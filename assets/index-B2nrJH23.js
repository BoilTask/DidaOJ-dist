import{bl as rt,L as re,r as d,q as ie,bm as K,bn as D,bo as l,v as t,bp as R,bq as F,au as T,br as aa,j as Aa,t as Ra,bs as le,bt as Ma,bu as ye,bv as ae,aI as ce,bw as Ea,bx as qa,by as Ka,u as Te,F as oe,H as qe,bz as Fa,bA as ke,bB as Ne,n as Fe,w as Le,a as Ye,ah as Na,bC as gt,bD as la,bE as na,bb as Ga,bF as Oa,bG as Ha,bH as Ba,bI as oa,aN as Wa,bJ as Kt,bK as Vt,bL as Ja,a5 as Xa,bM as Ya,bN as Za,N as Qa,bO as el}from"./node_modules-B06hKWRe.js";import{L as Ie,C as _e,R as Ce,a as Pe,A as jt,S as tl,b as al,c as ll,d as nl,e as at,B as J,F as je,f as ze,I as $e,D as Ze,g as sa,h as he,i as Ge,j as Oe,k as ol,T as Ve,l as ut,m as it,O as zt,n as ra,o as sl,p as rl,q as ua,r as ia,P as ca,s as kt,t as et,u as da,v as ul,w as il,x as cl,y as dl,z as ml,E as pl,M as ma,G as pa,H as fl,J as vl,K as _l,N as gl,Q as bl,U as hl,V as yl,W as wl,X as kl,Y as Cl}from"./tdesign-vue-next-jcmEfwi8.js";import{V as ge}from"./vditor-DArazWIS.js";import{e as Ft}from"./monaco-editor-BHsDS0An.js";import{H as Sl,v as Il}from"./highlight.js-D9zWiMxS.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))u(o);new MutationObserver(o=>{for(const v of o)if(v.type==="childList")for(const g of v.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&u(g)}).observe(document,{childList:!0,subtree:!0});function n(o){const v={};return o.integrity&&(v.integrity=o.integrity),o.referrerPolicy&&(v.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?v.credentials="include":o.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function u(o){if(o.ep)return;o.ep=!0;const v=n(o);fetch(o.href,v)}})();var Re=(e=>(e.ManageWeb="i-manage-web",e.ManageJudge="i-manage-judge",e.ManageProblem="i-manage-problem",e.ManageContest="i-manage-contest",e.ManageCollection="i-manage-collection",e))(Re||{});const Pl={"r-admin":["i-manage-web","i-manage-judge","i-manage-problem","i-manage-contest","i-manage-collection"]};function Tl(e){if(e==null)return[];const a=[];for(const n of e){const u=Pl[n];u!=null&&a.push(...u)}return[...new Set(a)]}function xl(e,a){if(e==null||a==null)return!1;const n=Tl(e);for(const u of a)if(!n.includes(u))return!1;return!0}const De=rt("user",{state:()=>({token:"",userId:-1,username:"",nickname:"",roles:[]}),getters:{getToken(){return this.token},getUserId(){return this.userId},getUsername(){return this.username},getNickname(){return this.nickname}},actions:{clear(){this.$patch({token:"",userId:-1,username:"",nickname:"",roles:[]})},loadResponse(e){this.$patch({token:e.token,userId:e.user_id,username:e.username,nickname:e.nickname,roles:e.roles})},isLogin(){return this.token!=null&&this.token!=""},hasAuth(e){return this.hasAllAuths([e])},hasAllAuths(e){return e?xl(this.roles,e):!0}},persist:!0}),Ke=rt("webStyle",{state:()=>({title:""}),getters:{getTitle(){return this.title}},actions:{setTitle(e){this.title=e}}}),Ct=rt("sidebarStyle",{state:()=>({showSidebar:!1,forceHiddenSidebar:!1,menuActiveName:"",menuList:[]}),getters:{getMenuList(){return this.menuList}},actions:{setSidebarShow(e){this.showSidebar=e},setForceHiddenSidebar(e){this.forceHiddenSidebar=e},setMenuActiveName(e){this.menuActiveName=e},clearMenuList(){this.menuList=[]},setMenuList(e){this.menuList=e},addMenuList(e){this.menuList.push(e)}}}),Vl={style:{"text-align":"right"}},Dl=re({__name:"Hitokoto",setup(e){const a=d(!1),n=d(""),u=d(""),o=d(""),v=async()=>{a.value=!0;try{const y=await(await fetch("https://v1.hitokoto.cn")).json();u.value=y.hitokoto,o.value=y.creator,n.value="—— "+y.from}catch(g){u.value="一言获取失败了，但至少您还可以访问本站。",o.value="BoilTask",n.value="DidaOJ",console.error("Error fetching Hitokoto:",g)}finally{a.value=!1}};return ie(()=>{v()}),(g,y)=>{const h=_e,_=Ie;return D(),K(_,{loading:a.value},{default:l(()=>[t(h,{title:"一言 © Hitokoto"},{actions:l(()=>[T(" @"+F(o.value),1)]),default:l(()=>[R("div",null,[R("span",null,F(u.value),1),R("p",Vl,F(n.value),1)])]),_:1})]),_:1},8,["loading"])}}}),Ll="https://oj-api.didapipa.com/",X=aa.create({baseURL:Ll,timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});X.interceptors.request.use(e=>{const n=De().getToken;return n&&(e.headers["X-Token"]=n),e},e=>Promise.reject(e));X.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});const St=aa.create({timeout:6e4,withCredentials:!1,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});St.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function fa(){return St({baseURL:"https://r2-oj.didapipa.com",url:"/system/notification.json?"+Date.now(),method:"get"})}function va(){return St({baseURL:"https://r2-oj.didapipa.com",url:"/system/announcement.json?"+Date.now(),method:"get"})}function jl(){return X({url:"/system/status",method:"get"})}function zl(){return X({url:"/system/image/token",method:"get"})}function $l(e,a){return X({url:"/system/notification",method:"post",data:{theme:e,content:a}})}function Ul(e,a){return X({url:"/system/announcement",method:"post",data:{title:e,content:a}})}let Dt=null;async function Al(){Dt=await Ml()}function Rl(e,a="zh"){if(Dt==null)return[!1,e.toString()];const n=Dt[e.toString()];if(!n)return[!1,e.toString()];let u=n[a];return u||(a="zh",u=n[a]),u?[!0,u]:[!1,e.toString()]}async function Ml(){return new Promise(e=>{e({404:{zh:"接口未找到"},1e3:{zh:"系统错误，请重试或等待管理员修复"},1001:{zh:"系统异常，请重试或等待管理员修复"},1002:{zh:"未知错误"},1003:{zh:"操作过于频繁，请稍后重试"},10001:{zh:"权限异常，请重新登陆后再试"},10002:{zh:"参数不符合要求"},10003:{zh:"未找到目标数据"},10004:{zh:"操作需要登录，请登录后重试"},100001:{zh:"用户名不存在或密码不匹配"},100002:{zh:"邮件发送失败，可能是邮箱无效或达到了每日注册上限，如有问题可联系管理员解决"},100003:{zh:"验证码错误或已过期，请重新获取"},100004:{zh:"注册用户失败，可能存在同名用户"},100005:{zh:"用户名不存在，或您未在本系统绑定邮箱，请联系管理员寻求帮助"},100006:{zh:"验证码错误或已过期，请重新获取"},100007:{zh:"已存在相同标题的题目"},100008:{zh:"已存在相同标题的比赛"},100009:{zh:"已存在相同标题的题集"},100010:{zh:"未发现有效题目"},100011:{zh:"题目数量超过限制，无法添加"},100012:{zh:"比赛开始时间无法设置为早于当前时间"},100013:{zh:"当前无法提交题目"},100014:{zh:"申请访问失败，密码错误"}})})}function de(){const{appContext:e}=Aa();return{globalProperties:e.config.globalProperties}}function Ae(){return 1e3}function Be(e,a,n=3e3){return e.$message.success({duration:n,content:a})}function fe(e,a,n=3e3){return e.$message.info({duration:n,content:a})}function pe(e,a,n=3e3){return e.$message.error({duration:n,content:a})}function O(e,a,n=3e3){const[u,o]=Rl(a),v=u?o:`系统错误，错误提示[${o}]`;return e.$message.error({duration:n,content:v})}function _a(e,a){e.$message&&e.$message.close(a)}function El(e,a){return e.length<=a?e:e.slice(0,a)+"..."}function ga(e){return e.trim().split(/\s+/).flatMap(u=>u.split(",")).filter(u=>u.trim()!=="")}var $t=(e=>(e[e.Unknown=-1]="Unknown",e[e.C=0]="C",e[e.Cpp=1]="Cpp",e[e.Java=2]="Java",e[e.Python=3]="Python",e[e.Pascal=4]="Pascal",e[e.Golang=5]="Golang",e[e.Lua=6]="Lua",e[e.TypeScript=7]="TypeScript",e[e.Max=8]="Max",e))($t||{});function Ut(){const e=[-1,8];return Object.values($t).filter(a=>typeof a=="number"&&!e.includes(a)).map(a=>({value:a,label:yt(a)}))}function bt(e){return e>-1&&e<8}function yt(e){switch(e){case 0:return"C";case 1:return"C++";case 2:return"Java";case 3:return"Python";case 4:return"Pascal";case 5:return"Golang";case 6:return"Lua";case 7:return"TypeScript";default:return"未知"}}function At(e){switch(e){case 0:return"c";case 1:return"cpp";case 2:return"java";case 3:return"python";case 4:return"pascal";case 5:return"go";case 6:return"lua";case 7:return"typescript";default:return"text"}}var Ue=(e=>(e[e.Init=0]="Init",e[e.Rejudge=1]="Rejudge",e[e.Submitting=2]="Submitting",e[e.Queuing=3]="Queuing",e[e.Compiling=4]="Compiling",e[e.Running=5]="Running",e[e.Accept=6]="Accept",e[e.PE=7]="PE",e[e.WA=8]="WA",e[e.TLE=9]="TLE",e[e.MLE=10]="MLE",e[e.OLE=11]="OLE",e[e.RE=12]="RE",e[e.CE=13]="CE",e[e.CLE=14]="CLE",e[e.JudgeFail=15]="JudgeFail",e[e.SubmitFail=16]="SubmitFail",e[e.Unknown=17]="Unknown",e[e.Max=18]="Max",e))(Ue||{});const ql=e=>{switch(e){case 0:return"普通评测";case 1:return"特殊评测";default:return"未知"}},wt=e=>{switch(e){case 0:return"等待处理";case 1:return"重新评测";case 2:return"提交中";case 3:return"队列中";case 4:return"编译中";case 5:return"运行中";case 6:return"通过";case 7:return"格式错误";case 8:return"答案错误";case 9:return"超时";case 10:return"内存超限";case 11:return"输出超限";case 12:return"运行错误";case 13:return"编译错误";case 14:return"编译超限";case 15:return"评测失败";case 16:return"提交失败";case 17:return"未知";default:return e}},ba=e=>{switch(e){case 0:case 1:case 2:case 3:case 4:case 5:case 17:return"default";case 6:return"success";case 7:return"warning";default:return"danger"}};function ha(){const e=[17,18];return Object.values(Ue).filter(a=>typeof a=="number"&&!e.includes(a)).map(a=>({value:a,label:wt(a)}))}function ht(e){return e>=0&&e<17}function st(e){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return!0;default:return!1}}function ya(e){var n;const a={};if(a.id=e.id,a.problemId=e.problem_id,a.contestProblemIndex=e.contest_problem_index,a.status=e.status,st(e.status)||!ht(e.status)?a.score="-":a.score=e.score.toString(),e.time?a.time=Math.ceil(e.time/1e6)+"ms":a.time="-",e.memory?a.memory=(e.memory/1024/1024).toFixed(2)+"MB":a.memory="-",a.language=e.language,a.codeLength=e.code_length,e.approve_time?a.approveTime=new Date(e.approve_time).toLocaleString():a.approveTime="-",a.author=e.author,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.code=e.code,a.compileMessage=e.compile_message,a.taskCurrent=e.task_current,a.taskTotal=e.task_total,a.task=[],e.task)for(let u=0;u<((n=e.task)==null?void 0:n.length);u++){const o=e.task[u],v={};v.taskId=o.task_id,v.status=o.status,o.time?v.time=Math.ceil(o.time/1e6)+"ms":v.time="-",o.memory?v.memory=(o.memory/1024/1024).toFixed(2)+"MB":v.memory="-",v.score=o.score,v.content=o.content,v.waHint=o.wa_hint,!v.content&&!v.waHint&&(v.content="无提示信息"),a.task.push(v)}return e.judger&&(a.judger=e.judger),e.judger_name?a.judgerName=e.judger_name:a.judgerName="-",e.judge_time&&(a.judgeTime=new Date(e.judge_time).toLocaleString()),a}function Kl(e,a,n,u,o){return X({url:"/judge/approve",method:"post",data:{problem_id:e,contest_id:a,problem_index:n,language:u,code:o}})}function Fl(e){return X({url:"/judge?id="+e,method:"get"})}function Nl(e){return X({url:"/judge/code?id="+e,method:"get"})}function Gl(e,a,n,u,o,v,g){let y={problem_id:a,username:n,language:String(u),status:String(o),page:String(v),page_size:String(g)};return e&&(y.contest_id=String(e)),X({url:`/judge/list?${new URLSearchParams(y).toString()}`,method:"get"})}function Ol(){return X({url:"/judge/statics/recently",method:"get"})}function Hl(){return X({url:"/judge/rejudge/recently",method:"post"})}function Bl(e,a,n){const u={};return e!=null&&(u.problem_id=e),a!=null?u.language=a:u.language=$t.Unknown,n!=null?u.status=n:u.status=18,X({url:"/judge/rejudge/search",method:"post",data:u})}function Wl(){return X({url:"/judge/rejudge/all",method:"post",timeout:0})}function Jl(e){return X({url:"/judge/rejudge",method:"post",data:{id:Number(e)}})}const Xl={class:"sh-main"},Yl={class:"dida-swiper-div"},Zl=["innerHTML"],Ql=re({__name:"HomeView",setup(e){const{globalProperties:a}=de();let n=-1;const u=d({theme:"",content:""}),o=d({title:"",content:""}),v=d(!1),g=async()=>{u.value=await fa()},y=async()=>{try{const _=await va(),r={math:{inlineDigit:!0,engine:"KaTeX"}};o.value.title=_.title,o.value.content=await ge.md2html(_.content,r)}catch{pe(a,"加载公告失败"),o.value={title:"公告加载失败",content:"请刷新页面重新获取"}}},h=async()=>{const _=await Ol();if(_.code!==0){pe(a,"加载OJ统计数据失败");return}let r=[];for(const p of _.data){const P=new Date(p.date),c=`${P.getMonth()+1}-${P.getDate()}`;r.push({Date:c,Type:"Unaccept",Count:p.attempt-p.accept}),r.push({Date:c,Type:"Accept",Count:p.accept})}const m={type:"bar",data:[{id:"barData",values:r}],xField:"Date",yField:"Count",seriesField:"Type",stack:!0,legends:{visible:!0},bar:{state:{hover:{stroke:"#000",lineWidth:1}}},height:300};new Ma(m,{dom:"ojStaticsDiv"}).renderSync()};return ie(async()=>{v.value=!0,await g(),n=setInterval(()=>{g()},3e4),await y(),await h(),v.value=!1}),Ra(()=>{clearInterval(n)}),(_,r)=>{const m=jt,f=al,p=tl,P=_e,c=Pe,C=at,k=nl,w=ll,i=Ce,s=Ie;return D(),K(s,{loading:v.value},{default:l(()=>[t(i,null,{default:l(()=>[t(c,{span:8},{default:l(()=>{var I;return[R("div",Xl,[u.value?(D(),K(m,{key:0,class:"dida-notification-div",theme:u.value.theme},{default:l(()=>[T(F(u.value.content),1)]),_:1},8,["theme"])):le("",!0),R("div",Yl,[t(p,{class:"dida-swiper"},{default:l(()=>[t(f,null,{default:l(()=>r[0]||(r[0]=[R("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1}),t(f,null,{default:l(()=>r[1]||(r[1]=[R("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1})]),_:1})]),r[2]||(r[2]=R("div",{id:"ojStaticsDiv"},null,-1)),t(P,{title:(I=o.value)==null?void 0:I.title,style:{width:"calc(100% - 100px)",margin:"0 auto"}},{default:l(()=>{var b;return[R("div",{innerHTML:(b=o.value)==null?void 0:b.content},null,8,Zl)]}),_:1},8,["title"])])]}),_:1}),t(c,{span:4},{default:l(()=>[t(P,{style:{margin:"10px"},bordered:!0},{default:l(()=>r[3]||(r[3]=[R("img",{src:"https://api.jysafe.cn/ip/",alt:"Welcome",style:{width:"100%"}},null,-1)])),_:1}),t(Dl,{style:{margin:"10px"}}),t(P,{style:{margin:"10px"},bordered:!0},{header:l(()=>r[4]||(r[4]=[R("b",null,"友情链接",-1)])),default:l(()=>[t(w,null,{default:l(()=>[t(k,null,{default:l(()=>[t(C,{href:"https://boiltask.com",target:"_blank"},{default:l(()=>r[5]||(r[5]=[T("BoilTask Blog")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])}}}),ue=(e,a)=>{const n=e.__vccOpts||e;for(const[u,o]of a)n[u]=o;return n},en=ue(Ql,[["__scopeId","data-v-6698351d"]]),tn={class:"sh-main"},an=re({__name:"View404",setup(e){let a=ye(),n=d(a.fullPath);return(u,o)=>{const v=J;return D(),ae("div",tn,[R("p",null,F(ce(n)),1),o[2]||(o[2]=R("p",null,"该页面无效或已被迁移，请重新选择访问目标",-1)),t(v,{theme:"primary",onClick:o[0]||(o[0]=()=>u.$router.push("/"))},{default:l(()=>o[1]||(o[1]=[T("返回首页")])),_:1})])}}}),wa=ue(an,[["__scopeId","data-v-d4218944"]]);function ln(e){const a={};return a.id=e.id,a.username=e.username,a.nickname=e.nickname,a.email=e.email,a.slogan=e.slogan,a.organization=e.organization,a.accept=e.accept,a.attempt=e.attempt,a.vjudgeId=e.vjudge_id,e.email&&(a.avatar=`https://www.gravatar.com/avatar/${Ea(e.email.toLowerCase().trim())}?d=identicon&s=100`),a}function nn(e,a){return X({url:"/user/login",method:"post",data:{username:e,password:a}})}function on(){return X({url:"/user/login/refresh",method:"post"})}function sn(e){const a={username:e};return X({url:`/user/info?${new URLSearchParams(a).toString()}`,method:"get"})}function rn(e){const a="https://vjudge.net/user/solveDetail/"+encodeURIComponent(e);return St({url:a,method:"get"})}function un(e){return X({url:"/user/account/infos",method:"post",data:{users:e}})}function cn(e){return X({url:"/user/parse",method:"post",data:{users:e}})}function dn(e,a){return X({url:"/user/register/email",method:"post",data:{token:e,email:a}})}function mn(e,a,n,u,o){return X({url:"/user/register",method:"post",data:{username:e,password:a,email:n,key:u,nickname:o}})}function pn(e,a){return X({url:"/user/forget",method:"post",data:{token:e,username:a}})}function fn(e,a,n){return X({url:"/user/password/modify",method:"post",data:{username:e,password:a,key:n}})}const vn={class:"dida-login-footer"},_n=re({__name:"LoginView",setup(e){const{globalProperties:a}=de(),n=De(),u=d(!1),o=d({username:"",password:""}),v=()=>{fe(a,"重置成功")},g=({validateResult:y,firstError:h})=>{u.value||(u.value=!0,nn(o.value.username,o.value.password).then(_=>{if(_.code===0){n.loadResponse(_.data),fe(a,"登录成功");let r=a.$route.query.redirect_uri;r||(r="/user/"+_.data.username),a.$router.push({path:r})}else O(a,_.code)}).catch(_=>{console.error("Login error",_),pe(a,"登录失败")}).finally(()=>{u.value=!1}))};return ie(()=>{if(n.isLogin()){a.$router.push({path:"/user"});return}}),(y,h)=>{const _=$e,r=ze,m=J,f=je,p=at,P=_e;return D(),K(P,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:l(()=>[t(f,{ref:"form",data:o.value,colon:!0,onReset:v,onSubmit:g,class:"yj-login-form","label-width":0},{default:l(()=>[t(r,{name:"username"},{default:l(()=>[t(_,{modelValue:o.value.username,"onUpdate:modelValue":h[0]||(h[0]=c=>o.value.username=c),clearable:"",autocomplete:"username",placeholder:"请输入用户名"},{"prefix-icon":l(()=>[t(ce(qa))]),_:1},8,["modelValue"])]),_:1}),t(r,{name:"password"},{default:l(()=>[t(_,{modelValue:o.value.password,"onUpdate:modelValue":h[1]||(h[1]=c=>o.value.password=c),type:"password",autocomplete:"current-password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":l(()=>[t(ce(Ka))]),_:1},8,["modelValue"])]),_:1}),t(r,null,{default:l(()=>[t(m,{theme:"primary",type:"submit",block:"",loading:u.value},{default:l(()=>h[4]||(h[4]=[T("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),R("div",vn,[t(p,{onClick:h[2]||(h[2]=()=>{ce(a).$router.push({name:"login-forget"})})},{default:l(()=>h[5]||(h[5]=[T("忘记密码 ")])),_:1}),t(p,{onClick:h[3]||(h[3]=()=>{ce(a).$router.push({name:"register"})})},{default:l(()=>h[6]||(h[6]=[T("注册账户 ")])),_:1})])]),_:1})}}}),gn=ue(_n,[["__scopeId","data-v-0466c42d"]]),bn={class:"dida-login-footer"},hn=re({__name:"RegisterView",setup(e){const{globalProperties:a}=de(),n=De(),u=d(!1),o=d(!1),v=d(!1),g=d("发送验证码");let y=null,h=-1;const _=d(!1),r=d(null),m=d({username:"",password:"",confirmPassword:"",nickname:"",email:"",emailKey:""}),p=d({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:i=>new Promise(s=>{const I=setTimeout(()=>{s(m.value.password===i),clearTimeout(I)})}),message:"两次密码不一致"}],nickname:[{required:!0,message:"请填写昵称"},{min:1,message:"昵称至少1个字符"},{max:30,message:"昵称最多30个字符"}],email:[{required:!0,message:"请填写邮箱"},{pattern:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"邮箱格式不正确"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),P=d(()=>t(J,{onClick:c,disabled:v.value,loading:o.value,style:"width:120px"},{default:()=>[g.value]})),c=async()=>{var b;if(!m.value.email){pe(a,"请输入邮箱");return}if(!m.value.email.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)){pe(a,"邮箱格式不正确");return}if(v.value||o.value)return;_.value=!0,await qe();const i=document.getElementById("cf-confirm-div");i&&i.remove();const s=document.createElement("div");s.id="cf-confirm-div",s.setAttribute("data-theme","light"),(b=r.value)==null||b.appendChild(s);const I=window;I.turnstile.ready(function(){I.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(x){_.value=!1,await C(x)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},C=async i=>{if(!v.value){o.value=!0;try{const s=await dn(i,m.value.email);if(s.code!==0){O(a,s.code);return}fe(a,"发送验证码成功"),o.value=!1,v.value=!0,y=new Date,g.value="60秒后重发",h=setInterval(()=>{const b=Math.floor((new Date().getTime()-(y==null?void 0:y.getTime()))/1e3);b>60?(g.value="发送验证码",v.value=!1,clearInterval(h)):g.value=`${60-b}秒后重发`},1e3)}catch{pe(a,"发送验证码失败")}finally{o.value=!1}}},k=()=>{fe(a,"重置成功")},w=({validateResult:i,firstError:s,e:I})=>{if(!u.value){if(I.preventDefault(),i!==!0){pe(a,s);return}if(m.value.password!==m.value.confirmPassword){pe(a,"两次密码不一致");return}u.value=!0,mn(m.value.username,m.value.password,m.value.email,m.value.emailKey,m.value.nickname).then(b=>{b.code===0?(fe(a,"注册成功，可使用账号信息登录"),a.$router.push({name:"login"})):O(a,b.code)}).catch(b=>{console.error("Login error",b),pe(a,"登录失败")}).finally(()=>{u.value=!1})}};return ie(()=>{if(n.isLogin()){a.$router.push({path:"/user"});return}}),Te(()=>{clearInterval(h)}),(i,s)=>{const I=$e,b=ze,x=sa,U=J,A=je,j=at,z=_e,E=Ze;return D(),ae(oe,null,[t(z,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:l(()=>[t(A,{ref:"form",rules:p.value,data:m.value,colon:!0,onReset:k,onSubmit:w,class:"yj-login-form"},{default:l(()=>[t(b,{name:"username",label:"用户名"},{default:l(()=>[t(I,{modelValue:m.value.username,"onUpdate:modelValue":s[0]||(s[0]=$=>m.value.username=$),clearable:"",placeholder:"用于登录与查找"},null,8,["modelValue"])]),_:1}),t(b,{name:"password",label:"密码"},{default:l(()=>[t(I,{modelValue:m.value.password,"onUpdate:modelValue":s[1]||(s[1]=$=>m.value.password=$),type:"password",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(b,{name:"confirmPassword",label:"确认密码"},{default:l(()=>[t(I,{modelValue:m.value.confirmPassword,"onUpdate:modelValue":s[2]||(s[2]=$=>m.value.confirmPassword=$),type:"password",clearable:"",placeholder:"请确认密码"},null,8,["modelValue"])]),_:1}),t(b,{name:"nickname",label:"昵称"},{default:l(()=>[t(I,{modelValue:m.value.nickname,"onUpdate:modelValue":s[3]||(s[3]=$=>m.value.nickname=$),clearable:"",placeholder:"用于优先在网站各处展示"},null,8,["modelValue"])]),_:1}),t(b,{name:"email",label:"邮箱"},{default:l(()=>[t(I,{modelValue:m.value.email,"onUpdate:modelValue":s[4]||(s[4]=$=>m.value.email=$),clearable:"",placeholder:"请填写常用邮箱"},null,8,["modelValue"])]),_:1}),t(b,{name:"emailKey",label:"验证码"},{default:l(()=>[t(x,{append:P.value},{default:l(()=>[t(I,{modelValue:m.value.emailKey,"onUpdate:modelValue":s[5]||(s[5]=$=>m.value.emailKey=$),clearable:"",placeholder:"请输入验证码",style:{width:"140px"}},null,8,["modelValue"])]),_:1},8,["append"])]),_:1}),t(b,null,{default:l(()=>[t(U,{theme:"primary",type:"submit",block:"",loading:u.value},{default:l(()=>s[8]||(s[8]=[T("注册")])),_:1},8,["loading"])]),_:1})]),_:1},8,["rules","data"]),R("div",bn,[t(j,{onClick:s[6]||(s[6]=()=>{ce(a).$router.push({name:"login"})})},{default:l(()=>s[9]||(s[9]=[T("返回登陆 ")])),_:1})])]),_:1}),t(E,{visible:_.value,"onUpdate:visible":s[7]||(s[7]=$=>_.value=$),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:l(()=>[R("div",{ref_key:"dialogContainer",ref:r,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),yn=ue(hn,[["__scopeId","data-v-d25e7538"]]),wn={key:0,style:{margin:"10px"}},kn={key:1,style:{margin:"10px"}},Cn={style:{margin:"12px"}},Sn=re({__name:"UserView",setup(e){let a=ye();const{globalProperties:n}=de(),u=Ke();let o="";const v=d(!1),g=d(null),y=d([]),h=d([]),_=d([]),r=async m=>{v.value=!0;try{let f=await sn(m);if(f.code!==0){v.value=!1,O(n,f.code),await Q.push({name:"home"});return}if(g.value=ln(f.data.user),y.value=f.data.problems_ac,u.setTitle(g.value.nickname+" - "+u.getTitle),g.value.vjudgeId){const p=await rn(g.value.vjudgeId);h.value=p.acRecords;for(const P in h.value)h.value[P].sort((c,C)=>c.length===C.length?c.localeCompare(C):c.length-C.length);_.value=p.failRecords;for(const P in _.value)_.value[P].sort((c,C)=>c.length===C.length?c.localeCompare(C):c.length-C.length)}}catch{pe(n,"获取用户信息失败"),await Q.push({name:"home"})}finally{v.value=!1}};return Fa(async(m,f,p)=>{if(Array.isArray(m.params.username)?o=m.params.username[0]:o=m.params.username,!o){await Q.push({name:"home"});return}await r(o),p()}),ie(async()=>{if(Array.isArray(a.params.username)?o=a.params.username[0]:o=a.params.username,!o){await Q.push({name:"home"});return}await r(o)}),(m,f)=>{const p=J,P=he,c=_e,C=at,k=Oe,w=Ge,i=Pe,s=ol,I=Ce,b=Ie;return D(),K(b,{loading:v.value},{default:l(()=>[t(I,{class:"dida-main-content"},{default:l(()=>[t(i,{span:8},{default:l(()=>{var x;return[t(c,{style:{margin:"10px"},title:"AC题目"},{default:l(()=>[t(P,{style:{"flex-wrap":"wrap"}},{default:l(()=>[(D(!0),ae(oe,null,ke(y.value,U=>(D(),K(p,{key:U,size:"small",onClick:()=>ce(Q).push({name:"problem-detail",params:{problemId:U}})},{default:l(()=>[T(F(U),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),(x=g.value)!=null&&x.vjudgeId?(D(),K(c,{key:0,style:{margin:"10px"},title:"vjudge.net"},{actions:l(()=>{var U;return[t(C,{href:"https://vjudge.net/user/"+((U=g.value)==null?void 0:U.vjudgeId),target:"_blank"},{default:l(()=>{var A;return[T("@"+F((A=g.value)==null?void 0:A.vjudgeId),1)]}),_:1},8,["href"])]}),default:l(()=>[h.value&&Object.keys(h.value).length>0?(D(),ae("div",wn,[f[0]||(f[0]=R("div",{style:{margin:"5px"}},[R("span",null,"AC")],-1)),t(w,{layout:"vertical",bordered:!0},{default:l(()=>[(D(!0),ae(oe,null,ke(h.value,(U,A)=>(D(),K(k,{key:A,label:A},{default:l(()=>[t(P,{style:{"flex-wrap":"wrap"}},{default:l(()=>[(D(!0),ae(oe,null,ke(U,j=>(D(),K(p,{key:j,size:"small",onClick:()=>ce(Q).push({name:"problem-detail",params:{problemId:A+"-"+j}})},{default:l(()=>[T(F(j),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):le("",!0),_.value&&Object.keys(_.value).length>0?(D(),ae("div",kn,[f[1]||(f[1]=R("div",{style:{margin:"5px"}},[R("span",null,"Fail")],-1)),t(w,{layout:"vertical",bordered:!0},{default:l(()=>[(D(!0),ae(oe,null,ke(_.value,(U,A)=>(D(),K(k,{key:A,label:A},{default:l(()=>[t(P,{style:{"flex-wrap":"wrap"}},{default:l(()=>[(D(!0),ae(oe,null,ke(U,j=>(D(),K(p,{key:j,size:"small",onClick:()=>ce(Q).push({name:"problem-detail",params:{problemId:A+"-"+j}})},{default:l(()=>[T(F(j),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):le("",!0)]),_:1})):le("",!0)]}),_:1}),t(i,{span:4},{default:l(()=>[R("div",Cn,[t(w,{layout:"vertical",bordered:!0},{default:l(()=>[t(k,{label:"头像"},{default:l(()=>{var x;return[t(s,{shape:"round",size:"100px",image:(x=g.value)==null?void 0:x.avatar,"hide-on-load-failed":!1},null,8,["image"])]}),_:1}),t(k,{label:"昵称"},{default:l(()=>{var x;return[T(F((x=g.value)==null?void 0:x.nickname),1)]}),_:1}),t(k,{label:"Slogan"},{default:l(()=>{var x;return[T(F((x=g.value)==null?void 0:x.slogan),1)]}),_:1}),t(k,{label:"邮箱"},{default:l(()=>{var x;return[T(F((x=g.value)==null?void 0:x.email),1)]}),_:1}),t(k,{label:"组织"},{default:l(()=>{var x;return[T(F((x=g.value)==null?void 0:x.organization),1)]}),_:1}),t(k,{label:"通过数量"},{default:l(()=>{var x;return[T(F((x=g.value)==null?void 0:x.accept),1)]}),_:1}),t(k,{label:"提交数量"},{default:l(()=>{var x;return[T(F((x=g.value)==null?void 0:x.attempt),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),In=ue(Sn,[["__scopeId","data-v-6d730b5a"]]),Rt=[{name:"home",path:"/",title:"首页",showSidebar:!1,disableGenerateTab:!0,component:en},{name:"problem",path:"/problem",title:"题目",icon:"calculation",showSidebar:!0,redirect:"problem-list"},{name:"collection-detail-tab",title:"题集",path:"/collection",showSidebar:!0,disableGenerateTab:!0,redirect:"problem-collection-list"},{name:"judge",path:"/judge",title:"评测",icon:"code",showSidebar:!0,redirect:"judge-list"},{name:"contest",path:"/contest",title:"比赛",icon:"application",showSidebar:!0,redirect:"contest-list"},{name:"contest-detail-tab",title:"比赛",path:"/contest",showSidebar:!0,disableGenerateTab:!0,redirect:"contest-list"},{name:"discuss",title:"讨论",path:"/discuss",icon:"sonic",showSidebar:!0,redirect:"discuss-list"},{name:"rank",path:"/rank",title:"排名",icon:"chart-column",showSidebar:!0,redirect:"rank-ac-all"},{name:"system",path:"/system",title:"系统",icon:"dashboard",showSidebar:!0,redirect:"system-status"},{name:"manage",path:"/manage",title:"管理",icon:"command",showSidebar:!0,redirect:"manage-web",auths:[Re.ManageWeb]},{name:"login",path:"/login",title:"登陆",showSidebar:!1,disableGenerateTab:!0,component:gn},{name:"register",path:"/register",title:"注册",showSidebar:!1,disableGenerateTab:!0,component:yn},{name:"user",path:"/user/:username+",title:"用户",showSidebar:!1,needLogin:!0,disableGenerateTab:!0,component:In},{name:"404",path:"/404",title:"404",showSidebar:!1,disableGenerateTab:!0,component:wa}],Pn=e=>Rt.find(a=>a.name==e),Tn=e=>{const a=[];return Rt.forEach(n=>{!n.disableGenerateTab&&e.hasAllAuths(n.auths)&&a.push(n)}),a},xn=e=>{Rt.forEach(a=>{const n={name:a.name,path:a.path,meta:{title:a.title,tab:a.name,showSidebar:a.showSidebar,needLogin:a.needLogin,redirect:a.redirect,tabAuths:a.auths},component:a.component};e.push(n)})};function ka(e){return e.children!==void 0}function Vn(e){return e.children!==void 0}var We=(e=>(e[e.None=0]="None",e[e.Attempt=1]="Attempt",e[e.Accept=2]="Accept",e))(We||{});function ct(e,a){const n={};if(n.id=e.id,n.author=e.author,n.title=e.title,n.tags=[],e.tags)for(const u of e.tags){const o=a[u];o&&n.tags.push(o)}if(n.private=e.private,n.accept=e.accept,n.attempt=e.attempt,e.description!=null&&(n.description=e.description),e.time_limit!=null&&e.time_limit>=0?n.timeLimit=e.time_limit.toString()+" ms":n.timeLimit="未知",e.memory_limit!=null&&e.memory_limit>=0?n.memoryLimit=(e.memory_limit/1024).toFixed(2)+" MB":n.memoryLimit="未知",e.judge_type!=null&&(n.judgeType=ql(e.judge_type)),e.insert_time!=null&&(n.insertTime=new Date(e.insert_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.source!=null){const u=/\[([^\]]+)\]\(([^)]+)\)/,o=e.source.match(u);o?(n.source=o[1],n.sourceUrl=o[2]):(n.source=e.source,n.sourceUrl="")}return e.judge_md5!=null&&(n.judgeMd5=e.judge_md5),e.origin_oj!=null&&(n.originOj=e.origin_oj),e.origin_id!=null&&(n.originId=e.origin_id),e.origin_url!=null&&(n.originUrl=e.origin_url),n}function Ca(e,a,n){const u={};return e?u.id=e:(u.contest_id=a,u.problem_index=n),X({url:`/problem?${new URLSearchParams(u).toString()}`,method:"get"})}function Sa(e){return X({url:"/problem/tag/list?max_count="+e,method:"get"})}function Dn(e){return X({url:"/problem/judge?id="+e,method:"get"})}function Ln(e,a,n,u,o,v){const g={};return e&&(g.oj=e),a&&(g.title=a),n&&(g.tag=n),u!==void 0&&(g.private=u?"1":"0"),o&&(g.page=o),v&&(g.page_size=v),X({url:`/problem/list?${new URLSearchParams(g).toString()}`,method:"get"})}function jn(e){const a={};return e&&(a.problem_id=e),X({url:`/problem/recommend?${new URLSearchParams(a).toString()}`,method:"get"})}function Ia(e,a){return X({url:"/problem/crawl",method:"post",data:{oj:e,id:a}})}function zn(e,a,n,u,o,v,g){return X({url:"/problem/create",method:"post",data:{title:e,time_limit:a,memory_limit:n,source:u,private:o,tags:v,description:g}})}function $n(e,a,n,u,o,v,g,y){return X({url:"/problem/edit",method:"post",data:{id:e,title:a,time_limit:n,memory_limit:u,source:o,private:v,tags:g,description:y}})}function Un(e,a){return X({url:"/problem/judge/data/download?id="+e+"&key="+a,method:"get"})}function An(e){return X({url:"/problem/image/token?id="+e,method:"get"})}function Rn(e,a){const n=new FormData;return n.append("id",e),n.append("zip",a),X({url:"/problem/judge/data",method:"post",data:n,headers:{"Content-Type":"multipart/form-data"},timeout:1e3*60*5})}function Mn(e){return X({url:"/problem/parse",method:"post",data:{problems:e}})}const En={style:{margin:"10px"}},qn={key:0,class:"dida-operation-container"};function Kn(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ye(e)}const Fn=re({__name:"ProblemList",setup(e){const a=ye(),n=Ne(),{globalProperties:u}=de(),o=De();let v=null;const g=d(!1),y={};let h={};const _=d(!1),r=Fe(()=>o.hasAuth(Re.ManageProblem)),m=d([{title:"ID",colKey:"id",cell:($,S)=>{let V=b(S.row.id);return t(J,{variant:"dashed",theme:V,onClick:()=>I(S.row.id)},{default:()=>[S.row.id]})}},{title:"标题",colKey:"title",cell:($,S)=>t(J,{variant:"text",onClick:()=>I(S.row.id)},{default:()=>[S.row.title]})},{title:"标签",colKey:"tags",cell:($,S)=>{const V=S.row.tags;if(!V||V.length===0)return"";let L=[];for(let M=0;M<V.length;M++){const B=V[M];L.push(t(J,{key:M,theme:"default",variant:"outline",size:"small",onClick:()=>A(B)},{default:()=>[B.name]}))}return t(he,null,Kn(L)?L:{default:()=>[L]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),f=d(!1);let p=1,P=50;const c=d({current:p,pageSize:P,defaultCurrent:p,defaultPageSize:P,total:0,pageSizeOptions:[50,100]}),C=d(),k=d(),w=[{label:"DidaOJ",value:"didaoj"},{label:"HDU",value:"hdu"},{label:"POJ",value:"poj"},{label:"NYOJ",value:"nyoj"}],i=d({oj:"",title:"",tag:"",private:!1}),s=d({oj:"",problem:""}),I=$=>{$&&n.push({path:"/problem/"+$})},b=$=>{if(!$||!h)return"default";const S=h[$];if(!S)return"default";switch(S){case We.Accept:return"success";case We.Attempt:return"warning";default:return"default"}},x=async()=>{await n.push({query:{...a.query,oj:i.value.oj,title:i.value.title,tag:i.value.tag,private:i.value.private?"1":"0",page:1,page_size:c.value.defaultPageSize}})},U=async()=>{try{_.value=!0;const $=await Ia(s.value.oj,s.value.problem);$.code===0?(fe(u,"搜索成功"),await n.push({name:"problem-detail",params:{problemId:$.data}})):O(u,$.code)}catch($){console.error($),O(u,Ae())}finally{_.value=!1}},A=$=>{$&&n.push({query:{...a.query,title:"",tag:$.name,page:1,page_size:c.value.defaultPageSize}})},j=()=>{n.push({name:"manage-problem-create"})},z=async($,S)=>{f.value=!0;try{const{current:V,pageSize:L}=$,M=await Ln(i.value.oj,i.value.title,i.value.tag,i.value.private,V,L);if(C.value=[],M.code===0){const B=M.data.list;if(!B||B.length<=0){c.value={...c.value,total:0},h={},fe(u,"未找到记录");return}B.forEach(Z=>{var G;const N=ct(Z,y);(G=C.value)==null||G.push(N)}),c.value={...c.value,total:M.data.total_count},h=M.data.problem_attempt_status}else S&&O(u,M.code)}catch(V){console.error(V),O(u,Ae())}finally{f.value=!1}},E=async $=>{await n.push({query:{...a.query,page:$.current,page_size:$.pageSize}})};return ie(async()=>{f.value=!0,k.value=[],Sa(-1).then($=>{if($.code===0){k.value=$.data.list,g.value=$.data.total_count>$.data.list.length;for(let S=0;S<$.data.list.length;S++){const V=$.data.list[S];y[V.id]=V}v=Le(()=>a.query,S=>{i.value.oj=S.oj||"",i.value.title=S.title||"",i.value.tag=S.tag||"",i.value.private=S.private==="1";const V=parseInt(S.page)||c.value.defaultCurrent,L=parseInt(S.page_size)||c.value.defaultPageSize;p=V,P=L,c.value={...c.value,current:p,pageSize:P},z({current:p,pageSize:P},!0)},{immediate:!0})}else g.value=!0}).catch($=>{console.error($),g.value=!0})}),Te(()=>{v&&v()}),($,S)=>{const V=Ve,L=_e,M=Pe,B=J,Z=he,N=ut,G=ze,q=$e,be=it,Se=je,W=Ce;return D(),K(W,null,{default:l(()=>[t(M,{span:9},{default:l(()=>[t(L,{style:{margin:"10px"}},{default:l(()=>[t(V,{data:C.value,columns:m.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:c.value,"table-layout":"auto",loading:f.value,onPageChange:E},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(M,{span:3},{default:l(()=>[R("div",En,[r.value?(D(),ae("div",qn,[t(Z,null,{default:l(()=>[t(B,{onClick:j},{default:l(()=>S[7]||(S[7]=[T("新建")])),_:1})]),_:1})])):le("",!0),t(L,{class:"sh-card"},{default:l(()=>[t(Se,{model:i.value,onSubmit:x},{default:l(()=>[t(G,{label:"OJ"},{default:l(()=>[t(N,{modelValue:i.value.oj,"onUpdate:modelValue":S[0]||(S[0]=H=>i.value.oj=H),options:w,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(G,{label:"标题"},{default:l(()=>[t(q,{modelValue:i.value.title,"onUpdate:modelValue":S[1]||(S[1]=H=>i.value.title=H),placeholder:"请输入关键词"},null,8,["modelValue"])]),_:1}),t(G,{label:"标签"},{default:l(()=>[t(q,{modelValue:i.value.tag,"onUpdate:modelValue":S[2]||(S[2]=H=>i.value.tag=H),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),r.value?(D(),K(G,{key:0,label:"私有"},{default:l(()=>[t(be,{modelValue:i.value.private,"onUpdate:modelValue":S[3]||(S[3]=H=>i.value.private=H)},null,8,["modelValue"])]),_:1})):le("",!0),t(G,null,{default:l(()=>[t(B,{theme:"primary",type:"submit"},{default:l(()=>S[8]||(S[8]=[T("搜索")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(L,{class:"sh-card"},{default:l(()=>[t(Se,{model:s.value,onSubmit:U},{default:l(()=>[t(G,{label:"OJ"},{default:l(()=>[t(N,{modelValue:s.value.oj,"onUpdate:modelValue":S[4]||(S[4]=H=>s.value.oj=H),options:w,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(G,{label:"题目"},{default:l(()=>[t(q,{modelValue:s.value.problem,"onUpdate:modelValue":S[5]||(S[5]=H=>s.value.problem=H),placeholder:"请输入原始题号"},null,8,["modelValue"])]),_:1}),t(G,null,{default:l(()=>[t(B,{theme:"primary",type:"submit",loading:_.value},{default:l(()=>S[9]||(S[9]=[T("前往")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),t(L,{class:"sh-card sh-background-black"},{default:l(()=>[(D(!0),ae(oe,null,ke(k.value,H=>(D(),K(B,{class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:()=>A(H)},{default:l(()=>[T(F(H.name),1)]),_:2},1032,["onClick"]))),256)),g.value?(D(),K(B,{key:0,class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:S[6]||(S[6]=()=>$.$router.push("/problem/tags"))},{default:l(()=>S[10]||(S[10]=[T(" ... ")])),_:1})):le("",!0)]),_:1})])]),_:1})]),_:1})}}}),Nn=ue(Fn,[["__scopeId","data-v-bc7185f5"]]);function tt(e){e.querySelectorAll("pre > code:not([data-copy-attached])").forEach(n=>{n.setAttribute("data-copy-attached","true");const u=n.parentElement,o=document.createElement("div");o.className="copy-wrapper";const v=document.createElement("button");v.className="copy-btn",v.innerText="复制",v.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(n.innerText),v.innerText="已复制",setTimeout(()=>v.innerText="复制",1500)}catch{v.innerText="失败"}}),u.replaceWith(o),o.appendChild(v),o.appendChild(u)})}function Xe(e){let a="";for(;e>0;)e--,a=String.fromCharCode(65+e%26)+a,e=Math.floor(e/26);return a}async function Mt(e){const a={};a.id=e.id,a.ownerId=e.owner_id,a.ownerUsername=e.owner_username,a.ownerNickname=e.owner_nickname,a.title=e.title,a.startTime=new Date(e.start_time).toLocaleString(),a.endTime=new Date(e.end_time).toLocaleString(),a.createTime=new Date(e.create_time).toLocaleString(),a.updateTime=new Date(e.update_time).toLocaleString(),a.private=e.private;const n={math:{inlineDigit:!0,engine:"KaTeX"}};if(a.description=await ge.md2html(e.description,n),a.notification=e.notification,e.problems){a.problems=[],e.problems.sort((u,o)=>u.index-o.index);for(let u=0;u<e.problems.length;u++){const o=e.problems[u];let v={accept:0,attempt:0,author:"",id:"",private:!1,tags:[],title:""};v.index=o.index,v.id=Xe(o.index),v.title=o.title,o.accept?v.accept=o.accept:v.accept=0,o.attempt?v.attempt=o.attempt:v.attempt=0,a.problems.push(v)}}return a}function Gn(e){return X({url:"/contest?id="+e,method:"get"})}function On(e){return X({url:"/contest/edit?id="+e,method:"get"})}function Hn(e){return X({url:"/contest/problem/list?id="+e,method:"get"})}function Bn(e,a){return X({url:"/contest/problem?id="+e+"&problem_index="+a,method:"get"})}function Wn(e,a){return X({url:"/contest/list?page="+e+"&page_size="+a,method:"get"})}function Jn(e){return X({url:"/contest/rank?id="+e,method:"get"})}function Xn(e){return X({url:"/contest/create",method:"post",data:e})}function Yn(e){return X({url:"/contest/edit",method:"post",data:e})}function Zn(e,a){return X({url:"/contest/password",method:"post",data:{id:e,password:a}})}function Qn(e){return X({url:"/contest/dolos",method:"post",data:{id:e}})}const Et=async(e,a)=>{a&&await e.push({name:"user",params:{username:a}})},Nt=e=>{const a=Q.resolve({name:"problem-detail",params:{problemId:e}});window.open(a.href,"_blank")},Lt=async(e,a)=>{await Q.push({name:"contest-problem-detail",params:{contestId:e,problemIndex:a}})},eo=["innerHTML"],to={key:0,class:"dida-problems-container"},ao={style:{margin:"12px"}},lo={key:1},no={class:"dida-operation-container"},oo={key:0,class:"dida-operation-container"},so={class:"dida-code-submit-div"},ro=re({__name:"ProblemDetail",setup(e){let a=ye();const{globalProperties:n}=de();let u=null;const o=Ke(),v=De();let g=d(""),y="",h=0,_=d(0);const r=d(!1),m=d(null),f=d(!1),p=d(null);let P=null;const c=d(null),C=d(!1),k=d(!1),w={},i=d(""),s=d([]);s.value=Ut();const I=d([]),b=Fe(()=>v.hasAuth(Re.ManageProblem)),x=L=>{L&&Q.push({name:"problem-list",query:{...a.query,title:"",tag:L.name}})},U=async()=>{let L=y;if(!L)try{const M=await Bn(h,_.value);M.code===0?L=M.data:O(n,M.code)}catch{pe(n,"获取题目ID失败，请稍后再试");return}await Q.push({name:"manage-problem",params:{problemId:L}})},A=()=>{y?Q.push({name:"judge-list",query:{problem_id:y}}):Q.push({name:"contest-judge",params:{contestId:h},query:{problem_id:Xe(_.value)}})},j=()=>{y?Q.push({name:"discuss-list-problem",query:{problem_id:y}}):Q.push({name:"contest-discuss",params:{contestId:h},query:{problem_id:Xe(_.value)}})},z=()=>{Q.push({name:"problem-recommend",params:{problemId:y}})},E=async()=>{var B,Z;const L=(B=p.value)==null?void 0:B.originOj,M=(Z=p.value)==null?void 0:Z.originId;if(!(!L||!M))try{C.value=!0;const N=await Ia(L,M);N.code===0?(await V(),fe(n,"更新成功")):O(n,N.code)}catch{pe(n,"更新失败，请稍后再试")}finally{C.value=!1}},$=async()=>{const L=parseInt(i.value);if(!bt(L)){pe(n,"请选择所编写的语言");return}const M=P==null?void 0:P.getValue();if(!M){pe(n,"请输入所需提交的代码");return}if(!y&&(!h||!_.value)){pe(n,"问题ID无效");return}k.value=!0;try{const B=await Kl(y,h,_.value,L,M);if(B.code!==0){O(n,B.code);return}fe(n,"提交成功，正在跳转到详情页面");const Z=B.data.id;h?await Q.push({name:"contest-judge-detail",params:{contestId:h,judgeId:Z}}):await Q.push({name:"judge-detail",params:{judgeId:Z}})}finally{k.value=!1}},S=L=>{if(!P)return;const M=P.getModel();M&&Ft.setModelLanguage(M,At(L))},V=async()=>{I.value=[];let L=await Ca(y,h,_.value);if(L.code!==0){f.value=!1,O(n,L.code),await Q.push({name:"problem"});return}L.data.tags&&L.data.tags.forEach(Z=>{w[Z.id]=Z}),p.value=ct(L.data.problem,w),o.setTitle(p.value.title+" - "+o.getTitle);let M=p.value.description;h&&(L=await Hn(h),L.code===0?(L.data.problems.sort((Z,N)=>Z-N),I.value=L.data.problems):O(n,L.code));const B={math:{inlineDigit:!0,engine:"KaTeX"}};g.value=await ge.md2html(M,B),await qe(()=>{m.value&&(ge.mathRender(m.value),ge.highlightRender({lineNumber:!0,enable:!0},m.value),tt(m.value),!P&&c.value&&(P=Ft.create(c.value,{value:"",language:"cpp",minimap:{enabled:!0},colorDecorators:!0,readOnly:!1,theme:"vs-dark"}))),f.value=!1})};return ie(async()=>{u=Le(()=>a.params,async()=>{if(Array.isArray(a.params.problemId)?y=a.params.problemId[0]:y=a.params.problemId,!y){if(Array.isArray(a.params.contestId)?h=Number(a.params.contestId[0]):h=Number(a.params.contestId),!h){pe(n,"题目不存在"),await Q.push({name:"problem"});return}if(Array.isArray(a.params.problemIndex)?_.value=parseInt(a.params.problemIndex[0]):_.value=parseInt(a.params.problemIndex),!_.value){pe(n,"题目不存在"),await Q.push({name:"problem"});return}}r.value=!!h,f.value=!0,await V()},{immediate:!0})}),Te(()=>{u&&(u(),u=null)}),(L,M)=>{const B=_e,Z=Pe,N=J,G=he,q=Oe,be=at,Se=Ge,W=zt,H=ut,ne=Ce,ee=Ie;return D(),K(ee,{loading:f.value},{default:l(()=>[t(ne,{class:"dida-main-content"},{default:l(()=>[t(Z,{span:8},{default:l(()=>[t(B,{style:{margin:"10px"}},{default:l(()=>[R("div",{innerHTML:ce(g),ref_key:"markdownRef",ref:m},null,8,eo)]),_:1})]),_:1}),t(Z,{span:4},{default:l(()=>{var me;return[ce(h)?(D(),ae("div",to,[t(G,{style:{"flex-wrap":"wrap"}},{default:l(()=>[(D(!0),ae(oe,null,ke(I.value,(se,te)=>(D(),K(N,{key:te,theme:se==ce(_)?"primary":"default",onClick:async()=>await ce(Lt)(ce(h),se)},{default:l(()=>[T(F(ce(Xe)(se)),1)]),_:2},1032,["theme","onClick"]))),128))]),_:1})])):le("",!0),R("div",ao,[t(Se,{layout:"vertical",bordered:!0},{default:l(()=>{var se;return[t(q,{label:"标题"},{default:l(()=>{var te;return[T(F((te=p.value)==null?void 0:te.title),1)]}),_:1}),t(q,{label:"时间限制"},{default:l(()=>{var te;return[T(F((te=p.value)==null?void 0:te.timeLimit),1)]}),_:1}),t(q,{label:"内存限制"},{default:l(()=>{var te;return[T(F((te=p.value)==null?void 0:te.memoryLimit),1)]}),_:1}),t(q,{label:"判题方式"},{default:l(()=>{var te;return[T(F((te=p.value)==null?void 0:te.judgeType),1)]}),_:1}),r.value?le("",!0):(D(),K(q,{key:0,label:"正确提交"},{default:l(()=>{var te;return[T(F((te=p.value)==null?void 0:te.accept),1)]}),_:1})),r.value?le("",!0):(D(),K(q,{key:1,label:"提交总数"},{default:l(()=>{var te;return[T(F((te=p.value)==null?void 0:te.attempt),1)]}),_:1})),t(q,{label:"创建时间"},{default:l(()=>{var te;return[T(F((te=p.value)==null?void 0:te.insertTime),1)]}),_:1}),t(q,{label:"更新时间"},{default:l(()=>{var te;return[T(F((te=p.value)==null?void 0:te.updateTime),1)]}),_:1}),t(q,{label:"上传用户"},{default:l(()=>{var te;return[T(F((te=p.value)==null?void 0:te.creatorNickname),1)]}),_:1}),r.value?le("",!0):(D(),K(q,{key:2,label:"题目来源"},{default:l(()=>{var te,we,Y;return[(te=p.value)!=null&&te.sourceUrl?(D(),K(be,{key:0,href:(we=p.value)==null?void 0:we.sourceUrl,target:"_blank"},{default:l(()=>{var ve;return[T(F((ve=p.value)==null?void 0:ve.source),1)]}),_:1},8,["href"])):(D(),ae("span",lo,F((Y=p.value)==null?void 0:Y.source),1))]}),_:1})),b.value?(D(),K(q,{key:3,label:"是否私有"},{default:l(()=>{var te;return[T(F((te=p.value)!=null&&te.private?"私有":"公开"),1)]}),_:1})):le("",!0),(se=p.value)!=null&&se.originUrl?(D(),K(q,{key:4,label:"原题链接"},{default:l(()=>{var te;return[t(be,{href:(te=p.value)==null?void 0:te.originUrl,target:"_blank"},{default:l(()=>{var we,Y;return[T(F((we=p.value)==null?void 0:we.originOj)+" - "+F((Y=p.value)==null?void 0:Y.originId),1)]}),_:1},8,["href"])]}),_:1})):le("",!0),ce(y)?(D(),K(q,{key:5,label:"标签"},{default:l(()=>[t(G,null,{default:l(()=>{var te;return[(D(!0),ae(oe,null,ke((te=p.value)==null?void 0:te.tags,we=>(D(),K(N,{key:we.id,variant:"dashed",onClick:()=>x(we)},{default:l(()=>[T(F(we.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})):le("",!0)]}),_:1}),R("div",no,[t(G,null,{default:l(()=>[t(N,{onClick:A},{default:l(()=>M[1]||(M[1]=[T("提交记录")])),_:1}),t(N,{onClick:j},{default:l(()=>M[2]||(M[2]=[T("题目讨论")])),_:1}),ce(y)?(D(),K(N,{key:0,onClick:z},{default:l(()=>M[3]||(M[3]=[T("题目推荐")])),_:1})):le("",!0)]),_:1})]),b.value||(me=p.value)!=null&&me.originId?(D(),ae("div",oo,[t(G,null,{default:l(()=>{var se;return[b.value?(D(),K(N,{key:0,onClick:U},{default:l(()=>M[4]||(M[4]=[T("编辑")])),_:1})):le("",!0),(se=p.value)!=null&&se.originId?(D(),K(N,{key:1,onClick:E,loading:C.value},{default:l(()=>M[5]||(M[5]=[T("更新描述 ")])),_:1},8,["loading"])):le("",!0)]}),_:1})])):le("",!0),R("div",so,[t(G,null,{default:l(()=>[t(H,{modelValue:i.value,"onUpdate:modelValue":M[0]||(M[0]=se=>i.value=se),label:"语言：",placeholder:"请选择提交语言","auto-width":"",clearable:"",onChange:S},{default:l(()=>[(D(!0),ae(oe,null,ke(s.value,se=>(D(),K(W,{key:se.value,value:se.value,label:se.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),t(N,{onClick:$,loading:k.value},{default:l(()=>M[6]||(M[6]=[T("提交")])),_:1},8,["loading"])]),_:1}),R("div",{ref_key:"codeEditRef",ref:c,class:"dida-code-editor"},null,512)])])]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),Gt=ue(ro,[["__scopeId","data-v-f1bba400"]]),uo={style:{margin:"10px"}};function io(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ye(e)}const co=re({__name:"ProblemRecommend",setup(e){const a=ye(),n=Ne(),{globalProperties:u}=de();let o=null,v="",g={},y={};const h=d([{title:"ID",colKey:"id",cell:(c,C)=>{let k=f(C.row.id);return t(J,{variant:"dashed",theme:k,onClick:()=>m(C.row.id)},{default:()=>[C.row.id]})}},{title:"标题",colKey:"title",cell:(c,C)=>t(J,{variant:"text",onClick:()=>m(C.row.id)},{default:()=>[C.row.title]})},{title:"标签",colKey:"tags",cell:(c,C)=>{const k=C.row.tags;if(!k||k.length===0)return"";let w=[];for(let i=0;i<k.length;i++){const s=k[i];w.push(t(J,{key:i,theme:"default",variant:"outline",size:"small",onClick:()=>p(s)},{default:()=>[s.name]}))}return t(he,null,io(w)?w:{default:()=>[w]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),_=d(!1),r=d(),m=c=>{c&&n.push({path:"/problem/"+c})},f=c=>{if(!c||!y)return"default";const C=y[c];if(!C)return"default";switch(C){case We.Accept:return"success";case We.Attempt:return"warning";default:return"default"}},p=c=>{c&&n.push({name:"problem-list",query:{tag:c.name}})},P=async c=>{_.value=!0;try{const C=await jn(v);if(r.value=[],C.code===0){const k=C.data.list;if(!k||k.length<=0){fe(u,"暂无推荐题目");return}g={},C.data.tags&&C.data.tags.forEach(w=>{g[w.id]=w}),k.forEach(w=>{var s;const i=ct(w,g);(s=r.value)==null||s.push(i)})}else c&&O(u,C.code)}catch(C){console.error(C),O(u,Ae())}finally{_.value=!1}};return ie(async()=>{_.value=!0,o=Le(()=>a.query,c=>{Array.isArray(a.params.problemId)?v=a.params.problemId[0]:v=a.params.problemId,P(!0)},{immediate:!0})}),Te(()=>{o&&o()}),(c,C)=>{const k=Ve,w=_e,i=Pe,s=Ce;return D(),K(s,null,{default:l(()=>[t(i,{span:9},{default:l(()=>[t(w,{style:{margin:"10px"}},{default:l(()=>[t(k,{data:r.value,columns:h.value,"row-key":"id","vertical-align":"top",hover:!0,"table-layout":"auto",loading:_.value},null,8,["data","columns","loading"])]),_:1})]),_:1}),t(i,{span:3},{default:l(()=>[R("div",uo,[t(w,{class:"sh-card",header:"题目推荐","header-bordered":!0},{default:l(()=>C[0]||(C[0]=[T(" 根据本站其他用户的提交记录推荐类似题目"),R("br",null,null,-1),T("依据推荐算法来计算，与本用户相似度最高的用户做的题，大概率被自己感兴趣。 ")])),_:1})])]),_:1})]),_:1})}}}),mo=ue(co,[["__scopeId","data-v-77972e8b"]]);function Pa(e,a){return fetch(e,{method:"PUT",headers:{"Content-Type":a.type},body:a})}async function po(e,a,n,u){var v;if(!e)return O(n,"编辑器已失效，请刷新后重试"),null;const o=fe(n,"图片正在上传，请稍候...",0);console.log("正在上传图片",a),e.disabled();try{for(const g of a){console.log(g);const h=`[正在上传 ⏳ ${((v=crypto.randomUUID)==null?void 0:v.call(crypto))||Math.random().toString(36).substring(2)}]`;let _=h.replace("⏳",'<span class="sh-anim-loop" style="display: inline-block; font-size: 16px;">⏳</span>');e.insertValue(`
${_}
`,!1);const r=await u();if(r.code!==0){O(n,r.code);let P=e.getValue();P=P.replace(h,"图片上传失败"),e.setValue(P);continue}const m=r.data.upload_url;await Pa(m,g);const f="![图片]("+r.data.preview_url+")";let p=e.getValue();p=p.replace(h,f),e.setValue(p)}}finally{e.enable(),_a(n,o)}return null}const fo={style:{margin:"10px"}},vo={key:1},_o={style:{margin:"12px"}},go={class:"dida-edit-container"},bo=re({__name:"ProblemEdit",setup(e){let a=ye();const{globalProperties:n}=de(),u=Ke(),o=d(""),v=d(!1);let g=null;const y=d(!1),h=d(null),_=d({title:"",timeLimit:0,memoryLimit:0,source:"",private:!0,tags:[]}),r=d([]),m=d([]),f=Fe(()=>{const I=[],b=r.value;for(let x=0,U=b.length;x<U;x++)b[x].value&&I.push(b[x].value);return I}),p=(I,b)=>{const{trigger:x,index:U,item:A}=b;if(x==="clear"&&(r.value=[]),["tag-remove","backspace"].includes(x)&&r.value.splice(U,1),x==="enter"){for(let z=0;z<m.value.length;z++){const E=m.value[z];if(E.label===A){for(let $=0;$<r.value.length;$++)if(r.value[$].label===E.label)return;r.value.push(E);return}}const j={label:A,value:A};r.value.push(j),m.value=m.value.concat(j)}},P=(I,{current:b,type:x})=>{if(!b){r.value=x==="check"?m.value.slice(1):[];return}if(x==="check"){const U=m.value.find(A=>A.value===b);if(!U)return;r.value.push(U)}else r.value=r.value.filter(U=>U.value!==b)},c=()=>{Q.push({name:"problem-detail",params:{problemId:o.value}})},C=()=>{Q.push({name:"manage-problem-judge",params:{problemId:o.value}})},k=async()=>{if(g){y.value=!0,_.value.tags=[];for(let I=0;I<r.value.length;I++){const b=r.value[I];b&&b.label&&_.value.tags.push(b.label)}try{const I=await zn(_.value.title,_.value.timeLimit,_.value.memoryLimit,_.value.source,_.value.private,_.value.tags,g.getValue());if(y.value=!0,I.code!==0){O(n,I.code);return}I.data!=null&&await Q.push({name:"problem-detail",params:{problemId:I.data}}),Be(n,"创建成功")}finally{y.value=!1}}},w=async()=>{if(g){y.value=!0,_.value.tags=[];for(let I=0;I<r.value.length;I++){const b=r.value[I];b&&b.label&&_.value.tags.push(b.label)}try{const I=await $n(o.value,_.value.title,_.value.timeLimit,_.value.memoryLimit,_.value.source,_.value.private,_.value.tags,g.getValue());if(y.value=!0,I.code!==0){O(n,I.code);return}I.data.update_time!=null&&(h.value.updateTime=new Date(I.data.update_time).toLocaleString()),I.data.description!=null&&(g==null||g.setValue(I.data.description)),Be(n,"保存成功")}finally{y.value=!1}}},i=I=>{const b={after:()=>{g==null||g.setValue(I),v.value=!1},upload:{accept:"image/*,.mp3, .wav, .rar",token:"test",url:"/api/upload/editor",linkToImgUrl:"/api/upload/fetch",filename(x){return x.replace(/[^(a-zA-Z0-9\u4e00-\u9fa5\.)]/g,"").replace(/[\?\\/:|<>\*\[\]\(\)\$%\{\}@~]/g,"").replace("/\\s/g","")},async handler(x){var A;if(!g)return O(n,"编辑器已失效，请刷新后重试"),null;const U=fe(n,"图片正在上传，请稍候...",0);console.log("正在上传图片",x),g.disabled();for(const j of x){console.log(j);const E=`[正在上传 ⏳ ${((A=crypto.randomUUID)==null?void 0:A.call(crypto))||Math.random().toString(36).substring(2)}]`;let $=E.replace("⏳",'<span class="sh-anim-loop" style="display: inline-block; font-size: 16px;">⏳</span>');g.insertValue(`
${$}
`,!1);const S=await An(o.value);if(S.code!==0){O(n,S.code);let B=g.getValue();B=B.replace(E,"图片上传失败"),g.setValue(B);continue}const V=S.data.upload_url;await Pa(V,j);const L="![图片]("+S.data.preview_url+")";let M=g.getValue();M=M.replace(E,L),g.setValue(M)}return g.enable(),_a(n,U),null}},preview:{math:{inlineDigit:!0,engine:"KaTeX"}}};g=new ge("problemEditDiv",b)},s=async()=>{const I=await Ca(o.value,void 0,void 0);if(I.code!==0){O(n,I.code),console.error("problem get failed",I.code),await Q.push({name:"problem"});return}const b=I.data.problem;if(h.value=ct(b,{}),_.value.title=b.title,_.value.timeLimit=b.time_limit,_.value.memoryLimit=b.memory_limit,_.value.source=b.source,_.value.private=b.private,_.value.tags=[],r.value=[],I.data.tags)for(let U=0;U<I.data.tags.length;U++){const A=I.data.tags[U];A&&A.name&&(_.value.tags.push(A.name),r.value.push({label:A.name,value:A.id}))}u.setTitle(b.title+" - "+u.getTitle);let x=b.description;i(x)};return ie(async()=>{Array.isArray(a.params.problemId)?o.value=a.params.problemId[0]:o.value=a.params.problemId,o.value?(v.value=!0,Sa(-1).then(async I=>{I.code===0?(I.data.list&&I.data.list.forEach(b=>{m.value.push({label:b.name,value:b.id})}),await s()):(O(n,I.code),console.error("problem tag get failed",I.code),await Q.push({name:"problem"}))}).catch(async I=>{console.error(I),O(n,"获取数据异常"),await Q.push({name:"problem"})})):(_.value.timeLimit=1e3,_.value.memoryLimit=65536,i(""))}),(I,b)=>{const x=$e,U=ze,A=ra,j=it,z=rl,E=sl,$=je,S=_e,V=Pe,L=J,M=he,B=Oe,Z=Ge,N=Ce,G=Ie;return D(),K(G,{loading:v.value},{default:l(()=>[t(N,null,{default:l(()=>[t(V,{span:8},{default:l(()=>[R("div",fo,[t(S,{class:"sh-card"},{default:l(()=>[t($,{model:_.value},{default:l(()=>[t(U,{label:"标题"},{default:l(()=>[t(x,{modelValue:_.value.title,"onUpdate:modelValue":b[0]||(b[0]=q=>_.value.title=q),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),t(U,{label:"时间限制"},{default:l(()=>[t(A,{modelValue:_.value.timeLimit,"onUpdate:modelValue":b[1]||(b[1]=q=>_.value.timeLimit=q),theme:"normal",min:0},{suffix:l(()=>b[5]||(b[5]=[R("span",null,"ms",-1)])),_:1},8,["modelValue"])]),_:1}),t(U,{label:"内存限制"},{default:l(()=>[t(A,{modelValue:_.value.memoryLimit,"onUpdate:modelValue":b[2]||(b[2]=q=>_.value.memoryLimit=q),theme:"normal",min:0},{suffix:l(()=>b[6]||(b[6]=[R("span",null,"KB",-1)])),_:1},8,["modelValue"])]),_:1}),t(U,{label:"来源"},{default:l(()=>[t(x,{modelValue:_.value.source,"onUpdate:modelValue":b[3]||(b[3]=q=>_.value.source=q),placeholder:"请输入题目来源"},null,8,["modelValue"])]),_:1}),t(U,{label:"私有"},{default:l(()=>[t(j,{modelValue:_.value.private,"onUpdate:modelValue":b[4]||(b[4]=q=>_.value.private=q)},null,8,["modelValue"])]),_:1}),t(U,{label:"标签"},{default:l(()=>[t(E,{value:r.value,"allow-input":!0,placeholder:"请选择或输入","tag-input-props":{excessTagsDisplayType:"break-line"},"popup-props":{overlayInnerClassName:["narrow-scrollbar"],overlayInnerStyle:{maxHeight:"280px",overflowY:"auto",overscrollBehavior:"contain",padding:"6px"}},clearable:"",multiple:"",onTagChange:p},{panel:l(()=>[m.value.length?(D(),K(z,{key:0,value:f.value,options:m.value,onChange:P},null,8,["value","options"])):(D(),ae("div",vo,"暂无数据"))]),suffixIcon:l(()=>[t(ce(Na))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(V,{span:4},{default:l(()=>[R("div",_o,[R("div",go,[o.value?(D(),K(M,{key:0},{default:l(()=>[t(L,{onClick:w,theme:"danger",loading:y.value},{default:l(()=>b[7]||(b[7]=[T("保存")])),_:1},8,["loading"]),t(L,{onClick:C,theme:"warning"},{default:l(()=>b[8]||(b[8]=[T("判题数据")])),_:1}),t(L,{onClick:c},{default:l(()=>b[9]||(b[9]=[T("查看")])),_:1})]),_:1})):(D(),K(M,{key:1},{default:l(()=>[t(L,{onClick:k,theme:"danger",loading:y.value},{default:l(()=>b[10]||(b[10]=[T("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(D(),K(Z,{key:0,layout:"vertical",bordered:!0},{default:l(()=>[t(B,{label:"创建时间"},{default:l(()=>{var q;return[T(F((q=h.value)==null?void 0:q.insertTime),1)]}),_:1}),t(B,{label:"更新时间"},{default:l(()=>{var q;return[T(F((q=h.value)==null?void 0:q.updateTime),1)]}),_:1}),t(B,{label:"判题方式"},{default:l(()=>{var q;return[T(F((q=h.value)==null?void 0:q.judgeType),1)]}),_:1}),t(B,{label:"上传用户"},{default:l(()=>{var q;return[T(F((q=h.value)==null?void 0:q.creatorNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),b[11]||(b[11]=R("div",{id:"problemEditDiv",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"])}}}),Ot=ue(bo,[["__scopeId","data-v-92753818"]]),ho={style:{margin:"10px"}},yo={style:{margin:"12px"}},wo={class:"dida-edit-container"},ko=re({__name:"ProblemJudge",setup(e){let a=ye();const{globalProperties:n}=de(),u=Ke(),o=d(""),v=d(!1),g=d(null);let y=null;const h=d(null),_=d(""),r=d(!1),m=d(!1),f=d([{title:"文件",colKey:"file"},{title:"大小",colKey:"size",width:150,cell:(j,z)=>z.row.size.toFixed(0)+" B"},{title:"最后修改时间",colKey:"lastModified",width:180,cell:(j,z)=>new Date(z.row.lastModified).toLocaleString()},{title:"操作",colKey:"action",width:100,cell:(j,z)=>t(J,{onClick:()=>w(z.row.file)},{default:()=>[T("下载")]})}]),p=d([]),P=Fe(()=>({border:"2px dashed #ccc",borderRadius:"6px",padding:"20px",textAlign:"center",cursor:"pointer",backgroundColor:r.value?"#f0f9ff":"#fff",transition:"background-color 0.2s ease"})),c=Fe(()=>_.value?`已选择：${_.value}`:r.value?"松开文件以上传":"拖拽判题数据压缩包到这里，或点击选择文件"),C=()=>{Q.push({name:"problem-detail",params:{problemId:o.value}})},k=()=>{Q.push({name:"manage-problem",params:{problemId:o.value}})},w=async j=>{const z=await Un(o.value,j);if(z.code!==0){O(n,z.code);return}const E=document.createElement("a");E.href=z.data,E.target="_blank",E.click(),URL.revokeObjectURL(E.href)},i=async()=>{if(!y){pe(n,"请选择压缩包");return}m.value=!0,Rn(o.value,y).then(async j=>{j.code==0?(h.value.value=null,y=null,_.value="",v.value=!0,Be(n,"上传成功"),await A()):O(n,j.code)}).catch(j=>{console.log(j),n.$message.error({duration:3e3,content:"申请失败"})}).finally(()=>{m.value=!1})},s=()=>{var j;(j=h.value)==null||j.click()},I=j=>{const z=j.target.files[0];z&&(_.value=z.name,y=z)},b=j=>{r.value=!0},x=()=>{r.value=!1},U=j=>{j.preventDefault(),j.stopPropagation(),r.value=!1;const z=j.dataTransfer.files[0];if(z){_.value=z.name;const E=new DataTransfer;E.items.add(z),h.value.files=E.files,y=z}},A=async()=>{const j=await Dn(o.value);if(j.code!==0){O(n,j.code),await Q.push({name:"problem"});return}const z=j.data.problem;g.value=ct(z,{}),u.setTitle(z.title+" - "+u.getTitle),p.value=[],j.data.judges?j.data.judges.forEach(E=>{p.value.push({file:E.key,size:E.size,lastModified:E.last_modified})}):pe(n,"评测数据不存在"),v.value=!1};return ie(async()=>{if(Array.isArray(a.params.problemId)?o.value=a.params.problemId[0]:o.value=a.params.problemId,!o.value){pe(n,"题目不存在"),await Q.push({name:"problem"});return}v.value=!0,await A()}),(j,z)=>{const E=Ve,$=Pe,S=J,V=he,L=Oe,M=Ge,B=Ce,Z=Ie;return D(),K(Z,{loading:v.value},{default:l(()=>[t(B,null,{default:l(()=>[t($,{span:7},{default:l(()=>[R("div",ho,[R("div",{id:"drop-zone",style:la(P.value),onClick:s,onDragenter:gt(b,["prevent"]),onDragover:z[0]||(z[0]=gt(()=>{},["prevent"])),onDragleave:gt(x,["prevent"]),onDrop:U},[R("input",{ref_key:"fileInput",ref:h,type:"file",style:{display:"none"},onChange:I},null,544),T(" "+F(c.value),1)],36)]),t(E,{data:p.value,columns:f.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1}),t($,{span:5},{default:l(()=>[R("div",yo,[R("div",wo,[t(V,null,{default:l(()=>[t(S,{onClick:i,theme:"danger",loading:m.value},{default:l(()=>z[1]||(z[1]=[T("上传")])),_:1},8,["loading"]),t(S,{onClick:k,theme:"warning"},{default:l(()=>z[2]||(z[2]=[T("编辑")])),_:1}),t(S,{onClick:C},{default:l(()=>z[3]||(z[3]=[T("查看")])),_:1})]),_:1})]),t(M,{layout:"vertical",bordered:!0},{default:l(()=>[t(L,{label:"标题"},{default:l(()=>{var N;return[T(F((N=g.value)==null?void 0:N.title),1)]}),_:1}),t(L,{label:"创建时间"},{default:l(()=>{var N;return[T(F((N=g.value)==null?void 0:N.insertTime),1)]}),_:1}),t(L,{label:"更新时间"},{default:l(()=>{var N;return[T(F((N=g.value)==null?void 0:N.updateTime),1)]}),_:1}),t(L,{label:"判题方式"},{default:l(()=>{var N;return[T(F((N=g.value)==null?void 0:N.judgeType),1)]}),_:1}),t(L,{label:"评测数据"},{default:l(()=>{var N;return[T(F((N=g.value)==null?void 0:N.judgeMd5),1)]}),_:1}),t(L,{label:"上传用户"},{default:l(()=>{var N;return[T(F((N=g.value)==null?void 0:N.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Co=ue(ko,[["__scopeId","data-v-12b13fb1"]]);async function qt(e){const a={};if(a.id=e.id,a.ownerId=e.owner_id,a.ownerUsername=e.owner_username,a.ownerNickname=e.owner_nickname,a.title=e.title,e.start_time?a.startTime=new Date(e.start_time).toLocaleString():a.startTime="无限制",e.end_time?a.endTime=new Date(e.end_time).toLocaleString():a.endTime="无限制",e.update_time?a.updateTime=new Date(e.update_time).toLocaleString():a.updateTime="",e.create_time?a.createTime=new Date(e.create_time).toLocaleString():a.createTime="",e.description){const n={math:{inlineDigit:!0,engine:"KaTeX"}};a.description=await ge.md2html(e.description,n)}else a.description="";return a.problems=e.problems,a}function So(e){return X({url:"/collection?id="+e,method:"get"})}function Io(e){return X({url:"/collection/edit?id="+e,method:"get"})}function Po(e,a){return X({url:"/collection/list?page="+e+"&page_size="+a,method:"get"})}function To(e){return X({url:"/collection/rank?id="+e,method:"get"})}function xo(e){return X({url:"/collection/create",method:"post",data:e})}function Vo(e){return X({url:"/collection/edit",method:"post",data:e})}function Do(e){return X({url:"/collection/join",method:"post",data:{id:e}})}function Lo(e){return X({url:"/collection/quit",method:"post",data:{id:e}})}const jo={style:{margin:"10px"}},zo=re({__name:"CollectionList",setup(e){const a=ye(),n=Ne(),{globalProperties:u}=de();let o=null;d(!1),d(!1);const v=d([{title:"ID",colKey:"id",width:"100",cell:(k,w)=>t(J,{variant:"text",onClick:()=>f(w.row.id)},{default:()=>[w.row.id]})},{title:"标题",colKey:"title",cell:(k,w)=>t(J,{variant:"text",onClick:()=>f(w.row.id)},{default:()=>[w.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),g=d(!1);let y=1,h=50;const _=d({current:y,pageSize:h,defaultCurrent:y,defaultPageSize:h,total:0,pageSizeOptions:[50,100]}),r=d(),m=d({title:"",username:""});d({title:"",description:"",open_time:[]});const f=k=>{k&&n.push({path:"/collection/"+k})},p=async()=>{await n.push({query:{...a.query,title:m.value.title,username:m.value.username,page:1,page_size:_.value.defaultPageSize}})},P=async(k,w)=>{var i;g.value=!0;try{const{current:s,pageSize:I}=k,b=await Po(s,I);if(r.value=[],b.code===0){const x=b.data.list;for(let U=0;U<x.length;U++){const A=x[U],j=await qt(A);(i=r.value)==null||i.push(j)}_.value={..._.value,total:b.data.total_count}}else w&&O(u,b.code)}catch(s){console.error(s),O(u,Ae())}finally{g.value=!1}},c=async k=>{await n.push({query:{...a.query,page:k.current,page_size:k.pageSize}})},C=async()=>{await n.push({name:"collection-create"})};return ie(async()=>{o=Le(()=>a.query,k=>{m.value.title=k.title||"",m.value.username=k.username||"";const w=parseInt(k.page)||_.value.defaultCurrent,i=parseInt(k.page_size)||_.value.defaultPageSize;y=w,h=i,_.value={..._.value,current:y,pageSize:h},P({current:y,pageSize:h},!0)},{immediate:!0})}),Te(()=>{o&&o()}),(k,w)=>{const i=Ve,s=_e,I=Pe,b=$e,x=ze,U=J,A=je,j=he,z=Ce;return D(),K(z,null,{default:l(()=>[t(I,{span:9},{default:l(()=>[t(s,{style:{margin:"10px"}},{default:l(()=>[t(i,{data:r.value,columns:v.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:_.value,loading:g.value,onPageChange:c},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(I,{span:3},{default:l(()=>[R("div",jo,[t(s,{class:"sh-card"},{default:l(()=>[t(A,{model:m.value},{default:l(()=>[t(x,{label:"标题"},{default:l(()=>[t(b,{modelValue:m.value.title,"onUpdate:modelValue":w[0]||(w[0]=E=>m.value.title=E),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(x,{label:"负责人"},{default:l(()=>[t(b,{modelValue:m.value.username,"onUpdate:modelValue":w[1]||(w[1]=E=>m.value.username=E),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(x,null,{default:l(()=>[t(U,{theme:"primary",onClick:p},{default:l(()=>w[2]||(w[2]=[T("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(s,{class:"sh-card"},{default:l(()=>[t(j,null,{default:l(()=>[t(U,{onClick:C},{default:l(()=>w[3]||(w[3]=[T("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),$o=ue(zo,[["__scopeId","data-v-36c7c0e5"]]),Uo={style:{margin:"20px"}},Ao={class:"dida-operation-container"},Ro={style:{margin:"12px"}},Mo=["innerHTML"],Eo=re({__name:"CollectionDetail",setup(e){let a=ye();const{globalProperties:n}=de(),u=Ke(),o=De();let v=0;const g=d(!1),y=d(null),h=d(!1),_=d(!1);let r={};const m=Fe(()=>o.hasAuth(Re.ManageCollection)||y.value&&o.getUserId==y.value.ownerId),f=w=>{if(!w||!r)return"default";const i=r[w];if(!i)return"default";switch(i){case We.Accept:return"success";case We.Attempt:return"warning";default:return"default"}},p=d([{title:"问题ID",colKey:"id",cell:(w,i)=>{const s=f(i.row.id);return t(J,{variant:"dashed",theme:s,onClick:()=>Nt(i.row.id)},{default:()=>[i.row.id]})}},{title:"标题",colKey:"title",cell:(w,i)=>t(J,{variant:"text",onClick:()=>Nt(i.row.id)},{default:()=>[i.row.title]})},{title:"正确",colKey:"accept",cell:(w,i)=>i.row.accept?i.row.accept:0},{title:"提交",colKey:"attempt",cell:(w,i)=>i.row.attempt?i.row.attempt:0}]),P=d([]),c=async()=>{if(!o.isLogin()){await Q.push({name:"login"});return}_.value=!0;try{const w=await Do(v);if(w.code!==0){O(n,w.code);return}h.value=!0,Be(n,"加入成功")}finally{_.value=!1}},C=async()=>{if(!o.isLogin()){await Q.push({name:"login"});return}_.value=!0;try{const w=await Lo(v);if(w.code!==0){O(n,w.code);return}h.value=!1,Be(n,"退出成功")}finally{_.value=!1}},k=()=>{y.value&&Q.push({name:"collection-edit",params:{collectionId:y.value.id}})};return ie(async()=>{if(Array.isArray(a.params.collectionId)?v=Number(a.params.collectionId[0]):v=Number(a.params.collectionId),!v){await Q.push({name:"problem-collection-list"});return}h.value=!1,g.value=!0;const w=await So(v);if(w.code!==0){g.value=!1,O(n,w.code),await Q.push({name:"problem-collection-list"});return}h.value=w.data.joined,r=w.data.attempt_status||{},y.value=await qt(w.data.collection),P.value=[],w.data.collection.problems&&w.data.collection.problems.forEach(i=>{const s=w.data.problems.find(I=>I.id===i);P.value.push(s)}),u.setTitle(y.value.title+" - "+u.getTitle),await qe(()=>{const i=document.querySelectorAll(".dida-content-description");i&&i.length>0&&i.forEach(s=>{ge.mathRender(s),ge.highlightRender({lineNumber:!0,enable:!0},s),tt(s)}),g.value=!1})}),(w,i)=>{const s=ia,I=ua,b=Ve,x=_e,U=Pe,A=J,j=he,z=Oe,E=Ge,$=Ce,S=Ie;return D(),K(S,{loading:g.value},{default:l(()=>[t($,{class:"dida-main-content"},{default:l(()=>[t(U,{span:6},{default:l(()=>[R("div",Uo,[t(I,{"max-item-width":"300"},{default:l(()=>[t(s,{to:{name:"problem-collection-list"}},{default:l(()=>i[0]||(i[0]=[T("题目集合")])),_:1}),t(s,null,{default:l(()=>{var V;return[T(F((V=y.value)==null?void 0:V.title),1)]}),_:1})]),_:1})]),t(x,{style:{margin:"10px"}},{default:l(()=>[t(b,{data:P.value,columns:p.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),_:1})]),_:1}),t(U,{span:6},{default:l(()=>{var V;return[R("div",Ao,[t(j,null,{default:l(()=>[h.value?(D(),K(A,{key:0,onClick:C,loading:_.value},{default:l(()=>i[1]||(i[1]=[T("退出")])),_:1},8,["loading"])):(D(),K(A,{key:1,onClick:c,loading:_.value},{default:l(()=>i[2]||(i[2]=[T("加入")])),_:1},8,["loading"])),m.value?(D(),K(A,{key:2,onClick:k},{default:l(()=>i[3]||(i[3]=[T("编辑")])),_:1})):le("",!0)]),_:1})]),R("div",Ro,[t(E,{layout:"vertical",bordered:!0},{default:l(()=>[t(z,{label:"创建者"},{default:l(()=>{var L;return[T(F((L=y.value)==null?void 0:L.ownerNickname),1)]}),_:1})]),_:1}),t(E,{layout:"vertical",bordered:!0},{default:l(()=>[t(z,{label:"开始时间"},{default:l(()=>{var L;return[T(F((L=y.value)==null?void 0:L.startTime),1)]}),_:1})]),_:1}),t(E,{layout:"vertical",bordered:!0},{default:l(()=>[t(z,{label:"结束时间"},{default:l(()=>{var L;return[T(F((L=y.value)==null?void 0:L.endTime),1)]}),_:1})]),_:1})]),(V=y.value)!=null&&V.description?(D(),K(x,{key:0,style:{margin:"10px"}},{default:l(()=>{var L;return[R("div",{innerHTML:(L=y.value)==null?void 0:L.description,class:"dida-content-description"},null,8,Mo)]}),_:1})):le("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),qo=ue(Eo,[["__scopeId","data-v-3f4490c0"]]),Ko=re({__name:"CollectionRank",setup(e){const a=ye(),n=Ne(),{globalProperties:u}=de();let o=null,v=0,g=0;const y=d([{title:"Rank",colKey:"rank",align:"center"},{title:"序号",colKey:"index",align:"center"},{title:"Username",colKey:"username",cell:(f,p)=>t(J,{variant:"text",onClick:()=>n.push({name:"user",params:{username:p.row.username}})},{default:()=>[p.row.username]})},{title:"昵称",colKey:"nickname",cell:(f,p)=>t(J,{variant:"text",onClick:()=>n.push({name:"user",params:{username:p.row.username}})},{default:()=>[p.row.nickname]})},{title:"Count",colKey:"count",cell:(f,p)=>t(J,{variant:"text",onClick:()=>n.push({name:"judge-list",query:{username:p.row.username,status:Ue.Accept}})},{default:()=>[`${p.row.accept} / ${g}`]})},{title:"Progress",colKey:"progress",cell:(f,p)=>{let P=100;return g>0&&(P=Number((p.row.accept/g*100).toFixed(2))),t(ca,{percentage:P},null)}}]),h=d(!1),_=d([]),r=({col:f,rowIndex:p})=>{let P=1;for(let c=p+1;c<_.value.length&&_.value[c].rank===_.value[p].rank;c++)P++;if(f.colKey==="rank")return{rowspan:P}},m=async f=>{h.value=!0;try{const p=await To(v);if(_.value=[],p.code===0){g=p.data.problem;const P=p.data.ranks,c=[];if(P){for(let w=0;w<P.length;w++){const i=P[w];let s={userId:i.author_id,username:i.author_username,nickname:i.author_nickname};s.accept=i.accept,c.push(s)}c.sort((w,i)=>w.accept!==i.accept?i.accept-w.accept:w.userId-i.userId);let C=0,k=-1;for(let w=0;w<c.length;w++)c[w].accept!==k&&(C=w+1,k=c[w].accept),c[w].index=w+1,c[w].rank=C}_.value=c}else f&&O(u,p.code)}catch(p){console.error(p),O(u,Ae())}finally{h.value=!1}};return ie(async()=>{o=Le(()=>a.query,async()=>{if(Array.isArray(a.params.collectionId)?v=Number(a.params.collectionId[0]):v=Number(a.params.collectionId),!v){await n.push({name:"problem-collection-list"});return}await m(!0)},{immediate:!0})}),Te(()=>{o&&o()}),(f,p)=>{const P=Ve,c=_e,C=Ce;return D(),K(C,null,{default:l(()=>[t(c,{style:{margin:"10px"}},{default:l(()=>[R("div",null,[t(P,{data:_.value,columns:y.value,"row-key":"index","rowspan-and-colspan":r,"vertical-align":"middle",bordered:!0,hover:!0,loading:h.value},null,8,["data","columns","loading"])])]),_:1})]),_:1})}}});var xe=(e=>(e[e.Valid=0]="Valid",e[e.Duplicate=1]="Duplicate",e[e.Invalid=2]="Invalid",e))(xe||{});const Fo={class:"dida-form-border"},No={style:{"text-align":"right"}},Go=re({name:"ParseProblemList",__name:"ParseProblemList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:a}=de(),n=d(!1),u=d(!1),o=d(""),v=na(e,"modelValue");let g=[];Le(v,async f=>{JSON.stringify(f)!==JSON.stringify(g)&&(await _(f),g=v.value)},{deep:!0});const y=d([]),h=d([{title:"有效性",colKey:"validType",cell:(f,p)=>{switch(p.row.valid){case xe.Valid:return t(et,{theme:"success"},{default:()=>[T("有效")]});case xe.Duplicate:return t(et,{theme:"warning"},{default:()=>[T("重复")]});case xe.Invalid:return t(et,{theme:"danger"},{default:()=>[T("无效")]});default:return null}}},{title:"问题ID",colKey:"id"},{title:"标题",colKey:"title"}]),_=async f=>{const p=Array.from(new Set(f)),P=await Mn(p);if(P.code!==0){O(a,P.code),u.value=!1;return}const c=[],C=P.data.problems;let k=[];f.forEach(w=>{const i=C.find(s=>s.id===w);if(i){const s=c.find(I=>I.id===w);i.valid=s?xe.Duplicate:xe.Valid,c.push({id:w,title:i.title,valid:i.valid}),s||k.push(w)}else c.push({id:w,title:"-",valid:xe.Invalid})}),y.value=c,g=k,v.value=k},r=async()=>{u.value=!0;const f=ga(o.value);await _(f),n.value=!1,u.value=!1},m=()=>{y.value?o.value=y.value.map(f=>f.id).join(`
`):o.value="",n.value=!0};return(f,p)=>{const P=J,c=Ve,C=kt,k=Ze;return D(),ae(oe,null,[R("div",Fo,[R("div",No,[t(P,{onClick:m},{default:l(()=>p[2]||(p[2]=[T("编辑")])),_:1})]),t(c,{data:y.value,columns:h.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(k,{visible:n.value,"onUpdate:visible":p[1]||(p[1]=w=>n.value=w),onConfirm:r,header:"请输入问题ID","confirm-loading":u.value},{default:l(()=>[p[3]||(p[3]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(C,{modelValue:o.value,"onUpdate:modelValue":p[0]||(p[0]=w=>o.value=w),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Ta=ue(Go,[["__scopeId","data-v-7f4ce589"]]),Oo={class:"dida-form-border"},Ho={style:{"text-align":"right"}},Bo=re({name:"ParseUserList",__name:"ParseUserList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:a}=de(),n=d(!1),u=d(!1),o=d(""),v=na(e,"modelValue");let g=[];Le(v,async P=>{JSON.stringify(P)!==JSON.stringify(g)&&(g=P,await r(P))},{deep:!0});const y=d(),h=d([{title:"有效性",colKey:"validType",cell:(P,c)=>{switch(c.row.valid){case xe.Valid:return t(et,{theme:"success"},{default:()=>[T("有效")]});case xe.Duplicate:return t(et,{theme:"warning"},{default:()=>[T("重复")]});case xe.Invalid:return t(et,{theme:"danger"},{default:()=>[T("无效")]})}}},{title:"Username",colKey:"username"},{title:"昵称",colKey:"nickname"}]),_=(P,c)=>{if(P.code!==0){O(a,P.code),u.value=!1;return}const C=[],k=P.data.users;let w=[];c?c.forEach(i=>{let s=null;if(k&&(s=k.find(I=>I.username.toLowerCase()===i.toLowerCase())),s){const I=C.find(x=>x.username.toLowerCase()===i.toLowerCase()),b=I?xe.Duplicate:xe.Valid;C.push({id:s.id,username:s.username,nickname:s.nickname,valid:b}),I||w.push(s.id)}else C.push({id:-1,username:i,nickname:"-",valid:xe.Invalid})}):k&&k.forEach(i=>{const s=C.find(b=>b.id===i.id),I=s?xe.Duplicate:xe.Valid;C.push({id:i.id,username:i.username,nickname:i.nickname,valid:I}),s||w.push(i.id)}),y.value=C,g=w,v.value=w},r=async P=>{const c=Array.from(new Set(P)),C=await un(c);_(C)},m=async P=>{const c=Array.from(new Set(P)),C=await cn(c);_(C,P)},f=async()=>{u.value=!0;const P=ga(o.value);await m(P),n.value=!1,u.value=!1},p=()=>{y.value?o.value=y.value.map(P=>P.username).join(`
`):o.value="",n.value=!0};return(P,c)=>{const C=J,k=Ve,w=kt,i=Ze;return D(),ae(oe,null,[R("div",Oo,[R("div",Ho,[t(C,{onClick:p},{default:l(()=>c[2]||(c[2]=[T("编辑")])),_:1})]),t(k,{data:y.value,columns:h.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(i,{visible:n.value,"onUpdate:visible":c[1]||(c[1]=s=>n.value=s),onConfirm:f,header:"请输入用户Username","confirm-loading":u.value},{default:l(()=>[c[3]||(c[3]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(w,{modelValue:o.value,"onUpdate:modelValue":c[0]||(c[0]=s=>o.value=s),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),xa=ue(Bo,[["__scopeId","data-v-d2170a86"]]),Wo={style:{margin:"10px"}},Jo={style:{margin:"12px"}},Xo={class:"dida-edit-container"},Yo=re({__name:"CollectionEdit",setup(e){let a=ye();const{globalProperties:n}=de(),u=Ke(),o=d(""),v=d(!1);let g=null;const y=d(!1),h=d(!1),_=d(null),r=d({title:"",openTime:[],private:!0,problems:[],members:[],description:""}),m=d(""),f=d(""),p=d(!1),P=async()=>{p.value=!0,h.value=!1,p.value=!1},c=async()=>{if(g){y.value=!0;try{const i={title:r.value.title,description:g.getValue(),problems:r.value.problems,members:r.value.members,private:r.value.private};r.value.openTime[0]&&(i.start_time=new Date(r.value.openTime[0])),r.value.openTime[1]&&(i.end_time=new Date(r.value.openTime[1]));const s=await xo(i);if(y.value=!0,s.code!==0){O(n,s.code);return}s.data!=null&&await Q.push({name:"collection-detail",params:{collectionId:s.data}}),Be(n,"创建成功")}finally{y.value=!1}}},C=async()=>{if(g){y.value=!0;try{const i={id:Number(o.value),title:r.value.title,private:r.value.private,problems:r.value.problems,members:r.value.members,description:g.getValue()};r.value.openTime[0]&&(i.start_time=new Date(r.value.openTime[0])),r.value.openTime[1]&&(i.end_time=new Date(r.value.openTime[1]));const s=await Vo(i);if(y.value=!0,s.code!==0){O(n,s.code);return}s.data!=null&&_.value&&(_.value.updateTime=new Date(s.data).toLocaleString()),Be(n,"保存成功")}finally{y.value=!1}}},k=i=>{const s={after:()=>{g==null||g.setValue(i),v.value=!1},preview:{math:{inlineDigit:!0,engine:"KaTeX"}}};g=new ge("collectionEditDiv",s)},w=async()=>{const i=await Io(o.value);if(i.code!==0){O(n,i.code),console.error("collection get failed",i.code),await Q.push({name:"problem-collection-list"});return}const s=i.data.collection;_.value=await qt(s),r.value.title=s.title,r.value.openTime=[],s.start_time?r.value.openTime.push(new Date(s.start_time)):r.value.openTime.push(""),s.end_time?r.value.openTime.push(new Date(s.end_time)):r.value.openTime.push(""),r.value.private=s.private,r.value.description=s.description,r.value.problems=s.problems,r.value.members=s.members,u.setTitle(s.title+" - "+u.getTitle);let I="";s.description&&(I=s.description),k(I)};return ie(async()=>{Array.isArray(a.params.collectionId)?o.value=a.params.collectionId[0]:o.value=a.params.collectionId,o.value?(v.value=!0,await w()):k("")}),(i,s)=>{const I=$e,b=ze,x=da,U=it,A=je,j=_e,z=Pe,E=J,$=he,S=Oe,V=Ge,L=Ce,M=Ie,B=kt,Z=Ze;return D(),ae(oe,null,[t(M,{loading:v.value},{default:l(()=>[t(L,null,{default:l(()=>[t(z,{span:8},{default:l(()=>[R("div",Wo,[t(j,{class:"sh-card"},{default:l(()=>[t(A,{model:r.value},{default:l(()=>[t(b,{label:"标题"},{default:l(()=>[t(I,{modelValue:r.value.title,"onUpdate:modelValue":s[0]||(s[0]=N=>r.value.title=N),placeholder:"题集标题"},null,8,["modelValue"])]),_:1}),t(b,{label:"开启时间"},{default:l(()=>[t(x,{modelValue:r.value.openTime,"onUpdate:modelValue":s[1]||(s[1]=N=>r.value.openTime=N),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(b,{label:"私有"},{default:l(()=>[t(U,{modelValue:r.value.private,"onUpdate:modelValue":s[2]||(s[2]=N=>r.value.private=N)},null,8,["modelValue"])]),_:1}),t(b,{label:"成员"},{default:l(()=>[t(xa,{modelValue:r.value.members,"onUpdate:modelValue":s[3]||(s[3]=N=>r.value.members=N)},null,8,["modelValue"])]),_:1}),t(b,{label:"问题"},{default:l(()=>[t(Ta,{modelValue:r.value.problems,"onUpdate:modelValue":s[4]||(s[4]=N=>r.value.problems=N)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(z,{span:4},{default:l(()=>[R("div",Jo,[R("div",Xo,[o.value?(D(),K($,{key:0},{default:l(()=>[t(E,{onClick:C,theme:"danger",loading:y.value},{default:l(()=>s[7]||(s[7]=[T("保存")])),_:1},8,["loading"])]),_:1})):(D(),K($,{key:1},{default:l(()=>[t(E,{onClick:c,theme:"danger",loading:y.value},{default:l(()=>s[8]||(s[8]=[T("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(D(),K(V,{key:0,layout:"vertical",bordered:!0},{default:l(()=>[t(S,{label:"创建时间"},{default:l(()=>{var N;return[T(F((N=_.value)==null?void 0:N.createTime),1)]}),_:1}),t(S,{label:"更新时间"},{default:l(()=>{var N;return[T(F((N=_.value)==null?void 0:N.updateTime),1)]}),_:1}),t(S,{label:"创建用户"},{default:l(()=>{var N;return[T(F((N=_.value)==null?void 0:N.ownerNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),s[9]||(s[9]=R("div",{id:"collectionEditDiv",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"]),t(Z,{visible:h.value,"onUpdate:visible":s[6]||(s[6]=N=>h.value=N),onConfirm:P,header:m.value,"confirm-loading":p.value},{default:l(()=>[s[10]||(s[10]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(B,{modelValue:f.value,"onUpdate:modelValue":s[5]||(s[5]=N=>f.value=N),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),Ht=ue(Yo,[["__scopeId","data-v-dbc568cf"]]),Zo=["innerHTML"];function Bt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ye(e)}const Qo=re({__name:"JudgeJobList",setup(e){const a=ye(),n=Ne(),{globalProperties:u}=de();let o=!1,v=null,g;const y=d(!1),h=d(null),_=d(null),r=d(!1);let m=-1;const f=d({problemId:"",username:"",language:void 0,status:void 0}),p=d([{title:"ID",colKey:"id",cell:(S,V)=>{let L=null;return ht(V.row.status)&&bt(V.row.language)&&(L=()=>{U(V.row.id)}),t(J,{variant:"text",onClick:L},{default:()=>[V.row.id]})}},{title:"问题",colKey:"problemId",cell:(S,V)=>{if(m){let L;return t(J,{variant:"text",onClick:()=>x(m,V.row.contestProblemIndex)},Bt(L=Xe(V.row.contestProblemIndex))?L:{default:()=>[L]})}return t(J,{variant:"text",onClick:()=>b(V.row.problemId)},{default:()=>[V.row.problemId]})}},{title:"状态",colKey:"status",align:"center",cell:(S,V)=>{let L=null;ht(V.row.status)&&bt(V.row.language)&&(L=()=>{U(V.row.id)});const M=V.row.status,B=wt(M);let Z=!ht(M);const N=ba(M);let G=[];return st(M)&&G.push(t(Ie,{text:V.row.state,size:"small",class:"dida-status-loading"},null)),G.push(t("span",null,[B])),t(J,{theme:N,variant:"outline",onClick:L,disabled:Z},Bt(G)?G:{default:()=>[G]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"code",cell:(S,V)=>{let L=!bt(V.row.language);return t(J,{theme:"default",onClick:()=>I(V.row),disabled:L},{default:()=>[yt(V.row.language)+" / "+V.row.codeLength]})}},{title:"作者",colKey:"author",width:200,cell:(S,V)=>t(J,{variant:"text",onClick:()=>A(V.row.authorUsername)},{default:()=>[V.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),P=d(!1);let c=1,C=50;const k=d({current:c,pageSize:C,defaultCurrent:c,defaultPageSize:C,total:0,pageSizeOptions:[50,100]}),w=d(),i=d([]);i.value=Ut();const s=d([]);s.value=ha();const I=async S=>{r.value=!0,y.value=!0;try{h.value=S;const V=await Nl(Number(h.value.id));if(V.code===0){const L=V.data,B=`\`\`\`${At(L.language)}
${L.code}
\`\`\``,Z={};h.value.code=await ge.md2html(B,Z),await qe(()=>{_.value&&(ge.highlightRender({lineNumber:!0,enable:!0},_.value),tt(_.value))})}else O(u,V.code)}finally{r.value=!1}},b=S=>{S&&n.push({path:"/problem/"+S})},x=(S,V)=>{n.push({name:"contest-problem-detail",params:{contestId:S,problemIndex:V}})},U=S=>{S&&(m>0?n.push({name:"contest-judge-detail",params:{contestId:m,judgeId:S}}):n.push({name:"judge-detail",params:{judgeId:S}}))},A=S=>{S&&n.push({path:"/user/"+S})},j=async()=>{await n.push({query:{...a.query,page:1,page_size:C,problem_id:f.value.problemId,username:f.value.username,language:f.value.language,status:f.value.status}})},z=async()=>{f.value.problemId="",f.value.username="",f.value.language=void 0,f.value.status=void 0,await n.push({query:{...a.query,page:1,page_size:C,problem_id:"",username:"",language:void 0,status:void 0}})},E=async(S,V)=>{V&&(P.value=!0);let L=!1;try{const{current:M,pageSize:B}=S,Z=await Gl(m,f.value.problemId,f.value.username,f.value.language,f.value.status,M,B);if(w.value=[],Z.code===0){if(!Z.data.has_auth){fe(u,"您目前没有权限查看评测记录"),m?await n.push({name:"contest-detail",params:{contestId:m}}):await n.push({name:"judge-list"});return}Z.data.list&&Z.data.list.length>0?(Z.data.list.forEach(G=>{var be;const q=ya(G);(be=w.value)==null||be.push(q),st(G.status)&&(L=!0)}),k.value={...k.value,total:Z.data.total_count}):(fe(u,"未找到记录"),k.value={...k.value,total:0})}else V&&O(u,Z.code)}catch(M){console.error(M),V&&O(u,Ae())}finally{V&&(P.value=!1),L&&o&&(g=setTimeout(()=>{E({current:c,pageSize:C},!1)},5e3))}},$=async S=>{await n.push({query:{...a.query,page:S.current,page_size:S.pageSize}})};return ie(async()=>{o=!0,v=Le(()=>a.query,S=>{Array.isArray(a.params.contestId)?m=Number(a.params.contestId[0]):m=Number(a.params.contestId),f.value.problemId=S.problem_id||"",f.value.username=S.username||"",S.language!=null?f.value.language=Number(S.language):f.value.language=void 0,S.status!=null?f.value.status=Number(S.status):f.value.status=void 0;const V=parseInt(S.page)||k.value.defaultCurrent,L=parseInt(S.page_size)||k.value.defaultPageSize;c=V,C=L,k.value.pageSizeOptions.includes(C)||(C=k.value.defaultPageSize),k.value={...k.value,current:c,pageSize:C},E({current:c,pageSize:C},!0)},{immediate:!0})}),Te(()=>{o=!1,v&&v(),clearTimeout(g)}),(S,V)=>{const L=$e,M=ze,B=zt,Z=ut,N=J,G=he,q=je,be=Ve,Se=_e,W=at,H=Ie,ne=Ze;return D(),ae(oe,null,[t(Se,{style:{margin:"10px"}},{default:l(()=>[t(q,{layout:"inline",onSubmit:j,onReset:z},{default:l(()=>[t(M,{label:"题号"},{default:l(()=>[t(L,{modelValue:f.value.problemId,"onUpdate:modelValue":V[0]||(V[0]=ee=>f.value.problemId=ee),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(M,{label:"用户"},{default:l(()=>[t(L,{modelValue:f.value.username,"onUpdate:modelValue":V[1]||(V[1]=ee=>f.value.username=ee),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(M,{label:"语言"},{default:l(()=>[t(Z,{modelValue:f.value.language,"onUpdate:modelValue":V[2]||(V[2]=ee=>f.value.language=ee),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:l(()=>[(D(!0),ae(oe,null,ke(i.value,ee=>(D(),K(B,{key:ee.value,value:ee.value,label:ee.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(M,{label:"状态"},{default:l(()=>[t(Z,{modelValue:f.value.status,"onUpdate:modelValue":V[3]||(V[3]=ee=>f.value.status=ee),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:l(()=>[(D(!0),ae(oe,null,ke(s.value,ee=>(D(),K(B,{key:ee.value,value:ee.value,label:ee.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(M,null,{default:l(()=>[t(G,null,{default:l(()=>[t(N,{theme:"primary",type:"submit"},{default:l(()=>V[7]||(V[7]=[T("搜索")])),_:1}),t(N,{theme:"default",variant:"base",type:"reset"},{default:l(()=>V[8]||(V[8]=[T("重置")])),_:1})]),_:1})]),_:1})]),_:1}),t(be,{data:w.value,columns:p.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:k.value,loading:P.value,onPageChange:$,"table-layout":"auto"},null,8,["data","columns","pagination","loading"])]),_:1}),t(ne,{visible:y.value,"onUpdate:visible":V[5]||(V[5]=ee=>y.value=ee),width:"800px","cancel-btn":null,"close-btn":!1,onConfirm:V[6]||(V[6]=ee=>y.value=!1)},{header:l(()=>[t(W,{onClick:V[4]||(V[4]=()=>{var ee;U((ee=h.value)==null?void 0:ee.id)})},{default:l(()=>{var ee,me;return[T(F(((ee=h.value)==null?void 0:ee.id)+" - "+ce(yt)((me=h.value)==null?void 0:me.language)),1)]}),_:1})]),default:l(()=>[t(H,{loading:r.value},{default:l(()=>{var ee;return[R("div",{innerHTML:(ee=h.value)==null?void 0:ee.code,ref_key:"markdownCodeRef",ref:_,style:{"min-height":"100px"}},null,8,Zo)]}),_:1},8,["loading"])]),_:1},8,["visible"])],64)}}}),Wt=ue(Qo,[["__scopeId","data-v-8ecb6b14"]]),es={class:"dida-code-container"},ts=["innerHTML"],as={key:2,class:"dida-edit-container"};function Jt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ye(e)}const ls=re({__name:"JudgeJobDetail",setup(e){const a=ye(),n=Ne(),u=De(),{globalProperties:o}=de();let v=!1,g,y=0,h=0;const _=d(""),r=d(null),m=d(""),f=d(null),p=d(0),P=d(null),c=d({from:"#5a96ff",to:"#00A870"});let C=!1;const k=d([{title:"ID",colKey:"id"},{title:"问题",colKey:"problemId",cell:(E,$)=>t(J,{variant:"text",onClick:()=>x($.row.problemId)},{default:()=>[$.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(E,$)=>{const S=$.row.status,V=wt(S),L=ba(S);let M=[];return st(S)&&M.push(t(Ie,{text:$.row.state,size:"small",class:"dida-status-loading"},null)),M.push(t("span",null,[V])),t(J,{theme:L,variant:"outline"},Jt(M)?M:{default:()=>[M]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"language",cell:(E,$)=>t("span",null,[yt($.row.language)+" / "+$.row.codeLength])},{title:"作者",colKey:"author",width:200,cell:(E,$)=>t(J,{variant:"text",onClick:()=>U($.row.authorUsername)},{default:()=>[$.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),w=d(!1),i=d(!1),s=d(),I=Fe(()=>u.hasAuth(Re.ManageJudge)),b=async()=>{if(!i.value){i.value=!0;try{const E=await Jl(y);E.code===0?await j(!0):O(o,E.code)}catch(E){console.error(E),O(o,Ae())}finally{i.value=!1}}},x=E=>{E&&n.push({path:"/problem/"+E})},U=E=>{E&&n.push({path:"/user/"+E})},A=E=>{const $=E.status,S=wt($);let V;switch($){case Ue.Init:case Ue.Rejudge:case Ue.Compiling:case Ue.Running:V="default";break;case Ue.Accept:V="success";break;case Ue.PE:V="warning";break;default:V="danger";break}return t(he,null,{default:()=>[t(J,{theme:"default",variant:"outline"},{default:()=>[E.taskId]}),t(J,{theme:V,variant:"outline"},Jt(S)?S:{default:()=>[S]}),t("span",null,[T("分数："),E.score]),t("span",null,[T("用时："),E.time]),t("span",null,[T("内存："),E.memory])]})},j=async E=>{var S;E&&(w.value=!0);let $=!1;try{const V=await Fl(y);if(s.value=[],V.code===0){const L=V.data,M=ya(L);(S=s.value)==null||S.push(M),_.value=M.judgerName,c.value.to="#00A870",st(L.status)?(P.value="active",M.taskTotal>0?(p.value=M.taskCurrent/M.taskTotal*100,M.taskCurrent>=M.taskTotal&&(p.value=99)):p.value=0):(p.value=100,L.status===Ue.Accept?P.value="success":L.status===Ue.PE?(c.value.to="#F57C20",P.value="warning"):(c.value.to="#F56C6C",P.value="error"));const B={};if(L.code){const N=`\`\`\`${At(L.language)}
${L.code}
\`\`\``;m.value=await ge.md2html(N,B),await qe(()=>{f.value&&(C||(C=!0,ge.highlightRender({lineNumber:!0,enable:!0},f.value)),tt(f.value))})}r.value=M,st(L.status)&&($=!0)}else E&&O(o,V.code),h?await n.push({name:"contest-judge",params:{contestId:h}}):await n.push({name:"judge-list"})}catch(V){console.error(V),E&&O(o,Ae())}finally{E&&(w.value=!1),$&&v&&(g=setTimeout(()=>{j(!1)},5e3))}};function z(){f.value&&f.value.parentElement&&(f.value.style.maxWidth=f.value.parentElement.clientWidth+"px")}return ie(async()=>{if(v=!0,Array.isArray(a.params.judgeId)?y=Number(a.params.judgeId[0]):y=Number(a.params.judgeId),Array.isArray(a.params.contestId)?h=Number(a.params.contestId[0]):h=Number(a.params.contestId),!y){await n.push({name:"judge"});return}await j(!0),z(),window.addEventListener("resize",z)}),Te(()=>{v=!1,window.removeEventListener("resize",z),clearTimeout(g)}),(E,$)=>{var Se,W,H;const S=ca,V=Ve,L=_e,M=Pe,B=Oe,Z=Ge,N=Ce,G=ul,q=il,be=J;return D(),ae(oe,null,[t(S,{color:c.value,status:P.value,class:"dida-job-progress",percentage:p.value},null,8,["color","status","percentage"]),t(L,{style:{margin:"10px"}},{default:l(()=>[t(V,{data:s.value,columns:k.value,"row-key":"id","vertical-align":"top",hover:!0,loading:w.value},null,8,["data","columns","loading"])]),_:1}),t(N,null,{default:l(()=>[t(M,{span:8},{default:l(()=>[R("div",es,[R("div",{innerHTML:m.value,ref_key:"markdownCodeRef",ref:f,class:"dida-code-div"},null,8,ts)])]),_:1}),t(M,{span:4},{default:l(()=>[t(Z,{layout:"vertical",bordered:!0,style:{margin:"10px"}},{default:l(()=>[t(B,{label:"判题机"},{default:l(()=>[T(F(_.value),1)]),_:1}),t(B,{label:"判题时间"},{default:l(()=>{var ne;return[T(F((ne=r.value)==null?void 0:ne.judgeTime),1)]}),_:1})]),_:1})]),_:1})]),_:1}),(Se=r.value)!=null&&Se.compileMessage?(D(),K(L,{key:0,class:"compile-message"},{default:l(()=>{var ne;return[T(F((ne=r.value)==null?void 0:ne.compileMessage),1)]}),_:1})):le("",!0),(W=r.value)!=null&&W.task&&((H=r.value)==null?void 0:H.task.length)>0?(D(),K(q,{key:1,class:"task-panel"},{default:l(()=>{var ne;return[(D(!0),ae(oe,null,ke((ne=r.value)==null?void 0:ne.task,(ee,me)=>(D(),K(G,{key:ee.taskId,header:()=>A(ee)},{default:l(()=>[T(F(ee.content)+" "+F(ee.waHint),1)]),_:2},1032,["header"]))),128))]}),_:1})):le("",!0),I.value?(D(),ae("div",as,[t(be,{onClick:b,loading:i.value},{default:l(()=>$[0]||($[0]=[T("重新评测")])),_:1},8,["loading"])])):le("",!0)],64)}}}),Xt=ue(ls,[["__scopeId","data-v-e5da76e3"]]),ns={style:{margin:"10px"}},os=re({__name:"ContestList",setup(e){const a=ye(),n=Ne(),{globalProperties:u}=de();let o=null;const v=d([{title:"ID",colKey:"id",cell:(k,w)=>t(J,{variant:"text",onClick:()=>f(w.row.id)},{default:()=>[w.row.id]})},{title:"标题",colKey:"title",cell:(k,w)=>t(J,{variant:"text",onClick:()=>f(w.row.id)},{default:()=>[w.row.title]})},{title:"负责人",colKey:"ownerNickname",cell:(k,w)=>t(J,{variant:"text",onClick:()=>Et(n,w.row.ownerUsername)},{default:()=>[w.row.ownerNickname]})},{title:"权限",colKey:"private",cell:(k,w)=>w.row.private?"私有":"公开"},{title:"开始时间",colKey:"startTime"},{title:"结束时间",colKey:"endTime"}]),g=d(!1);let y=1,h=50;const _=d({current:y,pageSize:h,defaultCurrent:y,defaultPageSize:h,total:0,pageSizeOptions:[50,100]}),r=d(),m=d({title:"",username:""}),f=k=>{k&&n.push({path:"/contest/"+k})},p=async()=>{await n.push({query:{...a.query,title:m.value.title,username:m.value.username,page:1,page_size:_.value.defaultPageSize}})},P=async(k,w)=>{var i;g.value=!0;try{const{current:s,pageSize:I}=k,b=await Wn(s,I);if(r.value=[],b.code===0){const x=b.data.list;for(let U=0;U<x.length;U++){const A=x[U],j=await Mt(A);(i=r.value)==null||i.push(j)}_.value={..._.value,total:b.data.total_count}}else w&&O(u,b.code)}catch(s){console.error(s),O(u,Ae())}finally{g.value=!1}},c=async k=>{await n.push({query:{...a.query,page:k.current,page_size:k.pageSize}})},C=()=>{n.push({name:"contest-create"})};return ie(async()=>{o=Le(()=>a.query,k=>{m.value.title=k.title||"",m.value.username=k.username||"";const w=parseInt(k.page)||_.value.defaultCurrent,i=parseInt(k.page_size)||_.value.defaultPageSize;y=w,h=i,_.value={..._.value,current:y,pageSize:h},P({current:y,pageSize:h},!0)},{immediate:!0})}),Te(()=>{o&&o()}),(k,w)=>{const i=Ve,s=_e,I=Pe,b=$e,x=ze,U=J,A=je,j=he,z=Ce;return D(),K(z,null,{default:l(()=>[t(I,{span:9},{default:l(()=>[t(s,{style:{margin:"10px"}},{default:l(()=>[t(i,{data:r.value,columns:v.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:_.value,loading:g.value,"table-layout":"auto",onPageChange:c},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(I,{span:3},{default:l(()=>[R("div",ns,[t(s,{class:"sh-card"},{default:l(()=>[t(A,{model:m.value},{default:l(()=>[t(x,{label:"标题"},{default:l(()=>[t(b,{modelValue:m.value.title,"onUpdate:modelValue":w[0]||(w[0]=E=>m.value.title=E),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(x,{label:"负责人"},{default:l(()=>[t(b,{modelValue:m.value.username,"onUpdate:modelValue":w[1]||(w[1]=E=>m.value.username=E),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(x,null,{default:l(()=>[t(U,{theme:"primary",onClick:p},{default:l(()=>w[2]||(w[2]=[T("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(s,{class:"sh-card"},{default:l(()=>[t(j,null,{default:l(()=>[t(U,{onClick:C},{default:l(()=>w[3]||(w[3]=[T("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),Yt=ue(os,[["__scopeId","data-v-98239b6b"]]),ss={style:{margin:"20px"}},rs={style:{margin:"10px"}},us={style:{"text-align":"center","align-content":"center",padding:"20px",height:"500px"}},is={style:{"text-align":"center",width:"100%"}},cs={class:"dida-operation-container"},ds={style:{margin:"12px"}},ms=["innerHTML"],ps=re({__name:"ContestDetail",setup(e){let a=ye();const{globalProperties:n}=de(),u=Ke(),o=De(),v=d(!1);let g=0;const y=d(!1),h=d(null),_=d(!1),r=d(!1),m=d(""),f=Fe(()=>o.hasAuth(Re.ManageContest)||h.value&&o.getUserId==h.value.ownerId),p=b=>{if(!b||!C)return"default";const x=C[b];if(!x)return"default";switch(x){case We.Accept:return"success";case We.Attempt:return"warning";default:return"default"}},P=d([{title:"问题ID",colKey:"index",cell:(b,x)=>{const U=p(x.row.index);return t(J,{variant:"dashed",theme:U,onClick:async()=>await Lt(g,x.row.index)},{default:()=>[x.row.id]})}},{title:"标题",colKey:"title",cell:(b,x)=>t(J,{variant:"text",onClick:async()=>await Lt(g,x.row.index)},{default:()=>[x.row.title]})},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),c=d([]);let C={},k=d(!1);const w=()=>{Q.push({name:"contest-edit",params:{contestId:g}})},i=async()=>{v.value=!0;try{const b=await Qn(g);if(b.code!==0){O(n,b.code);return}const x=b.data;fe(n,"查重报告已生成，请前往查看"),window.open(x,"_blank")}finally{v.value=!1}},s=async b=>{if(!o.isLogin()){await Q.push({name:"login"});return}if(!m.value){pe(n,"请输入密码");return}k.value=!0;try{const x=await Zn(g,m.value);if(x.code!==0){O(n,x.code);return}fe(n,"申请访问成功"),await I()}catch(x){console.error("Error submitting contest password:",x),O(n,"提交密码失败，请稍后再试")}finally{k.value=!1}},I=async()=>{y.value=!0;const b=await Gn(g);if(b.code!==0){y.value=!1,O(n,b.code),await Q.push({name:"contest"});return}_.value=b.data.has_auth,r.value=b.data.need_password,h.value=await Mt(b.data.contest),c.value=h.value.problems,C=b.data.attempt_status||{},u.setTitle(h.value.title+" - "+u.getTitle),await qe(()=>{const x=document.querySelectorAll(".dida-content-description");x&&x.length>0&&x.forEach(U=>{ge.mathRender(U),ge.highlightRender({lineNumber:!0,enable:!0},U),tt(U)}),y.value=!1})};return ie(async()=>{if(Array.isArray(a.params.contestId)?g=Number(a.params.contestId[0]):g=Number(a.params.contestId),!g){await Q.push({name:"contest"});return}await I()}),(b,x)=>{const U=jt,A=Ve,j=_e,z=$e,E=ze,$=J,S=je,V=Pe,L=he,M=Oe,B=Ge,Z=Ce,N=Ie;return D(),K(N,{loading:y.value},{default:l(()=>[t(Z,{class:"dida-main-content"},{default:l(()=>[t(V,{span:6},{default:l(()=>{var G,q,be;return[R("div",ss,[R("h1",null,F((G=h.value)==null?void 0:G.title),1),(q=h.value)!=null&&q.notification?(D(),K(U,{key:0,theme:"info",message:(be=h.value)==null?void 0:be.notification},null,8,["message"])):le("",!0)]),R("div",rs,[_.value?(D(),K(j,{key:0},{default:l(()=>[t(A,{data:c.value,columns:P.value,"row-key":"id","table-layout":"auto","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1})):(D(),K(j,{key:1},{default:l(()=>[R("div",us,[t(U,{theme:"warning",message:"您没有查看本比赛的权限"}),r.value?(D(),K(S,{key:0,style:{margin:"20px auto 0",width:"200px"},onSubmit:s,"label-width":"0"},{default:l(()=>[t(E,null,{default:l(()=>[t(z,{placeholder:"请输入密码",value:m.value,"onUpdate:value":x[0]||(x[0]=Se=>m.value=Se),style:{width:"300px"},type:"password",autocomplete:"new-password"},null,8,["value"])]),_:1}),t(E,null,{default:l(()=>[R("div",is,[t($,{theme:"primary",type:"submit",loading:ce(k)},{default:l(()=>x[1]||(x[1]=[T("提交")])),_:1},8,["loading"])])]),_:1})]),_:1})):le("",!0)])]),_:1}))])]}),_:1}),t(V,{span:6},{default:l(()=>{var G;return[R("div",cs,[t(L,null,{default:l(()=>[f.value?(D(),K($,{key:0,onClick:i,loading:v.value},{default:l(()=>x[2]||(x[2]=[T("查重")])),_:1},8,["loading"])):le("",!0),f.value?(D(),K($,{key:1,onClick:w},{default:l(()=>x[3]||(x[3]=[T("编辑")])),_:1})):le("",!0)]),_:1})]),R("div",ds,[t(B,{layout:"vertical",bordered:!0},{default:l(()=>[t(M,{label:"创建时间"},{default:l(()=>{var q;return[T(F((q=h.value)==null?void 0:q.createTime),1)]}),_:1})]),_:1}),t(B,{layout:"vertical",bordered:!0},{default:l(()=>[t(M,{label:"更新时间"},{default:l(()=>{var q;return[T(F((q=h.value)==null?void 0:q.updateTime),1)]}),_:1})]),_:1}),t(B,{layout:"vertical",bordered:!0},{default:l(()=>[t(M,{label:"开始时间"},{default:l(()=>{var q;return[T(F((q=h.value)==null?void 0:q.startTime),1)]}),_:1})]),_:1}),t(B,{layout:"vertical",bordered:!0},{default:l(()=>[t(M,{label:"结束时间"},{default:l(()=>{var q;return[T(F((q=h.value)==null?void 0:q.endTime),1)]}),_:1})]),_:1})]),(G=h.value)!=null&&G.description?(D(),K(j,{key:0,style:{margin:"12px"}},{default:l(()=>{var q;return[R("div",{innerHTML:(q=h.value)==null?void 0:q.description,class:"dida-content-description"},null,8,ms)]}),_:1})):le("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),fs=ue(ps,[["__scopeId","data-v-75131de1"]]);function Va(e){return e?Math.floor(e/1e9):0}function ot(e){if(e<=0)return"0秒";let a="";const n=Math.floor(e/3600);n>0&&(a+=`${n}小时`);const u=Math.floor(e%3600/60);return(u>0||n>0)&&(n>0&&u<10&&(a+="0"),a+=`${u}分钟`),e=e%60,(e>0||u>0||n>0)&&((n>0||u>0)&&e<10&&(a+="0"),a+=`${e.toFixed(0)}秒`),a}const vs=rt("contest",{state:()=>({starMembers:{}}),actions:{clear(){this.$patch({starMembers:{}})},addStarMember(e,a){this.starMembers[e]||(this.starMembers[e]={}),this.starMembers[e][a]=!0},removeStarMember(e,a){this.starMembers[e]&&(delete this.starMembers[e][a],Object.keys(this.starMembers[e]).length===0&&delete this.starMembers[e])},isStarMember(e,a){var n;return!!((n=this.starMembers[e])!=null&&n[a])}},persist:!0}),_s={style:{margin:"10px 10px 40px"}},gs={style:{"text-align":"right","margin-bottom":"10px"}},bs={class:"table-scroll-wrapper"};function Zt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ye(e)}const hs=re({__name:"ContestRank",setup(e){const a=ye(),n=Ne(),u=vs(),{globalProperties:o}=de();let v=!1,g=null,y=0,h=null,_=null,r=0;const m=d(0),f=d(0),p=d(!1),P=d(!0),c=d(!0);let C=null,k=null,w=1,i=50;const s=d({current:w,pageSize:i,defaultCurrent:1,defaultPageSize:50,total:0,pageSizeOptions:[50,100,1e3]}),I=W=>u&&u.isStarMember(y,W),b=async W=>{s.value={...s.value,current:W.current,pageSize:W.pageSize},await n.push({query:{...a.query,page:W.current,page_size:W.pageSize}})},x=W=>{if(W==null)return"-";const H=Math.floor(W/3600).toString().padStart(2,"0"),ne=Math.floor(W%3600/60).toString().padStart(2,"0"),ee=(W%60).toFixed(0).toString().padStart(2,"0");return`${H}:${ne}:${ee}`},U=d({}),A=[{title:"Rank",colKey:"rank",align:"center",fixed:"left"},{title:"昵称",colKey:"nickname",fixed:"left",attrs:W=>{let H={};return I(W.row.userId)&&(H={backgroundColor:"rgba(255,165,30,0.5)"}),{style:H}},cell:(W,H)=>{const ne=El(H.row.nickname,18);let ee=null;return I(H.row.userId)?ee=t(J,{shape:"circle",variant:"text",class:"rank-unstar-button",onClick:()=>{u.removeStarMember(y,H.row.userId),q()}},{default:()=>[t(Ga,{slot:"icon"},null)]}):ee=t(J,{shape:"circle",variant:"text",class:"rank-star-button",onClick:()=>{u.addStarMember(y,H.row.userId),q()}},{default:()=>[t(Oa,{slot:"icon"},null)]}),t("div",{class:"rank-nickname-cell"},[t(he,null,{default:()=>[t(dl,{content:H.row.nickname},{default:()=>[t(J,{variant:"text",onClick:()=>n.push({name:"user",params:{username:H.row.username}})},Zt(ne)?ne:{default:()=>[ne]})]}),ee]})])}},{title:"Solved",colKey:"solved",align:"center",fixed:"left",cell:(W,H)=>t(J,{variant:"text",onClick:()=>n.push({name:"contest-judge",params:{contestId:y},query:{username:H.row.username,status:Ue.Accept}})},{default:()=>[H.row.solved]})},{title:"Penalty",colKey:"penalty",align:"center",fixed:"left",cell:(W,H)=>x(H.row.penalty)}],j=d([]),z=d(!1);let E=[],$=[];const S=d([]);let V=[];const L=({col:W,rowIndex:H})=>{if(W.colKey==="rank"){let ne=s.value.current;s.value.current>Math.ceil(S.value.length/s.value.pageSize)&&(ne=Math.ceil(S.value.length/s.value.pageSize));let ee=s.value.pageSize*(ne-1),me=1;for(let se=H+1;ee+se<S.value.length&&S.value[ee+se].rank===S.value[ee+H].rank;se++)me++;return{rowspan:me}}},M=(W,{value:H})=>ot(H),B=()=>{C&&clearInterval(C),C=setInterval(()=>{v&&Se(!1)},3e4),k&&clearInterval(k),k=setInterval(()=>{if(!v)return;m.value=(new Date().getTime()-h.getTime())/1e3;const W=Math.min(m.value,f.value);m.value=Math.min(m.value,W),q()},1e3)},Z=()=>{C&&(clearInterval(C),C=null),k&&(clearInterval(k),k=null)},N=async W=>{c.value=W,W?(await Se(!1),B()):Z()},G=()=>{q(),s.value={...s.value,current:1}},q=()=>{S.value=[];let W=[];for(let Y=0;Y<E.length;Y++){const ve=E[Y];let Me={userId:ve.author_id,username:ve.author_username,nickname:ve.author_nickname},Je=0,Ee=0;ve.problems.forEach(He=>{let Qe=-1,lt=He.lock||0;if(He.ac){if(Qe=(new Date(He.ac).getTime()-(h==null?void 0:h.getTime()))/1e3,Qe>m.value)return;Je++,Ee+=Qe,Ee+=He.attempt*20*60}if(lt>0&&r>0){const Ua=f.value-r;m.value<Ua&&(lt=0)}const pt=He.index;Me[`problem_${pt}`]={acDuration:Qe,attempt:He.attempt||0,lock:lt}}),Me.solved=Je,Me.penalty=Ee,W.push(Me)}W.sort((Y,ve)=>Y.solved!==ve.solved?ve.solved-Y.solved:Y.penalty!==ve.penalty?Y.penalty-ve.penalty:Y.userId-ve.userId);const H=$;let ne=0,ee=0,me=-1,se=-1;for(let Y=0;Y<W.length;Y++)H&&H.includes(W[Y].userId)?W[Y].rank="*":(ee++,(W[Y].solved!==me||W[Y].penalty!==se)&&(ne=ee,me=W[Y].solved,se=W[Y].penalty),W[Y].rank=String(ne));p.value&&(W=W.filter(Y=>I(Y.userId)));const te=document.querySelectorAll("tbody tr"),we={};V.forEach((Y,ve)=>{const Me=te[ve];Me&&(we[Y.userId]=Me.getBoundingClientRect())}),s.value={...s.value,total:W.length},S.value=W;for(let Y=0;Y<S.value.length;Y++)S.value[Y].index=Y+1;if(V=[...S.value],P.value){const Y={},ve=document.querySelectorAll("table tbody tr");S.value.forEach((Me,Je)=>{const Ee=ve[Je];Ee&&(Y[Me.userId]=Ee.getBoundingClientRect())}),requestAnimationFrame(()=>{const Me=document.querySelectorAll("table tbody tr");S.value.forEach((Je,Ee)=>{const He=Me[Ee],Qe=we[Je.userId],lt=Y[Je.userId];if(Qe&&lt){const pt=Qe.top-lt.top;pt!==0&&(He.style.transition="none",He.style.transform=`translateY(${pt}px)`)}}),requestAnimationFrame(()=>{document.querySelectorAll("table tbody tr").forEach(Ee=>{Ee.style.transition="transform 300ms ease",Ee.style.transform=""})})})}},be=W=>{N(!1),m.value=W;const H=Math.min(f.value,(new Date().getTime()-(h==null?void 0:h.getTime()))/1e3);m.value=Math.min(m.value,H),q()},Se=async W=>{W&&(z.value=!0);try{const H=await Jn(y);if(j.value=[...A],E=[],$=[],S.value=[],s.value={...s.value,total:0},H.code===0){if(!H.data.has_auth){fe(o,"您目前没有权限查看比赛排名"),await n.push({name:"contest-detail",params:{contestId:y}});return}H.data.problems.sort((me,se)=>me-se),H.data.problems.forEach((me,se)=>{j.value.push({colKey:`problem_${me}`,align:"center",title:()=>{let te;return t(J,{variant:"text",onClick:()=>n.push({name:"contest-problem-detail",params:{contestId:y,problemIndex:me}})},Zt(te=Xe(me))?te:{default:()=>[te]})},cell:(te,we)=>{const Y=we.row[`problem_${me}`];if(!Y)return"";let ve="";return Y.acDuration>=0&&(ve=x(Y.acDuration)),Y.attempt>0&&(ve&&(ve+=" "),ve+=`(-${Y.attempt})`),Y.lock>0&&(ve&&(ve+=" "),ve+=`(+${Y.lock})`),t("span",null,[ve])},attrs:te=>{const we=te.row[`problem_${me}`];return we?we.acDuration>=0?{style:{backgroundColor:"rgba(130,255,30,0.5)"}}:we.lock>0?{style:{backgroundColor:"rgb(255,180,50,0.5)"}}:we.attempt>0?{style:{backgroundColor:"rgba(255,120,120,0.5)"}}:{}:{}}})});const ne=H.data.contest;if(h=new Date(ne.start_time),_=new Date(ne.end_time),E=H.data.ranks,$=H.data.v_members||[],f.value=Math.floor((_.getTime()-h.getTime())/1e3),U.value={0:"0",[Math.floor(f.value/2)]:ot(Math.floor(f.value/2)),[f.value]:ot(f.value)},r=Va(ne.lock_rank_duration||0),H.data.is_locked&&r>0){const me=Math.max(0,f.value-r);U.value[me]=t("span",{style:"color: #0052d9"},[T("锁榜("),ot(me),T(")")])}m.value=Math.floor((new Date().getTime()-h.getTime())/1e3);const ee=Math.min(m.value,f.value);m.value=Math.min(m.value,ee),c.value=!0,B(),q()}else W&&O(o,H.code)}catch(H){console.error(H),W&&O(o,Ae())}finally{W&&(z.value=!1)}};return ie(async()=>{v=!0,g=Le(()=>a.query,async W=>{if(Array.isArray(a.params.contestId)?y=Number(a.params.contestId[0]):y=Number(a.params.contestId),!y){await n.push({name:"contest"});return}const H=parseInt(W.page)||s.value.defaultCurrent,ne=parseInt(W.page_size)||s.value.defaultPageSize;w=H,i=ne,s.value={...s.value,current:w,pageSize:i},await Se(!0)},{immediate:!0})}),Te(()=>{v=!1,g&&g(),Z()}),(W,H)=>{const ne=it,ee=he,me=cl,se=Ve,te=_e,we=Ce;return D(),K(we,null,{default:l(()=>[t(te,{style:{margin:"10px",width:"100%"}},{default:l(()=>[R("div",_s,[R("div",gs,[t(ee,null,{default:l(()=>[t(ne,{size:"large",modelValue:p.value,"onUpdate:modelValue":H[0]||(H[0]=Y=>p.value=Y),onChange:G},{label:l(Y=>[T(F(Y.value?"仅展示收藏":"未过滤收藏"),1)]),_:1},8,["modelValue"]),t(ne,{size:"large",modelValue:P.value,"onUpdate:modelValue":H[1]||(H[1]=Y=>P.value=Y)},{label:l(Y=>[T(F(Y.value?"开启动画":"关闭动画"),1)]),_:1},8,["modelValue"]),t(ne,{size:"large",modelValue:c.value,"onUpdate:modelValue":H[2]||(H[2]=Y=>c.value=Y),onChange:N},{label:l(Y=>[T(F(Y.value?"自动刷新":"关闭刷新"),1)]),_:1},8,["modelValue"])]),_:1})]),t(me,{modelValue:m.value,"onUpdate:modelValue":H[3]||(H[3]=Y=>m.value=Y),marks:U.value,max:f.value,label:M,"tooltip-props":{placement:"top"},"input-number-props":{theme:"column",autoWidth:!0,format:ce(ot),onChange:be},onChangeEnd:be},null,8,["modelValue","marks","max","input-number-props"])]),R("div",bs,[t(se,{data:S.value,columns:j.value,"row-key":"index","vertical-align":"middle",bordered:!0,hover:!0,"table-layout":"auto","rowspan-and-colspan":L,loading:z.value,class:"dida-contest-rank-table",pagination:s.value,onPageChange:b},null,8,["data","columns","loading","pagination"])])]),_:1})]),_:1})}}}),ys=ue(hs,[["__scopeId","data-v-838e6c28"]]),ws={style:{margin:"10px"}},ks={style:{margin:"12px"}},Cs={class:"dida-edit-container"},Ss=re({__name:"ContestEdit",setup(e){let a=ye();const{globalProperties:n}=de(),u=Ke(),o=d(""),v=d(!1);let g=null;const y=d(!1),h=d(!1),_=d(null),r=d({title:"",openTime:[],private:!0,password:"",problems:[],members:[],description:"",notification:"",lockRankDuration:0,alwaysLock:!0,submitAnytime:!1}),m=d(""),f=d(""),p=d(!1),P=async()=>{p.value=!0,h.value=!1,p.value=!1},c=async()=>{if(g){y.value=!0;try{const i={title:r.value.title,description:g.getValue(),notification:r.value.notification,lock_rank_duration:r.value.lockRankDuration,always_lock:r.value.alwaysLock,problems:r.value.problems,members:r.value.members,private:r.value.private,password:r.value.password,submit_anytime:r.value.submitAnytime};r.value.openTime[0]&&(i.start_time=new Date(r.value.openTime[0])),r.value.openTime[1]&&(i.end_time=new Date(r.value.openTime[1]));const s=await Xn(i);if(y.value=!0,s.code!==0){O(n,s.code);return}s.data!=null&&await Q.push({name:"contest-detail",params:{contestId:s.data}}),Be(n,"创建成功")}finally{y.value=!1}}},C=async()=>{if(g){y.value=!0;try{const i={id:Number(o.value),title:r.value.title,description:g.getValue(),notification:r.value.notification,lock_rank_duration:r.value.lockRankDuration,always_lock:r.value.alwaysLock,problems:r.value.problems,members:r.value.members,private:r.value.private,password:r.value.password,submit_anytime:r.value.submitAnytime};r.value.openTime[0]&&(i.start_time=new Date(r.value.openTime[0])),r.value.openTime[1]&&(i.end_time=new Date(r.value.openTime[1]));const s=await Yn(i);if(y.value=!0,s.code!==0){O(n,s.code);return}s.data!=null&&_.value&&(_.value.updateTime=new Date(s.data).toLocaleString()),Be(n,"保存成功")}finally{y.value=!1}}},k=i=>{const s={after:()=>{g==null||g.setValue(i),v.value=!1},preview:{math:{inlineDigit:!0,engine:"KaTeX"}}};g=new ge("contestEditDiv",s)},w=async()=>{const i=await On(o.value);if(i.code!==0){O(n,i.code),console.error("contest get failed",i.code),await Q.push({name:"contest-list"});return}const s=i.data.contest;_.value=await Mt(s),r.value.title=s.title,r.value.openTime=[],s.start_time?r.value.openTime.push(new Date(s.start_time)):r.value.openTime.push(""),s.end_time?r.value.openTime.push(new Date(s.end_time)):r.value.openTime.push(""),r.value.private=s.private,r.value.password=s.password||"",r.value.description=s.description||"",r.value.notification=s.notification||"",r.value.problems=i.data.problems,r.value.members=i.data.members,s.lock_rank_duration?r.value.lockRankDuration=Va(s.lock_rank_duration):r.value.lockRankDuration=0,r.value.alwaysLock=s.always_lock,r.value.submitAnytime=s.submit_anytime,u.setTitle(s.title+" - "+u.getTitle);let I="";s.description&&(I=s.description),k(I)};return ie(async()=>{Array.isArray(a.params.contestId)?o.value=a.params.contestId[0]:o.value=a.params.contestId,o.value?(v.value=!0,await w()):k("")}),(i,s)=>{const I=$e,b=ze,x=da,U=it,A=ra,j=je,z=_e,E=Pe,$=J,S=he,V=Oe,L=Ge,M=Ce,B=Ie,Z=kt,N=Ze;return D(),ae(oe,null,[t(B,{loading:v.value},{default:l(()=>[t(M,null,{default:l(()=>[t(E,{span:8},{default:l(()=>[R("div",ws,[t(z,{class:"sh-card"},{default:l(()=>[t(j,{model:r.value,"label-width":"150px"},{default:l(()=>[t(b,{label:"标题"},{default:l(()=>[t(I,{modelValue:r.value.title,"onUpdate:modelValue":s[0]||(s[0]=G=>r.value.title=G),placeholder:"比赛标题"},null,8,["modelValue"])]),_:1}),t(b,{label:"通知"},{default:l(()=>[t(I,{modelValue:r.value.notification,"onUpdate:modelValue":s[1]||(s[1]=G=>r.value.notification=G),placeholder:"会更为醒目地提醒"},null,8,["modelValue"])]),_:1}),t(b,{label:"开启时间"},{default:l(()=>[t(x,{modelValue:r.value.openTime,"onUpdate:modelValue":s[2]||(s[2]=G=>r.value.openTime=G),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(b,{label:"提交限制"},{default:l(()=>[t(U,{modelValue:r.value.submitAnytime,"onUpdate:modelValue":s[3]||(s[3]=G=>r.value.submitAnytime=G)},{label:l(G=>[T(F(G.value?"结束仍能提交":"仅比赛期间提交"),1)]),_:1},8,["modelValue"])]),_:1}),t(b,{label:"锁榜时长"},{default:l(()=>[t(A,{modelValue:r.value.lockRankDuration,"onUpdate:modelValue":s[4]||(s[4]=G=>r.value.lockRankDuration=G),min:0,format:ce(ot),"auto-width":""},null,8,["modelValue","format"])]),_:1}),t(b,{label:"自动解锁"},{default:l(()=>[t(U,{modelValue:r.value.alwaysLock,"onUpdate:modelValue":s[5]||(s[5]=G=>r.value.alwaysLock=G)},{label:l(G=>[T(F(G.value?"结束后仍锁榜":"结束后解锁"),1)]),_:1},8,["modelValue"])]),_:1}),t(b,{label:"私有"},{default:l(()=>[t(U,{modelValue:r.value.private,"onUpdate:modelValue":s[6]||(s[6]=G=>r.value.private=G)},null,8,["modelValue"])]),_:1}),r.value.private?(D(),K(b,{key:0,label:"密码"},{default:l(()=>[t(I,{modelValue:r.value.password,"onUpdate:modelValue":s[7]||(s[7]=G=>r.value.password=G),type:"password",placeholder:"请输入访问密码，留空代表关闭密码访问"},null,8,["modelValue"])]),_:1})):le("",!0),r.value.private?(D(),K(b,{key:1,label:"成员"},{default:l(()=>[t(xa,{modelValue:r.value.members,"onUpdate:modelValue":s[8]||(s[8]=G=>r.value.members=G)},null,8,["modelValue"])]),_:1})):le("",!0),t(b,{label:"问题"},{default:l(()=>[t(Ta,{modelValue:r.value.problems,"onUpdate:modelValue":s[9]||(s[9]=G=>r.value.problems=G)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(E,{span:4},{default:l(()=>[R("div",ks,[R("div",Cs,[o.value?(D(),K(S,{key:0},{default:l(()=>[t($,{onClick:C,theme:"danger",loading:y.value},{default:l(()=>s[12]||(s[12]=[T("保存")])),_:1},8,["loading"])]),_:1})):(D(),K(S,{key:1},{default:l(()=>[t($,{onClick:c,theme:"danger",loading:y.value},{default:l(()=>s[13]||(s[13]=[T("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(D(),K(L,{key:0,layout:"vertical",bordered:!0},{default:l(()=>[t(V,{label:"创建时间"},{default:l(()=>{var G;return[T(F((G=_.value)==null?void 0:G.createTime),1)]}),_:1}),t(V,{label:"更新时间"},{default:l(()=>{var G;return[T(F((G=_.value)==null?void 0:G.updateTime),1)]}),_:1}),t(V,{label:"创建用户"},{default:l(()=>{var G;return[T(F((G=_.value)==null?void 0:G.ownerNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),s[14]||(s[14]=R("div",{id:"contestEditDiv",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"]),t(N,{visible:h.value,"onUpdate:visible":s[11]||(s[11]=G=>h.value=G),onConfirm:P,header:m.value,"confirm-loading":p.value},{default:l(()=>[s[15]||(s[15]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(Z,{modelValue:f.value,"onUpdate:modelValue":s[10]||(s[10]=G=>f.value=G),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),Qt=ue(Ss,[["__scopeId","data-v-77e745ac"]]);function Da(e){const a={};return a.id=e.id,a.authorId=e.author_id,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.title=e.title,a.content=e.content,e.insert_time&&(a.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(a.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(a.updateTime=new Date(e.update_time).toLocaleString()),a.problemId=e.problem_id,a.problemTitle=e.problem_title,a.contestId=e.contest_id,a.contestTitle=e.contest_title,a.contestProblemIndex=e.contest_problem_index,a}async function Is(e){const a={};if(a.id=e.id,a.authorId=e.author_id,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.content="",e.content){const n={math:{inlineDigit:!0,engine:"KaTeX"}};a.content=await ge.md2html(e.content,n)}return e.insert_time&&(a.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(a.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(a.updateTime=new Date(e.update_time).toLocaleString()),a}function Ps(e){return X({url:"/discuss?id="+e,method:"get"})}function Ts(e,a,n,u,o,v){const g={};return e&&(g.contest_id=e),a&&(g.problem_id=a),n&&(g.title=n),u&&(g.username=u),o&&(g.page=o),v&&(g.page_size=v),X({url:`/discuss/list?${new URLSearchParams(g).toString()}`,method:"get"})}function xs(e,a,n){return X({url:"/discuss/comment/list?id="+e+"&page="+a+"&page_size="+n,method:"get"})}function Vs(e){return X({url:"/discuss/create",method:"post",data:e})}const Ds={style:{margin:"10px"}};function Ls(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ye(e)}const js=re({__name:"DiscussList",setup(e){const a=ye(),n=Ne(),{globalProperties:u}=de();let o=null;const v=d(!1),g=d(!1);let y=-1;const h=d([]),_=[],r=[{title:"标题",colKey:"title",cell:(j,z)=>t(J,{variant:"text",onClick:()=>s(z.row.id)},{default:()=>[z.row.title]})},{title:"创建人",colKey:"authorNickname",width:"200",cell:(j,z)=>t(J,{variant:"text",onClick:async()=>await Et(n,z.row.authorUsername)},{default:()=>[z.row.authorNickname]})},{title:"创建时间",colKey:"insertTime",width:"180"},{title:"更新时间",colKey:"updateTime",width:"180"}],m=d(!1);let f=1,p=50;const P=d({current:f,pageSize:p,defaultCurrent:f,defaultPageSize:p,total:0,pageSizeOptions:[50,100]}),c=d(),C=d({problemId:"",title:"",username:""}),k=d({title:"",content:""}),w=j=>{j&&n.push({name:"problem-detail",params:{problemId:j}})},i=(j,z)=>{n.push({name:"contest-problem-detail",params:{contestId:j,problemIndex:z}})},s=j=>{if(j){if(y){n.push({name:"contest-discuss-detail",params:{contestId:y,discussId:j}});return}n.push({name:"discuss-detail",params:{discussId:j}})}},I=async()=>{await n.push({query:{...a.query,problem_id:C.value.problemId,title:C.value.title,username:C.value.username,page:1,page_size:P.value.defaultPageSize}})},b=async(j,z)=>{var E;m.value=!0;try{const{current:$,pageSize:S}=j,V=await Ts(y,C.value.problemId,C.value.title,C.value.username,$,S);if(c.value=[],V.code===0){if(!V.data.has_auth){fe(u,"您目前没有权限查看讨论列表"),y?await n.push({name:"contest-detail",params:{contestId:y}}):await n.push({name:"discuss-list"});return}if(V.data.list){const L=V.data.list;for(let M=0;M<L.length;M++){const B=L[M],Z=await Da(B);(E=c.value)==null||E.push(Z)}}P.value={...P.value,total:V.data.total_count}}else z&&O(u,V.code)}catch($){console.error($),O(u,Ae())}finally{m.value=!1}},x=async j=>{await n.push({query:{...a.query,page:j.current,page_size:j.pageSize}})},U=()=>{v.value=!0},A=async()=>{g.value=!0,console.log("discussCreateForm",k.value),Vs(k.value).then(j=>{j.code===0?(fe(u,"创建比赛成功"),v.value=!1,n.push({path:"/discuss/"+j.data.id})):O(u,j.code)}).finally(()=>{g.value=!1})};return ie(async()=>{o=Le(()=>a.query,j=>{Array.isArray(a.params.contestId)?y=Number(a.params.contestId[0]):y=Number(a.params.contestId),h.value=_,y?h.value=h.value.concat([{title:"问题ID",colKey:"contestProblemIndex",width:"100",cell:($,S)=>{let V;return S.row.contestProblemIndex?t(J,{variant:"text",onClick:()=>i(y,S.row.contestProblemIndex)},Ls(V=Xe(S.row.contestProblemIndex))?V:{default:()=>[V]}):""}}]):h.value=h.value.concat([{title:"问题ID",colKey:"problemId",width:"100",cell:($,S)=>S.row.problemId?t(J,{variant:"text",onClick:()=>w(S.row.problemId)},{default:()=>[S.row.problemId]}):""}]),h.value=h.value.concat(r),C.value.problemId=j.problem_id||"",C.value.title=j.title||"",C.value.username=j.username||"";const z=parseInt(j.page)||P.value.defaultCurrent,E=parseInt(j.page_size)||P.value.defaultPageSize;f=z,p=E,P.value={...P.value,current:f,pageSize:p},b({current:f,pageSize:p},!0)},{immediate:!0})}),Te(()=>{o&&o()}),(j,z)=>{const E=Ve,$=_e,S=Pe,V=$e,L=ze,M=J,B=je,Z=he,N=Ce,G=Ze;return D(),ae(oe,null,[t(N,null,{default:l(()=>[t(S,{span:9},{default:l(()=>[t($,{style:{margin:"10px"}},{default:l(()=>[t(E,{data:c.value,columns:h.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:P.value,loading:m.value,"table-layout":"auto",onPageChange:x},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(S,{span:3},{default:l(()=>[R("div",Ds,[t($,{class:"sh-card"},{default:l(()=>[t(B,{model:C.value},{default:l(()=>[t(L,{label:"问题ID"},{default:l(()=>[t(V,{modelValue:C.value.problemId,"onUpdate:modelValue":z[0]||(z[0]=q=>C.value.problemId=q),placeholder:"请输入完整问题ID"},null,8,["modelValue"])]),_:1}),t(L,{label:"标题"},{default:l(()=>[t(V,{modelValue:C.value.title,"onUpdate:modelValue":z[1]||(z[1]=q=>C.value.title=q),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(L,{label:"创建人"},{default:l(()=>[t(V,{modelValue:C.value.username,"onUpdate:modelValue":z[2]||(z[2]=q=>C.value.username=q),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(L,null,{default:l(()=>[t(M,{theme:"primary",onClick:I},{default:l(()=>z[6]||(z[6]=[T("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t($,{class:"sh-card"},{default:l(()=>[t(Z,null,{default:l(()=>[t(M,{onClick:U},{default:l(()=>z[7]||(z[7]=[T("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),t(G,{visible:v.value,"onUpdate:visible":z[5]||(z[5]=q=>v.value=q),header:"创建讨论",onConfirm:A,"confirm-loading":g.value},{default:l(()=>[t(B,{"label-width":80,model:k.value,onSubmit:z[4]||(z[4]=gt(()=>{},["prevent"]))},{default:l(()=>[t(L,{label:"标题"},{default:l(()=>[t(V,{modelValue:k.value.title,"onUpdate:modelValue":z[3]||(z[3]=q=>k.value.title=q),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),ft=ue(js,[["__scopeId","data-v-a2987da9"]]),zs={key:0,style:{margin:"20px"}},$s=["innerHTML"],Us=["innerHTML"],As={style:{margin:"10px"}},Rs={style:{margin:"10px"}},Ms={style:{margin:"10px","text-align":"right"}},Es={style:{margin:"12px"}},qs={key:0,class:"dida-edit-container"},Ks=re({__name:"DiscussDetail",props:{discussId:{}},setup(e){const a=e;let n=ye();const{globalProperties:u}=de();let o=null;const v=Ke(),g=De();let y=d("");const h=d(""),_=d(null),r=d(!1),m=d(null),f=d(!1);let p=1,P=20;const c=d({current:1,total:0,defaultPageSize:P,defaultCurrent:p,pageSizeOptions:[20,50]}),C=d([]),k={},w=Fe(()=>g.hasAuth(Re.ManageDiscuss)),i=A=>{A&&Q.push({name:"discuss-list",query:{...n.query,title:"",tag:A.name}})},s=()=>{Q.push({name:"manage-discuss",params:{discussId:h.value}})},I=()=>t("div",{class:"t-pagination__total"},[`共 ${c.value.total} 条回复`]),b=()=>{},x=async(A,j)=>{var z;f.value=!0;try{const{current:E,pageSize:$}=A,S=await xs(h.value,E,$);if(C.value=[],S.code===0){const V=S.data.list;if(V)for(let L=0;L<V.length;L++){const M=V[L],B=await Is(M);(z=C.value)==null||z.push(B),await qe(()=>{const Z=document.querySelectorAll(".dida-discuss-content");Z&&Z.length>0&&Z.forEach(N=>{ge.mathRender(N),ge.highlightRender({lineNumber:!0,enable:!0},N),tt(N)})})}c.value={...c.value,total:S.data.total_count}}else j&&O(u,S.code)}catch(E){console.error(E),O(u,Ae())}finally{f.value=!1}},U=async A=>{await Q.push({query:{...n.query,page:A.current,page_size:A.pageSize}})};return ie(async()=>{if(h.value=a.discussId,h.value||(Array.isArray(n.params.discussId)?h.value=n.params.discussId[0]:h.value=n.params.discussId),!h.value){pe(u,"讨论不存在"),await Q.push({name:"discuss"});return}r.value=!0;const A=await Ps(h.value);if(A.code!==0){r.value=!1,O(u,A.code),await Q.push({name:"discuss"});return}A.data.tags&&A.data.tags.forEach($=>{k[$.id]=$}),m.value=Da(A.data.discuss),v.setTitle(m.value.title+" - "+v.getTitle);let j=m.value.content;const z={math:{inlineDigit:!0,engine:"KaTeX"}};y.value=await ge.md2html(j,z),await qe(()=>{_.value&&(ge.mathRender(_.value),ge.highlightRender({lineNumber:!0,enable:!0},_.value),tt(_.value)),r.value=!1}),o=Le(()=>n.query,$=>{const S=parseInt($.page)||c.value.defaultCurrent,V=parseInt($.page_size)||c.value.defaultPageSize;p=S,P=V,c.value={...c.value,current:p,pageSize:P},x({current:p,pageSize:P},!0)},{immediate:!0});const E={after:()=>{},preview:{math:{inlineDigit:!0,engine:"KaTeX"}}};new ge("commentEditRef",E)}),Te(()=>{o&&o()}),(A,j)=>{const z=ia,E=ua,$=_e,S=he,V=ml,L=J,M=Pe,B=Oe,Z=Ge,N=Ce,G=Ie;return D(),K(G,{loading:r.value},{default:l(()=>[t(N,{class:"dida-main-content"},{default:l(()=>[t(M,{span:8},{default:l(()=>{var q,be,Se;return[(q=m.value)!=null&&q.problemTitle||(be=m.value)!=null&&be.contestTitle?(D(),ae("div",zs,[t(E,{"max-item-width":"300"},{default:l(()=>{var W,H,ne,ee,me;return[(W=m.value)!=null&&W.contestTitle?(D(),ae(oe,{key:0},[t(z,{to:{name:"contest-detail",params:{contestId:(H=m.value)==null?void 0:H.contestId}}},{default:l(()=>{var se;return[T(F((se=m.value)==null?void 0:se.contestTitle),1)]}),_:1},8,["to"]),(ne=m.value)!=null&&ne.contestProblemIndex?(D(),K(z,{key:0,to:{name:"contest-problem-detail",params:{problemIndex:(ee=m.value)==null?void 0:ee.contestProblemIndex}}},{default:l(()=>{var se,te;return[T(F(ce(Xe)((se=m.value)==null?void 0:se.contestProblemIndex))+" - "+F((te=m.value)==null?void 0:te.problemTitle),1)]}),_:1},8,["to"])):le("",!0)],64)):(D(),ae(oe,{key:1},[t(z,{to:{name:"discuss-list-problem"}},{default:l(()=>j[3]||(j[3]=[T(" 问题讨论")])),_:1}),t(z,{to:{name:"problem-detail",params:{problemId:(me=m.value)==null?void 0:me.problemId}}},{default:l(()=>{var se;return[T(F((se=m.value)==null?void 0:se.problemTitle),1)]}),_:1},8,["to"])],64))]}),_:1})])):le("",!0),t($,{style:{margin:"10px"},header:(Se=m.value)==null?void 0:Se.title,"header-bordered":!0},{default:l(()=>[R("div",{innerHTML:ce(y),class:"dida-discuss-content"},null,8,$s)]),_:1},8,["header"]),(D(!0),ae(oe,null,ke(C.value,(W,H)=>(D(),K($,{key:H,style:{margin:"10px"},"header-bordered":""},{header:l(()=>[t(S,null,{default:l(()=>[R("span",null,F(W.authorNickname),1),R("span",null,F(W.insertTime),1)]),_:2},1024)]),default:l(()=>[R("div",{innerHTML:W.content,class:"dida-discuss-content"},null,8,Us)]),_:2},1024))),128)),R("div",As,[t(V,{modelValue:c.value.current,"onUpdate:modelValue":j[0]||(j[0]=W=>c.value.current=W),"page-size":c.value.pageSize,"onUpdate:pageSize":j[1]||(j[1]=W=>c.value.pageSize=W),total:c.value.total,"page-size-options":c.value.pageSizeOptions,"show-page-size":!1,"total-content":I,onChange:U},null,8,["modelValue","page-size","total","page-size-options"])]),R("div",Rs,[j[5]||(j[5]=R("div",{id:"commentEditRef",class:"dida-comment-editor"},null,-1)),R("div",Ms,[t(S,null,{default:l(()=>[t(L,{theme:"primary",onClick:b},{default:l(()=>j[4]||(j[4]=[T("提交")])),_:1})]),_:1})])])]}),_:1}),t(M,{span:4},{default:l(()=>[R("div",Es,[w.value?(D(),ae("div",qs,[t(L,{onClick:s},{default:l(()=>j[6]||(j[6]=[T("编辑")])),_:1})])):le("",!0),t(Z,{layout:"vertical",bordered:!0},{default:l(()=>[t(B,{label:"创建时间"},{default:l(()=>{var q;return[T(F((q=m.value)==null?void 0:q.insertTime),1)]}),_:1}),t(B,{label:"编辑时间"},{default:l(()=>{var q;return[T(F((q=m.value)==null?void 0:q.modifyTime),1)]}),_:1}),t(B,{label:"更新时间"},{default:l(()=>{var q;return[T(F((q=m.value)==null?void 0:q.updateTime),1)]}),_:1}),t(B,{label:"创建用户"},{default:l(()=>[t(L,{variant:"text",onClick:j[2]||(j[2]=async()=>{var q;return await ce(Et)(ce(Q),(q=m.value)==null?void 0:q.authorUsername)})},{default:l(()=>{var q;return[T(F((q=m.value)==null?void 0:q.authorNickname),1)]}),_:1})]),_:1}),t(B,{label:"标签"},{default:l(()=>[t(S,null,{default:l(()=>{var q;return[(D(!0),ae(oe,null,ke((q=m.value)==null?void 0:q.tags,be=>(D(),K(L,{key:be.id,variant:"dashed",onClick:()=>i(be)},{default:l(()=>[T(F(be.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),It=ue(Ks,[["__scopeId","data-v-20308f3c"]]);function Fs(e,a){return X({url:"/rank/ac/all?page="+e+"&page_size="+a,method:"get"})}function Ns(e,a){return X({url:"/rank/ac/problem?page="+e+"&page_size="+a,method:"get"})}function Gs(e,a){return X({url:"/rank/ac/problem/today?page="+e+"&page_size="+a,method:"get"})}function Os(e,a){return X({url:"/rank/ac/problem/day7?page="+e+"&page_size="+a,method:"get"})}function Hs(e,a){return X({url:"/rank/ac/problem/day30?page="+e+"&page_size="+a,method:"get"})}function Bs(e,a){return X({url:"/rank/ac/problem/year?page="+e+"&page_size="+a,method:"get"})}const Ws={style:{margin:"10px"}};function Pt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ye(e)}const Js=re({__name:"RankUser",props:{type:{}},setup(e){const a=ye(),n=Ne(),{globalProperties:u}=de();let o=null;const v=e,g=d(""),y=d(""),h={all:{header:"统计所有用户在本站的提交记录",content:"优先以AC记录数量排序，如果相同则提交所用次数较少的优先，如果仍相同，注册较早的用户靠前"},problem:{header:"统计所有用户在本站的提交记录",content:"以题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-today":{header:"统计所有用户今日在本站的提交记录",content:"以今日题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-day7":{header:"统计所有用户最近7日在本站的提交记录",content:"以7日题目记录数量排序（从7日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-day30":{header:"统计所有用户最近30日在本站的提交记录",content:"以30日题目记录数量排序（从30日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-year":{header:"统计所有用户最近1年在本站的提交记录",content:"以最近1年题目记录数量排序（从365日前的0点开始计算），如果相同，注册较早的用户靠前"}},_=d([]),r=[{title:"序号",colKey:"index"},{title:"用户名",colKey:"username",cell:(x,U)=>t(J,{variant:"dashed",onClick:()=>w(U.row.username)},{default:()=>[U.row.username]})},{title:"昵称",colKey:"nickname"},{title:"Slogan",colKey:"slogan"}],m=[{title:"题目数量",colKey:"problem_count",cell:(x,U)=>{let A=0;return U.row.problem_count&&(A=U.row.problem_count),t(J,{variant:"dashed",onClick:()=>i(U.row.username)},Pt(A)?A:{default:()=>[A]})}}],f=[{title:"正确",colKey:"accept",cell:(x,U)=>{let A=0;return U.row.accept&&(A=U.row.accept),t(J,{variant:"dashed",onClick:()=>i(U.row.username)},Pt(A)?A:{default:()=>[A]})}},{title:"提交",colKey:"attempt",cell:(x,U)=>{let A=0;return U.row.attempt&&(A=U.row.attempt),t(J,{variant:"dashed",onClick:()=>s(U.row.username)},Pt(A)?A:{default:()=>[A]})}}],p=d(!1);let P=1,c=50;const C=d({current:P,pageSize:c,defaultCurrent:P,defaultPageSize:c,total:0,pageSizeOptions:[50]}),k=d(),w=x=>{n.push({name:"user",params:{username:x}})},i=x=>{n.push({name:"judge-list",query:{username:x,status:Ue.Accept}})},s=x=>{n.push({name:"judge-list",query:{username:x}})},I=async(x,U)=>{p.value=!0;try{k.value=[];const{current:A,pageSize:j}=x;let z=null;switch(v.type){case"problem":z=await Ns(A,j);break;case"problem-today":z=await Gs(A,j);break;case"problem-day7":z=await Os(A,j);break;case"problem-day30":z=await Hs(A,j);break;case"problem-year":z=await Bs(A,j);break;default:z=await Fs(A,j);break}if(z.code===0){const E=z.data.list;if(!E||E.length<=0){C.value={...C.value,total:0},fe(u,"未找到记录");return}k.value=[];const $=C.value.pageSize*(C.value.current-1);let S=1;E.forEach(V=>{var M;const L=V;L.index=$+S++,(M=k.value)==null||M.push(L)}),C.value={...C.value,total:z.data.total_count}}else U&&O(u,z.code)}catch(A){console.error(A),O(u,Ae())}finally{p.value=!1}},b=async x=>{await n.push({query:{...a.query,page:x.current,page_size:x.pageSize}})};return ie(async()=>{p.value=!0,o=Le(()=>a.query,x=>{switch(v.type&&h[v.type]?(g.value=h[v.type].header,y.value=h[v.type].content):(g.value=h.all.header,y.value=h.all.content),v.type){case"all":_.value=r.concat(f);break;default:_.value=r.concat(m);break}const U=parseInt(x.page)||C.value.defaultCurrent,A=parseInt(x.page_size)||C.value.defaultPageSize;P=U,c=A,C.value={...C.value,current:P,pageSize:c},I({current:P,pageSize:c},!0)},{immediate:!0})}),Te(()=>{o&&o()}),(x,U)=>{const A=Ve,j=_e,z=Pe,E=Ce;return D(),K(E,null,{default:l(()=>[t(z,{span:9},{default:l(()=>[t(j,{style:{margin:"10px"}},{default:l(()=>[t(A,{data:k.value,columns:_.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:C.value,loading:p.value,"table-layout":"auto",onPageChange:b},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(z,{span:3},{default:l(()=>[R("div",Ws,[t(j,{class:"sh-card",header:g.value,"header-bordered":!0},{default:l(()=>[T(F(y.value),1)]),_:1},8,["header"])])]),_:1})]),_:1})}}}),nt=ue(Js,[["__scopeId","data-v-13682529"]]),Xs={style:{display:"flex","align-items":"center"}},Ys={style:{color:"#409eff","margin-right":"20px"}},Zs={class:"dida-login-footer"},Qs=re({__name:"UserForget",setup(e){const{globalProperties:a}=de(),n=De(),u=d(!1),o=d(!1),v=d(!1),g=d("发送验证码");let y=null,h=-1;const _=d(!1),r=d(null),m=d(""),f=d({username:"",emailKey:"",password:"",confirmPassword:""}),P=d({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:I=>new Promise(b=>{const x=setTimeout(()=>{b(f.value.password===I),clearTimeout(x)})}),message:"两次密码不一致"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),c=()=>{fe(a,"重置成功")},C=async I=>{if(!v.value){u.value=!0,o.value=!0;try{const b=await pn(I,f.value.username);b.code===0?(fe(a,"验证码发送成功"),m.value=b.data,o.value=!1,v.value=!0,y=new Date,g.value="60秒后重发",h=setInterval(()=>{const U=Math.floor((new Date().getTime()-(y==null?void 0:y.getTime()))/1e3);U>60?(g.value="发送验证码",v.value=!1,clearInterval(h)):g.value=`${60-U}秒后重发`},1e3)):O(a,b.code)}catch(b){console.error("Send email key error",b),pe(a,"发送验证码失败")}finally{u.value=!1}}},k=async()=>{var U;if(_.value=!0,v.value||o.value)return;await qe();const I=document.getElementById("cf-confirm-div");I&&I.remove();const b=document.createElement("div");b.id="cf-confirm-div",b.setAttribute("data-theme","light"),(U=r.value)==null||U.appendChild(b);const x=window;x.turnstile.ready(function(){x.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(A){_.value=!1,await C(A)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},w=d(()=>t(J,{onClick:k,disabled:v.value,loading:o.value,style:"width:120px"},{default:()=>[g.value]})),i=async()=>{u.value=!0;try{const I=await fn(f.value.username,f.value.password,f.value.emailKey);I.code===0?(fe(a,"密码修改成功"),a.$router.push({name:"login"})):O(a,I.code)}catch(I){console.error("Modify password error",I),pe(a,"修改密码失败")}finally{u.value=!1}},s=async({validateResult:I,firstError:b,e:x})=>{if(!u.value){if(x.preventDefault(),I!==!0){pe(a,b);return}m.value?await i():await k()}};return ie(()=>{if(n.isLogin()){a.$router.push({path:"/user"});return}}),Te(()=>{}),(I,b)=>{const x=jt,U=$e,A=ze,j=sa,z=J,E=je,$=at,S=_e,V=Ze;return D(),ae(oe,null,[t(S,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:l(()=>[t(x,{"max-line":1},{default:l(()=>b[6]||(b[6]=[R("span",null,"如果您未绑定邮箱或忘记用户名，可联系管理员寻求帮助",-1),R("span",null,"管理员邮箱：BoilTask@qq.com",-1)])),_:1}),t(E,{ref:"form",rules:P.value,data:f.value,colon:!0,onReset:c,onSubmit:s,class:"yj-login-form"},{default:l(()=>[t(A,{name:"username",label:"用户名"},{default:l(()=>[t(U,{modelValue:f.value.username,"onUpdate:modelValue":b[0]||(b[0]=L=>f.value.username=L),clearable:"",placeholder:"请输入完整用户名"},null,8,["modelValue"])]),_:1}),m.value?(D(),ae(oe,{key:0},[t(A,{name:"email",label:"发送邮箱"},{default:l(()=>[t(j,{append:w.value},{default:l(()=>[R("div",Xs,[R("span",Ys,F(m.value),1)])]),_:1},8,["append"])]),_:1}),t(A,{name:"emailKey",label:"验证码"},{default:l(()=>[t(U,{modelValue:f.value.emailKey,"onUpdate:modelValue":b[1]||(b[1]=L=>f.value.emailKey=L),clearable:"",placeholder:"请输入收到的验证码"},null,8,["modelValue"])]),_:1}),t(A,{name:"password",label:"新密码"},{default:l(()=>[t(U,{modelValue:f.value.password,"onUpdate:modelValue":b[2]||(b[2]=L=>f.value.password=L),type:"password",clearable:"",placeholder:"新密码"},null,8,["modelValue"])]),_:1}),t(A,{name:"confirmPassword",label:"确认密码"},{default:l(()=>[t(U,{modelValue:f.value.confirmPassword,"onUpdate:modelValue":b[3]||(b[3]=L=>f.value.confirmPassword=L),type:"password",clearable:"",placeholder:"请重复输入密码"},null,8,["modelValue"])]),_:1})],64)):le("",!0),m.value?(D(),K(A,{key:1},{default:l(()=>[t(z,{theme:"primary",type:"submit",block:"",loading:u.value},{default:l(()=>b[7]||(b[7]=[T("修改密码")])),_:1},8,["loading"])]),_:1})):(D(),K(A,{key:2},{default:l(()=>[t(z,{theme:"primary",type:"submit",block:"",loading:u.value},{default:l(()=>b[8]||(b[8]=[T("重置密码")])),_:1},8,["loading"])]),_:1}))]),_:1},8,["rules","data"]),R("div",Zs,[t($,{onClick:b[4]||(b[4]=()=>{ce(a).$router.push({name:"login"})})},{default:l(()=>b[9]||(b[9]=[T("返回登陆 ")])),_:1})])]),_:1}),t(V,{visible:_.value,"onUpdate:visible":b[5]||(b[5]=L=>_.value=L),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:l(()=>[R("div",{ref_key:"dialogContainer",ref:r,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),er=ue(Qs,[["__scopeId","data-v-d3cb1db8"]]),tr={class:"judger-status-panel"},ar={class:"judger-status-panel"};function lr(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ye(e)}const nr=re({__name:"SystemStatus",setup(e){const{globalProperties:a}=de(),n=d([]),u=d([]),o=d(!1);let v;const g=_=>{let r="失效",m="danger";const f=new Date,p=new Date(_.updateTime);return f.getTime()-p.getTime()>3e4?(r="离线",m="default"):_.cpuUsage>90?(r="CPU过高",m="warning"):_.memPercent>90?(r="内存过高",m="warning"):(r="在线",m="success"),t(he,null,{default:()=>[t("span",null,[_.key,T(" - "),_.name]),t("span",null,[_.updateTime]),t(et,{theme:m,size:"small"},lr(r)?r:{default:()=>[r]})]})},y=async()=>{const _={};for(let w=0;w<n.value.length;w++){const i=n.value[w];_[i.key]={...i}}const r={};for(let w=0;w<u.value.length;w++){const i=u.value[w];r[i.key]={...i}}const m=[],f=[],p=await jl();if(p.code!==0){O(a,p.code);return}const P=p.data.web,c={key:"didaoj"};P.name?c.name=P.name:c.name="-",P.update_time?c.updateTime=new Date(P.update_time).toLocaleString():c.updateTime="-",P.cpu_usage?c.cpuUsage=Number(P.cpu_usage):c.cpuUsage=0,P.mem_usage?c.memUsage=P.mem_usage/(1024*1024*1024):c.memUsage=0,P.mem_total?c.memTotal=P.mem_total/(1024*1024*1024):c.memTotal=0,c.memTotal>0?c.memPercent=Math.round(c.memUsage/c.memTotal*1e4)/100:c.memPercent=0,c.avgMessage=P.avg_message;const C=_[c.key];C?(c.cpuUsageFrom=C.cpuUsage,c.memPercentFrom=C.memPercent,c.memUsageFrom=C.memUsage,c.memTotalFrom=C.memTotal):(c.cpuUsageFrom=0,c.memPercentFrom=0,c.memUsageFrom=0,c.memTotalFrom=0),m.push(c),n.value=m;const k=p.data.judger;for(let w=0;w<k.length;w++){const i=k[w],s={key:i.key,name:i.name};i.name?s.name=i.name:s.name="-",i.update_time?s.updateTime=new Date(i.update_time).toLocaleString():s.updateTime="-",i.cpu_usage?s.cpuUsage=Number(i.cpu_usage):s.cpuUsage=0,i.mem_usage?s.memUsage=i.mem_usage/(1024*1024*1024):s.memUsage=0,i.mem_total?s.memTotal=i.mem_total/(1024*1024*1024):s.memTotal=0,s.memTotal>0?s.memPercent=Math.round(s.memUsage/s.memTotal*1e4)/100:s.memPercent=0,s.avgMessage=i.avg_message,r[i.key]?(s.cpuUsageFrom=r[i.key].cpuUsage,s.memPercentFrom=r[i.key].memPercent,s.memUsageFrom=r[i.key].memUsage,s.memTotalFrom=r[i.key].memTotal):(s.cpuUsageFrom=0,s.memPercentFrom=0,s.memUsageFrom=0,s.memTotalFrom=0),f.push(s)}u.value=f},h=async()=>{await y(),o.value=!1};return ie(async()=>{u.value=[],n.value=[],o.value=!0,await h(),v=setInterval(()=>{h()},5e3)}),Te(()=>{clearInterval(v)}),(_,r)=>{const m=pl,f=he,p=_e,P=Ie;return D(),K(P,{loading:o.value},{default:l(()=>[t(p,{title:"接口状态",class:"judger-status"},{default:l(()=>[R("div",tr,[(D(!0),ae(oe,null,ke(n.value,c=>(D(),K(p,{key:c.key,header:()=>g(c),class:"judge-status-judger"},{footer:l(()=>[R("span",null," 负载信息："+F(c.avgMessage),1)]),default:l(()=>[t(f,{class:"judge-status-judger"},{default:l(()=>[t(m,{title:"CPU使用率",value:c.cpuUsage,animation:{valueFrom:c.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(m,{title:"内存使用率",value:c.memPercent,animation:{valueFrom:c.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(m,{title:"内存使用量",animation:{valueFrom:c.memUsageFrom,duration:2e3},"animation-start":!0,value:c.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(m,{title:"内存总量",value:c.memTotal,animation:{valueFrom:c.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1}),t(p,{title:"判题机状态",class:"judger-status"},{default:l(()=>[R("div",ar,[(D(!0),ae(oe,null,ke(u.value,c=>(D(),K(p,{key:c.key,header:()=>g(c),class:"judge-status-judger"},{footer:l(()=>[R("span",null," 负载信息："+F(c.avgMessage),1)]),default:l(()=>[t(f,{class:"judge-status-judger"},{default:l(()=>[t(m,{title:"CPU使用率",value:c.cpuUsage,animation:{valueFrom:c.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(m,{title:"内存使用率",value:c.memPercent,animation:{valueFrom:c.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(m,{title:"内存使用量",animation:{valueFrom:c.memUsageFrom,duration:2e3},"animation-start":!0,value:c.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(m,{title:"内存总量",value:c.memTotal,animation:{valueFrom:c.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1})]),_:1},8,["loading"])}}}),or=ue(nr,[["__scopeId","data-v-d2b0a05b"]]),sr=re({__name:"ManageJudge",setup(e){const{globalProperties:a}=de(),n=d(!1),u=d(!1),o=d({problemId:"",language:void 0,status:void 0}),v=d(!1),g=d([]);g.value=Ut();const y=d([]);y.value=ha();const h=async()=>{n.value=!0;try{const m=await Hl();if(m.code!==0){O(a,m.code);return}fe(a,"重判成功"),await Q.push({name:"judge-list"})}catch(m){console.error(m),O(a,"重判失败")}finally{n.value=!1}},_=async()=>{if(!o.value.problemId&&!o.value.language&&!o.value.status){O(a,"请输入问题Id");return}v.value=!0;try{const m=await Bl(o.value.problemId,o.value.language,o.value.status);if(m.code!==0){O(a,m.code);return}fe(a,"重判成功"),await Q.push({name:"judge-list",query:{problem_id:o.value.problemId,language:o.value.language}})}catch(m){console.error(m),O(a,"重判失败")}finally{v.value=!1}},r=async()=>{u.value=!0;try{const m=await Wl();if(m.code!==0){O(a,m.code);return}fe(a,"重判成功"),await Q.push({name:"judge-list"})}catch(m){console.error(m),O(a,"重判失败")}finally{u.value=!1}};return(m,f)=>{const p=J,P=_e,c=$e,C=ze,k=zt,w=ut,i=he,s=je;return D(),ae(oe,null,[t(P,{class:"yj-manage-card",title:"重判最近提交"},{default:l(()=>[t(p,{onClick:h,loading:n.value},{default:l(()=>f[3]||(f[3]=[T("重判")])),_:1},8,["loading"])]),_:1}),t(P,{class:"yj-manage-card",title:"重判指定记录"},{default:l(()=>[t(s,{layout:"inline",onSubmit:_},{default:l(()=>[t(C,{label:"题号"},{default:l(()=>[t(c,{modelValue:o.value.problemId,"onUpdate:modelValue":f[0]||(f[0]=I=>o.value.problemId=I),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(C,{label:"语言"},{default:l(()=>[t(w,{modelValue:o.value.language,"onUpdate:modelValue":f[1]||(f[1]=I=>o.value.language=I),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:l(()=>[(D(!0),ae(oe,null,ke(g.value,I=>(D(),K(k,{key:I.value,value:I.value,label:I.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(C,{label:"状态"},{default:l(()=>[t(w,{modelValue:o.value.status,"onUpdate:modelValue":f[2]||(f[2]=I=>o.value.status=I),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:l(()=>[(D(!0),ae(oe,null,ke(y.value,I=>(D(),K(k,{key:I.value,value:I.value,label:I.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(C,null,{default:l(()=>[t(i,null,{default:l(()=>[t(p,{theme:"primary",type:"submit",loading:v.value},{default:l(()=>f[4]||(f[4]=[T("重判")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(P,{class:"yj-manage-card",title:"重判所有"},{default:l(()=>[t(p,{onClick:r,theme:"danger",loading:u.value},{default:l(()=>f[5]||(f[5]=[T("重判")])),_:1},8,["loading"])]),_:1})],64)}}}),rr=ue(sr,[["__scopeId","data-v-6d48cbf2"]]),ur=re({__name:"ManageWeb",setup(e){const{globalProperties:a}=de(),n=d({theme:"",content:""}),u=d({title:"",content:""}),o=d(!1),v=d(!1),g=d(!1);let y=null;const h=async()=>{v.value=!0;try{const f=await $l(n.value.theme,n.value.content);if(f.code!==0){O(a,f.code);return}fe(a,"保存成功")}catch(f){console.error(f),O(a,"保存失败")}finally{v.value=!1}},_=async()=>{g.value=!0;try{if(!y){O(a,"编辑器未初始化");return}const f=y.getValue(),p=await Ul(u.value.title,f);if(p.code!==0){O(a,p.code);return}y.setValue(p.data.content),fe(a,"保存成功")}catch(f){console.error(f),pe(a,"保存失败")}finally{g.value=!1}},r=async()=>{n.value=await fa()},m=async()=>{try{u.value=await va()}catch{pe(a,"加载公告失败"),u.value={title:"",content:""}}const f={after:()=>{y==null||y.setValue(u.value.content)},upload:{accept:"image/*,.mp3, .wav, .rar",filename(p){return p.replace(/[^(a-zA-Z0-9\u4e00-\u9fa5\.)]/g,"").replace(/[\?\\/:|<>\*\[\]\(\)\$%\{\}@~]/g,"").replace("/\\s/g","")},async handler(p){return po(y,p,a,zl)}},preview:{math:{inlineDigit:!0,engine:"KaTeX"}}};y=new ge("problemEditDiv",f)};return ie(async()=>{o.value=!0;try{await r(),await m()}catch{pe(a,"加载数据失败")}o.value=!1}),(f,p)=>{const P=ut,c=ze,C=$e,k=J,w=he,i=je,s=_e,I=Ie;return D(),K(I,{loading:o.value},{default:l(()=>[t(s,{class:"yj-manage-card",title:"站点通知"},{default:l(()=>[t(i,{onSubmit:h},{default:l(()=>[t(c,{label:"主题"},{default:l(()=>[t(P,{modelValue:n.value.theme,"onUpdate:modelValue":p[0]||(p[0]=b=>n.value.theme=b),options:[{label:"success",value:"success"},{label:"info",value:"info"},{label:"warning",value:"warning"},{label:"error",value:"error"}],placeholder:"请选择主题"},null,8,["modelValue"])]),_:1}),t(c,{label:"内容"},{default:l(()=>[t(C,{modelValue:n.value.content,"onUpdate:modelValue":p[1]||(p[1]=b=>n.value.content=b),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),t(c,null,{default:l(()=>[t(w,null,{default:l(()=>[t(k,{theme:"primary",type:"submit",loading:v.value},{default:l(()=>p[3]||(p[3]=[T("保存")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(s,{class:"yj-manage-card",title:"首页公告"},{actions:l(()=>[t(k,{theme:"primary",loading:g.value,onClick:_},{default:l(()=>p[4]||(p[4]=[T("保存")])),_:1},8,["loading"])]),default:l(()=>[t(i,{onSubmit:_},{default:l(()=>[t(c,{label:"标题"},{default:l(()=>[t(C,{modelValue:u.value.title,"onUpdate:modelValue":p[2]||(p[2]=b=>u.value.title=b),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1}),p[5]||(p[5]=R("div",{id:"problemEditDiv",class:"dida-description-editor"},null,-1))]),_:1})]),_:1},8,["loading"])}}}),ir=ue(ur,[["__scopeId","data-v-c0322fca"]]),La=[{name:"problem-list",tab:"problem",sidebar:"problem-list",path:"",title:"问题列表",icon:"list",component:Nn},{name:"problem-detail",tab:"problem",sidebar:"problem-list",path:":problemId+",title:"问题详情",icon:"list",component:Gt},{name:"problem-recommend",tab:"problem",sidebar:"problem-recommend",path:"recommend/:problemId*",title:"问题推荐",icon:"cpu",needLogin:!0,component:mo},{name:"problem-collection-list",tab:"problem",sidebar:"problem-collection-list",path:"collection",title:"题目集合",icon:"list",disableTabPath:!0,component:$o},{name:"collection-detail",tab:"collection-detail-tab",sidebar:"collection-detail",path:":collectionId+",title:"题集详情",icon:"cpu",component:qo},{name:"collection-rank",tab:"collection-detail-tab",sidebar:"collection-rank",path:":collectionId+/rank",title:"题集排名",icon:"list",component:Ko},{name:"collection-edit",tab:"collection-detail-tab",sidebar:"collection-edit",disableSidebar:!0,needLogin:!0,path:":collectionId+/edit",title:"题集编辑",icon:"list",component:Ht},{name:"collection-create",tab:"collection-detail-tab",sidebar:"collection-create",needLogin:!0,disableSidebar:!0,path:"create",title:"新建题集",icon:"list",component:Ht},{name:"judge-list",tab:"judge",sidebar:"judge-list",path:"",title:"评测列表",icon:"list",component:Wt},{name:"judge-detail",tab:"judge",sidebar:"judge-list",path:":judgeId+",title:"评测详情",icon:"cpu",component:Xt},{name:"contest-list",tab:"contest",sidebar:"contest-list",path:"",title:"比赛列表",icon:"list",component:Yt},{name:"contest-recent",tab:"contest",sidebar:"contest-recent",path:"recent",title:"近期比赛",icon:"list",component:Yt},{name:"contest-create",tab:"contest",sidebar:"contest-create",disableSidebar:!0,needLogin:!0,path:"create",title:"新建比赛",icon:"list",component:Qt},{name:"contest-edit",tab:"contest-detail-tab",sidebar:"contest-edit",disableSidebar:!0,needLogin:!0,path:":contestId+/edit",title:"比赛编辑",icon:"list",component:Qt},{name:"contest-detail",tab:"contest-detail-tab",sidebar:"contest-detail",path:":contestId+",title:"比赛详情",icon:"cpu",component:fs},{name:"contest-problem-detail",tab:"contest-detail-tab",sidebar:"contest-problem-detail",path:":contestId+/problem/:problemIndex+",title:"问题详情",icon:"cpu",disableSidebar:!0,component:Gt},{name:"contest-judge",tab:"contest-detail-tab",sidebar:"contest-judge",path:":contestId+/judge",title:"评测列表",icon:"list",component:Wt},{name:"contest-judge-detail",tab:"contest-detail-tab",sidebar:"contest-judge-detail",path:":contestId+/judge/:judgeId+",title:"评测详情",icon:"cpu",component:Xt,disableSidebar:!0},{name:"contest-rank",tab:"contest-detail-tab",sidebar:"contest-rank",path:":contestId+/rank",title:"比赛排名",icon:"list",component:ys},{name:"contest-discuss",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss",title:"比赛讨论",icon:"list",component:ft},{name:"contest-discuss-detail",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss/:discussId+",title:"讨论详情",icon:"list",component:It},{name:"discuss-list",tab:"discuss",sidebar:"discuss-list",path:"",title:"讨论列表",icon:"list",component:ft},{name:"discuss-list-problem",tab:"discuss",sidebar:"discuss-list-problem",path:"problem",title:"问题讨论",icon:"list",component:ft},{name:"discuss-list-judge",tab:"discuss",sidebar:"discuss-list-judge",path:"judge",title:"评测讨论",icon:"list",component:ft},{name:"discuss-detail",tab:"discuss",sidebar:"discuss-list",path:":discussId+",title:"讨论详情",icon:"list",component:It},{name:"rank-ac-all",tab:"rank",sidebar:"rank-ac-all",path:"ac",title:"AC排名",icon:"base-station",props:{type:"all"},component:nt},{name:"rank-ac-problem",tab:"rank",sidebar:"rank-ac-problem",path:"ac/problem",title:"题量排名",icon:"base-station",props:{type:"problem"},component:nt},{name:"rank-ac-problem-today",tab:"rank",sidebar:"rank-ac-problem-today",path:"ac/problem/today",title:"今日题量",icon:"base-station",props:{type:"problem-today"},component:nt},{name:"rank-ac-problem-day7",tab:"rank",sidebar:"rank-ac-problem-day7",path:"ac/problem/day7",title:"7日题量",icon:"base-station",props:{type:"problem-day7"},component:nt},{name:"rank-ac-problem-day30",tab:"rank",sidebar:"rank-ac-problem-day30",path:"ac/problem/day30",title:"30日题量",icon:"base-station",props:{type:"problem-day30"},component:nt},{name:"rank-ac-problem-year",tab:"rank",sidebar:"rank-ac-problem-year",path:"ac/problem/year",title:"1年题量",icon:"base-station",props:{type:"problem-year"},component:nt},{name:"system-status",tab:"system",sidebar:"system-status",path:"",title:"运行状态",icon:"base-station",component:or},{name:"system-about",tab:"system",sidebar:"system-about",path:"about",title:"关于",icon:"base-station",props:{discussId:"52"},component:It},{name:"manage-problem-create",tab:"manage",sidebar:"manage-problem-create",disableSidebar:!0,path:"problem",title:"新建问题",icon:"list",component:Ot,auths:[Re.ManageProblem]},{name:"manage-problem",tab:"manage",sidebar:"manage-problem",disableSidebar:!0,path:"problem/:problemId+",title:"问题编辑",icon:"list",component:Ot,auths:[Re.ManageProblem]},{name:"manage-problem-judge",tab:"manage",sidebar:"manage-problem-judge",disableSidebar:!0,path:"problem/:problemId+/judge",title:"评测数据",icon:"list",component:Co,auths:[Re.ManageProblem]},{name:"manage-web",tab:"manage",path:"web",sidebar:"manage-web",title:"站点管理",icon:"list",auths:[Re.ManageWeb],component:ir},{name:"manage-judge",tab:"manage",path:"judge",sidebar:"manage-judge",title:"评测管理",icon:"list",auths:["i-manage-judge"],component:rr},{name:"login-forget",tab:"login",path:"forget",title:"忘记密码",component:er}],ea=(e,a,n,u)=>{u.tab==n&&(u.disableSidebar&&a!=u.sidebar||u.sidebar==null||u.sidebar!=u.name||e.push({name:u.name,title:u.title,icon:u.icon,to:{name:u.name}}))},cr=(e,a)=>{const n=[];return La.forEach(u=>{if(ka(u)){const o=[];u.children.forEach(v=>{ea(o,e,a,v)}),o.length>0&&n.push({title:u.title,children:o})}else ea(n,e,a,u)}),n},ta=(e,a)=>{const n=Pn(a.tab),u={name:a.name,path:"/"+a.path,meta:{title:a.title+" - "+n.title,tab:a.tab,sidebar:a.sidebar,showSidebar:n.showSidebar,needLogin:n.needLogin||a.needLogin,tabAuths:n.auths,auths:a.auths},props:a.props,component:a.component};!n.disablePath&&!a.disableTabPath&&(u.path=n.path+u.path),e.push(u)},dr=e=>{La.forEach(a=>{ka(a)?a.children.forEach(n=>{ta(e,n)}):ta(e,a)})},mr={class:"sh-main"},pr=re({__name:"View403",setup(e){let a=ye();const n=d("");return ie(()=>{a.query.target?n.value=a.query.target:n.value=a.fullPath}),(u,o)=>{const v=J;return D(),ae("div",mr,[R("p",null,F(n.value),1),o[2]||(o[2]=R("p",null,"该页面无访问权限，请更换访问目标或重新登陆后再试",-1)),t(v,{theme:"primary",onClick:o[0]||(o[0]=()=>u.$router.push("/"))},{default:l(()=>o[1]||(o[1]=[T("返回首页")])),_:1})])}}}),ja=ue(pr,[["__scopeId","data-v-777362b3"]]),dt=[];xn(dt);dr(dt);dt.push({path:"/403",name:"403",component:ja});dt.push({path:"/:pathMatch(.*)*",name:"404",component:wa});const Q=Ha({history:Ba("/"),routes:dt});Q.beforeEach((e,a,n)=>{if(e.name==null||!Q.hasRoute(e.name)){n({name:"home"});return}const u=e.matched[e.matched.length-1].meta;if(u.redirect){n({name:u.redirect});return}if(u.needLogin){const v=De();if(v.getToken==null||v.getToken==""){n({name:"login",query:{redirect_uri:e.fullPath}});return}}const o=u.tabAuths;if(o&&!De().hasAllAuths(o)){n({name:"403",query:{target:e.fullPath}});return}n()});Q.afterEach((e,a)=>{if(e.name===a.name)return;const n=Ct(),u=Ke();let o=null;if(e.matched.length>0&&(o=e.matched[e.matched.length-1].meta),o!=null&&o.title&&u.setTitle(o==null?void 0:o.title),o!=null&&o.showSidebar){n.setSidebarShow(!0);const v=cr(o==null?void 0:o.sidebar,o==null?void 0:o.tab);n.setMenuList(v),n.setMenuActiveName(o==null?void 0:o.sidebar)}else n.setSidebarShow(!1)});const za=rt("login",{state:()=>({Loaded:!1}),getters:{isLoaded(){return this.Loaded}}}),fr=re({__name:"HeaderContent",setup(e){const a=za(),n=De(),{globalProperties:u}=de(),o=d(a.isLoaded),v=d(!1),g=d(n.getUsername),y=d(n.getNickname),h=d(),_=()=>{h.value=Tn(n)};a.$subscribe((f,p)=>{o.value=p.Loaded}),n.$subscribe((f,p)=>{g.value=p.username,y.value=p.nickname,v.value=p.token!="",_()});const r=()=>{u.$router.currentRoute.value.name!=="login"&&u.$router.push({name:"login",query:{redirect_uri:u.$router.currentRoute.value.fullPath}})},m=()=>{n.clear(),u.$message.success({duration:3e3,content:"注销成功"}),u.$router.push({path:"/login",query:{redirect_uri:u.$router.currentRoute.value.fullPath}})};return ie(()=>{_()}),(f,p)=>{const P=oa("router-link"),c=pa,C=ma,k=fl,w=vl;return D(),K(w,{modelValue:f.$route.meta.tab,"onUpdate:modelValue":p[0]||(p[0]=i=>f.$route.meta.tab=i),class:"sh-menu","expand-type":"popup"},{logo:l(()=>[t(P,{to:"/",class:"sh-logo"},{default:l(()=>p[1]||(p[1]=[T("DidaOJ")])),_:1})]),operations:l(()=>[o.value&&v.value?(D(),K(k,{key:0,title:y.value},{icon:l(()=>[t(c,{name:"user"})]),default:l(()=>[t(C,{value:"user",to:{path:"/user/"+g.value}},{default:l(()=>p[2]||(p[2]=[T("个人空间")])),_:1},8,["to"]),t(C,{value:"user_logout",onClick:m},{default:l(()=>p[3]||(p[3]=[T(" 注销")])),_:1})]),_:1},8,["title"])):o.value?(D(),K(C,{key:2,value:"login",onClick:r},{icon:l(()=>[t(c,{name:"login"})]),default:l(()=>[p[5]||(p[5]=T(" 登录 "))]),_:1})):(D(),K(C,{key:1,value:"login"},{icon:l(()=>[t(c,{name:"login"})]),default:l(()=>[p[4]||(p[4]=T(" ... "))]),_:1}))]),default:l(()=>[(D(!0),ae(oe,null,ke(h.value,i=>(D(),K(C,{key:i.name,value:i.name,to:{name:i.name}},{icon:l(()=>[i.icon?(D(),K(c,{key:0,name:i.icon},null,8,["name"])):le("",!0)]),default:l(()=>[T(" "+F(i.title),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])}}}),vr=ue(fr,[["__scopeId","data-v-c64d812f"]]),_r={id:"menu-container"},gr=re({__name:"SidebarContent",setup(e){const a=Ct(),n=d(!1),u=d(null),o=d(a.menuActiveName),v=d(a.menuList),g=d([]),y=d(!1),h=()=>{o.value=a.menuActiveName;const r=JSON.stringify(v.value),m=JSON.stringify(a.menuList);r!==m&&(g.value.push([...a.menuList]),_())},_=async()=>{if(g.value.length>0&&!y.value){for(y.value=!0;g.value.length>1;)g.value.shift();const r=g.value.shift();n.value=r.length<=0,v.value=[],await qe(),u.value&&u.value.updateActiveName(),await new Promise(f=>setTimeout(f,300)),v.value=r,await qe(),u.value&&u.value.updateActiveName();const m=300;await new Promise(f=>setTimeout(f,m)),y.value=!1,await _()}};return a.$subscribe((r,m)=>{h()}),ie(()=>{h()}),(r,m)=>{const f=pa,p=ma,P=gl,c=_l,C=Ie;return D(),ae(oe,null,[R("div",_r,[t(c,{modelValue:o.value,"onUpdate:modelValue":m[0]||(m[0]=k=>o.value=k),theme:"light",class:"sh-menu-container"},{default:l(()=>[t(Wa,{name:"move-left"},{default:l(()=>[(D(!0),ae(oe,null,ke(v.value,(k,w)=>(D(),ae(oe,{key:w},[ce(Vn)(k)?(D(),K(P,{key:0,title:k.title},{default:l(()=>[(D(!0),ae(oe,null,ke(k.children,(i,s)=>(D(),K(p,{key:i.name,value:i.name,to:i.to},Kt({default:l(()=>[T(" "+F(i.title),1)]),_:2},[i.icon?{name:"icon",fn:l(()=>[t(f,{name:i.icon,class:Vt(i.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))),128))]),_:2},1032,["title"])):(D(),K(p,{key:k.name,value:k.name,to:k.to},Kt({default:l(()=>[T(" "+F(k.title),1)]),_:2},[k.icon?{name:"icon",fn:l(()=>[t(f,{name:k.icon,class:Vt(k.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),t(C,{size:"small",loading:n.value,"show-overlay":!0,attach:"#menu-container",class:"sh-sidebar-loading",style:{"align-items":"flex-start","padding-top":"100px"}},null,8,["loading"])],64)}}}),br=ue(gr,[["__scopeId","data-v-96e2d89f"]]),hr={};function yr(e,a){return null}const wr=ue(hr,[["render",yr]]),kr={class:"footer"},Cr={class:"footer-left"},Sr={class:"foot-time"},Ir={class:"footer-center"},Pr={href:"https://beiancx.miit.gov.cn/",target:"_blank"},Tr={class:"footer-right"},xr={class:"foot-text"},Vr={href:"https://github.com/hpu-developer/DiDaOJ-web",target:"_blank"},Dr={class:"foot-text"},Lr={href:"https://github.com/hpu-developer/DiDaOJ-go",target:"_blank"},jr=re({__name:"FooterContent",setup(e){const a=d("");function n(){a.value=new Date().toLocaleString()}return ie(()=>{n(),setInterval(()=>{n()},1e3)}),(u,o)=>{const v=J;return D(),ae("div",kr,[R("div",Cr,[R("p",Sr,F(a.value),1)]),R("div",Ir,[R("a",Pr,[t(v,{theme:"default",variant:"outline",ghost:!0},{default:l(()=>o[0]||(o[0]=[T("豫ICP备15024677号-4")])),_:1})])]),R("div",Tr,[R("p",xr,[R("a",Vr,[t(v,{theme:"default",variant:"outline",ghost:!0},{default:l(()=>o[1]||(o[1]=[T("@didaoj-web")])),_:1})])]),R("p",Dr,[R("a",Lr,[t(v,{theme:"default",variant:"outline",ghost:!0},{default:l(()=>o[2]||(o[2]=[T("@didaoj-go")])),_:1})])])])])}}}),zr=ue(jr,[["__scopeId","data-v-979fed79"]]),vt=20,Tt=100,xt=50,$r=re({__name:"ForceHiddenSidebarButton",setup(e){let a=Ct();const n=d({x:window.innerWidth-Tt-vt,y:window.innerHeight-xt-vt}),u=d(window.innerWidth),o=d(window.innerHeight);let v=!1,g={x:0,y:0};const y=k=>{v=!0;const w=k.clientX??k.touches[0].clientX,i=k.clientY??k.touches[0].clientY;g={x:w-n.value.x,y:i-n.value.y},document.addEventListener("mousemove",h),document.addEventListener("touchmove",h),document.addEventListener("mouseup",_),document.addEventListener("touchend",_)},h=k=>{if(!v)return;const w=k.clientX??k.touches[0].clientX,i=k.clientY??k.touches[0].clientY;let s=w-g.x,I=i-g.y;s=Math.max(0,Math.min(s,u.value-Tt)),I=Math.max(0,Math.min(I,o.value-xt)),n.value={x:s,y:I}},_=()=>{v=!1,document.removeEventListener("mousemove",h),document.removeEventListener("touchmove",h),document.removeEventListener("mouseup",_),document.removeEventListener("touchend",_)},r=()=>{u.value=window.innerWidth,o.value=window.innerHeight,n.value={x:Math.min(n.value.x,u.value-Tt-vt),y:Math.min(n.value.y,o.value-xt-vt)}};let m=d(a.forceHiddenSidebar),f=d(a.forceHiddenSidebar);const p=()=>{m.value=!m.value,a.setForceHiddenSidebar(m.value)},P=()=>{f.value||(f.value=!0,a.setForceHiddenSidebar(m.value))},c=()=>{f.value&&(f.value=!1,a.setForceHiddenSidebar(!1))},C=k=>{k>=800?c():P()};return C(u.value),Le(u,k=>{C(k)}),ie(()=>{window.addEventListener("resize",r)}),Te(()=>{window.removeEventListener("resize",r)}),(k,w)=>{const i=J;return ce(f)?(D(),K(i,{key:0,class:"draggable-button",style:la({top:`${n.value.y}px`,left:`${n.value.x}px`}),onMousedown:y,onTouchstart:y,variant:"dashed",theme:"primary",onClick:p},{default:l(()=>[T(F(ce(m)?"显示":"隐藏"),1)]),_:1},8,["style"])):le("",!0)}}}),Ur=ue($r,[["__scopeId","data-v-1aee5506"]]),_t="DidaOJ",Ar=re({__name:"App",setup(e){const{globalProperties:a}=de(),n=za(),u=De(),o=Ke(),v=Ct();n.$patch({Loaded:!1});const g=u.getToken,y=d(!1),h=d(!1);o.title&&o.title.length>0?document.title=o.title+" - "+_t:document.title=_t,o.$subscribe((f,p)=>{p.title&&p.title.length>0?document.title=p.title+" - "+_t:document.title=_t}),v.$subscribe((f,p)=>{y.value=p.showSidebar,h.value=y.value&&!p.forceHiddenSidebar});const _=ye(),r=Fe(()=>{const f=_.meta.auths;return f?!u.hasAllAuths(f):!1});function m(){a.$message.warning({duration:3e3,content:"登陆状态失效"}),n.$patch({Loaded:!0}),u.clear()}return ie(()=>{document.addEventListener("DOMContentLoaded",()=>{Ja.autoSpacingPage()}),g?on().then(f=>{f.code==0?(u.loadResponse(f.data),n.$patch({Loaded:!0})):(O(a,f.code),n.$patch({Loaded:!0}),u.clear())}).catch(f=>{console.log(f),m()}):n.$patch({Loaded:!0})}),(f,p)=>{const P=bl,c=yl,C=oa("RouterView"),k=wl,w=hl,i=kl;return D(),ae(oe,null,[t(w,null,{default:l(()=>[t(P,{class:"sh-header"},{default:l(()=>[t(vr)]),_:1}),t(w,null,{default:l(()=>[t(Xa,{name:"slide"},{default:l(()=>[h.value?(D(),K(c,{key:0,class:"sh-sidebar"},{default:l(()=>[t(br)]),_:1})):le("",!0)]),_:1}),t(w,{class:Vt(["sh-main-layout",{expanded:!h.value}])},{default:l(()=>[t(wr),t(k,{class:"sh-main-content"},{default:l(()=>[r.value?(D(),K(ja,{key:0})):(D(),K(C,{key:1}))]),_:1}),t(zr)]),_:1},8,["class"])]),_:1})]),_:1}),y.value?(D(),K(Ur,{key:0})):le("",!0),t(i,{container:"body",offset:["24px","80px"],size:"small"})],64)}}}),Rr=ue(Ar,[["__scopeId","data-v-2169b8cd"]]);Sl.registerLanguage("verilog",Il);const $a=Ya();$a.use(Za);const mt=Qa(Rr);mt.use($a);mt.use(Q);mt.use(Cl);mt.use(el);mt.mount("#app");Al().then(()=>{console.log("Text cache reinitialized")}).catch(e=>{console.error("Text cache reinitialization failed",e)});
