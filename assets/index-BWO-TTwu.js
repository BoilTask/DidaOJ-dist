import{bm as st,bn as Rt,n as ae,r as p,o as ne,G as Et,bo as X,bp as L,s as t,bq as l,br as E,F as Q,bs as de,bt as M,bu as K,ap as x,u as Me,bv as le,bw as pe,aD as me,g as fa,bx as _a,by as va,bz as ga,J as Se,q as Le,bA as ba,bB as Ue,c as Re,y as Ve,bC as Xe,bD as pt,ac as ha,bE as Kt,bF as ya,bG as wa,bH as qt,aM as ka,bI as ft,a0 as Ca,bJ as Sa,bK as Ia,B as Pa,bL as xa}from"./node_modules-x_y3cvPb.js";import{L as Ce,C as se,S as ve,a as Ta,T as Fe,b as be,A as gt,c as ja,d as La,e as Va,f as Da,g as Ne,R as ge,B as O,F as De,h as ze,I as $e,D as He,i as Mt,j as Ee,k as Ke,l as za,m as Ie,n as rt,o as Ft,O as bt,p as Gt,q as Nt,P as Ot,r as Ht,s as $a,t as Bt,u as Wt,v as Ua,w as Aa,x as Ra,y as Ea,z as Ka,M as Jt,E as Xt,G as qa,H as Ma,J as Fa,K as Ga,N as Na,Q as Oa,U as Ha,V as Ba,W as Wa,X as Ja}from"./tdesign-vue-next-B95E-Rb4.js";import{V as ue}from"./vditor-DArazWIS.js";import{e as St}from"./monaco-editor-BHsDS0An.js";import{H as Xa,v as Ya}from"./highlight.js-D9zWiMxS.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const d of o)if(d.type==="childList")for(const _ of d.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&s(_)}).observe(document,{childList:!0,subtree:!0});function n(o){const d={};return o.integrity&&(d.integrity=o.integrity),o.referrerPolicy&&(d.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?d.credentials="include":o.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function s(o){if(o.ep)return;o.ep=!0;const d=n(o);fetch(o.href,d)}})();var je=(e=>(e.Manage="i-manage",e.ManageJudge="i-manage-judge",e.ManageProblem="i-manage-problem",e.ManageContest="i-manage-contest",e.ManageCollection="i-manage-collection",e))(je||{});const Za={"r-admin":["i-manage","i-manage-judge","i-manage-problem","i-manage-contest","i-manage-collection"]};function Qa(e){if(e==null)return[];const a=[];for(const n of e){const s=Za[n];s!=null&&a.push(...s)}return[...new Set(a)]}function el(e,a){if(e==null||a==null)return!1;const n=Qa(e);for(const s of a)if(!n.includes(s))return!1;return!0}const xe=st("user",{state:()=>({token:"",userId:-1,username:"",nickname:"",roles:[]}),getters:{getToken(){return this.token},getUserId(){return this.userId},getUsername(){return this.username},getNickname(){return this.nickname}},actions:{clear(){this.$patch({token:"",userId:-1,username:"",nickname:"",roles:[]})},loadResponse(e){this.$patch({token:e.token,userId:e.user_id,username:e.username,nickname:e.nickname,roles:e.roles})},isLogin(){return this.token!=null&&this.token!=""},hasAuth(e){return this.hasAllAuths([e])},hasAllAuths(e){return e?el(this.roles,e):!0}},persist:!0}),Ae=st("webStyle",{state:()=>({title:""}),getters:{getTitle(){return this.title}},actions:{setTitle(e){this.title=e}}}),ut=st("sidebarStyle",{state:()=>({showSidebar:!1,forceHiddenSidebar:!1,menuActiveName:"",menuList:[]}),getters:{getMenuList(){return this.menuList}},actions:{setSidebarShow(e){this.showSidebar=e},setForceHiddenSidebar(e){this.forceHiddenSidebar=e},setMenuActiveName(e){this.menuActiveName=e},clearMenuList(){this.menuList=[]},setMenuList(e){this.menuList=e},addMenuList(e){this.menuList.push(e)}}}),Be=Rt.create({timeout:6e4,withCredentials:!1,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});Be.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function tl(){return Be({baseURL:"https://r2-oj.didapipa.com",url:"/system/notification.json?"+Date.now(),method:"get"})}function al(){return Be({baseURL:"https://r2-oj.didapipa.com",url:"/status/judger.json?"+Date.now(),method:"get"})}function Yt(e){return Be({baseURL:"https://r2-oj.didapipa.com",url:"/status/judger/"+e+".json?"+Date.now(),method:"get"})}function ll(e){return Be({baseURL:"https://r2-oj.didapipa.com",url:"/status/web.json?"+Date.now(),method:"get"})}const nl={class:"judger-status-panel"},ol={class:"judger-status-panel"};function sl(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Me(e)}const rl=ae({__name:"SystemStatus",setup(e){const a=p([]),n=p([]),s=p(!1),o=p(!1);let d;const _=b=>{let r="失效",u="danger";const g=new Date,k=new Date(b.updateTime);return g.getTime()-k.getTime()>3e4?(r="离线",u="default"):b.cpuUsage>90?(r="CPU过高",u="warning"):b.memPercent>90?(r="内存过高",u="warning"):(r="在线",u="success"),t(ve,null,{default:()=>[t("span",null,[b.key,x(" - "),b.name]),t("span",null,[b.updateTime]),t(Fe,{theme:u,size:"small"},sl(r)?r:{default:()=>[r]})]})},P=async()=>{const b=[{key:"didaoj",name:"DidaOj"}],r={};for(let g=0;g<a.value.length;g++){const k=a.value[g];r[k.key]=k}const u=[];for(let g=0;g<b.length;g++){const k=b[g],m={key:k.key},c=await ll(k.key);c&&(c.name?m.name=c.name:m.name="-",c.update_time?m.updateTime=new Date(c.update_time).toLocaleString():m.updateTime="-",c.cpu_usage?m.cpuUsage=Number(c.cpu_usage):m.cpuUsage=0,c.mem_usage?m.memUsage=c.mem_usage/(1024*1024*1024):m.memUsage=0,c.mem_total?m.memTotal=c.mem_total/(1024*1024*1024):m.memTotal=0,m.memTotal>0?m.memPercent=Math.round(m.memUsage/m.memTotal*1e4)/100:m.memPercent=0,m.avgMessage=c.avg_message,r[k.key]?(m.cpuUsageFrom=r[k.key].cpuUsage,m.memPercentFrom=r[k.key].memPercent,m.memUsageFrom=r[k.key].memUsage,m.memTotalFrom=r[k.key].memTotal):(m.cpuUsageFrom=0,m.memPercentFrom=0,m.memUsageFrom=0,m.memTotalFrom=0),u.push(m))}a.value=u},I=async()=>{const b=await al(),r={};for(let g=0;g<n.value.length;g++){const k=n.value[g];r[k.key]=k}const u=[];for(let g=0;g<b.judgers.length;g++){const k=b.judgers[g],m={key:k.key,name:k.name},c=await Yt(k.key);c&&(c.name?m.name=c.name:m.name="-",c.update_time?m.updateTime=new Date(c.update_time).toLocaleString():m.updateTime="-",c.cpu_usage?m.cpuUsage=Number(c.cpu_usage):m.cpuUsage=0,c.mem_usage?m.memUsage=c.mem_usage/(1024*1024*1024):m.memUsage=0,c.mem_total?m.memTotal=c.mem_total/(1024*1024*1024):m.memTotal=0,m.memTotal>0?m.memPercent=Math.round(m.memUsage/m.memTotal*1e4)/100:m.memPercent=0,m.avgMessage=c.avg_message,r[k.key]?(m.cpuUsageFrom=r[k.key].cpuUsage,m.memPercentFrom=r[k.key].memPercent,m.memUsageFrom=r[k.key].memUsage,m.memTotalFrom=r[k.key].memTotal):(m.cpuUsageFrom=0,m.memPercentFrom=0,m.memUsageFrom=0,m.memTotalFrom=0),u.push(m))}n.value=u},y=async()=>{await P(),s.value=!1,await I(),o.value=!1};return ne(async()=>{n.value=[],a.value=[],o.value=!0,s.value=!0,await y(),d=setInterval(()=>{y()},5e3)}),Et(()=>{clearInterval(d)}),(b,r)=>{const u=Ta,g=ve,k=se,m=Ce;return L(),X(Q,null,[t(k,{title:"接口状态",class:"judger-status"},{default:l(()=>[t(m,{loading:s.value},{default:l(()=>[E("div",nl,[(L(!0),X(Q,null,de(a.value,c=>(L(),M(k,{key:c.key,header:()=>_(c),class:"judge-status-judger"},{footer:l(()=>[E("span",null," 负载信息："+K(c.avgMessage),1)]),default:l(()=>[t(g,{class:"judge-status-judger"},{default:l(()=>[t(u,{title:"CPU使用率",value:c.cpuUsage,animation:{valueFrom:c.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(u,{title:"内存使用率",value:c.memPercent,animation:{valueFrom:c.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(u,{title:"内存使用量",animation:{valueFrom:c.memUsageFrom,duration:2e3},"animation-start":!0,value:c.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(u,{title:"内存总量",value:c.memTotal,animation:{valueFrom:c.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1},8,["loading"])]),_:1}),t(k,{title:"判题机状态",class:"judger-status"},{default:l(()=>[t(m,{loading:o.value},{default:l(()=>[E("div",ol,[(L(!0),X(Q,null,de(n.value,c=>(L(),M(k,{key:c.key,header:()=>_(c),class:"judge-status-judger"},{footer:l(()=>[E("span",null," 负载信息："+K(c.avgMessage),1)]),default:l(()=>[t(g,{class:"judge-status-judger"},{default:l(()=>[t(u,{title:"CPU使用率",value:c.cpuUsage,animation:{valueFrom:c.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(u,{title:"内存使用率",value:c.memPercent,animation:{valueFrom:c.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(u,{title:"内存使用量",animation:{valueFrom:c.memUsageFrom,duration:2e3},"animation-start":!0,value:c.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(u,{title:"内存总量",value:c.memTotal,animation:{valueFrom:c.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1},8,["loading"])]),_:1})],64)}}}),oe=(e,a)=>{const n=e.__vccOpts||e;for(const[s,o]of a)n[s]=o;return n},_t=oe(rl,[["__scopeId","data-v-1fb43cc1"]]),ul={style:{"text-align":"right"}},il=ae({__name:"Hitokoto",setup(e){const a=p(!1),n=p(""),s=p(""),o=p(""),d=async()=>{a.value=!0;try{const P=await(await fetch("https://v1.hitokoto.cn")).json();s.value=P.hitokoto,o.value=P.creator,n.value="—— "+P.from}catch(_){s.value="一言获取失败了，但至少您还可以访问本站。",o.value="BoilTask",n.value="DidaOJ",console.error("Error fetching Hitokoto:",_)}finally{a.value=!1}};return ne(()=>{d()}),(_,P)=>{const I=se,y=Ce;return L(),M(y,{loading:a.value},{default:l(()=>[t(I,{title:"一言 © Hitokoto"},{actions:l(()=>[x(" @"+K(o.value),1)]),default:l(()=>[E("div",null,[E("span",null,K(s.value),1),E("p",ul,K(n.value),1)])]),_:1})]),_:1},8,["loading"])}}}),cl={class:"sh-main"},dl={class:"dida-swiper-div"},ml=ae({__name:"HomeView",setup(e){let a=-1;const n=p(null),s=async()=>{n.value=await tl()};return ne(async()=>{await s(),a=setInterval(()=>{s()},3e4)}),Et(()=>{clearInterval(a)}),(o,d)=>{const _=gt,P=La,I=ja,y=se,b=be,r=Ne,u=Da,g=Va,k=ge;return L(),M(k,null,{default:l(()=>[t(b,{span:8},{default:l(()=>[E("div",cl,[n.value?(L(),M(_,{key:0,style:{margin:"20px"},theme:n.value.theme},{default:l(()=>[x(K(n.value.content),1)]),_:1},8,["theme"])):le("",!0),E("div",dl,[t(I,{class:"dida-swiper"},{default:l(()=>[t(P,null,{default:l(()=>d[0]||(d[0]=[E("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1}),t(P,null,{default:l(()=>d[1]||(d[1]=[E("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1})]),_:1})]),t(y,{title:"正在完善，欢迎提供意见建议",style:{width:"500px",margin:"0 auto"}},{default:l(()=>d[2]||(d[2]=[E("p",null,[E("a",{href:"https://codeoj.cn/",target:"_blank"},"CodeOJ"),x("的迁移计划")],-1),E("p",null,"正在开发中",-1)])),_:1})])]),_:1}),t(b,{span:4},{default:l(()=>[t(il,{style:{margin:"10px"}}),t(_t),t(y,{style:{margin:"10px"},bordered:!0},{header:l(()=>d[3]||(d[3]=[E("b",null,"友情链接",-1)])),default:l(()=>[t(g,null,{default:l(()=>[t(u,null,{default:l(()=>[t(r,{href:"https://boiltask.com",target:"_blank"},{default:l(()=>d[4]||(d[4]=[x("BoilTask Blog")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),pl=oe(ml,[["__scopeId","data-v-aba0b66b"]]),fl={class:"sh-main"},_l=ae({__name:"View404",setup(e){let a=pe(),n=p(a.fullPath);return(s,o)=>{const d=O;return L(),X("div",fl,[E("p",null,K(me(n)),1),o[2]||(o[2]=E("p",null,"该页面无效或已被迁移，请重新选择访问目标",-1)),t(d,{theme:"primary",onClick:o[0]||(o[0]=()=>s.$router.push("/"))},{default:l(()=>o[1]||(o[1]=[x("返回首页")])),_:1})])}}}),Zt=oe(_l,[["__scopeId","data-v-d4218944"]]);let vt=null;async function vl(){vt=await bl()}function gl(e,a="zh"){if(vt==null)return[!1,e.toString()];const n=vt[e.toString()];if(!n)return[!1,e.toString()];let s=n[a];return s||(a="zh",s=n[a]),s?[!0,s]:[!1,e.toString()]}async function bl(){return new Promise((e,a)=>{e({404:{zh:"接口未找到"},1e3:{zh:"系统错误，请重试或等待管理员修复"},1001:{zh:"系统异常，请重试或等待管理员修复"},1002:{zh:"未知错误"},1003:{zh:"操作过于频繁，请稍后重试"},10001:{zh:"权限异常，请重新登陆后再试"},10002:{zh:"参数不符合要求"},10003:{zh:"未找到目标数据"},100001:{zh:"用户名不存在或密码不匹配"},100002:{zh:"邮件发送失败，可能是邮箱无效或达到了每日注册上限，如有问题可联系管理员解决"},100003:{zh:"验证码错误或已过期，请重新获取"},100004:{zh:"注册用户失败，可能存在同名用户"},100005:{zh:"用户名不存在，或您未在本系统绑定邮箱，请联系管理员寻求帮助"},100006:{zh:"验证码错误或已过期，请重新获取"},100007:{zh:"已存在相同标题的题目"}})})}function re(){const{appContext:e}=fa();return{globalProperties:e.config.globalProperties}}function Te(){return 1e3}function Ye(e,a,n=3e3){e.$message.success({duration:n,content:a})}function _e(e,a,n=3e3){e.$message.info({duration:n,content:a})}function ce(e,a,n=3e3){e.$message.error({duration:n,content:a})}function H(e,a,n=3e3){const[s,o]=gl(a),d=s?o:`系统错误，错误提示[${o}]`;e.$message.error({duration:n,content:d})}function hl(e,a){return e.length<=a?e:e.slice(0,a)+"..."}function It(e){return e.trim().split(/\s+/).flatMap(s=>s.split(",")).filter(s=>s.trim()!=="")}const yl="https://oj-api.didapipa.com/",J=Rt.create({baseURL:yl,timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});J.interceptors.request.use(e=>{const n=xe().getToken;return n&&(e.headers["X-Token"]=n),e},e=>Promise.reject(e));J.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function wl(e){const a={};return a.id=e.id,a.username=e.username,a.nickname=e.nickname,a.email=e.email,a.slogan=e.slogan,a.organization=e.organization,a.accept=e.accept,a.attempt=e.attempt,a.vjudgeId=e.vjudge_id,e.email&&(a.avatar=`https://www.gravatar.com/avatar/${_a(e.email.toLowerCase().trim())}?d=identicon&s=100`),a}function kl(e,a){return J({url:"/user/login",method:"post",data:{username:e,password:a}})}function Cl(){return J({url:"/user/login/refresh",method:"post"})}function Sl(e){const a={username:e};return J({url:`/user/info?${new URLSearchParams(a).toString()}`,method:"get"})}function Il(e){const a="https://vjudge.net/user/solveDetail/"+encodeURIComponent(e);return Be({url:a,method:"get"})}function Pl(e){return J({url:"/user/parse",method:"post",data:{users:e}})}function xl(e,a){return J({url:"/user/register/email",method:"post",data:{token:e,email:a}})}function Tl(e,a,n,s,o){return J({url:"/user/register",method:"post",data:{username:e,password:a,email:n,key:s,nickname:o}})}function jl(e,a){return J({url:"/user/forget",method:"post",data:{token:e,username:a}})}function Ll(e,a,n){return J({url:"/user/password/modify",method:"post",data:{username:e,password:a,key:n}})}const Vl={class:"dida-login-footer"},Dl=ae({__name:"LoginView",setup(e){const{globalProperties:a}=re(),n=xe(),s=p(!1),o=p({username:"",password:""}),d=()=>{_e(a,"重置成功")},_=({validateResult:P,firstError:I})=>{s.value||(s.value=!0,kl(o.value.username,o.value.password).then(y=>{if(y.code===0){n.loadResponse(y.data),_e(a,"登录成功");let b=a.$route.query.redirect_uri;b||(b="/user/"+y.data.username),a.$router.push({path:b})}else H(a,y.code)}).catch(y=>{console.error("Login error",y),ce(a,"登录失败")}).finally(()=>{s.value=!1}))};return ne(()=>{if(n.isLogin()){a.$router.push({path:"/user"});return}}),(P,I)=>{const y=$e,b=ze,r=O,u=De,g=Ne,k=se;return L(),M(k,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:l(()=>[t(u,{ref:"form",data:o.value,colon:!0,onReset:d,onSubmit:_,class:"yj-login-form","label-width":0},{default:l(()=>[t(b,{name:"username"},{default:l(()=>[t(y,{modelValue:o.value.username,"onUpdate:modelValue":I[0]||(I[0]=m=>o.value.username=m),clearable:"",placeholder:"请输入用户名"},{"prefix-icon":l(()=>[t(me(va))]),_:1},8,["modelValue"])]),_:1}),t(b,{name:"password"},{default:l(()=>[t(y,{modelValue:o.value.password,"onUpdate:modelValue":I[1]||(I[1]=m=>o.value.password=m),type:"password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":l(()=>[t(me(ga))]),_:1},8,["modelValue"])]),_:1}),t(b,null,{default:l(()=>[t(r,{theme:"primary",type:"submit",block:"",loading:s.value},{default:l(()=>I[4]||(I[4]=[x("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),E("div",Vl,[t(g,{onClick:I[2]||(I[2]=()=>{me(a).$router.push({name:"login-forget"})})},{default:l(()=>I[5]||(I[5]=[x("忘记密码")])),_:1}),t(g,{onClick:I[3]||(I[3]=()=>{me(a).$router.push({name:"register"})})},{default:l(()=>I[6]||(I[6]=[x("注册账户")])),_:1})])]),_:1})}}}),zl=oe(Dl,[["__scopeId","data-v-be6a0deb"]]),$l={class:"dida-login-footer"},Ul=ae({__name:"RegisterView",setup(e){const{globalProperties:a}=re(),n=xe(),s=p(!1),o=p(!1),d=p(!1),_=p("发送验证码");let P=null,I=-1;const y=p(!1),b=p(null),r=p({username:"",password:"",confirmPassword:"",nickname:"",email:"",emailKey:""}),g=p({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:V=>new Promise(R=>{const w=setTimeout(()=>{R(r.value.password===V),clearTimeout(w)})}),message:"两次密码不一致"}],nickname:[{required:!0,message:"请填写昵称"},{min:1,message:"昵称至少1个字符"},{max:30,message:"昵称最多30个字符"}],email:[{required:!0,message:"请填写邮箱"},{pattern:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"邮箱格式不正确"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),k=p(()=>t(O,{onClick:m,disabled:d.value,loading:o.value,style:"width:120px"},{default:()=>[_.value]})),m=async()=>{var f;if(!r.value.email){ce(a,"请输入邮箱");return}if(!r.value.email.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)){ce(a,"邮箱格式不正确");return}if(d.value||o.value)return;y.value=!0,await Le();const V=document.getElementById("cf-confirm-div");V&&V.remove();const R=document.createElement("div");R.id="cf-confirm-div",R.setAttribute("data-theme","light"),(f=b.value)==null||f.appendChild(R);const w=window;w.turnstile.ready(function(){w.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(D){y.value=!1,await c(D)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},c=async V=>{if(!d.value){o.value=!0;try{const R=await xl(V,r.value.email);if(R.code!==0){H(a,R.code);return}_e(a,"发送验证码成功"),o.value=!1,d.value=!0,P=new Date,_.value="60秒后重发",I=setInterval(()=>{const f=Math.floor((new Date().getTime()-(P==null?void 0:P.getTime()))/1e3);f>60?(_.value="发送验证码",d.value=!1,clearInterval(I)):_.value=`${60-f}秒后重发`},1e3)}catch{ce(a,"发送验证码失败")}finally{o.value=!1}}},S=()=>{_e(a,"重置成功")},A=({validateResult:V,firstError:R,e:w})=>{if(!s.value){if(w.preventDefault(),V!==!0){ce(a,R);return}if(r.value.password!==r.value.confirmPassword){ce(a,"两次密码不一致");return}s.value=!0,Tl(r.value.username,r.value.password,r.value.email,r.value.emailKey,r.value.nickname).then(f=>{f.code===0?(_e(a,"注册成功，可使用账号信息登录"),a.$router.push({name:"login"})):H(a,f.code)}).catch(f=>{console.error("Login error",f),ce(a,"登录失败")}).finally(()=>{s.value=!1})}};return ne(()=>{if(n.isLogin()){a.$router.push({path:"/user"});return}}),Se(()=>{clearInterval(I)}),(V,R)=>{const w=$e,f=ze,D=Mt,z=O,j=De,v=Ne,i=se,U=He;return L(),X(Q,null,[t(i,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:l(()=>[t(j,{ref:"form",rules:g.value,data:r.value,colon:!0,onReset:S,onSubmit:A,class:"yj-login-form"},{default:l(()=>[t(f,{name:"username",label:"用户名"},{default:l(()=>[t(w,{modelValue:r.value.username,"onUpdate:modelValue":R[0]||(R[0]=T=>r.value.username=T),clearable:"",placeholder:"用于登录与查找"},null,8,["modelValue"])]),_:1}),t(f,{name:"password",label:"密码"},{default:l(()=>[t(w,{modelValue:r.value.password,"onUpdate:modelValue":R[1]||(R[1]=T=>r.value.password=T),type:"password",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(f,{name:"confirmPassword",label:"确认密码"},{default:l(()=>[t(w,{modelValue:r.value.confirmPassword,"onUpdate:modelValue":R[2]||(R[2]=T=>r.value.confirmPassword=T),type:"password",clearable:"",placeholder:"请确认密码"},null,8,["modelValue"])]),_:1}),t(f,{name:"nickname",label:"昵称"},{default:l(()=>[t(w,{modelValue:r.value.nickname,"onUpdate:modelValue":R[3]||(R[3]=T=>r.value.nickname=T),clearable:"",placeholder:"用于优先在网站各处展示"},null,8,["modelValue"])]),_:1}),t(f,{name:"email",label:"邮箱"},{default:l(()=>[t(w,{modelValue:r.value.email,"onUpdate:modelValue":R[4]||(R[4]=T=>r.value.email=T),clearable:"",placeholder:"请填写常用邮箱"},null,8,["modelValue"])]),_:1}),t(f,{name:"emailKey",label:"验证码"},{default:l(()=>[t(D,{append:k.value},{default:l(()=>[t(w,{modelValue:r.value.emailKey,"onUpdate:modelValue":R[5]||(R[5]=T=>r.value.emailKey=T),clearable:"",placeholder:"请输入验证码",style:{width:"140px"}},null,8,["modelValue"])]),_:1},8,["append"])]),_:1}),t(f,null,{default:l(()=>[t(z,{theme:"primary",type:"submit",block:"",loading:s.value},{default:l(()=>R[8]||(R[8]=[x("注册")])),_:1},8,["loading"])]),_:1})]),_:1},8,["rules","data"]),E("div",$l,[t(v,{onClick:R[6]||(R[6]=()=>{me(a).$router.push({name:"login"})})},{default:l(()=>R[9]||(R[9]=[x("返回登陆 ")])),_:1})])]),_:1}),t(U,{visible:y.value,"onUpdate:visible":R[7]||(R[7]=T=>y.value=T),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:l(()=>[E("div",{ref_key:"dialogContainer",ref:b,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),Al=oe(Ul,[["__scopeId","data-v-9b5f4fc7"]]),Rl={key:0,style:{margin:"10px"}},El={key:1,style:{margin:"10px"}},Kl={style:{margin:"12px"}},ql=ae({__name:"UserView",setup(e){let a=pe();const{globalProperties:n}=re(),s=Ae();let o="";const d=p(!1),_=p(null),P=p([]),I=p([]),y=p([]),b=async r=>{d.value=!0;try{let u=await Sl(r);if(u.code!==0){d.value=!1,H(n,u.code),await B.push({name:"home"});return}if(_.value=wl(u.data.user),P.value=u.data.problems_ac,s.setTitle(_.value.nickname+" - "+s.getTitle),_.value.vjudgeId){const g=await Il(_.value.vjudgeId);I.value=g.acRecords;for(const k in I.value)I.value[k].sort((m,c)=>m.length===c.length?m.localeCompare(c):m.length-c.length);y.value=g.failRecords;for(const k in y.value)y.value[k].sort((m,c)=>m.length===c.length?m.localeCompare(c):m.length-c.length)}}catch{ce(n,"获取用户信息失败"),await B.push({name:"home"})}finally{d.value=!1}};return ba(async(r,u,g)=>{if(Array.isArray(r.params.username)?o=r.params.username[0]:o=r.params.username,!o){await B.push({name:"home"});return}await b(o),g()}),ne(async()=>{if(Array.isArray(a.params.username)?o=a.params.username[0]:o=a.params.username,!o){await B.push({name:"home"});return}await b(o)}),(r,u)=>{const g=O,k=ve,m=se,c=Ne,S=Ke,A=Ee,V=be,R=za,w=ge,f=Ce;return L(),M(f,{loading:d.value},{default:l(()=>[t(w,{class:"dida-main-content"},{default:l(()=>[t(V,{span:8},{default:l(()=>{var D;return[t(m,{style:{margin:"10px"},title:"AC题目"},{default:l(()=>[t(k,{style:{"flex-wrap":"wrap"}},{default:l(()=>[(L(!0),X(Q,null,de(P.value,z=>(L(),M(g,{key:z,size:"small",onClick:()=>me(B).push({name:"problem-detail",params:{problemId:z}})},{default:l(()=>[x(K(z),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),(D=_.value)!=null&&D.vjudgeId?(L(),M(m,{key:0,style:{margin:"10px"},title:"vjudge.net"},{actions:l(()=>{var z;return[t(c,{href:"https://vjudge.net/user/"+((z=_.value)==null?void 0:z.vjudgeId),target:"_blank"},{default:l(()=>{var j;return[x("@"+K((j=_.value)==null?void 0:j.vjudgeId),1)]}),_:1},8,["href"])]}),default:l(()=>[I.value&&Object.keys(I.value).length>0?(L(),X("div",Rl,[u[0]||(u[0]=E("div",{style:{margin:"5px"}},[E("span",null,"AC")],-1)),t(A,{layout:"vertical",bordered:!0},{default:l(()=>[(L(!0),X(Q,null,de(I.value,(z,j)=>(L(),M(S,{key:j,label:j},{default:l(()=>[t(k,{style:{"flex-wrap":"wrap"}},{default:l(()=>[(L(!0),X(Q,null,de(z,v=>(L(),M(g,{key:v,size:"small",onClick:()=>me(B).push({name:"problem-detail",params:{problemId:j+"-"+v}})},{default:l(()=>[x(K(v),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):le("",!0),y.value&&Object.keys(y.value).length>0?(L(),X("div",El,[u[1]||(u[1]=E("div",{style:{margin:"5px"}},[E("span",null,"Fail")],-1)),t(A,{layout:"vertical",bordered:!0},{default:l(()=>[(L(!0),X(Q,null,de(y.value,(z,j)=>(L(),M(S,{key:j,label:j},{default:l(()=>[t(k,{style:{"flex-wrap":"wrap"}},{default:l(()=>[(L(!0),X(Q,null,de(z,v=>(L(),M(g,{key:v,size:"small",onClick:()=>me(B).push({name:"problem-detail",params:{problemId:j+"-"+v}})},{default:l(()=>[x(K(v),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):le("",!0)]),_:1})):le("",!0)]}),_:1}),t(V,{span:4},{default:l(()=>[E("div",Kl,[t(A,{layout:"vertical",bordered:!0},{default:l(()=>[t(S,{label:"头像"},{default:l(()=>{var D;return[t(R,{shape:"round",size:"100px",image:(D=_.value)==null?void 0:D.avatar,"hide-on-load-failed":!1},null,8,["image"])]}),_:1}),t(S,{label:"昵称"},{default:l(()=>{var D;return[x(K((D=_.value)==null?void 0:D.nickname),1)]}),_:1}),t(S,{label:"Slogan"},{default:l(()=>{var D;return[x(K((D=_.value)==null?void 0:D.slogan),1)]}),_:1}),t(S,{label:"邮箱"},{default:l(()=>{var D;return[x(K((D=_.value)==null?void 0:D.email),1)]}),_:1}),t(S,{label:"组织"},{default:l(()=>{var D;return[x(K((D=_.value)==null?void 0:D.organization),1)]}),_:1}),t(S,{label:"通过数量"},{default:l(()=>{var D;return[x(K((D=_.value)==null?void 0:D.accept),1)]}),_:1}),t(S,{label:"提交数量"},{default:l(()=>{var D;return[x(K((D=_.value)==null?void 0:D.attempt),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Ml=oe(ql,[["__scopeId","data-v-555e19aa"]]),ht=[{name:"home",path:"/",title:"首页",showSidebar:!1,disableGenerateTab:!0,component:pl},{name:"problem",path:"/problem",title:"题目",icon:"calculation",showSidebar:!0,redirect:"problem-list"},{name:"collection-detail-tab",title:"题集",path:"/collection",showSidebar:!0,disableGenerateTab:!0,redirect:"problem-collection-list"},{name:"judge",path:"/judge",title:"评测",icon:"code",showSidebar:!0,redirect:"judge-list"},{name:"contest",path:"/contest",title:"比赛",icon:"application",showSidebar:!0,redirect:"contest-list"},{name:"contest-detail-tab",title:"比赛",path:"/contest",showSidebar:!0,disableGenerateTab:!0,redirect:"contest-list"},{name:"discuss",title:"讨论",path:"/discuss",icon:"sonic",showSidebar:!0,redirect:"discuss-list"},{name:"rank",path:"/rank",title:"排名",icon:"chart-column",showSidebar:!0,redirect:"rank-ac-all"},{name:"tool",path:"/tool",title:"工具",icon:"tools",showSidebar:!0,redirect:"tool-paste"},{name:"system",path:"/system",title:"系统",icon:"dashboard",showSidebar:!0,redirect:"system-status"},{name:"manage",path:"/manage",title:"管理",icon:"command",showSidebar:!0,redirect:"manage-judge",auths:[je.Manage]},{name:"login",path:"/login",title:"登陆",showSidebar:!1,disableGenerateTab:!0,component:zl},{name:"register",path:"/register",title:"注册",showSidebar:!1,disableGenerateTab:!0,component:Al},{name:"user",path:"/user/:username+",title:"用户",showSidebar:!1,needLogin:!0,disableGenerateTab:!0,component:Ml},{name:"404",path:"/404",title:"404",showSidebar:!1,disableGenerateTab:!0,component:Zt}],Fl=e=>ht.find(a=>a.name==e),Gl=e=>{const a=[];return ht.forEach(n=>{!n.disableGenerateTab&&e.hasAllAuths(n.auths)&&a.push(n)}),a},Nl=e=>{ht.forEach(a=>{const n={name:a.name,path:a.path,meta:{title:a.title,tab:a.name,showSidebar:a.showSidebar,needLogin:a.needLogin,redirect:a.redirect,tabAuths:a.auths},component:a.component};e.push(n)})};function Qt(e){return e.children!==void 0}function Ol(e){return e.children!==void 0}var yt=(e=>(e[e.Unknown=-1]="Unknown",e[e.C=0]="C",e[e.Cpp=1]="Cpp",e[e.Java=2]="Java",e[e.Python=3]="Python",e[e.Pascal=4]="Pascal",e[e.Golang=5]="Golang",e[e.Lua=6]="Lua",e[e.TypeScript=7]="TypeScript",e[e.Max=8]="Max",e))(yt||{});function wt(){const e=[-1,8];return Object.values(yt).filter(a=>typeof a=="number"&&!e.includes(a)).map(a=>({value:a,label:ea(a)}))}function Hl(e){return e>-1&&e<8}function ea(e){switch(e){case 0:return"C";case 1:return"C++";case 2:return"Java";case 3:return"Python";case 4:return"Pascal";case 5:return"Golang";case 6:return"Lua";case 7:return"TypeScript";default:return"Unknown"}}function kt(e){switch(e){case 0:return"c";case 1:return"cpp";case 2:return"java";case 3:return"python";case 4:return"pascal";case 5:return"go";case 6:return"lua";case 7:return"typescript";default:return"text"}}var Pe=(e=>(e[e.Init=0]="Init",e[e.Rejudge=1]="Rejudge",e[e.Submitting=2]="Submitting",e[e.Queuing=3]="Queuing",e[e.Compiling=4]="Compiling",e[e.Running=5]="Running",e[e.Accept=6]="Accept",e[e.PE=7]="PE",e[e.WA=8]="WA",e[e.TLE=9]="TLE",e[e.MLE=10]="MLE",e[e.OLE=11]="OLE",e[e.RE=12]="RE",e[e.CE=13]="CE",e[e.CLE=14]="CLE",e[e.JudgeFail=15]="JudgeFail",e[e.SubmitFail=16]="SubmitFail",e[e.Unknown=17]="Unknown",e[e.Max=18]="Max",e))(Pe||{});const Bl=e=>{switch(e){case 0:return"普通评测";case 1:return"特殊评测";default:return"未知"}},ot=e=>{switch(e){case 0:return"等待处理";case 1:return"重新评测";case 2:return"提交中";case 3:return"队列中";case 4:return"编译中";case 5:return"运行中";case 6:return"通过";case 7:return"格式错误";case 8:return"答案错误";case 9:return"超时";case 10:return"内存超限";case 11:return"输出超限";case 12:return"运行错误";case 13:return"编译错误";case 14:return"编译超限";case 15:return"评测失败";case 16:return"提交失败";case 17:return"未知";default:return e}},ta=e=>{switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return"default";case 6:return"success";case 7:return"warning";default:return"danger"}};function aa(){const e=[17,18];return Object.values(Pe).filter(a=>typeof a=="number"&&!e.includes(a)).map(a=>({value:a,label:ot(a)}))}function Oe(e){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return!0;default:return!1}}function la(e){var n;const a={};if(a.id=e.id,a.problemId=e.problem_id,a.contestProblemIndex=e.contest_problem_index,a.status=e.status,Oe(e.status)?a.score="-":a.score=e.score.toString(),e.time?a.time=Math.ceil(e.time/1e6)+"ms":a.time="-",e.memory?a.memory=(e.memory/1024/1024).toFixed(2)+"MB":a.memory="-",a.language=ea(e.language),a.codeLength=e.code_length,e.approve_time?a.approveTime=new Date(e.approve_time).toLocaleString():a.approveTime="-",a.author=e.author,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.code=e.code,a.compileMessage=e.compile_message,a.taskCurrent=e.task_current,a.taskTotal=e.task_total,a.task=[],e.task)for(let s=0;s<((n=e.task)==null?void 0:n.length);s++){const o=e.task[s],d={};d.taskId=o.task_id,d.status=o.status,o.time?d.time=Math.ceil(o.time/1e6)+"ms":d.time="-",o.memory?d.memory=(o.memory/1024/1024).toFixed(2)+"MB":d.memory="-",d.score=o.score,d.content=o.content,d.waHint=o.wa_hint,!d.content&&!d.waHint&&(d.content="无提示信息"),a.task.push(d)}return e.judger&&(a.judger=e.judger),e.judge_time&&(a.judgeTime=new Date(e.judge_time).toLocaleString()),a}function Wl(e,a,n,s,o){return J({url:"/judge/approve",method:"post",data:{problem_id:e,contest_id:a,problem_index:n,language:s,code:o}})}function Jl(e){return J({url:"/judge?id="+e,method:"get"})}function Xl(e){return J({url:"/judge/code?id="+e,method:"get"})}function Yl(e,a,n,s,o,d,_){const P=new URLSearchParams({contest_id:String(e),problem_id:a,username:n,language:String(s),status:String(o),page:String(d),page_size:String(_)});return J({url:`/judge/list?${P.toString()}`,method:"get"})}function Zl(){return J({url:"/judge/rejudge/recently",method:"post"})}function Ql(e,a,n){const s={};return e!=null&&(s.problem_id=e),a!=null?s.language=a:s.language=yt.Unknown,n!=null?s.status=n:s.status=18,J({url:"/judge/rejudge/search",method:"post",data:s})}function en(){return J({url:"/judge/rejudge/all",method:"post",timeout:0})}function tn(e){return J({url:"/judge/rejudge",method:"post",data:{id:Number(e)}})}var Ze=(e=>(e[e.None=0]="None",e[e.Attempt=1]="Attempt",e[e.Accept=2]="Accept",e))(Ze||{});function Qe(e,a){const n={};if(n.id=e.id,n.author=e.author,n.title=e.title,n.tags=[],e.tags)for(const s of e.tags){const o=a[s];o&&n.tags.push(o)}if(n.private=e.private,n.accept=e.accept,n.attempt=e.attempt,e.description!=null&&(n.description=e.description),e.time_limit!=null&&e.time_limit>=0?n.timeLimit=e.time_limit.toString()+" ms":n.timeLimit="未知",e.memory_limit!=null&&e.memory_limit>=0?n.memoryLimit=(e.memory_limit/1024).toFixed(2)+" MB":n.memoryLimit="未知",e.judge_type!=null&&(n.judgeType=Bl(e.judge_type)),e.insert_time!=null&&(n.insertTime=new Date(e.insert_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.source!=null){const s=/\[([^\]]+)\]\(([^)]+)\)/,o=e.source.match(s);o?(n.source=o[1],n.sourceUrl=o[2]):(n.source=e.source,n.sourceUrl="")}return e.judge_md5!=null&&(n.judgeMd5=e.judge_md5),e.origin_oj!=null&&(n.originOj=e.origin_oj),e.origin_id!=null&&(n.originId=e.origin_id),e.origin_url!=null&&(n.originUrl=e.origin_url),n}function na(e,a,n){const s={};return e?s.id=e:(s.contest_id=a,s.problem_index=n),J({url:`/problem?${new URLSearchParams(s).toString()}`,method:"get"})}function oa(e){return J({url:"/problem/tag/list?max_count="+e,method:"get"})}function an(e){return J({url:"/problem/judge?id="+e,method:"get"})}function ln(e,a,n,s,o,d){const _={};return e&&(_.oj=e),a&&(_.title=a),n&&(_.tag=n),s!==void 0&&(_.private=s?"1":"0"),o&&(_.page=o),d&&(_.page_size=d),J({url:`/problem/list?${new URLSearchParams(_).toString()}`,method:"get"})}function nn(e){const a={};return e&&(a.problem_id=e),J({url:`/problem/recommend?${new URLSearchParams(a).toString()}`,method:"get"})}function sa(e,a){return J({url:"/problem/crawl",method:"post",data:{oj:e,id:a}})}function on(e,a,n,s,o,d,_){return J({url:"/problem/create",method:"post",data:{title:e,time_limit:a,memory_limit:n,source:s,private:o,tags:d,description:_}})}function sn(e,a,n,s,o,d,_,P){return J({url:"/problem/edit",method:"post",data:{id:e,title:a,time_limit:n,memory_limit:s,source:o,private:d,tags:_,description:P}})}function rn(e,a){return J({url:"/problem/judge/data/download?id="+e+"&key="+a,method:"get"})}function un(e,a){const n=new FormData;return n.append("id",e),n.append("zip",a),J({url:"/problem/judge/data",method:"post",data:n,headers:{"Content-Type":"multipart/form-data"},timeout:1e3*60*5})}function cn(e){return J({url:"/problem/parse",method:"post",data:{problems:e}})}const dn={style:{margin:"10px"}},mn={key:0,class:"dida-operation-container"};function pn(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Me(e)}const fn=ae({__name:"ProblemList",setup(e){const a=pe(),n=Ue(),{globalProperties:s}=re(),o=xe();let d=null;const _=p(!1),P={};let I={};const y=p(!1),b=Re(()=>o.hasAuth(je.ManageProblem)),r=p([{title:"ID",colKey:"id",cell:(T,h)=>{let C=f(h.row.id);return t(O,{variant:"dashed",theme:C,onClick:()=>w(h.row.id)},{default:()=>[h.row.id]})}},{title:"标题",colKey:"title",cell:(T,h)=>t(O,{variant:"text",onClick:()=>w(h.row.id)},{default:()=>[h.row.title]})},{title:"标签",colKey:"tags",cell:(T,h)=>{const C=h.row.tags;if(!C||C.length===0)return"";let $=[];for(let G=0;G<C.length;G++){const q=C[G];$.push(t(O,{key:G,theme:"default",variant:"outline",size:"small",onClick:()=>j(q)},{default:()=>[q.name]}))}return t(ve,null,pn($)?$:{default:()=>[$]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),u=p(!1);let g=1,k=50;const m=p({current:g,pageSize:k,defaultCurrent:g,defaultPageSize:k,total:0,pageSizeOptions:[50,100]}),c=p(),S=p(),A=[{label:"DidaOJ",value:"didaoj"},{label:"HDU",value:"hdu"},{label:"POJ",value:"poj"},{label:"NYOJ",value:"nyoj"}],V=p({oj:"",title:"",tag:"",private:!1}),R=p({oj:"",problem:""}),w=T=>{T&&n.push({path:"/problem/"+T})},f=T=>{if(!T||!I)return"default";const h=I[T];if(!h)return"default";switch(h){case Ze.Accept:return"success";case Ze.Attempt:return"warning";default:return"default"}},D=async()=>{await n.push({query:{...a.query,oj:V.value.oj,title:V.value.title,tag:V.value.tag,private:V.value.private?"1":"0",page:1,page_size:m.value.defaultPageSize}})},z=async()=>{try{y.value=!0;const T=await sa(R.value.oj,R.value.problem);T.code===0?(_e(s,"搜索成功"),await n.push({name:"problem-detail",params:{problemId:T.data}})):H(s,T.code)}catch(T){console.error(T),H(s,Te())}finally{y.value=!1}},j=T=>{T&&n.push({query:{...a.query,title:"",tag:T.name,page:1,page_size:m.value.defaultPageSize}})},v=()=>{n.push({name:"manage-problem-create"})},i=async(T,h)=>{u.value=!0;try{const{current:C,pageSize:$}=T,G=await ln(V.value.oj,V.value.title,V.value.tag,V.value.private,C,$);if(c.value=[],G.code===0){const q=G.data.list;if(!q||q.length<=0){m.value={...m.value,total:0},I={},_e(s,"未找到记录");return}q.forEach(Y=>{var te;const W=Qe(Y,P);(te=c.value)==null||te.push(W)}),m.value={...m.value,total:G.data.total_count},I=G.data.problem_attempt_status}else h&&H(s,G.code)}catch(C){console.error(C),H(s,Te())}finally{u.value=!1}},U=async T=>{await n.push({query:{...a.query,page:T.current,page_size:T.pageSize}})};return ne(async()=>{u.value=!0,S.value=[],oa(-1).then(T=>{if(T.code===0){S.value=T.data.list,_.value=T.data.total_count>T.data.list.length;for(let h=0;h<T.data.list.length;h++){const C=T.data.list[h];P[C.id]=C}d=Ve(()=>a.query,h=>{V.value.oj=h.oj||"",V.value.title=h.title||"",V.value.tag=h.tag||"",V.value.private=h.private==="1";const C=parseInt(h.page)||m.value.defaultCurrent,$=parseInt(h.page_size)||m.value.defaultPageSize;g=C,k=$,m.value={...m.value,current:g,pageSize:k},i({current:g,pageSize:k},!0)},{immediate:!0})}else _.value=!0}).catch(T=>{console.error(T),_.value=!0})}),Se(()=>{d&&d()}),(T,h)=>{const C=Ie,$=se,G=be,q=O,Y=ve,W=rt,te=ze,N=$e,fe=Ft,we=De,ie=ge;return L(),M(ie,null,{default:l(()=>[t(G,{span:9},{default:l(()=>[t($,{style:{margin:"10px"}},{default:l(()=>[t(C,{data:c.value,columns:r.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:m.value,"table-layout":"auto",loading:u.value,onPageChange:U},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(G,{span:3},{default:l(()=>[E("div",dn,[b.value?(L(),X("div",mn,[t(Y,null,{default:l(()=>[t(q,{onClick:v},{default:l(()=>h[7]||(h[7]=[x("新建")])),_:1})]),_:1})])):le("",!0),t($,{class:"sh-card"},{default:l(()=>[t(we,{model:V.value,onSubmit:D},{default:l(()=>[t(te,{label:"OJ"},{default:l(()=>[t(W,{modelValue:V.value.oj,"onUpdate:modelValue":h[0]||(h[0]=ee=>V.value.oj=ee),options:A,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(te,{label:"标题"},{default:l(()=>[t(N,{modelValue:V.value.title,"onUpdate:modelValue":h[1]||(h[1]=ee=>V.value.title=ee),placeholder:"请输入关键词"},null,8,["modelValue"])]),_:1}),t(te,{label:"标签"},{default:l(()=>[t(N,{modelValue:V.value.tag,"onUpdate:modelValue":h[2]||(h[2]=ee=>V.value.tag=ee),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),b.value?(L(),M(te,{key:0,label:"私有"},{default:l(()=>[t(fe,{modelValue:V.value.private,"onUpdate:modelValue":h[3]||(h[3]=ee=>V.value.private=ee)},null,8,["modelValue"])]),_:1})):le("",!0),t(te,null,{default:l(()=>[t(q,{theme:"primary",type:"submit"},{default:l(()=>h[8]||(h[8]=[x("搜索")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t($,{class:"sh-card"},{default:l(()=>[t(we,{model:R.value,onSubmit:z},{default:l(()=>[t(te,{label:"OJ"},{default:l(()=>[t(W,{modelValue:R.value.oj,"onUpdate:modelValue":h[4]||(h[4]=ee=>R.value.oj=ee),options:A,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(te,{label:"题目"},{default:l(()=>[t(N,{modelValue:R.value.problem,"onUpdate:modelValue":h[5]||(h[5]=ee=>R.value.problem=ee),placeholder:"请输入原始题号"},null,8,["modelValue"])]),_:1}),t(te,null,{default:l(()=>[t(q,{theme:"primary",type:"submit",loading:y.value},{default:l(()=>h[9]||(h[9]=[x("前往")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),t($,{class:"sh-card sh-background-black"},{default:l(()=>[(L(!0),X(Q,null,de(S.value,ee=>(L(),M(q,{class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:()=>j(ee)},{default:l(()=>[x(K(ee.name),1)]),_:2},1032,["onClick"]))),256)),_.value?(L(),M(q,{key:0,class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:h[6]||(h[6]=()=>T.$router.push("/problem/tags"))},{default:l(()=>h[10]||(h[10]=[x(" ... ")])),_:1})):le("",!0)]),_:1})])]),_:1})]),_:1})}}}),_n=oe(fn,[["__scopeId","data-v-bc7185f5"]]);function Ge(e){e.querySelectorAll("pre > code:not([data-copy-attached])").forEach(n=>{n.setAttribute("data-copy-attached","true");const s=n.parentElement,o=document.createElement("div");o.className="copy-wrapper";const d=document.createElement("button");d.className="copy-btn",d.innerText="复制",d.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(n.innerText),d.innerText="已复制",setTimeout(()=>d.innerText="复制",1500)}catch{d.innerText="失败"}}),s.replaceWith(o),o.appendChild(d),o.appendChild(s)})}function qe(e){let a="";for(;e>0;)e--,a=String.fromCharCode(65+e%26)+a,e=Math.floor(e/26);return a}async function ra(e){const a={};if(a.id=e.id,a.ownerId=e.owner_id,a.ownerUsername=e.owner_username,a.ownerNickname=e.owner_nickname,a.title=e.title,a.startTime=new Date(e.start_time).toLocaleString(),a.endTime=new Date(e.end_time).toLocaleString(),e.descriptions){a.descriptions=[];const n={math:{inlineDigit:!0,engine:"KaTeX"}};for(let s=0;s<e.descriptions.length;s++){const o=e.descriptions[s],d={};d.title=o.title,d.content=await ue.md2html(o.content,n),d.sort=o.sort,a.descriptions.push(d)}}if(a.notification=e.notification,e.problems){a.problems=[],e.problems.sort((n,s)=>n.index-s.index);for(let n=0;n<e.problems.length;n++){const s=e.problems[n];s.accept||(s.accept=0),s.attempt||(s.attempt=0),s.id=qe(s.index),a.problems.push(s)}}return a}function vn(e){return J({url:"/contest?id="+e,method:"get"})}function gn(e,a){return J({url:"/contest/list?page="+e+"&page_size="+a,method:"get"})}function bn(e){return J({url:"/contest/rank?id="+e,method:"get"})}function hn(e){return J({url:"/contest/create",method:"post",data:e})}const yn=["innerHTML"],wn={style:{margin:"12px"}},kn={key:1},Cn={class:"dida-operation-container"},Sn={class:"dida-operation-container"},In={class:"dida-code-submit-div"},Pn=ae({__name:"ProblemDetail",setup(e){let a=pe();const{globalProperties:n}=re(),s=Ae(),o=xe();let d=p(""),_="",P=0,I=0;const y=p(!1),b=p(null),r=p(!1),u=p(null);let g=null;const k=p(null),m=p(!1),c=p(!1),S={},A=p(""),V=p([]);V.value=wt();const R=Re(()=>o.hasAuth(je.ManageProblem)),w=h=>{h&&B.push({name:"problem-list",query:{...a.query,title:"",tag:h.name}})},f=()=>{B.push({name:"manage-problem",params:{problemId:_}})},D=()=>{_?B.push({name:"judge-list",query:{problem_id:_}}):B.push({name:"contest-judge",params:{contestId:P},query:{problem_id:qe(I)}})},z=()=>{_?B.push({name:"discuss-list-problem",query:{problem_id:_}}):B.push({name:"contest-discuss",params:{contestId:P},query:{problem_id:qe(I)}})},j=()=>{B.push({name:"problem-recommend",params:{problemId:_}})},v=async()=>{var $,G;const h=($=u.value)==null?void 0:$.originOj,C=(G=u.value)==null?void 0:G.originId;if(!(!h||!C))try{m.value=!0;const q=await sa(h,C);q.code===0?(await T(),_e(n,"更新成功")):H(n,q.code)}catch{ce(n,"更新失败，请稍后再试")}finally{m.value=!1}},i=async()=>{if(!_){ce(n,"问题ID无效");return}const h=parseInt(A.value);if(!Hl(h)){ce(n,"请选择所编写的语言");return}const C=g==null?void 0:g.getValue();if(!C){ce(n,"请输入所需提交的代码");return}c.value=!0;try{const $=await Wl(_,P,I,h,C);if($.code!==0){H(n,$.code);return}_e(n,"提交成功，正在跳转到详情页面");const G=$.data.id;await B.push({path:"/judge/"+G})}finally{c.value=!1}},U=h=>{if(!g)return;const C=g.getModel();C&&St.setModelLanguage(C,kt(h))},T=async()=>{let h=await na(_,P,I);if(h.code!==0){r.value=!1,H(n,h.code),await B.push({name:"problem"});return}h.data.tags&&h.data.tags.forEach(G=>{S[G.id]=G}),u.value=Qe(h.data.problem,S),s.setTitle(u.value.title+" - "+s.getTitle);let C=u.value.description;const $={math:{inlineDigit:!0,engine:"KaTeX"}};d.value=await ue.md2html(C,$),await Le(()=>{b.value&&(ue.mathRender(b.value),ue.highlightRender({lineNumber:!0,enable:!0},b.value),Ge(b.value),!g&&k.value&&(g=St.create(k.value,{value:"",language:"cpp",minimap:{enabled:!0},colorDecorators:!0,readOnly:!1,theme:"vs-dark"}))),r.value=!1})};return ne(async()=>{if(Array.isArray(a.params.problemId)?_=a.params.problemId[0]:_=a.params.problemId,!_){if(Array.isArray(a.params.contestId)?P=Number(a.params.contestId[0]):P=Number(a.params.contestId),!P){ce(n,"题目不存在"),await B.push({name:"problem"});return}if(Array.isArray(a.params.problemIndex)?I=parseInt(a.params.problemIndex[0]):I=parseInt(a.params.problemIndex),!I){ce(n,"题目不存在"),await B.push({name:"problem"});return}}y.value=!!P,r.value=!0,await T()}),(h,C)=>{const $=se,G=be,q=Ke,Y=Ne,W=O,te=ve,N=Ee,fe=bt,we=rt,ie=ge,ee=Ce;return L(),M(ee,{loading:r.value},{default:l(()=>[t(ie,{class:"dida-main-content"},{default:l(()=>[t(G,{span:8},{default:l(()=>[t($,{style:{margin:"10px"}},{default:l(()=>[E("div",{innerHTML:me(d),ref_key:"markdownRef",ref:b},null,8,yn)]),_:1})]),_:1}),t(G,{span:4},{default:l(()=>[E("div",wn,[t(N,{layout:"vertical",bordered:!0},{default:l(()=>{var Z;return[t(q,{label:"标题"},{default:l(()=>{var F;return[x(K((F=u.value)==null?void 0:F.title),1)]}),_:1}),t(q,{label:"时间限制"},{default:l(()=>{var F;return[x(K((F=u.value)==null?void 0:F.timeLimit),1)]}),_:1}),t(q,{label:"内存限制"},{default:l(()=>{var F;return[x(K((F=u.value)==null?void 0:F.memoryLimit),1)]}),_:1}),t(q,{label:"判题方式"},{default:l(()=>{var F;return[x(K((F=u.value)==null?void 0:F.judgeType),1)]}),_:1}),t(q,{label:"正确提交"},{default:l(()=>{var F;return[x(K((F=u.value)==null?void 0:F.accept),1)]}),_:1}),t(q,{label:"提交总数"},{default:l(()=>{var F;return[x(K((F=u.value)==null?void 0:F.attempt),1)]}),_:1}),t(q,{label:"创建时间"},{default:l(()=>{var F;return[x(K((F=u.value)==null?void 0:F.insertTime),1)]}),_:1}),t(q,{label:"更新时间"},{default:l(()=>{var F;return[x(K((F=u.value)==null?void 0:F.updateTime),1)]}),_:1}),t(q,{label:"上传用户"},{default:l(()=>{var F;return[x(K((F=u.value)==null?void 0:F.creatorNickname),1)]}),_:1}),y.value?le("",!0):(L(),M(q,{key:0,label:"题目来源"},{default:l(()=>{var F,he,ke;return[(F=u.value)!=null&&F.sourceUrl?(L(),M(Y,{key:0,href:(he=u.value)==null?void 0:he.sourceUrl,target:"_blank"},{default:l(()=>{var We;return[x(K((We=u.value)==null?void 0:We.source),1)]}),_:1},8,["href"])):(L(),X("span",kn,K((ke=u.value)==null?void 0:ke.source),1))]}),_:1})),R.value?(L(),M(q,{key:1,label:"是否私有"},{default:l(()=>{var F;return[x(K((F=u.value)!=null&&F.private?"私有":"公开"),1)]}),_:1})):le("",!0),(Z=u.value)!=null&&Z.originUrl?(L(),M(q,{key:2,label:"原题链接"},{default:l(()=>{var F;return[t(Y,{href:(F=u.value)==null?void 0:F.originUrl,target:"_blank"},{default:l(()=>{var he,ke;return[x(K((he=u.value)==null?void 0:he.originOj)+" - "+K((ke=u.value)==null?void 0:ke.originId),1)]}),_:1},8,["href"])]}),_:1})):le("",!0),me(_)?(L(),M(q,{key:3,label:"标签"},{default:l(()=>[t(te,null,{default:l(()=>{var F;return[(L(!0),X(Q,null,de((F=u.value)==null?void 0:F.tags,he=>(L(),M(W,{key:he.id,variant:"dashed",onClick:()=>w(he)},{default:l(()=>[x(K(he.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})):le("",!0)]}),_:1}),E("div",Cn,[t(te,null,{default:l(()=>[t(W,{onClick:D},{default:l(()=>C[1]||(C[1]=[x("提交记录")])),_:1}),t(W,{onClick:z},{default:l(()=>C[2]||(C[2]=[x("题目讨论")])),_:1}),me(_)?(L(),M(W,{key:0,onClick:j},{default:l(()=>C[3]||(C[3]=[x("题目推荐")])),_:1})):le("",!0)]),_:1})]),E("div",Sn,[t(te,null,{default:l(()=>{var Z;return[R.value?(L(),M(W,{key:0,onClick:f},{default:l(()=>C[4]||(C[4]=[x("编辑")])),_:1})):le("",!0),(Z=u.value)!=null&&Z.originId?(L(),M(W,{key:1,onClick:v,loading:m.value},{default:l(()=>C[5]||(C[5]=[x("更新描述 ")])),_:1},8,["loading"])):le("",!0)]}),_:1})]),E("div",In,[t(te,null,{default:l(()=>[t(we,{modelValue:A.value,"onUpdate:modelValue":C[0]||(C[0]=Z=>A.value=Z),label:"语言：",placeholder:"请选择提交语言","auto-width":"",clearable:"",onChange:U},{default:l(()=>[(L(!0),X(Q,null,de(V.value,Z=>(L(),M(fe,{key:Z.value,value:Z.value,label:Z.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),t(W,{onClick:i,loading:c.value},{default:l(()=>C[6]||(C[6]=[x("提交")])),_:1},8,["loading"])]),_:1}),E("div",{ref_key:"codeEditRef",ref:k,class:"dida-code-editor"},null,512)])])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Pt=oe(Pn,[["__scopeId","data-v-e5bb36b6"]]),xn={style:{margin:"10px"}};function Tn(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Me(e)}const jn=ae({__name:"ProblemRecommend",setup(e){const a=pe(),n=Ue(),{globalProperties:s}=re();let o=null,d="",_={},P={};const I=p([{title:"ID",colKey:"id",cell:(m,c)=>{let S=u(c.row.id);return t(O,{variant:"dashed",theme:S,onClick:()=>r(c.row.id)},{default:()=>[c.row.id]})}},{title:"标题",colKey:"title",cell:(m,c)=>t(O,{variant:"text",onClick:()=>r(c.row.id)},{default:()=>[c.row.title]})},{title:"标签",colKey:"tags",cell:(m,c)=>{const S=c.row.tags;if(!S||S.length===0)return"";let A=[];for(let V=0;V<S.length;V++){const R=S[V];A.push(t(O,{key:V,theme:"default",variant:"outline",size:"small",onClick:()=>g(R)},{default:()=>[R.name]}))}return t(ve,null,Tn(A)?A:{default:()=>[A]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),y=p(!1),b=p(),r=m=>{m&&n.push({path:"/problem/"+m})},u=m=>{if(!m||!P)return"default";const c=P[m];if(!c)return"default";switch(c){case Ze.Accept:return"success";case Ze.Attempt:return"warning";default:return"default"}},g=m=>{m&&n.push({name:"problem-list",query:{tag:m.name}})},k=async m=>{y.value=!0;try{const c=await nn(d);if(b.value=[],c.code===0){const S=c.data.list;if(!S||S.length<=0){_e(s,"暂无推荐题目");return}_={},c.data.tags&&c.data.tags.forEach(A=>{_[A.id]=A}),S.forEach(A=>{var R;const V=Qe(A,_);(R=b.value)==null||R.push(V)})}else m&&H(s,c.code)}catch(c){console.error(c),H(s,Te())}finally{y.value=!1}};return ne(async()=>{y.value=!0,o=Ve(()=>a.query,m=>{Array.isArray(a.params.problemId)?d=a.params.problemId[0]:d=a.params.problemId,k(!0)},{immediate:!0})}),Se(()=>{o&&o()}),(m,c)=>{const S=Ie,A=se,V=be,R=ge;return L(),M(R,null,{default:l(()=>[t(V,{span:9},{default:l(()=>[t(A,{style:{margin:"10px"}},{default:l(()=>[t(S,{data:b.value,columns:I.value,"row-key":"id","vertical-align":"top",hover:!0,"table-layout":"auto",loading:y.value},null,8,["data","columns","loading"])]),_:1})]),_:1}),t(V,{span:3},{default:l(()=>[E("div",xn,[t(A,{class:"sh-card",header:"题目推荐","header-bordered":!0},{default:l(()=>c[0]||(c[0]=[x(" 根据本站其他用户的提交记录推荐类似题目"),E("br",null,null,-1),x("依据推荐算法来计算，与本用户相似度最高的用户做的题，大概率被自己感兴趣。 ")])),_:1})])]),_:1})]),_:1})}}}),Ln=oe(jn,[["__scopeId","data-v-77972e8b"]]);async function Ct(e){const a={};if(a.id=e.id,a.ownerId=e.owner_id,a.ownerUsername=e.owner_username,a.ownerNickname=e.owner_nickname,a.title=e.title,e.start_time?a.startTime=new Date(e.start_time).toLocaleString():a.startTime="无限制",e.end_time?a.endTime=new Date(e.end_time).toLocaleString():a.endTime="无限制",e.update_time?a.updateTime=new Date(e.update_time).toLocaleString():a.updateTime="",e.create_time?a.createTime=new Date(e.create_time).toLocaleString():a.createTime="",e.description){const n={math:{inlineDigit:!0,engine:"KaTeX"}};a.description=await ue.md2html(e.description,n)}else a.description="";return a.problems=e.problems,a}function Vn(e){return J({url:"/collection?id="+e,method:"get"})}function Dn(e){return J({url:"/collection/edit?id="+e,method:"get"})}function zn(e,a){return J({url:"/collection/list?page="+e+"&page_size="+a,method:"get"})}function $n(e){return J({url:"/collection/rank?id="+e,method:"get"})}function Un(e){return J({url:"/collection/create",method:"post",data:e})}function An(e){return J({url:"/collection/edit",method:"post",data:e})}const Rn={style:{margin:"10px"}},En=ae({__name:"CollectionList",setup(e){const a=pe(),n=Ue(),{globalProperties:s}=re();let o=null;p(!1),p(!1);const d=p([{title:"ID",colKey:"id",width:"100",cell:(S,A)=>t(O,{variant:"text",onClick:()=>u(A.row.id)},{default:()=>[A.row.id]})},{title:"标题",colKey:"title",cell:(S,A)=>t(O,{variant:"text",onClick:()=>u(A.row.id)},{default:()=>[A.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),_=p(!1);let P=1,I=50;const y=p({current:P,pageSize:I,defaultCurrent:P,defaultPageSize:I,total:0,pageSizeOptions:[50,100]}),b=p(),r=p({title:"",username:""});p({title:"",description:"",open_time:[]});const u=S=>{S&&n.push({path:"/collection/"+S})},g=async()=>{await n.push({query:{...a.query,title:r.value.title,username:r.value.username,page:1,page_size:y.value.defaultPageSize}})},k=async(S,A)=>{var V;_.value=!0;try{const{current:R,pageSize:w}=S,f=await zn(R,w);if(b.value=[],f.code===0){const D=f.data.list;for(let z=0;z<D.length;z++){const j=D[z],v=await Ct(j);(V=b.value)==null||V.push(v)}y.value={...y.value,total:f.data.total_count}}else A&&H(s,f.code)}catch(R){console.error(R),H(s,Te())}finally{_.value=!1}},m=async S=>{await n.push({query:{...a.query,page:S.current,page_size:S.pageSize}})},c=async()=>{await n.push({name:"collection-create"})};return ne(async()=>{o=Ve(()=>a.query,S=>{r.value.title=S.title||"",r.value.username=S.username||"";const A=parseInt(S.page)||y.value.defaultCurrent,V=parseInt(S.page_size)||y.value.defaultPageSize;P=A,I=V,y.value={...y.value,current:P,pageSize:I},k({current:P,pageSize:I},!0)},{immediate:!0})}),Se(()=>{o&&o()}),(S,A)=>{const V=Ie,R=se,w=be,f=$e,D=ze,z=O,j=De,v=ve,i=ge;return L(),M(i,null,{default:l(()=>[t(w,{span:9},{default:l(()=>[t(R,{style:{margin:"10px"}},{default:l(()=>[t(V,{data:b.value,columns:d.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:y.value,loading:_.value,onPageChange:m},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(w,{span:3},{default:l(()=>[E("div",Rn,[t(R,{class:"sh-card"},{default:l(()=>[t(j,{model:r.value},{default:l(()=>[t(D,{label:"标题"},{default:l(()=>[t(f,{modelValue:r.value.title,"onUpdate:modelValue":A[0]||(A[0]=U=>r.value.title=U),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(D,{label:"负责人"},{default:l(()=>[t(f,{modelValue:r.value.username,"onUpdate:modelValue":A[1]||(A[1]=U=>r.value.username=U),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(D,null,{default:l(()=>[t(z,{theme:"primary",onClick:g},{default:l(()=>A[2]||(A[2]=[x("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(R,{class:"sh-card"},{default:l(()=>[t(v,null,{default:l(()=>[t(z,{onClick:c},{default:l(()=>A[3]||(A[3]=[x("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),Kn=oe(En,[["__scopeId","data-v-29832c46"]]),qn={style:{margin:"20px"}},Mn={class:"dida-operation-container"},Fn={style:{margin:"12px"}},Gn=["innerHTML"],Nn=ae({__name:"CollectionDetail",setup(e){let a=pe();const{globalProperties:n}=re(),s=Ae(),o=xe();let d=0;const _=p(!1),P=p(null),I=Re(()=>o.hasAuth(je.ManageCollection)||P.value&&o.getUserId==P.value.ownerId),y=p([{title:"问题ID",colKey:"id",cell:(g,k)=>t(O,{variant:"text",onClick:()=>r(k.row.id)},{default:()=>[k.row.id]})},{title:"标题",colKey:"title",cell:(g,k)=>t(O,{variant:"text",onClick:()=>r(k.row.id)},{default:()=>[k.row.title]})},{title:"正确",colKey:"accept",cell:(g,k)=>k.row.accept?k.row.accept:0},{title:"提交",colKey:"attempt",cell:(g,k)=>k.row.attempt?k.row.attempt:0}]),b=p([]),r=g=>{B.push({name:"problem-detail",params:{problemId:g}})},u=()=>{P.value&&B.push({name:"collection-edit",params:{collectionId:P.value.id}})};return ne(async()=>{if(Array.isArray(a.params.collectionId)?d=Number(a.params.collectionId[0]):d=Number(a.params.collectionId),!d){await B.push({name:"problem-collection-list"});return}_.value=!0;const g=await Vn(d);if(g.code!==0){_.value=!1,H(n,g.code),await B.push({name:"problem-collection-list"});return}P.value=await Ct(g.data.collection),b.value=[],g.data.collection.problems&&g.data.collection.problems.forEach(k=>{const m=g.data.problems.find(c=>c.id===k);b.value.push(m)}),s.setTitle(P.value.title+" - "+s.getTitle),await Le(()=>{const k=document.querySelectorAll(".dida-content-description");k&&k.length>0&&k.forEach(m=>{ue.mathRender(m),ue.highlightRender({lineNumber:!0,enable:!0},m),Ge(m)}),_.value=!1})}),(g,k)=>{const m=Nt,c=Gt,S=Ie,A=se,V=be,R=O,w=ve,f=Ke,D=Ee,z=ge,j=Ce;return L(),M(j,{loading:_.value},{default:l(()=>[t(z,{class:"dida-main-content"},{default:l(()=>[t(V,{span:6},{default:l(()=>[E("div",qn,[t(c,{"max-item-width":"300"},{default:l(()=>[t(m,{to:{name:"problem-collection-list"}},{default:l(()=>k[0]||(k[0]=[x("题目集合")])),_:1}),t(m,null,{default:l(()=>{var v;return[x(K((v=P.value)==null?void 0:v.title),1)]}),_:1})]),_:1})]),t(A,{style:{margin:"10px"}},{default:l(()=>[t(S,{data:b.value,columns:y.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),_:1})]),_:1}),t(V,{span:6},{default:l(()=>{var v;return[E("div",Mn,[t(w,null,{default:l(()=>[I.value?(L(),M(R,{key:0,onClick:u},{default:l(()=>k[1]||(k[1]=[x("编辑")])),_:1})):le("",!0)]),_:1})]),E("div",Fn,[t(D,{layout:"vertical",bordered:!0},{default:l(()=>[t(f,{label:"创建者"},{default:l(()=>{var i;return[x(K((i=P.value)==null?void 0:i.ownerNickname),1)]}),_:1})]),_:1}),t(D,{layout:"vertical",bordered:!0},{default:l(()=>[t(f,{label:"开始时间"},{default:l(()=>{var i;return[x(K((i=P.value)==null?void 0:i.startTime),1)]}),_:1})]),_:1}),t(D,{layout:"vertical",bordered:!0},{default:l(()=>[t(f,{label:"结束时间"},{default:l(()=>{var i;return[x(K((i=P.value)==null?void 0:i.endTime),1)]}),_:1})]),_:1})]),(v=P.value)!=null&&v.description?(L(),M(A,{key:0,style:{margin:"10px"}},{default:l(()=>{var i;return[E("div",{innerHTML:(i=P.value)==null?void 0:i.description,class:"dida-content-description"},null,8,Gn)]}),_:1})):le("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),On=oe(Nn,[["__scopeId","data-v-c5aa5e2c"]]),Hn=ae({__name:"CollectionRank",setup(e){const a=pe(),n=Ue(),{globalProperties:s}=re();let o=null,d=0,_=0;const P=p([{title:"Rank",colKey:"rank",align:"center",cell:(r,u)=>t(O,{variant:"text",onClick:()=>n.push({name:"collection-user-rank",params:{collectionId:d,userId:u.row.user_id}})},{default:()=>[u.row.rank]})},{title:"Username",colKey:"username",cell:(r,u)=>t(O,{variant:"text",onClick:()=>n.push({name:"user",params:{username:u.row.username}})},{default:()=>[u.row.username]})},{title:"昵称",colKey:"nickname",cell:(r,u)=>t(O,{variant:"text",onClick:()=>n.push({name:"user",params:{username:u.row.username}})},{default:()=>[u.row.nickname]})},{title:"Count",colKey:"count",cell:(r,u)=>t(O,{variant:"text",onClick:()=>n.push({name:"judge-list",query:{username:u.row.username,status:Pe.Accept}})},{default:()=>[`${u.row.accept} / ${_}`]})},{title:"Progress",colKey:"progress",cell:(r,u)=>{let g=100;return _>0&&(g=Number((u.row.accept/_*100).toFixed(2))),t(Ot,{percentage:String(g)},null)}}]),I=p(!1),y=p(),b=async r=>{I.value=!0;try{const u=await $n(d);if(y.value=[],u.code===0){_=u.data.problem;const g=u.data.ranks,k=[];if(g){for(let m=0;m<g.length;m++){const c=g[m];let S={userId:c.author_id,username:c.author_username,nickname:c.author_nickname};S.accept=c.accept,k.push(S)}k.sort((m,c)=>m.accept!==c.accept?c.accept-m.accept:m.userId-c.userId);for(let m=0;m<k.length;m++)k[m].rank=m+1}y.value=k}else r&&H(s,u.code)}catch(u){console.error(u),H(s,Te())}finally{I.value=!1}};return ne(async()=>{o=Ve(()=>a.query,async()=>{if(Array.isArray(a.params.collectionId)?d=Number(a.params.collectionId[0]):d=Number(a.params.collectionId),!d){await n.push({name:"problem-collection-list"});return}await b(!0)},{immediate:!0})}),Se(()=>{o&&o()}),(r,u)=>{const g=Ie,k=se,m=ge;return L(),M(m,null,{default:l(()=>[t(k,{style:{margin:"10px"}},{default:l(()=>[E("div",null,[t(g,{data:y.value,columns:P.value,"row-key":"id","vertical-align":"top",hover:!0,loading:I.value},null,8,["data","columns","loading"])])]),_:1})]),_:1})}}}),Bn={style:{margin:"10px"}},Wn={class:"dida-form-border"},Jn={style:{"text-align":"right"}},Xn={class:"dida-form-border"},Yn={style:{"text-align":"right"}},Zn={style:{margin:"12px"}},Qn={class:"dida-edit-container"};var ye=function(e){return e[e.Valid=0]="Valid",e[e.Duplicate=1]="Duplicate",e[e.Invalid=2]="Invalid",e}(ye||{});const eo=ae({__name:"CollectionEdit",setup(e){let a=pe();const{globalProperties:n}=re(),s=Ae(),o=p(""),d=p(!1);let _=null;const P=p(!1),I=p(!1),y=p(null),b=p({title:"",openTime:[],private:!0,problems:[],users:[],description:""}),r=p([{title:"有效性",colKey:"validType",cell:(v,i)=>{switch(i.row.valid){case ye.Valid:return t(Fe,{theme:"success"},{default:()=>[x("有效")]});case ye.Duplicate:return t(Fe,{theme:"warning"},{default:()=>[x("重复")]});case ye.Invalid:return t(Fe,{theme:"danger"},{default:()=>[x("无效")]})}}},{title:"问题ID",colKey:"id"},{title:"标题",colKey:"title"}]),u=p([{title:"有效性",colKey:"validType",cell:(v,i)=>{switch(i.row.valid){case ye.Valid:return t(Fe,{theme:"success"},{default:()=>[x("有效")]});case ye.Duplicate:return t(Fe,{theme:"warning"},{default:()=>[x("重复")]});case ye.Invalid:return t(Fe,{theme:"danger"},{default:()=>[x("无效")]})}}},{title:"Username",colKey:"username"},{title:"昵称",colKey:"nickname"}]),g=p([]),k=p([]),m=p(""),c=p("");let S=null;const A=p(!1),V=async()=>{I.value=!0,m.value="请输入问题ID",c.value="",g.value.forEach(v=>{c.value+=`${v.id}
`}),S=async()=>{const v=It(c.value),i=Array.from(new Set(v)),U=await cn(i);if(U.code!==0){H(n,U.code);return}g.value=[];const T=U.data.problems;v.forEach(h=>{let C=null;T&&(C=T.find($=>$.id===h)),C?(g.value.find(G=>G.id===h)?C.valid=ye.Duplicate:C.valid=ye.Valid,g.value.push({valid:C.valid,id:h,title:C.title})):g.value.push({valid:ye.Invalid,id:h,title:"-"})}),b.value.problems=[],g.value.forEach(h=>{b.value.problems.push(h.id)})}},R=async()=>{I.value=!0,m.value="请输入username",c.value="",k.value.forEach(v=>{c.value+=`${v.username}
`}),S=async()=>{const v=It(c.value),i=await Pl(v);if(i.code!==0){H(n,i.code);return}k.value=[],v.sort((U,T)=>U.username.localeCompare(T.username)),v.forEach(U=>{let T=null;i.data.users&&(T=i.data.users.find(h=>h.username===U)),T?(k.value.find(C=>C.id===T.id)?T.valid=ye.Duplicate:T.valid=ye.Valid,k.value.push(T)):k.value.push({id:-1,username:U,nickname:"-",valid:ye.Invalid})}),b.value.users=[],k.value.forEach(U=>{b.value.users.push(U.id)})}},w=async()=>{A.value=!0,S&&await S(),I.value=!1,A.value=!1},f=async()=>{if(_){P.value=!0;try{const v={title:b.value.title,description:_.getValue(),problems:b.value.problems,users:b.value.users,start_time:b.value.openTime[0],end_time:b.value.openTime[1],private:b.value.private},i=await Un(v);if(P.value=!0,i.code!==0){H(n,i.code);return}i.data!=null&&await B.push({name:"collection-detail",params:{collectionId:i.data}}),Ye(n,"创建成功")}finally{P.value=!1}}},D=async()=>{if(_){P.value=!0;try{const v={id:Number(o.value),title:b.value.title,private:b.value.private,problems:b.value.problems,users:b.value.users,description:_.getValue()};b.value.openTime[0]&&(v.start_time=new Date(b.value.openTime[0])),b.value.openTime[1]&&(v.end_time=new Date(b.value.openTime[1]));const i=await An(v);if(P.value=!0,i.code!==0){H(n,i.code);return}i.data!=null&&(y.value.updateTime=new Date(i.data).toLocaleString()),Ye(n,"保存成功")}finally{P.value=!1}}},z=v=>{const i={after:()=>{_==null||_.setValue(v),d.value=!1}};_=new ue("collectionEditDiv",i)},j=async()=>{const v=await Dn(o.value);if(v.code!==0){H(n,v.code),console.error("collection get failed",v.code),await B.push({name:"problem-collection-list"});return}const i=v.data.collection;y.value=await Ct(i),g.value=[],v.data.problems&&v.data.problems.forEach(T=>{T.valid=ye.Valid,g.value.push(T)}),k.value=[],v.data.users&&v.data.users.length>0&&v.data.users.forEach(T=>{T.valid=ye.Valid,k.value.push(T)}),b.value.title=i.title,b.value.openTime=[],i.start_time?b.value.openTime.push(new Date(i.start_time)):b.value.openTime.push(""),i.end_time?b.value.openTime.push(new Date(i.end_time)):b.value.openTime.push(""),b.value.private=i.private,b.value.description=i.description,b.value.problems=[],g.value.forEach(T=>{b.value.problems.push(T.id)}),b.value.users=[],k.value.forEach(T=>{b.value.users.push(T.id)}),s.setTitle(i.title+" - "+s.getTitle);let U="";i.description&&(U=i.description),z(U)};return ne(async()=>{Array.isArray(a.params.collectionId)?o.value=a.params.collectionId[0]:o.value=a.params.collectionId,o.value?(d.value=!0,await j()):z("")}),(v,i)=>{const U=$e,T=ze,h=Ht,C=O,$=Ie,G=De,q=se,Y=be,W=ve,te=Ke,N=Ee,fe=ge,we=Ce,ie=$a,ee=He;return L(),X(Q,null,[t(we,{loading:d.value},{default:l(()=>[t(fe,null,{default:l(()=>[t(Y,{span:8},{default:l(()=>[E("div",Bn,[t(q,{class:"sh-card"},{default:l(()=>[t(G,{model:b.value},{default:l(()=>[t(T,{label:"标题"},{default:l(()=>[t(U,{modelValue:b.value.title,"onUpdate:modelValue":i[0]||(i[0]=Z=>b.value.title=Z),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),t(T,{label:"开启时间"},{default:l(()=>[t(h,{modelValue:b.value.openTime,"onUpdate:modelValue":i[1]||(i[1]=Z=>b.value.openTime=Z),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(T,{label:"问题"},{default:l(()=>[E("div",Wn,[E("div",Jn,[t(C,{onClick:V},{default:l(()=>i[4]||(i[4]=[x("编辑")])),_:1})]),t($,{data:g.value,columns:r.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])])]),_:1}),t(T,{label:"成员"},{default:l(()=>[E("div",Xn,[E("div",Yn,[t(C,{onClick:R},{default:l(()=>i[5]||(i[5]=[x("编辑")])),_:1})]),t($,{data:k.value,columns:u.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(Y,{span:4},{default:l(()=>[E("div",Zn,[E("div",Qn,[o.value?(L(),M(W,{key:0},{default:l(()=>[t(C,{onClick:D,theme:"danger",loading:P.value},{default:l(()=>i[6]||(i[6]=[x("保存")])),_:1},8,["loading"])]),_:1})):(L(),M(W,{key:1},{default:l(()=>[t(C,{onClick:f,theme:"danger",loading:P.value},{default:l(()=>i[7]||(i[7]=[x("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(L(),M(N,{key:0,layout:"vertical",bordered:!0},{default:l(()=>[t(te,{label:"创建时间"},{default:l(()=>{var Z;return[x(K((Z=y.value)==null?void 0:Z.insertTime),1)]}),_:1}),t(te,{label:"更新时间"},{default:l(()=>{var Z;return[x(K((Z=y.value)==null?void 0:Z.updateTime),1)]}),_:1}),t(te,{label:"创建用户"},{default:l(()=>{var Z;return[x(K((Z=y.value)==null?void 0:Z.authorNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),i[8]||(i[8]=E("div",{id:"collectionEditDiv",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"]),t(ee,{visible:I.value,"onUpdate:visible":i[3]||(i[3]=Z=>I.value=Z),onConfirm:w,header:m.value,"confirm-loading":A.value},{default:l(()=>[i[9]||(i[9]=E("div",{style:{"margin-bottom":"10px"}},[E("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(ie,{modelValue:c.value,"onUpdate:modelValue":i[2]||(i[2]=Z=>c.value=Z),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),xt=oe(eo,[["__scopeId","data-v-2f7847b3"]]),to=["innerHTML"];function Tt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Me(e)}const ao=ae({__name:"JudgeJobList",setup(e){const a=pe(),n=Ue(),{globalProperties:s}=re();let o=!1,d=null,_;const P=p(!1),I=p(null),y=p(null),b=p(!1);let r=-1;const u=p({problemId:"",username:"",language:void 0,status:void 0}),g=p([{title:"ID",colKey:"id",cell:(h,C)=>t(O,{variant:"text",onClick:()=>z(C.row.id)},{default:()=>[C.row.id]})},{title:"问题",colKey:"problemId",cell:(h,C)=>{if(r){let $;return t(O,{variant:"text",onClick:()=>D(r,C.row.contestProblemIndex)},Tt($=qe(C.row.contestProblemIndex))?$:{default:()=>[$]})}return t(O,{variant:"text",onClick:()=>f(C.row.problemId)},{default:()=>[C.row.problemId]})}},{title:"状态",colKey:"status",align:"center",cell:(h,C)=>{const $=C.row.status,G=ot($),q=ta($);let Y=[];return Oe($)&&Y.push(t(Ce,{text:C.row.state,size:"small",class:"dida-status-loading"},null)),Y.push(t("span",null,[G])),t(O,{theme:q,variant:"outline",onClick:()=>z(C.row.id)},Tt(Y)?Y:{default:()=>[Y]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"code",cell:(h,C)=>t(O,{theme:"default",onClick:()=>w(C.row)},{default:()=>[C.row.language+" / "+C.row.codeLength]})},{title:"作者",colKey:"author",width:200,cell:(h,C)=>t(O,{variant:"text",onClick:()=>j(C.row.authorUsername)},{default:()=>[C.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),k=p(!1);let m=1,c=50;const S=p({current:m,pageSize:c,defaultCurrent:m,defaultPageSize:c,total:0,pageSizeOptions:[50,100]}),A=p(),V=p([]);V.value=wt();const R=p([]);R.value=aa();const w=async h=>{b.value=!0,P.value=!0;try{I.value=h;const C=await Xl(Number(I.value.id));if(C.code===0){const $=C.data,q=`\`\`\`${kt($.language)}
${$.code}
\`\`\``,Y={};I.value.code=await ue.md2html(q,Y),await Le(()=>{y.value&&(ue.highlightRender({lineNumber:!0,enable:!0},y.value),Ge(y.value))})}else H(s,C.code)}finally{b.value=!1}},f=h=>{h&&n.push({path:"/problem/"+h})},D=(h,C)=>{n.push({name:"contest-problem-detail",params:{contestId:h,problemIndex:C}})},z=h=>{h&&(r>0?n.push({name:"contest-judge-detail",params:{contestId:r,judgeId:h}}):n.push({name:"judge-detail",params:{judgeId:h}}))},j=h=>{h&&n.push({path:"/user/"+h})},v=async()=>{await n.push({query:{...a.query,page:1,page_size:c,problem_id:u.value.problemId,username:u.value.username,language:u.value.language,status:u.value.status}})},i=async()=>{u.value.problemId="",u.value.username="",u.value.language=void 0,u.value.status=void 0,await n.push({query:{...a.query,page:1,page_size:c,problem_id:"",username:"",language:void 0,status:void 0}})},U=async(h,C)=>{C&&(k.value=!0);let $=!1;try{const{current:G,pageSize:q}=h,Y=await Yl(r,u.value.problemId,u.value.username,u.value.language,u.value.status,G,q);A.value=[],Y.code===0?Y.data.list&&Y.data.list.length>0?(Y.data.list.forEach(te=>{var fe;const N=la(te);(fe=A.value)==null||fe.push(N),Oe(te.status)&&($=!0)}),S.value={...S.value,total:Y.data.total_count}):(_e(s,"未找到记录"),S.value={...S.value,total:0}):C&&H(s,Y.code)}catch(G){console.error(G),C&&H(s,Te())}finally{C&&(k.value=!1),$&&o&&(_=setTimeout(()=>{U({current:m,pageSize:c},!1)},5e3))}},T=async h=>{await n.push({query:{...a.query,page:h.current,page_size:h.pageSize}})};return ne(async()=>{o=!0,d=Ve(()=>a.query,h=>{Array.isArray(a.params.contestId)?r=Number(a.params.contestId[0]):r=Number(a.params.contestId),u.value.problemId=h.problem_id||"",u.value.username=h.username||"",h.language!=null?u.value.language=Number(h.language):u.value.language=void 0,h.status!=null?u.value.status=Number(h.status):u.value.status=void 0;const C=parseInt(h.page)||S.value.defaultCurrent,$=parseInt(h.page_size)||S.value.defaultPageSize;m=C,c=$,S.value.pageSizeOptions.includes(c)||(c=S.value.defaultPageSize),S.value={...S.value,current:m,pageSize:c},U({current:m,pageSize:c},!0)},{immediate:!0})}),Se(()=>{o=!1,d&&d(),clearTimeout(_)}),(h,C)=>{const $=$e,G=ze,q=bt,Y=rt,W=O,te=ve,N=De,fe=Ie,we=se,ie=Ne,ee=Ce,Z=He;return L(),X(Q,null,[t(we,{style:{margin:"10px"}},{default:l(()=>[t(N,{layout:"inline",onSubmit:v,onReset:i},{default:l(()=>[t(G,{label:"题号"},{default:l(()=>[t($,{modelValue:u.value.problemId,"onUpdate:modelValue":C[0]||(C[0]=F=>u.value.problemId=F),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(G,{label:"用户"},{default:l(()=>[t($,{modelValue:u.value.username,"onUpdate:modelValue":C[1]||(C[1]=F=>u.value.username=F),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(G,{label:"语言"},{default:l(()=>[t(Y,{modelValue:u.value.language,"onUpdate:modelValue":C[2]||(C[2]=F=>u.value.language=F),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:l(()=>[(L(!0),X(Q,null,de(V.value,F=>(L(),M(q,{key:F.value,value:F.value,label:F.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(G,{label:"状态"},{default:l(()=>[t(Y,{modelValue:u.value.status,"onUpdate:modelValue":C[3]||(C[3]=F=>u.value.status=F),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:l(()=>[(L(!0),X(Q,null,de(R.value,F=>(L(),M(q,{key:F.value,value:F.value,label:F.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(G,null,{default:l(()=>[t(te,null,{default:l(()=>[t(W,{theme:"primary",type:"submit"},{default:l(()=>C[7]||(C[7]=[x("搜索")])),_:1}),t(W,{theme:"default",variant:"base",type:"reset"},{default:l(()=>C[8]||(C[8]=[x("重置")])),_:1})]),_:1})]),_:1})]),_:1}),t(fe,{data:A.value,columns:g.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:S.value,loading:k.value,onPageChange:T,"table-layout":"auto"},null,8,["data","columns","pagination","loading"])]),_:1}),t(Z,{visible:P.value,"onUpdate:visible":C[5]||(C[5]=F=>P.value=F),width:"800px","cancel-btn":null,"close-btn":!1,onConfirm:C[6]||(C[6]=F=>P.value=!1)},{header:l(()=>[t(ie,{onClick:C[4]||(C[4]=()=>{var F;z((F=I.value)==null?void 0:F.id)})},{default:l(()=>{var F,he;return[x(K(((F=I.value)==null?void 0:F.id)+" - "+((he=I.value)==null?void 0:he.language)),1)]}),_:1})]),default:l(()=>[t(ee,{loading:b.value},{default:l(()=>{var F;return[E("div",{innerHTML:(F=I.value)==null?void 0:F.code,ref_key:"markdownCodeRef",ref:y,style:{"min-height":"100px"}},null,8,to)]}),_:1},8,["loading"])]),_:1},8,["visible"])],64)}}}),jt=oe(ao,[["__scopeId","data-v-375cd905"]]),lo={class:"dida-code-container"},no=["innerHTML"],oo={key:2,class:"dida-edit-container"};function Lt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Me(e)}const so=ae({__name:"JudgeJobDetail",setup(e){const a=pe(),n=Ue(),s=xe(),{globalProperties:o}=re();let d=!1,_,P=-1;const I=p(""),y=p(null),b=p(""),r=p(null),u=p(0),g=p(null),k=p({from:"#5a96ff",to:"#00A870"});let m=!1;const c=p([{title:"ID",colKey:"id"},{title:"问题",colKey:"problemId",cell:(i,U)=>t(O,{variant:"text",onClick:()=>f(U.row.problemId)},{default:()=>[U.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(i,U)=>{const T=U.row.status,h=ot(T),C=ta(T);let $=[];return Oe(T)&&$.push(t(Ce,{text:U.row.state,size:"small",class:"dida-status-loading"},null)),$.push(t("span",null,[h])),t(O,{theme:C,variant:"outline"},Lt($)?$:{default:()=>[$]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"language",cell:(i,U)=>t("span",null,[U.row.language+" / "+U.row.codeLength])},{title:"作者",colKey:"author",width:200,cell:(i,U)=>t(O,{variant:"text",onClick:()=>D(U.row.authorUsername)},{default:()=>[U.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),S=p(!1),A=p(!1),V=p(),R=Re(()=>s.hasAuth(je.ManageJudge)),w=async()=>{if(!A.value){A.value=!0;try{const i=await tn(P);i.code===0?await j(!0):H(o,i.code)}catch(i){console.error(i),H(o,Te())}finally{A.value=!1}}},f=i=>{i&&n.push({path:"/problem/"+i})},D=i=>{i&&n.push({path:"/user/"+i})},z=i=>{const U=i.status,T=ot(U);let h;switch(U){case Pe.Init:case Pe.Rejudge:case Pe.Compiling:case Pe.Running:h="default";break;case Pe.Accept:h="success";break;case Pe.PE:h="warning";break;default:h="danger";break}return t(ve,null,{default:()=>[t(O,{theme:"default",variant:"outline"},{default:()=>[i.taskId]}),t(O,{theme:h,variant:"outline"},Lt(T)?T:{default:()=>[T]}),t("span",null,[x("分数："),i.score]),t("span",null,[x("用时："),i.time]),t("span",null,[x("内存："),i.memory])]})},j=async i=>{var T;i&&(S.value=!0);let U=!1;try{const h=await Jl(P);if(V.value=[],h.code===0){const C=h.data,$=la(C);if((T=V.value)==null||T.push($),C.judger){const q=await Yt(C.judger);I.value=q.name}else I.value="";k.value.to="#00A870",Oe(C.status)?(g.value="active",$.taskTotal>0?(u.value=$.taskCurrent/$.taskTotal*100,$.taskCurrent>=$.taskTotal&&(u.value=99)):u.value=0):(u.value=100,C.status===Pe.Accept?g.value="success":C.status===Pe.PE?(k.value.to="#F57C20",g.value="warning"):(k.value.to="#F56C6C",g.value="error"));const G={};if(C.code){const Y=`\`\`\`${kt(C.language)}
${C.code}
\`\`\``;b.value=await ue.md2html(Y,G),await Le(()=>{r.value&&(m||(m=!0,ue.highlightRender({lineNumber:!0,enable:!0},r.value)),Ge(r.value))})}y.value=$,Oe(C.status)&&(U=!0)}else i&&H(o,h.code)}catch(h){console.error(h),i&&H(o,Te())}finally{i&&(S.value=!1),U&&d&&(_=setTimeout(()=>{j(!1)},5e3))}};function v(){r.value&&r.value.parentElement&&(r.value.style.maxWidth=r.value.parentElement.clientWidth+"px")}return ne(async()=>{if(d=!0,Array.isArray(a.params.judgeId)?P=Number(a.params.judgeId[0]):P=Number(a.params.judgeId),!P){await n.push({name:"judge"});return}await j(!0),v(),window.addEventListener("resize",v)}),Se(()=>{d=!1,window.removeEventListener("resize",v),clearTimeout(_)}),(i,U)=>{var fe,we,ie;const T=Ot,h=Ie,C=se,$=be,G=Ke,q=Ee,Y=ge,W=Bt,te=Wt,N=O;return L(),X(Q,null,[t(T,{color:k.value,status:g.value,class:"dida-job-progress",percentage:u.value},null,8,["color","status","percentage"]),t(C,{style:{margin:"10px"}},{default:l(()=>[t(h,{data:V.value,columns:c.value,"row-key":"id","vertical-align":"top",hover:!0,loading:S.value},null,8,["data","columns","loading"])]),_:1}),t(Y,null,{default:l(()=>[t($,{span:8},{default:l(()=>[E("div",lo,[E("div",{innerHTML:b.value,ref_key:"markdownCodeRef",ref:r,class:"dida-code-div"},null,8,no)])]),_:1}),t($,{span:4},{default:l(()=>[t(q,{layout:"vertical",bordered:!0,style:{margin:"10px"}},{default:l(()=>[t(G,{label:"判题机"},{default:l(()=>[x(K(I.value),1)]),_:1}),t(G,{label:"判题时间"},{default:l(()=>{var ee;return[x(K((ee=y.value)==null?void 0:ee.judgeTime),1)]}),_:1})]),_:1})]),_:1})]),_:1}),(fe=y.value)!=null&&fe.compileMessage?(L(),M(C,{key:0,class:"compile-message"},{default:l(()=>{var ee;return[x(K((ee=y.value)==null?void 0:ee.compileMessage),1)]}),_:1})):le("",!0),(we=y.value)!=null&&we.task&&((ie=y.value)==null?void 0:ie.task.length)>0?(L(),M(te,{key:1,class:"task-panel"},{default:l(()=>{var ee;return[(L(!0),X(Q,null,de((ee=y.value)==null?void 0:ee.task,(Z,F)=>(L(),M(W,{key:Z.taskId,header:()=>z(Z)},{default:l(()=>[x(K(Z.content)+" "+K(Z.waHint),1)]),_:2},1032,["header"]))),128))]}),_:1})):le("",!0),R.value?(L(),X("div",oo,[t(N,{onClick:w,loading:A.value},{default:l(()=>U[0]||(U[0]=[x("重新评测")])),_:1},8,["loading"])])):le("",!0)],64)}}}),Vt=oe(so,[["__scopeId","data-v-574eda0b"]]),ro={style:{margin:"10px"}},uo=ae({__name:"ContestList",setup(e){const a=pe(),n=Ue(),{globalProperties:s}=re();let o=null;const d=p(!1),_=p(!1),P=p([{title:"ID",colKey:"id",width:"100",cell:(w,f)=>t(O,{variant:"text",onClick:()=>m(f.row.id)},{default:()=>[f.row.id]})},{title:"标题",colKey:"title",cell:(w,f)=>t(O,{variant:"text",onClick:()=>m(f.row.id)},{default:()=>[f.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),I=p(!1);let y=1,b=50;const r=p({current:y,pageSize:b,defaultCurrent:y,defaultPageSize:b,total:0,pageSizeOptions:[50,100]}),u=p(),g=p({title:"",username:""}),k=p({title:"",description:"",open_time:[]}),m=w=>{w&&n.push({path:"/contest/"+w})},c=async()=>{await n.push({query:{...a.query,title:g.value.title,username:g.value.username,page:1,page_size:r.value.defaultPageSize}})},S=async(w,f)=>{var D;I.value=!0;try{const{current:z,pageSize:j}=w,v=await gn(z,j);if(u.value=[],v.code===0){const i=v.data.list;for(let U=0;U<i.length;U++){const T=i[U],h=await ra(T);(D=u.value)==null||D.push(h)}r.value={...r.value,total:v.data.total_count}}else f&&H(s,v.code)}catch(z){console.error(z),H(s,Te())}finally{I.value=!1}},A=async w=>{await n.push({query:{...a.query,page:w.current,page_size:w.pageSize}})},V=()=>{d.value=!0},R=async()=>{_.value=!0,console.log("contestCreateForm",k.value),hn(k.value).then(w=>{w.code===0?(_e(s,"创建比赛成功"),d.value=!1,n.push({path:"/contest/"+w.data.id})):H(s,w.code)}).finally(()=>{_.value=!1})};return ne(async()=>{o=Ve(()=>a.query,w=>{g.value.title=w.title||"",g.value.username=w.username||"";const f=parseInt(w.page)||r.value.defaultCurrent,D=parseInt(w.page_size)||r.value.defaultPageSize;y=f,b=D,r.value={...r.value,current:y,pageSize:b},S({current:y,pageSize:b},!0)},{immediate:!0})}),Se(()=>{o&&o()}),(w,f)=>{const D=Ie,z=se,j=be,v=$e,i=ze,U=O,T=De,h=ve,C=ge,$=Ht,G=He;return L(),X(Q,null,[t(C,null,{default:l(()=>[t(j,{span:9},{default:l(()=>[t(z,{style:{margin:"10px"}},{default:l(()=>[t(D,{data:u.value,columns:P.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:r.value,loading:I.value,onPageChange:A},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(j,{span:3},{default:l(()=>[E("div",ro,[t(z,{class:"sh-card"},{default:l(()=>[t(T,{model:g.value},{default:l(()=>[t(i,{label:"标题"},{default:l(()=>[t(v,{modelValue:g.value.title,"onUpdate:modelValue":f[0]||(f[0]=q=>g.value.title=q),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(i,{label:"负责人"},{default:l(()=>[t(v,{modelValue:g.value.username,"onUpdate:modelValue":f[1]||(f[1]=q=>g.value.username=q),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(i,null,{default:l(()=>[t(U,{theme:"primary",onClick:c},{default:l(()=>f[6]||(f[6]=[x("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(z,{class:"sh-card"},{default:l(()=>[t(h,null,{default:l(()=>[t(U,{onClick:V},{default:l(()=>f[7]||(f[7]=[x("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),t(G,{visible:d.value,"onUpdate:visible":f[5]||(f[5]=q=>d.value=q),header:"创建比赛",onConfirm:R,"confirm-loading":_.value},{default:l(()=>[t(T,{"label-width":80,model:k.value,onSubmit:f[4]||(f[4]=Xe(()=>{},["prevent"]))},{default:l(()=>[t(i,{label:"标题"},{default:l(()=>[t(v,{modelValue:k.value.title,"onUpdate:modelValue":f[2]||(f[2]=q=>k.value.title=q),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),t(i,{label:"开启时间"},{default:l(()=>[t($,{"enable-time-picker":"","allow-input":"",clearable:"",modelValue:k.value.open_time,"onUpdate:modelValue":f[3]||(f[3]=q=>k.value.open_time=q)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Dt=oe(uo,[["__scopeId","data-v-3e6ea683"]]),io={style:{margin:"20px"}},co={style:{margin:"12px"}},mo=["innerHTML"],po=ae({__name:"ContestDetail",setup(e){let a=pe();const{globalProperties:n}=re(),s=Ae();let o=0;const d=p(!1),_=p(null),P=p([{title:"问题ID",colKey:"id",cell:(b,r)=>t(O,{variant:"text",onClick:()=>y(o,r.row.index)},{default:()=>[r.row.id]})},{title:"标题",colKey:"title",cell:(b,r)=>t(O,{variant:"text",onClick:()=>y(o,r.row.index)},{default:()=>[r.row.title]})},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),I=p([]),y=(b,r)=>{B.push({name:"contest-problem-detail",params:{contestId:b,problemIndex:r}})};return ne(async()=>{if(Array.isArray(a.params.contestId)?o=Number(a.params.contestId[0]):o=Number(a.params.contestId),!o){await B.push({name:"contest"});return}d.value=!0;const b=await vn(o);if(b.code!==0){d.value=!1,H(n,b.code),await B.push({name:"contest"});return}_.value=await ra(b.data),I.value=_.value.problems,s.setTitle(_.value.title+" - "+s.getTitle),await Le(()=>{const r=document.querySelectorAll(".dida-content-description");r&&r.length>0&&r.forEach(u=>{ue.mathRender(u),ue.highlightRender({lineNumber:!0,enable:!0},u),Ge(u)}),d.value=!1})}),(b,r)=>{const u=gt,g=Ie,k=se,m=be,c=Ke,S=Ee,A=O,V=ve,R=Bt,w=Wt,f=ge,D=Ce;return L(),M(D,{loading:d.value},{default:l(()=>{var z,j,v;return[E("div",io,[E("h1",null,K((z=_.value)==null?void 0:z.title),1),(j=_.value)!=null&&j.notification?(L(),M(u,{key:0,theme:"info",message:(v=_.value)==null?void 0:v.notification},null,8,["message"])):le("",!0)]),t(f,{class:"dida-main-content"},{default:l(()=>[t(m,{span:6},{default:l(()=>[t(k,{style:{margin:"10px"}},{default:l(()=>[t(g,{data:I.value,columns:P.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1})]),_:1}),t(m,{span:6},{default:l(()=>[E("div",co,[t(S,{layout:"vertical",bordered:!0},{default:l(()=>[t(c,{label:"开始时间"},{default:l(()=>{var i;return[x(K((i=_.value)==null?void 0:i.startTime),1)]}),_:1})]),_:1}),t(S,{layout:"vertical",bordered:!0},{default:l(()=>[t(c,{label:"结束时间"},{default:l(()=>{var i;return[x(K((i=_.value)==null?void 0:i.endTime),1)]}),_:1})]),_:1})]),t(w,{"default-value":[0],"expand-icon":!1,borderless:!0},{default:l(()=>{var i;return[(L(!0),X(Q,null,de((i=_.value)==null?void 0:i.descriptions,(U,T)=>(L(),M(R,{key:T,header:U.title},pt({default:l(()=>[E("div",{innerHTML:U.content,class:"dida-content-description"},null,8,mo)]),_:2},[T===0?{name:"headerRightContent",fn:l(()=>[t(V,{size:"small"},{default:l(()=>[t(A,{size:"small"},{default:l(()=>r[0]||(r[0]=[x("收起全部")])),_:1}),t(A,{size:"small"},{default:l(()=>r[1]||(r[1]=[x("展开全部")])),_:1})]),_:1})]),key:"0"}:void 0]),1032,["header"]))),128))]}),_:1})]),_:1})]),_:1})]}),_:1},8,["loading"])}}}),fo=oe(po,[["__scopeId","data-v-fd97176d"]]);function zt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Me(e)}const _o=ae({__name:"ContestRank",setup(e){const a=pe(),n=Ue(),{globalProperties:s}=re();let o=null,d=0;const _=p(null),P=p(null);let I=null;const y=c=>{if(c==null)return"-";const S=Math.floor(c/3600).toString().padStart(2,"0"),A=Math.floor(c%3600/60).toString().padStart(2,"0"),V=(c%60).toString().padStart(2,"0");return`${S}:${A}:${V}`},b=[{title:"Rank",colKey:"rank",align:"center",fixed:"left",cell:(c,S)=>t(O,{variant:"text",onClick:()=>n.push({name:"contest-user-rank",params:{contestId:d,userId:S.row.user_id}})},{default:()=>[S.row.rank]})},{title:"昵称",colKey:"nickname",fixed:"left",cell:(c,S)=>{const A=hl(S.row.nickname,18);return t(Ua,{content:S.row.nickname},{default:()=>[t(O,{variant:"text",onClick:()=>n.push({name:"user",params:{username:S.row.username}})},zt(A)?A:{default:()=>[A]})]})}},{title:"Solved",colKey:"solved",align:"center",fixed:"left",cell:(c,S)=>t(O,{variant:"text",onClick:()=>n.push({name:"contest-judge",params:{contestId:d},query:{username:S.row.username,status:Pe.Accept}})},{default:()=>[S.row.solved]})},{title:"Penalty",colKey:"penalty",align:"center",fixed:"left",cell:(c,S)=>y(S.row.penalty)}],r=p([]),u=p(!1),g=p(),k=async c=>{u.value=!0;try{const S=await bn(d);if(r.value=b,g.value=[],S.code===0){S.data.problems.sort((w,f)=>w-f),S.data.problems.forEach((w,f)=>{r.value.push({title:qe(w),colKey:`problem_${w}`,align:"center",title:(D,{colIndex:z})=>{let j;return t(O,{variant:"text",onClick:()=>n.push({name:"contest-problem-detail",params:{contestId:d,problemIndex:w}})},zt(j=qe(w))?j:{default:()=>[j]})},cell:(D,z)=>{const j=z.row[`problem_${w}`];if(!j)return"";let v="";return j.acDuration>=0&&(v=y(j.acDuration)),j.attempt>0&&(v&&(v+=" "),v+=`(-${j.attempt})`),t("span",null,[v])},attrs:D=>{const z=D.row[`problem_${w}`];return z?z.acDuration>=0?{style:{backgroundColor:"rgba(130,255,30,0.5)"}}:{style:{backgroundColor:"rgba(255,120,120,0.5)"}}:{}}})});const A=new Date(S.data.start_time),V=S.data.ranks,R=[];for(let w=0;w<V.length;w++){const f=V[w];let D={username:f.author_username,nickname:f.author_nickname},z=0,j=0;f.problems.forEach((v,i)=>{let U=-1;v.ac&&(z++,U=(new Date(v.ac).getTime()-A.getTime())/1e3,j+=U,j+=v.attempt*20*60);const T=v.index;D[`problem_${T}`]={acDuration:U,attempt:v.attempt}}),D.solved=z,D.penalty=j,R.push(D)}R.sort((w,f)=>w.solved!==f.solved?f.solved-w.solved:w.penalty-f.penalty);for(let w=0;w<R.length;w++)R[w].rank=w+1;g.value=R}else c&&H(s,S.code)}catch(S){console.error(S),H(s,Te())}finally{u.value=!1}};function m(){if(P.value){const c=P.value.parentElement.clientWidth;console.log("Parent width:",c),P.value.style.width=c+"px"}}return ne(async()=>{o=Ve(()=>a.query,async c=>{if(Array.isArray(a.params.contestId)?d=Number(a.params.contestId[0]):d=Number(a.params.contestId),!d){await n.push({name:"contest"});return}await k(!0),m(),I=new ResizeObserver(m),_.value&&I.observe(_.value)},{immediate:!0})}),Se(()=>{o&&o(),I&&_.value&&I.unobserve(_.value)}),(c,S)=>{const A=Ie,V=se,R=ge;return L(),M(R,null,{default:l(()=>[t(V,{style:{margin:"10px",width:"100%"}},{default:l(()=>[E("div",{ref_key:"scrollWrapper",ref:_},[E("div",{ref_key:"tableWrapper",ref:P,style:{width:"0"}},[t(A,{data:g.value,columns:r.value,"row-key":"id","vertical-align":"top",hover:!0,"table-layout":"auto",loading:u.value},null,8,["data","columns","loading"])],512)],512)]),_:1})]),_:1})}}});function ua(e){const a={};return a.id=e.id,a.authorId=e.author_id,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.title=e.title,a.content=e.content,e.insert_time&&(a.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(a.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(a.updateTime=new Date(e.update_time).toLocaleString()),a.problemId=e.problem_id,a.problemTitle=e.problem_title,a.contestId=e.contest_id,a.contestTitle=e.contest_title,a.contestProblemIndex=e.contest_problem_index,a}async function vo(e){const a={};if(a.id=e.id,a.authorId=e.author_id,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.content="",e.content){const n={math:{inlineDigit:!0,engine:"KaTeX"}};a.content=await ue.md2html(e.content,n)}return e.insert_time&&(a.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(a.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(a.updateTime=new Date(e.update_time).toLocaleString()),a}function go(e){return J({url:"/discuss?id="+e,method:"get"})}function bo(e,a,n,s,o,d){const _={};return e&&(_.contest_id=e),a&&(_.problem_id=a),n&&(_.title=n),s&&(_.username=s),o&&(_.page=o),d&&(_.page_size=d),J({url:`/discuss/list?${new URLSearchParams(_).toString()}`,method:"get"})}function ho(e,a,n){return J({url:"/discuss/comment/list?id="+e+"&page="+a+"&page_size="+n,method:"get"})}function yo(e){return J({url:"/discuss/create",method:"post",data:e})}const ia=async(e,a)=>{a&&await e.push({name:"user",params:{username:a}})},wo={style:{margin:"10px"}};function ko(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Me(e)}const Co=ae({__name:"DiscussList",setup(e){const a=pe(),n=Ue(),{globalProperties:s}=re();let o=null;const d=p(!1),_=p(!1);let P=-1;const I=p([]),y=[],b=[{title:"标题",colKey:"title",cell:(v,i)=>t(O,{variant:"text",onClick:()=>R(i.row.id)},{default:()=>[i.row.title]})},{title:"创建人",colKey:"authorNickname",width:"200",cell:(v,i)=>t(O,{variant:"text",onClick:async()=>await ia(n,i.row.authorUsername)},{default:()=>[i.row.authorNickname]})},{title:"创建时间",colKey:"insertTime",width:"180"},{title:"更新时间",colKey:"updateTime",width:"180"}],r=p(!1);let u=1,g=50;const k=p({current:u,pageSize:g,defaultCurrent:u,defaultPageSize:g,total:0,pageSizeOptions:[50,100]}),m=p(),c=p({problemId:"",title:"",username:""}),S=p({title:"",content:""}),A=v=>{v&&n.push({name:"problem-detail",params:{problemId:v}})},V=(v,i)=>{n.push({name:"contest-problem-detail",params:{contestId:v,problemIndex:i}})},R=v=>{if(v){if(P){n.push({name:"contest-discuss-detail",params:{contestId:P,discussId:v}});return}n.push({name:"discuss-detail",params:{discussId:v}})}},w=async()=>{await n.push({query:{...a.query,problem_id:c.value.problemId,title:c.value.title,username:c.value.username,page:1,page_size:k.value.defaultPageSize}})},f=async(v,i)=>{var U;r.value=!0;try{const{current:T,pageSize:h}=v,C=await bo(P,c.value.problemId,c.value.title,c.value.username,T,h);if(m.value=[],C.code===0){if(C.data.list){const $=C.data.list;for(let G=0;G<$.length;G++){const q=$[G],Y=await ua(q);(U=m.value)==null||U.push(Y)}}k.value={...k.value,total:C.data.total_count}}else i&&H(s,C.code)}catch(T){console.error(T),H(s,Te())}finally{r.value=!1}},D=async v=>{await n.push({query:{...a.query,page:v.current,page_size:v.pageSize}})},z=()=>{d.value=!0},j=async()=>{_.value=!0,console.log("discussCreateForm",S.value),yo(S.value).then(v=>{v.code===0?(_e(s,"创建比赛成功"),d.value=!1,n.push({path:"/discuss/"+v.data.id})):H(s,v.code)}).finally(()=>{_.value=!1})};return ne(async()=>{o=Ve(()=>a.query,v=>{Array.isArray(a.params.contestId)?P=Number(a.params.contestId[0]):P=Number(a.params.contestId),I.value=y,P?I.value=I.value.concat([{title:"问题ID",colKey:"contestProblemIndex",width:"100",cell:(T,h)=>{let C;return h.row.contestProblemIndex?t(O,{variant:"text",onClick:()=>V(P,h.row.contestProblemIndex)},ko(C=qe(h.row.contestProblemIndex))?C:{default:()=>[C]}):""}}]):I.value=I.value.concat([{title:"问题ID",colKey:"problemId",width:"100",cell:(T,h)=>h.row.problemId?t(O,{variant:"text",onClick:()=>A(h.row.problemId)},{default:()=>[h.row.problemId]}):""}]),I.value=I.value.concat(b),c.value.problemId=v.problem_id||"",c.value.title=v.title||"",c.value.username=v.username||"";const i=parseInt(v.page)||k.value.defaultCurrent,U=parseInt(v.page_size)||k.value.defaultPageSize;u=i,g=U,k.value={...k.value,current:u,pageSize:g},f({current:u,pageSize:g},!0)},{immediate:!0})}),Se(()=>{o&&o()}),(v,i)=>{const U=Ie,T=se,h=be,C=$e,$=ze,G=O,q=De,Y=ve,W=ge,te=He;return L(),X(Q,null,[t(W,null,{default:l(()=>[t(h,{span:9},{default:l(()=>[t(T,{style:{margin:"10px"}},{default:l(()=>[t(U,{data:m.value,columns:I.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:k.value,loading:r.value,"table-layout":"auto",onPageChange:D},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(h,{span:3},{default:l(()=>[E("div",wo,[t(T,{class:"sh-card"},{default:l(()=>[t(q,{model:c.value},{default:l(()=>[t($,{label:"问题ID"},{default:l(()=>[t(C,{modelValue:c.value.problemId,"onUpdate:modelValue":i[0]||(i[0]=N=>c.value.problemId=N),placeholder:"请输入完整问题ID"},null,8,["modelValue"])]),_:1}),t($,{label:"标题"},{default:l(()=>[t(C,{modelValue:c.value.title,"onUpdate:modelValue":i[1]||(i[1]=N=>c.value.title=N),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t($,{label:"创建人"},{default:l(()=>[t(C,{modelValue:c.value.username,"onUpdate:modelValue":i[2]||(i[2]=N=>c.value.username=N),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t($,null,{default:l(()=>[t(G,{theme:"primary",onClick:w},{default:l(()=>i[6]||(i[6]=[x("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(T,{class:"sh-card"},{default:l(()=>[t(Y,null,{default:l(()=>[t(G,{onClick:z},{default:l(()=>i[7]||(i[7]=[x("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),t(te,{visible:d.value,"onUpdate:visible":i[5]||(i[5]=N=>d.value=N),header:"创建讨论",onConfirm:j,"confirm-loading":_.value},{default:l(()=>[t(q,{"label-width":80,model:S.value,onSubmit:i[4]||(i[4]=Xe(()=>{},["prevent"]))},{default:l(()=>[t($,{label:"标题"},{default:l(()=>[t(C,{modelValue:S.value.title,"onUpdate:modelValue":i[3]||(i[3]=N=>S.value.title=N),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),at=oe(Co,[["__scopeId","data-v-428fc50f"]]),So={key:0,style:{margin:"20px"}},Io=["innerHTML"],Po=["innerHTML"],xo={style:{margin:"10px"}},To={style:{margin:"10px"}},jo={style:{margin:"10px","text-align":"right"}},Lo={style:{margin:"12px"}},Vo={key:0,class:"dida-edit-container"},Do=ae({__name:"DiscussDetail",props:{discussId:{}},setup(e){const a=e;let n=pe();const{globalProperties:s}=re();let o=null;const d=Ae(),_=xe();let P=p("");const I=p(""),y=p(null),b=p(!1),r=p(null),u=p(!1);let g=1,k=20;const m=p({current:1,total:0,defaultPageSize:k,defaultCurrent:g,pageSizeOptions:[20,50]}),c=p([]),S={},A=Re(()=>_.hasAuth(je.ManageDiscuss)),V=j=>{j&&B.push({name:"discuss-list",query:{...n.query,title:"",tag:j.name}})},R=()=>{B.push({name:"manage-discuss",params:{discussId:I.value}})},w=()=>t("div",{class:"t-pagination__total"},[`共 ${m.value.total} 条回复`]),f=()=>{},D=async(j,v)=>{var i;u.value=!0;try{const{current:U,pageSize:T}=j,h=await ho(I.value,U,T);if(c.value=[],h.code===0){const C=h.data.list;if(C)for(let $=0;$<C.length;$++){const G=C[$],q=await vo(G);(i=c.value)==null||i.push(q),await Le(()=>{const Y=document.querySelectorAll(".dida-discuss-content");Y&&Y.length>0&&Y.forEach(W=>{ue.mathRender(W),ue.highlightRender({lineNumber:!0,enable:!0},W),Ge(W)})})}m.value={...m.value,total:h.data.total_count}}else v&&H(s,h.code)}catch(U){console.error(U),H(s,Te())}finally{u.value=!1}},z=async j=>{await B.push({query:{...n.query,page:j.current,page_size:j.pageSize}})};return ne(async()=>{if(I.value=a.discussId,I.value||(Array.isArray(n.params.discussId)?I.value=n.params.discussId[0]:I.value=n.params.discussId),!I.value){ce(s,"讨论不存在"),await B.push({name:"discuss"});return}b.value=!0;const j=await go(I.value);if(j.code!==0){b.value=!1,H(s,j.code),await B.push({name:"discuss"});return}j.data.tags&&j.data.tags.forEach(T=>{S[T.id]=T}),r.value=ua(j.data.discuss),d.setTitle(r.value.title+" - "+d.getTitle);let v=r.value.content;const i={math:{inlineDigit:!0,engine:"KaTeX"}};P.value=await ue.md2html(v,i),await Le(()=>{y.value&&(ue.mathRender(y.value),ue.highlightRender({lineNumber:!0,enable:!0},y.value),Ge(y.value)),b.value=!1}),o=Ve(()=>n.query,T=>{const h=parseInt(T.page)||m.value.defaultCurrent,C=parseInt(T.page_size)||m.value.defaultPageSize;g=h,k=C,m.value={...m.value,current:g,pageSize:k},D({current:g,pageSize:k},!0)},{immediate:!0});const U={after:()=>{}};new ue("commentEditRef",U)}),Se(()=>{o&&o()}),(j,v)=>{const i=Nt,U=Gt,T=se,h=ve,C=Aa,$=O,G=be,q=Ke,Y=Ee,W=ge,te=Ce;return L(),M(te,{loading:b.value},{default:l(()=>[t(W,{class:"dida-main-content"},{default:l(()=>[t(G,{span:8},{default:l(()=>{var N,fe,we;return[(N=r.value)!=null&&N.problemTitle||(fe=r.value)!=null&&fe.contestTitle?(L(),X("div",So,[t(U,{"max-item-width":"300"},{default:l(()=>{var ie,ee,Z,F,he;return[(ie=r.value)!=null&&ie.contestTitle?(L(),X(Q,{key:0},[t(i,{to:{name:"contest-detail",params:{contestId:(ee=r.value)==null?void 0:ee.contestId}}},{default:l(()=>{var ke;return[x(K((ke=r.value)==null?void 0:ke.contestTitle),1)]}),_:1},8,["to"]),(Z=r.value)!=null&&Z.contestProblemIndex?(L(),M(i,{key:0,to:{name:"contest-problem-detail",params:{problemIndex:(F=r.value)==null?void 0:F.contestProblemIndex}}},{default:l(()=>{var ke,We;return[x(K(me(qe)((ke=r.value)==null?void 0:ke.contestProblemIndex))+" - "+K((We=r.value)==null?void 0:We.problemTitle),1)]}),_:1},8,["to"])):le("",!0)],64)):(L(),X(Q,{key:1},[t(i,{to:{name:"discuss-list-problem"}},{default:l(()=>v[3]||(v[3]=[x(" 问题讨论")])),_:1}),t(i,{to:{name:"problem-detail",params:{problemId:(he=r.value)==null?void 0:he.problemId}}},{default:l(()=>{var ke;return[x(K((ke=r.value)==null?void 0:ke.problemTitle),1)]}),_:1},8,["to"])],64))]}),_:1})])):le("",!0),t(T,{style:{margin:"10px"},header:(we=r.value)==null?void 0:we.title,"header-bordered":!0},{default:l(()=>[E("div",{innerHTML:me(P),class:"dida-discuss-content"},null,8,Io)]),_:1},8,["header"]),(L(!0),X(Q,null,de(c.value,(ie,ee)=>(L(),M(T,{key:ee,style:{margin:"10px"},"header-bordered":""},{header:l(()=>[t(h,null,{default:l(()=>[E("span",null,K(ie.authorNickname),1),E("span",null,K(ie.insertTime),1)]),_:2},1024)]),default:l(()=>[E("div",{innerHTML:ie.content,class:"dida-discuss-content"},null,8,Po)]),_:2},1024))),128)),E("div",xo,[t(C,{modelValue:m.value.current,"onUpdate:modelValue":v[0]||(v[0]=ie=>m.value.current=ie),"page-size":m.value.pageSize,"onUpdate:pageSize":v[1]||(v[1]=ie=>m.value.pageSize=ie),total:m.value.total,"page-size-options":m.value.pageSizeOptions,"show-page-size":!1,"total-content":w,onChange:z},null,8,["modelValue","page-size","total","page-size-options"])]),E("div",To,[v[5]||(v[5]=E("div",{id:"commentEditRef",class:"dida-comment-editor"},null,-1)),E("div",jo,[t(h,null,{default:l(()=>[t($,{theme:"primary",onClick:f},{default:l(()=>v[4]||(v[4]=[x("提交")])),_:1})]),_:1})])])]}),_:1}),t(G,{span:4},{default:l(()=>[E("div",Lo,[A.value?(L(),X("div",Vo,[t($,{onClick:R},{default:l(()=>v[6]||(v[6]=[x("编辑")])),_:1})])):le("",!0),t(Y,{layout:"vertical",bordered:!0},{default:l(()=>[t(q,{label:"创建时间"},{default:l(()=>{var N;return[x(K((N=r.value)==null?void 0:N.insertTime),1)]}),_:1}),t(q,{label:"编辑时间"},{default:l(()=>{var N;return[x(K((N=r.value)==null?void 0:N.modifyTime),1)]}),_:1}),t(q,{label:"更新时间"},{default:l(()=>{var N;return[x(K((N=r.value)==null?void 0:N.updateTime),1)]}),_:1}),t(q,{label:"创建用户"},{default:l(()=>[t($,{variant:"text",onClick:v[2]||(v[2]=async()=>{var N;return await me(ia)(me(B),(N=r.value)==null?void 0:N.authorUsername)})},{default:l(()=>{var N;return[x(K((N=r.value)==null?void 0:N.authorNickname),1)]}),_:1})]),_:1}),t(q,{label:"标签"},{default:l(()=>[t(h,null,{default:l(()=>{var N;return[(L(!0),X(Q,null,de((N=r.value)==null?void 0:N.tags,fe=>(L(),M($,{key:fe.id,variant:"dashed",onClick:()=>V(fe)},{default:l(()=>[x(K(fe.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),it=oe(Do,[["__scopeId","data-v-03948cc8"]]);function zo(e,a){return J({url:"/rank/ac/all?page="+e+"&page_size="+a,method:"get"})}function $o(e,a){return J({url:"/rank/ac/problem?page="+e+"&page_size="+a,method:"get"})}function Uo(e,a){return J({url:"/rank/ac/problem/today?page="+e+"&page_size="+a,method:"get"})}function Ao(e,a){return J({url:"/rank/ac/problem/day7?page="+e+"&page_size="+a,method:"get"})}function Ro(e,a){return J({url:"/rank/ac/problem/year?page="+e+"&page_size="+a,method:"get"})}const Eo={style:{margin:"10px"}};function ct(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Me(e)}const Ko=ae({__name:"RankUser",props:{type:{}},setup(e){const a=pe(),n=Ue(),{globalProperties:s}=re();let o=null;const d=e,_=p(""),P=p(""),I={all:{header:"统计所有用户在本站的提交记录",content:"优先以AC记录数量排序，如果相同则提交所用次数较少的优先，如果仍相同，注册较早的用户靠前"},problem:{header:"统计所有用户在本站的提交记录",content:"以题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-today":{header:"统计所有用户今日在本站的提交记录",content:"以今日题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-day7":{header:"统计所有用户最近7日在本站的提交记录",content:"以7日题目记录数量排序（从7日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-year":{header:"统计所有用户最近1年在本站的提交记录",content:"以最近1年题目记录数量排序（从365日前的0点开始计算），如果相同，注册较早的用户靠前"}},y=p([]),b=[{title:"序号",colKey:"index"},{title:"用户名",colKey:"username",cell:(D,z)=>t(O,{variant:"dashed",onClick:()=>A(z.row.username)},{default:()=>[z.row.username]})},{title:"昵称",colKey:"nickname"},{title:"Slogan",colKey:"slogan"}],r=[{title:"题目数量",colKey:"problem_count",cell:(D,z)=>{let j=0;return z.row.problem_count&&(j=z.row.problem_count),t(O,{variant:"dashed",onClick:()=>V(z.row.username)},ct(j)?j:{default:()=>[j]})}}],u=[{title:"正确",colKey:"accept",cell:(D,z)=>{let j=0;return z.row.accept&&(j=z.row.accept),t(O,{variant:"dashed",onClick:()=>V(z.row.username)},ct(j)?j:{default:()=>[j]})}},{title:"提交",colKey:"attempt",cell:(D,z)=>{let j=0;return z.row.attempt&&(j=z.row.attempt),t(O,{variant:"dashed",onClick:()=>R(z.row.username)},ct(j)?j:{default:()=>[j]})}}],g=p(!1);let k=1,m=50;const c=p({current:k,pageSize:m,defaultCurrent:k,defaultPageSize:m,total:0,pageSizeOptions:[50]}),S=p(),A=D=>{n.push({name:"user",params:{username:D}})},V=D=>{n.push({name:"judge-list",query:{username:D,status:Pe.Accept}})},R=D=>{n.push({name:"judge-list",query:{username:D}})},w=async(D,z)=>{g.value=!0;try{S.value=[];const{current:j,pageSize:v}=D;let i=null;switch(d.type){case"problem":i=await $o(j,v);break;case"problem-today":i=await Uo(j,v);break;case"problem-day7":i=await Ao(j,v);break;case"problem-year":i=await Ro(j,v);break;default:i=await zo(j,v);break}if(i.code===0){const U=i.data.list;if(!U||U.length<=0){c.value={...c.value,total:0},_e(s,"未找到记录");return}S.value=[];const T=c.value.pageSize*(c.value.current-1);let h=1;U.forEach(C=>{var G;const $=C;$.index=T+h++,(G=S.value)==null||G.push($)}),c.value={...c.value,total:i.data.total_count}}else z&&H(s,i.code)}catch(j){console.error(j),H(s,Te())}finally{g.value=!1}},f=async D=>{await n.push({query:{...a.query,page:D.current,page_size:D.pageSize}})};return ne(async()=>{g.value=!0,o=Ve(()=>a.query,D=>{switch(d.type&&I[d.type]?(_.value=I[d.type].header,P.value=I[d.type].content):(_.value=I.all.header,P.value=I.all.content),d.type){case"all":y.value=b.concat(u);break;default:y.value=b.concat(r);break}const z=parseInt(D.page)||c.value.defaultCurrent,j=parseInt(D.page_size)||c.value.defaultPageSize;k=z,m=j,c.value={...c.value,current:k,pageSize:m},w({current:k,pageSize:m},!0)},{immediate:!0})}),Se(()=>{o&&o()}),(D,z)=>{const j=Ie,v=se,i=be,U=ge;return L(),M(U,null,{default:l(()=>[t(i,{span:9},{default:l(()=>[t(v,{style:{margin:"10px"}},{default:l(()=>[t(j,{data:S.value,columns:y.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:c.value,loading:g.value,"table-layout":"auto",onPageChange:f},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(i,{span:3},{default:l(()=>[E("div",Eo,[t(v,{class:"sh-card",header:_.value,"header-bordered":!0},{default:l(()=>[x(K(P.value),1)]),_:1},8,["header"])])]),_:1})]),_:1})}}}),Je=oe(Ko,[["__scopeId","data-v-9bbfd60b"]]),qo=ae({__name:"ManageJudge",setup(e){const{globalProperties:a}=re(),n=p(!1),s=p(!1),o=p({problemId:"",language:void 0,status:void 0}),d=p(!1),_=p([]);_.value=wt();const P=p([]);P.value=aa();const I=async()=>{n.value=!0;try{const r=await Zl();if(r.code!==0){H(a,r.code);return}_e(a,"重判成功"),await B.push({name:"judge-list"})}catch(r){console.error(r),H(a,"重判失败")}finally{n.value=!1}},y=async()=>{if(!o.value.problemId&&!o.value.language&&!o.value.status){H(a,"请输入问题Id");return}d.value=!0;try{const r=await Ql(o.value.problemId,o.value.language,o.value.status);if(r.code!==0){H(a,r.code);return}_e(a,"重判成功"),await B.push({name:"judge-list",query:{problem_id:o.value.problemId,language:o.value.language}})}catch(r){console.error(r),H(a,"重判失败")}finally{d.value=!1}},b=async()=>{s.value=!0;try{const r=await en();if(r.code!==0){H(a,r.code);return}_e(a,"重判成功"),await B.push({name:"judge-list"})}catch(r){console.error(r),H(a,"重判失败")}finally{s.value=!1}};return(r,u)=>{const g=O,k=se,m=$e,c=ze,S=bt,A=rt,V=ve,R=De;return L(),X(Q,null,[t(k,{class:"yj-manage-card",title:"重判最近提交"},{default:l(()=>[t(g,{onClick:I,loading:n.value},{default:l(()=>u[3]||(u[3]=[x("重判")])),_:1},8,["loading"])]),_:1}),t(k,{class:"yj-manage-card",title:"重判指定记录"},{default:l(()=>[t(R,{layout:"inline",onSubmit:y},{default:l(()=>[t(c,{label:"题号"},{default:l(()=>[t(m,{modelValue:o.value.problemId,"onUpdate:modelValue":u[0]||(u[0]=w=>o.value.problemId=w),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(c,{label:"语言"},{default:l(()=>[t(A,{modelValue:o.value.language,"onUpdate:modelValue":u[1]||(u[1]=w=>o.value.language=w),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:l(()=>[(L(!0),X(Q,null,de(_.value,w=>(L(),M(S,{key:w.value,value:w.value,label:w.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"状态"},{default:l(()=>[t(A,{modelValue:o.value.status,"onUpdate:modelValue":u[2]||(u[2]=w=>o.value.status=w),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:l(()=>[(L(!0),X(Q,null,de(P.value,w=>(L(),M(S,{key:w.value,value:w.value,label:w.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(c,null,{default:l(()=>[t(V,null,{default:l(()=>[t(g,{theme:"primary",type:"submit",loading:d.value},{default:l(()=>u[4]||(u[4]=[x("重判")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(k,{class:"yj-manage-card",title:"重判所有"},{default:l(()=>[t(g,{onClick:b,theme:"danger",loading:s.value},{default:l(()=>u[5]||(u[5]=[x("重判")])),_:1},8,["loading"])]),_:1})],64)}}}),Mo=oe(qo,[["__scopeId","data-v-6a706c72"]]),Fo={style:{margin:"10px"}},Go={key:1},No={style:{margin:"12px"}},Oo={class:"dida-edit-container"},Ho=ae({__name:"ProblemEdit",setup(e){let a=pe();const{globalProperties:n}=re(),s=Ae(),o=p(""),d=p(!1);let _=null;const P=p(!1),I=p(null),y=p({title:"",timeLimit:0,memoryLimit:0,source:"",private:!0,tags:[]}),b=p([]),r=p([]),u=Re(()=>{const w=[],f=b.value;for(let D=0,z=f.length;D<z;D++)f[D].value&&w.push(f[D].value);return w}),g=(w,f)=>{const{trigger:D,index:z,item:j}=f;if(D==="clear"&&(b.value=[]),["tag-remove","backspace"].includes(D)&&b.value.splice(z,1),D==="enter"){for(let i=0;i<r.value.length;i++){const U=r.value[i];if(U.label===j){for(let T=0;T<b.value.length;T++)if(b.value[T].label===U.label)return;b.value.push(U);return}}const v={label:j,value:j};b.value.push(v),r.value=r.value.concat(v)}},k=(w,{current:f,type:D})=>{if(!f){b.value=D==="check"?r.value.slice(1):[];return}if(D==="check"){const z=r.value.find(j=>j.value===f);if(!z)return;b.value.push(z)}else b.value=b.value.filter(z=>z.value!==f)},m=()=>{B.push({name:"problem-detail",params:{problemId:o.value}})},c=()=>{B.push({name:"manage-problem-judge",params:{problemId:o.value}})},S=async()=>{if(_){P.value=!0,y.value.tags=[];for(let w=0;w<b.value.length;w++){const f=b.value[w];f&&f.label&&y.value.tags.push(f.label)}try{const w=await on(y.value.title,y.value.timeLimit,y.value.memoryLimit,y.value.source,y.value.private,y.value.tags,_.getValue());if(P.value=!0,w.code!==0){H(n,w.code);return}w.data!=null&&await B.push({name:"problem-detail",params:{problemId:w.data}}),Ye(n,"创建成功")}finally{P.value=!1}}},A=async()=>{if(_){P.value=!0,y.value.tags=[];for(let w=0;w<b.value.length;w++){const f=b.value[w];f&&f.label&&y.value.tags.push(f.label)}try{const w=await sn(o.value,y.value.title,y.value.timeLimit,y.value.memoryLimit,y.value.source,y.value.private,y.value.tags,_.getValue());if(P.value=!0,w.code!==0){H(n,w.code);return}w.data!=null&&(I.value.updateTime=new Date(w.data).toLocaleString()),Ye(n,"保存成功")}finally{P.value=!1}}},V=w=>{const f={after:()=>{_==null||_.setValue(w),d.value=!1}};_=new ue("problemEditDiv",f)},R=async()=>{const w=await na(o.value,void 0,void 0);if(w.code!==0){H(n,w.code),console.error("problem get failed",w.code),await B.push({name:"problem"});return}const f=w.data.problem;if(I.value=Qe(f,{}),y.value.title=f.title,y.value.timeLimit=f.time_limit,y.value.memoryLimit=f.memory_limit,y.value.source=f.source,y.value.private=f.private,y.value.tags=[],b.value=[],w.data.tags)for(let z=0;z<w.data.tags.length;z++){const j=w.data.tags[z];j&&j.name&&(y.value.tags.push(j.name),b.value.push({label:j.name,value:j.id}))}s.setTitle(f.title+" - "+s.getTitle);let D=f.description;V(D)};return ne(async()=>{Array.isArray(a.params.problemId)?o.value=a.params.problemId[0]:o.value=a.params.problemId,o.value?(d.value=!0,oa(-1).then(async w=>{w.code===0?(w.data.list&&w.data.list.forEach(f=>{r.value.push({label:f.name,value:f.id})}),await R()):(H(n,w.code),console.error("problem tag get failed",w.code),await B.push({name:"problem"}))}).catch(async w=>{console.error(w),H(n,"获取数据异常"),await B.push({name:"problem"})})):(y.value.timeLimit=1e3,y.value.memoryLimit=65536,V(""))}),(w,f)=>{const D=$e,z=ze,j=Ra,v=Ft,i=Ka,U=Ea,T=De,h=se,C=be,$=O,G=ve,q=Ke,Y=Ee,W=ge,te=Ce;return L(),M(te,{loading:d.value},{default:l(()=>[t(W,null,{default:l(()=>[t(C,{span:8},{default:l(()=>[E("div",Fo,[t(h,{class:"sh-card"},{default:l(()=>[t(T,{model:y.value},{default:l(()=>[t(z,{label:"标题"},{default:l(()=>[t(D,{modelValue:y.value.title,"onUpdate:modelValue":f[0]||(f[0]=N=>y.value.title=N),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),t(z,{label:"时间限制"},{default:l(()=>[t(j,{modelValue:y.value.timeLimit,"onUpdate:modelValue":f[1]||(f[1]=N=>y.value.timeLimit=N),theme:"normal",min:0},{suffix:l(()=>f[5]||(f[5]=[E("span",null,"ms",-1)])),_:1},8,["modelValue"])]),_:1}),t(z,{label:"内存限制"},{default:l(()=>[t(j,{modelValue:y.value.memoryLimit,"onUpdate:modelValue":f[2]||(f[2]=N=>y.value.memoryLimit=N),theme:"normal",min:0},{suffix:l(()=>f[6]||(f[6]=[E("span",null,"KB",-1)])),_:1},8,["modelValue"])]),_:1}),t(z,{label:"来源"},{default:l(()=>[t(D,{modelValue:y.value.source,"onUpdate:modelValue":f[3]||(f[3]=N=>y.value.source=N),placeholder:"请输入题目来源"},null,8,["modelValue"])]),_:1}),t(z,{label:"私有"},{default:l(()=>[t(v,{modelValue:y.value.private,"onUpdate:modelValue":f[4]||(f[4]=N=>y.value.private=N)},null,8,["modelValue"])]),_:1}),t(z,{label:"标签"},{default:l(()=>[t(U,{value:b.value,"allow-input":!0,placeholder:"请选择或输入","tag-input-props":{excessTagsDisplayType:"break-line"},"popup-props":{overlayInnerClassName:["narrow-scrollbar"],overlayInnerStyle:{maxHeight:"280px",overflowY:"auto",overscrollBehavior:"contain",padding:"6px"}},clearable:"",multiple:"",onTagChange:g},{panel:l(()=>[r.value.length?(L(),M(i,{key:0,value:u.value,options:r.value,onChange:k},null,8,["value","options"])):(L(),X("div",Go,"暂无数据"))]),suffixIcon:l(()=>[t(me(ha))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(C,{span:4},{default:l(()=>[E("div",No,[E("div",Oo,[o.value?(L(),M(G,{key:0},{default:l(()=>[t($,{onClick:A,theme:"danger",loading:P.value},{default:l(()=>f[7]||(f[7]=[x("保存")])),_:1},8,["loading"]),t($,{onClick:c,theme:"warning"},{default:l(()=>f[8]||(f[8]=[x("判题数据")])),_:1}),t($,{onClick:m},{default:l(()=>f[9]||(f[9]=[x("查看")])),_:1})]),_:1})):(L(),M(G,{key:1},{default:l(()=>[t($,{onClick:S,theme:"danger",loading:P.value},{default:l(()=>f[10]||(f[10]=[x("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(L(),M(Y,{key:0,layout:"vertical",bordered:!0},{default:l(()=>[t(q,{label:"创建时间"},{default:l(()=>{var N;return[x(K((N=I.value)==null?void 0:N.insertTime),1)]}),_:1}),t(q,{label:"更新时间"},{default:l(()=>{var N;return[x(K((N=I.value)==null?void 0:N.updateTime),1)]}),_:1}),t(q,{label:"判题方式"},{default:l(()=>{var N;return[x(K((N=I.value)==null?void 0:N.judgeType),1)]}),_:1}),t(q,{label:"上传用户"},{default:l(()=>{var N;return[x(K((N=I.value)==null?void 0:N.creatorNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),f[11]||(f[11]=E("div",{id:"problemEditDiv",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"])}}}),$t=oe(Ho,[["__scopeId","data-v-583e6955"]]),Bo={style:{margin:"10px"}},Wo={style:{margin:"12px"}},Jo={class:"dida-edit-container"},Xo=ae({__name:"ProblemJudge",setup(e){let a=pe();const{globalProperties:n}=re(),s=Ae(),o=p(""),d=p(!1),_=p(null);let P=null;const I=p(null),y=p(""),b=p(!1),r=p(!1),u=p([{title:"文件",colKey:"file"},{title:"大小",colKey:"size",width:150,cell:(v,i)=>i.row.size.toFixed(0)+" B"},{title:"最后修改时间",colKey:"lastModified",width:180,cell:(v,i)=>new Date(i.row.lastModified).toLocaleString()},{title:"操作",colKey:"action",width:100,cell:(v,i)=>t(O,{onClick:()=>A(i.row.file)},{default:()=>[x("下载")]})}]),g=p([]),k=Re(()=>({border:"2px dashed #ccc",borderRadius:"6px",padding:"20px",textAlign:"center",cursor:"pointer",backgroundColor:b.value?"#f0f9ff":"#fff",transition:"background-color 0.2s ease"})),m=Re(()=>y.value?`已选择：${y.value}`:b.value?"松开文件以上传":"拖拽文件到这里，或点击选择文件"),c=()=>{B.push({name:"problem-detail",params:{problemId:o.value}})},S=()=>{B.push({name:"manage-problem",params:{problemId:o.value}})},A=async v=>{const i=await rn(o.value,v);if(i.code!==0){H(n,i.code);return}const U=document.createElement("a");U.href=i.data,U.target="_blank",U.click(),URL.revokeObjectURL(U.href)},V=async()=>{if(!P){ce(n,"请选择压缩包");return}r.value=!0,un(o.value,P).then(async v=>{v.code==0?(I.value.value=null,P=null,y.value="",d.value=!0,Ye(n,"上传成功"),await j()):H(n,v.code)}).catch(v=>{console.log(v),n.$message.error({duration:3e3,content:"申请失败"})}).finally(()=>{r.value=!1})},R=()=>{var v;(v=I.value)==null||v.click()},w=v=>{const i=v.target.files[0];i&&(y.value=i.name,P=i)},f=v=>{b.value=!0},D=()=>{b.value=!1},z=v=>{v.preventDefault(),v.stopPropagation(),b.value=!1;const i=v.dataTransfer.files[0];if(i){y.value=i.name;const U=new DataTransfer;U.items.add(i),I.value.files=U.files,P=i}},j=async()=>{const v=await an(o.value);if(v.code!==0){H(n,v.code),await B.push({name:"problem"});return}const i=v.data.problem;_.value=Qe(i,{}),s.setTitle(i.title+" - "+s.getTitle),g.value=[],v.data.judges?v.data.judges.forEach(U=>{g.value.push({file:U.key,size:U.size,lastModified:U.last_modified})}):ce(n,"评测数据不存在"),d.value=!1};return ne(async()=>{if(Array.isArray(a.params.problemId)?o.value=a.params.problemId[0]:o.value=a.params.problemId,!o.value){ce(n,"题目不存在"),await B.push({name:"problem"});return}d.value=!0,await j()}),(v,i)=>{const U=Ie,T=be,h=O,C=ve,$=Ke,G=Ee,q=ge,Y=Ce;return L(),M(Y,{loading:d.value},{default:l(()=>[t(q,null,{default:l(()=>[t(T,{span:7},{default:l(()=>[E("div",Bo,[E("div",{id:"drop-zone",style:Kt(k.value),onClick:R,onDragenter:Xe(f,["prevent"]),onDragover:i[0]||(i[0]=Xe(()=>{},["prevent"])),onDragleave:Xe(D,["prevent"]),onDrop:z},[E("input",{ref_key:"fileInput",ref:I,type:"file",style:{display:"none"},onChange:w},null,544),x(" "+K(m.value),1)],36)]),t(U,{data:g.value,columns:u.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1}),t(T,{span:5},{default:l(()=>[E("div",Wo,[E("div",Jo,[t(C,null,{default:l(()=>[t(h,{onClick:V,theme:"danger",loading:r.value},{default:l(()=>i[1]||(i[1]=[x("上传")])),_:1},8,["loading"]),t(h,{onClick:S,theme:"warning"},{default:l(()=>i[2]||(i[2]=[x("编辑")])),_:1}),t(h,{onClick:c},{default:l(()=>i[3]||(i[3]=[x("查看")])),_:1})]),_:1})]),t(G,{layout:"vertical",bordered:!0},{default:l(()=>[t($,{label:"标题"},{default:l(()=>{var W;return[x(K((W=_.value)==null?void 0:W.title),1)]}),_:1}),t($,{label:"创建时间"},{default:l(()=>{var W;return[x(K((W=_.value)==null?void 0:W.insertTime),1)]}),_:1}),t($,{label:"更新时间"},{default:l(()=>{var W;return[x(K((W=_.value)==null?void 0:W.updateTime),1)]}),_:1}),t($,{label:"判题方式"},{default:l(()=>{var W;return[x(K((W=_.value)==null?void 0:W.judgeType),1)]}),_:1}),t($,{label:"评测数据"},{default:l(()=>{var W;return[x(K((W=_.value)==null?void 0:W.judgeMd5),1)]}),_:1}),t($,{label:"上传用户"},{default:l(()=>{var W;return[x(K((W=_.value)==null?void 0:W.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Yo=oe(Xo,[["__scopeId","data-v-17986e38"]]),Zo={style:{display:"flex","align-items":"center"}},Qo={style:{color:"#409eff","margin-right":"20px"}},es={class:"dida-login-footer"},ts=ae({__name:"UserForget",setup(e){const{globalProperties:a}=re(),n=xe(),s=p(!1),o=p(!1),d=p(!1),_=p("发送验证码");let P=null,I=-1;const y=p(!1),b=p(null),r=p(""),u=p({username:"",emailKey:"",password:"",confirmPassword:""}),k=p({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:w=>new Promise(f=>{const D=setTimeout(()=>{f(u.value.password===w),clearTimeout(D)})}),message:"两次密码不一致"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),m=()=>{_e(a,"重置成功")},c=async w=>{if(!d.value){s.value=!0,o.value=!0;try{const f=await jl(w,u.value.username);f.code===0?(_e(a,"验证码发送成功"),r.value=f.data,o.value=!1,d.value=!0,P=new Date,_.value="60秒后重发",I=setInterval(()=>{const z=Math.floor((new Date().getTime()-(P==null?void 0:P.getTime()))/1e3);z>60?(_.value="发送验证码",d.value=!1,clearInterval(I)):_.value=`${60-z}秒后重发`},1e3)):H(a,f.code)}catch(f){console.error("Send email key error",f),ce(a,"发送验证码失败")}finally{s.value=!1}}},S=async()=>{var z;if(y.value=!0,d.value||o.value)return;await Le();const w=document.getElementById("cf-confirm-div");w&&w.remove();const f=document.createElement("div");f.id="cf-confirm-div",f.setAttribute("data-theme","light"),(z=b.value)==null||z.appendChild(f);const D=window;D.turnstile.ready(function(){D.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(j){y.value=!1,await c(j)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},A=p(()=>t(O,{onClick:S,disabled:d.value,loading:o.value,style:"width:120px"},{default:()=>[_.value]})),V=async()=>{s.value=!0;try{const w=await Ll(u.value.username,u.value.password,u.value.emailKey);w.code===0?(_e(a,"密码修改成功"),a.$router.push({name:"login"})):H(a,w.code)}catch(w){console.error("Modify password error",w),ce(a,"修改密码失败")}finally{s.value=!1}},R=async({validateResult:w,firstError:f,e:D})=>{if(!s.value){if(D.preventDefault(),w!==!0){ce(a,f);return}r.value?await V():await S()}};return ne(()=>{if(n.isLogin()){a.$router.push({path:"/user"});return}}),Se(()=>{}),(w,f)=>{const D=gt,z=$e,j=ze,v=Mt,i=O,U=De,T=Ne,h=se,C=He;return L(),X(Q,null,[t(h,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:l(()=>[t(D,{"max-line":1},{default:l(()=>f[6]||(f[6]=[E("span",null,"如果您未绑定邮箱或忘记用户名，可联系管理员寻求帮助",-1),E("span",null,"管理员邮箱：BoilTask@qq.com",-1)])),_:1}),t(U,{ref:"form",rules:k.value,data:u.value,colon:!0,onReset:m,onSubmit:R,class:"yj-login-form"},{default:l(()=>[t(j,{name:"username",label:"用户名"},{default:l(()=>[t(z,{modelValue:u.value.username,"onUpdate:modelValue":f[0]||(f[0]=$=>u.value.username=$),clearable:"",placeholder:"请输入完整用户名"},null,8,["modelValue"])]),_:1}),r.value?(L(),X(Q,{key:0},[t(j,{name:"email",label:"发送邮箱"},{default:l(()=>[t(v,{append:A.value},{default:l(()=>[E("div",Zo,[E("span",Qo,K(r.value),1)])]),_:1},8,["append"])]),_:1}),t(j,{name:"emailKey",label:"验证码"},{default:l(()=>[t(z,{modelValue:u.value.emailKey,"onUpdate:modelValue":f[1]||(f[1]=$=>u.value.emailKey=$),clearable:"",placeholder:"请输入收到的验证码"},null,8,["modelValue"])]),_:1}),t(j,{name:"password",label:"新密码"},{default:l(()=>[t(z,{modelValue:u.value.password,"onUpdate:modelValue":f[2]||(f[2]=$=>u.value.password=$),type:"password",clearable:"",placeholder:"新密码"},null,8,["modelValue"])]),_:1}),t(j,{name:"confirmPassword",label:"确认密码"},{default:l(()=>[t(z,{modelValue:u.value.confirmPassword,"onUpdate:modelValue":f[3]||(f[3]=$=>u.value.confirmPassword=$),type:"password",clearable:"",placeholder:"请重复输入密码"},null,8,["modelValue"])]),_:1})],64)):le("",!0),r.value?(L(),M(j,{key:1},{default:l(()=>[t(i,{theme:"primary",type:"submit",block:"",loading:s.value},{default:l(()=>f[7]||(f[7]=[x("修改密码")])),_:1},8,["loading"])]),_:1})):(L(),M(j,{key:2},{default:l(()=>[t(i,{theme:"primary",type:"submit",block:"",loading:s.value},{default:l(()=>f[8]||(f[8]=[x("重置密码")])),_:1},8,["loading"])]),_:1}))]),_:1},8,["rules","data"]),E("div",es,[t(T,{onClick:f[4]||(f[4]=()=>{me(a).$router.push({name:"login"})})},{default:l(()=>f[9]||(f[9]=[x("返回登陆 ")])),_:1})])]),_:1}),t(C,{visible:y.value,"onUpdate:visible":f[5]||(f[5]=$=>y.value=$),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:l(()=>[E("div",{ref_key:"dialogContainer",ref:b,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),as=oe(ts,[["__scopeId","data-v-c3586c6f"]]),ca=[{name:"problem-list",tab:"problem",sidebar:"problem-list",path:"",title:"问题列表",icon:"list",component:_n},{name:"problem-detail",tab:"problem",sidebar:"problem-list",path:":problemId+",title:"问题详情",icon:"list",component:Pt},{name:"problem-recommend",tab:"problem",sidebar:"problem-recommend",path:"recommend/:problemId*",title:"问题推荐",icon:"cpu",needLogin:!0,component:Ln},{name:"problem-collection-list",tab:"problem",sidebar:"problem-collection-list",path:"collection",title:"题目集合",icon:"list",disableTabPath:!0,component:Kn},{name:"collection-detail",tab:"collection-detail-tab",sidebar:"collection-detail",path:":collectionId+",title:"题集详情",icon:"cpu",component:On},{name:"collection-rank",tab:"collection-detail-tab",sidebar:"collection-rank",path:":collectionId+/rank",title:"题集排名",icon:"list",component:Hn},{name:"collection-edit",tab:"collection-detail-tab",sidebar:"collection-edit",disableSidebar:!0,path:":collectionId+/edit",title:"题集编辑",icon:"list",component:xt},{name:"collection-create",tab:"collection-detail-tab",sidebar:"collection-create",disableSidebar:!0,path:"create",title:"新建题集",icon:"list",component:xt,auths:[je.ManageCollection]},{name:"judge-list",tab:"judge",sidebar:"judge-list",path:"",title:"评测列表",icon:"list",component:jt},{name:"judge-detail",tab:"judge",sidebar:"judge-list",path:":judgeId+",title:"评测详情",icon:"cpu",component:Vt},{name:"contest-list",tab:"contest",sidebar:"contest-list",path:"",title:"比赛列表",icon:"list",component:Dt},{name:"contest-recent",tab:"contest",sidebar:"contest-recent",path:"recent",title:"近期比赛",icon:"list",component:Dt},{name:"contest-detail",tab:"contest-detail-tab",sidebar:"contest-detail",path:":contestId+",title:"比赛详情",icon:"cpu",component:fo},{name:"contest-problem-detail",tab:"contest-detail-tab",sidebar:"contest-problem-detail",path:":contestId+/problem/:problemIndex+",title:"问题详情",icon:"cpu",disableSidebar:!0,component:Pt},{name:"contest-judge",tab:"contest-detail-tab",sidebar:"contest-judge",path:":contestId+/judge",title:"评测列表",icon:"list",component:jt},{name:"contest-judge-detail",tab:"contest-detail-tab",sidebar:"contest-judge-detail",path:":contestId+/judge/:judgeId+",title:"评测详情",icon:"cpu",component:Vt,disableSidebar:!0},{name:"contest-rank",tab:"contest-detail-tab",sidebar:"contest-rank",path:":contestId+/rank",title:"比赛排名",icon:"list",component:_o},{name:"contest-discuss",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss",title:"比赛讨论",icon:"list",component:at},{name:"contest-discuss-detail",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss/:discussId+",title:"讨论详情",icon:"list",component:it},{name:"discuss-list",tab:"discuss",sidebar:"discuss-list",path:"",title:"讨论列表",icon:"list",component:at},{name:"discuss-list-problem",tab:"discuss",sidebar:"discuss-list-problem",path:"problem",title:"问题讨论",icon:"list",component:at},{name:"discuss-list-judge",tab:"discuss",sidebar:"discuss-list-judge",path:"judge",title:"评测讨论",icon:"list",component:at},{name:"discuss-detail",tab:"discuss",sidebar:"discuss-list",path:":discussId+",title:"讨论详情",icon:"list",component:it},{name:"rank-ac-all",tab:"rank",sidebar:"rank-ac-all",path:"ac",title:"AC排名",icon:"base-station",props:{type:"all"},component:Je},{name:"rank-ac-problem",tab:"rank",sidebar:"rank-ac-problem",path:"ac/problem",title:"题量排名",icon:"base-station",props:{type:"problem"},component:Je},{name:"rank-ac-problem-today",tab:"rank",sidebar:"rank-ac-problem-today",path:"ac/problem/today",title:"今日题量",icon:"base-station",props:{type:"problem-today"},component:Je},{name:"rank-ac-problem-day7",tab:"rank",sidebar:"rank-ac-problem-day7",path:"ac/problem/day7",title:"7日题量",icon:"base-station",props:{type:"problem-day7"},component:Je},{name:"rank-ac-problem-year",tab:"rank",sidebar:"rank-ac-problem-year",path:"ac/problem/year",title:"1年题量",icon:"base-station",props:{type:"problem-year"},component:Je},{name:"tool-paste",tab:"tool",sidebar:"tool-paste",path:"paste",title:"码池",icon:"base-station",component:_t},{name:"system-status",tab:"system",sidebar:"system-status",path:"",title:"运行状态",icon:"base-station",component:_t},{name:"system-about",tab:"system",sidebar:"system-about",path:"about",title:"关于",icon:"base-station",props:{discussId:"52"},component:it},{name:"manage-problem-create",tab:"manage",sidebar:"manage-problem-create",disableSidebar:!0,path:"problem",title:"新建问题",icon:"list",component:$t,auths:[je.ManageProblem]},{name:"manage-problem",tab:"manage",sidebar:"manage-problem",disableSidebar:!0,path:"problem/:problemId+",title:"问题编辑",icon:"list",component:$t,auths:[je.ManageProblem]},{name:"manage-problem-judge",tab:"manage",sidebar:"manage-problem-judge",disableSidebar:!0,path:"problem/:problemId+/judge",title:"评测数据",icon:"list",component:Yo,auths:[je.ManageProblem]},{name:"manage-judge",tab:"manage",path:"judge",sidebar:"manage-judge",title:"评测管理",icon:"list",auths:["i-manage-judge"],component:Mo},{name:"login-forget",tab:"login",path:"forget",title:"忘记密码",component:as}],Ut=(e,a,n,s)=>{s.tab==n&&(s.disableSidebar&&a!=s.sidebar||s.sidebar==null||s.sidebar!=s.name||e.push({name:s.name,title:s.title,icon:s.icon,to:{name:s.name}}))},ls=(e,a)=>{const n=[];return ca.forEach(s=>{if(Qt(s)){const o=[];s.children.forEach(d=>{Ut(o,e,a,d)}),o.length>0&&n.push({title:s.title,children:o})}else Ut(n,e,a,s)}),n},At=(e,a)=>{const n=Fl(a.tab),s={name:a.name,path:"/"+a.path,meta:{title:a.title+" - "+n.title,tab:a.tab,sidebar:a.sidebar,showSidebar:n.showSidebar,needLogin:n.needLogin||a.needLogin,tabAuths:n.auths,auths:a.auths},props:a.props,component:a.component};!n.disablePath&&!a.disableTabPath&&(s.path=n.path+s.path),e.push(s)},ns=e=>{ca.forEach(a=>{Qt(a)?a.children.forEach(n=>{At(e,n)}):At(e,a)})},os={class:"sh-main"},ss=ae({__name:"View403",setup(e){let a=pe();const n=p("");return ne(()=>{a.query.target?n.value=a.query.target:n.value=a.fullPath}),(s,o)=>{const d=O;return L(),X("div",os,[E("p",null,K(n.value),1),o[2]||(o[2]=E("p",null,"该页面无访问权限，请更换访问目标或重新登陆后再试",-1)),t(d,{theme:"primary",onClick:o[0]||(o[0]=()=>s.$router.push("/"))},{default:l(()=>o[1]||(o[1]=[x("返回首页")])),_:1})])}}}),da=oe(ss,[["__scopeId","data-v-8f62f1f8"]]),et=[];Nl(et);ns(et);et.push({path:"/403",name:"403",component:da});et.push({path:"/:pathMatch(.*)*",name:"404",component:Zt});const B=ya({history:wa("/"),routes:et});B.beforeEach((e,a,n)=>{if(e.name==null||!B.hasRoute(e.name)){n({name:"home"});return}const s=e.matched[e.matched.length-1].meta;if(s.redirect){n({name:s.redirect});return}if(s.needLogin){const d=xe();if(d.getToken==null||d.getToken==""){n({name:"login",query:{redirect_uri:e.fullPath}});return}}const o=s.tabAuths;if(o&&!xe().hasAllAuths(o)){n({name:"403",query:{target:e.fullPath}});return}n()});B.afterEach((e,a)=>{if(e.name===a.name)return;const n=ut(),s=Ae();let o=null;if(e.matched.length>0&&(o=e.matched[e.matched.length-1].meta),o!=null&&o.title&&s.setTitle(o==null?void 0:o.title),o!=null&&o.showSidebar){n.setSidebarShow(!0);const d=ls(o==null?void 0:o.sidebar,o==null?void 0:o.tab);n.setMenuList(d),n.setMenuActiveName(o==null?void 0:o.sidebar)}else n.setSidebarShow(!1)});const ma=st("login",{state:()=>({Loaded:!1}),getters:{isLoaded(){return this.Loaded}}}),rs=ae({__name:"HeaderContent",setup(e){const a=ma(),n=xe(),{globalProperties:s}=re(),o=p(a.isLoaded),d=p(!1),_=p(n.getUsername),P=p(n.getNickname),I=p(),y=()=>{I.value=Gl(n)};a.$subscribe((u,g)=>{o.value=g.Loaded}),n.$subscribe((u,g)=>{_.value=g.username,P.value=g.nickname,d.value=g.token!="",y()});const b=()=>{s.$router.currentRoute.value.name!=="login"&&s.$router.push({name:"login",query:{redirect_uri:s.$router.currentRoute.value.fullPath}})},r=()=>{n.clear(),s.$message.success({duration:3e3,content:"注销成功"}),s.$router.push({path:"/login",query:{redirect_uri:s.$router.currentRoute.value.fullPath}})};return ne(()=>{y()}),(u,g)=>{const k=qt("router-link"),m=Xt,c=Jt,S=qa,A=Ma;return L(),M(A,{modelValue:u.$route.meta.tab,"onUpdate:modelValue":g[0]||(g[0]=V=>u.$route.meta.tab=V),class:"sh-menu","expand-type":"popup"},{logo:l(()=>[t(k,{to:"/",class:"sh-logo"},{default:l(()=>g[1]||(g[1]=[x("DidaOJ")])),_:1})]),operations:l(()=>[o.value&&d.value?(L(),M(S,{key:0,title:P.value},{icon:l(()=>[t(m,{name:"user"})]),default:l(()=>[t(c,{value:"user",to:{path:"/user/"+_.value}},{default:l(()=>g[2]||(g[2]=[x("个人空间")])),_:1},8,["to"]),t(c,{value:"user_logout",onClick:r},{default:l(()=>g[3]||(g[3]=[x(" 注销")])),_:1})]),_:1},8,["title"])):o.value?(L(),M(c,{key:2,value:"login",onClick:b},{icon:l(()=>[t(m,{name:"login"})]),default:l(()=>[g[5]||(g[5]=x(" 登录 "))]),_:1})):(L(),M(c,{key:1,value:"login"},{icon:l(()=>[t(m,{name:"login"})]),default:l(()=>[g[4]||(g[4]=x(" ... "))]),_:1}))]),default:l(()=>[(L(!0),X(Q,null,de(I.value,V=>(L(),M(c,{key:V.name,value:V.name,to:{name:V.name}},{icon:l(()=>[V.icon?(L(),M(m,{key:0,name:V.icon},null,8,["name"])):le("",!0)]),default:l(()=>[x(" "+K(V.title),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])}}}),us=oe(rs,[["__scopeId","data-v-c64d812f"]]),is={id:"menu-container"},cs=ae({__name:"SidebarContent",setup(e){const a=ut(),n=p(!1),s=p(null),o=p(a.menuActiveName),d=p(a.menuList),_=p([]),P=p(!1),I=()=>{o.value=a.menuActiveName;const b=JSON.stringify(d.value),r=JSON.stringify(a.menuList);b!==r&&(_.value.push([...a.menuList]),y())},y=async()=>{if(_.value.length>0&&!P.value){for(P.value=!0;_.value.length>1;)_.value.shift();const b=_.value.shift();n.value=b.length<=0,d.value=[],await Le(),s.value&&s.value.updateActiveName(),await new Promise(u=>setTimeout(u,300)),d.value=b,await Le(),s.value&&s.value.updateActiveName();const r=300;await new Promise(u=>setTimeout(u,r)),P.value=!1,await y()}};return a.$subscribe((b,r)=>{I()}),ne(()=>{I()}),(b,r)=>{const u=Xt,g=Jt,k=Ga,m=Fa,c=Ce;return L(),X(Q,null,[E("div",is,[t(m,{modelValue:o.value,"onUpdate:modelValue":r[0]||(r[0]=S=>o.value=S),theme:"light",class:"sh-menu-container"},{default:l(()=>[t(ka,{name:"move-left"},{default:l(()=>[(L(!0),X(Q,null,de(d.value,(S,A)=>(L(),X(Q,{key:A},[me(Ol)(S)?(L(),M(k,{key:0,title:S.title},{default:l(()=>[(L(!0),X(Q,null,de(S.children,(V,R)=>(L(),M(g,{key:V.name,value:V.name,to:V.to},pt({default:l(()=>[x(" "+K(V.title),1)]),_:2},[V.icon?{name:"icon",fn:l(()=>[t(u,{name:V.icon,class:ft(V.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))),128))]),_:2},1032,["title"])):(L(),M(g,{key:S.name,value:S.name,to:S.to},pt({default:l(()=>[x(" "+K(S.title),1)]),_:2},[S.icon?{name:"icon",fn:l(()=>[t(u,{name:S.icon,class:ft(S.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),t(c,{size:"small",loading:n.value,"show-overlay":!0,attach:"#menu-container",class:"sh-sidebar-loading",style:{"align-items":"flex-start","padding-top":"100px"}},null,8,["loading"])],64)}}}),ds=oe(cs,[["__scopeId","data-v-96e2d89f"]]),ms={};function ps(e,a){return null}const fs=oe(ms,[["render",ps]]),_s={class:"footer"},vs={class:"footer-left"},gs={class:"foot-time"},bs={class:"footer-center"},hs={href:"https://beiancx.miit.gov.cn/",target:"_blank"},ys={class:"footer-right"},ws={class:"foot-text"},ks={href:"https://github.com/hpu-developer/DiDaOJ-web",target:"_blank"},Cs={class:"foot-text"},Ss={href:"https://github.com/hpu-developer/DiDaOJ-go",target:"_blank"},Is=ae({__name:"FooterContent",setup(e){const a=p("");function n(){a.value=new Date().toLocaleString()}return ne(()=>{n(),setInterval(()=>{n()},1e3)}),(s,o)=>{const d=O;return L(),X("div",_s,[E("div",vs,[E("p",gs,K(a.value),1)]),E("div",bs,[E("a",hs,[t(d,{theme:"default",variant:"outline",ghost:!0},{default:l(()=>o[0]||(o[0]=[x("豫ICP备15024677号-4")])),_:1})])]),E("div",ys,[E("p",ws,[E("a",ks,[t(d,{theme:"default",variant:"outline",ghost:!0},{default:l(()=>o[1]||(o[1]=[x("@didaoj-web")])),_:1})])]),E("p",Cs,[E("a",Ss,[t(d,{theme:"default",variant:"outline",ghost:!0},{default:l(()=>o[2]||(o[2]=[x("@didaoj-go")])),_:1})])])])])}}}),Ps=oe(Is,[["__scopeId","data-v-979fed79"]]),lt=20,dt=100,mt=50,xs=ae({__name:"ForceHiddenSidebarButton",setup(e){let a=ut();const n=p({x:window.innerWidth-dt-lt,y:window.innerHeight-mt-lt}),s=p(window.innerWidth),o=p(window.innerHeight);let d=!1,_={x:0,y:0};const P=S=>{d=!0;const A=S.clientX??S.touches[0].clientX,V=S.clientY??S.touches[0].clientY;_={x:A-n.value.x,y:V-n.value.y},document.addEventListener("mousemove",I),document.addEventListener("touchmove",I),document.addEventListener("mouseup",y),document.addEventListener("touchend",y)},I=S=>{if(!d)return;const A=S.clientX??S.touches[0].clientX,V=S.clientY??S.touches[0].clientY;let R=A-_.x,w=V-_.y;R=Math.max(0,Math.min(R,s.value-dt)),w=Math.max(0,Math.min(w,o.value-mt)),n.value={x:R,y:w}},y=()=>{d=!1,document.removeEventListener("mousemove",I),document.removeEventListener("touchmove",I),document.removeEventListener("mouseup",y),document.removeEventListener("touchend",y)},b=()=>{s.value=window.innerWidth,o.value=window.innerHeight,n.value={x:Math.min(n.value.x,s.value-dt-lt),y:Math.min(n.value.y,o.value-mt-lt)}};let r=p(a.forceHiddenSidebar),u=p(a.forceHiddenSidebar);const g=()=>{r.value=!r.value,a.setForceHiddenSidebar(r.value)},k=()=>{u.value||(u.value=!0,a.setForceHiddenSidebar(r.value))},m=()=>{u.value&&(u.value=!1,a.setForceHiddenSidebar(!1))},c=S=>{S>=800?m():k()};return c(s.value),Ve(s,S=>{c(S)}),ne(()=>{window.addEventListener("resize",b)}),Se(()=>{window.removeEventListener("resize",b)}),(S,A)=>{const V=O;return me(u)?(L(),M(V,{key:0,class:"draggable-button",style:Kt({top:`${n.value.y}px`,left:`${n.value.x}px`}),onMousedown:P,onTouchstart:P,variant:"dashed",theme:"primary",onClick:g},{default:l(()=>[x(K(me(r)?"显示":"隐藏"),1)]),_:1},8,["style"])):le("",!0)}}}),Ts=oe(xs,[["__scopeId","data-v-1aee5506"]]),nt="DidaOJ",js=ae({__name:"App",setup(e){const{globalProperties:a}=re(),n=ma(),s=xe(),o=Ae(),d=ut();n.$patch({Loaded:!1});const _=s.getToken,P=p(!1),I=p(!1);o.title&&o.title.length>0?document.title=o.title+" - "+nt:document.title=nt,o.$subscribe((u,g)=>{g.title&&g.title.length>0?document.title=g.title+" - "+nt:document.title=nt}),d.$subscribe((u,g)=>{P.value=g.showSidebar,I.value=P.value&&!g.forceHiddenSidebar});const y=pe(),b=Re(()=>{const u=y.meta.auths;return u?!s.hasAllAuths(u):!1});function r(){a.$message.warning({duration:3e3,content:"登陆状态失效"}),n.$patch({Loaded:!0}),s.clear()}return ne(()=>{if(_==""){n.$patch({Loaded:!0});return}Cl().then(u=>{u.code==0?(s.loadResponse(u.data),n.$patch({Loaded:!0})):(H(a,u.code),n.$patch({Loaded:!0}),s.clear())}).catch(u=>{console.log(u),r()})}),(u,g)=>{const k=Na,m=Ha,c=qt("RouterView"),S=Ba,A=Oa,V=Wa;return L(),X(Q,null,[t(A,null,{default:l(()=>[t(k,{class:"sh-header"},{default:l(()=>[t(us)]),_:1}),t(A,null,{default:l(()=>[t(Ca,{name:"slide"},{default:l(()=>[I.value?(L(),M(m,{key:0,class:"sh-sidebar"},{default:l(()=>[t(ds)]),_:1})):le("",!0)]),_:1}),t(A,{class:ft(["sh-main-layout",{expanded:!I.value}])},{default:l(()=>[t(fs),t(S,{class:"sh-main-content"},{default:l(()=>[b.value?(L(),M(da,{key:0})):(L(),M(c,{key:1}))]),_:1}),t(Ps)]),_:1},8,["class"])]),_:1})]),_:1}),P.value?(L(),M(Ts,{key:0})):le("",!0),t(V,{container:"body",offset:["24px","80px"],size:"small"})],64)}}}),Ls=oe(js,[["__scopeId","data-v-9e122cb4"]]);Xa.registerLanguage("verilog",Ya);const pa=Sa();pa.use(Ia);const tt=Pa(Ls);tt.use(pa);tt.use(B);tt.use(Ja);tt.use(xa);tt.mount("#app");vl().then(()=>{console.log("Text cache reinitialized")}).catch(e=>{console.error("Text cache reinitialization failed",e)});
