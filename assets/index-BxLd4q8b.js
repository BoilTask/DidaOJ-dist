import{bl as mt,L as ie,r as d,q as de,bm as E,bn as D,bo as a,v as t,bp as A,bq as q,au as S,br as _a,j as Wa,u as Ja,bs as ne,bt as ee,F as re,bu as Ie,bv as Xa,bw as ke,aI as fe,bx as Ya,by as Za,bz as Qa,t as Le,H as Ge,bA as el,bB as We,n as He,w as ze,a as tt,a2 as tl,a3 as al,bC as ll,bD as nl,bE as ol,ah as sl,bF as wt,bG as ga,bH as ba,bb as rl,bI as il,bJ as ul,bK as cl,bL as ha,aN as dl,bM as Zt,bN as Rt,bO as ml,a5 as pl,bP as fl,bQ as vl,N as _l,bR as gl}from"./node_modules-Ck6Qvwbp.js";import{L as De,C as he,R as Te,a as xe,A as Tt,S as bl,b as hl,c as yl,d as wl,e as kl,f as st,T as lt,B as G,F as $e,g as Ae,I as Ue,D as ot,h as ya,i as ye,j as Je,k as Xe,l as Cl,m as Re,n as pt,o as ft,P as qt,O as Kt,p as Nt,q as Sl,r as wa,s as Il,t as Pl,u as ka,v as Ca,w as xt,x as Tl,y as xl,z as Vl,E as Dl,G as Ll,H as jl,M as Sa,J as Ia,K as zl,N as $l,Q as Al,U as Ul,V as Rl,W as Ml,X as El,Y as ql,Z as Kl,_ as Nl}from"./tdesign-vue-next-B_uo7vfc.js";import{V as me}from"./vditor-DArazWIS.js";import{e as Qt}from"./monaco-editor-BHsDS0An.js";import{H as Fl,v as Ol}from"./highlight.js-D9zWiMxS.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const _ of o)if(_.type==="childList")for(const b of _.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&r(b)}).observe(document,{childList:!0,subtree:!0});function n(o){const _={};return o.integrity&&(_.integrity=o.integrity),o.referrerPolicy&&(_.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?_.credentials="include":o.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function r(o){if(o.ep)return;o.ep=!0;const _=n(o);fetch(o.href,_)}})();var je=(e=>(e.ManageWeb="i-manage-web",e.ManageJudge="i-manage-judge",e.ManageProblem="i-manage-problem",e.ManageProblemDaily="i-manage-problem-daily",e.ManageContest="i-manage-contest",e.ManageCollection="i-manage-collection",e))(je||{});const Gl={"r-admin":["i-manage-web","i-manage-judge","i-manage-problem","i-manage-problem-daily","i-manage-contest","i-manage-collection"]};function Hl(e){if(e==null)return[];const l=[];for(const n of e){const r=Gl[n];r!=null&&l.push(...r)}return[...new Set(l)]}function Bl(e,l){if(e==null||l==null)return!1;const n=Hl(e);for(const r of l)if(!n.includes(r))return!1;return!0}const qe=mt("user",{state:()=>({token:"",userId:-1,username:"",nickname:"",roles:[]}),getters:{getToken(){return this.token},getUserId(){return this.userId},getUsername(){return this.username},getNickname(){return this.nickname}},actions:{clear(){this.$patch({token:"",userId:-1,username:"",nickname:"",roles:[]})},loadResponse(e){this.$patch({token:e.token,userId:e.user_id,username:e.username,nickname:e.nickname,roles:e.roles})},isLogin(){return this.token!=null&&this.token!=""},hasAuth(e){return this.hasAllAuths([e])},hasAllAuths(e){return e?Bl(this.roles,e):!0}},persist:!0}),Ye=mt("webStyle",{state:()=>({title:""}),getters:{getTitle(){return this.title}},actions:{setTitle(e){this.title=e}}}),Vt=mt("sidebarStyle",{state:()=>({showSidebar:!1,forceHiddenSidebar:!1,menuActiveName:"",menuList:[]}),getters:{getMenuList(){return this.menuList}},actions:{setSidebarShow(e){this.showSidebar=e},setForceHiddenSidebar(e){this.forceHiddenSidebar=e},setMenuActiveName(e){this.menuActiveName=e},clearMenuList(){this.menuList=[]},setMenuList(e){this.menuList=e},addMenuList(e){this.menuList.push(e)}}}),Wl={style:{"text-align":"right"}},Jl=ie({__name:"Hitokoto",setup(e){const l=d(!1),n=d(""),r=d(""),o=d(""),_=async()=>{l.value=!0;try{const h=await(await fetch("https://v1.hitokoto.cn")).json();r.value=h.hitokoto,o.value=h.creator,n.value="—— "+h.from}catch(b){r.value="一言获取失败了，但至少您还可以访问本站。",o.value="BoilTask",n.value="DidaOJ",console.error("Error fetching Hitokoto:",b)}finally{l.value=!1}};return de(()=>{_()}),(b,h)=>{const C=he,g=De;return D(),E(g,{loading:l.value},{default:a(()=>[t(C,{title:"一言 © Hitokoto"},{actions:a(()=>[S(" @"+q(o.value),1)]),default:a(()=>[A("div",null,[A("span",null,q(r.value),1),A("p",Wl,q(n.value),1)])]),_:1})]),_:1},8,["loading"])}}}),Xl="https://oj-api.didapipa.com/",X=_a.create({baseURL:Xl,timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});X.interceptors.request.use(e=>{const n=qe().getToken;return n&&(e.headers["X-Token"]=n),e},e=>Promise.reject(e));X.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});const Dt=_a.create({timeout:6e4,withCredentials:!1,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});Dt.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function Pa(){return Dt({baseURL:"https://r2-oj.didapipa.com",url:"/system/notification.json?"+Date.now(),method:"get"})}function Ta(){return Dt({baseURL:"https://r2-oj.didapipa.com",url:"/system/announcement.json?"+Date.now(),method:"get"})}function Yl(){return X({url:"/system/status",method:"get"})}function Zl(){return X({url:"/system/image/token",method:"get"})}function Ql(e,l){return X({url:"/system/notification",method:"post",data:{theme:e,content:l}})}function en(e,l){return X({url:"/system/announcement",method:"post",data:{title:e,content:l}})}let Mt=null;async function tn(){Mt=await ln()}function an(e,l="zh"){if(Mt==null)return[!1,e.toString()];const n=Mt[e.toString()];if(!n)return[!1,e.toString()];let r=n[l];return r||(l="zh",r=n[l]),r?[!0,r]:[!1,e.toString()]}async function ln(){return new Promise(e=>{e({404:{zh:"接口未找到"},1e3:{zh:"系统错误，请重试或等待管理员修复"},1001:{zh:"系统异常，请重试或等待管理员修复"},1002:{zh:"未知错误"},1003:{zh:"操作过于频繁，请稍后重试"},10001:{zh:"权限异常，请重新登陆后再试"},10002:{zh:"参数不符合要求"},10003:{zh:"未找到目标数据"},10004:{zh:"操作需要登录，请登录后重试"},100001:{zh:"用户名不存在或密码不匹配"},100002:{zh:"邮件发送失败，可能是邮箱无效或达到了每日注册上限，如有问题可联系管理员解决"},100003:{zh:"验证码错误或已过期，请重新获取"},100004:{zh:"注册用户失败，可能存在同名用户"},100005:{zh:"用户名不存在，或您未在本系统绑定邮箱，请联系管理员寻求帮助"},100006:{zh:"验证码错误或已过期，请重新获取"},100007:{zh:"已存在相同标题的题目"},100008:{zh:"已存在相同标题的比赛"},100009:{zh:"已存在相同标题的题集"},100010:{zh:"未发现有效题目"},100011:{zh:"题目数量超过限制，无法添加"},100012:{zh:"比赛开始时间无法设置为早于当前时间"},100013:{zh:"当前无法提交题目"},100014:{zh:"申请访问失败，密码错误"},100015:{zh:"未找到目标题目"},100016:{zh:"已经存在该日期的条目"},100017:{zh:"已经存在该问题的条目"}})})}function pe(){const{appContext:e}=Wa();return{globalProperties:e.config.globalProperties}}function Ne(){return 1e3}function Be(e,l,n=3e3){return e.$message.success({duration:n,content:l})}function be(e,l,n=3e3){return e.$message.info({duration:n,content:l})}function ve(e,l,n=3e3){return e.$message.error({duration:n,content:l})}function F(e,l,n=3e3){const[r,o]=an(l),_=r?o:`系统错误，错误提示[${o}]`;return e.$message.error({duration:n,content:_})}function nn(e,l){e.$message&&e.$message.close(l)}function on(e,l){return e.length<=l?e:e.slice(0,l)+"..."}function xa(e){return e.trim().split(/\s+/).flatMap(r=>r.split(",")).filter(r=>r.trim()!=="")}var Ft=(e=>(e[e.Unknown=-1]="Unknown",e[e.C=0]="C",e[e.Cpp=1]="Cpp",e[e.Java=2]="Java",e[e.Python=3]="Python",e[e.Pascal=4]="Pascal",e[e.Golang=5]="Golang",e[e.Lua=6]="Lua",e[e.TypeScript=7]="TypeScript",e[e.Max=8]="Max",e))(Ft||{});function Ot(){const e=[-1,8];return Object.values(Ft).filter(l=>typeof l=="number"&&!e.includes(l)).map(l=>({value:l,label:St(l)}))}function kt(e){return e>-1&&e<8}function St(e){switch(e){case 0:return"C";case 1:return"C++";case 2:return"Java";case 3:return"Python";case 4:return"Pascal";case 5:return"Golang";case 6:return"Lua";case 7:return"TypeScript";default:return"未知"}}function Gt(e){switch(e){case 0:return"c";case 1:return"cpp";case 2:return"java";case 3:return"python";case 4:return"pascal";case 5:return"go";case 6:return"lua";case 7:return"typescript";default:return"text"}}var Fe=(e=>(e[e.Init=0]="Init",e[e.Rejudge=1]="Rejudge",e[e.Submitting=2]="Submitting",e[e.Queuing=3]="Queuing",e[e.Compiling=4]="Compiling",e[e.Running=5]="Running",e[e.Accept=6]="Accept",e[e.PE=7]="PE",e[e.WA=8]="WA",e[e.TLE=9]="TLE",e[e.MLE=10]="MLE",e[e.OLE=11]="OLE",e[e.RE=12]="RE",e[e.CE=13]="CE",e[e.CLE=14]="CLE",e[e.JudgeFail=15]="JudgeFail",e[e.SubmitFail=16]="SubmitFail",e[e.Unknown=17]="Unknown",e[e.Max=18]="Max",e))(Fe||{});const sn=e=>{switch(e){case 0:return"普通评测";case 1:return"特殊评测";default:return"未知"}},It=e=>{switch(e){case 0:return"等待处理";case 1:return"重新评测";case 2:return"提交中";case 3:return"队列中";case 4:return"编译中";case 5:return"运行中";case 6:return"通过";case 7:return"格式错误";case 8:return"答案错误";case 9:return"超时";case 10:return"内存超限";case 11:return"输出超限";case 12:return"运行错误";case 13:return"编译错误";case 14:return"编译超限";case 15:return"评测失败";case 16:return"提交失败";case 17:return"未知";default:return e}},Va=e=>{switch(e){case 0:case 1:case 2:case 3:case 4:case 5:case 17:return"default";case 6:return"success";case 7:return"warning";default:return"danger"}};function Da(){const e=[17,18];return Object.values(Fe).filter(l=>typeof l=="number"&&!e.includes(l)).map(l=>({value:l,label:It(l)}))}function Ct(e){return e>=0&&e<17}function ct(e){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return!0;default:return!1}}function La(e){var n;const l={};if(l.id=e.id,l.problemId=e.problem_id,l.contestProblemIndex=e.contest_problem_index,l.status=e.status,ct(e.status)||!Ct(e.status)?l.score="-":l.score=e.score.toString(),e.time?l.time=Math.ceil(e.time/1e6)+"ms":l.time="-",e.memory?l.memory=(e.memory/1024/1024).toFixed(2)+"MB":l.memory="-",l.language=e.language,l.codeLength=e.code_length,e.approve_time?l.approveTime=new Date(e.approve_time).toLocaleString():l.approveTime="-",l.author=e.author,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.code=e.code,l.compileMessage=e.compile_message,l.taskCurrent=e.task_current,l.taskTotal=e.task_total,l.task=[],e.task)for(let r=0;r<((n=e.task)==null?void 0:n.length);r++){const o=e.task[r],_={};_.taskId=o.task_id,_.status=o.status,o.time?_.time=Math.ceil(o.time/1e6)+"ms":_.time="-",o.memory?_.memory=(o.memory/1024/1024).toFixed(2)+"MB":_.memory="-",_.score=o.score,_.content=o.content,_.waHint=o.wa_hint,!_.content&&!_.waHint&&(_.content="无提示信息"),l.task.push(_)}return e.judger&&(l.judger=e.judger),e.judger_name?l.judgerName=e.judger_name:l.judgerName="-",e.judge_time&&(l.judgeTime=new Date(e.judge_time).toLocaleString()),l}function rn(e,l,n,r,o){return X({url:"/judge/approve",method:"post",data:{problem_id:e,contest_id:l,problem_index:n,language:r,code:o}})}function un(e){return X({url:"/judge?id="+e,method:"get"})}function cn(e){return X({url:"/judge/code?id="+e,method:"get"})}function dn(e,l,n,r,o,_,b){let h={problem_id:l,username:n,language:String(r),status:String(o),page:String(_),page_size:String(b)};return e&&(h.contest_id=String(e)),X({url:`/judge/list?${new URLSearchParams(h).toString()}`,method:"get"})}function mn(){return X({url:"/judge/statics/recently",method:"get"})}function pn(){return X({url:"/judge/rejudge/recently",method:"post"})}function fn(e,l,n){const r={};return e!=null&&(r.problem_id=e),l!=null?r.language=l:r.language=Ft.Unknown,n!=null?r.status=n:r.status=18,X({url:"/judge/rejudge/search",method:"post",data:r})}function vn(){return X({url:"/judge/rejudge/all",method:"post",timeout:0})}function _n(e){return X({url:"/judge/rejudge",method:"post",data:{id:Number(e)}})}var Oe=(e=>(e[e.None=0]="None",e[e.Attempt=1]="Attempt",e[e.Accept=2]="Accept",e))(Oe||{});function vt(e,l){const n={};if(n.id=e.id,n.author=e.author,n.title=e.title,n.tags=[],e.tags)for(const r of e.tags){const o=l[r];o&&n.tags.push(o)}if(n.private=e.private,n.accept=e.accept,n.attempt=e.attempt,e.description!=null&&(n.description=e.description),e.time_limit!=null&&e.time_limit>=0?n.timeLimit=e.time_limit.toString()+" ms":n.timeLimit="未知",e.memory_limit!=null&&e.memory_limit>=0?n.memoryLimit=(e.memory_limit/1024).toFixed(2)+" MB":n.memoryLimit="未知",e.judge_type!=null&&(n.judgeType=sn(e.judge_type)),e.insert_time!=null&&(n.insertTime=new Date(e.insert_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.source!=null){const r=/\[([^\]]+)\]\(([^)]+)\)/,o=e.source.match(r);o?(n.source=o[1],n.sourceUrl=o[2]):(n.source=e.source,n.sourceUrl="")}return e.judge_md5!=null&&(n.judgeMd5=e.judge_md5),e.origin_oj!=null&&(n.originOj=e.origin_oj),e.origin_id!=null&&(n.originId=e.origin_id),e.origin_url!=null&&(n.originUrl=e.origin_url),n}function ja(e,l){const n={};if(n.id=e.id,n.problemId=e.problem_id,n.title=e.title,n.tags=[],e.tags)for(const r of e.tags){const o=l[r];o&&n.tags.push(o)}return e.accept?n.accept=e.accept:n.accept=0,e.attempt?n.attempt=e.attempt:n.attempt=0,n.solution=e.solution,n.code=e.code,e.create_time!=null&&(n.createTime=new Date(e.create_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.updater_nickname!=null&&(n.updaterNickname=e.updater_nickname),n}function za(e,l,n){const r={};return e?r.id=e:(r.contest_id=l,r.problem_index=n),X({url:`/problem?${new URLSearchParams(r).toString()}`,method:"get"})}function $a(e){return X({url:"/problem/tag/list?max_count="+e,method:"get"})}function gn(e){return X({url:"/problem/judge?id="+e,method:"get"})}function bn(e,l,n,r,o,_){const b={};return e&&(b.oj=e),l&&(b.title=l),n&&(b.tag=n),r!==void 0&&(b.private=r?"1":"0"),o&&(b.page=o),_&&(b.page_size=_),X({url:`/problem/list?${new URLSearchParams(b).toString()}`,method:"get"})}function hn(e){const l={};return e&&(l.problem_id=e),X({url:`/problem/recommend?${new URLSearchParams(l).toString()}`,method:"get"})}function yn(e){return X({url:"/problem/daily?id="+e,method:"get"})}function wn(e){return X({url:"/problem/daily/edit?id="+e,method:"get"})}function kn(){return X({url:"/problem/daily/recently",method:"get"})}function Cn(e,l,n,r,o){const _={};return e&&(_.start_date=e),l&&(_.end_date=l),n&&(_.problem_id=n),r&&(_.page=r),o&&(_.page_size=o),X({url:`/problem/daily/list?${new URLSearchParams(_).toString()}`,method:"get"})}function Aa(e,l){return X({url:"/problem/crawl",method:"post",data:{oj:e,id:l}})}function Sn(e,l,n,r,o,_,b){return X({url:"/problem/create",method:"post",data:{title:e,time_limit:l,memory_limit:n,source:r,private:o,tags:_,description:b}})}function In(e,l,n,r,o,_,b,h){return X({url:"/problem/edit",method:"post",data:{id:e,title:l,time_limit:n,memory_limit:r,source:o,private:_,tags:b,description:h}})}function Pn(e,l,n,r){return X({url:"/problem/daily/create",method:"post",data:{id:e,problem_id:l,solution:n,code:r}})}function Tn(e,l,n,r){return X({url:"/problem/daily/edit",method:"post",data:{id:e,problem_id:l,solution:n,code:r}})}function xn(e,l){return X({url:"/problem/judge/data/download?id="+e+"&key="+l,method:"get"})}function Vn(e){return e||(e=""),X({url:"/problem/image/token?id="+e,method:"get"})}function ea(e){return e||(e=""),X({url:"/problem/daily/image/token?id="+e,method:"get"})}function Dn(e,l){const n=new FormData;return n.append("id",e),n.append("zip",l),X({url:"/problem/judge/data",method:"post",data:n,headers:{"Content-Type":"multipart/form-data"},timeout:1e3*60*5})}function Ln(e){return X({url:"/problem/parse",method:"post",data:{problems:e}})}const jn={class:"sh-main"},zn={class:"dida-swiper-div"},$n=["innerHTML"],An=ie({__name:"HomeView",setup(e){const{globalProperties:l}=pe();let n=-1;const r=d({theme:"info",content:""}),o=d({title:"",content:""}),_=d([]),b=d(!1),h=async()=>{r.value=await Pa()},C=async()=>{try{const m=await Ta(),c={math:{inlineDigit:!0,engine:"KaTeX"}};o.value.title=m.title,o.value.content=await me.md2html(m.content,c)}catch{ve(l,"加载公告失败"),o.value={title:"公告加载失败",content:"请刷新页面重新获取"}}},g=async()=>{const m=await mn();if(m.code!==0){ve(l,"加载OJ统计数据失败");return}let c=[];for(const p of m.data){const k=new Date(p.date),f=`${k.getMonth()+1}-${k.getDate()}`;c.push({Date:f,Type:"Unaccept",Count:p.attempt-p.accept}),c.push({Date:f,Type:"Accept",Count:p.accept})}const y={type:"bar",data:[{id:"barData",values:c}],xField:"Date",yField:"Count",seriesField:"Type",stack:!0,legends:{visible:!0},bar:{state:{hover:{stroke:"#000",lineWidth:1}}},height:300};new Xa(y,{dom:"ojStaticsDiv"}).renderSync()},i=async()=>{_.value=[];const m=await kn();if(m.code!==0){ve(l,"加载每日问题数据失败");return}m.data.list&&m.data.list.length>0&&m.data.list.forEach(c=>{let y="default",P="未尝试";if(m.data.attempt_status){const k=m.data.attempt_status[c.problem_id];if(k)switch(k){case Oe.Accept:y="success",P="已解决";break;case Oe.Attempt:y="warning",P="待解决";break;default:y="default",P="未尝试"}}const p=`${c.title}`;_.value.push({id:c.id,title:p,problemId:c.problem_id,theme:y,tag:P})})};return de(async()=>{b.value=!0,await h(),n=setInterval(()=>{h()},3e4),await C(),await g(),await i(),b.value=!1}),Ja(()=>{clearInterval(n)}),(m,c)=>{const y=Tt,P=hl,p=bl,k=he,f=xe,v=st,u=kl,s=lt,x=wl,w=yl,j=Te,M=De;return D(),E(M,{loading:b.value},{default:a(()=>[t(j,null,{default:a(()=>[t(f,{span:8},{default:a(()=>{var V;return[A("div",jn,[r.value?(D(),E(y,{key:0,class:"dida-notification-div",theme:r.value.theme},{default:a(()=>[S(q(r.value.content),1)]),_:1},8,["theme"])):ne("",!0),A("div",zn,[t(p,{class:"dida-swiper"},{default:a(()=>[t(P,null,{default:a(()=>c[1]||(c[1]=[A("a",{href:"http://codeoj.cn",target:"_blank"},[A("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"})],-1)])),_:1}),t(P,null,{default:a(()=>c[2]||(c[2]=[A("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1})]),_:1})]),c[3]||(c[3]=A("div",{id:"ojStaticsDiv"},null,-1)),t(k,{title:(V=o.value)==null?void 0:V.title,style:{width:"calc(100% - 100px)",margin:"0 auto"}},{default:a(()=>{var I;return[A("div",{innerHTML:(I=o.value)==null?void 0:I.content},null,8,$n)]}),_:1},8,["title"])])]}),_:1}),t(f,{span:4},{default:a(()=>[t(k,{style:{margin:"10px"},bordered:!0},{default:a(()=>c[4]||(c[4]=[A("img",{src:"https://api.jysafe.cn/ip/",alt:"Welcome",style:{width:"100%"}},null,-1)])),_:1}),t(Jl,{style:{margin:"10px"}}),t(k,{style:{margin:"10px"},bordered:!0,title:"每日一题"},{actions:a(()=>[t(v,{onClick:c[0]||(c[0]=V=>m.$router.push({name:"problem-daily-list"}))},{default:a(()=>c[5]||(c[5]=[S("查看全部")])),_:1})]),default:a(()=>[t(w,{split:!0,size:"small"},{default:a(()=>[(D(!0),ee(re,null,Ie(_.value,V=>(D(),E(x,{key:V.id},{default:a(()=>[t(u,{style:{width:"100px"}},{description:a(()=>[t(v,{onClick:I=>m.$router.push({name:"problem-daily-detail",params:{dailyId:V.id}})},{default:a(()=>[S(q(V.problemId),1)]),_:2},1032,["onClick"])]),_:2},1024),t(u,{style:{width:"200px"}},{description:a(()=>[t(v,{onClick:I=>m.$router.push({name:"problem-daily-detail",params:{dailyId:V.id}})},{default:a(()=>[S(q(V.title),1)]),_:2},1032,["onClick"])]),_:2},1024),t(u,{style:{width:"135px"},description:V.id},null,8,["description"]),t(u,null,{description:a(()=>[t(s,{theme:V.theme},{default:a(()=>[S(q(V.tag),1)]),_:2},1032,["theme"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),t(k,{style:{margin:"10px"},bordered:!0},{header:a(()=>c[6]||(c[6]=[A("b",null,"友情链接",-1)])),default:a(()=>[t(w,null,{default:a(()=>[t(x,null,{default:a(()=>[t(v,{href:"https://boiltask.com",target:"_blank"},{default:a(()=>c[7]||(c[7]=[S("BoilTask Blog")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])}}}),ue=(e,l)=>{const n=e.__vccOpts||e;for(const[r,o]of l)n[r]=o;return n},Un=ue(An,[["__scopeId","data-v-91bd14b1"]]),Rn={class:"sh-main"},Mn=ie({__name:"View404",setup(e){let l=ke(),n=d(l.fullPath);return(r,o)=>{const _=G;return D(),ee("div",Rn,[A("p",null,q(fe(n)),1),o[2]||(o[2]=A("p",null,"该页面无效或已被迁移，请重新选择访问目标",-1)),t(_,{theme:"primary",onClick:o[0]||(o[0]=()=>r.$router.push("/"))},{default:a(()=>o[1]||(o[1]=[S("返回首页")])),_:1})])}}}),Ua=ue(Mn,[["__scopeId","data-v-d4218944"]]);function En(e){const l={};return l.id=e.id,l.username=e.username,l.nickname=e.nickname,l.email=e.email,l.slogan=e.slogan,l.organization=e.organization,l.accept=e.accept,l.attempt=e.attempt,l.vjudgeId=e.vjudge_id,e.email&&(l.avatar=`https://www.gravatar.com/avatar/${Ya(e.email.toLowerCase().trim())}?d=identicon&s=100`),l}function qn(e,l){return X({url:"/user/login",method:"post",data:{username:e,password:l}})}function Kn(){return X({url:"/user/login/refresh",method:"post"})}function Nn(e){const l={username:e};return X({url:`/user/info?${new URLSearchParams(l).toString()}`,method:"get"})}function Fn(e){const l="https://vjudge.net/user/solveDetail/"+encodeURIComponent(e);return Dt({url:l,method:"get"})}function On(e){return X({url:"/user/account/infos",method:"post",data:{users:e}})}function Gn(e){return X({url:"/user/parse",method:"post",data:{users:e}})}function Hn(e,l){return X({url:"/user/register/email",method:"post",data:{token:e,email:l}})}function Bn(e,l,n,r,o){return X({url:"/user/register",method:"post",data:{username:e,password:l,email:n,key:r,nickname:o}})}function Wn(e,l){return X({url:"/user/forget",method:"post",data:{token:e,username:l}})}function Jn(e,l,n){return X({url:"/user/password/modify",method:"post",data:{username:e,password:l,key:n}})}const Xn={class:"dida-login-footer"},Yn=ie({__name:"LoginView",setup(e){const{globalProperties:l}=pe(),n=qe(),r=d(!1),o=d({username:"",password:""}),_=()=>{be(l,"重置成功")},b=({validateResult:h,firstError:C})=>{r.value||(r.value=!0,qn(o.value.username,o.value.password).then(g=>{if(g.code===0){n.loadResponse(g.data),be(l,"登录成功");let i=l.$route.query.redirect_uri;i||(i="/user/"+g.data.username),l.$router.push({path:i})}else F(l,g.code)}).catch(g=>{console.error("Login error",g),ve(l,"登录失败")}).finally(()=>{r.value=!1}))};return de(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),(h,C)=>{const g=Ue,i=Ae,m=G,c=$e,y=st,P=he;return D(),E(P,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(c,{ref:"form",data:o.value,colon:!0,onReset:_,onSubmit:b,class:"yj-login-form","label-width":0},{default:a(()=>[t(i,{name:"username"},{default:a(()=>[t(g,{modelValue:o.value.username,"onUpdate:modelValue":C[0]||(C[0]=p=>o.value.username=p),clearable:"",autocomplete:"username",placeholder:"请输入用户名"},{"prefix-icon":a(()=>[t(fe(Za))]),_:1},8,["modelValue"])]),_:1}),t(i,{name:"password"},{default:a(()=>[t(g,{modelValue:o.value.password,"onUpdate:modelValue":C[1]||(C[1]=p=>o.value.password=p),type:"password",autocomplete:"current-password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":a(()=>[t(fe(Qa))]),_:1},8,["modelValue"])]),_:1}),t(i,null,{default:a(()=>[t(m,{theme:"primary",type:"submit",block:"",loading:r.value},{default:a(()=>C[4]||(C[4]=[S("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),A("div",Xn,[t(y,{onClick:C[2]||(C[2]=()=>{fe(l).$router.push({name:"login-forget"})})},{default:a(()=>C[5]||(C[5]=[S("忘记密码 ")])),_:1}),t(y,{onClick:C[3]||(C[3]=()=>{fe(l).$router.push({name:"register"})})},{default:a(()=>C[6]||(C[6]=[S("注册账户 ")])),_:1})])]),_:1})}}}),Zn=ue(Yn,[["__scopeId","data-v-0466c42d"]]),Qn={class:"dida-login-footer"},eo=ie({__name:"RegisterView",setup(e){const{globalProperties:l}=pe(),n=qe(),r=d(!1),o=d(!1),_=d(!1),b=d("发送验证码");let h=null,C=-1;const g=d(!1),i=d(null),m=d({username:"",password:"",confirmPassword:"",nickname:"",email:"",emailKey:""}),y=d({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:u=>new Promise(s=>{const x=setTimeout(()=>{s(m.value.password===u),clearTimeout(x)})}),message:"两次密码不一致"}],nickname:[{required:!0,message:"请填写昵称"},{min:1,message:"昵称至少1个字符"},{max:30,message:"昵称最多30个字符"}],email:[{required:!0,message:"请填写邮箱"},{pattern:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"邮箱格式不正确"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),P=d(()=>t(G,{onClick:p,disabled:_.value,loading:o.value,style:"width:120px"},{default:()=>[b.value]})),p=async()=>{var w;if(!m.value.email){ve(l,"请输入邮箱");return}if(!m.value.email.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)){ve(l,"邮箱格式不正确");return}if(_.value||o.value)return;g.value=!0,await Ge();const u=document.getElementById("cf-confirm-div");u&&u.remove();const s=document.createElement("div");s.id="cf-confirm-div",s.setAttribute("data-theme","light"),(w=i.value)==null||w.appendChild(s);const x=window;x.turnstile.ready(function(){x.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(j){g.value=!1,await k(j)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},k=async u=>{if(!_.value){o.value=!0;try{const s=await Hn(u,m.value.email);if(s.code!==0){F(l,s.code);return}be(l,"发送验证码成功"),o.value=!1,_.value=!0,h=new Date,b.value="60秒后重发",C=setInterval(()=>{const w=Math.floor((new Date().getTime()-(h==null?void 0:h.getTime()))/1e3);w>60?(b.value="发送验证码",_.value=!1,clearInterval(C)):b.value=`${60-w}秒后重发`},1e3)}catch{ve(l,"发送验证码失败")}finally{o.value=!1}}},f=()=>{be(l,"重置成功")},v=({validateResult:u,firstError:s,e:x})=>{if(!r.value){if(x.preventDefault(),u!==!0){ve(l,s);return}if(m.value.password!==m.value.confirmPassword){ve(l,"两次密码不一致");return}r.value=!0,Bn(m.value.username,m.value.password,m.value.email,m.value.emailKey,m.value.nickname).then(w=>{w.code===0?(be(l,"注册成功，可使用账号信息登录"),l.$router.push({name:"login"})):F(l,w.code)}).catch(w=>{console.error("Login error",w),ve(l,"登录失败")}).finally(()=>{r.value=!1})}};return de(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),Le(()=>{clearInterval(C)}),(u,s)=>{const x=Ue,w=Ae,j=ya,M=G,V=$e,I=st,z=he,R=ot;return D(),ee(re,null,[t(z,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(V,{ref:"form",rules:y.value,data:m.value,colon:!0,onReset:f,onSubmit:v,class:"yj-login-form"},{default:a(()=>[t(w,{name:"username",label:"用户名"},{default:a(()=>[t(x,{modelValue:m.value.username,"onUpdate:modelValue":s[0]||(s[0]=U=>m.value.username=U),clearable:"",placeholder:"用于登录与查找"},null,8,["modelValue"])]),_:1}),t(w,{name:"password",label:"密码"},{default:a(()=>[t(x,{modelValue:m.value.password,"onUpdate:modelValue":s[1]||(s[1]=U=>m.value.password=U),type:"password",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(w,{name:"confirmPassword",label:"确认密码"},{default:a(()=>[t(x,{modelValue:m.value.confirmPassword,"onUpdate:modelValue":s[2]||(s[2]=U=>m.value.confirmPassword=U),type:"password",clearable:"",placeholder:"请确认密码"},null,8,["modelValue"])]),_:1}),t(w,{name:"nickname",label:"昵称"},{default:a(()=>[t(x,{modelValue:m.value.nickname,"onUpdate:modelValue":s[3]||(s[3]=U=>m.value.nickname=U),clearable:"",placeholder:"用于优先在网站各处展示"},null,8,["modelValue"])]),_:1}),t(w,{name:"email",label:"邮箱"},{default:a(()=>[t(x,{modelValue:m.value.email,"onUpdate:modelValue":s[4]||(s[4]=U=>m.value.email=U),clearable:"",placeholder:"请填写常用邮箱"},null,8,["modelValue"])]),_:1}),t(w,{name:"emailKey",label:"验证码"},{default:a(()=>[t(j,{append:P.value},{default:a(()=>[t(x,{modelValue:m.value.emailKey,"onUpdate:modelValue":s[5]||(s[5]=U=>m.value.emailKey=U),clearable:"",placeholder:"请输入验证码",style:{width:"140px"}},null,8,["modelValue"])]),_:1},8,["append"])]),_:1}),t(w,null,{default:a(()=>[t(M,{theme:"primary",type:"submit",block:"",loading:r.value},{default:a(()=>s[8]||(s[8]=[S("注册")])),_:1},8,["loading"])]),_:1})]),_:1},8,["rules","data"]),A("div",Qn,[t(I,{onClick:s[6]||(s[6]=()=>{fe(l).$router.push({name:"login"})})},{default:a(()=>s[9]||(s[9]=[S("返回登陆 ")])),_:1})])]),_:1}),t(R,{visible:g.value,"onUpdate:visible":s[7]||(s[7]=U=>g.value=U),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:a(()=>[A("div",{ref_key:"dialogContainer",ref:i,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),to=ue(eo,[["__scopeId","data-v-d25e7538"]]),ao={key:0,style:{margin:"10px"}},lo={key:1,style:{margin:"10px"}},no={style:{margin:"12px"}},oo=ie({__name:"UserView",setup(e){let l=ke();const{globalProperties:n}=pe(),r=Ye();let o="";const _=d(!1),b=d(null),h=d([]),C=d([]),g=d([]),i=async m=>{_.value=!0;try{let c=await Nn(m);if(c.code!==0){_.value=!1,F(n,c.code),await Z.push({name:"home"});return}if(b.value=En(c.data.user),h.value=c.data.problems_ac,r.setTitle(b.value.nickname+" - "+r.getTitle),b.value.vjudgeId){const y=await Fn(b.value.vjudgeId);C.value=y.acRecords;for(const P in C.value)C.value[P].sort((p,k)=>p.length===k.length?p.localeCompare(k):p.length-k.length);g.value=y.failRecords;for(const P in g.value)g.value[P].sort((p,k)=>p.length===k.length?p.localeCompare(k):p.length-k.length)}}catch{ve(n,"获取用户信息失败"),await Z.push({name:"home"})}finally{_.value=!1}};return el(async(m,c,y)=>{if(Array.isArray(m.params.username)?o=m.params.username[0]:o=m.params.username,!o){await Z.push({name:"home"});return}await i(o),y()}),de(async()=>{if(Array.isArray(l.params.username)?o=l.params.username[0]:o=l.params.username,!o){await Z.push({name:"home"});return}await i(o)}),(m,c)=>{const y=G,P=ye,p=he,k=st,f=Xe,v=Je,u=xe,s=Cl,x=Te,w=De;return D(),E(w,{loading:_.value},{default:a(()=>[t(x,{class:"dida-main-content"},{default:a(()=>[t(u,{span:8},{default:a(()=>{var j;return[t(p,{style:{margin:"10px"},title:"AC题目"},{default:a(()=>[t(P,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(D(!0),ee(re,null,Ie(h.value,M=>(D(),E(y,{key:M,size:"small",onClick:()=>fe(Z).push({name:"problem-detail",params:{problemId:M}})},{default:a(()=>[S(q(M),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),(j=b.value)!=null&&j.vjudgeId?(D(),E(p,{key:0,style:{margin:"10px"},title:"vjudge.net"},{actions:a(()=>{var M;return[t(k,{href:"https://vjudge.net/user/"+((M=b.value)==null?void 0:M.vjudgeId),target:"_blank"},{default:a(()=>{var V;return[S("@"+q((V=b.value)==null?void 0:V.vjudgeId),1)]}),_:1},8,["href"])]}),default:a(()=>[C.value&&Object.keys(C.value).length>0?(D(),ee("div",ao,[c[0]||(c[0]=A("div",{style:{margin:"5px"}},[A("span",null,"AC")],-1)),t(v,{layout:"vertical",bordered:!0},{default:a(()=>[(D(!0),ee(re,null,Ie(C.value,(M,V)=>(D(),E(f,{key:V,label:V},{default:a(()=>[t(P,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(D(!0),ee(re,null,Ie(M,I=>(D(),E(y,{key:I,size:"small",onClick:()=>fe(Z).push({name:"problem-detail",params:{problemId:V+"-"+I}})},{default:a(()=>[S(q(I),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):ne("",!0),g.value&&Object.keys(g.value).length>0?(D(),ee("div",lo,[c[1]||(c[1]=A("div",{style:{margin:"5px"}},[A("span",null,"Fail")],-1)),t(v,{layout:"vertical",bordered:!0},{default:a(()=>[(D(!0),ee(re,null,Ie(g.value,(M,V)=>(D(),E(f,{key:V,label:V},{default:a(()=>[t(P,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(D(!0),ee(re,null,Ie(M,I=>(D(),E(y,{key:I,size:"small",onClick:()=>fe(Z).push({name:"problem-detail",params:{problemId:V+"-"+I}})},{default:a(()=>[S(q(I),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):ne("",!0)]),_:1})):ne("",!0)]}),_:1}),t(u,{span:4},{default:a(()=>[A("div",no,[t(v,{layout:"vertical",bordered:!0},{default:a(()=>[t(f,{label:"头像"},{default:a(()=>{var j;return[t(s,{shape:"round",size:"100px",image:(j=b.value)==null?void 0:j.avatar,"hide-on-load-failed":!1},null,8,["image"])]}),_:1}),t(f,{label:"昵称"},{default:a(()=>{var j;return[S(q((j=b.value)==null?void 0:j.nickname),1)]}),_:1}),t(f,{label:"Slogan"},{default:a(()=>{var j;return[S(q((j=b.value)==null?void 0:j.slogan),1)]}),_:1}),t(f,{label:"邮箱"},{default:a(()=>{var j;return[S(q((j=b.value)==null?void 0:j.email),1)]}),_:1}),t(f,{label:"组织"},{default:a(()=>{var j;return[S(q((j=b.value)==null?void 0:j.organization),1)]}),_:1}),t(f,{label:"通过数量"},{default:a(()=>{var j;return[S(q((j=b.value)==null?void 0:j.accept),1)]}),_:1}),t(f,{label:"提交数量"},{default:a(()=>{var j;return[S(q((j=b.value)==null?void 0:j.attempt),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),so=ue(oo,[["__scopeId","data-v-6d730b5a"]]),Ht=[{name:"home",path:"/",title:"首页",showSidebar:!1,disableGenerateTab:!0,component:Un},{name:"problem",path:"/problem",title:"题目",icon:"calculation",showSidebar:!0,redirect:"problem-list"},{name:"collection-detail-tab",title:"题集",path:"/collection",showSidebar:!0,disableGenerateTab:!0,redirect:"problem-collection-list"},{name:"judge",path:"/judge",title:"评测",icon:"code",showSidebar:!0,redirect:"judge-list"},{name:"contest",path:"/contest",title:"比赛",icon:"application",showSidebar:!0,redirect:"contest-list"},{name:"contest-detail-tab",title:"比赛",path:"/contest",showSidebar:!0,disableGenerateTab:!0,redirect:"contest-list"},{name:"discuss",title:"讨论",path:"/discuss",icon:"sonic",showSidebar:!0,redirect:"discuss-list"},{name:"rank",path:"/rank",title:"排名",icon:"chart-column",showSidebar:!0,redirect:"rank-ac-all"},{name:"system",path:"/system",title:"系统",icon:"dashboard",showSidebar:!0,redirect:"system-status"},{name:"manage",path:"/manage",title:"管理",icon:"command",showSidebar:!0,redirect:"manage-web",auths:[je.ManageWeb]},{name:"login",path:"/login",title:"登陆",showSidebar:!1,disableGenerateTab:!0,component:Zn},{name:"register",path:"/register",title:"注册",showSidebar:!1,disableGenerateTab:!0,component:to},{name:"user",path:"/user/:username+",title:"用户",showSidebar:!1,needLogin:!0,disableGenerateTab:!0,component:so},{name:"404",path:"/404",title:"404",showSidebar:!1,disableGenerateTab:!0,component:Ua}],ro=e=>Ht.find(l=>l.name==e),io=e=>{const l=[];return Ht.forEach(n=>{!n.disableGenerateTab&&e.hasAllAuths(n.auths)&&l.push(n)}),l},uo=e=>{Ht.forEach(l=>{const n={name:l.name,path:l.path,meta:{title:l.title,tab:l.name,showSidebar:l.showSidebar,needLogin:l.needLogin,redirect:l.redirect,tabAuths:l.auths},component:l.component};e.push(n)})};function Ra(e){return e.children!==void 0}function co(e){return e.children!==void 0}const mo={style:{margin:"10px"}},po={key:0,class:"dida-operation-container"};function fo(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const vo=ie({__name:"ProblemList",setup(e){const l=ke(),n=We(),{globalProperties:r}=pe(),o=qe();let _=null;const b=d(!1),h={};let C={};const g=d(!1),i=He(()=>o.hasAuth(je.ManageProblem)),m=d([{title:"ID",colKey:"id",cell:(U,T)=>{let L=w(T.row.id);return t(G,{variant:"dashed",theme:L,onClick:()=>x(T.row.id)},{default:()=>[T.row.id]})}},{title:"标题",colKey:"title",cell:(U,T)=>t(G,{variant:"text",onClick:()=>x(T.row.id)},{default:()=>[T.row.title]})},{title:"标签",colKey:"tags",cell:(U,T)=>{const L=T.row.tags;if(!L||L.length===0)return"";let $=[];for(let K=0;K<L.length;K++){const Y=L[K];$.push(t(G,{key:K,theme:"default",variant:"outline",size:"small",onClick:()=>V(Y)},{default:()=>[Y.name]}))}return t(ye,null,fo($)?$:{default:()=>[$]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),c=d(!1);let y=1,P=50;const p=d({current:y,pageSize:P,defaultCurrent:y,defaultPageSize:P,total:0,pageSizeOptions:[50,100]}),k=d(),f=d(),v=[{label:"DidaOJ",value:"didaoj"},{label:"HDU",value:"hdu"},{label:"POJ",value:"poj"},{label:"NYOJ",value:"nyoj"}],u=d({oj:"",title:"",tag:"",private:!1}),s=d({oj:"",problem:""}),x=U=>{U&&n.push({path:"/problem/"+U})},w=U=>{if(!U||!C)return"default";const T=C[U];if(!T)return"default";switch(T){case Oe.Accept:return"success";case Oe.Attempt:return"warning";default:return"default"}},j=async()=>{await n.push({query:{...l.query,oj:u.value.oj,title:u.value.title,tag:u.value.tag,private:u.value.private?"1":"0",page:1,page_size:p.value.defaultPageSize}})},M=async()=>{try{g.value=!0;const U=await Aa(s.value.oj,s.value.problem);U.code===0?(be(r,"搜索成功"),await n.push({name:"problem-detail",params:{problemId:U.data}})):F(r,U.code)}catch(U){console.error(U),F(r,Ne())}finally{g.value=!1}},V=U=>{U&&n.push({query:{...l.query,title:"",tag:U.name,page:1,page_size:p.value.defaultPageSize}})},I=()=>{n.push({name:"manage-problem-create"})},z=async(U,T)=>{c.value=!0;try{const{current:L,pageSize:$}=U,K=await bn(u.value.oj,u.value.title,u.value.tag,u.value.private,L,$);if(k.value=[],K.code===0){const Y=K.data.list;if(!Y||Y.length<=0){p.value={...p.value,total:0},C={},be(r,"未找到记录");return}Y.forEach(ae=>{var O;const H=vt(ae,h);(O=k.value)==null||O.push(H)}),p.value={...p.value,total:K.data.total_count},C=K.data.problem_attempt_status}else T&&F(r,K.code)}catch(L){console.error(L),F(r,Ne())}finally{c.value=!1}},R=async U=>{await n.push({query:{...l.query,page:U.current,page_size:U.pageSize}})};return de(async()=>{c.value=!0,f.value=[],$a(-1).then(U=>{if(U.code===0){f.value=U.data.list,b.value=U.data.total_count>U.data.list.length;for(let T=0;T<U.data.list.length;T++){const L=U.data.list[T];h[L.id]=L}_=ze(()=>l.query,T=>{u.value.oj=T.oj||"",u.value.title=T.title||"",u.value.tag=T.tag||"",u.value.private=T.private==="1";const L=parseInt(T.page)||p.value.defaultCurrent,$=parseInt(T.page_size)||p.value.defaultPageSize;y=L,P=$,p.value={...p.value,current:y,pageSize:P},z({current:y,pageSize:P},!0)},{immediate:!0})}else b.value=!0}).catch(U=>{console.error(U),b.value=!0})}),Le(()=>{_&&_()}),(U,T)=>{const L=Re,$=he,K=xe,Y=G,ae=ye,H=pt,O=Ae,N=Ue,Ce=ft,Ve=$e,J=Te;return D(),E(J,null,{default:a(()=>[t(K,{span:9},{default:a(()=>[t($,{style:{margin:"10px"}},{default:a(()=>[t(L,{data:k.value,columns:m.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:p.value,"table-layout":"auto",loading:c.value,onPageChange:R},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(K,{span:3},{default:a(()=>[A("div",mo,[i.value?(D(),ee("div",po,[t(ae,null,{default:a(()=>[t(Y,{onClick:I},{default:a(()=>T[7]||(T[7]=[S("新建")])),_:1})]),_:1})])):ne("",!0),t($,{class:"sh-card"},{default:a(()=>[t(Ve,{model:u.value,onSubmit:j},{default:a(()=>[t(O,{label:"OJ"},{default:a(()=>[t(H,{modelValue:u.value.oj,"onUpdate:modelValue":T[0]||(T[0]=B=>u.value.oj=B),options:v,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(O,{label:"标题"},{default:a(()=>[t(N,{modelValue:u.value.title,"onUpdate:modelValue":T[1]||(T[1]=B=>u.value.title=B),placeholder:"请输入关键词"},null,8,["modelValue"])]),_:1}),t(O,{label:"标签"},{default:a(()=>[t(N,{modelValue:u.value.tag,"onUpdate:modelValue":T[2]||(T[2]=B=>u.value.tag=B),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),i.value?(D(),E(O,{key:0,label:"私有"},{default:a(()=>[t(Ce,{modelValue:u.value.private,"onUpdate:modelValue":T[3]||(T[3]=B=>u.value.private=B)},null,8,["modelValue"])]),_:1})):ne("",!0),t(O,null,{default:a(()=>[t(Y,{theme:"primary",type:"submit"},{default:a(()=>T[8]||(T[8]=[S("搜索")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t($,{class:"sh-card"},{default:a(()=>[t(Ve,{model:s.value,onSubmit:M},{default:a(()=>[t(O,{label:"OJ"},{default:a(()=>[t(H,{modelValue:s.value.oj,"onUpdate:modelValue":T[4]||(T[4]=B=>s.value.oj=B),options:v,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(O,{label:"题目"},{default:a(()=>[t(N,{modelValue:s.value.problem,"onUpdate:modelValue":T[5]||(T[5]=B=>s.value.problem=B),placeholder:"请输入原始题号"},null,8,["modelValue"])]),_:1}),t(O,null,{default:a(()=>[t(Y,{theme:"primary",type:"submit",loading:g.value},{default:a(()=>T[9]||(T[9]=[S("前往")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),t($,{class:"sh-card sh-background-black"},{default:a(()=>[(D(!0),ee(re,null,Ie(f.value,B=>(D(),E(Y,{class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:()=>V(B)},{default:a(()=>[S(q(B.name),1)]),_:2},1032,["onClick"]))),256)),b.value?(D(),E(Y,{key:0,class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:T[6]||(T[6]=()=>U.$router.push("/problem/tags"))},{default:a(()=>T[10]||(T[10]=[S(" ... ")])),_:1})):ne("",!0)]),_:1})])]),_:1})]),_:1})}}}),_o=ue(vo,[["__scopeId","data-v-bc7185f5"]]);function et(e){e.querySelectorAll("pre > code:not([data-copy-attached])").forEach(n=>{n.setAttribute("data-copy-attached","true");const r=n.parentElement,o=document.createElement("div");o.className="copy-wrapper";const _=document.createElement("button");_.className="copy-btn",_.innerText="复制",_.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(n.innerText),_.innerText="已复制",setTimeout(()=>_.innerText="复制",1500)}catch{_.innerText="失败"}}),r.replaceWith(o),o.appendChild(_),o.appendChild(r)})}function nt(e){let l="";for(;e>0;)e--,l=String.fromCharCode(65+e%26)+l,e=Math.floor(e/26);return l}async function Bt(e){const l={};l.id=e.id,l.ownerId=e.owner_id,l.ownerUsername=e.owner_username,l.ownerNickname=e.owner_nickname,l.title=e.title,l.startTime=new Date(e.start_time).toLocaleString(),l.endTime=new Date(e.end_time).toLocaleString(),l.createTime=new Date(e.create_time).toLocaleString(),l.updateTime=new Date(e.update_time).toLocaleString(),l.private=e.private;const n={math:{inlineDigit:!0,engine:"KaTeX"}};if(l.description=await me.md2html(e.description,n),l.notification=e.notification,e.problems){l.problems=[],e.problems.sort((r,o)=>r.index-o.index);for(let r=0;r<e.problems.length;r++){const o=e.problems[r];let _={accept:0,attempt:0,author:"",id:"",private:!1,tags:[],title:""};_.index=o.index,_.id=nt(o.index),_.title=o.title,o.accept?_.accept=o.accept:_.accept=0,o.attempt?_.attempt=o.attempt:_.attempt=0,l.problems.push(_)}}return l}function go(e){return X({url:"/contest?id="+e,method:"get"})}function bo(e){return X({url:"/contest/edit?id="+e,method:"get"})}function ho(e){return X({url:"/contest/problem/list?id="+e,method:"get"})}function yo(e,l){return X({url:"/contest/problem?id="+e+"&problem_index="+l,method:"get"})}function wo(e,l){return X({url:"/contest/list?page="+e+"&page_size="+l,method:"get"})}function ko(e){return X({url:"/contest/rank?id="+e,method:"get"})}function Co(e){return X({url:"/contest/create",method:"post",data:e})}function So(e){return X({url:"/contest/edit",method:"post",data:e})}function Io(e,l){return X({url:"/contest/password",method:"post",data:{id:e,password:l}})}function Po(e){return X({url:"/contest/dolos",method:"post",data:{id:e}})}const Wt=async(e,l)=>{l&&await e.push({name:"user",params:{username:l}})},ta=e=>{const l=Z.resolve({name:"problem-detail",params:{problemId:e}});window.open(l.href,"_blank")},Et=async(e,l)=>{await Z.push({name:"contest-problem-detail",params:{contestId:e,problemIndex:l}})};function To(e,l){return fetch(e,{method:"PUT",headers:{"Content-Type":l.type},body:l})}async function Pt(e,l,n,r){var _;if(!e)return F(n,"编辑器已失效，请刷新后重试"),null;const o=be(n,"图片正在上传，请稍候...",0);console.log("正在上传图片",l),e.disabled();try{for(const b of l){console.log(b);const C=`[正在上传 ⏳ ${((_=crypto.randomUUID)==null?void 0:_.call(crypto))||Math.random().toString(36).substring(2)}]`;let g=C.replace("⏳",'<span class="sh-anim-loop" style="display: inline-block; font-size: 16px;">⏳</span>');e.insertValue(`
${g}
`,!1);const i=await r();if(i.code!==0){F(n,i.code);let P=e.getValue();P=P.replace(C,"图片上传失败"),e.setValue(P);continue}const m=i.data.upload_url;await To(m,b);const c="![图片]("+i.data.preview_url+")";let y=e.getValue();y=y.replace(C,c),e.setValue(y)}}finally{e.enable(),nn(n,o)}return null}function aa(e){const l={math:{inlineDigit:!0,engine:"KaTeX"}};return me.md2html(e,l)}const xo={class:"sh-button"},Vo={style:{"margin-top":"16px"}},Do={__name:"SecretPanel",setup(e){const l=d(!1);return(n,r)=>{const o=G;return D(),ee("div",nl(ol(n.$attrs)),[A("div",xo,[t(o,{onClick:r[0]||(r[0]=_=>l.value=!l.value)},{default:a(()=>[S(q(l.value?"收起":"展开"),1)]),_:1})]),tl(A("div",Vo,[ll(n.$slots,"default",{},void 0)],512),[[al,l.value]])],16)}}},la=ue(Do,[["__scopeId","data-v-83e9f414"]]),Lo=["innerHTML"],jo=["innerHTML"],zo={key:1,style:{"text-align":"center"}},$o={style:{"margin-left":"-100px"}},Ao=["innerHTML"],Uo={key:1,style:{"text-align":"center"}},Ro={style:{"margin-left":"-100px"}},Mo={key:0,class:"dida-problems-container"},Eo={style:{margin:"12px"}},qo={key:1},Ko={class:"dida-operation-container"},No={key:0,class:"dida-operation-container"},Fo={class:"dida-code-submit-div"},Oo={class:"dida-code-editor-div"},Go=ie({__name:"ProblemDetail",setup(e){let l=ke();const{globalProperties:n}=pe();let r=null;const o=Ye(),_=qe();let b=d(""),h="",C="",g=0,i=d(0);const m=d(!1),c=d(!1),y=d(null),P=d(null),p=d(null),k=d(!1),f=d(null);let v=null;const u=d(null),s=d(!1),x=d(!1),w={},j=d(""),M=d([]);M.value=Ot();const V=d([]),I=d(null),z=d(-1),R=d(-1),U=d(""),T=d("");let L=0;const $=He(()=>_.hasAuth(je.ManageProblem)),K=He(()=>_.hasAuth(je.ManageProblemDaily)),Y=()=>{I.value&&clearInterval(I.value),I.value=setInterval(()=>{const le=z.value<=0,Q=new Date(new Date().getTime()+L),W=Q.getHours()*60*60+Q.getMinutes()*60+Q.getSeconds(),se=18*60*60;W<se?z.value=se-W:z.value=-1,R.value=24*60*60-W,(!le&&z.value<=0||R.value<=0)&&Se()},1e3)},ae=()=>{I.value&&(clearInterval(I.value),I.value=null)},H=le=>{le&&Z.push({name:"problem-list",query:{...l.query,title:"",tag:le.name}})},O=async()=>{if(!C){ve(n,"每日问题ID无效");return}await Z.push({name:"manage-problem-daily",params:{dailyId:C}})},N=async()=>{let le=h;if(!le)try{const Q=await yo(g,i.value);Q.code===0?le=Q.data:F(n,Q.code)}catch{ve(n,"获取题目ID失败，请稍后再试");return}await Z.push({name:"manage-problem",params:{problemId:le}})},Ce=()=>{h?Z.push({name:"judge-list",query:{problem_id:h}}):Z.push({name:"contest-judge",params:{contestId:g},query:{problem_id:nt(i.value)}})},Ve=()=>{h?Z.push({name:"discuss-list-problem",query:{problem_id:h}}):Z.push({name:"contest-discuss",params:{contestId:g},query:{problem_id:nt(i.value)}})},J=()=>{Z.push({name:"problem-recommend",params:{problemId:h}})},B=async()=>{var W,se;const le=(W=f.value)==null?void 0:W.originOj,Q=(se=f.value)==null?void 0:se.originId;if(!(!le||!Q))try{s.value=!0;const _e=await Aa(le,Q);_e.code===0?(await ge(),be(n,"更新成功")):F(n,_e.code)}catch{ve(n,"更新失败，请稍后再试")}finally{s.value=!1}},ce=async()=>{const le=parseInt(j.value);if(!kt(le)){ve(n,"请选择所编写的语言");return}const Q=v==null?void 0:v.getValue();if(!Q){ve(n,"请输入所需提交的代码");return}if(!h&&(!g||!i.value)){ve(n,"问题ID无效");return}x.value=!0;try{const W=await rn(h,g,i.value,le,Q);if(W.code!==0){F(n,W.code);return}be(n,"提交成功，正在跳转到详情页面");const se=W.data.id;g?await Z.push({name:"contest-judge-detail",params:{contestId:g,judgeId:se}}):await Z.push({name:"judge-detail",params:{judgeId:se}})}finally{x.value=!1}},te=le=>{if(!v)return;const Q=v.getModel();Q&&Qt.setModelLanguage(Q,Gt(le))},ge=async()=>{V.value=[];let le=await za(h,g,i.value);if(le.code!==0){k.value=!1,F(n,le.code),await Z.push({name:"problem"});return}le.data.tags&&le.data.tags.forEach(se=>{w[se.id]=se}),f.value=vt(le.data.problem,w),o.setTitle(f.value.title+" - "+o.getTitle);let Q=f.value.description;g&&(le=await ho(g),le.code===0?(le.data.problems.sort((se,_e)=>se-_e),V.value=le.data.problems):F(n,le.code));const W={math:{inlineDigit:!0,engine:"KaTeX"}};b.value=await me.md2html(Q,W),await Ge(()=>{y.value&&(me.mathRender(y.value),me.highlightRender({lineNumber:!0,enable:!0},y.value),et(y.value),!v&&u.value&&(v=Qt.create(u.value,{value:"",language:"cpp",minimap:{enabled:!0},colorDecorators:!0,readOnly:!1,theme:"vs-dark"}))),k.value=!1})},Se=async()=>{ae(),c.value=!1;const le=await yn(C);if(le.code!==0)return;c.value=!0;const Q=le.data.problem_daily;h=Q.problem_id,U.value=await aa(Q.solution),T.value=await aa(Q.code);const W=new Date(le.data.time);L=W.getTime()-new Date().getTime();const se=W.toISOString().split("T")[0];if(C===se){const _e=W.getHours()*60*60+W.getMinutes()*60+W.getSeconds(),Ke=18*60*60;_e<Ke?z.value=Ke-_e:z.value=-1,R.value=24*60*60-_e}await Ge(()=>{P.value&&(me.mathRender(P.value),me.highlightRender({lineNumber:!0,enable:!0},P.value),et(P.value)),p.value&&(me.mathRender(p.value),me.highlightRender({lineNumber:!0,enable:!0},p.value),et(p.value))}),(z.value>=0||R.value>=0)&&Y()};return de(async()=>{r=ze(()=>l.params,async()=>{if(c.value=!1,Array.isArray(l.params.problemId)?h=l.params.problemId[0]:h=l.params.problemId,h||(Array.isArray(l.params.dailyId)?C=l.params.dailyId[0]:C=l.params.dailyId,await Se()),!h){if(Array.isArray(l.params.contestId)?g=Number(l.params.contestId[0]):g=Number(l.params.contestId),!g){ve(n,"题目不存在"),C?await Z.push({name:"problem-daily-list"}):await Z.push({name:"problem"});return}if(Array.isArray(l.params.problemIndex)?i.value=parseInt(l.params.problemIndex[0]):i.value=parseInt(l.params.problemIndex),!i.value){ve(n,"题目不存在"),await Z.push({name:"problem"});return}}m.value=!!g,k.value=!0,await ge()},{immediate:!0}),u.value&&new ResizeObserver(()=>{v&&v.layout()}).observe(u.value)}),Le(()=>{r&&(r(),r=null),ae()}),(le,Q)=>{const W=he,se=qt,_e=ye,Ke=xe,Pe=G,we=Xe,Ze=st,at=Je,rt=Kt,Lt=pt,Ha=Te,Ba=De;return D(),E(Ba,{loading:k.value},{default:a(()=>[t(Ha,{class:"dida-main-content"},{default:a(()=>[t(Ke,{span:8},{default:a(()=>[t(W,{style:{margin:"10px"}},{default:a(()=>[A("div",{innerHTML:fe(b),ref_key:"descriptionMarkdownRef",ref:y},null,8,Lo)]),_:1}),c.value?(D(),E(W,{key:0,style:{margin:"10px"},title:"题解"},{default:a(()=>[z.value<0?(D(),E(la,{key:0},{default:a(()=>[A("div",{ref_key:"dailyCodeMarkdownRef",ref:p,innerHTML:U.value},null,8,jo)]),_:1})):(D(),ee("div",zo,[A("div",$o,[t(_e,null,{default:a(()=>[Q[2]||(Q[2]=A("p",null,"距离解锁百分比",-1)),t(se,{theme:"circle",color:{from:"#0052D9",to:"#00A870"},percentage:100-z.value/(18*60*60)*100,status:"active"},{label:a(()=>[S(q((100-z.value/(18*60*60)*100).toFixed(3))+"% ",1)]),default:a(()=>[Q[1]||(Q[1]=S(" > "))]),_:1},8,["percentage"])]),_:1})])]))]),_:1})):ne("",!0),c.value?(D(),E(W,{key:1,style:{margin:"10px"},title:"示例代码"},{default:a(()=>[R.value<0?(D(),E(la,{key:0},{default:a(()=>[A("div",{ref_key:"dailyCodeMarkdownRef",ref:p,innerHTML:T.value},null,8,Ao)]),_:1})):(D(),ee("div",Uo,[A("div",Ro,[t(_e,{style:{margin:"0 auto"}},{default:a(()=>[Q[4]||(Q[4]=A("p",null,"距离解锁百分比",-1)),t(se,{theme:"circle",color:{from:"#0052D9",to:"#00A870"},percentage:100-R.value/(24*60*60)*100,status:"active"},{label:a(()=>[S(q((100-R.value/(24*60*60)*100).toFixed(3))+"% ",1)]),default:a(()=>[Q[3]||(Q[3]=S(" > "))]),_:1},8,["percentage"])]),_:1})])]))]),_:1})):ne("",!0)]),_:1}),t(Ke,{span:4},{default:a(()=>{var Xt;return[fe(g)?(D(),ee("div",Mo,[t(_e,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(D(!0),ee(re,null,Ie(V.value,(Me,oe)=>(D(),E(Pe,{key:oe,theme:Me==fe(i)?"primary":"default",onClick:async()=>await fe(Et)(fe(g),Me)},{default:a(()=>[S(q(fe(nt)(Me)),1)]),_:2},1032,["theme","onClick"]))),128))]),_:1})])):ne("",!0),A("div",Eo,[t(at,{layout:"vertical",bordered:!0},{default:a(()=>{var Me;return[t(we,{label:"ID"},{default:a(()=>{var oe;return[S(q((oe=f.value)==null?void 0:oe.id),1)]}),_:1}),t(we,{label:"标题"},{default:a(()=>{var oe;return[S(q((oe=f.value)==null?void 0:oe.title),1)]}),_:1}),t(we,{label:"时间限制"},{default:a(()=>{var oe;return[S(q((oe=f.value)==null?void 0:oe.timeLimit),1)]}),_:1}),t(we,{label:"内存限制"},{default:a(()=>{var oe;return[S(q((oe=f.value)==null?void 0:oe.memoryLimit),1)]}),_:1}),t(we,{label:"判题方式"},{default:a(()=>{var oe;return[S(q((oe=f.value)==null?void 0:oe.judgeType),1)]}),_:1}),m.value?ne("",!0):(D(),E(we,{key:0,label:"正确提交"},{default:a(()=>{var oe;return[S(q((oe=f.value)==null?void 0:oe.accept),1)]}),_:1})),m.value?ne("",!0):(D(),E(we,{key:1,label:"提交总数"},{default:a(()=>{var oe;return[S(q((oe=f.value)==null?void 0:oe.attempt),1)]}),_:1})),t(we,{label:"创建时间"},{default:a(()=>{var oe;return[S(q((oe=f.value)==null?void 0:oe.insertTime),1)]}),_:1}),t(we,{label:"更新时间"},{default:a(()=>{var oe;return[S(q((oe=f.value)==null?void 0:oe.updateTime),1)]}),_:1}),t(we,{label:"上传用户"},{default:a(()=>{var oe;return[S(q((oe=f.value)==null?void 0:oe.creatorNickname),1)]}),_:1}),m.value?ne("",!0):(D(),E(we,{key:2,label:"题目来源"},{default:a(()=>{var oe,Qe,dt;return[(oe=f.value)!=null&&oe.sourceUrl?(D(),E(Ze,{key:0,href:(Qe=f.value)==null?void 0:Qe.sourceUrl,target:"_blank"},{default:a(()=>{var Yt;return[S(q((Yt=f.value)==null?void 0:Yt.source),1)]}),_:1},8,["href"])):(D(),ee("span",qo,q((dt=f.value)==null?void 0:dt.source),1))]}),_:1})),$.value?(D(),E(we,{key:3,label:"是否私有"},{default:a(()=>{var oe;return[S(q((oe=f.value)!=null&&oe.private?"私有":"公开"),1)]}),_:1})):ne("",!0),(Me=f.value)!=null&&Me.originUrl?(D(),E(we,{key:4,label:"原题链接"},{default:a(()=>{var oe;return[t(Ze,{href:(oe=f.value)==null?void 0:oe.originUrl,target:"_blank"},{default:a(()=>{var Qe,dt;return[S(q((Qe=f.value)==null?void 0:Qe.originOj)+" - "+q((dt=f.value)==null?void 0:dt.originId),1)]}),_:1},8,["href"])]}),_:1})):ne("",!0),fe(h)?(D(),E(we,{key:5,label:"标签"},{default:a(()=>[t(_e,null,{default:a(()=>{var oe;return[(D(!0),ee(re,null,Ie((oe=f.value)==null?void 0:oe.tags,Qe=>(D(),E(Pe,{key:Qe.id,variant:"dashed",onClick:()=>H(Qe)},{default:a(()=>[S(q(Qe.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})):ne("",!0)]}),_:1}),A("div",Ko,[t(_e,null,{default:a(()=>[t(Pe,{onClick:Ce},{default:a(()=>Q[5]||(Q[5]=[S("提交记录")])),_:1}),t(Pe,{onClick:Ve},{default:a(()=>Q[6]||(Q[6]=[S("题目讨论")])),_:1}),fe(h)?(D(),E(Pe,{key:0,onClick:J},{default:a(()=>Q[7]||(Q[7]=[S("题目推荐")])),_:1})):ne("",!0)]),_:1})]),c.value&&K.value||$.value||(Xt=f.value)!=null&&Xt.originId?(D(),ee("div",No,[t(_e,null,{default:a(()=>{var Me;return[c.value&&K.value?(D(),E(Pe,{key:0,onClick:O},{default:a(()=>Q[8]||(Q[8]=[S("每日一题")])),_:1})):ne("",!0),$.value?(D(),E(Pe,{key:1,onClick:N},{default:a(()=>Q[9]||(Q[9]=[S("编辑")])),_:1})):ne("",!0),(Me=f.value)!=null&&Me.originId?(D(),E(Pe,{key:2,onClick:B,loading:s.value},{default:a(()=>Q[10]||(Q[10]=[S("更新描述 ")])),_:1},8,["loading"])):ne("",!0)]}),_:1})])):ne("",!0),A("div",Fo,[t(_e,null,{default:a(()=>[t(Lt,{modelValue:j.value,"onUpdate:modelValue":Q[0]||(Q[0]=Me=>j.value=Me),label:"语言：",placeholder:"请选择提交语言","auto-width":"",clearable:"",onChange:te},{default:a(()=>[(D(!0),ee(re,null,Ie(M.value,Me=>(D(),E(rt,{key:Me.value,value:Me.value,label:Me.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),t(Pe,{onClick:ce,loading:x.value},{default:a(()=>Q[11]||(Q[11]=[S("提交")])),_:1},8,["loading"])]),_:1}),A("div",Oo,[A("div",{ref_key:"codeEditRef",ref:u,class:"dida-code-editor"},null,512)])])])]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),jt=ue(Go,[["__scopeId","data-v-0ef834bc"]]),Ho={style:{margin:"10px"}},Bo={key:0,class:"dida-operation-container"};function Wo(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const Jo=ie({__name:"ProblemDailyList",setup(e){const l=ke(),n=We(),{globalProperties:r}=pe(),o=qe();let _=!1,b=null,h={},C={};const g=He(()=>o.hasAuth(je.ManageProblem)),i=d([{title:"日期",colKey:"id",cell:(V,I)=>t(G,{variant:"dashed",onClick:()=>f(I.row.id)},{default:()=>[I.row.id]})},{title:"ID",colKey:"problemId",cell:(V,I)=>{let z=v(I.row.problemId);return t(G,{variant:"dashed",theme:z,onClick:()=>f(I.row.id)},{default:()=>[I.row.problemId]})}},{title:"标题",colKey:"title",cell:(V,I)=>t(G,{variant:"text",onClick:()=>f(I.row.id)},{default:()=>[I.row.title]})},{title:"标签",colKey:"tags",cell:(V,I)=>{const z=I.row.tags;if(!z||z.length===0)return"";let R=[];for(let U=0;U<z.length;U++){const T=z[U];R.push(t(G,{key:U,theme:"default",variant:"outline",size:"small",onClick:()=>x(T)},{default:()=>[T.name]}))}return t(ye,null,Wo(R)?R:{default:()=>[R]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),m=d(!1);let c=1,y=50;const P=d({current:c,pageSize:y,defaultCurrent:c,defaultPageSize:y,total:0,pageSizeOptions:[50,100]}),p=d([]),k=d({date:[],problemId:""}),f=V=>{V&&n.push({name:"problem-daily-detail",params:{dailyId:V}})},v=V=>{if(!V||!C)return"default";const I=C[V];if(!I)return"default";switch(I){case Oe.Accept:return"success";case Oe.Attempt:return"warning";default:return"default"}},u=async()=>{let V="";k.value.date&&k.value.date.length>1&&(V=k.value.date[0]+"~"+k.value.date[1]),await n.push({query:{...l.query,date:V,problem_id:k.value.problemId,page:1,page_size:P.value.defaultPageSize}})},s=async()=>{k.value.date=[],k.value.problemId="",await n.push({query:{...l.query,date:"",problem_id:"",page:1,page_size:P.value.defaultPageSize}})},x=V=>{V&&n.push({name:"problem-list",query:{...l.query,title:"",tag:V.name,page:1,page_size:P.value.defaultPageSize}})},w=()=>{n.push({name:"manage-problem-daily-create"})},j=async(V,I)=>{m.value=!0;try{const{current:z,pageSize:R}=V;let U="";k.value.date[0]&&(U=k.value.date[0]);let T="";k.value.date[1]&&(T=k.value.date[1]);const L=await Cn(U,T,k.value.problemId,z,R);if(p.value=[],L.code===0){const $=L.data.list;if(!$||$.length<=0){P.value={...P.value,total:0},C={},be(r,"未找到记录");return}h={},L.data.tags&&L.data.tags.forEach(K=>{h[K.id]=K}),$.forEach(K=>{var ae;const Y=ja(K,h);(ae=p.value)==null||ae.push(Y)}),P.value={...P.value,total:L.data.total_count},C=L.data.attempt_status}else I&&F(r,L.code)}catch(z){console.error(z),F(r,Ne())}finally{m.value=!1}},M=async V=>{await n.push({query:{...l.query,page:V.current,page_size:V.pageSize}})};return de(async()=>{_=!0,m.value=!0,b=ze(()=>l.query,V=>{if(!_)return;if(k.value.date=[],V.date){const R=V.date.split("~");R.length===2&&(k.value.date=[R[0],R[1]])}k.value.problemId=V.problem_id||"";const I=parseInt(V.page)||P.value.defaultCurrent,z=parseInt(V.page_size)||P.value.defaultPageSize;c=I,y=z,P.value={...P.value,current:c,pageSize:y},j({current:c,pageSize:y},!0)},{immediate:!0})}),Le(()=>{_=!1,b&&b()}),(V,I)=>{const z=Re,R=he,U=xe,T=G,L=ye,$=Nt,K=Ae,Y=Ue,ae=$e,H=Te;return D(),E(H,null,{default:a(()=>[t(U,{span:9},{default:a(()=>[t(R,{style:{margin:"10px"}},{default:a(()=>[t(z,{data:p.value,columns:i.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:P.value,"table-layout":"auto",loading:m.value,onPageChange:M},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(U,{span:3},{default:a(()=>[A("div",Ho,[g.value?(D(),ee("div",Bo,[t(L,null,{default:a(()=>[t(T,{onClick:w},{default:a(()=>I[2]||(I[2]=[S("新建")])),_:1})]),_:1})])):ne("",!0),t(R,{class:"sh-card"},{default:a(()=>[t(ae,{model:k.value,onSubmit:u,onReset:s},{default:a(()=>[t(K,{label:"日期","label-align":"top"},{default:a(()=>[t($,{modelValue:k.value.date,"onUpdate:modelValue":I[0]||(I[0]=O=>k.value.date=O),"allow-input":"",clearable:"",format:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(K,{label:"问题","label-align":"top"},{default:a(()=>[t(Y,{modelValue:k.value.problemId,"onUpdate:modelValue":I[1]||(I[1]=O=>k.value.problemId=O),placeholder:"请输入问题ID",clearable:""},null,8,["modelValue"])]),_:1}),t(K,{"label-align":"top"},{default:a(()=>[t(L,null,{default:a(()=>[t(T,{theme:"primary",type:"submit"},{default:a(()=>I[3]||(I[3]=[S("搜索")])),_:1}),t(T,{theme:"danger",type:"reset"},{default:a(()=>I[4]||(I[4]=[S("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(R,{class:"sh-card",header:"每日一题","header-bordered":!0},{default:a(()=>I[5]||(I[5]=[A("p",null,"由管理员团队精选的题目，每日0点更新。",-1),A("p",null,"当日下午6点提供题解，次日提供AC代码。",-1)])),_:1})])]),_:1})]),_:1})}}}),Xo=ue(Jo,[["__scopeId","data-v-5e0bb3cc"]]),Yo={style:{margin:"10px"}},Zo={style:{margin:"12px"}},Qo={class:"dida-edit-container"},es=ie({__name:"ProblemDailyEdit",setup(e){let l=ke();const{globalProperties:n}=pe();let r=null;const o=d(""),_=d(!1);let b=null,h=null;const C=d(!1),g=d(null),i=d({date:"",problemId:""}),m=()=>{Z.push({name:"problem-daily-detail",params:{dailyId:o.value}})},c=async()=>{if(!(!b||!h)){C.value=!0;try{const f=i.value.date,v=await Pn(f,i.value.problemId,b.getValue(),h.getValue());if(C.value=!0,v.code!==0){F(n,v.code);return}await Z.push({name:"manage-problem-daily",params:{dailyId:f}}),Be(n,"创建成功")}finally{C.value=!1}}},y=async()=>{if(!(!b||!h)){C.value=!0;try{const f=await Tn(o.value,i.value.problemId,b.getValue(),h.getValue());if(C.value=!0,f.code!==0){F(n,f.code);return}g.value&&(f.data.update_time!=null&&(g.value.updateTime=new Date(f.data.update_time).toLocaleString()),f.data.updater_nickname!=null&&(g.value.updaterNickname=f.data.updater_nickname)),f.data.solution!=null&&(b==null||b.setValue(f.data.solution)),f.data.code!=null&&(h==null||h.setValue(f.data.code)),Be(n,"保存成功")}finally{C.value=!1}}},P=f=>{const v={after:()=>{b==null||b.setValue(f),_.value=!1},upload:{accept:"image/*,.mp3, .wav, .rar",async handler(u){return Pt(b,u,n,()=>ea(o.value))}},preview:{math:{inlineDigit:!0,engine:"KaTeX"}}};b=new me("problemEditDiv",v)},p=f=>{const v={after:()=>{h==null||h.setValue(f),_.value=!1},upload:{accept:"image/*,.mp3, .wav, .rar",async handler(u){return Pt(b,u,n,()=>ea(o.value))}},preview:{math:{inlineDigit:!0,engine:"KaTeX"}}};h=new me("codeEditDiv",v)},k=async()=>{const f=await wn(o.value);if(f.code!==0){F(n,f.code),console.error("problem get failed",f.code),await Z.push({name:"problem"});return}const v=f.data;g.value=ja(v,{}),i.value.problemId=v.problem_id,P(v.solution),p(v.code)};return de(async()=>{r=ze(()=>l.params,async()=>{Array.isArray(l.params.dailyId)?o.value=l.params.dailyId[0]:o.value=l.params.dailyId,o.value?(_.value=!0,i.value.date=o.value,await k()):(P("暂无题解"),p("暂无标程"))},{immediate:!0})}),Le(()=>{r&&(r(),r=null)}),(f,v)=>{const u=Tt,s=Sl,x=Ae,w=Ue,j=$e,M=he,V=xe,I=G,z=ye,R=Xe,U=Je,T=Te,L=De;return D(),E(L,{loading:_.value},{default:a(()=>[t(T,null,{default:a(()=>[t(V,{span:8},{default:a(()=>[A("div",Yo,[t(u,{theme:"info"},{default:a(()=>v[2]||(v[2]=[S("可以提前配置将来日期的题目，对外仅展示到截止到当天的题目")])),_:1}),t(M,{class:"sh-form-card"},{default:a(()=>[t(j,{model:i.value},{default:a(()=>[t(x,{label:"日期"},{default:a(()=>[t(s,{modelValue:i.value.date,"onUpdate:modelValue":v[0]||(v[0]=$=>i.value.date=$),disabled:o.value&&!0},null,8,["modelValue","disabled"])]),_:1}),t(x,{label:"问题ID"},{default:a(()=>[t(w,{modelValue:i.value.problemId,"onUpdate:modelValue":v[1]||(v[1]=$=>i.value.problemId=$),placeholder:"问题标题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(V,{span:4},{default:a(()=>[A("div",Zo,[A("div",Qo,[o.value?(D(),E(z,{key:0},{default:a(()=>[t(I,{onClick:y,theme:"danger",loading:C.value},{default:a(()=>v[3]||(v[3]=[S("保存")])),_:1},8,["loading"]),t(I,{onClick:m},{default:a(()=>v[4]||(v[4]=[S("查看")])),_:1})]),_:1})):(D(),E(z,{key:1},{default:a(()=>[t(I,{onClick:c,theme:"danger",loading:C.value},{default:a(()=>v[5]||(v[5]=[S("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(D(),E(U,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(R,{label:"创建时间"},{default:a(()=>{var $;return[S(q(($=g.value)==null?void 0:$.createTime),1)]}),_:1}),t(R,{label:"更新时间"},{default:a(()=>{var $;return[S(q(($=g.value)==null?void 0:$.updateTime),1)]}),_:1}),t(R,{label:"创建用户"},{default:a(()=>{var $;return[S(q(($=g.value)==null?void 0:$.creatorNickname),1)]}),_:1}),t(R,{label:"更新用户"},{default:a(()=>{var $;return[S(q(($=g.value)==null?void 0:$.updaterNickname),1)]}),_:1})]),_:1})):ne("",!0)])]),_:1})]),_:1}),v[6]||(v[6]=A("div",null,[A("p",{style:{"margin-left":"20px"}},"题解："),A("div",{id:"problemEditDiv",class:"dida-description-editor"})],-1)),v[7]||(v[7]=A("div",null,[A("p",{style:{"margin-left":"20px"}},"标程："),A("div",{id:"codeEditDiv",class:"dida-description-editor"})],-1))]),_:1},8,["loading"])}}}),na=ue(es,[["__scopeId","data-v-d8ef49ab"]]),ts={style:{margin:"10px"}};function as(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const ls=ie({__name:"ProblemRecommend",setup(e){const l=ke(),n=We(),{globalProperties:r}=pe();let o=null,_="",b={},h={};const C=d([{title:"ID",colKey:"id",cell:(p,k)=>{let f=c(k.row.id);return t(G,{variant:"dashed",theme:f,onClick:()=>m(k.row.id)},{default:()=>[k.row.id]})}},{title:"标题",colKey:"title",cell:(p,k)=>t(G,{variant:"text",onClick:()=>m(k.row.id)},{default:()=>[k.row.title]})},{title:"标签",colKey:"tags",cell:(p,k)=>{const f=k.row.tags;if(!f||f.length===0)return"";let v=[];for(let u=0;u<f.length;u++){const s=f[u];v.push(t(G,{key:u,theme:"default",variant:"outline",size:"small",onClick:()=>y(s)},{default:()=>[s.name]}))}return t(ye,null,as(v)?v:{default:()=>[v]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),g=d(!1),i=d(),m=p=>{p&&n.push({path:"/problem/"+p})},c=p=>{if(!p||!h)return"default";const k=h[p];if(!k)return"default";switch(k){case Oe.Accept:return"success";case Oe.Attempt:return"warning";default:return"default"}},y=p=>{p&&n.push({name:"problem-list",query:{tag:p.name}})},P=async p=>{g.value=!0;try{const k=await hn(_);if(i.value=[],k.code===0){const f=k.data.list;if(!f||f.length<=0){be(r,"暂无推荐题目");return}b={},k.data.tags&&k.data.tags.forEach(v=>{b[v.id]=v}),f.forEach(v=>{var s;const u=vt(v,b);(s=i.value)==null||s.push(u)})}else p&&F(r,k.code)}catch(k){console.error(k),F(r,Ne())}finally{g.value=!1}};return de(async()=>{g.value=!0,o=ze(()=>l.query,p=>{Array.isArray(l.params.problemId)?_=l.params.problemId[0]:_=l.params.problemId,P(!0)},{immediate:!0})}),Le(()=>{o&&o()}),(p,k)=>{const f=Re,v=he,u=xe,s=Te;return D(),E(s,null,{default:a(()=>[t(u,{span:9},{default:a(()=>[t(v,{style:{margin:"10px"}},{default:a(()=>[t(f,{data:i.value,columns:C.value,"row-key":"id","vertical-align":"top",hover:!0,"table-layout":"auto",loading:g.value},null,8,["data","columns","loading"])]),_:1})]),_:1}),t(u,{span:3},{default:a(()=>[A("div",ts,[t(v,{class:"sh-card",header:"题目推荐","header-bordered":!0},{default:a(()=>k[0]||(k[0]=[S(" 根据本站其他用户的提交记录推荐类似题目"),A("br",null,null,-1),S("依据推荐算法来计算，与本用户相似度最高的用户做的题，大概率被自己感兴趣。 ")])),_:1})])]),_:1})]),_:1})}}}),ns=ue(ls,[["__scopeId","data-v-77972e8b"]]),os={style:{margin:"10px"}},ss={key:1},rs={style:{margin:"12px"}},is={class:"dida-edit-container"},us=ie({__name:"ProblemEdit",setup(e){let l=ke();const{globalProperties:n}=pe(),r=Ye(),o=d(""),_=d(!1);let b=null;const h=d(!1),C=d(null),g=d({title:"",timeLimit:0,memoryLimit:0,source:"",private:!0,tags:[]}),i=d([]),m=d([]),c=He(()=>{const x=[],w=i.value;for(let j=0,M=w.length;j<M;j++)w[j].value&&x.push(w[j].value);return x}),y=(x,w)=>{const{trigger:j,index:M,item:V}=w;if(j==="clear"&&(i.value=[]),["tag-remove","backspace"].includes(j)&&i.value.splice(M,1),j==="enter"){for(let z=0;z<m.value.length;z++){const R=m.value[z];if(R.label===V){for(let U=0;U<i.value.length;U++)if(i.value[U].label===R.label)return;i.value.push(R);return}}const I={label:V,value:V};i.value.push(I),m.value=m.value.concat(I)}},P=(x,{current:w,type:j})=>{if(!w){i.value=j==="check"?m.value.slice(1):[];return}if(j==="check"){const M=m.value.find(V=>V.value===w);if(!M)return;i.value.push(M)}else i.value=i.value.filter(M=>M.value!==w)},p=()=>{Z.push({name:"problem-detail",params:{problemId:o.value}})},k=()=>{Z.push({name:"manage-problem-judge",params:{problemId:o.value}})},f=async()=>{if(b){h.value=!0,g.value.tags=[];for(let x=0;x<i.value.length;x++){const w=i.value[x];w&&w.label&&g.value.tags.push(w.label)}try{const x=await Sn(g.value.title,g.value.timeLimit,g.value.memoryLimit,g.value.source,g.value.private,g.value.tags,b.getValue());if(h.value=!0,x.code!==0){F(n,x.code);return}x.data!=null&&await Z.push({name:"problem-detail",params:{problemId:x.data}}),Be(n,"创建成功")}finally{h.value=!1}}},v=async()=>{if(b){h.value=!0,g.value.tags=[];for(let x=0;x<i.value.length;x++){const w=i.value[x];w&&w.label&&g.value.tags.push(w.label)}try{const x=await In(o.value,g.value.title,g.value.timeLimit,g.value.memoryLimit,g.value.source,g.value.private,g.value.tags,b.getValue());if(h.value=!0,x.code!==0){F(n,x.code);return}x.data.update_time!=null&&(C.value.updateTime=new Date(x.data.update_time).toLocaleString()),x.data.description!=null&&(b==null||b.setValue(x.data.description)),Be(n,"保存成功")}finally{h.value=!1}}},u=x=>{const w={after:()=>{b==null||b.setValue(x),_.value=!1},upload:{accept:"image/*,.mp3, .wav, .rar",async handler(j){return Pt(b,j,n,()=>Vn(o.value))}},preview:{math:{inlineDigit:!0,engine:"KaTeX"}}};b=new me("problemEditDiv",w)},s=async()=>{const x=await za(o.value,void 0,void 0);if(x.code!==0){F(n,x.code),console.error("problem get failed",x.code),await Z.push({name:"problem"});return}const w=x.data.problem;if(C.value=vt(w,{}),g.value.title=w.title,g.value.timeLimit=w.time_limit,g.value.memoryLimit=w.memory_limit,g.value.source=w.source,g.value.private=w.private,g.value.tags=[],i.value=[],x.data.tags)for(let M=0;M<x.data.tags.length;M++){const V=x.data.tags[M];V&&V.name&&(g.value.tags.push(V.name),i.value.push({label:V.name,value:V.id}))}r.setTitle(w.title+" - "+r.getTitle);let j=w.description;u(j)};return de(async()=>{Array.isArray(l.params.problemId)?o.value=l.params.problemId[0]:o.value=l.params.problemId,o.value?(_.value=!0,$a(-1).then(async x=>{x.code===0?(x.data.list&&x.data.list.forEach(w=>{m.value.push({label:w.name,value:w.id})}),await s()):(F(n,x.code),console.error("problem tag get failed",x.code),await Z.push({name:"problem"}))}).catch(async x=>{console.error(x),F(n,"获取数据异常"),await Z.push({name:"problem"})})):(g.value.timeLimit=1e3,g.value.memoryLimit=65536,u(""))}),(x,w)=>{const j=Ue,M=Ae,V=wa,I=ft,z=Pl,R=Il,U=$e,T=he,L=xe,$=G,K=ye,Y=Xe,ae=Je,H=Te,O=De;return D(),E(O,{loading:_.value},{default:a(()=>[t(H,null,{default:a(()=>[t(L,{span:8},{default:a(()=>[A("div",os,[t(T,{class:"sh-card"},{default:a(()=>[t(U,{model:g.value},{default:a(()=>[t(M,{label:"标题"},{default:a(()=>[t(j,{modelValue:g.value.title,"onUpdate:modelValue":w[0]||(w[0]=N=>g.value.title=N),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),t(M,{label:"时间限制"},{default:a(()=>[t(V,{modelValue:g.value.timeLimit,"onUpdate:modelValue":w[1]||(w[1]=N=>g.value.timeLimit=N),theme:"normal",min:0},{suffix:a(()=>w[5]||(w[5]=[A("span",null,"ms",-1)])),_:1},8,["modelValue"])]),_:1}),t(M,{label:"内存限制"},{default:a(()=>[t(V,{modelValue:g.value.memoryLimit,"onUpdate:modelValue":w[2]||(w[2]=N=>g.value.memoryLimit=N),theme:"normal",min:0},{suffix:a(()=>w[6]||(w[6]=[A("span",null,"KB",-1)])),_:1},8,["modelValue"])]),_:1}),t(M,{label:"来源"},{default:a(()=>[t(j,{modelValue:g.value.source,"onUpdate:modelValue":w[3]||(w[3]=N=>g.value.source=N),placeholder:"请输入题目来源"},null,8,["modelValue"])]),_:1}),t(M,{label:"私有"},{default:a(()=>[t(I,{modelValue:g.value.private,"onUpdate:modelValue":w[4]||(w[4]=N=>g.value.private=N)},null,8,["modelValue"])]),_:1}),t(M,{label:"标签"},{default:a(()=>[t(R,{value:i.value,"allow-input":!0,placeholder:"请选择或输入","tag-input-props":{excessTagsDisplayType:"break-line"},"popup-props":{overlayInnerClassName:["narrow-scrollbar"],overlayInnerStyle:{maxHeight:"280px",overflowY:"auto",overscrollBehavior:"contain",padding:"6px"}},clearable:"",multiple:"",onTagChange:y},{panel:a(()=>[m.value.length?(D(),E(z,{key:0,value:c.value,options:m.value,onChange:P},null,8,["value","options"])):(D(),ee("div",ss,"暂无数据"))]),suffixIcon:a(()=>[t(fe(sl))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(L,{span:4},{default:a(()=>[A("div",rs,[A("div",is,[o.value?(D(),E(K,{key:0},{default:a(()=>[t($,{onClick:v,theme:"danger",loading:h.value},{default:a(()=>w[7]||(w[7]=[S("保存")])),_:1},8,["loading"]),t($,{onClick:k,theme:"warning"},{default:a(()=>w[8]||(w[8]=[S("判题数据")])),_:1}),t($,{onClick:p},{default:a(()=>w[9]||(w[9]=[S("查看")])),_:1})]),_:1})):(D(),E(K,{key:1},{default:a(()=>[t($,{onClick:f,theme:"danger",loading:h.value},{default:a(()=>w[10]||(w[10]=[S("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(D(),E(ae,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(Y,{label:"创建时间"},{default:a(()=>{var N;return[S(q((N=C.value)==null?void 0:N.insertTime),1)]}),_:1}),t(Y,{label:"更新时间"},{default:a(()=>{var N;return[S(q((N=C.value)==null?void 0:N.updateTime),1)]}),_:1}),t(Y,{label:"判题方式"},{default:a(()=>{var N;return[S(q((N=C.value)==null?void 0:N.judgeType),1)]}),_:1}),t(Y,{label:"上传用户"},{default:a(()=>{var N;return[S(q((N=C.value)==null?void 0:N.creatorNickname),1)]}),_:1})]),_:1})):ne("",!0)])]),_:1})]),_:1}),w[11]||(w[11]=A("div",{id:"problemEditDiv",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"])}}}),oa=ue(us,[["__scopeId","data-v-5cd40c20"]]),cs={style:{margin:"10px"}},ds={style:{margin:"12px"}},ms={class:"dida-edit-container"},ps=ie({__name:"ProblemJudge",setup(e){let l=ke();const{globalProperties:n}=pe(),r=Ye(),o=d(""),_=d(!1),b=d(null);let h=null;const C=d(null),g=d(""),i=d(!1),m=d(!1),c=d([{title:"文件",colKey:"file"},{title:"大小",colKey:"size",width:150,cell:(I,z)=>z.row.size.toFixed(0)+" B"},{title:"最后修改时间",colKey:"lastModified",width:180,cell:(I,z)=>new Date(z.row.lastModified).toLocaleString()},{title:"操作",colKey:"action",width:100,cell:(I,z)=>t(G,{onClick:()=>v(z.row.file)},{default:()=>[S("下载")]})}]),y=d([]),P=He(()=>({border:"2px dashed #ccc",borderRadius:"6px",padding:"20px",textAlign:"center",cursor:"pointer",backgroundColor:i.value?"#f0f9ff":"#fff",transition:"background-color 0.2s ease"})),p=He(()=>g.value?`已选择：${g.value}`:i.value?"松开文件以上传":"拖拽判题数据压缩包到这里，或点击选择文件"),k=()=>{Z.push({name:"problem-detail",params:{problemId:o.value}})},f=()=>{Z.push({name:"manage-problem",params:{problemId:o.value}})},v=async I=>{const z=await xn(o.value,I);if(z.code!==0){F(n,z.code);return}const R=document.createElement("a");R.href=z.data,R.target="_blank",R.click(),URL.revokeObjectURL(R.href)},u=async()=>{if(!h){ve(n,"请选择压缩包");return}m.value=!0,Dn(o.value,h).then(async I=>{I.code==0?(C.value.value=null,h=null,g.value="",_.value=!0,Be(n,"上传成功"),await V()):F(n,I.code)}).catch(I=>{console.log(I),n.$message.error({duration:3e3,content:"申请失败"})}).finally(()=>{m.value=!1})},s=()=>{var I;(I=C.value)==null||I.click()},x=I=>{const z=I.target.files[0];z&&(g.value=z.name,h=z)},w=I=>{i.value=!0},j=()=>{i.value=!1},M=I=>{I.preventDefault(),I.stopPropagation(),i.value=!1;const z=I.dataTransfer.files[0];if(z){g.value=z.name;const R=new DataTransfer;R.items.add(z),C.value.files=R.files,h=z}},V=async()=>{const I=await gn(o.value);if(I.code!==0){F(n,I.code),await Z.push({name:"problem"});return}const z=I.data.problem;b.value=vt(z,{}),r.setTitle(z.title+" - "+r.getTitle),y.value=[],I.data.judges?I.data.judges.forEach(R=>{y.value.push({file:R.key,size:R.size,lastModified:R.last_modified})}):ve(n,"评测数据不存在"),_.value=!1};return de(async()=>{if(Array.isArray(l.params.problemId)?o.value=l.params.problemId[0]:o.value=l.params.problemId,!o.value){ve(n,"题目不存在"),await Z.push({name:"problem"});return}_.value=!0,await V()}),(I,z)=>{const R=Re,U=xe,T=G,L=ye,$=Xe,K=Je,Y=Te,ae=De;return D(),E(ae,{loading:_.value},{default:a(()=>[t(Y,null,{default:a(()=>[t(U,{span:7},{default:a(()=>[A("div",cs,[A("div",{id:"drop-zone",style:ga(P.value),onClick:s,onDragenter:wt(w,["prevent"]),onDragover:z[0]||(z[0]=wt(()=>{},["prevent"])),onDragleave:wt(j,["prevent"]),onDrop:M},[A("input",{ref_key:"fileInput",ref:C,type:"file",style:{display:"none"},onChange:x},null,544),S(" "+q(p.value),1)],36)]),t(R,{data:y.value,columns:c.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1}),t(U,{span:5},{default:a(()=>[A("div",ds,[A("div",ms,[t(L,null,{default:a(()=>[t(T,{onClick:u,theme:"danger",loading:m.value},{default:a(()=>z[1]||(z[1]=[S("上传")])),_:1},8,["loading"]),t(T,{onClick:f,theme:"warning"},{default:a(()=>z[2]||(z[2]=[S("编辑")])),_:1}),t(T,{onClick:k},{default:a(()=>z[3]||(z[3]=[S("查看")])),_:1})]),_:1})]),t(K,{layout:"vertical",bordered:!0},{default:a(()=>[t($,{label:"标题"},{default:a(()=>{var H;return[S(q((H=b.value)==null?void 0:H.title),1)]}),_:1}),t($,{label:"创建时间"},{default:a(()=>{var H;return[S(q((H=b.value)==null?void 0:H.insertTime),1)]}),_:1}),t($,{label:"更新时间"},{default:a(()=>{var H;return[S(q((H=b.value)==null?void 0:H.updateTime),1)]}),_:1}),t($,{label:"判题方式"},{default:a(()=>{var H;return[S(q((H=b.value)==null?void 0:H.judgeType),1)]}),_:1}),t($,{label:"评测数据"},{default:a(()=>{var H;return[S(q((H=b.value)==null?void 0:H.judgeMd5),1)]}),_:1}),t($,{label:"上传用户"},{default:a(()=>{var H;return[S(q((H=b.value)==null?void 0:H.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),fs=ue(ps,[["__scopeId","data-v-12b13fb1"]]);async function Jt(e){const l={};if(l.id=e.id,l.ownerId=e.owner_id,l.ownerUsername=e.owner_username,l.ownerNickname=e.owner_nickname,l.title=e.title,e.start_time?l.startTime=new Date(e.start_time).toLocaleString():l.startTime="无限制",e.end_time?l.endTime=new Date(e.end_time).toLocaleString():l.endTime="无限制",e.update_time?l.updateTime=new Date(e.update_time).toLocaleString():l.updateTime="",e.create_time?l.createTime=new Date(e.create_time).toLocaleString():l.createTime="",e.description){const n={math:{inlineDigit:!0,engine:"KaTeX"}};l.description=await me.md2html(e.description,n)}else l.description="";return l.problems=e.problems,l}function vs(e){return X({url:"/collection?id="+e,method:"get"})}function _s(e){return X({url:"/collection/edit?id="+e,method:"get"})}function gs(e,l){return X({url:"/collection/list?page="+e+"&page_size="+l,method:"get"})}function bs(e){return X({url:"/collection/rank?id="+e,method:"get"})}function hs(e){return X({url:"/collection/create",method:"post",data:e})}function ys(e){return X({url:"/collection/edit",method:"post",data:e})}function ws(e){return X({url:"/collection/join",method:"post",data:{id:e}})}function ks(e){return X({url:"/collection/quit",method:"post",data:{id:e}})}const Cs={style:{margin:"10px"}},Ss=ie({__name:"CollectionList",setup(e){const l=ke(),n=We(),{globalProperties:r}=pe();let o=null;d(!1),d(!1);const _=d([{title:"ID",colKey:"id",width:"100",cell:(f,v)=>t(G,{variant:"text",onClick:()=>c(v.row.id)},{default:()=>[v.row.id]})},{title:"标题",colKey:"title",cell:(f,v)=>t(G,{variant:"text",onClick:()=>c(v.row.id)},{default:()=>[v.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),b=d(!1);let h=1,C=50;const g=d({current:h,pageSize:C,defaultCurrent:h,defaultPageSize:C,total:0,pageSizeOptions:[50,100]}),i=d(),m=d({title:"",username:""});d({title:"",description:"",open_time:[]});const c=f=>{f&&n.push({path:"/collection/"+f})},y=async()=>{await n.push({query:{...l.query,title:m.value.title,username:m.value.username,page:1,page_size:g.value.defaultPageSize}})},P=async(f,v)=>{var u;b.value=!0;try{const{current:s,pageSize:x}=f,w=await gs(s,x);if(i.value=[],w.code===0){const j=w.data.list;for(let M=0;M<j.length;M++){const V=j[M],I=await Jt(V);(u=i.value)==null||u.push(I)}g.value={...g.value,total:w.data.total_count}}else v&&F(r,w.code)}catch(s){console.error(s),F(r,Ne())}finally{b.value=!1}},p=async f=>{await n.push({query:{...l.query,page:f.current,page_size:f.pageSize}})},k=async()=>{await n.push({name:"collection-create"})};return de(async()=>{o=ze(()=>l.query,f=>{m.value.title=f.title||"",m.value.username=f.username||"";const v=parseInt(f.page)||g.value.defaultCurrent,u=parseInt(f.page_size)||g.value.defaultPageSize;h=v,C=u,g.value={...g.value,current:h,pageSize:C},P({current:h,pageSize:C},!0)},{immediate:!0})}),Le(()=>{o&&o()}),(f,v)=>{const u=Re,s=he,x=xe,w=Ue,j=Ae,M=G,V=$e,I=ye,z=Te;return D(),E(z,null,{default:a(()=>[t(x,{span:9},{default:a(()=>[t(s,{style:{margin:"10px"}},{default:a(()=>[t(u,{data:i.value,columns:_.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:g.value,loading:b.value,onPageChange:p},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(x,{span:3},{default:a(()=>[A("div",Cs,[t(s,{class:"sh-card"},{default:a(()=>[t(V,{model:m.value},{default:a(()=>[t(j,{label:"标题"},{default:a(()=>[t(w,{modelValue:m.value.title,"onUpdate:modelValue":v[0]||(v[0]=R=>m.value.title=R),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(j,{label:"负责人"},{default:a(()=>[t(w,{modelValue:m.value.username,"onUpdate:modelValue":v[1]||(v[1]=R=>m.value.username=R),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(j,null,{default:a(()=>[t(M,{theme:"primary",onClick:y},{default:a(()=>v[2]||(v[2]=[S("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(s,{class:"sh-card"},{default:a(()=>[t(I,null,{default:a(()=>[t(M,{onClick:k},{default:a(()=>v[3]||(v[3]=[S("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),Is=ue(Ss,[["__scopeId","data-v-36c7c0e5"]]),Ps={style:{margin:"20px"}},Ts={class:"dida-operation-container"},xs={style:{margin:"12px"}},Vs=["innerHTML"],Ds=ie({__name:"CollectionDetail",setup(e){let l=ke();const{globalProperties:n}=pe(),r=Ye(),o=qe();let _=0;const b=d(!1),h=d(null),C=d(!1),g=d(!1);let i={};const m=He(()=>o.hasAuth(je.ManageCollection)||h.value&&o.getUserId==h.value.ownerId),c=v=>{if(!v||!i)return"default";const u=i[v];if(!u)return"default";switch(u){case Oe.Accept:return"success";case Oe.Attempt:return"warning";default:return"default"}},y=d([{title:"问题ID",colKey:"id",cell:(v,u)=>{const s=c(u.row.id);return t(G,{variant:"dashed",theme:s,onClick:()=>ta(u.row.id)},{default:()=>[u.row.id]})}},{title:"标题",colKey:"title",cell:(v,u)=>t(G,{variant:"text",onClick:()=>ta(u.row.id)},{default:()=>[u.row.title]})},{title:"正确",colKey:"accept",cell:(v,u)=>u.row.accept?u.row.accept:0},{title:"提交",colKey:"attempt",cell:(v,u)=>u.row.attempt?u.row.attempt:0}]),P=d([]),p=async()=>{if(!o.isLogin()){await Z.push({name:"login"});return}g.value=!0;try{const v=await ws(_);if(v.code!==0){F(n,v.code);return}C.value=!0,Be(n,"加入成功")}finally{g.value=!1}},k=async()=>{if(!o.isLogin()){await Z.push({name:"login"});return}g.value=!0;try{const v=await ks(_);if(v.code!==0){F(n,v.code);return}C.value=!1,Be(n,"退出成功")}finally{g.value=!1}},f=()=>{h.value&&Z.push({name:"collection-edit",params:{collectionId:h.value.id}})};return de(async()=>{if(Array.isArray(l.params.collectionId)?_=Number(l.params.collectionId[0]):_=Number(l.params.collectionId),!_){await Z.push({name:"problem-collection-list"});return}C.value=!1,b.value=!0;const v=await vs(_);if(v.code!==0){b.value=!1,F(n,v.code),await Z.push({name:"problem-collection-list"});return}C.value=v.data.joined,i=v.data.attempt_status||{},h.value=await Jt(v.data.collection),P.value=[],v.data.collection.problems&&v.data.collection.problems.forEach(u=>{const s=v.data.problems.find(x=>x.id===u);P.value.push(s)}),r.setTitle(h.value.title+" - "+r.getTitle),await Ge(()=>{const u=document.querySelectorAll(".dida-content-description");u&&u.length>0&&u.forEach(s=>{me.mathRender(s),me.highlightRender({lineNumber:!0,enable:!0},s),et(s)}),b.value=!1})}),(v,u)=>{const s=Ca,x=ka,w=Re,j=he,M=xe,V=G,I=ye,z=Xe,R=Je,U=Te,T=De;return D(),E(T,{loading:b.value},{default:a(()=>[t(U,{class:"dida-main-content"},{default:a(()=>[t(M,{span:6},{default:a(()=>[A("div",Ps,[t(x,{"max-item-width":"300"},{default:a(()=>[t(s,{to:{name:"problem-collection-list"}},{default:a(()=>u[0]||(u[0]=[S("题目集合")])),_:1}),t(s,null,{default:a(()=>{var L;return[S(q((L=h.value)==null?void 0:L.title),1)]}),_:1})]),_:1})]),t(j,{style:{margin:"10px"}},{default:a(()=>[t(w,{data:P.value,columns:y.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),_:1})]),_:1}),t(M,{span:6},{default:a(()=>{var L;return[A("div",Ts,[t(I,null,{default:a(()=>[C.value?(D(),E(V,{key:0,onClick:k,loading:g.value},{default:a(()=>u[1]||(u[1]=[S("退出")])),_:1},8,["loading"])):(D(),E(V,{key:1,onClick:p,loading:g.value},{default:a(()=>u[2]||(u[2]=[S("加入")])),_:1},8,["loading"])),m.value?(D(),E(V,{key:2,onClick:f},{default:a(()=>u[3]||(u[3]=[S("编辑")])),_:1})):ne("",!0)]),_:1})]),A("div",xs,[t(R,{layout:"vertical",bordered:!0},{default:a(()=>[t(z,{label:"创建者"},{default:a(()=>{var $;return[S(q(($=h.value)==null?void 0:$.ownerNickname),1)]}),_:1})]),_:1}),t(R,{layout:"vertical",bordered:!0},{default:a(()=>[t(z,{label:"开始时间"},{default:a(()=>{var $;return[S(q(($=h.value)==null?void 0:$.startTime),1)]}),_:1})]),_:1}),t(R,{layout:"vertical",bordered:!0},{default:a(()=>[t(z,{label:"结束时间"},{default:a(()=>{var $;return[S(q(($=h.value)==null?void 0:$.endTime),1)]}),_:1})]),_:1})]),(L=h.value)!=null&&L.description?(D(),E(j,{key:0,style:{margin:"10px"}},{default:a(()=>{var $;return[A("div",{innerHTML:($=h.value)==null?void 0:$.description,class:"dida-content-description"},null,8,Vs)]}),_:1})):ne("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),Ls=ue(Ds,[["__scopeId","data-v-3f4490c0"]]),js=ie({__name:"CollectionRank",setup(e){const l=ke(),n=We(),{globalProperties:r}=pe();let o=null,_=0,b=0;const h=d([{title:"Rank",colKey:"rank",align:"center"},{title:"序号",colKey:"index",align:"center"},{title:"Username",colKey:"username",cell:(c,y)=>t(G,{variant:"text",onClick:()=>n.push({name:"user",params:{username:y.row.username}})},{default:()=>[y.row.username]})},{title:"昵称",colKey:"nickname",cell:(c,y)=>t(G,{variant:"text",onClick:()=>n.push({name:"user",params:{username:y.row.username}})},{default:()=>[y.row.nickname]})},{title:"Count",colKey:"count",cell:(c,y)=>t(G,{variant:"text",onClick:()=>n.push({name:"judge-list",query:{username:y.row.username,status:Fe.Accept}})},{default:()=>[`${y.row.accept} / ${b}`]})},{title:"Progress",colKey:"progress",cell:(c,y)=>{let P=100;return b>0&&(P=Number((y.row.accept/b*100).toFixed(2))),t(qt,{percentage:P},null)}}]),C=d(!1),g=d([]),i=({col:c,rowIndex:y})=>{let P=1;for(let p=y+1;p<g.value.length&&g.value[p].rank===g.value[y].rank;p++)P++;if(c.colKey==="rank")return{rowspan:P}},m=async c=>{C.value=!0;try{const y=await bs(_);if(g.value=[],y.code===0){b=y.data.problem;const P=y.data.ranks,p=[];if(P){for(let v=0;v<P.length;v++){const u=P[v];let s={userId:u.author_id,username:u.author_username,nickname:u.author_nickname};s.accept=u.accept,p.push(s)}p.sort((v,u)=>v.accept!==u.accept?u.accept-v.accept:v.userId-u.userId);let k=0,f=-1;for(let v=0;v<p.length;v++)p[v].accept!==f&&(k=v+1,f=p[v].accept),p[v].index=v+1,p[v].rank=k}g.value=p}else c&&F(r,y.code)}catch(y){console.error(y),F(r,Ne())}finally{C.value=!1}};return de(async()=>{o=ze(()=>l.query,async()=>{if(Array.isArray(l.params.collectionId)?_=Number(l.params.collectionId[0]):_=Number(l.params.collectionId),!_){await n.push({name:"problem-collection-list"});return}await m(!0)},{immediate:!0})}),Le(()=>{o&&o()}),(c,y)=>{const P=Re,p=he,k=Te;return D(),E(k,null,{default:a(()=>[t(p,{style:{margin:"10px"}},{default:a(()=>[A("div",null,[t(P,{data:g.value,columns:h.value,"row-key":"index","rowspan-and-colspan":i,"vertical-align":"middle",bordered:!0,hover:!0,loading:C.value},null,8,["data","columns","loading"])])]),_:1})]),_:1})}}});var Ee=(e=>(e[e.Valid=0]="Valid",e[e.Duplicate=1]="Duplicate",e[e.Invalid=2]="Invalid",e))(Ee||{});const zs={class:"dida-form-border"},$s={style:{"text-align":"right"}},As=ie({name:"ParseProblemList",__name:"ParseProblemList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:l}=pe(),n=d(!1),r=d(!1),o=d(""),_=ba(e,"modelValue");let b=[];ze(_,async c=>{JSON.stringify(c)!==JSON.stringify(b)&&(await g(c),b=_.value)},{deep:!0});const h=d([]),C=d([{title:"有效性",colKey:"validType",cell:(c,y)=>{switch(y.row.valid){case Ee.Valid:return t(lt,{theme:"success"},{default:()=>[S("有效")]});case Ee.Duplicate:return t(lt,{theme:"warning"},{default:()=>[S("重复")]});case Ee.Invalid:return t(lt,{theme:"danger"},{default:()=>[S("无效")]});default:return null}}},{title:"问题ID",colKey:"id"},{title:"标题",colKey:"title"}]),g=async c=>{const y=Array.from(new Set(c)),P=await Ln(y);if(P.code!==0){F(l,P.code),r.value=!1;return}const p=[],k=P.data.problems;let f=[];c.forEach(v=>{const u=k.find(s=>s.id===v);if(u){const s=p.find(x=>x.id===v);u.valid=s?Ee.Duplicate:Ee.Valid,p.push({id:v,title:u.title,valid:u.valid}),s||f.push(v)}else p.push({id:v,title:"-",valid:Ee.Invalid})}),h.value=p,b=f,_.value=f},i=async()=>{r.value=!0;const c=xa(o.value);await g(c),n.value=!1,r.value=!1},m=()=>{h.value?o.value=h.value.map(c=>c.id).join(`
`):o.value="",n.value=!0};return(c,y)=>{const P=G,p=Re,k=xt,f=ot;return D(),ee(re,null,[A("div",zs,[A("div",$s,[t(P,{onClick:m},{default:a(()=>y[2]||(y[2]=[S("编辑")])),_:1})]),t(p,{data:h.value,columns:C.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(f,{visible:n.value,"onUpdate:visible":y[1]||(y[1]=v=>n.value=v),onConfirm:i,header:"请输入问题ID","confirm-loading":r.value},{default:a(()=>[y[3]||(y[3]=A("div",{style:{"margin-bottom":"10px"}},[A("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(k,{modelValue:o.value,"onUpdate:modelValue":y[0]||(y[0]=v=>o.value=v),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Ma=ue(As,[["__scopeId","data-v-7f4ce589"]]),Us={class:"dida-form-border"},Rs={style:{"text-align":"right"}},Ms=ie({name:"ParseUserList",__name:"ParseUserList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:l}=pe(),n=d(!1),r=d(!1),o=d(""),_=ba(e,"modelValue");let b=[];ze(_,async P=>{JSON.stringify(P)!==JSON.stringify(b)&&(b=P,await i(P))},{deep:!0});const h=d(),C=d([{title:"有效性",colKey:"validType",cell:(P,p)=>{switch(p.row.valid){case Ee.Valid:return t(lt,{theme:"success"},{default:()=>[S("有效")]});case Ee.Duplicate:return t(lt,{theme:"warning"},{default:()=>[S("重复")]});case Ee.Invalid:return t(lt,{theme:"danger"},{default:()=>[S("无效")]})}}},{title:"Username",colKey:"username"},{title:"昵称",colKey:"nickname"}]),g=(P,p)=>{if(P.code!==0){F(l,P.code),r.value=!1;return}const k=[],f=P.data.users;let v=[];p?p.forEach(u=>{let s=null;if(f&&(s=f.find(x=>x.username.toLowerCase()===u.toLowerCase())),s){const x=k.find(j=>j.username.toLowerCase()===u.toLowerCase()),w=x?Ee.Duplicate:Ee.Valid;k.push({id:s.id,username:s.username,nickname:s.nickname,valid:w}),x||v.push(s.id)}else k.push({id:-1,username:u,nickname:"-",valid:Ee.Invalid})}):f&&f.forEach(u=>{const s=k.find(w=>w.id===u.id),x=s?Ee.Duplicate:Ee.Valid;k.push({id:u.id,username:u.username,nickname:u.nickname,valid:x}),s||v.push(u.id)}),h.value=k,b=v,_.value=v},i=async P=>{const p=Array.from(new Set(P)),k=await On(p);g(k)},m=async P=>{const p=Array.from(new Set(P)),k=await Gn(p);g(k,P)},c=async()=>{r.value=!0;const P=xa(o.value);await m(P),n.value=!1,r.value=!1},y=()=>{h.value?o.value=h.value.map(P=>P.username).join(`
`):o.value="",n.value=!0};return(P,p)=>{const k=G,f=Re,v=xt,u=ot;return D(),ee(re,null,[A("div",Us,[A("div",Rs,[t(k,{onClick:y},{default:a(()=>p[2]||(p[2]=[S("编辑")])),_:1})]),t(f,{data:h.value,columns:C.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(u,{visible:n.value,"onUpdate:visible":p[1]||(p[1]=s=>n.value=s),onConfirm:c,header:"请输入用户Username","confirm-loading":r.value},{default:a(()=>[p[3]||(p[3]=A("div",{style:{"margin-bottom":"10px"}},[A("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(v,{modelValue:o.value,"onUpdate:modelValue":p[0]||(p[0]=s=>o.value=s),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Ea=ue(Ms,[["__scopeId","data-v-d2170a86"]]),Es={style:{margin:"10px"}},qs={style:{margin:"12px"}},Ks={class:"dida-edit-container"},Ns=ie({__name:"CollectionEdit",setup(e){let l=ke();const{globalProperties:n}=pe(),r=Ye(),o=d(""),_=d(!1);let b=null;const h=d(!1),C=d(!1),g=d(null),i=d({title:"",openTime:[],private:!0,problems:[],members:[],description:""}),m=d(""),c=d(""),y=d(!1),P=async()=>{y.value=!0,C.value=!1,y.value=!1},p=async()=>{if(b){h.value=!0;try{const u={title:i.value.title,description:b.getValue(),problems:i.value.problems,members:i.value.members,private:i.value.private};i.value.openTime[0]&&(u.start_time=new Date(i.value.openTime[0])),i.value.openTime[1]&&(u.end_time=new Date(i.value.openTime[1]));const s=await hs(u);if(h.value=!0,s.code!==0){F(n,s.code);return}s.data!=null&&await Z.push({name:"collection-detail",params:{collectionId:s.data}}),Be(n,"创建成功")}finally{h.value=!1}}},k=async()=>{if(b){h.value=!0;try{const u={id:Number(o.value),title:i.value.title,private:i.value.private,problems:i.value.problems,members:i.value.members,description:b.getValue()};i.value.openTime[0]&&(u.start_time=new Date(i.value.openTime[0])),i.value.openTime[1]&&(u.end_time=new Date(i.value.openTime[1]));const s=await ys(u);if(h.value=!0,s.code!==0){F(n,s.code);return}s.data!=null&&g.value&&(g.value.updateTime=new Date(s.data).toLocaleString()),Be(n,"保存成功")}finally{h.value=!1}}},f=u=>{const s={after:()=>{b==null||b.setValue(u),_.value=!1},preview:{math:{inlineDigit:!0,engine:"KaTeX"}}};b=new me("collectionEditDiv",s)},v=async()=>{const u=await _s(o.value);if(u.code!==0){F(n,u.code),console.error("collection get failed",u.code),await Z.push({name:"problem-collection-list"});return}const s=u.data.collection;g.value=await Jt(s),i.value.title=s.title,i.value.openTime=[],s.start_time?i.value.openTime.push(new Date(s.start_time)):i.value.openTime.push(""),s.end_time?i.value.openTime.push(new Date(s.end_time)):i.value.openTime.push(""),i.value.private=s.private,i.value.description=s.description,i.value.problems=s.problems,i.value.members=s.members,r.setTitle(s.title+" - "+r.getTitle);let x="";s.description&&(x=s.description),f(x)};return de(async()=>{Array.isArray(l.params.collectionId)?o.value=l.params.collectionId[0]:o.value=l.params.collectionId,o.value?(_.value=!0,await v()):f("")}),(u,s)=>{const x=Ue,w=Ae,j=Nt,M=ft,V=$e,I=he,z=xe,R=G,U=ye,T=Xe,L=Je,$=Te,K=De,Y=xt,ae=ot;return D(),ee(re,null,[t(K,{loading:_.value},{default:a(()=>[t($,null,{default:a(()=>[t(z,{span:8},{default:a(()=>[A("div",Es,[t(I,{class:"sh-card"},{default:a(()=>[t(V,{model:i.value},{default:a(()=>[t(w,{label:"标题"},{default:a(()=>[t(x,{modelValue:i.value.title,"onUpdate:modelValue":s[0]||(s[0]=H=>i.value.title=H),placeholder:"题集标题"},null,8,["modelValue"])]),_:1}),t(w,{label:"开启时间"},{default:a(()=>[t(j,{modelValue:i.value.openTime,"onUpdate:modelValue":s[1]||(s[1]=H=>i.value.openTime=H),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(w,{label:"私有"},{default:a(()=>[t(M,{modelValue:i.value.private,"onUpdate:modelValue":s[2]||(s[2]=H=>i.value.private=H)},null,8,["modelValue"])]),_:1}),t(w,{label:"成员"},{default:a(()=>[t(Ea,{modelValue:i.value.members,"onUpdate:modelValue":s[3]||(s[3]=H=>i.value.members=H)},null,8,["modelValue"])]),_:1}),t(w,{label:"问题"},{default:a(()=>[t(Ma,{modelValue:i.value.problems,"onUpdate:modelValue":s[4]||(s[4]=H=>i.value.problems=H)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(z,{span:4},{default:a(()=>[A("div",qs,[A("div",Ks,[o.value?(D(),E(U,{key:0},{default:a(()=>[t(R,{onClick:k,theme:"danger",loading:h.value},{default:a(()=>s[7]||(s[7]=[S("保存")])),_:1},8,["loading"])]),_:1})):(D(),E(U,{key:1},{default:a(()=>[t(R,{onClick:p,theme:"danger",loading:h.value},{default:a(()=>s[8]||(s[8]=[S("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(D(),E(L,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(T,{label:"创建时间"},{default:a(()=>{var H;return[S(q((H=g.value)==null?void 0:H.createTime),1)]}),_:1}),t(T,{label:"更新时间"},{default:a(()=>{var H;return[S(q((H=g.value)==null?void 0:H.updateTime),1)]}),_:1}),t(T,{label:"创建用户"},{default:a(()=>{var H;return[S(q((H=g.value)==null?void 0:H.ownerNickname),1)]}),_:1})]),_:1})):ne("",!0)])]),_:1})]),_:1}),s[9]||(s[9]=A("div",{id:"collectionEditDiv",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"]),t(ae,{visible:C.value,"onUpdate:visible":s[6]||(s[6]=H=>C.value=H),onConfirm:P,header:m.value,"confirm-loading":y.value},{default:a(()=>[s[10]||(s[10]=A("div",{style:{"margin-bottom":"10px"}},[A("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(Y,{modelValue:c.value,"onUpdate:modelValue":s[5]||(s[5]=H=>c.value=H),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),sa=ue(Ns,[["__scopeId","data-v-dbc568cf"]]),Fs=["innerHTML"];function ra(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const Os=ie({__name:"JudgeJobList",setup(e){const l=ke(),n=We(),{globalProperties:r}=pe();let o=!1,_=null,b;const h=d(!1),C=d(null),g=d(null),i=d(!1);let m=-1;const c=d({problemId:"",username:"",language:void 0,status:void 0}),y=d([{title:"ID",colKey:"id",cell:(T,L)=>{let $=null;return Ct(L.row.status)&&kt(L.row.language)&&($=()=>{M(L.row.id)}),t(G,{variant:"text",onClick:$},{default:()=>[L.row.id]})}},{title:"问题",colKey:"problemId",cell:(T,L)=>{if(m){let $;return t(G,{variant:"text",onClick:()=>j(m,L.row.contestProblemIndex)},ra($=nt(L.row.contestProblemIndex))?$:{default:()=>[$]})}return t(G,{variant:"text",onClick:()=>w(L.row.problemId)},{default:()=>[L.row.problemId]})}},{title:"状态",colKey:"status",align:"center",cell:(T,L)=>{let $=null;Ct(L.row.status)&&kt(L.row.language)&&($=()=>{M(L.row.id)});const K=L.row.status,Y=It(K);let ae=!Ct(K);const H=Va(K);let O=[];return ct(K)&&O.push(t(De,{text:L.row.state,size:"small",class:"dida-status-loading"},null)),O.push(t("span",null,[Y])),t(G,{theme:H,variant:"outline",onClick:$,disabled:ae},ra(O)?O:{default:()=>[O]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"code",cell:(T,L)=>{let $=!kt(L.row.language);return t(G,{theme:"default",onClick:()=>x(L.row),disabled:$},{default:()=>[St(L.row.language)+" / "+L.row.codeLength]})}},{title:"作者",colKey:"author",width:200,cell:(T,L)=>t(G,{variant:"text",onClick:()=>V(L.row.authorUsername)},{default:()=>[L.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),P=d(!1);let p=1,k=50;const f=d({current:p,pageSize:k,defaultCurrent:p,defaultPageSize:k,total:0,pageSizeOptions:[50,100]}),v=d(),u=d([]);u.value=Ot();const s=d([]);s.value=Da();const x=async T=>{i.value=!0,h.value=!0;try{C.value=T;const L=await cn(Number(C.value.id));if(L.code===0){const $=L.data,Y=`\`\`\`${Gt($.language)}
${$.code}
\`\`\``,ae={};C.value.code=await me.md2html(Y,ae),await Ge(()=>{g.value&&(me.highlightRender({lineNumber:!0,enable:!0},g.value),et(g.value))})}else F(r,L.code)}finally{i.value=!1}},w=T=>{T&&n.push({path:"/problem/"+T})},j=(T,L)=>{n.push({name:"contest-problem-detail",params:{contestId:T,problemIndex:L}})},M=T=>{T&&(m>0?n.push({name:"contest-judge-detail",params:{contestId:m,judgeId:T}}):n.push({name:"judge-detail",params:{judgeId:T}}))},V=T=>{T&&n.push({path:"/user/"+T})},I=async()=>{await n.push({query:{...l.query,page:1,page_size:k,problem_id:c.value.problemId,username:c.value.username,language:c.value.language,status:c.value.status}})},z=async()=>{c.value.problemId="",c.value.username="",c.value.language=void 0,c.value.status=void 0,await n.push({query:{...l.query,page:1,page_size:k,problem_id:"",username:"",language:void 0,status:void 0}})},R=async(T,L)=>{L&&(P.value=!0);let $=!1;try{const{current:K,pageSize:Y}=T,ae=await dn(m,c.value.problemId,c.value.username,c.value.language,c.value.status,K,Y);if(v.value=[],ae.code===0){if(!ae.data.has_auth){be(r,"您目前没有权限查看评测记录"),m?await n.push({name:"contest-detail",params:{contestId:m}}):await n.push({name:"judge-list"});return}ae.data.list&&ae.data.list.length>0?(ae.data.list.forEach(O=>{var Ce;const N=La(O);(Ce=v.value)==null||Ce.push(N),ct(O.status)&&($=!0)}),f.value={...f.value,total:ae.data.total_count}):(be(r,"未找到记录"),f.value={...f.value,total:0})}else L&&F(r,ae.code)}catch(K){console.error(K),L&&F(r,Ne())}finally{L&&(P.value=!1),$&&o&&(b=setTimeout(()=>{R({current:p,pageSize:k},!1)},5e3))}},U=async T=>{await n.push({query:{...l.query,page:T.current,page_size:T.pageSize}})};return de(async()=>{o=!0,_=ze(()=>l.query,T=>{Array.isArray(l.params.contestId)?m=Number(l.params.contestId[0]):m=Number(l.params.contestId),c.value.problemId=T.problem_id||"",c.value.username=T.username||"",T.language!=null?c.value.language=Number(T.language):c.value.language=void 0,T.status!=null?c.value.status=Number(T.status):c.value.status=void 0;const L=parseInt(T.page)||f.value.defaultCurrent,$=parseInt(T.page_size)||f.value.defaultPageSize;p=L,k=$,f.value.pageSizeOptions.includes(k)||(k=f.value.defaultPageSize),f.value={...f.value,current:p,pageSize:k},R({current:p,pageSize:k},!0)},{immediate:!0})}),Le(()=>{o=!1,_&&_(),clearTimeout(b)}),(T,L)=>{const $=Ue,K=Ae,Y=Kt,ae=pt,H=G,O=ye,N=$e,Ce=Re,Ve=he,J=st,B=De,ce=ot;return D(),ee(re,null,[t(Ve,{style:{margin:"10px"}},{default:a(()=>[t(N,{layout:"inline",onSubmit:I,onReset:z},{default:a(()=>[t(K,{label:"题号"},{default:a(()=>[t($,{modelValue:c.value.problemId,"onUpdate:modelValue":L[0]||(L[0]=te=>c.value.problemId=te),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(K,{label:"用户"},{default:a(()=>[t($,{modelValue:c.value.username,"onUpdate:modelValue":L[1]||(L[1]=te=>c.value.username=te),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(K,{label:"语言"},{default:a(()=>[t(ae,{modelValue:c.value.language,"onUpdate:modelValue":L[2]||(L[2]=te=>c.value.language=te),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:a(()=>[(D(!0),ee(re,null,Ie(u.value,te=>(D(),E(Y,{key:te.value,value:te.value,label:te.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(K,{label:"状态"},{default:a(()=>[t(ae,{modelValue:c.value.status,"onUpdate:modelValue":L[3]||(L[3]=te=>c.value.status=te),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:a(()=>[(D(!0),ee(re,null,Ie(s.value,te=>(D(),E(Y,{key:te.value,value:te.value,label:te.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(K,null,{default:a(()=>[t(O,null,{default:a(()=>[t(H,{theme:"primary",type:"submit"},{default:a(()=>L[7]||(L[7]=[S("搜索")])),_:1}),t(H,{theme:"default",variant:"base",type:"reset"},{default:a(()=>L[8]||(L[8]=[S("重置")])),_:1})]),_:1})]),_:1})]),_:1}),t(Ce,{data:v.value,columns:y.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:f.value,loading:P.value,onPageChange:U,"table-layout":"auto"},null,8,["data","columns","pagination","loading"])]),_:1}),t(ce,{visible:h.value,"onUpdate:visible":L[5]||(L[5]=te=>h.value=te),width:"800px","cancel-btn":null,"close-btn":!1,onConfirm:L[6]||(L[6]=te=>h.value=!1)},{header:a(()=>[t(J,{onClick:L[4]||(L[4]=()=>{var te;M((te=C.value)==null?void 0:te.id)})},{default:a(()=>{var te,ge;return[S(q(((te=C.value)==null?void 0:te.id)+" - "+fe(St)((ge=C.value)==null?void 0:ge.language)),1)]}),_:1})]),default:a(()=>[t(B,{loading:i.value},{default:a(()=>{var te;return[A("div",{innerHTML:(te=C.value)==null?void 0:te.code,ref_key:"markdownCodeRef",ref:g,style:{"min-height":"100px"}},null,8,Fs)]}),_:1},8,["loading"])]),_:1},8,["visible"])],64)}}}),ia=ue(Os,[["__scopeId","data-v-8ecb6b14"]]),Gs={class:"dida-code-container"},Hs=["innerHTML"],Bs={key:2,class:"dida-edit-container"};function ua(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const Ws=ie({__name:"JudgeJobDetail",setup(e){const l=ke(),n=We(),r=qe(),{globalProperties:o}=pe();let _=!1,b,h=0,C=0;const g=d(""),i=d(null),m=d(""),c=d(null),y=d(0),P=d(null),p=d({from:"#5a96ff",to:"#00A870"});let k=!1;const f=d([{title:"ID",colKey:"id"},{title:"问题",colKey:"problemId",cell:(R,U)=>t(G,{variant:"text",onClick:()=>j(U.row.problemId)},{default:()=>[U.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(R,U)=>{const T=U.row.status,L=It(T),$=Va(T);let K=[];return ct(T)&&K.push(t(De,{text:U.row.state,size:"small",class:"dida-status-loading"},null)),K.push(t("span",null,[L])),t(G,{theme:$,variant:"outline"},ua(K)?K:{default:()=>[K]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"language",cell:(R,U)=>t("span",null,[St(U.row.language)+" / "+U.row.codeLength])},{title:"作者",colKey:"author",width:200,cell:(R,U)=>t(G,{variant:"text",onClick:()=>M(U.row.authorUsername)},{default:()=>[U.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),v=d(!1),u=d(!1),s=d(),x=He(()=>r.hasAuth(je.ManageJudge)),w=async()=>{if(!u.value){u.value=!0;try{const R=await _n(h);R.code===0?await I(!0):F(o,R.code)}catch(R){console.error(R),F(o,Ne())}finally{u.value=!1}}},j=R=>{R&&n.push({path:"/problem/"+R})},M=R=>{R&&n.push({path:"/user/"+R})},V=R=>{const U=R.status,T=It(U);let L;switch(U){case Fe.Init:case Fe.Rejudge:case Fe.Compiling:case Fe.Running:L="default";break;case Fe.Accept:L="success";break;case Fe.PE:L="warning";break;default:L="danger";break}return t(ye,null,{default:()=>[t(G,{theme:"default",variant:"outline"},{default:()=>[R.taskId]}),t(G,{theme:L,variant:"outline"},ua(T)?T:{default:()=>[T]}),t("span",null,[S("分数："),R.score]),t("span",null,[S("用时："),R.time]),t("span",null,[S("内存："),R.memory])]})},I=async R=>{var T;R&&(v.value=!0);let U=!1;try{const L=await un(h);if(s.value=[],L.code===0){const $=L.data,K=La($);(T=s.value)==null||T.push(K),g.value=K.judgerName,p.value.to="#00A870",ct($.status)?(P.value="active",K.taskTotal>0?(y.value=Number((K.taskCurrent/K.taskTotal*100).toFixed(2)),K.taskCurrent>=K.taskTotal&&(y.value=99)):y.value=0):(y.value=100,$.status===Fe.Accept?P.value="success":$.status===Fe.PE?(p.value.to="#F57C20",P.value="warning"):(p.value.to="#F56C6C",P.value="error"));const Y={};if($.code){const H=`\`\`\`${Gt($.language)}
${$.code}
\`\`\``;m.value=await me.md2html(H,Y),await Ge(()=>{c.value&&(k||(k=!0,me.highlightRender({lineNumber:!0,enable:!0},c.value)),et(c.value))})}i.value=K,ct($.status)&&(U=!0)}else R&&F(o,L.code),C?await n.push({name:"contest-judge",params:{contestId:C}}):await n.push({name:"judge-list"})}catch(L){console.error(L),R&&F(o,Ne())}finally{R&&(v.value=!1),U&&_&&(b=setTimeout(()=>{I(!1)},5e3))}};function z(){c.value&&c.value.parentElement&&(c.value.style.maxWidth=c.value.parentElement.clientWidth+"px")}return de(async()=>{if(_=!0,Array.isArray(l.params.judgeId)?h=Number(l.params.judgeId[0]):h=Number(l.params.judgeId),Array.isArray(l.params.contestId)?C=Number(l.params.contestId[0]):C=Number(l.params.contestId),!h){await n.push({name:"judge"});return}await I(!0),z(),window.addEventListener("resize",z)}),Le(()=>{_=!1,window.removeEventListener("resize",z),clearTimeout(b)}),(R,U)=>{var Ve,J,B;const T=qt,L=Re,$=he,K=xe,Y=Xe,ae=Je,H=Te,O=Tl,N=xl,Ce=G;return D(),ee(re,null,[t(T,{color:p.value,status:P.value,class:"dida-job-progress",percentage:y.value},null,8,["color","status","percentage"]),t($,{style:{margin:"10px"}},{default:a(()=>[t(L,{data:s.value,columns:f.value,"row-key":"id","vertical-align":"top",hover:!0,loading:v.value},null,8,["data","columns","loading"])]),_:1}),t(H,null,{default:a(()=>[t(K,{span:8},{default:a(()=>[A("div",Gs,[A("div",{innerHTML:m.value,ref_key:"markdownCodeRef",ref:c,class:"dida-code-div"},null,8,Hs)])]),_:1}),t(K,{span:4},{default:a(()=>[t(ae,{layout:"vertical",bordered:!0,style:{margin:"10px"}},{default:a(()=>[t(Y,{label:"判题机"},{default:a(()=>[S(q(g.value),1)]),_:1}),t(Y,{label:"判题时间"},{default:a(()=>{var ce;return[S(q((ce=i.value)==null?void 0:ce.judgeTime),1)]}),_:1})]),_:1})]),_:1})]),_:1}),(Ve=i.value)!=null&&Ve.compileMessage?(D(),E($,{key:0,class:"compile-message"},{default:a(()=>{var ce;return[S(q((ce=i.value)==null?void 0:ce.compileMessage),1)]}),_:1})):ne("",!0),(J=i.value)!=null&&J.task&&((B=i.value)==null?void 0:B.task.length)>0?(D(),E(N,{key:1,class:"task-panel"},{default:a(()=>{var ce;return[(D(!0),ee(re,null,Ie((ce=i.value)==null?void 0:ce.task,(te,ge)=>(D(),E(O,{key:te.taskId,header:()=>V(te)},{default:a(()=>[S(q(te.content)+" "+q(te.waHint),1)]),_:2},1032,["header"]))),128))]}),_:1})):ne("",!0),x.value?(D(),ee("div",Bs,[t(Ce,{onClick:w,loading:u.value},{default:a(()=>U[0]||(U[0]=[S("重新评测")])),_:1},8,["loading"])])):ne("",!0)],64)}}}),ca=ue(Ws,[["__scopeId","data-v-16d4df65"]]),Js={style:{margin:"10px"}},Xs=ie({__name:"ContestList",setup(e){const l=ke(),n=We(),{globalProperties:r}=pe();let o=null;const _=d([{title:"ID",colKey:"id",cell:(f,v)=>t(G,{variant:"text",onClick:()=>c(v.row.id)},{default:()=>[v.row.id]})},{title:"标题",colKey:"title",cell:(f,v)=>t(G,{variant:"text",onClick:()=>c(v.row.id)},{default:()=>[v.row.title]})},{title:"负责人",colKey:"ownerNickname",cell:(f,v)=>t(G,{variant:"text",onClick:()=>Wt(n,v.row.ownerUsername)},{default:()=>[v.row.ownerNickname]})},{title:"权限",colKey:"private",cell:(f,v)=>v.row.private?"私有":"公开"},{title:"开始时间",colKey:"startTime"},{title:"结束时间",colKey:"endTime"}]),b=d(!1);let h=1,C=50;const g=d({current:h,pageSize:C,defaultCurrent:h,defaultPageSize:C,total:0,pageSizeOptions:[50,100]}),i=d(),m=d({title:"",username:""}),c=f=>{f&&n.push({path:"/contest/"+f})},y=async()=>{await n.push({query:{...l.query,title:m.value.title,username:m.value.username,page:1,page_size:g.value.defaultPageSize}})},P=async(f,v)=>{var u;b.value=!0;try{const{current:s,pageSize:x}=f,w=await wo(s,x);if(i.value=[],w.code===0){const j=w.data.list;for(let M=0;M<j.length;M++){const V=j[M],I=await Bt(V);(u=i.value)==null||u.push(I)}g.value={...g.value,total:w.data.total_count}}else v&&F(r,w.code)}catch(s){console.error(s),F(r,Ne())}finally{b.value=!1}},p=async f=>{await n.push({query:{...l.query,page:f.current,page_size:f.pageSize}})},k=()=>{n.push({name:"contest-create"})};return de(async()=>{o=ze(()=>l.query,f=>{m.value.title=f.title||"",m.value.username=f.username||"";const v=parseInt(f.page)||g.value.defaultCurrent,u=parseInt(f.page_size)||g.value.defaultPageSize;h=v,C=u,g.value={...g.value,current:h,pageSize:C},P({current:h,pageSize:C},!0)},{immediate:!0})}),Le(()=>{o&&o()}),(f,v)=>{const u=Re,s=he,x=xe,w=Ue,j=Ae,M=G,V=$e,I=ye,z=Te;return D(),E(z,null,{default:a(()=>[t(x,{span:9},{default:a(()=>[t(s,{style:{margin:"10px"}},{default:a(()=>[t(u,{data:i.value,columns:_.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:g.value,loading:b.value,"table-layout":"auto",onPageChange:p,style:{"white-space":"nowrap"}},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(x,{span:3},{default:a(()=>[A("div",Js,[t(s,{class:"sh-card"},{default:a(()=>[t(V,{model:m.value},{default:a(()=>[t(j,{label:"标题"},{default:a(()=>[t(w,{modelValue:m.value.title,"onUpdate:modelValue":v[0]||(v[0]=R=>m.value.title=R),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(j,{label:"负责人"},{default:a(()=>[t(w,{modelValue:m.value.username,"onUpdate:modelValue":v[1]||(v[1]=R=>m.value.username=R),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(j,null,{default:a(()=>[t(M,{theme:"primary",onClick:y},{default:a(()=>v[2]||(v[2]=[S("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(s,{class:"sh-card"},{default:a(()=>[t(I,null,{default:a(()=>[t(M,{onClick:k},{default:a(()=>v[3]||(v[3]=[S("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),da=ue(Xs,[["__scopeId","data-v-c929776f"]]),Ys={style:{margin:"20px"}},Zs={style:{margin:"10px"}},Qs={style:{"text-align":"center","align-content":"center",padding:"20px",height:"500px"}},er={style:{"text-align":"center",width:"100%"}},tr={class:"dida-operation-container"},ar={style:{margin:"12px"}},lr=["innerHTML"],nr=ie({__name:"ContestDetail",setup(e){let l=ke();const{globalProperties:n}=pe(),r=Ye(),o=qe(),_=d(!1);let b=0;const h=d(!1),C=d(null),g=d(!1),i=d(!1),m=d(""),c=He(()=>o.hasAuth(je.ManageContest)||C.value&&o.getUserId==C.value.ownerId),y=w=>{if(!w||!k)return"default";const j=k[w];if(!j)return"default";switch(j){case Oe.Accept:return"success";case Oe.Attempt:return"warning";default:return"default"}},P=d([{title:"问题ID",colKey:"index",cell:(w,j)=>{const M=y(j.row.index);return t(G,{variant:"dashed",theme:M,onClick:async()=>await Et(b,j.row.index)},{default:()=>[j.row.id]})}},{title:"标题",colKey:"title",cell:(w,j)=>t(G,{variant:"text",onClick:async()=>await Et(b,j.row.index)},{default:()=>[j.row.title]})},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),p=d([]);let k={},f=d(!1);const v=()=>{Z.push({name:"contest-edit",params:{contestId:b}})},u=async()=>{_.value=!0;try{const w=await Po(b);if(w.code!==0){F(n,w.code);return}const j=w.data;be(n,"查重报告已生成，请前往查看"),window.open(j,"_blank")}finally{_.value=!1}},s=async w=>{if(!o.isLogin()){await Z.push({name:"login"});return}if(!m.value){ve(n,"请输入密码");return}f.value=!0;try{const j=await Io(b,m.value);if(j.code!==0){F(n,j.code);return}be(n,"申请访问成功"),await x()}catch(j){console.error("Error submitting contest password:",j),F(n,"提交密码失败，请稍后再试")}finally{f.value=!1}},x=async()=>{h.value=!0;const w=await go(b);if(w.code!==0){h.value=!1,F(n,w.code),await Z.push({name:"contest"});return}g.value=w.data.has_auth,i.value=w.data.need_password,C.value=await Bt(w.data.contest),p.value=C.value.problems,k=w.data.attempt_status||{},r.setTitle(C.value.title+" - "+r.getTitle),await Ge(()=>{const j=document.querySelectorAll(".dida-content-description");j&&j.length>0&&j.forEach(M=>{me.mathRender(M),me.highlightRender({lineNumber:!0,enable:!0},M),et(M)}),h.value=!1})};return de(async()=>{if(Array.isArray(l.params.contestId)?b=Number(l.params.contestId[0]):b=Number(l.params.contestId),!b){await Z.push({name:"contest"});return}await x()}),(w,j)=>{const M=Tt,V=Re,I=he,z=Ue,R=Ae,U=G,T=$e,L=xe,$=ye,K=Xe,Y=Je,ae=Te,H=De;return D(),E(H,{loading:h.value},{default:a(()=>[t(ae,{class:"dida-main-content"},{default:a(()=>[t(L,{span:6},{default:a(()=>{var O,N,Ce;return[A("div",Ys,[A("h1",null,q((O=C.value)==null?void 0:O.title),1),(N=C.value)!=null&&N.notification?(D(),E(M,{key:0,theme:"info",message:(Ce=C.value)==null?void 0:Ce.notification},null,8,["message"])):ne("",!0)]),A("div",Zs,[g.value?(D(),E(I,{key:0},{default:a(()=>[t(V,{data:p.value,columns:P.value,"row-key":"id","table-layout":"auto","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1})):(D(),E(I,{key:1},{default:a(()=>[A("div",Qs,[t(M,{theme:"warning",message:"您没有查看本比赛的权限"}),i.value?(D(),E(T,{key:0,style:{margin:"20px auto 0",width:"200px"},onSubmit:s,"label-width":"0"},{default:a(()=>[t(R,null,{default:a(()=>[t(z,{placeholder:"请输入密码",value:m.value,"onUpdate:value":j[0]||(j[0]=Ve=>m.value=Ve),style:{width:"300px"},type:"password",autocomplete:"new-password"},null,8,["value"])]),_:1}),t(R,null,{default:a(()=>[A("div",er,[t(U,{theme:"primary",type:"submit",loading:fe(f)},{default:a(()=>j[1]||(j[1]=[S("提交")])),_:1},8,["loading"])])]),_:1})]),_:1})):ne("",!0)])]),_:1}))])]}),_:1}),t(L,{span:6},{default:a(()=>{var O;return[A("div",tr,[t($,null,{default:a(()=>[c.value?(D(),E(U,{key:0,onClick:u,loading:_.value},{default:a(()=>j[2]||(j[2]=[S("查重")])),_:1},8,["loading"])):ne("",!0),c.value?(D(),E(U,{key:1,onClick:v},{default:a(()=>j[3]||(j[3]=[S("编辑")])),_:1})):ne("",!0)]),_:1})]),A("div",ar,[t(Y,{layout:"vertical",bordered:!0},{default:a(()=>[t(K,{label:"创建时间"},{default:a(()=>{var N;return[S(q((N=C.value)==null?void 0:N.createTime),1)]}),_:1})]),_:1}),t(Y,{layout:"vertical",bordered:!0},{default:a(()=>[t(K,{label:"更新时间"},{default:a(()=>{var N;return[S(q((N=C.value)==null?void 0:N.updateTime),1)]}),_:1})]),_:1}),t(Y,{layout:"vertical",bordered:!0},{default:a(()=>[t(K,{label:"开始时间"},{default:a(()=>{var N;return[S(q((N=C.value)==null?void 0:N.startTime),1)]}),_:1})]),_:1}),t(Y,{layout:"vertical",bordered:!0},{default:a(()=>[t(K,{label:"结束时间"},{default:a(()=>{var N;return[S(q((N=C.value)==null?void 0:N.endTime),1)]}),_:1})]),_:1})]),(O=C.value)!=null&&O.description?(D(),E(I,{key:0,style:{margin:"12px"}},{default:a(()=>{var N;return[A("div",{innerHTML:(N=C.value)==null?void 0:N.description,class:"dida-content-description"},null,8,lr)]}),_:1})):ne("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),or=ue(nr,[["__scopeId","data-v-75131de1"]]);function qa(e){return e?Math.floor(e/1e9):0}function ut(e){if(e<=0)return"0秒";let l="";const n=Math.floor(e/3600);n>0&&(l+=`${n}小时`);const r=Math.floor(e%3600/60);return(r>0||n>0)&&(n>0&&r<10&&(l+="0"),l+=`${r}分钟`),e=e%60,(e>0||r>0||n>0)&&((n>0||r>0)&&e<10&&(l+="0"),l+=`${e.toFixed(0)}秒`),l}const sr=mt("contest",{state:()=>({starMembers:{}}),actions:{clear(){this.$patch({starMembers:{}})},addStarMember(e,l){this.starMembers[e]||(this.starMembers[e]={}),this.starMembers[e][l]=!0},removeStarMember(e,l){this.starMembers[e]&&(delete this.starMembers[e][l],Object.keys(this.starMembers[e]).length===0&&delete this.starMembers[e])},isStarMember(e,l){var n;return!!((n=this.starMembers[e])!=null&&n[l])}},persist:!0}),rr={style:{margin:"10px 10px 40px"}},ir={style:{"text-align":"right","margin-bottom":"10px"}},ur={class:"table-scroll-wrapper"};function ma(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const cr=ie({__name:"ContestRank",setup(e){const l=ke(),n=We(),r=sr(),{globalProperties:o}=pe();let _=!1,b=null,h=0,C=null,g=null,i=0;const m=d(0),c=d(0),y=d(!1),P=d(!0),p=d(!0);let k=null,f=null,v=1,u=50;const s=d({current:v,pageSize:u,defaultCurrent:1,defaultPageSize:50,total:0,pageSizeOptions:[50,100,1e3]}),x=J=>r&&r.isStarMember(h,J),w=async J=>{s.value={...s.value,current:J.current,pageSize:J.pageSize},await n.push({query:{...l.query,page:J.current,page_size:J.pageSize}})},j=J=>{if(J==null)return"-";const B=Math.floor(J/3600).toString().padStart(2,"0"),ce=Math.floor(J%3600/60).toString().padStart(2,"0"),te=(J%60).toFixed(0).toString().padStart(2,"0");return`${B}:${ce}:${te}`},M=d({}),V=[{title:"Rank",colKey:"rank",align:"center",fixed:"left"},{title:"昵称",colKey:"nickname",fixed:"left",attrs:J=>{let B={};return x(J.row.userId)&&(B={backgroundColor:"rgba(255,165,30,0.5)"}),{style:B}},cell:(J,B)=>{const ce=on(B.row.nickname,18);let te=null;return x(B.row.userId)?te=t(G,{shape:"circle",variant:"text",class:"rank-unstar-button",onClick:()=>{r.removeStarMember(h,B.row.userId),N()}},{default:()=>[t(rl,{slot:"icon"},null)]}):te=t(G,{shape:"circle",variant:"text",class:"rank-star-button",onClick:()=>{r.addStarMember(h,B.row.userId),N()}},{default:()=>[t(il,{slot:"icon"},null)]}),t("div",{class:"rank-nickname-cell"},[t(ye,null,{default:()=>[t(Dl,{content:B.row.nickname},{default:()=>[t(G,{variant:"text",onClick:()=>n.push({name:"user",params:{username:B.row.username}})},ma(ce)?ce:{default:()=>[ce]})]}),te]})])}},{title:"Solved",colKey:"solved",align:"center",fixed:"left",cell:(J,B)=>t(G,{variant:"text",onClick:()=>n.push({name:"contest-judge",params:{contestId:h},query:{username:B.row.username,status:Fe.Accept}})},{default:()=>[B.row.solved]})},{title:"Penalty",colKey:"penalty",align:"center",fixed:"left",cell:(J,B)=>j(B.row.penalty)}],I=d([]),z=d(!1);let R=[],U=[];const T=d([]);let L=[];const $=({col:J,rowIndex:B})=>{if(J.colKey==="rank"){let ce=s.value.current;s.value.current>Math.ceil(T.value.length/s.value.pageSize)&&(ce=Math.ceil(T.value.length/s.value.pageSize));let te=s.value.pageSize*(ce-1),ge=1;for(let Se=B+1;te+Se<T.value.length&&T.value[te+Se].rank===T.value[te+B].rank;Se++)ge++;return{rowspan:ge}}},K=(J,{value:B})=>ut(B),Y=()=>{k&&clearInterval(k),k=setInterval(()=>{_&&Ve(!1)},3e4),f&&clearInterval(f),f=setInterval(()=>{if(!_)return;m.value=(new Date().getTime()-C.getTime())/1e3;const J=Math.min(m.value,c.value);m.value=Math.min(m.value,J),N()},1e3)},ae=()=>{k&&(clearInterval(k),k=null),f&&(clearInterval(f),f=null)},H=async J=>{p.value=J,J?(await Ve(!1),Y()):ae()},O=()=>{N(),s.value={...s.value,current:1}},N=()=>{T.value=[];let J=[];for(let W=0;W<R.length;W++){const se=R[W];let _e={userId:se.author_id,username:se.author_username,nickname:se.author_nickname},Ke=0,Pe=0;se.problems.forEach(we=>{let Ze=-1,at=we.lock||0;if(we.ac){if(Ze=(new Date(we.ac).getTime()-(C==null?void 0:C.getTime()))/1e3,Ze>m.value)return;Ke++,Pe+=Ze,Pe+=we.attempt*20*60}if(at>0&&i>0){const Lt=c.value-i;m.value<Lt&&(at=0)}const rt=we.index;_e[`problem_${rt}`]={acDuration:Ze,attempt:we.attempt||0,lock:at}}),_e.solved=Ke,_e.penalty=Pe,J.push(_e)}J.sort((W,se)=>W.solved!==se.solved?se.solved-W.solved:W.penalty!==se.penalty?W.penalty-se.penalty:W.userId-se.userId);const B=U;let ce=0,te=0,ge=-1,Se=-1;for(let W=0;W<J.length;W++)B&&B.includes(J[W].userId)?J[W].rank="*":(te++,(J[W].solved!==ge||J[W].penalty!==Se)&&(ce=te,ge=J[W].solved,Se=J[W].penalty),J[W].rank=String(ce));y.value&&(J=J.filter(W=>x(W.userId)));const le=document.querySelectorAll("tbody tr"),Q={};L.forEach((W,se)=>{const _e=le[se];_e&&(Q[W.userId]=_e.getBoundingClientRect())}),s.value={...s.value,total:J.length},T.value=J;for(let W=0;W<T.value.length;W++)T.value[W].index=W+1;if(L=[...T.value],P.value){const W={},se=document.querySelectorAll("table tbody tr");T.value.forEach((_e,Ke)=>{const Pe=se[Ke];Pe&&(W[_e.userId]=Pe.getBoundingClientRect())}),requestAnimationFrame(()=>{const _e=document.querySelectorAll("table tbody tr");T.value.forEach((Ke,Pe)=>{const we=_e[Pe],Ze=Q[Ke.userId],at=W[Ke.userId];if(Ze&&at){const rt=Ze.top-at.top;rt!==0&&(we.style.transition="none",we.style.transform=`translateY(${rt}px)`)}}),requestAnimationFrame(()=>{document.querySelectorAll("table tbody tr").forEach(Pe=>{Pe.style.transition="transform 300ms ease",Pe.style.transform=""})})})}},Ce=J=>{H(!1),m.value=J;const B=Math.min(c.value,(new Date().getTime()-(C==null?void 0:C.getTime()))/1e3);m.value=Math.min(m.value,B),N()},Ve=async J=>{J&&(z.value=!0);try{const B=await ko(h);if(I.value=[...V],R=[],U=[],T.value=[],s.value={...s.value,total:0},B.code===0){if(!B.data.has_auth){be(o,"您目前没有权限查看比赛排名"),await n.push({name:"contest-detail",params:{contestId:h}});return}B.data.problems.sort((ge,Se)=>ge-Se),B.data.problems.forEach((ge,Se)=>{I.value.push({colKey:`problem_${ge}`,align:"center",title:()=>{let le;return t(G,{variant:"text",onClick:()=>n.push({name:"contest-problem-detail",params:{contestId:h,problemIndex:ge}})},ma(le=nt(ge))?le:{default:()=>[le]})},cell:(le,Q)=>{const W=Q.row[`problem_${ge}`];if(!W)return"";let se="";return W.acDuration>=0&&(se=j(W.acDuration)),W.attempt>0&&(se&&(se+=" "),se+=`(-${W.attempt})`),W.lock>0&&(se&&(se+=" "),se+=`(+${W.lock})`),t("span",null,[se])},attrs:le=>{const Q=le.row[`problem_${ge}`];return Q?Q.acDuration>=0?{style:{backgroundColor:"rgba(130,255,30,0.5)"}}:Q.lock>0?{style:{backgroundColor:"rgb(255,180,50,0.5)"}}:Q.attempt>0?{style:{backgroundColor:"rgba(255,120,120,0.5)"}}:{}:{}}})});const ce=B.data.contest;if(C=new Date(ce.start_time),g=new Date(ce.end_time),R=B.data.ranks,U=B.data.v_members||[],c.value=Math.floor((g.getTime()-C.getTime())/1e3),M.value={0:"0",[Math.floor(c.value/2)]:ut(Math.floor(c.value/2)),[c.value]:ut(c.value)},i=qa(ce.lock_rank_duration||0),B.data.is_locked&&i>0){const ge=Math.max(0,c.value-i);M.value[ge]=t("span",{style:"color: #0052d9"},[S("锁榜("),ut(ge),S(")")])}m.value=Math.floor((new Date().getTime()-C.getTime())/1e3);const te=Math.min(m.value,c.value);m.value=Math.min(m.value,te),p.value=!0,Y(),N()}else J&&F(o,B.code)}catch(B){console.error(B),J&&F(o,Ne())}finally{J&&(z.value=!1)}};return de(async()=>{_=!0,b=ze(()=>l.query,async J=>{if(Array.isArray(l.params.contestId)?h=Number(l.params.contestId[0]):h=Number(l.params.contestId),!h){await n.push({name:"contest"});return}const B=parseInt(J.page)||s.value.defaultCurrent,ce=parseInt(J.page_size)||s.value.defaultPageSize;v=B,u=ce,s.value={...s.value,current:v,pageSize:u},await Ve(!0)},{immediate:!0})}),Le(()=>{_=!1,b&&b(),ae()}),(J,B)=>{const ce=ft,te=ye,ge=Vl,Se=Re,le=he,Q=Te;return D(),E(Q,null,{default:a(()=>[t(le,{style:{margin:"10px",width:"100%"}},{default:a(()=>[A("div",rr,[A("div",ir,[t(te,null,{default:a(()=>[t(ce,{size:"large",modelValue:y.value,"onUpdate:modelValue":B[0]||(B[0]=W=>y.value=W),onChange:O},{label:a(W=>[S(q(W.value?"仅展示收藏":"未过滤收藏"),1)]),_:1},8,["modelValue"]),t(ce,{size:"large",modelValue:P.value,"onUpdate:modelValue":B[1]||(B[1]=W=>P.value=W)},{label:a(W=>[S(q(W.value?"开启动画":"关闭动画"),1)]),_:1},8,["modelValue"]),t(ce,{size:"large",modelValue:p.value,"onUpdate:modelValue":B[2]||(B[2]=W=>p.value=W),onChange:H},{label:a(W=>[S(q(W.value?"自动刷新":"关闭刷新"),1)]),_:1},8,["modelValue"])]),_:1})]),t(ge,{modelValue:m.value,"onUpdate:modelValue":B[3]||(B[3]=W=>m.value=W),marks:M.value,max:c.value,label:K,"tooltip-props":{placement:"top"},"input-number-props":{theme:"column",autoWidth:!0,format:fe(ut),onChange:Ce},onChangeEnd:Ce},null,8,["modelValue","marks","max","input-number-props"])]),A("div",ur,[t(Se,{data:T.value,columns:I.value,"row-key":"index","vertical-align":"middle",bordered:!0,hover:!0,"table-layout":"auto","rowspan-and-colspan":$,loading:z.value,class:"dida-contest-rank-table",pagination:s.value,onPageChange:w},null,8,["data","columns","loading","pagination"])])]),_:1})]),_:1})}}}),dr=ue(cr,[["__scopeId","data-v-838e6c28"]]),mr={style:{margin:"10px"}},pr={style:{margin:"12px"}},fr={class:"dida-edit-container"},vr=ie({__name:"ContestEdit",setup(e){let l=ke();const{globalProperties:n}=pe(),r=Ye(),o=d(""),_=d(!1);let b=null;const h=d(!1),C=d(!1),g=d(null),i=d({title:"",openTime:[],private:!0,password:"",problems:[],members:[],description:"",notification:"",lockRankDuration:0,alwaysLock:!0,submitAnytime:!1}),m=d(""),c=d(""),y=d(!1),P=async()=>{y.value=!0,C.value=!1,y.value=!1},p=async()=>{if(b){h.value=!0;try{const u={title:i.value.title,description:b.getValue(),notification:i.value.notification,lock_rank_duration:i.value.lockRankDuration,always_lock:i.value.alwaysLock,problems:i.value.problems,members:i.value.members,private:i.value.private,password:i.value.password,submit_anytime:i.value.submitAnytime};i.value.openTime[0]&&(u.start_time=new Date(i.value.openTime[0])),i.value.openTime[1]&&(u.end_time=new Date(i.value.openTime[1]));const s=await Co(u);if(h.value=!0,s.code!==0){F(n,s.code);return}s.data!=null&&await Z.push({name:"contest-detail",params:{contestId:s.data}}),Be(n,"创建成功")}finally{h.value=!1}}},k=async()=>{if(b){h.value=!0;try{const u={id:Number(o.value),title:i.value.title,description:b.getValue(),notification:i.value.notification,lock_rank_duration:i.value.lockRankDuration,always_lock:i.value.alwaysLock,problems:i.value.problems,members:i.value.members,private:i.value.private,password:i.value.password,submit_anytime:i.value.submitAnytime};i.value.openTime[0]&&(u.start_time=new Date(i.value.openTime[0])),i.value.openTime[1]&&(u.end_time=new Date(i.value.openTime[1]));const s=await So(u);if(h.value=!0,s.code!==0){F(n,s.code);return}s.data!=null&&g.value&&(g.value.updateTime=new Date(s.data).toLocaleString()),Be(n,"保存成功")}finally{h.value=!1}}},f=u=>{const s={after:()=>{b==null||b.setValue(u),_.value=!1},preview:{math:{inlineDigit:!0,engine:"KaTeX"}}};b=new me("contestEditDiv",s)},v=async()=>{const u=await bo(o.value);if(u.code!==0){F(n,u.code),console.error("contest get failed",u.code),await Z.push({name:"contest-list"});return}const s=u.data.contest;g.value=await Bt(s),i.value.title=s.title,i.value.openTime=[],s.start_time?i.value.openTime.push(new Date(s.start_time)):i.value.openTime.push(""),s.end_time?i.value.openTime.push(new Date(s.end_time)):i.value.openTime.push(""),i.value.private=s.private,i.value.password=s.password||"",i.value.description=s.description||"",i.value.notification=s.notification||"",i.value.problems=u.data.problems,i.value.members=u.data.members,s.lock_rank_duration?i.value.lockRankDuration=qa(s.lock_rank_duration):i.value.lockRankDuration=0,i.value.alwaysLock=s.always_lock,i.value.submitAnytime=s.submit_anytime,r.setTitle(s.title+" - "+r.getTitle);let x="";s.description&&(x=s.description),f(x)};return de(async()=>{Array.isArray(l.params.contestId)?o.value=l.params.contestId[0]:o.value=l.params.contestId,o.value?(_.value=!0,await v()):f("")}),(u,s)=>{const x=Ue,w=Ae,j=Nt,M=ft,V=wa,I=$e,z=he,R=xe,U=G,T=ye,L=Xe,$=Je,K=Te,Y=De,ae=xt,H=ot;return D(),ee(re,null,[t(Y,{loading:_.value},{default:a(()=>[t(K,null,{default:a(()=>[t(R,{span:8},{default:a(()=>[A("div",mr,[t(z,{class:"sh-card"},{default:a(()=>[t(I,{model:i.value,"label-width":"150px"},{default:a(()=>[t(w,{label:"标题"},{default:a(()=>[t(x,{modelValue:i.value.title,"onUpdate:modelValue":s[0]||(s[0]=O=>i.value.title=O),placeholder:"比赛标题"},null,8,["modelValue"])]),_:1}),t(w,{label:"通知"},{default:a(()=>[t(x,{modelValue:i.value.notification,"onUpdate:modelValue":s[1]||(s[1]=O=>i.value.notification=O),placeholder:"会更为醒目地提醒"},null,8,["modelValue"])]),_:1}),t(w,{label:"开启时间"},{default:a(()=>[t(j,{modelValue:i.value.openTime,"onUpdate:modelValue":s[2]||(s[2]=O=>i.value.openTime=O),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(w,{label:"提交限制"},{default:a(()=>[t(M,{modelValue:i.value.submitAnytime,"onUpdate:modelValue":s[3]||(s[3]=O=>i.value.submitAnytime=O)},{label:a(O=>[S(q(O.value?"结束仍能提交":"仅比赛期间提交"),1)]),_:1},8,["modelValue"])]),_:1}),t(w,{label:"锁榜时长"},{default:a(()=>[t(V,{modelValue:i.value.lockRankDuration,"onUpdate:modelValue":s[4]||(s[4]=O=>i.value.lockRankDuration=O),min:0,format:fe(ut),"auto-width":""},null,8,["modelValue","format"])]),_:1}),t(w,{label:"自动解锁"},{default:a(()=>[t(M,{modelValue:i.value.alwaysLock,"onUpdate:modelValue":s[5]||(s[5]=O=>i.value.alwaysLock=O)},{label:a(O=>[S(q(O.value?"结束后仍锁榜":"结束后解锁"),1)]),_:1},8,["modelValue"])]),_:1}),t(w,{label:"私有"},{default:a(()=>[t(M,{modelValue:i.value.private,"onUpdate:modelValue":s[6]||(s[6]=O=>i.value.private=O)},null,8,["modelValue"])]),_:1}),i.value.private?(D(),E(w,{key:0,label:"密码"},{default:a(()=>[t(x,{modelValue:i.value.password,"onUpdate:modelValue":s[7]||(s[7]=O=>i.value.password=O),type:"password",placeholder:"请输入访问密码，留空代表关闭密码访问"},null,8,["modelValue"])]),_:1})):ne("",!0),i.value.private?(D(),E(w,{key:1,label:"成员"},{default:a(()=>[t(Ea,{modelValue:i.value.members,"onUpdate:modelValue":s[8]||(s[8]=O=>i.value.members=O)},null,8,["modelValue"])]),_:1})):ne("",!0),t(w,{label:"问题"},{default:a(()=>[t(Ma,{modelValue:i.value.problems,"onUpdate:modelValue":s[9]||(s[9]=O=>i.value.problems=O)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(R,{span:4},{default:a(()=>[A("div",pr,[A("div",fr,[o.value?(D(),E(T,{key:0},{default:a(()=>[t(U,{onClick:k,theme:"danger",loading:h.value},{default:a(()=>s[12]||(s[12]=[S("保存")])),_:1},8,["loading"])]),_:1})):(D(),E(T,{key:1},{default:a(()=>[t(U,{onClick:p,theme:"danger",loading:h.value},{default:a(()=>s[13]||(s[13]=[S("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(D(),E($,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(L,{label:"创建时间"},{default:a(()=>{var O;return[S(q((O=g.value)==null?void 0:O.createTime),1)]}),_:1}),t(L,{label:"更新时间"},{default:a(()=>{var O;return[S(q((O=g.value)==null?void 0:O.updateTime),1)]}),_:1}),t(L,{label:"创建用户"},{default:a(()=>{var O;return[S(q((O=g.value)==null?void 0:O.ownerNickname),1)]}),_:1})]),_:1})):ne("",!0)])]),_:1})]),_:1}),s[14]||(s[14]=A("div",{id:"contestEditDiv",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"]),t(H,{visible:C.value,"onUpdate:visible":s[11]||(s[11]=O=>C.value=O),onConfirm:P,header:m.value,"confirm-loading":y.value},{default:a(()=>[s[15]||(s[15]=A("div",{style:{"margin-bottom":"10px"}},[A("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(ae,{modelValue:c.value,"onUpdate:modelValue":s[10]||(s[10]=O=>c.value=O),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),pa=ue(vr,[["__scopeId","data-v-77e745ac"]]);function Ka(e){const l={};return l.id=e.id,l.authorId=e.author_id,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.title=e.title,l.content=e.content,e.insert_time&&(l.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(l.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(l.updateTime=new Date(e.update_time).toLocaleString()),l.problemId=e.problem_id,l.problemTitle=e.problem_title,l.contestId=e.contest_id,l.contestTitle=e.contest_title,l.contestProblemIndex=e.contest_problem_index,l}async function _r(e){const l={};if(l.id=e.id,l.authorId=e.author_id,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.content="",e.content){const n={math:{inlineDigit:!0,engine:"KaTeX"}};l.content=await me.md2html(e.content,n)}return e.insert_time&&(l.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(l.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(l.updateTime=new Date(e.update_time).toLocaleString()),l}function gr(e){return X({url:"/discuss?id="+e,method:"get"})}function br(e,l,n,r,o,_){const b={};return e&&(b.contest_id=e),l&&(b.problem_id=l),n&&(b.title=n),r&&(b.username=r),o&&(b.page=o),_&&(b.page_size=_),X({url:`/discuss/list?${new URLSearchParams(b).toString()}`,method:"get"})}function hr(e,l,n){return X({url:"/discuss/comment/list?id="+e+"&page="+l+"&page_size="+n,method:"get"})}function yr(e){return X({url:"/discuss/create",method:"post",data:e})}const wr={style:{margin:"10px"}};function kr(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const Cr=ie({__name:"DiscussList",setup(e){const l=ke(),n=We(),{globalProperties:r}=pe();let o=null;const _=d(!1),b=d(!1);let h=-1;const C=d([]),g=[],i=[{title:"标题",colKey:"title",cell:(I,z)=>t(G,{variant:"text",onClick:()=>s(z.row.id)},{default:()=>[z.row.title]})},{title:"创建人",colKey:"authorNickname",width:"200",cell:(I,z)=>t(G,{variant:"text",onClick:async()=>await Wt(n,z.row.authorUsername)},{default:()=>[z.row.authorNickname]})},{title:"创建时间",colKey:"insertTime",width:"180"},{title:"更新时间",colKey:"updateTime",width:"180"}],m=d(!1);let c=1,y=50;const P=d({current:c,pageSize:y,defaultCurrent:c,defaultPageSize:y,total:0,pageSizeOptions:[50,100]}),p=d(),k=d({problemId:"",title:"",username:""}),f=d({title:"",content:""}),v=I=>{I&&n.push({name:"problem-detail",params:{problemId:I}})},u=(I,z)=>{n.push({name:"contest-problem-detail",params:{contestId:I,problemIndex:z}})},s=I=>{if(I){if(h){n.push({name:"contest-discuss-detail",params:{contestId:h,discussId:I}});return}n.push({name:"discuss-detail",params:{discussId:I}})}},x=async()=>{await n.push({query:{...l.query,problem_id:k.value.problemId,title:k.value.title,username:k.value.username,page:1,page_size:P.value.defaultPageSize}})},w=async(I,z)=>{var R;m.value=!0;try{const{current:U,pageSize:T}=I,L=await br(h,k.value.problemId,k.value.title,k.value.username,U,T);if(p.value=[],L.code===0){if(!L.data.has_auth){be(r,"您目前没有权限查看讨论列表"),h?await n.push({name:"contest-detail",params:{contestId:h}}):await n.push({name:"discuss-list"});return}if(L.data.list){const $=L.data.list;for(let K=0;K<$.length;K++){const Y=$[K],ae=await Ka(Y);(R=p.value)==null||R.push(ae)}}P.value={...P.value,total:L.data.total_count}}else z&&F(r,L.code)}catch(U){console.error(U),F(r,Ne())}finally{m.value=!1}},j=async I=>{await n.push({query:{...l.query,page:I.current,page_size:I.pageSize}})},M=()=>{_.value=!0},V=async()=>{b.value=!0,console.log("discussCreateForm",f.value),yr(f.value).then(I=>{I.code===0?(be(r,"创建比赛成功"),_.value=!1,n.push({path:"/discuss/"+I.data.id})):F(r,I.code)}).finally(()=>{b.value=!1})};return de(async()=>{o=ze(()=>l.query,I=>{Array.isArray(l.params.contestId)?h=Number(l.params.contestId[0]):h=Number(l.params.contestId),C.value=g,h?C.value=C.value.concat([{title:"问题ID",colKey:"contestProblemIndex",width:"100",cell:(U,T)=>{let L;return T.row.contestProblemIndex?t(G,{variant:"text",onClick:()=>u(h,T.row.contestProblemIndex)},kr(L=nt(T.row.contestProblemIndex))?L:{default:()=>[L]}):""}}]):C.value=C.value.concat([{title:"问题ID",colKey:"problemId",width:"100",cell:(U,T)=>T.row.problemId?t(G,{variant:"text",onClick:()=>v(T.row.problemId)},{default:()=>[T.row.problemId]}):""}]),C.value=C.value.concat(i),k.value.problemId=I.problem_id||"",k.value.title=I.title||"",k.value.username=I.username||"";const z=parseInt(I.page)||P.value.defaultCurrent,R=parseInt(I.page_size)||P.value.defaultPageSize;c=z,y=R,P.value={...P.value,current:c,pageSize:y},w({current:c,pageSize:y},!0)},{immediate:!0})}),Le(()=>{o&&o()}),(I,z)=>{const R=Re,U=he,T=xe,L=Ue,$=Ae,K=G,Y=$e,ae=ye,H=Te,O=ot;return D(),ee(re,null,[t(H,null,{default:a(()=>[t(T,{span:9},{default:a(()=>[t(U,{style:{margin:"10px"}},{default:a(()=>[t(R,{data:p.value,columns:C.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:P.value,loading:m.value,"table-layout":"auto",onPageChange:j},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(T,{span:3},{default:a(()=>[A("div",wr,[t(U,{class:"sh-card"},{default:a(()=>[t(Y,{model:k.value},{default:a(()=>[t($,{label:"问题ID"},{default:a(()=>[t(L,{modelValue:k.value.problemId,"onUpdate:modelValue":z[0]||(z[0]=N=>k.value.problemId=N),placeholder:"请输入完整问题ID"},null,8,["modelValue"])]),_:1}),t($,{label:"标题"},{default:a(()=>[t(L,{modelValue:k.value.title,"onUpdate:modelValue":z[1]||(z[1]=N=>k.value.title=N),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t($,{label:"创建人"},{default:a(()=>[t(L,{modelValue:k.value.username,"onUpdate:modelValue":z[2]||(z[2]=N=>k.value.username=N),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t($,null,{default:a(()=>[t(K,{theme:"primary",onClick:x},{default:a(()=>z[6]||(z[6]=[S("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(U,{class:"sh-card"},{default:a(()=>[t(ae,null,{default:a(()=>[t(K,{onClick:M},{default:a(()=>z[7]||(z[7]=[S("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),t(O,{visible:_.value,"onUpdate:visible":z[5]||(z[5]=N=>_.value=N),header:"创建讨论",onConfirm:V,"confirm-loading":b.value},{default:a(()=>[t(Y,{"label-width":80,model:f.value,onSubmit:z[4]||(z[4]=wt(()=>{},["prevent"]))},{default:a(()=>[t($,{label:"标题"},{default:a(()=>[t(L,{modelValue:f.value.title,"onUpdate:modelValue":z[3]||(z[3]=N=>f.value.title=N),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),bt=ue(Cr,[["__scopeId","data-v-a2987da9"]]),Sr={key:0,style:{margin:"20px"}},Ir=["innerHTML"],Pr=["innerHTML"],Tr={style:{margin:"10px"}},xr={style:{margin:"10px"}},Vr={style:{margin:"10px","text-align":"right"}},Dr={style:{margin:"12px"}},Lr={key:0,class:"dida-edit-container"},jr=ie({__name:"DiscussDetail",props:{discussId:{}},setup(e){const l=e;let n=ke();const{globalProperties:r}=pe();let o=null;const _=Ye(),b=qe();let h=d("");const C=d(""),g=d(null),i=d(!1),m=d(null),c=d(!1);let y=1,P=20;const p=d({current:1,total:0,defaultPageSize:P,defaultCurrent:y,pageSizeOptions:[20,50]}),k=d([]),f={},v=He(()=>b.hasAuth(je.ManageDiscuss)),u=V=>{V&&Z.push({name:"discuss-list",query:{...n.query,title:"",tag:V.name}})},s=()=>{Z.push({name:"manage-discuss",params:{discussId:C.value}})},x=()=>t("div",{class:"t-pagination__total"},[`共 ${p.value.total} 条回复`]),w=()=>{},j=async(V,I)=>{var z;c.value=!0;try{const{current:R,pageSize:U}=V,T=await hr(C.value,R,U);if(k.value=[],T.code===0){const L=T.data.list;if(L)for(let $=0;$<L.length;$++){const K=L[$],Y=await _r(K);(z=k.value)==null||z.push(Y),await Ge(()=>{const ae=document.querySelectorAll(".dida-discuss-content");ae&&ae.length>0&&ae.forEach(H=>{me.mathRender(H),me.highlightRender({lineNumber:!0,enable:!0},H),et(H)})})}p.value={...p.value,total:T.data.total_count}}else I&&F(r,T.code)}catch(R){console.error(R),F(r,Ne())}finally{c.value=!1}},M=async V=>{await Z.push({query:{...n.query,page:V.current,page_size:V.pageSize}})};return de(async()=>{if(C.value=l.discussId,C.value||(Array.isArray(n.params.discussId)?C.value=n.params.discussId[0]:C.value=n.params.discussId),!C.value){ve(r,"讨论不存在"),await Z.push({name:"discuss"});return}i.value=!0;const V=await gr(C.value);if(V.code!==0){i.value=!1,F(r,V.code),await Z.push({name:"discuss"});return}V.data.tags&&V.data.tags.forEach(U=>{f[U.id]=U}),m.value=Ka(V.data.discuss),_.setTitle(m.value.title+" - "+_.getTitle);let I=m.value.content;const z={math:{inlineDigit:!0,engine:"KaTeX"}};h.value=await me.md2html(I,z),await Ge(()=>{g.value&&(me.mathRender(g.value),me.highlightRender({lineNumber:!0,enable:!0},g.value),et(g.value)),i.value=!1}),o=ze(()=>n.query,U=>{const T=parseInt(U.page)||p.value.defaultCurrent,L=parseInt(U.page_size)||p.value.defaultPageSize;y=T,P=L,p.value={...p.value,current:y,pageSize:P},j({current:y,pageSize:P},!0)},{immediate:!0});const R={after:()=>{},preview:{math:{inlineDigit:!0,engine:"KaTeX"}}};new me("commentEditRef",R)}),Le(()=>{o&&o()}),(V,I)=>{const z=Ca,R=ka,U=he,T=ye,L=Ll,$=G,K=xe,Y=Xe,ae=Je,H=Te,O=De;return D(),E(O,{loading:i.value},{default:a(()=>[t(H,{class:"dida-main-content"},{default:a(()=>[t(K,{span:8},{default:a(()=>{var N,Ce,Ve;return[(N=m.value)!=null&&N.problemTitle||(Ce=m.value)!=null&&Ce.contestTitle?(D(),ee("div",Sr,[t(R,{"max-item-width":"300"},{default:a(()=>{var J,B,ce,te,ge;return[(J=m.value)!=null&&J.contestTitle?(D(),ee(re,{key:0},[t(z,{to:{name:"contest-detail",params:{contestId:(B=m.value)==null?void 0:B.contestId}}},{default:a(()=>{var Se;return[S(q((Se=m.value)==null?void 0:Se.contestTitle),1)]}),_:1},8,["to"]),(ce=m.value)!=null&&ce.contestProblemIndex?(D(),E(z,{key:0,to:{name:"contest-problem-detail",params:{problemIndex:(te=m.value)==null?void 0:te.contestProblemIndex}}},{default:a(()=>{var Se,le;return[S(q(fe(nt)((Se=m.value)==null?void 0:Se.contestProblemIndex))+" - "+q((le=m.value)==null?void 0:le.problemTitle),1)]}),_:1},8,["to"])):ne("",!0)],64)):(D(),ee(re,{key:1},[t(z,{to:{name:"discuss-list-problem"}},{default:a(()=>I[3]||(I[3]=[S(" 问题讨论")])),_:1}),t(z,{to:{name:"problem-detail",params:{problemId:(ge=m.value)==null?void 0:ge.problemId}}},{default:a(()=>{var Se;return[S(q((Se=m.value)==null?void 0:Se.problemTitle),1)]}),_:1},8,["to"])],64))]}),_:1})])):ne("",!0),t(U,{style:{margin:"10px"},header:(Ve=m.value)==null?void 0:Ve.title,"header-bordered":!0},{default:a(()=>[A("div",{innerHTML:fe(h),class:"dida-discuss-content"},null,8,Ir)]),_:1},8,["header"]),(D(!0),ee(re,null,Ie(k.value,(J,B)=>(D(),E(U,{key:B,style:{margin:"10px"},"header-bordered":""},{header:a(()=>[t(T,null,{default:a(()=>[A("span",null,q(J.authorNickname),1),A("span",null,q(J.insertTime),1)]),_:2},1024)]),default:a(()=>[A("div",{innerHTML:J.content,class:"dida-discuss-content"},null,8,Pr)]),_:2},1024))),128)),A("div",Tr,[t(L,{modelValue:p.value.current,"onUpdate:modelValue":I[0]||(I[0]=J=>p.value.current=J),"page-size":p.value.pageSize,"onUpdate:pageSize":I[1]||(I[1]=J=>p.value.pageSize=J),total:p.value.total,"page-size-options":p.value.pageSizeOptions,"show-page-size":!1,"total-content":x,onChange:M},null,8,["modelValue","page-size","total","page-size-options"])]),A("div",xr,[I[5]||(I[5]=A("div",{id:"commentEditRef",class:"dida-comment-editor"},null,-1)),A("div",Vr,[t(T,null,{default:a(()=>[t($,{theme:"primary",onClick:w},{default:a(()=>I[4]||(I[4]=[S("提交")])),_:1})]),_:1})])])]}),_:1}),t(K,{span:4},{default:a(()=>[A("div",Dr,[v.value?(D(),ee("div",Lr,[t($,{onClick:s},{default:a(()=>I[6]||(I[6]=[S("编辑")])),_:1})])):ne("",!0),t(ae,{layout:"vertical",bordered:!0},{default:a(()=>[t(Y,{label:"创建时间"},{default:a(()=>{var N;return[S(q((N=m.value)==null?void 0:N.insertTime),1)]}),_:1}),t(Y,{label:"编辑时间"},{default:a(()=>{var N;return[S(q((N=m.value)==null?void 0:N.modifyTime),1)]}),_:1}),t(Y,{label:"更新时间"},{default:a(()=>{var N;return[S(q((N=m.value)==null?void 0:N.updateTime),1)]}),_:1}),t(Y,{label:"创建用户"},{default:a(()=>[t($,{variant:"text",onClick:I[2]||(I[2]=async()=>{var N;return await fe(Wt)(fe(Z),(N=m.value)==null?void 0:N.authorUsername)})},{default:a(()=>{var N;return[S(q((N=m.value)==null?void 0:N.authorNickname),1)]}),_:1})]),_:1}),t(Y,{label:"标签"},{default:a(()=>[t(T,null,{default:a(()=>{var N;return[(D(!0),ee(re,null,Ie((N=m.value)==null?void 0:N.tags,Ce=>(D(),E($,{key:Ce.id,variant:"dashed",onClick:()=>u(Ce)},{default:a(()=>[S(q(Ce.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),zt=ue(jr,[["__scopeId","data-v-20308f3c"]]);function zr(e,l){return X({url:"/rank/ac/all?page="+e+"&page_size="+l,method:"get"})}function $r(e,l){return X({url:"/rank/ac/problem?page="+e+"&page_size="+l,method:"get"})}function Ar(e,l){return X({url:"/rank/ac/problem/today?page="+e+"&page_size="+l,method:"get"})}function Ur(e,l){return X({url:"/rank/ac/problem/day7?page="+e+"&page_size="+l,method:"get"})}function Rr(e,l){return X({url:"/rank/ac/problem/day30?page="+e+"&page_size="+l,method:"get"})}function Mr(e,l){return X({url:"/rank/ac/problem/year?page="+e+"&page_size="+l,method:"get"})}const Er={style:{margin:"10px"}};function $t(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const qr=ie({__name:"RankUser",props:{type:{}},setup(e){const l=ke(),n=We(),{globalProperties:r}=pe();let o=null;const _=e,b=d(""),h=d(""),C={all:{header:"统计所有用户在本站的提交记录",content:"优先以AC记录数量排序，如果相同则提交所用次数较少的优先，如果仍相同，注册较早的用户靠前"},problem:{header:"统计所有用户在本站的提交记录",content:"以题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-today":{header:"统计所有用户今日在本站的提交记录",content:"以今日题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-day7":{header:"统计所有用户最近7日在本站的提交记录",content:"以7日题目记录数量排序（从7日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-day30":{header:"统计所有用户最近30日在本站的提交记录",content:"以30日题目记录数量排序（从30日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-year":{header:"统计所有用户最近1年在本站的提交记录",content:"以最近1年题目记录数量排序（从365日前的0点开始计算），如果相同，注册较早的用户靠前"}},g=d([]),i=[{title:"序号",colKey:"index"},{title:"用户名",colKey:"username",cell:(j,M)=>t(G,{variant:"dashed",onClick:()=>v(M.row.username)},{default:()=>[M.row.username]})},{title:"昵称",colKey:"nickname"},{title:"Slogan",colKey:"slogan"}],m=[{title:"题目数量",colKey:"problem_count",cell:(j,M)=>{let V=0;return M.row.problem_count&&(V=M.row.problem_count),t(G,{variant:"dashed",onClick:()=>u(M.row.username)},$t(V)?V:{default:()=>[V]})}}],c=[{title:"正确",colKey:"accept",cell:(j,M)=>{let V=0;return M.row.accept&&(V=M.row.accept),t(G,{variant:"dashed",onClick:()=>u(M.row.username)},$t(V)?V:{default:()=>[V]})}},{title:"提交",colKey:"attempt",cell:(j,M)=>{let V=0;return M.row.attempt&&(V=M.row.attempt),t(G,{variant:"dashed",onClick:()=>s(M.row.username)},$t(V)?V:{default:()=>[V]})}}],y=d(!1);let P=1,p=50;const k=d({current:P,pageSize:p,defaultCurrent:P,defaultPageSize:p,total:0,pageSizeOptions:[50]}),f=d(),v=j=>{n.push({name:"user",params:{username:j}})},u=j=>{n.push({name:"judge-list",query:{username:j,status:Fe.Accept}})},s=j=>{n.push({name:"judge-list",query:{username:j}})},x=async(j,M)=>{y.value=!0;try{f.value=[];const{current:V,pageSize:I}=j;let z=null;switch(_.type){case"problem":z=await $r(V,I);break;case"problem-today":z=await Ar(V,I);break;case"problem-day7":z=await Ur(V,I);break;case"problem-day30":z=await Rr(V,I);break;case"problem-year":z=await Mr(V,I);break;default:z=await zr(V,I);break}if(z.code===0){const R=z.data.list;if(!R||R.length<=0){k.value={...k.value,total:0},be(r,"未找到记录");return}f.value=[];const U=k.value.pageSize*(k.value.current-1);let T=1;R.forEach(L=>{var K;const $=L;$.index=U+T++,(K=f.value)==null||K.push($)}),k.value={...k.value,total:z.data.total_count}}else M&&F(r,z.code)}catch(V){console.error(V),F(r,Ne())}finally{y.value=!1}},w=async j=>{await n.push({query:{...l.query,page:j.current,page_size:j.pageSize}})};return de(async()=>{y.value=!0,o=ze(()=>l.query,j=>{switch(_.type&&C[_.type]?(b.value=C[_.type].header,h.value=C[_.type].content):(b.value=C.all.header,h.value=C.all.content),_.type){case"all":g.value=i.concat(c);break;default:g.value=i.concat(m);break}const M=parseInt(j.page)||k.value.defaultCurrent,V=parseInt(j.page_size)||k.value.defaultPageSize;P=M,p=V,k.value={...k.value,current:P,pageSize:p},x({current:P,pageSize:p},!0)},{immediate:!0})}),Le(()=>{o&&o()}),(j,M)=>{const V=Re,I=he,z=xe,R=Te;return D(),E(R,null,{default:a(()=>[t(z,{span:9},{default:a(()=>[t(I,{style:{margin:"10px"}},{default:a(()=>[t(V,{data:f.value,columns:g.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:k.value,loading:y.value,"table-layout":"auto",onPageChange:w},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(z,{span:3},{default:a(()=>[A("div",Er,[t(I,{class:"sh-card",header:b.value,"header-bordered":!0},{default:a(()=>[S(q(h.value),1)]),_:1},8,["header"])])]),_:1})]),_:1})}}}),it=ue(qr,[["__scopeId","data-v-13682529"]]),Kr={style:{display:"flex","align-items":"center"}},Nr={style:{color:"#409eff","margin-right":"20px"}},Fr={class:"dida-login-footer"},Or=ie({__name:"UserForget",setup(e){const{globalProperties:l}=pe(),n=qe(),r=d(!1),o=d(!1),_=d(!1),b=d("发送验证码");let h=null,C=-1;const g=d(!1),i=d(null),m=d(""),c=d({username:"",emailKey:"",password:"",confirmPassword:""}),P=d({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:x=>new Promise(w=>{const j=setTimeout(()=>{w(c.value.password===x),clearTimeout(j)})}),message:"两次密码不一致"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),p=()=>{be(l,"重置成功")},k=async x=>{if(!_.value){r.value=!0,o.value=!0;try{const w=await Wn(x,c.value.username);w.code===0?(be(l,"验证码发送成功"),m.value=w.data,o.value=!1,_.value=!0,h=new Date,b.value="60秒后重发",C=setInterval(()=>{const M=Math.floor((new Date().getTime()-(h==null?void 0:h.getTime()))/1e3);M>60?(b.value="发送验证码",_.value=!1,clearInterval(C)):b.value=`${60-M}秒后重发`},1e3)):F(l,w.code)}catch(w){console.error("Send email key error",w),ve(l,"发送验证码失败")}finally{r.value=!1}}},f=async()=>{var M;if(g.value=!0,_.value||o.value)return;await Ge();const x=document.getElementById("cf-confirm-div");x&&x.remove();const w=document.createElement("div");w.id="cf-confirm-div",w.setAttribute("data-theme","light"),(M=i.value)==null||M.appendChild(w);const j=window;j.turnstile.ready(function(){j.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(V){g.value=!1,await k(V)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},v=d(()=>t(G,{onClick:f,disabled:_.value,loading:o.value,style:"width:120px"},{default:()=>[b.value]})),u=async()=>{r.value=!0;try{const x=await Jn(c.value.username,c.value.password,c.value.emailKey);x.code===0?(be(l,"密码修改成功"),l.$router.push({name:"login"})):F(l,x.code)}catch(x){console.error("Modify password error",x),ve(l,"修改密码失败")}finally{r.value=!1}},s=async({validateResult:x,firstError:w,e:j})=>{if(!r.value){if(j.preventDefault(),x!==!0){ve(l,w);return}m.value?await u():await f()}};return de(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),Le(()=>{}),(x,w)=>{const j=Tt,M=Ue,V=Ae,I=ya,z=G,R=$e,U=st,T=he,L=ot;return D(),ee(re,null,[t(T,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(j,{"max-line":1},{default:a(()=>w[6]||(w[6]=[A("span",null,"如果您未绑定邮箱或忘记用户名，可联系管理员寻求帮助",-1),A("span",null,"管理员邮箱：BoilTask@qq.com",-1)])),_:1}),t(R,{ref:"form",rules:P.value,data:c.value,colon:!0,onReset:p,onSubmit:s,class:"yj-login-form"},{default:a(()=>[t(V,{name:"username",label:"用户名"},{default:a(()=>[t(M,{modelValue:c.value.username,"onUpdate:modelValue":w[0]||(w[0]=$=>c.value.username=$),clearable:"",placeholder:"请输入完整用户名"},null,8,["modelValue"])]),_:1}),m.value?(D(),ee(re,{key:0},[t(V,{name:"email",label:"发送邮箱"},{default:a(()=>[t(I,{append:v.value},{default:a(()=>[A("div",Kr,[A("span",Nr,q(m.value),1)])]),_:1},8,["append"])]),_:1}),t(V,{name:"emailKey",label:"验证码"},{default:a(()=>[t(M,{modelValue:c.value.emailKey,"onUpdate:modelValue":w[1]||(w[1]=$=>c.value.emailKey=$),clearable:"",placeholder:"请输入收到的验证码"},null,8,["modelValue"])]),_:1}),t(V,{name:"password",label:"新密码"},{default:a(()=>[t(M,{modelValue:c.value.password,"onUpdate:modelValue":w[2]||(w[2]=$=>c.value.password=$),type:"password",clearable:"",placeholder:"新密码"},null,8,["modelValue"])]),_:1}),t(V,{name:"confirmPassword",label:"确认密码"},{default:a(()=>[t(M,{modelValue:c.value.confirmPassword,"onUpdate:modelValue":w[3]||(w[3]=$=>c.value.confirmPassword=$),type:"password",clearable:"",placeholder:"请重复输入密码"},null,8,["modelValue"])]),_:1})],64)):ne("",!0),m.value?(D(),E(V,{key:1},{default:a(()=>[t(z,{theme:"primary",type:"submit",block:"",loading:r.value},{default:a(()=>w[7]||(w[7]=[S("修改密码")])),_:1},8,["loading"])]),_:1})):(D(),E(V,{key:2},{default:a(()=>[t(z,{theme:"primary",type:"submit",block:"",loading:r.value},{default:a(()=>w[8]||(w[8]=[S("重置密码")])),_:1},8,["loading"])]),_:1}))]),_:1},8,["rules","data"]),A("div",Fr,[t(U,{onClick:w[4]||(w[4]=()=>{fe(l).$router.push({name:"login"})})},{default:a(()=>w[9]||(w[9]=[S("返回登陆 ")])),_:1})])]),_:1}),t(L,{visible:g.value,"onUpdate:visible":w[5]||(w[5]=$=>g.value=$),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:a(()=>[A("div",{ref_key:"dialogContainer",ref:i,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),Gr=ue(Or,[["__scopeId","data-v-d3cb1db8"]]),Hr={class:"judger-status-panel"},Br={class:"judger-status-panel"};function Wr(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const Jr=ie({__name:"SystemStatus",setup(e){const{globalProperties:l}=pe(),n=d([]),r=d([]),o=d(!1);let _;const b=g=>{let i="失效",m="danger";const c=new Date,y=new Date(g.updateTime);return c.getTime()-y.getTime()>3e4?(i="离线",m="default"):g.cpuUsage>90?(i="CPU过高",m="warning"):g.memPercent>90?(i="内存过高",m="warning"):(i="在线",m="success"),t(ye,null,{default:()=>[t("span",null,[g.key,S(" - "),g.name]),t("span",null,[g.updateTime]),t(lt,{theme:m,size:"small"},Wr(i)?i:{default:()=>[i]})]})},h=async()=>{const g={};for(let v=0;v<n.value.length;v++){const u=n.value[v];g[u.key]={...u}}const i={};for(let v=0;v<r.value.length;v++){const u=r.value[v];i[u.key]={...u}}const m=[],c=[],y=await Yl();if(y.code!==0){F(l,y.code);return}const P=y.data.web,p={key:"didaoj"};P.name?p.name=P.name:p.name="-",P.update_time?p.updateTime=new Date(P.update_time).toLocaleString():p.updateTime="-",P.cpu_usage?p.cpuUsage=Number(P.cpu_usage):p.cpuUsage=0,P.mem_usage?p.memUsage=P.mem_usage/(1024*1024*1024):p.memUsage=0,P.mem_total?p.memTotal=P.mem_total/(1024*1024*1024):p.memTotal=0,p.memTotal>0?p.memPercent=Math.round(p.memUsage/p.memTotal*1e4)/100:p.memPercent=0,p.avgMessage=P.avg_message;const k=g[p.key];k?(p.cpuUsageFrom=k.cpuUsage,p.memPercentFrom=k.memPercent,p.memUsageFrom=k.memUsage,p.memTotalFrom=k.memTotal):(p.cpuUsageFrom=0,p.memPercentFrom=0,p.memUsageFrom=0,p.memTotalFrom=0),m.push(p),n.value=m;const f=y.data.judger;for(let v=0;v<f.length;v++){const u=f[v],s={key:u.key,name:u.name};u.name?s.name=u.name:s.name="-",u.update_time?s.updateTime=new Date(u.update_time).toLocaleString():s.updateTime="-",u.cpu_usage?s.cpuUsage=Number(u.cpu_usage):s.cpuUsage=0,u.mem_usage?s.memUsage=u.mem_usage/(1024*1024*1024):s.memUsage=0,u.mem_total?s.memTotal=u.mem_total/(1024*1024*1024):s.memTotal=0,s.memTotal>0?s.memPercent=Math.round(s.memUsage/s.memTotal*1e4)/100:s.memPercent=0,s.avgMessage=u.avg_message,i[u.key]?(s.cpuUsageFrom=i[u.key].cpuUsage,s.memPercentFrom=i[u.key].memPercent,s.memUsageFrom=i[u.key].memUsage,s.memTotalFrom=i[u.key].memTotal):(s.cpuUsageFrom=0,s.memPercentFrom=0,s.memUsageFrom=0,s.memTotalFrom=0),c.push(s)}r.value=c},C=async()=>{await h(),o.value=!1};return de(async()=>{r.value=[],n.value=[],o.value=!0,await C(),_=setInterval(()=>{C()},5e3)}),Le(()=>{clearInterval(_)}),(g,i)=>{const m=jl,c=ye,y=he,P=De;return D(),E(P,{loading:o.value},{default:a(()=>[t(y,{title:"接口状态",class:"judger-status"},{default:a(()=>[A("div",Hr,[(D(!0),ee(re,null,Ie(n.value,p=>(D(),E(y,{key:p.key,header:()=>b(p),class:"judge-status-judger"},{footer:a(()=>[A("span",null," 负载信息："+q(p.avgMessage),1)]),default:a(()=>[t(c,{class:"judge-status-judger"},{default:a(()=>[t(m,{title:"CPU使用率",value:p.cpuUsage,animation:{valueFrom:p.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(m,{title:"内存使用率",value:p.memPercent,animation:{valueFrom:p.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(m,{title:"内存使用量",animation:{valueFrom:p.memUsageFrom,duration:2e3},"animation-start":!0,value:p.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(m,{title:"内存总量",value:p.memTotal,animation:{valueFrom:p.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1}),t(y,{title:"判题机状态",class:"judger-status"},{default:a(()=>[A("div",Br,[(D(!0),ee(re,null,Ie(r.value,p=>(D(),E(y,{key:p.key,header:()=>b(p),class:"judge-status-judger"},{footer:a(()=>[A("span",null," 负载信息："+q(p.avgMessage),1)]),default:a(()=>[t(c,{class:"judge-status-judger"},{default:a(()=>[t(m,{title:"CPU使用率",value:p.cpuUsage,animation:{valueFrom:p.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(m,{title:"内存使用率",value:p.memPercent,animation:{valueFrom:p.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(m,{title:"内存使用量",animation:{valueFrom:p.memUsageFrom,duration:2e3},"animation-start":!0,value:p.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(m,{title:"内存总量",value:p.memTotal,animation:{valueFrom:p.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1})]),_:1},8,["loading"])}}}),Xr=ue(Jr,[["__scopeId","data-v-d2b0a05b"]]),Yr=ie({__name:"ManageJudge",setup(e){const{globalProperties:l}=pe(),n=d(!1),r=d(!1),o=d({problemId:"",language:void 0,status:void 0}),_=d(!1),b=d([]);b.value=Ot();const h=d([]);h.value=Da();const C=async()=>{n.value=!0;try{const m=await pn();if(m.code!==0){F(l,m.code);return}be(l,"重判成功"),await Z.push({name:"judge-list"})}catch(m){console.error(m),F(l,"重判失败")}finally{n.value=!1}},g=async()=>{if(!o.value.problemId&&!o.value.language&&!o.value.status){F(l,"请输入问题Id");return}_.value=!0;try{const m=await fn(o.value.problemId,o.value.language,o.value.status);if(m.code!==0){F(l,m.code);return}be(l,"重判成功"),await Z.push({name:"judge-list",query:{problem_id:o.value.problemId,language:o.value.language}})}catch(m){console.error(m),F(l,"重判失败")}finally{_.value=!1}},i=async()=>{r.value=!0;try{const m=await vn();if(m.code!==0){F(l,m.code);return}be(l,"重判成功"),await Z.push({name:"judge-list"})}catch(m){console.error(m),F(l,"重判失败")}finally{r.value=!1}};return(m,c)=>{const y=G,P=he,p=Ue,k=Ae,f=Kt,v=pt,u=ye,s=$e;return D(),ee(re,null,[t(P,{class:"yj-manage-card",title:"重判最近提交"},{default:a(()=>[t(y,{onClick:C,loading:n.value},{default:a(()=>c[3]||(c[3]=[S("重判")])),_:1},8,["loading"])]),_:1}),t(P,{class:"yj-manage-card",title:"重判指定记录"},{default:a(()=>[t(s,{layout:"inline",onSubmit:g},{default:a(()=>[t(k,{label:"题号"},{default:a(()=>[t(p,{modelValue:o.value.problemId,"onUpdate:modelValue":c[0]||(c[0]=x=>o.value.problemId=x),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(k,{label:"语言"},{default:a(()=>[t(v,{modelValue:o.value.language,"onUpdate:modelValue":c[1]||(c[1]=x=>o.value.language=x),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:a(()=>[(D(!0),ee(re,null,Ie(b.value,x=>(D(),E(f,{key:x.value,value:x.value,label:x.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(k,{label:"状态"},{default:a(()=>[t(v,{modelValue:o.value.status,"onUpdate:modelValue":c[2]||(c[2]=x=>o.value.status=x),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:a(()=>[(D(!0),ee(re,null,Ie(h.value,x=>(D(),E(f,{key:x.value,value:x.value,label:x.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(k,null,{default:a(()=>[t(u,null,{default:a(()=>[t(y,{theme:"primary",type:"submit",loading:_.value},{default:a(()=>c[4]||(c[4]=[S("重判")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(P,{class:"yj-manage-card",title:"重判所有"},{default:a(()=>[t(y,{onClick:i,theme:"danger",loading:r.value},{default:a(()=>c[5]||(c[5]=[S("重判")])),_:1},8,["loading"])]),_:1})],64)}}}),Zr=ue(Yr,[["__scopeId","data-v-6d48cbf2"]]),Qr=ie({__name:"ManageWeb",setup(e){const{globalProperties:l}=pe(),n=d({theme:"",content:""}),r=d({title:"",content:""}),o=d(!1),_=d(!1),b=d(!1);let h=null;const C=async()=>{_.value=!0;try{const c=await Ql(n.value.theme,n.value.content);if(c.code!==0){F(l,c.code);return}be(l,"保存成功")}catch(c){console.error(c),F(l,"保存失败")}finally{_.value=!1}},g=async()=>{b.value=!0;try{if(!h){F(l,"编辑器未初始化");return}const c=h.getValue(),y=await en(r.value.title,c);if(y.code!==0){F(l,y.code);return}h.setValue(y.data.content),be(l,"保存成功")}catch(c){console.error(c),ve(l,"保存失败")}finally{b.value=!1}},i=async()=>{n.value=await Pa()},m=async()=>{try{r.value=await Ta()}catch{ve(l,"加载公告失败"),r.value={title:"",content:""}}const c={after:()=>{h==null||h.setValue(r.value.content)},upload:{accept:"image/*,.mp3, .wav, .rar",filename(y){return y.replace(/[^(a-zA-Z0-9\u4e00-\u9fa5\.)]/g,"").replace(/[\?\\/:|<>\*\[\]\(\)\$%\{\}@~]/g,"").replace("/\\s/g","")},async handler(y){return Pt(h,y,l,Zl)}},preview:{math:{inlineDigit:!0,engine:"KaTeX"}}};h=new me("problemEditDiv",c)};return de(async()=>{o.value=!0;try{await i(),await m()}catch{ve(l,"加载数据失败")}o.value=!1}),(c,y)=>{const P=pt,p=Ae,k=Ue,f=G,v=ye,u=$e,s=he,x=De;return D(),E(x,{loading:o.value},{default:a(()=>[t(s,{class:"yj-manage-card",title:"站点通知"},{default:a(()=>[t(u,{onSubmit:C},{default:a(()=>[t(p,{label:"主题"},{default:a(()=>[t(P,{modelValue:n.value.theme,"onUpdate:modelValue":y[0]||(y[0]=w=>n.value.theme=w),options:[{label:"success",value:"success"},{label:"info",value:"info"},{label:"warning",value:"warning"},{label:"error",value:"error"}],placeholder:"请选择主题"},null,8,["modelValue"])]),_:1}),t(p,{label:"内容"},{default:a(()=>[t(k,{modelValue:n.value.content,"onUpdate:modelValue":y[1]||(y[1]=w=>n.value.content=w),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),t(p,null,{default:a(()=>[t(v,null,{default:a(()=>[t(f,{theme:"primary",type:"submit",loading:_.value},{default:a(()=>y[3]||(y[3]=[S("保存")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(s,{class:"yj-manage-card",title:"首页公告"},{actions:a(()=>[t(f,{theme:"primary",loading:b.value,onClick:g},{default:a(()=>y[4]||(y[4]=[S("保存")])),_:1},8,["loading"])]),default:a(()=>[t(u,{onSubmit:g},{default:a(()=>[t(p,{label:"标题"},{default:a(()=>[t(k,{modelValue:r.value.title,"onUpdate:modelValue":y[2]||(y[2]=w=>r.value.title=w),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1}),y[5]||(y[5]=A("div",{id:"problemEditDiv",class:"dida-description-editor"},null,-1))]),_:1})]),_:1},8,["loading"])}}}),ei=ue(Qr,[["__scopeId","data-v-2a390b78"]]),Na=[{name:"problem-list",tab:"problem",sidebar:"problem-list",path:"",title:"问题列表",icon:"list",component:_o},{name:"problem-detail",tab:"problem",sidebar:"problem-list",path:":problemId+",title:"问题详情",icon:"list",component:jt},{name:"problem-daily-list",tab:"problem",sidebar:"problem-daily-list",path:"daily",title:"每日一题",icon:"list",component:Xo},{name:"problem-daily-detail",tab:"problem",sidebar:"problem-daily-list",path:"daily/:dailyId+",title:"问题详情",icon:"list",component:jt},{name:"problem-recommend",tab:"problem",sidebar:"problem-recommend",path:"recommend/:problemId*",title:"问题推荐",icon:"cpu",needLogin:!0,component:ns},{name:"problem-collection-list",tab:"problem",sidebar:"problem-collection-list",path:"collection",title:"题目集合",icon:"list",disableTabPath:!0,component:Is},{name:"collection-detail",tab:"collection-detail-tab",sidebar:"collection-detail",path:":collectionId+",title:"题集详情",icon:"cpu",component:Ls},{name:"collection-rank",tab:"collection-detail-tab",sidebar:"collection-rank",path:":collectionId+/rank",title:"题集排名",icon:"list",component:js},{name:"collection-edit",tab:"collection-detail-tab",sidebar:"collection-edit",disableSidebar:!0,needLogin:!0,path:":collectionId+/edit",title:"题集编辑",icon:"list",component:sa},{name:"collection-create",tab:"collection-detail-tab",sidebar:"collection-create",needLogin:!0,disableSidebar:!0,path:"create",title:"新建题集",icon:"list",component:sa},{name:"judge-list",tab:"judge",sidebar:"judge-list",path:"",title:"评测列表",icon:"list",component:ia},{name:"judge-detail",tab:"judge",sidebar:"judge-list",path:":judgeId+",title:"评测详情",icon:"cpu",component:ca},{name:"contest-list",tab:"contest",sidebar:"contest-list",path:"",title:"比赛列表",icon:"list",component:da},{name:"contest-recent",tab:"contest",sidebar:"contest-recent",path:"recent",title:"近期比赛",icon:"list",component:da},{name:"contest-create",tab:"contest",sidebar:"contest-create",disableSidebar:!0,needLogin:!0,path:"create",title:"新建比赛",icon:"list",component:pa},{name:"contest-edit",tab:"contest-detail-tab",sidebar:"contest-edit",disableSidebar:!0,needLogin:!0,path:":contestId+/edit",title:"比赛编辑",icon:"list",component:pa},{name:"contest-detail",tab:"contest-detail-tab",sidebar:"contest-detail",path:":contestId+",title:"比赛详情",icon:"cpu",component:or},{name:"contest-problem-detail",tab:"contest-detail-tab",sidebar:"contest-problem-detail",path:":contestId+/problem/:problemIndex+",title:"问题详情",icon:"cpu",disableSidebar:!0,component:jt},{name:"contest-judge",tab:"contest-detail-tab",sidebar:"contest-judge",path:":contestId+/judge",title:"评测列表",icon:"list",component:ia},{name:"contest-judge-detail",tab:"contest-detail-tab",sidebar:"contest-judge-detail",path:":contestId+/judge/:judgeId+",title:"评测详情",icon:"cpu",component:ca,disableSidebar:!0},{name:"contest-rank",tab:"contest-detail-tab",sidebar:"contest-rank",path:":contestId+/rank",title:"比赛排名",icon:"list",component:dr},{name:"contest-discuss",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss",title:"比赛讨论",icon:"list",component:bt},{name:"contest-discuss-detail",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss/:discussId+",title:"讨论详情",icon:"list",component:zt},{name:"discuss-list",tab:"discuss",sidebar:"discuss-list",path:"",title:"讨论列表",icon:"list",component:bt},{name:"discuss-list-problem",tab:"discuss",sidebar:"discuss-list-problem",path:"problem",title:"问题讨论",icon:"list",component:bt},{name:"discuss-list-judge",tab:"discuss",sidebar:"discuss-list-judge",path:"judge",title:"评测讨论",icon:"list",component:bt},{name:"discuss-detail",tab:"discuss",sidebar:"discuss-list",path:":discussId+",title:"讨论详情",icon:"list",component:zt},{name:"rank-ac-all",tab:"rank",sidebar:"rank-ac-all",path:"ac",title:"AC排名",icon:"base-station",props:{type:"all"},component:it},{name:"rank-ac-problem",tab:"rank",sidebar:"rank-ac-problem",path:"ac/problem",title:"题量排名",icon:"base-station",props:{type:"problem"},component:it},{name:"rank-ac-problem-today",tab:"rank",sidebar:"rank-ac-problem-today",path:"ac/problem/today",title:"今日题量",icon:"base-station",props:{type:"problem-today"},component:it},{name:"rank-ac-problem-day7",tab:"rank",sidebar:"rank-ac-problem-day7",path:"ac/problem/day7",title:"7日题量",icon:"base-station",props:{type:"problem-day7"},component:it},{name:"rank-ac-problem-day30",tab:"rank",sidebar:"rank-ac-problem-day30",path:"ac/problem/day30",title:"30日题量",icon:"base-station",props:{type:"problem-day30"},component:it},{name:"rank-ac-problem-year",tab:"rank",sidebar:"rank-ac-problem-year",path:"ac/problem/year",title:"1年题量",icon:"base-station",props:{type:"problem-year"},component:it},{name:"system-status",tab:"system",sidebar:"system-status",path:"",title:"运行状态",icon:"base-station",component:Xr},{name:"system-about",tab:"system",sidebar:"system-about",path:"about",title:"关于",icon:"base-station",props:{discussId:"52"},component:zt},{name:"manage-problem-create",tab:"manage",sidebar:"manage-problem-create",disableSidebar:!0,path:"problem",title:"新建问题",icon:"list",component:oa,auths:[je.ManageProblem]},{name:"manage-problem",tab:"manage",sidebar:"manage-problem",disableSidebar:!0,path:"problem/:problemId+",title:"问题编辑",icon:"list",component:oa,auths:[je.ManageProblem]},{name:"manage-problem-daily-create",tab:"manage",sidebar:"manage-problem-daily-create",disableSidebar:!0,path:"problem/daily",title:"新建每日一题",icon:"list",component:na,auths:[je.ManageProblemDaily]},{name:"manage-problem-daily",tab:"manage",sidebar:"manage-problem-daily",disableSidebar:!0,path:"problem/daily/:dailyId+",title:"编辑每日一题",icon:"list",component:na,auths:[je.ManageProblemDaily]},{name:"manage-problem-judge",tab:"manage",sidebar:"manage-problem-judge",disableSidebar:!0,path:"problem/:problemId+/judge",title:"评测数据",icon:"list",component:fs,auths:[je.ManageProblem]},{name:"manage-web",tab:"manage",path:"web",sidebar:"manage-web",title:"站点管理",icon:"list",auths:[je.ManageWeb],component:ei},{name:"manage-judge",tab:"manage",path:"judge",sidebar:"manage-judge",title:"评测管理",icon:"list",auths:["i-manage-judge"],component:Zr},{name:"login-forget",tab:"login",path:"forget",title:"忘记密码",component:Gr}],fa=(e,l,n,r)=>{r.tab==n&&(r.disableSidebar&&l!=r.sidebar||r.sidebar==null||r.sidebar!=r.name||e.push({name:r.name,title:r.title,icon:r.icon,to:{name:r.name}}))},ti=(e,l)=>{const n=[];return Na.forEach(r=>{if(Ra(r)){const o=[];r.children.forEach(_=>{fa(o,e,l,_)}),o.length>0&&n.push({title:r.title,children:o})}else fa(n,e,l,r)}),n},va=(e,l)=>{const n=ro(l.tab),r={name:l.name,path:"/"+l.path,meta:{title:l.title+" - "+n.title,tab:l.tab,sidebar:l.sidebar,showSidebar:n.showSidebar,needLogin:n.needLogin||l.needLogin,tabAuths:n.auths,auths:l.auths},props:l.props,component:l.component};!n.disablePath&&!l.disableTabPath&&(r.path=n.path+r.path),e.push(r)},ai=e=>{Na.forEach(l=>{Ra(l)?l.children.forEach(n=>{va(e,n)}):va(e,l)})},li={class:"sh-main"},ni=ie({__name:"View403",setup(e){let l=ke();const n=d("");return de(()=>{l.query.target?n.value=l.query.target:n.value=l.fullPath}),(r,o)=>{const _=G;return D(),ee("div",li,[A("p",null,q(n.value),1),o[2]||(o[2]=A("p",null,"该页面无访问权限，请更换访问目标或重新登陆后再试",-1)),t(_,{theme:"primary",onClick:o[0]||(o[0]=()=>r.$router.push("/"))},{default:a(()=>o[1]||(o[1]=[S("返回首页")])),_:1})])}}}),Fa=ue(ni,[["__scopeId","data-v-777362b3"]]),_t=[];uo(_t);ai(_t);_t.push({path:"/403",name:"403",component:Fa});_t.push({path:"/:pathMatch(.*)*",name:"404",component:Ua});const Z=ul({history:cl("/"),routes:_t});Z.beforeEach((e,l,n)=>{if(e.name==null||!Z.hasRoute(e.name)){n({name:"home"});return}const r=e.matched[e.matched.length-1].meta;if(r.redirect){n({name:r.redirect});return}if(r.needLogin){const _=qe();if(_.getToken==null||_.getToken==""){n({name:"login",query:{redirect_uri:e.fullPath}});return}}const o=r.tabAuths;if(o&&!qe().hasAllAuths(o)){n({name:"403",query:{target:e.fullPath}});return}n()});Z.afterEach((e,l)=>{if(e.name===l.name)return;const n=Vt(),r=Ye();let o=null;if(e.matched.length>0&&(o=e.matched[e.matched.length-1].meta),o!=null&&o.title&&r.setTitle(o==null?void 0:o.title),o!=null&&o.showSidebar){n.setSidebarShow(!0);const _=ti(o==null?void 0:o.sidebar,o==null?void 0:o.tab);n.setMenuList(_),n.setMenuActiveName(o==null?void 0:o.sidebar)}else n.setSidebarShow(!1);window.scrollTo(0,0)});const Oa=mt("login",{state:()=>({Loaded:!1}),getters:{isLoaded(){return this.Loaded}}}),oi=ie({__name:"HeaderContent",setup(e){const l=Oa(),n=qe(),{globalProperties:r}=pe(),o=d(l.isLoaded),_=d(!1),b=d(n.getUsername),h=d(n.getNickname),C=d(),g=()=>{C.value=io(n)};l.$subscribe((c,y)=>{o.value=y.Loaded}),n.$subscribe((c,y)=>{b.value=y.username,h.value=y.nickname,_.value=y.token!="",g()});const i=()=>{r.$router.currentRoute.value.name!=="login"&&r.$router.push({name:"login",query:{redirect_uri:r.$router.currentRoute.value.fullPath}})},m=()=>{n.clear(),r.$message.success({duration:3e3,content:"注销成功"}),r.$router.push({path:"/login",query:{redirect_uri:r.$router.currentRoute.value.fullPath}})};return de(()=>{g()}),(c,y)=>{const P=ha("router-link"),p=Ia,k=Sa,f=zl,v=$l;return D(),E(v,{modelValue:c.$route.meta.tab,"onUpdate:modelValue":y[0]||(y[0]=u=>c.$route.meta.tab=u),class:"sh-menu","expand-type":"popup"},{logo:a(()=>[t(P,{to:"/",class:"sh-logo"},{default:a(()=>y[1]||(y[1]=[S("DidaOJ")])),_:1})]),operations:a(()=>[o.value&&_.value?(D(),E(f,{key:0,title:h.value},{icon:a(()=>[t(p,{name:"user"})]),default:a(()=>[t(k,{value:"user",to:{path:"/user/"+b.value}},{default:a(()=>y[2]||(y[2]=[S("个人空间")])),_:1},8,["to"]),t(k,{value:"user_logout",onClick:m},{default:a(()=>y[3]||(y[3]=[S(" 注销")])),_:1})]),_:1},8,["title"])):o.value?(D(),E(k,{key:2,value:"login",onClick:i},{icon:a(()=>[t(p,{name:"login"})]),default:a(()=>[y[5]||(y[5]=S(" 登录 "))]),_:1})):(D(),E(k,{key:1,value:"login"},{icon:a(()=>[t(p,{name:"login"})]),default:a(()=>[y[4]||(y[4]=S(" ... "))]),_:1}))]),default:a(()=>[(D(!0),ee(re,null,Ie(C.value,u=>(D(),E(k,{key:u.name,value:u.name,to:{name:u.name}},{icon:a(()=>[u.icon?(D(),E(p,{key:0,name:u.icon},null,8,["name"])):ne("",!0)]),default:a(()=>[S(" "+q(u.title),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])}}}),si=ue(oi,[["__scopeId","data-v-95e7494b"]]),ri={id:"menu-container"},ii=ie({__name:"SidebarContent",setup(e){const l=Vt(),n=d(!1),r=d(null),o=d(l.menuActiveName),_=d(l.menuList),b=d([]),h=d(!1),C=()=>{o.value=l.menuActiveName;const i=JSON.stringify(_.value),m=JSON.stringify(l.menuList);i!==m&&(b.value.push([...l.menuList]),g())},g=async()=>{if(b.value.length>0&&!h.value){for(h.value=!0;b.value.length>1;)b.value.shift();const i=b.value.shift();n.value=i.length<=0,_.value=[],await Ge(),r.value&&r.value.updateActiveName(),await new Promise(c=>setTimeout(c,300)),_.value=i,await Ge(),r.value&&r.value.updateActiveName();const m=300;await new Promise(c=>setTimeout(c,m)),h.value=!1,await g()}};return l.$subscribe((i,m)=>{C()}),de(()=>{C()}),(i,m)=>{const c=Ia,y=Sa,P=Ul,p=Al,k=De;return D(),ee(re,null,[A("div",ri,[t(p,{modelValue:o.value,"onUpdate:modelValue":m[0]||(m[0]=f=>o.value=f),theme:"light",class:"sh-menu-container"},{default:a(()=>[t(dl,{name:"move-left"},{default:a(()=>[(D(!0),ee(re,null,Ie(_.value,(f,v)=>(D(),ee(re,{key:v},[fe(co)(f)?(D(),E(P,{key:0,title:f.title},{default:a(()=>[(D(!0),ee(re,null,Ie(f.children,(u,s)=>(D(),E(y,{key:u.name,value:u.name,to:u.to},Zt({default:a(()=>[S(" "+q(u.title),1)]),_:2},[u.icon?{name:"icon",fn:a(()=>[t(c,{name:u.icon,class:Rt(u.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))),128))]),_:2},1032,["title"])):(D(),E(y,{key:f.name,value:f.name,to:f.to},Zt({default:a(()=>[S(" "+q(f.title),1)]),_:2},[f.icon?{name:"icon",fn:a(()=>[t(c,{name:f.icon,class:Rt(f.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),t(k,{size:"small",loading:n.value,"show-overlay":!0,attach:"#menu-container",class:"sh-sidebar-loading",style:{"align-items":"flex-start","padding-top":"100px"}},null,8,["loading"])],64)}}}),ui=ue(ii,[["__scopeId","data-v-96e2d89f"]]),ci={};function di(e,l){return null}const mi=ue(ci,[["render",di]]),pi={class:"footer"},fi={class:"footer-left"},vi={class:"foot-time"},_i={class:"footer-center"},gi={href:"https://beiancx.miit.gov.cn/",target:"_blank"},bi={class:"footer-right"},hi={class:"foot-text"},yi={href:"https://github.com/hpu-developer/DiDaOJ-web",target:"_blank"},wi={class:"foot-text"},ki={href:"https://github.com/hpu-developer/DiDaOJ-go",target:"_blank"},Ci=ie({__name:"FooterContent",setup(e){const l=d("");function n(){l.value=new Date().toLocaleString()}return de(()=>{n(),setInterval(()=>{n()},1e3)}),(r,o)=>{const _=G;return D(),ee("div",pi,[A("div",fi,[A("p",vi,q(l.value),1)]),A("div",_i,[A("a",gi,[t(_,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>o[0]||(o[0]=[S("豫ICP备15024677号-4")])),_:1})])]),A("div",bi,[A("p",hi,[A("a",yi,[t(_,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>o[1]||(o[1]=[S("@didaoj-web")])),_:1})])]),A("p",wi,[A("a",ki,[t(_,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>o[2]||(o[2]=[S("@didaoj-go")])),_:1})])])])])}}}),Si=ue(Ci,[["__scopeId","data-v-44f2e4e7"]]),ht=20,At=100,Ut=50,Ii=ie({__name:"ForceHiddenSidebarButton",setup(e){let l=Vt();const n=d({x:window.innerWidth-At-ht,y:window.innerHeight-Ut-ht}),r=d(window.innerWidth),o=d(window.innerHeight);let _=!1,b={x:0,y:0};const h=f=>{_=!0;const v=f.clientX??f.touches[0].clientX,u=f.clientY??f.touches[0].clientY;b={x:v-n.value.x,y:u-n.value.y},document.addEventListener("mousemove",C),document.addEventListener("touchmove",C),document.addEventListener("mouseup",g),document.addEventListener("touchend",g)},C=f=>{if(!_)return;const v=f.clientX??f.touches[0].clientX,u=f.clientY??f.touches[0].clientY;let s=v-b.x,x=u-b.y;s=Math.max(0,Math.min(s,r.value-At)),x=Math.max(0,Math.min(x,o.value-Ut)),n.value={x:s,y:x}},g=()=>{_=!1,document.removeEventListener("mousemove",C),document.removeEventListener("touchmove",C),document.removeEventListener("mouseup",g),document.removeEventListener("touchend",g)},i=()=>{r.value=window.innerWidth,o.value=window.innerHeight,n.value={x:Math.min(n.value.x,r.value-At-ht),y:Math.min(n.value.y,o.value-Ut-ht)}};let m=d(l.forceHiddenSidebar),c=d(l.forceHiddenSidebar);const y=()=>{m.value=!m.value,l.setForceHiddenSidebar(m.value)},P=()=>{c.value||(c.value=!0,l.setForceHiddenSidebar(m.value))},p=()=>{c.value&&(c.value=!1,l.setForceHiddenSidebar(!1))},k=f=>{f>=800?p():P()};return k(r.value),ze(r,f=>{k(f)}),de(()=>{window.addEventListener("resize",i)}),Le(()=>{window.removeEventListener("resize",i)}),(f,v)=>{const u=G;return fe(c)?(D(),E(u,{key:0,class:"draggable-button",style:ga({top:`${n.value.y}px`,left:`${n.value.x}px`}),onMousedown:h,onTouchstart:h,variant:"dashed",theme:"primary",onClick:y},{default:a(()=>[S(q(fe(m)?"显示":"隐藏"),1)]),_:1},8,["style"])):ne("",!0)}}}),Pi=ue(Ii,[["__scopeId","data-v-1aee5506"]]),yt="DidaOJ",Ti=ie({__name:"App",setup(e){const{globalProperties:l}=pe(),n=Oa(),r=qe(),o=Ye(),_=Vt();n.$patch({Loaded:!1});const b=r.getToken,h=d(!1),C=d(!1);o.title&&o.title.length>0?document.title=o.title+" - "+yt:document.title=yt,o.$subscribe((c,y)=>{y.title&&y.title.length>0?document.title=y.title+" - "+yt:document.title=yt}),_.$subscribe((c,y)=>{h.value=y.showSidebar,C.value=h.value&&!y.forceHiddenSidebar});const g=ke(),i=He(()=>{const c=g.meta.auths;return c?!r.hasAllAuths(c):!1});function m(){l.$message.warning({duration:3e3,content:"登陆状态失效"}),n.$patch({Loaded:!0}),r.clear()}return de(()=>{document.addEventListener("DOMContentLoaded",()=>{ml.autoSpacingPage()}),b?Kn().then(c=>{c.code==0?(r.loadResponse(c.data),n.$patch({Loaded:!0})):(F(l,c.code),n.$patch({Loaded:!0}),r.clear())}).catch(c=>{console.log(c),m()}):n.$patch({Loaded:!0})}),(c,y)=>{const P=Rl,p=El,k=ha("RouterView"),f=ql,v=Ml,u=Kl;return D(),ee(re,null,[t(v,{class:"sh-app-layout"},{default:a(()=>[t(P,{class:"sh-header"},{default:a(()=>[t(si)]),_:1}),t(v,null,{default:a(()=>[t(pl,{name:"slide"},{default:a(()=>[C.value?(D(),E(p,{key:0,class:"sh-sidebar"},{default:a(()=>[t(ui)]),_:1})):ne("",!0)]),_:1}),t(v,{class:Rt(["sh-main-layout",{expanded:!C.value}])},{default:a(()=>[t(mi),t(f,{class:"sh-main-content"},{default:a(()=>[i.value?(D(),E(Fa,{key:0})):(D(),E(k,{key:1}))]),_:1}),t(Si)]),_:1},8,["class"])]),_:1})]),_:1}),h.value?(D(),E(Pi,{key:0})):ne("",!0),t(u,{container:"body",offset:["24px","80px"],size:"small"})],64)}}}),xi=ue(Ti,[["__scopeId","data-v-62ffc342"]]);Fl.registerLanguage("verilog",Ol);const Ga=fl();Ga.use(vl);const gt=_l(xi);gt.use(Ga);gt.use(Z);gt.use(Nl);gt.use(gl);gt.mount("#app");tn().then(()=>{console.log("Text cache reinitialized")}).catch(e=>{console.error("Text cache reinitialization failed",e)});
