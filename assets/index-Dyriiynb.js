import{bl as ut,bm as la,L as re,r as d,q as ie,t as na,bn as ae,bo as L,v as t,bp as l,bq as U,F as ne,br as we,bs as K,bt as F,au as x,a as Xe,bu as le,bv as he,aI as ce,j as Ua,bw as Aa,bx as Ra,by as Ea,u as Te,H as qe,bz as Ma,bA as Ne,n as Fe,w as je,bB as oa,bb as qa,bC as Ka,bD as gt,ah as Fa,bE as sa,bF as Na,bG as Ga,bH as ra,aN as Oa,bI as Ft,bJ as Tt,a5 as Ha,bK as Ba,bL as Ja,N as Ya,bM as Wa}from"./node_modules-DNQYDn3u.js";import{L as xe,C as fe,S as be,a as Xa,T as et,b as Se,A as Dt,c as Za,d as Qa,e as el,f as tl,g as at,R as Ce,B,F as $e,h as Ue,I as Ae,D as Ze,i as ua,j as Ge,k as Oe,l as al,m as Ve,n as wt,o as it,O as zt,p as ia,q as ca,P as da,r as kt,s as ma,t as ll,u as nl,v as ol,w as sl,x as pa,y as rl,z as ul,E as il,M as fa,G as va,H as cl,J as dl,K as ml,N as pl,Q as fl,U as vl,V as _l,W as gl,X as bl,Y as hl}from"./tdesign-vue-next-DSccRSBE.js";import{V as _e}from"./vditor-DArazWIS.js";import{e as Nt}from"./monaco-editor-BHsDS0An.js";import{H as yl,v as wl}from"./highlight.js-D9zWiMxS.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const m of o)if(m.type==="childList")for(const y of m.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&r(y)}).observe(document,{childList:!0,subtree:!0});function n(o){const m={};return o.integrity&&(m.integrity=o.integrity),o.referrerPolicy&&(m.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?m.credentials="include":o.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function r(o){if(o.ep)return;o.ep=!0;const m=n(o);fetch(o.href,m)}})();var Me=(e=>(e.Manage="i-manage",e.ManageJudge="i-manage-judge",e.ManageProblem="i-manage-problem",e.ManageContest="i-manage-contest",e.ManageCollection="i-manage-collection",e))(Me||{});const kl={"r-admin":["i-manage","i-manage-judge","i-manage-problem","i-manage-contest","i-manage-collection"]};function Cl(e){if(e==null)return[];const a=[];for(const n of e){const r=kl[n];r!=null&&a.push(...r)}return[...new Set(a)]}function Sl(e,a){if(e==null||a==null)return!1;const n=Cl(e);for(const r of a)if(!n.includes(r))return!1;return!0}const Le=ut("user",{state:()=>({token:"",userId:-1,username:"",nickname:"",roles:[]}),getters:{getToken(){return this.token},getUserId(){return this.userId},getUsername(){return this.username},getNickname(){return this.nickname}},actions:{clear(){this.$patch({token:"",userId:-1,username:"",nickname:"",roles:[]})},loadResponse(e){this.$patch({token:e.token,userId:e.user_id,username:e.username,nickname:e.nickname,roles:e.roles})},isLogin(){return this.token!=null&&this.token!=""},hasAuth(e){return this.hasAllAuths([e])},hasAllAuths(e){return e?Sl(this.roles,e):!0}},persist:!0}),Ke=ut("webStyle",{state:()=>({title:""}),getters:{getTitle(){return this.title}},actions:{setTitle(e){this.title=e}}}),Ct=ut("sidebarStyle",{state:()=>({showSidebar:!1,forceHiddenSidebar:!1,menuActiveName:"",menuList:[]}),getters:{getMenuList(){return this.menuList}},actions:{setSidebarShow(e){this.showSidebar=e},setForceHiddenSidebar(e){this.forceHiddenSidebar=e},setMenuActiveName(e){this.menuActiveName=e},clearMenuList(){this.menuList=[]},setMenuList(e){this.menuList=e},addMenuList(e){this.menuList.push(e)}}}),st=la.create({timeout:6e4,withCredentials:!1,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});st.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function Il(){return st({baseURL:"https://r2-oj.didapipa.com",url:"/system/notification.json?"+Date.now(),method:"get"})}function Pl(){return st({baseURL:"https://r2-oj.didapipa.com",url:"/status/judger.json?"+Date.now(),method:"get"})}function _a(e){return st({baseURL:"https://r2-oj.didapipa.com",url:"/status/judger/"+e+".json?"+Date.now(),method:"get"})}function xl(e){return st({baseURL:"https://r2-oj.didapipa.com",url:"/status/web.json?"+Date.now(),method:"get"})}const Tl={class:"judger-status-panel"},Vl={class:"judger-status-panel"};function Ll(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Xe(e)}const jl=re({__name:"SystemStatus",setup(e){const a=d([]),n=d([]),r=d(!1),o=d(!1);let m;const y=u=>{let c="失效",p="danger";const _=new Date,I=new Date(u.updateTime);return _.getTime()-I.getTime()>3e4?(c="离线",p="default"):u.cpuUsage>90?(c="CPU过高",p="warning"):u.memPercent>90?(c="内存过高",p="warning"):(c="在线",p="success"),t(be,null,{default:()=>[t("span",null,[u.key,x(" - "),u.name]),t("span",null,[u.updateTime]),t(et,{theme:p,size:"small"},Ll(c)?c:{default:()=>[c]})]})},b=async()=>{const u=[{key:"didaoj",name:"DidaOj"}],c={};for(let _=0;_<a.value.length;_++){const I=a.value[_];c[I.key]=I}const p=[];for(let _=0;_<u.length;_++){const I=u[_],i={key:I.key},v=await xl(I.key);v&&(v.name?i.name=v.name:i.name="-",v.update_time?i.updateTime=new Date(v.update_time).toLocaleString():i.updateTime="-",v.cpu_usage?i.cpuUsage=Number(v.cpu_usage):i.cpuUsage=0,v.mem_usage?i.memUsage=v.mem_usage/(1024*1024*1024):i.memUsage=0,v.mem_total?i.memTotal=v.mem_total/(1024*1024*1024):i.memTotal=0,i.memTotal>0?i.memPercent=Math.round(i.memUsage/i.memTotal*1e4)/100:i.memPercent=0,i.avgMessage=v.avg_message,c[I.key]?(i.cpuUsageFrom=c[I.key].cpuUsage,i.memPercentFrom=c[I.key].memPercent,i.memUsageFrom=c[I.key].memUsage,i.memTotalFrom=c[I.key].memTotal):(i.cpuUsageFrom=0,i.memPercentFrom=0,i.memUsageFrom=0,i.memTotalFrom=0),p.push(i))}a.value=p},k=async()=>{const u=await Pl(),c={};for(let _=0;_<n.value.length;_++){const I=n.value[_];c[I.key]=I}const p=[];for(let _=0;_<u.judgers.length;_++){const I=u.judgers[_],i={key:I.key,name:I.name},v=await _a(I.key);v&&(v.name?i.name=v.name:i.name="-",v.update_time?i.updateTime=new Date(v.update_time).toLocaleString():i.updateTime="-",v.cpu_usage?i.cpuUsage=Number(v.cpu_usage):i.cpuUsage=0,v.mem_usage?i.memUsage=v.mem_usage/(1024*1024*1024):i.memUsage=0,v.mem_total?i.memTotal=v.mem_total/(1024*1024*1024):i.memTotal=0,i.memTotal>0?i.memPercent=Math.round(i.memUsage/i.memTotal*1e4)/100:i.memPercent=0,i.avgMessage=v.avg_message,c[I.key]?(i.cpuUsageFrom=c[I.key].cpuUsage,i.memPercentFrom=c[I.key].memPercent,i.memUsageFrom=c[I.key].memUsage,i.memTotalFrom=c[I.key].memTotal):(i.cpuUsageFrom=0,i.memPercentFrom=0,i.memUsageFrom=0,i.memTotalFrom=0),p.push(i))}n.value=p},g=async()=>{await b(),r.value=!1,await k(),o.value=!1};return ie(async()=>{n.value=[],a.value=[],o.value=!0,r.value=!0,await g(),m=setInterval(()=>{g()},5e3)}),na(()=>{clearInterval(m)}),(u,c)=>{const p=Xa,_=be,I=fe,i=xe;return L(),ae(ne,null,[t(I,{title:"接口状态",class:"judger-status"},{default:l(()=>[t(i,{loading:r.value},{default:l(()=>[U("div",Tl,[(L(!0),ae(ne,null,we(a.value,v=>(L(),K(I,{key:v.key,header:()=>y(v),class:"judge-status-judger"},{footer:l(()=>[U("span",null," 负载信息："+F(v.avgMessage),1)]),default:l(()=>[t(_,{class:"judge-status-judger"},{default:l(()=>[t(p,{title:"CPU使用率",value:v.cpuUsage,animation:{valueFrom:v.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(p,{title:"内存使用率",value:v.memPercent,animation:{valueFrom:v.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(p,{title:"内存使用量",animation:{valueFrom:v.memUsageFrom,duration:2e3},"animation-start":!0,value:v.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(p,{title:"内存总量",value:v.memTotal,animation:{valueFrom:v.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1},8,["loading"])]),_:1}),t(I,{title:"判题机状态",class:"judger-status"},{default:l(()=>[t(i,{loading:o.value},{default:l(()=>[U("div",Vl,[(L(!0),ae(ne,null,we(n.value,v=>(L(),K(I,{key:v.key,header:()=>y(v),class:"judge-status-judger"},{footer:l(()=>[U("span",null," 负载信息："+F(v.avgMessage),1)]),default:l(()=>[t(_,{class:"judge-status-judger"},{default:l(()=>[t(p,{title:"CPU使用率",value:v.cpuUsage,animation:{valueFrom:v.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(p,{title:"内存使用率",value:v.memPercent,animation:{valueFrom:v.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(p,{title:"内存使用量",animation:{valueFrom:v.memUsageFrom,duration:2e3},"animation-start":!0,value:v.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(p,{title:"内存总量",value:v.memTotal,animation:{valueFrom:v.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1},8,["loading"])]),_:1})],64)}}}),ue=(e,a)=>{const n=e.__vccOpts||e;for(const[r,o]of a)n[r]=o;return n},Vt=ue(jl,[["__scopeId","data-v-1fb43cc1"]]),Dl={style:{"text-align":"right"}},zl=re({__name:"Hitokoto",setup(e){const a=d(!1),n=d(""),r=d(""),o=d(""),m=async()=>{a.value=!0;try{const b=await(await fetch("https://v1.hitokoto.cn")).json();r.value=b.hitokoto,o.value=b.creator,n.value="—— "+b.from}catch(y){r.value="一言获取失败了，但至少您还可以访问本站。",o.value="BoilTask",n.value="DidaOJ",console.error("Error fetching Hitokoto:",y)}finally{a.value=!1}};return ie(()=>{m()}),(y,b)=>{const k=fe,g=xe;return L(),K(g,{loading:a.value},{default:l(()=>[t(k,{title:"一言 © Hitokoto"},{actions:l(()=>[x(" @"+F(o.value),1)]),default:l(()=>[U("div",null,[U("span",null,F(r.value),1),U("p",Dl,F(n.value),1)])]),_:1})]),_:1},8,["loading"])}}}),$l={class:"sh-main"},Ul={class:"dida-swiper-div"},Al=re({__name:"HomeView",setup(e){let a=-1;const n=d(null),r=async()=>{n.value=await Il()};return ie(async()=>{await r(),a=setInterval(()=>{r()},3e4)}),na(()=>{clearInterval(a)}),(o,m)=>{const y=Dt,b=Qa,k=Za,g=fe,u=Se,c=at,p=tl,_=el,I=Ce;return L(),K(I,null,{default:l(()=>[t(u,{span:8},{default:l(()=>[U("div",$l,[n.value?(L(),K(y,{key:0,style:{margin:"20px"},theme:n.value.theme},{default:l(()=>[x(F(n.value.content),1)]),_:1},8,["theme"])):le("",!0),U("div",Ul,[t(k,{class:"dida-swiper"},{default:l(()=>[t(b,null,{default:l(()=>m[0]||(m[0]=[U("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1}),t(b,null,{default:l(()=>m[1]||(m[1]=[U("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1})]),_:1})]),t(g,{title:"正在完善，欢迎提供意见建议",style:{width:"500px",margin:"0 auto"}},{default:l(()=>m[2]||(m[2]=[U("p",null,[U("a",{href:"https://codeoj.cn/",target:"_blank"},"CodeOJ"),x("的迁移计划")],-1),U("p",null,"正在开发中",-1)])),_:1})])]),_:1}),t(u,{span:4},{default:l(()=>[t(zl,{style:{margin:"10px"}}),t(Vt),t(g,{style:{margin:"10px"},bordered:!0},{header:l(()=>m[3]||(m[3]=[U("b",null,"友情链接",-1)])),default:l(()=>[t(_,null,{default:l(()=>[t(p,null,{default:l(()=>[t(c,{href:"https://boiltask.com",target:"_blank"},{default:l(()=>m[4]||(m[4]=[x("BoilTask Blog")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),Rl=ue(Al,[["__scopeId","data-v-aba0b66b"]]),El={class:"sh-main"},Ml=re({__name:"View404",setup(e){let a=he(),n=d(a.fullPath);return(r,o)=>{const m=B;return L(),ae("div",El,[U("p",null,F(ce(n)),1),o[2]||(o[2]=U("p",null,"该页面无效或已被迁移，请重新选择访问目标",-1)),t(m,{theme:"primary",onClick:o[0]||(o[0]=()=>r.$router.push("/"))},{default:l(()=>o[1]||(o[1]=[x("返回首页")])),_:1})])}}}),ga=ue(Ml,[["__scopeId","data-v-d4218944"]]);let Lt=null;async function ql(){Lt=await Fl()}function Kl(e,a="zh"){if(Lt==null)return[!1,e.toString()];const n=Lt[e.toString()];if(!n)return[!1,e.toString()];let r=n[a];return r||(a="zh",r=n[a]),r?[!0,r]:[!1,e.toString()]}async function Fl(){return new Promise(e=>{e({404:{zh:"接口未找到"},1e3:{zh:"系统错误，请重试或等待管理员修复"},1001:{zh:"系统异常，请重试或等待管理员修复"},1002:{zh:"未知错误"},1003:{zh:"操作过于频繁，请稍后重试"},10001:{zh:"权限异常，请重新登陆后再试"},10002:{zh:"参数不符合要求"},10003:{zh:"未找到目标数据"},10004:{zh:"操作需要登录，请登录后重试"},100001:{zh:"用户名不存在或密码不匹配"},100002:{zh:"邮件发送失败，可能是邮箱无效或达到了每日注册上限，如有问题可联系管理员解决"},100003:{zh:"验证码错误或已过期，请重新获取"},100004:{zh:"注册用户失败，可能存在同名用户"},100005:{zh:"用户名不存在，或您未在本系统绑定邮箱，请联系管理员寻求帮助"},100006:{zh:"验证码错误或已过期，请重新获取"},100007:{zh:"已存在相同标题的题目"},100008:{zh:"已存在相同标题的比赛"},100009:{zh:"已存在相同标题的题集"},100010:{zh:"未发现有效题目"},100011:{zh:"题目数量超过限制，无法添加"},100012:{zh:"比赛开始时间无法设置为早于当前时间"},100013:{zh:"当前无法提交题目"},100014:{zh:"申请访问失败，密码错误"}})})}function me(){const{appContext:e}=Ua();return{globalProperties:e.config.globalProperties}}function ze(){return 1e3}function Be(e,a,n=3e3){e.$message.success({duration:n,content:a})}function ge(e,a,n=3e3){e.$message.info({duration:n,content:a})}function ve(e,a,n=3e3){e.$message.error({duration:n,content:a})}function J(e,a,n=3e3){const[r,o]=Kl(a),m=r?o:`系统错误，错误提示[${o}]`;e.$message.error({duration:n,content:m})}function Nl(e,a){return e.length<=a?e:e.slice(0,a)+"..."}function ba(e){return e.trim().split(/\s+/).flatMap(r=>r.split(",")).filter(r=>r.trim()!=="")}const Gl="https://oj-api.didapipa.com/",Q=la.create({baseURL:Gl,timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});Q.interceptors.request.use(e=>{const n=Le().getToken;return n&&(e.headers["X-Token"]=n),e},e=>Promise.reject(e));Q.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function Ol(e){const a={};return a.id=e.id,a.username=e.username,a.nickname=e.nickname,a.email=e.email,a.slogan=e.slogan,a.organization=e.organization,a.accept=e.accept,a.attempt=e.attempt,a.vjudgeId=e.vjudge_id,e.email&&(a.avatar=`https://www.gravatar.com/avatar/${Aa(e.email.toLowerCase().trim())}?d=identicon&s=100`),a}function Hl(e,a){return Q({url:"/user/login",method:"post",data:{username:e,password:a}})}function Bl(){return Q({url:"/user/login/refresh",method:"post"})}function Jl(e){const a={username:e};return Q({url:`/user/info?${new URLSearchParams(a).toString()}`,method:"get"})}function Yl(e){const a="https://vjudge.net/user/solveDetail/"+encodeURIComponent(e);return st({url:a,method:"get"})}function Wl(e){return Q({url:"/user/account/infos",method:"post",data:{users:e}})}function Xl(e){return Q({url:"/user/parse",method:"post",data:{users:e}})}function Zl(e,a){return Q({url:"/user/register/email",method:"post",data:{token:e,email:a}})}function Ql(e,a,n,r,o){return Q({url:"/user/register",method:"post",data:{username:e,password:a,email:n,key:r,nickname:o}})}function en(e,a){return Q({url:"/user/forget",method:"post",data:{token:e,username:a}})}function tn(e,a,n){return Q({url:"/user/password/modify",method:"post",data:{username:e,password:a,key:n}})}const an={class:"dida-login-footer"},ln=re({__name:"LoginView",setup(e){const{globalProperties:a}=me(),n=Le(),r=d(!1),o=d({username:"",password:""}),m=()=>{ge(a,"重置成功")},y=({validateResult:b,firstError:k})=>{r.value||(r.value=!0,Hl(o.value.username,o.value.password).then(g=>{if(g.code===0){n.loadResponse(g.data),ge(a,"登录成功");let u=a.$route.query.redirect_uri;u||(u="/user/"+g.data.username),a.$router.push({path:u})}else J(a,g.code)}).catch(g=>{console.error("Login error",g),ve(a,"登录失败")}).finally(()=>{r.value=!1}))};return ie(()=>{if(n.isLogin()){a.$router.push({path:"/user"});return}}),(b,k)=>{const g=Ae,u=Ue,c=B,p=$e,_=at,I=fe;return L(),K(I,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:l(()=>[t(p,{ref:"form",data:o.value,colon:!0,onReset:m,onSubmit:y,class:"yj-login-form","label-width":0},{default:l(()=>[t(u,{name:"username"},{default:l(()=>[t(g,{modelValue:o.value.username,"onUpdate:modelValue":k[0]||(k[0]=i=>o.value.username=i),clearable:"",autocomplete:"username",placeholder:"请输入用户名"},{"prefix-icon":l(()=>[t(ce(Ra))]),_:1},8,["modelValue"])]),_:1}),t(u,{name:"password"},{default:l(()=>[t(g,{modelValue:o.value.password,"onUpdate:modelValue":k[1]||(k[1]=i=>o.value.password=i),type:"password",autocomplete:"current-password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":l(()=>[t(ce(Ea))]),_:1},8,["modelValue"])]),_:1}),t(u,null,{default:l(()=>[t(c,{theme:"primary",type:"submit",block:"",loading:r.value},{default:l(()=>k[4]||(k[4]=[x("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),U("div",an,[t(_,{onClick:k[2]||(k[2]=()=>{ce(a).$router.push({name:"login-forget"})})},{default:l(()=>k[5]||(k[5]=[x("忘记密码 ")])),_:1}),t(_,{onClick:k[3]||(k[3]=()=>{ce(a).$router.push({name:"register"})})},{default:l(()=>k[6]||(k[6]=[x("注册账户 ")])),_:1})])]),_:1})}}}),nn=ue(ln,[["__scopeId","data-v-524b77f9"]]),on={class:"dida-login-footer"},sn=re({__name:"RegisterView",setup(e){const{globalProperties:a}=me(),n=Le(),r=d(!1),o=d(!1),m=d(!1),y=d("发送验证码");let b=null,k=-1;const g=d(!1),u=d(null),c=d({username:"",password:"",confirmPassword:"",nickname:"",email:"",emailKey:""}),_=d({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:f=>new Promise(s=>{const w=setTimeout(()=>{s(c.value.password===f),clearTimeout(w)})}),message:"两次密码不一致"}],nickname:[{required:!0,message:"请填写昵称"},{min:1,message:"昵称至少1个字符"},{max:30,message:"昵称最多30个字符"}],email:[{required:!0,message:"请填写邮箱"},{pattern:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"邮箱格式不正确"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),I=d(()=>t(B,{onClick:i,disabled:m.value,loading:o.value,style:"width:120px"},{default:()=>[y.value]})),i=async()=>{var h;if(!c.value.email){ve(a,"请输入邮箱");return}if(!c.value.email.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)){ve(a,"邮箱格式不正确");return}if(m.value||o.value)return;g.value=!0,await qe();const f=document.getElementById("cf-confirm-div");f&&f.remove();const s=document.createElement("div");s.id="cf-confirm-div",s.setAttribute("data-theme","light"),(h=u.value)==null||h.appendChild(s);const w=window;w.turnstile.ready(function(){w.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function($){g.value=!1,await v($)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},v=async f=>{if(!m.value){o.value=!0;try{const s=await Zl(f,c.value.email);if(s.code!==0){J(a,s.code);return}ge(a,"发送验证码成功"),o.value=!1,m.value=!0,b=new Date,y.value="60秒后重发",k=setInterval(()=>{const h=Math.floor((new Date().getTime()-(b==null?void 0:b.getTime()))/1e3);h>60?(y.value="发送验证码",m.value=!1,clearInterval(k)):y.value=`${60-h}秒后重发`},1e3)}catch{ve(a,"发送验证码失败")}finally{o.value=!1}}},S=()=>{ge(a,"重置成功")},C=({validateResult:f,firstError:s,e:w})=>{if(!r.value){if(w.preventDefault(),f!==!0){ve(a,s);return}if(c.value.password!==c.value.confirmPassword){ve(a,"两次密码不一致");return}r.value=!0,Ql(c.value.username,c.value.password,c.value.email,c.value.emailKey,c.value.nickname).then(h=>{h.code===0?(ge(a,"注册成功，可使用账号信息登录"),a.$router.push({name:"login"})):J(a,h.code)}).catch(h=>{console.error("Login error",h),ve(a,"登录失败")}).finally(()=>{r.value=!1})}};return ie(()=>{if(n.isLogin()){a.$router.push({path:"/user"});return}}),Te(()=>{clearInterval(k)}),(f,s)=>{const w=Ae,h=Ue,$=ua,R=B,A=$e,j=at,D=fe,M=Ze;return L(),ae(ne,null,[t(D,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:l(()=>[t(A,{ref:"form",rules:_.value,data:c.value,colon:!0,onReset:S,onSubmit:C,class:"yj-login-form"},{default:l(()=>[t(h,{name:"username",label:"用户名"},{default:l(()=>[t(w,{modelValue:c.value.username,"onUpdate:modelValue":s[0]||(s[0]=z=>c.value.username=z),clearable:"",placeholder:"用于登录与查找"},null,8,["modelValue"])]),_:1}),t(h,{name:"password",label:"密码"},{default:l(()=>[t(w,{modelValue:c.value.password,"onUpdate:modelValue":s[1]||(s[1]=z=>c.value.password=z),type:"password",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(h,{name:"confirmPassword",label:"确认密码"},{default:l(()=>[t(w,{modelValue:c.value.confirmPassword,"onUpdate:modelValue":s[2]||(s[2]=z=>c.value.confirmPassword=z),type:"password",clearable:"",placeholder:"请确认密码"},null,8,["modelValue"])]),_:1}),t(h,{name:"nickname",label:"昵称"},{default:l(()=>[t(w,{modelValue:c.value.nickname,"onUpdate:modelValue":s[3]||(s[3]=z=>c.value.nickname=z),clearable:"",placeholder:"用于优先在网站各处展示"},null,8,["modelValue"])]),_:1}),t(h,{name:"email",label:"邮箱"},{default:l(()=>[t(w,{modelValue:c.value.email,"onUpdate:modelValue":s[4]||(s[4]=z=>c.value.email=z),clearable:"",placeholder:"请填写常用邮箱"},null,8,["modelValue"])]),_:1}),t(h,{name:"emailKey",label:"验证码"},{default:l(()=>[t($,{append:I.value},{default:l(()=>[t(w,{modelValue:c.value.emailKey,"onUpdate:modelValue":s[5]||(s[5]=z=>c.value.emailKey=z),clearable:"",placeholder:"请输入验证码",style:{width:"140px"}},null,8,["modelValue"])]),_:1},8,["append"])]),_:1}),t(h,null,{default:l(()=>[t(R,{theme:"primary",type:"submit",block:"",loading:r.value},{default:l(()=>s[8]||(s[8]=[x("注册")])),_:1},8,["loading"])]),_:1})]),_:1},8,["rules","data"]),U("div",on,[t(j,{onClick:s[6]||(s[6]=()=>{ce(a).$router.push({name:"login"})})},{default:l(()=>s[9]||(s[9]=[x("返回登陆 ")])),_:1})])]),_:1}),t(M,{visible:g.value,"onUpdate:visible":s[7]||(s[7]=z=>g.value=z),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:l(()=>[U("div",{ref_key:"dialogContainer",ref:u,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),rn=ue(sn,[["__scopeId","data-v-9b5f4fc7"]]),un={key:0,style:{margin:"10px"}},cn={key:1,style:{margin:"10px"}},dn={style:{margin:"12px"}},mn=re({__name:"UserView",setup(e){let a=he();const{globalProperties:n}=me(),r=Ke();let o="";const m=d(!1),y=d(null),b=d([]),k=d([]),g=d([]),u=async c=>{m.value=!0;try{let p=await Jl(c);if(p.code!==0){m.value=!1,J(n,p.code),await Z.push({name:"home"});return}if(y.value=Ol(p.data.user),b.value=p.data.problems_ac,r.setTitle(y.value.nickname+" - "+r.getTitle),y.value.vjudgeId){const _=await Yl(y.value.vjudgeId);k.value=_.acRecords;for(const I in k.value)k.value[I].sort((i,v)=>i.length===v.length?i.localeCompare(v):i.length-v.length);g.value=_.failRecords;for(const I in g.value)g.value[I].sort((i,v)=>i.length===v.length?i.localeCompare(v):i.length-v.length)}}catch{ve(n,"获取用户信息失败"),await Z.push({name:"home"})}finally{m.value=!1}};return Ma(async(c,p,_)=>{if(Array.isArray(c.params.username)?o=c.params.username[0]:o=c.params.username,!o){await Z.push({name:"home"});return}await u(o),_()}),ie(async()=>{if(Array.isArray(a.params.username)?o=a.params.username[0]:o=a.params.username,!o){await Z.push({name:"home"});return}await u(o)}),(c,p)=>{const _=B,I=be,i=fe,v=at,S=Oe,C=Ge,f=Se,s=al,w=Ce,h=xe;return L(),K(h,{loading:m.value},{default:l(()=>[t(w,{class:"dida-main-content"},{default:l(()=>[t(f,{span:8},{default:l(()=>{var $;return[t(i,{style:{margin:"10px"},title:"AC题目"},{default:l(()=>[t(I,{style:{"flex-wrap":"wrap"}},{default:l(()=>[(L(!0),ae(ne,null,we(b.value,R=>(L(),K(_,{key:R,size:"small",onClick:()=>ce(Z).push({name:"problem-detail",params:{problemId:R}})},{default:l(()=>[x(F(R),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),($=y.value)!=null&&$.vjudgeId?(L(),K(i,{key:0,style:{margin:"10px"},title:"vjudge.net"},{actions:l(()=>{var R;return[t(v,{href:"https://vjudge.net/user/"+((R=y.value)==null?void 0:R.vjudgeId),target:"_blank"},{default:l(()=>{var A;return[x("@"+F((A=y.value)==null?void 0:A.vjudgeId),1)]}),_:1},8,["href"])]}),default:l(()=>[k.value&&Object.keys(k.value).length>0?(L(),ae("div",un,[p[0]||(p[0]=U("div",{style:{margin:"5px"}},[U("span",null,"AC")],-1)),t(C,{layout:"vertical",bordered:!0},{default:l(()=>[(L(!0),ae(ne,null,we(k.value,(R,A)=>(L(),K(S,{key:A,label:A},{default:l(()=>[t(I,{style:{"flex-wrap":"wrap"}},{default:l(()=>[(L(!0),ae(ne,null,we(R,j=>(L(),K(_,{key:j,size:"small",onClick:()=>ce(Z).push({name:"problem-detail",params:{problemId:A+"-"+j}})},{default:l(()=>[x(F(j),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):le("",!0),g.value&&Object.keys(g.value).length>0?(L(),ae("div",cn,[p[1]||(p[1]=U("div",{style:{margin:"5px"}},[U("span",null,"Fail")],-1)),t(C,{layout:"vertical",bordered:!0},{default:l(()=>[(L(!0),ae(ne,null,we(g.value,(R,A)=>(L(),K(S,{key:A,label:A},{default:l(()=>[t(I,{style:{"flex-wrap":"wrap"}},{default:l(()=>[(L(!0),ae(ne,null,we(R,j=>(L(),K(_,{key:j,size:"small",onClick:()=>ce(Z).push({name:"problem-detail",params:{problemId:A+"-"+j}})},{default:l(()=>[x(F(j),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):le("",!0)]),_:1})):le("",!0)]}),_:1}),t(f,{span:4},{default:l(()=>[U("div",dn,[t(C,{layout:"vertical",bordered:!0},{default:l(()=>[t(S,{label:"头像"},{default:l(()=>{var $;return[t(s,{shape:"round",size:"100px",image:($=y.value)==null?void 0:$.avatar,"hide-on-load-failed":!1},null,8,["image"])]}),_:1}),t(S,{label:"昵称"},{default:l(()=>{var $;return[x(F(($=y.value)==null?void 0:$.nickname),1)]}),_:1}),t(S,{label:"Slogan"},{default:l(()=>{var $;return[x(F(($=y.value)==null?void 0:$.slogan),1)]}),_:1}),t(S,{label:"邮箱"},{default:l(()=>{var $;return[x(F(($=y.value)==null?void 0:$.email),1)]}),_:1}),t(S,{label:"组织"},{default:l(()=>{var $;return[x(F(($=y.value)==null?void 0:$.organization),1)]}),_:1}),t(S,{label:"通过数量"},{default:l(()=>{var $;return[x(F(($=y.value)==null?void 0:$.accept),1)]}),_:1}),t(S,{label:"提交数量"},{default:l(()=>{var $;return[x(F(($=y.value)==null?void 0:$.attempt),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),pn=ue(mn,[["__scopeId","data-v-555e19aa"]]),$t=[{name:"home",path:"/",title:"首页",showSidebar:!1,disableGenerateTab:!0,component:Rl},{name:"problem",path:"/problem",title:"题目",icon:"calculation",showSidebar:!0,redirect:"problem-list"},{name:"collection-detail-tab",title:"题集",path:"/collection",showSidebar:!0,disableGenerateTab:!0,redirect:"problem-collection-list"},{name:"judge",path:"/judge",title:"评测",icon:"code",showSidebar:!0,redirect:"judge-list"},{name:"contest",path:"/contest",title:"比赛",icon:"application",showSidebar:!0,redirect:"contest-list"},{name:"contest-detail-tab",title:"比赛",path:"/contest",showSidebar:!0,disableGenerateTab:!0,redirect:"contest-list"},{name:"discuss",title:"讨论",path:"/discuss",icon:"sonic",showSidebar:!0,redirect:"discuss-list"},{name:"rank",path:"/rank",title:"排名",icon:"chart-column",showSidebar:!0,redirect:"rank-ac-all"},{name:"tool",path:"/tool",title:"工具",icon:"tools",showSidebar:!0,redirect:"tool-paste"},{name:"system",path:"/system",title:"系统",icon:"dashboard",showSidebar:!0,redirect:"system-status"},{name:"manage",path:"/manage",title:"管理",icon:"command",showSidebar:!0,redirect:"manage-judge",auths:[Me.Manage]},{name:"login",path:"/login",title:"登陆",showSidebar:!1,disableGenerateTab:!0,component:nn},{name:"register",path:"/register",title:"注册",showSidebar:!1,disableGenerateTab:!0,component:rn},{name:"user",path:"/user/:username+",title:"用户",showSidebar:!1,needLogin:!0,disableGenerateTab:!0,component:pn},{name:"404",path:"/404",title:"404",showSidebar:!1,disableGenerateTab:!0,component:ga}],fn=e=>$t.find(a=>a.name==e),vn=e=>{const a=[];return $t.forEach(n=>{!n.disableGenerateTab&&e.hasAllAuths(n.auths)&&a.push(n)}),a},_n=e=>{$t.forEach(a=>{const n={name:a.name,path:a.path,meta:{title:a.title,tab:a.name,showSidebar:a.showSidebar,needLogin:a.needLogin,redirect:a.redirect,tabAuths:a.auths},component:a.component};e.push(n)})};function ha(e){return e.children!==void 0}function gn(e){return e.children!==void 0}var Ut=(e=>(e[e.Unknown=-1]="Unknown",e[e.C=0]="C",e[e.Cpp=1]="Cpp",e[e.Java=2]="Java",e[e.Python=3]="Python",e[e.Pascal=4]="Pascal",e[e.Golang=5]="Golang",e[e.Lua=6]="Lua",e[e.TypeScript=7]="TypeScript",e[e.Max=8]="Max",e))(Ut||{});function At(){const e=[-1,8];return Object.values(Ut).filter(a=>typeof a=="number"&&!e.includes(a)).map(a=>({value:a,label:Rt(a)}))}function bt(e){return e>-1&&e<8}function Rt(e){switch(e){case 0:return"C";case 1:return"C++";case 2:return"Java";case 3:return"Python";case 4:return"Pascal";case 5:return"Golang";case 6:return"Lua";case 7:return"TypeScript";default:return"未知"}}function Et(e){switch(e){case 0:return"c";case 1:return"cpp";case 2:return"java";case 3:return"python";case 4:return"pascal";case 5:return"go";case 6:return"lua";case 7:return"typescript";default:return"text"}}var De=(e=>(e[e.Init=0]="Init",e[e.Rejudge=1]="Rejudge",e[e.Submitting=2]="Submitting",e[e.Queuing=3]="Queuing",e[e.Compiling=4]="Compiling",e[e.Running=5]="Running",e[e.Accept=6]="Accept",e[e.PE=7]="PE",e[e.WA=8]="WA",e[e.TLE=9]="TLE",e[e.MLE=10]="MLE",e[e.OLE=11]="OLE",e[e.RE=12]="RE",e[e.CE=13]="CE",e[e.CLE=14]="CLE",e[e.JudgeFail=15]="JudgeFail",e[e.SubmitFail=16]="SubmitFail",e[e.Unknown=17]="Unknown",e[e.Max=18]="Max",e))(De||{});const bn=e=>{switch(e){case 0:return"普通评测";case 1:return"特殊评测";default:return"未知"}},yt=e=>{switch(e){case 0:return"等待处理";case 1:return"重新评测";case 2:return"提交中";case 3:return"队列中";case 4:return"编译中";case 5:return"运行中";case 6:return"通过";case 7:return"格式错误";case 8:return"答案错误";case 9:return"超时";case 10:return"内存超限";case 11:return"输出超限";case 12:return"运行错误";case 13:return"编译错误";case 14:return"编译超限";case 15:return"评测失败";case 16:return"提交失败";case 17:return"未知";default:return e}},ya=e=>{switch(e){case 0:case 1:case 2:case 3:case 4:case 5:case 17:return"default";case 6:return"success";case 7:return"warning";default:return"danger"}};function wa(){const e=[17,18];return Object.values(De).filter(a=>typeof a=="number"&&!e.includes(a)).map(a=>({value:a,label:yt(a)}))}function ht(e){return e>=0&&e<17}function ot(e){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return!0;default:return!1}}function ka(e){var n;const a={};if(a.id=e.id,a.problemId=e.problem_id,a.contestProblemIndex=e.contest_problem_index,a.status=e.status,ot(e.status)||!ht(e.status)?a.score="-":a.score=e.score.toString(),e.time?a.time=Math.ceil(e.time/1e6)+"ms":a.time="-",e.memory?a.memory=(e.memory/1024/1024).toFixed(2)+"MB":a.memory="-",a.language=e.language,a.codeLength=e.code_length,e.approve_time?a.approveTime=new Date(e.approve_time).toLocaleString():a.approveTime="-",a.author=e.author,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.code=e.code,a.compileMessage=e.compile_message,a.taskCurrent=e.task_current,a.taskTotal=e.task_total,a.task=[],e.task)for(let r=0;r<((n=e.task)==null?void 0:n.length);r++){const o=e.task[r],m={};m.taskId=o.task_id,m.status=o.status,o.time?m.time=Math.ceil(o.time/1e6)+"ms":m.time="-",o.memory?m.memory=(o.memory/1024/1024).toFixed(2)+"MB":m.memory="-",m.score=o.score,m.content=o.content,m.waHint=o.wa_hint,!m.content&&!m.waHint&&(m.content="无提示信息"),a.task.push(m)}return e.judger&&(a.judger=e.judger),e.judge_time&&(a.judgeTime=new Date(e.judge_time).toLocaleString()),a}function hn(e,a,n,r,o){return Q({url:"/judge/approve",method:"post",data:{problem_id:e,contest_id:a,problem_index:n,language:r,code:o}})}function yn(e){return Q({url:"/judge?id="+e,method:"get"})}function wn(e){return Q({url:"/judge/code?id="+e,method:"get"})}function kn(e,a,n,r,o,m,y){let b={problem_id:a,username:n,language:String(r),status:String(o),page:String(m),page_size:String(y)};return e&&(b.contest_id=String(e)),Q({url:`/judge/list?${new URLSearchParams(b).toString()}`,method:"get"})}function Cn(){return Q({url:"/judge/rejudge/recently",method:"post"})}function Sn(e,a,n){const r={};return e!=null&&(r.problem_id=e),a!=null?r.language=a:r.language=Ut.Unknown,n!=null?r.status=n:r.status=18,Q({url:"/judge/rejudge/search",method:"post",data:r})}function In(){return Q({url:"/judge/rejudge/all",method:"post",timeout:0})}function Pn(e){return Q({url:"/judge/rejudge",method:"post",data:{id:Number(e)}})}var Je=(e=>(e[e.None=0]="None",e[e.Attempt=1]="Attempt",e[e.Accept=2]="Accept",e))(Je||{});function ct(e,a){const n={};if(n.id=e.id,n.author=e.author,n.title=e.title,n.tags=[],e.tags)for(const r of e.tags){const o=a[r];o&&n.tags.push(o)}if(n.private=e.private,n.accept=e.accept,n.attempt=e.attempt,e.description!=null&&(n.description=e.description),e.time_limit!=null&&e.time_limit>=0?n.timeLimit=e.time_limit.toString()+" ms":n.timeLimit="未知",e.memory_limit!=null&&e.memory_limit>=0?n.memoryLimit=(e.memory_limit/1024).toFixed(2)+" MB":n.memoryLimit="未知",e.judge_type!=null&&(n.judgeType=bn(e.judge_type)),e.insert_time!=null&&(n.insertTime=new Date(e.insert_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.source!=null){const r=/\[([^\]]+)\]\(([^)]+)\)/,o=e.source.match(r);o?(n.source=o[1],n.sourceUrl=o[2]):(n.source=e.source,n.sourceUrl="")}return e.judge_md5!=null&&(n.judgeMd5=e.judge_md5),e.origin_oj!=null&&(n.originOj=e.origin_oj),e.origin_id!=null&&(n.originId=e.origin_id),e.origin_url!=null&&(n.originUrl=e.origin_url),n}function Ca(e,a,n){const r={};return e?r.id=e:(r.contest_id=a,r.problem_index=n),Q({url:`/problem?${new URLSearchParams(r).toString()}`,method:"get"})}function Sa(e){return Q({url:"/problem/tag/list?max_count="+e,method:"get"})}function xn(e){return Q({url:"/problem/judge?id="+e,method:"get"})}function Tn(e,a,n,r,o,m){const y={};return e&&(y.oj=e),a&&(y.title=a),n&&(y.tag=n),r!==void 0&&(y.private=r?"1":"0"),o&&(y.page=o),m&&(y.page_size=m),Q({url:`/problem/list?${new URLSearchParams(y).toString()}`,method:"get"})}function Vn(e){const a={};return e&&(a.problem_id=e),Q({url:`/problem/recommend?${new URLSearchParams(a).toString()}`,method:"get"})}function Ia(e,a){return Q({url:"/problem/crawl",method:"post",data:{oj:e,id:a}})}function Ln(e,a,n,r,o,m,y){return Q({url:"/problem/create",method:"post",data:{title:e,time_limit:a,memory_limit:n,source:r,private:o,tags:m,description:y}})}function jn(e,a,n,r,o,m,y,b){return Q({url:"/problem/edit",method:"post",data:{id:e,title:a,time_limit:n,memory_limit:r,source:o,private:m,tags:y,description:b}})}function Dn(e,a){return Q({url:"/problem/judge/data/download?id="+e+"&key="+a,method:"get"})}function zn(e,a){const n=new FormData;return n.append("id",e),n.append("zip",a),Q({url:"/problem/judge/data",method:"post",data:n,headers:{"Content-Type":"multipart/form-data"},timeout:1e3*60*5})}function $n(e){return Q({url:"/problem/parse",method:"post",data:{problems:e}})}const Un={style:{margin:"10px"}},An={key:0,class:"dida-operation-container"};function Rn(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Xe(e)}const En=re({__name:"ProblemList",setup(e){const a=he(),n=Ne(),{globalProperties:r}=me(),o=Le();let m=null;const y=d(!1),b={};let k={};const g=d(!1),u=Fe(()=>o.hasAuth(Me.ManageProblem)),c=d([{title:"ID",colKey:"id",cell:(z,P)=>{let T=h(P.row.id);return t(B,{variant:"dashed",theme:T,onClick:()=>w(P.row.id)},{default:()=>[P.row.id]})}},{title:"标题",colKey:"title",cell:(z,P)=>t(B,{variant:"text",onClick:()=>w(P.row.id)},{default:()=>[P.row.title]})},{title:"标签",colKey:"tags",cell:(z,P)=>{const T=P.row.tags;if(!T||T.length===0)return"";let V=[];for(let E=0;E<T.length;E++){const Y=T[E];V.push(t(B,{key:E,theme:"default",variant:"outline",size:"small",onClick:()=>A(Y)},{default:()=>[Y.name]}))}return t(be,null,Rn(V)?V:{default:()=>[V]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),p=d(!1);let _=1,I=50;const i=d({current:_,pageSize:I,defaultCurrent:_,defaultPageSize:I,total:0,pageSizeOptions:[50,100]}),v=d(),S=d(),C=[{label:"DidaOJ",value:"didaoj"},{label:"HDU",value:"hdu"},{label:"POJ",value:"poj"},{label:"NYOJ",value:"nyoj"}],f=d({oj:"",title:"",tag:"",private:!1}),s=d({oj:"",problem:""}),w=z=>{z&&n.push({path:"/problem/"+z})},h=z=>{if(!z||!k)return"default";const P=k[z];if(!P)return"default";switch(P){case Je.Accept:return"success";case Je.Attempt:return"warning";default:return"default"}},$=async()=>{await n.push({query:{...a.query,oj:f.value.oj,title:f.value.title,tag:f.value.tag,private:f.value.private?"1":"0",page:1,page_size:i.value.defaultPageSize}})},R=async()=>{try{g.value=!0;const z=await Ia(s.value.oj,s.value.problem);z.code===0?(ge(r,"搜索成功"),await n.push({name:"problem-detail",params:{problemId:z.data}})):J(r,z.code)}catch(z){console.error(z),J(r,ze())}finally{g.value=!1}},A=z=>{z&&n.push({query:{...a.query,title:"",tag:z.name,page:1,page_size:i.value.defaultPageSize}})},j=()=>{n.push({name:"manage-problem-create"})},D=async(z,P)=>{p.value=!0;try{const{current:T,pageSize:V}=z,E=await Tn(f.value.oj,f.value.title,f.value.tag,f.value.private,T,V);if(v.value=[],E.code===0){const Y=E.data.list;if(!Y||Y.length<=0){i.value={...i.value,total:0},k={},ge(r,"未找到记录");return}Y.forEach(W=>{var G;const q=ct(W,b);(G=v.value)==null||G.push(q)}),i.value={...i.value,total:E.data.total_count},k=E.data.problem_attempt_status}else P&&J(r,E.code)}catch(T){console.error(T),J(r,ze())}finally{p.value=!1}},M=async z=>{await n.push({query:{...a.query,page:z.current,page_size:z.pageSize}})};return ie(async()=>{p.value=!0,S.value=[],Sa(-1).then(z=>{if(z.code===0){S.value=z.data.list,y.value=z.data.total_count>z.data.list.length;for(let P=0;P<z.data.list.length;P++){const T=z.data.list[P];b[T.id]=T}m=je(()=>a.query,P=>{f.value.oj=P.oj||"",f.value.title=P.title||"",f.value.tag=P.tag||"",f.value.private=P.private==="1";const T=parseInt(P.page)||i.value.defaultCurrent,V=parseInt(P.page_size)||i.value.defaultPageSize;_=T,I=V,i.value={...i.value,current:_,pageSize:I},D({current:_,pageSize:I},!0)},{immediate:!0})}else y.value=!0}).catch(z=>{console.error(z),y.value=!0})}),Te(()=>{m&&m()}),(z,P)=>{const T=Ve,V=fe,E=Se,Y=B,W=be,q=wt,G=Ue,N=Ae,ye=it,Ie=$e,H=Ce;return L(),K(H,null,{default:l(()=>[t(E,{span:9},{default:l(()=>[t(V,{style:{margin:"10px"}},{default:l(()=>[t(T,{data:v.value,columns:c.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:i.value,"table-layout":"auto",loading:p.value,onPageChange:M},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(E,{span:3},{default:l(()=>[U("div",Un,[u.value?(L(),ae("div",An,[t(W,null,{default:l(()=>[t(Y,{onClick:j},{default:l(()=>P[7]||(P[7]=[x("新建")])),_:1})]),_:1})])):le("",!0),t(V,{class:"sh-card"},{default:l(()=>[t(Ie,{model:f.value,onSubmit:$},{default:l(()=>[t(G,{label:"OJ"},{default:l(()=>[t(q,{modelValue:f.value.oj,"onUpdate:modelValue":P[0]||(P[0]=O=>f.value.oj=O),options:C,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(G,{label:"标题"},{default:l(()=>[t(N,{modelValue:f.value.title,"onUpdate:modelValue":P[1]||(P[1]=O=>f.value.title=O),placeholder:"请输入关键词"},null,8,["modelValue"])]),_:1}),t(G,{label:"标签"},{default:l(()=>[t(N,{modelValue:f.value.tag,"onUpdate:modelValue":P[2]||(P[2]=O=>f.value.tag=O),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),u.value?(L(),K(G,{key:0,label:"私有"},{default:l(()=>[t(ye,{modelValue:f.value.private,"onUpdate:modelValue":P[3]||(P[3]=O=>f.value.private=O)},null,8,["modelValue"])]),_:1})):le("",!0),t(G,null,{default:l(()=>[t(Y,{theme:"primary",type:"submit"},{default:l(()=>P[8]||(P[8]=[x("搜索")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(V,{class:"sh-card"},{default:l(()=>[t(Ie,{model:s.value,onSubmit:R},{default:l(()=>[t(G,{label:"OJ"},{default:l(()=>[t(q,{modelValue:s.value.oj,"onUpdate:modelValue":P[4]||(P[4]=O=>s.value.oj=O),options:C,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(G,{label:"题目"},{default:l(()=>[t(N,{modelValue:s.value.problem,"onUpdate:modelValue":P[5]||(P[5]=O=>s.value.problem=O),placeholder:"请输入原始题号"},null,8,["modelValue"])]),_:1}),t(G,null,{default:l(()=>[t(Y,{theme:"primary",type:"submit",loading:g.value},{default:l(()=>P[9]||(P[9]=[x("前往")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),t(V,{class:"sh-card sh-background-black"},{default:l(()=>[(L(!0),ae(ne,null,we(S.value,O=>(L(),K(Y,{class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:()=>A(O)},{default:l(()=>[x(F(O.name),1)]),_:2},1032,["onClick"]))),256)),y.value?(L(),K(Y,{key:0,class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:P[6]||(P[6]=()=>z.$router.push("/problem/tags"))},{default:l(()=>P[10]||(P[10]=[x(" ... ")])),_:1})):le("",!0)]),_:1})])]),_:1})]),_:1})}}}),Mn=ue(En,[["__scopeId","data-v-bc7185f5"]]);function tt(e){e.querySelectorAll("pre > code:not([data-copy-attached])").forEach(n=>{n.setAttribute("data-copy-attached","true");const r=n.parentElement,o=document.createElement("div");o.className="copy-wrapper";const m=document.createElement("button");m.className="copy-btn",m.innerText="复制",m.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(n.innerText),m.innerText="已复制",setTimeout(()=>m.innerText="复制",1500)}catch{m.innerText="失败"}}),r.replaceWith(o),o.appendChild(m),o.appendChild(r)})}function We(e){let a="";for(;e>0;)e--,a=String.fromCharCode(65+e%26)+a,e=Math.floor(e/26);return a}async function Mt(e){const a={};a.id=e.id,a.ownerId=e.owner_id,a.ownerUsername=e.owner_username,a.ownerNickname=e.owner_nickname,a.title=e.title,a.startTime=new Date(e.start_time).toLocaleString(),a.endTime=new Date(e.end_time).toLocaleString(),a.createTime=new Date(e.create_time).toLocaleString(),a.updateTime=new Date(e.update_time).toLocaleString(),a.private=e.private;const n={math:{inlineDigit:!0,engine:"KaTeX"}};if(a.description=await _e.md2html(e.description,n),a.notification=e.notification,e.problems){a.problems=[],e.problems.sort((r,o)=>r.index-o.index);for(let r=0;r<e.problems.length;r++){const o=e.problems[r];let m={accept:0,attempt:0,author:"",id:"",private:!1,tags:[],title:""};m.index=o.index,m.id=We(o.index),m.title=o.title,o.accept?m.accept=o.accept:m.accept=0,o.attempt?m.attempt=o.attempt:m.attempt=0,a.problems.push(m)}}return a}function qn(e){return Q({url:"/contest?id="+e,method:"get"})}function Kn(e){return Q({url:"/contest/edit?id="+e,method:"get"})}function Fn(e){return Q({url:"/contest/problem/list?id="+e,method:"get"})}function Nn(e,a){return Q({url:"/contest/problem?id="+e+"&problem_index="+a,method:"get"})}function Gn(e,a){return Q({url:"/contest/list?page="+e+"&page_size="+a,method:"get"})}function On(e){return Q({url:"/contest/rank?id="+e,method:"get"})}function Hn(e){return Q({url:"/contest/create",method:"post",data:e})}function Bn(e){return Q({url:"/contest/edit",method:"post",data:e})}function Jn(e,a){return Q({url:"/contest/password",method:"post",data:{id:e,password:a}})}const qt=async(e,a)=>{a&&await e.push({name:"user",params:{username:a}})},Gt=async e=>{await Z.push({name:"problem-detail",params:{problemId:e}})},jt=async(e,a)=>{await Z.push({name:"contest-problem-detail",params:{contestId:e,problemIndex:a}})},Yn=["innerHTML"],Wn={key:0,class:"dida-problems-container"},Xn={style:{margin:"12px"}},Zn={key:1},Qn={class:"dida-operation-container"},eo={key:0,class:"dida-operation-container"},to={class:"dida-code-submit-div"},ao=re({__name:"ProblemDetail",setup(e){let a=he();const{globalProperties:n}=me();let r=null;const o=Ke(),m=Le();let y=d(""),b="",k=0,g=d(0);const u=d(!1),c=d(null),p=d(!1),_=d(null);let I=null;const i=d(null),v=d(!1),S=d(!1),C={},f=d(""),s=d([]);s.value=At();const w=d([]),h=Fe(()=>m.hasAuth(Me.ManageProblem)),$=V=>{V&&Z.push({name:"problem-list",query:{...a.query,title:"",tag:V.name}})},R=async()=>{let V=b;if(!V)try{const E=await Nn(k,g.value);E.code===0?V=E.data:J(n,E.code)}catch{ve(n,"获取题目ID失败，请稍后再试");return}await Z.push({name:"manage-problem",params:{problemId:V}})},A=()=>{b?Z.push({name:"judge-list",query:{problem_id:b}}):Z.push({name:"contest-judge",params:{contestId:k},query:{problem_id:We(g.value)}})},j=()=>{b?Z.push({name:"discuss-list-problem",query:{problem_id:b}}):Z.push({name:"contest-discuss",params:{contestId:k},query:{problem_id:We(g.value)}})},D=()=>{Z.push({name:"problem-recommend",params:{problemId:b}})},M=async()=>{var Y,W;const V=(Y=_.value)==null?void 0:Y.originOj,E=(W=_.value)==null?void 0:W.originId;if(!(!V||!E))try{v.value=!0;const q=await Ia(V,E);q.code===0?(await T(),ge(n,"更新成功")):J(n,q.code)}catch{ve(n,"更新失败，请稍后再试")}finally{v.value=!1}},z=async()=>{const V=parseInt(f.value);if(!bt(V)){ve(n,"请选择所编写的语言");return}const E=I==null?void 0:I.getValue();if(!E){ve(n,"请输入所需提交的代码");return}if(!b&&(!k||!g.value)){ve(n,"问题ID无效");return}S.value=!0;try{const Y=await hn(b,k,g.value,V,E);if(Y.code!==0){J(n,Y.code);return}ge(n,"提交成功，正在跳转到详情页面");const W=Y.data.id;k?await Z.push({name:"contest-judge-detail",params:{contestId:k,judgeId:W}}):await Z.push({name:"judge-detail",params:{judgeId:W}})}finally{S.value=!1}},P=V=>{if(!I)return;const E=I.getModel();E&&Nt.setModelLanguage(E,Et(V))},T=async()=>{w.value=[];let V=await Ca(b,k,g.value);if(V.code!==0){p.value=!1,J(n,V.code),await Z.push({name:"problem"});return}V.data.tags&&V.data.tags.forEach(W=>{C[W.id]=W}),_.value=ct(V.data.problem,C),o.setTitle(_.value.title+" - "+o.getTitle);let E=_.value.description;k&&(V=await Fn(k),V.code===0?(V.data.problems.sort((W,q)=>W-q),w.value=V.data.problems):J(n,V.code));const Y={math:{inlineDigit:!0,engine:"KaTeX"}};y.value=await _e.md2html(E,Y),await qe(()=>{c.value&&(_e.mathRender(c.value),_e.highlightRender({lineNumber:!0,enable:!0},c.value),tt(c.value),!I&&i.value&&(I=Nt.create(i.value,{value:"",language:"cpp",minimap:{enabled:!0},colorDecorators:!0,readOnly:!1,theme:"vs-dark"}))),p.value=!1})};return ie(async()=>{r=je(()=>a.params,async()=>{if(Array.isArray(a.params.problemId)?b=a.params.problemId[0]:b=a.params.problemId,!b){if(Array.isArray(a.params.contestId)?k=Number(a.params.contestId[0]):k=Number(a.params.contestId),!k){ve(n,"题目不存在"),await Z.push({name:"problem"});return}if(Array.isArray(a.params.problemIndex)?g.value=parseInt(a.params.problemIndex[0]):g.value=parseInt(a.params.problemIndex),!g.value){ve(n,"题目不存在"),await Z.push({name:"problem"});return}}u.value=!!k,p.value=!0,await T()},{immediate:!0})}),Te(()=>{r&&(r(),r=null)}),(V,E)=>{const Y=fe,W=Se,q=B,G=be,N=Oe,ye=at,Ie=Ge,H=zt,O=wt,oe=Ce,ee=xe;return L(),K(ee,{loading:p.value},{default:l(()=>[t(oe,{class:"dida-main-content"},{default:l(()=>[t(W,{span:8},{default:l(()=>[t(Y,{style:{margin:"10px"}},{default:l(()=>[U("div",{innerHTML:ce(y),ref_key:"markdownRef",ref:c},null,8,Yn)]),_:1})]),_:1}),t(W,{span:4},{default:l(()=>{var de;return[ce(k)?(L(),ae("div",Wn,[t(G,{style:{"flex-wrap":"wrap"}},{default:l(()=>[(L(!0),ae(ne,null,we(w.value,(se,te)=>(L(),K(q,{key:te,theme:se==ce(g)?"primary":"default",onClick:async()=>await ce(jt)(ce(k),se)},{default:l(()=>[x(F(ce(We)(se)),1)]),_:2},1032,["theme","onClick"]))),128))]),_:1})])):le("",!0),U("div",Xn,[t(Ie,{layout:"vertical",bordered:!0},{default:l(()=>{var se;return[t(N,{label:"标题"},{default:l(()=>{var te;return[x(F((te=_.value)==null?void 0:te.title),1)]}),_:1}),t(N,{label:"时间限制"},{default:l(()=>{var te;return[x(F((te=_.value)==null?void 0:te.timeLimit),1)]}),_:1}),t(N,{label:"内存限制"},{default:l(()=>{var te;return[x(F((te=_.value)==null?void 0:te.memoryLimit),1)]}),_:1}),t(N,{label:"判题方式"},{default:l(()=>{var te;return[x(F((te=_.value)==null?void 0:te.judgeType),1)]}),_:1}),u.value?le("",!0):(L(),K(N,{key:0,label:"正确提交"},{default:l(()=>{var te;return[x(F((te=_.value)==null?void 0:te.accept),1)]}),_:1})),u.value?le("",!0):(L(),K(N,{key:1,label:"提交总数"},{default:l(()=>{var te;return[x(F((te=_.value)==null?void 0:te.attempt),1)]}),_:1})),t(N,{label:"创建时间"},{default:l(()=>{var te;return[x(F((te=_.value)==null?void 0:te.insertTime),1)]}),_:1}),t(N,{label:"更新时间"},{default:l(()=>{var te;return[x(F((te=_.value)==null?void 0:te.updateTime),1)]}),_:1}),t(N,{label:"上传用户"},{default:l(()=>{var te;return[x(F((te=_.value)==null?void 0:te.creatorNickname),1)]}),_:1}),u.value?le("",!0):(L(),K(N,{key:2,label:"题目来源"},{default:l(()=>{var te,ke,X;return[(te=_.value)!=null&&te.sourceUrl?(L(),K(ye,{key:0,href:(ke=_.value)==null?void 0:ke.sourceUrl,target:"_blank"},{default:l(()=>{var pe;return[x(F((pe=_.value)==null?void 0:pe.source),1)]}),_:1},8,["href"])):(L(),ae("span",Zn,F((X=_.value)==null?void 0:X.source),1))]}),_:1})),h.value?(L(),K(N,{key:3,label:"是否私有"},{default:l(()=>{var te;return[x(F((te=_.value)!=null&&te.private?"私有":"公开"),1)]}),_:1})):le("",!0),(se=_.value)!=null&&se.originUrl?(L(),K(N,{key:4,label:"原题链接"},{default:l(()=>{var te;return[t(ye,{href:(te=_.value)==null?void 0:te.originUrl,target:"_blank"},{default:l(()=>{var ke,X;return[x(F((ke=_.value)==null?void 0:ke.originOj)+" - "+F((X=_.value)==null?void 0:X.originId),1)]}),_:1},8,["href"])]}),_:1})):le("",!0),ce(b)?(L(),K(N,{key:5,label:"标签"},{default:l(()=>[t(G,null,{default:l(()=>{var te;return[(L(!0),ae(ne,null,we((te=_.value)==null?void 0:te.tags,ke=>(L(),K(q,{key:ke.id,variant:"dashed",onClick:()=>$(ke)},{default:l(()=>[x(F(ke.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})):le("",!0)]}),_:1}),U("div",Qn,[t(G,null,{default:l(()=>[t(q,{onClick:A},{default:l(()=>E[1]||(E[1]=[x("提交记录")])),_:1}),t(q,{onClick:j},{default:l(()=>E[2]||(E[2]=[x("题目讨论")])),_:1}),ce(b)?(L(),K(q,{key:0,onClick:D},{default:l(()=>E[3]||(E[3]=[x("题目推荐")])),_:1})):le("",!0)]),_:1})]),h.value||(de=_.value)!=null&&de.originId?(L(),ae("div",eo,[t(G,null,{default:l(()=>{var se;return[h.value?(L(),K(q,{key:0,onClick:R},{default:l(()=>E[4]||(E[4]=[x("编辑")])),_:1})):le("",!0),(se=_.value)!=null&&se.originId?(L(),K(q,{key:1,onClick:M,loading:v.value},{default:l(()=>E[5]||(E[5]=[x("更新描述 ")])),_:1},8,["loading"])):le("",!0)]}),_:1})])):le("",!0),U("div",to,[t(G,null,{default:l(()=>[t(O,{modelValue:f.value,"onUpdate:modelValue":E[0]||(E[0]=se=>f.value=se),label:"语言：",placeholder:"请选择提交语言","auto-width":"",clearable:"",onChange:P},{default:l(()=>[(L(!0),ae(ne,null,we(s.value,se=>(L(),K(H,{key:se.value,value:se.value,label:se.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),t(q,{onClick:z,loading:S.value},{default:l(()=>E[6]||(E[6]=[x("提交")])),_:1},8,["loading"])]),_:1}),U("div",{ref_key:"codeEditRef",ref:i,class:"dida-code-editor"},null,512)])])]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),Ot=ue(ao,[["__scopeId","data-v-cd338f8f"]]),lo={style:{margin:"10px"}};function no(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Xe(e)}const oo=re({__name:"ProblemRecommend",setup(e){const a=he(),n=Ne(),{globalProperties:r}=me();let o=null,m="",y={},b={};const k=d([{title:"ID",colKey:"id",cell:(i,v)=>{let S=p(v.row.id);return t(B,{variant:"dashed",theme:S,onClick:()=>c(v.row.id)},{default:()=>[v.row.id]})}},{title:"标题",colKey:"title",cell:(i,v)=>t(B,{variant:"text",onClick:()=>c(v.row.id)},{default:()=>[v.row.title]})},{title:"标签",colKey:"tags",cell:(i,v)=>{const S=v.row.tags;if(!S||S.length===0)return"";let C=[];for(let f=0;f<S.length;f++){const s=S[f];C.push(t(B,{key:f,theme:"default",variant:"outline",size:"small",onClick:()=>_(s)},{default:()=>[s.name]}))}return t(be,null,no(C)?C:{default:()=>[C]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),g=d(!1),u=d(),c=i=>{i&&n.push({path:"/problem/"+i})},p=i=>{if(!i||!b)return"default";const v=b[i];if(!v)return"default";switch(v){case Je.Accept:return"success";case Je.Attempt:return"warning";default:return"default"}},_=i=>{i&&n.push({name:"problem-list",query:{tag:i.name}})},I=async i=>{g.value=!0;try{const v=await Vn(m);if(u.value=[],v.code===0){const S=v.data.list;if(!S||S.length<=0){ge(r,"暂无推荐题目");return}y={},v.data.tags&&v.data.tags.forEach(C=>{y[C.id]=C}),S.forEach(C=>{var s;const f=ct(C,y);(s=u.value)==null||s.push(f)})}else i&&J(r,v.code)}catch(v){console.error(v),J(r,ze())}finally{g.value=!1}};return ie(async()=>{g.value=!0,o=je(()=>a.query,i=>{Array.isArray(a.params.problemId)?m=a.params.problemId[0]:m=a.params.problemId,I(!0)},{immediate:!0})}),Te(()=>{o&&o()}),(i,v)=>{const S=Ve,C=fe,f=Se,s=Ce;return L(),K(s,null,{default:l(()=>[t(f,{span:9},{default:l(()=>[t(C,{style:{margin:"10px"}},{default:l(()=>[t(S,{data:u.value,columns:k.value,"row-key":"id","vertical-align":"top",hover:!0,"table-layout":"auto",loading:g.value},null,8,["data","columns","loading"])]),_:1})]),_:1}),t(f,{span:3},{default:l(()=>[U("div",lo,[t(C,{class:"sh-card",header:"题目推荐","header-bordered":!0},{default:l(()=>v[0]||(v[0]=[x(" 根据本站其他用户的提交记录推荐类似题目"),U("br",null,null,-1),x("依据推荐算法来计算，与本用户相似度最高的用户做的题，大概率被自己感兴趣。 ")])),_:1})])]),_:1})]),_:1})}}}),so=ue(oo,[["__scopeId","data-v-77972e8b"]]);async function Kt(e){const a={};if(a.id=e.id,a.ownerId=e.owner_id,a.ownerUsername=e.owner_username,a.ownerNickname=e.owner_nickname,a.title=e.title,e.start_time?a.startTime=new Date(e.start_time).toLocaleString():a.startTime="无限制",e.end_time?a.endTime=new Date(e.end_time).toLocaleString():a.endTime="无限制",e.update_time?a.updateTime=new Date(e.update_time).toLocaleString():a.updateTime="",e.create_time?a.createTime=new Date(e.create_time).toLocaleString():a.createTime="",e.description){const n={math:{inlineDigit:!0,engine:"KaTeX"}};a.description=await _e.md2html(e.description,n)}else a.description="";return a.problems=e.problems,a}function ro(e){return Q({url:"/collection?id="+e,method:"get"})}function uo(e){return Q({url:"/collection/edit?id="+e,method:"get"})}function io(e,a){return Q({url:"/collection/list?page="+e+"&page_size="+a,method:"get"})}function co(e){return Q({url:"/collection/rank?id="+e,method:"get"})}function mo(e){return Q({url:"/collection/create",method:"post",data:e})}function po(e){return Q({url:"/collection/edit",method:"post",data:e})}function fo(e){return Q({url:"/collection/join",method:"post",data:{id:e}})}function vo(e){return Q({url:"/collection/quit",method:"post",data:{id:e}})}const _o={style:{margin:"10px"}},go=re({__name:"CollectionList",setup(e){const a=he(),n=Ne(),{globalProperties:r}=me();let o=null;d(!1),d(!1);const m=d([{title:"ID",colKey:"id",width:"100",cell:(S,C)=>t(B,{variant:"text",onClick:()=>p(C.row.id)},{default:()=>[C.row.id]})},{title:"标题",colKey:"title",cell:(S,C)=>t(B,{variant:"text",onClick:()=>p(C.row.id)},{default:()=>[C.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),y=d(!1);let b=1,k=50;const g=d({current:b,pageSize:k,defaultCurrent:b,defaultPageSize:k,total:0,pageSizeOptions:[50,100]}),u=d(),c=d({title:"",username:""});d({title:"",description:"",open_time:[]});const p=S=>{S&&n.push({path:"/collection/"+S})},_=async()=>{await n.push({query:{...a.query,title:c.value.title,username:c.value.username,page:1,page_size:g.value.defaultPageSize}})},I=async(S,C)=>{var f;y.value=!0;try{const{current:s,pageSize:w}=S,h=await io(s,w);if(u.value=[],h.code===0){const $=h.data.list;for(let R=0;R<$.length;R++){const A=$[R],j=await Kt(A);(f=u.value)==null||f.push(j)}g.value={...g.value,total:h.data.total_count}}else C&&J(r,h.code)}catch(s){console.error(s),J(r,ze())}finally{y.value=!1}},i=async S=>{await n.push({query:{...a.query,page:S.current,page_size:S.pageSize}})},v=async()=>{await n.push({name:"collection-create"})};return ie(async()=>{o=je(()=>a.query,S=>{c.value.title=S.title||"",c.value.username=S.username||"";const C=parseInt(S.page)||g.value.defaultCurrent,f=parseInt(S.page_size)||g.value.defaultPageSize;b=C,k=f,g.value={...g.value,current:b,pageSize:k},I({current:b,pageSize:k},!0)},{immediate:!0})}),Te(()=>{o&&o()}),(S,C)=>{const f=Ve,s=fe,w=Se,h=Ae,$=Ue,R=B,A=$e,j=be,D=Ce;return L(),K(D,null,{default:l(()=>[t(w,{span:9},{default:l(()=>[t(s,{style:{margin:"10px"}},{default:l(()=>[t(f,{data:u.value,columns:m.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:g.value,loading:y.value,onPageChange:i},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(w,{span:3},{default:l(()=>[U("div",_o,[t(s,{class:"sh-card"},{default:l(()=>[t(A,{model:c.value},{default:l(()=>[t($,{label:"标题"},{default:l(()=>[t(h,{modelValue:c.value.title,"onUpdate:modelValue":C[0]||(C[0]=M=>c.value.title=M),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t($,{label:"负责人"},{default:l(()=>[t(h,{modelValue:c.value.username,"onUpdate:modelValue":C[1]||(C[1]=M=>c.value.username=M),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t($,null,{default:l(()=>[t(R,{theme:"primary",onClick:_},{default:l(()=>C[2]||(C[2]=[x("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(s,{class:"sh-card"},{default:l(()=>[t(j,null,{default:l(()=>[t(R,{onClick:v},{default:l(()=>C[3]||(C[3]=[x("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),bo=ue(go,[["__scopeId","data-v-29832c46"]]),ho={style:{margin:"20px"}},yo={class:"dida-operation-container"},wo={style:{margin:"12px"}},ko=["innerHTML"],Co=re({__name:"CollectionDetail",setup(e){let a=he();const{globalProperties:n}=me(),r=Ke(),o=Le();let m=0;const y=d(!1),b=d(null),k=d(!1),g=d(!1);let u={};const c=Fe(()=>o.hasAuth(Me.ManageCollection)||b.value&&o.getUserId==b.value.ownerId),p=C=>{if(!C||!u)return"default";const f=u[C];if(!f)return"default";switch(f){case Je.Accept:return"success";case Je.Attempt:return"warning";default:return"default"}},_=d([{title:"问题ID",colKey:"id",cell:(C,f)=>{const s=p(f.row.id);return t(B,{variant:"dashed",theme:s,onClick:async()=>await Gt(f.row.id)},{default:()=>[f.row.id]})}},{title:"标题",colKey:"title",cell:(C,f)=>t(B,{variant:"text",onClick:()=>Gt(f.row.id)},{default:()=>[f.row.title]})},{title:"正确",colKey:"accept",cell:(C,f)=>f.row.accept?f.row.accept:0},{title:"提交",colKey:"attempt",cell:(C,f)=>f.row.attempt?f.row.attempt:0}]),I=d([]),i=async()=>{if(!o.isLogin()){await Z.push({name:"login"});return}g.value=!0;try{const C=await fo(m);if(C.code!==0){J(n,C.code);return}k.value=!0,Be(n,"加入成功")}finally{g.value=!1}},v=async()=>{if(!o.isLogin()){await Z.push({name:"login"});return}g.value=!0;try{const C=await vo(m);if(C.code!==0){J(n,C.code);return}k.value=!1,Be(n,"退出成功")}finally{g.value=!1}},S=()=>{b.value&&Z.push({name:"collection-edit",params:{collectionId:b.value.id}})};return ie(async()=>{if(Array.isArray(a.params.collectionId)?m=Number(a.params.collectionId[0]):m=Number(a.params.collectionId),!m){await Z.push({name:"problem-collection-list"});return}k.value=!1,y.value=!0;const C=await ro(m);if(C.code!==0){y.value=!1,J(n,C.code),await Z.push({name:"problem-collection-list"});return}k.value=C.data.joined,u=C.data.attempt_status||{},b.value=await Kt(C.data.collection),I.value=[],C.data.collection.problems&&C.data.collection.problems.forEach(f=>{const s=C.data.problems.find(w=>w.id===f);I.value.push(s)}),r.setTitle(b.value.title+" - "+r.getTitle),await qe(()=>{const f=document.querySelectorAll(".dida-content-description");f&&f.length>0&&f.forEach(s=>{_e.mathRender(s),_e.highlightRender({lineNumber:!0,enable:!0},s),tt(s)}),y.value=!1})}),(C,f)=>{const s=ca,w=ia,h=Ve,$=fe,R=Se,A=B,j=be,D=Oe,M=Ge,z=Ce,P=xe;return L(),K(P,{loading:y.value},{default:l(()=>[t(z,{class:"dida-main-content"},{default:l(()=>[t(R,{span:6},{default:l(()=>[U("div",ho,[t(w,{"max-item-width":"300"},{default:l(()=>[t(s,{to:{name:"problem-collection-list"}},{default:l(()=>f[0]||(f[0]=[x("题目集合")])),_:1}),t(s,null,{default:l(()=>{var T;return[x(F((T=b.value)==null?void 0:T.title),1)]}),_:1})]),_:1})]),t($,{style:{margin:"10px"}},{default:l(()=>[t(h,{data:I.value,columns:_.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),_:1})]),_:1}),t(R,{span:6},{default:l(()=>{var T;return[U("div",yo,[t(j,null,{default:l(()=>[k.value?(L(),K(A,{key:0,onClick:v,loading:g.value},{default:l(()=>f[1]||(f[1]=[x("退出")])),_:1},8,["loading"])):(L(),K(A,{key:1,onClick:i,loading:g.value},{default:l(()=>f[2]||(f[2]=[x("加入")])),_:1},8,["loading"])),c.value?(L(),K(A,{key:2,onClick:S},{default:l(()=>f[3]||(f[3]=[x("编辑")])),_:1})):le("",!0)]),_:1})]),U("div",wo,[t(M,{layout:"vertical",bordered:!0},{default:l(()=>[t(D,{label:"创建者"},{default:l(()=>{var V;return[x(F((V=b.value)==null?void 0:V.ownerNickname),1)]}),_:1})]),_:1}),t(M,{layout:"vertical",bordered:!0},{default:l(()=>[t(D,{label:"开始时间"},{default:l(()=>{var V;return[x(F((V=b.value)==null?void 0:V.startTime),1)]}),_:1})]),_:1}),t(M,{layout:"vertical",bordered:!0},{default:l(()=>[t(D,{label:"结束时间"},{default:l(()=>{var V;return[x(F((V=b.value)==null?void 0:V.endTime),1)]}),_:1})]),_:1})]),(T=b.value)!=null&&T.description?(L(),K($,{key:0,style:{margin:"10px"}},{default:l(()=>{var V;return[U("div",{innerHTML:(V=b.value)==null?void 0:V.description,class:"dida-content-description"},null,8,ko)]}),_:1})):le("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),So=ue(Co,[["__scopeId","data-v-71d8f555"]]),Io=re({__name:"CollectionRank",setup(e){const a=he(),n=Ne(),{globalProperties:r}=me();let o=null,m=0,y=0;const b=d([{title:"Rank",colKey:"rank",align:"center"},{title:"序号",colKey:"index",align:"center"},{title:"Username",colKey:"username",cell:(p,_)=>t(B,{variant:"text",onClick:()=>n.push({name:"user",params:{username:_.row.username}})},{default:()=>[_.row.username]})},{title:"昵称",colKey:"nickname",cell:(p,_)=>t(B,{variant:"text",onClick:()=>n.push({name:"user",params:{username:_.row.username}})},{default:()=>[_.row.nickname]})},{title:"Count",colKey:"count",cell:(p,_)=>t(B,{variant:"text",onClick:()=>n.push({name:"judge-list",query:{username:_.row.username,status:De.Accept}})},{default:()=>[`${_.row.accept} / ${y}`]})},{title:"Progress",colKey:"progress",cell:(p,_)=>{let I=100;return y>0&&(I=Number((_.row.accept/y*100).toFixed(2))),t(da,{percentage:I},null)}}]),k=d(!1),g=d([]),u=({col:p,rowIndex:_})=>{let I=1;for(let i=_+1;i<g.value.length&&g.value[i].rank===g.value[_].rank;i++)I++;if(p.colKey==="rank")return{rowspan:I}},c=async p=>{k.value=!0;try{const _=await co(m);if(g.value=[],_.code===0){y=_.data.problem;const I=_.data.ranks,i=[];if(I){for(let C=0;C<I.length;C++){const f=I[C];let s={userId:f.author_id,username:f.author_username,nickname:f.author_nickname};s.accept=f.accept,i.push(s)}i.sort((C,f)=>C.accept!==f.accept?f.accept-C.accept:C.userId-f.userId);let v=0,S=-1;for(let C=0;C<i.length;C++)i[C].accept!==S&&(v=C+1,S=i[C].accept),i[C].index=C+1,i[C].rank=v}g.value=i}else p&&J(r,_.code)}catch(_){console.error(_),J(r,ze())}finally{k.value=!1}};return ie(async()=>{o=je(()=>a.query,async()=>{if(Array.isArray(a.params.collectionId)?m=Number(a.params.collectionId[0]):m=Number(a.params.collectionId),!m){await n.push({name:"problem-collection-list"});return}await c(!0)},{immediate:!0})}),Te(()=>{o&&o()}),(p,_)=>{const I=Ve,i=fe,v=Ce;return L(),K(v,null,{default:l(()=>[t(i,{style:{margin:"10px"}},{default:l(()=>[U("div",null,[t(I,{data:g.value,columns:b.value,"row-key":"index","rowspan-and-colspan":u,"vertical-align":"middle",bordered:!0,hover:!0,loading:k.value},null,8,["data","columns","loading"])])]),_:1})]),_:1})}}});var Pe=(e=>(e[e.Valid=0]="Valid",e[e.Duplicate=1]="Duplicate",e[e.Invalid=2]="Invalid",e))(Pe||{});const Po={class:"dida-form-border"},xo={style:{"text-align":"right"}},To=re({name:"ParseProblemList",__name:"ParseProblemList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:a}=me(),n=d(!1),r=d(!1),o=d(""),m=oa(e,"modelValue");let y=[];je(m,async p=>{JSON.stringify(p)!==JSON.stringify(y)&&(await g(p),y=m.value)},{deep:!0});const b=d([]),k=d([{title:"有效性",colKey:"validType",cell:(p,_)=>{switch(_.row.valid){case Pe.Valid:return t(et,{theme:"success"},{default:()=>[x("有效")]});case Pe.Duplicate:return t(et,{theme:"warning"},{default:()=>[x("重复")]});case Pe.Invalid:return t(et,{theme:"danger"},{default:()=>[x("无效")]});default:return null}}},{title:"问题ID",colKey:"id"},{title:"标题",colKey:"title"}]),g=async p=>{const _=Array.from(new Set(p)),I=await $n(_);if(I.code!==0){J(a,I.code),r.value=!1;return}const i=[],v=I.data.problems;let S=[];p.forEach(C=>{const f=v.find(s=>s.id===C);if(f){const s=i.find(w=>w.id===C);f.valid=s?Pe.Duplicate:Pe.Valid,i.push({id:C,title:f.title,valid:f.valid}),s||S.push(C)}else i.push({id:C,title:"-",valid:Pe.Invalid})}),b.value=i,y=S,m.value=S},u=async()=>{r.value=!0;const p=ba(o.value);await g(p),n.value=!1,r.value=!1},c=()=>{b.value?o.value=b.value.map(p=>p.id).join(`
`):o.value="",n.value=!0};return(p,_)=>{const I=B,i=Ve,v=kt,S=Ze;return L(),ae(ne,null,[U("div",Po,[U("div",xo,[t(I,{onClick:c},{default:l(()=>_[2]||(_[2]=[x("编辑")])),_:1})]),t(i,{data:b.value,columns:k.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(S,{visible:n.value,"onUpdate:visible":_[1]||(_[1]=C=>n.value=C),onConfirm:u,header:"请输入问题ID","confirm-loading":r.value},{default:l(()=>[_[3]||(_[3]=U("div",{style:{"margin-bottom":"10px"}},[U("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(v,{modelValue:o.value,"onUpdate:modelValue":_[0]||(_[0]=C=>o.value=C),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Pa=ue(To,[["__scopeId","data-v-b0352688"]]),Vo={class:"dida-form-border"},Lo={style:{"text-align":"right"}},jo=re({name:"ParseUserList",__name:"ParseUserList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:a}=me(),n=d(!1),r=d(!1),o=d(""),m=oa(e,"modelValue");let y=[];je(m,async I=>{JSON.stringify(I)!==JSON.stringify(y)&&(y=I,await u(I))},{deep:!0});const b=d(),k=d([{title:"有效性",colKey:"validType",cell:(I,i)=>{switch(i.row.valid){case Pe.Valid:return t(et,{theme:"success"},{default:()=>[x("有效")]});case Pe.Duplicate:return t(et,{theme:"warning"},{default:()=>[x("重复")]});case Pe.Invalid:return t(et,{theme:"danger"},{default:()=>[x("无效")]})}}},{title:"Username",colKey:"username"},{title:"昵称",colKey:"nickname"}]),g=(I,i)=>{if(I.code!==0){J(a,I.code),r.value=!1;return}const v=[],S=I.data.users;let C=[];i?i.forEach(f=>{let s=null;if(S&&(s=S.find(w=>w.username.toLowerCase()===f.toLowerCase())),s){const w=v.find($=>$.username.toLowerCase()===f.toLowerCase()),h=w?Pe.Duplicate:Pe.Valid;v.push({id:s.id,username:s.username,nickname:s.nickname,valid:h}),w||C.push(s.id)}else v.push({id:-1,username:f,nickname:"-",valid:Pe.Invalid})}):S&&S.forEach(f=>{const s=v.find(h=>h.id===f.id),w=s?Pe.Duplicate:Pe.Valid;v.push({id:f.id,username:f.username,nickname:f.nickname,valid:w}),s||C.push(f.id)}),b.value=v,y=C,m.value=C},u=async I=>{const i=Array.from(new Set(I)),v=await Wl(i);g(v)},c=async I=>{const i=Array.from(new Set(I)),v=await Xl(i);g(v,I)},p=async()=>{r.value=!0;const I=ba(o.value);await c(I),n.value=!1,r.value=!1},_=()=>{b.value?o.value=b.value.map(I=>I.username).join(`
`):o.value="",n.value=!0};return(I,i)=>{const v=B,S=Ve,C=kt,f=Ze;return L(),ae(ne,null,[U("div",Vo,[U("div",Lo,[t(v,{onClick:_},{default:l(()=>i[2]||(i[2]=[x("编辑")])),_:1})]),t(S,{data:b.value,columns:k.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(f,{visible:n.value,"onUpdate:visible":i[1]||(i[1]=s=>n.value=s),onConfirm:p,header:"请输入用户Username","confirm-loading":r.value},{default:l(()=>[i[3]||(i[3]=U("div",{style:{"margin-bottom":"10px"}},[U("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(C,{modelValue:o.value,"onUpdate:modelValue":i[0]||(i[0]=s=>o.value=s),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),xa=ue(jo,[["__scopeId","data-v-b0b99852"]]),Do={style:{margin:"10px"}},zo={style:{margin:"12px"}},$o={class:"dida-edit-container"},Uo=re({__name:"CollectionEdit",setup(e){let a=he();const{globalProperties:n}=me(),r=Ke(),o=d(""),m=d(!1);let y=null;const b=d(!1),k=d(!1),g=d(null),u=d({title:"",openTime:[],private:!0,problems:[],members:[],description:""}),c=d(""),p=d(""),_=d(!1),I=async()=>{_.value=!0,k.value=!1,_.value=!1},i=async()=>{if(y){b.value=!0;try{const f={title:u.value.title,description:y.getValue(),problems:u.value.problems,members:u.value.members,private:u.value.private};u.value.openTime[0]&&(f.start_time=new Date(u.value.openTime[0])),u.value.openTime[1]&&(f.end_time=new Date(u.value.openTime[1]));const s=await mo(f);if(b.value=!0,s.code!==0){J(n,s.code);return}s.data!=null&&await Z.push({name:"collection-detail",params:{collectionId:s.data}}),Be(n,"创建成功")}finally{b.value=!1}}},v=async()=>{if(y){b.value=!0;try{const f={id:Number(o.value),title:u.value.title,private:u.value.private,problems:u.value.problems,members:u.value.members,description:y.getValue()};u.value.openTime[0]&&(f.start_time=new Date(u.value.openTime[0])),u.value.openTime[1]&&(f.end_time=new Date(u.value.openTime[1]));const s=await po(f);if(b.value=!0,s.code!==0){J(n,s.code);return}s.data!=null&&g.value&&(g.value.updateTime=new Date(s.data).toLocaleString()),Be(n,"保存成功")}finally{b.value=!1}}},S=f=>{const s={after:()=>{y==null||y.setValue(f),m.value=!1}};y=new _e("collectionEditDiv",s)},C=async()=>{const f=await uo(o.value);if(f.code!==0){J(n,f.code),console.error("collection get failed",f.code),await Z.push({name:"problem-collection-list"});return}const s=f.data.collection;g.value=await Kt(s),u.value.title=s.title,u.value.openTime=[],s.start_time?u.value.openTime.push(new Date(s.start_time)):u.value.openTime.push(""),s.end_time?u.value.openTime.push(new Date(s.end_time)):u.value.openTime.push(""),u.value.private=s.private,u.value.description=s.description,u.value.problems=s.problems,u.value.members=s.members,r.setTitle(s.title+" - "+r.getTitle);let w="";s.description&&(w=s.description),S(w)};return ie(async()=>{Array.isArray(a.params.collectionId)?o.value=a.params.collectionId[0]:o.value=a.params.collectionId,o.value?(m.value=!0,await C()):S("")}),(f,s)=>{const w=Ae,h=Ue,$=ma,R=it,A=$e,j=fe,D=Se,M=B,z=be,P=Oe,T=Ge,V=Ce,E=xe,Y=kt,W=Ze;return L(),ae(ne,null,[t(E,{loading:m.value},{default:l(()=>[t(V,null,{default:l(()=>[t(D,{span:8},{default:l(()=>[U("div",Do,[t(j,{class:"sh-card"},{default:l(()=>[t(A,{model:u.value},{default:l(()=>[t(h,{label:"标题"},{default:l(()=>[t(w,{modelValue:u.value.title,"onUpdate:modelValue":s[0]||(s[0]=q=>u.value.title=q),placeholder:"题集标题"},null,8,["modelValue"])]),_:1}),t(h,{label:"开启时间"},{default:l(()=>[t($,{modelValue:u.value.openTime,"onUpdate:modelValue":s[1]||(s[1]=q=>u.value.openTime=q),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(h,{label:"私有"},{default:l(()=>[t(R,{modelValue:u.value.private,"onUpdate:modelValue":s[2]||(s[2]=q=>u.value.private=q)},null,8,["modelValue"])]),_:1}),t(h,{label:"成员"},{default:l(()=>[t(xa,{modelValue:u.value.members,"onUpdate:modelValue":s[3]||(s[3]=q=>u.value.members=q)},null,8,["modelValue"])]),_:1}),t(h,{label:"问题"},{default:l(()=>[t(Pa,{modelValue:u.value.problems,"onUpdate:modelValue":s[4]||(s[4]=q=>u.value.problems=q)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(D,{span:4},{default:l(()=>[U("div",zo,[U("div",$o,[o.value?(L(),K(z,{key:0},{default:l(()=>[t(M,{onClick:v,theme:"danger",loading:b.value},{default:l(()=>s[7]||(s[7]=[x("保存")])),_:1},8,["loading"])]),_:1})):(L(),K(z,{key:1},{default:l(()=>[t(M,{onClick:i,theme:"danger",loading:b.value},{default:l(()=>s[8]||(s[8]=[x("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(L(),K(T,{key:0,layout:"vertical",bordered:!0},{default:l(()=>[t(P,{label:"创建时间"},{default:l(()=>{var q;return[x(F((q=g.value)==null?void 0:q.createTime),1)]}),_:1}),t(P,{label:"更新时间"},{default:l(()=>{var q;return[x(F((q=g.value)==null?void 0:q.updateTime),1)]}),_:1}),t(P,{label:"创建用户"},{default:l(()=>{var q;return[x(F((q=g.value)==null?void 0:q.ownerNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),s[9]||(s[9]=U("div",{id:"collectionEditDiv",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"]),t(W,{visible:k.value,"onUpdate:visible":s[6]||(s[6]=q=>k.value=q),onConfirm:I,header:c.value,"confirm-loading":_.value},{default:l(()=>[s[10]||(s[10]=U("div",{style:{"margin-bottom":"10px"}},[U("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(Y,{modelValue:p.value,"onUpdate:modelValue":s[5]||(s[5]=q=>p.value=q),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),Ht=ue(Uo,[["__scopeId","data-v-c2aec1ce"]]),Ao=["innerHTML"];function Bt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Xe(e)}const Ro=re({__name:"JudgeJobList",setup(e){const a=he(),n=Ne(),{globalProperties:r}=me();let o=!1,m=null,y;const b=d(!1),k=d(null),g=d(null),u=d(!1);let c=-1;const p=d({problemId:"",username:"",language:void 0,status:void 0}),_=d([{title:"ID",colKey:"id",cell:(P,T)=>{let V=null;return ht(T.row.status)&&bt(T.row.language)&&(V=()=>{R(T.row.id)}),t(B,{variant:"text",onClick:V},{default:()=>[T.row.id]})}},{title:"问题",colKey:"problemId",cell:(P,T)=>{if(c){let V;return t(B,{variant:"text",onClick:()=>$(c,T.row.contestProblemIndex)},Bt(V=We(T.row.contestProblemIndex))?V:{default:()=>[V]})}return t(B,{variant:"text",onClick:()=>h(T.row.problemId)},{default:()=>[T.row.problemId]})}},{title:"状态",colKey:"status",align:"center",cell:(P,T)=>{let V=null;ht(T.row.status)&&bt(T.row.language)&&(V=()=>{R(T.row.id)});const E=T.row.status,Y=yt(E);let W=!ht(E);const q=ya(E);let G=[];return ot(E)&&G.push(t(xe,{text:T.row.state,size:"small",class:"dida-status-loading"},null)),G.push(t("span",null,[Y])),t(B,{theme:q,variant:"outline",onClick:V,disabled:W},Bt(G)?G:{default:()=>[G]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"code",cell:(P,T)=>{let V=!bt(T.row.language);return t(B,{theme:"default",onClick:()=>w(T.row),disabled:V},{default:()=>[Rt(T.row.language)+" / "+T.row.codeLength]})}},{title:"作者",colKey:"author",width:200,cell:(P,T)=>t(B,{variant:"text",onClick:()=>A(T.row.authorUsername)},{default:()=>[T.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),I=d(!1);let i=1,v=50;const S=d({current:i,pageSize:v,defaultCurrent:i,defaultPageSize:v,total:0,pageSizeOptions:[50,100]}),C=d(),f=d([]);f.value=At();const s=d([]);s.value=wa();const w=async P=>{u.value=!0,b.value=!0;try{k.value=P;const T=await wn(Number(k.value.id));if(T.code===0){const V=T.data,Y=`\`\`\`${Et(V.language)}
${V.code}
\`\`\``,W={};k.value.code=await _e.md2html(Y,W),await qe(()=>{g.value&&(_e.highlightRender({lineNumber:!0,enable:!0},g.value),tt(g.value))})}else J(r,T.code)}finally{u.value=!1}},h=P=>{P&&n.push({path:"/problem/"+P})},$=(P,T)=>{n.push({name:"contest-problem-detail",params:{contestId:P,problemIndex:T}})},R=P=>{P&&(c>0?n.push({name:"contest-judge-detail",params:{contestId:c,judgeId:P}}):n.push({name:"judge-detail",params:{judgeId:P}}))},A=P=>{P&&n.push({path:"/user/"+P})},j=async()=>{await n.push({query:{...a.query,page:1,page_size:v,problem_id:p.value.problemId,username:p.value.username,language:p.value.language,status:p.value.status}})},D=async()=>{p.value.problemId="",p.value.username="",p.value.language=void 0,p.value.status=void 0,await n.push({query:{...a.query,page:1,page_size:v,problem_id:"",username:"",language:void 0,status:void 0}})},M=async(P,T)=>{T&&(I.value=!0);let V=!1;try{const{current:E,pageSize:Y}=P,W=await kn(c,p.value.problemId,p.value.username,p.value.language,p.value.status,E,Y);if(C.value=[],W.code===0){if(!W.data.has_auth){ge(r,"您目前没有权限查看评测记录"),c?await n.push({name:"contest-detail",params:{contestId:c}}):await n.push({name:"judge-list"});return}W.data.list&&W.data.list.length>0?(W.data.list.forEach(G=>{var ye;const N=ka(G);(ye=C.value)==null||ye.push(N),ot(G.status)&&(V=!0)}),S.value={...S.value,total:W.data.total_count}):(ge(r,"未找到记录"),S.value={...S.value,total:0})}else T&&J(r,W.code)}catch(E){console.error(E),T&&J(r,ze())}finally{T&&(I.value=!1),V&&o&&(y=setTimeout(()=>{M({current:i,pageSize:v},!1)},5e3))}},z=async P=>{await n.push({query:{...a.query,page:P.current,page_size:P.pageSize}})};return ie(async()=>{o=!0,m=je(()=>a.query,P=>{Array.isArray(a.params.contestId)?c=Number(a.params.contestId[0]):c=Number(a.params.contestId),p.value.problemId=P.problem_id||"",p.value.username=P.username||"",P.language!=null?p.value.language=Number(P.language):p.value.language=void 0,P.status!=null?p.value.status=Number(P.status):p.value.status=void 0;const T=parseInt(P.page)||S.value.defaultCurrent,V=parseInt(P.page_size)||S.value.defaultPageSize;i=T,v=V,S.value.pageSizeOptions.includes(v)||(v=S.value.defaultPageSize),S.value={...S.value,current:i,pageSize:v},M({current:i,pageSize:v},!0)},{immediate:!0})}),Te(()=>{o=!1,m&&m(),clearTimeout(y)}),(P,T)=>{const V=Ae,E=Ue,Y=zt,W=wt,q=B,G=be,N=$e,ye=Ve,Ie=fe,H=at,O=xe,oe=Ze;return L(),ae(ne,null,[t(Ie,{style:{margin:"10px"}},{default:l(()=>[t(N,{layout:"inline",onSubmit:j,onReset:D},{default:l(()=>[t(E,{label:"题号"},{default:l(()=>[t(V,{modelValue:p.value.problemId,"onUpdate:modelValue":T[0]||(T[0]=ee=>p.value.problemId=ee),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(E,{label:"用户"},{default:l(()=>[t(V,{modelValue:p.value.username,"onUpdate:modelValue":T[1]||(T[1]=ee=>p.value.username=ee),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(E,{label:"语言"},{default:l(()=>[t(W,{modelValue:p.value.language,"onUpdate:modelValue":T[2]||(T[2]=ee=>p.value.language=ee),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:l(()=>[(L(!0),ae(ne,null,we(f.value,ee=>(L(),K(Y,{key:ee.value,value:ee.value,label:ee.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(E,{label:"状态"},{default:l(()=>[t(W,{modelValue:p.value.status,"onUpdate:modelValue":T[3]||(T[3]=ee=>p.value.status=ee),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:l(()=>[(L(!0),ae(ne,null,we(s.value,ee=>(L(),K(Y,{key:ee.value,value:ee.value,label:ee.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(E,null,{default:l(()=>[t(G,null,{default:l(()=>[t(q,{theme:"primary",type:"submit"},{default:l(()=>T[7]||(T[7]=[x("搜索")])),_:1}),t(q,{theme:"default",variant:"base",type:"reset"},{default:l(()=>T[8]||(T[8]=[x("重置")])),_:1})]),_:1})]),_:1})]),_:1}),t(ye,{data:C.value,columns:_.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:S.value,loading:I.value,onPageChange:z,"table-layout":"auto"},null,8,["data","columns","pagination","loading"])]),_:1}),t(oe,{visible:b.value,"onUpdate:visible":T[5]||(T[5]=ee=>b.value=ee),width:"800px","cancel-btn":null,"close-btn":!1,onConfirm:T[6]||(T[6]=ee=>b.value=!1)},{header:l(()=>[t(H,{onClick:T[4]||(T[4]=()=>{var ee;R((ee=k.value)==null?void 0:ee.id)})},{default:l(()=>{var ee,de;return[x(F(((ee=k.value)==null?void 0:ee.id)+" - "+((de=k.value)==null?void 0:de.language)),1)]}),_:1})]),default:l(()=>[t(O,{loading:u.value},{default:l(()=>{var ee;return[U("div",{innerHTML:(ee=k.value)==null?void 0:ee.code,ref_key:"markdownCodeRef",ref:g,style:{"min-height":"100px"}},null,8,Ao)]}),_:1},8,["loading"])]),_:1},8,["visible"])],64)}}}),Jt=ue(Ro,[["__scopeId","data-v-172ab9e7"]]),Eo={class:"dida-code-container"},Mo=["innerHTML"],qo={key:2,class:"dida-edit-container"};function Yt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Xe(e)}const Ko=re({__name:"JudgeJobDetail",setup(e){const a=he(),n=Ne(),r=Le(),{globalProperties:o}=me();let m=!1,y,b=0,k=0;const g=d(""),u=d(null),c=d(""),p=d(null),_=d(0),I=d(null),i=d({from:"#5a96ff",to:"#00A870"});let v=!1;const S=d([{title:"ID",colKey:"id"},{title:"问题",colKey:"problemId",cell:(M,z)=>t(B,{variant:"text",onClick:()=>$(z.row.problemId)},{default:()=>[z.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(M,z)=>{const P=z.row.status,T=yt(P),V=ya(P);let E=[];return ot(P)&&E.push(t(xe,{text:z.row.state,size:"small",class:"dida-status-loading"},null)),E.push(t("span",null,[T])),t(B,{theme:V,variant:"outline"},Yt(E)?E:{default:()=>[E]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"language",cell:(M,z)=>t("span",null,[Rt(z.row.language)+" / "+z.row.codeLength])},{title:"作者",colKey:"author",width:200,cell:(M,z)=>t(B,{variant:"text",onClick:()=>R(z.row.authorUsername)},{default:()=>[z.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),C=d(!1),f=d(!1),s=d(),w=Fe(()=>r.hasAuth(Me.ManageJudge)),h=async()=>{if(!f.value){f.value=!0;try{const M=await Pn(b);M.code===0?await j(!0):J(o,M.code)}catch(M){console.error(M),J(o,ze())}finally{f.value=!1}}},$=M=>{M&&n.push({path:"/problem/"+M})},R=M=>{M&&n.push({path:"/user/"+M})},A=M=>{const z=M.status,P=yt(z);let T;switch(z){case De.Init:case De.Rejudge:case De.Compiling:case De.Running:T="default";break;case De.Accept:T="success";break;case De.PE:T="warning";break;default:T="danger";break}return t(be,null,{default:()=>[t(B,{theme:"default",variant:"outline"},{default:()=>[M.taskId]}),t(B,{theme:T,variant:"outline"},Yt(P)?P:{default:()=>[P]}),t("span",null,[x("分数："),M.score]),t("span",null,[x("用时："),M.time]),t("span",null,[x("内存："),M.memory])]})},j=async M=>{var P;M&&(C.value=!0);let z=!1;try{const T=await yn(b);if(s.value=[],T.code===0){const V=T.data,E=ka(V);if((P=s.value)==null||P.push(E),V.judger){const W=await _a(V.judger);g.value=W.name}else g.value="";i.value.to="#00A870",ot(V.status)?(I.value="active",E.taskTotal>0?(_.value=E.taskCurrent/E.taskTotal*100,E.taskCurrent>=E.taskTotal&&(_.value=99)):_.value=0):(_.value=100,V.status===De.Accept?I.value="success":V.status===De.PE?(i.value.to="#F57C20",I.value="warning"):(i.value.to="#F56C6C",I.value="error"));const Y={};if(V.code){const q=`\`\`\`${Et(V.language)}
${V.code}
\`\`\``;c.value=await _e.md2html(q,Y),await qe(()=>{p.value&&(v||(v=!0,_e.highlightRender({lineNumber:!0,enable:!0},p.value)),tt(p.value))})}u.value=E,ot(V.status)&&(z=!0)}else M&&J(o,T.code),k?await n.push({name:"contest-judge",params:{contestId:k}}):await n.push({name:"judge-list"})}catch(T){console.error(T),M&&J(o,ze())}finally{M&&(C.value=!1),z&&m&&(y=setTimeout(()=>{j(!1)},5e3))}};function D(){p.value&&p.value.parentElement&&(p.value.style.maxWidth=p.value.parentElement.clientWidth+"px")}return ie(async()=>{if(m=!0,Array.isArray(a.params.judgeId)?b=Number(a.params.judgeId[0]):b=Number(a.params.judgeId),Array.isArray(a.params.contestId)?k=Number(a.params.contestId[0]):k=Number(a.params.contestId),!b){await n.push({name:"judge"});return}await j(!0),D(),window.addEventListener("resize",D)}),Te(()=>{m=!1,window.removeEventListener("resize",D),clearTimeout(y)}),(M,z)=>{var Ie,H,O;const P=da,T=Ve,V=fe,E=Se,Y=Oe,W=Ge,q=Ce,G=ll,N=nl,ye=B;return L(),ae(ne,null,[t(P,{color:i.value,status:I.value,class:"dida-job-progress",percentage:_.value},null,8,["color","status","percentage"]),t(V,{style:{margin:"10px"}},{default:l(()=>[t(T,{data:s.value,columns:S.value,"row-key":"id","vertical-align":"top",hover:!0,loading:C.value},null,8,["data","columns","loading"])]),_:1}),t(q,null,{default:l(()=>[t(E,{span:8},{default:l(()=>[U("div",Eo,[U("div",{innerHTML:c.value,ref_key:"markdownCodeRef",ref:p,class:"dida-code-div"},null,8,Mo)])]),_:1}),t(E,{span:4},{default:l(()=>[t(W,{layout:"vertical",bordered:!0,style:{margin:"10px"}},{default:l(()=>[t(Y,{label:"判题机"},{default:l(()=>[x(F(g.value),1)]),_:1}),t(Y,{label:"判题时间"},{default:l(()=>{var oe;return[x(F((oe=u.value)==null?void 0:oe.judgeTime),1)]}),_:1})]),_:1})]),_:1})]),_:1}),(Ie=u.value)!=null&&Ie.compileMessage?(L(),K(V,{key:0,class:"compile-message"},{default:l(()=>{var oe;return[x(F((oe=u.value)==null?void 0:oe.compileMessage),1)]}),_:1})):le("",!0),(H=u.value)!=null&&H.task&&((O=u.value)==null?void 0:O.task.length)>0?(L(),K(N,{key:1,class:"task-panel"},{default:l(()=>{var oe;return[(L(!0),ae(ne,null,we((oe=u.value)==null?void 0:oe.task,(ee,de)=>(L(),K(G,{key:ee.taskId,header:()=>A(ee)},{default:l(()=>[x(F(ee.content)+" "+F(ee.waHint),1)]),_:2},1032,["header"]))),128))]}),_:1})):le("",!0),w.value?(L(),ae("div",qo,[t(ye,{onClick:h,loading:f.value},{default:l(()=>z[0]||(z[0]=[x("重新评测")])),_:1},8,["loading"])])):le("",!0)],64)}}}),Wt=ue(Ko,[["__scopeId","data-v-23d2dc0c"]]),Fo={style:{margin:"10px"}},No=re({__name:"ContestList",setup(e){const a=he(),n=Ne(),{globalProperties:r}=me();let o=null;const m=d([{title:"ID",colKey:"id",cell:(S,C)=>t(B,{variant:"text",onClick:()=>p(C.row.id)},{default:()=>[C.row.id]})},{title:"标题",colKey:"title",cell:(S,C)=>t(B,{variant:"text",onClick:()=>p(C.row.id)},{default:()=>[C.row.title]})},{title:"负责人",colKey:"ownerNickname",cell:(S,C)=>t(B,{variant:"text",onClick:()=>qt(n,C.row.ownerUsername)},{default:()=>[C.row.ownerNickname]})},{title:"权限",colKey:"private",cell:(S,C)=>C.row.private?"私有":"公开"},{title:"开始时间",colKey:"startTime"},{title:"结束时间",colKey:"endTime"}]),y=d(!1);let b=1,k=50;const g=d({current:b,pageSize:k,defaultCurrent:b,defaultPageSize:k,total:0,pageSizeOptions:[50,100]}),u=d(),c=d({title:"",username:""}),p=S=>{S&&n.push({path:"/contest/"+S})},_=async()=>{await n.push({query:{...a.query,title:c.value.title,username:c.value.username,page:1,page_size:g.value.defaultPageSize}})},I=async(S,C)=>{var f;y.value=!0;try{const{current:s,pageSize:w}=S,h=await Gn(s,w);if(u.value=[],h.code===0){const $=h.data.list;for(let R=0;R<$.length;R++){const A=$[R],j=await Mt(A);(f=u.value)==null||f.push(j)}g.value={...g.value,total:h.data.total_count}}else C&&J(r,h.code)}catch(s){console.error(s),J(r,ze())}finally{y.value=!1}},i=async S=>{await n.push({query:{...a.query,page:S.current,page_size:S.pageSize}})},v=()=>{n.push({name:"contest-create"})};return ie(async()=>{o=je(()=>a.query,S=>{c.value.title=S.title||"",c.value.username=S.username||"";const C=parseInt(S.page)||g.value.defaultCurrent,f=parseInt(S.page_size)||g.value.defaultPageSize;b=C,k=f,g.value={...g.value,current:b,pageSize:k},I({current:b,pageSize:k},!0)},{immediate:!0})}),Te(()=>{o&&o()}),(S,C)=>{const f=Ve,s=fe,w=Se,h=Ae,$=Ue,R=B,A=$e,j=be,D=Ce;return L(),K(D,null,{default:l(()=>[t(w,{span:9},{default:l(()=>[t(s,{style:{margin:"10px"}},{default:l(()=>[t(f,{data:u.value,columns:m.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:g.value,loading:y.value,"table-layout":"auto",onPageChange:i},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(w,{span:3},{default:l(()=>[U("div",Fo,[t(s,{class:"sh-card"},{default:l(()=>[t(A,{model:c.value},{default:l(()=>[t($,{label:"标题"},{default:l(()=>[t(h,{modelValue:c.value.title,"onUpdate:modelValue":C[0]||(C[0]=M=>c.value.title=M),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t($,{label:"负责人"},{default:l(()=>[t(h,{modelValue:c.value.username,"onUpdate:modelValue":C[1]||(C[1]=M=>c.value.username=M),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t($,null,{default:l(()=>[t(R,{theme:"primary",onClick:_},{default:l(()=>C[2]||(C[2]=[x("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(s,{class:"sh-card"},{default:l(()=>[t(j,null,{default:l(()=>[t(R,{onClick:v},{default:l(()=>C[3]||(C[3]=[x("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),Xt=ue(No,[["__scopeId","data-v-98239b6b"]]),Go={style:{margin:"20px"}},Oo={style:{margin:"10px"}},Ho={style:{"text-align":"center","align-content":"center",padding:"20px",height:"500px"}},Bo={style:{"text-align":"center",width:"100%"}},Jo={class:"dida-operation-container"},Yo={style:{margin:"12px"}},Wo=["innerHTML"],Xo=re({__name:"ContestDetail",setup(e){let a=he();const{globalProperties:n}=me(),r=Ke(),o=Le();let m=0;const y=d(!1),b=d(null),k=d(!1),g=d(!1),u=d(""),c=Fe(()=>o.hasAuth(Me.ManageContest)||b.value&&o.getUserId==b.value.ownerId),p=s=>{if(!s||!i)return"default";const w=i[s];if(!w)return"default";switch(w){case Je.Accept:return"success";case Je.Attempt:return"warning";default:return"default"}},_=d([{title:"问题ID",colKey:"index",cell:(s,w)=>{const h=p(w.row.index);return t(B,{variant:"dashed",theme:h,onClick:async()=>await jt(m,w.row.index)},{default:()=>[w.row.id]})}},{title:"标题",colKey:"title",cell:(s,w)=>t(B,{variant:"text",onClick:async()=>await jt(m,w.row.index)},{default:()=>[w.row.title]})},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),I=d([]);let i={},v=d(!1);const S=()=>{Z.push({name:"contest-edit",params:{contestId:m}})},C=async s=>{if(!o.isLogin()){await Z.push({name:"login"});return}if(!u.value){ve(n,"请输入密码");return}v.value=!0;try{const w=await Jn(m,u.value);if(w.code!==0){J(n,w.code);return}ge(n,"申请访问成功"),await f()}catch(w){console.error("Error submitting contest password:",w),J(n,"提交密码失败，请稍后再试")}finally{v.value=!1}},f=async()=>{y.value=!0;const s=await qn(m);if(s.code!==0){y.value=!1,J(n,s.code),await Z.push({name:"contest"});return}k.value=s.data.has_auth,g.value=s.data.need_password,b.value=await Mt(s.data.contest),I.value=b.value.problems,i=s.data.attempt_status||{},r.setTitle(b.value.title+" - "+r.getTitle),await qe(()=>{const w=document.querySelectorAll(".dida-content-description");w&&w.length>0&&w.forEach(h=>{_e.mathRender(h),_e.highlightRender({lineNumber:!0,enable:!0},h),tt(h)}),y.value=!1})};return ie(async()=>{if(Array.isArray(a.params.contestId)?m=Number(a.params.contestId[0]):m=Number(a.params.contestId),!m){await Z.push({name:"contest"});return}await f()}),(s,w)=>{const h=Dt,$=Ve,R=fe,A=Ae,j=Ue,D=B,M=$e,z=Se,P=be,T=Oe,V=Ge,E=Ce,Y=xe;return L(),K(Y,{loading:y.value},{default:l(()=>[t(E,{class:"dida-main-content"},{default:l(()=>[t(z,{span:6},{default:l(()=>{var W,q,G;return[U("div",Go,[U("h1",null,F((W=b.value)==null?void 0:W.title),1),(q=b.value)!=null&&q.notification?(L(),K(h,{key:0,theme:"info",message:(G=b.value)==null?void 0:G.notification},null,8,["message"])):le("",!0)]),U("div",Oo,[k.value?(L(),K(R,{key:0},{default:l(()=>[t($,{data:I.value,columns:_.value,"row-key":"id","table-layout":"auto","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1})):(L(),K(R,{key:1},{default:l(()=>[U("div",Ho,[t(h,{theme:"warning",message:"您没有查看本比赛的权限"}),g.value?(L(),K(M,{key:0,style:{margin:"20px auto 0",width:"200px"},onSubmit:C,"label-width":"0"},{default:l(()=>[t(j,null,{default:l(()=>[t(A,{placeholder:"请输入密码",value:u.value,"onUpdate:value":w[0]||(w[0]=N=>u.value=N),style:{width:"300px"},type:"password",autocomplete:"new-password"},null,8,["value"])]),_:1}),t(j,null,{default:l(()=>[U("div",Bo,[t(D,{theme:"primary",type:"submit",loading:ce(v)},{default:l(()=>w[1]||(w[1]=[x("提交")])),_:1},8,["loading"])])]),_:1})]),_:1})):le("",!0)])]),_:1}))])]}),_:1}),t(z,{span:6},{default:l(()=>{var W;return[U("div",Jo,[t(P,null,{default:l(()=>[c.value?(L(),K(D,{key:0,onClick:S},{default:l(()=>w[2]||(w[2]=[x("编辑")])),_:1})):le("",!0)]),_:1})]),U("div",Yo,[t(V,{layout:"vertical",bordered:!0},{default:l(()=>[t(T,{label:"开始时间"},{default:l(()=>{var q;return[x(F((q=b.value)==null?void 0:q.startTime),1)]}),_:1})]),_:1}),t(V,{layout:"vertical",bordered:!0},{default:l(()=>[t(T,{label:"结束时间"},{default:l(()=>{var q;return[x(F((q=b.value)==null?void 0:q.endTime),1)]}),_:1})]),_:1})]),(W=b.value)!=null&&W.description?(L(),K(R,{key:0,style:{margin:"12px"}},{default:l(()=>{var q;return[U("div",{innerHTML:(q=b.value)==null?void 0:q.description,class:"dida-content-description"},null,8,Wo)]}),_:1})):le("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),Zo=ue(Xo,[["__scopeId","data-v-2f35f245"]]);function Ta(e){return e?Math.floor(e/1e9):0}function nt(e){if(e<=0)return"0秒";let a="";const n=Math.floor(e/3600);n>0&&(a+=`${n}小时`);const r=Math.floor(e%3600/60);return(r>0||n>0)&&(n>0&&r<10&&(a+="0"),a+=`${r}分钟`),e=e%60,(e>0||r>0||n>0)&&((n>0||r>0)&&e<10&&(a+="0"),a+=`${e.toFixed(0)}秒`),a}const Qo=ut("contest",{state:()=>({starMembers:{}}),actions:{clear(){this.$patch({starMembers:{}})},addStarMember(e,a){this.starMembers[e]||(this.starMembers[e]={}),this.starMembers[e][a]=!0},removeStarMember(e,a){this.starMembers[e]&&(delete this.starMembers[e][a],Object.keys(this.starMembers[e]).length===0&&delete this.starMembers[e])},isStarMember(e,a){var n;return!!((n=this.starMembers[e])!=null&&n[a])}},persist:!0}),es={style:{margin:"10px 10px 40px"}},ts={style:{"text-align":"right","margin-bottom":"10px"}},as={class:"table-scroll-wrapper"};function Zt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Xe(e)}const ls=re({__name:"ContestRank",setup(e){const a=he(),n=Ne(),r=Qo(),{globalProperties:o}=me();let m=!1,y=null,b=0,k=null,g=null,u=0;const c=d(0),p=d(0),_=d(!1),I=d(!0),i=d(!0);let v=null,S=null,C=1,f=50;const s=d({current:C,pageSize:f,defaultCurrent:1,defaultPageSize:50,total:0,pageSizeOptions:[50,100,1e3]}),w=H=>r&&r.isStarMember(b,H),h=async H=>{s.value={...s.value,current:H.current,pageSize:H.pageSize},await n.push({query:{...a.query,page:H.current,page_size:H.pageSize}})},$=H=>{if(H==null)return"-";const O=Math.floor(H/3600).toString().padStart(2,"0"),oe=Math.floor(H%3600/60).toString().padStart(2,"0"),ee=(H%60).toFixed(0).toString().padStart(2,"0");return`${O}:${oe}:${ee}`},R=d({}),A=[{title:"Rank",colKey:"rank",align:"center",fixed:"left"},{title:"昵称",colKey:"nickname",fixed:"left",attrs:H=>{let O={};return w(H.row.userId)&&(O={backgroundColor:"rgba(255,165,30,0.5)"}),{style:O}},cell:(H,O)=>{const oe=Nl(O.row.nickname,18);let ee=null;return w(O.row.userId)?ee=t(B,{shape:"circle",variant:"text",class:"rank-unstar-button",onClick:()=>{r.removeStarMember(b,O.row.userId),N()}},{default:()=>[t(qa,{slot:"icon"},null)]}):ee=t(B,{shape:"circle",variant:"text",class:"rank-star-button",onClick:()=>{r.addStarMember(b,O.row.userId),N()}},{default:()=>[t(Ka,{slot:"icon"},null)]}),t("div",{class:"rank-nickname-cell"},[t(be,null,{default:()=>[t(sl,{content:O.row.nickname},{default:()=>[t(B,{variant:"text",onClick:()=>n.push({name:"user",params:{username:O.row.username}})},Zt(oe)?oe:{default:()=>[oe]})]}),ee]})])}},{title:"Solved",colKey:"solved",align:"center",fixed:"left",cell:(H,O)=>t(B,{variant:"text",onClick:()=>n.push({name:"contest-judge",params:{contestId:b},query:{username:O.row.username,status:De.Accept}})},{default:()=>[O.row.solved]})},{title:"Penalty",colKey:"penalty",align:"center",fixed:"left",cell:(H,O)=>$(O.row.penalty)}],j=d([]),D=d(!1);let M=[],z=[];const P=d([]);let T=[];const V=({col:H,rowIndex:O})=>{if(H.colKey==="rank"){let oe=s.value.current;s.value.current>Math.ceil(P.value.length/s.value.pageSize)&&(oe=Math.ceil(P.value.length/s.value.pageSize));let ee=s.value.pageSize*(oe-1),de=1;for(let se=O+1;ee+se<P.value.length&&P.value[ee+se].rank===P.value[ee+O].rank;se++)de++;return{rowspan:de}}},E=(H,{value:O})=>nt(O),Y=()=>{v&&clearInterval(v),v=setInterval(()=>{m&&Ie(!1)},3e4),S&&clearInterval(S),S=setInterval(()=>{if(!m)return;c.value=(new Date().getTime()-k.getTime())/1e3;const H=Math.min(c.value,p.value);c.value=Math.min(c.value,H),N()},1e3)},W=()=>{v&&(clearInterval(v),v=null),S&&(clearInterval(S),S=null)},q=async H=>{i.value=H,H?(await Ie(!1),Y()):W()},G=()=>{N(),s.value={...s.value,current:1}},N=()=>{P.value=[];let H=[];for(let X=0;X<M.length;X++){const pe=M[X];let Re={userId:pe.author_id,username:pe.author_username,nickname:pe.author_nickname},Ye=0,Ee=0;pe.problems.forEach(He=>{let Qe=-1,lt=He.lock||0;if(He.ac){if(Qe=(new Date(He.ac).getTime()-(k==null?void 0:k.getTime()))/1e3,Qe>c.value)return;Ye++,Ee+=Qe,Ee+=He.attempt*20*60}if(lt>0&&u>0){const $a=p.value-u;c.value<$a&&(lt=0)}const pt=He.index;Re[`problem_${pt}`]={acDuration:Qe,attempt:He.attempt||0,lock:lt}}),Re.solved=Ye,Re.penalty=Ee,H.push(Re)}H.sort((X,pe)=>X.solved!==pe.solved?pe.solved-X.solved:X.penalty!==pe.penalty?X.penalty-pe.penalty:X.userId-pe.userId);const O=z;let oe=0,ee=0,de=-1,se=-1;for(let X=0;X<H.length;X++)O&&O.includes(H[X].userId)?H[X].rank="*":(ee++,(H[X].solved!==de||H[X].penalty!==se)&&(oe=ee,de=H[X].solved,se=H[X].penalty),H[X].rank=String(oe));_.value&&(H=H.filter(X=>w(X.userId)));const te=document.querySelectorAll("tbody tr"),ke={};T.forEach((X,pe)=>{const Re=te[pe];Re&&(ke[X.userId]=Re.getBoundingClientRect())}),s.value={...s.value,total:H.length},P.value=H;for(let X=0;X<P.value.length;X++)P.value[X].index=X+1;if(T=[...P.value],I.value){const X={},pe=document.querySelectorAll("table tbody tr");P.value.forEach((Re,Ye)=>{const Ee=pe[Ye];Ee&&(X[Re.userId]=Ee.getBoundingClientRect())}),requestAnimationFrame(()=>{const Re=document.querySelectorAll("table tbody tr");P.value.forEach((Ye,Ee)=>{const He=Re[Ee],Qe=ke[Ye.userId],lt=X[Ye.userId];if(Qe&&lt){const pt=Qe.top-lt.top;pt!==0&&(He.style.transition="none",He.style.transform=`translateY(${pt}px)`)}}),requestAnimationFrame(()=>{document.querySelectorAll("table tbody tr").forEach(Ee=>{Ee.style.transition="transform 300ms ease",Ee.style.transform=""})})})}},ye=H=>{q(!1),c.value=H;const O=Math.min(p.value,(new Date().getTime()-(k==null?void 0:k.getTime()))/1e3);c.value=Math.min(c.value,O),N()},Ie=async H=>{H&&(D.value=!0);try{const O=await On(b);if(j.value=[...A],M=[],z=[],P.value=[],s.value={...s.value,total:0},O.code===0){if(!O.data.has_auth){ge(o,"您目前没有权限查看比赛排名"),await n.push({name:"contest-detail",params:{contestId:b}});return}O.data.problems.sort((de,se)=>de-se),O.data.problems.forEach((de,se)=>{j.value.push({colKey:`problem_${de}`,align:"center",title:()=>{let te;return t(B,{variant:"text",onClick:()=>n.push({name:"contest-problem-detail",params:{contestId:b,problemIndex:de}})},Zt(te=We(de))?te:{default:()=>[te]})},cell:(te,ke)=>{const X=ke.row[`problem_${de}`];if(!X)return"";let pe="";return X.acDuration>=0&&(pe=$(X.acDuration)),X.attempt>0&&(pe&&(pe+=" "),pe+=`(-${X.attempt})`),X.lock>0&&(pe&&(pe+=" "),pe+=`(+${X.lock})`),t("span",null,[pe])},attrs:te=>{const ke=te.row[`problem_${de}`];return ke?ke.acDuration>=0?{style:{backgroundColor:"rgba(130,255,30,0.5)"}}:ke.lock>0?{style:{backgroundColor:"rgb(255,180,50,0.5)"}}:{style:{backgroundColor:"rgba(255,120,120,0.5)"}}:{}}})});const oe=O.data.contest;if(k=new Date(oe.start_time),g=new Date(oe.end_time),M=O.data.ranks,z=O.data.v_members||[],p.value=Math.floor((g.getTime()-k.getTime())/1e3),R.value={0:"0",[Math.floor(p.value/2)]:nt(Math.floor(p.value/2)),[p.value]:nt(p.value)},u=Ta(oe.lock_rank_duration||0),O.data.is_locked&&u>0){const de=Math.max(0,p.value-u);R.value[de]=t("span",{style:"color: #0052d9"},[x("锁榜("),nt(de),x(")")])}c.value=Math.floor((new Date().getTime()-k.getTime())/1e3);const ee=Math.min(c.value,p.value);c.value=Math.min(c.value,ee),i.value=!0,Y(),N()}else H&&J(o,O.code)}catch(O){console.error(O),H&&J(o,ze())}finally{H&&(D.value=!1)}};return ie(async()=>{m=!0,y=je(()=>a.query,async H=>{if(Array.isArray(a.params.contestId)?b=Number(a.params.contestId[0]):b=Number(a.params.contestId),!b){await n.push({name:"contest"});return}const O=parseInt(H.page)||s.value.defaultCurrent,oe=parseInt(H.page_size)||s.value.defaultPageSize;C=O,f=oe,s.value={...s.value,current:C,pageSize:f},await Ie(!0)},{immediate:!0})}),Te(()=>{m=!1,y&&y(),W()}),(H,O)=>{const oe=it,ee=be,de=ol,se=Ve,te=fe,ke=Ce;return L(),K(ke,null,{default:l(()=>[t(te,{style:{margin:"10px",width:"100%"}},{default:l(()=>[U("div",es,[U("div",ts,[t(ee,null,{default:l(()=>[t(oe,{size:"large",modelValue:_.value,"onUpdate:modelValue":O[0]||(O[0]=X=>_.value=X),onChange:G},{label:l(X=>[x(F(X.value?"仅展示收藏":"未过滤收藏"),1)]),_:1},8,["modelValue"]),t(oe,{size:"large",modelValue:I.value,"onUpdate:modelValue":O[1]||(O[1]=X=>I.value=X)},{label:l(X=>[x(F(X.value?"开启动画":"关闭动画"),1)]),_:1},8,["modelValue"]),t(oe,{size:"large",modelValue:i.value,"onUpdate:modelValue":O[2]||(O[2]=X=>i.value=X),onChange:q},{label:l(X=>[x(F(X.value?"自动刷新":"关闭刷新"),1)]),_:1},8,["modelValue"])]),_:1})]),t(de,{modelValue:c.value,"onUpdate:modelValue":O[3]||(O[3]=X=>c.value=X),marks:R.value,max:p.value,label:E,"tooltip-props":{placement:"top"},"input-number-props":{theme:"column",autoWidth:!0,format:ce(nt),onChange:ye},onChangeEnd:ye},null,8,["modelValue","marks","max","input-number-props"])]),U("div",as,[t(se,{data:P.value,columns:j.value,"row-key":"index","vertical-align":"middle",bordered:!0,hover:!0,"table-layout":"auto","rowspan-and-colspan":V,loading:D.value,class:"dida-contest-rank-table",pagination:s.value,onPageChange:h},null,8,["data","columns","loading","pagination"])])]),_:1})]),_:1})}}}),ns=ue(ls,[["__scopeId","data-v-d68960f6"]]),os={style:{margin:"10px"}},ss={style:{margin:"12px"}},rs={class:"dida-edit-container"},us=re({__name:"ContestEdit",setup(e){let a=he();const{globalProperties:n}=me(),r=Ke(),o=d(""),m=d(!1);let y=null;const b=d(!1),k=d(!1),g=d(null),u=d({title:"",openTime:[],private:!0,password:"",problems:[],members:[],description:"",notification:"",lockRankDuration:0,alwaysLock:!0,submitAnytime:!1}),c=d(""),p=d(""),_=d(!1),I=async()=>{_.value=!0,k.value=!1,_.value=!1},i=async()=>{if(y){b.value=!0;try{const f={title:u.value.title,description:y.getValue(),notification:u.value.notification,lock_rank_duration:u.value.lockRankDuration,always_lock:u.value.alwaysLock,problems:u.value.problems,members:u.value.members,private:u.value.private,password:u.value.password,submit_anytime:u.value.submitAnytime};u.value.openTime[0]&&(f.start_time=new Date(u.value.openTime[0])),u.value.openTime[1]&&(f.end_time=new Date(u.value.openTime[1]));const s=await Hn(f);if(b.value=!0,s.code!==0){J(n,s.code);return}s.data!=null&&await Z.push({name:"contest-detail",params:{contestId:s.data}}),Be(n,"创建成功")}finally{b.value=!1}}},v=async()=>{if(y){b.value=!0;try{const f={id:Number(o.value),title:u.value.title,description:y.getValue(),notification:u.value.notification,lock_rank_duration:u.value.lockRankDuration,always_lock:u.value.alwaysLock,problems:u.value.problems,members:u.value.members,private:u.value.private,password:u.value.password,submit_anytime:u.value.submitAnytime};u.value.openTime[0]&&(f.start_time=new Date(u.value.openTime[0])),u.value.openTime[1]&&(f.end_time=new Date(u.value.openTime[1]));const s=await Bn(f);if(b.value=!0,s.code!==0){J(n,s.code);return}s.data!=null&&g.value&&(g.value.updateTime=new Date(s.data).toLocaleString()),Be(n,"保存成功")}finally{b.value=!1}}},S=f=>{const s={after:()=>{y==null||y.setValue(f),m.value=!1}};y=new _e("contestEditDiv",s)},C=async()=>{const f=await Kn(o.value);if(f.code!==0){J(n,f.code),console.error("contest get failed",f.code),await Z.push({name:"contest-list"});return}const s=f.data.contest;g.value=await Mt(s),u.value.title=s.title,u.value.openTime=[],s.start_time?u.value.openTime.push(new Date(s.start_time)):u.value.openTime.push(""),s.end_time?u.value.openTime.push(new Date(s.end_time)):u.value.openTime.push(""),u.value.private=s.private,u.value.password=s.password||"",u.value.description=s.description||"",u.value.notification=s.notification||"",u.value.problems=f.data.problems,u.value.members=f.data.members,s.lock_rank_duration?u.value.lockRankDuration=Ta(s.lock_rank_duration):u.value.lockRankDuration=0,u.value.alwaysLock=s.always_lock,u.value.submitAnytime=s.submit_anytime,r.setTitle(s.title+" - "+r.getTitle);let w="";s.description&&(w=s.description),S(w)};return ie(async()=>{Array.isArray(a.params.contestId)?o.value=a.params.contestId[0]:o.value=a.params.contestId,o.value?(m.value=!0,await C()):S("")}),(f,s)=>{const w=Ae,h=Ue,$=ma,R=it,A=pa,j=$e,D=fe,M=Se,z=B,P=be,T=Oe,V=Ge,E=Ce,Y=xe,W=kt,q=Ze;return L(),ae(ne,null,[t(Y,{loading:m.value},{default:l(()=>[t(E,null,{default:l(()=>[t(M,{span:8},{default:l(()=>[U("div",os,[t(D,{class:"sh-card"},{default:l(()=>[t(j,{model:u.value,"label-width":"150px"},{default:l(()=>[t(h,{label:"标题"},{default:l(()=>[t(w,{modelValue:u.value.title,"onUpdate:modelValue":s[0]||(s[0]=G=>u.value.title=G),placeholder:"比赛标题"},null,8,["modelValue"])]),_:1}),t(h,{label:"通知"},{default:l(()=>[t(w,{modelValue:u.value.notification,"onUpdate:modelValue":s[1]||(s[1]=G=>u.value.notification=G),placeholder:"会更为醒目地提醒"},null,8,["modelValue"])]),_:1}),t(h,{label:"开启时间"},{default:l(()=>[t($,{modelValue:u.value.openTime,"onUpdate:modelValue":s[2]||(s[2]=G=>u.value.openTime=G),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(h,{label:"提交限制"},{default:l(()=>[t(R,{modelValue:u.value.submitAnytime,"onUpdate:modelValue":s[3]||(s[3]=G=>u.value.submitAnytime=G)},{label:l(G=>[x(F(G.value?"结束仍能提交":"仅比赛期间提交"),1)]),_:1},8,["modelValue"])]),_:1}),t(h,{label:"锁榜时长"},{default:l(()=>[t(A,{modelValue:u.value.lockRankDuration,"onUpdate:modelValue":s[4]||(s[4]=G=>u.value.lockRankDuration=G),min:0,format:ce(nt),"auto-width":""},null,8,["modelValue","format"])]),_:1}),t(h,{label:"自动解锁"},{default:l(()=>[t(R,{modelValue:u.value.alwaysLock,"onUpdate:modelValue":s[5]||(s[5]=G=>u.value.alwaysLock=G)},{label:l(G=>[x(F(G.value?"结束后仍锁榜":"结束后解锁"),1)]),_:1},8,["modelValue"])]),_:1}),t(h,{label:"私有"},{default:l(()=>[t(R,{modelValue:u.value.private,"onUpdate:modelValue":s[6]||(s[6]=G=>u.value.private=G)},null,8,["modelValue"])]),_:1}),u.value.private?(L(),K(h,{key:0,label:"密码"},{default:l(()=>[t(w,{modelValue:u.value.password,"onUpdate:modelValue":s[7]||(s[7]=G=>u.value.password=G),type:"password",placeholder:"请输入访问密码，留空代表关闭密码访问"},null,8,["modelValue"])]),_:1})):le("",!0),u.value.private?(L(),K(h,{key:1,label:"成员"},{default:l(()=>[t(xa,{modelValue:u.value.members,"onUpdate:modelValue":s[8]||(s[8]=G=>u.value.members=G)},null,8,["modelValue"])]),_:1})):le("",!0),t(h,{label:"问题"},{default:l(()=>[t(Pa,{modelValue:u.value.problems,"onUpdate:modelValue":s[9]||(s[9]=G=>u.value.problems=G)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(M,{span:4},{default:l(()=>[U("div",ss,[U("div",rs,[o.value?(L(),K(P,{key:0},{default:l(()=>[t(z,{onClick:v,theme:"danger",loading:b.value},{default:l(()=>s[12]||(s[12]=[x("保存")])),_:1},8,["loading"])]),_:1})):(L(),K(P,{key:1},{default:l(()=>[t(z,{onClick:i,theme:"danger",loading:b.value},{default:l(()=>s[13]||(s[13]=[x("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(L(),K(V,{key:0,layout:"vertical",bordered:!0},{default:l(()=>[t(T,{label:"创建时间"},{default:l(()=>{var G;return[x(F((G=g.value)==null?void 0:G.createTime),1)]}),_:1}),t(T,{label:"更新时间"},{default:l(()=>{var G;return[x(F((G=g.value)==null?void 0:G.updateTime),1)]}),_:1}),t(T,{label:"创建用户"},{default:l(()=>{var G;return[x(F((G=g.value)==null?void 0:G.ownerNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),s[14]||(s[14]=U("div",{id:"contestEditDiv",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"]),t(q,{visible:k.value,"onUpdate:visible":s[11]||(s[11]=G=>k.value=G),onConfirm:I,header:c.value,"confirm-loading":_.value},{default:l(()=>[s[15]||(s[15]=U("div",{style:{"margin-bottom":"10px"}},[U("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(W,{modelValue:p.value,"onUpdate:modelValue":s[10]||(s[10]=G=>p.value=G),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),Qt=ue(us,[["__scopeId","data-v-cd60f18a"]]);function Va(e){const a={};return a.id=e.id,a.authorId=e.author_id,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.title=e.title,a.content=e.content,e.insert_time&&(a.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(a.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(a.updateTime=new Date(e.update_time).toLocaleString()),a.problemId=e.problem_id,a.problemTitle=e.problem_title,a.contestId=e.contest_id,a.contestTitle=e.contest_title,a.contestProblemIndex=e.contest_problem_index,a}async function is(e){const a={};if(a.id=e.id,a.authorId=e.author_id,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.content="",e.content){const n={math:{inlineDigit:!0,engine:"KaTeX"}};a.content=await _e.md2html(e.content,n)}return e.insert_time&&(a.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(a.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(a.updateTime=new Date(e.update_time).toLocaleString()),a}function cs(e){return Q({url:"/discuss?id="+e,method:"get"})}function ds(e,a,n,r,o,m){const y={};return e&&(y.contest_id=e),a&&(y.problem_id=a),n&&(y.title=n),r&&(y.username=r),o&&(y.page=o),m&&(y.page_size=m),Q({url:`/discuss/list?${new URLSearchParams(y).toString()}`,method:"get"})}function ms(e,a,n){return Q({url:"/discuss/comment/list?id="+e+"&page="+a+"&page_size="+n,method:"get"})}function ps(e){return Q({url:"/discuss/create",method:"post",data:e})}const fs={style:{margin:"10px"}};function vs(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Xe(e)}const _s=re({__name:"DiscussList",setup(e){const a=he(),n=Ne(),{globalProperties:r}=me();let o=null;const m=d(!1),y=d(!1);let b=-1;const k=d([]),g=[],u=[{title:"标题",colKey:"title",cell:(j,D)=>t(B,{variant:"text",onClick:()=>s(D.row.id)},{default:()=>[D.row.title]})},{title:"创建人",colKey:"authorNickname",width:"200",cell:(j,D)=>t(B,{variant:"text",onClick:async()=>await qt(n,D.row.authorUsername)},{default:()=>[D.row.authorNickname]})},{title:"创建时间",colKey:"insertTime",width:"180"},{title:"更新时间",colKey:"updateTime",width:"180"}],c=d(!1);let p=1,_=50;const I=d({current:p,pageSize:_,defaultCurrent:p,defaultPageSize:_,total:0,pageSizeOptions:[50,100]}),i=d(),v=d({problemId:"",title:"",username:""}),S=d({title:"",content:""}),C=j=>{j&&n.push({name:"problem-detail",params:{problemId:j}})},f=(j,D)=>{n.push({name:"contest-problem-detail",params:{contestId:j,problemIndex:D}})},s=j=>{if(j){if(b){n.push({name:"contest-discuss-detail",params:{contestId:b,discussId:j}});return}n.push({name:"discuss-detail",params:{discussId:j}})}},w=async()=>{await n.push({query:{...a.query,problem_id:v.value.problemId,title:v.value.title,username:v.value.username,page:1,page_size:I.value.defaultPageSize}})},h=async(j,D)=>{var M;c.value=!0;try{const{current:z,pageSize:P}=j,T=await ds(b,v.value.problemId,v.value.title,v.value.username,z,P);if(i.value=[],T.code===0){if(!T.data.has_auth){ge(r,"您目前没有权限查看讨论列表"),b?await n.push({name:"contest-detail",params:{contestId:b}}):await n.push({name:"discuss-list"});return}if(T.data.list){const V=T.data.list;for(let E=0;E<V.length;E++){const Y=V[E],W=await Va(Y);(M=i.value)==null||M.push(W)}}I.value={...I.value,total:T.data.total_count}}else D&&J(r,T.code)}catch(z){console.error(z),J(r,ze())}finally{c.value=!1}},$=async j=>{await n.push({query:{...a.query,page:j.current,page_size:j.pageSize}})},R=()=>{m.value=!0},A=async()=>{y.value=!0,console.log("discussCreateForm",S.value),ps(S.value).then(j=>{j.code===0?(ge(r,"创建比赛成功"),m.value=!1,n.push({path:"/discuss/"+j.data.id})):J(r,j.code)}).finally(()=>{y.value=!1})};return ie(async()=>{o=je(()=>a.query,j=>{Array.isArray(a.params.contestId)?b=Number(a.params.contestId[0]):b=Number(a.params.contestId),k.value=g,b?k.value=k.value.concat([{title:"问题ID",colKey:"contestProblemIndex",width:"100",cell:(z,P)=>{let T;return P.row.contestProblemIndex?t(B,{variant:"text",onClick:()=>f(b,P.row.contestProblemIndex)},vs(T=We(P.row.contestProblemIndex))?T:{default:()=>[T]}):""}}]):k.value=k.value.concat([{title:"问题ID",colKey:"problemId",width:"100",cell:(z,P)=>P.row.problemId?t(B,{variant:"text",onClick:()=>C(P.row.problemId)},{default:()=>[P.row.problemId]}):""}]),k.value=k.value.concat(u),v.value.problemId=j.problem_id||"",v.value.title=j.title||"",v.value.username=j.username||"";const D=parseInt(j.page)||I.value.defaultCurrent,M=parseInt(j.page_size)||I.value.defaultPageSize;p=D,_=M,I.value={...I.value,current:p,pageSize:_},h({current:p,pageSize:_},!0)},{immediate:!0})}),Te(()=>{o&&o()}),(j,D)=>{const M=Ve,z=fe,P=Se,T=Ae,V=Ue,E=B,Y=$e,W=be,q=Ce,G=Ze;return L(),ae(ne,null,[t(q,null,{default:l(()=>[t(P,{span:9},{default:l(()=>[t(z,{style:{margin:"10px"}},{default:l(()=>[t(M,{data:i.value,columns:k.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:I.value,loading:c.value,"table-layout":"auto",onPageChange:$},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(P,{span:3},{default:l(()=>[U("div",fs,[t(z,{class:"sh-card"},{default:l(()=>[t(Y,{model:v.value},{default:l(()=>[t(V,{label:"问题ID"},{default:l(()=>[t(T,{modelValue:v.value.problemId,"onUpdate:modelValue":D[0]||(D[0]=N=>v.value.problemId=N),placeholder:"请输入完整问题ID"},null,8,["modelValue"])]),_:1}),t(V,{label:"标题"},{default:l(()=>[t(T,{modelValue:v.value.title,"onUpdate:modelValue":D[1]||(D[1]=N=>v.value.title=N),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(V,{label:"创建人"},{default:l(()=>[t(T,{modelValue:v.value.username,"onUpdate:modelValue":D[2]||(D[2]=N=>v.value.username=N),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(V,null,{default:l(()=>[t(E,{theme:"primary",onClick:w},{default:l(()=>D[6]||(D[6]=[x("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(z,{class:"sh-card"},{default:l(()=>[t(W,null,{default:l(()=>[t(E,{onClick:R},{default:l(()=>D[7]||(D[7]=[x("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),t(G,{visible:m.value,"onUpdate:visible":D[5]||(D[5]=N=>m.value=N),header:"创建讨论",onConfirm:A,"confirm-loading":y.value},{default:l(()=>[t(Y,{"label-width":80,model:S.value,onSubmit:D[4]||(D[4]=gt(()=>{},["prevent"]))},{default:l(()=>[t(V,{label:"标题"},{default:l(()=>[t(T,{modelValue:S.value.title,"onUpdate:modelValue":D[3]||(D[3]=N=>S.value.title=N),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),ft=ue(_s,[["__scopeId","data-v-76771638"]]),gs={key:0,style:{margin:"20px"}},bs=["innerHTML"],hs=["innerHTML"],ys={style:{margin:"10px"}},ws={style:{margin:"10px"}},ks={style:{margin:"10px","text-align":"right"}},Cs={style:{margin:"12px"}},Ss={key:0,class:"dida-edit-container"},Is=re({__name:"DiscussDetail",props:{discussId:{}},setup(e){const a=e;let n=he();const{globalProperties:r}=me();let o=null;const m=Ke(),y=Le();let b=d("");const k=d(""),g=d(null),u=d(!1),c=d(null),p=d(!1);let _=1,I=20;const i=d({current:1,total:0,defaultPageSize:I,defaultCurrent:_,pageSizeOptions:[20,50]}),v=d([]),S={},C=Fe(()=>y.hasAuth(Me.ManageDiscuss)),f=A=>{A&&Z.push({name:"discuss-list",query:{...n.query,title:"",tag:A.name}})},s=()=>{Z.push({name:"manage-discuss",params:{discussId:k.value}})},w=()=>t("div",{class:"t-pagination__total"},[`共 ${i.value.total} 条回复`]),h=()=>{},$=async(A,j)=>{var D;p.value=!0;try{const{current:M,pageSize:z}=A,P=await ms(k.value,M,z);if(v.value=[],P.code===0){const T=P.data.list;if(T)for(let V=0;V<T.length;V++){const E=T[V],Y=await is(E);(D=v.value)==null||D.push(Y),await qe(()=>{const W=document.querySelectorAll(".dida-discuss-content");W&&W.length>0&&W.forEach(q=>{_e.mathRender(q),_e.highlightRender({lineNumber:!0,enable:!0},q),tt(q)})})}i.value={...i.value,total:P.data.total_count}}else j&&J(r,P.code)}catch(M){console.error(M),J(r,ze())}finally{p.value=!1}},R=async A=>{await Z.push({query:{...n.query,page:A.current,page_size:A.pageSize}})};return ie(async()=>{if(k.value=a.discussId,k.value||(Array.isArray(n.params.discussId)?k.value=n.params.discussId[0]:k.value=n.params.discussId),!k.value){ve(r,"讨论不存在"),await Z.push({name:"discuss"});return}u.value=!0;const A=await cs(k.value);if(A.code!==0){u.value=!1,J(r,A.code),await Z.push({name:"discuss"});return}A.data.tags&&A.data.tags.forEach(z=>{S[z.id]=z}),c.value=Va(A.data.discuss),m.setTitle(c.value.title+" - "+m.getTitle);let j=c.value.content;const D={math:{inlineDigit:!0,engine:"KaTeX"}};b.value=await _e.md2html(j,D),await qe(()=>{g.value&&(_e.mathRender(g.value),_e.highlightRender({lineNumber:!0,enable:!0},g.value),tt(g.value)),u.value=!1}),o=je(()=>n.query,z=>{const P=parseInt(z.page)||i.value.defaultCurrent,T=parseInt(z.page_size)||i.value.defaultPageSize;_=P,I=T,i.value={...i.value,current:_,pageSize:I},$({current:_,pageSize:I},!0)},{immediate:!0});const M={after:()=>{}};new _e("commentEditRef",M)}),Te(()=>{o&&o()}),(A,j)=>{const D=ca,M=ia,z=fe,P=be,T=rl,V=B,E=Se,Y=Oe,W=Ge,q=Ce,G=xe;return L(),K(G,{loading:u.value},{default:l(()=>[t(q,{class:"dida-main-content"},{default:l(()=>[t(E,{span:8},{default:l(()=>{var N,ye,Ie;return[(N=c.value)!=null&&N.problemTitle||(ye=c.value)!=null&&ye.contestTitle?(L(),ae("div",gs,[t(M,{"max-item-width":"300"},{default:l(()=>{var H,O,oe,ee,de;return[(H=c.value)!=null&&H.contestTitle?(L(),ae(ne,{key:0},[t(D,{to:{name:"contest-detail",params:{contestId:(O=c.value)==null?void 0:O.contestId}}},{default:l(()=>{var se;return[x(F((se=c.value)==null?void 0:se.contestTitle),1)]}),_:1},8,["to"]),(oe=c.value)!=null&&oe.contestProblemIndex?(L(),K(D,{key:0,to:{name:"contest-problem-detail",params:{problemIndex:(ee=c.value)==null?void 0:ee.contestProblemIndex}}},{default:l(()=>{var se,te;return[x(F(ce(We)((se=c.value)==null?void 0:se.contestProblemIndex))+" - "+F((te=c.value)==null?void 0:te.problemTitle),1)]}),_:1},8,["to"])):le("",!0)],64)):(L(),ae(ne,{key:1},[t(D,{to:{name:"discuss-list-problem"}},{default:l(()=>j[3]||(j[3]=[x(" 问题讨论")])),_:1}),t(D,{to:{name:"problem-detail",params:{problemId:(de=c.value)==null?void 0:de.problemId}}},{default:l(()=>{var se;return[x(F((se=c.value)==null?void 0:se.problemTitle),1)]}),_:1},8,["to"])],64))]}),_:1})])):le("",!0),t(z,{style:{margin:"10px"},header:(Ie=c.value)==null?void 0:Ie.title,"header-bordered":!0},{default:l(()=>[U("div",{innerHTML:ce(b),class:"dida-discuss-content"},null,8,bs)]),_:1},8,["header"]),(L(!0),ae(ne,null,we(v.value,(H,O)=>(L(),K(z,{key:O,style:{margin:"10px"},"header-bordered":""},{header:l(()=>[t(P,null,{default:l(()=>[U("span",null,F(H.authorNickname),1),U("span",null,F(H.insertTime),1)]),_:2},1024)]),default:l(()=>[U("div",{innerHTML:H.content,class:"dida-discuss-content"},null,8,hs)]),_:2},1024))),128)),U("div",ys,[t(T,{modelValue:i.value.current,"onUpdate:modelValue":j[0]||(j[0]=H=>i.value.current=H),"page-size":i.value.pageSize,"onUpdate:pageSize":j[1]||(j[1]=H=>i.value.pageSize=H),total:i.value.total,"page-size-options":i.value.pageSizeOptions,"show-page-size":!1,"total-content":w,onChange:R},null,8,["modelValue","page-size","total","page-size-options"])]),U("div",ws,[j[5]||(j[5]=U("div",{id:"commentEditRef",class:"dida-comment-editor"},null,-1)),U("div",ks,[t(P,null,{default:l(()=>[t(V,{theme:"primary",onClick:h},{default:l(()=>j[4]||(j[4]=[x("提交")])),_:1})]),_:1})])])]}),_:1}),t(E,{span:4},{default:l(()=>[U("div",Cs,[C.value?(L(),ae("div",Ss,[t(V,{onClick:s},{default:l(()=>j[6]||(j[6]=[x("编辑")])),_:1})])):le("",!0),t(W,{layout:"vertical",bordered:!0},{default:l(()=>[t(Y,{label:"创建时间"},{default:l(()=>{var N;return[x(F((N=c.value)==null?void 0:N.insertTime),1)]}),_:1}),t(Y,{label:"编辑时间"},{default:l(()=>{var N;return[x(F((N=c.value)==null?void 0:N.modifyTime),1)]}),_:1}),t(Y,{label:"更新时间"},{default:l(()=>{var N;return[x(F((N=c.value)==null?void 0:N.updateTime),1)]}),_:1}),t(Y,{label:"创建用户"},{default:l(()=>[t(V,{variant:"text",onClick:j[2]||(j[2]=async()=>{var N;return await ce(qt)(ce(Z),(N=c.value)==null?void 0:N.authorUsername)})},{default:l(()=>{var N;return[x(F((N=c.value)==null?void 0:N.authorNickname),1)]}),_:1})]),_:1}),t(Y,{label:"标签"},{default:l(()=>[t(P,null,{default:l(()=>{var N;return[(L(!0),ae(ne,null,we((N=c.value)==null?void 0:N.tags,ye=>(L(),K(V,{key:ye.id,variant:"dashed",onClick:()=>f(ye)},{default:l(()=>[x(F(ye.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),St=ue(Is,[["__scopeId","data-v-03948cc8"]]);function Ps(e,a){return Q({url:"/rank/ac/all?page="+e+"&page_size="+a,method:"get"})}function xs(e,a){return Q({url:"/rank/ac/problem?page="+e+"&page_size="+a,method:"get"})}function Ts(e,a){return Q({url:"/rank/ac/problem/today?page="+e+"&page_size="+a,method:"get"})}function Vs(e,a){return Q({url:"/rank/ac/problem/day7?page="+e+"&page_size="+a,method:"get"})}function Ls(e,a){return Q({url:"/rank/ac/problem/year?page="+e+"&page_size="+a,method:"get"})}const js={style:{margin:"10px"}};function It(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Xe(e)}const Ds=re({__name:"RankUser",props:{type:{}},setup(e){const a=he(),n=Ne(),{globalProperties:r}=me();let o=null;const m=e,y=d(""),b=d(""),k={all:{header:"统计所有用户在本站的提交记录",content:"优先以AC记录数量排序，如果相同则提交所用次数较少的优先，如果仍相同，注册较早的用户靠前"},problem:{header:"统计所有用户在本站的提交记录",content:"以题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-today":{header:"统计所有用户今日在本站的提交记录",content:"以今日题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-day7":{header:"统计所有用户最近7日在本站的提交记录",content:"以7日题目记录数量排序（从7日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-year":{header:"统计所有用户最近1年在本站的提交记录",content:"以最近1年题目记录数量排序（从365日前的0点开始计算），如果相同，注册较早的用户靠前"}},g=d([]),u=[{title:"序号",colKey:"index"},{title:"用户名",colKey:"username",cell:($,R)=>t(B,{variant:"dashed",onClick:()=>C(R.row.username)},{default:()=>[R.row.username]})},{title:"昵称",colKey:"nickname"},{title:"Slogan",colKey:"slogan"}],c=[{title:"题目数量",colKey:"problem_count",cell:($,R)=>{let A=0;return R.row.problem_count&&(A=R.row.problem_count),t(B,{variant:"dashed",onClick:()=>f(R.row.username)},It(A)?A:{default:()=>[A]})}}],p=[{title:"正确",colKey:"accept",cell:($,R)=>{let A=0;return R.row.accept&&(A=R.row.accept),t(B,{variant:"dashed",onClick:()=>f(R.row.username)},It(A)?A:{default:()=>[A]})}},{title:"提交",colKey:"attempt",cell:($,R)=>{let A=0;return R.row.attempt&&(A=R.row.attempt),t(B,{variant:"dashed",onClick:()=>s(R.row.username)},It(A)?A:{default:()=>[A]})}}],_=d(!1);let I=1,i=50;const v=d({current:I,pageSize:i,defaultCurrent:I,defaultPageSize:i,total:0,pageSizeOptions:[50]}),S=d(),C=$=>{n.push({name:"user",params:{username:$}})},f=$=>{n.push({name:"judge-list",query:{username:$,status:De.Accept}})},s=$=>{n.push({name:"judge-list",query:{username:$}})},w=async($,R)=>{_.value=!0;try{S.value=[];const{current:A,pageSize:j}=$;let D=null;switch(m.type){case"problem":D=await xs(A,j);break;case"problem-today":D=await Ts(A,j);break;case"problem-day7":D=await Vs(A,j);break;case"problem-year":D=await Ls(A,j);break;default:D=await Ps(A,j);break}if(D.code===0){const M=D.data.list;if(!M||M.length<=0){v.value={...v.value,total:0},ge(r,"未找到记录");return}S.value=[];const z=v.value.pageSize*(v.value.current-1);let P=1;M.forEach(T=>{var E;const V=T;V.index=z+P++,(E=S.value)==null||E.push(V)}),v.value={...v.value,total:D.data.total_count}}else R&&J(r,D.code)}catch(A){console.error(A),J(r,ze())}finally{_.value=!1}},h=async $=>{await n.push({query:{...a.query,page:$.current,page_size:$.pageSize}})};return ie(async()=>{_.value=!0,o=je(()=>a.query,$=>{switch(m.type&&k[m.type]?(y.value=k[m.type].header,b.value=k[m.type].content):(y.value=k.all.header,b.value=k.all.content),m.type){case"all":g.value=u.concat(p);break;default:g.value=u.concat(c);break}const R=parseInt($.page)||v.value.defaultCurrent,A=parseInt($.page_size)||v.value.defaultPageSize;I=R,i=A,v.value={...v.value,current:I,pageSize:i},w({current:I,pageSize:i},!0)},{immediate:!0})}),Te(()=>{o&&o()}),($,R)=>{const A=Ve,j=fe,D=Se,M=Ce;return L(),K(M,null,{default:l(()=>[t(D,{span:9},{default:l(()=>[t(j,{style:{margin:"10px"}},{default:l(()=>[t(A,{data:S.value,columns:g.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:v.value,loading:_.value,"table-layout":"auto",onPageChange:h},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(D,{span:3},{default:l(()=>[U("div",js,[t(j,{class:"sh-card",header:y.value,"header-bordered":!0},{default:l(()=>[x(F(b.value),1)]),_:1},8,["header"])])]),_:1})]),_:1})}}}),rt=ue(Ds,[["__scopeId","data-v-9bbfd60b"]]),zs=re({__name:"ManageJudge",setup(e){const{globalProperties:a}=me(),n=d(!1),r=d(!1),o=d({problemId:"",language:void 0,status:void 0}),m=d(!1),y=d([]);y.value=At();const b=d([]);b.value=wa();const k=async()=>{n.value=!0;try{const c=await Cn();if(c.code!==0){J(a,c.code);return}ge(a,"重判成功"),await Z.push({name:"judge-list"})}catch(c){console.error(c),J(a,"重判失败")}finally{n.value=!1}},g=async()=>{if(!o.value.problemId&&!o.value.language&&!o.value.status){J(a,"请输入问题Id");return}m.value=!0;try{const c=await Sn(o.value.problemId,o.value.language,o.value.status);if(c.code!==0){J(a,c.code);return}ge(a,"重判成功"),await Z.push({name:"judge-list",query:{problem_id:o.value.problemId,language:o.value.language}})}catch(c){console.error(c),J(a,"重判失败")}finally{m.value=!1}},u=async()=>{r.value=!0;try{const c=await In();if(c.code!==0){J(a,c.code);return}ge(a,"重判成功"),await Z.push({name:"judge-list"})}catch(c){console.error(c),J(a,"重判失败")}finally{r.value=!1}};return(c,p)=>{const _=B,I=fe,i=Ae,v=Ue,S=zt,C=wt,f=be,s=$e;return L(),ae(ne,null,[t(I,{class:"yj-manage-card",title:"重判最近提交"},{default:l(()=>[t(_,{onClick:k,loading:n.value},{default:l(()=>p[3]||(p[3]=[x("重判")])),_:1},8,["loading"])]),_:1}),t(I,{class:"yj-manage-card",title:"重判指定记录"},{default:l(()=>[t(s,{layout:"inline",onSubmit:g},{default:l(()=>[t(v,{label:"题号"},{default:l(()=>[t(i,{modelValue:o.value.problemId,"onUpdate:modelValue":p[0]||(p[0]=w=>o.value.problemId=w),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(v,{label:"语言"},{default:l(()=>[t(C,{modelValue:o.value.language,"onUpdate:modelValue":p[1]||(p[1]=w=>o.value.language=w),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:l(()=>[(L(!0),ae(ne,null,we(y.value,w=>(L(),K(S,{key:w.value,value:w.value,label:w.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(v,{label:"状态"},{default:l(()=>[t(C,{modelValue:o.value.status,"onUpdate:modelValue":p[2]||(p[2]=w=>o.value.status=w),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:l(()=>[(L(!0),ae(ne,null,we(b.value,w=>(L(),K(S,{key:w.value,value:w.value,label:w.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(v,null,{default:l(()=>[t(f,null,{default:l(()=>[t(_,{theme:"primary",type:"submit",loading:m.value},{default:l(()=>p[4]||(p[4]=[x("重判")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(I,{class:"yj-manage-card",title:"重判所有"},{default:l(()=>[t(_,{onClick:u,theme:"danger",loading:r.value},{default:l(()=>p[5]||(p[5]=[x("重判")])),_:1},8,["loading"])]),_:1})],64)}}}),$s=ue(zs,[["__scopeId","data-v-6a706c72"]]),Us={style:{margin:"10px"}},As={key:1},Rs={style:{margin:"12px"}},Es={class:"dida-edit-container"},Ms=re({__name:"ProblemEdit",setup(e){let a=he();const{globalProperties:n}=me(),r=Ke(),o=d(""),m=d(!1);let y=null;const b=d(!1),k=d(null),g=d({title:"",timeLimit:0,memoryLimit:0,source:"",private:!0,tags:[]}),u=d([]),c=d([]),p=Fe(()=>{const w=[],h=u.value;for(let $=0,R=h.length;$<R;$++)h[$].value&&w.push(h[$].value);return w}),_=(w,h)=>{const{trigger:$,index:R,item:A}=h;if($==="clear"&&(u.value=[]),["tag-remove","backspace"].includes($)&&u.value.splice(R,1),$==="enter"){for(let D=0;D<c.value.length;D++){const M=c.value[D];if(M.label===A){for(let z=0;z<u.value.length;z++)if(u.value[z].label===M.label)return;u.value.push(M);return}}const j={label:A,value:A};u.value.push(j),c.value=c.value.concat(j)}},I=(w,{current:h,type:$})=>{if(!h){u.value=$==="check"?c.value.slice(1):[];return}if($==="check"){const R=c.value.find(A=>A.value===h);if(!R)return;u.value.push(R)}else u.value=u.value.filter(R=>R.value!==h)},i=()=>{Z.push({name:"problem-detail",params:{problemId:o.value}})},v=()=>{Z.push({name:"manage-problem-judge",params:{problemId:o.value}})},S=async()=>{if(y){b.value=!0,g.value.tags=[];for(let w=0;w<u.value.length;w++){const h=u.value[w];h&&h.label&&g.value.tags.push(h.label)}try{const w=await Ln(g.value.title,g.value.timeLimit,g.value.memoryLimit,g.value.source,g.value.private,g.value.tags,y.getValue());if(b.value=!0,w.code!==0){J(n,w.code);return}w.data!=null&&await Z.push({name:"problem-detail",params:{problemId:w.data}}),Be(n,"创建成功")}finally{b.value=!1}}},C=async()=>{if(y){b.value=!0,g.value.tags=[];for(let w=0;w<u.value.length;w++){const h=u.value[w];h&&h.label&&g.value.tags.push(h.label)}try{const w=await jn(o.value,g.value.title,g.value.timeLimit,g.value.memoryLimit,g.value.source,g.value.private,g.value.tags,y.getValue());if(b.value=!0,w.code!==0){J(n,w.code);return}w.data!=null&&(k.value.updateTime=new Date(w.data).toLocaleString()),Be(n,"保存成功")}finally{b.value=!1}}},f=w=>{const h={after:()=>{y==null||y.setValue(w),m.value=!1}};y=new _e("problemEditDiv",h)},s=async()=>{const w=await Ca(o.value,void 0,void 0);if(w.code!==0){J(n,w.code),console.error("problem get failed",w.code),await Z.push({name:"problem"});return}const h=w.data.problem;if(k.value=ct(h,{}),g.value.title=h.title,g.value.timeLimit=h.time_limit,g.value.memoryLimit=h.memory_limit,g.value.source=h.source,g.value.private=h.private,g.value.tags=[],u.value=[],w.data.tags)for(let R=0;R<w.data.tags.length;R++){const A=w.data.tags[R];A&&A.name&&(g.value.tags.push(A.name),u.value.push({label:A.name,value:A.id}))}r.setTitle(h.title+" - "+r.getTitle);let $=h.description;f($)};return ie(async()=>{Array.isArray(a.params.problemId)?o.value=a.params.problemId[0]:o.value=a.params.problemId,o.value?(m.value=!0,Sa(-1).then(async w=>{w.code===0?(w.data.list&&w.data.list.forEach(h=>{c.value.push({label:h.name,value:h.id})}),await s()):(J(n,w.code),console.error("problem tag get failed",w.code),await Z.push({name:"problem"}))}).catch(async w=>{console.error(w),J(n,"获取数据异常"),await Z.push({name:"problem"})})):(g.value.timeLimit=1e3,g.value.memoryLimit=65536,f(""))}),(w,h)=>{const $=Ae,R=Ue,A=pa,j=it,D=il,M=ul,z=$e,P=fe,T=Se,V=B,E=be,Y=Oe,W=Ge,q=Ce,G=xe;return L(),K(G,{loading:m.value},{default:l(()=>[t(q,null,{default:l(()=>[t(T,{span:8},{default:l(()=>[U("div",Us,[t(P,{class:"sh-card"},{default:l(()=>[t(z,{model:g.value},{default:l(()=>[t(R,{label:"标题"},{default:l(()=>[t($,{modelValue:g.value.title,"onUpdate:modelValue":h[0]||(h[0]=N=>g.value.title=N),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),t(R,{label:"时间限制"},{default:l(()=>[t(A,{modelValue:g.value.timeLimit,"onUpdate:modelValue":h[1]||(h[1]=N=>g.value.timeLimit=N),theme:"normal",min:0},{suffix:l(()=>h[5]||(h[5]=[U("span",null,"ms",-1)])),_:1},8,["modelValue"])]),_:1}),t(R,{label:"内存限制"},{default:l(()=>[t(A,{modelValue:g.value.memoryLimit,"onUpdate:modelValue":h[2]||(h[2]=N=>g.value.memoryLimit=N),theme:"normal",min:0},{suffix:l(()=>h[6]||(h[6]=[U("span",null,"KB",-1)])),_:1},8,["modelValue"])]),_:1}),t(R,{label:"来源"},{default:l(()=>[t($,{modelValue:g.value.source,"onUpdate:modelValue":h[3]||(h[3]=N=>g.value.source=N),placeholder:"请输入题目来源"},null,8,["modelValue"])]),_:1}),t(R,{label:"私有"},{default:l(()=>[t(j,{modelValue:g.value.private,"onUpdate:modelValue":h[4]||(h[4]=N=>g.value.private=N)},null,8,["modelValue"])]),_:1}),t(R,{label:"标签"},{default:l(()=>[t(M,{value:u.value,"allow-input":!0,placeholder:"请选择或输入","tag-input-props":{excessTagsDisplayType:"break-line"},"popup-props":{overlayInnerClassName:["narrow-scrollbar"],overlayInnerStyle:{maxHeight:"280px",overflowY:"auto",overscrollBehavior:"contain",padding:"6px"}},clearable:"",multiple:"",onTagChange:_},{panel:l(()=>[c.value.length?(L(),K(D,{key:0,value:p.value,options:c.value,onChange:I},null,8,["value","options"])):(L(),ae("div",As,"暂无数据"))]),suffixIcon:l(()=>[t(ce(Fa))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(T,{span:4},{default:l(()=>[U("div",Rs,[U("div",Es,[o.value?(L(),K(E,{key:0},{default:l(()=>[t(V,{onClick:C,theme:"danger",loading:b.value},{default:l(()=>h[7]||(h[7]=[x("保存")])),_:1},8,["loading"]),t(V,{onClick:v,theme:"warning"},{default:l(()=>h[8]||(h[8]=[x("判题数据")])),_:1}),t(V,{onClick:i},{default:l(()=>h[9]||(h[9]=[x("查看")])),_:1})]),_:1})):(L(),K(E,{key:1},{default:l(()=>[t(V,{onClick:S,theme:"danger",loading:b.value},{default:l(()=>h[10]||(h[10]=[x("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(L(),K(W,{key:0,layout:"vertical",bordered:!0},{default:l(()=>[t(Y,{label:"创建时间"},{default:l(()=>{var N;return[x(F((N=k.value)==null?void 0:N.insertTime),1)]}),_:1}),t(Y,{label:"更新时间"},{default:l(()=>{var N;return[x(F((N=k.value)==null?void 0:N.updateTime),1)]}),_:1}),t(Y,{label:"判题方式"},{default:l(()=>{var N;return[x(F((N=k.value)==null?void 0:N.judgeType),1)]}),_:1}),t(Y,{label:"上传用户"},{default:l(()=>{var N;return[x(F((N=k.value)==null?void 0:N.creatorNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),h[11]||(h[11]=U("div",{id:"problemEditDiv",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"])}}}),ea=ue(Ms,[["__scopeId","data-v-583e6955"]]),qs={style:{margin:"10px"}},Ks={style:{margin:"12px"}},Fs={class:"dida-edit-container"},Ns=re({__name:"ProblemJudge",setup(e){let a=he();const{globalProperties:n}=me(),r=Ke(),o=d(""),m=d(!1),y=d(null);let b=null;const k=d(null),g=d(""),u=d(!1),c=d(!1),p=d([{title:"文件",colKey:"file"},{title:"大小",colKey:"size",width:150,cell:(j,D)=>D.row.size.toFixed(0)+" B"},{title:"最后修改时间",colKey:"lastModified",width:180,cell:(j,D)=>new Date(D.row.lastModified).toLocaleString()},{title:"操作",colKey:"action",width:100,cell:(j,D)=>t(B,{onClick:()=>C(D.row.file)},{default:()=>[x("下载")]})}]),_=d([]),I=Fe(()=>({border:"2px dashed #ccc",borderRadius:"6px",padding:"20px",textAlign:"center",cursor:"pointer",backgroundColor:u.value?"#f0f9ff":"#fff",transition:"background-color 0.2s ease"})),i=Fe(()=>g.value?`已选择：${g.value}`:u.value?"松开文件以上传":"拖拽文件到这里，或点击选择文件"),v=()=>{Z.push({name:"problem-detail",params:{problemId:o.value}})},S=()=>{Z.push({name:"manage-problem",params:{problemId:o.value}})},C=async j=>{const D=await Dn(o.value,j);if(D.code!==0){J(n,D.code);return}const M=document.createElement("a");M.href=D.data,M.target="_blank",M.click(),URL.revokeObjectURL(M.href)},f=async()=>{if(!b){ve(n,"请选择压缩包");return}c.value=!0,zn(o.value,b).then(async j=>{j.code==0?(k.value.value=null,b=null,g.value="",m.value=!0,Be(n,"上传成功"),await A()):J(n,j.code)}).catch(j=>{console.log(j),n.$message.error({duration:3e3,content:"申请失败"})}).finally(()=>{c.value=!1})},s=()=>{var j;(j=k.value)==null||j.click()},w=j=>{const D=j.target.files[0];D&&(g.value=D.name,b=D)},h=j=>{u.value=!0},$=()=>{u.value=!1},R=j=>{j.preventDefault(),j.stopPropagation(),u.value=!1;const D=j.dataTransfer.files[0];if(D){g.value=D.name;const M=new DataTransfer;M.items.add(D),k.value.files=M.files,b=D}},A=async()=>{const j=await xn(o.value);if(j.code!==0){J(n,j.code),await Z.push({name:"problem"});return}const D=j.data.problem;y.value=ct(D,{}),r.setTitle(D.title+" - "+r.getTitle),_.value=[],j.data.judges?j.data.judges.forEach(M=>{_.value.push({file:M.key,size:M.size,lastModified:M.last_modified})}):ve(n,"评测数据不存在"),m.value=!1};return ie(async()=>{if(Array.isArray(a.params.problemId)?o.value=a.params.problemId[0]:o.value=a.params.problemId,!o.value){ve(n,"题目不存在"),await Z.push({name:"problem"});return}m.value=!0,await A()}),(j,D)=>{const M=Ve,z=Se,P=B,T=be,V=Oe,E=Ge,Y=Ce,W=xe;return L(),K(W,{loading:m.value},{default:l(()=>[t(Y,null,{default:l(()=>[t(z,{span:7},{default:l(()=>[U("div",qs,[U("div",{id:"drop-zone",style:sa(I.value),onClick:s,onDragenter:gt(h,["prevent"]),onDragover:D[0]||(D[0]=gt(()=>{},["prevent"])),onDragleave:gt($,["prevent"]),onDrop:R},[U("input",{ref_key:"fileInput",ref:k,type:"file",style:{display:"none"},onChange:w},null,544),x(" "+F(i.value),1)],36)]),t(M,{data:_.value,columns:p.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1}),t(z,{span:5},{default:l(()=>[U("div",Ks,[U("div",Fs,[t(T,null,{default:l(()=>[t(P,{onClick:f,theme:"danger",loading:c.value},{default:l(()=>D[1]||(D[1]=[x("上传")])),_:1},8,["loading"]),t(P,{onClick:S,theme:"warning"},{default:l(()=>D[2]||(D[2]=[x("编辑")])),_:1}),t(P,{onClick:v},{default:l(()=>D[3]||(D[3]=[x("查看")])),_:1})]),_:1})]),t(E,{layout:"vertical",bordered:!0},{default:l(()=>[t(V,{label:"标题"},{default:l(()=>{var q;return[x(F((q=y.value)==null?void 0:q.title),1)]}),_:1}),t(V,{label:"创建时间"},{default:l(()=>{var q;return[x(F((q=y.value)==null?void 0:q.insertTime),1)]}),_:1}),t(V,{label:"更新时间"},{default:l(()=>{var q;return[x(F((q=y.value)==null?void 0:q.updateTime),1)]}),_:1}),t(V,{label:"判题方式"},{default:l(()=>{var q;return[x(F((q=y.value)==null?void 0:q.judgeType),1)]}),_:1}),t(V,{label:"评测数据"},{default:l(()=>{var q;return[x(F((q=y.value)==null?void 0:q.judgeMd5),1)]}),_:1}),t(V,{label:"上传用户"},{default:l(()=>{var q;return[x(F((q=y.value)==null?void 0:q.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Gs=ue(Ns,[["__scopeId","data-v-17986e38"]]),Os={style:{display:"flex","align-items":"center"}},Hs={style:{color:"#409eff","margin-right":"20px"}},Bs={class:"dida-login-footer"},Js=re({__name:"UserForget",setup(e){const{globalProperties:a}=me(),n=Le(),r=d(!1),o=d(!1),m=d(!1),y=d("发送验证码");let b=null,k=-1;const g=d(!1),u=d(null),c=d(""),p=d({username:"",emailKey:"",password:"",confirmPassword:""}),I=d({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:w=>new Promise(h=>{const $=setTimeout(()=>{h(p.value.password===w),clearTimeout($)})}),message:"两次密码不一致"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),i=()=>{ge(a,"重置成功")},v=async w=>{if(!m.value){r.value=!0,o.value=!0;try{const h=await en(w,p.value.username);h.code===0?(ge(a,"验证码发送成功"),c.value=h.data,o.value=!1,m.value=!0,b=new Date,y.value="60秒后重发",k=setInterval(()=>{const R=Math.floor((new Date().getTime()-(b==null?void 0:b.getTime()))/1e3);R>60?(y.value="发送验证码",m.value=!1,clearInterval(k)):y.value=`${60-R}秒后重发`},1e3)):J(a,h.code)}catch(h){console.error("Send email key error",h),ve(a,"发送验证码失败")}finally{r.value=!1}}},S=async()=>{var R;if(g.value=!0,m.value||o.value)return;await qe();const w=document.getElementById("cf-confirm-div");w&&w.remove();const h=document.createElement("div");h.id="cf-confirm-div",h.setAttribute("data-theme","light"),(R=u.value)==null||R.appendChild(h);const $=window;$.turnstile.ready(function(){$.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(A){g.value=!1,await v(A)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},C=d(()=>t(B,{onClick:S,disabled:m.value,loading:o.value,style:"width:120px"},{default:()=>[y.value]})),f=async()=>{r.value=!0;try{const w=await tn(p.value.username,p.value.password,p.value.emailKey);w.code===0?(ge(a,"密码修改成功"),a.$router.push({name:"login"})):J(a,w.code)}catch(w){console.error("Modify password error",w),ve(a,"修改密码失败")}finally{r.value=!1}},s=async({validateResult:w,firstError:h,e:$})=>{if(!r.value){if($.preventDefault(),w!==!0){ve(a,h);return}c.value?await f():await S()}};return ie(()=>{if(n.isLogin()){a.$router.push({path:"/user"});return}}),Te(()=>{}),(w,h)=>{const $=Dt,R=Ae,A=Ue,j=ua,D=B,M=$e,z=at,P=fe,T=Ze;return L(),ae(ne,null,[t(P,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:l(()=>[t($,{"max-line":1},{default:l(()=>h[6]||(h[6]=[U("span",null,"如果您未绑定邮箱或忘记用户名，可联系管理员寻求帮助",-1),U("span",null,"管理员邮箱：BoilTask@qq.com",-1)])),_:1}),t(M,{ref:"form",rules:I.value,data:p.value,colon:!0,onReset:i,onSubmit:s,class:"yj-login-form"},{default:l(()=>[t(A,{name:"username",label:"用户名"},{default:l(()=>[t(R,{modelValue:p.value.username,"onUpdate:modelValue":h[0]||(h[0]=V=>p.value.username=V),clearable:"",placeholder:"请输入完整用户名"},null,8,["modelValue"])]),_:1}),c.value?(L(),ae(ne,{key:0},[t(A,{name:"email",label:"发送邮箱"},{default:l(()=>[t(j,{append:C.value},{default:l(()=>[U("div",Os,[U("span",Hs,F(c.value),1)])]),_:1},8,["append"])]),_:1}),t(A,{name:"emailKey",label:"验证码"},{default:l(()=>[t(R,{modelValue:p.value.emailKey,"onUpdate:modelValue":h[1]||(h[1]=V=>p.value.emailKey=V),clearable:"",placeholder:"请输入收到的验证码"},null,8,["modelValue"])]),_:1}),t(A,{name:"password",label:"新密码"},{default:l(()=>[t(R,{modelValue:p.value.password,"onUpdate:modelValue":h[2]||(h[2]=V=>p.value.password=V),type:"password",clearable:"",placeholder:"新密码"},null,8,["modelValue"])]),_:1}),t(A,{name:"confirmPassword",label:"确认密码"},{default:l(()=>[t(R,{modelValue:p.value.confirmPassword,"onUpdate:modelValue":h[3]||(h[3]=V=>p.value.confirmPassword=V),type:"password",clearable:"",placeholder:"请重复输入密码"},null,8,["modelValue"])]),_:1})],64)):le("",!0),c.value?(L(),K(A,{key:1},{default:l(()=>[t(D,{theme:"primary",type:"submit",block:"",loading:r.value},{default:l(()=>h[7]||(h[7]=[x("修改密码")])),_:1},8,["loading"])]),_:1})):(L(),K(A,{key:2},{default:l(()=>[t(D,{theme:"primary",type:"submit",block:"",loading:r.value},{default:l(()=>h[8]||(h[8]=[x("重置密码")])),_:1},8,["loading"])]),_:1}))]),_:1},8,["rules","data"]),U("div",Bs,[t(z,{onClick:h[4]||(h[4]=()=>{ce(a).$router.push({name:"login"})})},{default:l(()=>h[9]||(h[9]=[x("返回登陆 ")])),_:1})])]),_:1}),t(T,{visible:g.value,"onUpdate:visible":h[5]||(h[5]=V=>g.value=V),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:l(()=>[U("div",{ref_key:"dialogContainer",ref:u,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),Ys=ue(Js,[["__scopeId","data-v-c3586c6f"]]),La=[{name:"problem-list",tab:"problem",sidebar:"problem-list",path:"",title:"问题列表",icon:"list",component:Mn},{name:"problem-detail",tab:"problem",sidebar:"problem-list",path:":problemId+",title:"问题详情",icon:"list",component:Ot},{name:"problem-recommend",tab:"problem",sidebar:"problem-recommend",path:"recommend/:problemId*",title:"问题推荐",icon:"cpu",needLogin:!0,component:so},{name:"problem-collection-list",tab:"problem",sidebar:"problem-collection-list",path:"collection",title:"题目集合",icon:"list",disableTabPath:!0,component:bo},{name:"collection-detail",tab:"collection-detail-tab",sidebar:"collection-detail",path:":collectionId+",title:"题集详情",icon:"cpu",component:So},{name:"collection-rank",tab:"collection-detail-tab",sidebar:"collection-rank",path:":collectionId+/rank",title:"题集排名",icon:"list",component:Io},{name:"collection-edit",tab:"collection-detail-tab",sidebar:"collection-edit",disableSidebar:!0,needLogin:!0,path:":collectionId+/edit",title:"题集编辑",icon:"list",component:Ht},{name:"collection-create",tab:"collection-detail-tab",sidebar:"collection-create",needLogin:!0,disableSidebar:!0,path:"create",title:"新建题集",icon:"list",component:Ht},{name:"judge-list",tab:"judge",sidebar:"judge-list",path:"",title:"评测列表",icon:"list",component:Jt},{name:"judge-detail",tab:"judge",sidebar:"judge-list",path:":judgeId+",title:"评测详情",icon:"cpu",component:Wt},{name:"contest-list",tab:"contest",sidebar:"contest-list",path:"",title:"比赛列表",icon:"list",component:Xt},{name:"contest-recent",tab:"contest",sidebar:"contest-recent",path:"recent",title:"近期比赛",icon:"list",component:Xt},{name:"contest-create",tab:"contest",sidebar:"contest-create",disableSidebar:!0,needLogin:!0,path:"create",title:"新建比赛",icon:"list",component:Qt},{name:"contest-edit",tab:"contest-detail-tab",sidebar:"contest-edit",disableSidebar:!0,needLogin:!0,path:":contestId+/edit",title:"比赛编辑",icon:"list",component:Qt},{name:"contest-detail",tab:"contest-detail-tab",sidebar:"contest-detail",path:":contestId+",title:"比赛详情",icon:"cpu",component:Zo},{name:"contest-problem-detail",tab:"contest-detail-tab",sidebar:"contest-problem-detail",path:":contestId+/problem/:problemIndex+",title:"问题详情",icon:"cpu",disableSidebar:!0,component:Ot},{name:"contest-judge",tab:"contest-detail-tab",sidebar:"contest-judge",path:":contestId+/judge",title:"评测列表",icon:"list",component:Jt},{name:"contest-judge-detail",tab:"contest-detail-tab",sidebar:"contest-judge-detail",path:":contestId+/judge/:judgeId+",title:"评测详情",icon:"cpu",component:Wt,disableSidebar:!0},{name:"contest-rank",tab:"contest-detail-tab",sidebar:"contest-rank",path:":contestId+/rank",title:"比赛排名",icon:"list",component:ns},{name:"contest-discuss",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss",title:"比赛讨论",icon:"list",component:ft},{name:"contest-discuss-detail",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss/:discussId+",title:"讨论详情",icon:"list",component:St},{name:"discuss-list",tab:"discuss",sidebar:"discuss-list",path:"",title:"讨论列表",icon:"list",component:ft},{name:"discuss-list-problem",tab:"discuss",sidebar:"discuss-list-problem",path:"problem",title:"问题讨论",icon:"list",component:ft},{name:"discuss-list-judge",tab:"discuss",sidebar:"discuss-list-judge",path:"judge",title:"评测讨论",icon:"list",component:ft},{name:"discuss-detail",tab:"discuss",sidebar:"discuss-list",path:":discussId+",title:"讨论详情",icon:"list",component:St},{name:"rank-ac-all",tab:"rank",sidebar:"rank-ac-all",path:"ac",title:"AC排名",icon:"base-station",props:{type:"all"},component:rt},{name:"rank-ac-problem",tab:"rank",sidebar:"rank-ac-problem",path:"ac/problem",title:"题量排名",icon:"base-station",props:{type:"problem"},component:rt},{name:"rank-ac-problem-today",tab:"rank",sidebar:"rank-ac-problem-today",path:"ac/problem/today",title:"今日题量",icon:"base-station",props:{type:"problem-today"},component:rt},{name:"rank-ac-problem-day7",tab:"rank",sidebar:"rank-ac-problem-day7",path:"ac/problem/day7",title:"7日题量",icon:"base-station",props:{type:"problem-day7"},component:rt},{name:"rank-ac-problem-year",tab:"rank",sidebar:"rank-ac-problem-year",path:"ac/problem/year",title:"1年题量",icon:"base-station",props:{type:"problem-year"},component:rt},{name:"tool-paste",tab:"tool",sidebar:"tool-paste",path:"paste",title:"码池",icon:"base-station",component:Vt},{name:"system-status",tab:"system",sidebar:"system-status",path:"",title:"运行状态",icon:"base-station",component:Vt},{name:"system-about",tab:"system",sidebar:"system-about",path:"about",title:"关于",icon:"base-station",props:{discussId:"52"},component:St},{name:"manage-problem-create",tab:"manage",sidebar:"manage-problem-create",disableSidebar:!0,path:"problem",title:"新建问题",icon:"list",component:ea,auths:[Me.ManageProblem]},{name:"manage-problem",tab:"manage",sidebar:"manage-problem",disableSidebar:!0,path:"problem/:problemId+",title:"问题编辑",icon:"list",component:ea,auths:[Me.ManageProblem]},{name:"manage-problem-judge",tab:"manage",sidebar:"manage-problem-judge",disableSidebar:!0,path:"problem/:problemId+/judge",title:"评测数据",icon:"list",component:Gs,auths:[Me.ManageProblem]},{name:"manage-judge",tab:"manage",path:"judge",sidebar:"manage-judge",title:"评测管理",icon:"list",auths:["i-manage-judge"],component:$s},{name:"login-forget",tab:"login",path:"forget",title:"忘记密码",component:Ys}],ta=(e,a,n,r)=>{r.tab==n&&(r.disableSidebar&&a!=r.sidebar||r.sidebar==null||r.sidebar!=r.name||e.push({name:r.name,title:r.title,icon:r.icon,to:{name:r.name}}))},Ws=(e,a)=>{const n=[];return La.forEach(r=>{if(ha(r)){const o=[];r.children.forEach(m=>{ta(o,e,a,m)}),o.length>0&&n.push({title:r.title,children:o})}else ta(n,e,a,r)}),n},aa=(e,a)=>{const n=fn(a.tab),r={name:a.name,path:"/"+a.path,meta:{title:a.title+" - "+n.title,tab:a.tab,sidebar:a.sidebar,showSidebar:n.showSidebar,needLogin:n.needLogin||a.needLogin,tabAuths:n.auths,auths:a.auths},props:a.props,component:a.component};!n.disablePath&&!a.disableTabPath&&(r.path=n.path+r.path),e.push(r)},Xs=e=>{La.forEach(a=>{ha(a)?a.children.forEach(n=>{aa(e,n)}):aa(e,a)})},Zs={class:"sh-main"},Qs=re({__name:"View403",setup(e){let a=he();const n=d("");return ie(()=>{a.query.target?n.value=a.query.target:n.value=a.fullPath}),(r,o)=>{const m=B;return L(),ae("div",Zs,[U("p",null,F(n.value),1),o[2]||(o[2]=U("p",null,"该页面无访问权限，请更换访问目标或重新登陆后再试",-1)),t(m,{theme:"primary",onClick:o[0]||(o[0]=()=>r.$router.push("/"))},{default:l(()=>o[1]||(o[1]=[x("返回首页")])),_:1})])}}}),ja=ue(Qs,[["__scopeId","data-v-8f62f1f8"]]),dt=[];_n(dt);Xs(dt);dt.push({path:"/403",name:"403",component:ja});dt.push({path:"/:pathMatch(.*)*",name:"404",component:ga});const Z=Na({history:Ga("/"),routes:dt});Z.beforeEach((e,a,n)=>{if(e.name==null||!Z.hasRoute(e.name)){n({name:"home"});return}const r=e.matched[e.matched.length-1].meta;if(r.redirect){n({name:r.redirect});return}if(r.needLogin){const m=Le();if(m.getToken==null||m.getToken==""){n({name:"login",query:{redirect_uri:e.fullPath}});return}}const o=r.tabAuths;if(o&&!Le().hasAllAuths(o)){n({name:"403",query:{target:e.fullPath}});return}n()});Z.afterEach((e,a)=>{if(e.name===a.name)return;const n=Ct(),r=Ke();let o=null;if(e.matched.length>0&&(o=e.matched[e.matched.length-1].meta),o!=null&&o.title&&r.setTitle(o==null?void 0:o.title),o!=null&&o.showSidebar){n.setSidebarShow(!0);const m=Ws(o==null?void 0:o.sidebar,o==null?void 0:o.tab);n.setMenuList(m),n.setMenuActiveName(o==null?void 0:o.sidebar)}else n.setSidebarShow(!1)});const Da=ut("login",{state:()=>({Loaded:!1}),getters:{isLoaded(){return this.Loaded}}}),er=re({__name:"HeaderContent",setup(e){const a=Da(),n=Le(),{globalProperties:r}=me(),o=d(a.isLoaded),m=d(!1),y=d(n.getUsername),b=d(n.getNickname),k=d(),g=()=>{k.value=vn(n)};a.$subscribe((p,_)=>{o.value=_.Loaded}),n.$subscribe((p,_)=>{y.value=_.username,b.value=_.nickname,m.value=_.token!="",g()});const u=()=>{r.$router.currentRoute.value.name!=="login"&&r.$router.push({name:"login",query:{redirect_uri:r.$router.currentRoute.value.fullPath}})},c=()=>{n.clear(),r.$message.success({duration:3e3,content:"注销成功"}),r.$router.push({path:"/login",query:{redirect_uri:r.$router.currentRoute.value.fullPath}})};return ie(()=>{g()}),(p,_)=>{const I=ra("router-link"),i=va,v=fa,S=cl,C=dl;return L(),K(C,{modelValue:p.$route.meta.tab,"onUpdate:modelValue":_[0]||(_[0]=f=>p.$route.meta.tab=f),class:"sh-menu","expand-type":"popup"},{logo:l(()=>[t(I,{to:"/",class:"sh-logo"},{default:l(()=>_[1]||(_[1]=[x("DidaOJ")])),_:1})]),operations:l(()=>[o.value&&m.value?(L(),K(S,{key:0,title:b.value},{icon:l(()=>[t(i,{name:"user"})]),default:l(()=>[t(v,{value:"user",to:{path:"/user/"+y.value}},{default:l(()=>_[2]||(_[2]=[x("个人空间")])),_:1},8,["to"]),t(v,{value:"user_logout",onClick:c},{default:l(()=>_[3]||(_[3]=[x(" 注销")])),_:1})]),_:1},8,["title"])):o.value?(L(),K(v,{key:2,value:"login",onClick:u},{icon:l(()=>[t(i,{name:"login"})]),default:l(()=>[_[5]||(_[5]=x(" 登录 "))]),_:1})):(L(),K(v,{key:1,value:"login"},{icon:l(()=>[t(i,{name:"login"})]),default:l(()=>[_[4]||(_[4]=x(" ... "))]),_:1}))]),default:l(()=>[(L(!0),ae(ne,null,we(k.value,f=>(L(),K(v,{key:f.name,value:f.name,to:{name:f.name}},{icon:l(()=>[f.icon?(L(),K(i,{key:0,name:f.icon},null,8,["name"])):le("",!0)]),default:l(()=>[x(" "+F(f.title),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])}}}),tr=ue(er,[["__scopeId","data-v-c64d812f"]]),ar={id:"menu-container"},lr=re({__name:"SidebarContent",setup(e){const a=Ct(),n=d(!1),r=d(null),o=d(a.menuActiveName),m=d(a.menuList),y=d([]),b=d(!1),k=()=>{o.value=a.menuActiveName;const u=JSON.stringify(m.value),c=JSON.stringify(a.menuList);u!==c&&(y.value.push([...a.menuList]),g())},g=async()=>{if(y.value.length>0&&!b.value){for(b.value=!0;y.value.length>1;)y.value.shift();const u=y.value.shift();n.value=u.length<=0,m.value=[],await qe(),r.value&&r.value.updateActiveName(),await new Promise(p=>setTimeout(p,300)),m.value=u,await qe(),r.value&&r.value.updateActiveName();const c=300;await new Promise(p=>setTimeout(p,c)),b.value=!1,await g()}};return a.$subscribe((u,c)=>{k()}),ie(()=>{k()}),(u,c)=>{const p=va,_=fa,I=pl,i=ml,v=xe;return L(),ae(ne,null,[U("div",ar,[t(i,{modelValue:o.value,"onUpdate:modelValue":c[0]||(c[0]=S=>o.value=S),theme:"light",class:"sh-menu-container"},{default:l(()=>[t(Oa,{name:"move-left"},{default:l(()=>[(L(!0),ae(ne,null,we(m.value,(S,C)=>(L(),ae(ne,{key:C},[ce(gn)(S)?(L(),K(I,{key:0,title:S.title},{default:l(()=>[(L(!0),ae(ne,null,we(S.children,(f,s)=>(L(),K(_,{key:f.name,value:f.name,to:f.to},Ft({default:l(()=>[x(" "+F(f.title),1)]),_:2},[f.icon?{name:"icon",fn:l(()=>[t(p,{name:f.icon,class:Tt(f.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))),128))]),_:2},1032,["title"])):(L(),K(_,{key:S.name,value:S.name,to:S.to},Ft({default:l(()=>[x(" "+F(S.title),1)]),_:2},[S.icon?{name:"icon",fn:l(()=>[t(p,{name:S.icon,class:Tt(S.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),t(v,{size:"small",loading:n.value,"show-overlay":!0,attach:"#menu-container",class:"sh-sidebar-loading",style:{"align-items":"flex-start","padding-top":"100px"}},null,8,["loading"])],64)}}}),nr=ue(lr,[["__scopeId","data-v-96e2d89f"]]),or={};function sr(e,a){return null}const rr=ue(or,[["render",sr]]),ur={class:"footer"},ir={class:"footer-left"},cr={class:"foot-time"},dr={class:"footer-center"},mr={href:"https://beiancx.miit.gov.cn/",target:"_blank"},pr={class:"footer-right"},fr={class:"foot-text"},vr={href:"https://github.com/hpu-developer/DiDaOJ-web",target:"_blank"},_r={class:"foot-text"},gr={href:"https://github.com/hpu-developer/DiDaOJ-go",target:"_blank"},br=re({__name:"FooterContent",setup(e){const a=d("");function n(){a.value=new Date().toLocaleString()}return ie(()=>{n(),setInterval(()=>{n()},1e3)}),(r,o)=>{const m=B;return L(),ae("div",ur,[U("div",ir,[U("p",cr,F(a.value),1)]),U("div",dr,[U("a",mr,[t(m,{theme:"default",variant:"outline",ghost:!0},{default:l(()=>o[0]||(o[0]=[x("豫ICP备15024677号-4")])),_:1})])]),U("div",pr,[U("p",fr,[U("a",vr,[t(m,{theme:"default",variant:"outline",ghost:!0},{default:l(()=>o[1]||(o[1]=[x("@didaoj-web")])),_:1})])]),U("p",_r,[U("a",gr,[t(m,{theme:"default",variant:"outline",ghost:!0},{default:l(()=>o[2]||(o[2]=[x("@didaoj-go")])),_:1})])])])])}}}),hr=ue(br,[["__scopeId","data-v-979fed79"]]),vt=20,Pt=100,xt=50,yr=re({__name:"ForceHiddenSidebarButton",setup(e){let a=Ct();const n=d({x:window.innerWidth-Pt-vt,y:window.innerHeight-xt-vt}),r=d(window.innerWidth),o=d(window.innerHeight);let m=!1,y={x:0,y:0};const b=S=>{m=!0;const C=S.clientX??S.touches[0].clientX,f=S.clientY??S.touches[0].clientY;y={x:C-n.value.x,y:f-n.value.y},document.addEventListener("mousemove",k),document.addEventListener("touchmove",k),document.addEventListener("mouseup",g),document.addEventListener("touchend",g)},k=S=>{if(!m)return;const C=S.clientX??S.touches[0].clientX,f=S.clientY??S.touches[0].clientY;let s=C-y.x,w=f-y.y;s=Math.max(0,Math.min(s,r.value-Pt)),w=Math.max(0,Math.min(w,o.value-xt)),n.value={x:s,y:w}},g=()=>{m=!1,document.removeEventListener("mousemove",k),document.removeEventListener("touchmove",k),document.removeEventListener("mouseup",g),document.removeEventListener("touchend",g)},u=()=>{r.value=window.innerWidth,o.value=window.innerHeight,n.value={x:Math.min(n.value.x,r.value-Pt-vt),y:Math.min(n.value.y,o.value-xt-vt)}};let c=d(a.forceHiddenSidebar),p=d(a.forceHiddenSidebar);const _=()=>{c.value=!c.value,a.setForceHiddenSidebar(c.value)},I=()=>{p.value||(p.value=!0,a.setForceHiddenSidebar(c.value))},i=()=>{p.value&&(p.value=!1,a.setForceHiddenSidebar(!1))},v=S=>{S>=800?i():I()};return v(r.value),je(r,S=>{v(S)}),ie(()=>{window.addEventListener("resize",u)}),Te(()=>{window.removeEventListener("resize",u)}),(S,C)=>{const f=B;return ce(p)?(L(),K(f,{key:0,class:"draggable-button",style:sa({top:`${n.value.y}px`,left:`${n.value.x}px`}),onMousedown:b,onTouchstart:b,variant:"dashed",theme:"primary",onClick:_},{default:l(()=>[x(F(ce(c)?"显示":"隐藏"),1)]),_:1},8,["style"])):le("",!0)}}}),wr=ue(yr,[["__scopeId","data-v-1aee5506"]]),_t="DidaOJ",kr=re({__name:"App",setup(e){const{globalProperties:a}=me(),n=Da(),r=Le(),o=Ke(),m=Ct();n.$patch({Loaded:!1});const y=r.getToken,b=d(!1),k=d(!1);o.title&&o.title.length>0?document.title=o.title+" - "+_t:document.title=_t,o.$subscribe((p,_)=>{_.title&&_.title.length>0?document.title=_.title+" - "+_t:document.title=_t}),m.$subscribe((p,_)=>{b.value=_.showSidebar,k.value=b.value&&!_.forceHiddenSidebar});const g=he(),u=Fe(()=>{const p=g.meta.auths;return p?!r.hasAllAuths(p):!1});function c(){a.$message.warning({duration:3e3,content:"登陆状态失效"}),n.$patch({Loaded:!0}),r.clear()}return ie(()=>{if(y==""){n.$patch({Loaded:!0});return}Bl().then(p=>{p.code==0?(r.loadResponse(p.data),n.$patch({Loaded:!0})):(J(a,p.code),n.$patch({Loaded:!0}),r.clear())}).catch(p=>{console.log(p),c()})}),(p,_)=>{const I=fl,i=_l,v=ra("RouterView"),S=gl,C=vl,f=bl;return L(),ae(ne,null,[t(C,null,{default:l(()=>[t(I,{class:"sh-header"},{default:l(()=>[t(tr)]),_:1}),t(C,null,{default:l(()=>[t(Ha,{name:"slide"},{default:l(()=>[k.value?(L(),K(i,{key:0,class:"sh-sidebar"},{default:l(()=>[t(nr)]),_:1})):le("",!0)]),_:1}),t(C,{class:Tt(["sh-main-layout",{expanded:!k.value}])},{default:l(()=>[t(rr),t(S,{class:"sh-main-content"},{default:l(()=>[u.value?(L(),K(ja,{key:0})):(L(),K(v,{key:1}))]),_:1}),t(hr)]),_:1},8,["class"])]),_:1})]),_:1}),b.value?(L(),K(wr,{key:0})):le("",!0),t(f,{container:"body",offset:["24px","80px"],size:"small"})],64)}}}),Cr=ue(kr,[["__scopeId","data-v-9e122cb4"]]);yl.registerLanguage("verilog",wl);const za=Ba();za.use(Ja);const mt=Ya(Cr);mt.use(za);mt.use(Z);mt.use(hl);mt.use(Wa);mt.mount("#app");ql().then(()=>{console.log("Text cache reinitialized")}).catch(e=>{console.error("Text cache reinitialization failed",e)});
