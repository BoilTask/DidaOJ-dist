import{bm as at,bn as It,n as ee,r as d,o as ne,G as Tt,bo as Y,bp as $,s as t,bq as n,br as A,F as Q,bs as _e,bt as G,bu as q,ap as x,u as Ve,bv as ce,bw as pe,aD as de,g as ta,bx as aa,by as na,bz as oa,J as we,q as Ce,bA as la,bB as $e,y as Te,c as Ae,bC as Oe,bD as ut,ac as sa,bE as xt,bF as ra,bG as ua,bH as jt,aM as ia,bI as it,a0 as ca,bJ as da,bK as ma,B as pa,bL as fa}from"./node_modules-x_y3cvPb.js";import{L as ye,C as re,S as ge,a as _a,T as ga,b as be,A as mt,c as va,d as ba,e as ha,f as ya,g as Ge,R as ve,B as F,F as De,h as Ue,I as xe,D as Be,i as Lt,j as qe,k as Ke,l as wa,m as Pe,n as pt,O as zt,P as ka,o as Vt,p as $t,q as Sa,r as Ca,s as Pa,t as Ia,u as Ta,v as xa,w as ja,M as Dt,x as Ut,y as La,H as za,z as Va,E as $a,G as Da,J as Ua,K as Ra,N as Aa,Q as Ea,U as qa}from"./tdesign-vue-next-UxLz_uvk.js";import{V as me}from"./vditor-DArazWIS.js";import{e as vt}from"./monaco-editor-DCUKHC_e.js";import{H as Ka,v as Ma}from"./highlight.js-D9zWiMxS.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const u of l)if(u.type==="childList")for(const h of u.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function o(l){const u={};return l.integrity&&(u.integrity=l.integrity),l.referrerPolicy&&(u.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?u.credentials="include":l.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(l){if(l.ep)return;l.ep=!0;const u=o(l);fetch(l.href,u)}})();var Ee=(e=>(e.Manage="i-manage",e.ManageJudge="i-manage-judge",e.ManageProblem="i-manage-problem",e))(Ee||{});const Fa={"r-admin":["i-manage","i-manage-judge","i-manage-problem"]};function Ga(e){if(e==null)return[];const a=[];for(const o of e){const r=Fa[o];r!=null&&a.push(...r)}return[...new Set(a)]}function Na(e,a){if(e==null||a==null)return!1;const o=Ga(e);for(const r of a)if(!o.includes(r))return!1;return!0}const ke=at("user",{state:()=>({token:"",userId:-1,username:"",nickname:"",roles:[]}),getters:{getToken(){return this.token},getUserId(){return this.userId},getUsername(){return this.username},getNickname(){return this.nickname}},actions:{clear(){this.$patch({token:"",userId:-1,username:"",nickname:"",roles:[]})},loadResponse(e){this.$patch({token:e.token,userId:e.user_id,username:e.username,nickname:e.nickname,roles:e.roles})},isLogin(){return this.token!=null&&this.token!=""},hasAuth(e){return this.hasAllAuths([e])},hasAllAuths(e){return e?Na(this.roles,e):!0}},persist:!0}),Re=at("webStyle",{state:()=>({title:""}),getters:{getTitle(){return this.title}},actions:{setTitle(e){this.title=e}}}),nt=at("sidebarStyle",{state:()=>({showSidebar:!1,forceHiddenSidebar:!1,menuActiveName:"",menuList:[]}),getters:{getMenuList(){return this.menuList}},actions:{setSidebarShow(e){this.showSidebar=e},setForceHiddenSidebar(e){this.forceHiddenSidebar=e},setMenuActiveName(e){this.menuActiveName=e},clearMenuList(){this.menuList=[]},setMenuList(e){this.menuList=e},addMenuList(e){this.menuList.push(e)}}}),Je=It.create({timeout:6e4,withCredentials:!1,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});Je.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function Oa(){return Je({baseURL:"https://r2-oj.didapipa.com",url:"/system/notification.json?"+Date.now(),method:"get"})}function Ha(){return Je({baseURL:"https://r2-oj.didapipa.com",url:"/status/judger.json?"+Date.now(),method:"get"})}function Rt(e){return Je({baseURL:"https://r2-oj.didapipa.com",url:"/status/judger/"+e+".json?"+Date.now(),method:"get"})}function Ba(e){return Je({baseURL:"https://r2-oj.didapipa.com",url:"/status/web.json?"+Date.now(),method:"get"})}const Ja={class:"judger-status-panel"},Wa={class:"judger-status-panel"};function Xa(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ve(e)}const Ya=ee({__name:"SystemStatus",setup(e){const a=d([]),o=d([]),r=d(!1),l=d(!1);let u;const h=b=>{let s="失效",m="danger";const v=new Date,y=new Date(b.updateTime);return v.getTime()-y.getTime()>3e4?(s="离线",m="default"):b.cpuUsage>90?(s="CPU过高",m="warning"):b.memPercent>90?(s="内存过高",m="warning"):(s="在线",m="success"),t(ge,null,{default:()=>[t("span",null,[b.key,x(" - "),b.name]),t("span",null,[b.updateTime]),t(ga,{theme:m,size:"small"},Xa(s)?s:{default:()=>[s]})]})},z=async()=>{const b=[{key:"didaoj",name:"DidaOj"}],s={};for(let v=0;v<a.value.length;v++){const y=a.value[v];s[y.key]=y}const m=[];for(let v=0;v<b.length;v++){const y=b[v],p={key:y.key},c=await Ba(y.key);c&&(c.name?p.name=c.name:p.name="-",c.update_time?p.updateTime=new Date(c.update_time).toLocaleString():p.updateTime="-",c.cpu_usage?p.cpuUsage=Number(c.cpu_usage):p.cpuUsage=0,c.mem_usage?p.memUsage=c.mem_usage/(1024*1024*1024):p.memUsage=0,c.mem_total?p.memTotal=c.mem_total/(1024*1024*1024):p.memTotal=0,p.memTotal>0?p.memPercent=Math.round(p.memUsage/p.memTotal*1e4)/100:p.memPercent=0,p.avgMessage=c.avg_message,s[y.key]?(p.cpuUsageFrom=s[y.key].cpuUsage,p.memPercentFrom=s[y.key].memPercent,p.memUsageFrom=s[y.key].memUsage,p.memTotalFrom=s[y.key].memTotal):(p.cpuUsageFrom=0,p.memPercentFrom=0,p.memUsageFrom=0,p.memTotalFrom=0),m.push(p))}a.value=m},k=async()=>{const b=await Ha(),s={};for(let v=0;v<o.value.length;v++){const y=o.value[v];s[y.key]=y}const m=[];for(let v=0;v<b.judgers.length;v++){const y=b.judgers[v],p={key:y.key,name:y.name},c=await Rt(y.key);c&&(c.name?p.name=c.name:p.name="-",c.update_time?p.updateTime=new Date(c.update_time).toLocaleString():p.updateTime="-",c.cpu_usage?p.cpuUsage=Number(c.cpu_usage):p.cpuUsage=0,c.mem_usage?p.memUsage=c.mem_usage/(1024*1024*1024):p.memUsage=0,c.mem_total?p.memTotal=c.mem_total/(1024*1024*1024):p.memTotal=0,p.memTotal>0?p.memPercent=Math.round(p.memUsage/p.memTotal*1e4)/100:p.memPercent=0,p.avgMessage=c.avg_message,s[y.key]?(p.cpuUsageFrom=s[y.key].cpuUsage,p.memPercentFrom=s[y.key].memPercent,p.memUsageFrom=s[y.key].memUsage,p.memTotalFrom=s[y.key].memTotal):(p.cpuUsageFrom=0,p.memPercentFrom=0,p.memUsageFrom=0,p.memTotalFrom=0),m.push(p))}o.value=m},g=async()=>{await z(),r.value=!1,await k(),l.value=!1};return ne(async()=>{o.value=[],a.value=[],l.value=!0,r.value=!0,await g(),u=setInterval(()=>{g()},5e3)}),Tt(()=>{clearInterval(u)}),(b,s)=>{const m=_a,v=ge,y=re,p=ye;return $(),Y(Q,null,[t(y,{title:"接口状态",class:"judger-status"},{default:n(()=>[t(p,{loading:r.value},{default:n(()=>[A("div",Ja,[($(!0),Y(Q,null,_e(a.value,c=>($(),G(y,{key:c.key,header:()=>h(c),class:"judge-status-judger"},{footer:n(()=>[A("span",null," 负载信息："+q(c.avgMessage),1)]),default:n(()=>[t(v,{class:"judge-status-judger"},{default:n(()=>[t(m,{title:"CPU使用率",value:c.cpuUsage,animation:{valueFrom:c.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(m,{title:"内存使用率",value:c.memPercent,animation:{valueFrom:c.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(m,{title:"内存使用量",animation:{valueFrom:c.memUsageFrom,duration:2e3},"animation-start":!0,value:c.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(m,{title:"内存总量",value:c.memTotal,animation:{valueFrom:c.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1},8,["loading"])]),_:1}),t(y,{title:"判题机状态",class:"judger-status"},{default:n(()=>[t(p,{loading:l.value},{default:n(()=>[A("div",Wa,[($(!0),Y(Q,null,_e(o.value,c=>($(),G(y,{key:c.key,header:()=>h(c),class:"judge-status-judger"},{footer:n(()=>[A("span",null," 负载信息："+q(c.avgMessage),1)]),default:n(()=>[t(v,{class:"judge-status-judger"},{default:n(()=>[t(m,{title:"CPU使用率",value:c.cpuUsage,animation:{valueFrom:c.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(m,{title:"内存使用率",value:c.memPercent,animation:{valueFrom:c.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(m,{title:"内存使用量",animation:{valueFrom:c.memUsageFrom,duration:2e3},"animation-start":!0,value:c.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(m,{title:"内存总量",value:c.memTotal,animation:{valueFrom:c.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1},8,["loading"])]),_:1})],64)}}}),ae=(e,a)=>{const o=e.__vccOpts||e;for(const[r,l]of a)o[r]=l;return o},ct=ae(Ya,[["__scopeId","data-v-b8c98192"]]),Za={style:{"text-align":"right"}},Qa=ee({__name:"Hitokoto",setup(e){const a=d(!1),o=d(""),r=d(""),l=d(""),u=async()=>{a.value=!0;try{const z=await(await fetch("https://v1.hitokoto.cn")).json();r.value=z.hitokoto,l.value=z.creator,o.value="—— "+z.from}catch(h){r.value="一言获取失败了，但至少您还可以访问本站。",l.value="BoilTask",o.value="DidaOJ",console.error("Error fetching Hitokoto:",h)}finally{a.value=!1}};return ne(()=>{u()}),(h,z)=>{const k=re,g=ye;return $(),G(g,{loading:a.value},{default:n(()=>[t(k,{title:"一言 © Hitokoto"},{actions:n(()=>[x(" @"+q(l.value),1)]),default:n(()=>[A("div",null,[A("span",null,q(r.value),1),A("p",Za,q(o.value),1)])]),_:1})]),_:1},8,["loading"])}}}),en={class:"sh-main"},tn={class:"dida-swiper-div"},an=ee({__name:"HomeView",setup(e){let a=-1;const o=d(null),r=async()=>{o.value=await Oa()};return ne(async()=>{await r(),a=setInterval(()=>{r()},3e4)}),Tt(()=>{clearInterval(a)}),(l,u)=>{const h=mt,z=ba,k=va,g=re,b=be,s=Ge,m=ya,v=ha,y=ve;return $(),G(y,null,{default:n(()=>[t(b,{span:8},{default:n(()=>[A("div",en,[o.value?($(),G(h,{key:0,style:{margin:"20px"},theme:o.value.theme},{default:n(()=>[x(q(o.value.content),1)]),_:1},8,["theme"])):ce("",!0),A("div",tn,[t(k,{class:"dida-swiper"},{default:n(()=>[t(z,null,{default:n(()=>u[0]||(u[0]=[A("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1}),t(z,null,{default:n(()=>u[1]||(u[1]=[A("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1})]),_:1})]),t(g,{title:"正在完善，欢迎提供意见建议",style:{width:"500px",margin:"0 auto"}},{default:n(()=>u[2]||(u[2]=[A("p",null,[A("a",{href:"https://codeoj.cn/",target:"_blank"},"CodeOJ"),x("的迁移计划")],-1),A("p",null,"正在开发中",-1)])),_:1})])]),_:1}),t(b,{span:4},{default:n(()=>[t(Qa,{style:{margin:"10px"}}),t(ct),t(g,{style:{margin:"10px"},bordered:!0},{header:n(()=>u[3]||(u[3]=[A("b",null,"友情链接",-1)])),default:n(()=>[t(v,null,{default:n(()=>[t(m,null,{default:n(()=>[t(s,{href:"https://boiltask.com",target:"_blank"},{default:n(()=>u[4]||(u[4]=[x("BoilTask Blog")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),nn=ae(an,[["__scopeId","data-v-1e5edfb9"]]),on={class:"sh-main"},ln=ee({__name:"View404",setup(e){let a=pe(),o=d(a.fullPath);return(r,l)=>{const u=F;return $(),Y("div",on,[A("p",null,q(de(o)),1),l[2]||(l[2]=A("p",null,"该页面无效或已被迁移，请重新选择访问目标",-1)),t(u,{theme:"primary",onClick:l[0]||(l[0]=()=>r.$router.push("/"))},{default:n(()=>l[1]||(l[1]=[x("返回首页")])),_:1})])}}}),At=ae(ln,[["__scopeId","data-v-d4218944"]]);let dt=null;async function sn(){dt=await un()}function rn(e,a="zh"){if(dt==null)return[!1,e.toString()];const o=dt[e.toString()];if(!o)return[!1,e.toString()];let r=o[a];return r||(a="zh",r=o[a]),r?[!0,r]:[!1,e.toString()]}async function un(){return new Promise((e,a)=>{e({404:{zh:"接口未找到"},1e3:{zh:"系统错误，请重试或等待管理员修复"},1001:{zh:"系统异常，请重试或等待管理员修复"},1002:{zh:"未知错误"},1003:{zh:"操作过于频繁，请稍后重试"},10001:{zh:"权限异常，请重新登陆后再试"},10002:{zh:"参数不符合要求"},10003:{zh:"未找到目标数据"},100001:{zh:"用户名不存在或密码不匹配"},100002:{zh:"邮件发送失败，可能是邮箱无效或达到了每日注册上限，如有问题可联系管理员解决"},100003:{zh:"验证码错误或已过期，请重新获取"},100004:{zh:"注册用户失败，可能存在同名用户"},100005:{zh:"用户名不存在，或您未在本系统绑定邮箱，请联系管理员寻求帮助"},100006:{zh:"验证码错误或已过期，请重新获取"}})})}function ue(){const{appContext:e}=ta();return{globalProperties:e.config.globalProperties}}function Se(){return 1e3}function Et(e,a,o=3e3){e.$message.success({duration:o,content:a})}function se(e,a,o=3e3){e.$message.info({duration:o,content:a})}function le(e,a,o=3e3){e.$message.error({duration:o,content:a})}function N(e,a,o=3e3){const[r,l]=rn(a),u=r?l:`系统错误，错误提示[${l}]`;e.$message.error({duration:o,content:u})}const cn="https://oj-api.didapipa.com/",J=It.create({baseURL:cn,timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});J.interceptors.request.use(e=>{const o=ke().getToken;return o&&(e.headers["X-Token"]=o),e},e=>Promise.reject(e));J.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function dn(e){const a={};return a.id=e.id,a.username=e.username,a.nickname=e.nickname,a.email=e.email,a.slogan=e.slogan,a.organization=e.organization,a.accept=e.accept,a.attempt=e.attempt,e.email&&(a.avatar=`https://www.gravatar.com/avatar/${aa(e.email.toLowerCase().trim())}?d=identicon&s=100`),a}function mn(e,a){return J({url:"/user/login",method:"post",data:{username:e,password:a}})}function pn(){return J({url:"/user/login/refresh",method:"post"})}function fn(e){const a={username:e};return J({url:`/user/info?${new URLSearchParams(a).toString()}`,method:"get"})}function _n(e,a){return J({url:"/user/register/email",method:"post",data:{token:e,email:a}})}function gn(e,a,o,r,l){return J({url:"/user/register",method:"post",data:{username:e,password:a,email:o,key:r,nickname:l}})}function vn(e,a){return J({url:"/user/forget",method:"post",data:{token:e,username:a}})}function bn(e,a,o){return J({url:"/user/password/modify",method:"post",data:{username:e,password:a,key:o}})}const hn={class:"dida-login-footer"},yn=ee({__name:"LoginView",setup(e){const{globalProperties:a}=ue(),o=ke(),r=d(!1),l=d({username:"",password:""}),u=()=>{se(a,"重置成功")},h=({validateResult:z,firstError:k})=>{r.value||(r.value=!0,mn(l.value.username,l.value.password).then(g=>{if(g.code===0){o.loadResponse(g.data),se(a,"登录成功");let b=a.$route.query.redirect_uri;b||(b="/user/"+g.data.username),a.$router.push({path:b})}else N(a,g.code)}).catch(g=>{console.error("Login error",g),le(a,"登录失败")}).finally(()=>{r.value=!1}))};return ne(()=>{if(o.isLogin()){a.$router.push({path:"/user"});return}}),(z,k)=>{const g=xe,b=Ue,s=F,m=De,v=Ge,y=re;return $(),G(y,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:n(()=>[t(m,{ref:"form",data:l.value,colon:!0,onReset:u,onSubmit:h,class:"yj-login-form","label-width":0},{default:n(()=>[t(b,{name:"username"},{default:n(()=>[t(g,{modelValue:l.value.username,"onUpdate:modelValue":k[0]||(k[0]=p=>l.value.username=p),clearable:"",placeholder:"请输入用户名"},{"prefix-icon":n(()=>[t(de(na))]),_:1},8,["modelValue"])]),_:1}),t(b,{name:"password"},{default:n(()=>[t(g,{modelValue:l.value.password,"onUpdate:modelValue":k[1]||(k[1]=p=>l.value.password=p),type:"password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":n(()=>[t(de(oa))]),_:1},8,["modelValue"])]),_:1}),t(b,null,{default:n(()=>[t(s,{theme:"primary",type:"submit",block:"",loading:r.value},{default:n(()=>k[4]||(k[4]=[x("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),A("div",hn,[t(v,{onClick:k[2]||(k[2]=()=>{de(a).$router.push({name:"login-forget"})})},{default:n(()=>k[5]||(k[5]=[x("忘记密码")])),_:1}),t(v,{onClick:k[3]||(k[3]=()=>{de(a).$router.push({name:"register"})})},{default:n(()=>k[6]||(k[6]=[x("注册账户")])),_:1})])]),_:1})}}}),wn=ae(yn,[["__scopeId","data-v-be6a0deb"]]),kn={class:"dida-login-footer"},Sn=ee({__name:"RegisterView",setup(e){const{globalProperties:a}=ue(),o=ke(),r=d(!1),l=d(!1),u=d(!1),h=d("发送验证码");let z=null,k=-1;const g=d(!1),b=d(null),s=d({username:"",password:"",confirmPassword:"",nickname:"",email:"",emailKey:""}),v=d({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:P=>new Promise(f=>{const V=setTimeout(()=>{f(s.value.password===P),clearTimeout(V)})}),message:"两次密码不一致"}],nickname:[{required:!0,message:"请填写昵称"},{min:1,message:"昵称至少1个字符"},{max:30,message:"昵称最多30个字符"}],email:[{required:!0,message:"请填写邮箱"},{pattern:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"邮箱格式不正确"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),y=d(()=>t(F,{onClick:p,disabled:u.value,loading:l.value,style:"width:120px"},{default:()=>[h.value]})),p=async()=>{var w;if(!s.value.email){le(a,"请输入邮箱");return}if(!s.value.email.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)){le(a,"邮箱格式不正确");return}if(u.value||l.value)return;g.value=!0,await Ce();const P=document.getElementById("cf-confirm-div");P&&P.remove();const f=document.createElement("div");f.id="cf-confirm-div",f.setAttribute("data-theme","light"),(w=b.value)==null||w.appendChild(f);const V=window;V.turnstile.ready(function(){V.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(R){g.value=!1,await c(R)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},c=async P=>{if(!u.value){l.value=!0;try{const f=await _n(P,s.value.email);if(f.code!==0){N(a,f.code);return}se(a,"发送验证码成功"),l.value=!1,u.value=!0,z=new Date,h.value="60秒后重发",k=setInterval(()=>{const w=Math.floor((new Date().getTime()-(z==null?void 0:z.getTime()))/1e3);w>60?(h.value="发送验证码",u.value=!1,clearInterval(k)):h.value=`${60-w}秒后重发`},1e3)}catch{le(a,"发送验证码失败")}finally{l.value=!1}}},C=()=>{se(a,"重置成功")},D=({validateResult:P,firstError:f,e:V})=>{if(!r.value){if(V.preventDefault(),P!==!0){le(a,f);return}if(s.value.password!==s.value.confirmPassword){le(a,"两次密码不一致");return}r.value=!0,gn(s.value.username,s.value.password,s.value.email,s.value.emailKey,s.value.nickname).then(w=>{w.code===0?(se(a,"注册成功，可使用账号信息登录"),a.$router.push({name:"login"})):N(a,w.code)}).catch(w=>{console.error("Login error",w),le(a,"登录失败")}).finally(()=>{r.value=!1})}};return ne(()=>{if(o.isLogin()){a.$router.push({path:"/user"});return}}),we(()=>{clearInterval(k)}),(P,f)=>{const V=xe,w=Ue,R=Lt,E=F,U=De,_=Ge,i=re,T=Be;return $(),Y(Q,null,[t(i,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:n(()=>[t(U,{ref:"form",rules:v.value,data:s.value,colon:!0,onReset:C,onSubmit:D,class:"yj-login-form"},{default:n(()=>[t(w,{name:"username",label:"用户名"},{default:n(()=>[t(V,{modelValue:s.value.username,"onUpdate:modelValue":f[0]||(f[0]=j=>s.value.username=j),clearable:"",placeholder:"用于登录与查找"},null,8,["modelValue"])]),_:1}),t(w,{name:"password",label:"密码"},{default:n(()=>[t(V,{modelValue:s.value.password,"onUpdate:modelValue":f[1]||(f[1]=j=>s.value.password=j),type:"password",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(w,{name:"confirmPassword",label:"确认密码"},{default:n(()=>[t(V,{modelValue:s.value.confirmPassword,"onUpdate:modelValue":f[2]||(f[2]=j=>s.value.confirmPassword=j),type:"password",clearable:"",placeholder:"请确认密码"},null,8,["modelValue"])]),_:1}),t(w,{name:"nickname",label:"昵称"},{default:n(()=>[t(V,{modelValue:s.value.nickname,"onUpdate:modelValue":f[3]||(f[3]=j=>s.value.nickname=j),clearable:"",placeholder:"用于优先在网站各处展示"},null,8,["modelValue"])]),_:1}),t(w,{name:"email",label:"邮箱"},{default:n(()=>[t(V,{modelValue:s.value.email,"onUpdate:modelValue":f[4]||(f[4]=j=>s.value.email=j),clearable:"",placeholder:"请填写常用邮箱"},null,8,["modelValue"])]),_:1}),t(w,{name:"emailKey",label:"验证码"},{default:n(()=>[t(R,{append:y.value},{default:n(()=>[t(V,{modelValue:s.value.emailKey,"onUpdate:modelValue":f[5]||(f[5]=j=>s.value.emailKey=j),clearable:"",placeholder:"请输入验证码",style:{width:"140px"}},null,8,["modelValue"])]),_:1},8,["append"])]),_:1}),t(w,null,{default:n(()=>[t(E,{theme:"primary",type:"submit",block:"",loading:r.value},{default:n(()=>f[8]||(f[8]=[x("注册")])),_:1},8,["loading"])]),_:1})]),_:1},8,["rules","data"]),A("div",kn,[t(_,{onClick:f[6]||(f[6]=()=>{de(a).$router.push({name:"login"})})},{default:n(()=>f[9]||(f[9]=[x("返回登陆 ")])),_:1})])]),_:1}),t(T,{visible:g.value,"onUpdate:visible":f[7]||(f[7]=j=>g.value=j),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:n(()=>[A("div",{ref_key:"dialogContainer",ref:b,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),Cn=ae(Sn,[["__scopeId","data-v-d25e7538"]]),Pn={style:{margin:"12px"}},In=ee({__name:"UserView",setup(e){let a=pe();const{globalProperties:o}=ue(),r=Re();let l="";const u=d(!1),h=d(null),z=d([]),k=async g=>{u.value=!0;try{let b=await fn(g);if(b.code!==0){u.value=!1,N(o,b.code),await B.push({name:"home"});return}h.value=dn(b.data.user),z.value=b.data.problems_ac,r.setTitle(h.value.nickname+" - "+r.getTitle)}catch{le(o,"获取用户信息失败"),await B.push({name:"home"})}finally{u.value=!1}};return la(async(g,b,s)=>{if(Array.isArray(g.params.username)?l=g.params.username[0]:l=g.params.username,!l){await B.push({name:"home"});return}await k(l),s()}),ne(async()=>{if(Array.isArray(a.params.username)?l=a.params.username[0]:l=a.params.username,!l){await B.push({name:"home"});return}await k(l)}),(g,b)=>{const s=F,m=ge,v=re,y=be,p=wa,c=Ke,C=qe,D=ve,P=ye;return $(),G(P,{loading:u.value},{default:n(()=>[t(D,{class:"dida-main-content"},{default:n(()=>[t(y,{span:8},{default:n(()=>[t(v,{style:{margin:"10px"},title:"AC题目"},{default:n(()=>[t(m,{style:{"flex-wrap":"wrap"}},{default:n(()=>[($(!0),Y(Q,null,_e(z.value,f=>($(),G(s,{key:f,size:"small",onClick:()=>de(B).push({name:"problem-detail",params:{problemId:f}})},{default:n(()=>[x(q(f),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1}),t(y,{span:4},{default:n(()=>[A("div",Pn,[t(C,{layout:"vertical",bordered:!0},{default:n(()=>[t(c,{label:"头像"},{default:n(()=>{var f;return[t(p,{shape:"round",size:"100px",image:(f=h.value)==null?void 0:f.avatar,"hide-on-load-failed":!1},null,8,["image"])]}),_:1}),t(c,{label:"昵称"},{default:n(()=>{var f;return[x(q((f=h.value)==null?void 0:f.nickname),1)]}),_:1}),t(c,{label:"Slogan"},{default:n(()=>{var f;return[x(q((f=h.value)==null?void 0:f.slogan),1)]}),_:1}),t(c,{label:"邮箱"},{default:n(()=>{var f;return[x(q((f=h.value)==null?void 0:f.email),1)]}),_:1}),t(c,{label:"组织"},{default:n(()=>{var f;return[x(q((f=h.value)==null?void 0:f.organization),1)]}),_:1}),t(c,{label:"通过数量"},{default:n(()=>{var f;return[x(q((f=h.value)==null?void 0:f.accept),1)]}),_:1}),t(c,{label:"提交数量"},{default:n(()=>{var f;return[x(q((f=h.value)==null?void 0:f.attempt),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Tn=ae(In,[["__scopeId","data-v-cef20b99"]]),ft=[{name:"home",path:"/",title:"首页",showSidebar:!1,disableGenerateTab:!0,component:nn},{name:"problem",path:"/problem",title:"题目",icon:"calculation",showSidebar:!0,redirect:"problem-list"},{name:"judge",path:"/judge",title:"评测",icon:"code",showSidebar:!0,redirect:"judge-list"},{name:"contest",path:"/contest",title:"比赛",icon:"application",showSidebar:!0,redirect:"contest-list"},{name:"contest-detail-tab",title:"比赛",path:"/contest",showSidebar:!0,disableGenerateTab:!0,redirect:"contest-list"},{name:"discuss",title:"讨论",path:"/discuss",icon:"sonic",showSidebar:!0,redirect:"discuss-list"},{name:"rank",path:"/rank",title:"排名",icon:"chart-column",showSidebar:!0,redirect:"rank-ac-all"},{name:"tool",path:"/tool",title:"工具",icon:"tools",showSidebar:!0,redirect:"tool-paste"},{name:"system",path:"/system",title:"系统",icon:"dashboard",showSidebar:!0,redirect:"system-status"},{name:"manage",path:"/manage",title:"管理",icon:"command",showSidebar:!0,redirect:"manage-judge",auths:[Ee.Manage]},{name:"login",path:"/login",title:"登陆",showSidebar:!1,disableGenerateTab:!0,component:wn},{name:"register",path:"/register",title:"注册",showSidebar:!1,disableGenerateTab:!0,component:Cn},{name:"user",path:"/user/:username+",title:"用户",showSidebar:!1,needLogin:!0,disableGenerateTab:!0,component:Tn},{name:"404",path:"/404",title:"404",showSidebar:!1,disableGenerateTab:!0,component:At}],xn=e=>ft.find(a=>a.name==e),jn=e=>{const a=[];return ft.forEach(o=>{!o.disableGenerateTab&&e.hasAllAuths(o.auths)&&a.push(o)}),a},Ln=e=>{ft.forEach(a=>{const o={name:a.name,path:a.path,meta:{title:a.title,tab:a.name,showSidebar:a.showSidebar,needLogin:a.needLogin,redirect:a.redirect,tabAuths:a.auths},component:a.component};e.push(o)})};function qt(e){return e.children!==void 0}function zn(e){return e.children!==void 0}var Kt=(e=>(e[e.Unknown=-1]="Unknown",e[e.C=0]="C",e[e.Cpp=1]="Cpp",e[e.Java=2]="Java",e[e.Python=3]="Python",e[e.Pascal=4]="Pascal",e[e.Golang=5]="Golang",e[e.Max=6]="Max",e))(Kt||{});function Mt(){const e=[-1,5,6];return Object.values(Kt).filter(a=>typeof a=="number"&&!e.includes(a)).map(a=>({value:a,label:Ft(a)}))}function Vn(e){return e>-1&&e<6}function Ft(e){switch(e){case 0:return"C";case 1:return"C++";case 2:return"Java";case 3:return"Python";case 4:return"Pascal";case 5:return"Golang";default:return"Unknown"}}function _t(e){switch(e){case 0:return"c";case 1:return"cpp";case 2:return"java";case 3:return"python";case 4:return"pascal";case 5:return"golang";default:return"text"}}var he=(e=>(e[e.Init=0]="Init",e[e.Rejudge=1]="Rejudge",e[e.Submitting=2]="Submitting",e[e.Queuing=3]="Queuing",e[e.Compiling=4]="Compiling",e[e.Running=5]="Running",e[e.Accept=6]="Accept",e[e.PE=7]="PE",e[e.WA=8]="WA",e[e.TLE=9]="TLE",e[e.MLE=10]="MLE",e[e.OLE=11]="OLE",e[e.RE=12]="RE",e[e.CE=13]="CE",e[e.CLE=14]="CLE",e[e.JudgeFail=15]="JudgeFail",e[e.SubmitFail=16]="SubmitFail",e[e.Unknown=17]="Unknown",e))(he||{});const $n=e=>{switch(e){case 0:return"普通评测";case 1:return"特殊评测";default:return"未知"}},tt=e=>{switch(e){case 0:return"等待处理";case 1:return"重新评测";case 2:return"提交中";case 3:return"队列中";case 4:return"编译中";case 5:return"运行中";case 6:return"通过";case 7:return"格式错误";case 8:return"答案错误";case 9:return"超时";case 10:return"内存超限";case 11:return"输出超限";case 12:return"运行错误";case 13:return"编译错误";case 14:return"编译超限";case 15:return"评测失败";case 16:return"提交失败";case 17:return"未知";default:return e}},Gt=e=>{switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return"default";case 6:return"success";case 7:return"warning";default:return"danger"}};function Dn(){const e=[17];return Object.values(he).filter(a=>typeof a=="number"&&!e.includes(a)).map(a=>({value:a,label:tt(a)}))}function Me(e){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return!0;default:return!1}}function Nt(e){var o;const a={};if(a.id=e.id,a.problemId=e.problem_id,a.contestProblemIndex=e.contest_problem_index,a.status=e.status,Me(e.status)?a.score="-":a.score=e.score.toString(),e.time?a.time=Math.ceil(e.time/1e6)+"ms":a.time="-",e.memory?a.memory=(e.memory/1024/1024).toFixed(2)+"MB":a.memory="-",a.language=Ft(e.language),a.codeLength=e.code_length,e.approve_time?a.approveTime=new Date(e.approve_time).toLocaleString():a.approveTime="-",a.author=e.author,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.code=e.code,a.compileMessage=e.compile_message,a.taskCurrent=e.task_current,a.taskTotal=e.task_total,a.task=[],e.task)for(let r=0;r<((o=e.task)==null?void 0:o.length);r++){const l=e.task[r],u={};u.taskId=l.task_id,u.status=l.status,l.time?u.time=Math.ceil(l.time/1e6)+"ms":u.time="-",l.memory?u.memory=(l.memory/1024/1024).toFixed(2)+"MB":u.memory="-",u.score=l.score,u.content=l.content,u.waHint=l.wa_hint,!u.content&&!u.waHint&&(u.content="无提示信息"),a.task.push(u)}return e.judger&&(a.judger=e.judger),e.judge_time&&(a.judgeTime=new Date(e.judge_time).toLocaleString()),a}function Un(e,a,o,r,l){return J({url:"/judge/approve",method:"post",data:{problem_id:e,contest_id:a,problem_index:o,language:r,code:l}})}function Rn(e){return J({url:"/judge?id="+e,method:"get"})}function An(e){return J({url:"/judge/code?id="+e,method:"get"})}function En(e,a,o,r,l,u,h){const z=new URLSearchParams({contest_id:String(e),problem_id:a,username:o,language:String(r),status:String(l),page:String(u),page_size:String(h)});return J({url:`/judge/list?${z.toString()}`,method:"get"})}function qn(){return J({url:"/judge/rejudge/recently",method:"post"})}function Kn(e){return J({url:"/judge/rejudge/problem",method:"post",data:{id:e}})}function Mn(){return J({url:"/judge/rejudge/all",method:"post",timeout:0})}function Fn(e){return J({url:"/judge/rejudge",method:"post",data:{id:Number(e)}})}var He=(e=>(e[e.None=0]="None",e[e.Attempt=1]="Attempt",e[e.Accept=2]="Accept",e))(He||{});function We(e,a){const o={};if(o.id=e.id,o.author=e.author,o.title=e.title,o.tags=[],e.tags)for(const r of e.tags){const l=a[r];l&&o.tags.push(l)}if(o.accept=e.accept,o.attempt=e.attempt,e.description!=null&&(o.description=e.description),e.time_limit!=null&&e.time_limit>=0?o.timeLimit=e.time_limit.toString()+" ms":o.timeLimit="未知",e.memory_limit!=null&&e.memory_limit>=0?o.memoryLimit=(e.memory_limit/1024).toFixed(2)+" MB":o.memoryLimit="未知",e.judge_type!=null&&(o.judgeType=$n(e.judge_type)),e.insert_time!=null&&(o.insertTime=new Date(e.insert_time).toLocaleString()),e.update_time!=null&&(o.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(o.creatorNickname=e.creator_nickname),e.source!=null){const r=/\[([^\]]+)\]\(([^)]+)\)/,l=e.source.match(r);l?(o.source=l[1],o.sourceUrl=l[2]):(o.source=e.source,o.sourceUrl="")}return e.judge_md5!=null&&(o.judgeMd5=e.judge_md5),e.origin_oj!=null&&(o.originOj=e.origin_oj),e.origin_id!=null&&(o.originId=e.origin_id),e.origin_url!=null&&(o.originUrl=e.origin_url),o}function Ot(e,a,o){const r={};return e?r.id=e:(r.contest_id=a,r.problem_index=o),J({url:`/problem?${new URLSearchParams(r).toString()}`,method:"get"})}function Ht(e){return J({url:"/problem/tag/list?max_count="+e,method:"get"})}function Gn(e){return J({url:"/problem/judge?id="+e,method:"get"})}function Nn(e,a,o,r,l){const u={};return e&&(u.oj=e),a&&(u.title=a),o&&(u.tag=o),r&&(u.page=r),l&&(u.page_size=l),J({url:`/problem/list?${new URLSearchParams(u).toString()}`,method:"get"})}function On(e){const a={};return e&&(a.problem_id=e),J({url:`/problem/recommend?${new URLSearchParams(a).toString()}`,method:"get"})}function Bt(e,a){return J({url:"/problem/crawl",method:"post",data:{oj:e,id:a}})}function Hn(e,a,o,r,l,u,h){return J({url:"/problem/edit",method:"post",data:{id:e,title:a,time_limit:o,memory_limit:r,source:l,tags:u,description:h}})}function Bn(e,a){return J({url:"/problem/judge/data/download?id="+e+"&key="+a,method:"get"})}function Jn(e,a){const o=new FormData;return o.append("id",e),o.append("zip",a),J({url:"/problem/judge/data",method:"post",data:o,headers:{"Content-Type":"multipart/form-data"},timeout:1e3*60*5})}const Wn={style:{margin:"10px"}};function Xn(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ve(e)}const Yn=ee({__name:"ProblemList",setup(e){const a=pe(),o=$e(),{globalProperties:r}=ue();let l=null;const u=d(!1),h={};let z={};const k=d(!1),g=d([{title:"ID",colKey:"id",cell:(_,i)=>{let T=f(i.row.id);return t(F,{variant:"dashed",theme:T,onClick:()=>P(i.row.id)},{default:()=>[i.row.id]})}},{title:"标题",colKey:"title",cell:(_,i)=>t(F,{variant:"text",onClick:()=>P(i.row.id)},{default:()=>[i.row.title]})},{title:"标签",colKey:"tags",cell:(_,i)=>{const T=i.row.tags;if(!T||T.length===0)return"";let j=[];for(let I=0;I<T.length;I++){const S=T[I];j.push(t(F,{key:I,theme:"default",variant:"outline",size:"small",onClick:()=>R(S)},{default:()=>[S.name]}))}return t(ge,null,Xn(j)?j:{default:()=>[j]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),b=d(!1);let s=1,m=50;const v=d({current:s,pageSize:m,defaultCurrent:s,defaultPageSize:m,total:0,pageSizeOptions:[50,100]}),y=d(),p=d(),c=[{label:"DidaOJ",value:"didaoj"},{label:"HDU",value:"hdu"},{label:"POJ",value:"poj"},{label:"NYOJ",value:"nyoj"}],C=d({oj:"",title:"",tag:""}),D=d({oj:"",problem:""}),P=_=>{_&&o.push({path:"/problem/"+_})},f=_=>{if(!_||!z)return"default";const i=z[_];if(!i)return"default";switch(i){case He.Accept:return"success";case He.Attempt:return"warning";default:return"default"}},V=async()=>{await o.push({query:{...a.query,oj:C.value.oj,title:C.value.title,tag:C.value.tag,page:1,page_size:v.value.defaultPageSize}})},w=async()=>{try{k.value=!0;const _=await Bt(D.value.oj,D.value.problem);_.code===0?(se(r,"搜索成功"),await o.push({name:"problem-detail",params:{problemId:_.data}})):N(r,_.code)}catch(_){console.error(_),N(r,Se())}finally{k.value=!1}},R=_=>{_&&o.push({query:{...a.query,title:"",tag:_.name,page:1,page_size:v.value.defaultPageSize}})},E=async(_,i)=>{b.value=!0;try{const{current:T,pageSize:j}=_,I=await Nn(C.value.oj,C.value.title,C.value.tag,T,j);if(y.value=[],I.code===0){const S=I.data.list;if(!S||S.length<=0){v.value={...v.value,total:0},z={},se(r,"未找到记录");return}S.forEach(L=>{var M;const H=We(L,h);(M=y.value)==null||M.push(H)}),v.value={...v.value,total:I.data.total_count},z=I.data.problem_attempt_status}else i&&N(r,I.code)}catch(T){console.error(T),N(r,Se())}finally{b.value=!1}},U=async _=>{await o.push({query:{...a.query,page:_.current,page_size:_.pageSize}})};return ne(async()=>{b.value=!0,p.value=[],Ht(-1).then(_=>{if(_.code===0){p.value=_.data.list,u.value=_.data.total_count>_.data.list.length;for(let i=0;i<_.data.list.length;i++){const T=_.data.list[i];h[T.id]=T}l=Te(()=>a.query,i=>{C.value.oj=i.oj||"",C.value.title=i.title||"",C.value.tag=i.tag||"";const T=parseInt(i.page)||v.value.defaultCurrent,j=parseInt(i.page_size)||v.value.defaultPageSize;s=T,m=j,v.value={...v.value,current:s,pageSize:m},E({current:s,pageSize:m},!0)},{immediate:!0})}else u.value=!0}).catch(_=>{console.error(_),u.value=!0})}),we(()=>{l&&l()}),(_,i)=>{const T=Pe,j=re,I=be,S=pt,L=Ue,H=xe,M=F,K=De,Z=ve;return $(),G(Z,null,{default:n(()=>[t(I,{span:9},{default:n(()=>[t(j,{style:{margin:"10px"}},{default:n(()=>[t(T,{data:y.value,columns:g.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:v.value,"table-layout":"auto",loading:b.value,onPageChange:U},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(I,{span:3},{default:n(()=>[A("div",Wn,[t(j,{class:"sh-card"},{default:n(()=>[t(K,{model:C.value,onSubmit:V},{default:n(()=>[t(L,{label:"OJ"},{default:n(()=>[t(S,{modelValue:C.value.oj,"onUpdate:modelValue":i[0]||(i[0]=oe=>C.value.oj=oe),options:c,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(L,{label:"标题"},{default:n(()=>[t(H,{modelValue:C.value.title,"onUpdate:modelValue":i[1]||(i[1]=oe=>C.value.title=oe),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(L,{label:"标签"},{default:n(()=>[t(H,{modelValue:C.value.tag,"onUpdate:modelValue":i[2]||(i[2]=oe=>C.value.tag=oe),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(L,null,{default:n(()=>[t(M,{theme:"primary",type:"submit"},{default:n(()=>i[6]||(i[6]=[x("搜索")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(j,{class:"sh-card"},{default:n(()=>[t(K,{model:D.value,onSubmit:w},{default:n(()=>[t(L,{label:"OJ"},{default:n(()=>[t(S,{modelValue:D.value.oj,"onUpdate:modelValue":i[3]||(i[3]=oe=>D.value.oj=oe),options:c,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(L,{label:"题目"},{default:n(()=>[t(H,{modelValue:D.value.problem,"onUpdate:modelValue":i[4]||(i[4]=oe=>D.value.problem=oe),placeholder:"请输入原始题号"},null,8,["modelValue"])]),_:1}),t(L,null,{default:n(()=>[t(M,{theme:"primary",type:"submit",loading:k.value},{default:n(()=>i[7]||(i[7]=[x("前往")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),t(j,{class:"sh-card sh-background-black"},{default:n(()=>[($(!0),Y(Q,null,_e(p.value,oe=>($(),G(M,{class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:()=>R(oe)},{default:n(()=>[x(q(oe.name),1)]),_:2},1032,["onClick"]))),256)),u.value?($(),G(M,{key:0,class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:i[5]||(i[5]=()=>_.$router.push("/problem/tags"))},{default:n(()=>i[8]||(i[8]=[x(" ... ")])),_:1})):ce("",!0)]),_:1})])]),_:1})]),_:1})}}}),Zn=ae(Yn,[["__scopeId","data-v-0d94e7ac"]]);function Fe(e){e.querySelectorAll("pre > code:not([data-copy-attached])").forEach(o=>{o.setAttribute("data-copy-attached","true");const r=o.parentElement,l=document.createElement("div");l.className="copy-wrapper";const u=document.createElement("button");u.className="copy-btn",u.innerText="复制",u.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(o.innerText),u.innerText="已复制",setTimeout(()=>u.innerText="复制",1500)}catch{u.innerText="失败"}}),r.replaceWith(l),l.appendChild(u),l.appendChild(r)})}function ze(e){let a="";for(;e>0;)e--,a=String.fromCharCode(65+e%26)+a,e=Math.floor(e/26);return a}async function Jt(e){const a={};if(a.id=e.id,a.ownerId=e.owner_id,a.ownerUsername=e.owner_username,a.ownerNickname=e.owner_nickname,a.title=e.title,a.startTime=new Date(e.start_time).toLocaleString(),a.endTime=new Date(e.end_time).toLocaleString(),e.descriptions){a.descriptions=[];const o={math:{inlineDigit:!0,engine:"KaTeX"}};for(let r=0;r<e.descriptions.length;r++){const l=e.descriptions[r],u={};u.title=l.title,u.content=await me.md2html(l.content,o),u.sort=l.sort,a.descriptions.push(u)}}if(a.notification=e.notification,e.problems){a.problems=[],e.problems.sort((o,r)=>o.index-r.index);for(let o=0;o<e.problems.length;o++){const r=e.problems[o];r.accept||(r.accept=0),r.attempt||(r.attempt=0),r.id=ze(r.index),a.problems.push(r)}}return a}function Qn(e){return J({url:"/contest?id="+e,method:"get"})}function eo(e,a){return J({url:"/contest/list?page="+e+"&page_size="+a,method:"get"})}function to(e){return J({url:"/contest/rank?id="+e,method:"get"})}function ao(e){return J({url:"/contest/create",method:"post",data:e})}const no=["innerHTML"],oo={style:{margin:"12px"}},lo={key:1},so={class:"dida-operation-container"},ro={class:"dida-operation-container"},uo={class:"dida-code-submit-div"},io=ee({__name:"ProblemDetail",setup(e){let a=pe();const{globalProperties:o}=ue(),r=Re(),l=ke();let u=d(""),h="",z=0,k=0;const g=d(null),b=d(!1),s=d(null);let m=null;const v=d(null),y=d(!1),p={},c=d(""),C=d([]);C.value=Mt();const D=Ae(()=>l.hasAuth(Ee.ManageProblem)),P=T=>{T&&B.push({name:"problem-list",query:{...a.query,title:"",tag:T.name}})},f=()=>{B.push({name:"manage-problem",params:{problemId:h}})},V=()=>{h?B.push({name:"judge-list",query:{problem_id:h}}):B.push({name:"contest-judge",params:{contestId:z},query:{problem_id:ze(k)}})},w=()=>{h?B.push({name:"discuss-list-problem",query:{problem_id:h}}):B.push({name:"contest-discuss",params:{contestId:z},query:{problem_id:ze(k)}})},R=()=>{B.push({name:"problem-recommend",params:{problemId:h}})},E=async()=>{var I,S;const T=(I=s.value)==null?void 0:I.originOj,j=(S=s.value)==null?void 0:S.originId;if(!(!T||!j))try{y.value=!0;const L=await Bt(T,j);L.code===0?(await i(),se(o,"更新成功")):N(o,L.code)}catch{N(o,"更新失败，请稍后再试")}finally{y.value=!1}},U=async()=>{if(!h){le(o,"问题ID无效");return}const T=parseInt(c.value);if(!Vn(T)){le(o,"请选择所编写的语言");return}const j=m==null?void 0:m.getValue();if(!j){le(o,"请输入所需提交的代码");return}const I=await Un(h,z,k,T,j);if(I.code!==0){N(o,I.code);return}se(o,"提交成功，正在跳转到详情页面");const S=I.data.id;await B.push({path:"/judge/"+S})},_=T=>{if(!m)return;const j=m.getModel();j&&vt.setModelLanguage(j,_t(T))},i=async()=>{let T=await Ot(h,z,k);if(T.code!==0){b.value=!1,N(o,T.code),await B.push({name:"problem"});return}T.data.tags&&T.data.tags.forEach(S=>{p[S.id]=S}),s.value=We(T.data.problem,p),r.setTitle(s.value.title+" - "+r.getTitle);let j=s.value.description;const I={math:{inlineDigit:!0,engine:"KaTeX"}};u.value=await me.md2html(j,I),await Ce(()=>{g.value&&(me.mathRender(g.value),me.highlightRender({lineNumber:!0,enable:!0},g.value),Fe(g.value),!m&&v.value&&(m=vt.create(v.value,{value:"",language:"cpp",minimap:{enabled:!0},colorDecorators:!0,readOnly:!1,theme:"vs-dark"}))),b.value=!1})};return ne(async()=>{if(Array.isArray(a.params.problemId)?h=a.params.problemId[0]:h=a.params.problemId,!h){if(Array.isArray(a.params.contestId)?z=Number(a.params.contestId[0]):z=Number(a.params.contestId),!z){le(o,"题目不存在"),await B.push({name:"problem"});return}if(Array.isArray(a.params.problemIndex)?k=parseInt(a.params.problemIndex[0]):k=parseInt(a.params.problemIndex),!k){le(o,"题目不存在"),await B.push({name:"problem"});return}}b.value=!0,await i()}),(T,j)=>{const I=re,S=be,L=Ke,H=Ge,M=F,K=ge,Z=qe,oe=zt,W=pt,fe=ve,Ie=ye;return $(),G(Ie,{loading:b.value},{default:n(()=>[t(fe,{class:"dida-main-content"},{default:n(()=>[t(S,{span:8},{default:n(()=>[t(I,{style:{margin:"10px"}},{default:n(()=>[A("div",{innerHTML:de(u),ref_key:"markdownRef",ref:g},null,8,no)]),_:1})]),_:1}),t(S,{span:4},{default:n(()=>[A("div",oo,[t(Z,{layout:"vertical",bordered:!0},{default:n(()=>{var te;return[t(L,{label:"标题"},{default:n(()=>{var O;return[x(q((O=s.value)==null?void 0:O.title),1)]}),_:1}),t(L,{label:"时间限制"},{default:n(()=>{var O;return[x(q((O=s.value)==null?void 0:O.timeLimit),1)]}),_:1}),t(L,{label:"内存限制"},{default:n(()=>{var O;return[x(q((O=s.value)==null?void 0:O.memoryLimit),1)]}),_:1}),t(L,{label:"判题方式"},{default:n(()=>{var O;return[x(q((O=s.value)==null?void 0:O.judgeType),1)]}),_:1}),t(L,{label:"正确提交"},{default:n(()=>{var O;return[x(q((O=s.value)==null?void 0:O.accept),1)]}),_:1}),t(L,{label:"提交总数"},{default:n(()=>{var O;return[x(q((O=s.value)==null?void 0:O.attempt),1)]}),_:1}),t(L,{label:"创建时间"},{default:n(()=>{var O;return[x(q((O=s.value)==null?void 0:O.insertTime),1)]}),_:1}),t(L,{label:"更新时间"},{default:n(()=>{var O;return[x(q((O=s.value)==null?void 0:O.updateTime),1)]}),_:1}),t(L,{label:"上传用户"},{default:n(()=>{var O;return[x(q((O=s.value)==null?void 0:O.creatorNickname),1)]}),_:1}),t(L,{label:"题目来源"},{default:n(()=>{var O,ie,X;return[(O=s.value)!=null&&O.sourceUrl?($(),G(H,{key:0,href:(ie=s.value)==null?void 0:ie.sourceUrl,target:"_blank"},{default:n(()=>{var je;return[x(q((je=s.value)==null?void 0:je.source),1)]}),_:1},8,["href"])):($(),Y("span",lo,q((X=s.value)==null?void 0:X.source),1))]}),_:1}),(te=s.value)!=null&&te.originUrl?($(),G(L,{key:0,label:"原题链接"},{default:n(()=>{var O;return[t(H,{href:(O=s.value)==null?void 0:O.originUrl,target:"_blank"},{default:n(()=>{var ie,X;return[x(q((ie=s.value)==null?void 0:ie.originOj)+" - "+q((X=s.value)==null?void 0:X.originId),1)]}),_:1},8,["href"])]}),_:1})):ce("",!0),de(h)?($(),G(L,{key:1,label:"标签"},{default:n(()=>[t(K,null,{default:n(()=>{var O;return[($(!0),Y(Q,null,_e((O=s.value)==null?void 0:O.tags,ie=>($(),G(M,{key:ie.id,variant:"dashed",onClick:()=>P(ie)},{default:n(()=>[x(q(ie.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})):ce("",!0)]}),_:1}),A("div",so,[t(K,null,{default:n(()=>[t(M,{onClick:V},{default:n(()=>j[1]||(j[1]=[x("提交记录")])),_:1}),t(M,{onClick:w},{default:n(()=>j[2]||(j[2]=[x("题目讨论")])),_:1}),de(h)?($(),G(M,{key:0,onClick:R},{default:n(()=>j[3]||(j[3]=[x("题目推荐")])),_:1})):ce("",!0)]),_:1})]),A("div",ro,[t(K,null,{default:n(()=>{var te;return[D.value?($(),G(M,{key:0,onClick:f},{default:n(()=>j[4]||(j[4]=[x("编辑")])),_:1})):ce("",!0),(te=s.value)!=null&&te.originId?($(),G(M,{key:1,onClick:E,loading:y.value},{default:n(()=>j[5]||(j[5]=[x("更新描述 ")])),_:1},8,["loading"])):ce("",!0)]}),_:1})]),A("div",uo,[t(K,null,{default:n(()=>[t(W,{modelValue:c.value,"onUpdate:modelValue":j[0]||(j[0]=te=>c.value=te),label:"语言：",placeholder:"请选择提交语言","auto-width":"",clearable:"",onChange:_},{default:n(()=>[($(!0),Y(Q,null,_e(C.value,te=>($(),G(oe,{key:te.value,value:te.value,label:te.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),t(M,{onClick:U},{default:n(()=>j[6]||(j[6]=[x("提交")])),_:1})]),_:1}),A("div",{ref_key:"codeEditRef",ref:v,class:"dida-code-editor"},null,512)])])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),bt=ae(io,[["__scopeId","data-v-c28514ba"]]),co={style:{margin:"10px"}};function mo(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ve(e)}const po=ee({__name:"ProblemRecommend",setup(e){const a=pe(),o=$e(),{globalProperties:r}=ue();let l=null,u="",h={},z={};const k=d([{title:"ID",colKey:"id",cell:(p,c)=>{let C=m(c.row.id);return t(F,{variant:"dashed",theme:C,onClick:()=>s(c.row.id)},{default:()=>[c.row.id]})}},{title:"标题",colKey:"title",cell:(p,c)=>t(F,{variant:"text",onClick:()=>s(c.row.id)},{default:()=>[c.row.title]})},{title:"标签",colKey:"tags",cell:(p,c)=>{const C=c.row.tags;if(!C||C.length===0)return"";let D=[];for(let P=0;P<C.length;P++){const f=C[P];D.push(t(F,{key:P,theme:"default",variant:"outline",size:"small",onClick:()=>v(f)},{default:()=>[f.name]}))}return t(ge,null,mo(D)?D:{default:()=>[D]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),g=d(!1),b=d(),s=p=>{p&&o.push({path:"/problem/"+p})},m=p=>{if(!p||!z)return"default";const c=z[p];if(!c)return"default";switch(c){case He.Accept:return"success";case He.Attempt:return"warning";default:return"default"}},v=p=>{p&&o.push({name:"problem-list",query:{tag:p.name}})},y=async p=>{g.value=!0;try{const c=await On(u);if(b.value=[],c.code===0){const C=c.data.list;if(!C||C.length<=0){se(r,"未找到记录");return}h={},c.data.tags&&c.data.tags.forEach(D=>{h[D.id]=D}),C.forEach(D=>{var f;const P=We(D,h);(f=b.value)==null||f.push(P)})}else p&&N(r,c.code)}catch(c){console.error(c),N(r,Se())}finally{g.value=!1}};return ne(async()=>{g.value=!0,l=Te(()=>a.query,p=>{Array.isArray(a.params.problemId)?u=a.params.problemId[0]:u=a.params.problemId,y(!0)},{immediate:!0})}),we(()=>{l&&l()}),(p,c)=>{const C=Pe,D=re,P=be,f=ve;return $(),G(f,null,{default:n(()=>[t(P,{span:9},{default:n(()=>[t(D,{style:{margin:"10px"}},{default:n(()=>[t(C,{data:b.value,columns:k.value,"row-key":"id","vertical-align":"top",hover:!0,"table-layout":"auto",loading:g.value},null,8,["data","columns","loading"])]),_:1})]),_:1}),t(P,{span:3},{default:n(()=>[A("div",co,[t(D,{class:"sh-card",header:"题目推荐","header-bordered":!0},{default:n(()=>c[0]||(c[0]=[x(" 根据本站其他用户的提交记录推荐类似题目"),A("br",null,null,-1),x("依据推荐算法来计算，与本用户相似度最高的用户做的题，大概率被自己感兴趣。 ")])),_:1})])]),_:1})]),_:1})}}}),fo=ae(po,[["__scopeId","data-v-3b5a8a61"]]),_o=["innerHTML"];function ht(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ve(e)}const go=ee({__name:"JudgeJobList",setup(e){const a=pe(),o=$e(),{globalProperties:r}=ue();let l=!1,u=null,h;const z=d(!1),k=d(null),g=d(null),b=d(!1);let s=-1;const m=d({problemId:"",username:"",language:void 0,status:void 0}),v=d([{title:"ID",colKey:"id",cell:(I,S)=>t(F,{variant:"text",onClick:()=>E(S.row.id)},{default:()=>[S.row.id]})},{title:"问题",colKey:"problemId",cell:(I,S)=>{if(s){let L;return t(F,{variant:"text",onClick:()=>R(s,S.row.contestProblemIndex)},ht(L=ze(S.row.contestProblemIndex))?L:{default:()=>[L]})}return t(F,{variant:"text",onClick:()=>w(S.row.problemId)},{default:()=>[S.row.problemId]})}},{title:"状态",colKey:"status",align:"center",cell:(I,S)=>{const L=S.row.status,H=tt(L),M=Gt(L);let K=[];return Me(L)&&K.push(t(ye,{text:S.row.state,size:"small",class:"dida-status-loading"},null)),K.push(t("span",null,[H])),t(F,{theme:M,variant:"outline",onClick:()=>E(S.row.id)},ht(K)?K:{default:()=>[K]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"code",cell:(I,S)=>t(F,{theme:"default",onClick:()=>V(S.row)},{default:()=>[S.row.language+" / "+S.row.codeLength]})},{title:"作者",colKey:"author",width:200,cell:(I,S)=>t(F,{variant:"text",onClick:()=>U(S.row.authorUsername)},{default:()=>[S.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),y=d(!1);let p=1,c=50;const C=d({current:p,pageSize:c,defaultCurrent:p,defaultPageSize:c,total:0,pageSizeOptions:[50,100]}),D=d(),P=d([]);P.value=Mt();const f=d([]);f.value=Dn();const V=async I=>{b.value=!0,z.value=!0;try{k.value=I;const S=await An(Number(k.value.id));if(S.code===0){const L=S.data,M=`\`\`\`${_t(L.language)}
${L.code}
\`\`\``,K={};k.value.code=await me.md2html(M,K),await Ce(()=>{g.value&&(me.highlightRender({lineNumber:!0,enable:!0},g.value),Fe(g.value))})}else N(r,S.code)}finally{b.value=!1}},w=I=>{I&&o.push({path:"/problem/"+I})},R=(I,S)=>{o.push({name:"contest-problem-detail",params:{contestId:I,problemIndex:S}})},E=I=>{I&&(s>0?o.push({name:"contest-judge-detail",params:{contestId:s,judgeId:I}}):o.push({name:"judge-detail",params:{judgeId:I}}))},U=I=>{I&&o.push({path:"/user/"+I})},_=async()=>{await o.push({query:{...a.query,page:1,page_size:c,problem_id:m.value.problemId,username:m.value.username,language:m.value.language,status:m.value.status}})},i=async()=>{m.value.problemId="",m.value.username="",m.value.language=void 0,m.value.status=void 0,await o.push({query:{...a.query,page:1,page_size:c,problem_id:"",username:"",language:void 0,status:void 0}})},T=async(I,S)=>{S&&(y.value=!0);let L=!1;try{const{current:H,pageSize:M}=I,K=await En(s,m.value.problemId,m.value.username,m.value.language,m.value.status,H,M);D.value=[],K.code===0?K.data.list&&K.data.list.length>0?(K.data.list.forEach(oe=>{var fe;const W=Nt(oe);(fe=D.value)==null||fe.push(W),Me(oe.status)&&(L=!0)}),C.value={...C.value,total:K.data.total_count}):(se(r,"未找到记录"),C.value={...C.value,total:0}):S&&N(r,K.code)}catch(H){console.error(H),S&&N(r,Se())}finally{S&&(y.value=!1),L&&l&&(h=setTimeout(()=>{T({current:p,pageSize:c},!1)},5e3))}},j=async I=>{await o.push({query:{...a.query,page:I.current,page_size:I.pageSize}})};return ne(async()=>{l=!0,u=Te(()=>a.query,I=>{Array.isArray(a.params.contestId)?s=Number(a.params.contestId[0]):s=Number(a.params.contestId),m.value.problemId=I.problem_id||"",m.value.username=I.username||"",I.language!=null?m.value.language=Number(I.language):m.value.language=void 0,I.status!=null?m.value.status=Number(I.status):m.value.status=void 0;const S=parseInt(I.page)||C.value.defaultCurrent,L=parseInt(I.page_size)||C.value.defaultPageSize;p=S,c=L,C.value.pageSizeOptions.includes(c)||(c=C.value.defaultPageSize),C.value={...C.value,current:p,pageSize:c},T({current:p,pageSize:c},!0)},{immediate:!0})}),we(()=>{l=!1,u&&u(),clearTimeout(h)}),(I,S)=>{const L=xe,H=Ue,M=zt,K=pt,Z=F,oe=ge,W=De,fe=Pe,Ie=re,te=Ge,O=ye,ie=Be;return $(),Y(Q,null,[t(Ie,{style:{margin:"10px"}},{default:n(()=>[t(W,{layout:"inline",onSubmit:_,onReset:i},{default:n(()=>[t(H,{label:"题号"},{default:n(()=>[t(L,{modelValue:m.value.problemId,"onUpdate:modelValue":S[0]||(S[0]=X=>m.value.problemId=X),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(H,{label:"用户"},{default:n(()=>[t(L,{modelValue:m.value.username,"onUpdate:modelValue":S[1]||(S[1]=X=>m.value.username=X),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(H,{label:"语言"},{default:n(()=>[t(K,{modelValue:m.value.language,"onUpdate:modelValue":S[2]||(S[2]=X=>m.value.language=X),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:n(()=>[($(!0),Y(Q,null,_e(P.value,X=>($(),G(M,{key:X.value,value:X.value,label:X.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(H,{label:"状态"},{default:n(()=>[t(K,{modelValue:m.value.status,"onUpdate:modelValue":S[3]||(S[3]=X=>m.value.status=X),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:n(()=>[($(!0),Y(Q,null,_e(f.value,X=>($(),G(M,{key:X.value,value:X.value,label:X.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(H,null,{default:n(()=>[t(oe,null,{default:n(()=>[t(Z,{theme:"primary",type:"submit"},{default:n(()=>S[7]||(S[7]=[x("搜索")])),_:1}),t(Z,{theme:"default",variant:"base",type:"reset"},{default:n(()=>S[8]||(S[8]=[x("重置")])),_:1})]),_:1})]),_:1})]),_:1}),t(fe,{data:D.value,columns:v.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:C.value,loading:y.value,onPageChange:j,"table-layout":"auto"},null,8,["data","columns","pagination","loading"])]),_:1}),t(ie,{visible:z.value,"onUpdate:visible":S[5]||(S[5]=X=>z.value=X),width:"800px","cancel-btn":null,"close-btn":!1,onConfirm:S[6]||(S[6]=X=>z.value=!1)},{header:n(()=>[t(te,{onClick:S[4]||(S[4]=()=>{var X;E((X=k.value)==null?void 0:X.id)})},{default:n(()=>{var X,je;return[x(q(((X=k.value)==null?void 0:X.id)+" - "+((je=k.value)==null?void 0:je.language)),1)]}),_:1})]),default:n(()=>[t(O,{loading:b.value},{default:n(()=>{var X;return[A("div",{innerHTML:(X=k.value)==null?void 0:X.code,ref_key:"markdownCodeRef",ref:g,style:{"min-height":"100px"}},null,8,_o)]}),_:1},8,["loading"])]),_:1},8,["visible"])],64)}}}),yt=ae(go,[["__scopeId","data-v-ae344c2e"]]),vo={class:"dida-code-container"},bo=["innerHTML"],ho={key:2,class:"dida-edit-container"};function wt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ve(e)}const yo=ee({__name:"JudgeJobDetail",setup(e){const a=pe(),o=$e(),r=ke(),{globalProperties:l}=ue();let u=!1,h,z=-1;const k=d(""),g=d(null),b=d(""),s=d(null),m=d(0),v=d(null),y=d({from:"#5a96ff",to:"#00A870"});let p=!1;const c=d([{title:"ID",colKey:"id"},{title:"问题",colKey:"problemId",cell:(i,T)=>t(F,{variant:"text",onClick:()=>w(T.row.problemId)},{default:()=>[T.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(i,T)=>{const j=T.row.status,I=tt(j),S=Gt(j);let L=[];return Me(j)&&L.push(t(ye,{text:T.row.state,size:"small",class:"dida-status-loading"},null)),L.push(t("span",null,[I])),t(F,{theme:S,variant:"outline"},wt(L)?L:{default:()=>[L]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"language",cell:(i,T)=>t("span",null,[T.row.language+" / "+T.row.codeLength])},{title:"作者",colKey:"author",width:200,cell:(i,T)=>t(F,{variant:"text",onClick:()=>R(T.row.authorUsername)},{default:()=>[T.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),C=d(!1),D=d(!1),P=d(),f=Ae(()=>r.hasAuth(Ee.ManageJudge)),V=async()=>{if(!D.value){D.value=!0;try{const i=await Fn(z);i.code===0?await U(!0):N(l,i.code)}catch(i){console.error(i),N(l,Se())}finally{D.value=!1}}},w=i=>{i&&o.push({path:"/problem/"+i})},R=i=>{i&&o.push({path:"/user/"+i})},E=i=>{const T=i.status,j=tt(T);let I;switch(T){case he.Init:case he.Rejudge:case he.Compiling:case he.Running:I="default";break;case he.Accept:I="success";break;case he.PE:I="warning";break;default:I="danger";break}return t(ge,null,{default:()=>[t(F,{theme:"default",variant:"outline"},{default:()=>[i.taskId]}),t(F,{theme:I,variant:"outline"},wt(j)?j:{default:()=>[j]}),t("span",null,[x("分数："),i.score]),t("span",null,[x("用时："),i.time]),t("span",null,[x("内存："),i.memory])]})},U=async i=>{var j;i&&(C.value=!0);let T=!1;try{const I=await Rn(z);if(P.value=[],I.code===0){const S=I.data,L=Nt(S);if((j=P.value)==null||j.push(L),S.judger){const M=await Rt(S.judger);k.value=M.name}else k.value="";y.value.to="#00A870",Me(S.status)?(v.value="active",L.taskTotal>0?(m.value=L.taskCurrent/L.taskTotal*100,L.taskCurrent>=L.taskTotal&&(m.value=99)):m.value=0):(m.value=100,S.status===he.Accept?v.value="success":S.status===he.PE?(y.value.to="#F57C20",v.value="warning"):(y.value.to="#F56C6C",v.value="error"));const H={};if(S.code){const K=`\`\`\`${_t(S.language)}
${S.code}
\`\`\``;b.value=await me.md2html(K,H),await Ce(()=>{s.value&&(p||(p=!0,me.highlightRender({lineNumber:!0,enable:!0},s.value)),Fe(s.value))})}g.value=L,Me(S.status)&&(T=!0)}else i&&N(l,I.code)}catch(I){console.error(I),i&&N(l,Se())}finally{i&&(C.value=!1),T&&u&&(h=setTimeout(()=>{U(!1)},5e3))}};function _(){s.value&&s.value.parentElement&&(s.value.style.maxWidth=s.value.parentElement.clientWidth+"px")}return ne(async()=>{if(u=!0,Array.isArray(a.params.judgeId)?z=Number(a.params.judgeId[0]):z=Number(a.params.judgeId),!z){await o.push({name:"judge"});return}await U(!0),_(),window.addEventListener("resize",_)}),we(()=>{u=!1,window.removeEventListener("resize",_),clearTimeout(h)}),(i,T)=>{var fe,Ie,te;const j=ka,I=Pe,S=re,L=be,H=Ke,M=qe,K=ve,Z=Vt,oe=$t,W=F;return $(),Y(Q,null,[t(j,{color:y.value,status:v.value,class:"dida-job-progress",percentage:m.value},null,8,["color","status","percentage"]),t(S,{style:{margin:"10px"}},{default:n(()=>[t(I,{data:P.value,columns:c.value,"row-key":"id","vertical-align":"top",hover:!0,loading:C.value},null,8,["data","columns","loading"])]),_:1}),t(K,null,{default:n(()=>[t(L,{span:8},{default:n(()=>[A("div",vo,[A("div",{innerHTML:b.value,ref_key:"markdownCodeRef",ref:s,class:"dida-code-div"},null,8,bo)])]),_:1}),t(L,{span:4},{default:n(()=>[t(M,{layout:"vertical",bordered:!0,style:{margin:"10px"}},{default:n(()=>[t(H,{label:"判题机"},{default:n(()=>[x(q(k.value),1)]),_:1}),t(H,{label:"判题时间"},{default:n(()=>{var O;return[x(q((O=g.value)==null?void 0:O.judgeTime),1)]}),_:1})]),_:1})]),_:1})]),_:1}),(fe=g.value)!=null&&fe.compileMessage?($(),G(S,{key:0,class:"compile-message"},{default:n(()=>{var O;return[x(q((O=g.value)==null?void 0:O.compileMessage),1)]}),_:1})):ce("",!0),(Ie=g.value)!=null&&Ie.task&&((te=g.value)==null?void 0:te.task.length)>0?($(),G(oe,{key:1,class:"task-panel"},{default:n(()=>{var O;return[($(!0),Y(Q,null,_e((O=g.value)==null?void 0:O.task,(ie,X)=>($(),G(Z,{key:ie.taskId,header:()=>E(ie)},{default:n(()=>[x(q(ie.content)+" "+q(ie.waHint),1)]),_:2},1032,["header"]))),128))]}),_:1})):ce("",!0),f.value?($(),Y("div",ho,[t(W,{onClick:V,loading:D.value},{default:n(()=>T[0]||(T[0]=[x("重新评测")])),_:1},8,["loading"])])):ce("",!0)],64)}}}),kt=ae(yo,[["__scopeId","data-v-c193991c"]]),wo={style:{margin:"10px"}},ko=ee({__name:"ContestList",setup(e){const a=pe(),o=$e(),{globalProperties:r}=ue();let l=null;const u=d(!1),h=d(!1),z=d([{title:"ID",colKey:"id",width:"100",cell:(V,w)=>t(F,{variant:"text",onClick:()=>p(w.row.id)},{default:()=>[w.row.id]})},{title:"标题",colKey:"title",cell:(V,w)=>t(F,{variant:"text",onClick:()=>p(w.row.id)},{default:()=>[w.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),k=d(!1);let g=1,b=50;const s=d({current:g,pageSize:b,defaultCurrent:g,defaultPageSize:b,total:0,pageSizeOptions:[50,100]}),m=d(),v=d({title:"",username:""}),y=d({title:"",description:"",open_time:[]}),p=V=>{V&&o.push({path:"/contest/"+V})},c=async()=>{await o.push({query:{...a.query,title:v.value.title,username:v.value.username,page:1,page_size:s.value.defaultPageSize}})},C=async(V,w)=>{var R;k.value=!0;try{const{current:E,pageSize:U}=V,_=await eo(E,U);if(m.value=[],_.code===0){const i=_.data.list;for(let T=0;T<i.length;T++){const j=i[T],I=await Jt(j);(R=m.value)==null||R.push(I)}s.value={...s.value,total:_.data.total_count}}else w&&N(r,_.code)}catch(E){console.error(E),N(r,Se())}finally{k.value=!1}},D=async V=>{await o.push({query:{...a.query,page:V.current,page_size:V.pageSize}})},P=()=>{u.value=!0},f=async()=>{h.value=!0,console.log("contestCreateForm",y.value),ao(y.value).then(V=>{V.code===0?(se(r,"创建比赛成功"),u.value=!1,o.push({path:"/contest/"+V.data.id})):N(r,V.code)}).finally(()=>{h.value=!1})};return ne(async()=>{l=Te(()=>a.query,V=>{v.value.title=V.title||"",v.value.username=V.username||"";const w=parseInt(V.page)||s.value.defaultCurrent,R=parseInt(V.page_size)||s.value.defaultPageSize;g=w,b=R,s.value={...s.value,current:g,pageSize:b},C({current:g,pageSize:b},!0)},{immediate:!0})}),we(()=>{l&&l()}),(V,w)=>{const R=Pe,E=re,U=be,_=xe,i=Ue,T=F,j=De,I=ge,S=ve,L=Sa,H=Be;return $(),Y(Q,null,[t(S,null,{default:n(()=>[t(U,{span:9},{default:n(()=>[t(E,{style:{margin:"10px"}},{default:n(()=>[t(R,{data:m.value,columns:z.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:s.value,loading:k.value,onPageChange:D},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(U,{span:3},{default:n(()=>[A("div",wo,[t(E,{class:"sh-card"},{default:n(()=>[t(j,{model:v.value},{default:n(()=>[t(i,{label:"标题"},{default:n(()=>[t(_,{modelValue:v.value.title,"onUpdate:modelValue":w[0]||(w[0]=M=>v.value.title=M),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(i,{label:"负责人"},{default:n(()=>[t(_,{modelValue:v.value.username,"onUpdate:modelValue":w[1]||(w[1]=M=>v.value.username=M),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(i,null,{default:n(()=>[t(T,{theme:"primary",onClick:c},{default:n(()=>w[6]||(w[6]=[x("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(E,{class:"sh-card"},{default:n(()=>[t(I,null,{default:n(()=>[t(T,{onClick:P},{default:n(()=>w[7]||(w[7]=[x("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),t(H,{visible:u.value,"onUpdate:visible":w[5]||(w[5]=M=>u.value=M),header:"创建比赛",onConfirm:f,"confirm-loading":h.value},{default:n(()=>[t(j,{"label-width":80,model:y.value,onSubmit:w[4]||(w[4]=Oe(()=>{},["prevent"]))},{default:n(()=>[t(i,{label:"标题"},{default:n(()=>[t(_,{modelValue:y.value.title,"onUpdate:modelValue":w[2]||(w[2]=M=>y.value.title=M),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),t(i,{label:"开启时间"},{default:n(()=>[t(L,{"enable-time-picker":"","allow-input":"",clearable:"",modelValue:y.value.open_time,"onUpdate:modelValue":w[3]||(w[3]=M=>y.value.open_time=M)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),St=ae(ko,[["__scopeId","data-v-3e6ea683"]]),So={style:{margin:"20px"}},Co=["innerHTML"],Po={style:{margin:"12px"}},Io=ee({__name:"ContestDetail",setup(e){let a=pe();const{globalProperties:o}=ue(),r=Re();let l=0;const u=d(!1),h=d(null),z=d([{title:"问题ID",colKey:"id",cell:(b,s)=>t(F,{variant:"text",onClick:()=>g(l,s.row.index)},{default:()=>[s.row.id]})},{title:"标题",colKey:"title",cell:(b,s)=>t(F,{variant:"text",onClick:()=>g(l,s.row.index)},{default:()=>[s.row.title]})},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),k=d([]),g=(b,s)=>{B.push({name:"contest-problem-detail",params:{contestId:b,problemIndex:s}})};return ne(async()=>{if(Array.isArray(a.params.contestId)?l=Number(a.params.contestId[0]):l=Number(a.params.contestId),!l){await B.push({name:"contest"});return}u.value=!0;const b=await Qn(l);if(b.code!==0){u.value=!1,N(o,b.code),await B.push({name:"contest"});return}h.value=await Jt(b.data),k.value=h.value.problems,r.setTitle(h.value.title+" - "+r.getTitle),await Ce(()=>{const s=document.querySelectorAll(".dida-content-description");s&&s.length>0&&s.forEach(m=>{me.mathRender(m),me.highlightRender({lineNumber:!0,enable:!0},m),Fe(m)}),u.value=!1})}),(b,s)=>{const m=mt,v=F,y=ge,p=Vt,c=$t,C=Pe,D=re,P=be,f=Ke,V=qe,w=ve,R=ye;return $(),G(R,{loading:u.value},{default:n(()=>[t(w,{class:"dida-main-content"},{default:n(()=>[t(P,{span:8},{default:n(()=>{var E,U,_;return[A("div",So,[A("h1",null,q((E=h.value)==null?void 0:E.title),1),(U=h.value)!=null&&U.notification?($(),G(m,{key:0,theme:"info",message:(_=h.value)==null?void 0:_.notification},null,8,["message"])):ce("",!0)]),t(c,{"default-value":[0],"expand-icon":!1,borderless:!0},{default:n(()=>{var i;return[($(!0),Y(Q,null,_e((i=h.value)==null?void 0:i.descriptions,(T,j)=>($(),G(p,{key:j,header:T.title},ut({default:n(()=>[A("div",{innerHTML:T.content,class:"dida-content-description"},null,8,Co)]),_:2},[j===0?{name:"headerRightContent",fn:n(()=>[t(y,{size:"small"},{default:n(()=>[t(v,{size:"small"},{default:n(()=>s[0]||(s[0]=[x("收起全部")])),_:1}),t(v,{size:"small"},{default:n(()=>s[1]||(s[1]=[x("展开全部")])),_:1})]),_:1})]),key:"0"}:void 0]),1032,["header"]))),128))]}),_:1}),t(D,{style:{margin:"10px"}},{default:n(()=>[t(C,{data:k.value,columns:z.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1})]}),_:1}),t(P,{span:4},{default:n(()=>[A("div",Po,[t(V,{layout:"vertical",bordered:!0},{default:n(()=>[t(f,{label:"开始时间"},{default:n(()=>{var E;return[x(q((E=h.value)==null?void 0:E.startTime),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),To=ae(Io,[["__scopeId","data-v-0c96c05a"]]);function xo(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ve(e)}const jo=ee({__name:"ContestRank",setup(e){const a=pe(),o=$e(),{globalProperties:r}=ue();let l=null,u=0;const h=v=>{if(v==null)return"-";const y=Math.floor(v/3600).toString().padStart(2,"0"),p=Math.floor(v%3600/60).toString().padStart(2,"0"),c=(v%60).toString().padStart(2,"0");return`${y}:${p}:${c}`},z=[{title:"Rank",colKey:"rank",align:"center",cell:(v,y)=>t(F,{variant:"text",onClick:()=>o.push({name:"contest-user-rank",params:{contestId:u,userId:y.row.user_id}})},{default:()=>[y.row.rank]})},{title:"昵称",colKey:"nickname",cell:(v,y)=>t(F,{variant:"text",onClick:()=>o.push({name:"user",params:{username:y.row.username}})},{default:()=>[y.row.nickname]})},{title:"Solved",colKey:"solved",align:"center",cell:(v,y)=>t(F,{variant:"text",onClick:()=>o.push({name:"contest-judge",params:{contestId:u},query:{username:y.row.username,status:he.Accept}})},{default:()=>[y.row.solved]})},{title:"Penalty",colKey:"penalty",align:"center",cell:(v,y)=>h(y.row.penalty)}],k=d([]),g=d(!1),b=d(),s=()=>{document.body.clientWidth<1e3?k.value.forEach(y=>{y.width="auto"}):k.value.forEach(y=>{y.width="150px"})},m=async v=>{g.value=!0;try{const y=await to(u);if(k.value=z,b.value=[],y.code===0){y.data.problems.sort((D,P)=>D-P),y.data.problems.forEach((D,P)=>{k.value.push({title:ze(D),colKey:`problem_${D}`,align:"center",title:(f,{colIndex:V})=>{let w;return t(F,{variant:"text",onClick:()=>o.push({name:"contest-problem-detail",params:{contestId:u,problemIndex:D}})},xo(w=ze(D))?w:{default:()=>[w]})},cell:(f,V)=>{const w=V.row[`problem_${D}`];if(!w)return"";let R="";return w.acDuration>=0&&(R=h(w.acDuration)),w.attempt>0&&(R&&(R+=" "),R+=`(-${w.attempt})`),t("span",null,[R])},attrs:f=>{const V=f.row[`problem_${D}`];return V?V.acDuration>=0?{style:{backgroundColor:"rgba(130,255,30,0.5)"}}:{style:{backgroundColor:"rgba(255,120,120,0.5)"}}:{}}})});const p=new Date(y.data.start_time),c=y.data.ranks,C=[];for(let D=0;D<c.length;D++){const P=c[D];let f={username:P.author_username,nickname:P.author_nickname},V=0,w=0;P.problems.forEach((R,E)=>{let U=-1;R.ac&&(V++,U=(new Date(R.ac).getTime()-p.getTime())/1e3,w+=U,w+=R.attempt*20*60);const _=R.index;f[`problem_${_}`]={acDuration:U,attempt:R.attempt}}),f.solved=V,f.penalty=w,C.push(f)}C.sort((D,P)=>D.solved!==P.solved?P.solved-D.solved:D.penalty-P.penalty);for(let D=0;D<C.length;D++)C[D].rank=D+1;b.value=C}else v&&N(r,y.code)}catch(y){console.error(y),N(r,Se())}finally{g.value=!1}};return ne(async()=>{l=Te(()=>a.query,async v=>{if(Array.isArray(a.params.contestId)?u=Number(a.params.contestId[0]):u=Number(a.params.contestId),!u){await o.push({name:"contest"});return}await m(!0),s(),window.addEventListener("resize",s)},{immediate:!0})}),we(()=>{window.removeEventListener("resize",s),l&&l()}),(v,y)=>{const p=Pe,c=re,C=ve;return $(),G(C,null,{default:n(()=>[t(c,{style:{margin:"10px"}},{default:n(()=>[A("div",null,[t(p,{data:b.value,columns:k.value,"row-key":"id","vertical-align":"top",hover:!0,"table-layout":"auto",loading:g.value},null,8,["data","columns","loading"])])]),_:1})]),_:1})}}});function Wt(e){const a={};return a.id=e.id,a.authorId=e.author_id,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.title=e.title,a.content=e.content,e.insert_time&&(a.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(a.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(a.updateTime=new Date(e.update_time).toLocaleString()),a.problemId=e.problem_id,a.problemTitle=e.problem_title,a.contestId=e.contest_id,a.contestTitle=e.contest_title,a.contestProblemIndex=e.contest_problem_index,a}async function Lo(e){const a={};if(a.id=e.id,a.authorId=e.author_id,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.content="",e.content){const o={math:{inlineDigit:!0,engine:"KaTeX"}};a.content=await me.md2html(e.content,o)}return e.insert_time&&(a.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(a.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(a.updateTime=new Date(e.update_time).toLocaleString()),a}function zo(e){return J({url:"/discuss?id="+e,method:"get"})}function Vo(e,a,o,r,l,u){const h={};return e&&(h.contest_id=e),a&&(h.problem_id=a),o&&(h.title=o),r&&(h.username=r),l&&(h.page=l),u&&(h.page_size=u),J({url:`/discuss/list?${new URLSearchParams(h).toString()}`,method:"get"})}function $o(e,a,o){return J({url:"/discuss/comment/list?id="+e+"&page="+a+"&page_size="+o,method:"get"})}function Do(e){return J({url:"/discuss/create",method:"post",data:e})}const Xt=async(e,a)=>{a&&await e.push({name:"user",params:{username:a}})},Uo={style:{margin:"10px"}};function Ro(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ve(e)}const Ao=ee({__name:"DiscussList",setup(e){const a=pe(),o=$e(),{globalProperties:r}=ue();let l=null;const u=d(!1),h=d(!1);let z=-1;const k=d([]),g=[],b=[{title:"标题",colKey:"title",cell:(_,i)=>t(F,{variant:"text",onClick:()=>f(i.row.id)},{default:()=>[i.row.title]})},{title:"创建人",colKey:"authorNickname",width:"200",cell:(_,i)=>t(F,{variant:"text",onClick:async()=>await Xt(o,i.row.authorUsername)},{default:()=>[i.row.authorNickname]})},{title:"创建时间",colKey:"insertTime",width:"180"},{title:"更新时间",colKey:"updateTime",width:"180"}],s=d(!1);let m=1,v=50;const y=d({current:m,pageSize:v,defaultCurrent:m,defaultPageSize:v,total:0,pageSizeOptions:[50,100]}),p=d(),c=d({problemId:"",title:"",username:""}),C=d({title:"",content:""}),D=_=>{_&&o.push({name:"problem-detail",params:{problemId:_}})},P=(_,i)=>{o.push({name:"contest-problem-detail",params:{contestId:_,problemIndex:i}})},f=_=>{if(_){if(z){o.push({name:"contest-discuss-detail",params:{contestId:z,discussId:_}});return}o.push({name:"discuss-detail",params:{discussId:_}})}},V=async()=>{await o.push({query:{...a.query,problem_id:c.value.problemId,title:c.value.title,username:c.value.username,page:1,page_size:y.value.defaultPageSize}})},w=async(_,i)=>{var T;s.value=!0;try{const{current:j,pageSize:I}=_,S=await Vo(z,c.value.problemId,c.value.title,c.value.username,j,I);if(p.value=[],S.code===0){if(S.data.list){const L=S.data.list;for(let H=0;H<L.length;H++){const M=L[H],K=await Wt(M);(T=p.value)==null||T.push(K)}}y.value={...y.value,total:S.data.total_count}}else i&&N(r,S.code)}catch(j){console.error(j),N(r,Se())}finally{s.value=!1}},R=async _=>{await o.push({query:{...a.query,page:_.current,page_size:_.pageSize}})},E=()=>{u.value=!0},U=async()=>{h.value=!0,console.log("discussCreateForm",C.value),Do(C.value).then(_=>{_.code===0?(se(r,"创建比赛成功"),u.value=!1,o.push({path:"/discuss/"+_.data.id})):N(r,_.code)}).finally(()=>{h.value=!1})};return ne(async()=>{l=Te(()=>a.query,_=>{Array.isArray(a.params.contestId)?z=Number(a.params.contestId[0]):z=Number(a.params.contestId),k.value=g,z?k.value=k.value.concat([{title:"问题ID",colKey:"contestProblemIndex",width:"100",cell:(j,I)=>{let S;return I.row.contestProblemIndex?t(F,{variant:"text",onClick:()=>P(z,I.row.contestProblemIndex)},Ro(S=ze(I.row.contestProblemIndex))?S:{default:()=>[S]}):""}}]):k.value=k.value.concat([{title:"问题ID",colKey:"problemId",width:"100",cell:(j,I)=>I.row.problemId?t(F,{variant:"text",onClick:()=>D(I.row.problemId)},{default:()=>[I.row.problemId]}):""}]),k.value=k.value.concat(b),c.value.problemId=_.problem_id||"",c.value.title=_.title||"",c.value.username=_.username||"";const i=parseInt(_.page)||y.value.defaultCurrent,T=parseInt(_.page_size)||y.value.defaultPageSize;m=i,v=T,y.value={...y.value,current:m,pageSize:v},w({current:m,pageSize:v},!0)},{immediate:!0})}),we(()=>{l&&l()}),(_,i)=>{const T=Pe,j=re,I=be,S=xe,L=Ue,H=F,M=De,K=ge,Z=ve,oe=Be;return $(),Y(Q,null,[t(Z,null,{default:n(()=>[t(I,{span:9},{default:n(()=>[t(j,{style:{margin:"10px"}},{default:n(()=>[t(T,{data:p.value,columns:k.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:y.value,loading:s.value,"table-layout":"auto",onPageChange:R},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(I,{span:3},{default:n(()=>[A("div",Uo,[t(j,{class:"sh-card"},{default:n(()=>[t(M,{model:c.value},{default:n(()=>[t(L,{label:"问题ID"},{default:n(()=>[t(S,{modelValue:c.value.problemId,"onUpdate:modelValue":i[0]||(i[0]=W=>c.value.problemId=W),placeholder:"请输入完整问题ID"},null,8,["modelValue"])]),_:1}),t(L,{label:"标题"},{default:n(()=>[t(S,{modelValue:c.value.title,"onUpdate:modelValue":i[1]||(i[1]=W=>c.value.title=W),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(L,{label:"创建人"},{default:n(()=>[t(S,{modelValue:c.value.username,"onUpdate:modelValue":i[2]||(i[2]=W=>c.value.username=W),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(L,null,{default:n(()=>[t(H,{theme:"primary",onClick:V},{default:n(()=>i[6]||(i[6]=[x("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(j,{class:"sh-card"},{default:n(()=>[t(K,null,{default:n(()=>[t(H,{onClick:E},{default:n(()=>i[7]||(i[7]=[x("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),t(oe,{visible:u.value,"onUpdate:visible":i[5]||(i[5]=W=>u.value=W),header:"创建讨论",onConfirm:U,"confirm-loading":h.value},{default:n(()=>[t(M,{"label-width":80,model:C.value,onSubmit:i[4]||(i[4]=Oe(()=>{},["prevent"]))},{default:n(()=>[t(L,{label:"标题"},{default:n(()=>[t(S,{modelValue:C.value.title,"onUpdate:modelValue":i[3]||(i[3]=W=>C.value.title=W),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Ze=ae(Ao,[["__scopeId","data-v-29a5b754"]]),Eo={key:0,style:{margin:"20px"}},qo=["innerHTML"],Ko=["innerHTML"],Mo={style:{margin:"10px"}},Fo={style:{margin:"10px"}},Go={style:{margin:"10px","text-align":"right"}},No={style:{margin:"12px"}},Oo={key:0,class:"dida-edit-container"},Ho=ee({__name:"DiscussDetail",props:{discussId:{}},setup(e){const a=e;let o=pe();const{globalProperties:r}=ue();let l=null;const u=Re(),h=ke();let z=d("");const k=d(""),g=d(null),b=d(!1),s=d(null),m=d(!1);let v=1,y=20;const p=d({current:1,total:0,defaultPageSize:y,defaultCurrent:v,pageSizeOptions:[20,50]}),c=d([]),C={},D=Ae(()=>h.hasAuth(Ee.ManageDiscuss)),P=U=>{U&&B.push({name:"discuss-list",query:{...o.query,title:"",tag:U.name}})},f=()=>{B.push({name:"manage-discuss",params:{discussId:k.value}})},V=()=>t("div",{class:"t-pagination__total"},[`共 ${p.value.total} 条回复`]),w=()=>{},R=async(U,_)=>{var i;m.value=!0;try{const{current:T,pageSize:j}=U,I=await $o(k.value,T,j);if(c.value=[],I.code===0){const S=I.data.list;if(S)for(let L=0;L<S.length;L++){const H=S[L],M=await Lo(H);(i=c.value)==null||i.push(M),await Ce(()=>{const K=document.querySelectorAll(".dida-discuss-content");K&&K.length>0&&K.forEach(Z=>{me.mathRender(Z),me.highlightRender({lineNumber:!0,enable:!0},Z),Fe(Z)})})}p.value={...p.value,total:I.data.total_count}}else _&&N(r,I.code)}catch(T){console.error(T),N(r,Se())}finally{m.value=!1}},E=async U=>{await B.push({query:{...o.query,page:U.current,page_size:U.pageSize}})};return ne(async()=>{if(k.value=a.discussId,k.value||(Array.isArray(o.params.discussId)?k.value=o.params.discussId[0]:k.value=o.params.discussId),!k.value){le(r,"讨论不存在"),await B.push({name:"discuss"});return}b.value=!0;const U=await zo(k.value);if(U.code!==0){b.value=!1,N(r,U.code),await B.push({name:"discuss"});return}U.data.tags&&U.data.tags.forEach(j=>{C[j.id]=j}),s.value=Wt(U.data.discuss),u.setTitle(s.value.title+" - "+u.getTitle);let _=s.value.content;const i={math:{inlineDigit:!0,engine:"KaTeX"}};z.value=await me.md2html(_,i),await Ce(()=>{g.value&&(me.mathRender(g.value),me.highlightRender({lineNumber:!0,enable:!0},g.value),Fe(g.value)),b.value=!1}),l=Te(()=>o.query,j=>{const I=parseInt(j.page)||p.value.defaultCurrent,S=parseInt(j.page_size)||p.value.defaultPageSize;v=I,y=S,p.value={...p.value,current:v,pageSize:y},R({current:v,pageSize:y},!0)},{immediate:!0});const T={after:()=>{}};new me("commentEditRef",T)}),we(()=>{l&&l()}),(U,_)=>{const i=Pa,T=Ca,j=re,I=ge,S=Ia,L=F,H=be,M=Ke,K=qe,Z=ve,oe=ye;return $(),G(oe,{loading:b.value},{default:n(()=>[t(Z,{class:"dida-main-content"},{default:n(()=>[t(H,{span:8},{default:n(()=>{var W,fe,Ie;return[(W=s.value)!=null&&W.problemTitle||(fe=s.value)!=null&&fe.contestTitle?($(),Y("div",Eo,[t(T,{"max-item-width":"300"},{default:n(()=>{var te,O,ie,X,je;return[(te=s.value)!=null&&te.contestTitle?($(),Y(Q,{key:0},[t(i,{to:{name:"contest-detail",params:{contestId:(O=s.value)==null?void 0:O.contestId}}},{default:n(()=>{var Le;return[x(q((Le=s.value)==null?void 0:Le.contestTitle),1)]}),_:1},8,["to"]),(ie=s.value)!=null&&ie.contestProblemIndex?($(),G(i,{key:0,to:{name:"contest-problem-detail",params:{problemIndex:(X=s.value)==null?void 0:X.contestProblemIndex}}},{default:n(()=>{var Le,gt;return[x(q(de(ze)((Le=s.value)==null?void 0:Le.contestProblemIndex))+" - "+q((gt=s.value)==null?void 0:gt.problemTitle),1)]}),_:1},8,["to"])):ce("",!0)],64)):($(),Y(Q,{key:1},[t(i,{to:{name:"discuss-list-problem"}},{default:n(()=>_[3]||(_[3]=[x(" 问题讨论")])),_:1}),t(i,{to:{name:"problem-detail",params:{problemId:(je=s.value)==null?void 0:je.problemId}}},{default:n(()=>{var Le;return[x(q((Le=s.value)==null?void 0:Le.problemTitle),1)]}),_:1},8,["to"])],64))]}),_:1})])):ce("",!0),t(j,{style:{margin:"10px"},header:(Ie=s.value)==null?void 0:Ie.title,"header-bordered":!0},{default:n(()=>[A("div",{innerHTML:de(z),class:"dida-discuss-content"},null,8,qo)]),_:1},8,["header"]),($(!0),Y(Q,null,_e(c.value,(te,O)=>($(),G(j,{key:O,style:{margin:"10px"},"header-bordered":""},{header:n(()=>[t(I,null,{default:n(()=>[A("span",null,q(te.authorNickname),1),A("span",null,q(te.insertTime),1)]),_:2},1024)]),default:n(()=>[A("div",{innerHTML:te.content,class:"dida-discuss-content"},null,8,Ko)]),_:2},1024))),128)),A("div",Mo,[t(S,{modelValue:p.value.current,"onUpdate:modelValue":_[0]||(_[0]=te=>p.value.current=te),"page-size":p.value.pageSize,"onUpdate:pageSize":_[1]||(_[1]=te=>p.value.pageSize=te),total:p.value.total,"page-size-options":p.value.pageSizeOptions,"show-page-size":!1,"total-content":V,onChange:E},null,8,["modelValue","page-size","total","page-size-options"])]),A("div",Fo,[_[5]||(_[5]=A("div",{id:"commentEditRef",class:"dida-comment-editor"},null,-1)),A("div",Go,[t(I,null,{default:n(()=>[t(L,{theme:"primary",onClick:w},{default:n(()=>_[4]||(_[4]=[x("提交")])),_:1})]),_:1})])])]}),_:1}),t(H,{span:4},{default:n(()=>[A("div",No,[D.value?($(),Y("div",Oo,[t(L,{onClick:f},{default:n(()=>_[6]||(_[6]=[x("编辑")])),_:1})])):ce("",!0),t(K,{layout:"vertical",bordered:!0},{default:n(()=>[t(M,{label:"创建时间"},{default:n(()=>{var W;return[x(q((W=s.value)==null?void 0:W.insertTime),1)]}),_:1}),t(M,{label:"编辑时间"},{default:n(()=>{var W;return[x(q((W=s.value)==null?void 0:W.modifyTime),1)]}),_:1}),t(M,{label:"更新时间"},{default:n(()=>{var W;return[x(q((W=s.value)==null?void 0:W.updateTime),1)]}),_:1}),t(M,{label:"创建用户"},{default:n(()=>[t(L,{variant:"text",onClick:_[2]||(_[2]=async()=>{var W;return await de(Xt)(de(B),(W=s.value)==null?void 0:W.authorUsername)})},{default:n(()=>{var W;return[x(q((W=s.value)==null?void 0:W.authorNickname),1)]}),_:1})]),_:1}),t(M,{label:"标签"},{default:n(()=>[t(I,null,{default:n(()=>{var W;return[($(!0),Y(Q,null,_e((W=s.value)==null?void 0:W.tags,fe=>($(),G(L,{key:fe.id,variant:"dashed",onClick:()=>P(fe)},{default:n(()=>[x(q(fe.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),ot=ae(Ho,[["__scopeId","data-v-2c25e4fb"]]);function Bo(e,a){return J({url:"/rank/ac/all?page="+e+"&page_size="+a,method:"get"})}function Jo(e,a){return J({url:"/rank/ac/problem?page="+e+"&page_size="+a,method:"get"})}function Wo(e,a){return J({url:"/rank/ac/problem/today?page="+e+"&page_size="+a,method:"get"})}function Xo(e,a){return J({url:"/rank/ac/problem/day7?page="+e+"&page_size="+a,method:"get"})}function Yo(e,a){return J({url:"/rank/ac/problem/year?page="+e+"&page_size="+a,method:"get"})}const Zo={style:{margin:"10px"}};function lt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ve(e)}const Qo=ee({__name:"RankUser",props:{type:{}},setup(e){const a=pe(),o=$e(),{globalProperties:r}=ue();let l=null;const u=e,h=d(""),z=d(""),k={all:{header:"统计所有用户在本站的提交记录",content:"优先以AC记录数量排序，如果相同则提交所用次数较少的优先，如果仍相同，注册较早的用户靠前"},problem:{header:"统计所有用户在本站的提交记录",content:"以题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-today":{header:"统计所有用户今日在本站的提交记录",content:"以今日题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-day7":{header:"统计所有用户最近7日在本站的提交记录",content:"以7日题目记录数量排序（从7日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-year":{header:"统计所有用户最近1年在本站的提交记录",content:"以最近1年题目记录数量排序（从365日前的0点开始计算），如果相同，注册较早的用户靠前"}},g=d([]),b=[{title:"序号",colKey:"index"},{title:"用户名",colKey:"username",cell:(R,E)=>t(F,{variant:"dashed",onClick:()=>D(E.row.username)},{default:()=>[E.row.username]})},{title:"昵称",colKey:"nickname"},{title:"Slogan",colKey:"slogan"}],s=[{title:"题目数量",colKey:"problem_count",cell:(R,E)=>{let U=0;return E.row.problem_count&&(U=E.row.problem_count),t(F,{variant:"dashed",onClick:()=>P(E.row.username)},lt(U)?U:{default:()=>[U]})}}],m=[{title:"正确",colKey:"accept",cell:(R,E)=>{let U=0;return E.row.accept&&(U=E.row.accept),t(F,{variant:"dashed",onClick:()=>P(E.row.username)},lt(U)?U:{default:()=>[U]})}},{title:"提交",colKey:"attempt",cell:(R,E)=>{let U=0;return E.row.attempt&&(U=E.row.attempt),t(F,{variant:"dashed",onClick:()=>f(E.row.username)},lt(U)?U:{default:()=>[U]})}}],v=d(!1);let y=1,p=50;const c=d({current:y,pageSize:p,defaultCurrent:y,defaultPageSize:p,total:0,pageSizeOptions:[50]}),C=d(),D=R=>{o.push({name:"user",params:{username:R}})},P=R=>{o.push({name:"judge-list",query:{username:R,status:he.Accept}})},f=R=>{o.push({name:"judge-list",query:{username:R}})},V=async(R,E)=>{v.value=!0;try{C.value=[];const{current:U,pageSize:_}=R;let i=null;switch(u.type){case"problem":i=await Jo(U,_);break;case"problem-today":i=await Wo(U,_);break;case"problem-day7":i=await Xo(U,_);break;case"problem-year":i=await Yo(U,_);break;default:i=await Bo(U,_);break}if(i.code===0){const T=i.data.list;if(!T||T.length<=0){c.value={...c.value,total:0},se(r,"未找到记录");return}C.value=[];const j=c.value.pageSize*(c.value.current-1);let I=1;T.forEach(S=>{var H;const L=S;L.index=j+I++,(H=C.value)==null||H.push(L)}),c.value={...c.value,total:i.data.total_count}}else E&&N(r,i.code)}catch(U){console.error(U),N(r,Se())}finally{v.value=!1}},w=async R=>{await o.push({query:{...a.query,page:R.current,page_size:R.pageSize}})};return ne(async()=>{v.value=!0,l=Te(()=>a.query,R=>{switch(u.type&&k[u.type]?(h.value=k[u.type].header,z.value=k[u.type].content):(h.value=k.all.header,z.value=k.all.content),u.type){case"all":g.value=b.concat(m);break;default:g.value=b.concat(s);break}const E=parseInt(R.page)||c.value.defaultCurrent,U=parseInt(R.page_size)||c.value.defaultPageSize;y=E,p=U,c.value={...c.value,current:y,pageSize:p},V({current:y,pageSize:p},!0)},{immediate:!0})}),we(()=>{l&&l()}),(R,E)=>{const U=Pe,_=re,i=be,T=ve;return $(),G(T,null,{default:n(()=>[t(i,{span:9},{default:n(()=>[t(_,{style:{margin:"10px"}},{default:n(()=>[t(U,{data:C.value,columns:g.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:c.value,loading:v.value,"table-layout":"auto",onPageChange:w},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(i,{span:3},{default:n(()=>[A("div",Zo,[t(_,{class:"sh-card",header:h.value,"header-bordered":!0},{default:n(()=>[x(q(z.value),1)]),_:1},8,["header"])])]),_:1})]),_:1})}}}),Ne=ae(Qo,[["__scopeId","data-v-ad6297d7"]]),el=ee({__name:"ManageJudge",setup(e){const{globalProperties:a}=ue(),o=d(""),r=d(!1),l=d(!1),u=d(!1),h=async()=>{r.value=!0;try{const g=await qn();if(g.code!==0){N(a,g.code);return}se(a,"重判成功"),await B.push({name:"judge-list"})}catch(g){console.error(g),N(a,"重判失败")}finally{r.value=!1}},z=async()=>{if(o.value===""){N(a,"请输入问题Id");return}l.value=!0;try{const g=await Kn(o.value);if(g.code!==0){N(a,g.code);return}se(a,"重判成功"),await B.push({name:"judge-list",query:{problem_id:o.value}})}catch(g){console.error(g),N(a,"重判失败")}finally{l.value=!1}},k=async()=>{u.value=!0;try{const g=await Mn();if(g.code!==0){N(a,g.code);return}se(a,"重判成功"),await B.push({name:"judge-list"})}catch(g){console.error(g),N(a,"重判失败")}finally{u.value=!1}};return(g,b)=>{const s=F,m=re,v=xe,y=ge;return $(),Y(Q,null,[t(m,{class:"yj-manage-card",title:"重判最近提交"},{default:n(()=>[t(s,{onClick:h,loading:r.value},{default:n(()=>b[1]||(b[1]=[x("重判")])),_:1},8,["loading"])]),_:1}),t(m,{class:"yj-manage-card",title:"重判问题"},{default:n(()=>[t(y,null,{default:n(()=>[t(v,{modelValue:o.value,"onUpdate:modelValue":b[0]||(b[0]=p=>o.value=p),placeholder:"输入问题Id"},null,8,["modelValue"]),t(s,{onClick:z,loading:l.value},{default:n(()=>b[2]||(b[2]=[x("重判")])),_:1},8,["loading"])]),_:1})]),_:1}),t(m,{class:"yj-manage-card",title:"重判所有"},{default:n(()=>[t(s,{onClick:k,theme:"danger",loading:u.value},{default:n(()=>b[3]||(b[3]=[x("重判")])),_:1},8,["loading"])]),_:1})],64)}}}),tl=ae(el,[["__scopeId","data-v-14c853f1"]]),al={style:{margin:"10px"}},nl={key:1},ol={style:{margin:"12px"}},ll={class:"dida-edit-container"},sl=ee({__name:"ProblemEdit",setup(e){let a=pe();const{globalProperties:o}=ue(),r=Re(),l=d(""),u=d(!1);let h=null;const z=d(!1),k=d(null),g=d({title:"",timeLimit:0,memoryLimit:0,source:"",tags:[]}),b=d([]),s=d([]),m=Ae(()=>{const P=[],f=b.value;for(let V=0,w=f.length;V<w;V++)f[V].value&&P.push(f[V].value);return P}),v=(P,f)=>{const{trigger:V,index:w,item:R}=f;if(V==="clear"&&(b.value=[]),["tag-remove","backspace"].includes(V)&&b.value.splice(w,1),V==="enter"){for(let U=0;U<s.value.length;U++){const _=s.value[U];if(_.label===R){for(let i=0;i<b.value.length;i++)if(b.value[i].label===_.label)return;b.value.push(_);return}}const E={label:R,value:R};b.value.push(E),s.value=s.value.concat(E)}},y=(P,{current:f,type:V})=>{if(!f){b.value=V==="check"?s.value.slice(1):[];return}if(V==="check"){const w=s.value.find(R=>R.value===f);if(!w)return;b.value.push(w)}else b.value=b.value.filter(w=>w.value!==f)},p=()=>{B.push({name:"problem-detail",params:{problemId:l.value}})},c=()=>{B.push({name:"manage-problem-judge",params:{problemId:l.value}})},C=async()=>{if(h){z.value=!0,g.value.tags=[];for(let P=0;P<b.value.length;P++){const f=b.value[P];f&&f.label&&g.value.tags.push(f.label)}try{const P=await Hn(l.value,g.value.title,g.value.timeLimit,g.value.memoryLimit,g.value.source,g.value.tags,h.getValue());if(z.value=!0,P.code!==0){N(o,P.code);return}P.data!=null&&(k.value.updateTime=new Date(P.data).toLocaleString()),Et(o,"保存成功")}finally{z.value=!1}}},D=async()=>{const P=await Ot(l.value);if(P.code!==0){N(o,P.code),console.error("problem get failed",P.code),await B.push({name:"problem"});return}const f=P.data.problem;if(k.value=We(f,{}),g.value.title=f.title,g.value.timeLimit=f.time_limit,g.value.memoryLimit=f.memory_limit,g.value.source=f.source,g.value.tags=[],b.value=[],P.data.tags)for(let R=0;R<P.data.tags.length;R++){const E=P.data.tags[R];E&&E.name&&(g.value.tags.push(E.name),b.value.push({label:E.name,value:E.id}))}r.setTitle(f.title+" - "+r.getTitle);let V=f.description;const w={after:()=>{h==null||h.setValue(V)}};h=new me("codeEditRef",w),u.value=!1};return ne(async()=>{if(Array.isArray(a.params.problemId)?l.value=a.params.problemId[0]:l.value=a.params.problemId,!l.value){le(o,"题目不存在"),await B.push({name:"problem"});return}u.value=!0,Ht(-1).then(async P=>{P.code===0?(P.data.list&&P.data.list.forEach(f=>{s.value.push({label:f.name,value:f.id})}),await D()):(N(o,P.code),console.error("problem tag get failed",P.code),await B.push({name:"problem"}))}).catch(async P=>{console.error(P),N(o,"获取数据异常"),await B.push({name:"problem"})})}),(P,f)=>{const V=xe,w=Ue,R=Ta,E=ja,U=xa,_=De,i=re,T=be,j=F,I=ge,S=Ke,L=qe,H=ve,M=ye;return $(),G(M,{loading:u.value},{default:n(()=>[t(H,null,{default:n(()=>[t(T,{span:8},{default:n(()=>[A("div",al,[t(i,{class:"sh-card"},{default:n(()=>[t(_,{model:g.value},{default:n(()=>[t(w,{label:"标题"},{default:n(()=>[t(V,{modelValue:g.value.title,"onUpdate:modelValue":f[0]||(f[0]=K=>g.value.title=K),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),t(w,{label:"时间限制"},{default:n(()=>[t(R,{modelValue:g.value.timeLimit,"onUpdate:modelValue":f[1]||(f[1]=K=>g.value.timeLimit=K),theme:"normal",min:0},{suffix:n(()=>f[4]||(f[4]=[A("span",null,"ms",-1)])),_:1},8,["modelValue"])]),_:1}),t(w,{label:"内存限制"},{default:n(()=>[t(R,{modelValue:g.value.memoryLimit,"onUpdate:modelValue":f[2]||(f[2]=K=>g.value.memoryLimit=K),theme:"normal",min:0},{suffix:n(()=>f[5]||(f[5]=[A("span",null,"KB",-1)])),_:1},8,["modelValue"])]),_:1}),t(w,{label:"来源"},{default:n(()=>[t(V,{modelValue:g.value.source,"onUpdate:modelValue":f[3]||(f[3]=K=>g.value.source=K),placeholder:"请输入题目来源"},null,8,["modelValue"])]),_:1}),t(w,{label:"标签"},{default:n(()=>[t(U,{value:b.value,"allow-input":!0,placeholder:"请选择或输入","tag-input-props":{excessTagsDisplayType:"break-line"},"popup-props":{overlayInnerClassName:["narrow-scrollbar"],overlayInnerStyle:{maxHeight:"280px",overflowY:"auto",overscrollBehavior:"contain",padding:"6px"}},clearable:"",multiple:"",onTagChange:v},{panel:n(()=>[s.value.length?($(),G(E,{key:0,value:m.value,options:s.value,onChange:y},null,8,["value","options"])):($(),Y("div",nl,"暂无数据"))]),suffixIcon:n(()=>[t(de(sa))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(T,{span:4},{default:n(()=>[A("div",ol,[A("div",ll,[t(I,null,{default:n(()=>[t(j,{onClick:C,theme:"danger",loading:z.value},{default:n(()=>f[6]||(f[6]=[x("保存")])),_:1},8,["loading"]),t(j,{onClick:c,theme:"warning"},{default:n(()=>f[7]||(f[7]=[x("判题数据")])),_:1}),t(j,{onClick:p},{default:n(()=>f[8]||(f[8]=[x("查看")])),_:1})]),_:1})]),t(L,{layout:"vertical",bordered:!0},{default:n(()=>[t(S,{label:"创建时间"},{default:n(()=>{var K;return[x(q((K=k.value)==null?void 0:K.insertTime),1)]}),_:1}),t(S,{label:"更新时间"},{default:n(()=>{var K;return[x(q((K=k.value)==null?void 0:K.updateTime),1)]}),_:1}),t(S,{label:"判题方式"},{default:n(()=>{var K;return[x(q((K=k.value)==null?void 0:K.judgeType),1)]}),_:1}),t(S,{label:"上传用户"},{default:n(()=>{var K;return[x(q((K=k.value)==null?void 0:K.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1}),f[9]||(f[9]=A("div",{id:"codeEditRef",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"])}}}),rl=ae(sl,[["__scopeId","data-v-e994311e"]]),ul={style:{margin:"10px"}},il={style:{margin:"12px"}},cl={class:"dida-edit-container"},dl=ee({__name:"ProblemJudge",setup(e){let a=pe();const{globalProperties:o}=ue(),r=Re(),l=d(""),u=d(!1),h=d(null);let z=null;const k=d(null),g=d(""),b=d(!1),s=d(!1),m=d([{title:"文件",colKey:"file"},{title:"大小",colKey:"size",width:150,cell:(_,i)=>i.row.size.toFixed(0)+" B"},{title:"最后修改时间",colKey:"lastModified",width:180,cell:(_,i)=>new Date(i.row.lastModified).toLocaleString()},{title:"操作",colKey:"action",width:100,cell:(_,i)=>t(F,{onClick:()=>D(i.row.file)},{default:()=>[x("下载")]})}]),v=d([]),y=Ae(()=>({border:"2px dashed #ccc",borderRadius:"6px",padding:"20px",textAlign:"center",cursor:"pointer",backgroundColor:b.value?"#f0f9ff":"#fff",transition:"background-color 0.2s ease"})),p=Ae(()=>g.value?`已选择：${g.value}`:b.value?"松开文件以上传":"拖拽文件到这里，或点击选择文件"),c=()=>{B.push({name:"problem-detail",params:{problemId:l.value}})},C=()=>{B.push({name:"manage-problem",params:{problemId:l.value}})},D=async _=>{const i=await Bn(l.value,_);if(i.code!==0){N(o,i.code);return}const T=document.createElement("a");T.href=i.data,T.target="_blank",T.click(),URL.revokeObjectURL(T.href)},P=async()=>{if(!z){le(o,"请选择压缩包");return}s.value=!0,Jn(l.value,z).then(async _=>{_.code==0?(k.value.value=null,z=null,g.value="",u.value=!0,Et(o,"上传成功"),await U()):N(o,_.code)}).catch(_=>{console.log(_),o.$message.error({duration:3e3,content:"申请失败"})}).finally(()=>{s.value=!1})},f=()=>{var _;(_=k.value)==null||_.click()},V=_=>{const i=_.target.files[0];i&&(g.value=i.name,z=i)},w=_=>{b.value=!0},R=()=>{b.value=!1},E=_=>{_.preventDefault(),_.stopPropagation(),b.value=!1;const i=_.dataTransfer.files[0];if(i){g.value=i.name;const T=new DataTransfer;T.items.add(i),k.value.files=T.files,z=i}},U=async()=>{const _=await Gn(l.value);if(_.code!==0){N(o,_.code),await B.push({name:"problem"});return}const i=_.data.problem;h.value=We(i,{}),r.setTitle(i.title+" - "+r.getTitle),v.value=[],_.data.judges?_.data.judges.forEach(T=>{v.value.push({file:T.key,size:T.size,lastModified:T.last_modified})}):le(o,"评测数据不存在"),u.value=!1};return ne(async()=>{if(Array.isArray(a.params.problemId)?l.value=a.params.problemId[0]:l.value=a.params.problemId,!l.value){le(o,"题目不存在"),await B.push({name:"problem"});return}u.value=!0,await U()}),(_,i)=>{const T=Pe,j=be,I=F,S=ge,L=Ke,H=qe,M=ve,K=ye;return $(),G(K,{loading:u.value},{default:n(()=>[t(M,null,{default:n(()=>[t(j,{span:7},{default:n(()=>[A("div",ul,[A("div",{id:"drop-zone",style:xt(y.value),onClick:f,onDragenter:Oe(w,["prevent"]),onDragover:i[0]||(i[0]=Oe(()=>{},["prevent"])),onDragleave:Oe(R,["prevent"]),onDrop:E},[A("input",{ref_key:"fileInput",ref:k,type:"file",style:{display:"none"},onChange:V},null,544),x(" "+q(p.value),1)],36)]),t(T,{data:v.value,columns:m.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1}),t(j,{span:5},{default:n(()=>[A("div",il,[A("div",cl,[t(S,null,{default:n(()=>[t(I,{onClick:P,theme:"danger",loading:s.value},{default:n(()=>i[1]||(i[1]=[x("上传")])),_:1},8,["loading"]),t(I,{onClick:C,theme:"warning"},{default:n(()=>i[2]||(i[2]=[x("编辑")])),_:1}),t(I,{onClick:c},{default:n(()=>i[3]||(i[3]=[x("查看")])),_:1})]),_:1})]),t(H,{layout:"vertical",bordered:!0},{default:n(()=>[t(L,{label:"标题"},{default:n(()=>{var Z;return[x(q((Z=h.value)==null?void 0:Z.title),1)]}),_:1}),t(L,{label:"创建时间"},{default:n(()=>{var Z;return[x(q((Z=h.value)==null?void 0:Z.insertTime),1)]}),_:1}),t(L,{label:"更新时间"},{default:n(()=>{var Z;return[x(q((Z=h.value)==null?void 0:Z.updateTime),1)]}),_:1}),t(L,{label:"判题方式"},{default:n(()=>{var Z;return[x(q((Z=h.value)==null?void 0:Z.judgeType),1)]}),_:1}),t(L,{label:"评测数据"},{default:n(()=>{var Z;return[x(q((Z=h.value)==null?void 0:Z.judgeMd5),1)]}),_:1}),t(L,{label:"上传用户"},{default:n(()=>{var Z;return[x(q((Z=h.value)==null?void 0:Z.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),ml=ae(dl,[["__scopeId","data-v-3be5c9c9"]]),pl={style:{display:"flex","align-items":"center"}},fl={style:{color:"#409eff","margin-right":"20px"}},_l={class:"dida-login-footer"},gl=ee({__name:"UserForget",setup(e){const{globalProperties:a}=ue(),o=ke(),r=d(!1),l=d(!1),u=d(!1),h=d("发送验证码");let z=null,k=-1;const g=d(!1),b=d(null),s=d(""),m=d({username:"",emailKey:"",password:"",confirmPassword:""}),y=d({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:V=>new Promise(w=>{const R=setTimeout(()=>{w(m.value.password===V),clearTimeout(R)})}),message:"两次密码不一致"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),p=()=>{se(a,"重置成功")},c=async V=>{if(!u.value){r.value=!0,l.value=!0;try{const w=await vn(V,m.value.username);w.code===0?(se(a,"验证码发送成功"),s.value=w.data,l.value=!1,u.value=!0,z=new Date,h.value="60秒后重发",k=setInterval(()=>{const E=Math.floor((new Date().getTime()-(z==null?void 0:z.getTime()))/1e3);E>60?(h.value="发送验证码",u.value=!1,clearInterval(k)):h.value=`${60-E}秒后重发`},1e3)):N(a,w.code)}catch(w){console.error("Send email key error",w),le(a,"发送验证码失败")}finally{r.value=!1}}},C=async()=>{var E;if(g.value=!0,u.value||l.value)return;await Ce();const V=document.getElementById("cf-confirm-div");V&&V.remove();const w=document.createElement("div");w.id="cf-confirm-div",w.setAttribute("data-theme","light"),(E=b.value)==null||E.appendChild(w);const R=window;R.turnstile.ready(function(){R.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(U){g.value=!1,await c(U)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},D=d(()=>t(F,{onClick:C,disabled:u.value,loading:l.value,style:"width:120px"},{default:()=>[h.value]})),P=async()=>{r.value=!0;try{const V=await bn(m.value.username,m.value.password,m.value.emailKey);V.code===0?(se(a,"密码修改成功"),a.$router.push({name:"login"})):N(a,V.code)}catch(V){console.error("Modify password error",V),le(a,"修改密码失败")}finally{r.value=!1}},f=async({validateResult:V,firstError:w,e:R})=>{if(!r.value){if(R.preventDefault(),V!==!0){le(a,w);return}s.value?await P():await C()}};return ne(()=>{if(o.isLogin()){a.$router.push({path:"/user"});return}}),we(()=>{}),(V,w)=>{const R=mt,E=xe,U=Ue,_=Lt,i=F,T=De,j=Ge,I=re,S=Be;return $(),Y(Q,null,[t(I,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:n(()=>[t(R,{"max-line":1},{default:n(()=>w[6]||(w[6]=[A("span",null,"如果您未绑定邮箱或忘记用户名，可联系管理员寻求帮助",-1),A("span",null,"管理员邮箱：BoilTask@qq.com",-1)])),_:1}),t(T,{ref:"form",rules:y.value,data:m.value,colon:!0,onReset:p,onSubmit:f,class:"yj-login-form"},{default:n(()=>[t(U,{name:"username",label:"用户名"},{default:n(()=>[t(E,{modelValue:m.value.username,"onUpdate:modelValue":w[0]||(w[0]=L=>m.value.username=L),clearable:"",placeholder:"请输入完整用户名"},null,8,["modelValue"])]),_:1}),s.value?($(),Y(Q,{key:0},[t(U,{name:"email",label:"发送邮箱"},{default:n(()=>[t(_,{append:D.value},{default:n(()=>[A("div",pl,[A("span",fl,q(s.value),1)])]),_:1},8,["append"])]),_:1}),t(U,{name:"emailKey",label:"验证码"},{default:n(()=>[t(E,{modelValue:m.value.emailKey,"onUpdate:modelValue":w[1]||(w[1]=L=>m.value.emailKey=L),clearable:"",placeholder:"请输入收到的验证码"},null,8,["modelValue"])]),_:1}),t(U,{name:"password",label:"新密码"},{default:n(()=>[t(E,{modelValue:m.value.password,"onUpdate:modelValue":w[2]||(w[2]=L=>m.value.password=L),type:"password",clearable:"",placeholder:"新密码"},null,8,["modelValue"])]),_:1}),t(U,{name:"confirmPassword",label:"确认密码"},{default:n(()=>[t(E,{modelValue:m.value.confirmPassword,"onUpdate:modelValue":w[3]||(w[3]=L=>m.value.confirmPassword=L),type:"password",clearable:"",placeholder:"请重复输入密码"},null,8,["modelValue"])]),_:1})],64)):ce("",!0),s.value?($(),G(U,{key:1},{default:n(()=>[t(i,{theme:"primary",type:"submit",block:"",loading:r.value},{default:n(()=>w[7]||(w[7]=[x("修改密码")])),_:1},8,["loading"])]),_:1})):($(),G(U,{key:2},{default:n(()=>[t(i,{theme:"primary",type:"submit",block:"",loading:r.value},{default:n(()=>w[8]||(w[8]=[x("重置密码")])),_:1},8,["loading"])]),_:1}))]),_:1},8,["rules","data"]),A("div",_l,[t(j,{onClick:w[4]||(w[4]=()=>{de(a).$router.push({name:"login"})})},{default:n(()=>w[9]||(w[9]=[x("返回登陆 ")])),_:1})])]),_:1}),t(S,{visible:g.value,"onUpdate:visible":w[5]||(w[5]=L=>g.value=L),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:n(()=>[A("div",{ref_key:"dialogContainer",ref:b,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),vl=ae(gl,[["__scopeId","data-v-d3cb1db8"]]),Yt=[{name:"problem-list",tab:"problem",sidebar:"problem-list",path:"",title:"问题列表",icon:"list",component:Zn},{name:"problem-detail",tab:"problem",sidebar:"problem-list",path:":problemId+",title:"问题详情",icon:"list",component:bt},{name:"problem-recommend",tab:"problem",sidebar:"problem-recommend",path:"recommend/:problemId*",title:"问题推荐",icon:"cpu",needLogin:!0,component:fo},{name:"judge-list",tab:"judge",sidebar:"judge-list",path:"",title:"评测列表",icon:"list",component:yt},{name:"judge-detail",tab:"judge",sidebar:"judge-list",path:":judgeId+",title:"评测详情",icon:"cpu",component:kt},{name:"contest-list",tab:"contest",sidebar:"contest-list",path:"",title:"比赛列表",icon:"list",component:St},{name:"contest-recent",tab:"contest",sidebar:"contest-recent",path:"recent",title:"近期比赛",icon:"list",component:St},{name:"contest-detail",tab:"contest-detail-tab",sidebar:"contest-detail",path:":contestId+",title:"比赛详情",icon:"cpu",component:To},{name:"contest-problem-detail",tab:"contest-detail-tab",sidebar:"contest-problem-detail",path:":contestId+/problem/:problemIndex+",title:"问题详情",icon:"cpu",disableSidebar:!0,component:bt},{name:"contest-judge",tab:"contest-detail-tab",sidebar:"contest-judge",path:":contestId+/judge",title:"评测列表",icon:"list",component:yt},{name:"contest-judge-detail",tab:"contest-detail-tab",sidebar:"contest-judge-detail",path:":contestId+/judge/:judgeId+",title:"评测详情",icon:"cpu",component:kt,disableSidebar:!0},{name:"contest-rank",tab:"contest-detail-tab",sidebar:"contest-rank",path:":contestId+/rank",title:"比赛排名",icon:"list",component:jo},{name:"contest-discuss",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss",title:"比赛讨论",icon:"list",component:Ze},{name:"contest-discuss-detail",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss/:discussId+",title:"讨论详情",icon:"list",component:ot},{name:"discuss-list",tab:"discuss",sidebar:"discuss-list",path:"",title:"讨论列表",icon:"list",component:Ze},{name:"discuss-list-problem",tab:"discuss",sidebar:"discuss-list-problem",path:"problem",title:"问题讨论",icon:"list",component:Ze},{name:"discuss-list-judge",tab:"discuss",sidebar:"discuss-list-judge",path:"judge",title:"评测讨论",icon:"list",component:Ze},{name:"discuss-detail",tab:"discuss",sidebar:"discuss-list",path:":discussId+",title:"讨论详情",icon:"list",component:ot},{name:"rank-ac-all",tab:"rank",sidebar:"rank-ac-all",path:"ac",title:"AC排名",icon:"base-station",props:{type:"all"},component:Ne},{name:"rank-ac-problem",tab:"rank",sidebar:"rank-ac-problem",path:"ac/problem",title:"题量排名",icon:"base-station",props:{type:"problem"},component:Ne},{name:"rank-ac-problem-today",tab:"rank",sidebar:"rank-ac-problem-today",path:"ac/problem/today",title:"今日题量",icon:"base-station",props:{type:"problem-today"},component:Ne},{name:"rank-ac-problem-day7",tab:"rank",sidebar:"rank-ac-problem-day7",path:"ac/problem/day7",title:"7日题量",icon:"base-station",props:{type:"problem-day7"},component:Ne},{name:"rank-ac-problem-year",tab:"rank",sidebar:"rank-ac-problem-year",path:"ac/problem/year",title:"1年题量",icon:"base-station",props:{type:"problem-year"},component:Ne},{name:"tool-paste",tab:"tool",sidebar:"tool-paste",path:"paste",title:"码池",icon:"base-station",component:ct},{name:"system-status",tab:"system",sidebar:"system-status",path:"",title:"运行状态",icon:"base-station",component:ct},{name:"system-about",tab:"system",sidebar:"system-about",path:"about",title:"关于",icon:"base-station",props:{discussId:"52"},component:ot},{name:"manage-problem",tab:"manage",sidebar:"manage-problem",disableSidebar:!0,path:"problem/:problemId+",title:"问题编辑",icon:"list",component:rl,auths:[Ee.ManageProblem]},{name:"manage-problem-judge",tab:"manage",sidebar:"manage-problem-judge",disableSidebar:!0,path:"problem/:problemId+/judge",title:"评测数据",icon:"list",component:ml,auths:[Ee.ManageProblem]},{name:"manage-judge",tab:"manage",path:"judge",sidebar:"manage-judge",title:"评测管理",icon:"list",auths:["i-manage-judge"],component:tl},{name:"login-forget",tab:"login",path:"forget",title:"忘记密码",component:vl}],Ct=(e,a,o,r)=>{r.tab==o&&(r.disableSidebar&&a!=r.sidebar||r.sidebar==null||r.sidebar!=r.name||e.push({name:r.name,title:r.title,icon:r.icon,to:{name:r.name}}))},bl=(e,a)=>{const o=[];return Yt.forEach(r=>{if(qt(r)){const l=[];r.children.forEach(u=>{Ct(l,e,a,u)}),l.length>0&&o.push({title:r.title,children:l})}else Ct(o,e,a,r)}),o},Pt=(e,a)=>{const o=xn(a.tab),r={name:a.name,path:"/"+a.path,meta:{title:a.title+" - "+o.title,tab:a.tab,sidebar:a.sidebar,showSidebar:o.showSidebar,needLogin:o.needLogin||a.needLogin,tabAuths:o.auths,auths:a.auths},props:a.props,component:a.component};o.disablePath||(r.path=o.path+r.path),e.push(r)},hl=e=>{Yt.forEach(a=>{qt(a)?a.children.forEach(o=>{Pt(e,o)}):Pt(e,a)})},yl={class:"sh-main"},wl=ee({__name:"View403",setup(e){let a=pe();const o=d("");return ne(()=>{a.query.target?o.value=a.query.target:o.value=a.fullPath}),(r,l)=>{const u=F;return $(),Y("div",yl,[A("p",null,q(o.value),1),l[2]||(l[2]=A("p",null,"该页面无访问权限，请更换访问目标或重新登陆后再试",-1)),t(u,{theme:"primary",onClick:l[0]||(l[0]=()=>r.$router.push("/"))},{default:n(()=>l[1]||(l[1]=[x("返回首页")])),_:1})])}}}),Zt=ae(wl,[["__scopeId","data-v-777362b3"]]),Xe=[];Ln(Xe);hl(Xe);Xe.push({path:"/403",name:"403",component:Zt});Xe.push({path:"/:pathMatch(.*)*",name:"404",component:At});const B=ra({history:ua("/"),routes:Xe});B.beforeEach((e,a,o)=>{if(e.name==null||!B.hasRoute(e.name)){o({name:"home"});return}const r=e.matched[e.matched.length-1].meta;if(r.redirect){o({name:r.redirect});return}if(r.needLogin){const u=ke();if(u.getToken==null||u.getToken==""){o({name:"login",query:{redirect_uri:e.fullPath}});return}}const l=r.tabAuths;if(l&&!ke().hasAllAuths(l)){o({name:"403",query:{target:e.fullPath}});return}o()});B.afterEach((e,a)=>{if(e.name===a.name)return;const o=nt(),r=Re();let l=null;if(e.matched.length>0&&(l=e.matched[e.matched.length-1].meta),l!=null&&l.title&&r.setTitle(l==null?void 0:l.title),l!=null&&l.showSidebar){o.setSidebarShow(!0);const u=bl(l==null?void 0:l.sidebar,l==null?void 0:l.tab);o.setMenuList(u),o.setMenuActiveName(l==null?void 0:l.sidebar)}else o.setSidebarShow(!1)});const Qt=at("login",{state:()=>({Loaded:!1}),getters:{isLoaded(){return this.Loaded}}}),kl=ee({__name:"HeaderContent",setup(e){const a=Qt(),o=ke(),{globalProperties:r}=ue(),l=d(a.isLoaded),u=d(!1),h=d(o.getUsername),z=d(o.getNickname),k=d(),g=()=>{k.value=jn(o)};a.$subscribe((m,v)=>{l.value=v.Loaded}),o.$subscribe((m,v)=>{h.value=v.username,z.value=v.nickname,u.value=v.token!="",g()});const b=()=>{r.$router.currentRoute.value.name!=="login"&&r.$router.push({name:"login",query:{redirect_uri:r.$router.currentRoute.value.fullPath}})},s=()=>{o.clear(),r.$message.success({duration:3e3,content:"注销成功"}),r.$router.push({path:"/login",query:{redirect_uri:r.$router.currentRoute.value.fullPath}})};return ne(()=>{g()}),(m,v)=>{const y=jt("router-link"),p=Ut,c=Dt,C=La,D=za;return $(),G(D,{modelValue:m.$route.meta.tab,"onUpdate:modelValue":v[0]||(v[0]=P=>m.$route.meta.tab=P),class:"sh-menu","expand-type":"popup"},{logo:n(()=>[t(y,{to:"/",class:"sh-logo"},{default:n(()=>v[1]||(v[1]=[x("DidaOJ")])),_:1})]),operations:n(()=>[l.value&&u.value?($(),G(C,{key:0,title:z.value},{icon:n(()=>[t(p,{name:"user"})]),default:n(()=>[t(c,{value:"user",to:{path:"/user/"+h.value}},{default:n(()=>v[2]||(v[2]=[x("个人空间")])),_:1},8,["to"]),t(c,{value:"user_logout",onClick:s},{default:n(()=>v[3]||(v[3]=[x(" 注销")])),_:1})]),_:1},8,["title"])):l.value?($(),G(c,{key:2,value:"login",onClick:b},{icon:n(()=>[t(p,{name:"login"})]),default:n(()=>[v[5]||(v[5]=x(" 登录 "))]),_:1})):($(),G(c,{key:1,value:"login"},{icon:n(()=>[t(p,{name:"login"})]),default:n(()=>[v[4]||(v[4]=x(" ... "))]),_:1}))]),default:n(()=>[($(!0),Y(Q,null,_e(k.value,P=>($(),G(c,{key:P.name,value:P.name,to:{name:P.name}},{icon:n(()=>[P.icon?($(),G(p,{key:0,name:P.icon},null,8,["name"])):ce("",!0)]),default:n(()=>[x(" "+q(P.title),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])}}}),Sl=ae(kl,[["__scopeId","data-v-c64d812f"]]),Cl={id:"menu-container"},Pl=ee({__name:"SidebarContent",setup(e){const a=nt(),o=d(!1),r=d(null),l=d(a.menuActiveName),u=d(a.menuList),h=d([]),z=d(!1),k=()=>{l.value=a.menuActiveName;const b=JSON.stringify(u.value),s=JSON.stringify(a.menuList);b!==s&&(h.value.push([...a.menuList]),g())},g=async()=>{if(h.value.length>0&&!z.value){for(z.value=!0;h.value.length>1;)h.value.shift();const b=h.value.shift();o.value=b.length<=0,u.value=[],await Ce(),r.value&&r.value.updateActiveName(),await new Promise(m=>setTimeout(m,300)),u.value=b,await Ce(),r.value&&r.value.updateActiveName();const s=300;await new Promise(m=>setTimeout(m,s)),z.value=!1,await g()}};return a.$subscribe((b,s)=>{k()}),ne(()=>{k()}),(b,s)=>{const m=Ut,v=Dt,y=$a,p=Va,c=ye;return $(),Y(Q,null,[A("div",Cl,[t(p,{modelValue:l.value,"onUpdate:modelValue":s[0]||(s[0]=C=>l.value=C),theme:"light",class:"sh-menu-container"},{default:n(()=>[t(ia,{name:"move-left"},{default:n(()=>[($(!0),Y(Q,null,_e(u.value,(C,D)=>($(),Y(Q,{key:D},[de(zn)(C)?($(),G(y,{key:0,title:C.title},{default:n(()=>[($(!0),Y(Q,null,_e(C.children,(P,f)=>($(),G(v,{key:P.name,value:P.name,to:P.to},ut({default:n(()=>[x(" "+q(P.title),1)]),_:2},[P.icon?{name:"icon",fn:n(()=>[t(m,{name:P.icon,class:it(P.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))),128))]),_:2},1032,["title"])):($(),G(v,{key:C.name,value:C.name,to:C.to},ut({default:n(()=>[x(" "+q(C.title),1)]),_:2},[C.icon?{name:"icon",fn:n(()=>[t(m,{name:C.icon,class:it(C.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),t(c,{size:"small",loading:o.value,"show-overlay":!0,attach:"#menu-container",class:"sh-sidebar-loading",style:{"align-items":"flex-start","padding-top":"100px"}},null,8,["loading"])],64)}}}),Il=ae(Pl,[["__scopeId","data-v-96e2d89f"]]),Tl={};function xl(e,a){return null}const jl=ae(Tl,[["render",xl]]),Ll={class:"footer"},zl={class:"footer-left"},Vl={class:"foot-time"},$l={class:"footer-center"},Dl={href:"https://beiancx.miit.gov.cn/",target:"_blank"},Ul={class:"footer-right"},Rl={class:"foot-text"},Al={href:"https://github.com/hpu-developer/DiDaOJ-web",target:"_blank"},El={class:"foot-text"},ql={href:"https://github.com/hpu-developer/DiDaOJ-go",target:"_blank"},Kl=ee({__name:"FooterContent",setup(e){const a=d("");function o(){a.value=new Date().toLocaleString()}return ne(()=>{o(),setInterval(()=>{o()},1e3)}),(r,l)=>{const u=F;return $(),Y("div",Ll,[A("div",zl,[A("p",Vl,q(a.value),1)]),A("div",$l,[A("a",Dl,[t(u,{theme:"default",variant:"outline",ghost:!0},{default:n(()=>l[0]||(l[0]=[x("豫ICP备15024677号-4")])),_:1})])]),A("div",Ul,[A("p",Rl,[A("a",Al,[t(u,{theme:"default",variant:"outline",ghost:!0},{default:n(()=>l[1]||(l[1]=[x("@didaoj-web")])),_:1})])]),A("p",El,[A("a",ql,[t(u,{theme:"default",variant:"outline",ghost:!0},{default:n(()=>l[2]||(l[2]=[x("@didaoj-go")])),_:1})])])])])}}}),Ml=ae(Kl,[["__scopeId","data-v-979fed79"]]),Qe=20,st=100,rt=50,Fl=ee({__name:"ForceHiddenSidebarButton",setup(e){let a=nt();const o=d({x:window.innerWidth-st-Qe,y:window.innerHeight-rt-Qe}),r=d(window.innerWidth),l=d(window.innerHeight);let u=!1,h={x:0,y:0};const z=C=>{u=!0;const D=C.clientX??C.touches[0].clientX,P=C.clientY??C.touches[0].clientY;h={x:D-o.value.x,y:P-o.value.y},document.addEventListener("mousemove",k),document.addEventListener("touchmove",k),document.addEventListener("mouseup",g),document.addEventListener("touchend",g)},k=C=>{if(!u)return;const D=C.clientX??C.touches[0].clientX,P=C.clientY??C.touches[0].clientY;let f=D-h.x,V=P-h.y;f=Math.max(0,Math.min(f,r.value-st)),V=Math.max(0,Math.min(V,l.value-rt)),o.value={x:f,y:V}},g=()=>{u=!1,document.removeEventListener("mousemove",k),document.removeEventListener("touchmove",k),document.removeEventListener("mouseup",g),document.removeEventListener("touchend",g)},b=()=>{r.value=window.innerWidth,l.value=window.innerHeight,o.value={x:Math.min(o.value.x,r.value-st-Qe),y:Math.min(o.value.y,l.value-rt-Qe)}};let s=d(a.forceHiddenSidebar),m=d(a.forceHiddenSidebar);const v=()=>{s.value=!s.value,a.setForceHiddenSidebar(s.value)},y=()=>{m.value||(m.value=!0,a.setForceHiddenSidebar(s.value))},p=()=>{m.value&&(m.value=!1,a.setForceHiddenSidebar(!1))},c=C=>{C>=800?p():y()};return c(r.value),Te(r,C=>{c(C)}),ne(()=>{window.addEventListener("resize",b)}),we(()=>{window.removeEventListener("resize",b)}),(C,D)=>{const P=F;return de(m)?($(),G(P,{key:0,class:"draggable-button",style:xt({top:`${o.value.y}px`,left:`${o.value.x}px`}),onMousedown:z,onTouchstart:z,variant:"dashed",theme:"primary",onClick:v},{default:n(()=>[x(q(de(s)?"显示":"隐藏"),1)]),_:1},8,["style"])):ce("",!0)}}}),Gl=ae(Fl,[["__scopeId","data-v-1aee5506"]]),et="DidaOJ",Nl=ee({__name:"App",setup(e){const{globalProperties:a}=ue(),o=Qt(),r=ke(),l=Re(),u=nt();o.$patch({Loaded:!1});const h=r.getToken,z=d(!1),k=d(!1);l.title&&l.title.length>0?document.title=l.title+" - "+et:document.title=et,l.$subscribe((m,v)=>{v.title&&v.title.length>0?document.title=v.title+" - "+et:document.title=et}),u.$subscribe((m,v)=>{z.value=v.showSidebar,k.value=z.value&&!v.forceHiddenSidebar});const g=pe(),b=Ae(()=>{const m=g.meta.auths;return m?!r.hasAllAuths(m):!1});function s(){a.$message.warning({duration:3e3,content:"登陆状态失效"}),o.$patch({Loaded:!0}),r.clear()}return ne(()=>{if(h==""){o.$patch({Loaded:!0});return}pn().then(m=>{m.code==0?(r.loadResponse(m.data),o.$patch({Loaded:!0})):(N(a,m.code),o.$patch({Loaded:!0}),r.clear())}).catch(m=>{console.log(m),s()})}),(m,v)=>{const y=Da,p=Ra,c=jt("RouterView"),C=Aa,D=Ua,P=Ea;return $(),Y(Q,null,[t(D,null,{default:n(()=>[t(y,{class:"sh-header"},{default:n(()=>[t(Sl)]),_:1}),t(D,null,{default:n(()=>[t(ca,{name:"slide"},{default:n(()=>[k.value?($(),G(p,{key:0,class:"sh-sidebar"},{default:n(()=>[t(Il)]),_:1})):ce("",!0)]),_:1}),t(D,{class:it(["sh-main-layout",{expanded:!k.value}])},{default:n(()=>[t(jl),t(C,{class:"sh-main-content"},{default:n(()=>[b.value?($(),G(Zt,{key:0})):($(),G(c,{key:1}))]),_:1}),t(Ml)]),_:1},8,["class"])]),_:1})]),_:1}),z.value?($(),G(Gl,{key:0})):ce("",!0),t(P,{container:"body",offset:["24px","80px"],size:"small"})],64)}}}),Ol=ae(Nl,[["__scopeId","data-v-9e122cb4"]]);Ka.registerLanguage("verilog",Ma);const ea=da();ea.use(ma);const Ye=pa(Ol);Ye.use(ea);Ye.use(B);Ye.use(qa);Ye.use(fa);Ye.mount("#app");sn().then(()=>{console.log("Text cache reinitialized")}).catch(e=>{console.error("Text cache reinitialization failed",e)});
