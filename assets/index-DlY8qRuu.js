import{ct as vt,d as ce,a as m,o as pe,cu as E,cv as j,cw as a,e as t,cx as R,cy as q,bE as P,cz as _a,aM as Ha,cA as Ee,cB as le,cC as ee,F as me,cD as xe,cE as Ba,cF as Ja,cG as Se,bS as fe,cH as Wa,cI as Ya,cJ as Xa,b as De,v as pt,cK as Za,cL as Xe,j as Je,w as Ue,a9 as at,bc as Qa,bd as el,cM as tl,cN as al,cO as ll,br as nl,cP as Lt,cQ as ga,cR as ba,cj as ol,cS as sl,cT as rl,cU as il,bX as ul,cV as Qt,cW as Kt,cX as dl,bf as cl,aY as ha,z as ml,cY as pl,cZ as fl,c_ as vl,c$ as $t}from"./node_modules-DzJYoZ3M.js";import{L as Ve,C as be,R as Pe,a as Te,A as xt,S as _l,b as gl,c as bl,d as hl,e as yl,f as nt,T as et,B as O,F as Ae,g as ze,I as Re,D as ot,h as ya,i as he,j as We,k as Ye,l as wl,m as Ke,n as _t,o as gt,P as Ft,O as Nt,p as Ot,q as kl,r as wa,s as Sl,t as Cl,u as ka,v as Sa,w as Tt,x as Il,y as Pl,z as xl,E as Tl,G as Vl,H as Dl,J as jl,M as Ca,K as Ia,N as Ll,Q as $l,U as Ul,V as Al,W as zl,X as Rl,Y as Ml,Z as El,_ as ql,$ as Kl}from"./tdesign-vue-next-VkHX3IOx.js";import{u as _e,S as ge,a as we,b as N,G as He,H as dt,c as Ge,d as Fl,e as Pa,f as Nl,g as Ol,h as Gl,E as Hl,M as Bl,R as Jl}from"./md-editor-v3-WS7rfDbR.js";import{e as ea}from"./monaco-editor-ouHSYV7a.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const b of o)if(b.type==="childList")for(const g of b.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&i(g)}).observe(document,{childList:!0,subtree:!0});function n(o){const b={};return o.integrity&&(b.integrity=o.integrity),o.referrerPolicy&&(b.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?b.credentials="include":o.crossOrigin==="anonymous"?b.credentials="omit":b.credentials="same-origin",b}function i(o){if(o.ep)return;o.ep=!0;const b=n(o);fetch(o.href,b)}})();var Le=(e=>(e.ManageWeb="i-manage-web",e.ManageJudge="i-manage-judge",e.ManageProblem="i-manage-problem",e.ManageProblemDaily="i-manage-problem-daily",e.ManageContest="i-manage-contest",e.ManageCollection="i-manage-collection",e.ManageDiscuss="i-manage-discuss",e))(Le||{});const Wl={"r-admin":["i-manage-web","i-manage-judge","i-manage-problem","i-manage-problem-daily","i-manage-contest","i-manage-collection","i-manage-discuss"]};function Yl(e){if(e==null)return[];const l=[];for(const n of e){const i=Wl[n];i!=null&&l.push(...i)}return[...new Set(l)]}function Xl(e,l){if(e==null||l==null)return!1;const n=Yl(e);for(const i of l)if(!n.includes(i))return!1;return!0}const qe=vt("user",{state:()=>({token:"",userId:-1,username:"",nickname:"",roles:[]}),getters:{getToken(){return this.token},getUserId(){return this.userId},getUsername(){return this.username},getNickname(){return this.nickname}},actions:{clear(){this.$patch({token:"",userId:-1,username:"",nickname:"",roles:[]})},loadResponse(e){this.$patch({token:e.token,userId:e.user_id,username:e.username,nickname:e.nickname,roles:e.roles})},isLogin(){return this.token!=null&&this.token!=""},hasAuth(e){return this.hasAllAuths([e])},hasAllAuths(e){return e?Xl(this.roles,e):!0}},persist:!0}),Ze=vt("webStyle",{state:()=>({title:""}),getters:{getTitle(){return this.title}},actions:{setTitle(e){this.title=e}}}),Vt=vt("sidebarStyle",{state:()=>({showSidebar:!1,forceHiddenSidebar:!1,menuActiveName:"",menuList:[]}),getters:{getMenuList(){return this.menuList}},actions:{setSidebarShow(e){this.showSidebar=e},setForceHiddenSidebar(e){this.forceHiddenSidebar=e},setMenuActiveName(e){this.menuActiveName=e},clearMenuList(){this.menuList=[]},setMenuList(e){this.menuList=e},addMenuList(e){this.menuList.push(e)}}}),Zl={style:{"text-align":"right"}},Ql=ce({__name:"Hitokoto",setup(e){const l=m(!1),n=m(""),i=m(""),o=m(""),b=async()=>{l.value=!0;try{const y=await(await fetch("https://v1.hitokoto.cn")).json();i.value=y.hitokoto,o.value=y.creator,n.value="—— "+y.from}catch(g){i.value="一言获取失败了，但至少您还可以访问本站。",o.value="BoilTask",n.value="DidaOJ",console.error("Error fetching Hitokoto:",g)}finally{l.value=!1}};return pe(()=>{b()}),(g,y)=>{const f=be,s=Ve;return j(),E(s,{loading:l.value},{default:a(()=>[t(f,{title:"一言 © Hitokoto"},{actions:a(()=>[P(" @"+q(o.value),1)]),default:a(()=>[R("div",null,[R("span",null,q(i.value),1),R("p",Zl,q(n.value),1)])]),_:1})]),_:1},8,["loading"])}}}),en="https://oj-api.didapipa.com/",G=_a.create({baseURL:en,timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});G.interceptors.request.use(e=>{const n=qe().getToken;return n&&(e.headers["X-Token"]=n),e},e=>Promise.reject(e));G.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});const Dt=_a.create({timeout:6e4,withCredentials:!1,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});Dt.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function xa(){return Dt({baseURL:"https://r2-oj.didapipa.com",url:"/system/notification.json?"+Date.now(),method:"get"})}function Ta(){return Dt({baseURL:"https://r2-oj.didapipa.com",url:"/system/announcement.json?"+Date.now(),method:"get"})}function tn(){return G({url:"/system/status",method:"get"})}function an(){return G({url:"/system/image/token",method:"get"})}function ln(e,l){return G({url:"/system/notification",method:"post",data:{theme:e,content:l}})}function nn(e,l){return G({url:"/system/announcement",method:"post",data:{title:e,content:l}})}var jt=(e=>(e[e.Unknown=-1]="Unknown",e[e.C=0]="C",e[e.Cpp=1]="Cpp",e[e.Java=2]="Java",e[e.Python=3]="Python",e[e.Pascal=4]="Pascal",e[e.Golang=5]="Golang",e[e.Lua=6]="Lua",e[e.TypeScript=7]="TypeScript",e[e.Max=8]="Max",e))(jt||{});function Gt(){const e=[-1,8];return Object.values(jt).filter(l=>typeof l=="number"&&!e.includes(l)).map(l=>({value:l,label:It(l)}))}function St(e){return e>-1&&e<8}function It(e){switch(e){case 0:return"C";case 1:return"C++";case 2:return"Java";case 3:return"Python";case 4:return"Pascal";case 5:return"Golang";case 6:return"Lua";case 7:return"TypeScript";default:return"未知"}}function Ht(e){switch(e){case 0:return"c";case 1:return"cpp";case 2:return"java";case 3:return"python";case 4:return"pascal";case 5:return"go";case 6:return"lua";case 7:return"typescript";default:return"text"}}var Be=(e=>(e[e.Init=0]="Init",e[e.Rejudge=1]="Rejudge",e[e.Submitting=2]="Submitting",e[e.Queuing=3]="Queuing",e[e.Compiling=4]="Compiling",e[e.Running=5]="Running",e[e.Accept=6]="Accept",e[e.PE=7]="PE",e[e.WA=8]="WA",e[e.TLE=9]="TLE",e[e.MLE=10]="MLE",e[e.OLE=11]="OLE",e[e.RE=12]="RE",e[e.CE=13]="CE",e[e.CLE=14]="CLE",e[e.JudgeFail=15]="JudgeFail",e[e.SubmitFail=16]="SubmitFail",e[e.Unknown=17]="Unknown",e[e.Max=18]="Max",e))(Be||{});const on=e=>{switch(e){case 0:return"普通评测";case 1:return"特殊评测";default:return"未知"}},Pt=e=>{switch(e){case 0:return"等待处理";case 1:return"重新评测";case 2:return"提交中";case 3:return"队列中";case 4:return"编译中";case 5:return"运行中";case 6:return"通过";case 7:return"格式错误";case 8:return"答案错误";case 9:return"超时";case 10:return"内存超限";case 11:return"输出超限";case 12:return"运行错误";case 13:return"编译错误";case 14:return"编译超限";case 15:return"评测失败";case 16:return"提交失败";case 17:return"未知";default:return e}},ta=e=>{if(e!==void 0)switch(e){case 0:return"已经提交到系统，请耐心等待评测结果";case 1:return"管理员发起了重新评测，请耐心等待评测结果";case 2:return"判题机已经接受了本次提交，正在提交到远程判官中";case 3:return"判题机已经接受了本次提交，正在排队等待评测";case 4:return"判题机正在编译您的代码，部分语言会在此步检查是否符合语法";case 5:return"您的代码正在运行，请等待运行结果";case 6:return"您的代码通过了测试用例，恭喜您！";case 7:return"您的代码基本正确，但可能存在空格、空行等格式错误，请认真对比输出要求";case 8:return"您的答案与标准答案存在区别，请继续思考有无未考虑的情况";case 9:return"运行您的代码所用的时间超过了题目限制，请思考时间上更优的解法";case 10:return"运行您的代码所用的内存超过了题目限制，请思考空间上更优的解法";case 11:return"您程序的输出内容远远多于了题目要求（一般是数倍于正确输出），请检查相关逻辑";case 12:return"在运行您程序的过程中发生了异常，可能是除零、数组越界等问题，请检查相关逻辑";case 13:return"您的代码在编译阶段发生了错误，可能是语法错误或其他编译问题，请检查相关逻辑";case 14:return"在编译您代码的过程中，所占用的资源远远超过了要求，请检查相关逻辑";case 15:return"评测过程中发生了异常，一般是判题机或远程判官的问题，可尝试联系管理员处理";case 16:return"在将您的代码提交到远程判官的过程中发生了错误，一般是判题机或远程判官的问题，可联系管理员处理";case 17:return"您的代码状态未知，有可能是您不具有权限，或者该代码状态被隐藏"}return"暂时无提示信息"},Va=e=>{switch(e){case 0:case 1:case 2:case 3:case 4:case 5:case 17:return"default";case 6:return"success";case 7:return"warning";default:return"danger"}};function Da(){const e=[17,18];return Object.values(Be).filter(l=>typeof l=="number"&&!e.includes(l)).map(l=>({value:l,label:Pt(l)}))}function Ct(e){return e>=0&&e<17}function ut(e){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return!0;default:return!1}}function ja(e){var n;const l={};if(l.id=e.id,l.problemId=e.problem_id,l.contestProblemIndex=e.contest_problem_index,l.status=e.status,ut(e.status)||!Ct(e.status)?l.score="-":l.score=(e.score/10).toString(),e.time?l.time=Math.ceil(e.time/1e6)+"ms":l.time="-",e.memory?l.memory=(e.memory/1024/1024).toFixed(2)+"MB":l.memory="-",l.language=e.language,l.codeLength=e.code_length,e.approve_time?l.approveTime=new Date(e.approve_time).toLocaleString():l.approveTime="-",l.author=e.author,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.code=e.code,l.compileMessage=e.compile_message,l.taskCurrent=e.task_current,l.taskTotal=e.task_total,l.task=[],e.task)for(let i=0;i<((n=e.task)==null?void 0:n.length);i++){const o=e.task[i],b={};b.taskId=o.task_id,b.status=o.status,o.time?b.time=Math.ceil(o.time/1e6)+"ms":b.time="-",o.memory?b.memory=(o.memory/1024/1024).toFixed(2)+"MB":b.memory="-",o.score?b.score=(o.score/10).toString():b.score="-",b.content=o.content,b.waHint=o.wa_hint,l.task.push(b)}return e.judger&&(l.judger=e.judger),e.judger_name?l.judgerName=e.judger_name:l.judgerName="-",e.judge_time&&(l.judgeTime=new Date(e.judge_time).toLocaleString()),l}function sn(e,l,n,i,o){return G({url:"/judge/approve",method:"post",data:{problem_id:e,contest_id:l,problem_index:n,language:i,code:o}})}function rn(e,l){let n={id:e};return l&&(n.contest_id=l),G({url:"/judge?"+new URLSearchParams(n).toString(),method:"get"})}function un(e){return G({url:"/judge/code?id="+e,method:"get"})}function dn(e,l,n,i,o,b,g){let y={problem_id:l,username:n,language:String(i),status:String(o),page:String(b),page_size:String(g)};return e&&(y.contest_id=String(e)),G({url:`/judge/list?${new URLSearchParams(y).toString()}`,method:"get"})}function cn(){return G({url:"/judge/statics/recently",method:"get"})}function mn(){return G({url:"/judge/rejudge/recently",method:"post"})}function pn(e,l,n){const i={};return e!=null&&(i.problem_id=e),l!=null?i.language=l:i.language=jt.Unknown,n!=null?i.status=n:i.status=18,G({url:"/judge/rejudge/search",method:"post",data:i})}function fn(){return G({url:"/judge/rejudge/all",method:"post",timeout:0})}function vn(e){return G({url:"/judge/rejudge",method:"post",data:{id:Number(e)}})}var $e=(e=>(e[e.None=0]="None",e[e.Attempt=1]="Attempt",e[e.Accept=2]="Accept",e))($e||{});function bt(e,l){const n={};if(n.id=e.id,n.author=e.author,n.title=e.title,n.tags=[],e.tags)for(const i of e.tags){const o=l[i];o&&n.tags.push(o)}if(n.private=e.private,n.accept=e.accept,n.attempt=e.attempt,e.description!=null&&(n.description=e.description),e.time_limit!=null&&e.time_limit>=0?n.timeLimit=e.time_limit.toString()+" ms":n.timeLimit="未知",e.memory_limit!=null&&e.memory_limit>=0?n.memoryLimit=(e.memory_limit/1024).toFixed(2)+" MB":n.memoryLimit="未知",e.judge_type!=null&&(n.judgeType=on(e.judge_type)),e.insert_time!=null&&(n.insertTime=new Date(e.insert_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.source!=null){const i=/\[([^\]]+)\]\(([^)]+)\)/,o=e.source.match(i);o?(n.source=o[1],n.sourceUrl=o[2]):(n.source=e.source,n.sourceUrl="")}return e.judge_md5!=null&&(n.judgeMd5=e.judge_md5),e.origin_oj!=null&&(n.originOj=e.origin_oj),e.origin_id!=null&&(n.originId=e.origin_id),e.origin_url!=null&&(n.originUrl=e.origin_url),n}function La(e,l){const n={};if(n.id=e.id,n.problemId=e.problem_id,n.title=e.title,n.tags=[],e.tags)for(const i of e.tags){const o=l[i];o&&n.tags.push(o)}return e.accept?n.accept=e.accept:n.accept=0,e.attempt?n.attempt=e.attempt:n.attempt=0,n.solution=e.solution,n.code=e.code,e.create_time!=null&&(n.createTime=new Date(e.create_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.updater_nickname!=null&&(n.updaterNickname=e.updater_nickname),n}function $a(e,l,n){const i={};return e?i.id=e:(i.contest_id=l,i.problem_index=n),G({url:`/problem?${new URLSearchParams(i).toString()}`,method:"get"})}function Ua(e){return G({url:"/problem/tag/list?max_count="+e,method:"get"})}function _n(e){return G({url:"/problem/judge?id="+e,method:"get"})}function gn(e,l,n,i,o,b){const g={};return e&&(g.oj=e),l&&(g.title=l),n&&(g.tag=n),i!==void 0&&(g.private=i?"1":"0"),o&&(g.page=o),b&&(g.page_size=b),G({url:`/problem/list?${new URLSearchParams(g).toString()}`,method:"get"})}function bn(e){const l={};return e&&(l.problem_id=e),G({url:`/problem/recommend?${new URLSearchParams(l).toString()}`,method:"get"})}function hn(e){return G({url:"/problem/daily?id="+e,method:"get"})}function yn(e){return G({url:"/problem/daily/edit?id="+e,method:"get"})}function wn(){return G({url:"/problem/daily/recently",method:"get"})}function kn(e,l,n,i,o){const b={};return e&&(b.start_date=e),l&&(b.end_date=l),n&&(b.problem_id=n),i&&(b.page=i),o&&(b.page_size=o),G({url:`/problem/daily/list?${new URLSearchParams(b).toString()}`,method:"get"})}function Aa(e){return G({url:"/problem/attempt/status",method:"get",params:{ids:e.join(",")}})}function za(e,l){return G({url:"/problem/crawl",method:"post",data:{oj:e,id:l}})}function Sn(e,l,n,i,o,b,g){return G({url:"/problem/create",method:"post",data:{title:e,time_limit:l,memory_limit:n,source:i,private:o,tags:b,description:g}})}function Cn(e,l,n,i,o,b,g,y){return G({url:"/problem/edit",method:"post",data:{id:e,title:l,time_limit:n,memory_limit:i,source:o,private:b,tags:g,description:y}})}function In(e,l,n,i){return G({url:"/problem/daily/create",method:"post",data:{id:e,problem_id:l,solution:n,code:i}})}function Pn(e,l,n,i){return G({url:"/problem/daily/edit",method:"post",data:{id:e,problem_id:l,solution:n,code:i}})}function xn(e,l){return G({url:"/problem/judge/data/download?id="+e+"&key="+l,method:"get"})}function Tn(e){return e||(e=""),G({url:"/problem/image/token?id="+e,method:"get"})}function Vn(e){return e||(e=""),G({url:"/problem/daily/image/token?id="+e,method:"get"})}function Dn(e,l){const n=new FormData;return n.append("id",e),n.append("zip",l),G({url:"/problem/judge/data",method:"post",data:n,headers:{"Content-Type":"multipart/form-data"},timeout:1e3*60*5})}function jn(e){return G({url:"/problem/parse",method:"post",data:{problems:e}})}const Ln={class:"sh-main"},$n={class:"dida-swiper-div"},Un=ce({__name:"HomeView",setup(e){const{globalProperties:l}=_e();let n=-1;const i=m({theme:"info",content:""}),o=m({title:"",content:""}),b=m([]),g=m(!1),y=m(!1),f=m(!1),s=async()=>{i.value=await xa()},U=async()=>{try{const S=await Ta();o.value.title=S.title,o.value.content=S.content}catch{ge(l,"加载公告失败"),o.value={title:"公告加载失败",content:"请刷新页面重新获取"}}},p=async()=>{const S=await cn();if(S.code!==0){ge(l,"加载OJ统计数据失败");return}let h=[];for(const _ of S.data){const v=new Date(_.date),d=`${v.getMonth()+1}-${v.getDate()}`;h.push({Date:d,Type:"Unaccept",Count:_.attempt-_.accept}),h.push({Date:d,Type:"Accept",Count:_.accept})}const w={type:"bar",data:[{id:"barData",values:h}],xField:"Date",yField:"Count",seriesField:"Type",stack:!0,legends:{visible:!0},bar:{state:{hover:{stroke:"#000",lineWidth:1}}},height:300};new Ba(w,{dom:"ojStaticsDiv"}).renderSync()},D=async()=>{b.value=[];const S=await wn();if(S.code!==0){ge(l,"加载每日问题数据失败");return}S.data.list&&S.data.list.length>0&&S.data.list.forEach(h=>{let w="default",u="未尝试";if(S.data.attempt_status){const v=S.data.attempt_status[h.problem_id];if(v)switch(v){case $e.Accept:w="success",u="已解决";break;case $e.Attempt:w="warning",u="待解决";break;default:w="default",u="未尝试"}}const _=`${h.title}`;b.value.push({id:h.id,title:_,problemId:h.problem_id,theme:w,tag:u})})};return pe(async()=>{f.value=!0,g.value=!0,y.value=!0,(async()=>(await s(),n=setInterval(()=>{s()},3e4),await U(),f.value=!1))(),(async()=>(await p(),g.value=!1))(),(async()=>(await D(),y.value=!1))()}),Ha(()=>{clearInterval(n)}),(S,h)=>{const w=xt,u=gl,_=_l,v=Ve,d=Ee("md-preview"),r=be,A=Te,c=nt,I=yl,z=et,k=hl,x=bl,T=Pe;return j(),E(v,{loading:f.value},{default:a(()=>[t(T,null,{default:a(()=>[t(A,{span:8},{default:a(()=>{var V;return[R("div",Ln,[i.value?(j(),E(w,{key:0,class:"dida-notification-div",theme:i.value.theme},{default:a(()=>[P(q(i.value.content),1)]),_:1},8,["theme"])):le("",!0),R("div",$n,[t(_,{class:"dida-swiper"},{default:a(()=>[t(u,null,{default:a(()=>h[1]||(h[1]=[R("a",{href:"http://codeoj.cn",target:"_blank"},[R("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"})],-1)])),_:1}),t(u,null,{default:a(()=>h[2]||(h[2]=[R("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1})]),_:1})]),t(v,{loading:g.value&&!f.value},{default:a(()=>h[3]||(h[3]=[R("div",{id:"ojStaticsDiv",style:{"min-height":"200px"}},null,-1)])),_:1},8,["loading"]),t(r,{title:(V=o.value)==null?void 0:V.title,style:{width:"calc(100% - 100px)",margin:"0 auto"}},{default:a(()=>{var C;return[t(d,{"model-value":(C=o.value)==null?void 0:C.content,previewTheme:"cyanosis"},null,8,["model-value"])]}),_:1},8,["title"])])]}),_:1}),t(A,{span:4},{default:a(()=>[t(r,{style:{margin:"10px"},bordered:!0},{default:a(()=>h[4]||(h[4]=[R("img",{src:"https://api.jysafe.cn/ip/",alt:"Welcome",style:{width:"100%"}},null,-1)])),_:1}),t(Ql,{style:{margin:"10px"}}),t(r,{style:{margin:"10px"},bordered:!0,title:"每日一题"},{actions:a(()=>[t(c,{onClick:h[0]||(h[0]=V=>S.$router.push({name:"problem-daily-list"}))},{default:a(()=>h[5]||(h[5]=[P("查看全部")])),_:1})]),default:a(()=>[t(v,{loading:y.value&&!f.value},{default:a(()=>[t(x,{split:!0,size:"small",style:{"min-height":"200px"}},{default:a(()=>[(j(!0),ee(me,null,xe(b.value,V=>(j(),E(k,{key:V.id},{default:a(()=>[t(I,{style:{width:"100px"}},{description:a(()=>[t(c,{onClick:C=>S.$router.push({name:"problem-daily-detail",params:{dailyId:V.id}})},{default:a(()=>[P(q(V.problemId),1)]),_:2},1032,["onClick"])]),_:2},1024),t(I,{style:{width:"200px"}},{description:a(()=>[t(c,{onClick:C=>S.$router.push({name:"problem-daily-detail",params:{dailyId:V.id}})},{default:a(()=>[P(q(V.title),1)]),_:2},1032,["onClick"])]),_:2},1024),t(I,{style:{width:"135px"},description:V.id},null,8,["description"]),t(I,null,{description:a(()=>[t(z,{theme:V.theme},{default:a(()=>[P(q(V.tag),1)]),_:2},1032,["theme"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["loading"])]),_:1}),t(r,{style:{margin:"10px"},bordered:!0},{header:a(()=>h[6]||(h[6]=[R("b",null,"友情链接",-1)])),default:a(()=>[t(x,null,{default:a(()=>[t(k,null,{default:a(()=>[t(c,{href:"https://oi-wiki.org/",target:"_blank"},{default:a(()=>h[7]||(h[7]=[P("OI Wiki")])),_:1})]),_:1}),t(k,null,{default:a(()=>[t(c,{href:"https://boiltask.com",target:"_blank"},{default:a(()=>h[8]||(h[8]=[P("BoilTask Blog")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])}}}),de=(e,l)=>{const n=e.__vccOpts||e;for(const[i,o]of l)n[i]=o;return n},An=de(Un,[["__scopeId","data-v-09e344ae"]]),zn={},Rn={style:{margin:"20px"}};function Mn(e,l){return j(),ee("div",Rn,l[0]||(l[0]=[Ja('<header data-v-2f5a046e><h1 data-v-2f5a046e>算法设计高级课程方案</h1><p data-v-2f5a046e>分治策略 · 动态规划 · 贪心算法 · 回溯算法</p></header><div class="section" data-v-2f5a046e><h2 data-v-2f5a046e>一、课程核心知识点</h2><div class="two-columns" data-v-2f5a046e><div class="column" data-v-2f5a046e><h3 data-v-2f5a046e>1. 分治策略 (Divide and Conquer)</h3><p data-v-2f5a046e>分治算法是一种将问题分解为若干子问题，递归解决子问题，再合并子问题解得到原问题解的算法策略:cite[1]:cite[4]。</p><ul data-v-2f5a046e><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>基本思想</span>：将大问题分解为k个较小规模的相同子问题</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>关键特征</span>：子问题相互独立且与原问题形式相同</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>典型应用</span>：归并排序、快速排序、大整数乘法</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>复杂度分析</span>：主定理(Master Theorem)的应用</li></ul><h3 data-v-2f5a046e>2. 动态规划 (Dynamic Programming)</h3><p data-v-2f5a046e>动态规划通过保存子问题的解避免重复计算，适用于具有最优子结构和重叠子问题性质的问题:cite[1]:cite[6]。</p><ul data-v-2f5a046e><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>基本思想</span>：记忆化存储，自底向上求解</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>关键特征</span>：最优子结构、重叠子问题、无后效性</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>典型应用</span>：背包问题、最长公共子序列、最短路径</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>设计步骤</span>：定义状态、状态转移方程、边界条件</li></ul></div><div class="column" data-v-2f5a046e><h3 data-v-2f5a046e>3. 贪心算法 (Greedy Algorithm)</h3><p data-v-2f5a046e>贪心算法在每一步做出局部最优选择，希望最终得到全局最优解:cite[1]:cite[5]。</p><ul data-v-2f5a046e><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>基本思想</span>：当前状态下做出最好选择，不回溯</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>关键特征</span>：贪心选择性质、最优子结构</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>典型应用</span>：霍夫曼编码、最小生成树、任务调度</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>局限性</span>：不保证全局最优，需证明正确性</li></ul><h3 data-v-2f5a046e>4. 回溯算法 (Backtracking)</h3><p data-v-2f5a046e>回溯法通过深度优先搜索解空间树，通过剪枝避免无效搜索:cite[1]:cite[7]。</p><ul data-v-2f5a046e><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>基本思想</span>：系统搜索解空间，走不通就回溯</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>关键特征</span>：解空间树、约束函数、限界函数</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>典型应用</span>：八皇后问题、图着色、组合优化</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>优化技巧</span>：剪枝策略、启发式搜索</li></ul></div></div></div><div class="section" data-v-2f5a046e><h2 data-v-2f5a046e>二、专题化案例建设</h2><p data-v-2f5a046e>从各大竞赛平台选取真实案例，将算法理论应用于实际问题解决。</p><div class="case-study" data-v-2f5a046e><h3 data-v-2f5a046e>案例1：电商平台优惠券分配优化（阿里天池）</h3><p data-v-2f5a046e><strong data-v-2f5a046e>适用算法</strong>：动态规划、贪心算法</p><p data-v-2f5a046e><strong data-v-2f5a046e>问题描述</strong>：在预算限制下，如何分配优惠券以最大化平台GMV。</p><p data-v-2f5a046e><strong data-v-2f5a046e>教学要点</strong>：</p><ul data-v-2f5a046e><li data-v-2f5a046e>建立价值-成本模型</li><li data-v-2f5a046e>设计状态转移方程</li><li data-v-2f5a046e>比较贪心策略与动态规划效果</li></ul></div><div class="case-study" data-v-2f5a046e><h3 data-v-2f5a046e>案例2：医疗影像分割（Kaggle）</h3><p data-v-2f5a046e><strong data-v-2f5a046e>适用算法</strong>：分治策略</p><p data-v-2f5a046e><strong data-v-2f5a046e>问题描述</strong>：将大型医疗影像分割处理，提高分析效率。</p><p data-v-2f5a046e><strong data-v-2f5a046e>教学要点</strong>：</p><ul data-v-2f5a046e><li data-v-2f5a046e>图像分块处理策略</li><li data-v-2f5a046e>并行计算与结果合并</li><li data-v-2f5a046e>分治粒度对性能的影响</li></ul></div><div class="case-study" data-v-2f5a046e><h3 data-v-2f5a046e>案例3：网络路由优化（华为开发者大赛）</h3><p data-v-2f5a046e><strong data-v-2f5a046e>适用算法</strong>：回溯算法</p><p data-v-2f5a046e><strong data-v-2f5a046e>问题描述</strong>：在复杂网络拓扑中找到最优数据传输路径。</p><p data-v-2f5a046e><strong data-v-2f5a046e>教学要点</strong>：</p><ul data-v-2f5a046e><li data-v-2f5a046e>解空间树的构建</li><li data-v-2f5a046e>剪枝条件设计</li><li data-v-2f5a046e>回溯与分支限界的比较</li></ul></div><table data-v-2f5a046e><tr data-v-2f5a046e><th data-v-2f5a046e>竞赛平台</th><th data-v-2f5a046e>案例类型</th><th data-v-2f5a046e>适用算法</th><th data-v-2f5a046e>技能培养重点</th></tr><tr data-v-2f5a046e><td data-v-2f5a046e>百度AI Studio</td><td data-v-2f5a046e>自然语言处理</td><td data-v-2f5a046e>动态规划</td><td data-v-2f5a046e>序列对齐、编辑距离</td></tr><tr data-v-2f5a046e><td data-v-2f5a046e>阿里天池</td><td data-v-2f5a046e>推荐系统</td><td data-v-2f5a046e>贪心算法</td><td data-v-2f5a046e>实时决策、局部最优</td></tr><tr data-v-2f5a046e><td data-v-2f5a046e>Kaggle</td><td data-v-2f5a046e>数据挖掘</td><td data-v-2f5a046e>分治策略</td><td data-v-2f5a046e>大数据处理、并行计算</td></tr><tr data-v-2f5a046e><td data-v-2f5a046e>华为云大赛</td><td data-v-2f5a046e>网络优化</td><td data-v-2f5a046e>回溯算法</td><td data-v-2f5a046e>解空间探索、剪枝优化</td></tr></table></div><div class="section" data-v-2f5a046e><h2 data-v-2f5a046e>三、学术训练模块</h2><p data-v-2f5a046e>精选与课程知识点相关的经典学术论文，培养学生学术研究能力。</p><div class="paper-analysis" data-v-2f5a046e><h3 data-v-2f5a046e>论文1：动态规划在生物信息学中的应用</h3><p data-v-2f5a046e><strong data-v-2f5a046e>关联知识点</strong>：动态规划</p><p data-v-2f5a046e><strong data-v-2f5a046e>核心内容</strong>：Smith-Waterman算法在序列比对中的应用</p><p data-v-2f5a046e><strong data-v-2f5a046e>教学安排</strong>：</p><ol data-v-2f5a046e><li data-v-2f5a046e>论文精读：算法设计思想</li><li data-v-2f5a046e>复现实验：实现基础算法</li><li data-v-2f5a046e>性能分析：时间复杂度与空间复杂度</li><li data-v-2f5a046e>改进讨论：可能的优化方向</li></ol></div><div class="paper-analysis" data-v-2f5a046e><h3 data-v-2f5a046e>论文2：贪心算法的近似比证明</h3><p data-v-2f5a046e><strong data-v-2f5a046e>关联知识点</strong>：贪心算法</p><p data-v-2f5a046e><strong data-v-2f5a046e>核心内容</strong>：集合覆盖问题的贪心算法近似比分析</p><p data-v-2f5a046e><strong data-v-2f5a046e>教学安排</strong>：</p><ol data-v-2f5a046e><li data-v-2f5a046e>问题建模：形式化描述集合覆盖</li><li data-v-2f5a046e>算法设计：贪心策略实现</li><li data-v-2f5a046e>理论证明：近似比推导</li><li data-v-2f5a046e>实验验证：与最优解比较</li></ol></div><div class="paper-analysis" data-v-2f5a046e><h3 data-v-2f5a046e>论文3：分治算法的并行化实现</h3><p data-v-2f5a046e><strong data-v-2f5a046e>关联知识点</strong>：分治策略</p><p data-v-2f5a046e><strong data-v-2f5a046e>核心内容</strong>：MapReduce框架下的分治算法设计</p><p data-v-2f5a046e><strong data-v-2f5a046e>教学安排</strong>：</p><ol data-v-2f5a046e><li data-v-2f5a046e>算法分解：任务划分策略</li><li data-v-2f5a046e>并行实现：MapReduce编程</li><li data-v-2f5a046e>性能评估：加速比分析</li><li data-v-2f5a046e>应用讨论：大数据场景适用性</li></ol></div></div><div class="section" data-v-2f5a046e><h2 data-v-2f5a046e>四、分类培养方案</h2><p data-v-2f5a046e>针对专业型硕士和学术型硕士的不同培养目标，设计差异化教学内容。</p><div class="two-columns" data-v-2f5a046e><div class="column learning-path" data-v-2f5a046e><h3 data-v-2f5a046e>专业型硕士培养路径</h3><p data-v-2f5a046e><strong data-v-2f5a046e>培养目标</strong>：算法工程实现能力、实际问题解决能力</p><p data-v-2f5a046e><strong data-v-2f5a046e>教学重点</strong>：</p><ul data-v-2f5a046e><li data-v-2f5a046e>算法实现技巧与优化</li><li data-v-2f5a046e>工业界案例分析</li><li data-v-2f5a046e>性能调优与工程实践</li><li data-v-2f5a046e>团队协作开发</li></ul><p data-v-2f5a046e><strong data-v-2f5a046e>评估方式</strong>：</p><ol data-v-2f5a046e><li data-v-2f5a046e>竞赛项目实战</li><li data-v-2f5a046e>算法优化报告</li><li data-v-2f5a046e>系统性能评测</li></ol></div><div class="column learning-path" data-v-2f5a046e><h3 data-v-2f5a046e>学术型硕士培养路径</h3><p data-v-2f5a046e><strong data-v-2f5a046e>培养目标</strong>：算法理论研究能力、创新思维能力</p><p data-v-2f5a046e><strong data-v-2f5a046e>教学重点</strong>：</p><ul data-v-2f5a046e><li data-v-2f5a046e>算法正确性证明</li><li data-v-2f5a046e>复杂度分析理论</li><li data-v-2f5a046e>前沿论文研读</li><li data-v-2f5a046e>算法改进与创新</li></ul><p data-v-2f5a046e><strong data-v-2f5a046e>评估方式</strong>：</p><ol data-v-2f5a046e><li data-v-2f5a046e>学术论文阅读报告</li><li data-v-2f5a046e>理论证明作业</li><li data-v-2f5a046e>研究性课题论文</li></ol></div></div><table data-v-2f5a046e><tr data-v-2f5a046e><th data-v-2f5a046e>教学环节</th><th data-v-2f5a046e>专业型硕士</th><th data-v-2f5a046e>学术型硕士</th></tr><tr data-v-2f5a046e><td data-v-2f5a046e>案例教学</td><td data-v-2f5a046e>70%课时</td><td data-v-2f5a046e>40%课时</td></tr><tr data-v-2f5a046e><td data-v-2f5a046e>理论证明</td><td data-v-2f5a046e>20%课时</td><td data-v-2f5a046e>50%课时</td></tr><tr data-v-2f5a046e><td data-v-2f5a046e>论文研读</td><td data-v-2f5a046e>10%课时</td><td data-v-2f5a046e>40%课时</td></tr><tr data-v-2f5a046e><td data-v-2f5a046e>实践项目</td><td data-v-2f5a046e>必做</td><td data-v-2f5a046e>选做</td></tr><tr data-v-2f5a046e><td data-v-2f5a046e>研究论文</td><td data-v-2f5a046e>选做</td><td data-v-2f5a046e>必做</td></tr></table></div><div class="section" data-v-2f5a046e><h2 data-v-2f5a046e>五、课程评估与反馈</h2><p data-v-2f5a046e>建立多元化的课程评估体系，持续改进教学质量。</p><h3 data-v-2f5a046e>1. 学生评估方式</h3><ul data-v-2f5a046e><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>平时作业</span>：算法实现与理论证明(30%)</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>期中项目</span>：竞赛案例解决方案(20%)</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>期末考核</span>：综合设计与理论分析(30%)</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>课堂参与</span>：讨论与报告(20%)</li></ul><h3 data-v-2f5a046e>2. 教学反馈机制</h3><ul data-v-2f5a046e><li data-v-2f5a046e>每周在线问卷调查</li><li data-v-2f5a046e>每月师生座谈会</li><li data-v-2f5a046e>课程内容动态调整</li><li data-v-2f5a046e>竞赛成绩追踪分析</li></ul></div>',6)]))}const En=de(zn,[["render",Mn],["__scopeId","data-v-2f5a046e"]]),qn={class:"sh-main"},Kn=ce({__name:"View404",setup(e){let l=Se(),n=m(l.fullPath);return(i,o)=>{const b=O;return j(),ee("div",qn,[R("p",null,q(fe(n)),1),o[2]||(o[2]=R("p",null,"该页面无效或已被迁移，请重新选择访问目标",-1)),t(b,{theme:"primary",onClick:o[0]||(o[0]=()=>i.$router.push("/"))},{default:a(()=>o[1]||(o[1]=[P("返回首页")])),_:1})])}}}),Ra=de(Kn,[["__scopeId","data-v-d4218944"]]);function Fn(e){const l={};return l.id=e.id,l.username=e.username,l.nickname=e.nickname,l.email=e.email,l.slogan=e.slogan,l.organization=e.organization,l.accept=e.accept,l.attempt=e.attempt,l.vjudgeId=e.vjudge_id,e.email&&(l.avatar=`https://www.gravatar.com/avatar/${Wa(e.email.toLowerCase().trim())}?d=identicon&s=100`),l}function Nn(e,l){return G({url:"/user/login",method:"post",data:{username:e,password:l}})}function On(){return G({url:"/user/login/refresh",method:"post"})}function Gn(e){const l={username:e};return G({url:`/user/info?${new URLSearchParams(l).toString()}`,method:"get"})}function Hn(e){const l="https://vjudge.net/user/solveDetail/"+encodeURIComponent(e);return Dt({url:l,method:"get"})}function Bn(e){return G({url:"/user/account/infos",method:"post",data:{users:e}})}function Jn(e){return G({url:"/user/parse",method:"post",data:{users:e}})}function Wn(e,l){return G({url:"/user/register/email",method:"post",data:{token:e,email:l}})}function Yn(e,l,n,i,o){return G({url:"/user/register",method:"post",data:{username:e,password:l,email:n,key:i,nickname:o}})}function Xn(e,l){return G({url:"/user/forget",method:"post",data:{token:e,username:l}})}function Zn(e,l,n){return G({url:"/user/password/modify",method:"post",data:{username:e,password:l,key:n}})}const Qn={class:"dida-login-footer"},eo=ce({__name:"LoginView",setup(e){const{globalProperties:l}=_e(),n=qe(),i=m(!1),o=m({username:"",password:""}),b=()=>{we(l,"重置成功")},g=({validateResult:y,firstError:f})=>{i.value||(i.value=!0,Nn(o.value.username,o.value.password).then(s=>{if(s.code===0){n.loadResponse(s.data),we(l,"登录成功");let U=l.$route.query.redirect_uri;U||(U="/user/"+s.data.username),l.$router.push({path:U})}else N(l,s.code)}).catch(s=>{console.error("Login error",s),ge(l,"登录失败")}).finally(()=>{i.value=!1}))};return pe(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),(y,f)=>{const s=Re,U=ze,p=O,D=Ae,S=nt,h=be;return j(),E(h,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(D,{ref:"form",data:o.value,colon:!0,onReset:b,onSubmit:g,class:"yj-login-form","label-width":0},{default:a(()=>[t(U,{name:"username"},{default:a(()=>[t(s,{modelValue:o.value.username,"onUpdate:modelValue":f[0]||(f[0]=w=>o.value.username=w),clearable:"",autocomplete:"username",placeholder:"请输入用户名"},{"prefix-icon":a(()=>[t(fe(Ya))]),_:1},8,["modelValue"])]),_:1}),t(U,{name:"password"},{default:a(()=>[t(s,{modelValue:o.value.password,"onUpdate:modelValue":f[1]||(f[1]=w=>o.value.password=w),type:"password",autocomplete:"current-password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":a(()=>[t(fe(Xa))]),_:1},8,["modelValue"])]),_:1}),t(U,null,{default:a(()=>[t(p,{theme:"primary",type:"submit",block:"",loading:i.value},{default:a(()=>f[4]||(f[4]=[P("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),R("div",Qn,[t(S,{onClick:f[2]||(f[2]=()=>{fe(l).$router.push({name:"login-forget"})})},{default:a(()=>f[5]||(f[5]=[P("忘记密码 ")])),_:1}),t(S,{onClick:f[3]||(f[3]=()=>{fe(l).$router.push({name:"register"})})},{default:a(()=>f[6]||(f[6]=[P("注册账户 ")])),_:1})])]),_:1})}}}),to=de(eo,[["__scopeId","data-v-0466c42d"]]),ao={class:"dida-login-footer"},lo=ce({__name:"RegisterView",setup(e){const{globalProperties:l}=_e(),n=qe(),i=m(!1),o=m(!1),b=m(!1),g=m("发送验证码");let y=null,f=-1;const s=m(!1),U=m(null),p=m({username:"",password:"",confirmPassword:"",nickname:"",email:"",emailKey:""}),S=m({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:d=>new Promise(r=>{const A=setTimeout(()=>{r(p.value.password===d),clearTimeout(A)})}),message:"两次密码不一致"}],nickname:[{required:!0,message:"请填写昵称"},{min:1,message:"昵称至少1个字符"},{max:30,message:"昵称最多30个字符"}],email:[{required:!0,message:"请填写邮箱"},{pattern:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"邮箱格式不正确"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),h=m(()=>t(O,{onClick:w,disabled:b.value,loading:o.value,style:"width:120px"},{default:()=>[g.value]})),w=async()=>{var c;if(!p.value.email){ge(l,"请输入邮箱");return}if(!p.value.email.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)){ge(l,"邮箱格式不正确");return}if(b.value||o.value)return;s.value=!0,await pt();const d=document.getElementById("cf-confirm-div");d&&d.remove();const r=document.createElement("div");r.id="cf-confirm-div",r.setAttribute("data-theme","light"),(c=U.value)==null||c.appendChild(r);const A=window;A.turnstile.ready(function(){A.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(I){s.value=!1,await u(I)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},u=async d=>{if(!b.value){o.value=!0;try{const r=await Wn(d,p.value.email);if(r.code!==0){N(l,r.code);return}we(l,"发送验证码成功"),o.value=!1,b.value=!0,y=new Date,g.value="60秒后重发",f=setInterval(()=>{const c=Math.floor((new Date().getTime()-(y==null?void 0:y.getTime()))/1e3);c>60?(g.value="发送验证码",b.value=!1,clearInterval(f)):g.value=`${60-c}秒后重发`},1e3)}catch{ge(l,"发送验证码失败")}finally{o.value=!1}}},_=()=>{we(l,"重置成功")},v=({validateResult:d,firstError:r,e:A})=>{if(!i.value){if(A.preventDefault(),d!==!0){ge(l,r);return}if(p.value.password!==p.value.confirmPassword){ge(l,"两次密码不一致");return}i.value=!0,Yn(p.value.username,p.value.password,p.value.email,p.value.emailKey,p.value.nickname).then(c=>{c.code===0?(we(l,"注册成功，可使用账号信息登录"),l.$router.push({name:"login"})):N(l,c.code)}).catch(c=>{console.error("Login error",c),ge(l,"登录失败")}).finally(()=>{i.value=!1})}};return pe(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),De(()=>{clearInterval(f)}),(d,r)=>{const A=Re,c=ze,I=ya,z=O,k=Ae,x=nt,T=be,V=ot;return j(),ee(me,null,[t(T,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(k,{ref:"form",rules:S.value,data:p.value,colon:!0,onReset:_,onSubmit:v,class:"yj-login-form"},{default:a(()=>[t(c,{name:"username",label:"用户名"},{default:a(()=>[t(A,{modelValue:p.value.username,"onUpdate:modelValue":r[0]||(r[0]=C=>p.value.username=C),clearable:"",placeholder:"用于登录与查找"},null,8,["modelValue"])]),_:1}),t(c,{name:"password",label:"密码"},{default:a(()=>[t(A,{modelValue:p.value.password,"onUpdate:modelValue":r[1]||(r[1]=C=>p.value.password=C),type:"password",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(c,{name:"confirmPassword",label:"确认密码"},{default:a(()=>[t(A,{modelValue:p.value.confirmPassword,"onUpdate:modelValue":r[2]||(r[2]=C=>p.value.confirmPassword=C),type:"password",clearable:"",placeholder:"请确认密码"},null,8,["modelValue"])]),_:1}),t(c,{name:"nickname",label:"昵称"},{default:a(()=>[t(A,{modelValue:p.value.nickname,"onUpdate:modelValue":r[3]||(r[3]=C=>p.value.nickname=C),clearable:"",placeholder:"用于优先在网站各处展示"},null,8,["modelValue"])]),_:1}),t(c,{name:"email",label:"邮箱"},{default:a(()=>[t(A,{modelValue:p.value.email,"onUpdate:modelValue":r[4]||(r[4]=C=>p.value.email=C),clearable:"",placeholder:"请填写常用邮箱"},null,8,["modelValue"])]),_:1}),t(c,{name:"emailKey",label:"验证码"},{default:a(()=>[t(I,{append:h.value},{default:a(()=>[t(A,{modelValue:p.value.emailKey,"onUpdate:modelValue":r[5]||(r[5]=C=>p.value.emailKey=C),clearable:"",placeholder:"请输入验证码",style:{width:"140px"}},null,8,["modelValue"])]),_:1},8,["append"])]),_:1}),t(c,null,{default:a(()=>[t(z,{theme:"primary",type:"submit",block:"",loading:i.value},{default:a(()=>r[8]||(r[8]=[P("注册")])),_:1},8,["loading"])]),_:1})]),_:1},8,["rules","data"]),R("div",ao,[t(x,{onClick:r[6]||(r[6]=()=>{fe(l).$router.push({name:"login"})})},{default:a(()=>r[9]||(r[9]=[P("返回登陆 ")])),_:1})])]),_:1}),t(V,{visible:s.value,"onUpdate:visible":r[7]||(r[7]=C=>s.value=C),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:a(()=>[R("div",{ref_key:"dialogContainer",ref:U,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),no=de(lo,[["__scopeId","data-v-d25e7538"]]),oo={key:0,style:{margin:"10px"}},so={key:1,style:{margin:"10px"}},ro={style:{margin:"12px"}},io=ce({__name:"UserView",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze(),o=qe();let b="";const g=m(!1),y=m(null),f=m([]);let s=null;const U=m([]),p=m([]),D=w=>{let u="primary";if(!s)return u;const _=s[w];if(_)switch(_){case $e.Accept:u="success";break;case $e.Attempt:u="warning";break}return u},S=async()=>{if(!o.isLogin())return;s={};const w=await Aa(f.value);w.code===0?s=w.data:N(n,w.code,w.data)},h=async w=>{g.value=!0;try{let u=await Gn(w);if(u.code!==0){g.value=!1,N(n,u.code),await Y.push({name:"home"});return}if(y.value=Fn(u.data.user),f.value=u.data.problems_ac,i.setTitle(y.value.nickname+" - "+i.getTitle),y.value.vjudgeId){const _=await Hn(y.value.vjudgeId);U.value=_.acRecords;for(const v in U.value)U.value[v].sort((d,r)=>d.length===r.length?d.localeCompare(r):d.length-r.length);p.value=_.failRecords;for(const v in p.value)p.value[v].sort((d,r)=>d.length===r.length?d.localeCompare(r):d.length-r.length)}await S()}catch{ge(n,"获取用户信息失败"),await Y.push({name:"home"})}finally{g.value=!1}};return Za(async(w,u,_)=>{if(Array.isArray(w.params.username)?b=w.params.username[0]:b=w.params.username,!b){await Y.push({name:"home"});return}await h(b),_()}),pe(async()=>{if(Array.isArray(l.params.username)?b=l.params.username[0]:b=l.params.username,!b){await Y.push({name:"home"});return}await h(b)}),(w,u)=>{const _=O,v=he,d=be,r=nt,A=Ye,c=We,I=Te,z=wl,k=Pe,x=Ve;return j(),E(x,{loading:g.value},{default:a(()=>[t(k,{class:"dida-main-content"},{default:a(()=>[t(I,{span:8},{default:a(()=>{var T;return[t(d,{style:{margin:"10px"},title:"AC题目"},{default:a(()=>[t(v,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(j(!0),ee(me,null,xe(f.value,V=>(j(),E(_,{key:V,size:"small",theme:D(V),onClick:()=>fe(Y).push({name:"problem-detail",params:{problemId:V}})},{default:a(()=>[P(q(V),1)]),_:2},1032,["theme","onClick"]))),128))]),_:1})]),_:1}),(T=y.value)!=null&&T.vjudgeId?(j(),E(d,{key:0,style:{margin:"10px"},title:"vjudge.net"},{actions:a(()=>{var V;return[t(r,{href:"https://vjudge.net/user/"+((V=y.value)==null?void 0:V.vjudgeId),target:"_blank"},{default:a(()=>{var C;return[P("@"+q((C=y.value)==null?void 0:C.vjudgeId),1)]}),_:1},8,["href"])]}),default:a(()=>[U.value&&Object.keys(U.value).length>0?(j(),ee("div",oo,[u[0]||(u[0]=R("div",{style:{margin:"5px"}},[R("span",null,"AC")],-1)),t(c,{layout:"vertical",bordered:!0},{default:a(()=>[(j(!0),ee(me,null,xe(U.value,(V,C)=>(j(),E(A,{key:C,label:C},{default:a(()=>[t(v,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(j(!0),ee(me,null,xe(V,$=>(j(),E(_,{key:$,size:"small",onClick:()=>fe(Y).push({name:"problem-detail",params:{problemId:C+"-"+$}})},{default:a(()=>[P(q($),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):le("",!0),p.value&&Object.keys(p.value).length>0?(j(),ee("div",so,[u[1]||(u[1]=R("div",{style:{margin:"5px"}},[R("span",null,"Fail")],-1)),t(c,{layout:"vertical",bordered:!0},{default:a(()=>[(j(!0),ee(me,null,xe(p.value,(V,C)=>(j(),E(A,{key:C,label:C},{default:a(()=>[t(v,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(j(!0),ee(me,null,xe(V,$=>(j(),E(_,{key:$,size:"small",onClick:()=>fe(Y).push({name:"problem-detail",params:{problemId:C+"-"+$}})},{default:a(()=>[P(q($),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):le("",!0)]),_:1})):le("",!0)]}),_:1}),t(I,{span:4},{default:a(()=>[R("div",ro,[t(c,{layout:"vertical",bordered:!0},{default:a(()=>[t(A,{label:"头像"},{default:a(()=>{var T;return[t(z,{shape:"round",size:"100px",image:(T=y.value)==null?void 0:T.avatar,"hide-on-load-failed":!1},null,8,["image"])]}),_:1}),t(A,{label:"昵称"},{default:a(()=>{var T;return[P(q((T=y.value)==null?void 0:T.nickname),1)]}),_:1}),t(A,{label:"Slogan"},{default:a(()=>{var T;return[P(q((T=y.value)==null?void 0:T.slogan),1)]}),_:1}),t(A,{label:"邮箱"},{default:a(()=>{var T;return[P(q((T=y.value)==null?void 0:T.email),1)]}),_:1}),t(A,{label:"组织"},{default:a(()=>{var T;return[P(q((T=y.value)==null?void 0:T.organization),1)]}),_:1}),t(A,{label:"通过数量"},{default:a(()=>{var T;return[P(q((T=y.value)==null?void 0:T.accept),1)]}),_:1}),t(A,{label:"提交数量"},{default:a(()=>{var T;return[P(q((T=y.value)==null?void 0:T.attempt),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),uo=de(io,[["__scopeId","data-v-6db39d03"]]),Bt=[{name:"home",path:"/",title:"首页",showSidebar:!1,disableGenerateTab:!0,component:An},{name:"problem",path:"/problem",title:"题目",icon:"calculation",showSidebar:!0,redirect:"problem-list"},{name:"collection-detail-tab",title:"题集",path:"/collection",showSidebar:!0,disableGenerateTab:!0,redirect:"problem-collection-list"},{name:"judge",path:"/judge",title:"评测",icon:"code",showSidebar:!0,redirect:"judge-list"},{name:"contest",path:"/contest",title:"比赛",icon:"application",showSidebar:!0,redirect:"contest-list"},{name:"contest-detail-tab",title:"比赛",path:"/contest",showSidebar:!0,disableGenerateTab:!0,redirect:"contest-list"},{name:"discuss",title:"讨论",path:"/discuss",icon:"sonic",showSidebar:!0,redirect:"discuss-list"},{name:"discuss-detail-tab",title:"讨论",path:"/discuss",showSidebar:!0,disableGenerateTab:!0,redirect:"discuss-list"},{name:"rank",path:"/rank",title:"排名",icon:"chart-column",showSidebar:!0,redirect:"rank-ac-all"},{name:"study",path:"/study",title:"研习",icon:"book-open",showSidebar:!1,component:En},{name:"system",path:"/system",title:"系统",icon:"dashboard",showSidebar:!0,redirect:"system-status"},{name:"manage",path:"/manage",title:"管理",icon:"command",showSidebar:!0,redirect:"manage-web",auths:[Le.ManageWeb]},{name:"login",path:"/login",title:"登陆",showSidebar:!1,disableGenerateTab:!0,component:to},{name:"register",path:"/register",title:"注册",showSidebar:!1,disableGenerateTab:!0,component:no},{name:"user",path:"/user/:username+",title:"用户",showSidebar:!1,disableGenerateTab:!0,component:uo},{name:"404",path:"/404",title:"404",showSidebar:!1,disableGenerateTab:!0,component:Ra}],co=e=>Bt.find(l=>l.name==e),mo=e=>{const l=[];return Bt.forEach(n=>{!n.disableGenerateTab&&e.hasAllAuths(n.auths)&&l.push(n)}),l},po=e=>{Bt.forEach(l=>{const n={name:l.name,path:l.path,meta:{title:l.title,tab:l.name,showSidebar:l.showSidebar,needLogin:l.needLogin,redirect:l.redirect,tabAuths:l.auths},component:l.component};e.push(n)})};function Ma(e){return e.children!==void 0}function fo(e){return e.children!==void 0}const vo={style:{margin:"10px"}},_o={key:0,class:"dida-operation-container"};function go(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!at(e)}const bo=ce({__name:"ProblemList",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e(),o=qe();let b=null;const g=m(!1),y={};let f={};const s=m(!1),U=Je(()=>o.hasAuth(Le.ManageProblem)),p=m([{title:"ID",colKey:"id",cell:($,L)=>{let M=c(L.row.id);return t(O,{variant:"dashed",theme:M,onClick:()=>A(L.row.id)},{default:()=>[L.row.id]})}},{title:"标题",colKey:"title",cell:($,L)=>t(O,{variant:"text",onClick:()=>A(L.row.id)},{default:()=>[L.row.title]})},{title:"标签",colKey:"tags",cell:($,L)=>{const M=L.row.tags;if(!M||M.length===0)return"";let F=[];for(let te=0;te<M.length;te++){const X=M[te];F.push(t(O,{key:te,theme:"default",variant:"outline",size:"small",onClick:()=>x(X)},{default:()=>[X.name]}))}return t(he,null,go(F)?F:{default:()=>[F]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),D=m(!1);let S=1,h=50;const w=m({current:S,pageSize:h,defaultCurrent:S,defaultPageSize:h,total:0,pageSizeOptions:[50,100]}),u=m(),_=m(),v=[{label:"DidaOJ",value:"didaoj"},{label:"HDU",value:"hdu"},{label:"POJ",value:"poj"},{label:"NYOJ",value:"nyoj"}],d=m({oj:"",title:"",tag:"",private:!1}),r=m({oj:"",problem:""}),A=$=>{$&&n.push({path:"/problem/"+$})},c=$=>{if(!$||!f)return"default";const L=f[$];if(!L)return"default";switch(L){case $e.Accept:return"success";case $e.Attempt:return"warning";default:return"default"}},I=async()=>{await n.push({query:{...l.query,oj:d.value.oj,title:d.value.title,tag:d.value.tag,private:d.value.private?"1":"0",page:1,page_size:w.value.defaultPageSize}})},z=async()=>{d.value.oj="",d.value.title="",d.value.tag="",d.value.private=!1,await n.push({query:{...l.query,oj:"",title:"",tag:"",private:"0",page:1,page_size:w.value.defaultPageSize}})},k=async()=>{try{s.value=!0;const $=await za(r.value.oj,r.value.problem);$.code===0?(we(i,"搜索成功"),await n.push({name:"problem-detail",params:{problemId:$.data}})):N(i,$.code)}catch($){console.error($),N(i,He())}finally{s.value=!1}},x=$=>{$&&n.push({query:{...l.query,title:"",tag:$.name,page:1,page_size:w.value.defaultPageSize}})},T=()=>{n.push({name:"manage-problem-create"})},V=async($,L)=>{D.value=!0;try{const{current:M,pageSize:F}=$,te=await gn(d.value.oj,d.value.title,d.value.tag,d.value.private,M,F);if(u.value=[],te.code===0){const X=te.data.list;if(!X||X.length<=0){w.value={...w.value,total:0},f={},we(i,"未找到记录");return}X.forEach(ae=>{var B;const Q=bt(ae,y);(B=u.value)==null||B.push(Q)}),w.value={...w.value,total:te.data.total_count},f=te.data.problem_attempt_status}else L&&N(i,te.code)}catch(M){console.error(M),N(i,He())}finally{D.value=!1}},C=async $=>{await n.push({query:{...l.query,page:$.current,page_size:$.pageSize}})};return pe(async()=>{D.value=!0,_.value=[],Ua(-1).then($=>{if($.code===0){_.value=$.data.list,g.value=$.data.total_count>$.data.list.length;for(let L=0;L<$.data.list.length;L++){const M=$.data.list[L];y[M.id]=M}b=Ue(()=>l.query,L=>{d.value.oj=L.oj||"",d.value.title=L.title||"",d.value.tag=L.tag||"",d.value.private=L.private==="1";const M=parseInt(L.page)||w.value.defaultCurrent,F=parseInt(L.page_size)||w.value.defaultPageSize;S=M,h=F,w.value={...w.value,current:S,pageSize:h},V({current:S,pageSize:h},!0)},{immediate:!0})}else g.value=!0}).catch($=>{console.error($),g.value=!0})}),De(()=>{b&&b()}),($,L)=>{const M=Ke,F=be,te=Te,X=O,ae=he,Q=_t,B=ze,ie=Re,ue=gt,ye=Ae,W=Pe;return j(),E(W,null,{default:a(()=>[t(te,{span:9},{default:a(()=>[t(F,{style:{margin:"10px"}},{default:a(()=>[t(M,{data:u.value,columns:p.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:w.value,"table-layout":"auto",loading:D.value,onPageChange:C},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(te,{span:3},{default:a(()=>[R("div",vo,[U.value?(j(),ee("div",_o,[t(ae,null,{default:a(()=>[t(X,{onClick:T},{default:a(()=>L[7]||(L[7]=[P("新建")])),_:1})]),_:1})])):le("",!0),t(F,{class:"sh-card"},{default:a(()=>[t(ye,{model:d.value,onSubmit:I,onReset:z},{default:a(()=>[t(B,{label:"OJ"},{default:a(()=>[t(Q,{modelValue:d.value.oj,"onUpdate:modelValue":L[0]||(L[0]=K=>d.value.oj=K),options:v,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(B,{label:"标题"},{default:a(()=>[t(ie,{modelValue:d.value.title,"onUpdate:modelValue":L[1]||(L[1]=K=>d.value.title=K),placeholder:"请输入关键词"},null,8,["modelValue"])]),_:1}),t(B,{label:"标签"},{default:a(()=>[t(ie,{modelValue:d.value.tag,"onUpdate:modelValue":L[2]||(L[2]=K=>d.value.tag=K),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),U.value?(j(),E(B,{key:0,label:"私有"},{default:a(()=>[t(ue,{modelValue:d.value.private,"onUpdate:modelValue":L[3]||(L[3]=K=>d.value.private=K)},null,8,["modelValue"])]),_:1})):le("",!0),t(B,null,{default:a(()=>[t(ae,null,{default:a(()=>[t(X,{theme:"primary",type:"submit"},{default:a(()=>L[8]||(L[8]=[P("搜索")])),_:1}),t(X,{theme:"danger",type:"reset"},{default:a(()=>L[9]||(L[9]=[P("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(F,{class:"sh-card"},{default:a(()=>[t(ye,{model:r.value,onSubmit:k},{default:a(()=>[t(B,{label:"OJ"},{default:a(()=>[t(Q,{modelValue:r.value.oj,"onUpdate:modelValue":L[4]||(L[4]=K=>r.value.oj=K),options:v,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(B,{label:"题目"},{default:a(()=>[t(ie,{modelValue:r.value.problem,"onUpdate:modelValue":L[5]||(L[5]=K=>r.value.problem=K),placeholder:"请输入原始题号"},null,8,["modelValue"])]),_:1}),t(B,null,{default:a(()=>[t(X,{theme:"primary",type:"submit",loading:s.value},{default:a(()=>L[10]||(L[10]=[P("前往")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),t(F,{class:"sh-card sh-background-black"},{default:a(()=>[(j(!0),ee(me,null,xe(_.value,K=>(j(),E(X,{class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:()=>x(K)},{default:a(()=>[P(q(K.name),1)]),_:2},1032,["onClick"]))),256)),g.value?(j(),E(X,{key:0,class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:L[6]||(L[6]=()=>$.$router.push("/problem/tags"))},{default:a(()=>L[11]||(L[11]=[P(" ... ")])),_:1})):le("",!0)]),_:1})])]),_:1})]),_:1})}}}),ho=de(bo,[["__scopeId","data-v-dbe06f89"]]);function tt(e){let l="";for(;e>0;)e--,l=String.fromCharCode(65+e%26)+l,e=Math.floor(e/26);return l}function Jt(e){const l={};if(l.id=e.id,l.ownerId=e.owner_id,l.ownerUsername=e.owner_username,l.ownerNickname=e.owner_nickname,l.title=e.title,l.startTime=new Date(e.start_time).toLocaleString(),l.endTime=new Date(e.end_time).toLocaleString(),l.createTime=new Date(e.create_time).toLocaleString(),l.updateTime=new Date(e.update_time).toLocaleString(),l.private=e.private,l.description=e.description,l.notification=e.notification,e.problems){l.problems=[],e.problems.sort((n,i)=>n.index-i.index);for(let n=0;n<e.problems.length;n++){const i=e.problems[n];let o={accept:0,attempt:0,author:"",id:"",private:!1,tags:[],title:""};o.index=i.index,o.id=tt(i.index),o.title=i.title,i.accept?o.accept=i.accept:o.accept=0,i.attempt?o.attempt=i.attempt:o.attempt=0,l.problems.push(o)}}return l}function yo(e){return G({url:"/contest?id="+e,method:"get"})}function wo(e){return G({url:"/contest/edit?id="+e,method:"get"})}function ko(e){return G({url:"/contest/problem/list?id="+e,method:"get"})}function So(e){return e||(e=0),G({url:"/contest/image/token?id="+e,method:"get"})}function Co(e,l){return G({url:"/contest/problem?id="+e+"&problem_index="+l,method:"get"})}function Io(e,l,n,i){const o={};return e&&(o.title=e),l&&(o.username=l),n&&(o.page=String(n)),i&&(o.page_size=String(i)),G({url:`/contest/list?${new URLSearchParams(o).toString()}`,method:"get"})}function Po(e){return G({url:"/contest/rank?id="+e,method:"get"})}function xo(e){return G({url:"/contest/create",method:"post",data:e})}function To(e){return G({url:"/contest/edit",method:"post",data:e})}function Vo(e,l){return G({url:"/contest/password",method:"post",data:{id:e,password:l}})}function Do(e){return G({url:"/contest/dolos",method:"post",data:{id:e}})}const Wt=async(e,l)=>{l&&await e.push({name:"user",params:{username:l}})},aa=e=>{const l=Y.resolve({name:"problem-detail",params:{problemId:e}});window.open(l.href,"_blank")},ft=async(e,l)=>{await Y.push({name:"contest-problem-detail",params:{contestId:e,problemIndex:l}})},jo={class:"sh-button"},Lo={style:{"margin-top":"16px"}},$o={__name:"SecretPanel",setup(e){const l=m(!1);return(n,i)=>{const o=O;return j(),ee("div",al(ll(n.$attrs)),[R("div",jo,[t(o,{onClick:i[0]||(i[0]=b=>l.value=!l.value)},{default:a(()=>[P(q(l.value?"收起":"展开"),1)]),_:1})]),Qa(R("div",Lo,[tl(n.$slots,"default",{},void 0)],512),[[el,l.value]])],16)}}},la=de($o,[["__scopeId","data-v-83e9f414"]]),Uo={key:1,style:{"text-align":"center"}},Ao={key:1,style:{"text-align":"center"}},zo={key:0,class:"dida-problems-container"},Ro={style:{margin:"12px"}},Mo={key:1},Eo={class:"dida-operation-container"},qo={key:0,class:"dida-operation-container"},Ko={class:"dida-code-submit-div"},Fo={class:"dida-code-editor-div"},No=ce({__name:"ProblemDetail",setup(e){let l=Se();const{globalProperties:n}=_e();let i=null;const o=Ze(),b=qe();let g=m(""),y="",f="",s=0,U=m(0);const p=m(!1),D=m(!1),S=m(!1),h=m(null);let w=null;const u=m(null),_=m(!1),v=m(!1),d={},r=m(""),A=m([]);A.value=Gt();const c=m([]),I=m(null),z=m(-1),k=m(-1),x=m(""),T=m("");let V=0;const C=Je(()=>b.hasAuth(Le.ManageProblem)),$=Je(()=>b.hasAuth(Le.ManageProblemDaily)),L=()=>{I.value&&clearInterval(I.value),I.value=setInterval(()=>{const Z=z.value<=0,J=new Date(new Date().getTime()+V),oe=J.getHours()*60*60+J.getMinutes()*60+J.getSeconds(),ne=18*60*60;oe<ne?z.value=ne-oe:z.value=-1,k.value=24*60*60-oe,(!Z&&z.value<=0||k.value<=0)&&K()},1e3)},M=()=>{I.value&&(clearInterval(I.value),I.value=null)},F=Z=>{Z&&Y.push({name:"problem-list",query:{...l.query,title:"",tag:Z.name}})},te=async()=>{if(!f){ge(n,"每日问题ID无效");return}await Y.push({name:"manage-problem-daily",params:{dailyId:f}})},X=async()=>{let Z=y;if(!Z)try{const J=await Co(s,U.value);J.code===0?Z=J.data:N(n,J.code)}catch{ge(n,"获取题目ID失败，请稍后再试");return}await Y.push({name:"manage-problem",params:{problemId:Z}})},ae=()=>{y?Y.push({name:"judge-list",query:{problem_id:y}}):Y.push({name:"contest-judge",params:{contestId:s},query:{problem_id:tt(U.value)}})},Q=()=>{y?Y.push({name:"discuss-list-problem",query:{problem_id:y}}):Y.push({name:"contest-discuss",params:{contestId:s},query:{problem_id:tt(U.value)}})},B=()=>{Y.push({name:"problem-recommend",params:{problemId:y}})},ie=async()=>{var oe,ne;const Z=(oe=h.value)==null?void 0:oe.originOj,J=(ne=h.value)==null?void 0:ne.originId;if(!(!Z||!J))try{_.value=!0;const Ie=await za(Z,J);Ie.code===0?(await W(),we(n,"更新成功")):N(n,Ie.code)}catch{ge(n,"更新失败，请稍后再试")}finally{_.value=!1}},ue=async()=>{const Z=parseInt(r.value);if(!St(Z)){ge(n,"请选择所编写的语言");return}const J=w==null?void 0:w.getValue();if(!J){ge(n,"请输入所需提交的代码");return}if(!y&&(!s||!U.value)){ge(n,"问题ID无效");return}v.value=!0;try{const oe=await sn(y,s,U.value,Z,J);if(oe.code!==0){N(n,oe.code);return}we(n,"提交成功，正在跳转到详情页面");const ne=oe.data.id;s?await Y.push({name:"contest-judge-detail",params:{contestId:s,judgeId:ne}}):await Y.push({name:"judge-detail",params:{judgeId:ne}})}finally{v.value=!1}},ye=Z=>{if(!w)return;const J=w.getModel();J&&ea.setModelLanguage(J,Ht(Z))},W=async()=>{c.value=[];let Z=await $a(y,s,U.value);if(Z.code!==0){S.value=!1,N(n,Z.code),await Y.push({name:"problem"});return}Z.data.tags&&Z.data.tags.forEach(J=>{d[J.id]=J}),h.value=bt(Z.data.problem,d),o.setTitle(h.value.title+" - "+o.getTitle),s&&(Z=await ko(s),Z.code===0?(Z.data.problems.sort((J,oe)=>J-oe),c.value=Z.data.problems):N(n,Z.code)),g.value=h.value.description,await pt(()=>{!w&&u.value&&(w=ea.create(u.value,{value:"",language:"cpp",minimap:{enabled:!0},colorDecorators:!0,readOnly:!1,theme:"vs-dark"})),S.value=!1})},K=async()=>{M(),D.value=!1;const Z=await hn(f);if(Z.code!==0)return;D.value=!0;const J=Z.data.problem_daily;y=J.problem_id,x.value=J.solution,T.value=J.code;const oe=new Date(Z.data.time);V=oe.getTime()-new Date().getTime();const ne=new Date(oe.getTime()),Ie=ne.getFullYear(),Ce=String(ne.getMonth()+1).padStart(2,"0"),H=String(ne.getDate()).padStart(2,"0"),se=`${Ie}-${Ce}-${H}`;if(f===se){const ve=oe.getHours()*60*60+oe.getMinutes()*60+oe.getSeconds(),je=18*60*60;ve<je?z.value=je-ve:z.value=-1,k.value=24*60*60-ve}(z.value>=0||k.value>=0)&&L()};return pe(async()=>{i=Ue(()=>l.params,async()=>{if(D.value=!1,Array.isArray(l.params.problemId)?y=l.params.problemId[0]:y=l.params.problemId,y||(Array.isArray(l.params.dailyId)?f=l.params.dailyId[0]:f=l.params.dailyId,S.value=!0,await K(),S.value=!1),!y){if(Array.isArray(l.params.contestId)?s=Number(l.params.contestId[0]):s=Number(l.params.contestId),!s){ge(n,"题目不存在"),f?await Y.push({name:"problem-daily-list"}):await Y.push({name:"problem"});return}if(Array.isArray(l.params.problemIndex)?U.value=parseInt(l.params.problemIndex[0]):U.value=parseInt(l.params.problemIndex),!U.value){ge(n,"题目不存在"),await Y.push({name:"problem"});return}}p.value=!!s,S.value=!0,await W()},{immediate:!0}),u.value&&new ResizeObserver(()=>{w&&w.layout()}).observe(u.value)}),De(()=>{i&&(i(),i=null),M()}),(Z,J)=>{const oe=Ee("md-preview"),ne=be,Ie=Ft,Ce=he,H=Te,se=O,ve=Ye,je=nt,Me=We,ke=Nt,Fe=_t,lt=Pe,st=Ve;return j(),E(st,{loading:S.value},{default:a(()=>[t(lt,{class:"dida-main-content"},{default:a(()=>[t(H,{span:8},{default:a(()=>[t(ne,{style:{margin:"10px"}},{default:a(()=>[t(oe,{"model-value":fe(g),previewTheme:"cyanosis"},null,8,["model-value"])]),_:1}),D.value?(j(),E(ne,{key:0,style:{margin:"10px"},title:"题解"},{default:a(()=>[z.value<0?(j(),E(la,{key:0},{default:a(()=>[t(oe,{"model-value":x.value,previewTheme:"cyanosis"},null,8,["model-value"])]),_:1})):(j(),ee("div",Uo,[R("div",null,[t(Ce,null,{default:a(()=>[J[2]||(J[2]=R("p",null,"距离解锁百分比",-1)),t(Ie,{theme:"circle",color:{from:"#0052D9",to:"#00A870"},percentage:100-z.value/(18*60*60)*100,status:"active"},{label:a(()=>[P(q((100-z.value/(18*60*60)*100).toFixed(3))+"% ",1)]),default:a(()=>[J[1]||(J[1]=P(" > "))]),_:1},8,["percentage"])]),_:1})])]))]),_:1})):le("",!0),D.value?(j(),E(ne,{key:1,style:{margin:"10px"},title:"示例代码"},{default:a(()=>[k.value<0?(j(),E(la,{key:0},{default:a(()=>[t(oe,{"model-value":T.value,previewTheme:"cyanosis"},null,8,["model-value"])]),_:1})):(j(),ee("div",Ao,[R("div",null,[t(Ce,{style:{margin:"0 auto"}},{default:a(()=>[J[4]||(J[4]=R("p",null,"距离解锁百分比",-1)),t(Ie,{theme:"circle",color:{from:"#0052D9",to:"#00A870"},percentage:100-k.value/(24*60*60)*100,status:"active"},{label:a(()=>[P(q((100-k.value/(24*60*60)*100).toFixed(3))+"% ",1)]),default:a(()=>[J[3]||(J[3]=P(" > "))]),_:1},8,["percentage"])]),_:1})])]))]),_:1})):le("",!0)]),_:1}),t(H,{span:4},{default:a(()=>{var yt;return[fe(s)?(j(),ee("div",zo,[t(Ce,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(j(!0),ee(me,null,xe(c.value,(Ne,re)=>(j(),E(se,{key:re,theme:Ne==fe(U)?"primary":"default",onClick:async()=>await fe(ft)(fe(s),Ne)},{default:a(()=>[P(q(fe(tt)(Ne)),1)]),_:2},1032,["theme","onClick"]))),128))]),_:1})])):le("",!0),R("div",Ro,[t(Me,{layout:"vertical",bordered:!0},{default:a(()=>{var Ne;return[t(ve,{label:"ID"},{default:a(()=>{var re;return[P(q((re=h.value)==null?void 0:re.id),1)]}),_:1}),t(ve,{label:"标题"},{default:a(()=>{var re;return[P(q((re=h.value)==null?void 0:re.title),1)]}),_:1}),t(ve,{label:"时间限制"},{default:a(()=>{var re;return[P(q((re=h.value)==null?void 0:re.timeLimit),1)]}),_:1}),t(ve,{label:"内存限制"},{default:a(()=>{var re;return[P(q((re=h.value)==null?void 0:re.memoryLimit),1)]}),_:1}),t(ve,{label:"判题方式"},{default:a(()=>{var re;return[P(q((re=h.value)==null?void 0:re.judgeType),1)]}),_:1}),p.value?le("",!0):(j(),E(ve,{key:0,label:"正确提交"},{default:a(()=>{var re;return[P(q((re=h.value)==null?void 0:re.accept),1)]}),_:1})),p.value?le("",!0):(j(),E(ve,{key:1,label:"提交总数"},{default:a(()=>{var re;return[P(q((re=h.value)==null?void 0:re.attempt),1)]}),_:1})),t(ve,{label:"创建时间"},{default:a(()=>{var re;return[P(q((re=h.value)==null?void 0:re.insertTime),1)]}),_:1}),t(ve,{label:"更新时间"},{default:a(()=>{var re;return[P(q((re=h.value)==null?void 0:re.updateTime),1)]}),_:1}),t(ve,{label:"上传用户"},{default:a(()=>{var re;return[P(q((re=h.value)==null?void 0:re.creatorNickname),1)]}),_:1}),p.value?le("",!0):(j(),E(ve,{key:2,label:"题目来源"},{default:a(()=>{var re,Qe,mt;return[(re=h.value)!=null&&re.sourceUrl?(j(),E(je,{key:0,href:(Qe=h.value)==null?void 0:Qe.sourceUrl,target:"_blank"},{default:a(()=>{var Zt;return[P(q((Zt=h.value)==null?void 0:Zt.source),1)]}),_:1},8,["href"])):(j(),ee("span",Mo,q((mt=h.value)==null?void 0:mt.source),1))]}),_:1})),C.value?(j(),E(ve,{key:3,label:"是否私有"},{default:a(()=>{var re;return[P(q((re=h.value)!=null&&re.private?"私有":"公开"),1)]}),_:1})):le("",!0),(Ne=h.value)!=null&&Ne.originUrl?(j(),E(ve,{key:4,label:"原题链接"},{default:a(()=>{var re;return[t(je,{href:(re=h.value)==null?void 0:re.originUrl,target:"_blank"},{default:a(()=>{var Qe,mt;return[P(q((Qe=h.value)==null?void 0:Qe.originOj)+" - "+q((mt=h.value)==null?void 0:mt.originId),1)]}),_:1},8,["href"])]}),_:1})):le("",!0),fe(y)?(j(),E(ve,{key:5,label:"标签"},{default:a(()=>[t(Ce,null,{default:a(()=>{var re;return[(j(!0),ee(me,null,xe((re=h.value)==null?void 0:re.tags,Qe=>(j(),E(se,{key:Qe.id,variant:"dashed",onClick:()=>F(Qe)},{default:a(()=>[P(q(Qe.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})):le("",!0)]}),_:1}),R("div",Eo,[t(Ce,null,{default:a(()=>[t(se,{onClick:ae},{default:a(()=>J[5]||(J[5]=[P("提交记录")])),_:1}),t(se,{onClick:Q},{default:a(()=>J[6]||(J[6]=[P("题目讨论")])),_:1}),fe(y)?(j(),E(se,{key:0,onClick:B},{default:a(()=>J[7]||(J[7]=[P("题目推荐")])),_:1})):le("",!0)]),_:1})]),D.value&&$.value||C.value||(yt=h.value)!=null&&yt.originId?(j(),ee("div",qo,[t(Ce,null,{default:a(()=>{var Ne;return[D.value&&$.value?(j(),E(se,{key:0,onClick:te},{default:a(()=>J[8]||(J[8]=[P("每日一题")])),_:1})):le("",!0),C.value?(j(),E(se,{key:1,onClick:X},{default:a(()=>J[9]||(J[9]=[P("编辑")])),_:1})):le("",!0),(Ne=h.value)!=null&&Ne.originId?(j(),E(se,{key:2,onClick:ie,loading:_.value},{default:a(()=>J[10]||(J[10]=[P("更新描述 ")])),_:1},8,["loading"])):le("",!0)]}),_:1})])):le("",!0),R("div",Ko,[t(Ce,null,{default:a(()=>[t(Fe,{modelValue:r.value,"onUpdate:modelValue":J[0]||(J[0]=Ne=>r.value=Ne),label:"语言：",placeholder:"请选择提交语言","auto-width":"",clearable:"",onChange:ye},{default:a(()=>[(j(!0),ee(me,null,xe(A.value,Ne=>(j(),E(ke,{key:Ne.value,value:Ne.value,label:Ne.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),t(se,{onClick:ue,loading:v.value},{default:a(()=>J[11]||(J[11]=[P("提交")])),_:1},8,["loading"])]),_:1}),R("div",Fo,[R("div",{ref_key:"codeEditRef",ref:u,class:"dida-code-editor"},null,512)])])])]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),Ut=de(No,[["__scopeId","data-v-bf97b778"]]),Oo={style:{margin:"10px"}},Go={key:0,class:"dida-operation-container"};function Ho(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!at(e)}const Bo=ce({__name:"ProblemDailyList",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e(),o=qe();let b=!1,g=null,y={},f={};const s=Je(()=>o.hasAuth(Le.ManageProblem)),U=m([{title:"日期",colKey:"id",cell:(k,x)=>t(O,{variant:"dashed",onClick:()=>_(x.row.id)},{default:()=>[x.row.id]})},{title:"ID",colKey:"problemId",cell:(k,x)=>{let T=v(x.row.problemId);return t(O,{variant:"dashed",theme:T,onClick:()=>_(x.row.id)},{default:()=>[x.row.problemId]})}},{title:"标题",colKey:"title",cell:(k,x)=>t(O,{variant:"text",onClick:()=>_(x.row.id)},{default:()=>[x.row.title]})},{title:"标签",colKey:"tags",cell:(k,x)=>{const T=x.row.tags;if(!T||T.length===0)return"";let V=[];for(let C=0;C<T.length;C++){const $=T[C];V.push(t(O,{key:C,theme:"default",variant:"outline",size:"small",onClick:()=>A($)},{default:()=>[$.name]}))}return t(he,null,Ho(V)?V:{default:()=>[V]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),p=m(!1);let D=1,S=50;const h=m({current:D,pageSize:S,defaultCurrent:D,defaultPageSize:S,total:0,pageSizeOptions:[50,100]}),w=m([]),u=m({date:[],problemId:""}),_=k=>{k&&n.push({name:"problem-daily-detail",params:{dailyId:k}})},v=k=>{if(!k||!f)return"default";const x=f[k];if(!x)return"default";switch(x){case $e.Accept:return"success";case $e.Attempt:return"warning";default:return"default"}},d=async()=>{let k="";u.value.date&&u.value.date.length>1&&(k=u.value.date[0]+"~"+u.value.date[1]),await n.push({query:{...l.query,date:k,problem_id:u.value.problemId,page:1,page_size:h.value.defaultPageSize}})},r=async()=>{u.value.date=[],u.value.problemId="",await n.push({query:{...l.query,date:"",problem_id:"",page:1,page_size:h.value.defaultPageSize}})},A=k=>{k&&n.push({name:"problem-list",query:{...l.query,title:"",tag:k.name,page:1,page_size:h.value.defaultPageSize}})},c=()=>{n.push({name:"manage-problem-daily-create"})},I=async(k,x)=>{p.value=!0;try{const{current:T,pageSize:V}=k;let C="";u.value.date[0]&&(C=u.value.date[0]);let $="";u.value.date[1]&&($=u.value.date[1]);const L=await kn(C,$,u.value.problemId,T,V);if(w.value=[],L.code===0){const M=L.data.list;if(!M||M.length<=0){h.value={...h.value,total:0},f={},we(i,"未找到记录");return}y={},L.data.tags&&L.data.tags.forEach(F=>{y[F.id]=F}),M.forEach(F=>{var X;const te=La(F,y);(X=w.value)==null||X.push(te)}),h.value={...h.value,total:L.data.total_count},f=L.data.attempt_status}else x&&N(i,L.code)}catch(T){console.error(T),N(i,He())}finally{p.value=!1}},z=async k=>{await n.push({query:{...l.query,page:k.current,page_size:k.pageSize}})};return pe(async()=>{b=!0,p.value=!0,g=Ue(()=>l.query,k=>{if(!b)return;if(u.value.date=[],k.date){const V=k.date.split("~");V.length===2&&(u.value.date=[V[0],V[1]])}u.value.problemId=k.problem_id||"";const x=parseInt(k.page)||h.value.defaultCurrent,T=parseInt(k.page_size)||h.value.defaultPageSize;D=x,S=T,h.value={...h.value,current:D,pageSize:S},I({current:D,pageSize:S},!0)},{immediate:!0})}),De(()=>{b=!1,g&&g()}),(k,x)=>{const T=Ke,V=be,C=Te,$=O,L=he,M=Ot,F=ze,te=Re,X=Ae,ae=Pe;return j(),E(ae,null,{default:a(()=>[t(C,{span:9},{default:a(()=>[t(V,{style:{margin:"10px"}},{default:a(()=>[t(T,{data:w.value,columns:U.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:h.value,"table-layout":"auto",loading:p.value,onPageChange:z},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(C,{span:3},{default:a(()=>[R("div",Oo,[s.value?(j(),ee("div",Go,[t(L,null,{default:a(()=>[t($,{onClick:c},{default:a(()=>x[2]||(x[2]=[P("新建")])),_:1})]),_:1})])):le("",!0),t(V,{class:"sh-card"},{default:a(()=>[t(X,{model:u.value,onSubmit:d,onReset:r},{default:a(()=>[t(F,{label:"日期","label-align":"top"},{default:a(()=>[t(M,{modelValue:u.value.date,"onUpdate:modelValue":x[0]||(x[0]=Q=>u.value.date=Q),"allow-input":"",clearable:"",format:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(F,{label:"问题","label-align":"top"},{default:a(()=>[t(te,{modelValue:u.value.problemId,"onUpdate:modelValue":x[1]||(x[1]=Q=>u.value.problemId=Q),placeholder:"请输入问题ID",clearable:""},null,8,["modelValue"])]),_:1}),t(F,{"label-align":"top"},{default:a(()=>[t(L,null,{default:a(()=>[t($,{theme:"primary",type:"submit"},{default:a(()=>x[3]||(x[3]=[P("搜索")])),_:1}),t($,{theme:"danger",type:"reset"},{default:a(()=>x[4]||(x[4]=[P("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(V,{class:"sh-card",header:"每日一题","header-bordered":!0},{default:a(()=>x[5]||(x[5]=[R("p",null,"由管理员团队精选的题目，每日0点更新。",-1),R("p",null,"当日下午6点提供题解，次日提供AC代码。",-1)])),_:1})])]),_:1})]),_:1})}}}),Jo=de(Bo,[["__scopeId","data-v-5e0bb3cc"]]),Wo={style:{margin:"10px"}},Yo={style:{margin:"12px"}},Xo={class:"dida-edit-container"},Zo=ce({__name:"ProblemDailyEdit",setup(e){let l=Se();const{globalProperties:n}=_e();let i=null;const o=m(""),b=m(!1),g=m(!1),y=m(null),f=m({date:"",problemId:"",solution:"",code:""}),s=()=>{Y.push({name:"problem-daily-detail",params:{dailyId:o.value}})};async function U(u,_){g.value=!0,await dt(u,_,n,()=>Vn(o.value)),g.value=!1}const p=async()=>{g.value=!0;try{const u=f.value.date,_=await In(u,f.value.problemId,f.value.solution,f.value.code);if(g.value=!0,_.code!==0){N(n,_.code);return}await Y.push({name:"manage-problem-daily",params:{dailyId:u}}),Ge(n,"创建成功")}finally{g.value=!1}},D=async()=>{g.value=!0;try{const u=await Pn(o.value,f.value.problemId,f.value.solution,f.value.code);if(g.value=!0,u.code!==0){N(n,u.code);return}y.value&&(u.data.update_time!=null&&(y.value.updateTime=new Date(u.data.update_time).toLocaleString()),u.data.updater_nickname!=null&&(y.value.updaterNickname=u.data.updater_nickname)),u.data.solution!=null&&(f.value.solution=u.data.solution),u.data.code!=null&&(f.value.code=u.data.code),Ge(n,"保存成功")}finally{g.value=!1}},S=u=>{f.value.solution=u,b.value=!1},h=u=>{f.value.code=u,b.value=!1},w=async()=>{const u=await yn(o.value);if(u.code!==0){N(n,u.code),console.error("problem get failed",u.code),await Y.push({name:"problem"});return}const _=u.data;y.value=La(_,{}),f.value.problemId=_.problem_id,S(_.solution),h(_.code)};return pe(async()=>{i=Ue(()=>l.params,async()=>{Array.isArray(l.params.dailyId)?o.value=l.params.dailyId[0]:o.value=l.params.dailyId,o.value?(b.value=!0,f.value.date=o.value,await w()):(S("暂无题解"),h("暂无标程"))},{immediate:!0})}),De(()=>{i&&(i(),i=null)}),(u,_)=>{const v=xt,d=kl,r=ze,A=Re,c=Ae,I=be,z=Te,k=O,x=he,T=Ye,V=We,C=Pe,$=Ee("md-editor-v3"),L=Ve;return j(),E(L,{loading:b.value},{default:a(()=>[t(C,null,{default:a(()=>[t(z,{span:8},{default:a(()=>[R("div",Wo,[t(v,{theme:"info"},{default:a(()=>_[4]||(_[4]=[P("可以提前配置将来日期的题目，对外仅展示到截止到当天的题目")])),_:1}),t(I,{class:"sh-form-card"},{default:a(()=>[t(c,{model:f.value},{default:a(()=>[t(r,{label:"日期"},{default:a(()=>[t(d,{modelValue:f.value.date,"onUpdate:modelValue":_[0]||(_[0]=M=>f.value.date=M),disabled:o.value&&!0},null,8,["modelValue","disabled"])]),_:1}),t(r,{label:"问题ID"},{default:a(()=>[t(A,{modelValue:f.value.problemId,"onUpdate:modelValue":_[1]||(_[1]=M=>f.value.problemId=M),placeholder:"问题标题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(z,{span:4},{default:a(()=>[R("div",Yo,[R("div",Xo,[o.value?(j(),E(x,{key:0},{default:a(()=>[t(k,{onClick:D,theme:"danger",loading:g.value},{default:a(()=>_[5]||(_[5]=[P("保存")])),_:1},8,["loading"]),t(k,{onClick:s},{default:a(()=>_[6]||(_[6]=[P("查看")])),_:1})]),_:1})):(j(),E(x,{key:1},{default:a(()=>[t(k,{onClick:p,theme:"danger",loading:g.value},{default:a(()=>_[7]||(_[7]=[P("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(j(),E(V,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(T,{label:"创建时间"},{default:a(()=>{var M;return[P(q((M=y.value)==null?void 0:M.createTime),1)]}),_:1}),t(T,{label:"更新时间"},{default:a(()=>{var M;return[P(q((M=y.value)==null?void 0:M.updateTime),1)]}),_:1}),t(T,{label:"创建用户"},{default:a(()=>{var M;return[P(q((M=y.value)==null?void 0:M.creatorNickname),1)]}),_:1}),t(T,{label:"更新用户"},{default:a(()=>{var M;return[P(q((M=y.value)==null?void 0:M.updaterNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),R("div",null,[_[8]||(_[8]=R("p",{style:{"margin-left":"20px"}},"题解：",-1)),t($,{id:"daily-solution-editor",modelValue:f.value.solution,"onUpdate:modelValue":_[2]||(_[2]=M=>f.value.solution=M),onSave:D,onOnUploadImg:U,previewTheme:"cyanosis"},null,8,["modelValue"]),t(L,{loading:g.value,attach:"#daily-solution-editor","z-index":1e5},null,8,["loading"])]),R("div",null,[_[9]||(_[9]=R("p",{style:{"margin-left":"20px"}},"标程：",-1)),t($,{id:"daily-code-editor",modelValue:f.value.code,"onUpdate:modelValue":_[3]||(_[3]=M=>f.value.code=M),onSave:D,onOnUploadImg:U,previewTheme:"cyanosis"},null,8,["modelValue"]),t(L,{loading:g.value,attach:"#daily-code-editor","z-index":1e5},null,8,["loading"])])]),_:1},8,["loading"])}}}),na=de(Zo,[["__scopeId","data-v-b11269dd"]]),Qo={style:{margin:"10px"}};function es(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!at(e)}const ts=ce({__name:"ProblemRecommend",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=null,b="",g={},y={};const f=m([{title:"ID",colKey:"id",cell:(w,u)=>{let _=D(u.row.id);return t(O,{variant:"dashed",theme:_,onClick:()=>p(u.row.id)},{default:()=>[u.row.id]})}},{title:"标题",colKey:"title",cell:(w,u)=>t(O,{variant:"text",onClick:()=>p(u.row.id)},{default:()=>[u.row.title]})},{title:"标签",colKey:"tags",cell:(w,u)=>{const _=u.row.tags;if(!_||_.length===0)return"";let v=[];for(let d=0;d<_.length;d++){const r=_[d];v.push(t(O,{key:d,theme:"default",variant:"outline",size:"small",onClick:()=>S(r)},{default:()=>[r.name]}))}return t(he,null,es(v)?v:{default:()=>[v]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),s=m(!1),U=m(),p=w=>{w&&n.push({path:"/problem/"+w})},D=w=>{if(!w||!y)return"default";const u=y[w];if(!u)return"default";switch(u){case $e.Accept:return"success";case $e.Attempt:return"warning";default:return"default"}},S=w=>{w&&n.push({name:"problem-list",query:{tag:w.name}})},h=async w=>{s.value=!0;try{const u=await bn(b);if(U.value=[],u.code===0){const _=u.data.list;if(!_||_.length<=0){we(i,"暂无推荐题目");return}g={},u.data.tags&&u.data.tags.forEach(v=>{g[v.id]=v}),_.forEach(v=>{var r;const d=bt(v,g);(r=U.value)==null||r.push(d)})}else w&&N(i,u.code)}catch(u){console.error(u),N(i,He())}finally{s.value=!1}};return pe(async()=>{s.value=!0,o=Ue(()=>l.query,w=>{Array.isArray(l.params.problemId)?b=l.params.problemId[0]:b=l.params.problemId,h(!0)},{immediate:!0})}),De(()=>{o&&o()}),(w,u)=>{const _=Ke,v=be,d=Te,r=Pe;return j(),E(r,null,{default:a(()=>[t(d,{span:9},{default:a(()=>[t(v,{style:{margin:"10px"}},{default:a(()=>[t(_,{data:U.value,columns:f.value,"row-key":"id","vertical-align":"top",hover:!0,"table-layout":"auto",loading:s.value},null,8,["data","columns","loading"])]),_:1})]),_:1}),t(d,{span:3},{default:a(()=>[R("div",Qo,[t(v,{class:"sh-card",header:"题目推荐","header-bordered":!0},{default:a(()=>u[0]||(u[0]=[P(" 根据本站其他用户的提交记录推荐类似题目"),R("br",null,null,-1),P("依据推荐算法来计算，与本用户相似度最高的用户做的题，大概率被自己感兴趣。 ")])),_:1})])]),_:1})]),_:1})}}}),as=de(ts,[["__scopeId","data-v-77972e8b"]]),ls={style:{margin:"10px"}},ns={key:1},os={style:{margin:"12px"}},ss={class:"dida-edit-container"},rs={class:"dida-description-editor"},is=ce({__name:"ProblemEdit",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze(),o=m(""),b=m(!1),g=m(!1),y=m(!1),f=m(null),s=m({title:"",timeLimit:0,memoryLimit:0,source:"",private:!0,tags:[],description:""}),U=m([]),p=m([]),D=Je(()=>{const c=[],I=U.value;for(let z=0,k=I.length;z<k;z++)I[z].value&&c.push(I[z].value);return c}),S=(c,I)=>{const{trigger:z,index:k,item:x}=I;if(z==="clear"&&(U.value=[]),["tag-remove","backspace"].includes(z)&&U.value.splice(k,1),z==="enter"){for(let V=0;V<p.value.length;V++){const C=p.value[V];if(C.label===x){for(let $=0;$<U.value.length;$++)if(U.value[$].label===C.label)return;U.value.push(C);return}}const T={label:x,value:x};U.value.push(T),p.value=p.value.concat(T)}},h=(c,{current:I,type:z})=>{if(!I){U.value=z==="check"?p.value.slice(1):[];return}if(z==="check"){const k=p.value.find(x=>x.value===I);if(!k)return;U.value.push(k)}else U.value=U.value.filter(k=>k.value!==I)},w=()=>{Y.push({name:"problem-detail",params:{problemId:o.value}})},u=()=>{Y.push({name:"manage-problem-judge",params:{problemId:o.value}})},_=async(c,I)=>{y.value=!0,await dt(c,I,n,()=>Tn(o.value)),y.value=!1},v=async()=>{g.value=!0,s.value.tags=[];for(let c=0;c<U.value.length;c++){const I=U.value[c];I&&I.label&&s.value.tags.push(I.label)}try{const c=await Sn(s.value.title,s.value.timeLimit,s.value.memoryLimit,s.value.source,s.value.private,s.value.tags,s.value.description);if(g.value=!0,c.code!==0){N(n,c.code);return}c.data!=null&&await Y.push({name:"problem-detail",params:{problemId:c.data}}),Ge(n,"创建成功")}finally{g.value=!1}},d=async()=>{g.value=!0,s.value.tags=[];for(let c=0;c<U.value.length;c++){const I=U.value[c];I&&I.label&&s.value.tags.push(I.label)}try{const c=await Cn(o.value,s.value.title,s.value.timeLimit,s.value.memoryLimit,s.value.source,s.value.private,s.value.tags,s.value.description);if(g.value=!0,c.code!==0){N(n,c.code);return}f.value&&c.data.update_time!=null&&(f.value.updateTime=new Date(c.data.update_time).toLocaleString()),c.data.description!=null&&(s.value.description=c.data.description),Ge(n,"保存成功")}finally{g.value=!1}},r=c=>{s.value.description=c,b.value=!1},A=async()=>{const c=await $a(o.value,void 0,void 0);if(c.code!==0){N(n,c.code),console.error("problem get failed",c.code),await Y.push({name:"problem"});return}const I=c.data.problem;if(f.value=bt(I,{}),s.value.title=I.title,s.value.timeLimit=I.time_limit,s.value.memoryLimit=I.memory_limit,s.value.source=I.source,s.value.private=I.private,s.value.tags=[],U.value=[],c.data.tags)for(let k=0;k<c.data.tags.length;k++){const x=c.data.tags[k];x&&x.name&&(s.value.tags.push(x.name),U.value.push({label:x.name,value:x.id}))}i.setTitle(I.title+" - "+i.getTitle);let z=I.description;r(z)};return pe(async()=>{Array.isArray(l.params.problemId)?o.value=l.params.problemId[0]:o.value=l.params.problemId,o.value?(b.value=!0,Ua(-1).then(async c=>{c.code===0?(c.data.list&&c.data.list.forEach(I=>{p.value.push({label:I.name,value:I.id})}),await A()):(N(n,c.code),console.error("problem tag get failed",c.code),await Y.push({name:"problem"}))}).catch(async c=>{console.error(c),N(n,"获取数据异常"),await Y.push({name:"problem"})})):(s.value.timeLimit=1e3,s.value.memoryLimit=65536,r(""))}),(c,I)=>{const z=Re,k=ze,x=wa,T=gt,V=Cl,C=Sl,$=Ae,L=be,M=Te,F=O,te=he,X=Ye,ae=We,Q=Pe,B=Ee("md-editor-v3"),ie=Ve;return j(),E(ie,{loading:b.value},{default:a(()=>[t(Q,null,{default:a(()=>[t(M,{span:8},{default:a(()=>[R("div",ls,[t(L,{class:"sh-card"},{default:a(()=>[t($,{model:s.value},{default:a(()=>[t(k,{label:"标题"},{default:a(()=>[t(z,{modelValue:s.value.title,"onUpdate:modelValue":I[0]||(I[0]=ue=>s.value.title=ue),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),t(k,{label:"时间限制"},{default:a(()=>[t(x,{modelValue:s.value.timeLimit,"onUpdate:modelValue":I[1]||(I[1]=ue=>s.value.timeLimit=ue),theme:"normal",min:0},{suffix:a(()=>I[6]||(I[6]=[R("span",null,"ms",-1)])),_:1},8,["modelValue"])]),_:1}),t(k,{label:"内存限制"},{default:a(()=>[t(x,{modelValue:s.value.memoryLimit,"onUpdate:modelValue":I[2]||(I[2]=ue=>s.value.memoryLimit=ue),theme:"normal",min:0},{suffix:a(()=>I[7]||(I[7]=[R("span",null,"KB",-1)])),_:1},8,["modelValue"])]),_:1}),t(k,{label:"来源"},{default:a(()=>[t(z,{modelValue:s.value.source,"onUpdate:modelValue":I[3]||(I[3]=ue=>s.value.source=ue),placeholder:"请输入题目来源"},null,8,["modelValue"])]),_:1}),t(k,{label:"私有"},{default:a(()=>[t(T,{modelValue:s.value.private,"onUpdate:modelValue":I[4]||(I[4]=ue=>s.value.private=ue)},null,8,["modelValue"])]),_:1}),t(k,{label:"标签"},{default:a(()=>[t(C,{value:U.value,"allow-input":!0,placeholder:"请选择或输入","tag-input-props":{excessTagsDisplayType:"break-line"},"popup-props":{overlayInnerClassName:["narrow-scrollbar"],overlayInnerStyle:{maxHeight:"280px",overflowY:"auto",overscrollBehavior:"contain",padding:"6px"}},clearable:"",multiple:"",onTagChange:S},{panel:a(()=>[p.value.length?(j(),E(V,{key:0,value:D.value,options:p.value,onChange:h},null,8,["value","options"])):(j(),ee("div",ns,"暂无数据"))]),suffixIcon:a(()=>[t(fe(nl))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(M,{span:4},{default:a(()=>[R("div",os,[R("div",ss,[o.value?(j(),E(te,{key:0},{default:a(()=>[t(F,{onClick:d,theme:"danger",loading:g.value},{default:a(()=>I[8]||(I[8]=[P("保存")])),_:1},8,["loading"]),t(F,{onClick:u,theme:"warning"},{default:a(()=>I[9]||(I[9]=[P("判题数据")])),_:1}),t(F,{onClick:w},{default:a(()=>I[10]||(I[10]=[P("查看")])),_:1})]),_:1})):(j(),E(te,{key:1},{default:a(()=>[t(F,{onClick:v,theme:"danger",loading:g.value},{default:a(()=>I[11]||(I[11]=[P("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(j(),E(ae,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(X,{label:"创建时间"},{default:a(()=>{var ue;return[P(q((ue=f.value)==null?void 0:ue.insertTime),1)]}),_:1}),t(X,{label:"更新时间"},{default:a(()=>{var ue;return[P(q((ue=f.value)==null?void 0:ue.updateTime),1)]}),_:1}),t(X,{label:"判题方式"},{default:a(()=>{var ue;return[P(q((ue=f.value)==null?void 0:ue.judgeType),1)]}),_:1}),t(X,{label:"上传用户"},{default:a(()=>{var ue;return[P(q((ue=f.value)==null?void 0:ue.creatorNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),R("div",rs,[I[12]||(I[12]=R("p",null,"题目描述",-1)),t(ie,{loading:y.value||g.value},{default:a(()=>[t(B,{modelValue:s.value.description,"onUpdate:modelValue":I[5]||(I[5]=ue=>s.value.description=ue),onSave:d,onOnUploadImg:_,previewTheme:"cyanosis"},null,8,["modelValue"])]),_:1},8,["loading"])])]),_:1},8,["loading"])}}}),oa=de(is,[["__scopeId","data-v-e349d9e2"]]),us={style:{margin:"10px"}},ds={style:{margin:"12px"}},cs={class:"dida-edit-container"},ms=ce({__name:"ProblemJudge",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze(),o=m(""),b=m(!1),g=m(null);let y=null;const f=m(null),s=m(""),U=m(!1),p=m(!1),D=m([{title:"文件",colKey:"file"},{title:"大小",colKey:"size",width:150,cell:(x,T)=>{let V=T.row.size,C;return V>10*1024?V>1024*1024?C=(V/(1024*1024)).toFixed(3)+" MB":C=(V/1024).toFixed(3)+" KB":C=V+" B",C}},{title:"最后修改时间",colKey:"lastModified",width:180,cell:(x,T)=>new Date(T.row.lastModified).toLocaleString()},{title:"操作",colKey:"action",width:100,cell:(x,T)=>t(O,{onClick:()=>v(T.row.file)},{default:()=>[P("下载")]})}]),S=m([]),h=Je(()=>({border:"2px dashed #ccc",borderRadius:"6px",padding:"20px",textAlign:"center",cursor:"pointer",backgroundColor:U.value?"#f0f9ff":"#fff",transition:"background-color 0.2s ease"})),w=Je(()=>s.value?`已选择：${s.value}`:U.value?"松开文件以上传":"拖拽判题数据压缩包到这里，或点击选择文件"),u=()=>{Y.push({name:"problem-detail",params:{problemId:o.value}})},_=()=>{Y.push({name:"manage-problem",params:{problemId:o.value}})},v=async x=>{const T=await xn(o.value,x);if(T.code!==0){N(n,T.code);return}const V=document.createElement("a");V.href=T.data,V.target="_blank",V.click(),URL.revokeObjectURL(V.href)},d=async()=>{if(!y){ge(n,"请选择压缩包");return}p.value=!0,Dn(o.value,y).then(async x=>{x.code==0?(f.value.value=null,y=null,s.value="",b.value=!0,Ge(n,"上传成功"),await k()):Fl(n,x.code,x.data)}).catch(x=>{console.log(x),n.$message.error({duration:3e3,content:"上传失败"})}).finally(()=>{p.value=!1})},r=()=>{var x;(x=f.value)==null||x.click()},A=x=>{const T=x.target.files[0];T&&(s.value=T.name,y=T)},c=x=>{U.value=!0},I=()=>{U.value=!1},z=x=>{x.preventDefault(),x.stopPropagation(),U.value=!1;const T=x.dataTransfer.files[0];if(T){s.value=T.name;const V=new DataTransfer;V.items.add(T),f.value.files=V.files,y=T}},k=async()=>{const x=await _n(o.value);if(x.code!==0){N(n,x.code),await Y.push({name:"problem"});return}const T=x.data.problem;g.value=bt(T,{}),i.setTitle(T.title+" - "+i.getTitle),S.value=[],x.data.judges?(x.data.judges.forEach(V=>{S.value.push({file:V.key,size:V.size,lastModified:V.last_modified})}),S.value.sort((V,C)=>V.file.endsWith(".zip")&&!C.file.endsWith(".zip")?-1:!V.file.endsWith(".zip")&&C.file.endsWith(".zip")?1:V.file.endsWith(".yaml")&&!C.file.endsWith(".yaml")?-1:!V.file.endsWith(".yaml")&&C.file.endsWith(".yaml")?1:0)):ge(n,"评测数据不存在"),b.value=!1};return pe(async()=>{if(Array.isArray(l.params.problemId)?o.value=l.params.problemId[0]:o.value=l.params.problemId,!o.value){ge(n,"题目不存在"),await Y.push({name:"problem"});return}b.value=!0,await k()}),(x,T)=>{const V=Ke,C=Te,$=O,L=he,M=Ye,F=We,te=Pe,X=Ve;return j(),E(X,{loading:b.value},{default:a(()=>[t(te,null,{default:a(()=>[t(C,{span:7},{default:a(()=>[R("div",us,[R("div",{id:"drop-zone",style:ga(h.value),onClick:r,onDragenter:Lt(c,["prevent"]),onDragover:T[0]||(T[0]=Lt(()=>{},["prevent"])),onDragleave:Lt(I,["prevent"]),onDrop:z},[R("input",{ref_key:"fileInput",ref:f,type:"file",style:{display:"none"},onChange:A},null,544),P(" "+q(w.value),1)],36)]),t(V,{data:S.value,columns:D.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1}),t(C,{span:5},{default:a(()=>[R("div",ds,[R("div",cs,[t(L,null,{default:a(()=>[t($,{onClick:d,theme:"danger",loading:p.value},{default:a(()=>T[1]||(T[1]=[P("上传")])),_:1},8,["loading"]),t($,{onClick:_,theme:"warning"},{default:a(()=>T[2]||(T[2]=[P("编辑")])),_:1}),t($,{onClick:u},{default:a(()=>T[3]||(T[3]=[P("查看")])),_:1})]),_:1})]),t(F,{layout:"vertical",bordered:!0},{default:a(()=>[t(M,{label:"标题"},{default:a(()=>{var ae;return[P(q((ae=g.value)==null?void 0:ae.title),1)]}),_:1}),t(M,{label:"创建时间"},{default:a(()=>{var ae;return[P(q((ae=g.value)==null?void 0:ae.insertTime),1)]}),_:1}),t(M,{label:"更新时间"},{default:a(()=>{var ae;return[P(q((ae=g.value)==null?void 0:ae.updateTime),1)]}),_:1}),t(M,{label:"判题方式"},{default:a(()=>{var ae;return[P(q((ae=g.value)==null?void 0:ae.judgeType),1)]}),_:1}),t(M,{label:"评测数据"},{default:a(()=>{var ae;return[P(q((ae=g.value)==null?void 0:ae.judgeMd5),1)]}),_:1}),t(M,{label:"上传用户"},{default:a(()=>{var ae;return[P(q((ae=g.value)==null?void 0:ae.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),ps=de(ms,[["__scopeId","data-v-0098ef39"]]);function Yt(e){const l={};return l.id=e.id,l.ownerId=e.owner_id,l.ownerUsername=e.owner_username,l.ownerNickname=e.owner_nickname,l.title=e.title,e.start_time?l.startTime=new Date(e.start_time).toLocaleString():l.startTime="无限制",e.end_time?l.endTime=new Date(e.end_time).toLocaleString():l.endTime="无限制",e.update_time?l.updateTime=new Date(e.update_time).toLocaleString():l.updateTime="",e.create_time?l.createTime=new Date(e.create_time).toLocaleString():l.createTime="",e.description?l.description=e.description:l.description="",l.problems=e.problems,l}function fs(e){return G({url:"/collection?id="+e,method:"get"})}function vs(e){return G({url:"/collection/edit?id="+e,method:"get"})}function _s(e,l){return G({url:"/collection/list?page="+e+"&page_size="+l,method:"get"})}function gs(e){return G({url:"/collection/rank?id="+e,method:"get"})}function bs(e){return G({url:"/collection/create",method:"post",data:e})}function hs(e){return G({url:"/collection/edit",method:"post",data:e})}function ys(e){return G({url:"/collection/join",method:"post",data:{id:e}})}function ws(e){return G({url:"/collection/quit",method:"post",data:{id:e}})}const ks={style:{margin:"10px"}},Ss=ce({__name:"CollectionList",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=null;m(!1),m(!1);const b=m([{title:"ID",colKey:"id",width:"100",cell:(_,v)=>t(O,{variant:"text",onClick:()=>D(v.row.id)},{default:()=>[v.row.id]})},{title:"标题",colKey:"title",cell:(_,v)=>t(O,{variant:"text",onClick:()=>D(v.row.id)},{default:()=>[v.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),g=m(!1);let y=1,f=50;const s=m({current:y,pageSize:f,defaultCurrent:y,defaultPageSize:f,total:0,pageSizeOptions:[50,100]}),U=m(),p=m({title:"",username:""});m({title:"",description:"",open_time:[]});const D=_=>{_&&n.push({path:"/collection/"+_})},S=async()=>{await n.push({query:{...l.query,title:p.value.title,username:p.value.username,page:1,page_size:s.value.defaultPageSize}})},h=async(_,v)=>{var d;g.value=!0;try{const{current:r,pageSize:A}=_,c=await _s(r,A);if(U.value=[],c.code===0){const I=c.data.list;for(let z=0;z<I.length;z++){const k=I[z],x=Yt(k);(d=U.value)==null||d.push(x)}s.value={...s.value,total:c.data.total_count}}else v&&N(i,c.code)}catch(r){console.error(r),N(i,He())}finally{g.value=!1}},w=async _=>{await n.push({query:{...l.query,page:_.current,page_size:_.pageSize}})},u=async()=>{await n.push({name:"collection-create"})};return pe(async()=>{o=Ue(()=>l.query,_=>{p.value.title=_.title||"",p.value.username=_.username||"";const v=parseInt(_.page)||s.value.defaultCurrent,d=parseInt(_.page_size)||s.value.defaultPageSize;y=v,f=d,s.value={...s.value,current:y,pageSize:f},h({current:y,pageSize:f},!0)},{immediate:!0})}),De(()=>{o&&o()}),(_,v)=>{const d=Ke,r=be,A=Te,c=Re,I=ze,z=O,k=Ae,x=he,T=Pe;return j(),E(T,null,{default:a(()=>[t(A,{span:9},{default:a(()=>[t(r,{style:{margin:"10px"}},{default:a(()=>[t(d,{data:U.value,columns:b.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:s.value,loading:g.value,onPageChange:w},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(A,{span:3},{default:a(()=>[R("div",ks,[t(r,{class:"sh-card"},{default:a(()=>[t(k,{model:p.value},{default:a(()=>[t(I,{label:"标题"},{default:a(()=>[t(c,{modelValue:p.value.title,"onUpdate:modelValue":v[0]||(v[0]=V=>p.value.title=V),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(I,{label:"负责人"},{default:a(()=>[t(c,{modelValue:p.value.username,"onUpdate:modelValue":v[1]||(v[1]=V=>p.value.username=V),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(I,null,{default:a(()=>[t(z,{theme:"primary",onClick:S},{default:a(()=>v[2]||(v[2]=[P("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(r,{class:"sh-card"},{default:a(()=>[t(x,null,{default:a(()=>[t(z,{onClick:u},{default:a(()=>v[3]||(v[3]=[P("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),Cs=de(Ss,[["__scopeId","data-v-3c9d295e"]]),Is={style:{margin:"20px"}},Ps={class:"dida-operation-container"},xs={style:{margin:"12px"}},Ts=ce({__name:"CollectionDetail",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze(),o=qe();let b=0;const g=m(!1),y=m(null),f=m(!1),s=m(!1);let U={};const p=Je(()=>o.hasAuth(Le.ManageCollection)||y.value&&o.getUserId==y.value.ownerId),D=v=>{if(!v||!U)return"default";const d=U[v];if(!d)return"default";switch(d){case $e.Accept:return"success";case $e.Attempt:return"warning";default:return"default"}},S=m([{title:"问题ID",colKey:"id",cell:(v,d)=>{const r=D(d.row.id);return t(O,{variant:"dashed",theme:r,onClick:()=>aa(d.row.id)},{default:()=>[d.row.id]})}},{title:"标题",colKey:"title",cell:(v,d)=>t(O,{variant:"text",onClick:()=>aa(d.row.id)},{default:()=>[d.row.title]})},{title:"正确",colKey:"accept",cell:(v,d)=>d.row.accept?d.row.accept:0},{title:"提交",colKey:"attempt",cell:(v,d)=>d.row.attempt?d.row.attempt:0}]),h=m([]),w=async()=>{if(!o.isLogin()){await Y.push({name:"login"});return}s.value=!0;try{const v=await ys(b);if(v.code!==0){N(n,v.code);return}f.value=!0,Ge(n,"加入成功")}finally{s.value=!1}},u=async()=>{if(!o.isLogin()){await Y.push({name:"login"});return}s.value=!0;try{const v=await ws(b);if(v.code!==0){N(n,v.code);return}f.value=!1,Ge(n,"退出成功")}finally{s.value=!1}},_=()=>{y.value&&Y.push({name:"collection-edit",params:{collectionId:y.value.id}})};return pe(async()=>{if(Array.isArray(l.params.collectionId)?b=Number(l.params.collectionId[0]):b=Number(l.params.collectionId),!b){await Y.push({name:"problem-collection-list"});return}f.value=!1,g.value=!0;const v=await fs(b);if(v.code!==0){g.value=!1,N(n,v.code),await Y.push({name:"problem-collection-list"});return}f.value=v.data.joined,U=v.data.attempt_status||{},y.value=Yt(v.data.collection),h.value=[],v.data.collection.problems&&v.data.collection.problems.forEach(d=>{const r=v.data.problems.find(A=>A.id===d);h.value.push(r)}),i.setTitle(y.value.title+" - "+i.getTitle),g.value=!1}),(v,d)=>{const r=Sa,A=ka,c=Ke,I=be,z=Te,k=O,x=he,T=Ye,V=We,C=Ee("md-preview"),$=Pe,L=Ve;return j(),E(L,{loading:g.value},{default:a(()=>[t($,{class:"dida-main-content"},{default:a(()=>[t(z,{span:6},{default:a(()=>[R("div",Is,[t(A,{"max-item-width":"300"},{default:a(()=>[t(r,{to:{name:"problem-collection-list"}},{default:a(()=>d[0]||(d[0]=[P("题目集合")])),_:1}),t(r,null,{default:a(()=>{var M;return[P(q((M=y.value)==null?void 0:M.title),1)]}),_:1})]),_:1})]),t(I,{style:{margin:"10px"}},{default:a(()=>[t(c,{data:h.value,columns:S.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),_:1})]),_:1}),t(z,{span:6},{default:a(()=>{var M;return[R("div",Ps,[t(x,null,{default:a(()=>[f.value?(j(),E(k,{key:0,onClick:u,loading:s.value},{default:a(()=>d[1]||(d[1]=[P("退出")])),_:1},8,["loading"])):(j(),E(k,{key:1,onClick:w,loading:s.value},{default:a(()=>d[2]||(d[2]=[P("加入")])),_:1},8,["loading"])),p.value?(j(),E(k,{key:2,onClick:_},{default:a(()=>d[3]||(d[3]=[P("编辑")])),_:1})):le("",!0)]),_:1})]),R("div",xs,[t(V,{layout:"vertical",bordered:!0},{default:a(()=>[t(T,{label:"创建者"},{default:a(()=>{var F;return[P(q((F=y.value)==null?void 0:F.ownerNickname),1)]}),_:1})]),_:1}),t(V,{layout:"vertical",bordered:!0},{default:a(()=>[t(T,{label:"开始时间"},{default:a(()=>{var F;return[P(q((F=y.value)==null?void 0:F.startTime),1)]}),_:1})]),_:1}),t(V,{layout:"vertical",bordered:!0},{default:a(()=>[t(T,{label:"结束时间"},{default:a(()=>{var F;return[P(q((F=y.value)==null?void 0:F.endTime),1)]}),_:1})]),_:1})]),(M=y.value)!=null&&M.description?(j(),E(I,{key:0,style:{margin:"10px"}},{default:a(()=>{var F;return[t(C,{"model-value":(F=y.value)==null?void 0:F.description},null,8,["model-value"])]}),_:1})):le("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),Vs=de(Ts,[["__scopeId","data-v-042bd4bb"]]),Ds=ce({__name:"CollectionRank",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=null,b=0,g=0;const y=m([{title:"Rank",colKey:"rank",align:"center"},{title:"序号",colKey:"index",align:"center"},{title:"Username",colKey:"username",cell:(D,S)=>t(O,{variant:"text",onClick:()=>n.push({name:"user",params:{username:S.row.username}})},{default:()=>[S.row.username]})},{title:"昵称",colKey:"nickname",cell:(D,S)=>t(O,{variant:"text",onClick:()=>n.push({name:"user",params:{username:S.row.username}})},{default:()=>[S.row.nickname]})},{title:"Count",colKey:"count",cell:(D,S)=>t(O,{variant:"text",onClick:()=>n.push({name:"judge-list",query:{username:S.row.username,status:Be.Accept}})},{default:()=>[`${S.row.accept} / ${g}`]})},{title:"Progress",colKey:"progress",cell:(D,S)=>{let h=100;return g>0&&(h=Number((S.row.accept/g*100).toFixed(2))),t(Ft,{percentage:h},null)}}]),f=m(!1),s=m([]),U=({col:D,rowIndex:S})=>{let h=1;for(let w=S+1;w<s.value.length&&s.value[w].rank===s.value[S].rank;w++)h++;if(D.colKey==="rank")return{rowspan:h}},p=async D=>{f.value=!0;try{const S=await gs(b);if(s.value=[],S.code===0){g=S.data.problem;const h=S.data.ranks,w=[];if(h){for(let v=0;v<h.length;v++){const d=h[v];let r={userId:d.author_id,username:d.author_username,nickname:d.author_nickname};r.accept=d.accept,w.push(r)}w.sort((v,d)=>v.accept!==d.accept?d.accept-v.accept:v.userId-d.userId);let u=0,_=-1;for(let v=0;v<w.length;v++)w[v].accept!==_&&(u=v+1,_=w[v].accept),w[v].index=v+1,w[v].rank=u}s.value=w}else D&&N(i,S.code)}catch(S){console.error(S),N(i,He())}finally{f.value=!1}};return pe(async()=>{o=Ue(()=>l.query,async()=>{if(Array.isArray(l.params.collectionId)?b=Number(l.params.collectionId[0]):b=Number(l.params.collectionId),!b){await n.push({name:"problem-collection-list"});return}await p(!0)},{immediate:!0})}),De(()=>{o&&o()}),(D,S)=>{const h=Ke,w=be,u=Pe;return j(),E(u,null,{default:a(()=>[t(w,{style:{margin:"10px"}},{default:a(()=>[R("div",null,[t(h,{data:s.value,columns:y.value,"row-key":"index","rowspan-and-colspan":U,"vertical-align":"middle",bordered:!0,hover:!0,loading:f.value},null,8,["data","columns","loading"])])]),_:1})]),_:1})}}});var Oe=(e=>(e[e.Valid=0]="Valid",e[e.Duplicate=1]="Duplicate",e[e.Invalid=2]="Invalid",e))(Oe||{});const js={class:"dida-form-border"},Ls={style:{"text-align":"right"}},$s=ce({name:"ParseProblemList",__name:"ParseProblemList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:l}=_e(),n=m(!1),i=m(!1),o=m(""),b=ba(e,"modelValue");let g=[];Ue(b,async D=>{JSON.stringify(D)!==JSON.stringify(g)&&(await s(D),g=b.value)},{deep:!0});const y=m([]),f=m([{title:"有效性",colKey:"validType",cell:(D,S)=>{switch(S.row.valid){case Oe.Valid:return t(et,{theme:"success"},{default:()=>[P("有效")]});case Oe.Duplicate:return t(et,{theme:"warning"},{default:()=>[P("重复")]});case Oe.Invalid:return t(et,{theme:"danger"},{default:()=>[P("无效")]});default:return null}}},{title:"问题ID",colKey:"id"},{title:"标题",colKey:"title"}]),s=async D=>{const S=Array.from(new Set(D)),h=await jn(S);if(h.code!==0){N(l,h.code),i.value=!1;return}const w=[],u=h.data.problems;let _=[];D.forEach(v=>{const d=u.find(r=>r.id===v);if(d){const r=w.find(A=>A.id===v);d.valid=r?Oe.Duplicate:Oe.Valid,w.push({id:v,title:d.title,valid:d.valid}),r||_.push(v)}else w.push({id:v,title:"-",valid:Oe.Invalid})}),y.value=w,g=_,b.value=_},U=async()=>{i.value=!0;const D=Pa(o.value);await s(D),n.value=!1,i.value=!1},p=()=>{y.value?o.value=y.value.map(D=>D.id).join(`
`):o.value="",n.value=!0};return(D,S)=>{const h=O,w=Ke,u=Tt,_=ot;return j(),ee(me,null,[R("div",js,[R("div",Ls,[t(h,{onClick:p},{default:a(()=>S[2]||(S[2]=[P("编辑")])),_:1})]),t(w,{data:y.value,columns:f.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(_,{visible:n.value,"onUpdate:visible":S[1]||(S[1]=v=>n.value=v),onConfirm:U,header:"请输入问题ID","confirm-loading":i.value},{default:a(()=>[S[3]||(S[3]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(u,{modelValue:o.value,"onUpdate:modelValue":S[0]||(S[0]=v=>o.value=v),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Ea=de($s,[["__scopeId","data-v-7f4ce589"]]),Us={class:"dida-form-border"},As={style:{"text-align":"right"}},zs=ce({name:"ParseUserList",__name:"ParseUserList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:l}=_e(),n=m(!1),i=m(!1),o=m(""),b=ba(e,"modelValue");let g=[];Ue(b,async h=>{JSON.stringify(h)!==JSON.stringify(g)&&(g=h,await U(h))},{deep:!0});const y=m(),f=m([{title:"有效性",colKey:"validType",cell:(h,w)=>{switch(w.row.valid){case Oe.Valid:return t(et,{theme:"success"},{default:()=>[P("有效")]});case Oe.Duplicate:return t(et,{theme:"warning"},{default:()=>[P("重复")]});case Oe.Invalid:return t(et,{theme:"danger"},{default:()=>[P("无效")]})}}},{title:"Username",colKey:"username"},{title:"昵称",colKey:"nickname"}]),s=(h,w)=>{if(h.code!==0){N(l,h.code),i.value=!1;return}const u=[],_=h.data.users;let v=[];w?w.forEach(d=>{let r=null;if(_&&(r=_.find(A=>A.username.toLowerCase()===d.toLowerCase())),r){const A=u.find(I=>I.username.toLowerCase()===d.toLowerCase()),c=A?Oe.Duplicate:Oe.Valid;u.push({id:r.id,username:r.username,nickname:r.nickname,valid:c}),A||v.push(r.id)}else u.push({id:-1,username:d,nickname:"-",valid:Oe.Invalid})}):_&&_.forEach(d=>{const r=u.find(c=>c.id===d.id),A=r?Oe.Duplicate:Oe.Valid;u.push({id:d.id,username:d.username,nickname:d.nickname,valid:A}),r||v.push(d.id)}),y.value=u,g=v,b.value=v},U=async h=>{const w=Array.from(new Set(h)),u=await Bn(w);s(u)},p=async h=>{const w=Array.from(new Set(h)),u=await Jn(w);s(u,h)},D=async()=>{i.value=!0;const h=Pa(o.value);await p(h),n.value=!1,i.value=!1},S=()=>{y.value?o.value=y.value.map(h=>h.username).join(`
`):o.value="",n.value=!0};return(h,w)=>{const u=O,_=Ke,v=Tt,d=ot;return j(),ee(me,null,[R("div",Us,[R("div",As,[t(u,{onClick:S},{default:a(()=>w[2]||(w[2]=[P("编辑")])),_:1})]),t(_,{data:y.value,columns:f.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(d,{visible:n.value,"onUpdate:visible":w[1]||(w[1]=r=>n.value=r),onConfirm:D,header:"请输入用户Username","confirm-loading":i.value},{default:a(()=>[w[3]||(w[3]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(v,{modelValue:o.value,"onUpdate:modelValue":w[0]||(w[0]=r=>o.value=r),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),qa=de(zs,[["__scopeId","data-v-d2170a86"]]),Rs={style:{margin:"10px"}},Ms={style:{margin:"12px"}},Es={class:"dida-edit-container"},qs=ce({__name:"CollectionEdit",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze(),o=m(""),b=m(!1),g=m(!1),y=m(!1),f=m(null),s=m({title:"",openTime:[],private:!0,problems:[],members:[],description:""}),U=m(""),p=m(""),D=m(!1),S=async()=>{D.value=!0,y.value=!1,D.value=!1},h=async()=>{g.value=!0;try{const d={title:s.value.title,problems:s.value.problems,members:s.value.members,private:s.value.private,description:s.value.description};s.value.openTime[0]&&(d.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(d.end_time=new Date(s.value.openTime[1]));const r=await bs(d);if(r.code!==0){N(n,r.code);return}r.data!=null&&await Y.push({name:"collection-detail",params:{collectionId:r.data}}),Ge(n,"创建成功")}finally{g.value=!1}},w=async()=>{g.value=!0;try{const d={id:Number(o.value),title:s.value.title,private:s.value.private,problems:s.value.problems,members:s.value.members,description:s.value.description};s.value.openTime[0]&&(d.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(d.end_time=new Date(s.value.openTime[1]));const r=await hs(d);if(r.code!==0){N(n,r.code);return}r.data!=null&&f.value&&(f.value.updateTime=new Date(r.data).toLocaleString()),Ge(n,"保存成功")}finally{g.value=!1}},u=d=>{s.value.description=d,b.value=!1};async function _(d,r){g.value=!0,ge(n,"本界面暂不支持上传图片"),g.value=!1}const v=async()=>{const d=await vs(o.value);if(d.code!==0){N(n,d.code),console.error("collection get failed",d.code),await Y.push({name:"problem-collection-list"});return}const r=d.data.collection;f.value=Yt(r),s.value.title=r.title,s.value.openTime=[],r.start_time?s.value.openTime.push(new Date(r.start_time)):s.value.openTime.push(""),r.end_time?s.value.openTime.push(new Date(r.end_time)):s.value.openTime.push(""),s.value.private=r.private,s.value.description=r.description,s.value.problems=r.problems,s.value.members=r.members,i.setTitle(r.title+" - "+i.getTitle);let A="";r.description&&(A=r.description),u(A)};return pe(async()=>{Array.isArray(l.params.collectionId)?o.value=l.params.collectionId[0]:o.value=l.params.collectionId,o.value?(b.value=!0,await v()):u("")}),(d,r)=>{const A=Re,c=ze,I=Ot,z=gt,k=Ae,x=be,T=Te,V=O,C=he,$=Ye,L=We,M=Pe,F=Ee("md-editor-v3"),te=Ve,X=Tt,ae=ot;return j(),ee(me,null,[t(te,{loading:b.value},{default:a(()=>[t(M,null,{default:a(()=>[t(T,{span:8},{default:a(()=>[R("div",Rs,[t(x,{class:"sh-card"},{default:a(()=>[t(k,{model:s.value},{default:a(()=>[t(c,{label:"标题"},{default:a(()=>[t(A,{modelValue:s.value.title,"onUpdate:modelValue":r[0]||(r[0]=Q=>s.value.title=Q),placeholder:"题集标题"},null,8,["modelValue"])]),_:1}),t(c,{label:"开启时间"},{default:a(()=>[t(I,{modelValue:s.value.openTime,"onUpdate:modelValue":r[1]||(r[1]=Q=>s.value.openTime=Q),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(c,{label:"私有"},{default:a(()=>[t(z,{modelValue:s.value.private,"onUpdate:modelValue":r[2]||(r[2]=Q=>s.value.private=Q)},null,8,["modelValue"])]),_:1}),t(c,{label:"成员"},{default:a(()=>[t(qa,{modelValue:s.value.members,"onUpdate:modelValue":r[3]||(r[3]=Q=>s.value.members=Q)},null,8,["modelValue"])]),_:1}),t(c,{label:"问题"},{default:a(()=>[t(Ea,{modelValue:s.value.problems,"onUpdate:modelValue":r[4]||(r[4]=Q=>s.value.problems=Q)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(T,{span:4},{default:a(()=>[R("div",Ms,[R("div",Es,[o.value?(j(),E(C,{key:0},{default:a(()=>[t(V,{onClick:w,theme:"danger",loading:g.value},{default:a(()=>r[8]||(r[8]=[P("保存")])),_:1},8,["loading"])]),_:1})):(j(),E(C,{key:1},{default:a(()=>[t(V,{onClick:h,theme:"danger",loading:g.value},{default:a(()=>r[9]||(r[9]=[P("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(j(),E(L,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t($,{label:"创建时间"},{default:a(()=>{var Q;return[P(q((Q=f.value)==null?void 0:Q.createTime),1)]}),_:1}),t($,{label:"更新时间"},{default:a(()=>{var Q;return[P(q((Q=f.value)==null?void 0:Q.updateTime),1)]}),_:1}),t($,{label:"创建用户"},{default:a(()=>{var Q;return[P(q((Q=f.value)==null?void 0:Q.ownerNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),t(F,{id:"collection-description-editor",modelValue:s.value.description,"onUpdate:modelValue":r[5]||(r[5]=Q=>s.value.description=Q),onSave:w,onOnUploadImg:_,previewTheme:"cyanosis",class:"dida-description-editor"},null,8,["modelValue"]),t(te,{loading:g.value,attach:"#collection-description-editor","z-index":1e5},null,8,["loading"])]),_:1},8,["loading"]),t(ae,{visible:y.value,"onUpdate:visible":r[7]||(r[7]=Q=>y.value=Q),onConfirm:S,header:U.value,"confirm-loading":D.value},{default:a(()=>[r[10]||(r[10]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(X,{modelValue:p.value,"onUpdate:modelValue":r[6]||(r[6]=Q=>p.value=Q),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),sa=de(qs,[["__scopeId","data-v-2a875f8a"]]);function ra(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!at(e)}const Ks=ce({__name:"JudgeJobList",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=!1,b=null,g;const y=m(!1),f=m(null),s=m(!1);let U=-1;const p=m({problemId:"",username:"",language:void 0,status:void 0}),D=m([{title:"ID",colKey:"id",cell:(V,C)=>{let $=null;return Ct(C.row.status)&&St(C.row.language)&&($=()=>{c(C.row.id)}),t(O,{variant:"text",onClick:$},{default:()=>[C.row.id]})}},{title:"问题",colKey:"problemId",cell:(V,C)=>{if(U){let $;return t(O,{variant:"text",onClick:()=>ft(U,C.row.contestProblemIndex)},ra($=tt(C.row.contestProblemIndex))?$:{default:()=>[$]})}return t(O,{variant:"text",onClick:()=>A(C.row.problemId)},{default:()=>[C.row.problemId]})}},{title:"状态",colKey:"status",align:"center",cell:(V,C)=>{let $=null;Ct(C.row.status)&&St(C.row.language)&&($=()=>{c(C.row.id)});const L=C.row.status,M=Pt(L);let F=!Ct(L);const te=Va(L);let X=[];return ut(L)&&X.push(t(Ve,{text:C.row.state,size:"small",class:"dida-status-loading"},null)),X.push(t("span",null,[M])),t(O,{theme:te,variant:"outline",onClick:$,disabled:F},ra(X)?X:{default:()=>[X]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"code",cell:(V,C)=>{let $=!St(C.row.language);return t(O,{theme:"default",onClick:()=>r(C.row),disabled:$},{default:()=>[It(C.row.language)+" / "+C.row.codeLength]})}},{title:"作者",colKey:"author",width:200,cell:(V,C)=>t(O,{variant:"text",onClick:()=>I(C.row.authorUsername)},{default:()=>[C.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),S=m(!1);let h=1,w=50;const u=m({current:h,pageSize:w,defaultCurrent:h,defaultPageSize:w,total:0,pageSizeOptions:[50,100]}),_=m(),v=m([]);v.value=Gt();const d=m([]);d.value=Da();const r=async V=>{s.value=!0,y.value=!0;try{f.value=V;const C=await un(Number(f.value.id));if(C.code===0){const $=C.data,L=Ht($.language);f.value.code=`\`\`\`${L}
${$.code}
\`\`\``}else N(i,C.code)}finally{s.value=!1}},A=V=>{V&&n.push({path:"/problem/"+V})},c=V=>{V&&(U>0?n.push({name:"contest-judge-detail",params:{contestId:U,judgeId:V}}):n.push({name:"judge-detail",params:{judgeId:V}}))},I=V=>{V&&n.push({path:"/user/"+V})},z=async()=>{await n.push({query:{...l.query,page:1,page_size:w,problem_id:p.value.problemId,username:p.value.username,language:p.value.language,status:p.value.status}})},k=async()=>{p.value.problemId="",p.value.username="",p.value.language=void 0,p.value.status=void 0,await n.push({query:{...l.query,page:1,page_size:w,problem_id:"",username:"",language:void 0,status:void 0}})},x=async(V,C)=>{C&&(S.value=!0);let $=!1;try{const{current:L,pageSize:M}=V,F=await dn(U,p.value.problemId,p.value.username,p.value.language,p.value.status,L,M);if(_.value=[],F.code===0){if(!F.data.has_auth){we(i,"您目前没有权限查看评测记录"),U?await n.push({name:"contest-detail",params:{contestId:U}}):await n.push({name:"judge-list"});return}F.data.list&&F.data.list.length>0?(F.data.list.forEach(X=>{var Q;const ae=ja(X);(Q=_.value)==null||Q.push(ae),ut(X.status)&&($=!0)}),u.value={...u.value,total:F.data.total_count}):(we(i,"未找到记录"),u.value={...u.value,total:0})}else C&&N(i,F.code)}catch(L){console.error(L),C&&N(i,He())}finally{C&&(S.value=!1),$&&o&&(g=setTimeout(()=>{x({current:h,pageSize:w},!1)},5e3))}},T=async V=>{await n.push({query:{...l.query,page:V.current,page_size:V.pageSize}})};return pe(async()=>{o=!0,b=Ue(()=>l.query,V=>{Array.isArray(l.params.contestId)?U=Number(l.params.contestId[0]):U=Number(l.params.contestId),p.value.problemId=V.problem_id||"",p.value.username=V.username||"",V.language!=null?p.value.language=Number(V.language):p.value.language=void 0,V.status!=null?p.value.status=Number(V.status):p.value.status=void 0;const C=parseInt(V.page)||u.value.defaultCurrent,$=parseInt(V.page_size)||u.value.defaultPageSize;h=C,w=$,u.value.pageSizeOptions.includes(w)||(w=u.value.defaultPageSize),u.value={...u.value,current:h,pageSize:w},x({current:h,pageSize:w},!0)},{immediate:!0})}),De(()=>{o=!1,b&&b(),clearTimeout(g)}),(V,C)=>{const $=Re,L=ze,M=Nt,F=_t,te=O,X=he,ae=Ae,Q=Ke,B=be,ie=nt,ue=Ee("md-preview"),ye=Ve,W=ot;return j(),ee(me,null,[t(B,{style:{margin:"10px"}},{default:a(()=>[t(ae,{layout:"inline",onSubmit:z,onReset:k},{default:a(()=>[t(L,{label:"题号"},{default:a(()=>[t($,{modelValue:p.value.problemId,"onUpdate:modelValue":C[0]||(C[0]=K=>p.value.problemId=K),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(L,{label:"用户"},{default:a(()=>[t($,{modelValue:p.value.username,"onUpdate:modelValue":C[1]||(C[1]=K=>p.value.username=K),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(L,{label:"语言"},{default:a(()=>[t(F,{modelValue:p.value.language,"onUpdate:modelValue":C[2]||(C[2]=K=>p.value.language=K),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:a(()=>[(j(!0),ee(me,null,xe(v.value,K=>(j(),E(M,{key:K.value,value:K.value,label:K.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(L,{label:"状态"},{default:a(()=>[t(F,{modelValue:p.value.status,"onUpdate:modelValue":C[3]||(C[3]=K=>p.value.status=K),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:a(()=>[(j(!0),ee(me,null,xe(d.value,K=>(j(),E(M,{key:K.value,value:K.value,label:K.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(L,null,{default:a(()=>[t(X,null,{default:a(()=>[t(te,{theme:"primary",type:"submit"},{default:a(()=>C[7]||(C[7]=[P("搜索")])),_:1}),t(te,{theme:"default",variant:"base",type:"reset"},{default:a(()=>C[8]||(C[8]=[P("重置")])),_:1})]),_:1})]),_:1})]),_:1}),t(Q,{data:_.value,columns:D.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:u.value,loading:S.value,onPageChange:T,"table-layout":"auto"},null,8,["data","columns","pagination","loading"])]),_:1}),t(W,{visible:y.value,"onUpdate:visible":C[5]||(C[5]=K=>y.value=K),width:"800px","cancel-btn":null,"close-btn":!1,onConfirm:C[6]||(C[6]=K=>y.value=!1)},{header:a(()=>[t(ie,{onClick:C[4]||(C[4]=()=>{var K;c((K=f.value)==null?void 0:K.id)})},{default:a(()=>{var K,Z,J;return[P(q(((K=f.value)==null?void 0:K.id)+" - "+fe(It)((Z=f.value)!=null&&Z.language?(J=f.value)==null?void 0:J.language:fe(jt).Unknown)),1)]}),_:1})]),default:a(()=>[t(ye,{loading:s.value},{default:a(()=>{var K;return[t(ue,{"model-value":(K=f.value)==null?void 0:K.code,"code-foldable":!1,style:{"min-height":"100px"}},null,8,["model-value"])]}),_:1},8,["loading"])]),_:1},8,["visible"])],64)}}}),ia=de(Ks,[["__scopeId","data-v-1ade2410"]]),Fs={class:"dida-code-container"},Ns={style:{margin:"20px"}},Os={key:2,class:"dida-edit-container"};function At(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!at(e)}const Gs=ce({__name:"JudgeJobDetail",setup(e){const l=Se(),n=Xe(),i=qe(),{globalProperties:o}=_e();let b=!1,g,y=0,f=0;const s=m(""),U=m(null),p=m(""),D=m(0),S=m(null),h=m({from:"#5a96ff",to:"#00A870"}),w=m([{title:"ID",colKey:"id"},{title:"问题",colKey:"problemId",cell:(k,x)=>{if(f){let T;return t(O,{variant:"text",onClick:()=>ft(f,x.row.contestProblemIndex)},At(T=tt(x.row.contestProblemIndex))?T:{default:()=>[T]})}return t(O,{variant:"text",onClick:()=>A(x.row.problemId)},{default:()=>[x.row.problemId]})}},{title:"状态",colKey:"status",align:"center",cell:(k,x)=>{const T=x.row.status,V=Pt(T),C=Va(T);let $=[];return ut(T)&&$.push(t(Ve,{text:x.row.state,size:"small",class:"dida-status-loading"},null)),$.push(t("span",null,[V])),t(O,{theme:C,variant:"outline"},At($)?$:{default:()=>[$]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"language",cell:(k,x)=>t("span",null,[It(x.row.language)+" / "+x.row.codeLength])},{title:"作者",colKey:"author",width:200,cell:(k,x)=>t(O,{variant:"text",onClick:()=>c(x.row.authorUsername)},{default:()=>[x.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),u=m(!1),_=m(!1),v=m(),d=Je(()=>i.hasAuth(Le.ManageJudge)),r=async()=>{if(!_.value){_.value=!0;try{const k=await vn(y);k.code===0?await z(!0):N(o,k.code)}catch(k){console.error(k),N(o,He())}finally{_.value=!1}}},A=k=>{k&&n.push({path:"/problem/"+k})},c=k=>{k&&n.push({path:"/user/"+k})},I=k=>{const x=k.status,T=Pt(x);let V;switch(x){case Be.Init:case Be.Rejudge:case Be.Compiling:case Be.Running:V="default";break;case Be.Accept:V="success";break;case Be.PE:V="warning";break;default:V="danger";break}return t(he,null,{default:()=>[t(O,{theme:"default",variant:"outline"},{default:()=>[k.taskId]}),t(O,{theme:V,variant:"outline"},At(T)?T:{default:()=>[T]}),t("span",null,[P("分数："),k.score]),t("span",null,[P("用时："),k.time]),t("span",null,[P("内存："),k.memory])]})},z=async k=>{var T;k&&(u.value=!0);let x=!1;try{const V=await rn(y,f);if(v.value=[],V.code===0){const C=V.data,$=ja(C);if((T=v.value)==null||T.push($),s.value=$.judgerName,h.value.to="#00A870",ut(C.status)?(S.value="active",$.taskTotal>0?(D.value=Number(($.taskCurrent/$.taskTotal*100).toFixed(2)),$.taskCurrent>=$.taskTotal&&(D.value=99)):D.value=0):(D.value=100,C.status===Be.Accept?S.value="success":C.status===Be.PE?(h.value.to="#F57C20",S.value="warning"):(h.value.to="#F56C6C",S.value="error")),C.code){const L=Ht(C.language);p.value=`\`\`\`${L}
${C.code}
\`\`\``}U.value=$,ut(C.status)&&(x=!0)}else k&&N(o,V.code),f?await n.push({name:"contest-judge",params:{contestId:f}}):await n.push({name:"judge-list"})}catch(V){console.error(V),k&&N(o,He())}finally{k&&(u.value=!1),x&&b&&(g=setTimeout(()=>{z(!1)},5e3))}};return pe(async()=>{if(b=!0,Array.isArray(l.params.judgeId)?y=Number(l.params.judgeId[0]):y=Number(l.params.judgeId),Array.isArray(l.params.contestId)?f=Number(l.params.contestId[0]):f=Number(l.params.contestId),!y){await n.push({name:"judge"});return}await z(!0)}),De(()=>{b=!1,clearTimeout(g)}),(k,x)=>{var B,ie,ue;const T=Ft,V=Ke,C=be,$=Ee("md-preview"),L=Te,M=Ye,F=We,te=Pe,X=Il,ae=Pl,Q=O;return j(),ee(me,null,[t(T,{color:h.value,status:S.value,class:"dida-job-progress",percentage:D.value},null,8,["color","status","percentage"]),t(C,{style:{margin:"10px"}},{default:a(()=>[t(V,{data:v.value,columns:w.value,"row-key":"id","vertical-align":"top",hover:!0,loading:u.value},null,8,["data","columns","loading"])]),_:1}),t(te,null,{default:a(()=>[t(L,{span:8},{default:a(()=>[R("div",Fs,[t($,{"model-value":p.value,class:"dida-code-div"},null,8,["model-value"])])]),_:1}),t(L,{span:4},{default:a(()=>[R("div",Ns,[t(F,{layout:"vertical",bordered:!0},{default:a(()=>[t(M,{label:"判题机"},{default:a(()=>[P(q(s.value),1)]),_:1}),t(M,{label:"判题时间"},{default:a(()=>{var ye;return[P(q((ye=U.value)==null?void 0:ye.judgeTime),1)]}),_:1})]),_:1}),t(C,{class:"dida-card-tips"},{default:a(()=>{var ye;return[P(q(u.value?"数据正在加载，请等待":fe(ta)((ye=U.value)==null?void 0:ye.status)),1)]}),_:1})])]),_:1})]),_:1}),(B=U.value)!=null&&B.compileMessage?(j(),E(C,{key:0,class:"compile-message"},{default:a(()=>{var ye;return[P(q((ye=U.value)==null?void 0:ye.compileMessage),1)]}),_:1})):le("",!0),(ie=U.value)!=null&&ie.task&&((ue=U.value)==null?void 0:ue.task.length)>0?(j(),E(ae,{key:1,class:"task-panel"},{default:a(()=>{var ye;return[(j(!0),ee(me,null,xe((ye=U.value)==null?void 0:ye.task,(W,K)=>(j(),E(X,{key:W.taskId,header:()=>I(W)},{default:a(()=>[t(C,null,{default:a(()=>[P(q(fe(ta)(W.status)),1)]),_:2},1024),W.content?(j(),E(C,{key:0,class:"dida-card-tips"},{default:a(()=>[t($,{"model-value":W.content},null,8,["model-value"])]),_:2},1024)):le("",!0),W.waHint?(j(),E(C,{key:1,class:"dida-card-tips"},{default:a(()=>[t($,{"model-value":W.waHint},null,8,["model-value"])]),_:2},1024)):le("",!0)]),_:2},1032,["header"]))),128))]}),_:1})):le("",!0),d.value?(j(),ee("div",Os,[t(Q,{onClick:r,loading:_.value},{default:a(()=>x[0]||(x[0]=[P("重新评测")])),_:1},8,["loading"])])):le("",!0)],64)}}}),ua=de(Gs,[["__scopeId","data-v-aab721fd"]]),Hs={style:{margin:"10px"}},Bs=ce({__name:"ContestList",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=null;const b=m([{title:"ID",colKey:"id",cell:(v,d)=>t(O,{variant:"text",onClick:()=>D(d.row.id)},{default:()=>[d.row.id]})},{title:"标题",colKey:"title",cell:(v,d)=>t(O,{variant:"text",onClick:()=>D(d.row.id)},{default:()=>[d.row.title]})},{title:"负责人",colKey:"ownerNickname",cell:(v,d)=>t(O,{variant:"text",onClick:()=>Wt(n,d.row.ownerUsername)},{default:()=>[d.row.ownerNickname]})},{title:"权限",colKey:"private",cell:(v,d)=>d.row.private?"私有":"公开"},{title:"开始时间",colKey:"startTime"},{title:"结束时间",colKey:"endTime"}]),g=m(!1);let y=1,f=50;const s=m({current:y,pageSize:f,defaultCurrent:y,defaultPageSize:f,total:0,pageSizeOptions:[50,100]}),U=m(),p=m({title:"",username:""}),D=v=>{v&&n.push({path:"/contest/"+v})},S=async()=>{await n.push({query:{...l.query,title:p.value.title,username:p.value.username,page:1,page_size:s.value.defaultPageSize}})},h=async()=>{p.value.title="",p.value.username="",await n.push({query:{...l.query,title:"",username:"",page:1,page_size:s.value.defaultPageSize}})},w=async(v,d)=>{var r;g.value=!0;try{const{current:A,pageSize:c}=v,I=await Io(p.value.title,p.value.username,A,c);if(U.value=[],I.code===0){const z=I.data.list;for(let k=0;k<z.length;k++){const x=z[k],T=Jt(x);(r=U.value)==null||r.push(T)}s.value={...s.value,total:I.data.total_count}}else d&&N(i,I.code)}catch(A){console.error(A),N(i,He())}finally{g.value=!1}},u=async v=>{await n.push({query:{...l.query,page:v.current,page_size:v.pageSize}})},_=()=>{n.push({name:"contest-create"})};return pe(async()=>{o=Ue(()=>l.query,v=>{p.value.title=v.title||"",p.value.username=v.username||"";const d=parseInt(v.page)||s.value.defaultCurrent,r=parseInt(v.page_size)||s.value.defaultPageSize;y=d,f=r,s.value={...s.value,current:y,pageSize:f},w({current:y,pageSize:f},!0)},{immediate:!0})}),De(()=>{o&&o()}),(v,d)=>{const r=Ke,A=be,c=Te,I=Re,z=ze,k=O,x=he,T=Ae,V=Pe;return j(),E(V,null,{default:a(()=>[t(c,{span:9},{default:a(()=>[t(A,{style:{margin:"10px"}},{default:a(()=>[t(r,{data:U.value,columns:b.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:s.value,loading:g.value,"table-layout":"auto",onPageChange:u,style:{"white-space":"nowrap"}},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(c,{span:3},{default:a(()=>[R("div",Hs,[t(A,{class:"sh-card"},{default:a(()=>[t(T,{model:p.value,onSubmit:S,onReset:h},{default:a(()=>[t(z,{label:"标题"},{default:a(()=>[t(I,{modelValue:p.value.title,"onUpdate:modelValue":d[0]||(d[0]=C=>p.value.title=C),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(z,{label:"负责人"},{default:a(()=>[t(I,{modelValue:p.value.username,"onUpdate:modelValue":d[1]||(d[1]=C=>p.value.username=C),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(z,null,{default:a(()=>[t(x,null,{default:a(()=>[t(k,{theme:"primary",type:"submit"},{default:a(()=>d[2]||(d[2]=[P("提交")])),_:1}),t(k,{theme:"danger",type:"reset"},{default:a(()=>d[3]||(d[3]=[P("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(A,{class:"sh-card"},{default:a(()=>[t(x,null,{default:a(()=>[t(k,{onClick:_},{default:a(()=>d[4]||(d[4]=[P("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),da=de(Bs,[["__scopeId","data-v-d94af270"]]),Js={style:{margin:"20px"}},Ws={style:{margin:"10px"}},Ys={style:{"text-align":"center","align-content":"center",padding:"20px",height:"500px"}},Xs={style:{"text-align":"center",width:"100%"}},Zs={class:"dida-operation-container"},Qs={style:{margin:"12px"}},er=ce({__name:"ContestDetail",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze(),o=qe(),b=m(!1);let g=0;const y=m(!1),f=m(null),s=m(!1),U=m(!1),p=m(""),D=Je(()=>o.hasAuth(Le.ManageContest)||f.value&&o.getUserId==f.value.ownerId),S=c=>{if(!c||!u)return"default";const I=u[c];if(!I)return"default";switch(I){case $e.Accept:return"success";case $e.Attempt:return"warning";default:return"default"}},h=m([{title:"问题ID",colKey:"index",cell:(c,I)=>{const z=S(I.row.index);return t(O,{variant:"dashed",theme:z,onClick:async()=>await ft(g,I.row.index)},{default:()=>[I.row.id]})}},{title:"标题",colKey:"title",cell:(c,I)=>t(O,{variant:"text",onClick:async()=>await ft(g,I.row.index)},{default:()=>[I.row.title]})},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),w=m([]);let u={},_=m(!1);const v=()=>{Y.push({name:"contest-edit",params:{contestId:g}})},d=async()=>{b.value=!0;try{const c=await Do(g);if(c.code!==0){N(n,c.code);return}const I=c.data;we(n,"查重报告已生成，请前往查看"),window.open(I,"_blank")}finally{b.value=!1}},r=async c=>{if(!o.isLogin()){await Y.push({name:"login"});return}if(!p.value){ge(n,"请输入密码");return}_.value=!0;try{const I=await Vo(g,p.value);if(I.code!==0){N(n,I.code);return}we(n,"申请访问成功"),await A()}catch(I){console.error("Error submitting contest password:",I),N(n,"提交密码失败，请稍后再试")}finally{_.value=!1}},A=async()=>{y.value=!0;const c=await yo(g);if(c.code!==0){y.value=!1,N(n,c.code),await Y.push({name:"contest"});return}s.value=c.data.has_auth,U.value=c.data.need_password,f.value=Jt(c.data.contest),w.value=f.value.problems,u=c.data.attempt_status||{},i.setTitle(f.value.title+" - "+i.getTitle),y.value=!1};return pe(async()=>{if(Array.isArray(l.params.contestId)?g=Number(l.params.contestId[0]):g=Number(l.params.contestId),!g){await Y.push({name:"contest"});return}await A()}),(c,I)=>{const z=xt,k=Ke,x=be,T=Re,V=ze,C=O,$=Ae,L=Te,M=he,F=Ye,te=We,X=Ee("md-preview"),ae=Pe,Q=Ve;return j(),E(Q,{loading:y.value},{default:a(()=>[t(ae,{class:"dida-main-content"},{default:a(()=>[t(L,{span:6},{default:a(()=>{var B,ie,ue;return[R("div",Js,[R("h1",null,q((B=f.value)==null?void 0:B.title),1),(ie=f.value)!=null&&ie.notification?(j(),E(z,{key:0,theme:"info",message:(ue=f.value)==null?void 0:ue.notification},null,8,["message"])):le("",!0)]),R("div",Ws,[s.value?(j(),E(x,{key:0},{default:a(()=>[t(k,{data:w.value,columns:h.value,"row-key":"id","table-layout":"auto","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1})):(j(),E(x,{key:1},{default:a(()=>[R("div",Ys,[t(z,{theme:"warning",message:"您没有查看本比赛的权限"}),U.value?(j(),E($,{key:0,style:{margin:"20px auto 0",width:"200px"},onSubmit:r,"label-width":"0"},{default:a(()=>[t(V,null,{default:a(()=>[t(T,{placeholder:"请输入密码",value:p.value,"onUpdate:value":I[0]||(I[0]=ye=>p.value=ye),style:{width:"300px"},type:"password",autocomplete:"new-password"},null,8,["value"])]),_:1}),t(V,null,{default:a(()=>[R("div",Xs,[t(C,{theme:"primary",type:"submit",loading:fe(_)},{default:a(()=>I[1]||(I[1]=[P("提交")])),_:1},8,["loading"])])]),_:1})]),_:1})):le("",!0)])]),_:1}))])]}),_:1}),t(L,{span:6},{default:a(()=>{var B;return[R("div",Zs,[t(M,null,{default:a(()=>[D.value?(j(),E(C,{key:0,onClick:d,loading:b.value},{default:a(()=>I[2]||(I[2]=[P("查重")])),_:1},8,["loading"])):le("",!0),D.value?(j(),E(C,{key:1,onClick:v},{default:a(()=>I[3]||(I[3]=[P("编辑")])),_:1})):le("",!0)]),_:1})]),R("div",Qs,[t(te,{layout:"vertical",bordered:!0},{default:a(()=>[t(F,{label:"创建时间"},{default:a(()=>{var ie;return[P(q((ie=f.value)==null?void 0:ie.createTime),1)]}),_:1})]),_:1}),t(te,{layout:"vertical",bordered:!0},{default:a(()=>[t(F,{label:"更新时间"},{default:a(()=>{var ie;return[P(q((ie=f.value)==null?void 0:ie.updateTime),1)]}),_:1})]),_:1}),t(te,{layout:"vertical",bordered:!0},{default:a(()=>[t(F,{label:"开始时间"},{default:a(()=>{var ie;return[P(q((ie=f.value)==null?void 0:ie.startTime),1)]}),_:1})]),_:1}),t(te,{layout:"vertical",bordered:!0},{default:a(()=>[t(F,{label:"结束时间"},{default:a(()=>{var ie;return[P(q((ie=f.value)==null?void 0:ie.endTime),1)]}),_:1})]),_:1})]),(B=f.value)!=null&&B.description?(j(),E(x,{key:0,style:{margin:"12px"}},{default:a(()=>{var ie;return[t(X,{"model-value":(ie=f.value)==null?void 0:ie.description,class:"dida-content-description"},null,8,["model-value"])]}),_:1})):le("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),tr=de(er,[["__scopeId","data-v-af022b1b"]]);function Ka(e){return e?Math.floor(e/1e9):0}function it(e){if(e<=0)return"0秒";let l="";const n=Math.floor(e/3600);n>0&&(l+=`${n}小时`);const i=Math.floor(e%3600/60);return(i>0||n>0)&&(n>0&&i<10&&(l+="0"),l+=`${i}分钟`),e=e%60,(e>0||i>0||n>0)&&((n>0||i>0)&&e<10&&(l+="0"),l+=`${e.toFixed(0)}秒`),l}const ar=vt("contest",{state:()=>({starMembers:{}}),actions:{clear(){this.$patch({starMembers:{}})},addStarMember(e,l){this.starMembers[e]||(this.starMembers[e]={}),this.starMembers[e][l]=!0},removeStarMember(e,l){this.starMembers[e]&&(delete this.starMembers[e][l],Object.keys(this.starMembers[e]).length===0&&delete this.starMembers[e])},isStarMember(e,l){var n;return!!((n=this.starMembers[e])!=null&&n[l])}},persist:!0}),lr={style:{margin:"10px 10px 40px"}},nr={style:{"text-align":"right","margin-bottom":"10px"}},or={class:"table-scroll-wrapper"};function ca(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!at(e)}const sr=ce({__name:"ContestRank",setup(e){const l=Se(),n=Xe(),i=ar(),{globalProperties:o}=_e();let b=!1,g=null,y=0,f=null,s=null,U=0;const p=m(0),D=m(0),S=m(!1),h=m(!0),w=m(!0);let u=null,_=null,v=1,d=50;const r=m({current:v,pageSize:d,defaultCurrent:1,defaultPageSize:50,total:0,pageSizeOptions:[50,100,1e3]}),A=W=>i&&i.isStarMember(y,W),c=async W=>{r.value={...r.value,current:W.current,pageSize:W.pageSize},await n.push({query:{...l.query,page:W.current,page_size:W.pageSize}})},I=W=>{if(W==null)return"-";const K=Math.floor(W/3600).toString().padStart(2,"0"),Z=Math.floor(W%3600/60).toString().padStart(2,"0"),J=(W%60).toFixed(0).toString().padStart(2,"0");return`${K}:${Z}:${J}`},z=m({});let k={userId:0,ac:-1};const x=[{title:"Rank",colKey:"rank",align:"center",fixed:"left"},{title:"昵称",colKey:"nickname",fixed:"left",attrs:W=>{let K={};return A(W.row.userId)&&(K={backgroundColor:"rgba(255,165,30,0.5)"}),{style:K}},cell:(W,K)=>{const Z=Nl(K.row.nickname,18);let J=null;return A(K.row.userId)?J=t(O,{shape:"circle",variant:"text",class:"rank-unstar-button",onClick:()=>{i.removeStarMember(y,K.row.userId),ie()}},{default:()=>[t(ol,{slot:"icon"},null)]}):J=t(O,{shape:"circle",variant:"text",class:"rank-star-button",onClick:()=>{i.addStarMember(y,K.row.userId),ie()}},{default:()=>[t(sl,{slot:"icon"},null)]}),t("div",{class:"rank-nickname-cell"},[t(he,null,{default:()=>[t(Tl,{content:K.row.nickname},{default:()=>[t(O,{variant:"text",onClick:()=>n.push({name:"user",params:{username:K.row.username}})},ca(Z)?Z:{default:()=>[Z]})]}),J]})])}},{title:"Solved",colKey:"solved",align:"center",fixed:"left",cell:(W,K)=>t(O,{variant:"text",onClick:()=>n.push({name:"contest-judge",params:{contestId:y},query:{username:K.row.username,status:Be.Accept}})},{default:()=>[K.row.solved]})},{title:"Penalty",colKey:"penalty",align:"center",fixed:"left",cell:(W,K)=>I(K.row.penalty)}],T=m([]),V=m(!1);let C=[],$=[];const L=m([]);let M=[];const F=({col:W,rowIndex:K})=>{if(W.colKey==="rank"){let Z=r.value.current;r.value.current>Math.ceil(L.value.length/r.value.pageSize)&&(Z=Math.ceil(L.value.length/r.value.pageSize));let J=r.value.pageSize*(Z-1),oe=1;for(let ne=K+1;J+ne<L.value.length&&L.value[J+ne].rank===L.value[J+K].rank;ne++)oe++;return{rowspan:oe}}},te=(W,{value:K})=>it(K),X=()=>{u&&clearInterval(u),u=setInterval(()=>{b&&ye(!1)},3e4),_&&clearInterval(_),_=setInterval(()=>{if(!b)return;p.value=(new Date().getTime()-f.getTime())/1e3;const W=Math.min(p.value,D.value);p.value=Math.min(p.value,W),ie()},1e3)},ae=()=>{u&&(clearInterval(u),u=null),_&&(clearInterval(_),_=null)},Q=async W=>{w.value=W,W?(await ye(!1),X()):ae()},B=()=>{ie(),r.value={...r.value,current:1}},ie=()=>{L.value=[];let W=[];k={};for(let H=0;H<C.length;H++){const se=C[H];let ve={userId:se.author_id,username:se.author_username,nickname:se.author_nickname},je=0,Me=0;se.problems.forEach(ke=>{let Fe=-1,lt=ke.lock||0;if(ke.ac){if(Fe=(new Date(ke.ac).getTime()-(f==null?void 0:f.getTime()))/1e3,Fe>p.value)return;je++,Me+=Fe,Me+=ke.attempt*20*60,k[ke.index]===void 0?k[ke.index]={userId:se.author_id,ac:Fe}:k[ke.index].ac>Fe&&(k[ke.index].userId=se.author_id,k[ke.index].ac=Fe)}if(lt>0&&U>0){const yt=D.value-U;p.value<yt&&(lt=0)}const st=ke.index;ve[`problem_${st}`]={acDuration:Fe,attempt:ke.attempt||0,lock:lt}}),ve.solved=je,ve.penalty=Me,W.push(ve)}W.sort((H,se)=>H.solved!==se.solved?se.solved-H.solved:H.penalty!==se.penalty?H.penalty-se.penalty:H.userId-se.userId);const K=$;let Z=0,J=0,oe=-1,ne=-1;for(let H=0;H<W.length;H++)K&&K.includes(W[H].userId)?W[H].rank="*":(J++,(W[H].solved!==oe||W[H].penalty!==ne)&&(Z=J,oe=W[H].solved,ne=W[H].penalty),W[H].rank=String(Z));S.value&&(W=W.filter(H=>A(H.userId)));const Ie=document.querySelectorAll("tbody tr"),Ce={};M.forEach((H,se)=>{const ve=Ie[se];ve&&(Ce[H.userId]=ve.getBoundingClientRect())}),r.value={...r.value,total:W.length},L.value=W;for(let H=0;H<L.value.length;H++)L.value[H].index=H+1;if(M=[...L.value],h.value){const H={},se=document.querySelectorAll("table tbody tr");L.value.forEach((ve,je)=>{const Me=se[je];Me&&(H[ve.userId]=Me.getBoundingClientRect())}),requestAnimationFrame(()=>{const ve=document.querySelectorAll("table tbody tr");L.value.forEach((je,Me)=>{const ke=ve[Me],Fe=Ce[je.userId],lt=H[je.userId];if(Fe&&lt){const st=Fe.top-lt.top;st!==0&&(ke.style.transition="none",ke.style.transform=`translateY(${st}px)`)}}),requestAnimationFrame(()=>{document.querySelectorAll("table tbody tr").forEach(Me=>{Me.style.transition="transform 300ms ease",Me.style.transform=""})})})}},ue=W=>{Q(!1),p.value=W;const K=Math.min(D.value,(new Date().getTime()-(f==null?void 0:f.getTime()))/1e3);p.value=Math.min(p.value,K),ie()},ye=async W=>{W&&(V.value=!0);try{const K=await Po(y);if(T.value=[...x],C=[],$=[],L.value=[],r.value={...r.value,total:0},K.code===0){if(!K.data.has_auth){we(o,"您目前没有权限查看比赛排名"),await n.push({name:"contest-detail",params:{contestId:y}});return}K.data.problems.sort((oe,ne)=>oe-ne),K.data.problems.forEach((oe,ne)=>{T.value.push({colKey:`problem_${oe}`,align:"center",title:()=>{let Ie;return t(O,{variant:"text",onClick:()=>n.push({name:"contest-problem-detail",params:{contestId:y,problemIndex:oe}})},ca(Ie=tt(oe))?Ie:{default:()=>[Ie]})},cell:(Ie,Ce)=>{const H=Ce.row[`problem_${oe}`];if(!H)return"";let se="";return H.acDuration>=0&&(se=I(H.acDuration)),H.attempt>0&&(se&&(se+=" "),se+=`(-${H.attempt})`),H.lock>0&&(se&&(se+=" "),se+=`(+${H.lock})`),t("span",null,[se])},attrs:Ie=>{const Ce=Ie.row[`problem_${oe}`];if(!Ce)return{};if(Ce.acDuration>=0){const H=k[oe];if(H!==void 0){const se=Ie.row.userId;if(H.userId===se)return{style:{backgroundColor:"rgba(65,155,5,0.5)"}}}return{style:{backgroundColor:"rgba(130,255,30,0.5)"}}}return Ce.lock>0?{style:{backgroundColor:"rgb(255,180,50,0.5)"}}:Ce.attempt>0?{style:{backgroundColor:"rgba(255,120,120,0.5)"}}:{}}})});const Z=K.data.contest;if(f=new Date(Z.start_time),s=new Date(Z.end_time),C=K.data.ranks,$=K.data.v_members||[],D.value=Math.floor((s.getTime()-f.getTime())/1e3),z.value={0:"0",[Math.floor(D.value/2)]:it(Math.floor(D.value/2)),[D.value]:it(D.value)},U=Ka(Z.lock_rank_duration||0),K.data.is_locked&&U>0){const oe=Math.max(0,D.value-U);z.value[oe]=t("span",{style:"color: #0052d9"},[P("锁榜("),it(oe),P(")")])}p.value=Math.floor((new Date().getTime()-f.getTime())/1e3);const J=Math.min(p.value,D.value);p.value=Math.min(p.value,J),w.value=!0,X(),ie()}else W&&N(o,K.code)}catch(K){console.error(K),W&&N(o,He())}finally{W&&(V.value=!1)}};return pe(async()=>{b=!0,g=Ue(()=>l.query,async W=>{if(Array.isArray(l.params.contestId)?y=Number(l.params.contestId[0]):y=Number(l.params.contestId),!y){await n.push({name:"contest"});return}const K=parseInt(W.page)||r.value.defaultCurrent,Z=parseInt(W.page_size)||r.value.defaultPageSize;v=K,d=Z,r.value={...r.value,current:v,pageSize:d},await ye(!0)},{immediate:!0})}),De(()=>{b=!1,g&&g(),ae()}),(W,K)=>{const Z=gt,J=he,oe=xl,ne=Ke,Ie=be,Ce=Pe;return j(),E(Ce,null,{default:a(()=>[t(Ie,{style:{margin:"10px",width:"100%"}},{default:a(()=>[R("div",lr,[R("div",nr,[t(J,null,{default:a(()=>[t(Z,{size:"large",modelValue:S.value,"onUpdate:modelValue":K[0]||(K[0]=H=>S.value=H),onChange:B},{label:a(H=>[P(q(H.value?"仅展示收藏":"未过滤收藏"),1)]),_:1},8,["modelValue"]),t(Z,{size:"large",modelValue:h.value,"onUpdate:modelValue":K[1]||(K[1]=H=>h.value=H)},{label:a(H=>[P(q(H.value?"开启动画":"关闭动画"),1)]),_:1},8,["modelValue"]),t(Z,{size:"large",modelValue:w.value,"onUpdate:modelValue":K[2]||(K[2]=H=>w.value=H),onChange:Q},{label:a(H=>[P(q(H.value?"自动刷新":"关闭刷新"),1)]),_:1},8,["modelValue"])]),_:1})]),t(oe,{modelValue:p.value,"onUpdate:modelValue":K[3]||(K[3]=H=>p.value=H),marks:z.value,max:D.value,label:te,"tooltip-props":{placement:"top"},"input-number-props":{theme:"column",autoWidth:!0,format:fe(it),onChange:ue},onChangeEnd:ue},null,8,["modelValue","marks","max","input-number-props"])]),R("div",or,[t(ne,{data:L.value,columns:T.value,"row-key":"index","vertical-align":"middle",bordered:!0,hover:!0,"table-layout":"auto","rowspan-and-colspan":F,loading:V.value,class:"dida-contest-rank-table",pagination:r.value,onPageChange:c},null,8,["data","columns","loading","pagination"])])]),_:1})]),_:1})}}}),rr=de(sr,[["__scopeId","data-v-38775be1"]]),ir={style:{margin:"10px"}},ur={style:{margin:"12px"}},dr={class:"dida-edit-container"},cr={class:"dida-description-editor"},mr=ce({__name:"ContestEdit",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze(),o=m(0),b=m(!1),g=m(!1),y=m(!1),f=m(null),s=m({title:"",openTime:[],private:!0,password:"",problems:[],members:[],description:"",notification:"",lockRankDuration:0,alwaysLock:!0,submitAnytime:!1}),U=m(""),p=m(""),D=m(!1),S=async()=>{D.value=!0,y.value=!1,D.value=!1},h=async(d,r)=>{g.value=!0,await dt(d,r,n,()=>So(o.value)),g.value=!1},w=async()=>{g.value=!0;try{const d={title:s.value.title,description:s.value.description,notification:s.value.notification,lock_rank_duration:s.value.lockRankDuration,always_lock:s.value.alwaysLock,problems:s.value.problems,members:s.value.members,private:s.value.private,password:s.value.password,submit_anytime:s.value.submitAnytime};s.value.openTime[0]&&(d.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(d.end_time=new Date(s.value.openTime[1]));const r=await xo(d);if(g.value=!0,r.code!==0){N(n,r.code);return}r.data!=null&&await Y.push({name:"contest-detail",params:{contestId:r.data}}),Ge(n,"创建成功")}finally{g.value=!1}},u=async()=>{g.value=!0;try{const d={id:Number(o.value),title:s.value.title,notification:s.value.notification,lock_rank_duration:s.value.lockRankDuration,always_lock:s.value.alwaysLock,problems:s.value.problems,members:s.value.members,private:s.value.private,password:s.value.password,submit_anytime:s.value.submitAnytime,description:s.value.description};s.value.openTime[0]&&(d.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(d.end_time=new Date(s.value.openTime[1]));const r=await To(d);if(g.value=!0,r.code!==0){N(n,r.code);return}f.value&&(r.data.description!=null&&(s.value.description=r.data.description),r.data.update_time!=null&&(f.value.updateTime=new Date(r.data.update_time).toLocaleString())),Ge(n,"保存成功")}finally{g.value=!1}},_=d=>{s.value.description=d,b.value=!1},v=async()=>{const d=await wo(o.value);if(d.code!==0){N(n,d.code),console.error("contest get failed",d.code),await Y.push({name:"contest-list"});return}const r=d.data.contest;f.value=Jt(r),s.value.title=r.title,s.value.openTime=[],r.start_time?s.value.openTime.push(new Date(r.start_time)):s.value.openTime.push(""),r.end_time?s.value.openTime.push(new Date(r.end_time)):s.value.openTime.push(""),s.value.private=r.private,s.value.password=r.password||"",s.value.description=r.description||"",s.value.notification=r.notification||"",s.value.problems=d.data.problems,s.value.members=d.data.members,r.lock_rank_duration?s.value.lockRankDuration=Ka(r.lock_rank_duration):s.value.lockRankDuration=0,s.value.alwaysLock=r.always_lock,s.value.submitAnytime=r.submit_anytime,i.setTitle(r.title+" - "+i.getTitle);let A="";r.description&&(A=r.description),_(A)};return pe(async()=>{Array.isArray(l.params.contestId)?o.value=Number(l.params.contestId[0]):o.value=Number(l.params.contestId),o.value?(b.value=!0,await v()):_("")}),(d,r)=>{const A=Re,c=ze,I=Ot,z=gt,k=wa,x=Ae,T=be,V=Te,C=O,$=he,L=Ye,M=We,F=Pe,te=Ee("md-editor-v3"),X=Ve,ae=Tt,Q=ot;return j(),ee(me,null,[t(X,{loading:b.value},{default:a(()=>[t(F,null,{default:a(()=>[t(V,{span:8},{default:a(()=>[R("div",ir,[t(T,{class:"sh-card"},{default:a(()=>[t(x,{model:s.value,"label-width":"150px"},{default:a(()=>[t(c,{label:"标题"},{default:a(()=>[t(A,{modelValue:s.value.title,"onUpdate:modelValue":r[0]||(r[0]=B=>s.value.title=B),placeholder:"比赛标题"},null,8,["modelValue"])]),_:1}),t(c,{label:"通知"},{default:a(()=>[t(A,{modelValue:s.value.notification,"onUpdate:modelValue":r[1]||(r[1]=B=>s.value.notification=B),placeholder:"会更为醒目地提醒"},null,8,["modelValue"])]),_:1}),t(c,{label:"开启时间"},{default:a(()=>[t(I,{modelValue:s.value.openTime,"onUpdate:modelValue":r[2]||(r[2]=B=>s.value.openTime=B),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(c,{label:"提交限制"},{default:a(()=>[t(z,{modelValue:s.value.submitAnytime,"onUpdate:modelValue":r[3]||(r[3]=B=>s.value.submitAnytime=B)},{label:a(B=>[P(q(B.value?"结束仍能提交":"仅比赛期间提交"),1)]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"锁榜时长"},{default:a(()=>[t(k,{modelValue:s.value.lockRankDuration,"onUpdate:modelValue":r[4]||(r[4]=B=>s.value.lockRankDuration=B),min:0,format:fe(it),"auto-width":""},null,8,["modelValue","format"])]),_:1}),t(c,{label:"自动解锁"},{default:a(()=>[t(z,{modelValue:s.value.alwaysLock,"onUpdate:modelValue":r[5]||(r[5]=B=>s.value.alwaysLock=B)},{label:a(B=>[P(q(B.value?"结束后仍锁榜":"结束后解锁"),1)]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"私有"},{default:a(()=>[t(z,{modelValue:s.value.private,"onUpdate:modelValue":r[6]||(r[6]=B=>s.value.private=B)},null,8,["modelValue"])]),_:1}),s.value.private?(j(),E(c,{key:0,label:"密码"},{default:a(()=>[t(A,{modelValue:s.value.password,"onUpdate:modelValue":r[7]||(r[7]=B=>s.value.password=B),type:"password",placeholder:"请输入访问密码，留空代表关闭密码访问"},null,8,["modelValue"])]),_:1})):le("",!0),s.value.private?(j(),E(c,{key:1,label:"成员"},{default:a(()=>[t(qa,{modelValue:s.value.members,"onUpdate:modelValue":r[8]||(r[8]=B=>s.value.members=B)},null,8,["modelValue"])]),_:1})):le("",!0),t(c,{label:"问题"},{default:a(()=>[t(Ea,{modelValue:s.value.problems,"onUpdate:modelValue":r[9]||(r[9]=B=>s.value.problems=B)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(V,{span:4},{default:a(()=>[R("div",ur,[R("div",dr,[o.value?(j(),E($,{key:0},{default:a(()=>[t(C,{onClick:u,theme:"danger",loading:g.value},{default:a(()=>r[13]||(r[13]=[P("保存")])),_:1},8,["loading"])]),_:1})):(j(),E($,{key:1},{default:a(()=>[t(C,{onClick:w,theme:"danger",loading:g.value},{default:a(()=>r[14]||(r[14]=[P("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(j(),E(M,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(L,{label:"创建时间"},{default:a(()=>{var B;return[P(q((B=f.value)==null?void 0:B.createTime),1)]}),_:1}),t(L,{label:"更新时间"},{default:a(()=>{var B;return[P(q((B=f.value)==null?void 0:B.updateTime),1)]}),_:1}),t(L,{label:"创建用户"},{default:a(()=>{var B;return[P(q((B=f.value)==null?void 0:B.ownerNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),R("div",cr,[r[15]||(r[15]=R("p",null,"公告",-1)),t(te,{id:"contest-description-editor",modelValue:s.value.description,"onUpdate:modelValue":r[10]||(r[10]=B=>s.value.description=B),onSave:u,onOnUploadImg:h,previewTheme:"cyanosis"},null,8,["modelValue"]),t(X,{loading:g.value,attach:"#contest-description-editor","z-index":1e5},null,8,["loading"])])]),_:1},8,["loading"]),t(Q,{visible:y.value,"onUpdate:visible":r[12]||(r[12]=B=>y.value=B),onConfirm:S,header:U.value,"confirm-loading":D.value},{default:a(()=>[r[16]||(r[16]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(ae,{modelValue:p.value,"onUpdate:modelValue":r[11]||(r[11]=B=>p.value=B),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),ma=de(mr,[["__scopeId","data-v-6b7ea9fb"]]);function Xt(e){const l={};return l.id=e.id,l.authorId=e.author_id,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.title=e.title,l.content=e.content,e.insert_time&&(l.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(l.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(l.updateTime=new Date(e.update_time).toLocaleString()),l.problemId=e.problem_id,l.problemTitle=e.problem_title,l.contestId=e.contest_id,l.contestTitle=e.contest_title,l.contestProblemIndex=e.contest_problem_index,l}function pr(e){const l={};return l.id=e.id,l.authorId=e.author_id,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.content="",e.content&&(l.content=e.content),e.insert_time&&(l.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(l.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(l.updateTime=new Date(e.update_time).toLocaleString()),l}function fr(e){return G({url:"/discuss?id="+e,method:"get"})}function vr(e){return G({url:"/discuss/edit?id="+e,method:"get"})}function _r(e,l,n,i,o,b,g){const y={};return e?y.only_problem="1":y.only_problem="0",l&&(y.contest_id=l),n&&(y.problem_id=n),i&&(y.title=i),o&&(y.username=o),b&&(y.page=b),g&&(y.page_size=g),G({url:`/discuss/list?${new URLSearchParams(y).toString()}`,method:"get"})}function gr(e){return e||(e=0),G({url:"/discuss/image/token?id="+e,method:"get"})}function br(e,l){return e||(e=0),l||(l=0),G({url:"/discuss/comment/image/token?id="+e+"&comment_id="+l,method:"get"})}function hr(e,l,n){return G({url:"/discuss/comment/list?id="+e+"&page="+l+"&page_size="+n,method:"get"})}function yr(e){return G({url:"/discuss/create",method:"post",data:e})}function wr(e){return G({url:"/discuss/edit",method:"post",data:e})}function kr(e){return G({url:"/discuss/comment/create",method:"post",data:e})}function Sr(e){return G({url:"/discuss/comment/edit",method:"post",data:e})}const Cr={style:{margin:"10px"}};function Ir(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!at(e)}const Pr=ce({__name:"DiscussList",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=!1,b=null,g=-1,y=m(!1);const f=m([]),s=[],U=[{title:"标题",colKey:"title",cell:(z,k)=>t(O,{variant:"text",onClick:()=>d(k.row.id)},{default:()=>[k.row.title]})},{title:"创建人",colKey:"authorNickname",width:"200",cell:(z,k)=>t(O,{variant:"text",onClick:async()=>await Wt(n,k.row.authorUsername)},{default:()=>[k.row.authorNickname]})},{title:"创建时间",colKey:"insertTime",width:"180"},{title:"更新时间",colKey:"updateTime",width:"180"}],p=m(!1);let D=1,S=50;const h=m({current:D,pageSize:S,defaultCurrent:D,defaultPageSize:S,total:0,pageSizeOptions:[50,100]}),w=m(),u=m({problemId:"",title:"",username:""}),_=z=>{z&&n.push({name:"problem-detail",params:{problemId:z}})},v=(z,k)=>{n.push({name:"contest-problem-detail",params:{contestId:z,problemIndex:k}})},d=z=>{if(z){if(g){n.push({name:"contest-discuss-detail",params:{contestId:g,discussId:z}});return}n.push({name:"discuss-detail",params:{discussId:z}})}},r=async()=>{await n.push({query:{...l.query,problem_id:u.value.problemId,title:u.value.title,username:u.value.username,page:1,page_size:h.value.defaultPageSize}})},A=async(z,k)=>{var x;p.value=!0;try{const{current:T,pageSize:V}=z,C=await _r(y.value,g,u.value.problemId,u.value.title,u.value.username,T,V);if(w.value=[],C.code===0){if(!C.data.has_auth){we(i,"您目前没有权限查看讨论列表"),g?await n.push({name:"contest-detail",params:{contestId:g}}):await n.push({name:"discuss-list"});return}if(C.data.list){const $=C.data.list;for(let L=0;L<$.length;L++){const M=$[L],F=await Xt(M);(x=w.value)==null||x.push(F)}}h.value={...h.value,total:C.data.total_count}}else k&&N(i,C.code)}catch(T){console.error(T),N(i,He())}finally{p.value=!1}},c=async z=>{await n.push({query:{...l.query,page:z.current,page_size:z.pageSize}})},I=async()=>{await n.push({name:"discuss-create"})};return pe(async()=>{o=!0,b=Ue(()=>l.query,z=>{if(!o)return;y.value=l.name==="discuss-list-problem",Array.isArray(l.params.contestId)?g=Number(l.params.contestId[0]):g=Number(l.params.contestId),f.value=s,g?f.value=f.value.concat([{title:"问题ID",colKey:"contestProblemIndex",width:"100",cell:(T,V)=>{let C;return V.row.contestProblemIndex?t(O,{variant:"text",onClick:()=>v(g,V.row.contestProblemIndex)},Ir(C=tt(V.row.contestProblemIndex))?C:{default:()=>[C]}):""}}]):f.value=f.value.concat([{title:"问题ID",colKey:"problemId",width:"100",cell:(T,V)=>V.row.problemId?t(O,{variant:"text",onClick:()=>_(V.row.problemId)},{default:()=>[V.row.problemId]}):""}]),f.value=f.value.concat(U),u.value.problemId=z.problem_id||"",u.value.title=z.title||"",u.value.username=z.username||"";const k=parseInt(z.page)||h.value.defaultCurrent,x=parseInt(z.page_size)||h.value.defaultPageSize;D=k,S=x,h.value={...h.value,current:D,pageSize:S},A({current:D,pageSize:S},!0)},{immediate:!0})}),De(()=>{o=!1,b&&b()}),(z,k)=>{const x=Ke,T=be,V=Te,C=Re,$=ze,L=O,M=Ae,F=he,te=Pe;return j(),E(te,null,{default:a(()=>[t(V,{span:9},{default:a(()=>[t(T,{style:{margin:"10px"}},{default:a(()=>[t(x,{data:w.value,columns:f.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:h.value,loading:p.value,"table-layout":"auto",onPageChange:c},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(V,{span:3},{default:a(()=>[R("div",Cr,[t(T,{class:"sh-card"},{default:a(()=>[t(M,{model:u.value},{default:a(()=>[t($,{label:"问题ID"},{default:a(()=>[t(C,{modelValue:u.value.problemId,"onUpdate:modelValue":k[0]||(k[0]=X=>u.value.problemId=X),placeholder:"请输入完整问题ID"},null,8,["modelValue"])]),_:1}),t($,{label:"标题"},{default:a(()=>[t(C,{modelValue:u.value.title,"onUpdate:modelValue":k[1]||(k[1]=X=>u.value.title=X),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t($,{label:"创建人"},{default:a(()=>[t(C,{modelValue:u.value.username,"onUpdate:modelValue":k[2]||(k[2]=X=>u.value.username=X),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t($,null,{default:a(()=>[t(L,{theme:"primary",onClick:r},{default:a(()=>k[3]||(k[3]=[P("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(T,{class:"sh-card"},{default:a(()=>[t(F,null,{default:a(()=>[t(L,{onClick:I},{default:a(()=>k[4]||(k[4]=[P("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),zt=de(Pr,[["__scopeId","data-v-d6935e64"]]),xr={key:0,style:{margin:"20px"}},Tr={class:"dida-operation-container"},Vr={class:"dida-operation-container"},Dr={style:{margin:"10px"}},jr={style:{margin:"10px"}},Lr={style:{margin:"10px"},class:"dida-operation-container"},$r={style:{margin:"12px"}},Ur={key:0,class:"dida-edit-container"},Ar=ce({__name:"DiscussDetail",props:{discussId:{}},setup(e){const l=e;let n=Se();const{globalProperties:i}=_e();let o=!1,b=null;const g=Ze(),y=qe();let f=m("");const s=m(0),U=m(!1),p=m(null),D=m(!1),S=m(!1),h=m(0),w=m("");let u=1,_=20;const v=m({current:1,pageSize:20,total:0,defaultPageSize:_,defaultCurrent:u,pageSizeOptions:[20,50]}),d=m([]),r=Je(()=>y.hasAuth(Le.ManageDiscuss)),A=Je(()=>y.hasAuth(Le.ManageDiscuss)||p.value&&y.getUserId==p.value.authorId),c=()=>{Y.push({name:"discuss-edit",params:{discussId:s.value}})},I=()=>t("div",{class:"t-pagination__total"},[`共 ${v.value.total} 条回复`]),z=($,L)=>{h.value=$,w.value=L;const M=document.getElementById("discuss-comment-editor");M&&M.scrollIntoView({behavior:"smooth"})},k=()=>{h.value=0,w.value="";const $=document.getElementById("discuss-comment-editor");$&&$.scrollIntoView({behavior:"smooth"})},x=async()=>{S.value=!0;try{let $;if(h.value){const L={id:h.value,discuss_id:s.value,content:w.value};if($=await Sr(L),$.code!==0){N(i,$.code);return}Ge(i,"编辑成功"),h.value=0,w.value="",u===1?await V({current:1,pageSize:_},!0):await Y.push({query:{current:1}});const M=document.getElementById("comment-divider");M&&M.scrollIntoView({behavior:"smooth"})}else{const L={discuss_id:s.value,content:w.value};if($=await kr(L),$.code!==0){N(i,$.code);return}Ge(i,"编辑成功"),h.value=0,w.value="",u===1?await V({current:1,pageSize:_},!0):await Y.push({query:{current:1}});const M=document.getElementById("comment-divider");M&&M.scrollIntoView({behavior:"smooth"})}}finally{S.value=!1}},T=async($,L)=>{S.value=!0,await dt($,L,i,()=>br(s.value,h.value)),S.value=!1},V=async($,L)=>{var M;D.value=!0;try{const{current:F,pageSize:te}=$,X=await hr(s.value,F,te);if(d.value=[],X.code===0){const ae=X.data.list;if(ae)for(let Q=0;Q<ae.length;Q++){const B=ae[Q],ie=pr(B);(M=d.value)==null||M.push(ie)}v.value={...v.value,total:X.data.total_count}}else L&&N(i,X.code)}catch(F){console.error(F),N(i,He())}finally{D.value=!1}},C=async $=>{await Y.push({query:{...n.query,page:$.current,page_size:$.pageSize}})};return pe(async()=>{if(o=!0,s.value=Number(l.discussId),s.value||(Array.isArray(n.params.discussId)?s.value=Number(n.params.discussId[0]):s.value=Number(n.params.discussId)),!s.value){ge(i,"讨论不存在"),await Y.push({name:"discuss"});return}U.value=!0;const $=await fr(s.value);if($.code!==0){U.value=!1,N(i,$.code),await Y.push({name:"discuss"});return}p.value=Xt($.data.discuss),g.setTitle(p.value.title+" - "+g.getTitle),f.value=p.value.content,U.value=!1,b=Ue(()=>n.query,L=>{if(!o)return;const M=parseInt(L.page)||v.value.defaultCurrent,F=parseInt(L.page_size)||v.value.defaultPageSize;u=M,_=F,v.value={...v.value,current:u,pageSize:_},V({current:u,pageSize:_},!0)},{immediate:!0})}),De(()=>{o=!1,b&&b()}),($,L)=>{const M=Sa,F=ka,te=Ee("md-preview"),X=be,ae=Vl,Q=he,B=O,ie=Dl,ue=et,ye=Ee("md-editor-v3"),W=Ve,K=Te,Z=Ye,J=We,oe=Pe;return j(),E(W,{loading:U.value},{default:a(()=>[t(oe,{class:"dida-main-content"},{default:a(()=>[t(K,{span:8},{default:a(()=>{var ne,Ie,Ce;return[(ne=p.value)!=null&&ne.problemTitle||(Ie=p.value)!=null&&Ie.contestTitle?(j(),ee("div",xr,[t(F,{"max-item-width":"300"},{default:a(()=>{var H,se,ve,je,Me;return[(H=p.value)!=null&&H.contestTitle?(j(),ee(me,{key:0},[t(M,{to:{name:"contest-detail",params:{contestId:(se=p.value)==null?void 0:se.contestId}}},{default:a(()=>{var ke;return[P(q((ke=p.value)==null?void 0:ke.contestTitle),1)]}),_:1},8,["to"]),(ve=p.value)!=null&&ve.contestProblemIndex?(j(),E(M,{key:0,to:{name:"contest-problem-detail",params:{problemIndex:(je=p.value)==null?void 0:je.contestProblemIndex}}},{default:a(()=>{var ke,Fe;return[P(q(fe(tt)((ke=p.value)==null?void 0:ke.contestProblemIndex))+" - "+q((Fe=p.value)==null?void 0:Fe.problemTitle),1)]}),_:1},8,["to"])):le("",!0)],64)):(j(),ee(me,{key:1},[t(M,{to:{name:"discuss-list-problem"}},{default:a(()=>L[4]||(L[4]=[P(" 题目讨论")])),_:1}),t(M,{to:{name:"problem-detail",params:{problemId:(Me=p.value)==null?void 0:Me.problemId}}},{default:a(()=>{var ke;return[P(q((ke=p.value)==null?void 0:ke.problemTitle),1)]}),_:1},8,["to"])],64))]}),_:1})])):le("",!0),t(X,{style:{margin:"10px"},header:(Ce=p.value)==null?void 0:Ce.title,"header-bordered":!0},{default:a(()=>[t(te,{"model-value":fe(f),previewTheme:"cyanosis"},null,8,["model-value"])]),_:1},8,["header"]),t(ae,{id:"comment-divider"},{default:a(()=>L[5]||(L[5]=[P("评论区")])),_:1}),(j(!0),ee(me,null,xe(d.value,(H,se)=>(j(),E(X,{key:se,style:{margin:"10px"},"header-bordered":""},{header:a(()=>[R("div",Tr,[t(Q,null,{default:a(()=>[R("span",null,q(H.authorNickname),1),R("span",null,q(H.insertTime),1)]),_:2},1024)]),R("div",Vr,[t(Q,null,{default:a(()=>[r.value||fe(y).getUserId===H.authorId?(j(),E(B,{key:0,onClick:()=>{z(H.id,H.content)}},{default:a(()=>L[6]||(L[6]=[P(" 编辑 ")])),_:2},1032,["onClick"])):le("",!0)]),_:2},1024)])]),default:a(()=>[t(te,{"model-value":H.content,previewTheme:"cyanosis"},null,8,["model-value"])]),_:2},1024))),128)),R("div",Dr,[t(ie,{modelValue:v.value.current,"onUpdate:modelValue":L[0]||(L[0]=H=>v.value.current=H),"page-size":v.value.pageSize,"onUpdate:pageSize":L[1]||(L[1]=H=>v.value.pageSize=H),total:v.value.total,"page-size-options":v.value.pageSizeOptions,"show-page-size":!1,"total-content":I,onChange:C},null,8,["modelValue","page-size","total","page-size-options"])]),t(ae),R("div",jr,[R("div",Lr,[t(ue,{style:{margin:"10px"}},{default:a(()=>[P(q(h.value?"编辑回复":"发表回复"),1)]),_:1}),t(Q,null,{default:a(()=>[t(B,{theme:"danger",onClick:k},{default:a(()=>L[7]||(L[7]=[P("清除")])),_:1}),t(B,{theme:"primary",onClick:x,loading:S.value},{default:a(()=>L[8]||(L[8]=[P("提交")])),_:1},8,["loading"])]),_:1})]),t(ye,{id:"discuss-comment-editor",modelValue:w.value,"onUpdate:modelValue":L[2]||(L[2]=H=>w.value=H),previewTheme:"cyanosis",onSave:x,onOnUploadImg:T},null,8,["modelValue"]),t(W,{loading:S.value,attach:"#discuss-comment-editor","z-index":1e5},null,8,["loading"])])]}),_:1}),t(K,{span:4},{default:a(()=>[R("div",$r,[A.value?(j(),ee("div",Ur,[t(B,{onClick:c},{default:a(()=>L[9]||(L[9]=[P("编辑")])),_:1})])):le("",!0),t(J,{layout:"vertical",bordered:!0},{default:a(()=>[t(Z,{label:"创建时间"},{default:a(()=>{var ne;return[P(q((ne=p.value)==null?void 0:ne.insertTime),1)]}),_:1}),t(Z,{label:"编辑时间"},{default:a(()=>{var ne;return[P(q((ne=p.value)==null?void 0:ne.modifyTime),1)]}),_:1}),t(Z,{label:"更新时间"},{default:a(()=>{var ne;return[P(q((ne=p.value)==null?void 0:ne.updateTime),1)]}),_:1}),t(Z,{label:"创建用户"},{default:a(()=>[t(B,{variant:"text",onClick:L[3]||(L[3]=async()=>{var ne;return await fe(Wt)(fe(Y),(ne=p.value)==null?void 0:ne.authorUsername)})},{default:a(()=>{var ne;return[P(q((ne=p.value)==null?void 0:ne.authorNickname),1)]}),_:1})]),_:1}),t(Z,{label:"标签"})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Rt=de(Ar,[["__scopeId","data-v-3d044029"]]),zr={style:{margin:"10px"}},Rr={style:{margin:"12px"}},Mr={class:"dida-edit-container"},Er={class:"dida-description-editor"},qr=ce({__name:"DiscussEdit",setup(e){let l=Se();const{globalProperties:n}=_e();let i=null;const o=m(0),b=m(!1),g=m(!1),y=m(null),f=m({title:"",problemId:"",content:""}),s=()=>{Y.push({name:"discuss-detail",params:{discussId:o.value}})};async function U(w,u){g.value=!0,await dt(w,u,n,()=>gr(o.value)),g.value=!1}const p=async()=>{g.value=!0;try{const w={title:f.value.title,content:f.value.content,problem_id:f.value.problemId},u=await yr(w);if(g.value=!0,u.code!==0){N(n,u.code);return}const _=u.data;await Y.push({name:"discuss-detail",params:{discussId:_}}),Ge(n,"创建成功")}finally{g.value=!1}},D=async()=>{g.value=!0;try{const w={id:o.value,title:f.value.title,content:f.value.content,problem_id:f.value.problemId},u=await wr(w);if(g.value=!0,u.code!==0){N(n,u.code);return}y.value&&u.data.modify_time!=null&&(y.value.modifyTime=new Date(u.data.modify_time).toLocaleString()),u.data.content!=null&&(f.value.content=u.data.content),Ge(n,"保存成功")}finally{g.value=!1}},S=async()=>{o.value?await D():await p()},h=async()=>{const w=await vr(o.value);if(w.code!==0){N(n,w.code),await Y.push({name:"discuss"});return}const u=w.data.discuss;y.value=Xt(u),f.value.title=u.title,f.value.content=u.content,f.value.problemId=u.problem_id,b.value=!1};return pe(async()=>{i=Ue(()=>l.params,async()=>{Array.isArray(l.params.discussId)?o.value=Number(l.params.discussId[0]):o.value=Number(l.params.discussId),o.value?(b.value=!0,await h()):(f.value.title="",f.value.problemId="",f.value.content="")},{immediate:!0})}),De(()=>{i&&(i(),i=null)}),(w,u)=>{const _=Re,v=ze,d=Ae,r=be,A=Te,c=O,I=he,z=Ye,k=We,x=Pe,T=Ee("md-editor-v3"),V=Ve;return j(),E(V,{loading:b.value},{default:a(()=>[t(x,null,{default:a(()=>[t(A,{span:8},{default:a(()=>[R("div",zr,[t(r,{class:"sh-form-card"},{default:a(()=>[t(d,{model:f.value},{default:a(()=>[t(v,{label:"标题"},{default:a(()=>[t(_,{modelValue:f.value.title,"onUpdate:modelValue":u[0]||(u[0]=C=>f.value.title=C),placeholder:"讨论标题"},null,8,["modelValue"])]),_:1}),t(v,{label:"关联题目"},{default:a(()=>[t(_,{modelValue:f.value.problemId,"onUpdate:modelValue":u[1]||(u[1]=C=>f.value.problemId=C),placeholder:"讨论题目"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(A,{span:4},{default:a(()=>[R("div",Rr,[R("div",Mr,[o.value?(j(),E(I,{key:0},{default:a(()=>[t(c,{onClick:D,theme:"danger",loading:g.value},{default:a(()=>u[3]||(u[3]=[P("保存")])),_:1},8,["loading"]),t(c,{onClick:s},{default:a(()=>u[4]||(u[4]=[P("查看")])),_:1})]),_:1})):(j(),E(I,{key:1},{default:a(()=>[t(c,{onClick:p,theme:"danger",loading:g.value},{default:a(()=>u[5]||(u[5]=[P("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(j(),E(k,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(z,{label:"创建时间"},{default:a(()=>{var C;return[P(q((C=y.value)==null?void 0:C.insertTime),1)]}),_:1}),t(z,{label:"更新时间"},{default:a(()=>{var C;return[P(q((C=y.value)==null?void 0:C.modifyTime),1)]}),_:1}),t(z,{label:"创建用户"},{default:a(()=>{var C;return[P(q((C=y.value)==null?void 0:C.authorNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),R("div",Er,[t(T,{id:"discuss-editor",modelValue:f.value.content,"onUpdate:modelValue":u[2]||(u[2]=C=>f.value.content=C),onSave:S,onOnUploadImg:U,previewTheme:"cyanosis"},null,8,["modelValue"]),t(V,{loading:g.value,attach:"#discuss-editor","z-index":1e5},null,8,["loading"])])]),_:1},8,["loading"])}}}),pa=de(qr,[["__scopeId","data-v-164ac069"]]);function Kr(e,l){return G({url:"/rank/ac/all?page="+e+"&page_size="+l,method:"get"})}function Fr(e,l){return G({url:"/rank/ac/problem?page="+e+"&page_size="+l,method:"get"})}function Nr(e,l){return G({url:"/rank/ac/problem/today?page="+e+"&page_size="+l,method:"get"})}function Or(e,l){return G({url:"/rank/ac/problem/day7?page="+e+"&page_size="+l,method:"get"})}function Gr(e,l){return G({url:"/rank/ac/problem/day30?page="+e+"&page_size="+l,method:"get"})}function Hr(e,l){return G({url:"/rank/ac/problem/year?page="+e+"&page_size="+l,method:"get"})}const Br={style:{margin:"10px"}};function Mt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!at(e)}const Jr=ce({__name:"RankUser",props:{type:{}},setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=null;const b=e,g=m(""),y=m(""),f={all:{header:"统计所有用户在本站的提交记录",content:"优先以AC记录数量排序，如果相同则提交所用次数较少的优先，如果仍相同，注册较早的用户靠前"},problem:{header:"统计所有用户在本站的提交记录",content:"以题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-today":{header:"统计所有用户今日在本站的提交记录",content:"以今日题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-day7":{header:"统计所有用户最近7日在本站的提交记录",content:"以7日题目记录数量排序（从7日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-day30":{header:"统计所有用户最近30日在本站的提交记录",content:"以30日题目记录数量排序（从30日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-year":{header:"统计所有用户最近1年在本站的提交记录",content:"以最近1年题目记录数量排序（从365日前的0点开始计算），如果相同，注册较早的用户靠前"}},s=m([]),U=[{title:"序号",colKey:"index"},{title:"用户名",colKey:"username",cell:(I,z)=>t(O,{variant:"dashed",onClick:()=>v(z.row.username)},{default:()=>[z.row.username]})},{title:"昵称",colKey:"nickname"},{title:"Slogan",colKey:"slogan"}],p=[{title:"题目数量",colKey:"problem_count",cell:(I,z)=>{let k=0;return z.row.problem_count&&(k=z.row.problem_count),t(O,{variant:"dashed",onClick:()=>d(z.row.username)},Mt(k)?k:{default:()=>[k]})}}],D=[{title:"正确",colKey:"accept",cell:(I,z)=>{let k=0;return z.row.accept&&(k=z.row.accept),t(O,{variant:"dashed",onClick:()=>d(z.row.username)},Mt(k)?k:{default:()=>[k]})}},{title:"提交",colKey:"attempt",cell:(I,z)=>{let k=0;return z.row.attempt&&(k=z.row.attempt),t(O,{variant:"dashed",onClick:()=>r(z.row.username)},Mt(k)?k:{default:()=>[k]})}}],S=m(!1);let h=1,w=50;const u=m({current:h,pageSize:w,defaultCurrent:h,defaultPageSize:w,total:0,pageSizeOptions:[50]}),_=m(),v=I=>{n.push({name:"user",params:{username:I}})},d=I=>{n.push({name:"judge-list",query:{username:I,status:Be.Accept}})},r=I=>{n.push({name:"judge-list",query:{username:I}})},A=async(I,z)=>{S.value=!0;try{_.value=[];const{current:k,pageSize:x}=I;let T=null;switch(b.type){case"problem":T=await Fr(k,x);break;case"problem-today":T=await Nr(k,x);break;case"problem-day7":T=await Or(k,x);break;case"problem-day30":T=await Gr(k,x);break;case"problem-year":T=await Hr(k,x);break;default:T=await Kr(k,x);break}if(T.code===0){const V=T.data.list;if(!V||V.length<=0){u.value={...u.value,total:0},we(i,"未找到记录");return}_.value=[];const C=u.value.pageSize*(u.value.current-1);let $=1;V.forEach(L=>{var F;const M=L;M.index=C+$++,(F=_.value)==null||F.push(M)}),u.value={...u.value,total:T.data.total_count}}else z&&N(i,T.code)}catch(k){console.error(k),N(i,He())}finally{S.value=!1}},c=async I=>{await n.push({query:{...l.query,page:I.current,page_size:I.pageSize}})};return pe(async()=>{S.value=!0,o=Ue(()=>l.query,I=>{switch(b.type&&f[b.type]?(g.value=f[b.type].header,y.value=f[b.type].content):(g.value=f.all.header,y.value=f.all.content),b.type){case"all":s.value=U.concat(D);break;default:s.value=U.concat(p);break}const z=parseInt(I.page)||u.value.defaultCurrent,k=parseInt(I.page_size)||u.value.defaultPageSize;h=z,w=k,u.value={...u.value,current:h,pageSize:w},A({current:h,pageSize:w},!0)},{immediate:!0})}),De(()=>{o&&o()}),(I,z)=>{const k=Ke,x=be,T=Te,V=Pe;return j(),E(V,null,{default:a(()=>[t(T,{span:9},{default:a(()=>[t(x,{style:{margin:"10px"}},{default:a(()=>[t(k,{data:_.value,columns:s.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:u.value,loading:S.value,"table-layout":"auto",onPageChange:c},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(T,{span:3},{default:a(()=>[R("div",Br,[t(x,{class:"sh-card",header:g.value,"header-bordered":!0},{default:a(()=>[P(q(y.value),1)]),_:1},8,["header"])])]),_:1})]),_:1})}}}),rt=de(Jr,[["__scopeId","data-v-13682529"]]),Wr={style:{display:"flex","align-items":"center"}},Yr={style:{color:"#409eff","margin-right":"20px"}},Xr={class:"dida-login-footer"},Zr=ce({__name:"UserForget",setup(e){const{globalProperties:l}=_e(),n=qe(),i=m(!1),o=m(!1),b=m(!1),g=m("发送验证码");let y=null,f=-1;const s=m(!1),U=m(null),p=m(""),D=m({username:"",emailKey:"",password:"",confirmPassword:""}),h=m({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:A=>new Promise(c=>{const I=setTimeout(()=>{c(D.value.password===A),clearTimeout(I)})}),message:"两次密码不一致"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),w=()=>{we(l,"重置成功")},u=async A=>{if(!b.value){i.value=!0,o.value=!0;try{const c=await Xn(A,D.value.username);c.code===0?(we(l,"验证码发送成功"),p.value=c.data,o.value=!1,b.value=!0,y=new Date,g.value="60秒后重发",f=setInterval(()=>{const z=Math.floor((new Date().getTime()-(y==null?void 0:y.getTime()))/1e3);z>60?(g.value="发送验证码",b.value=!1,clearInterval(f)):g.value=`${60-z}秒后重发`},1e3)):N(l,c.code)}catch(c){console.error("Send email key error",c),ge(l,"发送验证码失败")}finally{i.value=!1}}},_=async()=>{var z;if(s.value=!0,b.value||o.value)return;await pt();const A=document.getElementById("cf-confirm-div");A&&A.remove();const c=document.createElement("div");c.id="cf-confirm-div",c.setAttribute("data-theme","light"),(z=U.value)==null||z.appendChild(c);const I=window;I.turnstile.ready(function(){I.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(k){s.value=!1,await u(k)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},v=m(()=>t(O,{onClick:_,disabled:b.value,loading:o.value,style:"width:120px"},{default:()=>[g.value]})),d=async()=>{i.value=!0;try{const A=await Zn(D.value.username,D.value.password,D.value.emailKey);A.code===0?(we(l,"密码修改成功"),l.$router.push({name:"login"})):N(l,A.code)}catch(A){console.error("Modify password error",A),ge(l,"修改密码失败")}finally{i.value=!1}},r=async({validateResult:A,firstError:c,e:I})=>{if(!i.value){if(I.preventDefault(),A!==!0){ge(l,c);return}p.value?await d():await _()}};return pe(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),De(()=>{}),(A,c)=>{const I=xt,z=Re,k=ze,x=ya,T=O,V=Ae,C=nt,$=be,L=ot;return j(),ee(me,null,[t($,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(I,{"max-line":1},{default:a(()=>c[6]||(c[6]=[R("span",null,"如果您未绑定邮箱或忘记用户名，可联系管理员寻求帮助",-1),R("span",null,"管理员邮箱：BoilTask@qq.com",-1)])),_:1}),t(I,{style:{"margin-top":"10px"}},{default:a(()=>c[7]||(c[7]=[R("p",null,"支持原acm.hpu.edu.cn、CodeOJ的用户直接登录",-1),R("p",null,"原DMOJ、hpuoj.com的用户，请先重置密码",-1),R("p",null,"可尝试学号/昵称等作为用户名登录，成功后有机会合并账户或修改用户名",-1)])),_:1}),t(V,{ref:"form",rules:h.value,data:D.value,colon:!0,onReset:w,onSubmit:r,class:"yj-login-form"},{default:a(()=>[t(k,{name:"username",label:"用户名"},{default:a(()=>[t(z,{modelValue:D.value.username,"onUpdate:modelValue":c[0]||(c[0]=M=>D.value.username=M),clearable:"",placeholder:"请输入完整用户名"},null,8,["modelValue"])]),_:1}),p.value?(j(),ee(me,{key:0},[t(k,{name:"email",label:"发送邮箱"},{default:a(()=>[t(x,{append:v.value},{default:a(()=>[R("div",Wr,[R("span",Yr,q(p.value),1)])]),_:1},8,["append"])]),_:1}),t(k,{name:"emailKey",label:"验证码"},{default:a(()=>[t(z,{modelValue:D.value.emailKey,"onUpdate:modelValue":c[1]||(c[1]=M=>D.value.emailKey=M),clearable:"",placeholder:"请输入收到的验证码"},null,8,["modelValue"])]),_:1}),t(k,{name:"password",label:"新密码"},{default:a(()=>[t(z,{modelValue:D.value.password,"onUpdate:modelValue":c[2]||(c[2]=M=>D.value.password=M),type:"password",clearable:"",placeholder:"新密码"},null,8,["modelValue"])]),_:1}),t(k,{name:"confirmPassword",label:"确认密码"},{default:a(()=>[t(z,{modelValue:D.value.confirmPassword,"onUpdate:modelValue":c[3]||(c[3]=M=>D.value.confirmPassword=M),type:"password",clearable:"",placeholder:"请重复输入密码"},null,8,["modelValue"])]),_:1})],64)):le("",!0),p.value?(j(),E(k,{key:1},{default:a(()=>[t(T,{theme:"primary",type:"submit",block:"",loading:i.value},{default:a(()=>c[8]||(c[8]=[P("修改密码")])),_:1},8,["loading"])]),_:1})):(j(),E(k,{key:2},{default:a(()=>[t(T,{theme:"primary",type:"submit",block:"",loading:i.value},{default:a(()=>c[9]||(c[9]=[P("重置密码")])),_:1},8,["loading"])]),_:1}))]),_:1},8,["rules","data"]),R("div",Xr,[t(C,{onClick:c[4]||(c[4]=()=>{fe(l).$router.push({name:"login"})})},{default:a(()=>c[10]||(c[10]=[P("返回登陆 ")])),_:1})])]),_:1}),t(L,{visible:s.value,"onUpdate:visible":c[5]||(c[5]=M=>s.value=M),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:a(()=>[R("div",{ref_key:"dialogContainer",ref:U,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),Qr=de(Zr,[["__scopeId","data-v-e960b193"]]),ei={class:"judger-status-panel"},ti={style:{"text-align":"center","margin-bottom":"20px"}},ai={class:"judger-status-panel"};function li(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!at(e)}const ni=ce({__name:"SystemStatus",setup(e){const{globalProperties:l}=_e(),n=m([]),i=m([]),o=m(!1),b=m(0),g=m(0),y=m(null),f=m(0),s=m(0),U=m(0);let p=-1,D;const S=u=>{let _="失效",v="danger";const d=new Date,r=new Date(u.updateTime);return d.getTime()-r.getTime()>3e4?(_="离线",v="default"):u.cpuUsage>90?(_="CPU过高",v="warning"):u.memPercent>90?(_="内存过高",v="warning"):(_="在线",v="success"),t(he,null,{default:()=>[t("span",null,[u.key,P(" - "),u.name]),t("span",null,[u.updateTime]),t(et,{theme:v,size:"small"},li(_)?_:{default:()=>[_]})]})},h=async()=>{const u={};for(let k=0;k<n.value.length;k++){const x=n.value[k];u[x.key]={...x}}const _={};for(let k=0;k<i.value.length;k++){const x=i.value[k];_[x.key]={...x}}const v=[],d=[],r=await tn();if(r.code!==0){N(l,r.code);return}const A=r.data.web,c={key:"didaoj"};A.name?c.name=A.name:c.name="-",A.update_time?c.updateTime=new Date(A.update_time).toLocaleString():c.updateTime="-",A.cpu_usage?c.cpuUsage=Number(A.cpu_usage):c.cpuUsage=0,A.mem_usage?c.memUsage=A.mem_usage/(1024*1024*1024):c.memUsage=0,A.mem_total?c.memTotal=A.mem_total/(1024*1024*1024):c.memTotal=0,c.memTotal>0?c.memPercent=Math.round(c.memUsage/c.memTotal*1e4)/100:c.memPercent=0,c.avgMessage=A.avg_message;const I=u[c.key];I?(c.cpuUsageFrom=I.cpuUsage,c.memPercentFrom=I.memPercent,c.memUsageFrom=I.memUsage,c.memTotalFrom=I.memTotal):(c.cpuUsageFrom=0,c.memPercentFrom=0,c.memUsageFrom=0,c.memTotalFrom=0),v.push(c),n.value=v;const z=r.data.judger;for(let k=0;k<z.length;k++){const x=z[k],T={key:x.key,name:x.name};x.name?T.name=x.name:T.name="-",x.update_time?T.updateTime=new Date(x.update_time).toLocaleString():T.updateTime="-",x.max_job?T.maxJob=Number(x.max_job):T.maxJob=0,x.cpu_usage?T.cpuUsage=Number(x.cpu_usage):T.cpuUsage=0,x.mem_usage?T.memUsage=x.mem_usage/(1024*1024*1024):T.memUsage=0,x.mem_total?T.memTotal=x.mem_total/(1024*1024*1024):T.memTotal=0,T.memTotal>0?T.memPercent=Math.round(T.memUsage/T.memTotal*1e4)/100:T.memPercent=0,T.avgMessage=x.avg_message,_[x.key]?(T.maxJobFrom=_[x.key].maxJob,T.cpuUsageFrom=_[x.key].cpuUsage,T.memPercentFrom=_[x.key].memPercent,T.memUsageFrom=_[x.key].memUsage,T.memTotalFrom=_[x.key].memTotal):(T.maxJobFrom=0,T.cpuUsageFrom=0,T.memPercentFrom=0,T.memUsageFrom=0,T.memTotalFrom=0),d.push(T)}i.value=d,b.value=g.value,g.value=r.data.judge_job,U.value=s.value,y.value?s.value=(g.value-f.value)/((new Date().getTime()-y.value.getTime())/1e3)*60:(y.value=new Date,f.value=g.value,s.value=0,U.value=0),g.value?(clearTimeout(p),p=-1):p<0&&(p=setTimeout(()=>{y.value=null,f.value=0},1e4))},w=async()=>{await h(),o.value=!1};return pe(async()=>{i.value=[],n.value=[],o.value=!0,await w(),D=setInterval(()=>{w()},5e3)}),De(()=>{clearInterval(D)}),(u,_)=>{const v=jl,d=he,r=be,A=Ve;return j(),E(A,{loading:o.value},{default:a(()=>[t(r,{title:"接口状态",class:"judger-status"},{default:a(()=>[R("div",ei,[(j(!0),ee(me,null,xe(n.value,c=>(j(),E(r,{key:c.key,header:()=>S(c),class:"judge-status-judger"},{footer:a(()=>[R("span",null," 负载信息："+q(c.avgMessage),1)]),default:a(()=>[t(d,{class:"judge-status-judger"},{default:a(()=>[t(v,{title:"CPU使用率",value:c.cpuUsage,animation:{valueFrom:c.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(v,{title:"内存使用率",value:c.memPercent,animation:{valueFrom:c.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(v,{title:"内存使用量",animation:{valueFrom:c.memUsageFrom,duration:2e3},"animation-start":!0,value:c.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(v,{title:"内存总量",value:c.memTotal,animation:{valueFrom:c.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1}),t(r,{title:"判题机状态",class:"judger-status"},{default:a(()=>[R("div",ti,[t(d,null,{default:a(()=>[t(v,{title:"未完成的评测数量",value:g.value,animation:{valueFrom:b.value,duration:4e3},"animation-start":!0},null,8,["value","animation"]),y.value?(j(),E(v,{key:0,title:"评测数量趋势",value:s.value,animation:{valueFrom:U.value,duration:4e3},"animation-start":!0,decimalPlaces:2,unit:"/分钟"},null,8,["value","animation"])):(j(),E(v,{key:1,title:"评测数量趋势",format:()=>"样本较少"}))]),_:1})]),R("div",ai,[(j(!0),ee(me,null,xe(i.value,c=>(j(),E(r,{key:c.key,header:()=>S(c),class:"judge-status-judger"},{footer:a(()=>[R("span",null," 负载信息："+q(c.avgMessage),1)]),default:a(()=>[t(d,{class:"judge-status-judger"},{default:a(()=>[t(v,{title:"并发",value:c.maxJob,animation:{valueFrom:c.maxJob,duration:2e3},"animation-start":!0},null,8,["value","animation"]),t(v,{title:"CPU使用率",value:c.cpuUsage,animation:{valueFrom:c.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(v,{title:"内存使用率",value:c.memPercent,animation:{valueFrom:c.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(v,{title:"内存使用量",animation:{valueFrom:c.memUsageFrom,duration:2e3},"animation-start":!0,value:c.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(v,{title:"内存总量",value:c.memTotal,animation:{valueFrom:c.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1})]),_:1},8,["loading"])}}}),oi=de(ni,[["__scopeId","data-v-8c7320e9"]]),si=ce({__name:"ManageJudge",setup(e){const{globalProperties:l}=_e(),n=m(!1),i=m(!1),o=m({problemId:"",language:void 0,status:void 0}),b=m(!1),g=m([]);g.value=Gt();const y=m([]);y.value=Da();const f=async()=>{n.value=!0;try{const p=await mn();if(p.code!==0){N(l,p.code);return}we(l,"重判成功"),await Y.push({name:"judge-list"})}catch(p){console.error(p),N(l,"重判失败")}finally{n.value=!1}},s=async()=>{if(!o.value.problemId&&!o.value.language&&!o.value.status){N(l,"请输入问题Id");return}b.value=!0;try{const p=await pn(o.value.problemId,o.value.language,o.value.status);if(p.code!==0){N(l,p.code);return}we(l,"重判成功"),await Y.push({name:"judge-list",query:{problem_id:o.value.problemId,language:o.value.language}})}catch(p){console.error(p),N(l,"重判失败")}finally{b.value=!1}},U=async()=>{i.value=!0;try{const p=await fn();if(p.code!==0){N(l,p.code);return}we(l,"重判成功"),await Y.push({name:"judge-list"})}catch(p){console.error(p),N(l,"重判失败")}finally{i.value=!1}};return(p,D)=>{const S=O,h=be,w=Re,u=ze,_=Nt,v=_t,d=he,r=Ae;return j(),ee(me,null,[t(h,{class:"yj-manage-card",title:"重判最近提交"},{default:a(()=>[t(S,{onClick:f,loading:n.value},{default:a(()=>D[3]||(D[3]=[P("重判")])),_:1},8,["loading"])]),_:1}),t(h,{class:"yj-manage-card",title:"重判指定记录"},{default:a(()=>[t(r,{layout:"inline",onSubmit:s},{default:a(()=>[t(u,{label:"题号"},{default:a(()=>[t(w,{modelValue:o.value.problemId,"onUpdate:modelValue":D[0]||(D[0]=A=>o.value.problemId=A),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(u,{label:"语言"},{default:a(()=>[t(v,{modelValue:o.value.language,"onUpdate:modelValue":D[1]||(D[1]=A=>o.value.language=A),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:a(()=>[(j(!0),ee(me,null,xe(g.value,A=>(j(),E(_,{key:A.value,value:A.value,label:A.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"状态"},{default:a(()=>[t(v,{modelValue:o.value.status,"onUpdate:modelValue":D[2]||(D[2]=A=>o.value.status=A),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:a(()=>[(j(!0),ee(me,null,xe(y.value,A=>(j(),E(_,{key:A.value,value:A.value,label:A.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,null,{default:a(()=>[t(d,null,{default:a(()=>[t(S,{theme:"primary",type:"submit",loading:b.value},{default:a(()=>D[4]||(D[4]=[P("重判")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(h,{class:"yj-manage-card",title:"重判所有"},{default:a(()=>[t(S,{onClick:U,theme:"danger",loading:i.value},{default:a(()=>D[5]||(D[5]=[P("重判")])),_:1},8,["loading"])]),_:1})],64)}}}),ri=de(si,[["__scopeId","data-v-6d48cbf2"]]),ii=ce({__name:"ManageWeb",setup(e){const{globalProperties:l}=_e(),n=m({theme:"",content:""}),i=m({title:"",content:""}),o=m(!1),b=m(!1),g=m(!1);async function y(D,S){g.value=!0,await dt(D,S,l,an),g.value=!1}const f=async()=>{b.value=!0;try{const D=await ln(n.value.theme,n.value.content);if(D.code!==0){N(l,D.code);return}we(l,"保存成功")}catch(D){console.error(D),N(l,"保存失败")}finally{b.value=!1}},s=async()=>{g.value=!0;try{const D=i.value.content,S=await nn(i.value.title,D);if(S.code!==0){N(l,S.code);return}i.value.content=S.data.content,we(l,"保存成功")}catch(D){console.error(D),ge(l,"保存失败")}finally{g.value=!1}},U=async()=>{n.value=await xa()},p=async()=>{try{i.value=await Ta()}catch{ge(l,"加载公告失败"),i.value={title:"",content:""}}};return pe(async()=>{o.value=!0;try{await U(),await p()}catch{ge(l,"加载数据失败")}o.value=!1}),(D,S)=>{const h=_t,w=ze,u=Re,_=O,v=he,d=Ae,r=be,A=Ee("md-editor-v3"),c=Ve;return j(),E(c,{loading:o.value},{default:a(()=>[t(r,{class:"yj-manage-card",title:"站点通知"},{default:a(()=>[t(d,{onSubmit:f},{default:a(()=>[t(w,{label:"主题"},{default:a(()=>[t(h,{modelValue:n.value.theme,"onUpdate:modelValue":S[0]||(S[0]=I=>n.value.theme=I),options:[{label:"success",value:"success"},{label:"info",value:"info"},{label:"warning",value:"warning"},{label:"error",value:"error"}],placeholder:"请选择主题"},null,8,["modelValue"])]),_:1}),t(w,{label:"内容"},{default:a(()=>[t(u,{modelValue:n.value.content,"onUpdate:modelValue":S[1]||(S[1]=I=>n.value.content=I),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),t(w,null,{default:a(()=>[t(v,null,{default:a(()=>[t(_,{theme:"primary",type:"submit",loading:b.value},{default:a(()=>S[4]||(S[4]=[P("保存")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(r,{class:"yj-manage-card",title:"首页公告"},{actions:a(()=>[t(_,{theme:"primary",loading:g.value,onClick:s},{default:a(()=>S[5]||(S[5]=[P("保存")])),_:1},8,["loading"])]),default:a(()=>[t(d,{onSubmit:s},{default:a(()=>[t(w,{label:"标题"},{default:a(()=>[t(u,{modelValue:i.value.title,"onUpdate:modelValue":S[2]||(S[2]=I=>i.value.title=I),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1}),t(c,{loading:g.value},{default:a(()=>[t(A,{modelValue:i.value.content,"onUpdate:modelValue":S[3]||(S[3]=I=>i.value.content=I),onSave:s,onOnUploadImg:y,previewTheme:"cyanosis",class:"dida-description-editor"},null,8,["modelValue"])]),_:1},8,["loading"])]),_:1})]),_:1},8,["loading"])}}}),ui=de(ii,[["__scopeId","data-v-8c162eb5"]]),Fa=[{name:"problem-list",tab:"problem",sidebar:"problem-list",path:"",title:"问题列表",icon:"list",component:ho},{name:"problem-detail",tab:"problem",sidebar:"problem-list",path:":problemId+",title:"问题详情",icon:"list",component:Ut},{name:"problem-daily-list",tab:"problem",sidebar:"problem-daily-list",path:"daily",title:"每日一题",icon:"list",component:Jo},{name:"problem-daily-detail",tab:"problem",sidebar:"problem-daily-list",path:"daily/:dailyId+",title:"问题详情",icon:"list",component:Ut},{name:"problem-recommend",tab:"problem",sidebar:"problem-recommend",path:"recommend/:problemId*",title:"问题推荐",icon:"cpu",needLogin:!0,component:as},{name:"problem-collection-list",tab:"problem",sidebar:"problem-collection-list",path:"collection",title:"题目集合",icon:"list",disableTabPath:!0,component:Cs},{name:"collection-detail",tab:"collection-detail-tab",sidebar:"collection-detail",path:":collectionId+",title:"题集详情",icon:"cpu",component:Vs},{name:"collection-rank",tab:"collection-detail-tab",sidebar:"collection-rank",path:":collectionId+/rank",title:"题集排名",icon:"list",component:Ds},{name:"collection-edit",tab:"collection-detail-tab",sidebar:"collection-edit",disableSidebar:!0,needLogin:!0,path:":collectionId+/edit",title:"题集编辑",icon:"list",component:sa},{name:"collection-create",tab:"collection-detail-tab",sidebar:"collection-create",needLogin:!0,disableSidebar:!0,path:"create",title:"新建题集",icon:"list",component:sa},{name:"judge-list",tab:"judge",sidebar:"judge-list",path:"",title:"评测列表",icon:"list",component:ia},{name:"judge-detail",tab:"judge",sidebar:"judge-list",path:":judgeId+",title:"评测详情",icon:"cpu",component:ua},{name:"contest-list",tab:"contest",sidebar:"contest-list",path:"",title:"比赛列表",icon:"list",component:da},{name:"contest-recent",tab:"contest",sidebar:"contest-recent",path:"recent",title:"近期比赛",icon:"list",component:da},{name:"contest-create",tab:"contest",sidebar:"contest-create",disableSidebar:!0,needLogin:!0,path:"create",title:"新建比赛",icon:"list",component:ma},{name:"contest-edit",tab:"contest-detail-tab",sidebar:"contest-edit",disableSidebar:!0,needLogin:!0,path:":contestId+/edit",title:"比赛编辑",icon:"list",component:ma},{name:"contest-detail",tab:"contest-detail-tab",sidebar:"contest-detail",path:":contestId+",title:"比赛详情",icon:"cpu",component:tr},{name:"contest-problem-detail",tab:"contest-detail-tab",sidebar:"contest-problem-detail",path:":contestId+/problem/:problemIndex+",title:"问题详情",icon:"cpu",disableSidebar:!0,component:Ut},{name:"contest-judge",tab:"contest-detail-tab",sidebar:"contest-judge",path:":contestId+/judge",title:"评测列表",icon:"list",component:ia},{name:"contest-judge-detail",tab:"contest-detail-tab",sidebar:"contest-judge-detail",path:":contestId+/judge/:judgeId+",title:"评测详情",icon:"cpu",component:ua,disableSidebar:!0},{name:"contest-rank",tab:"contest-detail-tab",sidebar:"contest-rank",path:":contestId+/rank",title:"比赛排名",icon:"list",component:rr},{name:"contest-discuss",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss",title:"比赛讨论",icon:"list",component:zt},{name:"contest-discuss-detail",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss/:discussId+",title:"讨论详情",icon:"list",component:Rt},{name:"discuss-list",tab:"discuss",sidebar:"discuss-list",path:"",title:"讨论列表",icon:"list",component:zt},{name:"discuss-create",tab:"discuss",sidebar:"discuss-create",disableSidebar:!0,needLogin:!0,path:"create",title:"新建讨论",icon:"list",component:pa},{name:"discuss-edit",tab:"discuss-detail-tab",sidebar:"discuss-edit",disableSidebar:!0,needLogin:!0,path:":discussId+/edit",title:"编辑讨论",icon:"list",component:pa},{name:"discuss-list-problem",tab:"discuss",sidebar:"discuss-list-problem",path:"problem",title:"题目讨论",icon:"list",component:zt},{name:"discuss-detail",tab:"discuss",sidebar:"discuss-list",path:":discussId+",title:"讨论详情",icon:"list",component:Rt},{name:"rank-ac-all",tab:"rank",sidebar:"rank-ac-all",path:"ac",title:"AC排名",icon:"base-station",props:{type:"all"},component:rt},{name:"rank-ac-problem",tab:"rank",sidebar:"rank-ac-problem",path:"ac/problem",title:"题量排名",icon:"base-station",props:{type:"problem"},component:rt},{name:"rank-ac-problem-today",tab:"rank",sidebar:"rank-ac-problem-today",path:"ac/problem/today",title:"今日题量",icon:"base-station",props:{type:"problem-today"},component:rt},{name:"rank-ac-problem-day7",tab:"rank",sidebar:"rank-ac-problem-day7",path:"ac/problem/day7",title:"7日题量",icon:"base-station",props:{type:"problem-day7"},component:rt},{name:"rank-ac-problem-day30",tab:"rank",sidebar:"rank-ac-problem-day30",path:"ac/problem/day30",title:"30日题量",icon:"base-station",props:{type:"problem-day30"},component:rt},{name:"rank-ac-problem-year",tab:"rank",sidebar:"rank-ac-problem-year",path:"ac/problem/year",title:"1年题量",icon:"base-station",props:{type:"problem-year"},component:rt},{name:"system-status",tab:"system",sidebar:"system-status",path:"",title:"运行状态",icon:"base-station",component:oi},{name:"system-about",tab:"system",sidebar:"system-about",path:"about",title:"关于",icon:"base-station",props:{discussId:"93"},component:Rt},{name:"manage-problem-create",tab:"manage",sidebar:"manage-problem-create",disableSidebar:!0,path:"problem",title:"新建问题",icon:"list",component:oa,auths:[Le.ManageProblem]},{name:"manage-problem",tab:"manage",sidebar:"manage-problem",disableSidebar:!0,path:"problem/:problemId+",title:"问题编辑",icon:"list",component:oa,auths:[Le.ManageProblem]},{name:"manage-problem-daily-create",tab:"manage",sidebar:"manage-problem-daily-create",disableSidebar:!0,path:"problem/daily",title:"新建每日一题",icon:"list",component:na,auths:[Le.ManageProblemDaily]},{name:"manage-problem-daily",tab:"manage",sidebar:"manage-problem-daily",disableSidebar:!0,path:"problem/daily/:dailyId+",title:"编辑每日一题",icon:"list",component:na,auths:[Le.ManageProblemDaily]},{name:"manage-problem-judge",tab:"manage",sidebar:"manage-problem-judge",disableSidebar:!0,path:"problem/:problemId+/judge",title:"评测数据",icon:"list",component:ps,auths:[Le.ManageProblem]},{name:"manage-web",tab:"manage",path:"web",sidebar:"manage-web",title:"站点管理",icon:"list",auths:[Le.ManageWeb],component:ui},{name:"manage-judge",tab:"manage",path:"judge",sidebar:"manage-judge",title:"评测管理",icon:"list",auths:["i-manage-judge"],component:ri},{name:"login-forget",tab:"login",path:"forget",title:"忘记密码",component:Qr}],fa=(e,l,n,i)=>{i.tab==n&&(i.disableSidebar&&l!=i.sidebar||i.sidebar==null||i.sidebar!=i.name||e.push({name:i.name,title:i.title,icon:i.icon,to:{name:i.name}}))},di=(e,l)=>{const n=[];return Fa.forEach(i=>{if(Ma(i)){const o=[];i.children.forEach(b=>{fa(o,e,l,b)}),o.length>0&&n.push({title:i.title,children:o})}else fa(n,e,l,i)}),n},va=(e,l)=>{const n=co(l.tab),i={name:l.name,path:"/"+l.path,meta:{title:l.title+" - "+n.title,tab:l.tab,sidebar:l.sidebar,showSidebar:n.showSidebar,needLogin:n.needLogin||l.needLogin,tabAuths:n.auths,auths:l.auths},props:l.props,component:l.component};!n.disablePath&&!l.disableTabPath&&(i.path=n.path+i.path),e.push(i)},ci=e=>{Fa.forEach(l=>{Ma(l)?l.children.forEach(n=>{va(e,n)}):va(e,l)})},mi={class:"sh-main"},pi=ce({__name:"View403",setup(e){let l=Se();const n=m("");return pe(()=>{l.query.target?n.value=l.query.target:n.value=l.fullPath}),(i,o)=>{const b=O;return j(),ee("div",mi,[R("p",null,q(n.value),1),o[2]||(o[2]=R("p",null,"该页面无访问权限，请更换访问目标或重新登陆后再试",-1)),t(b,{theme:"primary",onClick:o[0]||(o[0]=()=>i.$router.push("/"))},{default:a(()=>o[1]||(o[1]=[P("返回首页")])),_:1})])}}}),Na=de(pi,[["__scopeId","data-v-777362b3"]]),ht=[];po(ht);ci(ht);ht.push({path:"/403",name:"403",component:Na});ht.push({path:"/:pathMatch(.*)*",name:"404",component:Ra});const Y=rl({history:il("/"),routes:ht});Y.beforeEach((e,l,n)=>{if(e.name==null||!Y.hasRoute(e.name)){n({name:"home"});return}const i=e.matched[e.matched.length-1].meta;if(i.redirect){n({name:i.redirect});return}if(i.needLogin){const b=qe();if(b.getToken==null||b.getToken==""){n({name:"login",query:{redirect_uri:e.fullPath}});return}}const o=i.tabAuths;if(o&&!qe().hasAllAuths(o)){n({name:"403",query:{target:e.fullPath}});return}n()});Y.afterEach((e,l)=>{if(e.name===l.name)return;const n=Vt(),i=Ze();let o=null;if(e.matched.length>0&&(o=e.matched[e.matched.length-1].meta),o!=null&&o.title&&i.setTitle(o==null?void 0:o.title),o!=null&&o.showSidebar){n.setSidebarShow(!0);const b=di(o==null?void 0:o.sidebar,o==null?void 0:o.tab);n.setMenuList(b),n.setMenuActiveName(o==null?void 0:o.sidebar)}else n.setSidebarShow(!1);window.scrollTo(0,0)});const Oa=vt("login",{state:()=>({Loaded:!1}),getters:{isLoaded(){return this.Loaded}}}),fi=ce({__name:"HeaderContent",setup(e){const l=Oa(),n=qe(),{globalProperties:i}=_e(),o=m(l.isLoaded),b=m(!1),g=m(n.getUsername),y=m(n.getNickname),f=m(),s=()=>{f.value=mo(n)};l.$subscribe((D,S)=>{o.value=S.Loaded}),n.$subscribe((D,S)=>{g.value=S.username,y.value=S.nickname,b.value=S.token!="",s()});const U=()=>{i.$router.currentRoute.value.name!=="login"&&i.$router.push({name:"login",query:{redirect_uri:i.$router.currentRoute.value.fullPath}})},p=()=>{n.clear(),i.$message.success({duration:3e3,content:"注销成功"}),i.$router.push({path:"/login",query:{redirect_uri:i.$router.currentRoute.value.fullPath}})};return pe(()=>{s()}),(D,S)=>{const h=Ee("router-link"),w=Ia,u=Ca,_=Ll,v=$l;return j(),E(v,{modelValue:D.$route.meta.tab,"onUpdate:modelValue":S[0]||(S[0]=d=>D.$route.meta.tab=d),class:"sh-menu","expand-type":"popup"},{logo:a(()=>[t(h,{to:"/",class:"sh-logo"},{default:a(()=>S[1]||(S[1]=[P("DidaOJ")])),_:1})]),operations:a(()=>[o.value&&b.value?(j(),E(_,{key:0,title:y.value},{icon:a(()=>[t(w,{name:"user"})]),default:a(()=>[t(u,{value:"user",to:{path:"/user/"+g.value}},{default:a(()=>S[2]||(S[2]=[P("个人空间")])),_:1},8,["to"]),t(u,{value:"user_logout",onClick:p},{default:a(()=>S[3]||(S[3]=[P(" 注销")])),_:1})]),_:1},8,["title"])):o.value?(j(),E(u,{key:2,value:"login",onClick:U},{icon:a(()=>[t(w,{name:"login"})]),default:a(()=>[S[5]||(S[5]=P(" 登录 "))]),_:1})):(j(),E(u,{key:1,value:"login"},{icon:a(()=>[t(w,{name:"login"})]),default:a(()=>[S[4]||(S[4]=P(" ... "))]),_:1}))]),default:a(()=>[(j(!0),ee(me,null,xe(f.value,d=>(j(),E(u,{key:d.name,value:d.name,to:{name:d.name}},{icon:a(()=>[d.icon?(j(),E(w,{key:0,name:d.icon},null,8,["name"])):le("",!0)]),default:a(()=>[P(" "+q(d.title),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])}}}),vi=de(fi,[["__scopeId","data-v-95e7494b"]]),_i={id:"menu-container"},gi=ce({__name:"SidebarContent",setup(e){const l=Vt(),n=m(!1),i=m(null),o=m(l.menuActiveName),b=m(l.menuList),g=m([]),y=m(!1),f=()=>{o.value=l.menuActiveName;const U=JSON.stringify(b.value),p=JSON.stringify(l.menuList);U!==p&&(g.value.push([...l.menuList]),s())},s=async()=>{if(g.value.length>0&&!y.value){for(y.value=!0;g.value.length>1;)g.value.shift();const U=g.value.shift();n.value=U.length<=0,b.value=[],await pt(),i.value&&i.value.updateActiveName(),await new Promise(D=>setTimeout(D,300)),b.value=U,await pt(),i.value&&i.value.updateActiveName();const p=300;await new Promise(D=>setTimeout(D,p)),y.value=!1,await s()}};return l.$subscribe((U,p)=>{f()}),pe(()=>{f()}),(U,p)=>{const D=Ia,S=Ca,h=Al,w=Ul,u=Ve;return j(),ee(me,null,[R("div",_i,[t(w,{modelValue:o.value,"onUpdate:modelValue":p[0]||(p[0]=_=>o.value=_),theme:"light",class:"sh-menu-container"},{default:a(()=>[t(ul,{name:"move-left"},{default:a(()=>[(j(!0),ee(me,null,xe(b.value,(_,v)=>(j(),ee(me,{key:v},[fe(fo)(_)?(j(),E(h,{key:0,title:_.title},{default:a(()=>[(j(!0),ee(me,null,xe(_.children,(d,r)=>(j(),E(S,{key:d.name,value:d.name,to:d.to},Qt({default:a(()=>[P(" "+q(d.title),1)]),_:2},[d.icon?{name:"icon",fn:a(()=>[t(D,{name:d.icon,class:Kt(d.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))),128))]),_:2},1032,["title"])):(j(),E(S,{key:_.name,value:_.name,to:_.to},Qt({default:a(()=>[P(" "+q(_.title),1)]),_:2},[_.icon?{name:"icon",fn:a(()=>[t(D,{name:_.icon,class:Kt(_.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),t(u,{size:"small",loading:n.value,"show-overlay":!0,attach:"#menu-container",class:"sh-sidebar-loading",style:{"align-items":"flex-start","padding-top":"100px"}},null,8,["loading"])],64)}}}),bi=de(gi,[["__scopeId","data-v-96e2d89f"]]),hi={};function yi(e,l){return null}const wi=de(hi,[["render",yi]]),ki={class:"footer"},Si={class:"footer-left"},Ci={class:"foot-time"},Ii={class:"footer-center"},Pi={href:"https://beiancx.miit.gov.cn/",target:"_blank"},xi={class:"footer-right"},Ti={class:"foot-text"},Vi={href:"https://github.com/hpu-developer/DiDaOJ-web",target:"_blank"},Di={class:"foot-text"},ji={href:"https://github.com/hpu-developer/DiDaOJ-go",target:"_blank"},Li=ce({__name:"FooterContent",setup(e){const l=m("");function n(){l.value=new Date().toLocaleString()}return pe(()=>{n(),setInterval(()=>{n()},1e3)}),(i,o)=>{const b=O;return j(),ee("div",ki,[R("div",Si,[R("p",Ci,q(l.value),1)]),R("div",Ii,[R("a",Pi,[t(b,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>o[0]||(o[0]=[P("豫ICP备15024677号-4")])),_:1})])]),R("div",xi,[R("p",Ti,[R("a",Vi,[t(b,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>o[1]||(o[1]=[P("@didaoj-web")])),_:1})])]),R("p",Di,[R("a",ji,[t(b,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>o[2]||(o[2]=[P("@didaoj-go")])),_:1})])])])])}}}),$i=de(Li,[["__scopeId","data-v-44f2e4e7"]]),wt=20,Et=100,qt=50,Ui=ce({__name:"ForceHiddenSidebarButton",setup(e){let l=Vt();const n=m({x:window.innerWidth-Et-wt,y:window.innerHeight-qt-wt}),i=m(window.innerWidth),o=m(window.innerHeight);let b=!1,g={x:0,y:0};const y=_=>{b=!0;const v=_.clientX??_.touches[0].clientX,d=_.clientY??_.touches[0].clientY;g={x:v-n.value.x,y:d-n.value.y},document.addEventListener("mousemove",f),document.addEventListener("touchmove",f),document.addEventListener("mouseup",s),document.addEventListener("touchend",s)},f=_=>{if(!b)return;const v=_.clientX??_.touches[0].clientX,d=_.clientY??_.touches[0].clientY;let r=v-g.x,A=d-g.y;r=Math.max(0,Math.min(r,i.value-Et)),A=Math.max(0,Math.min(A,o.value-qt)),n.value={x:r,y:A}},s=()=>{b=!1,document.removeEventListener("mousemove",f),document.removeEventListener("touchmove",f),document.removeEventListener("mouseup",s),document.removeEventListener("touchend",s)},U=()=>{i.value=window.innerWidth,o.value=window.innerHeight,n.value={x:Math.min(n.value.x,i.value-Et-wt),y:Math.min(n.value.y,o.value-qt-wt)}};let p=m(l.forceHiddenSidebar),D=m(l.forceHiddenSidebar);const S=()=>{p.value=!p.value,l.setForceHiddenSidebar(p.value)},h=()=>{D.value||(D.value=!0,l.setForceHiddenSidebar(p.value))},w=()=>{D.value&&(D.value=!1,l.setForceHiddenSidebar(!1))},u=_=>{_>=800?w():h()};return u(i.value),Ue(i,_=>{u(_)}),pe(()=>{window.addEventListener("resize",U)}),De(()=>{window.removeEventListener("resize",U)}),(_,v)=>{const d=O;return fe(D)?(j(),E(d,{key:0,class:"draggable-button",style:ga({top:`${n.value.y}px`,left:`${n.value.x}px`}),onMousedown:y,onTouchstart:y,variant:"dashed",theme:"primary",onClick:S},{default:a(()=>[P(q(fe(p)?"显示":"隐藏"),1)]),_:1},8,["style"])):le("",!0)}}}),Ai=de(Ui,[["__scopeId","data-v-1aee5506"]]),kt="DidaOJ",zi=ce({__name:"App",setup(e){const{globalProperties:l}=_e(),n=Oa(),i=qe(),o=Ze(),b=Vt();n.$patch({Loaded:!1});const g=i.getToken,y=m(!1),f=m(!1);o.title&&o.title.length>0?document.title=o.title+" - "+kt:document.title=kt,o.$subscribe((S,h)=>{h.title&&h.title.length>0?document.title=h.title+" - "+kt:document.title=kt}),b.$subscribe((S,h)=>{y.value=h.showSidebar,f.value=y.value&&!h.forceHiddenSidebar});const s=Se(),U=Je(()=>{const S=s.meta.auths;return S?!i.hasAllAuths(S):!1});function p(){l.$message.warning({duration:3e3,content:"登陆状态失效"}),n.$patch({Loaded:!0}),i.clear()}const D=async()=>{const S=document.querySelectorAll("oj-problem");if(S.length===0)return;let h={};S.forEach(_=>{const v=_.getAttribute("id"),d=document.createElement("span");d.setAttribute("style","padding:5px"),_.replaceWith(d);const r=m("default");h[v]||(h[v]=[]),h[v].push(r);let A=v;v&&!v.includes("-")&&(A="DidaOJ-"+v),ha({render:()=>ml(O,{innerHTML:A,onClick:()=>{window.open(`/problem/${v}`,"_blank")},size:"small",variant:"outline",theme:r.value})}).mount(d)});const w=[];for(const _ in h)w.push(_);const u=await Aa(w);if(u.code===0)for(const _ in h){const v=h[_];if(!v)continue;let d="primary";const r=u.data[_];if(r)switch(r){case $e.Accept:d="success";break;case $e.Attempt:d="warning";break}for(const A of v)A.value=d}};return pe(()=>{document.addEventListener("DOMContentLoaded",()=>{new MutationObserver(()=>{Ol(()=>{D()},1e3)()}).observe(document.body,{childList:!0,subtree:!0}),dl.autoSpacingPage()}),g?On().then(S=>{S.code==0?(i.loadResponse(S.data),n.$patch({Loaded:!0})):(N(l,S.code),n.$patch({Loaded:!0}),i.clear())}).catch(S=>{console.log(S),p()}):n.$patch({Loaded:!0})}),(S,h)=>{const w=zl,u=Ml,_=Ee("RouterView"),v=El,d=Rl,r=ql;return j(),ee(me,null,[t(d,{class:"sh-app-layout"},{default:a(()=>[t(w,{class:"sh-header"},{default:a(()=>[t(vi)]),_:1}),t(d,null,{default:a(()=>[t(cl,{name:"slide"},{default:a(()=>[f.value?(j(),E(u,{key:0,class:"sh-sidebar"},{default:a(()=>[t(bi)]),_:1})):le("",!0)]),_:1}),t(d,{class:Kt(["sh-main-layout",{expanded:!f.value}])},{default:a(()=>[t(wi),t(v,{class:"sh-main-content"},{default:a(()=>[U.value?(j(),E(Na,{key:0})):(j(),E(_,{key:1}))]),_:1}),t($i)]),_:1},8,["class"])]),_:1})]),_:1}),y.value?(j(),E(Ai,{key:0})):le("",!0),t(r,{container:"body",offset:["24px","80px"],size:"small"})],64)}}}),Ri=de(zi,[["__scopeId","data-v-66c2cfa5"]]);function Mi(e,l={}){const n=/\{\{%\s*(\w+)\s+([^%]+?)\s*%\}\}/g,i=l.renderers||{},o=e.renderer.rules.text??function(b,g){return b[g].content};e.renderer.rules.text=function(b,g,y,f,s){const p=b[g].content;return n.test(p)?p.replace(n,(S,h,w)=>{const u=i[h];if(typeof u=="function"){const _=w.trim().split(/\s+/);return u(_)}else return`<span class="shortcode-${h}">${h}: ${w.trim()}</span>`}):o(b,g,y,f,s)}}function Ei(e,l){const n=/\{\{%\s*(\w+)\s*%\}\}([\s\S]*?)\{\{%\s*\/\1\s*%\}\}/g;e.core.ruler.push("shortcode_color",i=>{for(const o of i.tokens){if(o.type!=="inline")continue;let b=o.content,g=!1;b=b.replace(n,(y,f,s)=>{var p;const U=(p=l.renderers)==null?void 0:p[f];return U?(g=!0,U([],s.trim())):y}),g&&(o.type="html_inline",o.tag="",o.attrs=null,o.content=b,o.children=[])}})}Gl({markdownItConfig(e){e.use($t,"align-left",{render(l,n){return l[n].nesting===1?`<div class="sh-align-left">
`:`</div>
`}}),e.use($t,"align-center",{render(l,n){return l[n].nesting===1?`<div class="sh-align-center">
`:`</div>
`}}),e.use($t,"align-right",{render(l,n){return l[n].nesting===1?`<div class="sh-align-right">
`:`</div>
`}}),e.use(Mi,{renderers:{problem:([l])=>`<oj-problem id="${l}">${l}</oj-problem>`}}),e.use(Ei,{renderers:{red:(l,n)=>`<span class="dida-font-red">${n}</span>`,green:(l,n)=>`<span class="dida-font-green">${n}</span>`,blue:(l,n)=>`<span class="dida-font-blue">${n}</span>`}})},markdownItPlugins(e){return[...e,{type:"linkAttr",plugin:vl,options:{matcher(l){return!l.startsWith("#")},attrs:{target:"_blank"}}}]}});const Ga=pl();Ga.use(fl);const ct=ha(Ri);ct.use(Ga);ct.use(Y);ct.use(Kl);ct.use(Hl);ct.use(Bl);ct.mount("#app");Jl().then(()=>{console.log("Text cache reinitialized")}).catch(e=>{console.error("Text cache reinitialization failed",e)});
