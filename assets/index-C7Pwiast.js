import{ct as pt,d as de,a as c,o as fe,cu as M,cv as V,cw as a,e as t,cx as R,cy as q,bE as x,cz as _a,aM as Ga,cA as Re,cB as le,cC as ae,F as pe,cD as Pe,cE as Ha,cF as Se,bS as ve,cG as Ba,cH as Wa,cI as Ja,b as De,v as mt,cJ as Ya,cK as Xe,j as Be,w as $e,a9 as tt,bc as Xa,bd as Za,cL as Qa,cM as el,cN as tl,br as al,cO as Dt,cP as ga,cQ as ba,cj as ll,cR as nl,cS as ol,cT as sl,bX as rl,cU as Zt,cV as Et,cW as ul,bf as il,aY as ha,z as dl,cX as cl,cY as ml,cZ as pl,c_ as jt}from"./node_modules-DOFHNO3z.js";import{L as Ve,C as he,R as Ie,a as Te,A as Ct,S as fl,b as vl,c as _l,d as gl,e as bl,f as lt,T as et,B as O,F as Ue,g as ze,I as Ae,D as nt,h as ya,i as we,j as We,k as Je,l as hl,m as Ee,n as ft,o as vt,P as qt,O as Kt,p as Ft,q as yl,r as wa,s as wl,t as kl,u as ka,v as Sa,w as It,x as Sl,y as Cl,z as Il,E as Pl,G as xl,H as Tl,J as Vl,M as Ca,K as Ia,N as Dl,Q as jl,U as Ll,V as $l,W as Ul,X as zl,Y as Al,Z as Rl,_ as El,$ as Ml}from"./tdesign-vue-next-C58KpEaq.js";import{u as _e,S as ge,a as ke,b as N,G as Ge,H as it,c as Ke,d as ql,e as Pa,f as Kl,g as Fl,h as Nl,E as Ol,M as Gl,R as Hl}from"./md-editor-v3-DcBrwSpW.js";import{e as Qt}from"./monaco-editor-ouHSYV7a.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))u(o);new MutationObserver(o=>{for(const y of o)if(y.type==="childList")for(const f of y.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&u(f)}).observe(document,{childList:!0,subtree:!0});function n(o){const y={};return o.integrity&&(y.integrity=o.integrity),o.referrerPolicy&&(y.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?y.credentials="include":o.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function u(o){if(o.ep)return;o.ep=!0;const y=n(o);fetch(o.href,y)}})();var Le=(e=>(e.ManageWeb="i-manage-web",e.ManageJudge="i-manage-judge",e.ManageProblem="i-manage-problem",e.ManageProblemDaily="i-manage-problem-daily",e.ManageContest="i-manage-contest",e.ManageCollection="i-manage-collection",e.ManageDiscuss="i-manage-discuss",e))(Le||{});const Bl={"r-admin":["i-manage-web","i-manage-judge","i-manage-problem","i-manage-problem-daily","i-manage-contest","i-manage-collection","i-manage-discuss"]};function Wl(e){if(e==null)return[];const l=[];for(const n of e){const u=Bl[n];u!=null&&l.push(...u)}return[...new Set(l)]}function Jl(e,l){if(e==null||l==null)return!1;const n=Wl(e);for(const u of l)if(!n.includes(u))return!1;return!0}const Fe=pt("user",{state:()=>({token:"",userId:-1,username:"",nickname:"",roles:[]}),getters:{getToken(){return this.token},getUserId(){return this.userId},getUsername(){return this.username},getNickname(){return this.nickname}},actions:{clear(){this.$patch({token:"",userId:-1,username:"",nickname:"",roles:[]})},loadResponse(e){this.$patch({token:e.token,userId:e.user_id,username:e.username,nickname:e.nickname,roles:e.roles})},isLogin(){return this.token!=null&&this.token!=""},hasAuth(e){return this.hasAllAuths([e])},hasAllAuths(e){return e?Jl(this.roles,e):!0}},persist:!0}),Ze=pt("webStyle",{state:()=>({title:""}),getters:{getTitle(){return this.title}},actions:{setTitle(e){this.title=e}}}),Pt=pt("sidebarStyle",{state:()=>({showSidebar:!1,forceHiddenSidebar:!1,menuActiveName:"",menuList:[]}),getters:{getMenuList(){return this.menuList}},actions:{setSidebarShow(e){this.showSidebar=e},setForceHiddenSidebar(e){this.forceHiddenSidebar=e},setMenuActiveName(e){this.menuActiveName=e},clearMenuList(){this.menuList=[]},setMenuList(e){this.menuList=e},addMenuList(e){this.menuList.push(e)}}}),Yl={style:{"text-align":"right"}},Xl=de({__name:"Hitokoto",setup(e){const l=c(!1),n=c(""),u=c(""),o=c(""),y=async()=>{l.value=!0;try{const C=await(await fetch("https://v1.hitokoto.cn")).json();u.value=C.hitokoto,o.value=C.creator,n.value="—— "+C.from}catch(f){u.value="一言获取失败了，但至少您还可以访问本站。",o.value="BoilTask",n.value="DidaOJ",console.error("Error fetching Hitokoto:",f)}finally{l.value=!1}};return fe(()=>{y()}),(f,C)=>{const v=he,s=Ve;return V(),M(s,{loading:l.value},{default:a(()=>[t(v,{title:"一言 © Hitokoto"},{actions:a(()=>[x(" @"+q(o.value),1)]),default:a(()=>[R("div",null,[R("span",null,q(u.value),1),R("p",Yl,q(n.value),1)])]),_:1})]),_:1},8,["loading"])}}}),Zl="https://oj-api.didapipa.com/",G=_a.create({baseURL:Zl,timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});G.interceptors.request.use(e=>{const n=Fe().getToken;return n&&(e.headers["X-Token"]=n),e},e=>Promise.reject(e));G.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});const xt=_a.create({timeout:6e4,withCredentials:!1,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});xt.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function xa(){return xt({baseURL:"https://r2-oj.didapipa.com",url:"/system/notification.json?"+Date.now(),method:"get"})}function Ta(){return xt({baseURL:"https://r2-oj.didapipa.com",url:"/system/announcement.json?"+Date.now(),method:"get"})}function Ql(){return G({url:"/system/status",method:"get"})}function en(){return G({url:"/system/image/token",method:"get"})}function tn(e,l){return G({url:"/system/notification",method:"post",data:{theme:e,content:l}})}function an(e,l){return G({url:"/system/announcement",method:"post",data:{title:e,content:l}})}var Tt=(e=>(e[e.Unknown=-1]="Unknown",e[e.C=0]="C",e[e.Cpp=1]="Cpp",e[e.Java=2]="Java",e[e.Python=3]="Python",e[e.Pascal=4]="Pascal",e[e.Golang=5]="Golang",e[e.Lua=6]="Lua",e[e.TypeScript=7]="TypeScript",e[e.Max=8]="Max",e))(Tt||{});function Nt(){const e=[-1,8];return Object.values(Tt).filter(l=>typeof l=="number"&&!e.includes(l)).map(l=>({value:l,label:kt(l)}))}function yt(e){return e>-1&&e<8}function kt(e){switch(e){case 0:return"C";case 1:return"C++";case 2:return"Java";case 3:return"Python";case 4:return"Pascal";case 5:return"Golang";case 6:return"Lua";case 7:return"TypeScript";default:return"未知"}}function Ot(e){switch(e){case 0:return"c";case 1:return"cpp";case 2:return"java";case 3:return"python";case 4:return"pascal";case 5:return"go";case 6:return"lua";case 7:return"typescript";default:return"text"}}var He=(e=>(e[e.Init=0]="Init",e[e.Rejudge=1]="Rejudge",e[e.Submitting=2]="Submitting",e[e.Queuing=3]="Queuing",e[e.Compiling=4]="Compiling",e[e.Running=5]="Running",e[e.Accept=6]="Accept",e[e.PE=7]="PE",e[e.WA=8]="WA",e[e.TLE=9]="TLE",e[e.MLE=10]="MLE",e[e.OLE=11]="OLE",e[e.RE=12]="RE",e[e.CE=13]="CE",e[e.CLE=14]="CLE",e[e.JudgeFail=15]="JudgeFail",e[e.SubmitFail=16]="SubmitFail",e[e.Unknown=17]="Unknown",e[e.Max=18]="Max",e))(He||{});const ln=e=>{switch(e){case 0:return"普通评测";case 1:return"特殊评测";default:return"未知"}},St=e=>{switch(e){case 0:return"等待处理";case 1:return"重新评测";case 2:return"提交中";case 3:return"队列中";case 4:return"编译中";case 5:return"运行中";case 6:return"通过";case 7:return"格式错误";case 8:return"答案错误";case 9:return"超时";case 10:return"内存超限";case 11:return"输出超限";case 12:return"运行错误";case 13:return"编译错误";case 14:return"编译超限";case 15:return"评测失败";case 16:return"提交失败";case 17:return"未知";default:return e}},ea=e=>{if(e!==void 0)switch(e){case 0:return"已经提交到系统，请耐心等待评测结果";case 1:return"管理员发起了重新评测，请耐心等待评测结果";case 2:return"判题机已经接受了本次提交，正在提交到远程判官中";case 3:return"判题机已经接受了本次提交，正在排队等待评测";case 4:return"判题机正在编译您的代码，部分语言会在此步检查是否符合语法";case 5:return"您的代码正在运行，请等待运行结果";case 6:return"您的代码通过了测试用例，恭喜您！";case 7:return"您的代码基本正确，但可能存在空格、空行等格式错误，请认真对比输出要求";case 8:return"您的答案与标准答案存在区别，请继续思考有无未考虑的情况";case 9:return"运行您的代码所用的时间超过了题目限制，请思考时间上更优的解法";case 10:return"运行您的代码所用的内存超过了题目限制，请思考空间上更优的解法";case 11:return"您程序的输出内容远远多于了题目要求（一般是数倍于正确输出），请检查相关逻辑";case 12:return"在运行您程序的过程中发生了异常，可能是除零、数组越界等问题，请检查相关逻辑";case 13:return"您的代码在编译阶段发生了错误，可能是语法错误或其他编译问题，请检查相关逻辑";case 14:return"在编译您代码的过程中，所占用的资源远远超过了要求，请检查相关逻辑";case 15:return"评测过程中发生了异常，一般是判题机或远程判官的问题，可尝试联系管理员处理";case 16:return"在将您的代码提交到远程判官的过程中发生了错误，一般是判题机或远程判官的问题，可联系管理员处理";case 17:return"您的代码状态未知，有可能是您不具有权限，或者该代码状态被隐藏"}return"暂时无提示信息"},Va=e=>{switch(e){case 0:case 1:case 2:case 3:case 4:case 5:case 17:return"default";case 6:return"success";case 7:return"warning";default:return"danger"}};function Da(){const e=[17,18];return Object.values(He).filter(l=>typeof l=="number"&&!e.includes(l)).map(l=>({value:l,label:St(l)}))}function wt(e){return e>=0&&e<17}function ut(e){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return!0;default:return!1}}function ja(e){var n;const l={};if(l.id=e.id,l.problemId=e.problem_id,l.contestProblemIndex=e.contest_problem_index,l.status=e.status,ut(e.status)||!wt(e.status)?l.score="-":l.score=(e.score/10).toString(),e.time?l.time=Math.ceil(e.time/1e6)+"ms":l.time="-",e.memory?l.memory=(e.memory/1024/1024).toFixed(2)+"MB":l.memory="-",l.language=e.language,l.codeLength=e.code_length,e.approve_time?l.approveTime=new Date(e.approve_time).toLocaleString():l.approveTime="-",l.author=e.author,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.code=e.code,l.compileMessage=e.compile_message,l.taskCurrent=e.task_current,l.taskTotal=e.task_total,l.task=[],e.task)for(let u=0;u<((n=e.task)==null?void 0:n.length);u++){const o=e.task[u],y={};y.taskId=o.task_id,y.status=o.status,o.time?y.time=Math.ceil(o.time/1e6)+"ms":y.time="-",o.memory?y.memory=(o.memory/1024/1024).toFixed(2)+"MB":y.memory="-",o.score?y.score=(o.score/10).toString():y.score="-",y.content=o.content,y.waHint=o.wa_hint,l.task.push(y)}return e.judger&&(l.judger=e.judger),e.judger_name?l.judgerName=e.judger_name:l.judgerName="-",e.judge_time&&(l.judgeTime=new Date(e.judge_time).toLocaleString()),l}function nn(e,l,n,u,o){return G({url:"/judge/approve",method:"post",data:{problem_id:e,contest_id:l,problem_index:n,language:u,code:o}})}function on(e){return G({url:"/judge?id="+e,method:"get"})}function sn(e){return G({url:"/judge/code?id="+e,method:"get"})}function rn(e,l,n,u,o,y,f){let C={problem_id:l,username:n,language:String(u),status:String(o),page:String(y),page_size:String(f)};return e&&(C.contest_id=String(e)),G({url:`/judge/list?${new URLSearchParams(C).toString()}`,method:"get"})}function un(){return G({url:"/judge/statics/recently",method:"get"})}function dn(){return G({url:"/judge/rejudge/recently",method:"post"})}function cn(e,l,n){const u={};return e!=null&&(u.problem_id=e),l!=null?u.language=l:u.language=Tt.Unknown,n!=null?u.status=n:u.status=18,G({url:"/judge/rejudge/search",method:"post",data:u})}function mn(){return G({url:"/judge/rejudge/all",method:"post",timeout:0})}function pn(e){return G({url:"/judge/rejudge",method:"post",data:{id:Number(e)}})}var Ne=(e=>(e[e.None=0]="None",e[e.Attempt=1]="Attempt",e[e.Accept=2]="Accept",e))(Ne||{});function _t(e,l){const n={};if(n.id=e.id,n.author=e.author,n.title=e.title,n.tags=[],e.tags)for(const u of e.tags){const o=l[u];o&&n.tags.push(o)}if(n.private=e.private,n.accept=e.accept,n.attempt=e.attempt,e.description!=null&&(n.description=e.description),e.time_limit!=null&&e.time_limit>=0?n.timeLimit=e.time_limit.toString()+" ms":n.timeLimit="未知",e.memory_limit!=null&&e.memory_limit>=0?n.memoryLimit=(e.memory_limit/1024).toFixed(2)+" MB":n.memoryLimit="未知",e.judge_type!=null&&(n.judgeType=ln(e.judge_type)),e.insert_time!=null&&(n.insertTime=new Date(e.insert_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.source!=null){const u=/\[([^\]]+)\]\(([^)]+)\)/,o=e.source.match(u);o?(n.source=o[1],n.sourceUrl=o[2]):(n.source=e.source,n.sourceUrl="")}return e.judge_md5!=null&&(n.judgeMd5=e.judge_md5),e.origin_oj!=null&&(n.originOj=e.origin_oj),e.origin_id!=null&&(n.originId=e.origin_id),e.origin_url!=null&&(n.originUrl=e.origin_url),n}function La(e,l){const n={};if(n.id=e.id,n.problemId=e.problem_id,n.title=e.title,n.tags=[],e.tags)for(const u of e.tags){const o=l[u];o&&n.tags.push(o)}return e.accept?n.accept=e.accept:n.accept=0,e.attempt?n.attempt=e.attempt:n.attempt=0,n.solution=e.solution,n.code=e.code,e.create_time!=null&&(n.createTime=new Date(e.create_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.updater_nickname!=null&&(n.updaterNickname=e.updater_nickname),n}function $a(e,l,n){const u={};return e?u.id=e:(u.contest_id=l,u.problem_index=n),G({url:`/problem?${new URLSearchParams(u).toString()}`,method:"get"})}function Ua(e){return G({url:"/problem/tag/list?max_count="+e,method:"get"})}function fn(e){return G({url:"/problem/judge?id="+e,method:"get"})}function vn(e,l,n,u,o,y){const f={};return e&&(f.oj=e),l&&(f.title=l),n&&(f.tag=n),u!==void 0&&(f.private=u?"1":"0"),o&&(f.page=o),y&&(f.page_size=y),G({url:`/problem/list?${new URLSearchParams(f).toString()}`,method:"get"})}function _n(e){const l={};return e&&(l.problem_id=e),G({url:`/problem/recommend?${new URLSearchParams(l).toString()}`,method:"get"})}function gn(e){return G({url:"/problem/daily?id="+e,method:"get"})}function bn(e){return G({url:"/problem/daily/edit?id="+e,method:"get"})}function hn(){return G({url:"/problem/daily/recently",method:"get"})}function yn(e,l,n,u,o){const y={};return e&&(y.start_date=e),l&&(y.end_date=l),n&&(y.problem_id=n),u&&(y.page=u),o&&(y.page_size=o),G({url:`/problem/daily/list?${new URLSearchParams(y).toString()}`,method:"get"})}function wn(e){return G({url:"/problem/attempt/status",method:"get",params:{ids:e.join(",")}})}function za(e,l){return G({url:"/problem/crawl",method:"post",data:{oj:e,id:l}})}function kn(e,l,n,u,o,y,f){return G({url:"/problem/create",method:"post",data:{title:e,time_limit:l,memory_limit:n,source:u,private:o,tags:y,description:f}})}function Sn(e,l,n,u,o,y,f,C){return G({url:"/problem/edit",method:"post",data:{id:e,title:l,time_limit:n,memory_limit:u,source:o,private:y,tags:f,description:C}})}function Cn(e,l,n,u){return G({url:"/problem/daily/create",method:"post",data:{id:e,problem_id:l,solution:n,code:u}})}function In(e,l,n,u){return G({url:"/problem/daily/edit",method:"post",data:{id:e,problem_id:l,solution:n,code:u}})}function Pn(e,l){return G({url:"/problem/judge/data/download?id="+e+"&key="+l,method:"get"})}function xn(e){return e||(e=""),G({url:"/problem/image/token?id="+e,method:"get"})}function Tn(e){return e||(e=""),G({url:"/problem/daily/image/token?id="+e,method:"get"})}function Vn(e,l){const n=new FormData;return n.append("id",e),n.append("zip",l),G({url:"/problem/judge/data",method:"post",data:n,headers:{"Content-Type":"multipart/form-data"},timeout:1e3*60*5})}function Dn(e){return G({url:"/problem/parse",method:"post",data:{problems:e}})}const jn={class:"sh-main"},Ln={class:"dida-swiper-div"},$n=de({__name:"HomeView",setup(e){const{globalProperties:l}=_e();let n=-1;const u=c({theme:"info",content:""}),o=c({title:"",content:""}),y=c([]),f=c(!1),C=c(!1),v=c(!1),s=async()=>{u.value=await xa()},$=async()=>{try{const w=await Ta();o.value.title=w.title,o.value.content=w.content}catch{ge(l,"加载公告失败"),o.value={title:"公告加载失败",content:"请刷新页面重新获取"}}},p=async()=>{const w=await un();if(w.code!==0){ge(l,"加载OJ统计数据失败");return}let b=[];for(const _ of w.data){const g=new Date(_.date),d=`${g.getMonth()+1}-${g.getDate()}`;b.push({Date:d,Type:"Unaccept",Count:_.attempt-_.accept}),b.push({Date:d,Type:"Accept",Count:_.accept})}const S={type:"bar",data:[{id:"barData",values:b}],xField:"Date",yField:"Count",seriesField:"Type",stack:!0,legends:{visible:!0},bar:{state:{hover:{stroke:"#000",lineWidth:1}}},height:300};new Ha(S,{dom:"ojStaticsDiv"}).renderSync()},T=async()=>{y.value=[];const w=await hn();if(w.code!==0){ge(l,"加载每日问题数据失败");return}w.data.list&&w.data.list.length>0&&w.data.list.forEach(b=>{let S="default",i="未尝试";if(w.data.attempt_status){const g=w.data.attempt_status[b.problem_id];if(g)switch(g){case Ne.Accept:S="success",i="已解决";break;case Ne.Attempt:S="warning",i="待解决";break;default:S="default",i="未尝试"}}const _=`${b.title}`;y.value.push({id:b.id,title:_,problemId:b.problem_id,theme:S,tag:i})})};return fe(async()=>{v.value=!0,f.value=!0,C.value=!0,(async()=>(await s(),n=setInterval(()=>{s()},3e4),await $(),v.value=!1))(),(async()=>(await p(),f.value=!1))(),(async()=>(await T(),C.value=!1))()}),Ga(()=>{clearInterval(n)}),(w,b)=>{const S=Ct,i=vl,_=fl,g=Ve,d=Re("md-preview"),r=he,z=Te,m=lt,h=bl,U=et,k=gl,P=_l,j=Ie;return V(),M(g,{loading:v.value},{default:a(()=>[t(j,null,{default:a(()=>[t(z,{span:8},{default:a(()=>{var A;return[R("div",jn,[u.value?(V(),M(S,{key:0,class:"dida-notification-div",theme:u.value.theme},{default:a(()=>[x(q(u.value.content),1)]),_:1},8,["theme"])):le("",!0),R("div",Ln,[t(_,{class:"dida-swiper"},{default:a(()=>[t(i,null,{default:a(()=>b[1]||(b[1]=[R("a",{href:"http://codeoj.cn",target:"_blank"},[R("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"})],-1)])),_:1}),t(i,null,{default:a(()=>b[2]||(b[2]=[R("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1})]),_:1})]),t(g,{loading:f.value&&!v.value},{default:a(()=>b[3]||(b[3]=[R("div",{id:"ojStaticsDiv",style:{"min-height":"200px"}},null,-1)])),_:1},8,["loading"]),t(r,{title:(A=o.value)==null?void 0:A.title,style:{width:"calc(100% - 100px)",margin:"0 auto"}},{default:a(()=>{var D;return[t(d,{"model-value":(D=o.value)==null?void 0:D.content,previewTheme:"cyanosis"},null,8,["model-value"])]}),_:1},8,["title"])])]}),_:1}),t(z,{span:4},{default:a(()=>[t(r,{style:{margin:"10px"},bordered:!0},{default:a(()=>b[4]||(b[4]=[R("img",{src:"https://api.jysafe.cn/ip/",alt:"Welcome",style:{width:"100%"}},null,-1)])),_:1}),t(Xl,{style:{margin:"10px"}}),t(r,{style:{margin:"10px"},bordered:!0,title:"每日一题"},{actions:a(()=>[t(m,{onClick:b[0]||(b[0]=A=>w.$router.push({name:"problem-daily-list"}))},{default:a(()=>b[5]||(b[5]=[x("查看全部")])),_:1})]),default:a(()=>[t(g,{loading:C.value&&!v.value},{default:a(()=>[t(P,{split:!0,size:"small",style:{"min-height":"200px"}},{default:a(()=>[(V(!0),ae(pe,null,Pe(y.value,A=>(V(),M(k,{key:A.id},{default:a(()=>[t(h,{style:{width:"100px"}},{description:a(()=>[t(m,{onClick:D=>w.$router.push({name:"problem-daily-detail",params:{dailyId:A.id}})},{default:a(()=>[x(q(A.problemId),1)]),_:2},1032,["onClick"])]),_:2},1024),t(h,{style:{width:"200px"}},{description:a(()=>[t(m,{onClick:D=>w.$router.push({name:"problem-daily-detail",params:{dailyId:A.id}})},{default:a(()=>[x(q(A.title),1)]),_:2},1032,["onClick"])]),_:2},1024),t(h,{style:{width:"135px"},description:A.id},null,8,["description"]),t(h,null,{description:a(()=>[t(U,{theme:A.theme},{default:a(()=>[x(q(A.tag),1)]),_:2},1032,["theme"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["loading"])]),_:1}),t(r,{style:{margin:"10px"},bordered:!0},{header:a(()=>b[6]||(b[6]=[R("b",null,"友情链接",-1)])),default:a(()=>[t(P,null,{default:a(()=>[t(k,null,{default:a(()=>[t(m,{href:"https://boiltask.com",target:"_blank"},{default:a(()=>b[7]||(b[7]=[x("BoilTask Blog")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])}}}),ce=(e,l)=>{const n=e.__vccOpts||e;for(const[u,o]of l)n[u]=o;return n},Un=ce($n,[["__scopeId","data-v-805a64dc"]]),zn={class:"sh-main"},An=de({__name:"View404",setup(e){let l=Se(),n=c(l.fullPath);return(u,o)=>{const y=O;return V(),ae("div",zn,[R("p",null,q(ve(n)),1),o[2]||(o[2]=R("p",null,"该页面无效或已被迁移，请重新选择访问目标",-1)),t(y,{theme:"primary",onClick:o[0]||(o[0]=()=>u.$router.push("/"))},{default:a(()=>o[1]||(o[1]=[x("返回首页")])),_:1})])}}}),Aa=ce(An,[["__scopeId","data-v-d4218944"]]);function Rn(e){const l={};return l.id=e.id,l.username=e.username,l.nickname=e.nickname,l.email=e.email,l.slogan=e.slogan,l.organization=e.organization,l.accept=e.accept,l.attempt=e.attempt,l.vjudgeId=e.vjudge_id,e.email&&(l.avatar=`https://www.gravatar.com/avatar/${Ba(e.email.toLowerCase().trim())}?d=identicon&s=100`),l}function En(e,l){return G({url:"/user/login",method:"post",data:{username:e,password:l}})}function Mn(){return G({url:"/user/login/refresh",method:"post"})}function qn(e){const l={username:e};return G({url:`/user/info?${new URLSearchParams(l).toString()}`,method:"get"})}function Kn(e){const l="https://vjudge.net/user/solveDetail/"+encodeURIComponent(e);return xt({url:l,method:"get"})}function Fn(e){return G({url:"/user/account/infos",method:"post",data:{users:e}})}function Nn(e){return G({url:"/user/parse",method:"post",data:{users:e}})}function On(e,l){return G({url:"/user/register/email",method:"post",data:{token:e,email:l}})}function Gn(e,l,n,u,o){return G({url:"/user/register",method:"post",data:{username:e,password:l,email:n,key:u,nickname:o}})}function Hn(e,l){return G({url:"/user/forget",method:"post",data:{token:e,username:l}})}function Bn(e,l,n){return G({url:"/user/password/modify",method:"post",data:{username:e,password:l,key:n}})}const Wn={class:"dida-login-footer"},Jn=de({__name:"LoginView",setup(e){const{globalProperties:l}=_e(),n=Fe(),u=c(!1),o=c({username:"",password:""}),y=()=>{ke(l,"重置成功")},f=({validateResult:C,firstError:v})=>{u.value||(u.value=!0,En(o.value.username,o.value.password).then(s=>{if(s.code===0){n.loadResponse(s.data),ke(l,"登录成功");let $=l.$route.query.redirect_uri;$||($="/user/"+s.data.username),l.$router.push({path:$})}else N(l,s.code)}).catch(s=>{console.error("Login error",s),ge(l,"登录失败")}).finally(()=>{u.value=!1}))};return fe(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),(C,v)=>{const s=Ae,$=ze,p=O,T=Ue,w=lt,b=he;return V(),M(b,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(T,{ref:"form",data:o.value,colon:!0,onReset:y,onSubmit:f,class:"yj-login-form","label-width":0},{default:a(()=>[t($,{name:"username"},{default:a(()=>[t(s,{modelValue:o.value.username,"onUpdate:modelValue":v[0]||(v[0]=S=>o.value.username=S),clearable:"",autocomplete:"username",placeholder:"请输入用户名"},{"prefix-icon":a(()=>[t(ve(Wa))]),_:1},8,["modelValue"])]),_:1}),t($,{name:"password"},{default:a(()=>[t(s,{modelValue:o.value.password,"onUpdate:modelValue":v[1]||(v[1]=S=>o.value.password=S),type:"password",autocomplete:"current-password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":a(()=>[t(ve(Ja))]),_:1},8,["modelValue"])]),_:1}),t($,null,{default:a(()=>[t(p,{theme:"primary",type:"submit",block:"",loading:u.value},{default:a(()=>v[4]||(v[4]=[x("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),R("div",Wn,[t(w,{onClick:v[2]||(v[2]=()=>{ve(l).$router.push({name:"login-forget"})})},{default:a(()=>v[5]||(v[5]=[x("忘记密码 ")])),_:1}),t(w,{onClick:v[3]||(v[3]=()=>{ve(l).$router.push({name:"register"})})},{default:a(()=>v[6]||(v[6]=[x("注册账户 ")])),_:1})])]),_:1})}}}),Yn=ce(Jn,[["__scopeId","data-v-524b77f9"]]),Xn={class:"dida-login-footer"},Zn=de({__name:"RegisterView",setup(e){const{globalProperties:l}=_e(),n=Fe(),u=c(!1),o=c(!1),y=c(!1),f=c("发送验证码");let C=null,v=-1;const s=c(!1),$=c(null),p=c({username:"",password:"",confirmPassword:"",nickname:"",email:"",emailKey:""}),w=c({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:d=>new Promise(r=>{const z=setTimeout(()=>{r(p.value.password===d),clearTimeout(z)})}),message:"两次密码不一致"}],nickname:[{required:!0,message:"请填写昵称"},{min:1,message:"昵称至少1个字符"},{max:30,message:"昵称最多30个字符"}],email:[{required:!0,message:"请填写邮箱"},{pattern:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"邮箱格式不正确"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),b=c(()=>t(O,{onClick:S,disabled:y.value,loading:o.value,style:"width:120px"},{default:()=>[f.value]})),S=async()=>{var m;if(!p.value.email){ge(l,"请输入邮箱");return}if(!p.value.email.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)){ge(l,"邮箱格式不正确");return}if(y.value||o.value)return;s.value=!0,await mt();const d=document.getElementById("cf-confirm-div");d&&d.remove();const r=document.createElement("div");r.id="cf-confirm-div",r.setAttribute("data-theme","light"),(m=$.value)==null||m.appendChild(r);const z=window;z.turnstile.ready(function(){z.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(h){s.value=!1,await i(h)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},i=async d=>{if(!y.value){o.value=!0;try{const r=await On(d,p.value.email);if(r.code!==0){N(l,r.code);return}ke(l,"发送验证码成功"),o.value=!1,y.value=!0,C=new Date,f.value="60秒后重发",v=setInterval(()=>{const m=Math.floor((new Date().getTime()-(C==null?void 0:C.getTime()))/1e3);m>60?(f.value="发送验证码",y.value=!1,clearInterval(v)):f.value=`${60-m}秒后重发`},1e3)}catch{ge(l,"发送验证码失败")}finally{o.value=!1}}},_=()=>{ke(l,"重置成功")},g=({validateResult:d,firstError:r,e:z})=>{if(!u.value){if(z.preventDefault(),d!==!0){ge(l,r);return}if(p.value.password!==p.value.confirmPassword){ge(l,"两次密码不一致");return}u.value=!0,Gn(p.value.username,p.value.password,p.value.email,p.value.emailKey,p.value.nickname).then(m=>{m.code===0?(ke(l,"注册成功，可使用账号信息登录"),l.$router.push({name:"login"})):N(l,m.code)}).catch(m=>{console.error("Login error",m),ge(l,"登录失败")}).finally(()=>{u.value=!1})}};return fe(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),De(()=>{clearInterval(v)}),(d,r)=>{const z=Ae,m=ze,h=ya,U=O,k=Ue,P=lt,j=he,A=nt;return V(),ae(pe,null,[t(j,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(k,{ref:"form",rules:w.value,data:p.value,colon:!0,onReset:_,onSubmit:g,class:"yj-login-form"},{default:a(()=>[t(m,{name:"username",label:"用户名"},{default:a(()=>[t(z,{modelValue:p.value.username,"onUpdate:modelValue":r[0]||(r[0]=D=>p.value.username=D),clearable:"",placeholder:"用于登录与查找"},null,8,["modelValue"])]),_:1}),t(m,{name:"password",label:"密码"},{default:a(()=>[t(z,{modelValue:p.value.password,"onUpdate:modelValue":r[1]||(r[1]=D=>p.value.password=D),type:"password",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(m,{name:"confirmPassword",label:"确认密码"},{default:a(()=>[t(z,{modelValue:p.value.confirmPassword,"onUpdate:modelValue":r[2]||(r[2]=D=>p.value.confirmPassword=D),type:"password",clearable:"",placeholder:"请确认密码"},null,8,["modelValue"])]),_:1}),t(m,{name:"nickname",label:"昵称"},{default:a(()=>[t(z,{modelValue:p.value.nickname,"onUpdate:modelValue":r[3]||(r[3]=D=>p.value.nickname=D),clearable:"",placeholder:"用于优先在网站各处展示"},null,8,["modelValue"])]),_:1}),t(m,{name:"email",label:"邮箱"},{default:a(()=>[t(z,{modelValue:p.value.email,"onUpdate:modelValue":r[4]||(r[4]=D=>p.value.email=D),clearable:"",placeholder:"请填写常用邮箱"},null,8,["modelValue"])]),_:1}),t(m,{name:"emailKey",label:"验证码"},{default:a(()=>[t(h,{append:b.value},{default:a(()=>[t(z,{modelValue:p.value.emailKey,"onUpdate:modelValue":r[5]||(r[5]=D=>p.value.emailKey=D),clearable:"",placeholder:"请输入验证码",style:{width:"140px"}},null,8,["modelValue"])]),_:1},8,["append"])]),_:1}),t(m,null,{default:a(()=>[t(U,{theme:"primary",type:"submit",block:"",loading:u.value},{default:a(()=>r[8]||(r[8]=[x("注册")])),_:1},8,["loading"])]),_:1})]),_:1},8,["rules","data"]),R("div",Xn,[t(P,{onClick:r[6]||(r[6]=()=>{ve(l).$router.push({name:"login"})})},{default:a(()=>r[9]||(r[9]=[x("返回登陆 ")])),_:1})])]),_:1}),t(A,{visible:s.value,"onUpdate:visible":r[7]||(r[7]=D=>s.value=D),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:a(()=>[R("div",{ref_key:"dialogContainer",ref:$,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),Qn=ce(Zn,[["__scopeId","data-v-9b5f4fc7"]]),eo={key:0,style:{margin:"10px"}},to={key:1,style:{margin:"10px"}},ao={style:{margin:"12px"}},lo=de({__name:"UserView",setup(e){let l=Se();const{globalProperties:n}=_e(),u=Ze();let o="";const y=c(!1),f=c(null),C=c([]),v=c([]),s=c([]),$=async p=>{y.value=!0;try{let T=await qn(p);if(T.code!==0){y.value=!1,N(n,T.code),await X.push({name:"home"});return}if(f.value=Rn(T.data.user),C.value=T.data.problems_ac,u.setTitle(f.value.nickname+" - "+u.getTitle),f.value.vjudgeId){const w=await Kn(f.value.vjudgeId);v.value=w.acRecords;for(const b in v.value)v.value[b].sort((S,i)=>S.length===i.length?S.localeCompare(i):S.length-i.length);s.value=w.failRecords;for(const b in s.value)s.value[b].sort((S,i)=>S.length===i.length?S.localeCompare(i):S.length-i.length)}}catch{ge(n,"获取用户信息失败"),await X.push({name:"home"})}finally{y.value=!1}};return Ya(async(p,T,w)=>{if(Array.isArray(p.params.username)?o=p.params.username[0]:o=p.params.username,!o){await X.push({name:"home"});return}await $(o),w()}),fe(async()=>{if(Array.isArray(l.params.username)?o=l.params.username[0]:o=l.params.username,!o){await X.push({name:"home"});return}await $(o)}),(p,T)=>{const w=O,b=we,S=he,i=lt,_=Je,g=We,d=Te,r=hl,z=Ie,m=Ve;return V(),M(m,{loading:y.value},{default:a(()=>[t(z,{class:"dida-main-content"},{default:a(()=>[t(d,{span:8},{default:a(()=>{var h;return[t(S,{style:{margin:"10px"},title:"AC题目"},{default:a(()=>[t(b,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(V(!0),ae(pe,null,Pe(C.value,U=>(V(),M(w,{key:U,size:"small",onClick:()=>ve(X).push({name:"problem-detail",params:{problemId:U}})},{default:a(()=>[x(q(U),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),(h=f.value)!=null&&h.vjudgeId?(V(),M(S,{key:0,style:{margin:"10px"},title:"vjudge.net"},{actions:a(()=>{var U;return[t(i,{href:"https://vjudge.net/user/"+((U=f.value)==null?void 0:U.vjudgeId),target:"_blank"},{default:a(()=>{var k;return[x("@"+q((k=f.value)==null?void 0:k.vjudgeId),1)]}),_:1},8,["href"])]}),default:a(()=>[v.value&&Object.keys(v.value).length>0?(V(),ae("div",eo,[T[0]||(T[0]=R("div",{style:{margin:"5px"}},[R("span",null,"AC")],-1)),t(g,{layout:"vertical",bordered:!0},{default:a(()=>[(V(!0),ae(pe,null,Pe(v.value,(U,k)=>(V(),M(_,{key:k,label:k},{default:a(()=>[t(b,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(V(!0),ae(pe,null,Pe(U,P=>(V(),M(w,{key:P,size:"small",onClick:()=>ve(X).push({name:"problem-detail",params:{problemId:k+"-"+P}})},{default:a(()=>[x(q(P),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):le("",!0),s.value&&Object.keys(s.value).length>0?(V(),ae("div",to,[T[1]||(T[1]=R("div",{style:{margin:"5px"}},[R("span",null,"Fail")],-1)),t(g,{layout:"vertical",bordered:!0},{default:a(()=>[(V(!0),ae(pe,null,Pe(s.value,(U,k)=>(V(),M(_,{key:k,label:k},{default:a(()=>[t(b,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(V(!0),ae(pe,null,Pe(U,P=>(V(),M(w,{key:P,size:"small",onClick:()=>ve(X).push({name:"problem-detail",params:{problemId:k+"-"+P}})},{default:a(()=>[x(q(P),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):le("",!0)]),_:1})):le("",!0)]}),_:1}),t(d,{span:4},{default:a(()=>[R("div",ao,[t(g,{layout:"vertical",bordered:!0},{default:a(()=>[t(_,{label:"头像"},{default:a(()=>{var h;return[t(r,{shape:"round",size:"100px",image:(h=f.value)==null?void 0:h.avatar,"hide-on-load-failed":!1},null,8,["image"])]}),_:1}),t(_,{label:"昵称"},{default:a(()=>{var h;return[x(q((h=f.value)==null?void 0:h.nickname),1)]}),_:1}),t(_,{label:"Slogan"},{default:a(()=>{var h;return[x(q((h=f.value)==null?void 0:h.slogan),1)]}),_:1}),t(_,{label:"邮箱"},{default:a(()=>{var h;return[x(q((h=f.value)==null?void 0:h.email),1)]}),_:1}),t(_,{label:"组织"},{default:a(()=>{var h;return[x(q((h=f.value)==null?void 0:h.organization),1)]}),_:1}),t(_,{label:"通过数量"},{default:a(()=>{var h;return[x(q((h=f.value)==null?void 0:h.accept),1)]}),_:1}),t(_,{label:"提交数量"},{default:a(()=>{var h;return[x(q((h=f.value)==null?void 0:h.attempt),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),no=ce(lo,[["__scopeId","data-v-555e19aa"]]),Gt=[{name:"home",path:"/",title:"首页",showSidebar:!1,disableGenerateTab:!0,component:Un},{name:"problem",path:"/problem",title:"题目",icon:"calculation",showSidebar:!0,redirect:"problem-list"},{name:"collection-detail-tab",title:"题集",path:"/collection",showSidebar:!0,disableGenerateTab:!0,redirect:"problem-collection-list"},{name:"judge",path:"/judge",title:"评测",icon:"code",showSidebar:!0,redirect:"judge-list"},{name:"contest",path:"/contest",title:"比赛",icon:"application",showSidebar:!0,redirect:"contest-list"},{name:"contest-detail-tab",title:"比赛",path:"/contest",showSidebar:!0,disableGenerateTab:!0,redirect:"contest-list"},{name:"discuss",title:"讨论",path:"/discuss",icon:"sonic",showSidebar:!0,redirect:"discuss-list"},{name:"discuss-detail-tab",title:"讨论",path:"/discuss",showSidebar:!0,disableGenerateTab:!0,redirect:"discuss-list"},{name:"rank",path:"/rank",title:"排名",icon:"chart-column",showSidebar:!0,redirect:"rank-ac-all"},{name:"system",path:"/system",title:"系统",icon:"dashboard",showSidebar:!0,redirect:"system-status"},{name:"manage",path:"/manage",title:"管理",icon:"command",showSidebar:!0,redirect:"manage-web",auths:[Le.ManageWeb]},{name:"login",path:"/login",title:"登陆",showSidebar:!1,disableGenerateTab:!0,component:Yn},{name:"register",path:"/register",title:"注册",showSidebar:!1,disableGenerateTab:!0,component:Qn},{name:"user",path:"/user/:username+",title:"用户",showSidebar:!1,needLogin:!0,disableGenerateTab:!0,component:no},{name:"404",path:"/404",title:"404",showSidebar:!1,disableGenerateTab:!0,component:Aa}],oo=e=>Gt.find(l=>l.name==e),so=e=>{const l=[];return Gt.forEach(n=>{!n.disableGenerateTab&&e.hasAllAuths(n.auths)&&l.push(n)}),l},ro=e=>{Gt.forEach(l=>{const n={name:l.name,path:l.path,meta:{title:l.title,tab:l.name,showSidebar:l.showSidebar,needLogin:l.needLogin,redirect:l.redirect,tabAuths:l.auths},component:l.component};e.push(n)})};function Ra(e){return e.children!==void 0}function uo(e){return e.children!==void 0}const io={style:{margin:"10px"}},co={key:0,class:"dida-operation-container"};function mo(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const po=de({__name:"ProblemList",setup(e){const l=Se(),n=Xe(),{globalProperties:u}=_e(),o=Fe();let y=null;const f=c(!1),C={};let v={};const s=c(!1),$=Be(()=>o.hasAuth(Le.ManageProblem)),p=c([{title:"ID",colKey:"id",cell:(I,L)=>{let E=m(L.row.id);return t(O,{variant:"dashed",theme:E,onClick:()=>z(L.row.id)},{default:()=>[L.row.id]})}},{title:"标题",colKey:"title",cell:(I,L)=>t(O,{variant:"text",onClick:()=>z(L.row.id)},{default:()=>[L.row.title]})},{title:"标签",colKey:"tags",cell:(I,L)=>{const E=L.row.tags;if(!E||E.length===0)return"";let H=[];for(let Z=0;Z<E.length;Z++){const Q=E[Z];H.push(t(O,{key:Z,theme:"default",variant:"outline",size:"small",onClick:()=>P(Q)},{default:()=>[Q.name]}))}return t(we,null,mo(H)?H:{default:()=>[H]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),T=c(!1);let w=1,b=50;const S=c({current:w,pageSize:b,defaultCurrent:w,defaultPageSize:b,total:0,pageSizeOptions:[50,100]}),i=c(),_=c(),g=[{label:"DidaOJ",value:"didaoj"},{label:"HDU",value:"hdu"},{label:"POJ",value:"poj"},{label:"NYOJ",value:"nyoj"}],d=c({oj:"",title:"",tag:"",private:!1}),r=c({oj:"",problem:""}),z=I=>{I&&n.push({path:"/problem/"+I})},m=I=>{if(!I||!v)return"default";const L=v[I];if(!L)return"default";switch(L){case Ne.Accept:return"success";case Ne.Attempt:return"warning";default:return"default"}},h=async()=>{await n.push({query:{...l.query,oj:d.value.oj,title:d.value.title,tag:d.value.tag,private:d.value.private?"1":"0",page:1,page_size:S.value.defaultPageSize}})},U=async()=>{d.value.oj="",d.value.title="",d.value.tag="",d.value.private=!1,await n.push({query:{...l.query,oj:"",title:"",tag:"",private:"0",page:1,page_size:S.value.defaultPageSize}})},k=async()=>{try{s.value=!0;const I=await za(r.value.oj,r.value.problem);I.code===0?(ke(u,"搜索成功"),await n.push({name:"problem-detail",params:{problemId:I.data}})):N(u,I.code)}catch(I){console.error(I),N(u,Ge())}finally{s.value=!1}},P=I=>{I&&n.push({query:{...l.query,title:"",tag:I.name,page:1,page_size:S.value.defaultPageSize}})},j=()=>{n.push({name:"manage-problem-create"})},A=async(I,L)=>{T.value=!0;try{const{current:E,pageSize:H}=I,Z=await vn(d.value.oj,d.value.title,d.value.tag,d.value.private,E,H);if(i.value=[],Z.code===0){const Q=Z.data.list;if(!Q||Q.length<=0){S.value={...S.value,total:0},v={},ke(u,"未找到记录");return}Q.forEach(ee=>{var F;const te=_t(ee,C);(F=i.value)==null||F.push(te)}),S.value={...S.value,total:Z.data.total_count},v=Z.data.problem_attempt_status}else L&&N(u,Z.code)}catch(E){console.error(E),N(u,Ge())}finally{T.value=!1}},D=async I=>{await n.push({query:{...l.query,page:I.current,page_size:I.pageSize}})};return fe(async()=>{T.value=!0,_.value=[],Ua(-1).then(I=>{if(I.code===0){_.value=I.data.list,f.value=I.data.total_count>I.data.list.length;for(let L=0;L<I.data.list.length;L++){const E=I.data.list[L];C[E.id]=E}y=$e(()=>l.query,L=>{d.value.oj=L.oj||"",d.value.title=L.title||"",d.value.tag=L.tag||"",d.value.private=L.private==="1";const E=parseInt(L.page)||S.value.defaultCurrent,H=parseInt(L.page_size)||S.value.defaultPageSize;w=E,b=H,S.value={...S.value,current:w,pageSize:b},A({current:w,pageSize:b},!0)},{immediate:!0})}else f.value=!0}).catch(I=>{console.error(I),f.value=!0})}),De(()=>{y&&y()}),(I,L)=>{const E=Ee,H=he,Z=Te,Q=O,ee=we,te=ft,F=ze,me=Ae,ue=vt,W=Ue,J=Ie;return V(),M(J,null,{default:a(()=>[t(Z,{span:9},{default:a(()=>[t(H,{style:{margin:"10px"}},{default:a(()=>[t(E,{data:i.value,columns:p.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:S.value,"table-layout":"auto",loading:T.value,onPageChange:D},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(Z,{span:3},{default:a(()=>[R("div",io,[$.value?(V(),ae("div",co,[t(ee,null,{default:a(()=>[t(Q,{onClick:j},{default:a(()=>L[7]||(L[7]=[x("新建")])),_:1})]),_:1})])):le("",!0),t(H,{class:"sh-card"},{default:a(()=>[t(W,{model:d.value,onSubmit:h,onReset:U},{default:a(()=>[t(F,{label:"OJ"},{default:a(()=>[t(te,{modelValue:d.value.oj,"onUpdate:modelValue":L[0]||(L[0]=ne=>d.value.oj=ne),options:g,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(F,{label:"标题"},{default:a(()=>[t(me,{modelValue:d.value.title,"onUpdate:modelValue":L[1]||(L[1]=ne=>d.value.title=ne),placeholder:"请输入关键词"},null,8,["modelValue"])]),_:1}),t(F,{label:"标签"},{default:a(()=>[t(me,{modelValue:d.value.tag,"onUpdate:modelValue":L[2]||(L[2]=ne=>d.value.tag=ne),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),$.value?(V(),M(F,{key:0,label:"私有"},{default:a(()=>[t(ue,{modelValue:d.value.private,"onUpdate:modelValue":L[3]||(L[3]=ne=>d.value.private=ne)},null,8,["modelValue"])]),_:1})):le("",!0),t(F,null,{default:a(()=>[t(ee,null,{default:a(()=>[t(Q,{theme:"primary",type:"submit"},{default:a(()=>L[8]||(L[8]=[x("搜索")])),_:1}),t(Q,{theme:"danger",type:"reset"},{default:a(()=>L[9]||(L[9]=[x("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(H,{class:"sh-card"},{default:a(()=>[t(W,{model:r.value,onSubmit:k},{default:a(()=>[t(F,{label:"OJ"},{default:a(()=>[t(te,{modelValue:r.value.oj,"onUpdate:modelValue":L[4]||(L[4]=ne=>r.value.oj=ne),options:g,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(F,{label:"题目"},{default:a(()=>[t(me,{modelValue:r.value.problem,"onUpdate:modelValue":L[5]||(L[5]=ne=>r.value.problem=ne),placeholder:"请输入原始题号"},null,8,["modelValue"])]),_:1}),t(F,null,{default:a(()=>[t(Q,{theme:"primary",type:"submit",loading:s.value},{default:a(()=>L[10]||(L[10]=[x("前往")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),t(H,{class:"sh-card sh-background-black"},{default:a(()=>[(V(!0),ae(pe,null,Pe(_.value,ne=>(V(),M(Q,{class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:()=>P(ne)},{default:a(()=>[x(q(ne.name),1)]),_:2},1032,["onClick"]))),256)),f.value?(V(),M(Q,{key:0,class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:L[6]||(L[6]=()=>I.$router.push("/problem/tags"))},{default:a(()=>L[11]||(L[11]=[x(" ... ")])),_:1})):le("",!0)]),_:1})])]),_:1})]),_:1})}}}),fo=ce(po,[["__scopeId","data-v-dbe06f89"]]);function at(e){let l="";for(;e>0;)e--,l=String.fromCharCode(65+e%26)+l,e=Math.floor(e/26);return l}function Ht(e){const l={};if(l.id=e.id,l.ownerId=e.owner_id,l.ownerUsername=e.owner_username,l.ownerNickname=e.owner_nickname,l.title=e.title,l.startTime=new Date(e.start_time).toLocaleString(),l.endTime=new Date(e.end_time).toLocaleString(),l.createTime=new Date(e.create_time).toLocaleString(),l.updateTime=new Date(e.update_time).toLocaleString(),l.private=e.private,l.description=e.description,l.notification=e.notification,e.problems){l.problems=[],e.problems.sort((n,u)=>n.index-u.index);for(let n=0;n<e.problems.length;n++){const u=e.problems[n];let o={accept:0,attempt:0,author:"",id:"",private:!1,tags:[],title:""};o.index=u.index,o.id=at(u.index),o.title=u.title,u.accept?o.accept=u.accept:o.accept=0,u.attempt?o.attempt=u.attempt:o.attempt=0,l.problems.push(o)}}return l}function vo(e){return G({url:"/contest?id="+e,method:"get"})}function _o(e){return G({url:"/contest/edit?id="+e,method:"get"})}function go(e){return G({url:"/contest/problem/list?id="+e,method:"get"})}function bo(e){return e||(e=0),G({url:"/contest/image/token?id="+e,method:"get"})}function ho(e,l){return G({url:"/contest/problem?id="+e+"&problem_index="+l,method:"get"})}function yo(e,l,n,u){const o={};return e&&(o.title=e),l&&(o.username=l),n&&(o.page=String(n)),u&&(o.page_size=String(u)),G({url:`/contest/list?${new URLSearchParams(o).toString()}`,method:"get"})}function wo(e){return G({url:"/contest/rank?id="+e,method:"get"})}function ko(e){return G({url:"/contest/create",method:"post",data:e})}function So(e){return G({url:"/contest/edit",method:"post",data:e})}function Co(e,l){return G({url:"/contest/password",method:"post",data:{id:e,password:l}})}function Io(e){return G({url:"/contest/dolos",method:"post",data:{id:e}})}const Bt=async(e,l)=>{l&&await e.push({name:"user",params:{username:l}})},ta=e=>{const l=X.resolve({name:"problem-detail",params:{problemId:e}});window.open(l.href,"_blank")},Mt=async(e,l)=>{await X.push({name:"contest-problem-detail",params:{contestId:e,problemIndex:l}})},Po={class:"sh-button"},xo={style:{"margin-top":"16px"}},To={__name:"SecretPanel",setup(e){const l=c(!1);return(n,u)=>{const o=O;return V(),ae("div",el(tl(n.$attrs)),[R("div",Po,[t(o,{onClick:u[0]||(u[0]=y=>l.value=!l.value)},{default:a(()=>[x(q(l.value?"收起":"展开"),1)]),_:1})]),Xa(R("div",xo,[Qa(n.$slots,"default",{},void 0)],512),[[Za,l.value]])],16)}}},aa=ce(To,[["__scopeId","data-v-23f11aab"]]),Vo={key:1,style:{"text-align":"center"}},Do={key:1,style:{"text-align":"center"}},jo={key:0,class:"dida-problems-container"},Lo={style:{margin:"12px"}},$o={key:1},Uo={class:"dida-operation-container"},zo={key:0,class:"dida-operation-container"},Ao={class:"dida-code-submit-div"},Ro={class:"dida-code-editor-div"},Eo=de({__name:"ProblemDetail",setup(e){let l=Se();const{globalProperties:n}=_e();let u=null;const o=Ze(),y=Fe();let f=c(""),C="",v="",s=0,$=c(0);const p=c(!1),T=c(!1),w=c(!1),b=c(null);let S=null;const i=c(null),_=c(!1),g=c(!1),d={},r=c(""),z=c([]);z.value=Nt();const m=c([]),h=c(null),U=c(-1),k=c(-1),P=c(""),j=c("");let A=0;const D=Be(()=>y.hasAuth(Le.ManageProblem)),I=Be(()=>y.hasAuth(Le.ManageProblemDaily)),L=()=>{h.value&&clearInterval(h.value),h.value=setInterval(()=>{const K=U.value<=0,B=new Date(new Date().getTime()+A),ie=B.getHours()*60*60+B.getMinutes()*60+B.getSeconds(),oe=18*60*60;ie<oe?U.value=oe-ie:U.value=-1,k.value=24*60*60-ie,(!K&&U.value<=0||k.value<=0)&&ne()},1e3)},E=()=>{h.value&&(clearInterval(h.value),h.value=null)},H=K=>{K&&X.push({name:"problem-list",query:{...l.query,title:"",tag:K.name}})},Z=async()=>{if(!v){ge(n,"每日问题ID无效");return}await X.push({name:"manage-problem-daily",params:{dailyId:v}})},Q=async()=>{let K=C;if(!K)try{const B=await ho(s,$.value);B.code===0?K=B.data:N(n,B.code)}catch{ge(n,"获取题目ID失败，请稍后再试");return}await X.push({name:"manage-problem",params:{problemId:K}})},ee=()=>{C?X.push({name:"judge-list",query:{problem_id:C}}):X.push({name:"contest-judge",params:{contestId:s},query:{problem_id:at($.value)}})},te=()=>{C?X.push({name:"discuss-list-problem",query:{problem_id:C}}):X.push({name:"contest-discuss",params:{contestId:s},query:{problem_id:at($.value)}})},F=()=>{X.push({name:"problem-recommend",params:{problemId:C}})},me=async()=>{var ie,oe;const K=(ie=b.value)==null?void 0:ie.originOj,B=(oe=b.value)==null?void 0:oe.originId;if(!(!K||!B))try{_.value=!0;const Ce=await za(K,B);Ce.code===0?(await J(),ke(n,"更新成功")):N(n,Ce.code)}catch{ge(n,"更新失败，请稍后再试")}finally{_.value=!1}},ue=async()=>{const K=parseInt(r.value);if(!yt(K)){ge(n,"请选择所编写的语言");return}const B=S==null?void 0:S.getValue();if(!B){ge(n,"请输入所需提交的代码");return}if(!C&&(!s||!$.value)){ge(n,"问题ID无效");return}g.value=!0;try{const ie=await nn(C,s,$.value,K,B);if(ie.code!==0){N(n,ie.code);return}ke(n,"提交成功，正在跳转到详情页面");const oe=ie.data.id;s?await X.push({name:"contest-judge-detail",params:{contestId:s,judgeId:oe}}):await X.push({name:"judge-detail",params:{judgeId:oe}})}finally{g.value=!1}},W=K=>{if(!S)return;const B=S.getModel();B&&Qt.setModelLanguage(B,Ot(K))},J=async()=>{m.value=[];let K=await $a(C,s,$.value);if(K.code!==0){w.value=!1,N(n,K.code),await X.push({name:"problem"});return}K.data.tags&&K.data.tags.forEach(B=>{d[B.id]=B}),b.value=_t(K.data.problem,d),o.setTitle(b.value.title+" - "+o.getTitle),s&&(K=await go(s),K.code===0?(K.data.problems.sort((B,ie)=>B-ie),m.value=K.data.problems):N(n,K.code)),f.value=b.value.description,await mt(()=>{!S&&i.value&&(S=Qt.create(i.value,{value:"",language:"cpp",minimap:{enabled:!0},colorDecorators:!0,readOnly:!1,theme:"vs-dark"})),w.value=!1})},ne=async()=>{E(),T.value=!1;const K=await gn(v);if(K.code!==0)return;T.value=!0;const B=K.data.problem_daily;C=B.problem_id,P.value=B.solution,j.value=B.code;const ie=new Date(K.data.time);A=ie.getTime()-new Date().getTime();const oe=new Date(ie.getTime()),Ce=oe.getFullYear(),Y=String(oe.getMonth()+1).padStart(2,"0"),se=String(oe.getDate()).padStart(2,"0"),ye=`${Ce}-${Y}-${se}`;if(v===ye){const be=ie.getHours()*60*60+ie.getMinutes()*60+ie.getSeconds(),xe=18*60*60;be<xe?U.value=xe-be:U.value=-1,k.value=24*60*60-be}(U.value>=0||k.value>=0)&&L()};return fe(async()=>{u=$e(()=>l.params,async()=>{if(T.value=!1,Array.isArray(l.params.problemId)?C=l.params.problemId[0]:C=l.params.problemId,C||(Array.isArray(l.params.dailyId)?v=l.params.dailyId[0]:v=l.params.dailyId,w.value=!0,await ne(),w.value=!1),!C){if(Array.isArray(l.params.contestId)?s=Number(l.params.contestId[0]):s=Number(l.params.contestId),!s){ge(n,"题目不存在"),v?await X.push({name:"problem-daily-list"}):await X.push({name:"problem"});return}if(Array.isArray(l.params.problemIndex)?$.value=parseInt(l.params.problemIndex[0]):$.value=parseInt(l.params.problemIndex),!$.value){ge(n,"题目不存在"),await X.push({name:"problem"});return}}p.value=!!s,w.value=!0,await J()},{immediate:!0}),i.value&&new ResizeObserver(()=>{S&&S.layout()}).observe(i.value)}),De(()=>{u&&(u(),u=null),E()}),(K,B)=>{const ie=Re("md-preview"),oe=he,Ce=qt,Y=we,se=Te,ye=O,be=Je,xe=lt,Oe=We,je=Kt,Ye=ft,ot=Ie,Vt=Ve;return V(),M(Vt,{loading:w.value},{default:a(()=>[t(ot,{class:"dida-main-content"},{default:a(()=>[t(se,{span:8},{default:a(()=>[t(oe,{style:{margin:"10px"}},{default:a(()=>[t(ie,{"model-value":ve(f),previewTheme:"cyanosis"},null,8,["model-value"])]),_:1}),T.value?(V(),M(oe,{key:0,style:{margin:"10px"},title:"题解"},{default:a(()=>[U.value<0?(V(),M(aa,{key:0},{default:a(()=>[t(ie,{"model-value":P.value,previewTheme:"cyanosis"},null,8,["model-value"])]),_:1})):(V(),ae("div",Vo,[R("div",null,[t(Y,null,{default:a(()=>[B[2]||(B[2]=R("p",null,"距离解锁百分比",-1)),t(Ce,{theme:"circle",color:{from:"#0052D9",to:"#00A870"},percentage:100-U.value/(18*60*60)*100,status:"active"},{label:a(()=>[x(q((100-U.value/(18*60*60)*100).toFixed(3))+"% ",1)]),default:a(()=>[B[1]||(B[1]=x(" > "))]),_:1},8,["percentage"])]),_:1})])]))]),_:1})):le("",!0),T.value?(V(),M(oe,{key:1,style:{margin:"10px"},title:"示例代码"},{default:a(()=>[k.value<0?(V(),M(aa,{key:0},{default:a(()=>[t(ie,{"model-value":j.value,previewTheme:"cyanosis"},null,8,["model-value"])]),_:1})):(V(),ae("div",Do,[R("div",null,[t(Y,{style:{margin:"0 auto"}},{default:a(()=>[B[4]||(B[4]=R("p",null,"距离解锁百分比",-1)),t(Ce,{theme:"circle",color:{from:"#0052D9",to:"#00A870"},percentage:100-k.value/(24*60*60)*100,status:"active"},{label:a(()=>[x(q((100-k.value/(24*60*60)*100).toFixed(3))+"% ",1)]),default:a(()=>[B[3]||(B[3]=x(" > "))]),_:1},8,["percentage"])]),_:1})])]))]),_:1})):le("",!0)]),_:1}),t(se,{span:4},{default:a(()=>{var Yt;return[ve(s)?(V(),ae("div",jo,[t(Y,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(V(!0),ae(pe,null,Pe(m.value,(Me,re)=>(V(),M(ye,{key:re,theme:Me==ve($)?"primary":"default",onClick:async()=>await ve(Mt)(ve(s),Me)},{default:a(()=>[x(q(ve(at)(Me)),1)]),_:2},1032,["theme","onClick"]))),128))]),_:1})])):le("",!0),R("div",Lo,[t(Oe,{layout:"vertical",bordered:!0},{default:a(()=>{var Me;return[t(be,{label:"ID"},{default:a(()=>{var re;return[x(q((re=b.value)==null?void 0:re.id),1)]}),_:1}),t(be,{label:"标题"},{default:a(()=>{var re;return[x(q((re=b.value)==null?void 0:re.title),1)]}),_:1}),t(be,{label:"时间限制"},{default:a(()=>{var re;return[x(q((re=b.value)==null?void 0:re.timeLimit),1)]}),_:1}),t(be,{label:"内存限制"},{default:a(()=>{var re;return[x(q((re=b.value)==null?void 0:re.memoryLimit),1)]}),_:1}),t(be,{label:"判题方式"},{default:a(()=>{var re;return[x(q((re=b.value)==null?void 0:re.judgeType),1)]}),_:1}),p.value?le("",!0):(V(),M(be,{key:0,label:"正确提交"},{default:a(()=>{var re;return[x(q((re=b.value)==null?void 0:re.accept),1)]}),_:1})),p.value?le("",!0):(V(),M(be,{key:1,label:"提交总数"},{default:a(()=>{var re;return[x(q((re=b.value)==null?void 0:re.attempt),1)]}),_:1})),t(be,{label:"创建时间"},{default:a(()=>{var re;return[x(q((re=b.value)==null?void 0:re.insertTime),1)]}),_:1}),t(be,{label:"更新时间"},{default:a(()=>{var re;return[x(q((re=b.value)==null?void 0:re.updateTime),1)]}),_:1}),t(be,{label:"上传用户"},{default:a(()=>{var re;return[x(q((re=b.value)==null?void 0:re.creatorNickname),1)]}),_:1}),p.value?le("",!0):(V(),M(be,{key:2,label:"题目来源"},{default:a(()=>{var re,Qe,ct;return[(re=b.value)!=null&&re.sourceUrl?(V(),M(xe,{key:0,href:(Qe=b.value)==null?void 0:Qe.sourceUrl,target:"_blank"},{default:a(()=>{var Xt;return[x(q((Xt=b.value)==null?void 0:Xt.source),1)]}),_:1},8,["href"])):(V(),ae("span",$o,q((ct=b.value)==null?void 0:ct.source),1))]}),_:1})),D.value?(V(),M(be,{key:3,label:"是否私有"},{default:a(()=>{var re;return[x(q((re=b.value)!=null&&re.private?"私有":"公开"),1)]}),_:1})):le("",!0),(Me=b.value)!=null&&Me.originUrl?(V(),M(be,{key:4,label:"原题链接"},{default:a(()=>{var re;return[t(xe,{href:(re=b.value)==null?void 0:re.originUrl,target:"_blank"},{default:a(()=>{var Qe,ct;return[x(q((Qe=b.value)==null?void 0:Qe.originOj)+" - "+q((ct=b.value)==null?void 0:ct.originId),1)]}),_:1},8,["href"])]}),_:1})):le("",!0),ve(C)?(V(),M(be,{key:5,label:"标签"},{default:a(()=>[t(Y,null,{default:a(()=>{var re;return[(V(!0),ae(pe,null,Pe((re=b.value)==null?void 0:re.tags,Qe=>(V(),M(ye,{key:Qe.id,variant:"dashed",onClick:()=>H(Qe)},{default:a(()=>[x(q(Qe.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})):le("",!0)]}),_:1}),R("div",Uo,[t(Y,null,{default:a(()=>[t(ye,{onClick:ee},{default:a(()=>B[5]||(B[5]=[x("提交记录")])),_:1}),t(ye,{onClick:te},{default:a(()=>B[6]||(B[6]=[x("题目讨论")])),_:1}),ve(C)?(V(),M(ye,{key:0,onClick:F},{default:a(()=>B[7]||(B[7]=[x("题目推荐")])),_:1})):le("",!0)]),_:1})]),T.value&&I.value||D.value||(Yt=b.value)!=null&&Yt.originId?(V(),ae("div",zo,[t(Y,null,{default:a(()=>{var Me;return[T.value&&I.value?(V(),M(ye,{key:0,onClick:Z},{default:a(()=>B[8]||(B[8]=[x("每日一题")])),_:1})):le("",!0),D.value?(V(),M(ye,{key:1,onClick:Q},{default:a(()=>B[9]||(B[9]=[x("编辑")])),_:1})):le("",!0),(Me=b.value)!=null&&Me.originId?(V(),M(ye,{key:2,onClick:me,loading:_.value},{default:a(()=>B[10]||(B[10]=[x("更新描述 ")])),_:1},8,["loading"])):le("",!0)]}),_:1})])):le("",!0),R("div",Ao,[t(Y,null,{default:a(()=>[t(Ye,{modelValue:r.value,"onUpdate:modelValue":B[0]||(B[0]=Me=>r.value=Me),label:"语言：",placeholder:"请选择提交语言","auto-width":"",clearable:"",onChange:W},{default:a(()=>[(V(!0),ae(pe,null,Pe(z.value,Me=>(V(),M(je,{key:Me.value,value:Me.value,label:Me.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),t(ye,{onClick:ue,loading:g.value},{default:a(()=>B[11]||(B[11]=[x("提交")])),_:1},8,["loading"])]),_:1}),R("div",Ro,[R("div",{ref_key:"codeEditRef",ref:i,class:"dida-code-editor"},null,512)])])])]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),Lt=ce(Eo,[["__scopeId","data-v-bf97b778"]]),Mo={style:{margin:"10px"}},qo={key:0,class:"dida-operation-container"};function Ko(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const Fo=de({__name:"ProblemDailyList",setup(e){const l=Se(),n=Xe(),{globalProperties:u}=_e(),o=Fe();let y=!1,f=null,C={},v={};const s=Be(()=>o.hasAuth(Le.ManageProblem)),$=c([{title:"日期",colKey:"id",cell:(k,P)=>t(O,{variant:"dashed",onClick:()=>_(P.row.id)},{default:()=>[P.row.id]})},{title:"ID",colKey:"problemId",cell:(k,P)=>{let j=g(P.row.problemId);return t(O,{variant:"dashed",theme:j,onClick:()=>_(P.row.id)},{default:()=>[P.row.problemId]})}},{title:"标题",colKey:"title",cell:(k,P)=>t(O,{variant:"text",onClick:()=>_(P.row.id)},{default:()=>[P.row.title]})},{title:"标签",colKey:"tags",cell:(k,P)=>{const j=P.row.tags;if(!j||j.length===0)return"";let A=[];for(let D=0;D<j.length;D++){const I=j[D];A.push(t(O,{key:D,theme:"default",variant:"outline",size:"small",onClick:()=>z(I)},{default:()=>[I.name]}))}return t(we,null,Ko(A)?A:{default:()=>[A]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),p=c(!1);let T=1,w=50;const b=c({current:T,pageSize:w,defaultCurrent:T,defaultPageSize:w,total:0,pageSizeOptions:[50,100]}),S=c([]),i=c({date:[],problemId:""}),_=k=>{k&&n.push({name:"problem-daily-detail",params:{dailyId:k}})},g=k=>{if(!k||!v)return"default";const P=v[k];if(!P)return"default";switch(P){case Ne.Accept:return"success";case Ne.Attempt:return"warning";default:return"default"}},d=async()=>{let k="";i.value.date&&i.value.date.length>1&&(k=i.value.date[0]+"~"+i.value.date[1]),await n.push({query:{...l.query,date:k,problem_id:i.value.problemId,page:1,page_size:b.value.defaultPageSize}})},r=async()=>{i.value.date=[],i.value.problemId="",await n.push({query:{...l.query,date:"",problem_id:"",page:1,page_size:b.value.defaultPageSize}})},z=k=>{k&&n.push({name:"problem-list",query:{...l.query,title:"",tag:k.name,page:1,page_size:b.value.defaultPageSize}})},m=()=>{n.push({name:"manage-problem-daily-create"})},h=async(k,P)=>{p.value=!0;try{const{current:j,pageSize:A}=k;let D="";i.value.date[0]&&(D=i.value.date[0]);let I="";i.value.date[1]&&(I=i.value.date[1]);const L=await yn(D,I,i.value.problemId,j,A);if(S.value=[],L.code===0){const E=L.data.list;if(!E||E.length<=0){b.value={...b.value,total:0},v={},ke(u,"未找到记录");return}C={},L.data.tags&&L.data.tags.forEach(H=>{C[H.id]=H}),E.forEach(H=>{var Q;const Z=La(H,C);(Q=S.value)==null||Q.push(Z)}),b.value={...b.value,total:L.data.total_count},v=L.data.attempt_status}else P&&N(u,L.code)}catch(j){console.error(j),N(u,Ge())}finally{p.value=!1}},U=async k=>{await n.push({query:{...l.query,page:k.current,page_size:k.pageSize}})};return fe(async()=>{y=!0,p.value=!0,f=$e(()=>l.query,k=>{if(!y)return;if(i.value.date=[],k.date){const A=k.date.split("~");A.length===2&&(i.value.date=[A[0],A[1]])}i.value.problemId=k.problem_id||"";const P=parseInt(k.page)||b.value.defaultCurrent,j=parseInt(k.page_size)||b.value.defaultPageSize;T=P,w=j,b.value={...b.value,current:T,pageSize:w},h({current:T,pageSize:w},!0)},{immediate:!0})}),De(()=>{y=!1,f&&f()}),(k,P)=>{const j=Ee,A=he,D=Te,I=O,L=we,E=Ft,H=ze,Z=Ae,Q=Ue,ee=Ie;return V(),M(ee,null,{default:a(()=>[t(D,{span:9},{default:a(()=>[t(A,{style:{margin:"10px"}},{default:a(()=>[t(j,{data:S.value,columns:$.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:b.value,"table-layout":"auto",loading:p.value,onPageChange:U},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(D,{span:3},{default:a(()=>[R("div",Mo,[s.value?(V(),ae("div",qo,[t(L,null,{default:a(()=>[t(I,{onClick:m},{default:a(()=>P[2]||(P[2]=[x("新建")])),_:1})]),_:1})])):le("",!0),t(A,{class:"sh-card"},{default:a(()=>[t(Q,{model:i.value,onSubmit:d,onReset:r},{default:a(()=>[t(H,{label:"日期","label-align":"top"},{default:a(()=>[t(E,{modelValue:i.value.date,"onUpdate:modelValue":P[0]||(P[0]=te=>i.value.date=te),"allow-input":"",clearable:"",format:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(H,{label:"问题","label-align":"top"},{default:a(()=>[t(Z,{modelValue:i.value.problemId,"onUpdate:modelValue":P[1]||(P[1]=te=>i.value.problemId=te),placeholder:"请输入问题ID",clearable:""},null,8,["modelValue"])]),_:1}),t(H,{"label-align":"top"},{default:a(()=>[t(L,null,{default:a(()=>[t(I,{theme:"primary",type:"submit"},{default:a(()=>P[3]||(P[3]=[x("搜索")])),_:1}),t(I,{theme:"danger",type:"reset"},{default:a(()=>P[4]||(P[4]=[x("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(A,{class:"sh-card",header:"每日一题","header-bordered":!0},{default:a(()=>P[5]||(P[5]=[R("p",null,"由管理员团队精选的题目，每日0点更新。",-1),R("p",null,"当日下午6点提供题解，次日提供AC代码。",-1)])),_:1})])]),_:1})]),_:1})}}}),No=ce(Fo,[["__scopeId","data-v-b97b04ec"]]),Oo={style:{margin:"10px"}},Go={style:{margin:"12px"}},Ho={class:"dida-edit-container"},Bo=de({__name:"ProblemDailyEdit",setup(e){let l=Se();const{globalProperties:n}=_e();let u=null;const o=c(""),y=c(!1),f=c(!1),C=c(null),v=c({date:"",problemId:"",solution:"",code:""}),s=()=>{X.push({name:"problem-daily-detail",params:{dailyId:o.value}})};async function $(i,_){f.value=!0,await it(i,_,n,()=>Tn(o.value)),f.value=!1}const p=async()=>{f.value=!0;try{const i=v.value.date,_=await Cn(i,v.value.problemId,v.value.solution,v.value.code);if(f.value=!0,_.code!==0){N(n,_.code);return}await X.push({name:"manage-problem-daily",params:{dailyId:i}}),Ke(n,"创建成功")}finally{f.value=!1}},T=async()=>{f.value=!0;try{const i=await In(o.value,v.value.problemId,v.value.solution,v.value.code);if(f.value=!0,i.code!==0){N(n,i.code);return}C.value&&(i.data.update_time!=null&&(C.value.updateTime=new Date(i.data.update_time).toLocaleString()),i.data.updater_nickname!=null&&(C.value.updaterNickname=i.data.updater_nickname)),i.data.solution!=null&&(v.value.solution=i.data.solution),i.data.code!=null&&(v.value.code=i.data.code),Ke(n,"保存成功")}finally{f.value=!1}},w=i=>{v.value.solution=i,y.value=!1},b=i=>{v.value.code=i,y.value=!1},S=async()=>{const i=await bn(o.value);if(i.code!==0){N(n,i.code),console.error("problem get failed",i.code),await X.push({name:"problem"});return}const _=i.data;C.value=La(_,{}),v.value.problemId=_.problem_id,w(_.solution),b(_.code)};return fe(async()=>{u=$e(()=>l.params,async()=>{Array.isArray(l.params.dailyId)?o.value=l.params.dailyId[0]:o.value=l.params.dailyId,o.value?(y.value=!0,v.value.date=o.value,await S()):(w("暂无题解"),b("暂无标程"))},{immediate:!0})}),De(()=>{u&&(u(),u=null)}),(i,_)=>{const g=Ct,d=yl,r=ze,z=Ae,m=Ue,h=he,U=Te,k=O,P=we,j=Je,A=We,D=Ie,I=Re("md-editor-v3"),L=Ve;return V(),M(L,{loading:y.value},{default:a(()=>[t(D,null,{default:a(()=>[t(U,{span:8},{default:a(()=>[R("div",Oo,[t(g,{theme:"info"},{default:a(()=>_[4]||(_[4]=[x("可以提前配置将来日期的题目，对外仅展示到截止到当天的题目")])),_:1}),t(h,{class:"sh-form-card"},{default:a(()=>[t(m,{model:v.value},{default:a(()=>[t(r,{label:"日期"},{default:a(()=>[t(d,{modelValue:v.value.date,"onUpdate:modelValue":_[0]||(_[0]=E=>v.value.date=E),disabled:o.value&&!0},null,8,["modelValue","disabled"])]),_:1}),t(r,{label:"问题ID"},{default:a(()=>[t(z,{modelValue:v.value.problemId,"onUpdate:modelValue":_[1]||(_[1]=E=>v.value.problemId=E),placeholder:"问题标题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(U,{span:4},{default:a(()=>[R("div",Go,[R("div",Ho,[o.value?(V(),M(P,{key:0},{default:a(()=>[t(k,{onClick:T,theme:"danger",loading:f.value},{default:a(()=>_[5]||(_[5]=[x("保存")])),_:1},8,["loading"]),t(k,{onClick:s},{default:a(()=>_[6]||(_[6]=[x("查看")])),_:1})]),_:1})):(V(),M(P,{key:1},{default:a(()=>[t(k,{onClick:p,theme:"danger",loading:f.value},{default:a(()=>_[7]||(_[7]=[x("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(V(),M(A,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(j,{label:"创建时间"},{default:a(()=>{var E;return[x(q((E=C.value)==null?void 0:E.createTime),1)]}),_:1}),t(j,{label:"更新时间"},{default:a(()=>{var E;return[x(q((E=C.value)==null?void 0:E.updateTime),1)]}),_:1}),t(j,{label:"创建用户"},{default:a(()=>{var E;return[x(q((E=C.value)==null?void 0:E.creatorNickname),1)]}),_:1}),t(j,{label:"更新用户"},{default:a(()=>{var E;return[x(q((E=C.value)==null?void 0:E.updaterNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),R("div",null,[_[8]||(_[8]=R("p",{style:{"margin-left":"20px"}},"题解：",-1)),t(I,{id:"daily-solution-editor",modelValue:v.value.solution,"onUpdate:modelValue":_[2]||(_[2]=E=>v.value.solution=E),onSave:T,onOnUploadImg:$,previewTheme:"cyanosis"},null,8,["modelValue"]),t(L,{loading:f.value,attach:"#daily-solution-editor","z-index":1e5},null,8,["loading"])]),R("div",null,[_[9]||(_[9]=R("p",{style:{"margin-left":"20px"}},"标程：",-1)),t(I,{id:"daily-code-editor",modelValue:v.value.code,"onUpdate:modelValue":_[3]||(_[3]=E=>v.value.code=E),onSave:T,onOnUploadImg:$,previewTheme:"cyanosis"},null,8,["modelValue"]),t(L,{loading:f.value,attach:"#daily-code-editor","z-index":1e5},null,8,["loading"])])]),_:1},8,["loading"])}}}),la=ce(Bo,[["__scopeId","data-v-fe63fd0d"]]),Wo={style:{margin:"10px"}};function Jo(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const Yo=de({__name:"ProblemRecommend",setup(e){const l=Se(),n=Xe(),{globalProperties:u}=_e();let o=null,y="",f={},C={};const v=c([{title:"ID",colKey:"id",cell:(S,i)=>{let _=T(i.row.id);return t(O,{variant:"dashed",theme:_,onClick:()=>p(i.row.id)},{default:()=>[i.row.id]})}},{title:"标题",colKey:"title",cell:(S,i)=>t(O,{variant:"text",onClick:()=>p(i.row.id)},{default:()=>[i.row.title]})},{title:"标签",colKey:"tags",cell:(S,i)=>{const _=i.row.tags;if(!_||_.length===0)return"";let g=[];for(let d=0;d<_.length;d++){const r=_[d];g.push(t(O,{key:d,theme:"default",variant:"outline",size:"small",onClick:()=>w(r)},{default:()=>[r.name]}))}return t(we,null,Jo(g)?g:{default:()=>[g]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),s=c(!1),$=c(),p=S=>{S&&n.push({path:"/problem/"+S})},T=S=>{if(!S||!C)return"default";const i=C[S];if(!i)return"default";switch(i){case Ne.Accept:return"success";case Ne.Attempt:return"warning";default:return"default"}},w=S=>{S&&n.push({name:"problem-list",query:{tag:S.name}})},b=async S=>{s.value=!0;try{const i=await _n(y);if($.value=[],i.code===0){const _=i.data.list;if(!_||_.length<=0){ke(u,"暂无推荐题目");return}f={},i.data.tags&&i.data.tags.forEach(g=>{f[g.id]=g}),_.forEach(g=>{var r;const d=_t(g,f);(r=$.value)==null||r.push(d)})}else S&&N(u,i.code)}catch(i){console.error(i),N(u,Ge())}finally{s.value=!1}};return fe(async()=>{s.value=!0,o=$e(()=>l.query,S=>{Array.isArray(l.params.problemId)?y=l.params.problemId[0]:y=l.params.problemId,b(!0)},{immediate:!0})}),De(()=>{o&&o()}),(S,i)=>{const _=Ee,g=he,d=Te,r=Ie;return V(),M(r,null,{default:a(()=>[t(d,{span:9},{default:a(()=>[t(g,{style:{margin:"10px"}},{default:a(()=>[t(_,{data:$.value,columns:v.value,"row-key":"id","vertical-align":"top",hover:!0,"table-layout":"auto",loading:s.value},null,8,["data","columns","loading"])]),_:1})]),_:1}),t(d,{span:3},{default:a(()=>[R("div",Wo,[t(g,{class:"sh-card",header:"题目推荐","header-bordered":!0},{default:a(()=>i[0]||(i[0]=[x(" 根据本站其他用户的提交记录推荐类似题目"),R("br",null,null,-1),x("依据推荐算法来计算，与本用户相似度最高的用户做的题，大概率被自己感兴趣。 ")])),_:1})])]),_:1})]),_:1})}}}),Xo=ce(Yo,[["__scopeId","data-v-77972e8b"]]),Zo={style:{margin:"10px"}},Qo={key:1},es={style:{margin:"12px"}},ts={class:"dida-edit-container"},as={class:"dida-description-editor"},ls=de({__name:"ProblemEdit",setup(e){let l=Se();const{globalProperties:n}=_e(),u=Ze(),o=c(""),y=c(!1),f=c(!1),C=c(!1),v=c(null),s=c({title:"",timeLimit:0,memoryLimit:0,source:"",private:!0,tags:[],description:""}),$=c([]),p=c([]),T=Be(()=>{const m=[],h=$.value;for(let U=0,k=h.length;U<k;U++)h[U].value&&m.push(h[U].value);return m}),w=(m,h)=>{const{trigger:U,index:k,item:P}=h;if(U==="clear"&&($.value=[]),["tag-remove","backspace"].includes(U)&&$.value.splice(k,1),U==="enter"){for(let A=0;A<p.value.length;A++){const D=p.value[A];if(D.label===P){for(let I=0;I<$.value.length;I++)if($.value[I].label===D.label)return;$.value.push(D);return}}const j={label:P,value:P};$.value.push(j),p.value=p.value.concat(j)}},b=(m,{current:h,type:U})=>{if(!h){$.value=U==="check"?p.value.slice(1):[];return}if(U==="check"){const k=p.value.find(P=>P.value===h);if(!k)return;$.value.push(k)}else $.value=$.value.filter(k=>k.value!==h)},S=()=>{X.push({name:"problem-detail",params:{problemId:o.value}})},i=()=>{X.push({name:"manage-problem-judge",params:{problemId:o.value}})},_=async(m,h)=>{C.value=!0,await it(m,h,n,()=>xn(o.value)),C.value=!1},g=async()=>{f.value=!0,s.value.tags=[];for(let m=0;m<$.value.length;m++){const h=$.value[m];h&&h.label&&s.value.tags.push(h.label)}try{const m=await kn(s.value.title,s.value.timeLimit,s.value.memoryLimit,s.value.source,s.value.private,s.value.tags,s.value.description);if(f.value=!0,m.code!==0){N(n,m.code);return}m.data!=null&&await X.push({name:"problem-detail",params:{problemId:m.data}}),Ke(n,"创建成功")}finally{f.value=!1}},d=async()=>{f.value=!0,s.value.tags=[];for(let m=0;m<$.value.length;m++){const h=$.value[m];h&&h.label&&s.value.tags.push(h.label)}try{const m=await Sn(o.value,s.value.title,s.value.timeLimit,s.value.memoryLimit,s.value.source,s.value.private,s.value.tags,s.value.description);if(f.value=!0,m.code!==0){N(n,m.code);return}v.value&&m.data.update_time!=null&&(v.value.updateTime=new Date(m.data.update_time).toLocaleString()),m.data.description!=null&&(s.value.description=m.data.description),Ke(n,"保存成功")}finally{f.value=!1}},r=m=>{s.value.description=m,y.value=!1},z=async()=>{const m=await $a(o.value,void 0,void 0);if(m.code!==0){N(n,m.code),console.error("problem get failed",m.code),await X.push({name:"problem"});return}const h=m.data.problem;if(v.value=_t(h,{}),s.value.title=h.title,s.value.timeLimit=h.time_limit,s.value.memoryLimit=h.memory_limit,s.value.source=h.source,s.value.private=h.private,s.value.tags=[],$.value=[],m.data.tags)for(let k=0;k<m.data.tags.length;k++){const P=m.data.tags[k];P&&P.name&&(s.value.tags.push(P.name),$.value.push({label:P.name,value:P.id}))}u.setTitle(h.title+" - "+u.getTitle);let U=h.description;r(U)};return fe(async()=>{Array.isArray(l.params.problemId)?o.value=l.params.problemId[0]:o.value=l.params.problemId,o.value?(y.value=!0,Ua(-1).then(async m=>{m.code===0?(m.data.list&&m.data.list.forEach(h=>{p.value.push({label:h.name,value:h.id})}),await z()):(N(n,m.code),console.error("problem tag get failed",m.code),await X.push({name:"problem"}))}).catch(async m=>{console.error(m),N(n,"获取数据异常"),await X.push({name:"problem"})})):(s.value.timeLimit=1e3,s.value.memoryLimit=65536,r(""))}),(m,h)=>{const U=Ae,k=ze,P=wa,j=vt,A=kl,D=wl,I=Ue,L=he,E=Te,H=O,Z=we,Q=Je,ee=We,te=Ie,F=Re("md-editor-v3"),me=Ve;return V(),M(me,{loading:y.value},{default:a(()=>[t(te,null,{default:a(()=>[t(E,{span:8},{default:a(()=>[R("div",Zo,[t(L,{class:"sh-card"},{default:a(()=>[t(I,{model:s.value},{default:a(()=>[t(k,{label:"标题"},{default:a(()=>[t(U,{modelValue:s.value.title,"onUpdate:modelValue":h[0]||(h[0]=ue=>s.value.title=ue),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),t(k,{label:"时间限制"},{default:a(()=>[t(P,{modelValue:s.value.timeLimit,"onUpdate:modelValue":h[1]||(h[1]=ue=>s.value.timeLimit=ue),theme:"normal",min:0},{suffix:a(()=>h[6]||(h[6]=[R("span",null,"ms",-1)])),_:1},8,["modelValue"])]),_:1}),t(k,{label:"内存限制"},{default:a(()=>[t(P,{modelValue:s.value.memoryLimit,"onUpdate:modelValue":h[2]||(h[2]=ue=>s.value.memoryLimit=ue),theme:"normal",min:0},{suffix:a(()=>h[7]||(h[7]=[R("span",null,"KB",-1)])),_:1},8,["modelValue"])]),_:1}),t(k,{label:"来源"},{default:a(()=>[t(U,{modelValue:s.value.source,"onUpdate:modelValue":h[3]||(h[3]=ue=>s.value.source=ue),placeholder:"请输入题目来源"},null,8,["modelValue"])]),_:1}),t(k,{label:"私有"},{default:a(()=>[t(j,{modelValue:s.value.private,"onUpdate:modelValue":h[4]||(h[4]=ue=>s.value.private=ue)},null,8,["modelValue"])]),_:1}),t(k,{label:"标签"},{default:a(()=>[t(D,{value:$.value,"allow-input":!0,placeholder:"请选择或输入","tag-input-props":{excessTagsDisplayType:"break-line"},"popup-props":{overlayInnerClassName:["narrow-scrollbar"],overlayInnerStyle:{maxHeight:"280px",overflowY:"auto",overscrollBehavior:"contain",padding:"6px"}},clearable:"",multiple:"",onTagChange:w},{panel:a(()=>[p.value.length?(V(),M(A,{key:0,value:T.value,options:p.value,onChange:b},null,8,["value","options"])):(V(),ae("div",Qo,"暂无数据"))]),suffixIcon:a(()=>[t(ve(al))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(E,{span:4},{default:a(()=>[R("div",es,[R("div",ts,[o.value?(V(),M(Z,{key:0},{default:a(()=>[t(H,{onClick:d,theme:"danger",loading:f.value},{default:a(()=>h[8]||(h[8]=[x("保存")])),_:1},8,["loading"]),t(H,{onClick:i,theme:"warning"},{default:a(()=>h[9]||(h[9]=[x("判题数据")])),_:1}),t(H,{onClick:S},{default:a(()=>h[10]||(h[10]=[x("查看")])),_:1})]),_:1})):(V(),M(Z,{key:1},{default:a(()=>[t(H,{onClick:g,theme:"danger",loading:f.value},{default:a(()=>h[11]||(h[11]=[x("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(V(),M(ee,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(Q,{label:"创建时间"},{default:a(()=>{var ue;return[x(q((ue=v.value)==null?void 0:ue.insertTime),1)]}),_:1}),t(Q,{label:"更新时间"},{default:a(()=>{var ue;return[x(q((ue=v.value)==null?void 0:ue.updateTime),1)]}),_:1}),t(Q,{label:"判题方式"},{default:a(()=>{var ue;return[x(q((ue=v.value)==null?void 0:ue.judgeType),1)]}),_:1}),t(Q,{label:"上传用户"},{default:a(()=>{var ue;return[x(q((ue=v.value)==null?void 0:ue.creatorNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),R("div",as,[h[12]||(h[12]=R("p",null,"题目描述",-1)),t(me,{loading:C.value||f.value},{default:a(()=>[t(F,{modelValue:s.value.description,"onUpdate:modelValue":h[5]||(h[5]=ue=>s.value.description=ue),onSave:d,onOnUploadImg:_,previewTheme:"cyanosis"},null,8,["modelValue"])]),_:1},8,["loading"])])]),_:1},8,["loading"])}}}),na=ce(ls,[["__scopeId","data-v-e349d9e2"]]),ns={style:{margin:"10px"}},os={style:{margin:"12px"}},ss={class:"dida-edit-container"},rs=de({__name:"ProblemJudge",setup(e){let l=Se();const{globalProperties:n}=_e(),u=Ze(),o=c(""),y=c(!1),f=c(null);let C=null;const v=c(null),s=c(""),$=c(!1),p=c(!1),T=c([{title:"文件",colKey:"file"},{title:"大小",colKey:"size",width:150,cell:(P,j)=>{let A=j.row.size,D;return A>10*1024?A>1024*1024?D=(A/(1024*1024)).toFixed(3)+" MB":D=(A/1024).toFixed(3)+" KB":D=A+" B",D}},{title:"最后修改时间",colKey:"lastModified",width:180,cell:(P,j)=>new Date(j.row.lastModified).toLocaleString()},{title:"操作",colKey:"action",width:100,cell:(P,j)=>t(O,{onClick:()=>g(j.row.file)},{default:()=>[x("下载")]})}]),w=c([]),b=Be(()=>({border:"2px dashed #ccc",borderRadius:"6px",padding:"20px",textAlign:"center",cursor:"pointer",backgroundColor:$.value?"#f0f9ff":"#fff",transition:"background-color 0.2s ease"})),S=Be(()=>s.value?`已选择：${s.value}`:$.value?"松开文件以上传":"拖拽判题数据压缩包到这里，或点击选择文件"),i=()=>{X.push({name:"problem-detail",params:{problemId:o.value}})},_=()=>{X.push({name:"manage-problem",params:{problemId:o.value}})},g=async P=>{const j=await Pn(o.value,P);if(j.code!==0){N(n,j.code);return}const A=document.createElement("a");A.href=j.data,A.target="_blank",A.click(),URL.revokeObjectURL(A.href)},d=async()=>{if(!C){ge(n,"请选择压缩包");return}p.value=!0,Vn(o.value,C).then(async P=>{P.code==0?(v.value.value=null,C=null,s.value="",y.value=!0,Ke(n,"上传成功"),await k()):ql(n,P.code,P.data)}).catch(P=>{console.log(P),n.$message.error({duration:3e3,content:"上传失败"})}).finally(()=>{p.value=!1})},r=()=>{var P;(P=v.value)==null||P.click()},z=P=>{const j=P.target.files[0];j&&(s.value=j.name,C=j)},m=P=>{$.value=!0},h=()=>{$.value=!1},U=P=>{P.preventDefault(),P.stopPropagation(),$.value=!1;const j=P.dataTransfer.files[0];if(j){s.value=j.name;const A=new DataTransfer;A.items.add(j),v.value.files=A.files,C=j}},k=async()=>{const P=await fn(o.value);if(P.code!==0){N(n,P.code),await X.push({name:"problem"});return}const j=P.data.problem;f.value=_t(j,{}),u.setTitle(j.title+" - "+u.getTitle),w.value=[],P.data.judges?(P.data.judges.forEach(A=>{w.value.push({file:A.key,size:A.size,lastModified:A.last_modified})}),w.value.sort((A,D)=>A.file.endsWith(".zip")&&!D.file.endsWith(".zip")?-1:!A.file.endsWith(".zip")&&D.file.endsWith(".zip")?1:A.file.endsWith(".yaml")&&!D.file.endsWith(".yaml")?-1:!A.file.endsWith(".yaml")&&D.file.endsWith(".yaml")?1:0)):ge(n,"评测数据不存在"),y.value=!1};return fe(async()=>{if(Array.isArray(l.params.problemId)?o.value=l.params.problemId[0]:o.value=l.params.problemId,!o.value){ge(n,"题目不存在"),await X.push({name:"problem"});return}y.value=!0,await k()}),(P,j)=>{const A=Ee,D=Te,I=O,L=we,E=Je,H=We,Z=Ie,Q=Ve;return V(),M(Q,{loading:y.value},{default:a(()=>[t(Z,null,{default:a(()=>[t(D,{span:7},{default:a(()=>[R("div",ns,[R("div",{id:"drop-zone",style:ga(b.value),onClick:r,onDragenter:Dt(m,["prevent"]),onDragover:j[0]||(j[0]=Dt(()=>{},["prevent"])),onDragleave:Dt(h,["prevent"]),onDrop:U},[R("input",{ref_key:"fileInput",ref:v,type:"file",style:{display:"none"},onChange:z},null,544),x(" "+q(S.value),1)],36)]),t(A,{data:w.value,columns:T.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1}),t(D,{span:5},{default:a(()=>[R("div",os,[R("div",ss,[t(L,null,{default:a(()=>[t(I,{onClick:d,theme:"danger",loading:p.value},{default:a(()=>j[1]||(j[1]=[x("上传")])),_:1},8,["loading"]),t(I,{onClick:_,theme:"warning"},{default:a(()=>j[2]||(j[2]=[x("编辑")])),_:1}),t(I,{onClick:i},{default:a(()=>j[3]||(j[3]=[x("查看")])),_:1})]),_:1})]),t(H,{layout:"vertical",bordered:!0},{default:a(()=>[t(E,{label:"标题"},{default:a(()=>{var ee;return[x(q((ee=f.value)==null?void 0:ee.title),1)]}),_:1}),t(E,{label:"创建时间"},{default:a(()=>{var ee;return[x(q((ee=f.value)==null?void 0:ee.insertTime),1)]}),_:1}),t(E,{label:"更新时间"},{default:a(()=>{var ee;return[x(q((ee=f.value)==null?void 0:ee.updateTime),1)]}),_:1}),t(E,{label:"判题方式"},{default:a(()=>{var ee;return[x(q((ee=f.value)==null?void 0:ee.judgeType),1)]}),_:1}),t(E,{label:"评测数据"},{default:a(()=>{var ee;return[x(q((ee=f.value)==null?void 0:ee.judgeMd5),1)]}),_:1}),t(E,{label:"上传用户"},{default:a(()=>{var ee;return[x(q((ee=f.value)==null?void 0:ee.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),us=ce(rs,[["__scopeId","data-v-0098ef39"]]);function Wt(e){const l={};return l.id=e.id,l.ownerId=e.owner_id,l.ownerUsername=e.owner_username,l.ownerNickname=e.owner_nickname,l.title=e.title,e.start_time?l.startTime=new Date(e.start_time).toLocaleString():l.startTime="无限制",e.end_time?l.endTime=new Date(e.end_time).toLocaleString():l.endTime="无限制",e.update_time?l.updateTime=new Date(e.update_time).toLocaleString():l.updateTime="",e.create_time?l.createTime=new Date(e.create_time).toLocaleString():l.createTime="",e.description?l.description=e.description:l.description="",l.problems=e.problems,l}function is(e){return G({url:"/collection?id="+e,method:"get"})}function ds(e){return G({url:"/collection/edit?id="+e,method:"get"})}function cs(e,l){return G({url:"/collection/list?page="+e+"&page_size="+l,method:"get"})}function ms(e){return G({url:"/collection/rank?id="+e,method:"get"})}function ps(e){return G({url:"/collection/create",method:"post",data:e})}function fs(e){return G({url:"/collection/edit",method:"post",data:e})}function vs(e){return G({url:"/collection/join",method:"post",data:{id:e}})}function _s(e){return G({url:"/collection/quit",method:"post",data:{id:e}})}const gs={style:{margin:"10px"}},bs=de({__name:"CollectionList",setup(e){const l=Se(),n=Xe(),{globalProperties:u}=_e();let o=null;c(!1),c(!1);const y=c([{title:"ID",colKey:"id",width:"100",cell:(_,g)=>t(O,{variant:"text",onClick:()=>T(g.row.id)},{default:()=>[g.row.id]})},{title:"标题",colKey:"title",cell:(_,g)=>t(O,{variant:"text",onClick:()=>T(g.row.id)},{default:()=>[g.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),f=c(!1);let C=1,v=50;const s=c({current:C,pageSize:v,defaultCurrent:C,defaultPageSize:v,total:0,pageSizeOptions:[50,100]}),$=c(),p=c({title:"",username:""});c({title:"",description:"",open_time:[]});const T=_=>{_&&n.push({path:"/collection/"+_})},w=async()=>{await n.push({query:{...l.query,title:p.value.title,username:p.value.username,page:1,page_size:s.value.defaultPageSize}})},b=async(_,g)=>{var d;f.value=!0;try{const{current:r,pageSize:z}=_,m=await cs(r,z);if($.value=[],m.code===0){const h=m.data.list;for(let U=0;U<h.length;U++){const k=h[U],P=Wt(k);(d=$.value)==null||d.push(P)}s.value={...s.value,total:m.data.total_count}}else g&&N(u,m.code)}catch(r){console.error(r),N(u,Ge())}finally{f.value=!1}},S=async _=>{await n.push({query:{...l.query,page:_.current,page_size:_.pageSize}})},i=async()=>{await n.push({name:"collection-create"})};return fe(async()=>{o=$e(()=>l.query,_=>{p.value.title=_.title||"",p.value.username=_.username||"";const g=parseInt(_.page)||s.value.defaultCurrent,d=parseInt(_.page_size)||s.value.defaultPageSize;C=g,v=d,s.value={...s.value,current:C,pageSize:v},b({current:C,pageSize:v},!0)},{immediate:!0})}),De(()=>{o&&o()}),(_,g)=>{const d=Ee,r=he,z=Te,m=Ae,h=ze,U=O,k=Ue,P=we,j=Ie;return V(),M(j,null,{default:a(()=>[t(z,{span:9},{default:a(()=>[t(r,{style:{margin:"10px"}},{default:a(()=>[t(d,{data:$.value,columns:y.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:s.value,loading:f.value,onPageChange:S},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(z,{span:3},{default:a(()=>[R("div",gs,[t(r,{class:"sh-card"},{default:a(()=>[t(k,{model:p.value},{default:a(()=>[t(h,{label:"标题"},{default:a(()=>[t(m,{modelValue:p.value.title,"onUpdate:modelValue":g[0]||(g[0]=A=>p.value.title=A),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(h,{label:"负责人"},{default:a(()=>[t(m,{modelValue:p.value.username,"onUpdate:modelValue":g[1]||(g[1]=A=>p.value.username=A),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(h,null,{default:a(()=>[t(U,{theme:"primary",onClick:w},{default:a(()=>g[2]||(g[2]=[x("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(r,{class:"sh-card"},{default:a(()=>[t(P,null,{default:a(()=>[t(U,{onClick:i},{default:a(()=>g[3]||(g[3]=[x("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),hs=ce(bs,[["__scopeId","data-v-cffb6215"]]),ys={style:{margin:"20px"}},ws={class:"dida-operation-container"},ks={style:{margin:"12px"}},Ss=de({__name:"CollectionDetail",setup(e){let l=Se();const{globalProperties:n}=_e(),u=Ze(),o=Fe();let y=0;const f=c(!1),C=c(null),v=c(!1),s=c(!1);let $={};const p=Be(()=>o.hasAuth(Le.ManageCollection)||C.value&&o.getUserId==C.value.ownerId),T=g=>{if(!g||!$)return"default";const d=$[g];if(!d)return"default";switch(d){case Ne.Accept:return"success";case Ne.Attempt:return"warning";default:return"default"}},w=c([{title:"问题ID",colKey:"id",cell:(g,d)=>{const r=T(d.row.id);return t(O,{variant:"dashed",theme:r,onClick:()=>ta(d.row.id)},{default:()=>[d.row.id]})}},{title:"标题",colKey:"title",cell:(g,d)=>t(O,{variant:"text",onClick:()=>ta(d.row.id)},{default:()=>[d.row.title]})},{title:"正确",colKey:"accept",cell:(g,d)=>d.row.accept?d.row.accept:0},{title:"提交",colKey:"attempt",cell:(g,d)=>d.row.attempt?d.row.attempt:0}]),b=c([]),S=async()=>{if(!o.isLogin()){await X.push({name:"login"});return}s.value=!0;try{const g=await vs(y);if(g.code!==0){N(n,g.code);return}v.value=!0,Ke(n,"加入成功")}finally{s.value=!1}},i=async()=>{if(!o.isLogin()){await X.push({name:"login"});return}s.value=!0;try{const g=await _s(y);if(g.code!==0){N(n,g.code);return}v.value=!1,Ke(n,"退出成功")}finally{s.value=!1}},_=()=>{C.value&&X.push({name:"collection-edit",params:{collectionId:C.value.id}})};return fe(async()=>{if(Array.isArray(l.params.collectionId)?y=Number(l.params.collectionId[0]):y=Number(l.params.collectionId),!y){await X.push({name:"problem-collection-list"});return}v.value=!1,f.value=!0;const g=await is(y);if(g.code!==0){f.value=!1,N(n,g.code),await X.push({name:"problem-collection-list"});return}v.value=g.data.joined,$=g.data.attempt_status||{},C.value=Wt(g.data.collection),b.value=[],g.data.collection.problems&&g.data.collection.problems.forEach(d=>{const r=g.data.problems.find(z=>z.id===d);b.value.push(r)}),u.setTitle(C.value.title+" - "+u.getTitle),f.value=!1}),(g,d)=>{const r=Sa,z=ka,m=Ee,h=he,U=Te,k=O,P=we,j=Je,A=We,D=Re("md-preview"),I=Ie,L=Ve;return V(),M(L,{loading:f.value},{default:a(()=>[t(I,{class:"dida-main-content"},{default:a(()=>[t(U,{span:6},{default:a(()=>[R("div",ys,[t(z,{"max-item-width":"300"},{default:a(()=>[t(r,{to:{name:"problem-collection-list"}},{default:a(()=>d[0]||(d[0]=[x("题目集合")])),_:1}),t(r,null,{default:a(()=>{var E;return[x(q((E=C.value)==null?void 0:E.title),1)]}),_:1})]),_:1})]),t(h,{style:{margin:"10px"}},{default:a(()=>[t(m,{data:b.value,columns:w.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),_:1})]),_:1}),t(U,{span:6},{default:a(()=>{var E;return[R("div",ws,[t(P,null,{default:a(()=>[v.value?(V(),M(k,{key:0,onClick:i,loading:s.value},{default:a(()=>d[1]||(d[1]=[x("退出")])),_:1},8,["loading"])):(V(),M(k,{key:1,onClick:S,loading:s.value},{default:a(()=>d[2]||(d[2]=[x("加入")])),_:1},8,["loading"])),p.value?(V(),M(k,{key:2,onClick:_},{default:a(()=>d[3]||(d[3]=[x("编辑")])),_:1})):le("",!0)]),_:1})]),R("div",ks,[t(A,{layout:"vertical",bordered:!0},{default:a(()=>[t(j,{label:"创建者"},{default:a(()=>{var H;return[x(q((H=C.value)==null?void 0:H.ownerNickname),1)]}),_:1})]),_:1}),t(A,{layout:"vertical",bordered:!0},{default:a(()=>[t(j,{label:"开始时间"},{default:a(()=>{var H;return[x(q((H=C.value)==null?void 0:H.startTime),1)]}),_:1})]),_:1}),t(A,{layout:"vertical",bordered:!0},{default:a(()=>[t(j,{label:"结束时间"},{default:a(()=>{var H;return[x(q((H=C.value)==null?void 0:H.endTime),1)]}),_:1})]),_:1})]),(E=C.value)!=null&&E.description?(V(),M(h,{key:0,style:{margin:"10px"}},{default:a(()=>{var H;return[t(D,{"model-value":(H=C.value)==null?void 0:H.description},null,8,["model-value"])]}),_:1})):le("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),Cs=ce(Ss,[["__scopeId","data-v-042bd4bb"]]),Is=de({__name:"CollectionRank",setup(e){const l=Se(),n=Xe(),{globalProperties:u}=_e();let o=null,y=0,f=0;const C=c([{title:"Rank",colKey:"rank",align:"center"},{title:"序号",colKey:"index",align:"center"},{title:"Username",colKey:"username",cell:(T,w)=>t(O,{variant:"text",onClick:()=>n.push({name:"user",params:{username:w.row.username}})},{default:()=>[w.row.username]})},{title:"昵称",colKey:"nickname",cell:(T,w)=>t(O,{variant:"text",onClick:()=>n.push({name:"user",params:{username:w.row.username}})},{default:()=>[w.row.nickname]})},{title:"Count",colKey:"count",cell:(T,w)=>t(O,{variant:"text",onClick:()=>n.push({name:"judge-list",query:{username:w.row.username,status:He.Accept}})},{default:()=>[`${w.row.accept} / ${f}`]})},{title:"Progress",colKey:"progress",cell:(T,w)=>{let b=100;return f>0&&(b=Number((w.row.accept/f*100).toFixed(2))),t(qt,{percentage:b},null)}}]),v=c(!1),s=c([]),$=({col:T,rowIndex:w})=>{let b=1;for(let S=w+1;S<s.value.length&&s.value[S].rank===s.value[w].rank;S++)b++;if(T.colKey==="rank")return{rowspan:b}},p=async T=>{v.value=!0;try{const w=await ms(y);if(s.value=[],w.code===0){f=w.data.problem;const b=w.data.ranks,S=[];if(b){for(let g=0;g<b.length;g++){const d=b[g];let r={userId:d.author_id,username:d.author_username,nickname:d.author_nickname};r.accept=d.accept,S.push(r)}S.sort((g,d)=>g.accept!==d.accept?d.accept-g.accept:g.userId-d.userId);let i=0,_=-1;for(let g=0;g<S.length;g++)S[g].accept!==_&&(i=g+1,_=S[g].accept),S[g].index=g+1,S[g].rank=i}s.value=S}else T&&N(u,w.code)}catch(w){console.error(w),N(u,Ge())}finally{v.value=!1}};return fe(async()=>{o=$e(()=>l.query,async()=>{if(Array.isArray(l.params.collectionId)?y=Number(l.params.collectionId[0]):y=Number(l.params.collectionId),!y){await n.push({name:"problem-collection-list"});return}await p(!0)},{immediate:!0})}),De(()=>{o&&o()}),(T,w)=>{const b=Ee,S=he,i=Ie;return V(),M(i,null,{default:a(()=>[t(S,{style:{margin:"10px"}},{default:a(()=>[R("div",null,[t(b,{data:s.value,columns:C.value,"row-key":"index","rowspan-and-colspan":$,"vertical-align":"middle",bordered:!0,hover:!0,loading:v.value},null,8,["data","columns","loading"])])]),_:1})]),_:1})}}});var qe=(e=>(e[e.Valid=0]="Valid",e[e.Duplicate=1]="Duplicate",e[e.Invalid=2]="Invalid",e))(qe||{});const Ps={class:"dida-form-border"},xs={style:{"text-align":"right"}},Ts=de({name:"ParseProblemList",__name:"ParseProblemList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:l}=_e(),n=c(!1),u=c(!1),o=c(""),y=ba(e,"modelValue");let f=[];$e(y,async T=>{JSON.stringify(T)!==JSON.stringify(f)&&(await s(T),f=y.value)},{deep:!0});const C=c([]),v=c([{title:"有效性",colKey:"validType",cell:(T,w)=>{switch(w.row.valid){case qe.Valid:return t(et,{theme:"success"},{default:()=>[x("有效")]});case qe.Duplicate:return t(et,{theme:"warning"},{default:()=>[x("重复")]});case qe.Invalid:return t(et,{theme:"danger"},{default:()=>[x("无效")]});default:return null}}},{title:"问题ID",colKey:"id"},{title:"标题",colKey:"title"}]),s=async T=>{const w=Array.from(new Set(T)),b=await Dn(w);if(b.code!==0){N(l,b.code),u.value=!1;return}const S=[],i=b.data.problems;let _=[];T.forEach(g=>{const d=i.find(r=>r.id===g);if(d){const r=S.find(z=>z.id===g);d.valid=r?qe.Duplicate:qe.Valid,S.push({id:g,title:d.title,valid:d.valid}),r||_.push(g)}else S.push({id:g,title:"-",valid:qe.Invalid})}),C.value=S,f=_,y.value=_},$=async()=>{u.value=!0;const T=Pa(o.value);await s(T),n.value=!1,u.value=!1},p=()=>{C.value?o.value=C.value.map(T=>T.id).join(`
`):o.value="",n.value=!0};return(T,w)=>{const b=O,S=Ee,i=It,_=nt;return V(),ae(pe,null,[R("div",Ps,[R("div",xs,[t(b,{onClick:p},{default:a(()=>w[2]||(w[2]=[x("编辑")])),_:1})]),t(S,{data:C.value,columns:v.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(_,{visible:n.value,"onUpdate:visible":w[1]||(w[1]=g=>n.value=g),onConfirm:$,header:"请输入问题ID","confirm-loading":u.value},{default:a(()=>[w[3]||(w[3]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(i,{modelValue:o.value,"onUpdate:modelValue":w[0]||(w[0]=g=>o.value=g),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Ea=ce(Ts,[["__scopeId","data-v-b0352688"]]),Vs={class:"dida-form-border"},Ds={style:{"text-align":"right"}},js=de({name:"ParseUserList",__name:"ParseUserList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:l}=_e(),n=c(!1),u=c(!1),o=c(""),y=ba(e,"modelValue");let f=[];$e(y,async b=>{JSON.stringify(b)!==JSON.stringify(f)&&(f=b,await $(b))},{deep:!0});const C=c(),v=c([{title:"有效性",colKey:"validType",cell:(b,S)=>{switch(S.row.valid){case qe.Valid:return t(et,{theme:"success"},{default:()=>[x("有效")]});case qe.Duplicate:return t(et,{theme:"warning"},{default:()=>[x("重复")]});case qe.Invalid:return t(et,{theme:"danger"},{default:()=>[x("无效")]})}}},{title:"Username",colKey:"username"},{title:"昵称",colKey:"nickname"}]),s=(b,S)=>{if(b.code!==0){N(l,b.code),u.value=!1;return}const i=[],_=b.data.users;let g=[];S?S.forEach(d=>{let r=null;if(_&&(r=_.find(z=>z.username.toLowerCase()===d.toLowerCase())),r){const z=i.find(h=>h.username.toLowerCase()===d.toLowerCase()),m=z?qe.Duplicate:qe.Valid;i.push({id:r.id,username:r.username,nickname:r.nickname,valid:m}),z||g.push(r.id)}else i.push({id:-1,username:d,nickname:"-",valid:qe.Invalid})}):_&&_.forEach(d=>{const r=i.find(m=>m.id===d.id),z=r?qe.Duplicate:qe.Valid;i.push({id:d.id,username:d.username,nickname:d.nickname,valid:z}),r||g.push(d.id)}),C.value=i,f=g,y.value=g},$=async b=>{const S=Array.from(new Set(b)),i=await Fn(S);s(i)},p=async b=>{const S=Array.from(new Set(b)),i=await Nn(S);s(i,b)},T=async()=>{u.value=!0;const b=Pa(o.value);await p(b),n.value=!1,u.value=!1},w=()=>{C.value?o.value=C.value.map(b=>b.username).join(`
`):o.value="",n.value=!0};return(b,S)=>{const i=O,_=Ee,g=It,d=nt;return V(),ae(pe,null,[R("div",Vs,[R("div",Ds,[t(i,{onClick:w},{default:a(()=>S[2]||(S[2]=[x("编辑")])),_:1})]),t(_,{data:C.value,columns:v.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(d,{visible:n.value,"onUpdate:visible":S[1]||(S[1]=r=>n.value=r),onConfirm:T,header:"请输入用户Username","confirm-loading":u.value},{default:a(()=>[S[3]||(S[3]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(g,{modelValue:o.value,"onUpdate:modelValue":S[0]||(S[0]=r=>o.value=r),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Ma=ce(js,[["__scopeId","data-v-b0b99852"]]),Ls={style:{margin:"10px"}},$s={style:{margin:"12px"}},Us={class:"dida-edit-container"},zs=de({__name:"CollectionEdit",setup(e){let l=Se();const{globalProperties:n}=_e(),u=Ze(),o=c(""),y=c(!1),f=c(!1),C=c(!1),v=c(null),s=c({title:"",openTime:[],private:!0,problems:[],members:[],description:""}),$=c(""),p=c(""),T=c(!1),w=async()=>{T.value=!0,C.value=!1,T.value=!1},b=async()=>{f.value=!0;try{const d={title:s.value.title,problems:s.value.problems,members:s.value.members,private:s.value.private,description:s.value.description};s.value.openTime[0]&&(d.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(d.end_time=new Date(s.value.openTime[1]));const r=await ps(d);if(r.code!==0){N(n,r.code);return}r.data!=null&&await X.push({name:"collection-detail",params:{collectionId:r.data}}),Ke(n,"创建成功")}finally{f.value=!1}},S=async()=>{f.value=!0;try{const d={id:Number(o.value),title:s.value.title,private:s.value.private,problems:s.value.problems,members:s.value.members,description:s.value.description};s.value.openTime[0]&&(d.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(d.end_time=new Date(s.value.openTime[1]));const r=await fs(d);if(r.code!==0){N(n,r.code);return}r.data!=null&&v.value&&(v.value.updateTime=new Date(r.data).toLocaleString()),Ke(n,"保存成功")}finally{f.value=!1}},i=d=>{s.value.description=d,y.value=!1};async function _(d,r){f.value=!0,ge(n,"本界面暂不支持上传图片"),f.value=!1}const g=async()=>{const d=await ds(o.value);if(d.code!==0){N(n,d.code),console.error("collection get failed",d.code),await X.push({name:"problem-collection-list"});return}const r=d.data.collection;v.value=Wt(r),s.value.title=r.title,s.value.openTime=[],r.start_time?s.value.openTime.push(new Date(r.start_time)):s.value.openTime.push(""),r.end_time?s.value.openTime.push(new Date(r.end_time)):s.value.openTime.push(""),s.value.private=r.private,s.value.description=r.description,s.value.problems=r.problems,s.value.members=r.members,u.setTitle(r.title+" - "+u.getTitle);let z="";r.description&&(z=r.description),i(z)};return fe(async()=>{Array.isArray(l.params.collectionId)?o.value=l.params.collectionId[0]:o.value=l.params.collectionId,o.value?(y.value=!0,await g()):i("")}),(d,r)=>{const z=Ae,m=ze,h=Ft,U=vt,k=Ue,P=he,j=Te,A=O,D=we,I=Je,L=We,E=Ie,H=Re("md-editor-v3"),Z=Ve,Q=It,ee=nt;return V(),ae(pe,null,[t(Z,{loading:y.value},{default:a(()=>[t(E,null,{default:a(()=>[t(j,{span:8},{default:a(()=>[R("div",Ls,[t(P,{class:"sh-card"},{default:a(()=>[t(k,{model:s.value},{default:a(()=>[t(m,{label:"标题"},{default:a(()=>[t(z,{modelValue:s.value.title,"onUpdate:modelValue":r[0]||(r[0]=te=>s.value.title=te),placeholder:"题集标题"},null,8,["modelValue"])]),_:1}),t(m,{label:"开启时间"},{default:a(()=>[t(h,{modelValue:s.value.openTime,"onUpdate:modelValue":r[1]||(r[1]=te=>s.value.openTime=te),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(m,{label:"私有"},{default:a(()=>[t(U,{modelValue:s.value.private,"onUpdate:modelValue":r[2]||(r[2]=te=>s.value.private=te)},null,8,["modelValue"])]),_:1}),t(m,{label:"成员"},{default:a(()=>[t(Ma,{modelValue:s.value.members,"onUpdate:modelValue":r[3]||(r[3]=te=>s.value.members=te)},null,8,["modelValue"])]),_:1}),t(m,{label:"问题"},{default:a(()=>[t(Ea,{modelValue:s.value.problems,"onUpdate:modelValue":r[4]||(r[4]=te=>s.value.problems=te)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(j,{span:4},{default:a(()=>[R("div",$s,[R("div",Us,[o.value?(V(),M(D,{key:0},{default:a(()=>[t(A,{onClick:S,theme:"danger",loading:f.value},{default:a(()=>r[8]||(r[8]=[x("保存")])),_:1},8,["loading"])]),_:1})):(V(),M(D,{key:1},{default:a(()=>[t(A,{onClick:b,theme:"danger",loading:f.value},{default:a(()=>r[9]||(r[9]=[x("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(V(),M(L,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(I,{label:"创建时间"},{default:a(()=>{var te;return[x(q((te=v.value)==null?void 0:te.createTime),1)]}),_:1}),t(I,{label:"更新时间"},{default:a(()=>{var te;return[x(q((te=v.value)==null?void 0:te.updateTime),1)]}),_:1}),t(I,{label:"创建用户"},{default:a(()=>{var te;return[x(q((te=v.value)==null?void 0:te.ownerNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),t(H,{id:"collection-description-editor",modelValue:s.value.description,"onUpdate:modelValue":r[5]||(r[5]=te=>s.value.description=te),onSave:S,onOnUploadImg:_,previewTheme:"cyanosis",class:"dida-description-editor"},null,8,["modelValue"]),t(Z,{loading:f.value,attach:"#collection-description-editor","z-index":1e5},null,8,["loading"])]),_:1},8,["loading"]),t(ee,{visible:C.value,"onUpdate:visible":r[7]||(r[7]=te=>C.value=te),onConfirm:w,header:$.value,"confirm-loading":T.value},{default:a(()=>[r[10]||(r[10]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(Q,{modelValue:p.value,"onUpdate:modelValue":r[6]||(r[6]=te=>p.value=te),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),oa=ce(zs,[["__scopeId","data-v-79ccaf8c"]]);function sa(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const As=de({__name:"JudgeJobList",setup(e){const l=Se(),n=Xe(),{globalProperties:u}=_e();let o=!1,y=null,f;const C=c(!1),v=c(null),s=c(!1);let $=-1;const p=c({problemId:"",username:"",language:void 0,status:void 0}),T=c([{title:"ID",colKey:"id",cell:(D,I)=>{let L=null;return wt(I.row.status)&&yt(I.row.language)&&(L=()=>{h(I.row.id)}),t(O,{variant:"text",onClick:L},{default:()=>[I.row.id]})}},{title:"问题",colKey:"problemId",cell:(D,I)=>{if($){let L;return t(O,{variant:"text",onClick:()=>m($,I.row.contestProblemIndex)},sa(L=at(I.row.contestProblemIndex))?L:{default:()=>[L]})}return t(O,{variant:"text",onClick:()=>z(I.row.problemId)},{default:()=>[I.row.problemId]})}},{title:"状态",colKey:"status",align:"center",cell:(D,I)=>{let L=null;wt(I.row.status)&&yt(I.row.language)&&(L=()=>{h(I.row.id)});const E=I.row.status,H=St(E);let Z=!wt(E);const Q=Va(E);let ee=[];return ut(E)&&ee.push(t(Ve,{text:I.row.state,size:"small",class:"dida-status-loading"},null)),ee.push(t("span",null,[H])),t(O,{theme:Q,variant:"outline",onClick:L,disabled:Z},sa(ee)?ee:{default:()=>[ee]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"code",cell:(D,I)=>{let L=!yt(I.row.language);return t(O,{theme:"default",onClick:()=>r(I.row),disabled:L},{default:()=>[kt(I.row.language)+" / "+I.row.codeLength]})}},{title:"作者",colKey:"author",width:200,cell:(D,I)=>t(O,{variant:"text",onClick:()=>U(I.row.authorUsername)},{default:()=>[I.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),w=c(!1);let b=1,S=50;const i=c({current:b,pageSize:S,defaultCurrent:b,defaultPageSize:S,total:0,pageSizeOptions:[50,100]}),_=c(),g=c([]);g.value=Nt();const d=c([]);d.value=Da();const r=async D=>{s.value=!0,C.value=!0;try{v.value=D;const I=await sn(Number(v.value.id));if(I.code===0){const L=I.data,E=Ot(L.language);v.value.code=`\`\`\`${E}
${L.code}
\`\`\``}else N(u,I.code)}finally{s.value=!1}},z=D=>{D&&n.push({path:"/problem/"+D})},m=(D,I)=>{n.push({name:"contest-problem-detail",params:{contestId:D,problemIndex:I}})},h=D=>{D&&($>0?n.push({name:"contest-judge-detail",params:{contestId:$,judgeId:D}}):n.push({name:"judge-detail",params:{judgeId:D}}))},U=D=>{D&&n.push({path:"/user/"+D})},k=async()=>{await n.push({query:{...l.query,page:1,page_size:S,problem_id:p.value.problemId,username:p.value.username,language:p.value.language,status:p.value.status}})},P=async()=>{p.value.problemId="",p.value.username="",p.value.language=void 0,p.value.status=void 0,await n.push({query:{...l.query,page:1,page_size:S,problem_id:"",username:"",language:void 0,status:void 0}})},j=async(D,I)=>{I&&(w.value=!0);let L=!1;try{const{current:E,pageSize:H}=D,Z=await rn($,p.value.problemId,p.value.username,p.value.language,p.value.status,E,H);if(_.value=[],Z.code===0){if(!Z.data.has_auth){ke(u,"您目前没有权限查看评测记录"),$?await n.push({name:"contest-detail",params:{contestId:$}}):await n.push({name:"judge-list"});return}Z.data.list&&Z.data.list.length>0?(Z.data.list.forEach(ee=>{var F;const te=ja(ee);(F=_.value)==null||F.push(te),ut(ee.status)&&(L=!0)}),i.value={...i.value,total:Z.data.total_count}):(ke(u,"未找到记录"),i.value={...i.value,total:0})}else I&&N(u,Z.code)}catch(E){console.error(E),I&&N(u,Ge())}finally{I&&(w.value=!1),L&&o&&(f=setTimeout(()=>{j({current:b,pageSize:S},!1)},5e3))}},A=async D=>{await n.push({query:{...l.query,page:D.current,page_size:D.pageSize}})};return fe(async()=>{o=!0,y=$e(()=>l.query,D=>{Array.isArray(l.params.contestId)?$=Number(l.params.contestId[0]):$=Number(l.params.contestId),p.value.problemId=D.problem_id||"",p.value.username=D.username||"",D.language!=null?p.value.language=Number(D.language):p.value.language=void 0,D.status!=null?p.value.status=Number(D.status):p.value.status=void 0;const I=parseInt(D.page)||i.value.defaultCurrent,L=parseInt(D.page_size)||i.value.defaultPageSize;b=I,S=L,i.value.pageSizeOptions.includes(S)||(S=i.value.defaultPageSize),i.value={...i.value,current:b,pageSize:S},j({current:b,pageSize:S},!0)},{immediate:!0})}),De(()=>{o=!1,y&&y(),clearTimeout(f)}),(D,I)=>{const L=Ae,E=ze,H=Kt,Z=ft,Q=O,ee=we,te=Ue,F=Ee,me=he,ue=lt,W=Re("md-preview"),J=Ve,ne=nt;return V(),ae(pe,null,[t(me,{style:{margin:"10px"}},{default:a(()=>[t(te,{layout:"inline",onSubmit:k,onReset:P},{default:a(()=>[t(E,{label:"题号"},{default:a(()=>[t(L,{modelValue:p.value.problemId,"onUpdate:modelValue":I[0]||(I[0]=K=>p.value.problemId=K),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(E,{label:"用户"},{default:a(()=>[t(L,{modelValue:p.value.username,"onUpdate:modelValue":I[1]||(I[1]=K=>p.value.username=K),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(E,{label:"语言"},{default:a(()=>[t(Z,{modelValue:p.value.language,"onUpdate:modelValue":I[2]||(I[2]=K=>p.value.language=K),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:a(()=>[(V(!0),ae(pe,null,Pe(g.value,K=>(V(),M(H,{key:K.value,value:K.value,label:K.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(E,{label:"状态"},{default:a(()=>[t(Z,{modelValue:p.value.status,"onUpdate:modelValue":I[3]||(I[3]=K=>p.value.status=K),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:a(()=>[(V(!0),ae(pe,null,Pe(d.value,K=>(V(),M(H,{key:K.value,value:K.value,label:K.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(E,null,{default:a(()=>[t(ee,null,{default:a(()=>[t(Q,{theme:"primary",type:"submit"},{default:a(()=>I[7]||(I[7]=[x("搜索")])),_:1}),t(Q,{theme:"default",variant:"base",type:"reset"},{default:a(()=>I[8]||(I[8]=[x("重置")])),_:1})]),_:1})]),_:1})]),_:1}),t(F,{data:_.value,columns:T.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:i.value,loading:w.value,onPageChange:A,"table-layout":"auto"},null,8,["data","columns","pagination","loading"])]),_:1}),t(ne,{visible:C.value,"onUpdate:visible":I[5]||(I[5]=K=>C.value=K),width:"800px","cancel-btn":null,"close-btn":!1,onConfirm:I[6]||(I[6]=K=>C.value=!1)},{header:a(()=>[t(ue,{onClick:I[4]||(I[4]=()=>{var K;h((K=v.value)==null?void 0:K.id)})},{default:a(()=>{var K,B,ie;return[x(q(((K=v.value)==null?void 0:K.id)+" - "+ve(kt)((B=v.value)!=null&&B.language?(ie=v.value)==null?void 0:ie.language:ve(Tt).Unknown)),1)]}),_:1})]),default:a(()=>[t(J,{loading:s.value},{default:a(()=>{var K;return[t(W,{"model-value":(K=v.value)==null?void 0:K.code,"code-foldable":!1,style:{"min-height":"100px"}},null,8,["model-value"])]}),_:1},8,["loading"])]),_:1},8,["visible"])],64)}}}),ra=ce(As,[["__scopeId","data-v-05589c5c"]]),Rs={class:"dida-code-container"},Es={style:{margin:"20px"}},Ms={key:2,class:"dida-edit-container"};function ua(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const qs=de({__name:"JudgeJobDetail",setup(e){const l=Se(),n=Xe(),u=Fe(),{globalProperties:o}=_e();let y=!1,f,C=0,v=0;const s=c(""),$=c(null),p=c(""),T=c(0),w=c(null),b=c({from:"#5a96ff",to:"#00A870"}),S=c([{title:"ID",colKey:"id"},{title:"问题",colKey:"problemId",cell:(k,P)=>t(O,{variant:"text",onClick:()=>z(P.row.problemId)},{default:()=>[P.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(k,P)=>{const j=P.row.status,A=St(j),D=Va(j);let I=[];return ut(j)&&I.push(t(Ve,{text:P.row.state,size:"small",class:"dida-status-loading"},null)),I.push(t("span",null,[A])),t(O,{theme:D,variant:"outline"},ua(I)?I:{default:()=>[I]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"language",cell:(k,P)=>t("span",null,[kt(P.row.language)+" / "+P.row.codeLength])},{title:"作者",colKey:"author",width:200,cell:(k,P)=>t(O,{variant:"text",onClick:()=>m(P.row.authorUsername)},{default:()=>[P.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),i=c(!1),_=c(!1),g=c(),d=Be(()=>u.hasAuth(Le.ManageJudge)),r=async()=>{if(!_.value){_.value=!0;try{const k=await pn(C);k.code===0?await U(!0):N(o,k.code)}catch(k){console.error(k),N(o,Ge())}finally{_.value=!1}}},z=k=>{k&&n.push({path:"/problem/"+k})},m=k=>{k&&n.push({path:"/user/"+k})},h=k=>{const P=k.status,j=St(P);let A;switch(P){case He.Init:case He.Rejudge:case He.Compiling:case He.Running:A="default";break;case He.Accept:A="success";break;case He.PE:A="warning";break;default:A="danger";break}return t(we,null,{default:()=>[t(O,{theme:"default",variant:"outline"},{default:()=>[k.taskId]}),t(O,{theme:A,variant:"outline"},ua(j)?j:{default:()=>[j]}),t("span",null,[x("分数："),k.score]),t("span",null,[x("用时："),k.time]),t("span",null,[x("内存："),k.memory])]})},U=async k=>{var j;k&&(i.value=!0);let P=!1;try{const A=await on(C);if(g.value=[],A.code===0){const D=A.data,I=ja(D);if((j=g.value)==null||j.push(I),s.value=I.judgerName,b.value.to="#00A870",ut(D.status)?(w.value="active",I.taskTotal>0?(T.value=Number((I.taskCurrent/I.taskTotal*100).toFixed(2)),I.taskCurrent>=I.taskTotal&&(T.value=99)):T.value=0):(T.value=100,D.status===He.Accept?w.value="success":D.status===He.PE?(b.value.to="#F57C20",w.value="warning"):(b.value.to="#F56C6C",w.value="error")),D.code){const L=Ot(D.language);p.value=`\`\`\`${L}
${D.code}
\`\`\``}$.value=I,ut(D.status)&&(P=!0)}else k&&N(o,A.code),v?await n.push({name:"contest-judge",params:{contestId:v}}):await n.push({name:"judge-list"})}catch(A){console.error(A),k&&N(o,Ge())}finally{k&&(i.value=!1),P&&y&&(f=setTimeout(()=>{U(!1)},5e3))}};return fe(async()=>{if(y=!0,Array.isArray(l.params.judgeId)?C=Number(l.params.judgeId[0]):C=Number(l.params.judgeId),Array.isArray(l.params.contestId)?v=Number(l.params.contestId[0]):v=Number(l.params.contestId),!C){await n.push({name:"judge"});return}await U(!0)}),De(()=>{y=!1,clearTimeout(f)}),(k,P)=>{var F,me,ue;const j=qt,A=Ee,D=he,I=Re("md-preview"),L=Te,E=Je,H=We,Z=Ie,Q=Sl,ee=Cl,te=O;return V(),ae(pe,null,[t(j,{color:b.value,status:w.value,class:"dida-job-progress",percentage:T.value},null,8,["color","status","percentage"]),t(D,{style:{margin:"10px"}},{default:a(()=>[t(A,{data:g.value,columns:S.value,"row-key":"id","vertical-align":"top",hover:!0,loading:i.value},null,8,["data","columns","loading"])]),_:1}),t(Z,null,{default:a(()=>[t(L,{span:8},{default:a(()=>[R("div",Rs,[t(I,{"model-value":p.value,class:"dida-code-div"},null,8,["model-value"])])]),_:1}),t(L,{span:4},{default:a(()=>[R("div",Es,[t(H,{layout:"vertical",bordered:!0},{default:a(()=>[t(E,{label:"判题机"},{default:a(()=>[x(q(s.value),1)]),_:1}),t(E,{label:"判题时间"},{default:a(()=>{var W;return[x(q((W=$.value)==null?void 0:W.judgeTime),1)]}),_:1})]),_:1}),t(D,{class:"dida-card-tips"},{default:a(()=>{var W;return[x(q(i.value?"数据正在加载，请等待":ve(ea)((W=$.value)==null?void 0:W.status)),1)]}),_:1})])]),_:1})]),_:1}),(F=$.value)!=null&&F.compileMessage?(V(),M(D,{key:0,class:"compile-message"},{default:a(()=>{var W;return[x(q((W=$.value)==null?void 0:W.compileMessage),1)]}),_:1})):le("",!0),(me=$.value)!=null&&me.task&&((ue=$.value)==null?void 0:ue.task.length)>0?(V(),M(ee,{key:1,class:"task-panel"},{default:a(()=>{var W;return[(V(!0),ae(pe,null,Pe((W=$.value)==null?void 0:W.task,(J,ne)=>(V(),M(Q,{key:J.taskId,header:()=>h(J)},{default:a(()=>[t(D,null,{default:a(()=>[x(q(ve(ea)(J.status)),1)]),_:2},1024),J.content?(V(),M(D,{key:0,class:"dida-card-tips"},{default:a(()=>[t(I,{"model-value":J.content},null,8,["model-value"])]),_:2},1024)):le("",!0),J.waHint?(V(),M(D,{key:1,class:"dida-card-tips"},{default:a(()=>[t(I,{"model-value":J.waHint},null,8,["model-value"])]),_:2},1024)):le("",!0)]),_:2},1032,["header"]))),128))]}),_:1})):le("",!0),d.value?(V(),ae("div",Ms,[t(te,{onClick:r,loading:_.value},{default:a(()=>P[0]||(P[0]=[x("重新评测")])),_:1},8,["loading"])])):le("",!0)],64)}}}),ia=ce(qs,[["__scopeId","data-v-de3651b0"]]),Ks={style:{margin:"10px"}},Fs=de({__name:"ContestList",setup(e){const l=Se(),n=Xe(),{globalProperties:u}=_e();let o=null;const y=c([{title:"ID",colKey:"id",cell:(g,d)=>t(O,{variant:"text",onClick:()=>T(d.row.id)},{default:()=>[d.row.id]})},{title:"标题",colKey:"title",cell:(g,d)=>t(O,{variant:"text",onClick:()=>T(d.row.id)},{default:()=>[d.row.title]})},{title:"负责人",colKey:"ownerNickname",cell:(g,d)=>t(O,{variant:"text",onClick:()=>Bt(n,d.row.ownerUsername)},{default:()=>[d.row.ownerNickname]})},{title:"权限",colKey:"private",cell:(g,d)=>d.row.private?"私有":"公开"},{title:"开始时间",colKey:"startTime"},{title:"结束时间",colKey:"endTime"}]),f=c(!1);let C=1,v=50;const s=c({current:C,pageSize:v,defaultCurrent:C,defaultPageSize:v,total:0,pageSizeOptions:[50,100]}),$=c(),p=c({title:"",username:""}),T=g=>{g&&n.push({path:"/contest/"+g})},w=async()=>{await n.push({query:{...l.query,title:p.value.title,username:p.value.username,page:1,page_size:s.value.defaultPageSize}})},b=async()=>{p.value.title="",p.value.username="",await n.push({query:{...l.query,title:"",username:"",page:1,page_size:s.value.defaultPageSize}})},S=async(g,d)=>{var r;f.value=!0;try{const{current:z,pageSize:m}=g,h=await yo(p.value.title,p.value.username,z,m);if($.value=[],h.code===0){const U=h.data.list;for(let k=0;k<U.length;k++){const P=U[k],j=Ht(P);(r=$.value)==null||r.push(j)}s.value={...s.value,total:h.data.total_count}}else d&&N(u,h.code)}catch(z){console.error(z),N(u,Ge())}finally{f.value=!1}},i=async g=>{await n.push({query:{...l.query,page:g.current,page_size:g.pageSize}})},_=()=>{n.push({name:"contest-create"})};return fe(async()=>{o=$e(()=>l.query,g=>{p.value.title=g.title||"",p.value.username=g.username||"";const d=parseInt(g.page)||s.value.defaultCurrent,r=parseInt(g.page_size)||s.value.defaultPageSize;C=d,v=r,s.value={...s.value,current:C,pageSize:v},S({current:C,pageSize:v},!0)},{immediate:!0})}),De(()=>{o&&o()}),(g,d)=>{const r=Ee,z=he,m=Te,h=Ae,U=ze,k=O,P=we,j=Ue,A=Ie;return V(),M(A,null,{default:a(()=>[t(m,{span:9},{default:a(()=>[t(z,{style:{margin:"10px"}},{default:a(()=>[t(r,{data:$.value,columns:y.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:s.value,loading:f.value,"table-layout":"auto",onPageChange:i,style:{"white-space":"nowrap"}},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(m,{span:3},{default:a(()=>[R("div",Ks,[t(z,{class:"sh-card"},{default:a(()=>[t(j,{model:p.value,onSubmit:w,onReset:b},{default:a(()=>[t(U,{label:"标题"},{default:a(()=>[t(h,{modelValue:p.value.title,"onUpdate:modelValue":d[0]||(d[0]=D=>p.value.title=D),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(U,{label:"负责人"},{default:a(()=>[t(h,{modelValue:p.value.username,"onUpdate:modelValue":d[1]||(d[1]=D=>p.value.username=D),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(U,null,{default:a(()=>[t(P,null,{default:a(()=>[t(k,{theme:"primary",type:"submit"},{default:a(()=>d[2]||(d[2]=[x("提交")])),_:1}),t(k,{theme:"danger",type:"reset"},{default:a(()=>d[3]||(d[3]=[x("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(z,{class:"sh-card"},{default:a(()=>[t(P,null,{default:a(()=>[t(k,{onClick:_},{default:a(()=>d[4]||(d[4]=[x("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),da=ce(Fs,[["__scopeId","data-v-dcab2ec1"]]),Ns={style:{margin:"20px"}},Os={style:{margin:"10px"}},Gs={style:{"text-align":"center","align-content":"center",padding:"20px",height:"500px"}},Hs={style:{"text-align":"center",width:"100%"}},Bs={class:"dida-operation-container"},Ws={style:{margin:"12px"}},Js=de({__name:"ContestDetail",setup(e){let l=Se();const{globalProperties:n}=_e(),u=Ze(),o=Fe(),y=c(!1);let f=0;const C=c(!1),v=c(null),s=c(!1),$=c(!1),p=c(""),T=Be(()=>o.hasAuth(Le.ManageContest)||v.value&&o.getUserId==v.value.ownerId),w=m=>{if(!m||!i)return"default";const h=i[m];if(!h)return"default";switch(h){case Ne.Accept:return"success";case Ne.Attempt:return"warning";default:return"default"}},b=c([{title:"问题ID",colKey:"index",cell:(m,h)=>{const U=w(h.row.index);return t(O,{variant:"dashed",theme:U,onClick:async()=>await Mt(f,h.row.index)},{default:()=>[h.row.id]})}},{title:"标题",colKey:"title",cell:(m,h)=>t(O,{variant:"text",onClick:async()=>await Mt(f,h.row.index)},{default:()=>[h.row.title]})},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),S=c([]);let i={},_=c(!1);const g=()=>{X.push({name:"contest-edit",params:{contestId:f}})},d=async()=>{y.value=!0;try{const m=await Io(f);if(m.code!==0){N(n,m.code);return}const h=m.data;ke(n,"查重报告已生成，请前往查看"),window.open(h,"_blank")}finally{y.value=!1}},r=async m=>{if(!o.isLogin()){await X.push({name:"login"});return}if(!p.value){ge(n,"请输入密码");return}_.value=!0;try{const h=await Co(f,p.value);if(h.code!==0){N(n,h.code);return}ke(n,"申请访问成功"),await z()}catch(h){console.error("Error submitting contest password:",h),N(n,"提交密码失败，请稍后再试")}finally{_.value=!1}},z=async()=>{C.value=!0;const m=await vo(f);if(m.code!==0){C.value=!1,N(n,m.code),await X.push({name:"contest"});return}s.value=m.data.has_auth,$.value=m.data.need_password,v.value=Ht(m.data.contest),S.value=v.value.problems,i=m.data.attempt_status||{},u.setTitle(v.value.title+" - "+u.getTitle),C.value=!1};return fe(async()=>{if(Array.isArray(l.params.contestId)?f=Number(l.params.contestId[0]):f=Number(l.params.contestId),!f){await X.push({name:"contest"});return}await z()}),(m,h)=>{const U=Ct,k=Ee,P=he,j=Ae,A=ze,D=O,I=Ue,L=Te,E=we,H=Je,Z=We,Q=Re("md-preview"),ee=Ie,te=Ve;return V(),M(te,{loading:C.value},{default:a(()=>[t(ee,{class:"dida-main-content"},{default:a(()=>[t(L,{span:6},{default:a(()=>{var F,me,ue;return[R("div",Ns,[R("h1",null,q((F=v.value)==null?void 0:F.title),1),(me=v.value)!=null&&me.notification?(V(),M(U,{key:0,theme:"info",message:(ue=v.value)==null?void 0:ue.notification},null,8,["message"])):le("",!0)]),R("div",Os,[s.value?(V(),M(P,{key:0},{default:a(()=>[t(k,{data:S.value,columns:b.value,"row-key":"id","table-layout":"auto","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1})):(V(),M(P,{key:1},{default:a(()=>[R("div",Gs,[t(U,{theme:"warning",message:"您没有查看本比赛的权限"}),$.value?(V(),M(I,{key:0,style:{margin:"20px auto 0",width:"200px"},onSubmit:r,"label-width":"0"},{default:a(()=>[t(A,null,{default:a(()=>[t(j,{placeholder:"请输入密码",value:p.value,"onUpdate:value":h[0]||(h[0]=W=>p.value=W),style:{width:"300px"},type:"password",autocomplete:"new-password"},null,8,["value"])]),_:1}),t(A,null,{default:a(()=>[R("div",Hs,[t(D,{theme:"primary",type:"submit",loading:ve(_)},{default:a(()=>h[1]||(h[1]=[x("提交")])),_:1},8,["loading"])])]),_:1})]),_:1})):le("",!0)])]),_:1}))])]}),_:1}),t(L,{span:6},{default:a(()=>{var F;return[R("div",Bs,[t(E,null,{default:a(()=>[T.value?(V(),M(D,{key:0,onClick:d,loading:y.value},{default:a(()=>h[2]||(h[2]=[x("查重")])),_:1},8,["loading"])):le("",!0),T.value?(V(),M(D,{key:1,onClick:g},{default:a(()=>h[3]||(h[3]=[x("编辑")])),_:1})):le("",!0)]),_:1})]),R("div",Ws,[t(Z,{layout:"vertical",bordered:!0},{default:a(()=>[t(H,{label:"创建时间"},{default:a(()=>{var me;return[x(q((me=v.value)==null?void 0:me.createTime),1)]}),_:1})]),_:1}),t(Z,{layout:"vertical",bordered:!0},{default:a(()=>[t(H,{label:"更新时间"},{default:a(()=>{var me;return[x(q((me=v.value)==null?void 0:me.updateTime),1)]}),_:1})]),_:1}),t(Z,{layout:"vertical",bordered:!0},{default:a(()=>[t(H,{label:"开始时间"},{default:a(()=>{var me;return[x(q((me=v.value)==null?void 0:me.startTime),1)]}),_:1})]),_:1}),t(Z,{layout:"vertical",bordered:!0},{default:a(()=>[t(H,{label:"结束时间"},{default:a(()=>{var me;return[x(q((me=v.value)==null?void 0:me.endTime),1)]}),_:1})]),_:1})]),(F=v.value)!=null&&F.description?(V(),M(P,{key:0,style:{margin:"12px"}},{default:a(()=>{var me;return[t(Q,{"model-value":(me=v.value)==null?void 0:me.description,class:"dida-content-description"},null,8,["model-value"])]}),_:1})):le("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),Ys=ce(Js,[["__scopeId","data-v-af022b1b"]]);function qa(e){return e?Math.floor(e/1e9):0}function rt(e){if(e<=0)return"0秒";let l="";const n=Math.floor(e/3600);n>0&&(l+=`${n}小时`);const u=Math.floor(e%3600/60);return(u>0||n>0)&&(n>0&&u<10&&(l+="0"),l+=`${u}分钟`),e=e%60,(e>0||u>0||n>0)&&((n>0||u>0)&&e<10&&(l+="0"),l+=`${e.toFixed(0)}秒`),l}const Xs=pt("contest",{state:()=>({starMembers:{}}),actions:{clear(){this.$patch({starMembers:{}})},addStarMember(e,l){this.starMembers[e]||(this.starMembers[e]={}),this.starMembers[e][l]=!0},removeStarMember(e,l){this.starMembers[e]&&(delete this.starMembers[e][l],Object.keys(this.starMembers[e]).length===0&&delete this.starMembers[e])},isStarMember(e,l){var n;return!!((n=this.starMembers[e])!=null&&n[l])}},persist:!0}),Zs={style:{margin:"10px 10px 40px"}},Qs={style:{"text-align":"right","margin-bottom":"10px"}},er={class:"table-scroll-wrapper"};function ca(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const tr=de({__name:"ContestRank",setup(e){const l=Se(),n=Xe(),u=Xs(),{globalProperties:o}=_e();let y=!1,f=null,C=0,v=null,s=null,$=0;const p=c(0),T=c(0),w=c(!1),b=c(!0),S=c(!0);let i=null,_=null,g=1,d=50;const r=c({current:g,pageSize:d,defaultCurrent:1,defaultPageSize:50,total:0,pageSizeOptions:[50,100,1e3]}),z=W=>u&&u.isStarMember(C,W),m=async W=>{r.value={...r.value,current:W.current,pageSize:W.pageSize},await n.push({query:{...l.query,page:W.current,page_size:W.pageSize}})},h=W=>{if(W==null)return"-";const J=Math.floor(W/3600).toString().padStart(2,"0"),ne=Math.floor(W%3600/60).toString().padStart(2,"0"),K=(W%60).toFixed(0).toString().padStart(2,"0");return`${J}:${ne}:${K}`},U=c({}),k=[{title:"Rank",colKey:"rank",align:"center",fixed:"left"},{title:"昵称",colKey:"nickname",fixed:"left",attrs:W=>{let J={};return z(W.row.userId)&&(J={backgroundColor:"rgba(255,165,30,0.5)"}),{style:J}},cell:(W,J)=>{const ne=Kl(J.row.nickname,18);let K=null;return z(J.row.userId)?K=t(O,{shape:"circle",variant:"text",class:"rank-unstar-button",onClick:()=>{u.removeStarMember(C,J.row.userId),F()}},{default:()=>[t(ll,{slot:"icon"},null)]}):K=t(O,{shape:"circle",variant:"text",class:"rank-star-button",onClick:()=>{u.addStarMember(C,J.row.userId),F()}},{default:()=>[t(nl,{slot:"icon"},null)]}),t("div",{class:"rank-nickname-cell"},[t(we,null,{default:()=>[t(Pl,{content:J.row.nickname},{default:()=>[t(O,{variant:"text",onClick:()=>n.push({name:"user",params:{username:J.row.username}})},ca(ne)?ne:{default:()=>[ne]})]}),K]})])}},{title:"Solved",colKey:"solved",align:"center",fixed:"left",cell:(W,J)=>t(O,{variant:"text",onClick:()=>n.push({name:"contest-judge",params:{contestId:C},query:{username:J.row.username,status:He.Accept}})},{default:()=>[J.row.solved]})},{title:"Penalty",colKey:"penalty",align:"center",fixed:"left",cell:(W,J)=>h(J.row.penalty)}],P=c([]),j=c(!1);let A=[],D=[];const I=c([]);let L=[];const E=({col:W,rowIndex:J})=>{if(W.colKey==="rank"){let ne=r.value.current;r.value.current>Math.ceil(I.value.length/r.value.pageSize)&&(ne=Math.ceil(I.value.length/r.value.pageSize));let K=r.value.pageSize*(ne-1),B=1;for(let ie=J+1;K+ie<I.value.length&&I.value[K+ie].rank===I.value[K+J].rank;ie++)B++;return{rowspan:B}}},H=(W,{value:J})=>rt(J),Z=()=>{i&&clearInterval(i),i=setInterval(()=>{y&&ue(!1)},3e4),_&&clearInterval(_),_=setInterval(()=>{if(!y)return;p.value=(new Date().getTime()-v.getTime())/1e3;const W=Math.min(p.value,T.value);p.value=Math.min(p.value,W),F()},1e3)},Q=()=>{i&&(clearInterval(i),i=null),_&&(clearInterval(_),_=null)},ee=async W=>{S.value=W,W?(await ue(!1),Z()):Q()},te=()=>{F(),r.value={...r.value,current:1}},F=()=>{I.value=[];let W=[];for(let Y=0;Y<A.length;Y++){const se=A[Y];let ye={userId:se.author_id,username:se.author_username,nickname:se.author_nickname},be=0,xe=0;se.problems.forEach(Oe=>{let je=-1,Ye=Oe.lock||0;if(Oe.ac){if(je=(new Date(Oe.ac).getTime()-(v==null?void 0:v.getTime()))/1e3,je>p.value)return;be++,xe+=je,xe+=Oe.attempt*20*60}if(Ye>0&&$>0){const Vt=T.value-$;p.value<Vt&&(Ye=0)}const ot=Oe.index;ye[`problem_${ot}`]={acDuration:je,attempt:Oe.attempt||0,lock:Ye}}),ye.solved=be,ye.penalty=xe,W.push(ye)}W.sort((Y,se)=>Y.solved!==se.solved?se.solved-Y.solved:Y.penalty!==se.penalty?Y.penalty-se.penalty:Y.userId-se.userId);const J=D;let ne=0,K=0,B=-1,ie=-1;for(let Y=0;Y<W.length;Y++)J&&J.includes(W[Y].userId)?W[Y].rank="*":(K++,(W[Y].solved!==B||W[Y].penalty!==ie)&&(ne=K,B=W[Y].solved,ie=W[Y].penalty),W[Y].rank=String(ne));w.value&&(W=W.filter(Y=>z(Y.userId)));const oe=document.querySelectorAll("tbody tr"),Ce={};L.forEach((Y,se)=>{const ye=oe[se];ye&&(Ce[Y.userId]=ye.getBoundingClientRect())}),r.value={...r.value,total:W.length},I.value=W;for(let Y=0;Y<I.value.length;Y++)I.value[Y].index=Y+1;if(L=[...I.value],b.value){const Y={},se=document.querySelectorAll("table tbody tr");I.value.forEach((ye,be)=>{const xe=se[be];xe&&(Y[ye.userId]=xe.getBoundingClientRect())}),requestAnimationFrame(()=>{const ye=document.querySelectorAll("table tbody tr");I.value.forEach((be,xe)=>{const Oe=ye[xe],je=Ce[be.userId],Ye=Y[be.userId];if(je&&Ye){const ot=je.top-Ye.top;ot!==0&&(Oe.style.transition="none",Oe.style.transform=`translateY(${ot}px)`)}}),requestAnimationFrame(()=>{document.querySelectorAll("table tbody tr").forEach(xe=>{xe.style.transition="transform 300ms ease",xe.style.transform=""})})})}},me=W=>{ee(!1),p.value=W;const J=Math.min(T.value,(new Date().getTime()-(v==null?void 0:v.getTime()))/1e3);p.value=Math.min(p.value,J),F()},ue=async W=>{W&&(j.value=!0);try{const J=await wo(C);if(P.value=[...k],A=[],D=[],I.value=[],r.value={...r.value,total:0},J.code===0){if(!J.data.has_auth){ke(o,"您目前没有权限查看比赛排名"),await n.push({name:"contest-detail",params:{contestId:C}});return}J.data.problems.sort((B,ie)=>B-ie),J.data.problems.forEach((B,ie)=>{P.value.push({colKey:`problem_${B}`,align:"center",title:()=>{let oe;return t(O,{variant:"text",onClick:()=>n.push({name:"contest-problem-detail",params:{contestId:C,problemIndex:B}})},ca(oe=at(B))?oe:{default:()=>[oe]})},cell:(oe,Ce)=>{const Y=Ce.row[`problem_${B}`];if(!Y)return"";let se="";return Y.acDuration>=0&&(se=h(Y.acDuration)),Y.attempt>0&&(se&&(se+=" "),se+=`(-${Y.attempt})`),Y.lock>0&&(se&&(se+=" "),se+=`(+${Y.lock})`),t("span",null,[se])},attrs:oe=>{const Ce=oe.row[`problem_${B}`];return Ce?Ce.acDuration>=0?{style:{backgroundColor:"rgba(130,255,30,0.5)"}}:Ce.lock>0?{style:{backgroundColor:"rgb(255,180,50,0.5)"}}:Ce.attempt>0?{style:{backgroundColor:"rgba(255,120,120,0.5)"}}:{}:{}}})});const ne=J.data.contest;if(v=new Date(ne.start_time),s=new Date(ne.end_time),A=J.data.ranks,D=J.data.v_members||[],T.value=Math.floor((s.getTime()-v.getTime())/1e3),U.value={0:"0",[Math.floor(T.value/2)]:rt(Math.floor(T.value/2)),[T.value]:rt(T.value)},$=qa(ne.lock_rank_duration||0),J.data.is_locked&&$>0){const B=Math.max(0,T.value-$);U.value[B]=t("span",{style:"color: #0052d9"},[x("锁榜("),rt(B),x(")")])}p.value=Math.floor((new Date().getTime()-v.getTime())/1e3);const K=Math.min(p.value,T.value);p.value=Math.min(p.value,K),S.value=!0,Z(),F()}else W&&N(o,J.code)}catch(J){console.error(J),W&&N(o,Ge())}finally{W&&(j.value=!1)}};return fe(async()=>{y=!0,f=$e(()=>l.query,async W=>{if(Array.isArray(l.params.contestId)?C=Number(l.params.contestId[0]):C=Number(l.params.contestId),!C){await n.push({name:"contest"});return}const J=parseInt(W.page)||r.value.defaultCurrent,ne=parseInt(W.page_size)||r.value.defaultPageSize;g=J,d=ne,r.value={...r.value,current:g,pageSize:d},await ue(!0)},{immediate:!0})}),De(()=>{y=!1,f&&f(),Q()}),(W,J)=>{const ne=vt,K=we,B=Il,ie=Ee,oe=he,Ce=Ie;return V(),M(Ce,null,{default:a(()=>[t(oe,{style:{margin:"10px",width:"100%"}},{default:a(()=>[R("div",Zs,[R("div",Qs,[t(K,null,{default:a(()=>[t(ne,{size:"large",modelValue:w.value,"onUpdate:modelValue":J[0]||(J[0]=Y=>w.value=Y),onChange:te},{label:a(Y=>[x(q(Y.value?"仅展示收藏":"未过滤收藏"),1)]),_:1},8,["modelValue"]),t(ne,{size:"large",modelValue:b.value,"onUpdate:modelValue":J[1]||(J[1]=Y=>b.value=Y)},{label:a(Y=>[x(q(Y.value?"开启动画":"关闭动画"),1)]),_:1},8,["modelValue"]),t(ne,{size:"large",modelValue:S.value,"onUpdate:modelValue":J[2]||(J[2]=Y=>S.value=Y),onChange:ee},{label:a(Y=>[x(q(Y.value?"自动刷新":"关闭刷新"),1)]),_:1},8,["modelValue"])]),_:1})]),t(B,{modelValue:p.value,"onUpdate:modelValue":J[3]||(J[3]=Y=>p.value=Y),marks:U.value,max:T.value,label:H,"tooltip-props":{placement:"top"},"input-number-props":{theme:"column",autoWidth:!0,format:ve(rt),onChange:me},onChangeEnd:me},null,8,["modelValue","marks","max","input-number-props"])]),R("div",er,[t(ie,{data:I.value,columns:P.value,"row-key":"index","vertical-align":"middle",bordered:!0,hover:!0,"table-layout":"auto","rowspan-and-colspan":E,loading:j.value,class:"dida-contest-rank-table",pagination:r.value,onPageChange:m},null,8,["data","columns","loading","pagination"])])]),_:1})]),_:1})}}}),ar=ce(tr,[["__scopeId","data-v-838e6c28"]]),lr={style:{margin:"10px"}},nr={style:{margin:"12px"}},or={class:"dida-edit-container"},sr={class:"dida-description-editor"},rr=de({__name:"ContestEdit",setup(e){let l=Se();const{globalProperties:n}=_e(),u=Ze(),o=c(0),y=c(!1),f=c(!1),C=c(!1),v=c(null),s=c({title:"",openTime:[],private:!0,password:"",problems:[],members:[],description:"",notification:"",lockRankDuration:0,alwaysLock:!0,submitAnytime:!1}),$=c(""),p=c(""),T=c(!1),w=async()=>{T.value=!0,C.value=!1,T.value=!1},b=async(d,r)=>{f.value=!0,await it(d,r,n,()=>bo(o.value)),f.value=!1},S=async()=>{f.value=!0;try{const d={title:s.value.title,description:s.value.description,notification:s.value.notification,lock_rank_duration:s.value.lockRankDuration,always_lock:s.value.alwaysLock,problems:s.value.problems,members:s.value.members,private:s.value.private,password:s.value.password,submit_anytime:s.value.submitAnytime};s.value.openTime[0]&&(d.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(d.end_time=new Date(s.value.openTime[1]));const r=await ko(d);if(f.value=!0,r.code!==0){N(n,r.code);return}r.data!=null&&await X.push({name:"contest-detail",params:{contestId:r.data}}),Ke(n,"创建成功")}finally{f.value=!1}},i=async()=>{f.value=!0;try{const d={id:Number(o.value),title:s.value.title,notification:s.value.notification,lock_rank_duration:s.value.lockRankDuration,always_lock:s.value.alwaysLock,problems:s.value.problems,members:s.value.members,private:s.value.private,password:s.value.password,submit_anytime:s.value.submitAnytime,description:s.value.description};s.value.openTime[0]&&(d.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(d.end_time=new Date(s.value.openTime[1]));const r=await So(d);if(f.value=!0,r.code!==0){N(n,r.code);return}v.value&&(r.data.description!=null&&(s.value.description=r.data.description),r.data.update_time!=null&&(v.value.updateTime=new Date(r.data.update_time).toLocaleString())),Ke(n,"保存成功")}finally{f.value=!1}},_=d=>{s.value.description=d,y.value=!1},g=async()=>{const d=await _o(o.value);if(d.code!==0){N(n,d.code),console.error("contest get failed",d.code),await X.push({name:"contest-list"});return}const r=d.data.contest;v.value=Ht(r),s.value.title=r.title,s.value.openTime=[],r.start_time?s.value.openTime.push(new Date(r.start_time)):s.value.openTime.push(""),r.end_time?s.value.openTime.push(new Date(r.end_time)):s.value.openTime.push(""),s.value.private=r.private,s.value.password=r.password||"",s.value.description=r.description||"",s.value.notification=r.notification||"",s.value.problems=d.data.problems,s.value.members=d.data.members,r.lock_rank_duration?s.value.lockRankDuration=qa(r.lock_rank_duration):s.value.lockRankDuration=0,s.value.alwaysLock=r.always_lock,s.value.submitAnytime=r.submit_anytime,u.setTitle(r.title+" - "+u.getTitle);let z="";r.description&&(z=r.description),_(z)};return fe(async()=>{Array.isArray(l.params.contestId)?o.value=Number(l.params.contestId[0]):o.value=Number(l.params.contestId),o.value?(y.value=!0,await g()):_("")}),(d,r)=>{const z=Ae,m=ze,h=Ft,U=vt,k=wa,P=Ue,j=he,A=Te,D=O,I=we,L=Je,E=We,H=Ie,Z=Re("md-editor-v3"),Q=Ve,ee=It,te=nt;return V(),ae(pe,null,[t(Q,{loading:y.value},{default:a(()=>[t(H,null,{default:a(()=>[t(A,{span:8},{default:a(()=>[R("div",lr,[t(j,{class:"sh-card"},{default:a(()=>[t(P,{model:s.value,"label-width":"150px"},{default:a(()=>[t(m,{label:"标题"},{default:a(()=>[t(z,{modelValue:s.value.title,"onUpdate:modelValue":r[0]||(r[0]=F=>s.value.title=F),placeholder:"比赛标题"},null,8,["modelValue"])]),_:1}),t(m,{label:"通知"},{default:a(()=>[t(z,{modelValue:s.value.notification,"onUpdate:modelValue":r[1]||(r[1]=F=>s.value.notification=F),placeholder:"会更为醒目地提醒"},null,8,["modelValue"])]),_:1}),t(m,{label:"开启时间"},{default:a(()=>[t(h,{modelValue:s.value.openTime,"onUpdate:modelValue":r[2]||(r[2]=F=>s.value.openTime=F),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(m,{label:"提交限制"},{default:a(()=>[t(U,{modelValue:s.value.submitAnytime,"onUpdate:modelValue":r[3]||(r[3]=F=>s.value.submitAnytime=F)},{label:a(F=>[x(q(F.value?"结束仍能提交":"仅比赛期间提交"),1)]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"锁榜时长"},{default:a(()=>[t(k,{modelValue:s.value.lockRankDuration,"onUpdate:modelValue":r[4]||(r[4]=F=>s.value.lockRankDuration=F),min:0,format:ve(rt),"auto-width":""},null,8,["modelValue","format"])]),_:1}),t(m,{label:"自动解锁"},{default:a(()=>[t(U,{modelValue:s.value.alwaysLock,"onUpdate:modelValue":r[5]||(r[5]=F=>s.value.alwaysLock=F)},{label:a(F=>[x(q(F.value?"结束后仍锁榜":"结束后解锁"),1)]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"私有"},{default:a(()=>[t(U,{modelValue:s.value.private,"onUpdate:modelValue":r[6]||(r[6]=F=>s.value.private=F)},null,8,["modelValue"])]),_:1}),s.value.private?(V(),M(m,{key:0,label:"密码"},{default:a(()=>[t(z,{modelValue:s.value.password,"onUpdate:modelValue":r[7]||(r[7]=F=>s.value.password=F),type:"password",placeholder:"请输入访问密码，留空代表关闭密码访问"},null,8,["modelValue"])]),_:1})):le("",!0),s.value.private?(V(),M(m,{key:1,label:"成员"},{default:a(()=>[t(Ma,{modelValue:s.value.members,"onUpdate:modelValue":r[8]||(r[8]=F=>s.value.members=F)},null,8,["modelValue"])]),_:1})):le("",!0),t(m,{label:"问题"},{default:a(()=>[t(Ea,{modelValue:s.value.problems,"onUpdate:modelValue":r[9]||(r[9]=F=>s.value.problems=F)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(A,{span:4},{default:a(()=>[R("div",nr,[R("div",or,[o.value?(V(),M(I,{key:0},{default:a(()=>[t(D,{onClick:i,theme:"danger",loading:f.value},{default:a(()=>r[13]||(r[13]=[x("保存")])),_:1},8,["loading"])]),_:1})):(V(),M(I,{key:1},{default:a(()=>[t(D,{onClick:S,theme:"danger",loading:f.value},{default:a(()=>r[14]||(r[14]=[x("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(V(),M(E,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(L,{label:"创建时间"},{default:a(()=>{var F;return[x(q((F=v.value)==null?void 0:F.createTime),1)]}),_:1}),t(L,{label:"更新时间"},{default:a(()=>{var F;return[x(q((F=v.value)==null?void 0:F.updateTime),1)]}),_:1}),t(L,{label:"创建用户"},{default:a(()=>{var F;return[x(q((F=v.value)==null?void 0:F.ownerNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),R("div",sr,[r[15]||(r[15]=R("p",null,"公告",-1)),t(Z,{id:"contest-description-editor",modelValue:s.value.description,"onUpdate:modelValue":r[10]||(r[10]=F=>s.value.description=F),onSave:i,onOnUploadImg:b,previewTheme:"cyanosis"},null,8,["modelValue"]),t(Q,{loading:f.value,attach:"#contest-description-editor","z-index":1e5},null,8,["loading"])])]),_:1},8,["loading"]),t(te,{visible:C.value,"onUpdate:visible":r[12]||(r[12]=F=>C.value=F),onConfirm:w,header:$.value,"confirm-loading":T.value},{default:a(()=>[r[16]||(r[16]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(ee,{modelValue:p.value,"onUpdate:modelValue":r[11]||(r[11]=F=>p.value=F),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),ma=ce(rr,[["__scopeId","data-v-e76af3ed"]]);function Jt(e){const l={};return l.id=e.id,l.authorId=e.author_id,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.title=e.title,l.content=e.content,e.insert_time&&(l.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(l.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(l.updateTime=new Date(e.update_time).toLocaleString()),l.problemId=e.problem_id,l.problemTitle=e.problem_title,l.contestId=e.contest_id,l.contestTitle=e.contest_title,l.contestProblemIndex=e.contest_problem_index,l}function ur(e){const l={};return l.id=e.id,l.authorId=e.author_id,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.content="",e.content&&(l.content=e.content),e.insert_time&&(l.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(l.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(l.updateTime=new Date(e.update_time).toLocaleString()),l}function ir(e){return G({url:"/discuss?id="+e,method:"get"})}function dr(e){return G({url:"/discuss/edit?id="+e,method:"get"})}function cr(e,l,n,u,o,y,f){const C={};return e?C.only_problem="1":C.only_problem="0",l&&(C.contest_id=l),n&&(C.problem_id=n),u&&(C.title=u),o&&(C.username=o),y&&(C.page=y),f&&(C.page_size=f),G({url:`/discuss/list?${new URLSearchParams(C).toString()}`,method:"get"})}function mr(e){return e||(e=0),G({url:"/discuss/image/token?id="+e,method:"get"})}function pr(e,l){return e||(e=0),l||(l=0),G({url:"/discuss/comment/image/token?id="+e+"&comment_id="+l,method:"get"})}function fr(e,l,n){return G({url:"/discuss/comment/list?id="+e+"&page="+l+"&page_size="+n,method:"get"})}function vr(e){return G({url:"/discuss/create",method:"post",data:e})}function _r(e){return G({url:"/discuss/edit",method:"post",data:e})}function gr(e){return G({url:"/discuss/comment/create",method:"post",data:e})}function br(e){return G({url:"/discuss/comment/edit",method:"post",data:e})}const hr={style:{margin:"10px"}};function yr(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const wr=de({__name:"DiscussList",setup(e){const l=Se(),n=Xe(),{globalProperties:u}=_e();let o=!1,y=null,f=-1,C=c(!1);const v=c([]),s=[],$=[{title:"标题",colKey:"title",cell:(U,k)=>t(O,{variant:"text",onClick:()=>d(k.row.id)},{default:()=>[k.row.title]})},{title:"创建人",colKey:"authorNickname",width:"200",cell:(U,k)=>t(O,{variant:"text",onClick:async()=>await Bt(n,k.row.authorUsername)},{default:()=>[k.row.authorNickname]})},{title:"创建时间",colKey:"insertTime",width:"180"},{title:"更新时间",colKey:"updateTime",width:"180"}],p=c(!1);let T=1,w=50;const b=c({current:T,pageSize:w,defaultCurrent:T,defaultPageSize:w,total:0,pageSizeOptions:[50,100]}),S=c(),i=c({problemId:"",title:"",username:""}),_=U=>{U&&n.push({name:"problem-detail",params:{problemId:U}})},g=(U,k)=>{n.push({name:"contest-problem-detail",params:{contestId:U,problemIndex:k}})},d=U=>{if(U){if(f){n.push({name:"contest-discuss-detail",params:{contestId:f,discussId:U}});return}n.push({name:"discuss-detail",params:{discussId:U}})}},r=async()=>{await n.push({query:{...l.query,problem_id:i.value.problemId,title:i.value.title,username:i.value.username,page:1,page_size:b.value.defaultPageSize}})},z=async(U,k)=>{var P;p.value=!0;try{const{current:j,pageSize:A}=U,D=await cr(C.value,f,i.value.problemId,i.value.title,i.value.username,j,A);if(S.value=[],D.code===0){if(!D.data.has_auth){ke(u,"您目前没有权限查看讨论列表"),f?await n.push({name:"contest-detail",params:{contestId:f}}):await n.push({name:"discuss-list"});return}if(D.data.list){const I=D.data.list;for(let L=0;L<I.length;L++){const E=I[L],H=await Jt(E);(P=S.value)==null||P.push(H)}}b.value={...b.value,total:D.data.total_count}}else k&&N(u,D.code)}catch(j){console.error(j),N(u,Ge())}finally{p.value=!1}},m=async U=>{await n.push({query:{...l.query,page:U.current,page_size:U.pageSize}})},h=async()=>{await n.push({name:"discuss-create"})};return fe(async()=>{o=!0,y=$e(()=>l.query,U=>{if(!o)return;C.value=l.name==="discuss-list-problem",Array.isArray(l.params.contestId)?f=Number(l.params.contestId[0]):f=Number(l.params.contestId),v.value=s,f?v.value=v.value.concat([{title:"问题ID",colKey:"contestProblemIndex",width:"100",cell:(j,A)=>{let D;return A.row.contestProblemIndex?t(O,{variant:"text",onClick:()=>g(f,A.row.contestProblemIndex)},yr(D=at(A.row.contestProblemIndex))?D:{default:()=>[D]}):""}}]):v.value=v.value.concat([{title:"问题ID",colKey:"problemId",width:"100",cell:(j,A)=>A.row.problemId?t(O,{variant:"text",onClick:()=>_(A.row.problemId)},{default:()=>[A.row.problemId]}):""}]),v.value=v.value.concat($),i.value.problemId=U.problem_id||"",i.value.title=U.title||"",i.value.username=U.username||"";const k=parseInt(U.page)||b.value.defaultCurrent,P=parseInt(U.page_size)||b.value.defaultPageSize;T=k,w=P,b.value={...b.value,current:T,pageSize:w},z({current:T,pageSize:w},!0)},{immediate:!0})}),De(()=>{o=!1,y&&y()}),(U,k)=>{const P=Ee,j=he,A=Te,D=Ae,I=ze,L=O,E=Ue,H=we,Z=Ie;return V(),M(Z,null,{default:a(()=>[t(A,{span:9},{default:a(()=>[t(j,{style:{margin:"10px"}},{default:a(()=>[t(P,{data:S.value,columns:v.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:b.value,loading:p.value,"table-layout":"auto",onPageChange:m},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(A,{span:3},{default:a(()=>[R("div",hr,[t(j,{class:"sh-card"},{default:a(()=>[t(E,{model:i.value},{default:a(()=>[t(I,{label:"问题ID"},{default:a(()=>[t(D,{modelValue:i.value.problemId,"onUpdate:modelValue":k[0]||(k[0]=Q=>i.value.problemId=Q),placeholder:"请输入完整问题ID"},null,8,["modelValue"])]),_:1}),t(I,{label:"标题"},{default:a(()=>[t(D,{modelValue:i.value.title,"onUpdate:modelValue":k[1]||(k[1]=Q=>i.value.title=Q),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(I,{label:"创建人"},{default:a(()=>[t(D,{modelValue:i.value.username,"onUpdate:modelValue":k[2]||(k[2]=Q=>i.value.username=Q),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(I,null,{default:a(()=>[t(L,{theme:"primary",onClick:r},{default:a(()=>k[3]||(k[3]=[x("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(j,{class:"sh-card"},{default:a(()=>[t(H,null,{default:a(()=>[t(L,{onClick:h},{default:a(()=>k[4]||(k[4]=[x("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),$t=ce(wr,[["__scopeId","data-v-52d475b4"]]),kr={key:0,style:{margin:"20px"}},Sr={class:"dida-operation-container"},Cr={class:"dida-operation-container"},Ir={style:{margin:"10px"}},Pr={style:{margin:"10px"}},xr={style:{margin:"10px"},class:"dida-operation-container"},Tr={style:{margin:"12px"}},Vr={key:0,class:"dida-edit-container"},Dr=de({__name:"DiscussDetail",props:{discussId:{}},setup(e){const l=e;let n=Se();const{globalProperties:u}=_e();let o=!1,y=null;const f=Ze(),C=Fe();let v=c("");const s=c(0),$=c(!1),p=c(null),T=c(!1),w=c(!1),b=c(0),S=c("");let i=1,_=20;const g=c({current:1,pageSize:20,total:0,defaultPageSize:_,defaultCurrent:i,pageSizeOptions:[20,50]}),d=c([]),r=Be(()=>C.hasAuth(Le.ManageDiscuss)),z=Be(()=>C.hasAuth(Le.ManageDiscuss)||p.value&&C.getUserId==p.value.authorId),m=()=>{X.push({name:"discuss-edit",params:{discussId:s.value}})},h=()=>t("div",{class:"t-pagination__total"},[`共 ${g.value.total} 条回复`]),U=(I,L)=>{b.value=I,S.value=L;const E=document.getElementById("discuss-comment-editor");E&&E.scrollIntoView({behavior:"smooth"})},k=()=>{b.value=0,S.value="";const I=document.getElementById("discuss-comment-editor");I&&I.scrollIntoView({behavior:"smooth"})},P=async()=>{w.value=!0;try{let I;if(b.value){const L={id:b.value,discuss_id:s.value,content:S.value};if(I=await br(L),I.code!==0){N(u,I.code);return}Ke(u,"编辑成功"),b.value=0,S.value="",i===1?await A({current:1,pageSize:_},!0):await X.push({query:{current:1}});const E=document.getElementById("comment-divider");E&&E.scrollIntoView({behavior:"smooth"})}else{const L={discuss_id:s.value,content:S.value};if(I=await gr(L),I.code!==0){N(u,I.code);return}Ke(u,"编辑成功"),b.value=0,S.value="",i===1?await A({current:1,pageSize:_},!0):await X.push({query:{current:1}});const E=document.getElementById("comment-divider");E&&E.scrollIntoView({behavior:"smooth"})}}finally{w.value=!1}},j=async(I,L)=>{w.value=!0,await it(I,L,u,()=>pr(s.value,b.value)),w.value=!1},A=async(I,L)=>{var E;T.value=!0;try{const{current:H,pageSize:Z}=I,Q=await fr(s.value,H,Z);if(d.value=[],Q.code===0){const ee=Q.data.list;if(ee)for(let te=0;te<ee.length;te++){const F=ee[te],me=ur(F);(E=d.value)==null||E.push(me)}g.value={...g.value,total:Q.data.total_count}}else L&&N(u,Q.code)}catch(H){console.error(H),N(u,Ge())}finally{T.value=!1}},D=async I=>{await X.push({query:{...n.query,page:I.current,page_size:I.pageSize}})};return fe(async()=>{if(o=!0,s.value=Number(l.discussId),s.value||(Array.isArray(n.params.discussId)?s.value=Number(n.params.discussId[0]):s.value=Number(n.params.discussId)),!s.value){ge(u,"讨论不存在"),await X.push({name:"discuss"});return}$.value=!0;const I=await ir(s.value);if(I.code!==0){$.value=!1,N(u,I.code),await X.push({name:"discuss"});return}p.value=Jt(I.data.discuss),f.setTitle(p.value.title+" - "+f.getTitle),v.value=p.value.content,$.value=!1,y=$e(()=>n.query,L=>{if(!o)return;const E=parseInt(L.page)||g.value.defaultCurrent,H=parseInt(L.page_size)||g.value.defaultPageSize;i=E,_=H,g.value={...g.value,current:i,pageSize:_},A({current:i,pageSize:_},!0)},{immediate:!0})}),De(()=>{o=!1,y&&y()}),(I,L)=>{const E=Sa,H=ka,Z=Re("md-preview"),Q=he,ee=xl,te=we,F=O,me=Tl,ue=et,W=Re("md-editor-v3"),J=Ve,ne=Te,K=Je,B=We,ie=Ie;return V(),M(J,{loading:$.value},{default:a(()=>[t(ie,{class:"dida-main-content"},{default:a(()=>[t(ne,{span:8},{default:a(()=>{var oe,Ce,Y;return[(oe=p.value)!=null&&oe.problemTitle||(Ce=p.value)!=null&&Ce.contestTitle?(V(),ae("div",kr,[t(H,{"max-item-width":"300"},{default:a(()=>{var se,ye,be,xe,Oe;return[(se=p.value)!=null&&se.contestTitle?(V(),ae(pe,{key:0},[t(E,{to:{name:"contest-detail",params:{contestId:(ye=p.value)==null?void 0:ye.contestId}}},{default:a(()=>{var je;return[x(q((je=p.value)==null?void 0:je.contestTitle),1)]}),_:1},8,["to"]),(be=p.value)!=null&&be.contestProblemIndex?(V(),M(E,{key:0,to:{name:"contest-problem-detail",params:{problemIndex:(xe=p.value)==null?void 0:xe.contestProblemIndex}}},{default:a(()=>{var je,Ye;return[x(q(ve(at)((je=p.value)==null?void 0:je.contestProblemIndex))+" - "+q((Ye=p.value)==null?void 0:Ye.problemTitle),1)]}),_:1},8,["to"])):le("",!0)],64)):(V(),ae(pe,{key:1},[t(E,{to:{name:"discuss-list-problem"}},{default:a(()=>L[4]||(L[4]=[x(" 题目讨论")])),_:1}),t(E,{to:{name:"problem-detail",params:{problemId:(Oe=p.value)==null?void 0:Oe.problemId}}},{default:a(()=>{var je;return[x(q((je=p.value)==null?void 0:je.problemTitle),1)]}),_:1},8,["to"])],64))]}),_:1})])):le("",!0),t(Q,{style:{margin:"10px"},header:(Y=p.value)==null?void 0:Y.title,"header-bordered":!0},{default:a(()=>[t(Z,{"model-value":ve(v),previewTheme:"cyanosis"},null,8,["model-value"])]),_:1},8,["header"]),t(ee,{id:"comment-divider"}),(V(!0),ae(pe,null,Pe(d.value,(se,ye)=>(V(),M(Q,{key:ye,style:{margin:"10px"},"header-bordered":""},{header:a(()=>[R("div",Sr,[t(te,null,{default:a(()=>[R("span",null,q(se.authorNickname),1),R("span",null,q(se.insertTime),1)]),_:2},1024)]),R("div",Cr,[t(te,null,{default:a(()=>[r.value||ve(C).getUserId===se.authorId?(V(),M(F,{key:0,onClick:()=>{U(se.id,se.content)}},{default:a(()=>L[5]||(L[5]=[x(" 编辑 ")])),_:2},1032,["onClick"])):le("",!0)]),_:2},1024)])]),default:a(()=>[t(Z,{"model-value":se.content,previewTheme:"cyanosis"},null,8,["model-value"])]),_:2},1024))),128)),R("div",Ir,[t(me,{modelValue:g.value.current,"onUpdate:modelValue":L[0]||(L[0]=se=>g.value.current=se),"page-size":g.value.pageSize,"onUpdate:pageSize":L[1]||(L[1]=se=>g.value.pageSize=se),total:g.value.total,"page-size-options":g.value.pageSizeOptions,"show-page-size":!1,"total-content":h,onChange:D},null,8,["modelValue","page-size","total","page-size-options"])]),t(ee),R("div",Pr,[R("div",xr,[t(ue,{style:{margin:"10px"}},{default:a(()=>[x(q(b.value?"编辑回复":"发表回复"),1)]),_:1}),t(te,null,{default:a(()=>[t(F,{theme:"danger",onClick:k},{default:a(()=>L[6]||(L[6]=[x("清除")])),_:1}),t(F,{theme:"primary",onClick:P,loading:w.value},{default:a(()=>L[7]||(L[7]=[x("提交")])),_:1},8,["loading"])]),_:1})]),t(W,{id:"discuss-comment-editor",modelValue:S.value,"onUpdate:modelValue":L[2]||(L[2]=se=>S.value=se),previewTheme:"cyanosis",onSave:P,onOnUploadImg:j},null,8,["modelValue"]),t(J,{loading:w.value,attach:"#discuss-comment-editor","z-index":1e5},null,8,["loading"])])]}),_:1}),t(ne,{span:4},{default:a(()=>[R("div",Tr,[z.value?(V(),ae("div",Vr,[t(F,{onClick:m},{default:a(()=>L[8]||(L[8]=[x("编辑")])),_:1})])):le("",!0),t(B,{layout:"vertical",bordered:!0},{default:a(()=>[t(K,{label:"创建时间"},{default:a(()=>{var oe;return[x(q((oe=p.value)==null?void 0:oe.insertTime),1)]}),_:1}),t(K,{label:"编辑时间"},{default:a(()=>{var oe;return[x(q((oe=p.value)==null?void 0:oe.modifyTime),1)]}),_:1}),t(K,{label:"更新时间"},{default:a(()=>{var oe;return[x(q((oe=p.value)==null?void 0:oe.updateTime),1)]}),_:1}),t(K,{label:"创建用户"},{default:a(()=>[t(F,{variant:"text",onClick:L[3]||(L[3]=async()=>{var oe;return await ve(Bt)(ve(X),(oe=p.value)==null?void 0:oe.authorUsername)})},{default:a(()=>{var oe;return[x(q((oe=p.value)==null?void 0:oe.authorNickname),1)]}),_:1})]),_:1}),t(K,{label:"标签"})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Ut=ce(Dr,[["__scopeId","data-v-acfa7b91"]]),jr={style:{margin:"10px"}},Lr={style:{margin:"12px"}},$r={class:"dida-edit-container"},Ur={class:"dida-description-editor"},zr=de({__name:"DiscussEdit",setup(e){let l=Se();const{globalProperties:n}=_e();let u=null;const o=c(0),y=c(!1),f=c(!1),C=c(null),v=c({title:"",problemId:"",content:""}),s=()=>{X.push({name:"discuss-detail",params:{discussId:o.value}})};async function $(S,i){f.value=!0,await it(S,i,n,()=>mr(o.value)),f.value=!1}const p=async()=>{f.value=!0;try{const S={title:v.value.title,content:v.value.content,problem_id:v.value.problemId},i=await vr(S);if(f.value=!0,i.code!==0){N(n,i.code);return}const _=i.data;await X.push({name:"discuss-detail",params:{discussId:_}}),Ke(n,"创建成功")}finally{f.value=!1}},T=async()=>{f.value=!0;try{const S={id:o.value,title:v.value.title,content:v.value.content,problem_id:v.value.problemId},i=await _r(S);if(f.value=!0,i.code!==0){N(n,i.code);return}C.value&&i.data.modify_time!=null&&(C.value.modifyTime=new Date(i.data.modify_time).toLocaleString()),i.data.content!=null&&(v.value.content=i.data.content),Ke(n,"保存成功")}finally{f.value=!1}},w=async()=>{o.value?await T():await p()},b=async()=>{const S=await dr(o.value);if(S.code!==0){N(n,S.code),await X.push({name:"discuss"});return}const i=S.data.discuss;C.value=Jt(i),v.value.title=i.title,v.value.content=i.content,v.value.problemId=i.problem_id,y.value=!1};return fe(async()=>{u=$e(()=>l.params,async()=>{Array.isArray(l.params.discussId)?o.value=Number(l.params.discussId[0]):o.value=Number(l.params.discussId),o.value?(y.value=!0,await b()):(v.value.title="",v.value.problemId="",v.value.content="")},{immediate:!0})}),De(()=>{u&&(u(),u=null)}),(S,i)=>{const _=Ae,g=ze,d=Ue,r=he,z=Te,m=O,h=we,U=Je,k=We,P=Ie,j=Re("md-editor-v3"),A=Ve;return V(),M(A,{loading:y.value},{default:a(()=>[t(P,null,{default:a(()=>[t(z,{span:8},{default:a(()=>[R("div",jr,[t(r,{class:"sh-form-card"},{default:a(()=>[t(d,{model:v.value},{default:a(()=>[t(g,{label:"标题"},{default:a(()=>[t(_,{modelValue:v.value.title,"onUpdate:modelValue":i[0]||(i[0]=D=>v.value.title=D),placeholder:"讨论标题"},null,8,["modelValue"])]),_:1}),t(g,{label:"关联题目"},{default:a(()=>[t(_,{modelValue:v.value.problemId,"onUpdate:modelValue":i[1]||(i[1]=D=>v.value.problemId=D),placeholder:"讨论题目"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(z,{span:4},{default:a(()=>[R("div",Lr,[R("div",$r,[o.value?(V(),M(h,{key:0},{default:a(()=>[t(m,{onClick:T,theme:"danger",loading:f.value},{default:a(()=>i[3]||(i[3]=[x("保存")])),_:1},8,["loading"]),t(m,{onClick:s},{default:a(()=>i[4]||(i[4]=[x("查看")])),_:1})]),_:1})):(V(),M(h,{key:1},{default:a(()=>[t(m,{onClick:p,theme:"danger",loading:f.value},{default:a(()=>i[5]||(i[5]=[x("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(V(),M(k,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(U,{label:"创建时间"},{default:a(()=>{var D;return[x(q((D=C.value)==null?void 0:D.insertTime),1)]}),_:1}),t(U,{label:"更新时间"},{default:a(()=>{var D;return[x(q((D=C.value)==null?void 0:D.modifyTime),1)]}),_:1}),t(U,{label:"创建用户"},{default:a(()=>{var D;return[x(q((D=C.value)==null?void 0:D.authorNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),R("div",Ur,[t(j,{id:"discuss-editor",modelValue:v.value.content,"onUpdate:modelValue":i[2]||(i[2]=D=>v.value.content=D),onSave:w,onOnUploadImg:$,previewTheme:"cyanosis"},null,8,["modelValue"]),t(A,{loading:f.value,attach:"#discuss-editor","z-index":1e5},null,8,["loading"])])]),_:1},8,["loading"])}}}),pa=ce(zr,[["__scopeId","data-v-164ac069"]]);function Ar(e,l){return G({url:"/rank/ac/all?page="+e+"&page_size="+l,method:"get"})}function Rr(e,l){return G({url:"/rank/ac/problem?page="+e+"&page_size="+l,method:"get"})}function Er(e,l){return G({url:"/rank/ac/problem/today?page="+e+"&page_size="+l,method:"get"})}function Mr(e,l){return G({url:"/rank/ac/problem/day7?page="+e+"&page_size="+l,method:"get"})}function qr(e,l){return G({url:"/rank/ac/problem/day30?page="+e+"&page_size="+l,method:"get"})}function Kr(e,l){return G({url:"/rank/ac/problem/year?page="+e+"&page_size="+l,method:"get"})}const Fr={style:{margin:"10px"}};function zt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const Nr=de({__name:"RankUser",props:{type:{}},setup(e){const l=Se(),n=Xe(),{globalProperties:u}=_e();let o=null;const y=e,f=c(""),C=c(""),v={all:{header:"统计所有用户在本站的提交记录",content:"优先以AC记录数量排序，如果相同则提交所用次数较少的优先，如果仍相同，注册较早的用户靠前"},problem:{header:"统计所有用户在本站的提交记录",content:"以题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-today":{header:"统计所有用户今日在本站的提交记录",content:"以今日题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-day7":{header:"统计所有用户最近7日在本站的提交记录",content:"以7日题目记录数量排序（从7日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-day30":{header:"统计所有用户最近30日在本站的提交记录",content:"以30日题目记录数量排序（从30日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-year":{header:"统计所有用户最近1年在本站的提交记录",content:"以最近1年题目记录数量排序（从365日前的0点开始计算），如果相同，注册较早的用户靠前"}},s=c([]),$=[{title:"序号",colKey:"index"},{title:"用户名",colKey:"username",cell:(h,U)=>t(O,{variant:"dashed",onClick:()=>g(U.row.username)},{default:()=>[U.row.username]})},{title:"昵称",colKey:"nickname"},{title:"Slogan",colKey:"slogan"}],p=[{title:"题目数量",colKey:"problem_count",cell:(h,U)=>{let k=0;return U.row.problem_count&&(k=U.row.problem_count),t(O,{variant:"dashed",onClick:()=>d(U.row.username)},zt(k)?k:{default:()=>[k]})}}],T=[{title:"正确",colKey:"accept",cell:(h,U)=>{let k=0;return U.row.accept&&(k=U.row.accept),t(O,{variant:"dashed",onClick:()=>d(U.row.username)},zt(k)?k:{default:()=>[k]})}},{title:"提交",colKey:"attempt",cell:(h,U)=>{let k=0;return U.row.attempt&&(k=U.row.attempt),t(O,{variant:"dashed",onClick:()=>r(U.row.username)},zt(k)?k:{default:()=>[k]})}}],w=c(!1);let b=1,S=50;const i=c({current:b,pageSize:S,defaultCurrent:b,defaultPageSize:S,total:0,pageSizeOptions:[50]}),_=c(),g=h=>{n.push({name:"user",params:{username:h}})},d=h=>{n.push({name:"judge-list",query:{username:h,status:He.Accept}})},r=h=>{n.push({name:"judge-list",query:{username:h}})},z=async(h,U)=>{w.value=!0;try{_.value=[];const{current:k,pageSize:P}=h;let j=null;switch(y.type){case"problem":j=await Rr(k,P);break;case"problem-today":j=await Er(k,P);break;case"problem-day7":j=await Mr(k,P);break;case"problem-day30":j=await qr(k,P);break;case"problem-year":j=await Kr(k,P);break;default:j=await Ar(k,P);break}if(j.code===0){const A=j.data.list;if(!A||A.length<=0){i.value={...i.value,total:0},ke(u,"未找到记录");return}_.value=[];const D=i.value.pageSize*(i.value.current-1);let I=1;A.forEach(L=>{var H;const E=L;E.index=D+I++,(H=_.value)==null||H.push(E)}),i.value={...i.value,total:j.data.total_count}}else U&&N(u,j.code)}catch(k){console.error(k),N(u,Ge())}finally{w.value=!1}},m=async h=>{await n.push({query:{...l.query,page:h.current,page_size:h.pageSize}})};return fe(async()=>{w.value=!0,o=$e(()=>l.query,h=>{switch(y.type&&v[y.type]?(f.value=v[y.type].header,C.value=v[y.type].content):(f.value=v.all.header,C.value=v.all.content),y.type){case"all":s.value=$.concat(T);break;default:s.value=$.concat(p);break}const U=parseInt(h.page)||i.value.defaultCurrent,k=parseInt(h.page_size)||i.value.defaultPageSize;b=U,S=k,i.value={...i.value,current:b,pageSize:S},z({current:b,pageSize:S},!0)},{immediate:!0})}),De(()=>{o&&o()}),(h,U)=>{const k=Ee,P=he,j=Te,A=Ie;return V(),M(A,null,{default:a(()=>[t(j,{span:9},{default:a(()=>[t(P,{style:{margin:"10px"}},{default:a(()=>[t(k,{data:_.value,columns:s.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:i.value,loading:w.value,"table-layout":"auto",onPageChange:m},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(j,{span:3},{default:a(()=>[R("div",Fr,[t(P,{class:"sh-card",header:f.value,"header-bordered":!0},{default:a(()=>[x(q(C.value),1)]),_:1},8,["header"])])]),_:1})]),_:1})}}}),st=ce(Nr,[["__scopeId","data-v-13682529"]]),Or={style:{display:"flex","align-items":"center"}},Gr={style:{color:"#409eff","margin-right":"20px"}},Hr={class:"dida-login-footer"},Br=de({__name:"UserForget",setup(e){const{globalProperties:l}=_e(),n=Fe(),u=c(!1),o=c(!1),y=c(!1),f=c("发送验证码");let C=null,v=-1;const s=c(!1),$=c(null),p=c(""),T=c({username:"",emailKey:"",password:"",confirmPassword:""}),b=c({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:z=>new Promise(m=>{const h=setTimeout(()=>{m(T.value.password===z),clearTimeout(h)})}),message:"两次密码不一致"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),S=()=>{ke(l,"重置成功")},i=async z=>{if(!y.value){u.value=!0,o.value=!0;try{const m=await Hn(z,T.value.username);m.code===0?(ke(l,"验证码发送成功"),p.value=m.data,o.value=!1,y.value=!0,C=new Date,f.value="60秒后重发",v=setInterval(()=>{const U=Math.floor((new Date().getTime()-(C==null?void 0:C.getTime()))/1e3);U>60?(f.value="发送验证码",y.value=!1,clearInterval(v)):f.value=`${60-U}秒后重发`},1e3)):N(l,m.code)}catch(m){console.error("Send email key error",m),ge(l,"发送验证码失败")}finally{u.value=!1}}},_=async()=>{var U;if(s.value=!0,y.value||o.value)return;await mt();const z=document.getElementById("cf-confirm-div");z&&z.remove();const m=document.createElement("div");m.id="cf-confirm-div",m.setAttribute("data-theme","light"),(U=$.value)==null||U.appendChild(m);const h=window;h.turnstile.ready(function(){h.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(k){s.value=!1,await i(k)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},g=c(()=>t(O,{onClick:_,disabled:y.value,loading:o.value,style:"width:120px"},{default:()=>[f.value]})),d=async()=>{u.value=!0;try{const z=await Bn(T.value.username,T.value.password,T.value.emailKey);z.code===0?(ke(l,"密码修改成功"),l.$router.push({name:"login"})):N(l,z.code)}catch(z){console.error("Modify password error",z),ge(l,"修改密码失败")}finally{u.value=!1}},r=async({validateResult:z,firstError:m,e:h})=>{if(!u.value){if(h.preventDefault(),z!==!0){ge(l,m);return}p.value?await d():await _()}};return fe(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),De(()=>{}),(z,m)=>{const h=Ct,U=Ae,k=ze,P=ya,j=O,A=Ue,D=lt,I=he,L=nt;return V(),ae(pe,null,[t(I,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(h,{"max-line":1},{default:a(()=>m[6]||(m[6]=[R("span",null,"如果您未绑定邮箱或忘记用户名，可联系管理员寻求帮助",-1),R("span",null,"管理员邮箱：BoilTask@qq.com",-1)])),_:1}),t(h,{style:{"margin-top":"10px"}},{default:a(()=>m[7]||(m[7]=[R("p",null,"支持原acm.hpu.edu.cn、CodeOJ的用户直接登录",-1),R("p",null,"原DMOJ、hpuoj.com的用户，请先重置密码",-1),R("p",null,"可尝试学号/昵称等作为用户名登录，成功后有机会合并账户或修改用户名",-1)])),_:1}),t(A,{ref:"form",rules:b.value,data:T.value,colon:!0,onReset:S,onSubmit:r,class:"yj-login-form"},{default:a(()=>[t(k,{name:"username",label:"用户名"},{default:a(()=>[t(U,{modelValue:T.value.username,"onUpdate:modelValue":m[0]||(m[0]=E=>T.value.username=E),clearable:"",placeholder:"请输入完整用户名"},null,8,["modelValue"])]),_:1}),p.value?(V(),ae(pe,{key:0},[t(k,{name:"email",label:"发送邮箱"},{default:a(()=>[t(P,{append:g.value},{default:a(()=>[R("div",Or,[R("span",Gr,q(p.value),1)])]),_:1},8,["append"])]),_:1}),t(k,{name:"emailKey",label:"验证码"},{default:a(()=>[t(U,{modelValue:T.value.emailKey,"onUpdate:modelValue":m[1]||(m[1]=E=>T.value.emailKey=E),clearable:"",placeholder:"请输入收到的验证码"},null,8,["modelValue"])]),_:1}),t(k,{name:"password",label:"新密码"},{default:a(()=>[t(U,{modelValue:T.value.password,"onUpdate:modelValue":m[2]||(m[2]=E=>T.value.password=E),type:"password",clearable:"",placeholder:"新密码"},null,8,["modelValue"])]),_:1}),t(k,{name:"confirmPassword",label:"确认密码"},{default:a(()=>[t(U,{modelValue:T.value.confirmPassword,"onUpdate:modelValue":m[3]||(m[3]=E=>T.value.confirmPassword=E),type:"password",clearable:"",placeholder:"请重复输入密码"},null,8,["modelValue"])]),_:1})],64)):le("",!0),p.value?(V(),M(k,{key:1},{default:a(()=>[t(j,{theme:"primary",type:"submit",block:"",loading:u.value},{default:a(()=>m[8]||(m[8]=[x("修改密码")])),_:1},8,["loading"])]),_:1})):(V(),M(k,{key:2},{default:a(()=>[t(j,{theme:"primary",type:"submit",block:"",loading:u.value},{default:a(()=>m[9]||(m[9]=[x("重置密码")])),_:1},8,["loading"])]),_:1}))]),_:1},8,["rules","data"]),R("div",Hr,[t(D,{onClick:m[4]||(m[4]=()=>{ve(l).$router.push({name:"login"})})},{default:a(()=>m[10]||(m[10]=[x("返回登陆 ")])),_:1})])]),_:1}),t(L,{visible:s.value,"onUpdate:visible":m[5]||(m[5]=E=>s.value=E),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:a(()=>[R("div",{ref_key:"dialogContainer",ref:$,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),Wr=ce(Br,[["__scopeId","data-v-e960b193"]]),Jr={class:"judger-status-panel"},Yr={style:{"text-align":"center","margin-bottom":"20px"}},Xr={class:"judger-status-panel"};function Zr(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const Qr=de({__name:"SystemStatus",setup(e){const{globalProperties:l}=_e(),n=c([]),u=c([]),o=c(!1),y=c(0),f=c(0),C=c(null),v=c(0),s=c(0),$=c(0);let p=-1,T;const w=i=>{let _="失效",g="danger";const d=new Date,r=new Date(i.updateTime);return d.getTime()-r.getTime()>3e4?(_="离线",g="default"):i.cpuUsage>90?(_="CPU过高",g="warning"):i.memPercent>90?(_="内存过高",g="warning"):(_="在线",g="success"),t(we,null,{default:()=>[t("span",null,[i.key,x(" - "),i.name]),t("span",null,[i.updateTime]),t(et,{theme:g,size:"small"},Zr(_)?_:{default:()=>[_]})]})},b=async()=>{const i={};for(let k=0;k<n.value.length;k++){const P=n.value[k];i[P.key]={...P}}const _={};for(let k=0;k<u.value.length;k++){const P=u.value[k];_[P.key]={...P}}const g=[],d=[],r=await Ql();if(r.code!==0){N(l,r.code);return}const z=r.data.web,m={key:"didaoj"};z.name?m.name=z.name:m.name="-",z.update_time?m.updateTime=new Date(z.update_time).toLocaleString():m.updateTime="-",z.cpu_usage?m.cpuUsage=Number(z.cpu_usage):m.cpuUsage=0,z.mem_usage?m.memUsage=z.mem_usage/(1024*1024*1024):m.memUsage=0,z.mem_total?m.memTotal=z.mem_total/(1024*1024*1024):m.memTotal=0,m.memTotal>0?m.memPercent=Math.round(m.memUsage/m.memTotal*1e4)/100:m.memPercent=0,m.avgMessage=z.avg_message;const h=i[m.key];h?(m.cpuUsageFrom=h.cpuUsage,m.memPercentFrom=h.memPercent,m.memUsageFrom=h.memUsage,m.memTotalFrom=h.memTotal):(m.cpuUsageFrom=0,m.memPercentFrom=0,m.memUsageFrom=0,m.memTotalFrom=0),g.push(m),n.value=g;const U=r.data.judger;for(let k=0;k<U.length;k++){const P=U[k],j={key:P.key,name:P.name};P.name?j.name=P.name:j.name="-",P.update_time?j.updateTime=new Date(P.update_time).toLocaleString():j.updateTime="-",P.cpu_usage?j.cpuUsage=Number(P.cpu_usage):j.cpuUsage=0,P.mem_usage?j.memUsage=P.mem_usage/(1024*1024*1024):j.memUsage=0,P.mem_total?j.memTotal=P.mem_total/(1024*1024*1024):j.memTotal=0,j.memTotal>0?j.memPercent=Math.round(j.memUsage/j.memTotal*1e4)/100:j.memPercent=0,j.avgMessage=P.avg_message,_[P.key]?(j.cpuUsageFrom=_[P.key].cpuUsage,j.memPercentFrom=_[P.key].memPercent,j.memUsageFrom=_[P.key].memUsage,j.memTotalFrom=_[P.key].memTotal):(j.cpuUsageFrom=0,j.memPercentFrom=0,j.memUsageFrom=0,j.memTotalFrom=0),d.push(j)}u.value=d,y.value=f.value,f.value=r.data.judge_job,$.value=s.value,C.value?s.value=Number(((f.value-v.value)/((new Date().getTime()-C.value.getTime())/1e3)*60).toFixed(2)):(C.value=new Date,v.value=f.value,s.value=0,$.value=0),f.value?(clearTimeout(p),p=-1):p<0&&(p=setTimeout(()=>{C.value=null,v.value=0},1e4))},S=async()=>{await b(),o.value=!1};return fe(async()=>{u.value=[],n.value=[],o.value=!0,await S(),T=setInterval(()=>{S()},5e3)}),De(()=>{clearInterval(T)}),(i,_)=>{const g=Vl,d=we,r=he,z=Ve;return V(),M(z,{loading:o.value},{default:a(()=>[t(r,{title:"接口状态",class:"judger-status"},{default:a(()=>[R("div",Jr,[(V(!0),ae(pe,null,Pe(n.value,m=>(V(),M(r,{key:m.key,header:()=>w(m),class:"judge-status-judger"},{footer:a(()=>[R("span",null," 负载信息："+q(m.avgMessage),1)]),default:a(()=>[t(d,{class:"judge-status-judger"},{default:a(()=>[t(g,{title:"CPU使用率",value:m.cpuUsage,animation:{valueFrom:m.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(g,{title:"内存使用率",value:m.memPercent,animation:{valueFrom:m.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(g,{title:"内存使用量",animation:{valueFrom:m.memUsageFrom,duration:2e3},"animation-start":!0,value:m.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(g,{title:"内存总量",value:m.memTotal,animation:{valueFrom:m.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1}),t(r,{title:"判题机状态",class:"judger-status"},{default:a(()=>[R("div",Yr,[t(d,null,{default:a(()=>[t(g,{title:"未完成的评测数量",value:f.value,animation:{valueFrom:y.value,duration:4e3},"animation-start":!0},null,8,["value","animation"]),C.value?(V(),M(g,{key:0,title:"评测数量趋势",value:s.value,animation:{valueFrom:$.value,duration:4e3},"animation-start":!0,unit:"/分钟"},null,8,["value","animation"])):(V(),M(g,{key:1,title:"评测数量趋势",format:()=>"样本较少"}))]),_:1})]),R("div",Xr,[(V(!0),ae(pe,null,Pe(u.value,m=>(V(),M(r,{key:m.key,header:()=>w(m),class:"judge-status-judger"},{footer:a(()=>[R("span",null," 负载信息："+q(m.avgMessage),1)]),default:a(()=>[t(d,{class:"judge-status-judger"},{default:a(()=>[t(g,{title:"CPU使用率",value:m.cpuUsage,animation:{valueFrom:m.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(g,{title:"内存使用率",value:m.memPercent,animation:{valueFrom:m.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(g,{title:"内存使用量",animation:{valueFrom:m.memUsageFrom,duration:2e3},"animation-start":!0,value:m.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(g,{title:"内存总量",value:m.memTotal,animation:{valueFrom:m.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1})]),_:1},8,["loading"])}}}),eu=ce(Qr,[["__scopeId","data-v-fd11fd70"]]),tu=de({__name:"ManageJudge",setup(e){const{globalProperties:l}=_e(),n=c(!1),u=c(!1),o=c({problemId:"",language:void 0,status:void 0}),y=c(!1),f=c([]);f.value=Nt();const C=c([]);C.value=Da();const v=async()=>{n.value=!0;try{const p=await dn();if(p.code!==0){N(l,p.code);return}ke(l,"重判成功"),await X.push({name:"judge-list"})}catch(p){console.error(p),N(l,"重判失败")}finally{n.value=!1}},s=async()=>{if(!o.value.problemId&&!o.value.language&&!o.value.status){N(l,"请输入问题Id");return}y.value=!0;try{const p=await cn(o.value.problemId,o.value.language,o.value.status);if(p.code!==0){N(l,p.code);return}ke(l,"重判成功"),await X.push({name:"judge-list",query:{problem_id:o.value.problemId,language:o.value.language}})}catch(p){console.error(p),N(l,"重判失败")}finally{y.value=!1}},$=async()=>{u.value=!0;try{const p=await mn();if(p.code!==0){N(l,p.code);return}ke(l,"重判成功"),await X.push({name:"judge-list"})}catch(p){console.error(p),N(l,"重判失败")}finally{u.value=!1}};return(p,T)=>{const w=O,b=he,S=Ae,i=ze,_=Kt,g=ft,d=we,r=Ue;return V(),ae(pe,null,[t(b,{class:"yj-manage-card",title:"重判最近提交"},{default:a(()=>[t(w,{onClick:v,loading:n.value},{default:a(()=>T[3]||(T[3]=[x("重判")])),_:1},8,["loading"])]),_:1}),t(b,{class:"yj-manage-card",title:"重判指定记录"},{default:a(()=>[t(r,{layout:"inline",onSubmit:s},{default:a(()=>[t(i,{label:"题号"},{default:a(()=>[t(S,{modelValue:o.value.problemId,"onUpdate:modelValue":T[0]||(T[0]=z=>o.value.problemId=z),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(i,{label:"语言"},{default:a(()=>[t(g,{modelValue:o.value.language,"onUpdate:modelValue":T[1]||(T[1]=z=>o.value.language=z),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:a(()=>[(V(!0),ae(pe,null,Pe(f.value,z=>(V(),M(_,{key:z.value,value:z.value,label:z.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"状态"},{default:a(()=>[t(g,{modelValue:o.value.status,"onUpdate:modelValue":T[2]||(T[2]=z=>o.value.status=z),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:a(()=>[(V(!0),ae(pe,null,Pe(C.value,z=>(V(),M(_,{key:z.value,value:z.value,label:z.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(i,null,{default:a(()=>[t(d,null,{default:a(()=>[t(w,{theme:"primary",type:"submit",loading:y.value},{default:a(()=>T[4]||(T[4]=[x("重判")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(b,{class:"yj-manage-card",title:"重判所有"},{default:a(()=>[t(w,{onClick:$,theme:"danger",loading:u.value},{default:a(()=>T[5]||(T[5]=[x("重判")])),_:1},8,["loading"])]),_:1})],64)}}}),au=ce(tu,[["__scopeId","data-v-6a706c72"]]),lu=de({__name:"ManageWeb",setup(e){const{globalProperties:l}=_e(),n=c({theme:"",content:""}),u=c({title:"",content:""}),o=c(!1),y=c(!1),f=c(!1);async function C(T,w){f.value=!0,await it(T,w,l,en),f.value=!1}const v=async()=>{y.value=!0;try{const T=await tn(n.value.theme,n.value.content);if(T.code!==0){N(l,T.code);return}ke(l,"保存成功")}catch(T){console.error(T),N(l,"保存失败")}finally{y.value=!1}},s=async()=>{f.value=!0;try{const T=u.value.content,w=await an(u.value.title,T);if(w.code!==0){N(l,w.code);return}u.value.content=w.data.content,ke(l,"保存成功")}catch(T){console.error(T),ge(l,"保存失败")}finally{f.value=!1}},$=async()=>{n.value=await xa()},p=async()=>{try{u.value=await Ta()}catch{ge(l,"加载公告失败"),u.value={title:"",content:""}}};return fe(async()=>{o.value=!0;try{await $(),await p()}catch{ge(l,"加载数据失败")}o.value=!1}),(T,w)=>{const b=ft,S=ze,i=Ae,_=O,g=we,d=Ue,r=he,z=Re("md-editor-v3"),m=Ve;return V(),M(m,{loading:o.value},{default:a(()=>[t(r,{class:"yj-manage-card",title:"站点通知"},{default:a(()=>[t(d,{onSubmit:v},{default:a(()=>[t(S,{label:"主题"},{default:a(()=>[t(b,{modelValue:n.value.theme,"onUpdate:modelValue":w[0]||(w[0]=h=>n.value.theme=h),options:[{label:"success",value:"success"},{label:"info",value:"info"},{label:"warning",value:"warning"},{label:"error",value:"error"}],placeholder:"请选择主题"},null,8,["modelValue"])]),_:1}),t(S,{label:"内容"},{default:a(()=>[t(i,{modelValue:n.value.content,"onUpdate:modelValue":w[1]||(w[1]=h=>n.value.content=h),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),t(S,null,{default:a(()=>[t(g,null,{default:a(()=>[t(_,{theme:"primary",type:"submit",loading:y.value},{default:a(()=>w[4]||(w[4]=[x("保存")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(r,{class:"yj-manage-card",title:"首页公告"},{actions:a(()=>[t(_,{theme:"primary",loading:f.value,onClick:s},{default:a(()=>w[5]||(w[5]=[x("保存")])),_:1},8,["loading"])]),default:a(()=>[t(d,{onSubmit:s},{default:a(()=>[t(S,{label:"标题"},{default:a(()=>[t(i,{modelValue:u.value.title,"onUpdate:modelValue":w[2]||(w[2]=h=>u.value.title=h),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1}),t(m,{loading:f.value},{default:a(()=>[t(z,{modelValue:u.value.content,"onUpdate:modelValue":w[3]||(w[3]=h=>u.value.content=h),onSave:s,onOnUploadImg:C,previewTheme:"cyanosis",class:"dida-description-editor"},null,8,["modelValue"])]),_:1},8,["loading"])]),_:1})]),_:1},8,["loading"])}}}),nu=ce(lu,[["__scopeId","data-v-4d343ab4"]]),Ka=[{name:"problem-list",tab:"problem",sidebar:"problem-list",path:"",title:"问题列表",icon:"list",component:fo},{name:"problem-detail",tab:"problem",sidebar:"problem-list",path:":problemId+",title:"问题详情",icon:"list",component:Lt},{name:"problem-daily-list",tab:"problem",sidebar:"problem-daily-list",path:"daily",title:"每日一题",icon:"list",component:No},{name:"problem-daily-detail",tab:"problem",sidebar:"problem-daily-list",path:"daily/:dailyId+",title:"问题详情",icon:"list",component:Lt},{name:"problem-recommend",tab:"problem",sidebar:"problem-recommend",path:"recommend/:problemId*",title:"问题推荐",icon:"cpu",needLogin:!0,component:Xo},{name:"problem-collection-list",tab:"problem",sidebar:"problem-collection-list",path:"collection",title:"题目集合",icon:"list",disableTabPath:!0,component:hs},{name:"collection-detail",tab:"collection-detail-tab",sidebar:"collection-detail",path:":collectionId+",title:"题集详情",icon:"cpu",component:Cs},{name:"collection-rank",tab:"collection-detail-tab",sidebar:"collection-rank",path:":collectionId+/rank",title:"题集排名",icon:"list",component:Is},{name:"collection-edit",tab:"collection-detail-tab",sidebar:"collection-edit",disableSidebar:!0,needLogin:!0,path:":collectionId+/edit",title:"题集编辑",icon:"list",component:oa},{name:"collection-create",tab:"collection-detail-tab",sidebar:"collection-create",needLogin:!0,disableSidebar:!0,path:"create",title:"新建题集",icon:"list",component:oa},{name:"judge-list",tab:"judge",sidebar:"judge-list",path:"",title:"评测列表",icon:"list",component:ra},{name:"judge-detail",tab:"judge",sidebar:"judge-list",path:":judgeId+",title:"评测详情",icon:"cpu",component:ia},{name:"contest-list",tab:"contest",sidebar:"contest-list",path:"",title:"比赛列表",icon:"list",component:da},{name:"contest-recent",tab:"contest",sidebar:"contest-recent",path:"recent",title:"近期比赛",icon:"list",component:da},{name:"contest-create",tab:"contest",sidebar:"contest-create",disableSidebar:!0,needLogin:!0,path:"create",title:"新建比赛",icon:"list",component:ma},{name:"contest-edit",tab:"contest-detail-tab",sidebar:"contest-edit",disableSidebar:!0,needLogin:!0,path:":contestId+/edit",title:"比赛编辑",icon:"list",component:ma},{name:"contest-detail",tab:"contest-detail-tab",sidebar:"contest-detail",path:":contestId+",title:"比赛详情",icon:"cpu",component:Ys},{name:"contest-problem-detail",tab:"contest-detail-tab",sidebar:"contest-problem-detail",path:":contestId+/problem/:problemIndex+",title:"问题详情",icon:"cpu",disableSidebar:!0,component:Lt},{name:"contest-judge",tab:"contest-detail-tab",sidebar:"contest-judge",path:":contestId+/judge",title:"评测列表",icon:"list",component:ra},{name:"contest-judge-detail",tab:"contest-detail-tab",sidebar:"contest-judge-detail",path:":contestId+/judge/:judgeId+",title:"评测详情",icon:"cpu",component:ia,disableSidebar:!0},{name:"contest-rank",tab:"contest-detail-tab",sidebar:"contest-rank",path:":contestId+/rank",title:"比赛排名",icon:"list",component:ar},{name:"contest-discuss",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss",title:"比赛讨论",icon:"list",component:$t},{name:"contest-discuss-detail",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss/:discussId+",title:"讨论详情",icon:"list",component:Ut},{name:"discuss-list",tab:"discuss",sidebar:"discuss-list",path:"",title:"讨论列表",icon:"list",component:$t},{name:"discuss-create",tab:"discuss",sidebar:"discuss-create",disableSidebar:!0,needLogin:!0,path:"create",title:"新建讨论",icon:"list",component:pa},{name:"discuss-edit",tab:"discuss-detail-tab",sidebar:"discuss-edit",disableSidebar:!0,needLogin:!0,path:":discussId+/edit",title:"编辑讨论",icon:"list",component:pa},{name:"discuss-list-problem",tab:"discuss",sidebar:"discuss-list-problem",path:"problem",title:"题目讨论",icon:"list",component:$t},{name:"discuss-detail",tab:"discuss",sidebar:"discuss-list",path:":discussId+",title:"讨论详情",icon:"list",component:Ut},{name:"rank-ac-all",tab:"rank",sidebar:"rank-ac-all",path:"ac",title:"AC排名",icon:"base-station",props:{type:"all"},component:st},{name:"rank-ac-problem",tab:"rank",sidebar:"rank-ac-problem",path:"ac/problem",title:"题量排名",icon:"base-station",props:{type:"problem"},component:st},{name:"rank-ac-problem-today",tab:"rank",sidebar:"rank-ac-problem-today",path:"ac/problem/today",title:"今日题量",icon:"base-station",props:{type:"problem-today"},component:st},{name:"rank-ac-problem-day7",tab:"rank",sidebar:"rank-ac-problem-day7",path:"ac/problem/day7",title:"7日题量",icon:"base-station",props:{type:"problem-day7"},component:st},{name:"rank-ac-problem-day30",tab:"rank",sidebar:"rank-ac-problem-day30",path:"ac/problem/day30",title:"30日题量",icon:"base-station",props:{type:"problem-day30"},component:st},{name:"rank-ac-problem-year",tab:"rank",sidebar:"rank-ac-problem-year",path:"ac/problem/year",title:"1年题量",icon:"base-station",props:{type:"problem-year"},component:st},{name:"system-status",tab:"system",sidebar:"system-status",path:"",title:"运行状态",icon:"base-station",component:eu},{name:"system-about",tab:"system",sidebar:"system-about",path:"about",title:"关于",icon:"base-station",props:{discussId:"93"},component:Ut},{name:"manage-problem-create",tab:"manage",sidebar:"manage-problem-create",disableSidebar:!0,path:"problem",title:"新建问题",icon:"list",component:na,auths:[Le.ManageProblem]},{name:"manage-problem",tab:"manage",sidebar:"manage-problem",disableSidebar:!0,path:"problem/:problemId+",title:"问题编辑",icon:"list",component:na,auths:[Le.ManageProblem]},{name:"manage-problem-daily-create",tab:"manage",sidebar:"manage-problem-daily-create",disableSidebar:!0,path:"problem/daily",title:"新建每日一题",icon:"list",component:la,auths:[Le.ManageProblemDaily]},{name:"manage-problem-daily",tab:"manage",sidebar:"manage-problem-daily",disableSidebar:!0,path:"problem/daily/:dailyId+",title:"编辑每日一题",icon:"list",component:la,auths:[Le.ManageProblemDaily]},{name:"manage-problem-judge",tab:"manage",sidebar:"manage-problem-judge",disableSidebar:!0,path:"problem/:problemId+/judge",title:"评测数据",icon:"list",component:us,auths:[Le.ManageProblem]},{name:"manage-web",tab:"manage",path:"web",sidebar:"manage-web",title:"站点管理",icon:"list",auths:[Le.ManageWeb],component:nu},{name:"manage-judge",tab:"manage",path:"judge",sidebar:"manage-judge",title:"评测管理",icon:"list",auths:["i-manage-judge"],component:au},{name:"login-forget",tab:"login",path:"forget",title:"忘记密码",component:Wr}],fa=(e,l,n,u)=>{u.tab==n&&(u.disableSidebar&&l!=u.sidebar||u.sidebar==null||u.sidebar!=u.name||e.push({name:u.name,title:u.title,icon:u.icon,to:{name:u.name}}))},ou=(e,l)=>{const n=[];return Ka.forEach(u=>{if(Ra(u)){const o=[];u.children.forEach(y=>{fa(o,e,l,y)}),o.length>0&&n.push({title:u.title,children:o})}else fa(n,e,l,u)}),n},va=(e,l)=>{const n=oo(l.tab),u={name:l.name,path:"/"+l.path,meta:{title:l.title+" - "+n.title,tab:l.tab,sidebar:l.sidebar,showSidebar:n.showSidebar,needLogin:n.needLogin||l.needLogin,tabAuths:n.auths,auths:l.auths},props:l.props,component:l.component};!n.disablePath&&!l.disableTabPath&&(u.path=n.path+u.path),e.push(u)},su=e=>{Ka.forEach(l=>{Ra(l)?l.children.forEach(n=>{va(e,n)}):va(e,l)})},ru={class:"sh-main"},uu=de({__name:"View403",setup(e){let l=Se();const n=c("");return fe(()=>{l.query.target?n.value=l.query.target:n.value=l.fullPath}),(u,o)=>{const y=O;return V(),ae("div",ru,[R("p",null,q(n.value),1),o[2]||(o[2]=R("p",null,"该页面无访问权限，请更换访问目标或重新登陆后再试",-1)),t(y,{theme:"primary",onClick:o[0]||(o[0]=()=>u.$router.push("/"))},{default:a(()=>o[1]||(o[1]=[x("返回首页")])),_:1})])}}}),Fa=ce(uu,[["__scopeId","data-v-8f62f1f8"]]),gt=[];ro(gt);su(gt);gt.push({path:"/403",name:"403",component:Fa});gt.push({path:"/:pathMatch(.*)*",name:"404",component:Aa});const X=ol({history:sl("/"),routes:gt});X.beforeEach((e,l,n)=>{if(e.name==null||!X.hasRoute(e.name)){n({name:"home"});return}const u=e.matched[e.matched.length-1].meta;if(u.redirect){n({name:u.redirect});return}if(u.needLogin){const y=Fe();if(y.getToken==null||y.getToken==""){n({name:"login",query:{redirect_uri:e.fullPath}});return}}const o=u.tabAuths;if(o&&!Fe().hasAllAuths(o)){n({name:"403",query:{target:e.fullPath}});return}n()});X.afterEach((e,l)=>{if(e.name===l.name)return;const n=Pt(),u=Ze();let o=null;if(e.matched.length>0&&(o=e.matched[e.matched.length-1].meta),o!=null&&o.title&&u.setTitle(o==null?void 0:o.title),o!=null&&o.showSidebar){n.setSidebarShow(!0);const y=ou(o==null?void 0:o.sidebar,o==null?void 0:o.tab);n.setMenuList(y),n.setMenuActiveName(o==null?void 0:o.sidebar)}else n.setSidebarShow(!1);window.scrollTo(0,0)});const Na=pt("login",{state:()=>({Loaded:!1}),getters:{isLoaded(){return this.Loaded}}}),iu=de({__name:"HeaderContent",setup(e){const l=Na(),n=Fe(),{globalProperties:u}=_e(),o=c(l.isLoaded),y=c(!1),f=c(n.getUsername),C=c(n.getNickname),v=c(),s=()=>{v.value=so(n)};l.$subscribe((T,w)=>{o.value=w.Loaded}),n.$subscribe((T,w)=>{f.value=w.username,C.value=w.nickname,y.value=w.token!="",s()});const $=()=>{u.$router.currentRoute.value.name!=="login"&&u.$router.push({name:"login",query:{redirect_uri:u.$router.currentRoute.value.fullPath}})},p=()=>{n.clear(),u.$message.success({duration:3e3,content:"注销成功"}),u.$router.push({path:"/login",query:{redirect_uri:u.$router.currentRoute.value.fullPath}})};return fe(()=>{s()}),(T,w)=>{const b=Re("router-link"),S=Ia,i=Ca,_=Dl,g=jl;return V(),M(g,{modelValue:T.$route.meta.tab,"onUpdate:modelValue":w[0]||(w[0]=d=>T.$route.meta.tab=d),class:"sh-menu","expand-type":"popup"},{logo:a(()=>[t(b,{to:"/",class:"sh-logo"},{default:a(()=>w[1]||(w[1]=[x("DidaOJ")])),_:1})]),operations:a(()=>[o.value&&y.value?(V(),M(_,{key:0,title:C.value},{icon:a(()=>[t(S,{name:"user"})]),default:a(()=>[t(i,{value:"user",to:{path:"/user/"+f.value}},{default:a(()=>w[2]||(w[2]=[x("个人空间")])),_:1},8,["to"]),t(i,{value:"user_logout",onClick:p},{default:a(()=>w[3]||(w[3]=[x(" 注销")])),_:1})]),_:1},8,["title"])):o.value?(V(),M(i,{key:2,value:"login",onClick:$},{icon:a(()=>[t(S,{name:"login"})]),default:a(()=>[w[5]||(w[5]=x(" 登录 "))]),_:1})):(V(),M(i,{key:1,value:"login"},{icon:a(()=>[t(S,{name:"login"})]),default:a(()=>[w[4]||(w[4]=x(" ... "))]),_:1}))]),default:a(()=>[(V(!0),ae(pe,null,Pe(v.value,d=>(V(),M(i,{key:d.name,value:d.name,to:{name:d.name}},{icon:a(()=>[d.icon?(V(),M(S,{key:0,name:d.icon},null,8,["name"])):le("",!0)]),default:a(()=>[x(" "+q(d.title),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])}}}),du=ce(iu,[["__scopeId","data-v-cdf693c2"]]),cu={id:"menu-container"},mu=de({__name:"SidebarContent",setup(e){const l=Pt(),n=c(!1),u=c(null),o=c(l.menuActiveName),y=c(l.menuList),f=c([]),C=c(!1),v=()=>{o.value=l.menuActiveName;const $=JSON.stringify(y.value),p=JSON.stringify(l.menuList);$!==p&&(f.value.push([...l.menuList]),s())},s=async()=>{if(f.value.length>0&&!C.value){for(C.value=!0;f.value.length>1;)f.value.shift();const $=f.value.shift();n.value=$.length<=0,y.value=[],await mt(),u.value&&u.value.updateActiveName(),await new Promise(T=>setTimeout(T,300)),y.value=$,await mt(),u.value&&u.value.updateActiveName();const p=300;await new Promise(T=>setTimeout(T,p)),C.value=!1,await s()}};return l.$subscribe(($,p)=>{v()}),fe(()=>{v()}),($,p)=>{const T=Ia,w=Ca,b=$l,S=Ll,i=Ve;return V(),ae(pe,null,[R("div",cu,[t(S,{modelValue:o.value,"onUpdate:modelValue":p[0]||(p[0]=_=>o.value=_),theme:"light",class:"sh-menu-container"},{default:a(()=>[t(rl,{name:"move-left"},{default:a(()=>[(V(!0),ae(pe,null,Pe(y.value,(_,g)=>(V(),ae(pe,{key:g},[ve(uo)(_)?(V(),M(b,{key:0,title:_.title},{default:a(()=>[(V(!0),ae(pe,null,Pe(_.children,(d,r)=>(V(),M(w,{key:d.name,value:d.name,to:d.to},Zt({default:a(()=>[x(" "+q(d.title),1)]),_:2},[d.icon?{name:"icon",fn:a(()=>[t(T,{name:d.icon,class:Et(d.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))),128))]),_:2},1032,["title"])):(V(),M(w,{key:_.name,value:_.name,to:_.to},Zt({default:a(()=>[x(" "+q(_.title),1)]),_:2},[_.icon?{name:"icon",fn:a(()=>[t(T,{name:_.icon,class:Et(_.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),t(i,{size:"small",loading:n.value,"show-overlay":!0,attach:"#menu-container",class:"sh-sidebar-loading",style:{"align-items":"flex-start","padding-top":"100px"}},null,8,["loading"])],64)}}}),pu=ce(mu,[["__scopeId","data-v-96e2d89f"]]),fu={};function vu(e,l){return null}const _u=ce(fu,[["render",vu]]),gu={class:"footer"},bu={class:"footer-left"},hu={class:"foot-time"},yu={class:"footer-center"},wu={href:"https://beiancx.miit.gov.cn/",target:"_blank"},ku={class:"footer-right"},Su={class:"foot-text"},Cu={href:"https://github.com/hpu-developer/DiDaOJ-web",target:"_blank"},Iu={class:"foot-text"},Pu={href:"https://github.com/hpu-developer/DiDaOJ-go",target:"_blank"},xu=de({__name:"FooterContent",setup(e){const l=c("");function n(){l.value=new Date().toLocaleString()}return fe(()=>{n(),setInterval(()=>{n()},1e3)}),(u,o)=>{const y=O;return V(),ae("div",gu,[R("div",bu,[R("p",hu,q(l.value),1)]),R("div",yu,[R("a",wu,[t(y,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>o[0]||(o[0]=[x("豫ICP备15024677号-4")])),_:1})])]),R("div",ku,[R("p",Su,[R("a",Cu,[t(y,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>o[1]||(o[1]=[x("@didaoj-web")])),_:1})])]),R("p",Iu,[R("a",Pu,[t(y,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>o[2]||(o[2]=[x("@didaoj-go")])),_:1})])])])])}}}),Tu=ce(xu,[["__scopeId","data-v-44f2e4e7"]]),bt=20,At=100,Rt=50,Vu=de({__name:"ForceHiddenSidebarButton",setup(e){let l=Pt();const n=c({x:window.innerWidth-At-bt,y:window.innerHeight-Rt-bt}),u=c(window.innerWidth),o=c(window.innerHeight);let y=!1,f={x:0,y:0};const C=_=>{y=!0;const g=_.clientX??_.touches[0].clientX,d=_.clientY??_.touches[0].clientY;f={x:g-n.value.x,y:d-n.value.y},document.addEventListener("mousemove",v),document.addEventListener("touchmove",v),document.addEventListener("mouseup",s),document.addEventListener("touchend",s)},v=_=>{if(!y)return;const g=_.clientX??_.touches[0].clientX,d=_.clientY??_.touches[0].clientY;let r=g-f.x,z=d-f.y;r=Math.max(0,Math.min(r,u.value-At)),z=Math.max(0,Math.min(z,o.value-Rt)),n.value={x:r,y:z}},s=()=>{y=!1,document.removeEventListener("mousemove",v),document.removeEventListener("touchmove",v),document.removeEventListener("mouseup",s),document.removeEventListener("touchend",s)},$=()=>{u.value=window.innerWidth,o.value=window.innerHeight,n.value={x:Math.min(n.value.x,u.value-At-bt),y:Math.min(n.value.y,o.value-Rt-bt)}};let p=c(l.forceHiddenSidebar),T=c(l.forceHiddenSidebar);const w=()=>{p.value=!p.value,l.setForceHiddenSidebar(p.value)},b=()=>{T.value||(T.value=!0,l.setForceHiddenSidebar(p.value))},S=()=>{T.value&&(T.value=!1,l.setForceHiddenSidebar(!1))},i=_=>{_>=800?S():b()};return i(u.value),$e(u,_=>{i(_)}),fe(()=>{window.addEventListener("resize",$)}),De(()=>{window.removeEventListener("resize",$)}),(_,g)=>{const d=O;return ve(T)?(V(),M(d,{key:0,class:"draggable-button",style:ga({top:`${n.value.y}px`,left:`${n.value.x}px`}),onMousedown:C,onTouchstart:C,variant:"dashed",theme:"primary",onClick:w},{default:a(()=>[x(q(ve(p)?"显示":"隐藏"),1)]),_:1},8,["style"])):le("",!0)}}}),Du=ce(Vu,[["__scopeId","data-v-1aee5506"]]),ht="DidaOJ",ju=de({__name:"App",setup(e){const{globalProperties:l}=_e(),n=Na(),u=Fe(),o=Ze(),y=Pt();n.$patch({Loaded:!1});const f=u.getToken,C=c(!1),v=c(!1);o.title&&o.title.length>0?document.title=o.title+" - "+ht:document.title=ht,o.$subscribe((w,b)=>{b.title&&b.title.length>0?document.title=b.title+" - "+ht:document.title=ht}),y.$subscribe((w,b)=>{C.value=b.showSidebar,v.value=C.value&&!b.forceHiddenSidebar});const s=Se(),$=Be(()=>{const w=s.meta.auths;return w?!u.hasAllAuths(w):!1});function p(){l.$message.warning({duration:3e3,content:"登陆状态失效"}),n.$patch({Loaded:!0}),u.clear()}const T=async()=>{const w=document.querySelectorAll("oj-problem");if(w.length===0)return;let b={};w.forEach(_=>{const g=_.getAttribute("id"),d=document.createElement("span");d.setAttribute("style","padding:5px"),_.replaceWith(d);const r=c("default");b[g]||(b[g]=[]),b[g].push(r);let z=g;g&&!g.includes("-")&&(z="DidaOJ-"+g),ha({render:()=>dl(O,{innerHTML:z,onClick:()=>{window.open(`/problem/${g}`,"_blank")},size:"small",variant:"outline",theme:r.value})}).mount(d)});const S=[];for(const _ in b)S.push(_);const i=await wn(S);if(i.code===0)for(const _ in b){const g=b[_];if(!g)continue;let d="primary";const r=i.data[_];if(r)switch(r){case Ne.Accept:d="success";break;case Ne.Attempt:d="warning";break}for(const z of g)z.value=d}};return fe(()=>{document.addEventListener("DOMContentLoaded",()=>{new MutationObserver(()=>{Fl(()=>{T()},1e3)()}).observe(document.body,{childList:!0,subtree:!0}),ul.autoSpacingPage()}),f?Mn().then(w=>{w.code==0?(u.loadResponse(w.data),n.$patch({Loaded:!0})):(N(l,w.code),n.$patch({Loaded:!0}),u.clear())}).catch(w=>{console.log(w),p()}):n.$patch({Loaded:!0})}),(w,b)=>{const S=Ul,i=Al,_=Re("RouterView"),g=Rl,d=zl,r=El;return V(),ae(pe,null,[t(d,{class:"sh-app-layout"},{default:a(()=>[t(S,{class:"sh-header"},{default:a(()=>[t(du)]),_:1}),t(d,null,{default:a(()=>[t(il,{name:"slide"},{default:a(()=>[v.value?(V(),M(i,{key:0,class:"sh-sidebar"},{default:a(()=>[t(pu)]),_:1})):le("",!0)]),_:1}),t(d,{class:Et(["sh-main-layout",{expanded:!v.value}])},{default:a(()=>[t(_u),t(g,{class:"sh-main-content"},{default:a(()=>[$.value?(V(),M(Fa,{key:0})):(V(),M(_,{key:1}))]),_:1}),t(Tu)]),_:1},8,["class"])]),_:1})]),_:1}),C.value?(V(),M(Du,{key:0})):le("",!0),t(r,{container:"body",offset:["24px","80px"],size:"small"})],64)}}}),Lu=ce(ju,[["__scopeId","data-v-66c2cfa5"]]);function $u(e,l={}){const n=/\{\{%\s*(\w+)\s+([^%]+?)\s*%\}\}/g,u=l.renderers||{},o=e.renderer.rules.text??function(y,f){return y[f].content};e.renderer.rules.text=function(y,f,C,v,s){const p=y[f].content;return n.test(p)?p.replace(n,(w,b,S)=>{const i=u[b];if(typeof i=="function"){const _=S.trim().split(/\s+/);return i(_)}else return`<span class="shortcode-${b}">${b}: ${S.trim()}</span>`}):o(y,f,C,v,s)}}function Uu(e,l){const n=/\{\{%\s*(\w+)\s*%\}\}([\s\S]*?)\{\{%\s*\/\1\s*%\}\}/g;e.core.ruler.push("shortcode_color",u=>{for(const o of u.tokens){if(o.type!=="inline")continue;let y=o.content,f=!1;y=y.replace(n,(C,v,s)=>{var p;const $=(p=l.renderers)==null?void 0:p[v];return $?(f=!0,$([],s.trim())):C}),f&&(o.type="html_inline",o.tag="",o.attrs=null,o.content=y,o.children=[])}})}Nl({markdownItConfig(e){e.use(jt,"align-left",{render(l,n){return l[n].nesting===1?`<div class="sh-align-left">
`:`</div>
`}}),e.use(jt,"align-center",{render(l,n){return l[n].nesting===1?`<div class="sh-align-center">
`:`</div>
`}}),e.use(jt,"align-right",{render(l,n){return l[n].nesting===1?`<div class="sh-align-right">
`:`</div>
`}}),e.use($u,{renderers:{problem:([l])=>`<oj-problem id="${l}">${l}</oj-problem>`}}),e.use(Uu,{renderers:{red:(l,n)=>`<span class="dida-font-red">${n}</span>`,green:(l,n)=>`<span class="dida-font-green">${n}</span>`,blue:(l,n)=>`<span class="dida-font-blue">${n}</span>`}})},markdownItPlugins(e){return[...e,{type:"linkAttr",plugin:pl,options:{matcher(l){return!l.startsWith("#")},attrs:{target:"_blank"}}}]}});const Oa=cl();Oa.use(ml);const dt=ha(Lu);dt.use(Oa);dt.use(X);dt.use(Ml);dt.use(Ol);dt.use(Gl);dt.mount("#app");Hl().then(()=>{console.log("Text cache reinitialized")}).catch(e=>{console.error("Text cache reinitialization failed",e)});
