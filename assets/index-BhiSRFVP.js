import{ct as _t,d as ce,a as c,o as pe,cu as M,cv as V,cw as a,e as t,cx as R,cy as q,bE as I,cz as ga,aM as Ba,cA as Me,cB as ae,cC as ee,F as me,cD as Te,cE as Ja,cF as Wa,cG as Se,bS as fe,cH as Ya,cI as Xa,cJ as Za,b as Ve,v as ft,cK as Qa,cL as Xe,j as Je,w as Ue,a9 as at,bc as el,bd as tl,cM as al,cN as ll,cO as nl,br as ol,cP as jt,cQ as ba,cR as ha,cj as sl,cS as rl,cT as il,cU as ul,bX as dl,cV as ea,cW as Kt,cX as cl,bf as ml,aY as ya,z as pl,cY as fl,cZ as vl,c_ as _l,c$ as Lt}from"./node_modules-DzJYoZ3M.js";import{L as De,C as be,R as Pe,a as xe,A as Tt,S as gl,b as bl,c as hl,d as yl,e as wl,f as ot,T as Qe,B as O,F as Ae,g as ze,I as Re,D as st,h as wa,i as We,j as Ye,k as kl,l as Fe,m as we,n as gt,o as bt,P as Nt,O as Ot,p as Gt,q as Sl,r as ka,s as Cl,t as Il,u as Sa,v as Ca,w as xt,x as Pl,y as Tl,z as xl,E as Dl,G as Vl,H as $l,J as jl,M as Ia,K as Pa,N as Ll,Q as Ul,U as Al,V as zl,W as Rl,X as El,Y as Ml,Z as ql,_ as Fl,$ as Kl}from"./tdesign-vue-next-DG0Rz_oo.js";import{u as _e,S as ge,a as ye,b as K,G as He,H as ct,c as Ge,d as Nl,e as Ta,f as Ol,g as Gl,h as Hl,E as Bl,M as Jl,R as Wl}from"./md-editor-v3-DMC6lql_.js";import{e as ta}from"./monaco-editor-ouHSYV7a.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const h of o)if(h.type==="childList")for(const b of h.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&i(b)}).observe(document,{childList:!0,subtree:!0});function n(o){const h={};return o.integrity&&(h.integrity=o.integrity),o.referrerPolicy&&(h.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?h.credentials="include":o.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function i(o){if(o.ep)return;o.ep=!0;const h=n(o);fetch(o.href,h)}})();var je=(e=>(e.ManageWeb="i-manage-web",e.ManageJudge="i-manage-judge",e.ManageProblem="i-manage-problem",e.ManageProblemDaily="i-manage-problem-daily",e.ManageContest="i-manage-contest",e.ManageCollection="i-manage-collection",e.ManageDiscuss="i-manage-discuss",e))(je||{});const Yl={"r-admin":["i-manage-web","i-manage-judge","i-manage-problem","i-manage-problem-daily","i-manage-contest","i-manage-collection","i-manage-discuss"]};function Xl(e){if(e==null)return[];const l=[];for(const n of e){const i=Yl[n];i!=null&&l.push(...i)}return[...new Set(l)]}function Zl(e,l){if(e==null||l==null)return!1;const n=Xl(e);for(const i of l)if(!n.includes(i))return!1;return!0}const qe=_t("user",{state:()=>({token:"",userId:-1,username:"",nickname:"",roles:[]}),getters:{getToken(){return this.token},getUserId(){return this.userId},getUsername(){return this.username},getNickname(){return this.nickname}},actions:{clear(){this.$patch({token:"",userId:-1,username:"",nickname:"",roles:[]})},loadResponse(e){this.$patch({token:e.token,userId:e.user_id,username:e.username,nickname:e.nickname,roles:e.roles})},isLogin(){return this.token!=null&&this.token!=""},hasAuth(e){return this.hasAllAuths([e])},hasAllAuths(e){return e?Zl(this.roles,e):!0}},persist:!0}),Ze=_t("webStyle",{state:()=>({title:""}),getters:{getTitle(){return this.title}},actions:{setTitle(e){this.title=e}}}),Dt=_t("sidebarStyle",{state:()=>({showSidebar:!1,forceHiddenSidebar:!1,menuActiveName:"",menuList:[]}),getters:{getMenuList(){return this.menuList}},actions:{setSidebarShow(e){this.showSidebar=e},setForceHiddenSidebar(e){this.forceHiddenSidebar=e},setMenuActiveName(e){this.menuActiveName=e},clearMenuList(){this.menuList=[]},setMenuList(e){this.menuList=e},addMenuList(e){this.menuList.push(e)}}}),Ql={style:{"text-align":"right"}},en=ce({__name:"Hitokoto",setup(e){const l=c(!1),n=c(""),i=c(""),o=c(""),h=async()=>{l.value=!0;try{const w=await(await fetch("https://v1.hitokoto.cn")).json();i.value=w.hitokoto,o.value=w.creator,n.value="—— "+w.from}catch(b){i.value="一言获取失败了，但至少您还可以访问本站。",o.value="BoilTask",n.value="DidaOJ",console.error("Error fetching Hitokoto:",b)}finally{l.value=!1}};return pe(()=>{h()}),(b,w)=>{const m=be,s=De;return V(),M(s,{loading:l.value},{default:a(()=>[t(m,{title:"一言 © Hitokoto"},{actions:a(()=>[I(" @"+q(o.value),1)]),default:a(()=>[R("div",null,[R("span",null,q(i.value),1),R("p",Ql,q(n.value),1)])]),_:1})]),_:1},8,["loading"])}}}),tn="https://oj-api.didapipa.com/",G=ga.create({baseURL:tn,timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});G.interceptors.request.use(e=>{const n=qe().getToken;return n&&(e.headers["X-Token"]=n),e},e=>Promise.reject(e));G.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});const Vt=ga.create({timeout:6e4,withCredentials:!1,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});Vt.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function xa(){return Vt({baseURL:"https://r2-oj.didapipa.com",url:"/system/notification.json?"+Date.now(),method:"get"})}function Da(){return Vt({baseURL:"https://r2-oj.didapipa.com",url:"/system/announcement.json?"+Date.now(),method:"get"})}function an(){return G({url:"/system/status",method:"get"})}function ln(){return G({url:"/system/image/token",method:"get"})}function nn(e,l){return G({url:"/system/notification",method:"post",data:{theme:e,content:l}})}function on(e,l){return G({url:"/system/announcement",method:"post",data:{title:e,content:l}})}var $t=(e=>(e[e.Unknown=-1]="Unknown",e[e.C=0]="C",e[e.Cpp=1]="Cpp",e[e.Java=2]="Java",e[e.Python=3]="Python",e[e.Pascal=4]="Pascal",e[e.Golang=5]="Golang",e[e.Lua=6]="Lua",e[e.TypeScript=7]="TypeScript",e[e.Max=8]="Max",e))($t||{});function Ht(){const e=[-1,8];return Object.values($t).filter(l=>typeof l=="number"&&!e.includes(l)).map(l=>({value:l,label:It(l)}))}function St(e){return e>-1&&e<8}function It(e){switch(e){case 0:return"C";case 1:return"C++";case 2:return"Java";case 3:return"Python";case 4:return"Pascal";case 5:return"Golang";case 6:return"Lua";case 7:return"TypeScript";default:return"未知"}}function Bt(e){switch(e){case 0:return"c";case 1:return"cpp";case 2:return"java";case 3:return"python";case 4:return"pascal";case 5:return"go";case 6:return"lua";case 7:return"typescript";default:return"text"}}var Be=(e=>(e[e.Init=0]="Init",e[e.Rejudge=1]="Rejudge",e[e.Submitting=2]="Submitting",e[e.Queuing=3]="Queuing",e[e.Compiling=4]="Compiling",e[e.Running=5]="Running",e[e.Accept=6]="Accept",e[e.PE=7]="PE",e[e.WA=8]="WA",e[e.TLE=9]="TLE",e[e.MLE=10]="MLE",e[e.OLE=11]="OLE",e[e.RE=12]="RE",e[e.CE=13]="CE",e[e.CLE=14]="CLE",e[e.JudgeFail=15]="JudgeFail",e[e.SubmitFail=16]="SubmitFail",e[e.Unknown=17]="Unknown",e[e.Max=18]="Max",e))(Be||{});const sn=e=>{switch(e){case 0:return"普通评测";case 1:return"特殊评测";default:return"未知"}},Pt=e=>{switch(e){case 0:return"等待处理";case 1:return"重新评测";case 2:return"提交中";case 3:return"队列中";case 4:return"编译中";case 5:return"运行中";case 6:return"通过";case 7:return"格式错误";case 8:return"答案错误";case 9:return"超时";case 10:return"内存超限";case 11:return"输出超限";case 12:return"运行错误";case 13:return"编译错误";case 14:return"编译超限";case 15:return"评测失败";case 16:return"提交失败";case 17:return"未知";default:return e}},aa=e=>{if(e!==void 0)switch(e){case 0:return"已经提交到系统，请耐心等待评测结果";case 1:return"管理员发起了重新评测，请耐心等待评测结果";case 2:return"判题机已经接受了本次提交，正在提交到远程判官中";case 3:return"判题机已经接受了本次提交，正在排队等待评测";case 4:return"判题机正在编译您的代码，部分语言会在此步检查是否符合语法";case 5:return"您的代码正在运行，请等待运行结果";case 6:return"您的代码通过了测试用例，恭喜您！";case 7:return"您的代码基本正确，但可能存在空格、空行等格式错误，请认真对比输出要求";case 8:return"您的答案与标准答案存在区别，请继续思考有无未考虑的情况";case 9:return"运行您的代码所用的时间超过了题目限制，请思考时间上更优的解法";case 10:return"运行您的代码所用的内存超过了题目限制，请思考空间上更优的解法";case 11:return"您程序的输出内容远远多于了题目要求（一般是数倍于正确输出），请检查相关逻辑";case 12:return"在运行您程序的过程中发生了异常，可能是除零、数组越界等问题，请检查相关逻辑";case 13:return"您的代码在编译阶段发生了错误，可能是语法错误或其他编译问题，请检查相关逻辑";case 14:return"在编译您代码的过程中，所占用的资源远远超过了要求，请检查相关逻辑";case 15:return"评测过程中发生了异常，一般是判题机或远程判官的问题，可尝试联系管理员处理";case 16:return"在将您的代码提交到远程判官的过程中发生了错误，一般是判题机或远程判官的问题，可联系管理员处理";case 17:return"您的代码状态未知，有可能是您不具有权限，或者该代码状态被隐藏"}return"暂时无提示信息"},Va=e=>{switch(e){case 0:case 1:case 2:case 3:case 4:case 5:case 17:return"default";case 6:return"success";case 7:return"warning";default:return"danger"}};function $a(){const e=[17,18];return Object.values(Be).filter(l=>typeof l=="number"&&!e.includes(l)).map(l=>({value:l,label:Pt(l)}))}function Ct(e){return e>=0&&e<17}function dt(e){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return!0;default:return!1}}function ja(e){var n;const l={};if(l.id=e.id,l.problemId=e.problem_id,l.contestProblemIndex=e.contest_problem_index,l.status=e.status,dt(e.status)||!Ct(e.status)?l.score="-":l.score=(e.score/10).toString(),e.time?l.time=Math.ceil(e.time/1e6)+"ms":l.time="-",e.memory?l.memory=(e.memory/1024/1024).toFixed(2)+"MB":l.memory="-",l.language=e.language,l.codeLength=e.code_length,e.approve_time?l.approveTime=new Date(e.approve_time).toLocaleString():l.approveTime="-",l.author=e.author,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.code=e.code,l.compileMessage=e.compile_message,l.taskCurrent=e.task_current,l.taskTotal=e.task_total,l.task=[],e.task)for(let i=0;i<((n=e.task)==null?void 0:n.length);i++){const o=e.task[i],h={};h.taskId=o.task_id,h.status=o.status,o.time?h.time=Math.ceil(o.time/1e6)+"ms":h.time="-",o.memory?h.memory=(o.memory/1024/1024).toFixed(2)+"MB":h.memory="-",o.score?h.score=(o.score/10).toString():h.score="-",h.content=o.content,h.waHint=o.wa_hint,l.task.push(h)}return e.judger&&(l.judger=e.judger),e.judger_name?l.judgerName=e.judger_name:l.judgerName="-",e.judge_time&&(l.judgeTime=new Date(e.judge_time).toLocaleString()),l}function rn(e,l,n,i,o){return G({url:"/judge/approve",method:"post",data:{problem_id:e,contest_id:l,problem_index:n,language:i,code:o}})}function un(e,l){let n={id:e};return l&&(n.contest_id=l),G({url:"/judge?"+new URLSearchParams(n).toString(),method:"get"})}function dn(e){return G({url:"/judge/code?id="+e,method:"get"})}function cn(e,l,n,i,o,h,b){let w={problem_id:l,username:n,language:String(i),status:String(o),page:String(h),page_size:String(b)};return e&&(w.contest_id=String(e)),G({url:`/judge/list?${new URLSearchParams(w).toString()}`,method:"get"})}function mn(){return G({url:"/judge/statics/recently",method:"get"})}function pn(){return G({url:"/judge/rejudge/recently",method:"post"})}function fn(e,l,n){const i={};return e!=null&&(i.problem_id=e),l!=null?i.language=l:i.language=$t.Unknown,n!=null?i.status=n:i.status=18,G({url:"/judge/rejudge/search",method:"post",data:i})}function vn(){return G({url:"/judge/rejudge/all",method:"post",timeout:0})}function _n(e){return G({url:"/judge/rejudge",method:"post",data:{id:Number(e)}})}var Le=(e=>(e[e.None=0]="None",e[e.Attempt=1]="Attempt",e[e.Accept=2]="Accept",e))(Le||{});function ht(e,l){const n={};if(n.id=e.id,n.author=e.author,n.title=e.title,n.tags=[],e.tags)for(const i of e.tags){const o=l[i];o&&n.tags.push(o)}if(n.private=e.private,n.accept=e.accept,n.attempt=e.attempt,e.description!=null&&(n.description=e.description),e.time_limit!=null&&e.time_limit>=0?n.timeLimit=e.time_limit.toString()+" ms":n.timeLimit="未知",e.memory_limit!=null&&e.memory_limit>=0?n.memoryLimit=(e.memory_limit/1024).toFixed(2)+" MB":n.memoryLimit="未知",e.judge_type!=null&&(n.judgeType=sn(e.judge_type)),e.insert_time!=null&&(n.insertTime=new Date(e.insert_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.source!=null){const i=/\[([^\]]+)\]\(([^)]+)\)/,o=e.source.match(i);o?(n.source=o[1],n.sourceUrl=o[2]):(n.source=e.source,n.sourceUrl="")}return e.judge_md5!=null&&(n.judgeMd5=e.judge_md5),e.origin_oj!=null&&(n.originOj=e.origin_oj),e.origin_id!=null&&(n.originId=e.origin_id),e.origin_url!=null&&(n.originUrl=e.origin_url),n}function La(e,l){const n={};if(n.id=e.id,n.problemId=e.problem_id,n.title=e.title,n.tags=[],e.tags)for(const i of e.tags){const o=l[i];o&&n.tags.push(o)}return e.accept?n.accept=e.accept:n.accept=0,e.attempt?n.attempt=e.attempt:n.attempt=0,n.solution=e.solution,n.code=e.code,e.create_time!=null&&(n.createTime=new Date(e.create_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.updater_nickname!=null&&(n.updaterNickname=e.updater_nickname),n}function Ua(e,l,n){const i={};return e?i.id=e:(i.contest_id=l,i.problem_index=n),G({url:`/problem?${new URLSearchParams(i).toString()}`,method:"get"})}function Aa(e){return G({url:"/problem/tag/list?max_count="+e,method:"get"})}function gn(e){return G({url:"/problem/judge?id="+e,method:"get"})}function bn(e,l,n,i,o,h){const b={};return e&&(b.oj=e),l&&(b.title=l),n&&(b.tag=n),i!==void 0&&(b.private=i?"1":"0"),o&&(b.page=o),h&&(b.page_size=h),G({url:`/problem/list?${new URLSearchParams(b).toString()}`,method:"get"})}function hn(e){const l={};return e&&(l.problem_id=e),G({url:`/problem/recommend?${new URLSearchParams(l).toString()}`,method:"get"})}function yn(e){return G({url:"/problem/daily?id="+e,method:"get"})}function wn(e){return G({url:"/problem/daily/edit?id="+e,method:"get"})}function kn(){return G({url:"/problem/daily/recently",method:"get"})}function Sn(e,l,n,i,o){const h={};return e&&(h.start_date=e),l&&(h.end_date=l),n&&(h.problem_id=n),i&&(h.page=i),o&&(h.page_size=o),G({url:`/problem/daily/list?${new URLSearchParams(h).toString()}`,method:"get"})}function za(e){return G({url:"/problem/attempt/status",method:"get",params:{ids:e.join(",")}})}function Ra(e,l){return G({url:"/problem/crawl",method:"post",data:{oj:e,id:l}})}function Cn(e,l,n,i,o,h,b){return G({url:"/problem/create",method:"post",data:{title:e,time_limit:l,memory_limit:n,source:i,private:o,tags:h,description:b}})}function In(e,l,n,i,o,h,b,w){return G({url:"/problem/edit",method:"post",data:{id:e,title:l,time_limit:n,memory_limit:i,source:o,private:h,tags:b,description:w}})}function Pn(e,l,n,i){return G({url:"/problem/daily/create",method:"post",data:{id:e,problem_id:l,solution:n,code:i}})}function Tn(e,l,n,i){return G({url:"/problem/daily/edit",method:"post",data:{id:e,problem_id:l,solution:n,code:i}})}function xn(e,l){return G({url:"/problem/judge/data/download?id="+e+"&key="+l,method:"get"})}function Dn(e){return e||(e=""),G({url:"/problem/image/token?id="+e,method:"get"})}function Vn(e){return e||(e=""),G({url:"/problem/daily/image/token?id="+e,method:"get"})}function $n(e,l){const n=new FormData;return n.append("id",e),n.append("zip",l),G({url:"/problem/judge/data",method:"post",data:n,headers:{"Content-Type":"multipart/form-data"},timeout:1e3*60*5})}function jn(e){return G({url:"/problem/parse",method:"post",data:{problems:e}})}const Ln={class:"sh-main"},Un={class:"dida-swiper-div"},An=ce({__name:"HomeView",setup(e){const{globalProperties:l}=_e();let n=-1;const i=c({theme:"info",content:""}),o=c({title:"",content:""}),h=c([]),b=c(!1),w=c(!1),m=c(!1),s=async()=>{i.value=await xa()},U=async()=>{try{const S=await Da();o.value.title=S.title,o.value.content=S.content}catch{ge(l,"加载公告失败"),o.value={title:"公告加载失败",content:"请刷新页面重新获取"}}},p=async()=>{const S=await mn();if(S.code!==0){ge(l,"加载OJ统计数据失败");return}let y=[];for(const g of S.data){const f=new Date(g.date),d=`${f.getMonth()+1}-${f.getDate()}`;y.push({Date:d,Type:"Unaccept",Count:g.attempt-g.accept}),y.push({Date:d,Type:"Accept",Count:g.accept})}const C={type:"bar",data:[{id:"barData",values:y}],xField:"Date",yField:"Count",seriesField:"Type",stack:!0,legends:{visible:!0},bar:{state:{hover:{stroke:"#000",lineWidth:1}}},height:300};new Ja(C,{dom:"ojStaticsDiv"}).renderSync()},T=async()=>{h.value=[];const S=await kn();if(S.code!==0){ge(l,"加载每日问题数据失败");return}S.data.list&&S.data.list.length>0&&S.data.list.forEach(y=>{let C="default",u="未尝试";if(S.data.attempt_status){const f=S.data.attempt_status[y.problem_id];if(f)switch(f){case Le.Accept:C="success",u="已解决";break;case Le.Attempt:C="warning",u="待解决";break;default:C="default",u="未尝试"}}const g=`${y.title}`;h.value.push({id:y.id,title:g,problemId:y.problem_id,theme:C,tag:u})})};return pe(async()=>{m.value=!0,b.value=!0,w.value=!0,(async()=>(await s(),n=setInterval(()=>{s()},3e4),await U(),m.value=!1))(),(async()=>(await p(),b.value=!1))(),(async()=>(await T(),w.value=!1))()}),Ba(()=>{clearInterval(n)}),(S,y)=>{const C=Tt,u=bl,g=gl,f=De,d=Me("md-preview"),r=be,A=xe,v=ot,$=wl,L=Qe,_=yl,k=hl,D=Pe;return V(),M(f,{loading:m.value},{default:a(()=>[t(D,null,{default:a(()=>[t(A,{span:8},{default:a(()=>{var x;return[R("div",Ln,[i.value?(V(),M(C,{key:0,class:"dida-notification-div",theme:i.value.theme},{default:a(()=>[I(q(i.value.content),1)]),_:1},8,["theme"])):ae("",!0),R("div",Un,[t(g,{class:"dida-swiper"},{default:a(()=>[t(u,null,{default:a(()=>y[1]||(y[1]=[R("a",{href:"http://codeoj.cn",target:"_blank"},[R("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"})],-1)])),_:1}),t(u,null,{default:a(()=>y[2]||(y[2]=[R("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1})]),_:1})]),t(f,{loading:b.value&&!m.value},{default:a(()=>y[3]||(y[3]=[R("div",{id:"ojStaticsDiv",style:{"min-height":"200px"}},null,-1)])),_:1},8,["loading"]),t(r,{title:(x=o.value)==null?void 0:x.title,style:{width:"calc(100% - 100px)",margin:"0 auto"}},{default:a(()=>{var P;return[t(d,{"model-value":(P=o.value)==null?void 0:P.content,previewTheme:"cyanosis"},null,8,["model-value"])]}),_:1},8,["title"])])]}),_:1}),t(A,{span:4},{default:a(()=>[t(r,{style:{margin:"10px"},bordered:!0},{default:a(()=>y[4]||(y[4]=[R("img",{src:"https://api.jysafe.cn/ip/",alt:"Welcome",style:{width:"100%"}},null,-1)])),_:1}),t(en,{style:{margin:"10px"}}),t(r,{style:{margin:"10px"},bordered:!0,title:"每日一题"},{actions:a(()=>[t(v,{onClick:y[0]||(y[0]=x=>S.$router.push({name:"problem-daily-list"}))},{default:a(()=>y[5]||(y[5]=[I("查看全部")])),_:1})]),default:a(()=>[t(f,{loading:w.value&&!m.value},{default:a(()=>[t(k,{split:!0,size:"small",style:{"min-height":"200px"}},{default:a(()=>[(V(!0),ee(me,null,Te(h.value,x=>(V(),M(_,{key:x.id},{default:a(()=>[t($,{style:{width:"100px"}},{description:a(()=>[t(v,{onClick:P=>S.$router.push({name:"problem-daily-detail",params:{dailyId:x.id}})},{default:a(()=>[I(q(x.problemId),1)]),_:2},1032,["onClick"])]),_:2},1024),t($,{style:{width:"200px"}},{description:a(()=>[t(v,{onClick:P=>S.$router.push({name:"problem-daily-detail",params:{dailyId:x.id}})},{default:a(()=>[I(q(x.title),1)]),_:2},1032,["onClick"])]),_:2},1024),t($,{style:{width:"135px"},description:x.id},null,8,["description"]),t($,null,{description:a(()=>[t(L,{theme:x.theme},{default:a(()=>[I(q(x.tag),1)]),_:2},1032,["theme"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["loading"])]),_:1}),t(r,{style:{margin:"10px"},bordered:!0},{header:a(()=>y[6]||(y[6]=[R("b",null,"友情链接",-1)])),default:a(()=>[t(k,null,{default:a(()=>[t(_,null,{default:a(()=>[t(v,{href:"https://oi-wiki.org/",target:"_blank"},{default:a(()=>y[7]||(y[7]=[I("OI Wiki")])),_:1})]),_:1}),t(_,null,{default:a(()=>[t(v,{href:"https://boiltask.com",target:"_blank"},{default:a(()=>y[8]||(y[8]=[I("BoilTask Blog")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])}}}),de=(e,l)=>{const n=e.__vccOpts||e;for(const[i,o]of l)n[i]=o;return n},zn=de(An,[["__scopeId","data-v-09e344ae"]]),Rn={},En={style:{margin:"20px"}};function Mn(e,l){return V(),ee("div",En,l[0]||(l[0]=[Wa('<header data-v-2f5a046e><h1 data-v-2f5a046e>算法设计高级课程方案</h1><p data-v-2f5a046e>分治策略 · 动态规划 · 贪心算法 · 回溯算法</p></header><div class="section" data-v-2f5a046e><h2 data-v-2f5a046e>一、课程核心知识点</h2><div class="two-columns" data-v-2f5a046e><div class="column" data-v-2f5a046e><h3 data-v-2f5a046e>1. 分治策略 (Divide and Conquer)</h3><p data-v-2f5a046e>分治算法是一种将问题分解为若干子问题，递归解决子问题，再合并子问题解得到原问题解的算法策略:cite[1]:cite[4]。</p><ul data-v-2f5a046e><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>基本思想</span>：将大问题分解为k个较小规模的相同子问题</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>关键特征</span>：子问题相互独立且与原问题形式相同</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>典型应用</span>：归并排序、快速排序、大整数乘法</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>复杂度分析</span>：主定理(Master Theorem)的应用</li></ul><h3 data-v-2f5a046e>2. 动态规划 (Dynamic Programming)</h3><p data-v-2f5a046e>动态规划通过保存子问题的解避免重复计算，适用于具有最优子结构和重叠子问题性质的问题:cite[1]:cite[6]。</p><ul data-v-2f5a046e><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>基本思想</span>：记忆化存储，自底向上求解</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>关键特征</span>：最优子结构、重叠子问题、无后效性</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>典型应用</span>：背包问题、最长公共子序列、最短路径</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>设计步骤</span>：定义状态、状态转移方程、边界条件</li></ul></div><div class="column" data-v-2f5a046e><h3 data-v-2f5a046e>3. 贪心算法 (Greedy Algorithm)</h3><p data-v-2f5a046e>贪心算法在每一步做出局部最优选择，希望最终得到全局最优解:cite[1]:cite[5]。</p><ul data-v-2f5a046e><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>基本思想</span>：当前状态下做出最好选择，不回溯</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>关键特征</span>：贪心选择性质、最优子结构</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>典型应用</span>：霍夫曼编码、最小生成树、任务调度</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>局限性</span>：不保证全局最优，需证明正确性</li></ul><h3 data-v-2f5a046e>4. 回溯算法 (Backtracking)</h3><p data-v-2f5a046e>回溯法通过深度优先搜索解空间树，通过剪枝避免无效搜索:cite[1]:cite[7]。</p><ul data-v-2f5a046e><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>基本思想</span>：系统搜索解空间，走不通就回溯</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>关键特征</span>：解空间树、约束函数、限界函数</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>典型应用</span>：八皇后问题、图着色、组合优化</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>优化技巧</span>：剪枝策略、启发式搜索</li></ul></div></div></div><div class="section" data-v-2f5a046e><h2 data-v-2f5a046e>二、专题化案例建设</h2><p data-v-2f5a046e>从各大竞赛平台选取真实案例，将算法理论应用于实际问题解决。</p><div class="case-study" data-v-2f5a046e><h3 data-v-2f5a046e>案例1：电商平台优惠券分配优化（阿里天池）</h3><p data-v-2f5a046e><strong data-v-2f5a046e>适用算法</strong>：动态规划、贪心算法</p><p data-v-2f5a046e><strong data-v-2f5a046e>问题描述</strong>：在预算限制下，如何分配优惠券以最大化平台GMV。</p><p data-v-2f5a046e><strong data-v-2f5a046e>教学要点</strong>：</p><ul data-v-2f5a046e><li data-v-2f5a046e>建立价值-成本模型</li><li data-v-2f5a046e>设计状态转移方程</li><li data-v-2f5a046e>比较贪心策略与动态规划效果</li></ul></div><div class="case-study" data-v-2f5a046e><h3 data-v-2f5a046e>案例2：医疗影像分割（Kaggle）</h3><p data-v-2f5a046e><strong data-v-2f5a046e>适用算法</strong>：分治策略</p><p data-v-2f5a046e><strong data-v-2f5a046e>问题描述</strong>：将大型医疗影像分割处理，提高分析效率。</p><p data-v-2f5a046e><strong data-v-2f5a046e>教学要点</strong>：</p><ul data-v-2f5a046e><li data-v-2f5a046e>图像分块处理策略</li><li data-v-2f5a046e>并行计算与结果合并</li><li data-v-2f5a046e>分治粒度对性能的影响</li></ul></div><div class="case-study" data-v-2f5a046e><h3 data-v-2f5a046e>案例3：网络路由优化（华为开发者大赛）</h3><p data-v-2f5a046e><strong data-v-2f5a046e>适用算法</strong>：回溯算法</p><p data-v-2f5a046e><strong data-v-2f5a046e>问题描述</strong>：在复杂网络拓扑中找到最优数据传输路径。</p><p data-v-2f5a046e><strong data-v-2f5a046e>教学要点</strong>：</p><ul data-v-2f5a046e><li data-v-2f5a046e>解空间树的构建</li><li data-v-2f5a046e>剪枝条件设计</li><li data-v-2f5a046e>回溯与分支限界的比较</li></ul></div><table data-v-2f5a046e><tr data-v-2f5a046e><th data-v-2f5a046e>竞赛平台</th><th data-v-2f5a046e>案例类型</th><th data-v-2f5a046e>适用算法</th><th data-v-2f5a046e>技能培养重点</th></tr><tr data-v-2f5a046e><td data-v-2f5a046e>百度AI Studio</td><td data-v-2f5a046e>自然语言处理</td><td data-v-2f5a046e>动态规划</td><td data-v-2f5a046e>序列对齐、编辑距离</td></tr><tr data-v-2f5a046e><td data-v-2f5a046e>阿里天池</td><td data-v-2f5a046e>推荐系统</td><td data-v-2f5a046e>贪心算法</td><td data-v-2f5a046e>实时决策、局部最优</td></tr><tr data-v-2f5a046e><td data-v-2f5a046e>Kaggle</td><td data-v-2f5a046e>数据挖掘</td><td data-v-2f5a046e>分治策略</td><td data-v-2f5a046e>大数据处理、并行计算</td></tr><tr data-v-2f5a046e><td data-v-2f5a046e>华为云大赛</td><td data-v-2f5a046e>网络优化</td><td data-v-2f5a046e>回溯算法</td><td data-v-2f5a046e>解空间探索、剪枝优化</td></tr></table></div><div class="section" data-v-2f5a046e><h2 data-v-2f5a046e>三、学术训练模块</h2><p data-v-2f5a046e>精选与课程知识点相关的经典学术论文，培养学生学术研究能力。</p><div class="paper-analysis" data-v-2f5a046e><h3 data-v-2f5a046e>论文1：动态规划在生物信息学中的应用</h3><p data-v-2f5a046e><strong data-v-2f5a046e>关联知识点</strong>：动态规划</p><p data-v-2f5a046e><strong data-v-2f5a046e>核心内容</strong>：Smith-Waterman算法在序列比对中的应用</p><p data-v-2f5a046e><strong data-v-2f5a046e>教学安排</strong>：</p><ol data-v-2f5a046e><li data-v-2f5a046e>论文精读：算法设计思想</li><li data-v-2f5a046e>复现实验：实现基础算法</li><li data-v-2f5a046e>性能分析：时间复杂度与空间复杂度</li><li data-v-2f5a046e>改进讨论：可能的优化方向</li></ol></div><div class="paper-analysis" data-v-2f5a046e><h3 data-v-2f5a046e>论文2：贪心算法的近似比证明</h3><p data-v-2f5a046e><strong data-v-2f5a046e>关联知识点</strong>：贪心算法</p><p data-v-2f5a046e><strong data-v-2f5a046e>核心内容</strong>：集合覆盖问题的贪心算法近似比分析</p><p data-v-2f5a046e><strong data-v-2f5a046e>教学安排</strong>：</p><ol data-v-2f5a046e><li data-v-2f5a046e>问题建模：形式化描述集合覆盖</li><li data-v-2f5a046e>算法设计：贪心策略实现</li><li data-v-2f5a046e>理论证明：近似比推导</li><li data-v-2f5a046e>实验验证：与最优解比较</li></ol></div><div class="paper-analysis" data-v-2f5a046e><h3 data-v-2f5a046e>论文3：分治算法的并行化实现</h3><p data-v-2f5a046e><strong data-v-2f5a046e>关联知识点</strong>：分治策略</p><p data-v-2f5a046e><strong data-v-2f5a046e>核心内容</strong>：MapReduce框架下的分治算法设计</p><p data-v-2f5a046e><strong data-v-2f5a046e>教学安排</strong>：</p><ol data-v-2f5a046e><li data-v-2f5a046e>算法分解：任务划分策略</li><li data-v-2f5a046e>并行实现：MapReduce编程</li><li data-v-2f5a046e>性能评估：加速比分析</li><li data-v-2f5a046e>应用讨论：大数据场景适用性</li></ol></div></div><div class="section" data-v-2f5a046e><h2 data-v-2f5a046e>四、分类培养方案</h2><p data-v-2f5a046e>针对专业型硕士和学术型硕士的不同培养目标，设计差异化教学内容。</p><div class="two-columns" data-v-2f5a046e><div class="column learning-path" data-v-2f5a046e><h3 data-v-2f5a046e>专业型硕士培养路径</h3><p data-v-2f5a046e><strong data-v-2f5a046e>培养目标</strong>：算法工程实现能力、实际问题解决能力</p><p data-v-2f5a046e><strong data-v-2f5a046e>教学重点</strong>：</p><ul data-v-2f5a046e><li data-v-2f5a046e>算法实现技巧与优化</li><li data-v-2f5a046e>工业界案例分析</li><li data-v-2f5a046e>性能调优与工程实践</li><li data-v-2f5a046e>团队协作开发</li></ul><p data-v-2f5a046e><strong data-v-2f5a046e>评估方式</strong>：</p><ol data-v-2f5a046e><li data-v-2f5a046e>竞赛项目实战</li><li data-v-2f5a046e>算法优化报告</li><li data-v-2f5a046e>系统性能评测</li></ol></div><div class="column learning-path" data-v-2f5a046e><h3 data-v-2f5a046e>学术型硕士培养路径</h3><p data-v-2f5a046e><strong data-v-2f5a046e>培养目标</strong>：算法理论研究能力、创新思维能力</p><p data-v-2f5a046e><strong data-v-2f5a046e>教学重点</strong>：</p><ul data-v-2f5a046e><li data-v-2f5a046e>算法正确性证明</li><li data-v-2f5a046e>复杂度分析理论</li><li data-v-2f5a046e>前沿论文研读</li><li data-v-2f5a046e>算法改进与创新</li></ul><p data-v-2f5a046e><strong data-v-2f5a046e>评估方式</strong>：</p><ol data-v-2f5a046e><li data-v-2f5a046e>学术论文阅读报告</li><li data-v-2f5a046e>理论证明作业</li><li data-v-2f5a046e>研究性课题论文</li></ol></div></div><table data-v-2f5a046e><tr data-v-2f5a046e><th data-v-2f5a046e>教学环节</th><th data-v-2f5a046e>专业型硕士</th><th data-v-2f5a046e>学术型硕士</th></tr><tr data-v-2f5a046e><td data-v-2f5a046e>案例教学</td><td data-v-2f5a046e>70%课时</td><td data-v-2f5a046e>40%课时</td></tr><tr data-v-2f5a046e><td data-v-2f5a046e>理论证明</td><td data-v-2f5a046e>20%课时</td><td data-v-2f5a046e>50%课时</td></tr><tr data-v-2f5a046e><td data-v-2f5a046e>论文研读</td><td data-v-2f5a046e>10%课时</td><td data-v-2f5a046e>40%课时</td></tr><tr data-v-2f5a046e><td data-v-2f5a046e>实践项目</td><td data-v-2f5a046e>必做</td><td data-v-2f5a046e>选做</td></tr><tr data-v-2f5a046e><td data-v-2f5a046e>研究论文</td><td data-v-2f5a046e>选做</td><td data-v-2f5a046e>必做</td></tr></table></div><div class="section" data-v-2f5a046e><h2 data-v-2f5a046e>五、课程评估与反馈</h2><p data-v-2f5a046e>建立多元化的课程评估体系，持续改进教学质量。</p><h3 data-v-2f5a046e>1. 学生评估方式</h3><ul data-v-2f5a046e><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>平时作业</span>：算法实现与理论证明(30%)</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>期中项目</span>：竞赛案例解决方案(20%)</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>期末考核</span>：综合设计与理论分析(30%)</li><li data-v-2f5a046e><span class="highlight" data-v-2f5a046e>课堂参与</span>：讨论与报告(20%)</li></ul><h3 data-v-2f5a046e>2. 教学反馈机制</h3><ul data-v-2f5a046e><li data-v-2f5a046e>每周在线问卷调查</li><li data-v-2f5a046e>每月师生座谈会</li><li data-v-2f5a046e>课程内容动态调整</li><li data-v-2f5a046e>竞赛成绩追踪分析</li></ul></div>',6)]))}const qn=de(Rn,[["render",Mn],["__scopeId","data-v-2f5a046e"]]),Fn={class:"sh-main"},Kn=ce({__name:"View404",setup(e){let l=Se(),n=c(l.fullPath);return(i,o)=>{const h=O;return V(),ee("div",Fn,[R("p",null,q(fe(n)),1),o[2]||(o[2]=R("p",null,"该页面无效或已被迁移，请重新选择访问目标",-1)),t(h,{theme:"primary",onClick:o[0]||(o[0]=()=>i.$router.push("/"))},{default:a(()=>o[1]||(o[1]=[I("返回首页")])),_:1})])}}}),Ea=de(Kn,[["__scopeId","data-v-d4218944"]]);function Nn(e){const l={};return l.id=e.id,l.username=e.username,l.nickname=e.nickname,l.email=e.email,l.slogan=e.slogan,l.organization=e.organization,l.accept=e.accept,l.attempt=e.attempt,l.vjudgeId=e.vjudge_id,e.email&&(l.avatar=`https://www.gravatar.com/avatar/${Ya(e.email.toLowerCase().trim())}?d=identicon&s=100`),l}function On(e,l){return G({url:"/user/login",method:"post",data:{username:e,password:l}})}function Gn(){return G({url:"/user/login/refresh",method:"post"})}function Hn(e){const l={username:e};return G({url:`/user/info?${new URLSearchParams(l).toString()}`,method:"get"})}function Bn(e){const l="https://vjudge.net/user/solveDetail/"+encodeURIComponent(e);return Vt({url:l,method:"get"})}function Jn(e){return G({url:"/user/account/infos",method:"post",data:{users:e}})}function Wn(e){return G({url:"/user/parse",method:"post",data:{users:e}})}function Yn(e,l){return G({url:"/user/register/email",method:"post",data:{token:e,email:l}})}function Xn(e,l,n,i,o){return G({url:"/user/register",method:"post",data:{username:e,password:l,email:n,key:i,nickname:o}})}function Zn(e,l){return G({url:"/user/forget",method:"post",data:{token:e,username:l}})}function Qn(e,l,n){return G({url:"/user/password/modify",method:"post",data:{username:e,password:l,key:n}})}const eo={class:"dida-login-footer"},to=ce({__name:"LoginView",setup(e){const{globalProperties:l}=_e(),n=qe(),i=c(!1),o=c({username:"",password:""}),h=()=>{ye(l,"重置成功")},b=({validateResult:w,firstError:m})=>{i.value||(i.value=!0,On(o.value.username,o.value.password).then(s=>{if(s.code===0){n.loadResponse(s.data),ye(l,"登录成功");let U=l.$route.query.redirect_uri;U||(U="/user/"+s.data.username),l.$router.push({path:U})}else K(l,s.code)}).catch(s=>{console.error("Login error",s),ge(l,"登录失败")}).finally(()=>{i.value=!1}))};return pe(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),(w,m)=>{const s=Re,U=ze,p=O,T=Ae,S=ot,y=be;return V(),M(y,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(T,{ref:"form",data:o.value,colon:!0,onReset:h,onSubmit:b,class:"yj-login-form","label-width":0},{default:a(()=>[t(U,{name:"username"},{default:a(()=>[t(s,{modelValue:o.value.username,"onUpdate:modelValue":m[0]||(m[0]=C=>o.value.username=C),clearable:"",autocomplete:"username",placeholder:"请输入用户名"},{"prefix-icon":a(()=>[t(fe(Xa))]),_:1},8,["modelValue"])]),_:1}),t(U,{name:"password"},{default:a(()=>[t(s,{modelValue:o.value.password,"onUpdate:modelValue":m[1]||(m[1]=C=>o.value.password=C),type:"password",autocomplete:"current-password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":a(()=>[t(fe(Za))]),_:1},8,["modelValue"])]),_:1}),t(U,null,{default:a(()=>[t(p,{theme:"primary",type:"submit",block:"",loading:i.value},{default:a(()=>m[4]||(m[4]=[I("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),R("div",eo,[t(S,{onClick:m[2]||(m[2]=()=>{fe(l).$router.push({name:"login-forget"})})},{default:a(()=>m[5]||(m[5]=[I("忘记密码 ")])),_:1}),t(S,{onClick:m[3]||(m[3]=()=>{fe(l).$router.push({name:"register"})})},{default:a(()=>m[6]||(m[6]=[I("注册账户 ")])),_:1})])]),_:1})}}}),ao=de(to,[["__scopeId","data-v-0466c42d"]]),lo={class:"dida-login-footer"},no=ce({__name:"RegisterView",setup(e){const{globalProperties:l}=_e(),n=qe(),i=c(!1),o=c(!1),h=c(!1),b=c("发送验证码");let w=null,m=-1;const s=c(!1),U=c(null),p=c({username:"",password:"",confirmPassword:"",nickname:"",email:"",emailKey:""}),S=c({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:d=>new Promise(r=>{const A=setTimeout(()=>{r(p.value.password===d),clearTimeout(A)})}),message:"两次密码不一致"}],nickname:[{required:!0,message:"请填写昵称"},{min:1,message:"昵称至少1个字符"},{max:30,message:"昵称最多30个字符"}],email:[{required:!0,message:"请填写邮箱"},{pattern:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"邮箱格式不正确"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),y=c(()=>t(O,{onClick:C,disabled:h.value,loading:o.value,style:"width:120px"},{default:()=>[b.value]})),C=async()=>{var v;if(!p.value.email){ge(l,"请输入邮箱");return}if(!p.value.email.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)){ge(l,"邮箱格式不正确");return}if(h.value||o.value)return;s.value=!0,await ft();const d=document.getElementById("cf-confirm-div");d&&d.remove();const r=document.createElement("div");r.id="cf-confirm-div",r.setAttribute("data-theme","light"),(v=U.value)==null||v.appendChild(r);const A=window;A.turnstile.ready(function(){A.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function($){s.value=!1,await u($)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},u=async d=>{if(!h.value){o.value=!0;try{const r=await Yn(d,p.value.email);if(r.code!==0){K(l,r.code);return}ye(l,"发送验证码成功"),o.value=!1,h.value=!0,w=new Date,b.value="60秒后重发",m=setInterval(()=>{const v=Math.floor((new Date().getTime()-(w==null?void 0:w.getTime()))/1e3);v>60?(b.value="发送验证码",h.value=!1,clearInterval(m)):b.value=`${60-v}秒后重发`},1e3)}catch{ge(l,"发送验证码失败")}finally{o.value=!1}}},g=()=>{ye(l,"重置成功")},f=({validateResult:d,firstError:r,e:A})=>{if(!i.value){if(A.preventDefault(),d!==!0){ge(l,r);return}if(p.value.password!==p.value.confirmPassword){ge(l,"两次密码不一致");return}i.value=!0,Xn(p.value.username,p.value.password,p.value.email,p.value.emailKey,p.value.nickname).then(v=>{v.code===0?(ye(l,"注册成功，可使用账号信息登录"),l.$router.push({name:"login"})):K(l,v.code)}).catch(v=>{console.error("Login error",v),ge(l,"登录失败")}).finally(()=>{i.value=!1})}};return pe(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),Ve(()=>{clearInterval(m)}),(d,r)=>{const A=Re,v=ze,$=wa,L=O,_=Ae,k=ot,D=be,x=st;return V(),ee(me,null,[t(D,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(_,{ref:"form",rules:S.value,data:p.value,colon:!0,onReset:g,onSubmit:f,class:"yj-login-form"},{default:a(()=>[t(v,{name:"username",label:"用户名"},{default:a(()=>[t(A,{modelValue:p.value.username,"onUpdate:modelValue":r[0]||(r[0]=P=>p.value.username=P),clearable:"",placeholder:"用于登录与查找"},null,8,["modelValue"])]),_:1}),t(v,{name:"password",label:"密码"},{default:a(()=>[t(A,{modelValue:p.value.password,"onUpdate:modelValue":r[1]||(r[1]=P=>p.value.password=P),type:"password",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(v,{name:"confirmPassword",label:"确认密码"},{default:a(()=>[t(A,{modelValue:p.value.confirmPassword,"onUpdate:modelValue":r[2]||(r[2]=P=>p.value.confirmPassword=P),type:"password",clearable:"",placeholder:"请确认密码"},null,8,["modelValue"])]),_:1}),t(v,{name:"nickname",label:"昵称"},{default:a(()=>[t(A,{modelValue:p.value.nickname,"onUpdate:modelValue":r[3]||(r[3]=P=>p.value.nickname=P),clearable:"",placeholder:"用于优先在网站各处展示"},null,8,["modelValue"])]),_:1}),t(v,{name:"email",label:"邮箱"},{default:a(()=>[t(A,{modelValue:p.value.email,"onUpdate:modelValue":r[4]||(r[4]=P=>p.value.email=P),clearable:"",placeholder:"请填写常用邮箱"},null,8,["modelValue"])]),_:1}),t(v,{name:"emailKey",label:"验证码"},{default:a(()=>[t($,{append:y.value},{default:a(()=>[t(A,{modelValue:p.value.emailKey,"onUpdate:modelValue":r[5]||(r[5]=P=>p.value.emailKey=P),clearable:"",placeholder:"请输入验证码",style:{width:"140px"}},null,8,["modelValue"])]),_:1},8,["append"])]),_:1}),t(v,null,{default:a(()=>[t(L,{theme:"primary",type:"submit",block:"",loading:i.value},{default:a(()=>r[8]||(r[8]=[I("注册")])),_:1},8,["loading"])]),_:1})]),_:1},8,["rules","data"]),R("div",lo,[t(k,{onClick:r[6]||(r[6]=()=>{fe(l).$router.push({name:"login"})})},{default:a(()=>r[9]||(r[9]=[I("返回登陆 ")])),_:1})])]),_:1}),t(x,{visible:s.value,"onUpdate:visible":r[7]||(r[7]=P=>s.value=P),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:a(()=>[R("div",{ref_key:"dialogContainer",ref:U,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),oo=de(no,[["__scopeId","data-v-d25e7538"]]),so={key:0},ro={key:0,style:{margin:"10px"}},io={key:1,style:{margin:"10px"}},uo={style:{margin:"12px"}},co=ce({__name:"UserView",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze(),o=qe();let h="";const b=c(!1),w=c(null),m=c([]);let s=null;const U=c([]),p=c([]),T=C=>{if(o.getUsername===h)return"success";let u="default";if(!s)return u;const g=s[C];if(g)switch(g){case Le.Accept:u="success";break;case Le.Attempt:u="warning";break}return u},S=async()=>{if(s={},!o.isLogin()||o.getUsername===h||m.value.length===0)return;const C=await za(m.value);C.code===0?s=C.data:K(n,C.code,C.data)},y=async C=>{b.value=!0;try{let u=await Hn(C);if(u.code!==0){b.value=!1,K(n,u.code),await X.push({name:"home"});return}w.value=Nn(u.data.user);const g=u.data.problems_ac;if(g.sort((f,d)=>f.length===d.length?f.localeCompare(d):f.length-d.length),m.value=g,i.setTitle(w.value.nickname+" - "+i.getTitle),w.value.vjudgeId){const f=await Bn(w.value.vjudgeId);U.value=f.acRecords;for(const d in U.value)U.value[d].sort((r,A)=>r.length===A.length?r.localeCompare(A):r.length-A.length);p.value=f.failRecords;for(const d in p.value)p.value[d].sort((r,A)=>r.length===A.length?r.localeCompare(A):r.length-A.length)}await S()}catch{ge(n,"获取用户信息失败"),await X.push({name:"home"})}finally{b.value=!1}};return Qa(async(C,u,g)=>{if(Array.isArray(C.params.username)?h=C.params.username[0]:h=C.params.username,!h){await X.push({name:"home"});return}await y(h),g()}),pe(async()=>{if(Array.isArray(l.params.username)?h=l.params.username[0]:h=l.params.username,!h){await X.push({name:"home"});return}await y(h)}),(C,u)=>{const g=O,f=be,d=ot,r=Ye,A=We,v=xe,$=kl,L=Pe,_=De;return V(),M(_,{loading:b.value},{default:a(()=>[t(L,{class:"dida-main-content"},{default:a(()=>[t(v,{span:8},{default:a(()=>{var k;return[t(f,{style:{margin:"10px"},title:"AC题目"},{default:a(()=>[m.value.length===0?(V(),ee("p",so,u[0]||(u[0]=[R("span",null,"暂无AC题目",-1)]))):(V(!0),ee(me,{key:1},Te(m.value,D=>(V(),M(g,{class:"dida-tag-button",key:D,size:"small",variant:"dashed",theme:T(D),onClick:()=>fe(X).push({name:"problem-detail",params:{problemId:D}})},{default:a(()=>[I(q(D),1)]),_:2},1032,["theme","onClick"]))),128))]),_:1}),(k=w.value)!=null&&k.vjudgeId?(V(),M(f,{key:0,style:{margin:"10px"},title:"vjudge.net"},{actions:a(()=>{var D;return[t(d,{href:"https://vjudge.net/user/"+((D=w.value)==null?void 0:D.vjudgeId),target:"_blank"},{default:a(()=>{var x;return[I("@"+q((x=w.value)==null?void 0:x.vjudgeId),1)]}),_:1},8,["href"])]}),default:a(()=>[U.value&&Object.keys(U.value).length>0?(V(),ee("div",ro,[u[1]||(u[1]=R("div",{style:{margin:"5px"}},[R("span",null,"AC")],-1)),t(A,{layout:"vertical",bordered:!0},{default:a(()=>[(V(!0),ee(me,null,Te(U.value,(D,x)=>(V(),M(r,{key:x,label:x},{default:a(()=>[(V(!0),ee(me,null,Te(D,P=>(V(),M(g,{class:"dida-tag-button",key:P,variant:"dashed",size:"small",onClick:()=>fe(X).push({name:"problem-detail",params:{problemId:x+"-"+P}})},{default:a(()=>[I(q(P),1)]),_:2},1032,["onClick"]))),128))]),_:2},1032,["label"]))),128))]),_:1})])):ae("",!0),p.value&&Object.keys(p.value).length>0?(V(),ee("div",io,[u[2]||(u[2]=R("div",{style:{margin:"5px"}},[R("span",null,"Fail")],-1)),t(A,{layout:"vertical",bordered:!0},{default:a(()=>[(V(!0),ee(me,null,Te(p.value,(D,x)=>(V(),M(r,{key:x,label:x},{default:a(()=>[(V(!0),ee(me,null,Te(D,P=>(V(),M(g,{class:"dida-tag-button",key:P,variant:"dashed",size:"small",onClick:()=>fe(X).push({name:"problem-detail",params:{problemId:x+"-"+P}})},{default:a(()=>[I(q(P),1)]),_:2},1032,["onClick"]))),128))]),_:2},1032,["label"]))),128))]),_:1})])):ae("",!0)]),_:1})):ae("",!0)]}),_:1}),t(v,{span:4},{default:a(()=>[R("div",uo,[t(A,{layout:"vertical",bordered:!0},{default:a(()=>[t(r,{label:"头像"},{default:a(()=>{var k;return[t($,{shape:"round",size:"100px",image:(k=w.value)==null?void 0:k.avatar,"hide-on-load-failed":!1},null,8,["image"])]}),_:1}),t(r,{label:"昵称"},{default:a(()=>{var k;return[I(q((k=w.value)==null?void 0:k.nickname),1)]}),_:1}),t(r,{label:"Slogan"},{default:a(()=>{var k;return[I(q((k=w.value)==null?void 0:k.slogan),1)]}),_:1}),t(r,{label:"邮箱"},{default:a(()=>{var k;return[I(q((k=w.value)==null?void 0:k.email),1)]}),_:1}),t(r,{label:"组织"},{default:a(()=>{var k;return[I(q((k=w.value)==null?void 0:k.organization),1)]}),_:1}),t(r,{label:"通过数量"},{default:a(()=>{var k;return[I(q((k=w.value)==null?void 0:k.accept),1)]}),_:1}),t(r,{label:"提交数量"},{default:a(()=>{var k;return[I(q((k=w.value)==null?void 0:k.attempt),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),mo=de(co,[["__scopeId","data-v-d84ade9e"]]),Jt=[{name:"home",path:"/",title:"首页",showSidebar:!1,disableGenerateTab:!0,component:zn},{name:"problem",path:"/problem",title:"题目",icon:"calculation",showSidebar:!0,redirect:"problem-list"},{name:"collection-detail-tab",title:"题集",path:"/collection",showSidebar:!0,disableGenerateTab:!0,redirect:"problem-collection-list"},{name:"judge",path:"/judge",title:"评测",icon:"code",showSidebar:!0,redirect:"judge-list"},{name:"contest",path:"/contest",title:"比赛",icon:"application",showSidebar:!0,redirect:"contest-list"},{name:"contest-detail-tab",title:"比赛",path:"/contest",showSidebar:!0,disableGenerateTab:!0,redirect:"contest-list"},{name:"discuss",title:"讨论",path:"/discuss",icon:"sonic",showSidebar:!0,redirect:"discuss-list"},{name:"discuss-detail-tab",title:"讨论",path:"/discuss",showSidebar:!0,disableGenerateTab:!0,redirect:"discuss-list"},{name:"rank",path:"/rank",title:"排名",icon:"chart-column",showSidebar:!0,redirect:"rank-ac-all"},{name:"study",path:"/study",title:"研习",icon:"book-open",showSidebar:!1,component:qn},{name:"system",path:"/system",title:"系统",icon:"dashboard",showSidebar:!0,redirect:"system-status"},{name:"manage",path:"/manage",title:"管理",icon:"command",showSidebar:!0,redirect:"manage-web",auths:[je.ManageWeb]},{name:"login",path:"/login",title:"登陆",showSidebar:!1,disableGenerateTab:!0,component:ao},{name:"register",path:"/register",title:"注册",showSidebar:!1,disableGenerateTab:!0,component:oo},{name:"user",path:"/user/:username+",title:"用户",showSidebar:!1,disableGenerateTab:!0,component:mo},{name:"404",path:"/404",title:"404",showSidebar:!1,disableGenerateTab:!0,component:Ea}],po=e=>Jt.find(l=>l.name==e),fo=e=>{const l=[];return Jt.forEach(n=>{!n.disableGenerateTab&&e.hasAllAuths(n.auths)&&l.push(n)}),l},vo=e=>{Jt.forEach(l=>{const n={name:l.name,path:l.path,meta:{title:l.title,tab:l.name,showSidebar:l.showSidebar,needLogin:l.needLogin,redirect:l.redirect,tabAuths:l.auths},component:l.component};e.push(n)})};function Ma(e){return e.children!==void 0}function _o(e){return e.children!==void 0}const go={style:{margin:"10px"}},bo={key:0,class:"dida-operation-container"};function ho(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!at(e)}const yo=ce({__name:"ProblemList",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e(),o=qe();let h=null;const b=c(!1),w={};let m={};const s=c(!1),U=Je(()=>o.hasAuth(je.ManageProblem)),p=c([{title:"ID",colKey:"id",cell:(z,j)=>{let E=v(j.row.id);return t(O,{variant:"dashed",theme:E,onClick:()=>A(j.row.id)},{default:()=>[j.row.id]})}},{title:"标题",colKey:"title",cell:(z,j)=>t(O,{variant:"text",onClick:()=>A(j.row.id)},{default:()=>[j.row.title]})},{title:"标签",colKey:"tags",cell:(z,j)=>{const E=j.row.tags;if(!E||E.length===0)return"";let N=[];for(let le=0;le<E.length;le++){const Y=E[le];N.push(t(O,{key:le,theme:"default",variant:"outline",size:"small",onClick:()=>k(Y)},{default:()=>[Y.name]}))}return t(we,null,ho(N)?N:{default:()=>[N]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),T=c(!1);let S=1,y=50;const C=c({current:S,pageSize:y,defaultCurrent:S,defaultPageSize:y,total:0,pageSizeOptions:[50,100]}),u=c(),g=c(),f=[{label:"DidaOJ",value:"didaoj"},{label:"HDU",value:"hdu"},{label:"POJ",value:"poj"},{label:"NYOJ",value:"nyoj"}],d=c({oj:"",title:"",tag:"",private:!1}),r=c({oj:"",problem:""}),A=z=>{z&&n.push({path:"/problem/"+z})},v=z=>{if(!z||!m)return"default";const j=m[z];if(!j)return"default";switch(j){case Le.Accept:return"success";case Le.Attempt:return"warning";default:return"default"}},$=async()=>{await n.push({query:{...l.query,oj:d.value.oj,title:d.value.title,tag:d.value.tag,private:d.value.private?"1":"0",page:1,page_size:C.value.defaultPageSize}})},L=async()=>{d.value.oj="",d.value.title="",d.value.tag="",d.value.private=!1,await n.push({query:{...l.query,oj:"",title:"",tag:"",private:"0",page:1,page_size:C.value.defaultPageSize}})},_=async()=>{try{s.value=!0;const z=await Ra(r.value.oj,r.value.problem);z.code===0?(ye(i,"搜索成功"),await n.push({name:"problem-detail",params:{problemId:z.data}})):K(i,z.code)}catch(z){console.error(z),K(i,He())}finally{s.value=!1}},k=z=>{z&&n.push({query:{...l.query,title:"",tag:z.name,page:1,page_size:C.value.defaultPageSize}})},D=()=>{n.push({name:"manage-problem-create"})},x=async(z,j)=>{T.value=!0;try{const{current:E,pageSize:N}=z,le=await bn(d.value.oj,d.value.title,d.value.tag,d.value.private,E,N);if(u.value=[],le.code===0){const Y=le.data.list;if(!Y||Y.length<=0){C.value={...C.value,total:0},m={},ye(i,"未找到记录");return}Y.forEach(te=>{var W;const Q=ht(te,w);(W=u.value)==null||W.push(Q)}),C.value={...C.value,total:le.data.total_count},m=le.data.problem_attempt_status}else j&&K(i,le.code)}catch(E){console.error(E),K(i,He())}finally{T.value=!1}},P=async z=>{await n.push({query:{...l.query,page:z.current,page_size:z.pageSize}})};return pe(async()=>{T.value=!0,g.value=[],Aa(-1).then(z=>{if(z.code===0){g.value=z.data.list,b.value=z.data.total_count>z.data.list.length;for(let j=0;j<z.data.list.length;j++){const E=z.data.list[j];w[E.id]=E}h=Ue(()=>l.query,j=>{d.value.oj=j.oj||"",d.value.title=j.title||"",d.value.tag=j.tag||"",d.value.private=j.private==="1";const E=parseInt(j.page)||C.value.defaultCurrent,N=parseInt(j.page_size)||C.value.defaultPageSize;S=E,y=N,C.value={...C.value,current:S,pageSize:y},x({current:S,pageSize:y},!0)},{immediate:!0})}else b.value=!0}).catch(z=>{console.error(z),b.value=!0})}),Ve(()=>{h&&h()}),(z,j)=>{const E=Fe,N=be,le=xe,Y=O,te=we,Q=gt,W=ze,he=Re,ie=bt,ue=Ae,J=Pe;return V(),M(J,null,{default:a(()=>[t(le,{span:9},{default:a(()=>[t(N,{style:{margin:"10px"}},{default:a(()=>[t(E,{data:u.value,columns:p.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:C.value,"table-layout":"auto",loading:T.value,onPageChange:P},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(le,{span:3},{default:a(()=>[R("div",go,[U.value?(V(),ee("div",bo,[t(te,null,{default:a(()=>[t(Y,{onClick:D},{default:a(()=>j[7]||(j[7]=[I("新建")])),_:1})]),_:1})])):ae("",!0),t(N,{class:"sh-card"},{default:a(()=>[t(ue,{model:d.value,onSubmit:$,onReset:L},{default:a(()=>[t(W,{label:"OJ"},{default:a(()=>[t(Q,{modelValue:d.value.oj,"onUpdate:modelValue":j[0]||(j[0]=F=>d.value.oj=F),options:f,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(W,{label:"标题"},{default:a(()=>[t(he,{modelValue:d.value.title,"onUpdate:modelValue":j[1]||(j[1]=F=>d.value.title=F),placeholder:"请输入关键词"},null,8,["modelValue"])]),_:1}),t(W,{label:"标签"},{default:a(()=>[t(he,{modelValue:d.value.tag,"onUpdate:modelValue":j[2]||(j[2]=F=>d.value.tag=F),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),U.value?(V(),M(W,{key:0,label:"私有"},{default:a(()=>[t(ie,{modelValue:d.value.private,"onUpdate:modelValue":j[3]||(j[3]=F=>d.value.private=F)},null,8,["modelValue"])]),_:1})):ae("",!0),t(W,null,{default:a(()=>[t(te,null,{default:a(()=>[t(Y,{theme:"primary",type:"submit"},{default:a(()=>j[8]||(j[8]=[I("搜索")])),_:1}),t(Y,{theme:"danger",type:"reset"},{default:a(()=>j[9]||(j[9]=[I("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(N,{class:"sh-card"},{default:a(()=>[t(ue,{model:r.value,onSubmit:_},{default:a(()=>[t(W,{label:"OJ"},{default:a(()=>[t(Q,{modelValue:r.value.oj,"onUpdate:modelValue":j[4]||(j[4]=F=>r.value.oj=F),options:f,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(W,{label:"题目"},{default:a(()=>[t(he,{modelValue:r.value.problem,"onUpdate:modelValue":j[5]||(j[5]=F=>r.value.problem=F),placeholder:"请输入原始题号"},null,8,["modelValue"])]),_:1}),t(W,null,{default:a(()=>[t(Y,{theme:"primary",type:"submit",loading:s.value},{default:a(()=>j[10]||(j[10]=[I("前往")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),t(N,{class:"sh-card sh-background-black"},{default:a(()=>[(V(!0),ee(me,null,Te(g.value,F=>(V(),M(Y,{class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:()=>k(F)},{default:a(()=>[I(q(F.name),1)]),_:2},1032,["onClick"]))),256)),b.value?(V(),M(Y,{key:0,class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:j[6]||(j[6]=()=>z.$router.push("/problem/tags"))},{default:a(()=>j[11]||(j[11]=[I(" ... ")])),_:1})):ae("",!0)]),_:1})])]),_:1})]),_:1})}}}),wo=de(yo,[["__scopeId","data-v-dbe06f89"]]);function tt(e){let l="";for(;e>0;)e--,l=String.fromCharCode(65+e%26)+l,e=Math.floor(e/26);return l}function Wt(e){const l={};if(l.id=e.id,l.ownerId=e.owner_id,l.ownerUsername=e.owner_username,l.ownerNickname=e.owner_nickname,l.title=e.title,l.startTime=new Date(e.start_time).toLocaleString(),l.endTime=new Date(e.end_time).toLocaleString(),l.createTime=new Date(e.create_time).toLocaleString(),l.updateTime=new Date(e.update_time).toLocaleString(),l.private=e.private,l.description=e.description,l.notification=e.notification,e.problems){l.problems=[],e.problems.sort((n,i)=>n.index-i.index);for(let n=0;n<e.problems.length;n++){const i=e.problems[n];let o={accept:0,attempt:0,author:"",id:"",private:!1,tags:[],title:""};o.index=i.index,o.id=tt(i.index),o.title=i.title,i.accept?o.accept=i.accept:o.accept=0,i.attempt?o.attempt=i.attempt:o.attempt=0,l.problems.push(o)}}return l}function ko(e){return G({url:"/contest?id="+e,method:"get"})}function So(e){return G({url:"/contest/edit?id="+e,method:"get"})}function Co(e){return G({url:"/contest/problem/list?id="+e,method:"get"})}function Io(e){return e||(e=0),G({url:"/contest/image/token?id="+e,method:"get"})}function Po(e,l){return G({url:"/contest/problem?id="+e+"&problem_index="+l,method:"get"})}function To(e,l,n,i){const o={};return e&&(o.title=e),l&&(o.username=l),n&&(o.page=String(n)),i&&(o.page_size=String(i)),G({url:`/contest/list?${new URLSearchParams(o).toString()}`,method:"get"})}function xo(e){return G({url:"/contest/rank?id="+e,method:"get"})}function Do(e){return G({url:"/contest/create",method:"post",data:e})}function Vo(e){return G({url:"/contest/edit",method:"post",data:e})}function $o(e,l){return G({url:"/contest/password",method:"post",data:{id:e,password:l}})}function jo(e){return G({url:"/contest/dolos",method:"post",data:{id:e}})}const Yt=async(e,l)=>{l&&await e.push({name:"user",params:{username:l}})},la=e=>{const l=X.resolve({name:"problem-detail",params:{problemId:e}});window.open(l.href,"_blank")},vt=async(e,l)=>{await X.push({name:"contest-problem-detail",params:{contestId:e,problemIndex:l}})},Lo={class:"sh-button"},Uo={style:{"margin-top":"16px"}},Ao={__name:"SecretPanel",setup(e){const l=c(!1);return(n,i)=>{const o=O;return V(),ee("div",ll(nl(n.$attrs)),[R("div",Lo,[t(o,{onClick:i[0]||(i[0]=h=>l.value=!l.value)},{default:a(()=>[I(q(l.value?"收起":"展开"),1)]),_:1})]),el(R("div",Uo,[al(n.$slots,"default",{},void 0)],512),[[tl,l.value]])],16)}}},na=de(Ao,[["__scopeId","data-v-83e9f414"]]),zo={key:1,style:{"text-align":"center"}},Ro={key:1,style:{"text-align":"center"}},Eo={key:0,class:"dida-problems-container"},Mo={style:{margin:"12px"}},qo={key:1},Fo={class:"dida-operation-container"},Ko={key:0,class:"dida-operation-container"},No={class:"dida-code-submit-div"},Oo={class:"dida-code-editor-div"},Go=ce({__name:"ProblemDetail",setup(e){let l=Se();const{globalProperties:n}=_e();let i=null;const o=Ze(),h=qe();let b=c(""),w="",m="",s=0,U=c(0);const p=c(!1),T=c(!1),S=c(!1),y=c(null);let C=null;const u=c(null),g=c(!1),f=c(!1),d={},r=c(""),A=c([]);A.value=Ht();const v=c([]),$=c(null),L=c(-1),_=c(-1),k=c(""),D=c("");let x=0;const P=Je(()=>h.hasAuth(je.ManageProblem)),z=Je(()=>h.hasAuth(je.ManageProblemDaily)),j=()=>{$.value&&clearInterval($.value),$.value=setInterval(()=>{const Z=L.value<=0,B=new Date(new Date().getTime()+x),oe=B.getHours()*60*60+B.getMinutes()*60+B.getSeconds(),ne=18*60*60;oe<ne?L.value=ne-oe:L.value=-1,_.value=24*60*60-oe,(!Z&&L.value<=0||_.value<=0)&&F()},1e3)},E=()=>{$.value&&(clearInterval($.value),$.value=null)},N=Z=>{Z&&X.push({name:"problem-list",query:{...l.query,title:"",tag:Z.name}})},le=async()=>{if(!m){ge(n,"每日问题ID无效");return}await X.push({name:"manage-problem-daily",params:{dailyId:m}})},Y=async()=>{let Z=w;if(!Z)try{const B=await Po(s,U.value);B.code===0?Z=B.data:K(n,B.code)}catch{ge(n,"获取题目ID失败，请稍后再试");return}await X.push({name:"manage-problem",params:{problemId:Z}})},te=()=>{w?X.push({name:"judge-list",query:{problem_id:w}}):X.push({name:"contest-judge",params:{contestId:s},query:{problem_id:tt(U.value)}})},Q=()=>{w?X.push({name:"discuss-list-problem",query:{problem_id:w}}):X.push({name:"contest-discuss",params:{contestId:s},query:{problem_id:tt(U.value)}})},W=()=>{X.push({name:"problem-recommend",params:{problemId:w}})},he=async()=>{var oe,ne;const Z=(oe=y.value)==null?void 0:oe.originOj,B=(ne=y.value)==null?void 0:ne.originId;if(!(!Z||!B))try{g.value=!0;const Ce=await Ra(Z,B);Ce.code===0?(await J(),ye(n,"更新成功")):K(n,Ce.code)}catch{ge(n,"更新失败，请稍后再试")}finally{g.value=!1}},ie=async()=>{const Z=parseInt(r.value);if(!St(Z)){ge(n,"请选择所编写的语言");return}const B=C==null?void 0:C.getValue();if(!B){ge(n,"请输入所需提交的代码");return}if(!w&&(!s||!U.value)){ge(n,"问题ID无效");return}f.value=!0;try{const oe=await rn(w,s,U.value,Z,B);if(oe.code!==0){K(n,oe.code);return}ye(n,"提交成功，正在跳转到详情页面");const ne=oe.data.id;s?await X.push({name:"contest-judge-detail",params:{contestId:s,judgeId:ne}}):await X.push({name:"judge-detail",params:{judgeId:ne}})}finally{f.value=!1}},ue=Z=>{if(!C)return;const B=C.getModel();B&&ta.setModelLanguage(B,Bt(Z))},J=async()=>{v.value=[];let Z=await Ua(w,s,U.value);if(Z.code!==0){S.value=!1,K(n,Z.code),await X.push({name:"problem"});return}Z.data.tags&&Z.data.tags.forEach(B=>{d[B.id]=B}),y.value=ht(Z.data.problem,d),o.setTitle(y.value.title+" - "+o.getTitle),s&&(Z=await Co(s),Z.code===0?(Z.data.problems.sort((B,oe)=>B-oe),v.value=Z.data.problems):K(n,Z.code)),b.value=y.value.description,await ft(()=>{!C&&u.value&&(C=ta.create(u.value,{value:"",language:"cpp",minimap:{enabled:!0},colorDecorators:!0,readOnly:!1,theme:"vs-dark"})),S.value=!1})},F=async()=>{E(),T.value=!1;const Z=await yn(m);if(Z.code!==0)return;T.value=!0;const B=Z.data.problem_daily;w=B.problem_id,k.value=B.solution,D.value=B.code;const oe=new Date(Z.data.time);x=oe.getTime()-new Date().getTime();const ne=new Date(oe.getTime()),Ce=ne.getFullYear(),Ie=String(ne.getMonth()+1).padStart(2,"0"),H=String(ne.getDate()).padStart(2,"0"),se=`${Ce}-${Ie}-${H}`;if(m===se){const ve=oe.getHours()*60*60+oe.getMinutes()*60+oe.getSeconds(),$e=18*60*60;ve<$e?L.value=$e-ve:L.value=-1,_.value=24*60*60-ve}(L.value>=0||_.value>=0)&&j()};return pe(async()=>{i=Ue(()=>l.params,async()=>{if(T.value=!1,Array.isArray(l.params.problemId)?w=l.params.problemId[0]:w=l.params.problemId,Array.isArray(l.params.dailyId)?m=l.params.dailyId[0]:m=l.params.dailyId,Array.isArray(l.params.contestId)?s=Number(l.params.contestId[0]):s=Number(l.params.contestId),!w&&m&&(S.value=!0,await F(),S.value=!1),!w)if(s){if(Array.isArray(l.params.problemIndex)?U.value=parseInt(l.params.problemIndex[0]):U.value=parseInt(l.params.problemIndex),!U.value){ge(n,"题目不存在"),await X.push({name:"contest-detail",params:{contestId:s}});return}}else ge(n,"题目不存在"),m?await X.push({name:"problem-daily-list"}):await X.push({name:"problem"});p.value=!!s,S.value=!0,await J()},{immediate:!0}),u.value&&new ResizeObserver(()=>{C&&C.layout()}).observe(u.value)}),Ve(()=>{i&&(i(),i=null),E()}),(Z,B)=>{const oe=Me("md-preview"),ne=be,Ce=Nt,Ie=we,H=xe,se=O,ve=Ye,$e=ot,Ee=We,ke=Ot,Ke=gt,lt=Pe,rt=De;return V(),M(rt,{loading:S.value},{default:a(()=>[t(lt,{class:"dida-main-content"},{default:a(()=>[t(H,{span:8},{default:a(()=>[t(ne,{style:{margin:"10px"}},{default:a(()=>[t(oe,{"model-value":fe(b),previewTheme:"cyanosis"},null,8,["model-value"])]),_:1}),T.value?(V(),M(ne,{key:0,style:{margin:"10px"},title:"题解"},{default:a(()=>[L.value<0?(V(),M(na,{key:0},{default:a(()=>[t(oe,{"model-value":k.value,previewTheme:"cyanosis"},null,8,["model-value"])]),_:1})):(V(),ee("div",zo,[R("div",null,[t(Ie,null,{default:a(()=>[B[2]||(B[2]=R("p",null,"距离解锁百分比",-1)),t(Ce,{theme:"circle",color:{from:"#0052D9",to:"#00A870"},percentage:100-L.value/(18*60*60)*100,status:"active"},{label:a(()=>[I(q((100-L.value/(18*60*60)*100).toFixed(3))+"% ",1)]),default:a(()=>[B[1]||(B[1]=I(" > "))]),_:1},8,["percentage"])]),_:1})])]))]),_:1})):ae("",!0),T.value?(V(),M(ne,{key:1,style:{margin:"10px"},title:"示例代码"},{default:a(()=>[_.value<0?(V(),M(na,{key:0},{default:a(()=>[t(oe,{"model-value":D.value,previewTheme:"cyanosis"},null,8,["model-value"])]),_:1})):(V(),ee("div",Ro,[R("div",null,[t(Ie,{style:{margin:"0 auto"}},{default:a(()=>[B[4]||(B[4]=R("p",null,"距离解锁百分比",-1)),t(Ce,{theme:"circle",color:{from:"#0052D9",to:"#00A870"},percentage:100-_.value/(24*60*60)*100,status:"active"},{label:a(()=>[I(q((100-_.value/(24*60*60)*100).toFixed(3))+"% ",1)]),default:a(()=>[B[3]||(B[3]=I(" > "))]),_:1},8,["percentage"])]),_:1})])]))]),_:1})):ae("",!0)]),_:1}),t(H,{span:4},{default:a(()=>{var nt;return[fe(s)?(V(),ee("div",Eo,[t(Ie,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(V(!0),ee(me,null,Te(v.value,(Ne,re)=>(V(),M(se,{key:re,theme:Ne==fe(U)?"primary":"default",onClick:async()=>await fe(vt)(fe(s),Ne)},{default:a(()=>[I(q(fe(tt)(Ne)),1)]),_:2},1032,["theme","onClick"]))),128))]),_:1})])):ae("",!0),R("div",Mo,[t(Ee,{layout:"vertical",bordered:!0},{default:a(()=>{var Ne;return[t(ve,{label:"ID"},{default:a(()=>{var re;return[I(q((re=y.value)==null?void 0:re.id),1)]}),_:1}),t(ve,{label:"标题"},{default:a(()=>{var re;return[I(q((re=y.value)==null?void 0:re.title),1)]}),_:1}),t(ve,{label:"时间限制"},{default:a(()=>{var re;return[I(q((re=y.value)==null?void 0:re.timeLimit),1)]}),_:1}),t(ve,{label:"内存限制"},{default:a(()=>{var re;return[I(q((re=y.value)==null?void 0:re.memoryLimit),1)]}),_:1}),t(ve,{label:"判题方式"},{default:a(()=>{var re;return[I(q((re=y.value)==null?void 0:re.judgeType),1)]}),_:1}),p.value?ae("",!0):(V(),M(ve,{key:0,label:"正确提交"},{default:a(()=>{var re;return[I(q((re=y.value)==null?void 0:re.accept),1)]}),_:1})),p.value?ae("",!0):(V(),M(ve,{key:1,label:"提交总数"},{default:a(()=>{var re;return[I(q((re=y.value)==null?void 0:re.attempt),1)]}),_:1})),t(ve,{label:"创建时间"},{default:a(()=>{var re;return[I(q((re=y.value)==null?void 0:re.insertTime),1)]}),_:1}),t(ve,{label:"更新时间"},{default:a(()=>{var re;return[I(q((re=y.value)==null?void 0:re.updateTime),1)]}),_:1}),t(ve,{label:"上传用户"},{default:a(()=>{var re;return[I(q((re=y.value)==null?void 0:re.creatorNickname),1)]}),_:1}),p.value?ae("",!0):(V(),M(ve,{key:2,label:"题目来源"},{default:a(()=>{var re,et,pt;return[(re=y.value)!=null&&re.sourceUrl?(V(),M($e,{key:0,href:(et=y.value)==null?void 0:et.sourceUrl,target:"_blank"},{default:a(()=>{var Qt;return[I(q((Qt=y.value)==null?void 0:Qt.source),1)]}),_:1},8,["href"])):(V(),ee("span",qo,q((pt=y.value)==null?void 0:pt.source),1))]}),_:1})),P.value?(V(),M(ve,{key:3,label:"是否私有"},{default:a(()=>{var re;return[I(q((re=y.value)!=null&&re.private?"私有":"公开"),1)]}),_:1})):ae("",!0),(Ne=y.value)!=null&&Ne.originUrl?(V(),M(ve,{key:4,label:"原题链接"},{default:a(()=>{var re;return[t($e,{href:(re=y.value)==null?void 0:re.originUrl,target:"_blank"},{default:a(()=>{var et,pt;return[I(q((et=y.value)==null?void 0:et.originOj)+" - "+q((pt=y.value)==null?void 0:pt.originId),1)]}),_:1},8,["href"])]}),_:1})):ae("",!0),fe(w)?(V(),M(ve,{key:5,label:"标签"},{default:a(()=>{var re;return[(V(!0),ee(me,null,Te((re=y.value)==null?void 0:re.tags,et=>(V(),M(se,{class:"dida-tag-button",key:et.id,variant:"dashed",size:"small",onClick:()=>N(et)},{default:a(()=>[I(q(et.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})):ae("",!0)]}),_:1}),R("div",Fo,[t(Ie,null,{default:a(()=>[t(se,{onClick:te},{default:a(()=>B[5]||(B[5]=[I("提交记录")])),_:1}),t(se,{onClick:Q},{default:a(()=>B[6]||(B[6]=[I("题目讨论")])),_:1}),fe(w)?(V(),M(se,{key:0,onClick:W},{default:a(()=>B[7]||(B[7]=[I("题目推荐")])),_:1})):ae("",!0)]),_:1})]),T.value&&z.value||P.value||(nt=y.value)!=null&&nt.originId?(V(),ee("div",Ko,[t(Ie,null,{default:a(()=>{var Ne;return[T.value&&z.value?(V(),M(se,{key:0,onClick:le},{default:a(()=>B[8]||(B[8]=[I("每日一题")])),_:1})):ae("",!0),P.value?(V(),M(se,{key:1,onClick:Y},{default:a(()=>B[9]||(B[9]=[I("编辑")])),_:1})):ae("",!0),(Ne=y.value)!=null&&Ne.originId?(V(),M(se,{key:2,onClick:he,loading:g.value},{default:a(()=>B[10]||(B[10]=[I("更新描述 ")])),_:1},8,["loading"])):ae("",!0)]}),_:1})])):ae("",!0),R("div",No,[t(Ie,null,{default:a(()=>[t(Ke,{modelValue:r.value,"onUpdate:modelValue":B[0]||(B[0]=Ne=>r.value=Ne),label:"语言：",placeholder:"请选择提交语言","auto-width":"",clearable:"",onChange:ue},{default:a(()=>[(V(!0),ee(me,null,Te(A.value,Ne=>(V(),M(ke,{key:Ne.value,value:Ne.value,label:Ne.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),t(se,{onClick:ie,loading:f.value},{default:a(()=>B[11]||(B[11]=[I("提交")])),_:1},8,["loading"])]),_:1}),R("div",Oo,[R("div",{ref_key:"codeEditRef",ref:u,class:"dida-code-editor"},null,512)])])])]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),Ut=de(Go,[["__scopeId","data-v-eed2fca5"]]),Ho={style:{margin:"10px"}},Bo={key:0,class:"dida-operation-container"};function Jo(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!at(e)}const Wo=ce({__name:"ProblemDailyList",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e(),o=qe();let h=!1,b=null,w={},m={};const s=Je(()=>o.hasAuth(je.ManageProblem)),U=c([{title:"日期",colKey:"id",cell:(_,k)=>t(O,{variant:"dashed",onClick:()=>g(k.row.id)},{default:()=>[k.row.id]})},{title:"ID",colKey:"problemId",cell:(_,k)=>{let D=f(k.row.problemId);return t(O,{variant:"dashed",theme:D,onClick:()=>g(k.row.id)},{default:()=>[k.row.problemId]})}},{title:"标题",colKey:"title",cell:(_,k)=>t(O,{variant:"text",onClick:()=>g(k.row.id)},{default:()=>[k.row.title]})},{title:"标签",colKey:"tags",cell:(_,k)=>{const D=k.row.tags;if(!D||D.length===0)return"";let x=[];for(let P=0;P<D.length;P++){const z=D[P];x.push(t(O,{key:P,theme:"default",variant:"outline",size:"small",onClick:()=>A(z)},{default:()=>[z.name]}))}return t(we,null,Jo(x)?x:{default:()=>[x]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),p=c(!1);let T=1,S=50;const y=c({current:T,pageSize:S,defaultCurrent:T,defaultPageSize:S,total:0,pageSizeOptions:[50,100]}),C=c([]),u=c({date:[],problemId:""}),g=_=>{_&&n.push({name:"problem-daily-detail",params:{dailyId:_}})},f=_=>{if(!_||!m)return"default";const k=m[_];if(!k)return"default";switch(k){case Le.Accept:return"success";case Le.Attempt:return"warning";default:return"default"}},d=async()=>{let _="";u.value.date&&u.value.date.length>1&&(_=u.value.date[0]+"~"+u.value.date[1]),await n.push({query:{...l.query,date:_,problem_id:u.value.problemId,page:1,page_size:y.value.defaultPageSize}})},r=async()=>{u.value.date=[],u.value.problemId="",await n.push({query:{...l.query,date:"",problem_id:"",page:1,page_size:y.value.defaultPageSize}})},A=_=>{_&&n.push({name:"problem-list",query:{...l.query,title:"",tag:_.name,page:1,page_size:y.value.defaultPageSize}})},v=()=>{n.push({name:"manage-problem-daily-create"})},$=async(_,k)=>{p.value=!0;try{const{current:D,pageSize:x}=_;let P="";u.value.date[0]&&(P=u.value.date[0]);let z="";u.value.date[1]&&(z=u.value.date[1]);const j=await Sn(P,z,u.value.problemId,D,x);if(C.value=[],j.code===0){const E=j.data.list;if(!E||E.length<=0){y.value={...y.value,total:0},m={},ye(i,"未找到记录");return}w={},j.data.tags&&j.data.tags.forEach(N=>{w[N.id]=N}),E.forEach(N=>{var Y;const le=La(N,w);(Y=C.value)==null||Y.push(le)}),y.value={...y.value,total:j.data.total_count},m=j.data.attempt_status}else k&&K(i,j.code)}catch(D){console.error(D),K(i,He())}finally{p.value=!1}},L=async _=>{await n.push({query:{...l.query,page:_.current,page_size:_.pageSize}})};return pe(async()=>{h=!0,p.value=!0,b=Ue(()=>l.query,_=>{if(!h)return;if(u.value.date=[],_.date){const x=_.date.split("~");x.length===2&&(u.value.date=[x[0],x[1]])}u.value.problemId=_.problem_id||"";const k=parseInt(_.page)||y.value.defaultCurrent,D=parseInt(_.page_size)||y.value.defaultPageSize;T=k,S=D,y.value={...y.value,current:T,pageSize:S},$({current:T,pageSize:S},!0)},{immediate:!0})}),Ve(()=>{h=!1,b&&b()}),(_,k)=>{const D=Fe,x=be,P=xe,z=O,j=we,E=Gt,N=ze,le=Re,Y=Ae,te=Pe;return V(),M(te,null,{default:a(()=>[t(P,{span:9},{default:a(()=>[t(x,{style:{margin:"10px"}},{default:a(()=>[t(D,{data:C.value,columns:U.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:y.value,"table-layout":"auto",loading:p.value,onPageChange:L},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(P,{span:3},{default:a(()=>[R("div",Ho,[s.value?(V(),ee("div",Bo,[t(j,null,{default:a(()=>[t(z,{onClick:v},{default:a(()=>k[2]||(k[2]=[I("新建")])),_:1})]),_:1})])):ae("",!0),t(x,{class:"sh-card"},{default:a(()=>[t(Y,{model:u.value,onSubmit:d,onReset:r},{default:a(()=>[t(N,{label:"日期","label-align":"top"},{default:a(()=>[t(E,{modelValue:u.value.date,"onUpdate:modelValue":k[0]||(k[0]=Q=>u.value.date=Q),"allow-input":"",clearable:"",format:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(N,{label:"问题","label-align":"top"},{default:a(()=>[t(le,{modelValue:u.value.problemId,"onUpdate:modelValue":k[1]||(k[1]=Q=>u.value.problemId=Q),placeholder:"请输入问题ID",clearable:""},null,8,["modelValue"])]),_:1}),t(N,{"label-align":"top"},{default:a(()=>[t(j,null,{default:a(()=>[t(z,{theme:"primary",type:"submit"},{default:a(()=>k[3]||(k[3]=[I("搜索")])),_:1}),t(z,{theme:"danger",type:"reset"},{default:a(()=>k[4]||(k[4]=[I("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(x,{class:"sh-card",header:"每日一题","header-bordered":!0},{default:a(()=>k[5]||(k[5]=[R("p",null,"由管理员团队精选的题目，每日0点更新。",-1),R("p",null,"当日下午6点提供题解，次日提供AC代码。",-1)])),_:1})])]),_:1})]),_:1})}}}),Yo=de(Wo,[["__scopeId","data-v-5e0bb3cc"]]),Xo={style:{margin:"10px"}},Zo={style:{margin:"12px"}},Qo={class:"dida-edit-container"},es=ce({__name:"ProblemDailyEdit",setup(e){let l=Se();const{globalProperties:n}=_e();let i=null;const o=c(""),h=c(!1),b=c(!1),w=c(null),m=c({date:"",problemId:"",solution:"",code:""}),s=()=>{X.push({name:"problem-daily-detail",params:{dailyId:o.value}})};async function U(u,g){b.value=!0,await ct(u,g,n,()=>Vn(o.value)),b.value=!1}const p=async()=>{b.value=!0;try{const u=m.value.date,g=await Pn(u,m.value.problemId,m.value.solution,m.value.code);if(b.value=!0,g.code!==0){K(n,g.code);return}await X.push({name:"manage-problem-daily",params:{dailyId:u}}),Ge(n,"创建成功")}finally{b.value=!1}},T=async()=>{b.value=!0;try{const u=await Tn(o.value,m.value.problemId,m.value.solution,m.value.code);if(b.value=!0,u.code!==0){K(n,u.code);return}w.value&&(u.data.update_time!=null&&(w.value.updateTime=new Date(u.data.update_time).toLocaleString()),u.data.updater_nickname!=null&&(w.value.updaterNickname=u.data.updater_nickname)),u.data.solution!=null&&(m.value.solution=u.data.solution),u.data.code!=null&&(m.value.code=u.data.code),Ge(n,"保存成功")}finally{b.value=!1}},S=u=>{m.value.solution=u,h.value=!1},y=u=>{m.value.code=u,h.value=!1},C=async()=>{const u=await wn(o.value);if(u.code!==0){K(n,u.code),console.error("problem get failed",u.code),await X.push({name:"problem-daily-list"});return}const g=u.data;w.value=La(g,{}),m.value.problemId=g.problem_id,S(g.solution),y(g.code)};return pe(async()=>{i=Ue(()=>l.params,async()=>{Array.isArray(l.params.dailyId)?o.value=l.params.dailyId[0]:o.value=l.params.dailyId,o.value?(h.value=!0,m.value.date=o.value,await C()):(S("暂无题解"),y("暂无标程"))},{immediate:!0})}),Ve(()=>{i&&(i(),i=null)}),(u,g)=>{const f=Tt,d=Sl,r=ze,A=Re,v=Ae,$=be,L=xe,_=O,k=we,D=Ye,x=We,P=Pe,z=Me("md-editor-v3"),j=De;return V(),M(j,{loading:h.value},{default:a(()=>[t(P,null,{default:a(()=>[t(L,{span:8},{default:a(()=>[R("div",Xo,[t(f,{theme:"info"},{default:a(()=>g[4]||(g[4]=[I("可以提前配置将来日期的题目，对外仅展示到截止到当天的题目")])),_:1}),t($,{class:"sh-form-card"},{default:a(()=>[t(v,{model:m.value},{default:a(()=>[t(r,{label:"日期"},{default:a(()=>[t(d,{modelValue:m.value.date,"onUpdate:modelValue":g[0]||(g[0]=E=>m.value.date=E),disabled:o.value&&!0},null,8,["modelValue","disabled"])]),_:1}),t(r,{label:"问题ID"},{default:a(()=>[t(A,{modelValue:m.value.problemId,"onUpdate:modelValue":g[1]||(g[1]=E=>m.value.problemId=E),placeholder:"问题标题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(L,{span:4},{default:a(()=>[R("div",Zo,[R("div",Qo,[o.value?(V(),M(k,{key:0},{default:a(()=>[t(_,{onClick:T,theme:"danger",loading:b.value},{default:a(()=>g[5]||(g[5]=[I("保存")])),_:1},8,["loading"]),t(_,{onClick:s},{default:a(()=>g[6]||(g[6]=[I("查看")])),_:1})]),_:1})):(V(),M(k,{key:1},{default:a(()=>[t(_,{onClick:p,theme:"danger",loading:b.value},{default:a(()=>g[7]||(g[7]=[I("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(V(),M(x,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(D,{label:"创建时间"},{default:a(()=>{var E;return[I(q((E=w.value)==null?void 0:E.createTime),1)]}),_:1}),t(D,{label:"更新时间"},{default:a(()=>{var E;return[I(q((E=w.value)==null?void 0:E.updateTime),1)]}),_:1}),t(D,{label:"创建用户"},{default:a(()=>{var E;return[I(q((E=w.value)==null?void 0:E.creatorNickname),1)]}),_:1}),t(D,{label:"更新用户"},{default:a(()=>{var E;return[I(q((E=w.value)==null?void 0:E.updaterNickname),1)]}),_:1})]),_:1})):ae("",!0)])]),_:1})]),_:1}),R("div",null,[g[8]||(g[8]=R("p",{style:{"margin-left":"20px"}},"题解：",-1)),t(z,{id:"daily-solution-editor",modelValue:m.value.solution,"onUpdate:modelValue":g[2]||(g[2]=E=>m.value.solution=E),onSave:T,onOnUploadImg:U,previewTheme:"cyanosis"},null,8,["modelValue"]),t(j,{loading:b.value,attach:"#daily-solution-editor","z-index":1e5},null,8,["loading"])]),R("div",null,[g[9]||(g[9]=R("p",{style:{"margin-left":"20px"}},"标程：",-1)),t(z,{id:"daily-code-editor",modelValue:m.value.code,"onUpdate:modelValue":g[3]||(g[3]=E=>m.value.code=E),onSave:T,onOnUploadImg:U,previewTheme:"cyanosis"},null,8,["modelValue"]),t(j,{loading:b.value,attach:"#daily-code-editor","z-index":1e5},null,8,["loading"])])]),_:1},8,["loading"])}}}),oa=de(es,[["__scopeId","data-v-1b272466"]]),ts={style:{margin:"10px"}};function as(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!at(e)}const ls=ce({__name:"ProblemRecommend",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=null,h="",b={},w={};const m=c([{title:"ID",colKey:"id",cell:(C,u)=>{let g=T(u.row.id);return t(O,{variant:"dashed",theme:g,onClick:()=>p(u.row.id)},{default:()=>[u.row.id]})}},{title:"标题",colKey:"title",cell:(C,u)=>t(O,{variant:"text",onClick:()=>p(u.row.id)},{default:()=>[u.row.title]})},{title:"标签",colKey:"tags",cell:(C,u)=>{const g=u.row.tags;if(!g||g.length===0)return"";let f=[];for(let d=0;d<g.length;d++){const r=g[d];f.push(t(O,{key:d,theme:"default",variant:"outline",size:"small",onClick:()=>S(r)},{default:()=>[r.name]}))}return t(we,null,as(f)?f:{default:()=>[f]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),s=c(!1),U=c(),p=C=>{C&&n.push({path:"/problem/"+C})},T=C=>{if(!C||!w)return"default";const u=w[C];if(!u)return"default";switch(u){case Le.Accept:return"success";case Le.Attempt:return"warning";default:return"default"}},S=C=>{C&&n.push({name:"problem-list",query:{tag:C.name}})},y=async C=>{s.value=!0;try{const u=await hn(h);if(U.value=[],u.code===0){const g=u.data.list;if(!g||g.length<=0){ye(i,"暂无推荐题目");return}b={},u.data.tags&&u.data.tags.forEach(f=>{b[f.id]=f}),g.forEach(f=>{var r;const d=ht(f,b);(r=U.value)==null||r.push(d)})}else C&&K(i,u.code)}catch(u){console.error(u),K(i,He())}finally{s.value=!1}};return pe(async()=>{s.value=!0,o=Ue(()=>l.query,C=>{Array.isArray(l.params.problemId)?h=l.params.problemId[0]:h=l.params.problemId,y(!0)},{immediate:!0})}),Ve(()=>{o&&o()}),(C,u)=>{const g=Fe,f=be,d=xe,r=Pe;return V(),M(r,null,{default:a(()=>[t(d,{span:9},{default:a(()=>[t(f,{style:{margin:"10px"}},{default:a(()=>[t(g,{data:U.value,columns:m.value,"row-key":"id","vertical-align":"top",hover:!0,"table-layout":"auto",loading:s.value},null,8,["data","columns","loading"])]),_:1})]),_:1}),t(d,{span:3},{default:a(()=>[R("div",ts,[t(f,{class:"sh-card",header:"题目推荐","header-bordered":!0},{default:a(()=>u[0]||(u[0]=[I(" 根据本站其他用户的提交记录推荐类似题目"),R("br",null,null,-1),I("依据推荐算法来计算，与本用户相似度最高的用户做的题，大概率被自己感兴趣。 ")])),_:1})])]),_:1})]),_:1})}}}),ns=de(ls,[["__scopeId","data-v-77972e8b"]]),os={style:{margin:"10px"}},ss={key:1},rs={style:{margin:"12px"}},is={class:"dida-edit-container"},us={class:"dida-description-editor"},ds=ce({__name:"ProblemEdit",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze(),o=c(""),h=c(!1),b=c(!1),w=c(!1),m=c(null),s=c({title:"",timeLimit:0,memoryLimit:0,source:"",private:!0,tags:[],description:""}),U=c([]),p=c([]),T=Je(()=>{const v=[],$=U.value;for(let L=0,_=$.length;L<_;L++)$[L].value&&v.push($[L].value);return v}),S=(v,$)=>{const{trigger:L,index:_,item:k}=$;if(L==="clear"&&(U.value=[]),["tag-remove","backspace"].includes(L)&&U.value.splice(_,1),L==="enter"){for(let x=0;x<p.value.length;x++){const P=p.value[x];if(P.label===k){for(let z=0;z<U.value.length;z++)if(U.value[z].label===P.label)return;U.value.push(P);return}}const D={label:k,value:k};U.value.push(D),p.value=p.value.concat(D)}},y=(v,{current:$,type:L})=>{if(!$){U.value=L==="check"?p.value.slice(1):[];return}if(L==="check"){const _=p.value.find(k=>k.value===$);if(!_)return;U.value.push(_)}else U.value=U.value.filter(_=>_.value!==$)},C=()=>{X.push({name:"problem-detail",params:{problemId:o.value}})},u=()=>{X.push({name:"manage-problem-judge",params:{problemId:o.value}})},g=async(v,$)=>{w.value=!0,await ct(v,$,n,()=>Dn(o.value)),w.value=!1},f=async()=>{b.value=!0,s.value.tags=[];for(let v=0;v<U.value.length;v++){const $=U.value[v];$&&$.label&&s.value.tags.push($.label)}try{const v=await Cn(s.value.title,s.value.timeLimit,s.value.memoryLimit,s.value.source,s.value.private,s.value.tags,s.value.description);if(b.value=!0,v.code!==0){K(n,v.code);return}v.data!=null&&await X.push({name:"problem-detail",params:{problemId:v.data}}),Ge(n,"创建成功")}finally{b.value=!1}},d=async()=>{b.value=!0,s.value.tags=[];for(let v=0;v<U.value.length;v++){const $=U.value[v];$&&$.label&&s.value.tags.push($.label)}try{const v=await In(o.value,s.value.title,s.value.timeLimit,s.value.memoryLimit,s.value.source,s.value.private,s.value.tags,s.value.description);if(b.value=!0,v.code!==0){K(n,v.code);return}m.value&&v.data.update_time!=null&&(m.value.updateTime=new Date(v.data.update_time).toLocaleString()),v.data.description!=null&&(s.value.description=v.data.description),Ge(n,"保存成功")}finally{b.value=!1}},r=v=>{s.value.description=v,h.value=!1},A=async()=>{const v=await Ua(o.value,void 0,void 0);if(v.code!==0){K(n,v.code),console.error("problem get failed",v.code),await X.push({name:"problem"});return}const $=v.data.problem;if(m.value=ht($,{}),s.value.title=$.title,s.value.timeLimit=$.time_limit,s.value.memoryLimit=$.memory_limit,s.value.source=$.source,s.value.private=$.private,s.value.tags=[],U.value=[],v.data.tags)for(let _=0;_<v.data.tags.length;_++){const k=v.data.tags[_];k&&k.name&&(s.value.tags.push(k.name),U.value.push({label:k.name,value:k.id}))}i.setTitle($.title+" - "+i.getTitle);let L=$.description;r(L)};return pe(async()=>{Array.isArray(l.params.problemId)?o.value=l.params.problemId[0]:o.value=l.params.problemId,o.value?(h.value=!0,Aa(-1).then(async v=>{v.code===0?(v.data.list&&v.data.list.forEach($=>{p.value.push({label:$.name,value:$.id})}),await A()):(K(n,v.code),console.error("problem tag get failed",v.code),await X.push({name:"problem"}))}).catch(async v=>{console.error(v),K(n,"获取数据异常"),await X.push({name:"problem"})})):(s.value.timeLimit=1e3,s.value.memoryLimit=65536,r(""))}),(v,$)=>{const L=Re,_=ze,k=ka,D=bt,x=Il,P=Cl,z=Ae,j=be,E=xe,N=O,le=we,Y=Ye,te=We,Q=Pe,W=Me("md-editor-v3"),he=De;return V(),M(he,{loading:h.value},{default:a(()=>[t(Q,null,{default:a(()=>[t(E,{span:8},{default:a(()=>[R("div",os,[t(j,{class:"sh-card"},{default:a(()=>[t(z,{model:s.value},{default:a(()=>[t(_,{label:"标题"},{default:a(()=>[t(L,{modelValue:s.value.title,"onUpdate:modelValue":$[0]||($[0]=ie=>s.value.title=ie),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),t(_,{label:"时间限制"},{default:a(()=>[t(k,{modelValue:s.value.timeLimit,"onUpdate:modelValue":$[1]||($[1]=ie=>s.value.timeLimit=ie),theme:"normal",min:0},{suffix:a(()=>$[6]||($[6]=[R("span",null,"ms",-1)])),_:1},8,["modelValue"])]),_:1}),t(_,{label:"内存限制"},{default:a(()=>[t(k,{modelValue:s.value.memoryLimit,"onUpdate:modelValue":$[2]||($[2]=ie=>s.value.memoryLimit=ie),theme:"normal",min:0},{suffix:a(()=>$[7]||($[7]=[R("span",null,"KB",-1)])),_:1},8,["modelValue"])]),_:1}),t(_,{label:"来源"},{default:a(()=>[t(L,{modelValue:s.value.source,"onUpdate:modelValue":$[3]||($[3]=ie=>s.value.source=ie),placeholder:"请输入题目来源"},null,8,["modelValue"])]),_:1}),t(_,{label:"私有"},{default:a(()=>[t(D,{modelValue:s.value.private,"onUpdate:modelValue":$[4]||($[4]=ie=>s.value.private=ie)},null,8,["modelValue"])]),_:1}),t(_,{label:"标签"},{default:a(()=>[t(P,{value:U.value,"allow-input":!0,placeholder:"请选择或输入","tag-input-props":{excessTagsDisplayType:"break-line"},"popup-props":{overlayInnerClassName:["narrow-scrollbar"],overlayInnerStyle:{maxHeight:"280px",overflowY:"auto",overscrollBehavior:"contain",padding:"6px"}},clearable:"",multiple:"",onTagChange:S},{panel:a(()=>[p.value.length?(V(),M(x,{key:0,value:T.value,options:p.value,onChange:y},null,8,["value","options"])):(V(),ee("div",ss,"暂无数据"))]),suffixIcon:a(()=>[t(fe(ol))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(E,{span:4},{default:a(()=>[R("div",rs,[R("div",is,[o.value?(V(),M(le,{key:0},{default:a(()=>[t(N,{onClick:d,theme:"danger",loading:b.value},{default:a(()=>$[8]||($[8]=[I("保存")])),_:1},8,["loading"]),t(N,{onClick:u,theme:"warning"},{default:a(()=>$[9]||($[9]=[I("判题数据")])),_:1}),t(N,{onClick:C},{default:a(()=>$[10]||($[10]=[I("查看")])),_:1})]),_:1})):(V(),M(le,{key:1},{default:a(()=>[t(N,{onClick:f,theme:"danger",loading:b.value},{default:a(()=>$[11]||($[11]=[I("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(V(),M(te,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(Y,{label:"创建时间"},{default:a(()=>{var ie;return[I(q((ie=m.value)==null?void 0:ie.insertTime),1)]}),_:1}),t(Y,{label:"更新时间"},{default:a(()=>{var ie;return[I(q((ie=m.value)==null?void 0:ie.updateTime),1)]}),_:1}),t(Y,{label:"判题方式"},{default:a(()=>{var ie;return[I(q((ie=m.value)==null?void 0:ie.judgeType),1)]}),_:1}),t(Y,{label:"上传用户"},{default:a(()=>{var ie;return[I(q((ie=m.value)==null?void 0:ie.creatorNickname),1)]}),_:1})]),_:1})):ae("",!0)])]),_:1})]),_:1}),R("div",us,[$[12]||($[12]=R("p",null,"题目描述",-1)),t(he,{loading:w.value||b.value},{default:a(()=>[t(W,{modelValue:s.value.description,"onUpdate:modelValue":$[5]||($[5]=ie=>s.value.description=ie),onSave:d,onOnUploadImg:g,previewTheme:"cyanosis"},null,8,["modelValue"])]),_:1},8,["loading"])])]),_:1},8,["loading"])}}}),sa=de(ds,[["__scopeId","data-v-e349d9e2"]]),cs={style:{margin:"10px"}},ms={style:{margin:"12px"}},ps={class:"dida-edit-container"},fs=ce({__name:"ProblemJudge",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze(),o=c(""),h=c(!1),b=c(null);let w=null;const m=c(null),s=c(""),U=c(!1),p=c(!1),T=c([{title:"文件",colKey:"file"},{title:"大小",colKey:"size",width:150,cell:(k,D)=>{let x=D.row.size,P;return x>10*1024?x>1024*1024?P=(x/(1024*1024)).toFixed(3)+" MB":P=(x/1024).toFixed(3)+" KB":P=x+" B",P}},{title:"最后修改时间",colKey:"lastModified",width:180,cell:(k,D)=>new Date(D.row.lastModified).toLocaleString()},{title:"操作",colKey:"action",width:100,cell:(k,D)=>t(O,{onClick:()=>f(D.row.file)},{default:()=>[I("下载")]})}]),S=c([]),y=Je(()=>({border:"2px dashed #ccc",borderRadius:"6px",padding:"20px",textAlign:"center",cursor:"pointer",backgroundColor:U.value?"#f0f9ff":"#fff",transition:"background-color 0.2s ease"})),C=Je(()=>s.value?`已选择：${s.value}`:U.value?"松开文件以上传":"拖拽判题数据压缩包到这里，或点击选择文件"),u=()=>{X.push({name:"problem-detail",params:{problemId:o.value}})},g=()=>{X.push({name:"manage-problem",params:{problemId:o.value}})},f=async k=>{const D=await xn(o.value,k);if(D.code!==0){K(n,D.code);return}const x=document.createElement("a");x.href=D.data,x.target="_blank",x.click(),URL.revokeObjectURL(x.href)},d=async()=>{if(!w){ge(n,"请选择压缩包");return}p.value=!0,$n(o.value,w).then(async k=>{k.code==0?(m.value.value=null,w=null,s.value="",h.value=!0,Ge(n,"上传成功"),await _()):Nl(n,k.code,k.data)}).catch(k=>{console.log(k),n.$message.error({duration:3e3,content:"上传失败"})}).finally(()=>{p.value=!1})},r=()=>{var k;(k=m.value)==null||k.click()},A=k=>{const D=k.target.files[0];D&&(s.value=D.name,w=D)},v=k=>{U.value=!0},$=()=>{U.value=!1},L=k=>{k.preventDefault(),k.stopPropagation(),U.value=!1;const D=k.dataTransfer.files[0];if(D){s.value=D.name;const x=new DataTransfer;x.items.add(D),m.value.files=x.files,w=D}},_=async()=>{const k=await gn(o.value);if(k.code!==0){K(n,k.code),await X.push({name:"problem"});return}const D=k.data.problem;b.value=ht(D,{}),i.setTitle(D.title+" - "+i.getTitle),S.value=[],k.data.judges?(k.data.judges.forEach(x=>{S.value.push({file:x.key,size:x.size,lastModified:x.last_modified})}),S.value.sort((x,P)=>x.file.endsWith(".zip")&&!P.file.endsWith(".zip")?-1:!x.file.endsWith(".zip")&&P.file.endsWith(".zip")?1:x.file.endsWith(".yaml")&&!P.file.endsWith(".yaml")?-1:!x.file.endsWith(".yaml")&&P.file.endsWith(".yaml")?1:0)):ge(n,"评测数据不存在"),h.value=!1};return pe(async()=>{if(Array.isArray(l.params.problemId)?o.value=l.params.problemId[0]:o.value=l.params.problemId,!o.value){ge(n,"题目不存在"),await X.push({name:"problem"});return}h.value=!0,await _()}),(k,D)=>{const x=Fe,P=xe,z=O,j=we,E=Ye,N=We,le=Pe,Y=De;return V(),M(Y,{loading:h.value},{default:a(()=>[t(le,null,{default:a(()=>[t(P,{span:7},{default:a(()=>[R("div",cs,[R("div",{id:"drop-zone",style:ba(y.value),onClick:r,onDragenter:jt(v,["prevent"]),onDragover:D[0]||(D[0]=jt(()=>{},["prevent"])),onDragleave:jt($,["prevent"]),onDrop:L},[R("input",{ref_key:"fileInput",ref:m,type:"file",style:{display:"none"},onChange:A},null,544),I(" "+q(C.value),1)],36)]),t(x,{data:S.value,columns:T.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1}),t(P,{span:5},{default:a(()=>[R("div",ms,[R("div",ps,[t(j,null,{default:a(()=>[t(z,{onClick:d,theme:"danger",loading:p.value},{default:a(()=>D[1]||(D[1]=[I("上传")])),_:1},8,["loading"]),t(z,{onClick:g,theme:"warning"},{default:a(()=>D[2]||(D[2]=[I("编辑")])),_:1}),t(z,{onClick:u},{default:a(()=>D[3]||(D[3]=[I("查看")])),_:1})]),_:1})]),t(N,{layout:"vertical",bordered:!0},{default:a(()=>[t(E,{label:"标题"},{default:a(()=>{var te;return[I(q((te=b.value)==null?void 0:te.title),1)]}),_:1}),t(E,{label:"创建时间"},{default:a(()=>{var te;return[I(q((te=b.value)==null?void 0:te.insertTime),1)]}),_:1}),t(E,{label:"更新时间"},{default:a(()=>{var te;return[I(q((te=b.value)==null?void 0:te.updateTime),1)]}),_:1}),t(E,{label:"判题方式"},{default:a(()=>{var te;return[I(q((te=b.value)==null?void 0:te.judgeType),1)]}),_:1}),t(E,{label:"评测数据"},{default:a(()=>{var te;return[I(q((te=b.value)==null?void 0:te.judgeMd5),1)]}),_:1}),t(E,{label:"上传用户"},{default:a(()=>{var te;return[I(q((te=b.value)==null?void 0:te.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),vs=de(fs,[["__scopeId","data-v-0098ef39"]]);function Xt(e){const l={};return l.id=e.id,l.ownerId=e.owner_id,l.ownerUsername=e.owner_username,l.ownerNickname=e.owner_nickname,l.title=e.title,e.start_time?l.startTime=new Date(e.start_time).toLocaleString():l.startTime="无限制",e.end_time?l.endTime=new Date(e.end_time).toLocaleString():l.endTime="无限制",e.update_time?l.updateTime=new Date(e.update_time).toLocaleString():l.updateTime="",e.create_time?l.createTime=new Date(e.create_time).toLocaleString():l.createTime="",e.description?l.description=e.description:l.description="",l.problems=e.problems,l}function _s(e){return G({url:"/collection?id="+e,method:"get"})}function gs(e){return G({url:"/collection/edit?id="+e,method:"get"})}function bs(e,l){return G({url:"/collection/list?page="+e+"&page_size="+l,method:"get"})}function hs(e){return G({url:"/collection/rank?id="+e,method:"get"})}function ys(e){return G({url:"/collection/create",method:"post",data:e})}function ws(e){return G({url:"/collection/edit",method:"post",data:e})}function ks(e){return G({url:"/collection/join",method:"post",data:{id:e}})}function Ss(e){return G({url:"/collection/quit",method:"post",data:{id:e}})}const Cs={style:{margin:"10px"}},Is=ce({__name:"CollectionList",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=null;c(!1),c(!1);const h=c([{title:"ID",colKey:"id",width:"100",cell:(g,f)=>t(O,{variant:"text",onClick:()=>T(f.row.id)},{default:()=>[f.row.id]})},{title:"标题",colKey:"title",cell:(g,f)=>t(O,{variant:"text",onClick:()=>T(f.row.id)},{default:()=>[f.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),b=c(!1);let w=1,m=50;const s=c({current:w,pageSize:m,defaultCurrent:w,defaultPageSize:m,total:0,pageSizeOptions:[50,100]}),U=c(),p=c({title:"",username:""});c({title:"",description:"",open_time:[]});const T=g=>{g&&n.push({path:"/collection/"+g})},S=async()=>{await n.push({query:{...l.query,title:p.value.title,username:p.value.username,page:1,page_size:s.value.defaultPageSize}})},y=async(g,f)=>{var d;b.value=!0;try{const{current:r,pageSize:A}=g,v=await bs(r,A);if(U.value=[],v.code===0){const $=v.data.list;for(let L=0;L<$.length;L++){const _=$[L],k=Xt(_);(d=U.value)==null||d.push(k)}s.value={...s.value,total:v.data.total_count}}else f&&K(i,v.code)}catch(r){console.error(r),K(i,He())}finally{b.value=!1}},C=async g=>{await n.push({query:{...l.query,page:g.current,page_size:g.pageSize}})},u=async()=>{await n.push({name:"collection-create"})};return pe(async()=>{o=Ue(()=>l.query,g=>{p.value.title=g.title||"",p.value.username=g.username||"";const f=parseInt(g.page)||s.value.defaultCurrent,d=parseInt(g.page_size)||s.value.defaultPageSize;w=f,m=d,s.value={...s.value,current:w,pageSize:m},y({current:w,pageSize:m},!0)},{immediate:!0})}),Ve(()=>{o&&o()}),(g,f)=>{const d=Fe,r=be,A=xe,v=Re,$=ze,L=O,_=Ae,k=we,D=Pe;return V(),M(D,null,{default:a(()=>[t(A,{span:9},{default:a(()=>[t(r,{style:{margin:"10px"}},{default:a(()=>[t(d,{data:U.value,columns:h.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:s.value,loading:b.value,onPageChange:C},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(A,{span:3},{default:a(()=>[R("div",Cs,[t(r,{class:"sh-card"},{default:a(()=>[t(_,{model:p.value},{default:a(()=>[t($,{label:"标题"},{default:a(()=>[t(v,{modelValue:p.value.title,"onUpdate:modelValue":f[0]||(f[0]=x=>p.value.title=x),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t($,{label:"负责人"},{default:a(()=>[t(v,{modelValue:p.value.username,"onUpdate:modelValue":f[1]||(f[1]=x=>p.value.username=x),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t($,null,{default:a(()=>[t(L,{theme:"primary",onClick:S},{default:a(()=>f[2]||(f[2]=[I("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(r,{class:"sh-card"},{default:a(()=>[t(k,null,{default:a(()=>[t(L,{onClick:u},{default:a(()=>f[3]||(f[3]=[I("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),Ps=de(Is,[["__scopeId","data-v-3c9d295e"]]),Ts={style:{margin:"20px"}},xs={class:"dida-operation-container"},Ds={style:{margin:"12px"}},Vs=ce({__name:"CollectionDetail",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze(),o=qe();let h=0;const b=c(!1),w=c(null),m=c(!1),s=c(!1);let U={};const p=Je(()=>o.hasAuth(je.ManageCollection)||w.value&&o.getUserId==w.value.ownerId),T=f=>{if(!f||!U)return"default";const d=U[f];if(!d)return"default";switch(d){case Le.Accept:return"success";case Le.Attempt:return"warning";default:return"default"}},S=c([{title:"问题ID",colKey:"id",cell:(f,d)=>{const r=T(d.row.id);return t(O,{variant:"dashed",theme:r,onClick:()=>la(d.row.id)},{default:()=>[d.row.id]})}},{title:"标题",colKey:"title",cell:(f,d)=>t(O,{variant:"text",onClick:()=>la(d.row.id)},{default:()=>[d.row.title]})},{title:"正确",colKey:"accept",cell:(f,d)=>d.row.accept?d.row.accept:0},{title:"提交",colKey:"attempt",cell:(f,d)=>d.row.attempt?d.row.attempt:0}]),y=c([]),C=async()=>{if(!o.isLogin()){await X.push({name:"login"});return}s.value=!0;try{const f=await ks(h);if(f.code!==0){K(n,f.code);return}m.value=!0,Ge(n,"加入成功")}finally{s.value=!1}},u=async()=>{if(!o.isLogin()){await X.push({name:"login"});return}s.value=!0;try{const f=await Ss(h);if(f.code!==0){K(n,f.code);return}m.value=!1,Ge(n,"退出成功")}finally{s.value=!1}},g=()=>{w.value&&X.push({name:"collection-edit",params:{collectionId:w.value.id}})};return pe(async()=>{if(Array.isArray(l.params.collectionId)?h=Number(l.params.collectionId[0]):h=Number(l.params.collectionId),!h){await X.push({name:"problem-collection-list"});return}m.value=!1,b.value=!0;const f=await _s(h);if(f.code!==0){b.value=!1,K(n,f.code),await X.push({name:"problem-collection-list"});return}m.value=f.data.joined,U=f.data.attempt_status||{},w.value=Xt(f.data.collection),y.value=[],f.data.collection.problems&&f.data.collection.problems.forEach(d=>{const r=f.data.problems.find(A=>A.id===d);y.value.push(r)}),i.setTitle(w.value.title+" - "+i.getTitle),b.value=!1}),(f,d)=>{const r=Ca,A=Sa,v=Fe,$=be,L=xe,_=O,k=we,D=Ye,x=We,P=Me("md-preview"),z=Pe,j=De;return V(),M(j,{loading:b.value},{default:a(()=>[t(z,{class:"dida-main-content"},{default:a(()=>[t(L,{span:6},{default:a(()=>[R("div",Ts,[t(A,{"max-item-width":"300"},{default:a(()=>[t(r,{to:{name:"problem-collection-list"}},{default:a(()=>d[0]||(d[0]=[I("题目集合")])),_:1}),t(r,null,{default:a(()=>{var E;return[I(q((E=w.value)==null?void 0:E.title),1)]}),_:1})]),_:1})]),t($,{style:{margin:"10px"}},{default:a(()=>[t(v,{data:y.value,columns:S.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),_:1})]),_:1}),t(L,{span:6},{default:a(()=>{var E;return[R("div",xs,[t(k,null,{default:a(()=>[m.value?(V(),M(_,{key:0,onClick:u,loading:s.value},{default:a(()=>d[1]||(d[1]=[I("退出")])),_:1},8,["loading"])):(V(),M(_,{key:1,onClick:C,loading:s.value},{default:a(()=>d[2]||(d[2]=[I("加入")])),_:1},8,["loading"])),p.value?(V(),M(_,{key:2,onClick:g},{default:a(()=>d[3]||(d[3]=[I("编辑")])),_:1})):ae("",!0)]),_:1})]),R("div",Ds,[t(x,{layout:"vertical",bordered:!0},{default:a(()=>[t(D,{label:"创建者"},{default:a(()=>{var N;return[I(q((N=w.value)==null?void 0:N.ownerNickname),1)]}),_:1})]),_:1}),t(x,{layout:"vertical",bordered:!0},{default:a(()=>[t(D,{label:"开始时间"},{default:a(()=>{var N;return[I(q((N=w.value)==null?void 0:N.startTime),1)]}),_:1})]),_:1}),t(x,{layout:"vertical",bordered:!0},{default:a(()=>[t(D,{label:"结束时间"},{default:a(()=>{var N;return[I(q((N=w.value)==null?void 0:N.endTime),1)]}),_:1})]),_:1})]),(E=w.value)!=null&&E.description?(V(),M($,{key:0,style:{margin:"10px"}},{default:a(()=>{var N;return[t(P,{"model-value":(N=w.value)==null?void 0:N.description},null,8,["model-value"])]}),_:1})):ae("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),$s=de(Vs,[["__scopeId","data-v-042bd4bb"]]),js=ce({__name:"CollectionRank",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=null,h=0,b=0;const w=c([{title:"Rank",colKey:"rank",align:"center"},{title:"序号",colKey:"index",align:"center"},{title:"Username",colKey:"username",cell:(T,S)=>t(O,{variant:"text",onClick:()=>n.push({name:"user",params:{username:S.row.username}})},{default:()=>[S.row.username]})},{title:"昵称",colKey:"nickname",cell:(T,S)=>t(O,{variant:"text",onClick:()=>n.push({name:"user",params:{username:S.row.username}})},{default:()=>[S.row.nickname]})},{title:"Count",colKey:"count",cell:(T,S)=>t(O,{variant:"text",onClick:()=>n.push({name:"judge-list",query:{username:S.row.username,status:Be.Accept}})},{default:()=>[`${S.row.accept} / ${b}`]})},{title:"Progress",colKey:"progress",cell:(T,S)=>{let y=100;return b>0&&(y=Number((S.row.accept/b*100).toFixed(2))),t(Nt,{percentage:y},null)}}]),m=c(!1),s=c([]),U=({col:T,rowIndex:S})=>{let y=1;for(let C=S+1;C<s.value.length&&s.value[C].rank===s.value[S].rank;C++)y++;if(T.colKey==="rank")return{rowspan:y}},p=async T=>{m.value=!0;try{const S=await hs(h);if(s.value=[],S.code===0){b=S.data.problem;const y=S.data.ranks,C=[];if(y){for(let f=0;f<y.length;f++){const d=y[f];let r={userId:d.author_id,username:d.author_username,nickname:d.author_nickname};r.accept=d.accept,C.push(r)}C.sort((f,d)=>f.accept!==d.accept?d.accept-f.accept:f.userId-d.userId);let u=0,g=-1;for(let f=0;f<C.length;f++)C[f].accept!==g&&(u=f+1,g=C[f].accept),C[f].index=f+1,C[f].rank=u}s.value=C}else T&&K(i,S.code)}catch(S){console.error(S),K(i,He())}finally{m.value=!1}};return pe(async()=>{o=Ue(()=>l.query,async()=>{if(Array.isArray(l.params.collectionId)?h=Number(l.params.collectionId[0]):h=Number(l.params.collectionId),!h){await n.push({name:"problem-collection-list"});return}await p(!0)},{immediate:!0})}),Ve(()=>{o&&o()}),(T,S)=>{const y=Fe,C=be,u=Pe;return V(),M(u,null,{default:a(()=>[t(C,{style:{margin:"10px"}},{default:a(()=>[R("div",null,[t(y,{data:s.value,columns:w.value,"row-key":"index","rowspan-and-colspan":U,"vertical-align":"middle",bordered:!0,hover:!0,loading:m.value},null,8,["data","columns","loading"])])]),_:1})]),_:1})}}});var Oe=(e=>(e[e.Valid=0]="Valid",e[e.Duplicate=1]="Duplicate",e[e.Invalid=2]="Invalid",e))(Oe||{});const Ls={class:"dida-form-border"},Us={style:{"text-align":"right"}},As=ce({name:"ParseProblemList",__name:"ParseProblemList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:l}=_e(),n=c(!1),i=c(!1),o=c(""),h=ha(e,"modelValue");let b=[];Ue(h,async T=>{JSON.stringify(T)!==JSON.stringify(b)&&(await s(T),b=h.value)},{deep:!0});const w=c([]),m=c([{title:"有效性",colKey:"validType",cell:(T,S)=>{switch(S.row.valid){case Oe.Valid:return t(Qe,{theme:"success"},{default:()=>[I("有效")]});case Oe.Duplicate:return t(Qe,{theme:"warning"},{default:()=>[I("重复")]});case Oe.Invalid:return t(Qe,{theme:"danger"},{default:()=>[I("无效")]});default:return null}}},{title:"问题ID",colKey:"id"},{title:"标题",colKey:"title"}]),s=async T=>{const S=Array.from(new Set(T)),y=await jn(S);if(y.code!==0){K(l,y.code),i.value=!1;return}const C=[],u=y.data.problems;let g=[];T.forEach(f=>{const d=u.find(r=>r.id===f);if(d){const r=C.find(A=>A.id===f);d.valid=r?Oe.Duplicate:Oe.Valid,C.push({id:f,title:d.title,valid:d.valid}),r||g.push(f)}else C.push({id:f,title:"-",valid:Oe.Invalid})}),w.value=C,b=g,h.value=g},U=async()=>{i.value=!0;const T=Ta(o.value);await s(T),n.value=!1,i.value=!1},p=()=>{w.value?o.value=w.value.map(T=>T.id).join(`
`):o.value="",n.value=!0};return(T,S)=>{const y=O,C=Fe,u=xt,g=st;return V(),ee(me,null,[R("div",Ls,[R("div",Us,[t(y,{onClick:p},{default:a(()=>S[2]||(S[2]=[I("编辑")])),_:1})]),t(C,{data:w.value,columns:m.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(g,{visible:n.value,"onUpdate:visible":S[1]||(S[1]=f=>n.value=f),onConfirm:U,header:"请输入问题ID","confirm-loading":i.value},{default:a(()=>[S[3]||(S[3]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(u,{modelValue:o.value,"onUpdate:modelValue":S[0]||(S[0]=f=>o.value=f),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),qa=de(As,[["__scopeId","data-v-7f4ce589"]]),zs={class:"dida-form-border"},Rs={style:{"text-align":"right"}},Es=ce({name:"ParseUserList",__name:"ParseUserList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:l}=_e(),n=c(!1),i=c(!1),o=c(""),h=ha(e,"modelValue");let b=[];Ue(h,async y=>{JSON.stringify(y)!==JSON.stringify(b)&&(b=y,await U(y))},{deep:!0});const w=c(),m=c([{title:"有效性",colKey:"validType",cell:(y,C)=>{switch(C.row.valid){case Oe.Valid:return t(Qe,{theme:"success"},{default:()=>[I("有效")]});case Oe.Duplicate:return t(Qe,{theme:"warning"},{default:()=>[I("重复")]});case Oe.Invalid:return t(Qe,{theme:"danger"},{default:()=>[I("无效")]})}}},{title:"Username",colKey:"username"},{title:"昵称",colKey:"nickname"}]),s=(y,C)=>{if(y.code!==0){K(l,y.code),i.value=!1;return}const u=[],g=y.data.users;let f=[];C?C.forEach(d=>{let r=null;if(g&&(r=g.find(A=>A.username.toLowerCase()===d.toLowerCase())),r){const A=u.find($=>$.username.toLowerCase()===d.toLowerCase()),v=A?Oe.Duplicate:Oe.Valid;u.push({id:r.id,username:r.username,nickname:r.nickname,valid:v}),A||f.push(r.id)}else u.push({id:-1,username:d,nickname:"-",valid:Oe.Invalid})}):g&&g.forEach(d=>{const r=u.find(v=>v.id===d.id),A=r?Oe.Duplicate:Oe.Valid;u.push({id:d.id,username:d.username,nickname:d.nickname,valid:A}),r||f.push(d.id)}),w.value=u,b=f,h.value=f},U=async y=>{const C=Array.from(new Set(y)),u=await Jn(C);s(u)},p=async y=>{const C=Array.from(new Set(y)),u=await Wn(C);s(u,y)},T=async()=>{i.value=!0;const y=Ta(o.value);await p(y),n.value=!1,i.value=!1},S=()=>{w.value?o.value=w.value.map(y=>y.username).join(`
`):o.value="",n.value=!0};return(y,C)=>{const u=O,g=Fe,f=xt,d=st;return V(),ee(me,null,[R("div",zs,[R("div",Rs,[t(u,{onClick:S},{default:a(()=>C[2]||(C[2]=[I("编辑")])),_:1})]),t(g,{data:w.value,columns:m.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(d,{visible:n.value,"onUpdate:visible":C[1]||(C[1]=r=>n.value=r),onConfirm:T,header:"请输入用户Username","confirm-loading":i.value},{default:a(()=>[C[3]||(C[3]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(f,{modelValue:o.value,"onUpdate:modelValue":C[0]||(C[0]=r=>o.value=r),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Fa=de(Es,[["__scopeId","data-v-d2170a86"]]),Ms={style:{margin:"10px"}},qs={style:{margin:"12px"}},Fs={class:"dida-edit-container"},Ks=ce({__name:"CollectionEdit",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze(),o=c(""),h=c(!1),b=c(!1),w=c(!1),m=c(null),s=c({title:"",openTime:[],private:!0,problems:[],members:[],description:""}),U=c(""),p=c(""),T=c(!1),S=async()=>{T.value=!0,w.value=!1,T.value=!1},y=async()=>{b.value=!0;try{const d={title:s.value.title,problems:s.value.problems,members:s.value.members,private:s.value.private,description:s.value.description};s.value.openTime[0]&&(d.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(d.end_time=new Date(s.value.openTime[1]));const r=await ys(d);if(r.code!==0){K(n,r.code);return}r.data!=null&&await X.push({name:"collection-detail",params:{collectionId:r.data}}),Ge(n,"创建成功")}finally{b.value=!1}},C=async()=>{b.value=!0;try{const d={id:Number(o.value),title:s.value.title,private:s.value.private,problems:s.value.problems,members:s.value.members,description:s.value.description};s.value.openTime[0]&&(d.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(d.end_time=new Date(s.value.openTime[1]));const r=await ws(d);if(r.code!==0){K(n,r.code);return}r.data!=null&&m.value&&(m.value.updateTime=new Date(r.data).toLocaleString()),Ge(n,"保存成功")}finally{b.value=!1}},u=d=>{s.value.description=d,h.value=!1};async function g(d,r){b.value=!0,ge(n,"本界面暂不支持上传图片"),b.value=!1}const f=async()=>{const d=await gs(o.value);if(d.code!==0){K(n,d.code),console.error("collection get failed",d.code),await X.push({name:"problem-collection-list"});return}const r=d.data.collection;m.value=Xt(r),s.value.title=r.title,s.value.openTime=[],r.start_time?s.value.openTime.push(new Date(r.start_time)):s.value.openTime.push(""),r.end_time?s.value.openTime.push(new Date(r.end_time)):s.value.openTime.push(""),s.value.private=r.private,s.value.description=r.description,s.value.problems=r.problems,s.value.members=r.members,i.setTitle(r.title+" - "+i.getTitle);let A="";r.description&&(A=r.description),u(A)};return pe(async()=>{Array.isArray(l.params.collectionId)?o.value=l.params.collectionId[0]:o.value=l.params.collectionId,o.value?(h.value=!0,await f()):u("")}),(d,r)=>{const A=Re,v=ze,$=Gt,L=bt,_=Ae,k=be,D=xe,x=O,P=we,z=Ye,j=We,E=Pe,N=Me("md-editor-v3"),le=De,Y=xt,te=st;return V(),ee(me,null,[t(le,{loading:h.value},{default:a(()=>[t(E,null,{default:a(()=>[t(D,{span:8},{default:a(()=>[R("div",Ms,[t(k,{class:"sh-card"},{default:a(()=>[t(_,{model:s.value},{default:a(()=>[t(v,{label:"标题"},{default:a(()=>[t(A,{modelValue:s.value.title,"onUpdate:modelValue":r[0]||(r[0]=Q=>s.value.title=Q),placeholder:"题集标题"},null,8,["modelValue"])]),_:1}),t(v,{label:"开启时间"},{default:a(()=>[t($,{modelValue:s.value.openTime,"onUpdate:modelValue":r[1]||(r[1]=Q=>s.value.openTime=Q),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(v,{label:"私有"},{default:a(()=>[t(L,{modelValue:s.value.private,"onUpdate:modelValue":r[2]||(r[2]=Q=>s.value.private=Q)},null,8,["modelValue"])]),_:1}),t(v,{label:"成员"},{default:a(()=>[t(Fa,{modelValue:s.value.members,"onUpdate:modelValue":r[3]||(r[3]=Q=>s.value.members=Q)},null,8,["modelValue"])]),_:1}),t(v,{label:"问题"},{default:a(()=>[t(qa,{modelValue:s.value.problems,"onUpdate:modelValue":r[4]||(r[4]=Q=>s.value.problems=Q)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(D,{span:4},{default:a(()=>[R("div",qs,[R("div",Fs,[o.value?(V(),M(P,{key:0},{default:a(()=>[t(x,{onClick:C,theme:"danger",loading:b.value},{default:a(()=>r[8]||(r[8]=[I("保存")])),_:1},8,["loading"])]),_:1})):(V(),M(P,{key:1},{default:a(()=>[t(x,{onClick:y,theme:"danger",loading:b.value},{default:a(()=>r[9]||(r[9]=[I("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(V(),M(j,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(z,{label:"创建时间"},{default:a(()=>{var Q;return[I(q((Q=m.value)==null?void 0:Q.createTime),1)]}),_:1}),t(z,{label:"更新时间"},{default:a(()=>{var Q;return[I(q((Q=m.value)==null?void 0:Q.updateTime),1)]}),_:1}),t(z,{label:"创建用户"},{default:a(()=>{var Q;return[I(q((Q=m.value)==null?void 0:Q.ownerNickname),1)]}),_:1})]),_:1})):ae("",!0)])]),_:1})]),_:1}),t(N,{id:"collection-description-editor",modelValue:s.value.description,"onUpdate:modelValue":r[5]||(r[5]=Q=>s.value.description=Q),onSave:C,onOnUploadImg:g,previewTheme:"cyanosis",class:"dida-description-editor"},null,8,["modelValue"]),t(le,{loading:b.value,attach:"#collection-description-editor","z-index":1e5},null,8,["loading"])]),_:1},8,["loading"]),t(te,{visible:w.value,"onUpdate:visible":r[7]||(r[7]=Q=>w.value=Q),onConfirm:S,header:U.value,"confirm-loading":T.value},{default:a(()=>[r[10]||(r[10]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(Y,{modelValue:p.value,"onUpdate:modelValue":r[6]||(r[6]=Q=>p.value=Q),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),ra=de(Ks,[["__scopeId","data-v-2a875f8a"]]);function ia(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!at(e)}const Ns=ce({__name:"JudgeJobList",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=!1,h=null,b;const w=c(!1),m=c(null),s=c(!1);let U=-1;const p=c({problemId:"",username:"",language:void 0,status:void 0}),T=c([{title:"ID",colKey:"id",cell:(x,P)=>{let z=null;return Ct(P.row.status)&&St(P.row.language)&&(z=()=>{v(P.row.id)}),t(O,{variant:"text",onClick:z},{default:()=>[P.row.id]})}},{title:"问题",colKey:"problemId",cell:(x,P)=>{if(U){let z;return t(O,{variant:"text",onClick:()=>vt(U,P.row.contestProblemIndex)},ia(z=tt(P.row.contestProblemIndex))?z:{default:()=>[z]})}return t(O,{variant:"text",onClick:()=>A(P.row.problemId)},{default:()=>[P.row.problemId]})}},{title:"状态",colKey:"status",align:"center",cell:(x,P)=>{let z=null;Ct(P.row.status)&&St(P.row.language)&&(z=()=>{v(P.row.id)});const j=P.row.status,E=Pt(j);let N=!Ct(j);const le=Va(j);let Y=[];return dt(j)&&Y.push(t(De,{text:P.row.state,size:"small",class:"dida-status-loading"},null)),Y.push(t("span",null,[E])),t(O,{theme:le,variant:"outline",onClick:z,disabled:N},ia(Y)?Y:{default:()=>[Y]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"code",cell:(x,P)=>{let z=!St(P.row.language);return t(O,{theme:"default",onClick:()=>r(P.row),disabled:z},{default:()=>[It(P.row.language)+" / "+P.row.codeLength]})}},{title:"作者",colKey:"author",width:200,cell:(x,P)=>t(O,{variant:"text",onClick:()=>$(P.row.authorUsername)},{default:()=>[P.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),S=c(!1);let y=1,C=50;const u=c({current:y,pageSize:C,defaultCurrent:y,defaultPageSize:C,total:500,pageSizeOptions:[50,100],showPageSize:!1,totalContent:(x,P)=>t("div",null,[t(Qe,null,{default:()=>[I("目前仅支持获取前10页数据")]})])}),g=c(),f=c([]);f.value=Ht();const d=c([]);d.value=$a();const r=async x=>{s.value=!0,w.value=!0;try{m.value=x;const P=await dn(Number(m.value.id));if(P.code===0){const z=P.data,j=Bt(z.language);m.value.code=`\`\`\`${j}
${z.code}
\`\`\``}else K(i,P.code)}finally{s.value=!1}},A=x=>{x&&n.push({path:"/problem/"+x})},v=x=>{x&&(U>0?n.push({name:"contest-judge-detail",params:{contestId:U,judgeId:x}}):n.push({name:"judge-detail",params:{judgeId:x}}))},$=x=>{x&&n.push({path:"/user/"+x})},L=async()=>{await n.push({query:{...l.query,page:1,page_size:C,problem_id:p.value.problemId,username:p.value.username,language:p.value.language,status:p.value.status}})},_=async()=>{p.value.problemId="",p.value.username="",p.value.language=void 0,p.value.status=void 0,await n.push({query:{...l.query,page:1,page_size:C,problem_id:"",username:"",language:void 0,status:void 0}})},k=async(x,P)=>{P&&(S.value=!0);let z=!1;try{const{current:j,pageSize:E}=x,N=await cn(U,p.value.problemId,p.value.username,p.value.language,p.value.status,j,E);if(g.value=[],N.code===0){if(!N.data.has_auth){ye(i,"您目前没有权限查看评测记录"),U?await n.push({name:"contest-detail",params:{contestId:U}}):await n.push({name:"judge-list"});return}N.data.list&&N.data.list.length>0?N.data.list.forEach(Y=>{var Q;const te=ja(Y);(Q=g.value)==null||Q.push(te),dt(Y.status)&&(z=!0)}):ye(i,"未找到记录")}else P&&K(i,N.code)}catch(j){console.error(j),P&&K(i,He())}finally{P&&(S.value=!1),z&&o&&(b=setTimeout(()=>{k({current:y,pageSize:C},!1)},5e3))}},D=async x=>{await n.push({query:{...l.query,page:x.current}})};return pe(async()=>{o=!0,h=Ue(()=>l.query,x=>{Array.isArray(l.params.contestId)?U=Number(l.params.contestId[0]):U=Number(l.params.contestId),p.value.problemId=x.problem_id||"",p.value.username=x.username||"",x.language!=null?p.value.language=Number(x.language):p.value.language=void 0,x.status!=null?p.value.status=Number(x.status):p.value.status=void 0;const P=parseInt(x.page)||u.value.defaultCurrent,z=parseInt(x.page_size)||u.value.defaultPageSize;y=P,C=z,u.value.pageSizeOptions.includes(C)||(C=u.value.defaultPageSize),u.value={...u.value,current:y,pageSize:C},k({current:y,pageSize:C},!0)},{immediate:!0})}),Ve(()=>{o=!1,h&&h(),clearTimeout(b)}),(x,P)=>{const z=Re,j=ze,E=Ot,N=gt,le=O,Y=we,te=Ae,Q=Fe,W=be,he=ot,ie=Me("md-preview"),ue=De,J=st;return V(),ee(me,null,[t(W,{style:{margin:"10px"}},{default:a(()=>[t(te,{layout:"inline",onSubmit:L,onReset:_},{default:a(()=>[t(j,{label:"题号"},{default:a(()=>[t(z,{modelValue:p.value.problemId,"onUpdate:modelValue":P[0]||(P[0]=F=>p.value.problemId=F),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(j,{label:"用户"},{default:a(()=>[t(z,{modelValue:p.value.username,"onUpdate:modelValue":P[1]||(P[1]=F=>p.value.username=F),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(j,{label:"语言"},{default:a(()=>[t(N,{modelValue:p.value.language,"onUpdate:modelValue":P[2]||(P[2]=F=>p.value.language=F),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:a(()=>[(V(!0),ee(me,null,Te(f.value,F=>(V(),M(E,{key:F.value,value:F.value,label:F.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(j,{label:"状态"},{default:a(()=>[t(N,{modelValue:p.value.status,"onUpdate:modelValue":P[3]||(P[3]=F=>p.value.status=F),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:a(()=>[(V(!0),ee(me,null,Te(d.value,F=>(V(),M(E,{key:F.value,value:F.value,label:F.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(j,null,{default:a(()=>[t(Y,null,{default:a(()=>[t(le,{theme:"primary",type:"submit"},{default:a(()=>P[7]||(P[7]=[I("搜索")])),_:1}),t(le,{theme:"default",variant:"base",type:"reset"},{default:a(()=>P[8]||(P[8]=[I("重置")])),_:1})]),_:1})]),_:1})]),_:1}),t(Q,{data:g.value,columns:T.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:u.value,loading:S.value,onPageChange:D,"table-layout":"auto"},null,8,["data","columns","pagination","loading"])]),_:1}),t(J,{visible:w.value,"onUpdate:visible":P[5]||(P[5]=F=>w.value=F),width:"800px","cancel-btn":null,"close-btn":!1,onConfirm:P[6]||(P[6]=F=>w.value=!1)},{header:a(()=>[t(he,{onClick:P[4]||(P[4]=()=>{var F;v((F=m.value)==null?void 0:F.id)})},{default:a(()=>{var F,Z,B;return[I(q(((F=m.value)==null?void 0:F.id)+" - "+fe(It)((Z=m.value)!=null&&Z.language?(B=m.value)==null?void 0:B.language:fe($t).Unknown)),1)]}),_:1})]),default:a(()=>[t(ue,{loading:s.value},{default:a(()=>{var F;return[t(ie,{"model-value":(F=m.value)==null?void 0:F.code,"code-foldable":!1,style:{"min-height":"100px"}},null,8,["model-value"])]}),_:1},8,["loading"])]),_:1},8,["visible"])],64)}}}),ua=de(Ns,[["__scopeId","data-v-20d985de"]]),Os={class:"dida-code-container"},Gs={style:{margin:"20px"}},Hs={key:2,class:"dida-edit-container"};function At(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!at(e)}const Bs=ce({__name:"JudgeJobDetail",setup(e){const l=Se(),n=Xe(),i=qe(),{globalProperties:o}=_e();let h=!1,b,w=0,m=0;const s=c(""),U=c(null),p=c(""),T=c(0),S=c(null),y=c({from:"#5a96ff",to:"#00A870"}),C=c([{title:"ID",colKey:"id"},{title:"问题",colKey:"problemId",cell:(_,k)=>{if(m){let D;return t(O,{variant:"text",onClick:()=>vt(m,k.row.contestProblemIndex)},At(D=tt(k.row.contestProblemIndex))?D:{default:()=>[D]})}return t(O,{variant:"text",onClick:()=>A(k.row.problemId)},{default:()=>[k.row.problemId]})}},{title:"状态",colKey:"status",align:"center",cell:(_,k)=>{const D=k.row.status,x=Pt(D),P=Va(D);let z=[];return dt(D)&&z.push(t(De,{text:k.row.state,size:"small",class:"dida-status-loading"},null)),z.push(t("span",null,[x])),t(O,{theme:P,variant:"outline"},At(z)?z:{default:()=>[z]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"language",cell:(_,k)=>t("span",null,[It(k.row.language)+" / "+k.row.codeLength])},{title:"作者",colKey:"author",width:200,cell:(_,k)=>t(O,{variant:"text",onClick:()=>v(k.row.authorUsername)},{default:()=>[k.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),u=c(!1),g=c(!1),f=c(),d=Je(()=>i.hasAuth(je.ManageJudge)),r=async()=>{if(!g.value){g.value=!0;try{const _=await _n(w);_.code===0?await L(!0):K(o,_.code)}catch(_){console.error(_),K(o,He())}finally{g.value=!1}}},A=_=>{_&&n.push({path:"/problem/"+_})},v=_=>{_&&n.push({path:"/user/"+_})},$=_=>{const k=_.status,D=Pt(k);let x;switch(k){case Be.Init:case Be.Rejudge:case Be.Compiling:case Be.Running:x="default";break;case Be.Accept:x="success";break;case Be.PE:x="warning";break;default:x="danger";break}return t(we,null,{default:()=>[t(O,{theme:"default",variant:"outline"},{default:()=>[_.taskId]}),t(O,{theme:x,variant:"outline"},At(D)?D:{default:()=>[D]}),t("span",null,[I("分数："),_.score]),t("span",null,[I("用时："),_.time]),t("span",null,[I("内存："),_.memory])]})},L=async _=>{var D;_&&(u.value=!0);let k=!1;try{const x=await un(w,m);if(f.value=[],x.code===0){const P=x.data,z=ja(P);if((D=f.value)==null||D.push(z),s.value=z.judgerName,y.value.to="#00A870",dt(P.status)?(S.value="active",z.taskTotal>0?(T.value=Number((z.taskCurrent/z.taskTotal*100).toFixed(2)),z.taskCurrent>=z.taskTotal&&(T.value=99)):T.value=0):(T.value=100,P.status===Be.Accept?S.value="success":P.status===Be.PE?(y.value.to="#F57C20",S.value="warning"):(y.value.to="#F56C6C",S.value="error")),P.code){const j=Bt(P.language);p.value=`\`\`\`${j}
${P.code}
\`\`\``}U.value=z,dt(P.status)&&(k=!0)}else _&&K(o,x.code),m?await n.push({name:"contest-judge",params:{contestId:m}}):await n.push({name:"judge-list"})}catch(x){console.error(x),_&&K(o,He())}finally{_&&(u.value=!1),k&&h&&(b=setTimeout(()=>{L(!1)},5e3))}};return pe(async()=>{if(h=!0,Array.isArray(l.params.judgeId)?w=Number(l.params.judgeId[0]):w=Number(l.params.judgeId),Array.isArray(l.params.contestId)?m=Number(l.params.contestId[0]):m=Number(l.params.contestId),!w){await n.push({name:"judge"});return}await L(!0)}),Ve(()=>{h=!1,clearTimeout(b)}),(_,k)=>{var W,he,ie;const D=Nt,x=Fe,P=be,z=Me("md-preview"),j=xe,E=Ye,N=We,le=Pe,Y=Pl,te=Tl,Q=O;return V(),ee(me,null,[t(D,{color:y.value,status:S.value,class:"dida-job-progress",percentage:T.value},null,8,["color","status","percentage"]),t(P,{style:{margin:"10px"}},{default:a(()=>[t(x,{data:f.value,columns:C.value,"row-key":"id","vertical-align":"top",hover:!0,loading:u.value},null,8,["data","columns","loading"])]),_:1}),t(le,null,{default:a(()=>[t(j,{span:8},{default:a(()=>[R("div",Os,[t(z,{"model-value":p.value,class:"dida-code-div"},null,8,["model-value"])])]),_:1}),t(j,{span:4},{default:a(()=>[R("div",Gs,[t(N,{layout:"vertical",bordered:!0},{default:a(()=>[t(E,{label:"判题机"},{default:a(()=>[I(q(s.value),1)]),_:1}),t(E,{label:"判题时间"},{default:a(()=>{var ue;return[I(q((ue=U.value)==null?void 0:ue.judgeTime),1)]}),_:1})]),_:1}),t(P,{class:"dida-card-tips"},{default:a(()=>{var ue;return[I(q(u.value?"数据正在加载，请等待":fe(aa)((ue=U.value)==null?void 0:ue.status)),1)]}),_:1})])]),_:1})]),_:1}),(W=U.value)!=null&&W.compileMessage?(V(),M(P,{key:0,class:"compile-message"},{default:a(()=>{var ue;return[I(q((ue=U.value)==null?void 0:ue.compileMessage),1)]}),_:1})):ae("",!0),(he=U.value)!=null&&he.task&&((ie=U.value)==null?void 0:ie.task.length)>0?(V(),M(te,{key:1,class:"task-panel"},{default:a(()=>{var ue;return[(V(!0),ee(me,null,Te((ue=U.value)==null?void 0:ue.task,(J,F)=>(V(),M(Y,{key:J.taskId,header:()=>$(J)},{default:a(()=>[t(P,null,{default:a(()=>[I(q(fe(aa)(J.status)),1)]),_:2},1024),J.content?(V(),M(P,{key:0,class:"dida-card-tips"},{default:a(()=>[t(z,{"model-value":J.content},null,8,["model-value"])]),_:2},1024)):ae("",!0),J.waHint?(V(),M(P,{key:1,class:"dida-card-tips"},{default:a(()=>[t(z,{"model-value":J.waHint},null,8,["model-value"])]),_:2},1024)):ae("",!0)]),_:2},1032,["header"]))),128))]}),_:1})):ae("",!0),d.value?(V(),ee("div",Hs,[t(Q,{onClick:r,loading:g.value},{default:a(()=>k[0]||(k[0]=[I("重新评测")])),_:1},8,["loading"])])):ae("",!0)],64)}}}),da=de(Bs,[["__scopeId","data-v-aab721fd"]]),Js={style:{margin:"10px"}},Ws=ce({__name:"ContestList",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=null;const h=c([{title:"ID",colKey:"id",cell:(f,d)=>t(O,{variant:"text",onClick:()=>T(d.row.id)},{default:()=>[d.row.id]})},{title:"标题",colKey:"title",cell:(f,d)=>t(O,{variant:"text",onClick:()=>T(d.row.id)},{default:()=>[d.row.title]})},{title:"负责人",colKey:"ownerNickname",cell:(f,d)=>t(O,{variant:"text",onClick:()=>Yt(n,d.row.ownerUsername)},{default:()=>[d.row.ownerNickname]})},{title:"权限",colKey:"private",cell:(f,d)=>d.row.private?"私有":"公开"},{title:"开始时间",colKey:"startTime"},{title:"结束时间",colKey:"endTime"}]),b=c(!1);let w=1,m=50;const s=c({current:w,pageSize:m,defaultCurrent:w,defaultPageSize:m,total:0,pageSizeOptions:[50,100]}),U=c(),p=c({title:"",username:""}),T=f=>{f&&n.push({path:"/contest/"+f})},S=async()=>{await n.push({query:{...l.query,title:p.value.title,username:p.value.username,page:1,page_size:s.value.defaultPageSize}})},y=async()=>{p.value.title="",p.value.username="",await n.push({query:{...l.query,title:"",username:"",page:1,page_size:s.value.defaultPageSize}})},C=async(f,d)=>{var r;b.value=!0;try{const{current:A,pageSize:v}=f,$=await To(p.value.title,p.value.username,A,v);if(U.value=[],$.code===0){const L=$.data.list;for(let _=0;_<L.length;_++){const k=L[_],D=Wt(k);(r=U.value)==null||r.push(D)}s.value={...s.value,total:$.data.total_count}}else d&&K(i,$.code)}catch(A){console.error(A),K(i,He())}finally{b.value=!1}},u=async f=>{await n.push({query:{...l.query,page:f.current,page_size:f.pageSize}})},g=()=>{n.push({name:"contest-create"})};return pe(async()=>{o=Ue(()=>l.query,f=>{p.value.title=f.title||"",p.value.username=f.username||"";const d=parseInt(f.page)||s.value.defaultCurrent,r=parseInt(f.page_size)||s.value.defaultPageSize;w=d,m=r,s.value={...s.value,current:w,pageSize:m},C({current:w,pageSize:m},!0)},{immediate:!0})}),Ve(()=>{o&&o()}),(f,d)=>{const r=Fe,A=be,v=xe,$=Re,L=ze,_=O,k=we,D=Ae,x=Pe;return V(),M(x,null,{default:a(()=>[t(v,{span:9},{default:a(()=>[t(A,{style:{margin:"10px"}},{default:a(()=>[t(r,{data:U.value,columns:h.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:s.value,loading:b.value,"table-layout":"auto",onPageChange:u,style:{"white-space":"nowrap"}},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(v,{span:3},{default:a(()=>[R("div",Js,[t(A,{class:"sh-card"},{default:a(()=>[t(D,{model:p.value,onSubmit:S,onReset:y},{default:a(()=>[t(L,{label:"标题"},{default:a(()=>[t($,{modelValue:p.value.title,"onUpdate:modelValue":d[0]||(d[0]=P=>p.value.title=P),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(L,{label:"负责人"},{default:a(()=>[t($,{modelValue:p.value.username,"onUpdate:modelValue":d[1]||(d[1]=P=>p.value.username=P),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(L,null,{default:a(()=>[t(k,null,{default:a(()=>[t(_,{theme:"primary",type:"submit"},{default:a(()=>d[2]||(d[2]=[I("提交")])),_:1}),t(_,{theme:"danger",type:"reset"},{default:a(()=>d[3]||(d[3]=[I("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(A,{class:"sh-card"},{default:a(()=>[t(k,null,{default:a(()=>[t(_,{onClick:g},{default:a(()=>d[4]||(d[4]=[I("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),ca=de(Ws,[["__scopeId","data-v-d94af270"]]);function zt(e){return e*1<10?`0${e}`:e}const Ys={name:"CountDown",emits:["on-end"],props:{format:{type:Function},target:{type:[Date,Number],required:!0},interval:{type:Number,default:1e3}},data(){return{lastTime:0,targetTime:0,timer:null}},computed:{result(){const{format:e=this.defaultFormat}=this;return e(this.lastTime)}},methods:{initTargetTime(){try{this.targetTime=Object.prototype.toString.call(this.target)==="[object Date]"?this.target.getTime():new Date(this.target).getTime()}catch(e){throw new Error("invalid target prop",e)}},updateTime(){const e=Date.now(),l=this.targetTime-e;this.lastTime=l>0?l:0},tick(){if(this.updateTime(),this.lastTime<=0){clearTimeout(this.timer),this.timer=null,this.$emit("on-end");return}this.timer=setTimeout(()=>{this.tick()},this.interval)},stop(){this.timer&&(clearTimeout(this.timer),this.timer=null)},defaultFormat(e){const i=Math.floor(e/36e5),o=Math.floor(e%36e5/6e4),h=Math.floor(e%6e4/1e3);return`${zt(i)}:${zt(o)}:${zt(h)}`}},watch:{target(){this.stop(),this.initTargetTime(),this.tick()}},created(){this.initTargetTime(),this.updateTime()},mounted(){this.tick()},beforeUnmount(){this.stop()}};function Xs(e,l,n,i,o,h){return V(),ee("span",null,q(h.result),1)}const Zs=de(Ys,[["render",Xs]]),Qs={style:{margin:"20px"}},er={style:{margin:"10px"}},tr={key:0,class:"dida-countdown-div"},ar={style:{"text-align":"center","align-content":"center",padding:"20px",height:"500px"}},lr={style:{"text-align":"center",width:"100%"}},nr={class:"dida-operation-container"},or={style:{margin:"12px"}},sr=ce({__name:"ContestDetail",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze(),o=qe(),h=c(!1);let b=0;const w=c(!1),m=c(null),s=c(!1),U=c(!1),p=c(""),T=c(null),S=Je(()=>o.hasAuth(je.ManageContest)||m.value&&(o==null?void 0:o.getUserId)===m.value.ownerId),y=L=>{if(!L||!g)return"default";const _=g[L];if(!_)return"default";switch(_){case Le.Accept:return"success";case Le.Attempt:return"warning";default:return"default"}},C=c([{title:"问题ID",colKey:"index",cell:(L,_)=>{const k=y(_.row.index);return t(O,{variant:"dashed",theme:k,onClick:async()=>await vt(b,_.row.index)},{default:()=>[_.row.id]})}},{title:"标题",colKey:"title",cell:(L,_)=>t(O,{variant:"text",onClick:async()=>await vt(b,_.row.index)},{default:()=>[_.row.title]})},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),u=c([]);let g={},f=c(!1);const d=async()=>{await $()},r=()=>{X.push({name:"contest-edit",params:{contestId:b}})},A=async()=>{h.value=!0;try{const L=await jo(b);if(L.code!==0){K(n,L.code);return}const _=L.data;ye(n,"查重报告已生成，请前往查看"),window.open(_,"_blank")}finally{h.value=!1}},v=async()=>{if(!o.isLogin()){await X.push({name:"login"});return}if(!p.value){ge(n,"请输入密码");return}f.value=!0;try{const L=await $o(b,p.value);if(L.code!==0){K(n,L.code);return}ye(n,"申请访问成功"),await $()}catch(L){console.error("Error submitting contest password:",L),K(n,"提交密码失败，请稍后再试")}finally{f.value=!1}},$=async()=>{w.value=!0;const L=await ko(b);if(L.code!==0){w.value=!1,K(n,L.code),await X.push({name:"contest"});return}s.value=L.data.has_auth,U.value=L.data.need_password,T.value=null;const _=new Date(L.data.now);if(_<new Date(L.data.contest.start_time)){const k=new Date().getTime()-_.getTime();T.value=new Date(new Date(L.data.contest.start_time).getTime()+k)}m.value=Wt(L.data.contest),u.value=m.value.problems,g=L.data.attempt_status||{},i.setTitle(m.value.title+" - "+i.getTitle),w.value=!1};return pe(async()=>{if(Array.isArray(l.params.contestId)?b=Number(l.params.contestId[0]):b=Number(l.params.contestId),!b){await X.push({name:"contest"});return}await $()}),(L,_)=>{const k=Tt,D=Fe,x=be,P=Re,z=ze,j=O,E=Ae,N=xe,le=we,Y=Ye,te=We,Q=Me("md-preview"),W=Pe,he=De;return V(),M(he,{loading:w.value},{default:a(()=>[t(W,{class:"dida-main-content"},{default:a(()=>[t(N,{span:6},{default:a(()=>{var ie,ue,J;return[R("div",Qs,[R("h1",null,q((ie=m.value)==null?void 0:ie.title),1),(ue=m.value)!=null&&ue.notification?(V(),M(k,{key:0,theme:"info",message:(J=m.value)==null?void 0:J.notification},null,8,["message"])):ae("",!0)]),R("div",er,[s.value?(V(),M(x,{key:0},{default:a(()=>[T.value?(V(),ee("div",tr,[_[1]||(_[1]=R("p",{class:"dida-countdown-head"},"比赛开启倒计时",-1)),t(Zs,{class:"dida-countdown-content",target:T.value,onOnEnd:d},null,8,["target"])])):(V(),M(D,{key:1,data:u.value,columns:C.value,"row-key":"id","table-layout":"auto","vertical-align":"top",hover:!0},null,8,["data","columns"]))]),_:1})):(V(),M(x,{key:1},{default:a(()=>[R("div",ar,[t(k,{theme:"warning",message:"您没有查看本比赛的权限"}),U.value?(V(),M(E,{key:0,style:{margin:"20px auto 0",width:"200px"},onSubmit:v,"label-width":"0"},{default:a(()=>[t(z,null,{default:a(()=>[t(P,{placeholder:"请输入密码",value:p.value,"onUpdate:value":_[0]||(_[0]=F=>p.value=F),style:{width:"300px"},type:"password",autocomplete:"new-password"},null,8,["value"])]),_:1}),t(z,null,{default:a(()=>[R("div",lr,[t(j,{theme:"primary",type:"submit",loading:fe(f)},{default:a(()=>_[2]||(_[2]=[I("提交")])),_:1},8,["loading"])])]),_:1})]),_:1})):ae("",!0)])]),_:1}))])]}),_:1}),t(N,{span:6},{default:a(()=>{var ie;return[R("div",nr,[t(le,null,{default:a(()=>[S.value?(V(),M(j,{key:0,onClick:A,loading:h.value},{default:a(()=>_[3]||(_[3]=[I("查重")])),_:1},8,["loading"])):ae("",!0),S.value?(V(),M(j,{key:1,onClick:r},{default:a(()=>_[4]||(_[4]=[I("编辑")])),_:1})):ae("",!0)]),_:1})]),R("div",or,[t(te,{layout:"vertical",bordered:!0},{default:a(()=>[t(Y,{label:"创建时间"},{default:a(()=>{var ue;return[I(q((ue=m.value)==null?void 0:ue.createTime),1)]}),_:1})]),_:1}),t(te,{layout:"vertical",bordered:!0},{default:a(()=>[t(Y,{label:"更新时间"},{default:a(()=>{var ue;return[I(q((ue=m.value)==null?void 0:ue.updateTime),1)]}),_:1})]),_:1}),t(te,{layout:"vertical",bordered:!0},{default:a(()=>[t(Y,{label:"开始时间"},{default:a(()=>{var ue;return[I(q((ue=m.value)==null?void 0:ue.startTime),1)]}),_:1})]),_:1}),t(te,{layout:"vertical",bordered:!0},{default:a(()=>[t(Y,{label:"结束时间"},{default:a(()=>{var ue;return[I(q((ue=m.value)==null?void 0:ue.endTime),1)]}),_:1})]),_:1})]),(ie=m.value)!=null&&ie.description?(V(),M(x,{key:0,style:{margin:"12px"}},{default:a(()=>{var ue;return[t(Q,{"model-value":(ue=m.value)==null?void 0:ue.description,class:"dida-content-description"},null,8,["model-value"])]}),_:1})):ae("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),rr=de(sr,[["__scopeId","data-v-74960a1e"]]);function Ka(e){return e?Math.floor(e/1e9):0}function ut(e){if(e<=0)return"0 秒 ";let l="";const n=Math.floor(e/3600);n>0&&(l+=`${n} 小时 `);const i=Math.floor(e%3600/60);return(i>0||n>0)&&(n>0&&i<10&&(l+="0"),l+=`${i} 分钟 `),e=e%60,(e>0||i>0||n>0)&&((n>0||i>0)&&e<10&&(l+="0"),l+=`${e.toFixed(0)} 秒`),l}const ir=_t("contest",{state:()=>({starMembers:{}}),actions:{clear(){this.$patch({starMembers:{}})},addStarMember(e,l){this.starMembers[e]||(this.starMembers[e]={}),this.starMembers[e][l]=!0},removeStarMember(e,l){this.starMembers[e]&&(delete this.starMembers[e][l],Object.keys(this.starMembers[e]).length===0&&delete this.starMembers[e])},isStarMember(e,l){var n;return!!((n=this.starMembers[e])!=null&&n[l])}},persist:!0}),ur={style:{margin:"10px 10px 40px"}},dr={style:{"text-align":"right","margin-bottom":"10px"}},cr={class:"table-scroll-wrapper"};function ma(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!at(e)}const mr=ce({__name:"ContestRank",setup(e){const l=Se(),n=Xe(),i=ir(),{globalProperties:o}=_e();let h=!1,b=null,w=0,m=null,s=null,U=0;const p=c(0),T=c(0),S=c(!1),y=c(!0),C=c(!0);let u=null,g=null,f=1,d=50;const r=c({current:f,pageSize:d,defaultCurrent:1,defaultPageSize:50,total:0,pageSizeOptions:[50,100,1e3]}),A=J=>i&&i.isStarMember(w,J),v=async J=>{r.value={...r.value,current:J.current,pageSize:J.pageSize},await n.push({query:{...l.query,page:J.current,page_size:J.pageSize}})},$=J=>{if(J==null)return"-";const F=Math.floor(J/3600).toString().padStart(2,"0"),Z=Math.floor(J%3600/60).toString().padStart(2,"0"),B=(J%60).toFixed(0).toString().padStart(2,"0");return`${F}:${Z}:${B}`},L=c({});let _={userId:0,ac:-1};const k=[{title:"Rank",colKey:"rank",align:"center",fixed:"left"},{title:"昵称",colKey:"nickname",fixed:"left",attrs:J=>{let F={};return A(J.row.userId)&&(F={backgroundColor:"rgba(255,165,30,0.5)"}),{style:F}},cell:(J,F)=>{const Z=Ol(F.row.nickname,18);let B=null;return A(F.row.userId)?B=t(O,{shape:"circle",variant:"text",class:"rank-unstar-button",onClick:()=>{i.removeStarMember(w,F.row.userId),he()}},{icon:()=>t(sl,null,null)}):B=t(O,{shape:"circle",variant:"text",class:"rank-star-button",onClick:()=>{i.addStarMember(w,F.row.userId),he()}},{icon:()=>t(rl,null,null)}),t("div",{class:"rank-nickname-cell"},[t(we,null,{default:()=>[t(Dl,{content:F.row.nickname},{default:()=>[t(O,{variant:"text",onClick:()=>n.push({name:"user",params:{username:F.row.username}})},ma(Z)?Z:{default:()=>[Z]})]}),B]})])}},{title:"Solved",colKey:"solved",align:"center",fixed:"left",cell:(J,F)=>t(O,{variant:"text",onClick:()=>n.push({name:"contest-judge",params:{contestId:w},query:{username:F.row.username,status:Be.Accept}})},{default:()=>[F.row.solved]})},{title:"Penalty",colKey:"penalty",align:"center",fixed:"left",cell:(J,F)=>$(F.row.penalty)}],D=c([]),x=c(!1);let P=[],z=[];const j=c([]);let E=[];const N=({col:J,rowIndex:F})=>{if(J.colKey==="rank"){let Z=r.value.current;r.value.current>Math.ceil(j.value.length/r.value.pageSize)&&(Z=Math.ceil(j.value.length/r.value.pageSize));let B=r.value.pageSize*(Z-1),oe=1;for(let ne=F+1;B+ne<j.value.length&&j.value[B+ne].rank===j.value[B+F].rank;ne++)oe++;return{rowspan:oe}}},le=(J,{value:F})=>ut(F),Y=()=>{u&&clearInterval(u),u=setInterval(()=>{h&&ue(!1)},3e4),g&&clearInterval(g),g=setInterval(()=>{if(!h||!m)return;p.value=(new Date().getTime()-m.getTime())/1e3;const J=Math.min(p.value,T.value);p.value=Math.min(p.value,J),he()},1e3)},te=()=>{u&&(clearInterval(u),u=null),g&&(clearInterval(g),g=null)},Q=async J=>{C.value=J,J?(await ue(!1),Y()):te()},W=()=>{he(),r.value={...r.value,current:1}},he=()=>{j.value=[];let J=[];if(_={},!m)return;for(let H=0;H<P.length;H++){const se=P[H];let ve={userId:se.author_id,username:se.author_username,nickname:se.author_nickname},$e=0,Ee=0;se.problems.forEach(ke=>{let Ke=-1,lt=ke.lock||0;if(ke.ac){let nt=0;if(m&&(nt=m.getTime()),Ke=(new Date(ke.ac).getTime()-nt)/1e3,Ke>p.value)return;$e++,Ee+=Ke,Ee+=ke.attempt*20*60,_[ke.index]===void 0?_[ke.index]={userId:se.author_id,ac:Ke}:_[ke.index].ac>Ke&&(_[ke.index].userId=se.author_id,_[ke.index].ac=Ke)}if(lt>0&&U>0){const nt=T.value-U;p.value<nt&&(lt=0)}const rt=ke.index;ve[`problem_${rt}`]={acDuration:Ke,attempt:ke.attempt||0,lock:lt}}),ve.solved=$e,ve.penalty=Ee,J.push(ve)}J.sort((H,se)=>H.solved!==se.solved?se.solved-H.solved:H.penalty!==se.penalty?H.penalty-se.penalty:H.userId-se.userId);const F=z;let Z=0,B=0,oe=-1,ne=-1;for(let H=0;H<J.length;H++)F&&F.includes(J[H].userId)?J[H].rank="*":(B++,(J[H].solved!==oe||J[H].penalty!==ne)&&(Z=B,oe=J[H].solved,ne=J[H].penalty),J[H].rank=String(Z));S.value&&(J=J.filter(H=>A(H.userId)));const Ce=document.querySelectorAll("tbody tr"),Ie={};E.forEach((H,se)=>{const ve=Ce[se];ve&&(Ie[H.userId]=ve.getBoundingClientRect())}),r.value={...r.value,total:J.length},j.value=J;for(let H=0;H<j.value.length;H++)j.value[H].index=H+1;if(E=[...j.value],y.value){const H={},se=document.querySelectorAll("table tbody tr");j.value.forEach((ve,$e)=>{const Ee=se[$e];Ee&&(H[ve.userId]=Ee.getBoundingClientRect())}),requestAnimationFrame(()=>{const ve=document.querySelectorAll("table tbody tr");j.value.forEach(($e,Ee)=>{const ke=ve[Ee],Ke=Ie[$e.userId],lt=H[$e.userId];if(Ke&&lt){const rt=Ke.top-lt.top;rt!==0&&(ke.style.transition="none",ke.style.transform=`translateY(${rt}px)`)}}),requestAnimationFrame(()=>{document.querySelectorAll("table tbody tr").forEach(Ee=>{Ee.style.transition="transform 300ms ease",Ee.style.transform=""})})})}},ie=J=>{if(Q(!1),!m)return;p.value=J;const F=Math.min(T.value,(new Date().getTime()-(m==null?void 0:m.getTime()))/1e3);p.value=Math.min(p.value,F),he()},ue=async J=>{J&&(x.value=!0);try{const F=await xo(w);if(D.value=[...k],P=[],z=[],j.value=[],r.value={...r.value,total:0},F.code===0){if(!F.data.has_auth){ye(o,"您目前没有权限查看比赛排名"),await n.push({name:"contest-detail",params:{contestId:w}});return}F.data.problems.sort((oe,ne)=>oe-ne),F.data.problems.forEach((oe,ne)=>{D.value.push({colKey:`problem_${oe}`,align:"center",title:()=>{let Ce;return t(O,{variant:"text",onClick:()=>n.push({name:"contest-problem-detail",params:{contestId:w,problemIndex:oe}})},ma(Ce=tt(oe))?Ce:{default:()=>[Ce]})},cell:(Ce,Ie)=>{const H=Ie.row[`problem_${oe}`];if(!H)return"";let se="";return H.acDuration>=0&&(se=$(H.acDuration)),H.attempt>0&&(se&&(se+=" "),se+=`(-${H.attempt})`),H.lock>0&&(se&&(se+=" "),se+=`(+${H.lock})`),t("span",null,[se])},attrs:Ce=>{const Ie=Ce.row[`problem_${oe}`];if(!Ie)return{};if(Ie.acDuration>=0){const H=_[oe];if(H!==void 0){const se=Ce.row.userId;if(H.userId===se)return{style:{backgroundColor:"rgba(65,155,5,0.5)"}}}return{style:{backgroundColor:"rgba(130,255,30,0.5)"}}}return Ie.lock>0?{style:{backgroundColor:"rgb(255,180,50,0.5)"}}:Ie.attempt>0?{style:{backgroundColor:"rgba(255,120,120,0.5)"}}:{}}})});const Z=F.data.contest;if(m=new Date(Z.start_time),s=new Date(Z.end_time),P=F.data.ranks,z=F.data.v_members||[],T.value=Math.floor((s.getTime()-m.getTime())/1e3),L.value={0:"0",[Math.floor(T.value/2)]:ut(Math.floor(T.value/2)),[T.value]:ut(T.value)},U=Ka(Z.lock_rank_duration||0),F.data.is_locked&&U>0){const oe=Math.max(0,T.value-U);L.value[oe]=t("span",{style:"color: #0052d9"},[I("锁榜("),ut(oe),I(")")])}p.value=Math.floor((new Date().getTime()-m.getTime())/1e3);const B=Math.min(p.value,T.value);p.value=Math.min(p.value,B),C.value=!0,Y(),he()}else J&&K(o,F.code)}catch(F){console.error(F),J&&K(o,He())}finally{J&&(x.value=!1)}};return pe(async()=>{h=!0,b=Ue(()=>l.query,async J=>{if(Array.isArray(l.params.contestId)?w=Number(l.params.contestId[0]):w=Number(l.params.contestId),!w){await n.push({name:"contest"});return}const F=parseInt(J.page)||r.value.defaultCurrent,Z=parseInt(J.page_size)||r.value.defaultPageSize;f=F,d=Z,r.value={...r.value,current:f,pageSize:d},await ue(!0)},{immediate:!0})}),Ve(()=>{h=!1,b&&b(),te()}),(J,F)=>{const Z=bt,B=we,oe=xl,ne=Fe,Ce=be,Ie=Pe;return V(),M(Ie,null,{default:a(()=>[t(Ce,{style:{margin:"10px",width:"100%"}},{default:a(()=>[R("div",ur,[I(" 榜单时间 "+q(fe(ut)(p.value))+" ",1),R("div",dr,[t(B,null,{default:a(()=>[t(Z,{size:"large",modelValue:S.value,"onUpdate:modelValue":F[0]||(F[0]=H=>S.value=H),onChange:W},{label:a(H=>[I(q(H.value?"仅展示收藏":"未过滤收藏"),1)]),_:1},8,["modelValue"]),t(Z,{size:"large",modelValue:y.value,"onUpdate:modelValue":F[1]||(F[1]=H=>y.value=H)},{label:a(H=>[I(q(H.value?"开启动画":"关闭动画"),1)]),_:1},8,["modelValue"]),t(Z,{size:"large",modelValue:C.value,"onUpdate:modelValue":F[2]||(F[2]=H=>C.value=H),onChange:Q},{label:a(H=>[I(q(H.value?"自动刷新":"关闭刷新"),1)]),_:1},8,["modelValue"])]),_:1})]),t(oe,{modelValue:p.value,"onUpdate:modelValue":F[3]||(F[3]=H=>p.value=H),marks:L.value,max:T.value,label:le,"tooltip-props":{placement:"top"},onChangeEnd:ie},null,8,["modelValue","marks","max"])]),R("div",cr,[t(ne,{data:j.value,columns:D.value,"row-key":"index","vertical-align":"middle",bordered:!0,hover:!0,"table-layout":"auto","rowspan-and-colspan":N,loading:x.value,class:"dida-contest-rank-table",pagination:r.value,onPageChange:v},null,8,["data","columns","loading","pagination"])])]),_:1})]),_:1})}}}),pr=de(mr,[["__scopeId","data-v-d29ef89f"]]),fr={style:{margin:"10px"}},vr={style:{margin:"12px"}},_r={class:"dida-edit-container"},gr={class:"dida-description-editor"},br=ce({__name:"ContestEdit",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze(),o=c(0),h=c(!1),b=c(!1),w=c(!1),m=c(null),s=c({title:"",openTime:[],private:!0,password:"",problems:[],members:[],description:"",notification:"",lockRankDuration:0,alwaysLock:!0,submitAnytime:!1}),U=c(""),p=c(""),T=c(!1),S=async()=>{T.value=!0,w.value=!1,T.value=!1},y=async(d,r)=>{b.value=!0,await ct(d,r,n,()=>Io(o.value)),b.value=!1},C=async()=>{b.value=!0;try{const d={title:s.value.title,description:s.value.description,notification:s.value.notification,lock_rank_duration:s.value.lockRankDuration,always_lock:s.value.alwaysLock,problems:s.value.problems,members:s.value.members,private:s.value.private,password:s.value.password,submit_anytime:s.value.submitAnytime};s.value.openTime[0]&&(d.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(d.end_time=new Date(s.value.openTime[1]));const r=await Do(d);if(b.value=!0,r.code!==0){K(n,r.code);return}r.data!=null&&await X.push({name:"contest-detail",params:{contestId:r.data}}),Ge(n,"创建成功")}finally{b.value=!1}},u=async()=>{b.value=!0;try{const d={id:Number(o.value),title:s.value.title,notification:s.value.notification,lock_rank_duration:s.value.lockRankDuration,always_lock:s.value.alwaysLock,problems:s.value.problems,members:s.value.members,private:s.value.private,password:s.value.password,submit_anytime:s.value.submitAnytime,description:s.value.description};s.value.openTime[0]&&(d.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(d.end_time=new Date(s.value.openTime[1]));const r=await Vo(d);if(b.value=!0,r.code!==0){K(n,r.code);return}m.value&&(r.data.description!=null&&(s.value.description=r.data.description),r.data.update_time!=null&&(m.value.updateTime=new Date(r.data.update_time).toLocaleString())),Ge(n,"保存成功")}finally{b.value=!1}},g=d=>{s.value.description=d,h.value=!1},f=async()=>{const d=await So(o.value);if(d.code!==0){K(n,d.code),console.error("contest get failed",d.code),await X.push({name:"contest-list"});return}const r=d.data.contest;m.value=Wt(r),s.value.title=r.title,s.value.openTime=[],r.start_time?s.value.openTime.push(new Date(r.start_time)):s.value.openTime.push(""),r.end_time?s.value.openTime.push(new Date(r.end_time)):s.value.openTime.push(""),s.value.private=r.private,s.value.password=r.password||"",s.value.description=r.description||"",s.value.notification=r.notification||"",s.value.problems=d.data.problems,s.value.members=d.data.members,r.lock_rank_duration?s.value.lockRankDuration=Ka(r.lock_rank_duration):s.value.lockRankDuration=0,s.value.alwaysLock=r.always_lock,s.value.submitAnytime=r.submit_anytime,i.setTitle(r.title+" - "+i.getTitle);let A="";r.description&&(A=r.description),g(A)};return pe(async()=>{Array.isArray(l.params.contestId)?o.value=Number(l.params.contestId[0]):o.value=Number(l.params.contestId),o.value?(h.value=!0,await f()):g("")}),(d,r)=>{const A=Re,v=ze,$=Gt,L=bt,_=ka,k=Ae,D=be,x=xe,P=O,z=we,j=Ye,E=We,N=Pe,le=Me("md-editor-v3"),Y=De,te=xt,Q=st;return V(),ee(me,null,[t(Y,{loading:h.value},{default:a(()=>[t(N,null,{default:a(()=>[t(x,{span:8},{default:a(()=>[R("div",fr,[t(D,{class:"sh-card"},{default:a(()=>[t(k,{model:s.value,"label-width":"150px"},{default:a(()=>[t(v,{label:"标题"},{default:a(()=>[t(A,{modelValue:s.value.title,"onUpdate:modelValue":r[0]||(r[0]=W=>s.value.title=W),placeholder:"比赛标题"},null,8,["modelValue"])]),_:1}),t(v,{label:"通知"},{default:a(()=>[t(A,{modelValue:s.value.notification,"onUpdate:modelValue":r[1]||(r[1]=W=>s.value.notification=W),placeholder:"会更为醒目地提醒"},null,8,["modelValue"])]),_:1}),t(v,{label:"开启时间"},{default:a(()=>[t($,{modelValue:s.value.openTime,"onUpdate:modelValue":r[2]||(r[2]=W=>s.value.openTime=W),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(v,{label:"提交限制"},{default:a(()=>[t(L,{modelValue:s.value.submitAnytime,"onUpdate:modelValue":r[3]||(r[3]=W=>s.value.submitAnytime=W)},{label:a(W=>[I(q(W.value?"结束仍能提交":"仅比赛期间提交"),1)]),_:1},8,["modelValue"])]),_:1}),t(v,{label:"锁榜时长"},{default:a(()=>[t(_,{modelValue:s.value.lockRankDuration,"onUpdate:modelValue":r[4]||(r[4]=W=>s.value.lockRankDuration=W),min:0,format:fe(ut),"auto-width":""},null,8,["modelValue","format"])]),_:1}),t(v,{label:"自动解锁"},{default:a(()=>[t(L,{modelValue:s.value.alwaysLock,"onUpdate:modelValue":r[5]||(r[5]=W=>s.value.alwaysLock=W)},{label:a(W=>[I(q(W.value?"结束后仍锁榜":"结束后解锁"),1)]),_:1},8,["modelValue"])]),_:1}),t(v,{label:"私有"},{default:a(()=>[t(L,{modelValue:s.value.private,"onUpdate:modelValue":r[6]||(r[6]=W=>s.value.private=W)},null,8,["modelValue"])]),_:1}),s.value.private?(V(),M(v,{key:0,label:"密码"},{default:a(()=>[t(A,{modelValue:s.value.password,"onUpdate:modelValue":r[7]||(r[7]=W=>s.value.password=W),type:"password",placeholder:"请输入访问密码，留空代表关闭密码访问"},null,8,["modelValue"])]),_:1})):ae("",!0),s.value.private?(V(),M(v,{key:1,label:"成员"},{default:a(()=>[t(Fa,{modelValue:s.value.members,"onUpdate:modelValue":r[8]||(r[8]=W=>s.value.members=W)},null,8,["modelValue"])]),_:1})):ae("",!0),t(v,{label:"问题"},{default:a(()=>[t(qa,{modelValue:s.value.problems,"onUpdate:modelValue":r[9]||(r[9]=W=>s.value.problems=W)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(x,{span:4},{default:a(()=>[R("div",vr,[R("div",_r,[o.value?(V(),M(z,{key:0},{default:a(()=>[t(P,{onClick:u,theme:"danger",loading:b.value},{default:a(()=>r[13]||(r[13]=[I("保存")])),_:1},8,["loading"])]),_:1})):(V(),M(z,{key:1},{default:a(()=>[t(P,{onClick:C,theme:"danger",loading:b.value},{default:a(()=>r[14]||(r[14]=[I("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(V(),M(E,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(j,{label:"创建时间"},{default:a(()=>{var W;return[I(q((W=m.value)==null?void 0:W.createTime),1)]}),_:1}),t(j,{label:"更新时间"},{default:a(()=>{var W;return[I(q((W=m.value)==null?void 0:W.updateTime),1)]}),_:1}),t(j,{label:"创建用户"},{default:a(()=>{var W;return[I(q((W=m.value)==null?void 0:W.ownerNickname),1)]}),_:1})]),_:1})):ae("",!0)])]),_:1})]),_:1}),R("div",gr,[r[15]||(r[15]=R("p",null,"公告",-1)),t(le,{id:"contest-description-editor",modelValue:s.value.description,"onUpdate:modelValue":r[10]||(r[10]=W=>s.value.description=W),onSave:u,onOnUploadImg:y,previewTheme:"cyanosis"},null,8,["modelValue"]),t(Y,{loading:b.value,attach:"#contest-description-editor","z-index":1e5},null,8,["loading"])])]),_:1},8,["loading"]),t(Q,{visible:w.value,"onUpdate:visible":r[12]||(r[12]=W=>w.value=W),onConfirm:S,header:U.value,"confirm-loading":T.value},{default:a(()=>[r[16]||(r[16]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(te,{modelValue:p.value,"onUpdate:modelValue":r[11]||(r[11]=W=>p.value=W),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),pa=de(br,[["__scopeId","data-v-6b7ea9fb"]]);function Zt(e){const l={};return l.id=e.id,l.authorId=e.author_id,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.title=e.title,l.content=e.content,e.insert_time&&(l.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(l.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(l.updateTime=new Date(e.update_time).toLocaleString()),l.problemId=e.problem_id,l.problemTitle=e.problem_title,l.contestId=e.contest_id,l.contestTitle=e.contest_title,l.contestProblemIndex=e.contest_problem_index,l}function hr(e){const l={};return l.id=e.id,l.authorId=e.author_id,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.content="",e.content&&(l.content=e.content),e.insert_time&&(l.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(l.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(l.updateTime=new Date(e.update_time).toLocaleString()),l}function yr(e){return G({url:"/discuss?id="+e,method:"get"})}function wr(e){return G({url:"/discuss/edit?id="+e,method:"get"})}function kr(e,l,n,i,o,h,b){const w={};return e?w.only_problem="1":w.only_problem="0",l&&(w.contest_id=l),n&&(w.problem_id=n),i&&(w.title=i),o&&(w.username=o),h&&(w.page=h),b&&(w.page_size=b),G({url:`/discuss/list?${new URLSearchParams(w).toString()}`,method:"get"})}function Sr(e){return e||(e=0),G({url:"/discuss/image/token?id="+e,method:"get"})}function Cr(e,l){return e||(e=0),l||(l=0),G({url:"/discuss/comment/image/token?id="+e+"&comment_id="+l,method:"get"})}function Ir(e,l,n){return G({url:"/discuss/comment/list?id="+e+"&page="+l+"&page_size="+n,method:"get"})}function Pr(e){return G({url:"/discuss/create",method:"post",data:e})}function Tr(e){return G({url:"/discuss/edit",method:"post",data:e})}function xr(e){return G({url:"/discuss/comment/create",method:"post",data:e})}function Dr(e){return G({url:"/discuss/comment/edit",method:"post",data:e})}const Vr={style:{margin:"10px"}};function $r(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!at(e)}const jr=ce({__name:"DiscussList",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=!1,h=null,b=-1,w=c(!1);const m=c([]),s=[],U=[{title:"标题",colKey:"title",cell:(L,_)=>t(O,{variant:"text",onClick:()=>d(_.row.id)},{default:()=>[_.row.title]})},{title:"创建人",colKey:"authorNickname",width:"200",cell:(L,_)=>t(O,{variant:"text",onClick:async()=>await Yt(n,_.row.authorUsername)},{default:()=>[_.row.authorNickname]})},{title:"创建时间",colKey:"insertTime",width:"180"},{title:"更新时间",colKey:"updateTime",width:"180"}],p=c(!1);let T=1,S=50;const y=c({current:T,pageSize:S,defaultCurrent:T,defaultPageSize:S,total:0,pageSizeOptions:[50,100]}),C=c(),u=c({problemId:"",title:"",username:""}),g=L=>{L&&n.push({name:"problem-detail",params:{problemId:L}})},f=(L,_)=>{n.push({name:"contest-problem-detail",params:{contestId:L,problemIndex:_}})},d=L=>{if(L){if(b){n.push({name:"contest-discuss-detail",params:{contestId:b,discussId:L}});return}n.push({name:"discuss-detail",params:{discussId:L}})}},r=async()=>{await n.push({query:{...l.query,problem_id:u.value.problemId,title:u.value.title,username:u.value.username,page:1,page_size:y.value.defaultPageSize}})},A=async(L,_)=>{var k;p.value=!0;try{const{current:D,pageSize:x}=L,P=await kr(w.value,b,u.value.problemId,u.value.title,u.value.username,D,x);if(C.value=[],P.code===0){if(!P.data.has_auth){ye(i,"您目前没有权限查看讨论列表"),b?await n.push({name:"contest-detail",params:{contestId:b}}):await n.push({name:"discuss-list"});return}if(P.data.list){const z=P.data.list;for(let j=0;j<z.length;j++){const E=z[j],N=await Zt(E);(k=C.value)==null||k.push(N)}}y.value={...y.value,total:P.data.total_count}}else _&&K(i,P.code)}catch(D){console.error(D),K(i,He())}finally{p.value=!1}},v=async L=>{await n.push({query:{...l.query,page:L.current,page_size:L.pageSize}})},$=async()=>{await n.push({name:"discuss-create"})};return pe(async()=>{o=!0,h=Ue(()=>l.query,L=>{if(!o)return;w.value=l.name==="discuss-list-problem",Array.isArray(l.params.contestId)?b=Number(l.params.contestId[0]):b=Number(l.params.contestId),m.value=s,b?m.value=m.value.concat([{title:"问题ID",colKey:"contestProblemIndex",width:"100",cell:(D,x)=>{let P;return x.row.contestProblemIndex?t(O,{variant:"text",onClick:()=>f(b,x.row.contestProblemIndex)},$r(P=tt(x.row.contestProblemIndex))?P:{default:()=>[P]}):""}}]):m.value=m.value.concat([{title:"问题ID",colKey:"problemId",width:"100",cell:(D,x)=>x.row.problemId?t(O,{variant:"text",onClick:()=>g(x.row.problemId)},{default:()=>[x.row.problemId]}):""}]),m.value=m.value.concat(U),u.value.problemId=L.problem_id||"",u.value.title=L.title||"",u.value.username=L.username||"";const _=parseInt(L.page)||y.value.defaultCurrent,k=parseInt(L.page_size)||y.value.defaultPageSize;T=_,S=k,y.value={...y.value,current:T,pageSize:S},A({current:T,pageSize:S},!0)},{immediate:!0})}),Ve(()=>{o=!1,h&&h()}),(L,_)=>{const k=Fe,D=be,x=xe,P=Re,z=ze,j=O,E=Ae,N=we,le=Pe;return V(),M(le,null,{default:a(()=>[t(x,{span:9},{default:a(()=>[t(D,{style:{margin:"10px"}},{default:a(()=>[t(k,{data:C.value,columns:m.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:y.value,loading:p.value,"table-layout":"auto",onPageChange:v},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(x,{span:3},{default:a(()=>[R("div",Vr,[t(D,{class:"sh-card"},{default:a(()=>[t(E,{model:u.value},{default:a(()=>[t(z,{label:"问题ID"},{default:a(()=>[t(P,{modelValue:u.value.problemId,"onUpdate:modelValue":_[0]||(_[0]=Y=>u.value.problemId=Y),placeholder:"请输入完整问题ID"},null,8,["modelValue"])]),_:1}),t(z,{label:"标题"},{default:a(()=>[t(P,{modelValue:u.value.title,"onUpdate:modelValue":_[1]||(_[1]=Y=>u.value.title=Y),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(z,{label:"创建人"},{default:a(()=>[t(P,{modelValue:u.value.username,"onUpdate:modelValue":_[2]||(_[2]=Y=>u.value.username=Y),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(z,null,{default:a(()=>[t(j,{theme:"primary",onClick:r},{default:a(()=>_[3]||(_[3]=[I("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(D,{class:"sh-card"},{default:a(()=>[t(N,null,{default:a(()=>[t(j,{onClick:$},{default:a(()=>_[4]||(_[4]=[I("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),Rt=de(jr,[["__scopeId","data-v-d6935e64"]]),Lr={key:0,style:{margin:"20px"}},Ur={class:"dida-operation-container"},Ar={class:"dida-operation-container"},zr={style:{margin:"10px"}},Rr={style:{margin:"10px"}},Er={style:{margin:"10px"},class:"dida-operation-container"},Mr={style:{margin:"12px"}},qr={key:0,class:"dida-edit-container"},Fr=ce({__name:"DiscussDetail",props:{discussId:{}},setup(e){const l=e;let n=Se();const{globalProperties:i}=_e();let o=!1,h=null;const b=Ze(),w=qe();let m=c("");const s=c(0),U=c(!1),p=c(null),T=c(!1),S=c(!1),y=c(0),C=c("");let u=1,g=20;const f=c({current:1,pageSize:20,total:0,defaultPageSize:g,defaultCurrent:u,pageSizeOptions:[20,50]}),d=c([]),r=Je(()=>w.hasAuth(je.ManageDiscuss)),A=Je(()=>w.hasAuth(je.ManageDiscuss)||p.value&&w.getUserId==p.value.authorId),v=()=>{X.push({name:"discuss-edit",params:{discussId:s.value}})},$=()=>t("div",{class:"t-pagination__total"},[`共 ${f.value.total} 条回复`]),L=(z,j)=>{y.value=z,C.value=j;const E=document.getElementById("discuss-comment-editor");E&&E.scrollIntoView({behavior:"smooth"})},_=()=>{y.value=0,C.value="";const z=document.getElementById("discuss-comment-editor");z&&z.scrollIntoView({behavior:"smooth"})},k=async()=>{S.value=!0;try{let z;if(y.value){const j={id:y.value,discuss_id:s.value,content:C.value};if(z=await Dr(j),z.code!==0){K(i,z.code);return}Ge(i,"编辑成功"),y.value=0,C.value="",u===1?await x({current:1,pageSize:g},!0):await X.push({query:{current:1}});const E=document.getElementById("comment-divider");E&&E.scrollIntoView({behavior:"smooth"})}else{const j={discuss_id:s.value,content:C.value};if(z=await xr(j),z.code!==0){K(i,z.code);return}Ge(i,"编辑成功"),y.value=0,C.value="",u===1?await x({current:1,pageSize:g},!0):await X.push({query:{current:1}});const E=document.getElementById("comment-divider");E&&E.scrollIntoView({behavior:"smooth"})}}finally{S.value=!1}},D=async(z,j)=>{S.value=!0,await ct(z,j,i,()=>Cr(s.value,y.value)),S.value=!1},x=async(z,j)=>{var E;T.value=!0;try{const{current:N,pageSize:le}=z,Y=await Ir(s.value,N,le);if(d.value=[],Y.code===0){const te=Y.data.list;if(te)for(let Q=0;Q<te.length;Q++){const W=te[Q],he=hr(W);(E=d.value)==null||E.push(he)}f.value={...f.value,total:Y.data.total_count}}else j&&K(i,Y.code)}catch(N){console.error(N),K(i,He())}finally{T.value=!1}},P=async z=>{await X.push({query:{...n.query,page:z.current,page_size:z.pageSize}})};return pe(async()=>{if(o=!0,s.value=Number(l.discussId),s.value||(Array.isArray(n.params.discussId)?s.value=Number(n.params.discussId[0]):s.value=Number(n.params.discussId)),!s.value){ge(i,"讨论不存在"),await X.push({name:"discuss"});return}U.value=!0;const z=await yr(s.value);if(z.code!==0){U.value=!1,K(i,z.code),await X.push({name:"discuss"});return}p.value=Zt(z.data.discuss),b.setTitle(p.value.title+" - "+b.getTitle),m.value=p.value.content,U.value=!1,h=Ue(()=>n.query,j=>{if(!o)return;const E=parseInt(j.page)||f.value.defaultCurrent,N=parseInt(j.page_size)||f.value.defaultPageSize;u=E,g=N,f.value={...f.value,current:u,pageSize:g},x({current:u,pageSize:g},!0)},{immediate:!0})}),Ve(()=>{o=!1,h&&h()}),(z,j)=>{const E=Ca,N=Sa,le=Me("md-preview"),Y=be,te=Vl,Q=we,W=O,he=$l,ie=Qe,ue=Me("md-editor-v3"),J=De,F=xe,Z=Ye,B=We,oe=Pe;return V(),M(J,{loading:U.value},{default:a(()=>[t(oe,{class:"dida-main-content"},{default:a(()=>[t(F,{span:8},{default:a(()=>{var ne,Ce,Ie;return[(ne=p.value)!=null&&ne.problemTitle||(Ce=p.value)!=null&&Ce.contestTitle?(V(),ee("div",Lr,[t(N,{"max-item-width":"300"},{default:a(()=>{var H,se,ve,$e,Ee;return[(H=p.value)!=null&&H.contestTitle?(V(),ee(me,{key:0},[t(E,{to:{name:"contest-detail",params:{contestId:(se=p.value)==null?void 0:se.contestId}}},{default:a(()=>{var ke;return[I(q((ke=p.value)==null?void 0:ke.contestTitle),1)]}),_:1},8,["to"]),(ve=p.value)!=null&&ve.contestProblemIndex?(V(),M(E,{key:0,to:{name:"contest-problem-detail",params:{problemIndex:($e=p.value)==null?void 0:$e.contestProblemIndex}}},{default:a(()=>{var ke,Ke;return[I(q(fe(tt)((ke=p.value)==null?void 0:ke.contestProblemIndex))+" - "+q((Ke=p.value)==null?void 0:Ke.problemTitle),1)]}),_:1},8,["to"])):ae("",!0)],64)):(V(),ee(me,{key:1},[t(E,{to:{name:"discuss-list-problem"}},{default:a(()=>j[4]||(j[4]=[I(" 题目讨论")])),_:1}),t(E,{to:{name:"problem-detail",params:{problemId:(Ee=p.value)==null?void 0:Ee.problemId}}},{default:a(()=>{var ke;return[I(q((ke=p.value)==null?void 0:ke.problemTitle),1)]}),_:1},8,["to"])],64))]}),_:1})])):ae("",!0),t(Y,{style:{margin:"10px"},header:(Ie=p.value)==null?void 0:Ie.title,"header-bordered":!0},{default:a(()=>[t(le,{"model-value":fe(m),previewTheme:"cyanosis"},null,8,["model-value"])]),_:1},8,["header"]),t(te,{id:"comment-divider"},{default:a(()=>j[5]||(j[5]=[I("评论区")])),_:1}),(V(!0),ee(me,null,Te(d.value,(H,se)=>(V(),M(Y,{key:se,style:{margin:"10px"},"header-bordered":""},{header:a(()=>[R("div",Ur,[t(Q,null,{default:a(()=>[R("span",null,q(H.authorNickname),1),R("span",null,q(H.insertTime),1)]),_:2},1024)]),R("div",Ar,[t(Q,null,{default:a(()=>[r.value||fe(w).getUserId===H.authorId?(V(),M(W,{key:0,onClick:()=>{L(H.id,H.content)}},{default:a(()=>j[6]||(j[6]=[I(" 编辑 ")])),_:2},1032,["onClick"])):ae("",!0)]),_:2},1024)])]),default:a(()=>[t(le,{"model-value":H.content,previewTheme:"cyanosis"},null,8,["model-value"])]),_:2},1024))),128)),R("div",zr,[t(he,{modelValue:f.value.current,"onUpdate:modelValue":j[0]||(j[0]=H=>f.value.current=H),"page-size":f.value.pageSize,"onUpdate:pageSize":j[1]||(j[1]=H=>f.value.pageSize=H),total:f.value.total,"page-size-options":f.value.pageSizeOptions,"show-page-size":!1,"total-content":$,onChange:P},null,8,["modelValue","page-size","total","page-size-options"])]),t(te),R("div",Rr,[R("div",Er,[t(ie,{style:{margin:"10px"}},{default:a(()=>[I(q(y.value?"编辑回复":"发表回复"),1)]),_:1}),t(Q,null,{default:a(()=>[t(W,{theme:"danger",onClick:_},{default:a(()=>j[7]||(j[7]=[I("清除")])),_:1}),t(W,{theme:"primary",onClick:k,loading:S.value},{default:a(()=>j[8]||(j[8]=[I("提交")])),_:1},8,["loading"])]),_:1})]),t(ue,{id:"discuss-comment-editor",modelValue:C.value,"onUpdate:modelValue":j[2]||(j[2]=H=>C.value=H),previewTheme:"cyanosis",onSave:k,onOnUploadImg:D},null,8,["modelValue"]),t(J,{loading:S.value,attach:"#discuss-comment-editor","z-index":1e5},null,8,["loading"])])]}),_:1}),t(F,{span:4},{default:a(()=>[R("div",Mr,[A.value?(V(),ee("div",qr,[t(W,{onClick:v},{default:a(()=>j[9]||(j[9]=[I("编辑")])),_:1})])):ae("",!0),t(B,{layout:"vertical",bordered:!0},{default:a(()=>[t(Z,{label:"创建时间"},{default:a(()=>{var ne;return[I(q((ne=p.value)==null?void 0:ne.insertTime),1)]}),_:1}),t(Z,{label:"编辑时间"},{default:a(()=>{var ne;return[I(q((ne=p.value)==null?void 0:ne.modifyTime),1)]}),_:1}),t(Z,{label:"更新时间"},{default:a(()=>{var ne;return[I(q((ne=p.value)==null?void 0:ne.updateTime),1)]}),_:1}),t(Z,{label:"创建用户"},{default:a(()=>[t(W,{variant:"text",onClick:j[3]||(j[3]=async()=>{var ne;return await fe(Yt)(fe(X),(ne=p.value)==null?void 0:ne.authorUsername)})},{default:a(()=>{var ne;return[I(q((ne=p.value)==null?void 0:ne.authorNickname),1)]}),_:1})]),_:1}),t(Z,{label:"标签"})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Et=de(Fr,[["__scopeId","data-v-3d044029"]]),Kr={style:{margin:"10px"}},Nr={style:{margin:"12px"}},Or={class:"dida-edit-container"},Gr={class:"dida-description-editor"},Hr=ce({__name:"DiscussEdit",setup(e){let l=Se();const{globalProperties:n}=_e();let i=null;const o=c(0),h=c(!1),b=c(!1),w=c(null),m=c({title:"",problemId:"",content:""}),s=()=>{X.push({name:"discuss-detail",params:{discussId:o.value}})};async function U(C,u){b.value=!0,await ct(C,u,n,()=>Sr(o.value)),b.value=!1}const p=async()=>{b.value=!0;try{const C={title:m.value.title,content:m.value.content,problem_id:m.value.problemId},u=await Pr(C);if(b.value=!0,u.code!==0){K(n,u.code);return}const g=u.data;await X.push({name:"discuss-detail",params:{discussId:g}}),Ge(n,"创建成功")}finally{b.value=!1}},T=async()=>{b.value=!0;try{const C={id:o.value,title:m.value.title,content:m.value.content,problem_id:m.value.problemId},u=await Tr(C);if(b.value=!0,u.code!==0){K(n,u.code);return}w.value&&u.data.modify_time!=null&&(w.value.modifyTime=new Date(u.data.modify_time).toLocaleString()),u.data.content!=null&&(m.value.content=u.data.content),Ge(n,"保存成功")}finally{b.value=!1}},S=async()=>{o.value?await T():await p()},y=async()=>{const C=await wr(o.value);if(C.code!==0){K(n,C.code),await X.push({name:"discuss"});return}const u=C.data.discuss;w.value=Zt(u),m.value.title=u.title,m.value.content=u.content,m.value.problemId=u.problem_id,h.value=!1};return pe(async()=>{i=Ue(()=>l.params,async()=>{Array.isArray(l.params.discussId)?o.value=Number(l.params.discussId[0]):o.value=Number(l.params.discussId),o.value?(h.value=!0,await y()):(m.value.title="",m.value.problemId="",m.value.content="")},{immediate:!0})}),Ve(()=>{i&&(i(),i=null)}),(C,u)=>{const g=Re,f=ze,d=Ae,r=be,A=xe,v=O,$=we,L=Ye,_=We,k=Pe,D=Me("md-editor-v3"),x=De;return V(),M(x,{loading:h.value},{default:a(()=>[t(k,null,{default:a(()=>[t(A,{span:8},{default:a(()=>[R("div",Kr,[t(r,{class:"sh-form-card"},{default:a(()=>[t(d,{model:m.value},{default:a(()=>[t(f,{label:"标题"},{default:a(()=>[t(g,{modelValue:m.value.title,"onUpdate:modelValue":u[0]||(u[0]=P=>m.value.title=P),placeholder:"讨论标题"},null,8,["modelValue"])]),_:1}),t(f,{label:"关联题目"},{default:a(()=>[t(g,{modelValue:m.value.problemId,"onUpdate:modelValue":u[1]||(u[1]=P=>m.value.problemId=P),placeholder:"讨论题目"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(A,{span:4},{default:a(()=>[R("div",Nr,[R("div",Or,[o.value?(V(),M($,{key:0},{default:a(()=>[t(v,{onClick:T,theme:"danger",loading:b.value},{default:a(()=>u[3]||(u[3]=[I("保存")])),_:1},8,["loading"]),t(v,{onClick:s},{default:a(()=>u[4]||(u[4]=[I("查看")])),_:1})]),_:1})):(V(),M($,{key:1},{default:a(()=>[t(v,{onClick:p,theme:"danger",loading:b.value},{default:a(()=>u[5]||(u[5]=[I("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(V(),M(_,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(L,{label:"创建时间"},{default:a(()=>{var P;return[I(q((P=w.value)==null?void 0:P.insertTime),1)]}),_:1}),t(L,{label:"更新时间"},{default:a(()=>{var P;return[I(q((P=w.value)==null?void 0:P.modifyTime),1)]}),_:1}),t(L,{label:"创建用户"},{default:a(()=>{var P;return[I(q((P=w.value)==null?void 0:P.authorNickname),1)]}),_:1})]),_:1})):ae("",!0)])]),_:1})]),_:1}),R("div",Gr,[t(D,{id:"discuss-editor",modelValue:m.value.content,"onUpdate:modelValue":u[2]||(u[2]=P=>m.value.content=P),onSave:S,onOnUploadImg:U,previewTheme:"cyanosis"},null,8,["modelValue"]),t(x,{loading:b.value,attach:"#discuss-editor","z-index":1e5},null,8,["loading"])])]),_:1},8,["loading"])}}}),fa=de(Hr,[["__scopeId","data-v-164ac069"]]);function Br(e,l){return G({url:"/rank/ac/all?page="+e+"&page_size="+l,method:"get"})}function Jr(e,l){return G({url:"/rank/ac/problem?page="+e+"&page_size="+l,method:"get"})}function Wr(e,l){return G({url:"/rank/ac/problem/today?page="+e+"&page_size="+l,method:"get"})}function Yr(e,l){return G({url:"/rank/ac/problem/day7?page="+e+"&page_size="+l,method:"get"})}function Xr(e,l){return G({url:"/rank/ac/problem/day30?page="+e+"&page_size="+l,method:"get"})}function Zr(e,l){return G({url:"/rank/ac/problem/year?page="+e+"&page_size="+l,method:"get"})}const Qr={style:{margin:"10px"}};function Mt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!at(e)}const ei=ce({__name:"RankUser",props:{type:{}},setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=null;const h=e,b=c(""),w=c(""),m={all:{header:"统计所有用户在本站的提交记录",content:"优先以AC记录数量排序，如果相同则提交所用次数较少的优先，如果仍相同，注册较早的用户靠前"},problem:{header:"统计所有用户在本站的提交记录",content:"以题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-today":{header:"统计所有用户今日在本站的提交记录",content:"以今日题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-day7":{header:"统计所有用户最近7日在本站的提交记录",content:"以7日题目记录数量排序（从7日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-day30":{header:"统计所有用户最近30日在本站的提交记录",content:"以30日题目记录数量排序（从30日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-year":{header:"统计所有用户最近1年在本站的提交记录",content:"以最近1年题目记录数量排序（从365日前的0点开始计算），如果相同，注册较早的用户靠前"}},s=c([]),U=[{title:"序号",colKey:"index"},{title:"用户名",colKey:"username",cell:($,L)=>t(O,{variant:"dashed",onClick:()=>f(L.row.username)},{default:()=>[L.row.username]})},{title:"昵称",colKey:"nickname"},{title:"Slogan",colKey:"slogan"}],p=[{title:"题目数量",colKey:"problem_count",cell:($,L)=>{let _=0;return L.row.problem_count&&(_=L.row.problem_count),t(O,{variant:"dashed",onClick:()=>d(L.row.username)},Mt(_)?_:{default:()=>[_]})}}],T=[{title:"正确",colKey:"accept",cell:($,L)=>{let _=0;return L.row.accept&&(_=L.row.accept),t(O,{variant:"dashed",onClick:()=>d(L.row.username)},Mt(_)?_:{default:()=>[_]})}},{title:"提交",colKey:"attempt",cell:($,L)=>{let _=0;return L.row.attempt&&(_=L.row.attempt),t(O,{variant:"dashed",onClick:()=>r(L.row.username)},Mt(_)?_:{default:()=>[_]})}}],S=c(!1);let y=1,C=50;const u=c({current:y,pageSize:C,defaultCurrent:y,defaultPageSize:C,total:0,pageSizeOptions:[50]}),g=c(),f=$=>{n.push({name:"user",params:{username:$}})},d=$=>{n.push({name:"judge-list",query:{username:$,status:Be.Accept}})},r=$=>{n.push({name:"judge-list",query:{username:$}})},A=async($,L)=>{S.value=!0;try{g.value=[];const{current:_,pageSize:k}=$;let D=null;switch(h.type){case"problem":D=await Jr(_,k);break;case"problem-today":D=await Wr(_,k);break;case"problem-day7":D=await Yr(_,k);break;case"problem-day30":D=await Xr(_,k);break;case"problem-year":D=await Zr(_,k);break;default:D=await Br(_,k);break}if(D.code===0){const x=D.data.list;if(!x||x.length<=0){u.value={...u.value,total:0},ye(i,"未找到记录");return}g.value=[];const P=u.value.pageSize*(u.value.current-1);let z=1;x.forEach(j=>{var N;const E=j;E.index=P+z++,(N=g.value)==null||N.push(E)}),u.value={...u.value,total:D.data.total_count}}else L&&K(i,D.code)}catch(_){console.error(_),K(i,He())}finally{S.value=!1}},v=async $=>{await n.push({query:{...l.query,page:$.current,page_size:$.pageSize}})};return pe(async()=>{S.value=!0,o=Ue(()=>l.query,$=>{switch(h.type&&m[h.type]?(b.value=m[h.type].header,w.value=m[h.type].content):(b.value=m.all.header,w.value=m.all.content),h.type){case"all":s.value=U.concat(T);break;default:s.value=U.concat(p);break}const L=parseInt($.page)||u.value.defaultCurrent,_=parseInt($.page_size)||u.value.defaultPageSize;y=L,C=_,u.value={...u.value,current:y,pageSize:C},A({current:y,pageSize:C},!0)},{immediate:!0})}),Ve(()=>{o&&o()}),($,L)=>{const _=Fe,k=be,D=xe,x=Pe;return V(),M(x,null,{default:a(()=>[t(D,{span:9},{default:a(()=>[t(k,{style:{margin:"10px"}},{default:a(()=>[t(_,{data:g.value,columns:s.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:u.value,loading:S.value,"table-layout":"auto",onPageChange:v},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(D,{span:3},{default:a(()=>[R("div",Qr,[t(k,{class:"sh-card",header:b.value,"header-bordered":!0},{default:a(()=>[I(q(w.value),1)]),_:1},8,["header"])])]),_:1})]),_:1})}}}),it=de(ei,[["__scopeId","data-v-13682529"]]),ti={style:{display:"flex","align-items":"center"}},ai={style:{color:"#409eff","margin-right":"20px"}},li={class:"dida-login-footer"},ni=ce({__name:"UserForget",setup(e){const{globalProperties:l}=_e(),n=qe(),i=c(!1),o=c(!1),h=c(!1),b=c("发送验证码");let w=null,m=-1;const s=c(!1),U=c(null),p=c(""),T=c({username:"",emailKey:"",password:"",confirmPassword:""}),y=c({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:A=>new Promise(v=>{const $=setTimeout(()=>{v(T.value.password===A),clearTimeout($)})}),message:"两次密码不一致"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),C=()=>{ye(l,"重置成功")},u=async A=>{if(!h.value){i.value=!0,o.value=!0;try{const v=await Zn(A,T.value.username);v.code===0?(ye(l,"验证码发送成功"),p.value=v.data,o.value=!1,h.value=!0,w=new Date,b.value="60秒后重发",m=setInterval(()=>{const L=Math.floor((new Date().getTime()-(w==null?void 0:w.getTime()))/1e3);L>60?(b.value="发送验证码",h.value=!1,clearInterval(m)):b.value=`${60-L}秒后重发`},1e3)):K(l,v.code)}catch(v){console.error("Send email key error",v),ge(l,"发送验证码失败")}finally{i.value=!1}}},g=async()=>{var L;if(s.value=!0,h.value||o.value)return;await ft();const A=document.getElementById("cf-confirm-div");A&&A.remove();const v=document.createElement("div");v.id="cf-confirm-div",v.setAttribute("data-theme","light"),(L=U.value)==null||L.appendChild(v);const $=window;$.turnstile.ready(function(){$.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(_){s.value=!1,await u(_)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},f=c(()=>t(O,{onClick:g,disabled:h.value,loading:o.value,style:"width:120px"},{default:()=>[b.value]})),d=async()=>{i.value=!0;try{const A=await Qn(T.value.username,T.value.password,T.value.emailKey);A.code===0?(ye(l,"密码修改成功"),l.$router.push({name:"login"})):K(l,A.code)}catch(A){console.error("Modify password error",A),ge(l,"修改密码失败")}finally{i.value=!1}},r=async({validateResult:A,firstError:v,e:$})=>{if(!i.value){if($.preventDefault(),A!==!0){ge(l,v);return}p.value?await d():await g()}};return pe(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),Ve(()=>{}),(A,v)=>{const $=Tt,L=Re,_=ze,k=wa,D=O,x=Ae,P=ot,z=be,j=st;return V(),ee(me,null,[t(z,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t($,{"max-line":1},{default:a(()=>v[6]||(v[6]=[R("span",null,"如果您未绑定邮箱或忘记用户名，可联系管理员寻求帮助",-1),R("span",null,"管理员邮箱：BoilTask@qq.com",-1)])),_:1}),t($,{style:{"margin-top":"10px"}},{default:a(()=>v[7]||(v[7]=[R("p",null,"支持原acm.hpu.edu.cn、CodeOJ的用户直接登录",-1),R("p",null,"原DMOJ、hpuoj.com的用户，请先重置密码",-1),R("p",null,"可尝试学号/昵称等作为用户名登录，成功后有机会合并账户或修改用户名",-1)])),_:1}),t(x,{ref:"form",rules:y.value,data:T.value,colon:!0,onReset:C,onSubmit:r,class:"yj-login-form"},{default:a(()=>[t(_,{name:"username",label:"用户名"},{default:a(()=>[t(L,{modelValue:T.value.username,"onUpdate:modelValue":v[0]||(v[0]=E=>T.value.username=E),clearable:"",placeholder:"请输入完整用户名"},null,8,["modelValue"])]),_:1}),p.value?(V(),ee(me,{key:0},[t(_,{name:"email",label:"发送邮箱"},{default:a(()=>[t(k,{append:f.value},{default:a(()=>[R("div",ti,[R("span",ai,q(p.value),1)])]),_:1},8,["append"])]),_:1}),t(_,{name:"emailKey",label:"验证码"},{default:a(()=>[t(L,{modelValue:T.value.emailKey,"onUpdate:modelValue":v[1]||(v[1]=E=>T.value.emailKey=E),clearable:"",placeholder:"请输入收到的验证码"},null,8,["modelValue"])]),_:1}),t(_,{name:"password",label:"新密码"},{default:a(()=>[t(L,{modelValue:T.value.password,"onUpdate:modelValue":v[2]||(v[2]=E=>T.value.password=E),type:"password",clearable:"",placeholder:"新密码"},null,8,["modelValue"])]),_:1}),t(_,{name:"confirmPassword",label:"确认密码"},{default:a(()=>[t(L,{modelValue:T.value.confirmPassword,"onUpdate:modelValue":v[3]||(v[3]=E=>T.value.confirmPassword=E),type:"password",clearable:"",placeholder:"请重复输入密码"},null,8,["modelValue"])]),_:1})],64)):ae("",!0),p.value?(V(),M(_,{key:1},{default:a(()=>[t(D,{theme:"primary",type:"submit",block:"",loading:i.value},{default:a(()=>v[8]||(v[8]=[I("修改密码")])),_:1},8,["loading"])]),_:1})):(V(),M(_,{key:2},{default:a(()=>[t(D,{theme:"primary",type:"submit",block:"",loading:i.value},{default:a(()=>v[9]||(v[9]=[I("重置密码")])),_:1},8,["loading"])]),_:1}))]),_:1},8,["rules","data"]),R("div",li,[t(P,{onClick:v[4]||(v[4]=()=>{fe(l).$router.push({name:"login"})})},{default:a(()=>v[10]||(v[10]=[I("返回登陆 ")])),_:1})])]),_:1}),t(j,{visible:s.value,"onUpdate:visible":v[5]||(v[5]=E=>s.value=E),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:a(()=>[R("div",{ref_key:"dialogContainer",ref:U,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),oi=de(ni,[["__scopeId","data-v-e960b193"]]),si={class:"judger-status-panel"},ri={style:{"text-align":"center","margin-bottom":"20px"}},ii={class:"judger-status-panel"};function ui(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!at(e)}const di=ce({__name:"SystemStatus",setup(e){const{globalProperties:l}=_e(),n=c([]),i=c([]),o=c(!1),h=c(0),b=c(0),w=c(null),m=c(0),s=c(0),U=c(0);let p=-1,T;const S=u=>{let g="失效",f="danger";const d=new Date,r=new Date(u.updateTime);return d.getTime()-r.getTime()>3e4?(g="离线",f="default"):u.cpuUsage>90?(g="CPU过高",f="warning"):u.memPercent>90?(g="内存过高",f="warning"):(g="在线",f="success"),t(we,null,{default:()=>[t("span",null,[u.key,I(" - "),u.name]),t("span",null,[u.updateTime]),t(Qe,{theme:f,size:"small"},ui(g)?g:{default:()=>[g]})]})},y=async()=>{const u={};for(let _=0;_<n.value.length;_++){const k=n.value[_];u[k.key]={...k}}const g={};for(let _=0;_<i.value.length;_++){const k=i.value[_];g[k.key]={...k}}const f=[],d=[],r=await an();if(r.code!==0){K(l,r.code);return}const A=r.data.web,v={key:"didaoj"};A.name?v.name=A.name:v.name="-",A.update_time?v.updateTime=new Date(A.update_time).toLocaleString():v.updateTime="-",A.cpu_usage?v.cpuUsage=Number(A.cpu_usage):v.cpuUsage=0,A.mem_usage?v.memUsage=A.mem_usage/(1024*1024*1024):v.memUsage=0,A.mem_total?v.memTotal=A.mem_total/(1024*1024*1024):v.memTotal=0,v.memTotal>0?v.memPercent=Math.round(v.memUsage/v.memTotal*1e4)/100:v.memPercent=0,v.avgMessage=A.avg_message;const $=u[v.key];$?(v.cpuUsageFrom=$.cpuUsage,v.memPercentFrom=$.memPercent,v.memUsageFrom=$.memUsage,v.memTotalFrom=$.memTotal):(v.cpuUsageFrom=0,v.memPercentFrom=0,v.memUsageFrom=0,v.memTotalFrom=0),f.push(v),n.value=f;const L=r.data.judger;for(let _=0;_<L.length;_++){const k=L[_],D={key:k.key,name:k.name};k.name?D.name=k.name:D.name="-",k.update_time?D.updateTime=new Date(k.update_time).toLocaleString():D.updateTime="-",k.max_job?D.maxJob=Number(k.max_job):D.maxJob=0,k.cpu_usage?D.cpuUsage=Number(k.cpu_usage):D.cpuUsage=0,k.mem_usage?D.memUsage=k.mem_usage/(1024*1024*1024):D.memUsage=0,k.mem_total?D.memTotal=k.mem_total/(1024*1024*1024):D.memTotal=0,D.memTotal>0?D.memPercent=Math.round(D.memUsage/D.memTotal*1e4)/100:D.memPercent=0,D.avgMessage=k.avg_message,g[k.key]?(D.maxJobFrom=g[k.key].maxJob,D.cpuUsageFrom=g[k.key].cpuUsage,D.memPercentFrom=g[k.key].memPercent,D.memUsageFrom=g[k.key].memUsage,D.memTotalFrom=g[k.key].memTotal):(D.maxJobFrom=0,D.cpuUsageFrom=0,D.memPercentFrom=0,D.memUsageFrom=0,D.memTotalFrom=0),d.push(D)}i.value=d,h.value=b.value,b.value=r.data.judge_job,U.value=s.value,b.value>0?(w.value?s.value=(b.value-m.value)/((new Date().getTime()-w.value.getTime())/1e3)*60:(w.value=new Date,m.value=b.value,s.value=0,U.value=0),clearTimeout(p),p=-1):p<0&&(p=setTimeout(()=>{w.value=null,m.value=0},1e4))},C=async()=>{await y(),o.value=!1};return pe(async()=>{i.value=[],n.value=[],o.value=!0,await C(),T=setInterval(()=>{C()},5e3)}),Ve(()=>{clearInterval(T)}),(u,g)=>{const f=jl,d=we,r=be,A=De;return V(),M(A,{loading:o.value},{default:a(()=>[t(r,{title:"接口状态",class:"judger-status"},{default:a(()=>[R("div",si,[(V(!0),ee(me,null,Te(n.value,v=>(V(),M(r,{key:v.key,header:()=>S(v),class:"judge-status-judger"},{footer:a(()=>[R("span",null," 负载信息："+q(v.avgMessage),1)]),default:a(()=>[t(d,{class:"judge-status-judger"},{default:a(()=>[t(f,{title:"CPU使用率",value:v.cpuUsage,animation:{valueFrom:v.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(f,{title:"内存使用率",value:v.memPercent,animation:{valueFrom:v.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(f,{title:"内存使用量",animation:{valueFrom:v.memUsageFrom,duration:2e3},"animation-start":!0,value:v.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(f,{title:"内存总量",value:v.memTotal,animation:{valueFrom:v.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1}),t(r,{title:"判题机状态",class:"judger-status"},{default:a(()=>[R("div",ri,[t(d,null,{default:a(()=>[t(f,{title:"未完成的评测数量",value:b.value,animation:{valueFrom:h.value,duration:4e3},"animation-start":!0},null,8,["value","animation"]),w.value?(V(),M(f,{key:0,title:"评测数量趋势",value:s.value,animation:{valueFrom:U.value,duration:4e3},"animation-start":!0,decimalPlaces:2,unit:"/分钟"},null,8,["value","animation"])):(V(),M(f,{key:1,title:"评测数量趋势",format:()=>"样本较少"}))]),_:1})]),R("div",ii,[(V(!0),ee(me,null,Te(i.value,v=>(V(),M(r,{key:v.key,header:()=>S(v),class:"judge-status-judger"},{footer:a(()=>[R("span",null," 负载信息："+q(v.avgMessage),1)]),default:a(()=>[t(d,{class:"judge-status-judger"},{default:a(()=>[t(f,{title:"并发",value:v.maxJob,animation:{valueFrom:v.maxJob,duration:2e3},"animation-start":!0},null,8,["value","animation"]),t(f,{title:"CPU使用率",value:v.cpuUsage,animation:{valueFrom:v.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(f,{title:"内存使用率",value:v.memPercent,animation:{valueFrom:v.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(f,{title:"内存使用量",animation:{valueFrom:v.memUsageFrom,duration:2e3},"animation-start":!0,value:v.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(f,{title:"内存总量",value:v.memTotal,animation:{valueFrom:v.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1})]),_:1},8,["loading"])}}}),ci=de(di,[["__scopeId","data-v-407e229f"]]),mi=ce({__name:"ManageJudge",setup(e){const{globalProperties:l}=_e(),n=c(!1),i=c(!1),o=c({problemId:"",language:void 0,status:void 0}),h=c(!1),b=c([]);b.value=Ht();const w=c([]);w.value=$a();const m=async()=>{n.value=!0;try{const p=await pn();if(p.code!==0){K(l,p.code);return}ye(l,"重判成功"),await X.push({name:"judge-list"})}catch(p){console.error(p),K(l,"重判失败")}finally{n.value=!1}},s=async()=>{if(!o.value.problemId&&!o.value.language&&!o.value.status){K(l,"请输入问题Id");return}h.value=!0;try{const p=await fn(o.value.problemId,o.value.language,o.value.status);if(p.code!==0){K(l,p.code);return}ye(l,"重判成功"),await X.push({name:"judge-list",query:{problem_id:o.value.problemId,language:o.value.language}})}catch(p){console.error(p),K(l,"重判失败")}finally{h.value=!1}},U=async()=>{i.value=!0;try{const p=await vn();if(p.code!==0){K(l,p.code);return}ye(l,"重判成功"),await X.push({name:"judge-list"})}catch(p){console.error(p),K(l,"重判失败")}finally{i.value=!1}};return(p,T)=>{const S=O,y=be,C=Re,u=ze,g=Ot,f=gt,d=we,r=Ae;return V(),ee(me,null,[t(y,{class:"yj-manage-card",title:"重判最近提交"},{default:a(()=>[t(S,{onClick:m,loading:n.value},{default:a(()=>T[3]||(T[3]=[I("重判")])),_:1},8,["loading"])]),_:1}),t(y,{class:"yj-manage-card",title:"重判指定记录"},{default:a(()=>[t(r,{layout:"inline",onSubmit:s},{default:a(()=>[t(u,{label:"题号"},{default:a(()=>[t(C,{modelValue:o.value.problemId,"onUpdate:modelValue":T[0]||(T[0]=A=>o.value.problemId=A),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(u,{label:"语言"},{default:a(()=>[t(f,{modelValue:o.value.language,"onUpdate:modelValue":T[1]||(T[1]=A=>o.value.language=A),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:a(()=>[(V(!0),ee(me,null,Te(b.value,A=>(V(),M(g,{key:A.value,value:A.value,label:A.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"状态"},{default:a(()=>[t(f,{modelValue:o.value.status,"onUpdate:modelValue":T[2]||(T[2]=A=>o.value.status=A),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:a(()=>[(V(!0),ee(me,null,Te(w.value,A=>(V(),M(g,{key:A.value,value:A.value,label:A.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,null,{default:a(()=>[t(d,null,{default:a(()=>[t(S,{theme:"primary",type:"submit",loading:h.value},{default:a(()=>T[4]||(T[4]=[I("重判")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(y,{class:"yj-manage-card",title:"重判所有"},{default:a(()=>[t(S,{onClick:U,theme:"danger",loading:i.value},{default:a(()=>T[5]||(T[5]=[I("重判")])),_:1},8,["loading"])]),_:1})],64)}}}),pi=de(mi,[["__scopeId","data-v-6d48cbf2"]]),fi=ce({__name:"ManageWeb",setup(e){const{globalProperties:l}=_e(),n=c({theme:"",content:""}),i=c({title:"",content:""}),o=c(!1),h=c(!1),b=c(!1);async function w(T,S){b.value=!0,await ct(T,S,l,ln),b.value=!1}const m=async()=>{h.value=!0;try{const T=await nn(n.value.theme,n.value.content);if(T.code!==0){K(l,T.code);return}ye(l,"保存成功")}catch(T){console.error(T),K(l,"保存失败")}finally{h.value=!1}},s=async()=>{b.value=!0;try{const T=i.value.content,S=await on(i.value.title,T);if(S.code!==0){K(l,S.code);return}i.value.content=S.data.content,ye(l,"保存成功")}catch(T){console.error(T),ge(l,"保存失败")}finally{b.value=!1}},U=async()=>{n.value=await xa()},p=async()=>{try{i.value=await Da()}catch{ge(l,"加载公告失败"),i.value={title:"",content:""}}};return pe(async()=>{o.value=!0;try{await U(),await p()}catch{ge(l,"加载数据失败")}o.value=!1}),(T,S)=>{const y=gt,C=ze,u=Re,g=O,f=we,d=Ae,r=be,A=Me("md-editor-v3"),v=De;return V(),M(v,{loading:o.value},{default:a(()=>[t(r,{class:"yj-manage-card",title:"站点通知"},{default:a(()=>[t(d,{onSubmit:m},{default:a(()=>[t(C,{label:"主题"},{default:a(()=>[t(y,{modelValue:n.value.theme,"onUpdate:modelValue":S[0]||(S[0]=$=>n.value.theme=$),options:[{label:"success",value:"success"},{label:"info",value:"info"},{label:"warning",value:"warning"},{label:"error",value:"error"}],placeholder:"请选择主题"},null,8,["modelValue"])]),_:1}),t(C,{label:"内容"},{default:a(()=>[t(u,{modelValue:n.value.content,"onUpdate:modelValue":S[1]||(S[1]=$=>n.value.content=$),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),t(C,null,{default:a(()=>[t(f,null,{default:a(()=>[t(g,{theme:"primary",type:"submit",loading:h.value},{default:a(()=>S[4]||(S[4]=[I("保存")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(r,{class:"yj-manage-card",title:"首页公告"},{actions:a(()=>[t(g,{theme:"primary",loading:b.value,onClick:s},{default:a(()=>S[5]||(S[5]=[I("保存")])),_:1},8,["loading"])]),default:a(()=>[t(d,{onSubmit:s},{default:a(()=>[t(C,{label:"标题"},{default:a(()=>[t(u,{modelValue:i.value.title,"onUpdate:modelValue":S[2]||(S[2]=$=>i.value.title=$),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1}),t(v,{loading:b.value},{default:a(()=>[t(A,{modelValue:i.value.content,"onUpdate:modelValue":S[3]||(S[3]=$=>i.value.content=$),onSave:s,onOnUploadImg:w,previewTheme:"cyanosis",class:"dida-description-editor"},null,8,["modelValue"])]),_:1},8,["loading"])]),_:1})]),_:1},8,["loading"])}}}),vi=de(fi,[["__scopeId","data-v-8c162eb5"]]),Na=[{name:"problem-list",tab:"problem",sidebar:"problem-list",path:"",title:"问题列表",icon:"list",component:wo},{name:"problem-detail",tab:"problem",sidebar:"problem-list",path:":problemId+",title:"问题详情",icon:"list",component:Ut},{name:"problem-daily-list",tab:"problem",sidebar:"problem-daily-list",path:"daily",title:"每日一题",icon:"list",component:Yo},{name:"problem-daily-detail",tab:"problem",sidebar:"problem-daily-list",path:"daily/:dailyId+",title:"问题详情",icon:"list",component:Ut},{name:"problem-recommend",tab:"problem",sidebar:"problem-recommend",path:"recommend/:problemId*",title:"问题推荐",icon:"cpu",needLogin:!0,component:ns},{name:"problem-collection-list",tab:"problem",sidebar:"problem-collection-list",path:"collection",title:"题目集合",icon:"list",disableTabPath:!0,component:Ps},{name:"collection-detail",tab:"collection-detail-tab",sidebar:"collection-detail",path:":collectionId+",title:"题集详情",icon:"cpu",component:$s},{name:"collection-rank",tab:"collection-detail-tab",sidebar:"collection-rank",path:":collectionId+/rank",title:"题集排名",icon:"list",component:js},{name:"collection-edit",tab:"collection-detail-tab",sidebar:"collection-edit",disableSidebar:!0,needLogin:!0,path:":collectionId+/edit",title:"题集编辑",icon:"list",component:ra},{name:"collection-create",tab:"collection-detail-tab",sidebar:"collection-create",needLogin:!0,disableSidebar:!0,path:"create",title:"新建题集",icon:"list",component:ra},{name:"judge-list",tab:"judge",sidebar:"judge-list",path:"",title:"评测列表",icon:"list",component:ua},{name:"judge-detail",tab:"judge",sidebar:"judge-list",path:":judgeId+",title:"评测详情",icon:"cpu",component:da},{name:"contest-list",tab:"contest",sidebar:"contest-list",path:"",title:"比赛列表",icon:"list",component:ca},{name:"contest-recent",tab:"contest",sidebar:"contest-recent",path:"recent",title:"近期比赛",icon:"list",component:ca},{name:"contest-create",tab:"contest",sidebar:"contest-create",disableSidebar:!0,needLogin:!0,path:"create",title:"新建比赛",icon:"list",component:pa},{name:"contest-edit",tab:"contest-detail-tab",sidebar:"contest-edit",disableSidebar:!0,needLogin:!0,path:":contestId+/edit",title:"比赛编辑",icon:"list",component:pa},{name:"contest-detail",tab:"contest-detail-tab",sidebar:"contest-detail",path:":contestId+",title:"比赛详情",icon:"cpu",component:rr},{name:"contest-problem-detail",tab:"contest-detail-tab",sidebar:"contest-problem-detail",path:":contestId+/problem/:problemIndex+",title:"问题详情",icon:"cpu",disableSidebar:!0,component:Ut},{name:"contest-judge",tab:"contest-detail-tab",sidebar:"contest-judge",path:":contestId+/judge",title:"评测列表",icon:"list",component:ua},{name:"contest-judge-detail",tab:"contest-detail-tab",sidebar:"contest-judge-detail",path:":contestId+/judge/:judgeId+",title:"评测详情",icon:"cpu",component:da,disableSidebar:!0},{name:"contest-rank",tab:"contest-detail-tab",sidebar:"contest-rank",path:":contestId+/rank",title:"比赛排名",icon:"list",component:pr},{name:"contest-discuss",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss",title:"比赛讨论",icon:"list",component:Rt},{name:"contest-discuss-detail",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss/:discussId+",title:"讨论详情",icon:"list",component:Et},{name:"discuss-list",tab:"discuss",sidebar:"discuss-list",path:"",title:"讨论列表",icon:"list",component:Rt},{name:"discuss-create",tab:"discuss",sidebar:"discuss-create",disableSidebar:!0,needLogin:!0,path:"create",title:"新建讨论",icon:"list",component:fa},{name:"discuss-edit",tab:"discuss-detail-tab",sidebar:"discuss-edit",disableSidebar:!0,needLogin:!0,path:":discussId+/edit",title:"编辑讨论",icon:"list",component:fa},{name:"discuss-list-problem",tab:"discuss",sidebar:"discuss-list-problem",path:"problem",title:"题目讨论",icon:"list",component:Rt},{name:"discuss-detail",tab:"discuss",sidebar:"discuss-list",path:":discussId+",title:"讨论详情",icon:"list",component:Et},{name:"rank-ac-all",tab:"rank",sidebar:"rank-ac-all",path:"ac",title:"AC排名",icon:"base-station",props:{type:"all"},component:it},{name:"rank-ac-problem",tab:"rank",sidebar:"rank-ac-problem",path:"ac/problem",title:"题量排名",icon:"base-station",props:{type:"problem"},component:it},{name:"rank-ac-problem-today",tab:"rank",sidebar:"rank-ac-problem-today",path:"ac/problem/today",title:"今日题量",icon:"base-station",props:{type:"problem-today"},component:it},{name:"rank-ac-problem-day7",tab:"rank",sidebar:"rank-ac-problem-day7",path:"ac/problem/day7",title:"7日题量",icon:"base-station",props:{type:"problem-day7"},component:it},{name:"rank-ac-problem-day30",tab:"rank",sidebar:"rank-ac-problem-day30",path:"ac/problem/day30",title:"30日题量",icon:"base-station",props:{type:"problem-day30"},component:it},{name:"rank-ac-problem-year",tab:"rank",sidebar:"rank-ac-problem-year",path:"ac/problem/year",title:"1年题量",icon:"base-station",props:{type:"problem-year"},component:it},{name:"system-status",tab:"system",sidebar:"system-status",path:"",title:"运行状态",icon:"base-station",component:ci},{name:"system-about",tab:"system",sidebar:"system-about",path:"about",title:"关于",icon:"base-station",props:{discussId:"93"},component:Et},{name:"manage-problem-create",tab:"manage",sidebar:"manage-problem-create",disableSidebar:!0,path:"problem",title:"新建问题",icon:"list",component:sa,auths:[je.ManageProblem]},{name:"manage-problem",tab:"manage",sidebar:"manage-problem",disableSidebar:!0,path:"problem/:problemId+",title:"问题编辑",icon:"list",component:sa,auths:[je.ManageProblem]},{name:"manage-problem-daily-create",tab:"manage",sidebar:"manage-problem-daily-create",disableSidebar:!0,path:"problem/daily",title:"新建每日一题",icon:"list",component:oa,auths:[je.ManageProblemDaily]},{name:"manage-problem-daily",tab:"manage",sidebar:"manage-problem-daily",disableSidebar:!0,path:"problem/daily/:dailyId+",title:"编辑每日一题",icon:"list",component:oa,auths:[je.ManageProblemDaily]},{name:"manage-problem-judge",tab:"manage",sidebar:"manage-problem-judge",disableSidebar:!0,path:"problem/:problemId+/judge",title:"评测数据",icon:"list",component:vs,auths:[je.ManageProblem]},{name:"manage-web",tab:"manage",path:"web",sidebar:"manage-web",title:"站点管理",icon:"list",auths:[je.ManageWeb],component:vi},{name:"manage-judge",tab:"manage",path:"judge",sidebar:"manage-judge",title:"评测管理",icon:"list",auths:["i-manage-judge"],component:pi},{name:"login-forget",tab:"login",path:"forget",title:"忘记密码",component:oi}],va=(e,l,n,i)=>{i.tab==n&&(i.disableSidebar&&l!=i.sidebar||i.sidebar==null||i.sidebar!=i.name||e.push({name:i.name,title:i.title,icon:i.icon,to:{name:i.name}}))},_i=(e,l)=>{const n=[];return Na.forEach(i=>{if(Ma(i)){const o=[];i.children.forEach(h=>{va(o,e,l,h)}),o.length>0&&n.push({title:i.title,children:o})}else va(n,e,l,i)}),n},_a=(e,l)=>{const n=po(l.tab),i={name:l.name,path:"/"+l.path,meta:{title:l.title+" - "+n.title,tab:l.tab,sidebar:l.sidebar,showSidebar:n.showSidebar,needLogin:n.needLogin||l.needLogin,tabAuths:n.auths,auths:l.auths},props:l.props,component:l.component};!n.disablePath&&!l.disableTabPath&&(i.path=n.path+i.path),e.push(i)},gi=e=>{Na.forEach(l=>{Ma(l)?l.children.forEach(n=>{_a(e,n)}):_a(e,l)})},bi={class:"sh-main"},hi=ce({__name:"View403",setup(e){let l=Se();const n=c("");return pe(()=>{l.query.target?n.value=l.query.target:n.value=l.fullPath}),(i,o)=>{const h=O;return V(),ee("div",bi,[R("p",null,q(n.value),1),o[2]||(o[2]=R("p",null,"该页面无访问权限，请更换访问目标或重新登陆后再试",-1)),t(h,{theme:"primary",onClick:o[0]||(o[0]=()=>i.$router.push("/"))},{default:a(()=>o[1]||(o[1]=[I("返回首页")])),_:1})])}}}),Oa=de(hi,[["__scopeId","data-v-777362b3"]]),yt=[];vo(yt);gi(yt);yt.push({path:"/403",name:"403",component:Oa});yt.push({path:"/:pathMatch(.*)*",name:"404",component:Ea});const X=il({history:ul("/"),routes:yt});X.beforeEach((e,l,n)=>{if(e.name==null||!X.hasRoute(e.name)){n({name:"home"});return}const i=e.matched[e.matched.length-1].meta;if(i.redirect){n({name:i.redirect});return}if(i.needLogin){const h=qe();if(h.getToken==null||h.getToken==""){n({name:"login",query:{redirect_uri:e.fullPath}});return}}const o=i.tabAuths;if(o&&!qe().hasAllAuths(o)){n({name:"403",query:{target:e.fullPath}});return}n()});X.afterEach((e,l)=>{if(e.name===l.name)return;const n=Dt(),i=Ze();let o=null;if(e.matched.length>0&&(o=e.matched[e.matched.length-1].meta),o!=null&&o.title&&i.setTitle(o==null?void 0:o.title),o!=null&&o.showSidebar){n.setSidebarShow(!0);const h=_i(o==null?void 0:o.sidebar,o==null?void 0:o.tab);n.setMenuList(h),n.setMenuActiveName(o==null?void 0:o.sidebar)}else n.setSidebarShow(!1);window.scrollTo(0,0)});const Ga=_t("login",{state:()=>({Loaded:!1}),getters:{isLoaded(){return this.Loaded}}}),yi=ce({__name:"HeaderContent",setup(e){const l=Ga(),n=qe(),{globalProperties:i}=_e(),o=c(l.isLoaded),h=c(!1),b=c(n.getUsername),w=c(n.getNickname),m=c(),s=()=>{m.value=fo(n)};l.$subscribe((T,S)=>{o.value=S.Loaded}),n.$subscribe((T,S)=>{b.value=S.username,w.value=S.nickname,h.value=S.token!="",s()});const U=()=>{i.$router.currentRoute.value.name!=="login"&&i.$router.push({name:"login",query:{redirect_uri:i.$router.currentRoute.value.fullPath}})},p=()=>{n.clear(),i.$message.success({duration:3e3,content:"注销成功"}),i.$router.push({path:"/login",query:{redirect_uri:i.$router.currentRoute.value.fullPath}})};return pe(()=>{s()}),(T,S)=>{const y=Me("router-link"),C=Pa,u=Ia,g=Ll,f=Ul;return V(),M(f,{modelValue:T.$route.meta.tab,"onUpdate:modelValue":S[0]||(S[0]=d=>T.$route.meta.tab=d),class:"sh-menu","expand-type":"popup"},{logo:a(()=>[t(y,{to:"/",class:"sh-logo"},{default:a(()=>S[1]||(S[1]=[I("DidaOJ")])),_:1})]),operations:a(()=>[o.value&&h.value?(V(),M(g,{key:0,title:w.value},{icon:a(()=>[t(C,{name:"user"})]),default:a(()=>[t(u,{value:"user",to:{path:"/user/"+b.value}},{default:a(()=>S[2]||(S[2]=[I("个人空间")])),_:1},8,["to"]),t(u,{value:"user_logout",onClick:p},{default:a(()=>S[3]||(S[3]=[I(" 注销")])),_:1})]),_:1},8,["title"])):o.value?(V(),M(u,{key:2,value:"login",onClick:U},{icon:a(()=>[t(C,{name:"login"})]),default:a(()=>[S[5]||(S[5]=I(" 登录 "))]),_:1})):(V(),M(u,{key:1,value:"login"},{icon:a(()=>[t(C,{name:"login"})]),default:a(()=>[S[4]||(S[4]=I(" ... "))]),_:1}))]),default:a(()=>[(V(!0),ee(me,null,Te(m.value,d=>(V(),M(u,{key:d.name,value:d.name,to:{name:d.name}},{icon:a(()=>[d.icon?(V(),M(C,{key:0,name:d.icon},null,8,["name"])):ae("",!0)]),default:a(()=>[I(" "+q(d.title),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])}}}),wi=de(yi,[["__scopeId","data-v-95e7494b"]]),ki={id:"menu-container"},Si=ce({__name:"SidebarContent",setup(e){const l=Dt(),n=c(!1),i=c(null),o=c(l.menuActiveName),h=c(l.menuList),b=c([]),w=c(!1),m=()=>{o.value=l.menuActiveName;const U=JSON.stringify(h.value),p=JSON.stringify(l.menuList);U!==p&&(b.value.push([...l.menuList]),s())},s=async()=>{if(b.value.length>0&&!w.value){for(w.value=!0;b.value.length>1;)b.value.shift();const U=b.value.shift();n.value=U.length<=0,h.value=[],await ft(),i.value&&i.value.updateActiveName(),await new Promise(T=>setTimeout(T,300)),h.value=U,await ft(),i.value&&i.value.updateActiveName();const p=300;await new Promise(T=>setTimeout(T,p)),w.value=!1,await s()}};return l.$subscribe((U,p)=>{m()}),pe(()=>{m()}),(U,p)=>{const T=Pa,S=Ia,y=zl,C=Al,u=De;return V(),ee(me,null,[R("div",ki,[t(C,{modelValue:o.value,"onUpdate:modelValue":p[0]||(p[0]=g=>o.value=g),theme:"light",class:"sh-menu-container"},{default:a(()=>[t(dl,{name:"move-left"},{default:a(()=>[(V(!0),ee(me,null,Te(h.value,(g,f)=>(V(),ee(me,{key:f},[fe(_o)(g)?(V(),M(y,{key:0,title:g.title},{default:a(()=>[(V(!0),ee(me,null,Te(g.children,(d,r)=>(V(),M(S,{key:d.name,value:d.name,to:d.to},ea({default:a(()=>[I(" "+q(d.title),1)]),_:2},[d.icon?{name:"icon",fn:a(()=>[t(T,{name:d.icon,class:Kt(d.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))),128))]),_:2},1032,["title"])):(V(),M(S,{key:g.name,value:g.name,to:g.to},ea({default:a(()=>[I(" "+q(g.title),1)]),_:2},[g.icon?{name:"icon",fn:a(()=>[t(T,{name:g.icon,class:Kt(g.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),t(u,{size:"small",loading:n.value,"show-overlay":!0,attach:"#menu-container",class:"sh-sidebar-loading",style:{"align-items":"flex-start","padding-top":"100px"}},null,8,["loading"])],64)}}}),Ci=de(Si,[["__scopeId","data-v-96e2d89f"]]),Ii={};function Pi(e,l){return null}const Ti=de(Ii,[["render",Pi]]),xi={class:"footer"},Di={class:"footer-left"},Vi={class:"foot-time"},$i={class:"footer-center"},ji={href:"https://beiancx.miit.gov.cn/",target:"_blank"},Li={class:"footer-right"},Ui={class:"foot-text"},Ai={href:"https://github.com/hpu-developer/DiDaOJ-web",target:"_blank"},zi={class:"foot-text"},Ri={href:"https://github.com/hpu-developer/DiDaOJ-go",target:"_blank"},Ei=ce({__name:"FooterContent",setup(e){const l=c("");function n(){l.value=new Date().toLocaleString()}return pe(()=>{n(),setInterval(()=>{n()},1e3)}),(i,o)=>{const h=O;return V(),ee("div",xi,[R("div",Di,[R("p",Vi,q(l.value),1)]),R("div",$i,[R("a",ji,[t(h,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>o[0]||(o[0]=[I("豫ICP备15024677号-4")])),_:1})])]),R("div",Li,[R("p",Ui,[R("a",Ai,[t(h,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>o[1]||(o[1]=[I("@didaoj-web")])),_:1})])]),R("p",zi,[R("a",Ri,[t(h,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>o[2]||(o[2]=[I("@didaoj-go")])),_:1})])])])])}}}),Mi=de(Ei,[["__scopeId","data-v-44f2e4e7"]]),wt=20,qt=100,Ft=50,qi=ce({__name:"ForceHiddenSidebarButton",setup(e){let l=Dt();const n=c({x:window.innerWidth-qt-wt,y:window.innerHeight-Ft-wt}),i=c(window.innerWidth),o=c(window.innerHeight);let h=!1,b={x:0,y:0};const w=g=>{h=!0;const f=g.clientX??g.touches[0].clientX,d=g.clientY??g.touches[0].clientY;b={x:f-n.value.x,y:d-n.value.y},document.addEventListener("mousemove",m),document.addEventListener("touchmove",m),document.addEventListener("mouseup",s),document.addEventListener("touchend",s)},m=g=>{if(!h)return;const f=g.clientX??g.touches[0].clientX,d=g.clientY??g.touches[0].clientY;let r=f-b.x,A=d-b.y;r=Math.max(0,Math.min(r,i.value-qt)),A=Math.max(0,Math.min(A,o.value-Ft)),n.value={x:r,y:A}},s=()=>{h=!1,document.removeEventListener("mousemove",m),document.removeEventListener("touchmove",m),document.removeEventListener("mouseup",s),document.removeEventListener("touchend",s)},U=()=>{i.value=window.innerWidth,o.value=window.innerHeight,n.value={x:Math.min(n.value.x,i.value-qt-wt),y:Math.min(n.value.y,o.value-Ft-wt)}};let p=c(l.forceHiddenSidebar),T=c(l.forceHiddenSidebar);const S=()=>{p.value=!p.value,l.setForceHiddenSidebar(p.value)},y=()=>{T.value||(T.value=!0,l.setForceHiddenSidebar(p.value))},C=()=>{T.value&&(T.value=!1,l.setForceHiddenSidebar(!1))},u=g=>{g>=800?C():y()};return u(i.value),Ue(i,g=>{u(g)}),pe(()=>{window.addEventListener("resize",U)}),Ve(()=>{window.removeEventListener("resize",U)}),(g,f)=>{const d=O;return fe(T)?(V(),M(d,{key:0,class:"draggable-button",style:ba({top:`${n.value.y}px`,left:`${n.value.x}px`}),onMousedown:w,onTouchstart:w,variant:"dashed",theme:"primary",onClick:S},{default:a(()=>[I(q(fe(p)?"显示":"隐藏"),1)]),_:1},8,["style"])):ae("",!0)}}}),Fi=de(qi,[["__scopeId","data-v-1aee5506"]]),kt="DidaOJ",Ki=ce({__name:"App",setup(e){const{globalProperties:l}=_e(),n=Ga(),i=qe(),o=Ze(),h=Dt();n.$patch({Loaded:!1});const b=i.getToken,w=c(!1),m=c(!1);o.title&&o.title.length>0?document.title=o.title+" - "+kt:document.title=kt,o.$subscribe((S,y)=>{y.title&&y.title.length>0?document.title=y.title+" - "+kt:document.title=kt}),h.$subscribe((S,y)=>{w.value=y.showSidebar,m.value=w.value&&!y.forceHiddenSidebar});const s=Se(),U=Je(()=>{const S=s.meta.auths;return S?!i.hasAllAuths(S):!1});function p(){l.$message.warning({duration:3e3,content:"登陆状态失效"}),n.$patch({Loaded:!0}),i.clear()}const T=async()=>{const S=document.querySelectorAll("oj-problem");if(S.length===0)return;let y={};S.forEach(g=>{const f=g.getAttribute("id"),d=document.createElement("span");d.setAttribute("style","padding:5px"),g.replaceWith(d);const r=c("default");y[f]||(y[f]=[]),y[f].push(r);let A=f;f&&!f.includes("-")&&(A="DidaOJ-"+f),ya({render:()=>pl(O,{innerHTML:A,onClick:()=>{window.open(`/problem/${f}`,"_blank")},size:"small",variant:"outline",theme:r.value})}).mount(d)});const C=[];for(const g in y)C.push(g);const u=await za(C);if(u.code===0)for(const g in y){const f=y[g];if(!f)continue;let d="primary";const r=u.data[g];if(r)switch(r){case Le.Accept:d="success";break;case Le.Attempt:d="warning";break}for(const A of f)A.value=d}};return pe(()=>{document.addEventListener("DOMContentLoaded",()=>{new MutationObserver(()=>{Gl(()=>{T()},1e3)()}).observe(document.body,{childList:!0,subtree:!0}),cl.autoSpacingPage()}),b?Gn().then(S=>{S.code==0?(i.loadResponse(S.data),n.$patch({Loaded:!0})):(K(l,S.code),n.$patch({Loaded:!0}),i.clear())}).catch(S=>{console.log(S),p()}):n.$patch({Loaded:!0})}),(S,y)=>{const C=Rl,u=Ml,g=Me("RouterView"),f=ql,d=El,r=Fl;return V(),ee(me,null,[t(d,{class:"sh-app-layout"},{default:a(()=>[t(C,{class:"sh-header"},{default:a(()=>[t(wi)]),_:1}),t(d,null,{default:a(()=>[t(ml,{name:"slide"},{default:a(()=>[m.value?(V(),M(u,{key:0,class:"sh-sidebar"},{default:a(()=>[t(Ci)]),_:1})):ae("",!0)]),_:1}),t(d,{class:Kt(["sh-main-layout",{expanded:!m.value}])},{default:a(()=>[t(Ti),t(f,{class:"sh-main-content"},{default:a(()=>[U.value?(V(),M(Oa,{key:0})):(V(),M(g,{key:1}))]),_:1}),t(Mi)]),_:1},8,["class"])]),_:1})]),_:1}),w.value?(V(),M(Fi,{key:0})):ae("",!0),t(r,{container:"body",offset:["24px","80px"],size:"small"})],64)}}}),Ni=de(Ki,[["__scopeId","data-v-66c2cfa5"]]);function Oi(e,l={}){const n=/\{\{%\s*(\w+)\s+([^%]+?)\s*%\}\}/g,i=l.renderers||{},o=e.renderer.rules.text??function(h,b){return h[b].content};e.renderer.rules.text=function(h,b,w,m,s){const p=h[b].content;return n.test(p)?p.replace(n,(S,y,C)=>{const u=i[y];if(typeof u=="function"){const g=C.trim().split(/\s+/);return u(g)}else return`<span class="shortcode-${y}">${y}: ${C.trim()}</span>`}):o(h,b,w,m,s)}}function Gi(e,l){const n=/\{\{%\s*(\w+)\s*%\}\}([\s\S]*?)\{\{%\s*\/\1\s*%\}\}/g;e.core.ruler.push("shortcode_color",i=>{for(const o of i.tokens){if(o.type!=="inline")continue;let h=o.content,b=!1;h=h.replace(n,(w,m,s)=>{var p;const U=(p=l.renderers)==null?void 0:p[m];return U?(b=!0,U([],s.trim())):w}),b&&(o.type="html_inline",o.tag="",o.attrs=null,o.content=h,o.children=[])}})}Hl({markdownItConfig(e){e.use(Lt,"align-left",{render(l,n){return l[n].nesting===1?`<div class="sh-align-left">
`:`</div>
`}}),e.use(Lt,"align-center",{render(l,n){return l[n].nesting===1?`<div class="sh-align-center">
`:`</div>
`}}),e.use(Lt,"align-right",{render(l,n){return l[n].nesting===1?`<div class="sh-align-right">
`:`</div>
`}}),e.use(Oi,{renderers:{problem:([l])=>`<oj-problem id="${l}">${l}</oj-problem>`}}),e.use(Gi,{renderers:{red:(l,n)=>`<span class="dida-font-red">${n}</span>`,green:(l,n)=>`<span class="dida-font-green">${n}</span>`,blue:(l,n)=>`<span class="dida-font-blue">${n}</span>`}})},markdownItPlugins(e){return[...e,{type:"linkAttr",plugin:_l,options:{matcher(l){return!l.startsWith("#")},attrs:{target:"_blank"}}}]}});const Ha=fl();Ha.use(vl);const mt=ya(Ni);mt.use(Ha);mt.use(X);mt.use(Kl);mt.use(Bl);mt.use(Jl);mt.mount("#app");Wl().then(()=>{console.log("Text cache reinitialized")}).catch(e=>{console.error("Text cache reinitialization failed",e)});
