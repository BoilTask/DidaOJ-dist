import{ct as mt,d as ie,a as p,o as me,cu as E,cv as D,cw as a,e as t,cx as R,cy as q,bE as P,cz as va,aM as Ga,cA as Ae,cB as oe,cC as le,F as de,cD as Ie,cE as Na,cF as Se,bS as fe,cG as Ha,cH as Ba,cI as Ja,b as Ve,v as ct,cJ as Wa,cK as We,j as Ne,w as Le,a9 as Qe,bc as Ya,bd as Xa,cL as Za,cM as Qa,cN as el,br as tl,cO as Dt,cP as _a,cQ as ga,cj as al,cR as ll,cS as nl,cT as ol,cU as sl,bX as rl,cV as Zt,cW as Mt,cX as il,bf as ul,aY as ba,z as dl,cY as cl,cZ as ml,c_ as pl,c$ as Lt}from"./node_modules-0I5abxol.js";import{L as Te,C as be,R as Pe,a as xe,A as Ct,S as fl,b as vl,c as _l,d as gl,e as bl,f as lt,T as tt,B as O,F as je,g as $e,I as Ue,D as nt,h as ha,i as we,j as He,k as Be,l as hl,m as Re,n as pt,o as ft,P as qt,O as Kt,p as Ft,q as yl,r as ya,s as wl,t as kl,u as wa,v as ka,w as It,x as Sl,y as Cl,z as Il,E as Pl,G as xl,H as Tl,M as Sa,J as Ca,K as Vl,N as Dl,Q as Ll,U as jl,V as $l,W as Ul,X as zl,Y as Al,Z as Rl,_ as Ml}from"./tdesign-vue-next-Cq8R5Clx.js";import{u as pe,S as ve,a as ke,b as F,G as Fe,H as vt,c as Ge,d as Ia,e as El,f as ql,g as Kl,E as Fl,M as Ol,R as Gl}from"./md-editor-v3-Dbkd2Qi7.js";import{e as Qt}from"./monaco-editor-ouHSYV7a.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const b of o)if(b.type==="childList")for(const f of b.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function n(o){const b={};return o.integrity&&(b.integrity=o.integrity),o.referrerPolicy&&(b.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?b.credentials="include":o.crossOrigin==="anonymous"?b.credentials="omit":b.credentials="same-origin",b}function i(o){if(o.ep)return;o.ep=!0;const b=n(o);fetch(o.href,b)}})();var ze=(e=>(e.ManageWeb="i-manage-web",e.ManageJudge="i-manage-judge",e.ManageProblem="i-manage-problem",e.ManageProblemDaily="i-manage-problem-daily",e.ManageContest="i-manage-contest",e.ManageCollection="i-manage-collection",e.ManageDiscuss="i-manage-discuss",e))(ze||{});const Nl={"r-admin":["i-manage-web","i-manage-judge","i-manage-problem","i-manage-problem-daily","i-manage-contest","i-manage-collection","i-manage-discuss"]};function Hl(e){if(e==null)return[];const l=[];for(const n of e){const i=Nl[n];i!=null&&l.push(...i)}return[...new Set(l)]}function Bl(e,l){if(e==null||l==null)return!1;const n=Hl(e);for(const i of l)if(!n.includes(i))return!1;return!0}const qe=mt("user",{state:()=>({token:"",userId:-1,username:"",nickname:"",roles:[]}),getters:{getToken(){return this.token},getUserId(){return this.userId},getUsername(){return this.username},getNickname(){return this.nickname}},actions:{clear(){this.$patch({token:"",userId:-1,username:"",nickname:"",roles:[]})},loadResponse(e){this.$patch({token:e.token,userId:e.user_id,username:e.username,nickname:e.nickname,roles:e.roles})},isLogin(){return this.token!=null&&this.token!=""},hasAuth(e){return this.hasAllAuths([e])},hasAllAuths(e){return e?Bl(this.roles,e):!0}},persist:!0}),Ye=mt("webStyle",{state:()=>({title:""}),getters:{getTitle(){return this.title}},actions:{setTitle(e){this.title=e}}}),Pt=mt("sidebarStyle",{state:()=>({showSidebar:!1,forceHiddenSidebar:!1,menuActiveName:"",menuList:[]}),getters:{getMenuList(){return this.menuList}},actions:{setSidebarShow(e){this.showSidebar=e},setForceHiddenSidebar(e){this.forceHiddenSidebar=e},setMenuActiveName(e){this.menuActiveName=e},clearMenuList(){this.menuList=[]},setMenuList(e){this.menuList=e},addMenuList(e){this.menuList.push(e)}}}),Jl={style:{"text-align":"right"}},Wl=ie({__name:"Hitokoto",setup(e){const l=p(!1),n=p(""),i=p(""),o=p(""),b=async()=>{l.value=!0;try{const S=await(await fetch("https://v1.hitokoto.cn")).json();i.value=S.hitokoto,o.value=S.creator,n.value="—— "+S.from}catch(f){i.value="一言获取失败了，但至少您还可以访问本站。",o.value="BoilTask",n.value="DidaOJ",console.error("Error fetching Hitokoto:",f)}finally{l.value=!1}};return me(()=>{b()}),(f,S)=>{const m=be,s=Te;return D(),E(s,{loading:l.value},{default:a(()=>[t(m,{title:"一言 © Hitokoto"},{actions:a(()=>[P(" @"+q(o.value),1)]),default:a(()=>[R("div",null,[R("span",null,q(i.value),1),R("p",Jl,q(n.value),1)])]),_:1})]),_:1},8,["loading"])}}}),Yl="https://oj-api.didapipa.com/",B=va.create({baseURL:Yl,timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});B.interceptors.request.use(e=>{const n=qe().getToken;return n&&(e.headers["X-Token"]=n),e},e=>Promise.reject(e));B.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});const xt=va.create({timeout:6e4,withCredentials:!1,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});xt.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function Pa(){return xt({baseURL:"https://r2-oj.didapipa.com",url:"/system/notification.json?"+Date.now(),method:"get"})}function xa(){return xt({baseURL:"https://r2-oj.didapipa.com",url:"/system/announcement.json?"+Date.now(),method:"get"})}function Xl(){return B({url:"/system/status",method:"get"})}function Zl(){return B({url:"/system/image/token",method:"get"})}function Ql(e,l){return B({url:"/system/notification",method:"post",data:{theme:e,content:l}})}function en(e,l){return B({url:"/system/announcement",method:"post",data:{title:e,content:l}})}var Tt=(e=>(e[e.Unknown=-1]="Unknown",e[e.C=0]="C",e[e.Cpp=1]="Cpp",e[e.Java=2]="Java",e[e.Python=3]="Python",e[e.Pascal=4]="Pascal",e[e.Golang=5]="Golang",e[e.Lua=6]="Lua",e[e.TypeScript=7]="TypeScript",e[e.Max=8]="Max",e))(Tt||{});function Ot(){const e=[-1,8];return Object.values(Tt).filter(l=>typeof l=="number"&&!e.includes(l)).map(l=>({value:l,label:kt(l)}))}function yt(e){return e>-1&&e<8}function kt(e){switch(e){case 0:return"C";case 1:return"C++";case 2:return"Java";case 3:return"Python";case 4:return"Pascal";case 5:return"Golang";case 6:return"Lua";case 7:return"TypeScript";default:return"未知"}}function Gt(e){switch(e){case 0:return"c";case 1:return"cpp";case 2:return"java";case 3:return"python";case 4:return"pascal";case 5:return"go";case 6:return"lua";case 7:return"typescript";default:return"text"}}var Oe=(e=>(e[e.Init=0]="Init",e[e.Rejudge=1]="Rejudge",e[e.Submitting=2]="Submitting",e[e.Queuing=3]="Queuing",e[e.Compiling=4]="Compiling",e[e.Running=5]="Running",e[e.Accept=6]="Accept",e[e.PE=7]="PE",e[e.WA=8]="WA",e[e.TLE=9]="TLE",e[e.MLE=10]="MLE",e[e.OLE=11]="OLE",e[e.RE=12]="RE",e[e.CE=13]="CE",e[e.CLE=14]="CLE",e[e.JudgeFail=15]="JudgeFail",e[e.SubmitFail=16]="SubmitFail",e[e.Unknown=17]="Unknown",e[e.Max=18]="Max",e))(Oe||{});const tn=e=>{switch(e){case 0:return"普通评测";case 1:return"特殊评测";default:return"未知"}},St=e=>{switch(e){case 0:return"等待处理";case 1:return"重新评测";case 2:return"提交中";case 3:return"队列中";case 4:return"编译中";case 5:return"运行中";case 6:return"通过";case 7:return"格式错误";case 8:return"答案错误";case 9:return"超时";case 10:return"内存超限";case 11:return"输出超限";case 12:return"运行错误";case 13:return"编译错误";case 14:return"编译超限";case 15:return"评测失败";case 16:return"提交失败";case 17:return"未知";default:return e}},Ta=e=>{switch(e){case 0:case 1:case 2:case 3:case 4:case 5:case 17:return"default";case 6:return"success";case 7:return"warning";default:return"danger"}};function Va(){const e=[17,18];return Object.values(Oe).filter(l=>typeof l=="number"&&!e.includes(l)).map(l=>({value:l,label:St(l)}))}function wt(e){return e>=0&&e<17}function it(e){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return!0;default:return!1}}function Da(e){var n;const l={};if(l.id=e.id,l.problemId=e.problem_id,l.contestProblemIndex=e.contest_problem_index,l.status=e.status,it(e.status)||!wt(e.status)?l.score="-":l.score=(e.score/10).toString(),e.time?l.time=Math.ceil(e.time/1e6)+"ms":l.time="-",e.memory?l.memory=(e.memory/1024/1024).toFixed(2)+"MB":l.memory="-",l.language=e.language,l.codeLength=e.code_length,e.approve_time?l.approveTime=new Date(e.approve_time).toLocaleString():l.approveTime="-",l.author=e.author,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.code=e.code,l.compileMessage=e.compile_message,l.taskCurrent=e.task_current,l.taskTotal=e.task_total,l.task=[],e.task)for(let i=0;i<((n=e.task)==null?void 0:n.length);i++){const o=e.task[i],b={};b.taskId=o.task_id,b.status=o.status,o.time?b.time=Math.ceil(o.time/1e6)+"ms":b.time="-",o.memory?b.memory=(o.memory/1024/1024).toFixed(2)+"MB":b.memory="-",b.score=o.score,b.content=o.content,b.waHint=o.wa_hint,!b.content&&!b.waHint&&(b.content="无提示信息"),l.task.push(b)}return e.judger&&(l.judger=e.judger),e.judger_name?l.judgerName=e.judger_name:l.judgerName="-",e.judge_time&&(l.judgeTime=new Date(e.judge_time).toLocaleString()),l}function an(e,l,n,i,o){return B({url:"/judge/approve",method:"post",data:{problem_id:e,contest_id:l,problem_index:n,language:i,code:o}})}function ln(e){return B({url:"/judge?id="+e,method:"get"})}function nn(e){return B({url:"/judge/code?id="+e,method:"get"})}function on(e,l,n,i,o,b,f){let S={problem_id:l,username:n,language:String(i),status:String(o),page:String(b),page_size:String(f)};return e&&(S.contest_id=String(e)),B({url:`/judge/list?${new URLSearchParams(S).toString()}`,method:"get"})}function sn(){return B({url:"/judge/statics/recently",method:"get"})}function rn(){return B({url:"/judge/rejudge/recently",method:"post"})}function un(e,l,n){const i={};return e!=null&&(i.problem_id=e),l!=null?i.language=l:i.language=Tt.Unknown,n!=null?i.status=n:i.status=18,B({url:"/judge/rejudge/search",method:"post",data:i})}function dn(){return B({url:"/judge/rejudge/all",method:"post",timeout:0})}function cn(e){return B({url:"/judge/rejudge",method:"post",data:{id:Number(e)}})}var Ke=(e=>(e[e.None=0]="None",e[e.Attempt=1]="Attempt",e[e.Accept=2]="Accept",e))(Ke||{});function _t(e,l){const n={};if(n.id=e.id,n.author=e.author,n.title=e.title,n.tags=[],e.tags)for(const i of e.tags){const o=l[i];o&&n.tags.push(o)}if(n.private=e.private,n.accept=e.accept,n.attempt=e.attempt,e.description!=null&&(n.description=e.description),e.time_limit!=null&&e.time_limit>=0?n.timeLimit=e.time_limit.toString()+" ms":n.timeLimit="未知",e.memory_limit!=null&&e.memory_limit>=0?n.memoryLimit=(e.memory_limit/1024).toFixed(2)+" MB":n.memoryLimit="未知",e.judge_type!=null&&(n.judgeType=tn(e.judge_type)),e.insert_time!=null&&(n.insertTime=new Date(e.insert_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.source!=null){const i=/\[([^\]]+)\]\(([^)]+)\)/,o=e.source.match(i);o?(n.source=o[1],n.sourceUrl=o[2]):(n.source=e.source,n.sourceUrl="")}return e.judge_md5!=null&&(n.judgeMd5=e.judge_md5),e.origin_oj!=null&&(n.originOj=e.origin_oj),e.origin_id!=null&&(n.originId=e.origin_id),e.origin_url!=null&&(n.originUrl=e.origin_url),n}function La(e,l){const n={};if(n.id=e.id,n.problemId=e.problem_id,n.title=e.title,n.tags=[],e.tags)for(const i of e.tags){const o=l[i];o&&n.tags.push(o)}return e.accept?n.accept=e.accept:n.accept=0,e.attempt?n.attempt=e.attempt:n.attempt=0,n.solution=e.solution,n.code=e.code,e.create_time!=null&&(n.createTime=new Date(e.create_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.updater_nickname!=null&&(n.updaterNickname=e.updater_nickname),n}function ja(e,l,n){const i={};return e?i.id=e:(i.contest_id=l,i.problem_index=n),B({url:`/problem?${new URLSearchParams(i).toString()}`,method:"get"})}function $a(e){return B({url:"/problem/tag/list?max_count="+e,method:"get"})}function mn(e){return B({url:"/problem/judge?id="+e,method:"get"})}function pn(e,l,n,i,o,b){const f={};return e&&(f.oj=e),l&&(f.title=l),n&&(f.tag=n),i!==void 0&&(f.private=i?"1":"0"),o&&(f.page=o),b&&(f.page_size=b),B({url:`/problem/list?${new URLSearchParams(f).toString()}`,method:"get"})}function fn(e){const l={};return e&&(l.problem_id=e),B({url:`/problem/recommend?${new URLSearchParams(l).toString()}`,method:"get"})}function vn(e){return B({url:"/problem/daily?id="+e,method:"get"})}function _n(e){return B({url:"/problem/daily/edit?id="+e,method:"get"})}function gn(){return B({url:"/problem/daily/recently",method:"get"})}function bn(e,l,n,i,o){const b={};return e&&(b.start_date=e),l&&(b.end_date=l),n&&(b.problem_id=n),i&&(b.page=i),o&&(b.page_size=o),B({url:`/problem/daily/list?${new URLSearchParams(b).toString()}`,method:"get"})}function hn(e){return B({url:"/problem/attempt/status",method:"get",params:{ids:e.join(",")}})}function Ua(e,l){return B({url:"/problem/crawl",method:"post",data:{oj:e,id:l}})}function yn(e,l,n,i,o,b,f){return B({url:"/problem/create",method:"post",data:{title:e,time_limit:l,memory_limit:n,source:i,private:o,tags:b,description:f}})}function wn(e,l,n,i,o,b,f,S){return B({url:"/problem/edit",method:"post",data:{id:e,title:l,time_limit:n,memory_limit:i,source:o,private:b,tags:f,description:S}})}function kn(e,l,n,i){return B({url:"/problem/daily/create",method:"post",data:{id:e,problem_id:l,solution:n,code:i}})}function Sn(e,l,n,i){return B({url:"/problem/daily/edit",method:"post",data:{id:e,problem_id:l,solution:n,code:i}})}function Cn(e,l){return B({url:"/problem/judge/data/download?id="+e+"&key="+l,method:"get"})}function In(e){return e||(e=""),B({url:"/problem/image/token?id="+e,method:"get"})}function Pn(e){return e||(e=""),B({url:"/problem/daily/image/token?id="+e,method:"get"})}function xn(e,l){const n=new FormData;return n.append("id",e),n.append("zip",l),B({url:"/problem/judge/data",method:"post",data:n,headers:{"Content-Type":"multipart/form-data"},timeout:1e3*60*5})}function Tn(e){return B({url:"/problem/parse",method:"post",data:{problems:e}})}const Vn={class:"sh-main"},Dn={class:"dida-swiper-div"},Ln=ie({__name:"HomeView",setup(e){const{globalProperties:l}=pe();let n=-1;const i=p({theme:"info",content:""}),o=p({title:"",content:""}),b=p([]),f=p(!1),S=p(!1),m=p(!1),s=async()=>{i.value=await Pa()},T=async()=>{try{const g=await xa();o.value.title=g.title,o.value.content=g.content}catch{ve(l,"加载公告失败"),o.value={title:"公告加载失败",content:"请刷新页面重新获取"}}},v=async()=>{const g=await sn();if(g.code!==0){ve(l,"加载OJ统计数据失败");return}let _=[];for(const w of g.data){const k=new Date(w.date),u=`${k.getMonth()+1}-${k.getDate()}`;_.push({Date:u,Type:"Unaccept",Count:w.attempt-w.accept}),_.push({Date:u,Type:"Accept",Count:w.accept})}const c={type:"bar",data:[{id:"barData",values:_}],xField:"Date",yField:"Count",seriesField:"Type",stack:!0,legends:{visible:!0},bar:{state:{hover:{stroke:"#000",lineWidth:1}}},height:300};new Na(c,{dom:"ojStaticsDiv"}).renderSync()},I=async()=>{b.value=[];const g=await gn();if(g.code!==0){ve(l,"加载每日问题数据失败");return}g.data.list&&g.data.list.length>0&&g.data.list.forEach(_=>{let c="default",d="未尝试";if(g.data.attempt_status){const k=g.data.attempt_status[_.problem_id];if(k)switch(k){case Ke.Accept:c="success",d="已解决";break;case Ke.Attempt:c="warning",d="待解决";break;default:c="default",d="未尝试"}}const w=`${_.title}`;b.value.push({id:_.id,title:w,problemId:_.problem_id,theme:c,tag:d})})};return me(async()=>{m.value=!0,f.value=!0,S.value=!0,(async()=>(await s(),n=setInterval(()=>{s()},3e4),await T(),m.value=!1))(),(async()=>(await v(),f.value=!1))(),(async()=>(await I(),S.value=!1))()}),Ga(()=>{clearInterval(n)}),(g,_)=>{const c=Ct,d=vl,w=fl,k=Te,u=Ae("md-preview"),r=be,z=xe,C=lt,y=bl,j=tt,h=gl,x=_l,$=Pe;return D(),E(k,{loading:m.value},{default:a(()=>[t($,null,{default:a(()=>[t(z,{span:8},{default:a(()=>{var U;return[R("div",Vn,[i.value?(D(),E(c,{key:0,class:"dida-notification-div",theme:i.value.theme},{default:a(()=>[P(q(i.value.content),1)]),_:1},8,["theme"])):oe("",!0),R("div",Dn,[t(w,{class:"dida-swiper"},{default:a(()=>[t(d,null,{default:a(()=>_[1]||(_[1]=[R("a",{href:"http://codeoj.cn",target:"_blank"},[R("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"})],-1)])),_:1}),t(d,null,{default:a(()=>_[2]||(_[2]=[R("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1})]),_:1})]),t(k,{loading:f.value&&!m.value},{default:a(()=>_[3]||(_[3]=[R("div",{id:"ojStaticsDiv",style:{"min-height":"200px"}},null,-1)])),_:1},8,["loading"]),t(r,{title:(U=o.value)==null?void 0:U.title,style:{width:"calc(100% - 100px)",margin:"0 auto"}},{default:a(()=>{var L;return[t(u,{"model-value":(L=o.value)==null?void 0:L.content,previewTheme:"cyanosis"},null,8,["model-value"])]}),_:1},8,["title"])])]}),_:1}),t(z,{span:4},{default:a(()=>[t(r,{style:{margin:"10px"},bordered:!0},{default:a(()=>_[4]||(_[4]=[R("img",{src:"https://api.jysafe.cn/ip/",alt:"Welcome",style:{width:"100%"}},null,-1)])),_:1}),t(Wl,{style:{margin:"10px"}}),t(r,{style:{margin:"10px"},bordered:!0,title:"每日一题"},{actions:a(()=>[t(C,{onClick:_[0]||(_[0]=U=>g.$router.push({name:"problem-daily-list"}))},{default:a(()=>_[5]||(_[5]=[P("查看全部")])),_:1})]),default:a(()=>[t(k,{loading:S.value&&!m.value},{default:a(()=>[t(x,{split:!0,size:"small",style:{"min-height":"200px"}},{default:a(()=>[(D(!0),le(de,null,Ie(b.value,U=>(D(),E(h,{key:U.id},{default:a(()=>[t(y,{style:{width:"100px"}},{description:a(()=>[t(C,{onClick:L=>g.$router.push({name:"problem-daily-detail",params:{dailyId:U.id}})},{default:a(()=>[P(q(U.problemId),1)]),_:2},1032,["onClick"])]),_:2},1024),t(y,{style:{width:"200px"}},{description:a(()=>[t(C,{onClick:L=>g.$router.push({name:"problem-daily-detail",params:{dailyId:U.id}})},{default:a(()=>[P(q(U.title),1)]),_:2},1032,["onClick"])]),_:2},1024),t(y,{style:{width:"135px"},description:U.id},null,8,["description"]),t(y,null,{description:a(()=>[t(j,{theme:U.theme},{default:a(()=>[P(q(U.tag),1)]),_:2},1032,["theme"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["loading"])]),_:1}),t(r,{style:{margin:"10px"},bordered:!0},{header:a(()=>_[6]||(_[6]=[R("b",null,"友情链接",-1)])),default:a(()=>[t(x,null,{default:a(()=>[t(h,null,{default:a(()=>[t(C,{href:"https://boiltask.com",target:"_blank"},{default:a(()=>_[7]||(_[7]=[P("BoilTask Blog")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])}}}),ue=(e,l)=>{const n=e.__vccOpts||e;for(const[i,o]of l)n[i]=o;return n},jn=ue(Ln,[["__scopeId","data-v-805a64dc"]]),$n={class:"sh-main"},Un=ie({__name:"View404",setup(e){let l=Se(),n=p(l.fullPath);return(i,o)=>{const b=O;return D(),le("div",$n,[R("p",null,q(fe(n)),1),o[2]||(o[2]=R("p",null,"该页面无效或已被迁移，请重新选择访问目标",-1)),t(b,{theme:"primary",onClick:o[0]||(o[0]=()=>i.$router.push("/"))},{default:a(()=>o[1]||(o[1]=[P("返回首页")])),_:1})])}}}),za=ue(Un,[["__scopeId","data-v-d4218944"]]);function zn(e){const l={};return l.id=e.id,l.username=e.username,l.nickname=e.nickname,l.email=e.email,l.slogan=e.slogan,l.organization=e.organization,l.accept=e.accept,l.attempt=e.attempt,l.vjudgeId=e.vjudge_id,e.email&&(l.avatar=`https://www.gravatar.com/avatar/${Ha(e.email.toLowerCase().trim())}?d=identicon&s=100`),l}function An(e,l){return B({url:"/user/login",method:"post",data:{username:e,password:l}})}function Rn(){return B({url:"/user/login/refresh",method:"post"})}function Mn(e){const l={username:e};return B({url:`/user/info?${new URLSearchParams(l).toString()}`,method:"get"})}function En(e){const l="https://vjudge.net/user/solveDetail/"+encodeURIComponent(e);return xt({url:l,method:"get"})}function qn(e){return B({url:"/user/account/infos",method:"post",data:{users:e}})}function Kn(e){return B({url:"/user/parse",method:"post",data:{users:e}})}function Fn(e,l){return B({url:"/user/register/email",method:"post",data:{token:e,email:l}})}function On(e,l,n,i,o){return B({url:"/user/register",method:"post",data:{username:e,password:l,email:n,key:i,nickname:o}})}function Gn(e,l){return B({url:"/user/forget",method:"post",data:{token:e,username:l}})}function Nn(e,l,n){return B({url:"/user/password/modify",method:"post",data:{username:e,password:l,key:n}})}const Hn={class:"dida-login-footer"},Bn=ie({__name:"LoginView",setup(e){const{globalProperties:l}=pe(),n=qe(),i=p(!1),o=p({username:"",password:""}),b=()=>{ke(l,"重置成功")},f=({validateResult:S,firstError:m})=>{i.value||(i.value=!0,An(o.value.username,o.value.password).then(s=>{if(s.code===0){n.loadResponse(s.data),ke(l,"登录成功");let T=l.$route.query.redirect_uri;T||(T="/user/"+s.data.username),l.$router.push({path:T})}else F(l,s.code)}).catch(s=>{console.error("Login error",s),ve(l,"登录失败")}).finally(()=>{i.value=!1}))};return me(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),(S,m)=>{const s=Ue,T=$e,v=O,I=je,g=lt,_=be;return D(),E(_,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(I,{ref:"form",data:o.value,colon:!0,onReset:b,onSubmit:f,class:"yj-login-form","label-width":0},{default:a(()=>[t(T,{name:"username"},{default:a(()=>[t(s,{modelValue:o.value.username,"onUpdate:modelValue":m[0]||(m[0]=c=>o.value.username=c),clearable:"",autocomplete:"username",placeholder:"请输入用户名"},{"prefix-icon":a(()=>[t(fe(Ba))]),_:1},8,["modelValue"])]),_:1}),t(T,{name:"password"},{default:a(()=>[t(s,{modelValue:o.value.password,"onUpdate:modelValue":m[1]||(m[1]=c=>o.value.password=c),type:"password",autocomplete:"current-password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":a(()=>[t(fe(Ja))]),_:1},8,["modelValue"])]),_:1}),t(T,null,{default:a(()=>[t(v,{theme:"primary",type:"submit",block:"",loading:i.value},{default:a(()=>m[4]||(m[4]=[P("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),R("div",Hn,[t(g,{onClick:m[2]||(m[2]=()=>{fe(l).$router.push({name:"login-forget"})})},{default:a(()=>m[5]||(m[5]=[P("忘记密码 ")])),_:1}),t(g,{onClick:m[3]||(m[3]=()=>{fe(l).$router.push({name:"register"})})},{default:a(()=>m[6]||(m[6]=[P("注册账户 ")])),_:1})])]),_:1})}}}),Jn=ue(Bn,[["__scopeId","data-v-524b77f9"]]),Wn={class:"dida-login-footer"},Yn=ie({__name:"RegisterView",setup(e){const{globalProperties:l}=pe(),n=qe(),i=p(!1),o=p(!1),b=p(!1),f=p("发送验证码");let S=null,m=-1;const s=p(!1),T=p(null),v=p({username:"",password:"",confirmPassword:"",nickname:"",email:"",emailKey:""}),g=p({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:u=>new Promise(r=>{const z=setTimeout(()=>{r(v.value.password===u),clearTimeout(z)})}),message:"两次密码不一致"}],nickname:[{required:!0,message:"请填写昵称"},{min:1,message:"昵称至少1个字符"},{max:30,message:"昵称最多30个字符"}],email:[{required:!0,message:"请填写邮箱"},{pattern:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"邮箱格式不正确"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),_=p(()=>t(O,{onClick:c,disabled:b.value,loading:o.value,style:"width:120px"},{default:()=>[f.value]})),c=async()=>{var C;if(!v.value.email){ve(l,"请输入邮箱");return}if(!v.value.email.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)){ve(l,"邮箱格式不正确");return}if(b.value||o.value)return;s.value=!0,await ct();const u=document.getElementById("cf-confirm-div");u&&u.remove();const r=document.createElement("div");r.id="cf-confirm-div",r.setAttribute("data-theme","light"),(C=T.value)==null||C.appendChild(r);const z=window;z.turnstile.ready(function(){z.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(y){s.value=!1,await d(y)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},d=async u=>{if(!b.value){o.value=!0;try{const r=await Fn(u,v.value.email);if(r.code!==0){F(l,r.code);return}ke(l,"发送验证码成功"),o.value=!1,b.value=!0,S=new Date,f.value="60秒后重发",m=setInterval(()=>{const C=Math.floor((new Date().getTime()-(S==null?void 0:S.getTime()))/1e3);C>60?(f.value="发送验证码",b.value=!1,clearInterval(m)):f.value=`${60-C}秒后重发`},1e3)}catch{ve(l,"发送验证码失败")}finally{o.value=!1}}},w=()=>{ke(l,"重置成功")},k=({validateResult:u,firstError:r,e:z})=>{if(!i.value){if(z.preventDefault(),u!==!0){ve(l,r);return}if(v.value.password!==v.value.confirmPassword){ve(l,"两次密码不一致");return}i.value=!0,On(v.value.username,v.value.password,v.value.email,v.value.emailKey,v.value.nickname).then(C=>{C.code===0?(ke(l,"注册成功，可使用账号信息登录"),l.$router.push({name:"login"})):F(l,C.code)}).catch(C=>{console.error("Login error",C),ve(l,"登录失败")}).finally(()=>{i.value=!1})}};return me(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),Ve(()=>{clearInterval(m)}),(u,r)=>{const z=Ue,C=$e,y=ha,j=O,h=je,x=lt,$=be,U=nt;return D(),le(de,null,[t($,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(h,{ref:"form",rules:g.value,data:v.value,colon:!0,onReset:w,onSubmit:k,class:"yj-login-form"},{default:a(()=>[t(C,{name:"username",label:"用户名"},{default:a(()=>[t(z,{modelValue:v.value.username,"onUpdate:modelValue":r[0]||(r[0]=L=>v.value.username=L),clearable:"",placeholder:"用于登录与查找"},null,8,["modelValue"])]),_:1}),t(C,{name:"password",label:"密码"},{default:a(()=>[t(z,{modelValue:v.value.password,"onUpdate:modelValue":r[1]||(r[1]=L=>v.value.password=L),type:"password",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(C,{name:"confirmPassword",label:"确认密码"},{default:a(()=>[t(z,{modelValue:v.value.confirmPassword,"onUpdate:modelValue":r[2]||(r[2]=L=>v.value.confirmPassword=L),type:"password",clearable:"",placeholder:"请确认密码"},null,8,["modelValue"])]),_:1}),t(C,{name:"nickname",label:"昵称"},{default:a(()=>[t(z,{modelValue:v.value.nickname,"onUpdate:modelValue":r[3]||(r[3]=L=>v.value.nickname=L),clearable:"",placeholder:"用于优先在网站各处展示"},null,8,["modelValue"])]),_:1}),t(C,{name:"email",label:"邮箱"},{default:a(()=>[t(z,{modelValue:v.value.email,"onUpdate:modelValue":r[4]||(r[4]=L=>v.value.email=L),clearable:"",placeholder:"请填写常用邮箱"},null,8,["modelValue"])]),_:1}),t(C,{name:"emailKey",label:"验证码"},{default:a(()=>[t(y,{append:_.value},{default:a(()=>[t(z,{modelValue:v.value.emailKey,"onUpdate:modelValue":r[5]||(r[5]=L=>v.value.emailKey=L),clearable:"",placeholder:"请输入验证码",style:{width:"140px"}},null,8,["modelValue"])]),_:1},8,["append"])]),_:1}),t(C,null,{default:a(()=>[t(j,{theme:"primary",type:"submit",block:"",loading:i.value},{default:a(()=>r[8]||(r[8]=[P("注册")])),_:1},8,["loading"])]),_:1})]),_:1},8,["rules","data"]),R("div",Wn,[t(x,{onClick:r[6]||(r[6]=()=>{fe(l).$router.push({name:"login"})})},{default:a(()=>r[9]||(r[9]=[P("返回登陆 ")])),_:1})])]),_:1}),t(U,{visible:s.value,"onUpdate:visible":r[7]||(r[7]=L=>s.value=L),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:a(()=>[R("div",{ref_key:"dialogContainer",ref:T,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),Xn=ue(Yn,[["__scopeId","data-v-9b5f4fc7"]]),Zn={key:0,style:{margin:"10px"}},Qn={key:1,style:{margin:"10px"}},eo={style:{margin:"12px"}},to=ie({__name:"UserView",setup(e){let l=Se();const{globalProperties:n}=pe(),i=Ye();let o="";const b=p(!1),f=p(null),S=p([]),m=p([]),s=p([]),T=async v=>{b.value=!0;try{let I=await Mn(v);if(I.code!==0){b.value=!1,F(n,I.code),await Y.push({name:"home"});return}if(f.value=zn(I.data.user),S.value=I.data.problems_ac,i.setTitle(f.value.nickname+" - "+i.getTitle),f.value.vjudgeId){const g=await En(f.value.vjudgeId);m.value=g.acRecords;for(const _ in m.value)m.value[_].sort((c,d)=>c.length===d.length?c.localeCompare(d):c.length-d.length);s.value=g.failRecords;for(const _ in s.value)s.value[_].sort((c,d)=>c.length===d.length?c.localeCompare(d):c.length-d.length)}}catch{ve(n,"获取用户信息失败"),await Y.push({name:"home"})}finally{b.value=!1}};return Wa(async(v,I,g)=>{if(Array.isArray(v.params.username)?o=v.params.username[0]:o=v.params.username,!o){await Y.push({name:"home"});return}await T(o),g()}),me(async()=>{if(Array.isArray(l.params.username)?o=l.params.username[0]:o=l.params.username,!o){await Y.push({name:"home"});return}await T(o)}),(v,I)=>{const g=O,_=we,c=be,d=lt,w=Be,k=He,u=xe,r=hl,z=Pe,C=Te;return D(),E(C,{loading:b.value},{default:a(()=>[t(z,{class:"dida-main-content"},{default:a(()=>[t(u,{span:8},{default:a(()=>{var y;return[t(c,{style:{margin:"10px"},title:"AC题目"},{default:a(()=>[t(_,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(D(!0),le(de,null,Ie(S.value,j=>(D(),E(g,{key:j,size:"small",onClick:()=>fe(Y).push({name:"problem-detail",params:{problemId:j}})},{default:a(()=>[P(q(j),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),(y=f.value)!=null&&y.vjudgeId?(D(),E(c,{key:0,style:{margin:"10px"},title:"vjudge.net"},{actions:a(()=>{var j;return[t(d,{href:"https://vjudge.net/user/"+((j=f.value)==null?void 0:j.vjudgeId),target:"_blank"},{default:a(()=>{var h;return[P("@"+q((h=f.value)==null?void 0:h.vjudgeId),1)]}),_:1},8,["href"])]}),default:a(()=>[m.value&&Object.keys(m.value).length>0?(D(),le("div",Zn,[I[0]||(I[0]=R("div",{style:{margin:"5px"}},[R("span",null,"AC")],-1)),t(k,{layout:"vertical",bordered:!0},{default:a(()=>[(D(!0),le(de,null,Ie(m.value,(j,h)=>(D(),E(w,{key:h,label:h},{default:a(()=>[t(_,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(D(!0),le(de,null,Ie(j,x=>(D(),E(g,{key:x,size:"small",onClick:()=>fe(Y).push({name:"problem-detail",params:{problemId:h+"-"+x}})},{default:a(()=>[P(q(x),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):oe("",!0),s.value&&Object.keys(s.value).length>0?(D(),le("div",Qn,[I[1]||(I[1]=R("div",{style:{margin:"5px"}},[R("span",null,"Fail")],-1)),t(k,{layout:"vertical",bordered:!0},{default:a(()=>[(D(!0),le(de,null,Ie(s.value,(j,h)=>(D(),E(w,{key:h,label:h},{default:a(()=>[t(_,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(D(!0),le(de,null,Ie(j,x=>(D(),E(g,{key:x,size:"small",onClick:()=>fe(Y).push({name:"problem-detail",params:{problemId:h+"-"+x}})},{default:a(()=>[P(q(x),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):oe("",!0)]),_:1})):oe("",!0)]}),_:1}),t(u,{span:4},{default:a(()=>[R("div",eo,[t(k,{layout:"vertical",bordered:!0},{default:a(()=>[t(w,{label:"头像"},{default:a(()=>{var y;return[t(r,{shape:"round",size:"100px",image:(y=f.value)==null?void 0:y.avatar,"hide-on-load-failed":!1},null,8,["image"])]}),_:1}),t(w,{label:"昵称"},{default:a(()=>{var y;return[P(q((y=f.value)==null?void 0:y.nickname),1)]}),_:1}),t(w,{label:"Slogan"},{default:a(()=>{var y;return[P(q((y=f.value)==null?void 0:y.slogan),1)]}),_:1}),t(w,{label:"邮箱"},{default:a(()=>{var y;return[P(q((y=f.value)==null?void 0:y.email),1)]}),_:1}),t(w,{label:"组织"},{default:a(()=>{var y;return[P(q((y=f.value)==null?void 0:y.organization),1)]}),_:1}),t(w,{label:"通过数量"},{default:a(()=>{var y;return[P(q((y=f.value)==null?void 0:y.accept),1)]}),_:1}),t(w,{label:"提交数量"},{default:a(()=>{var y;return[P(q((y=f.value)==null?void 0:y.attempt),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),ao=ue(to,[["__scopeId","data-v-555e19aa"]]),Nt=[{name:"home",path:"/",title:"首页",showSidebar:!1,disableGenerateTab:!0,component:jn},{name:"problem",path:"/problem",title:"题目",icon:"calculation",showSidebar:!0,redirect:"problem-list"},{name:"collection-detail-tab",title:"题集",path:"/collection",showSidebar:!0,disableGenerateTab:!0,redirect:"problem-collection-list"},{name:"judge",path:"/judge",title:"评测",icon:"code",showSidebar:!0,redirect:"judge-list"},{name:"contest",path:"/contest",title:"比赛",icon:"application",showSidebar:!0,redirect:"contest-list"},{name:"contest-detail-tab",title:"比赛",path:"/contest",showSidebar:!0,disableGenerateTab:!0,redirect:"contest-list"},{name:"discuss",title:"讨论",path:"/discuss",icon:"sonic",showSidebar:!0,redirect:"discuss-list"},{name:"discuss-detail-tab",title:"讨论",path:"/discuss",showSidebar:!0,disableGenerateTab:!0,redirect:"discuss-list"},{name:"rank",path:"/rank",title:"排名",icon:"chart-column",showSidebar:!0,redirect:"rank-ac-all"},{name:"system",path:"/system",title:"系统",icon:"dashboard",showSidebar:!0,redirect:"system-status"},{name:"manage",path:"/manage",title:"管理",icon:"command",showSidebar:!0,redirect:"manage-web",auths:[ze.ManageWeb]},{name:"login",path:"/login",title:"登陆",showSidebar:!1,disableGenerateTab:!0,component:Jn},{name:"register",path:"/register",title:"注册",showSidebar:!1,disableGenerateTab:!0,component:Xn},{name:"user",path:"/user/:username+",title:"用户",showSidebar:!1,needLogin:!0,disableGenerateTab:!0,component:ao},{name:"404",path:"/404",title:"404",showSidebar:!1,disableGenerateTab:!0,component:za}],lo=e=>Nt.find(l=>l.name==e),no=e=>{const l=[];return Nt.forEach(n=>{!n.disableGenerateTab&&e.hasAllAuths(n.auths)&&l.push(n)}),l},oo=e=>{Nt.forEach(l=>{const n={name:l.name,path:l.path,meta:{title:l.title,tab:l.name,showSidebar:l.showSidebar,needLogin:l.needLogin,redirect:l.redirect,tabAuths:l.auths},component:l.component};e.push(n)})};function Aa(e){return e.children!==void 0}function so(e){return e.children!==void 0}const ro={style:{margin:"10px"}},io={key:0,class:"dida-operation-container"};function uo(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const co=ie({__name:"ProblemList",setup(e){const l=Se(),n=We(),{globalProperties:i}=pe(),o=qe();let b=null;const f=p(!1),S={};let m={};const s=p(!1),T=Ne(()=>o.hasAuth(ze.ManageProblem)),v=p([{title:"ID",colKey:"id",cell:(V,A)=>{let M=C(A.row.id);return t(O,{variant:"dashed",theme:M,onClick:()=>z(A.row.id)},{default:()=>[A.row.id]})}},{title:"标题",colKey:"title",cell:(V,A)=>t(O,{variant:"text",onClick:()=>z(A.row.id)},{default:()=>[A.row.title]})},{title:"标签",colKey:"tags",cell:(V,A)=>{const M=A.row.tags;if(!M||M.length===0)return"";let J=[];for(let Q=0;Q<M.length;Q++){const ee=M[Q];J.push(t(O,{key:Q,theme:"default",variant:"outline",size:"small",onClick:()=>x(ee)},{default:()=>[ee.name]}))}return t(we,null,uo(J)?J:{default:()=>[J]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),I=p(!1);let g=1,_=50;const c=p({current:g,pageSize:_,defaultCurrent:g,defaultPageSize:_,total:0,pageSizeOptions:[50,100]}),d=p(),w=p(),k=[{label:"DidaOJ",value:"didaoj"},{label:"HDU",value:"hdu"},{label:"POJ",value:"poj"},{label:"NYOJ",value:"nyoj"}],u=p({oj:"",title:"",tag:"",private:!1}),r=p({oj:"",problem:""}),z=V=>{V&&n.push({path:"/problem/"+V})},C=V=>{if(!V||!m)return"default";const A=m[V];if(!A)return"default";switch(A){case Ke.Accept:return"success";case Ke.Attempt:return"warning";default:return"default"}},y=async()=>{await n.push({query:{...l.query,oj:u.value.oj,title:u.value.title,tag:u.value.tag,private:u.value.private?"1":"0",page:1,page_size:c.value.defaultPageSize}})},j=async()=>{u.value.oj="",u.value.title="",u.value.tag="",u.value.private=!1,await n.push({query:{...l.query,oj:"",title:"",tag:"",private:"0",page:1,page_size:c.value.defaultPageSize}})},h=async()=>{try{s.value=!0;const V=await Ua(r.value.oj,r.value.problem);V.code===0?(ke(i,"搜索成功"),await n.push({name:"problem-detail",params:{problemId:V.data}})):F(i,V.code)}catch(V){console.error(V),F(i,Fe())}finally{s.value=!1}},x=V=>{V&&n.push({query:{...l.query,title:"",tag:V.name,page:1,page_size:c.value.defaultPageSize}})},$=()=>{n.push({name:"manage-problem-create"})},U=async(V,A)=>{I.value=!0;try{const{current:M,pageSize:J}=V,Q=await pn(u.value.oj,u.value.title,u.value.tag,u.value.private,M,J);if(d.value=[],Q.code===0){const ee=Q.data.list;if(!ee||ee.length<=0){c.value={...c.value,total:0},m={},ke(i,"未找到记录");return}ee.forEach(ne=>{var G;const ae=_t(ne,S);(G=d.value)==null||G.push(ae)}),c.value={...c.value,total:Q.data.total_count},m=Q.data.problem_attempt_status}else A&&F(i,Q.code)}catch(M){console.error(M),F(i,Fe())}finally{I.value=!1}},L=async V=>{await n.push({query:{...l.query,page:V.current,page_size:V.pageSize}})};return me(async()=>{I.value=!0,w.value=[],$a(-1).then(V=>{if(V.code===0){w.value=V.data.list,f.value=V.data.total_count>V.data.list.length;for(let A=0;A<V.data.list.length;A++){const M=V.data.list[A];S[M.id]=M}b=Le(()=>l.query,A=>{u.value.oj=A.oj||"",u.value.title=A.title||"",u.value.tag=A.tag||"",u.value.private=A.private==="1";const M=parseInt(A.page)||c.value.defaultCurrent,J=parseInt(A.page_size)||c.value.defaultPageSize;g=M,_=J,c.value={...c.value,current:g,pageSize:_},U({current:g,pageSize:_},!0)},{immediate:!0})}else f.value=!0}).catch(V=>{console.error(V),f.value=!0})}),Ve(()=>{b&&b()}),(V,A)=>{const M=Re,J=be,Q=xe,ee=O,ne=we,ae=pt,G=$e,ce=Ue,Z=ft,N=je,X=Pe;return D(),E(X,null,{default:a(()=>[t(Q,{span:9},{default:a(()=>[t(J,{style:{margin:"10px"}},{default:a(()=>[t(M,{data:d.value,columns:v.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:c.value,"table-layout":"auto",loading:I.value,onPageChange:L},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(Q,{span:3},{default:a(()=>[R("div",ro,[T.value?(D(),le("div",io,[t(ne,null,{default:a(()=>[t(ee,{onClick:$},{default:a(()=>A[7]||(A[7]=[P("新建")])),_:1})]),_:1})])):oe("",!0),t(J,{class:"sh-card"},{default:a(()=>[t(N,{model:u.value,onSubmit:y,onReset:j},{default:a(()=>[t(G,{label:"OJ"},{default:a(()=>[t(ae,{modelValue:u.value.oj,"onUpdate:modelValue":A[0]||(A[0]=te=>u.value.oj=te),options:k,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(G,{label:"标题"},{default:a(()=>[t(ce,{modelValue:u.value.title,"onUpdate:modelValue":A[1]||(A[1]=te=>u.value.title=te),placeholder:"请输入关键词"},null,8,["modelValue"])]),_:1}),t(G,{label:"标签"},{default:a(()=>[t(ce,{modelValue:u.value.tag,"onUpdate:modelValue":A[2]||(A[2]=te=>u.value.tag=te),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),T.value?(D(),E(G,{key:0,label:"私有"},{default:a(()=>[t(Z,{modelValue:u.value.private,"onUpdate:modelValue":A[3]||(A[3]=te=>u.value.private=te)},null,8,["modelValue"])]),_:1})):oe("",!0),t(G,null,{default:a(()=>[t(ne,null,{default:a(()=>[t(ee,{theme:"primary",type:"submit"},{default:a(()=>A[8]||(A[8]=[P("搜索")])),_:1}),t(ee,{theme:"danger",type:"reset"},{default:a(()=>A[9]||(A[9]=[P("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(J,{class:"sh-card"},{default:a(()=>[t(N,{model:r.value,onSubmit:h},{default:a(()=>[t(G,{label:"OJ"},{default:a(()=>[t(ae,{modelValue:r.value.oj,"onUpdate:modelValue":A[4]||(A[4]=te=>r.value.oj=te),options:k,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(G,{label:"题目"},{default:a(()=>[t(ce,{modelValue:r.value.problem,"onUpdate:modelValue":A[5]||(A[5]=te=>r.value.problem=te),placeholder:"请输入原始题号"},null,8,["modelValue"])]),_:1}),t(G,null,{default:a(()=>[t(ee,{theme:"primary",type:"submit",loading:s.value},{default:a(()=>A[10]||(A[10]=[P("前往")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),t(J,{class:"sh-card sh-background-black"},{default:a(()=>[(D(!0),le(de,null,Ie(w.value,te=>(D(),E(ee,{class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:()=>x(te)},{default:a(()=>[P(q(te.name),1)]),_:2},1032,["onClick"]))),256)),f.value?(D(),E(ee,{key:0,class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:A[6]||(A[6]=()=>V.$router.push("/problem/tags"))},{default:a(()=>A[11]||(A[11]=[P(" ... ")])),_:1})):oe("",!0)]),_:1})])]),_:1})]),_:1})}}}),mo=ue(co,[["__scopeId","data-v-dbe06f89"]]);function at(e){let l="";for(;e>0;)e--,l=String.fromCharCode(65+e%26)+l,e=Math.floor(e/26);return l}function Ht(e){const l={};if(l.id=e.id,l.ownerId=e.owner_id,l.ownerUsername=e.owner_username,l.ownerNickname=e.owner_nickname,l.title=e.title,l.startTime=new Date(e.start_time).toLocaleString(),l.endTime=new Date(e.end_time).toLocaleString(),l.createTime=new Date(e.create_time).toLocaleString(),l.updateTime=new Date(e.update_time).toLocaleString(),l.private=e.private,l.description=e.description,l.notification=e.notification,e.problems){l.problems=[],e.problems.sort((n,i)=>n.index-i.index);for(let n=0;n<e.problems.length;n++){const i=e.problems[n];let o={accept:0,attempt:0,author:"",id:"",private:!1,tags:[],title:""};o.index=i.index,o.id=at(i.index),o.title=i.title,i.accept?o.accept=i.accept:o.accept=0,i.attempt?o.attempt=i.attempt:o.attempt=0,l.problems.push(o)}}return l}function po(e){return B({url:"/contest?id="+e,method:"get"})}function fo(e){return B({url:"/contest/edit?id="+e,method:"get"})}function vo(e){return B({url:"/contest/problem/list?id="+e,method:"get"})}function _o(e){return e||(e=0),B({url:"/contest/image/token?id="+e,method:"get"})}function go(e,l){return B({url:"/contest/problem?id="+e+"&problem_index="+l,method:"get"})}function bo(e,l,n,i){const o={};return e&&(o.title=e),l&&(o.username=l),n&&(o.page=String(n)),i&&(o.page_size=String(i)),B({url:`/contest/list?${new URLSearchParams(o).toString()}`,method:"get"})}function ho(e){return B({url:"/contest/rank?id="+e,method:"get"})}function yo(e){return B({url:"/contest/create",method:"post",data:e})}function wo(e){return B({url:"/contest/edit",method:"post",data:e})}function ko(e,l){return B({url:"/contest/password",method:"post",data:{id:e,password:l}})}function So(e){return B({url:"/contest/dolos",method:"post",data:{id:e}})}const Bt=async(e,l)=>{l&&await e.push({name:"user",params:{username:l}})},ea=e=>{const l=Y.resolve({name:"problem-detail",params:{problemId:e}});window.open(l.href,"_blank")},Et=async(e,l)=>{await Y.push({name:"contest-problem-detail",params:{contestId:e,problemIndex:l}})},Co={class:"sh-button"},Io={style:{"margin-top":"16px"}},Po={__name:"SecretPanel",setup(e){const l=p(!1);return(n,i)=>{const o=O;return D(),le("div",Qa(el(n.$attrs)),[R("div",Co,[t(o,{onClick:i[0]||(i[0]=b=>l.value=!l.value)},{default:a(()=>[P(q(l.value?"收起":"展开"),1)]),_:1})]),Ya(R("div",Io,[Za(n.$slots,"default",{},void 0)],512),[[Xa,l.value]])],16)}}},ta=ue(Po,[["__scopeId","data-v-23f11aab"]]),xo={key:1,style:{"text-align":"center"}},To={key:1,style:{"text-align":"center"}},Vo={key:0,class:"dida-problems-container"},Do={style:{margin:"12px"}},Lo={key:1},jo={class:"dida-operation-container"},$o={key:0,class:"dida-operation-container"},Uo={class:"dida-code-submit-div"},zo={class:"dida-code-editor-div"},Ao=ie({__name:"ProblemDetail",setup(e){let l=Se();const{globalProperties:n}=pe();let i=null;const o=Ye(),b=qe();let f=p(""),S="",m="",s=0,T=p(0);const v=p(!1),I=p(!1),g=p(!1),_=p(null);let c=null;const d=p(null),w=p(!1),k=p(!1),u={},r=p(""),z=p([]);z.value=Ot();const C=p([]),y=p(null),j=p(-1),h=p(-1),x=p(""),$=p("");let U=0;const L=Ne(()=>b.hasAuth(ze.ManageProblem)),V=Ne(()=>b.hasAuth(ze.ManageProblemDaily)),A=()=>{y.value&&clearInterval(y.value),y.value=setInterval(()=>{const K=j.value<=0,H=new Date(new Date().getTime()+U),re=H.getHours()*60*60+H.getMinutes()*60+H.getSeconds(),_e=18*60*60;re<_e?j.value=_e-re:j.value=-1,h.value=24*60*60-re,(!K&&j.value<=0||h.value<=0)&&te()},1e3)},M=()=>{y.value&&(clearInterval(y.value),y.value=null)},J=K=>{K&&Y.push({name:"problem-list",query:{...l.query,title:"",tag:K.name}})},Q=async()=>{if(!m){ve(n,"每日问题ID无效");return}await Y.push({name:"manage-problem-daily",params:{dailyId:m}})},ee=async()=>{let K=S;if(!K)try{const H=await go(s,T.value);H.code===0?K=H.data:F(n,H.code)}catch{ve(n,"获取题目ID失败，请稍后再试");return}await Y.push({name:"manage-problem",params:{problemId:K}})},ne=()=>{S?Y.push({name:"judge-list",query:{problem_id:S}}):Y.push({name:"contest-judge",params:{contestId:s},query:{problem_id:at(T.value)}})},ae=()=>{S?Y.push({name:"discuss-list-problem",query:{problem_id:S}}):Y.push({name:"contest-discuss",params:{contestId:s},query:{problem_id:at(T.value)}})},G=()=>{Y.push({name:"problem-recommend",params:{problemId:S}})},ce=async()=>{var re,_e;const K=(re=_.value)==null?void 0:re.originOj,H=(_e=_.value)==null?void 0:_e.originId;if(!(!K||!H))try{w.value=!0;const ge=await Ua(K,H);ge.code===0?(await X(),ke(n,"更新成功")):F(n,ge.code)}catch{ve(n,"更新失败，请稍后再试")}finally{w.value=!1}},Z=async()=>{const K=parseInt(r.value);if(!yt(K)){ve(n,"请选择所编写的语言");return}const H=c==null?void 0:c.getValue();if(!H){ve(n,"请输入所需提交的代码");return}if(!S&&(!s||!T.value)){ve(n,"问题ID无效");return}k.value=!0;try{const re=await an(S,s,T.value,K,H);if(re.code!==0){F(n,re.code);return}ke(n,"提交成功，正在跳转到详情页面");const _e=re.data.id;s?await Y.push({name:"contest-judge-detail",params:{contestId:s,judgeId:_e}}):await Y.push({name:"judge-detail",params:{judgeId:_e}})}finally{k.value=!1}},N=K=>{if(!c)return;const H=c.getModel();H&&Qt.setModelLanguage(H,Gt(K))},X=async()=>{C.value=[];let K=await ja(S,s,T.value);if(K.code!==0){g.value=!1,F(n,K.code),await Y.push({name:"problem"});return}K.data.tags&&K.data.tags.forEach(H=>{u[H.id]=H}),_.value=_t(K.data.problem,u),o.setTitle(_.value.title+" - "+o.getTitle),s&&(K=await vo(s),K.code===0?(K.data.problems.sort((H,re)=>H-re),C.value=K.data.problems):F(n,K.code)),f.value=_.value.description,await ct(()=>{!c&&d.value&&(c=Qt.create(d.value,{value:"",language:"cpp",minimap:{enabled:!0},colorDecorators:!0,readOnly:!1,theme:"vs-dark"})),g.value=!1})},te=async()=>{M(),I.value=!1;const K=await vn(m);if(K.code!==0)return;I.value=!0;const H=K.data.problem_daily;S=H.problem_id,x.value=H.solution,$.value=H.code;const re=new Date(K.data.time);U=re.getTime()-new Date().getTime();const _e=new Date(re.getTime()),ge=_e.getFullYear(),W=String(_e.getMonth()+1).padStart(2,"0"),he=String(_e.getDate()).padStart(2,"0"),Ce=`${ge}-${W}-${he}`;if(m===Ce){const ye=re.getHours()*60*60+re.getMinutes()*60+re.getSeconds(),De=18*60*60;ye<De?j.value=De-ye:j.value=-1,h.value=24*60*60-ye}(j.value>=0||h.value>=0)&&A()};return me(async()=>{i=Le(()=>l.params,async()=>{if(I.value=!1,Array.isArray(l.params.problemId)?S=l.params.problemId[0]:S=l.params.problemId,S||(Array.isArray(l.params.dailyId)?m=l.params.dailyId[0]:m=l.params.dailyId,g.value=!0,await te(),g.value=!1),!S){if(Array.isArray(l.params.contestId)?s=Number(l.params.contestId[0]):s=Number(l.params.contestId),!s){ve(n,"题目不存在"),m?await Y.push({name:"problem-daily-list"}):await Y.push({name:"problem"});return}if(Array.isArray(l.params.problemIndex)?T.value=parseInt(l.params.problemIndex[0]):T.value=parseInt(l.params.problemIndex),!T.value){ve(n,"题目不存在"),await Y.push({name:"problem"});return}}v.value=!!s,g.value=!0,await X()},{immediate:!0}),d.value&&new ResizeObserver(()=>{c&&c.layout()}).observe(d.value)}),Ve(()=>{i&&(i(),i=null),M()}),(K,H)=>{const re=Ae("md-preview"),_e=be,ge=qt,W=we,he=xe,Ce=O,ye=Be,De=lt,Je=He,Xe=Kt,et=pt,ot=Pe,Vt=Te;return D(),E(Vt,{loading:g.value},{default:a(()=>[t(ot,{class:"dida-main-content"},{default:a(()=>[t(he,{span:8},{default:a(()=>[t(_e,{style:{margin:"10px"}},{default:a(()=>[t(re,{"model-value":fe(f),previewTheme:"cyanosis"},null,8,["model-value"])]),_:1}),I.value?(D(),E(_e,{key:0,style:{margin:"10px"},title:"题解"},{default:a(()=>[j.value<0?(D(),E(ta,{key:0},{default:a(()=>[t(re,{"model-value":x.value,previewTheme:"cyanosis"},null,8,["model-value"])]),_:1})):(D(),le("div",xo,[R("div",null,[t(W,null,{default:a(()=>[H[2]||(H[2]=R("p",null,"距离解锁百分比",-1)),t(ge,{theme:"circle",color:{from:"#0052D9",to:"#00A870"},percentage:100-j.value/(18*60*60)*100,status:"active"},{label:a(()=>[P(q((100-j.value/(18*60*60)*100).toFixed(3))+"% ",1)]),default:a(()=>[H[1]||(H[1]=P(" > "))]),_:1},8,["percentage"])]),_:1})])]))]),_:1})):oe("",!0),I.value?(D(),E(_e,{key:1,style:{margin:"10px"},title:"示例代码"},{default:a(()=>[h.value<0?(D(),E(ta,{key:0},{default:a(()=>[t(re,{"model-value":$.value,previewTheme:"cyanosis"},null,8,["model-value"])]),_:1})):(D(),le("div",To,[R("div",null,[t(W,{style:{margin:"0 auto"}},{default:a(()=>[H[4]||(H[4]=R("p",null,"距离解锁百分比",-1)),t(ge,{theme:"circle",color:{from:"#0052D9",to:"#00A870"},percentage:100-h.value/(24*60*60)*100,status:"active"},{label:a(()=>[P(q((100-h.value/(24*60*60)*100).toFixed(3))+"% ",1)]),default:a(()=>[H[3]||(H[3]=P(" > "))]),_:1},8,["percentage"])]),_:1})])]))]),_:1})):oe("",!0)]),_:1}),t(he,{span:4},{default:a(()=>{var Yt;return[fe(s)?(D(),le("div",Vo,[t(W,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(D(!0),le(de,null,Ie(C.value,(Me,se)=>(D(),E(Ce,{key:se,theme:Me==fe(T)?"primary":"default",onClick:async()=>await fe(Et)(fe(s),Me)},{default:a(()=>[P(q(fe(at)(Me)),1)]),_:2},1032,["theme","onClick"]))),128))]),_:1})])):oe("",!0),R("div",Do,[t(Je,{layout:"vertical",bordered:!0},{default:a(()=>{var Me;return[t(ye,{label:"ID"},{default:a(()=>{var se;return[P(q((se=_.value)==null?void 0:se.id),1)]}),_:1}),t(ye,{label:"标题"},{default:a(()=>{var se;return[P(q((se=_.value)==null?void 0:se.title),1)]}),_:1}),t(ye,{label:"时间限制"},{default:a(()=>{var se;return[P(q((se=_.value)==null?void 0:se.timeLimit),1)]}),_:1}),t(ye,{label:"内存限制"},{default:a(()=>{var se;return[P(q((se=_.value)==null?void 0:se.memoryLimit),1)]}),_:1}),t(ye,{label:"判题方式"},{default:a(()=>{var se;return[P(q((se=_.value)==null?void 0:se.judgeType),1)]}),_:1}),v.value?oe("",!0):(D(),E(ye,{key:0,label:"正确提交"},{default:a(()=>{var se;return[P(q((se=_.value)==null?void 0:se.accept),1)]}),_:1})),v.value?oe("",!0):(D(),E(ye,{key:1,label:"提交总数"},{default:a(()=>{var se;return[P(q((se=_.value)==null?void 0:se.attempt),1)]}),_:1})),t(ye,{label:"创建时间"},{default:a(()=>{var se;return[P(q((se=_.value)==null?void 0:se.insertTime),1)]}),_:1}),t(ye,{label:"更新时间"},{default:a(()=>{var se;return[P(q((se=_.value)==null?void 0:se.updateTime),1)]}),_:1}),t(ye,{label:"上传用户"},{default:a(()=>{var se;return[P(q((se=_.value)==null?void 0:se.creatorNickname),1)]}),_:1}),v.value?oe("",!0):(D(),E(ye,{key:2,label:"题目来源"},{default:a(()=>{var se,Ze,dt;return[(se=_.value)!=null&&se.sourceUrl?(D(),E(De,{key:0,href:(Ze=_.value)==null?void 0:Ze.sourceUrl,target:"_blank"},{default:a(()=>{var Xt;return[P(q((Xt=_.value)==null?void 0:Xt.source),1)]}),_:1},8,["href"])):(D(),le("span",Lo,q((dt=_.value)==null?void 0:dt.source),1))]}),_:1})),L.value?(D(),E(ye,{key:3,label:"是否私有"},{default:a(()=>{var se;return[P(q((se=_.value)!=null&&se.private?"私有":"公开"),1)]}),_:1})):oe("",!0),(Me=_.value)!=null&&Me.originUrl?(D(),E(ye,{key:4,label:"原题链接"},{default:a(()=>{var se;return[t(De,{href:(se=_.value)==null?void 0:se.originUrl,target:"_blank"},{default:a(()=>{var Ze,dt;return[P(q((Ze=_.value)==null?void 0:Ze.originOj)+" - "+q((dt=_.value)==null?void 0:dt.originId),1)]}),_:1},8,["href"])]}),_:1})):oe("",!0),fe(S)?(D(),E(ye,{key:5,label:"标签"},{default:a(()=>[t(W,null,{default:a(()=>{var se;return[(D(!0),le(de,null,Ie((se=_.value)==null?void 0:se.tags,Ze=>(D(),E(Ce,{key:Ze.id,variant:"dashed",onClick:()=>J(Ze)},{default:a(()=>[P(q(Ze.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})):oe("",!0)]}),_:1}),R("div",jo,[t(W,null,{default:a(()=>[t(Ce,{onClick:ne},{default:a(()=>H[5]||(H[5]=[P("提交记录")])),_:1}),t(Ce,{onClick:ae},{default:a(()=>H[6]||(H[6]=[P("题目讨论")])),_:1}),fe(S)?(D(),E(Ce,{key:0,onClick:G},{default:a(()=>H[7]||(H[7]=[P("题目推荐")])),_:1})):oe("",!0)]),_:1})]),I.value&&V.value||L.value||(Yt=_.value)!=null&&Yt.originId?(D(),le("div",$o,[t(W,null,{default:a(()=>{var Me;return[I.value&&V.value?(D(),E(Ce,{key:0,onClick:Q},{default:a(()=>H[8]||(H[8]=[P("每日一题")])),_:1})):oe("",!0),L.value?(D(),E(Ce,{key:1,onClick:ee},{default:a(()=>H[9]||(H[9]=[P("编辑")])),_:1})):oe("",!0),(Me=_.value)!=null&&Me.originId?(D(),E(Ce,{key:2,onClick:ce,loading:w.value},{default:a(()=>H[10]||(H[10]=[P("更新描述 ")])),_:1},8,["loading"])):oe("",!0)]}),_:1})])):oe("",!0),R("div",Uo,[t(W,null,{default:a(()=>[t(et,{modelValue:r.value,"onUpdate:modelValue":H[0]||(H[0]=Me=>r.value=Me),label:"语言：",placeholder:"请选择提交语言","auto-width":"",clearable:"",onChange:N},{default:a(()=>[(D(!0),le(de,null,Ie(z.value,Me=>(D(),E(Xe,{key:Me.value,value:Me.value,label:Me.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),t(Ce,{onClick:Z,loading:k.value},{default:a(()=>H[11]||(H[11]=[P("提交")])),_:1},8,["loading"])]),_:1}),R("div",zo,[R("div",{ref_key:"codeEditRef",ref:d,class:"dida-code-editor"},null,512)])])])]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),jt=ue(Ao,[["__scopeId","data-v-bf97b778"]]),Ro={style:{margin:"10px"}},Mo={key:0,class:"dida-operation-container"};function Eo(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const qo=ie({__name:"ProblemDailyList",setup(e){const l=Se(),n=We(),{globalProperties:i}=pe(),o=qe();let b=!1,f=null,S={},m={};const s=Ne(()=>o.hasAuth(ze.ManageProblem)),T=p([{title:"日期",colKey:"id",cell:(h,x)=>t(O,{variant:"dashed",onClick:()=>w(x.row.id)},{default:()=>[x.row.id]})},{title:"ID",colKey:"problemId",cell:(h,x)=>{let $=k(x.row.problemId);return t(O,{variant:"dashed",theme:$,onClick:()=>w(x.row.id)},{default:()=>[x.row.problemId]})}},{title:"标题",colKey:"title",cell:(h,x)=>t(O,{variant:"text",onClick:()=>w(x.row.id)},{default:()=>[x.row.title]})},{title:"标签",colKey:"tags",cell:(h,x)=>{const $=x.row.tags;if(!$||$.length===0)return"";let U=[];for(let L=0;L<$.length;L++){const V=$[L];U.push(t(O,{key:L,theme:"default",variant:"outline",size:"small",onClick:()=>z(V)},{default:()=>[V.name]}))}return t(we,null,Eo(U)?U:{default:()=>[U]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),v=p(!1);let I=1,g=50;const _=p({current:I,pageSize:g,defaultCurrent:I,defaultPageSize:g,total:0,pageSizeOptions:[50,100]}),c=p([]),d=p({date:[],problemId:""}),w=h=>{h&&n.push({name:"problem-daily-detail",params:{dailyId:h}})},k=h=>{if(!h||!m)return"default";const x=m[h];if(!x)return"default";switch(x){case Ke.Accept:return"success";case Ke.Attempt:return"warning";default:return"default"}},u=async()=>{let h="";d.value.date&&d.value.date.length>1&&(h=d.value.date[0]+"~"+d.value.date[1]),await n.push({query:{...l.query,date:h,problem_id:d.value.problemId,page:1,page_size:_.value.defaultPageSize}})},r=async()=>{d.value.date=[],d.value.problemId="",await n.push({query:{...l.query,date:"",problem_id:"",page:1,page_size:_.value.defaultPageSize}})},z=h=>{h&&n.push({name:"problem-list",query:{...l.query,title:"",tag:h.name,page:1,page_size:_.value.defaultPageSize}})},C=()=>{n.push({name:"manage-problem-daily-create"})},y=async(h,x)=>{v.value=!0;try{const{current:$,pageSize:U}=h;let L="";d.value.date[0]&&(L=d.value.date[0]);let V="";d.value.date[1]&&(V=d.value.date[1]);const A=await bn(L,V,d.value.problemId,$,U);if(c.value=[],A.code===0){const M=A.data.list;if(!M||M.length<=0){_.value={..._.value,total:0},m={},ke(i,"未找到记录");return}S={},A.data.tags&&A.data.tags.forEach(J=>{S[J.id]=J}),M.forEach(J=>{var ee;const Q=La(J,S);(ee=c.value)==null||ee.push(Q)}),_.value={..._.value,total:A.data.total_count},m=A.data.attempt_status}else x&&F(i,A.code)}catch($){console.error($),F(i,Fe())}finally{v.value=!1}},j=async h=>{await n.push({query:{...l.query,page:h.current,page_size:h.pageSize}})};return me(async()=>{b=!0,v.value=!0,f=Le(()=>l.query,h=>{if(!b)return;if(d.value.date=[],h.date){const U=h.date.split("~");U.length===2&&(d.value.date=[U[0],U[1]])}d.value.problemId=h.problem_id||"";const x=parseInt(h.page)||_.value.defaultCurrent,$=parseInt(h.page_size)||_.value.defaultPageSize;I=x,g=$,_.value={..._.value,current:I,pageSize:g},y({current:I,pageSize:g},!0)},{immediate:!0})}),Ve(()=>{b=!1,f&&f()}),(h,x)=>{const $=Re,U=be,L=xe,V=O,A=we,M=Ft,J=$e,Q=Ue,ee=je,ne=Pe;return D(),E(ne,null,{default:a(()=>[t(L,{span:9},{default:a(()=>[t(U,{style:{margin:"10px"}},{default:a(()=>[t($,{data:c.value,columns:T.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:_.value,"table-layout":"auto",loading:v.value,onPageChange:j},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(L,{span:3},{default:a(()=>[R("div",Ro,[s.value?(D(),le("div",Mo,[t(A,null,{default:a(()=>[t(V,{onClick:C},{default:a(()=>x[2]||(x[2]=[P("新建")])),_:1})]),_:1})])):oe("",!0),t(U,{class:"sh-card"},{default:a(()=>[t(ee,{model:d.value,onSubmit:u,onReset:r},{default:a(()=>[t(J,{label:"日期","label-align":"top"},{default:a(()=>[t(M,{modelValue:d.value.date,"onUpdate:modelValue":x[0]||(x[0]=ae=>d.value.date=ae),"allow-input":"",clearable:"",format:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(J,{label:"问题","label-align":"top"},{default:a(()=>[t(Q,{modelValue:d.value.problemId,"onUpdate:modelValue":x[1]||(x[1]=ae=>d.value.problemId=ae),placeholder:"请输入问题ID",clearable:""},null,8,["modelValue"])]),_:1}),t(J,{"label-align":"top"},{default:a(()=>[t(A,null,{default:a(()=>[t(V,{theme:"primary",type:"submit"},{default:a(()=>x[3]||(x[3]=[P("搜索")])),_:1}),t(V,{theme:"danger",type:"reset"},{default:a(()=>x[4]||(x[4]=[P("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(U,{class:"sh-card",header:"每日一题","header-bordered":!0},{default:a(()=>x[5]||(x[5]=[R("p",null,"由管理员团队精选的题目，每日0点更新。",-1),R("p",null,"当日下午6点提供题解，次日提供AC代码。",-1)])),_:1})])]),_:1})]),_:1})}}}),Ko=ue(qo,[["__scopeId","data-v-b97b04ec"]]),Fo={style:{margin:"10px"}},Oo={style:{margin:"12px"}},Go={class:"dida-edit-container"},No=ie({__name:"ProblemDailyEdit",setup(e){let l=Se();const{globalProperties:n}=pe();let i=null;const o=p(""),b=p(!1),f=p(!1),S=p(null),m=p({date:"",problemId:"",solution:"",code:""}),s=()=>{Y.push({name:"problem-daily-detail",params:{dailyId:o.value}})};async function T(d,w){f.value=!0,await vt(d,w,n,()=>Pn(o.value)),f.value=!1}const v=async()=>{f.value=!0;try{const d=m.value.date,w=await kn(d,m.value.problemId,m.value.solution,m.value.code);if(f.value=!0,w.code!==0){F(n,w.code);return}await Y.push({name:"manage-problem-daily",params:{dailyId:d}}),Ge(n,"创建成功")}finally{f.value=!1}},I=async()=>{f.value=!0;try{const d=await Sn(o.value,m.value.problemId,m.value.solution,m.value.code);if(f.value=!0,d.code!==0){F(n,d.code);return}S.value&&(d.data.update_time!=null&&(S.value.updateTime=new Date(d.data.update_time).toLocaleString()),d.data.updater_nickname!=null&&(S.value.updaterNickname=d.data.updater_nickname)),d.data.solution!=null&&(m.value.solution=d.data.solution),d.data.code!=null&&(m.value.code=d.data.code),Ge(n,"保存成功")}finally{f.value=!1}},g=d=>{m.value.solution=d,b.value=!1},_=d=>{m.value.code=d,b.value=!1},c=async()=>{const d=await _n(o.value);if(d.code!==0){F(n,d.code),console.error("problem get failed",d.code),await Y.push({name:"problem"});return}const w=d.data;S.value=La(w,{}),m.value.problemId=w.problem_id,g(w.solution),_(w.code)};return me(async()=>{i=Le(()=>l.params,async()=>{Array.isArray(l.params.dailyId)?o.value=l.params.dailyId[0]:o.value=l.params.dailyId,o.value?(b.value=!0,m.value.date=o.value,await c()):(g("暂无题解"),_("暂无标程"))},{immediate:!0})}),Ve(()=>{i&&(i(),i=null)}),(d,w)=>{const k=Ct,u=yl,r=$e,z=Ue,C=je,y=be,j=xe,h=O,x=we,$=Be,U=He,L=Pe,V=Ae("md-editor-v3"),A=Te;return D(),E(A,{loading:b.value},{default:a(()=>[t(L,null,{default:a(()=>[t(j,{span:8},{default:a(()=>[R("div",Fo,[t(k,{theme:"info"},{default:a(()=>w[4]||(w[4]=[P("可以提前配置将来日期的题目，对外仅展示到截止到当天的题目")])),_:1}),t(y,{class:"sh-form-card"},{default:a(()=>[t(C,{model:m.value},{default:a(()=>[t(r,{label:"日期"},{default:a(()=>[t(u,{modelValue:m.value.date,"onUpdate:modelValue":w[0]||(w[0]=M=>m.value.date=M),disabled:o.value&&!0},null,8,["modelValue","disabled"])]),_:1}),t(r,{label:"问题ID"},{default:a(()=>[t(z,{modelValue:m.value.problemId,"onUpdate:modelValue":w[1]||(w[1]=M=>m.value.problemId=M),placeholder:"问题标题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(j,{span:4},{default:a(()=>[R("div",Oo,[R("div",Go,[o.value?(D(),E(x,{key:0},{default:a(()=>[t(h,{onClick:I,theme:"danger",loading:f.value},{default:a(()=>w[5]||(w[5]=[P("保存")])),_:1},8,["loading"]),t(h,{onClick:s},{default:a(()=>w[6]||(w[6]=[P("查看")])),_:1})]),_:1})):(D(),E(x,{key:1},{default:a(()=>[t(h,{onClick:v,theme:"danger",loading:f.value},{default:a(()=>w[7]||(w[7]=[P("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(D(),E(U,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t($,{label:"创建时间"},{default:a(()=>{var M;return[P(q((M=S.value)==null?void 0:M.createTime),1)]}),_:1}),t($,{label:"更新时间"},{default:a(()=>{var M;return[P(q((M=S.value)==null?void 0:M.updateTime),1)]}),_:1}),t($,{label:"创建用户"},{default:a(()=>{var M;return[P(q((M=S.value)==null?void 0:M.creatorNickname),1)]}),_:1}),t($,{label:"更新用户"},{default:a(()=>{var M;return[P(q((M=S.value)==null?void 0:M.updaterNickname),1)]}),_:1})]),_:1})):oe("",!0)])]),_:1})]),_:1}),R("div",null,[w[8]||(w[8]=R("p",{style:{"margin-left":"20px"}},"题解：",-1)),t(V,{id:"daily-solution-editor",modelValue:m.value.solution,"onUpdate:modelValue":w[2]||(w[2]=M=>m.value.solution=M),onSave:I,onOnUploadImg:T,previewTheme:"cyanosis"},null,8,["modelValue"]),t(A,{loading:f.value,attach:"#daily-solution-editor","z-index":1e5},null,8,["loading"])]),R("div",null,[w[9]||(w[9]=R("p",{style:{"margin-left":"20px"}},"标程：",-1)),t(V,{id:"daily-code-editor",modelValue:m.value.code,"onUpdate:modelValue":w[3]||(w[3]=M=>m.value.code=M),onSave:I,onOnUploadImg:T,previewTheme:"cyanosis"},null,8,["modelValue"]),t(A,{loading:f.value,attach:"#daily-code-editor","z-index":1e5},null,8,["loading"])])]),_:1},8,["loading"])}}}),aa=ue(No,[["__scopeId","data-v-fe63fd0d"]]),Ho={style:{margin:"10px"}};function Bo(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const Jo=ie({__name:"ProblemRecommend",setup(e){const l=Se(),n=We(),{globalProperties:i}=pe();let o=null,b="",f={},S={};const m=p([{title:"ID",colKey:"id",cell:(c,d)=>{let w=I(d.row.id);return t(O,{variant:"dashed",theme:w,onClick:()=>v(d.row.id)},{default:()=>[d.row.id]})}},{title:"标题",colKey:"title",cell:(c,d)=>t(O,{variant:"text",onClick:()=>v(d.row.id)},{default:()=>[d.row.title]})},{title:"标签",colKey:"tags",cell:(c,d)=>{const w=d.row.tags;if(!w||w.length===0)return"";let k=[];for(let u=0;u<w.length;u++){const r=w[u];k.push(t(O,{key:u,theme:"default",variant:"outline",size:"small",onClick:()=>g(r)},{default:()=>[r.name]}))}return t(we,null,Bo(k)?k:{default:()=>[k]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),s=p(!1),T=p(),v=c=>{c&&n.push({path:"/problem/"+c})},I=c=>{if(!c||!S)return"default";const d=S[c];if(!d)return"default";switch(d){case Ke.Accept:return"success";case Ke.Attempt:return"warning";default:return"default"}},g=c=>{c&&n.push({name:"problem-list",query:{tag:c.name}})},_=async c=>{s.value=!0;try{const d=await fn(b);if(T.value=[],d.code===0){const w=d.data.list;if(!w||w.length<=0){ke(i,"暂无推荐题目");return}f={},d.data.tags&&d.data.tags.forEach(k=>{f[k.id]=k}),w.forEach(k=>{var r;const u=_t(k,f);(r=T.value)==null||r.push(u)})}else c&&F(i,d.code)}catch(d){console.error(d),F(i,Fe())}finally{s.value=!1}};return me(async()=>{s.value=!0,o=Le(()=>l.query,c=>{Array.isArray(l.params.problemId)?b=l.params.problemId[0]:b=l.params.problemId,_(!0)},{immediate:!0})}),Ve(()=>{o&&o()}),(c,d)=>{const w=Re,k=be,u=xe,r=Pe;return D(),E(r,null,{default:a(()=>[t(u,{span:9},{default:a(()=>[t(k,{style:{margin:"10px"}},{default:a(()=>[t(w,{data:T.value,columns:m.value,"row-key":"id","vertical-align":"top",hover:!0,"table-layout":"auto",loading:s.value},null,8,["data","columns","loading"])]),_:1})]),_:1}),t(u,{span:3},{default:a(()=>[R("div",Ho,[t(k,{class:"sh-card",header:"题目推荐","header-bordered":!0},{default:a(()=>d[0]||(d[0]=[P(" 根据本站其他用户的提交记录推荐类似题目"),R("br",null,null,-1),P("依据推荐算法来计算，与本用户相似度最高的用户做的题，大概率被自己感兴趣。 ")])),_:1})])]),_:1})]),_:1})}}}),Wo=ue(Jo,[["__scopeId","data-v-77972e8b"]]),Yo={style:{margin:"10px"}},Xo={key:1},Zo={style:{margin:"12px"}},Qo={class:"dida-edit-container"},es={class:"dida-description-editor"},ts=ie({__name:"ProblemEdit",setup(e){let l=Se();const{globalProperties:n}=pe(),i=Ye(),o=p(""),b=p(!1),f=p(!1),S=p(!1),m=p(null),s=p({title:"",timeLimit:0,memoryLimit:0,source:"",private:!0,tags:[],description:""}),T=p([]),v=p([]),I=Ne(()=>{const C=[],y=T.value;for(let j=0,h=y.length;j<h;j++)y[j].value&&C.push(y[j].value);return C}),g=(C,y)=>{const{trigger:j,index:h,item:x}=y;if(j==="clear"&&(T.value=[]),["tag-remove","backspace"].includes(j)&&T.value.splice(h,1),j==="enter"){for(let U=0;U<v.value.length;U++){const L=v.value[U];if(L.label===x){for(let V=0;V<T.value.length;V++)if(T.value[V].label===L.label)return;T.value.push(L);return}}const $={label:x,value:x};T.value.push($),v.value=v.value.concat($)}},_=(C,{current:y,type:j})=>{if(!y){T.value=j==="check"?v.value.slice(1):[];return}if(j==="check"){const h=v.value.find(x=>x.value===y);if(!h)return;T.value.push(h)}else T.value=T.value.filter(h=>h.value!==y)},c=()=>{Y.push({name:"problem-detail",params:{problemId:o.value}})},d=()=>{Y.push({name:"manage-problem-judge",params:{problemId:o.value}})},w=async(C,y)=>{S.value=!0,await vt(C,y,n,()=>In(o.value)),S.value=!1},k=async()=>{f.value=!0,s.value.tags=[];for(let C=0;C<T.value.length;C++){const y=T.value[C];y&&y.label&&s.value.tags.push(y.label)}try{const C=await yn(s.value.title,s.value.timeLimit,s.value.memoryLimit,s.value.source,s.value.private,s.value.tags,s.value.description);if(f.value=!0,C.code!==0){F(n,C.code);return}C.data!=null&&await Y.push({name:"problem-detail",params:{problemId:C.data}}),Ge(n,"创建成功")}finally{f.value=!1}},u=async()=>{f.value=!0,s.value.tags=[];for(let C=0;C<T.value.length;C++){const y=T.value[C];y&&y.label&&s.value.tags.push(y.label)}try{const C=await wn(o.value,s.value.title,s.value.timeLimit,s.value.memoryLimit,s.value.source,s.value.private,s.value.tags,s.value.description);if(f.value=!0,C.code!==0){F(n,C.code);return}m.value&&C.data.update_time!=null&&(m.value.updateTime=new Date(C.data.update_time).toLocaleString()),C.data.description!=null&&(s.value.description=C.data.description),Ge(n,"保存成功")}finally{f.value=!1}},r=C=>{s.value.description=C,b.value=!1},z=async()=>{const C=await ja(o.value,void 0,void 0);if(C.code!==0){F(n,C.code),console.error("problem get failed",C.code),await Y.push({name:"problem"});return}const y=C.data.problem;if(m.value=_t(y,{}),s.value.title=y.title,s.value.timeLimit=y.time_limit,s.value.memoryLimit=y.memory_limit,s.value.source=y.source,s.value.private=y.private,s.value.tags=[],T.value=[],C.data.tags)for(let h=0;h<C.data.tags.length;h++){const x=C.data.tags[h];x&&x.name&&(s.value.tags.push(x.name),T.value.push({label:x.name,value:x.id}))}i.setTitle(y.title+" - "+i.getTitle);let j=y.description;r(j)};return me(async()=>{Array.isArray(l.params.problemId)?o.value=l.params.problemId[0]:o.value=l.params.problemId,o.value?(b.value=!0,$a(-1).then(async C=>{C.code===0?(C.data.list&&C.data.list.forEach(y=>{v.value.push({label:y.name,value:y.id})}),await z()):(F(n,C.code),console.error("problem tag get failed",C.code),await Y.push({name:"problem"}))}).catch(async C=>{console.error(C),F(n,"获取数据异常"),await Y.push({name:"problem"})})):(s.value.timeLimit=1e3,s.value.memoryLimit=65536,r(""))}),(C,y)=>{const j=Ue,h=$e,x=ya,$=ft,U=kl,L=wl,V=je,A=be,M=xe,J=O,Q=we,ee=Be,ne=He,ae=Pe,G=Ae("md-editor-v3"),ce=Te;return D(),E(ce,{loading:b.value},{default:a(()=>[t(ae,null,{default:a(()=>[t(M,{span:8},{default:a(()=>[R("div",Yo,[t(A,{class:"sh-card"},{default:a(()=>[t(V,{model:s.value},{default:a(()=>[t(h,{label:"标题"},{default:a(()=>[t(j,{modelValue:s.value.title,"onUpdate:modelValue":y[0]||(y[0]=Z=>s.value.title=Z),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),t(h,{label:"时间限制"},{default:a(()=>[t(x,{modelValue:s.value.timeLimit,"onUpdate:modelValue":y[1]||(y[1]=Z=>s.value.timeLimit=Z),theme:"normal",min:0},{suffix:a(()=>y[6]||(y[6]=[R("span",null,"ms",-1)])),_:1},8,["modelValue"])]),_:1}),t(h,{label:"内存限制"},{default:a(()=>[t(x,{modelValue:s.value.memoryLimit,"onUpdate:modelValue":y[2]||(y[2]=Z=>s.value.memoryLimit=Z),theme:"normal",min:0},{suffix:a(()=>y[7]||(y[7]=[R("span",null,"KB",-1)])),_:1},8,["modelValue"])]),_:1}),t(h,{label:"来源"},{default:a(()=>[t(j,{modelValue:s.value.source,"onUpdate:modelValue":y[3]||(y[3]=Z=>s.value.source=Z),placeholder:"请输入题目来源"},null,8,["modelValue"])]),_:1}),t(h,{label:"私有"},{default:a(()=>[t($,{modelValue:s.value.private,"onUpdate:modelValue":y[4]||(y[4]=Z=>s.value.private=Z)},null,8,["modelValue"])]),_:1}),t(h,{label:"标签"},{default:a(()=>[t(L,{value:T.value,"allow-input":!0,placeholder:"请选择或输入","tag-input-props":{excessTagsDisplayType:"break-line"},"popup-props":{overlayInnerClassName:["narrow-scrollbar"],overlayInnerStyle:{maxHeight:"280px",overflowY:"auto",overscrollBehavior:"contain",padding:"6px"}},clearable:"",multiple:"",onTagChange:g},{panel:a(()=>[v.value.length?(D(),E(U,{key:0,value:I.value,options:v.value,onChange:_},null,8,["value","options"])):(D(),le("div",Xo,"暂无数据"))]),suffixIcon:a(()=>[t(fe(tl))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(M,{span:4},{default:a(()=>[R("div",Zo,[R("div",Qo,[o.value?(D(),E(Q,{key:0},{default:a(()=>[t(J,{onClick:u,theme:"danger",loading:f.value},{default:a(()=>y[8]||(y[8]=[P("保存")])),_:1},8,["loading"]),t(J,{onClick:d,theme:"warning"},{default:a(()=>y[9]||(y[9]=[P("判题数据")])),_:1}),t(J,{onClick:c},{default:a(()=>y[10]||(y[10]=[P("查看")])),_:1})]),_:1})):(D(),E(Q,{key:1},{default:a(()=>[t(J,{onClick:k,theme:"danger",loading:f.value},{default:a(()=>y[11]||(y[11]=[P("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(D(),E(ne,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(ee,{label:"创建时间"},{default:a(()=>{var Z;return[P(q((Z=m.value)==null?void 0:Z.insertTime),1)]}),_:1}),t(ee,{label:"更新时间"},{default:a(()=>{var Z;return[P(q((Z=m.value)==null?void 0:Z.updateTime),1)]}),_:1}),t(ee,{label:"判题方式"},{default:a(()=>{var Z;return[P(q((Z=m.value)==null?void 0:Z.judgeType),1)]}),_:1}),t(ee,{label:"上传用户"},{default:a(()=>{var Z;return[P(q((Z=m.value)==null?void 0:Z.creatorNickname),1)]}),_:1})]),_:1})):oe("",!0)])]),_:1})]),_:1}),R("div",es,[y[12]||(y[12]=R("p",null,"题目描述",-1)),t(ce,{loading:S.value||f.value},{default:a(()=>[t(G,{modelValue:s.value.description,"onUpdate:modelValue":y[5]||(y[5]=Z=>s.value.description=Z),onSave:u,onOnUploadImg:w,previewTheme:"cyanosis"},null,8,["modelValue"])]),_:1},8,["loading"])])]),_:1},8,["loading"])}}}),la=ue(ts,[["__scopeId","data-v-e349d9e2"]]),as={style:{margin:"10px"}},ls={style:{margin:"12px"}},ns={class:"dida-edit-container"},os=ie({__name:"ProblemJudge",setup(e){let l=Se();const{globalProperties:n}=pe(),i=Ye(),o=p(""),b=p(!1),f=p(null);let S=null;const m=p(null),s=p(""),T=p(!1),v=p(!1),I=p([{title:"文件",colKey:"file"},{title:"大小",colKey:"size",width:150,cell:(x,$)=>{let U=$.row.size,L;return U>10*1024?U>1024*1024?L=(U/(1024*1024)).toFixed(3)+" MB":L=(U/1024).toFixed(3)+" KB":L=U+" B",L}},{title:"最后修改时间",colKey:"lastModified",width:180,cell:(x,$)=>new Date($.row.lastModified).toLocaleString()},{title:"操作",colKey:"action",width:100,cell:(x,$)=>t(O,{onClick:()=>k($.row.file)},{default:()=>[P("下载")]})}]),g=p([]),_=Ne(()=>({border:"2px dashed #ccc",borderRadius:"6px",padding:"20px",textAlign:"center",cursor:"pointer",backgroundColor:T.value?"#f0f9ff":"#fff",transition:"background-color 0.2s ease"})),c=Ne(()=>s.value?`已选择：${s.value}`:T.value?"松开文件以上传":"拖拽判题数据压缩包到这里，或点击选择文件"),d=()=>{Y.push({name:"problem-detail",params:{problemId:o.value}})},w=()=>{Y.push({name:"manage-problem",params:{problemId:o.value}})},k=async x=>{const $=await Cn(o.value,x);if($.code!==0){F(n,$.code);return}const U=document.createElement("a");U.href=$.data,U.target="_blank",U.click(),URL.revokeObjectURL(U.href)},u=async()=>{if(!S){ve(n,"请选择压缩包");return}v.value=!0,xn(o.value,S).then(async x=>{x.code==0?(m.value.value=null,S=null,s.value="",b.value=!0,Ge(n,"上传成功"),await h()):F(n,x.code)}).catch(x=>{console.log(x),n.$message.error({duration:3e3,content:"申请失败"})}).finally(()=>{v.value=!1})},r=()=>{var x;(x=m.value)==null||x.click()},z=x=>{const $=x.target.files[0];$&&(s.value=$.name,S=$)},C=x=>{T.value=!0},y=()=>{T.value=!1},j=x=>{x.preventDefault(),x.stopPropagation(),T.value=!1;const $=x.dataTransfer.files[0];if($){s.value=$.name;const U=new DataTransfer;U.items.add($),m.value.files=U.files,S=$}},h=async()=>{const x=await mn(o.value);if(x.code!==0){F(n,x.code),await Y.push({name:"problem"});return}const $=x.data.problem;f.value=_t($,{}),i.setTitle($.title+" - "+i.getTitle),g.value=[],x.data.judges?x.data.judges.forEach(U=>{g.value.push({file:U.key,size:U.size,lastModified:U.last_modified})}):ve(n,"评测数据不存在"),b.value=!1};return me(async()=>{if(Array.isArray(l.params.problemId)?o.value=l.params.problemId[0]:o.value=l.params.problemId,!o.value){ve(n,"题目不存在"),await Y.push({name:"problem"});return}b.value=!0,await h()}),(x,$)=>{const U=Re,L=xe,V=O,A=we,M=Be,J=He,Q=Pe,ee=Te;return D(),E(ee,{loading:b.value},{default:a(()=>[t(Q,null,{default:a(()=>[t(L,{span:7},{default:a(()=>[R("div",as,[R("div",{id:"drop-zone",style:_a(_.value),onClick:r,onDragenter:Dt(C,["prevent"]),onDragover:$[0]||($[0]=Dt(()=>{},["prevent"])),onDragleave:Dt(y,["prevent"]),onDrop:j},[R("input",{ref_key:"fileInput",ref:m,type:"file",style:{display:"none"},onChange:z},null,544),P(" "+q(c.value),1)],36)]),t(U,{data:g.value,columns:I.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1}),t(L,{span:5},{default:a(()=>[R("div",ls,[R("div",ns,[t(A,null,{default:a(()=>[t(V,{onClick:u,theme:"danger",loading:v.value},{default:a(()=>$[1]||($[1]=[P("上传")])),_:1},8,["loading"]),t(V,{onClick:w,theme:"warning"},{default:a(()=>$[2]||($[2]=[P("编辑")])),_:1}),t(V,{onClick:d},{default:a(()=>$[3]||($[3]=[P("查看")])),_:1})]),_:1})]),t(J,{layout:"vertical",bordered:!0},{default:a(()=>[t(M,{label:"标题"},{default:a(()=>{var ne;return[P(q((ne=f.value)==null?void 0:ne.title),1)]}),_:1}),t(M,{label:"创建时间"},{default:a(()=>{var ne;return[P(q((ne=f.value)==null?void 0:ne.insertTime),1)]}),_:1}),t(M,{label:"更新时间"},{default:a(()=>{var ne;return[P(q((ne=f.value)==null?void 0:ne.updateTime),1)]}),_:1}),t(M,{label:"判题方式"},{default:a(()=>{var ne;return[P(q((ne=f.value)==null?void 0:ne.judgeType),1)]}),_:1}),t(M,{label:"评测数据"},{default:a(()=>{var ne;return[P(q((ne=f.value)==null?void 0:ne.judgeMd5),1)]}),_:1}),t(M,{label:"上传用户"},{default:a(()=>{var ne;return[P(q((ne=f.value)==null?void 0:ne.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),ss=ue(os,[["__scopeId","data-v-bd1b4a95"]]);function Jt(e){const l={};return l.id=e.id,l.ownerId=e.owner_id,l.ownerUsername=e.owner_username,l.ownerNickname=e.owner_nickname,l.title=e.title,e.start_time?l.startTime=new Date(e.start_time).toLocaleString():l.startTime="无限制",e.end_time?l.endTime=new Date(e.end_time).toLocaleString():l.endTime="无限制",e.update_time?l.updateTime=new Date(e.update_time).toLocaleString():l.updateTime="",e.create_time?l.createTime=new Date(e.create_time).toLocaleString():l.createTime="",e.description?l.description=e.description:l.description="",l.problems=e.problems,l}function rs(e){return B({url:"/collection?id="+e,method:"get"})}function is(e){return B({url:"/collection/edit?id="+e,method:"get"})}function us(e,l){return B({url:"/collection/list?page="+e+"&page_size="+l,method:"get"})}function ds(e){return B({url:"/collection/rank?id="+e,method:"get"})}function cs(e){return B({url:"/collection/create",method:"post",data:e})}function ms(e){return B({url:"/collection/edit",method:"post",data:e})}function ps(e){return B({url:"/collection/join",method:"post",data:{id:e}})}function fs(e){return B({url:"/collection/quit",method:"post",data:{id:e}})}const vs={style:{margin:"10px"}},_s=ie({__name:"CollectionList",setup(e){const l=Se(),n=We(),{globalProperties:i}=pe();let o=null;p(!1),p(!1);const b=p([{title:"ID",colKey:"id",width:"100",cell:(w,k)=>t(O,{variant:"text",onClick:()=>I(k.row.id)},{default:()=>[k.row.id]})},{title:"标题",colKey:"title",cell:(w,k)=>t(O,{variant:"text",onClick:()=>I(k.row.id)},{default:()=>[k.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),f=p(!1);let S=1,m=50;const s=p({current:S,pageSize:m,defaultCurrent:S,defaultPageSize:m,total:0,pageSizeOptions:[50,100]}),T=p(),v=p({title:"",username:""});p({title:"",description:"",open_time:[]});const I=w=>{w&&n.push({path:"/collection/"+w})},g=async()=>{await n.push({query:{...l.query,title:v.value.title,username:v.value.username,page:1,page_size:s.value.defaultPageSize}})},_=async(w,k)=>{var u;f.value=!0;try{const{current:r,pageSize:z}=w,C=await us(r,z);if(T.value=[],C.code===0){const y=C.data.list;for(let j=0;j<y.length;j++){const h=y[j],x=Jt(h);(u=T.value)==null||u.push(x)}s.value={...s.value,total:C.data.total_count}}else k&&F(i,C.code)}catch(r){console.error(r),F(i,Fe())}finally{f.value=!1}},c=async w=>{await n.push({query:{...l.query,page:w.current,page_size:w.pageSize}})},d=async()=>{await n.push({name:"collection-create"})};return me(async()=>{o=Le(()=>l.query,w=>{v.value.title=w.title||"",v.value.username=w.username||"";const k=parseInt(w.page)||s.value.defaultCurrent,u=parseInt(w.page_size)||s.value.defaultPageSize;S=k,m=u,s.value={...s.value,current:S,pageSize:m},_({current:S,pageSize:m},!0)},{immediate:!0})}),Ve(()=>{o&&o()}),(w,k)=>{const u=Re,r=be,z=xe,C=Ue,y=$e,j=O,h=je,x=we,$=Pe;return D(),E($,null,{default:a(()=>[t(z,{span:9},{default:a(()=>[t(r,{style:{margin:"10px"}},{default:a(()=>[t(u,{data:T.value,columns:b.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:s.value,loading:f.value,onPageChange:c},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(z,{span:3},{default:a(()=>[R("div",vs,[t(r,{class:"sh-card"},{default:a(()=>[t(h,{model:v.value},{default:a(()=>[t(y,{label:"标题"},{default:a(()=>[t(C,{modelValue:v.value.title,"onUpdate:modelValue":k[0]||(k[0]=U=>v.value.title=U),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(y,{label:"负责人"},{default:a(()=>[t(C,{modelValue:v.value.username,"onUpdate:modelValue":k[1]||(k[1]=U=>v.value.username=U),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(y,null,{default:a(()=>[t(j,{theme:"primary",onClick:g},{default:a(()=>k[2]||(k[2]=[P("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(r,{class:"sh-card"},{default:a(()=>[t(x,null,{default:a(()=>[t(j,{onClick:d},{default:a(()=>k[3]||(k[3]=[P("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),gs=ue(_s,[["__scopeId","data-v-cffb6215"]]),bs={style:{margin:"20px"}},hs={class:"dida-operation-container"},ys={style:{margin:"12px"}},ws=ie({__name:"CollectionDetail",setup(e){let l=Se();const{globalProperties:n}=pe(),i=Ye(),o=qe();let b=0;const f=p(!1),S=p(null),m=p(!1),s=p(!1);let T={};const v=Ne(()=>o.hasAuth(ze.ManageCollection)||S.value&&o.getUserId==S.value.ownerId),I=k=>{if(!k||!T)return"default";const u=T[k];if(!u)return"default";switch(u){case Ke.Accept:return"success";case Ke.Attempt:return"warning";default:return"default"}},g=p([{title:"问题ID",colKey:"id",cell:(k,u)=>{const r=I(u.row.id);return t(O,{variant:"dashed",theme:r,onClick:()=>ea(u.row.id)},{default:()=>[u.row.id]})}},{title:"标题",colKey:"title",cell:(k,u)=>t(O,{variant:"text",onClick:()=>ea(u.row.id)},{default:()=>[u.row.title]})},{title:"正确",colKey:"accept",cell:(k,u)=>u.row.accept?u.row.accept:0},{title:"提交",colKey:"attempt",cell:(k,u)=>u.row.attempt?u.row.attempt:0}]),_=p([]),c=async()=>{if(!o.isLogin()){await Y.push({name:"login"});return}s.value=!0;try{const k=await ps(b);if(k.code!==0){F(n,k.code);return}m.value=!0,Ge(n,"加入成功")}finally{s.value=!1}},d=async()=>{if(!o.isLogin()){await Y.push({name:"login"});return}s.value=!0;try{const k=await fs(b);if(k.code!==0){F(n,k.code);return}m.value=!1,Ge(n,"退出成功")}finally{s.value=!1}},w=()=>{S.value&&Y.push({name:"collection-edit",params:{collectionId:S.value.id}})};return me(async()=>{if(Array.isArray(l.params.collectionId)?b=Number(l.params.collectionId[0]):b=Number(l.params.collectionId),!b){await Y.push({name:"problem-collection-list"});return}m.value=!1,f.value=!0;const k=await rs(b);if(k.code!==0){f.value=!1,F(n,k.code),await Y.push({name:"problem-collection-list"});return}m.value=k.data.joined,T=k.data.attempt_status||{},S.value=Jt(k.data.collection),_.value=[],k.data.collection.problems&&k.data.collection.problems.forEach(u=>{const r=k.data.problems.find(z=>z.id===u);_.value.push(r)}),i.setTitle(S.value.title+" - "+i.getTitle),f.value=!1}),(k,u)=>{const r=ka,z=wa,C=Re,y=be,j=xe,h=O,x=we,$=Be,U=He,L=Ae("md-preview"),V=Pe,A=Te;return D(),E(A,{loading:f.value},{default:a(()=>[t(V,{class:"dida-main-content"},{default:a(()=>[t(j,{span:6},{default:a(()=>[R("div",bs,[t(z,{"max-item-width":"300"},{default:a(()=>[t(r,{to:{name:"problem-collection-list"}},{default:a(()=>u[0]||(u[0]=[P("题目集合")])),_:1}),t(r,null,{default:a(()=>{var M;return[P(q((M=S.value)==null?void 0:M.title),1)]}),_:1})]),_:1})]),t(y,{style:{margin:"10px"}},{default:a(()=>[t(C,{data:_.value,columns:g.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),_:1})]),_:1}),t(j,{span:6},{default:a(()=>{var M;return[R("div",hs,[t(x,null,{default:a(()=>[m.value?(D(),E(h,{key:0,onClick:d,loading:s.value},{default:a(()=>u[1]||(u[1]=[P("退出")])),_:1},8,["loading"])):(D(),E(h,{key:1,onClick:c,loading:s.value},{default:a(()=>u[2]||(u[2]=[P("加入")])),_:1},8,["loading"])),v.value?(D(),E(h,{key:2,onClick:w},{default:a(()=>u[3]||(u[3]=[P("编辑")])),_:1})):oe("",!0)]),_:1})]),R("div",ys,[t(U,{layout:"vertical",bordered:!0},{default:a(()=>[t($,{label:"创建者"},{default:a(()=>{var J;return[P(q((J=S.value)==null?void 0:J.ownerNickname),1)]}),_:1})]),_:1}),t(U,{layout:"vertical",bordered:!0},{default:a(()=>[t($,{label:"开始时间"},{default:a(()=>{var J;return[P(q((J=S.value)==null?void 0:J.startTime),1)]}),_:1})]),_:1}),t(U,{layout:"vertical",bordered:!0},{default:a(()=>[t($,{label:"结束时间"},{default:a(()=>{var J;return[P(q((J=S.value)==null?void 0:J.endTime),1)]}),_:1})]),_:1})]),(M=S.value)!=null&&M.description?(D(),E(y,{key:0,style:{margin:"10px"}},{default:a(()=>{var J;return[t(L,{"model-value":(J=S.value)==null?void 0:J.description},null,8,["model-value"])]}),_:1})):oe("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),ks=ue(ws,[["__scopeId","data-v-042bd4bb"]]),Ss=ie({__name:"CollectionRank",setup(e){const l=Se(),n=We(),{globalProperties:i}=pe();let o=null,b=0,f=0;const S=p([{title:"Rank",colKey:"rank",align:"center"},{title:"序号",colKey:"index",align:"center"},{title:"Username",colKey:"username",cell:(I,g)=>t(O,{variant:"text",onClick:()=>n.push({name:"user",params:{username:g.row.username}})},{default:()=>[g.row.username]})},{title:"昵称",colKey:"nickname",cell:(I,g)=>t(O,{variant:"text",onClick:()=>n.push({name:"user",params:{username:g.row.username}})},{default:()=>[g.row.nickname]})},{title:"Count",colKey:"count",cell:(I,g)=>t(O,{variant:"text",onClick:()=>n.push({name:"judge-list",query:{username:g.row.username,status:Oe.Accept}})},{default:()=>[`${g.row.accept} / ${f}`]})},{title:"Progress",colKey:"progress",cell:(I,g)=>{let _=100;return f>0&&(_=Number((g.row.accept/f*100).toFixed(2))),t(qt,{percentage:_},null)}}]),m=p(!1),s=p([]),T=({col:I,rowIndex:g})=>{let _=1;for(let c=g+1;c<s.value.length&&s.value[c].rank===s.value[g].rank;c++)_++;if(I.colKey==="rank")return{rowspan:_}},v=async I=>{m.value=!0;try{const g=await ds(b);if(s.value=[],g.code===0){f=g.data.problem;const _=g.data.ranks,c=[];if(_){for(let k=0;k<_.length;k++){const u=_[k];let r={userId:u.author_id,username:u.author_username,nickname:u.author_nickname};r.accept=u.accept,c.push(r)}c.sort((k,u)=>k.accept!==u.accept?u.accept-k.accept:k.userId-u.userId);let d=0,w=-1;for(let k=0;k<c.length;k++)c[k].accept!==w&&(d=k+1,w=c[k].accept),c[k].index=k+1,c[k].rank=d}s.value=c}else I&&F(i,g.code)}catch(g){console.error(g),F(i,Fe())}finally{m.value=!1}};return me(async()=>{o=Le(()=>l.query,async()=>{if(Array.isArray(l.params.collectionId)?b=Number(l.params.collectionId[0]):b=Number(l.params.collectionId),!b){await n.push({name:"problem-collection-list"});return}await v(!0)},{immediate:!0})}),Ve(()=>{o&&o()}),(I,g)=>{const _=Re,c=be,d=Pe;return D(),E(d,null,{default:a(()=>[t(c,{style:{margin:"10px"}},{default:a(()=>[R("div",null,[t(_,{data:s.value,columns:S.value,"row-key":"index","rowspan-and-colspan":T,"vertical-align":"middle",bordered:!0,hover:!0,loading:m.value},null,8,["data","columns","loading"])])]),_:1})]),_:1})}}});var Ee=(e=>(e[e.Valid=0]="Valid",e[e.Duplicate=1]="Duplicate",e[e.Invalid=2]="Invalid",e))(Ee||{});const Cs={class:"dida-form-border"},Is={style:{"text-align":"right"}},Ps=ie({name:"ParseProblemList",__name:"ParseProblemList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:l}=pe(),n=p(!1),i=p(!1),o=p(""),b=ga(e,"modelValue");let f=[];Le(b,async I=>{JSON.stringify(I)!==JSON.stringify(f)&&(await s(I),f=b.value)},{deep:!0});const S=p([]),m=p([{title:"有效性",colKey:"validType",cell:(I,g)=>{switch(g.row.valid){case Ee.Valid:return t(tt,{theme:"success"},{default:()=>[P("有效")]});case Ee.Duplicate:return t(tt,{theme:"warning"},{default:()=>[P("重复")]});case Ee.Invalid:return t(tt,{theme:"danger"},{default:()=>[P("无效")]});default:return null}}},{title:"问题ID",colKey:"id"},{title:"标题",colKey:"title"}]),s=async I=>{const g=Array.from(new Set(I)),_=await Tn(g);if(_.code!==0){F(l,_.code),i.value=!1;return}const c=[],d=_.data.problems;let w=[];I.forEach(k=>{const u=d.find(r=>r.id===k);if(u){const r=c.find(z=>z.id===k);u.valid=r?Ee.Duplicate:Ee.Valid,c.push({id:k,title:u.title,valid:u.valid}),r||w.push(k)}else c.push({id:k,title:"-",valid:Ee.Invalid})}),S.value=c,f=w,b.value=w},T=async()=>{i.value=!0;const I=Ia(o.value);await s(I),n.value=!1,i.value=!1},v=()=>{S.value?o.value=S.value.map(I=>I.id).join(`
`):o.value="",n.value=!0};return(I,g)=>{const _=O,c=Re,d=It,w=nt;return D(),le(de,null,[R("div",Cs,[R("div",Is,[t(_,{onClick:v},{default:a(()=>g[2]||(g[2]=[P("编辑")])),_:1})]),t(c,{data:S.value,columns:m.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(w,{visible:n.value,"onUpdate:visible":g[1]||(g[1]=k=>n.value=k),onConfirm:T,header:"请输入问题ID","confirm-loading":i.value},{default:a(()=>[g[3]||(g[3]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(d,{modelValue:o.value,"onUpdate:modelValue":g[0]||(g[0]=k=>o.value=k),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Ra=ue(Ps,[["__scopeId","data-v-b0352688"]]),xs={class:"dida-form-border"},Ts={style:{"text-align":"right"}},Vs=ie({name:"ParseUserList",__name:"ParseUserList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:l}=pe(),n=p(!1),i=p(!1),o=p(""),b=ga(e,"modelValue");let f=[];Le(b,async _=>{JSON.stringify(_)!==JSON.stringify(f)&&(f=_,await T(_))},{deep:!0});const S=p(),m=p([{title:"有效性",colKey:"validType",cell:(_,c)=>{switch(c.row.valid){case Ee.Valid:return t(tt,{theme:"success"},{default:()=>[P("有效")]});case Ee.Duplicate:return t(tt,{theme:"warning"},{default:()=>[P("重复")]});case Ee.Invalid:return t(tt,{theme:"danger"},{default:()=>[P("无效")]})}}},{title:"Username",colKey:"username"},{title:"昵称",colKey:"nickname"}]),s=(_,c)=>{if(_.code!==0){F(l,_.code),i.value=!1;return}const d=[],w=_.data.users;let k=[];c?c.forEach(u=>{let r=null;if(w&&(r=w.find(z=>z.username.toLowerCase()===u.toLowerCase())),r){const z=d.find(y=>y.username.toLowerCase()===u.toLowerCase()),C=z?Ee.Duplicate:Ee.Valid;d.push({id:r.id,username:r.username,nickname:r.nickname,valid:C}),z||k.push(r.id)}else d.push({id:-1,username:u,nickname:"-",valid:Ee.Invalid})}):w&&w.forEach(u=>{const r=d.find(C=>C.id===u.id),z=r?Ee.Duplicate:Ee.Valid;d.push({id:u.id,username:u.username,nickname:u.nickname,valid:z}),r||k.push(u.id)}),S.value=d,f=k,b.value=k},T=async _=>{const c=Array.from(new Set(_)),d=await qn(c);s(d)},v=async _=>{const c=Array.from(new Set(_)),d=await Kn(c);s(d,_)},I=async()=>{i.value=!0;const _=Ia(o.value);await v(_),n.value=!1,i.value=!1},g=()=>{S.value?o.value=S.value.map(_=>_.username).join(`
`):o.value="",n.value=!0};return(_,c)=>{const d=O,w=Re,k=It,u=nt;return D(),le(de,null,[R("div",xs,[R("div",Ts,[t(d,{onClick:g},{default:a(()=>c[2]||(c[2]=[P("编辑")])),_:1})]),t(w,{data:S.value,columns:m.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(u,{visible:n.value,"onUpdate:visible":c[1]||(c[1]=r=>n.value=r),onConfirm:I,header:"请输入用户Username","confirm-loading":i.value},{default:a(()=>[c[3]||(c[3]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(k,{modelValue:o.value,"onUpdate:modelValue":c[0]||(c[0]=r=>o.value=r),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Ma=ue(Vs,[["__scopeId","data-v-b0b99852"]]),Ds={style:{margin:"10px"}},Ls={style:{margin:"12px"}},js={class:"dida-edit-container"},$s=ie({__name:"CollectionEdit",setup(e){let l=Se();const{globalProperties:n}=pe(),i=Ye(),o=p(""),b=p(!1),f=p(!1),S=p(!1),m=p(null),s=p({title:"",openTime:[],private:!0,problems:[],members:[],description:""}),T=p(""),v=p(""),I=p(!1),g=async()=>{I.value=!0,S.value=!1,I.value=!1},_=async()=>{f.value=!0;try{const u={title:s.value.title,problems:s.value.problems,members:s.value.members,private:s.value.private,description:s.value.description};s.value.openTime[0]&&(u.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(u.end_time=new Date(s.value.openTime[1]));const r=await cs(u);if(r.code!==0){F(n,r.code);return}r.data!=null&&await Y.push({name:"collection-detail",params:{collectionId:r.data}}),Ge(n,"创建成功")}finally{f.value=!1}},c=async()=>{f.value=!0;try{const u={id:Number(o.value),title:s.value.title,private:s.value.private,problems:s.value.problems,members:s.value.members,description:s.value.description};s.value.openTime[0]&&(u.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(u.end_time=new Date(s.value.openTime[1]));const r=await ms(u);if(r.code!==0){F(n,r.code);return}r.data!=null&&m.value&&(m.value.updateTime=new Date(r.data).toLocaleString()),Ge(n,"保存成功")}finally{f.value=!1}},d=u=>{s.value.description=u,b.value=!1};async function w(u,r){f.value=!0,ve(n,"本界面暂不支持上传图片"),f.value=!1}const k=async()=>{const u=await is(o.value);if(u.code!==0){F(n,u.code),console.error("collection get failed",u.code),await Y.push({name:"problem-collection-list"});return}const r=u.data.collection;m.value=Jt(r),s.value.title=r.title,s.value.openTime=[],r.start_time?s.value.openTime.push(new Date(r.start_time)):s.value.openTime.push(""),r.end_time?s.value.openTime.push(new Date(r.end_time)):s.value.openTime.push(""),s.value.private=r.private,s.value.description=r.description,s.value.problems=r.problems,s.value.members=r.members,i.setTitle(r.title+" - "+i.getTitle);let z="";r.description&&(z=r.description),d(z)};return me(async()=>{Array.isArray(l.params.collectionId)?o.value=l.params.collectionId[0]:o.value=l.params.collectionId,o.value?(b.value=!0,await k()):d("")}),(u,r)=>{const z=Ue,C=$e,y=Ft,j=ft,h=je,x=be,$=xe,U=O,L=we,V=Be,A=He,M=Pe,J=Ae("md-editor-v3"),Q=Te,ee=It,ne=nt;return D(),le(de,null,[t(Q,{loading:b.value},{default:a(()=>[t(M,null,{default:a(()=>[t($,{span:8},{default:a(()=>[R("div",Ds,[t(x,{class:"sh-card"},{default:a(()=>[t(h,{model:s.value},{default:a(()=>[t(C,{label:"标题"},{default:a(()=>[t(z,{modelValue:s.value.title,"onUpdate:modelValue":r[0]||(r[0]=ae=>s.value.title=ae),placeholder:"题集标题"},null,8,["modelValue"])]),_:1}),t(C,{label:"开启时间"},{default:a(()=>[t(y,{modelValue:s.value.openTime,"onUpdate:modelValue":r[1]||(r[1]=ae=>s.value.openTime=ae),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(C,{label:"私有"},{default:a(()=>[t(j,{modelValue:s.value.private,"onUpdate:modelValue":r[2]||(r[2]=ae=>s.value.private=ae)},null,8,["modelValue"])]),_:1}),t(C,{label:"成员"},{default:a(()=>[t(Ma,{modelValue:s.value.members,"onUpdate:modelValue":r[3]||(r[3]=ae=>s.value.members=ae)},null,8,["modelValue"])]),_:1}),t(C,{label:"问题"},{default:a(()=>[t(Ra,{modelValue:s.value.problems,"onUpdate:modelValue":r[4]||(r[4]=ae=>s.value.problems=ae)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t($,{span:4},{default:a(()=>[R("div",Ls,[R("div",js,[o.value?(D(),E(L,{key:0},{default:a(()=>[t(U,{onClick:c,theme:"danger",loading:f.value},{default:a(()=>r[8]||(r[8]=[P("保存")])),_:1},8,["loading"])]),_:1})):(D(),E(L,{key:1},{default:a(()=>[t(U,{onClick:_,theme:"danger",loading:f.value},{default:a(()=>r[9]||(r[9]=[P("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(D(),E(A,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(V,{label:"创建时间"},{default:a(()=>{var ae;return[P(q((ae=m.value)==null?void 0:ae.createTime),1)]}),_:1}),t(V,{label:"更新时间"},{default:a(()=>{var ae;return[P(q((ae=m.value)==null?void 0:ae.updateTime),1)]}),_:1}),t(V,{label:"创建用户"},{default:a(()=>{var ae;return[P(q((ae=m.value)==null?void 0:ae.ownerNickname),1)]}),_:1})]),_:1})):oe("",!0)])]),_:1})]),_:1}),t(J,{id:"collection-description-editor",modelValue:s.value.description,"onUpdate:modelValue":r[5]||(r[5]=ae=>s.value.description=ae),onSave:c,onOnUploadImg:w,previewTheme:"cyanosis",class:"dida-description-editor"},null,8,["modelValue"]),t(Q,{loading:f.value,attach:"#collection-description-editor","z-index":1e5},null,8,["loading"])]),_:1},8,["loading"]),t(ne,{visible:S.value,"onUpdate:visible":r[7]||(r[7]=ae=>S.value=ae),onConfirm:g,header:T.value,"confirm-loading":I.value},{default:a(()=>[r[10]||(r[10]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(ee,{modelValue:v.value,"onUpdate:modelValue":r[6]||(r[6]=ae=>v.value=ae),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),na=ue($s,[["__scopeId","data-v-79ccaf8c"]]);function oa(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const Us=ie({__name:"JudgeJobList",setup(e){const l=Se(),n=We(),{globalProperties:i}=pe();let o=!1,b=null,f;const S=p(!1),m=p(null),s=p(!1);let T=-1;const v=p({problemId:"",username:"",language:void 0,status:void 0}),I=p([{title:"ID",colKey:"id",cell:(L,V)=>{let A=null;return wt(V.row.status)&&yt(V.row.language)&&(A=()=>{y(V.row.id)}),t(O,{variant:"text",onClick:A},{default:()=>[V.row.id]})}},{title:"问题",colKey:"problemId",cell:(L,V)=>{if(T){let A;return t(O,{variant:"text",onClick:()=>C(T,V.row.contestProblemIndex)},oa(A=at(V.row.contestProblemIndex))?A:{default:()=>[A]})}return t(O,{variant:"text",onClick:()=>z(V.row.problemId)},{default:()=>[V.row.problemId]})}},{title:"状态",colKey:"status",align:"center",cell:(L,V)=>{let A=null;wt(V.row.status)&&yt(V.row.language)&&(A=()=>{y(V.row.id)});const M=V.row.status,J=St(M);let Q=!wt(M);const ee=Ta(M);let ne=[];return it(M)&&ne.push(t(Te,{text:V.row.state,size:"small",class:"dida-status-loading"},null)),ne.push(t("span",null,[J])),t(O,{theme:ee,variant:"outline",onClick:A,disabled:Q},oa(ne)?ne:{default:()=>[ne]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"code",cell:(L,V)=>{let A=!yt(V.row.language);return t(O,{theme:"default",onClick:()=>r(V.row),disabled:A},{default:()=>[kt(V.row.language)+" / "+V.row.codeLength]})}},{title:"作者",colKey:"author",width:200,cell:(L,V)=>t(O,{variant:"text",onClick:()=>j(V.row.authorUsername)},{default:()=>[V.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),g=p(!1);let _=1,c=50;const d=p({current:_,pageSize:c,defaultCurrent:_,defaultPageSize:c,total:0,pageSizeOptions:[50,100]}),w=p(),k=p([]);k.value=Ot();const u=p([]);u.value=Va();const r=async L=>{s.value=!0,S.value=!0;try{m.value=L;const V=await nn(Number(m.value.id));if(V.code===0){const A=V.data,M=Gt(A.language);m.value.code=`\`\`\`${M}
${A.code}
\`\`\``}else F(i,V.code)}finally{s.value=!1}},z=L=>{L&&n.push({path:"/problem/"+L})},C=(L,V)=>{n.push({name:"contest-problem-detail",params:{contestId:L,problemIndex:V}})},y=L=>{L&&(T>0?n.push({name:"contest-judge-detail",params:{contestId:T,judgeId:L}}):n.push({name:"judge-detail",params:{judgeId:L}}))},j=L=>{L&&n.push({path:"/user/"+L})},h=async()=>{await n.push({query:{...l.query,page:1,page_size:c,problem_id:v.value.problemId,username:v.value.username,language:v.value.language,status:v.value.status}})},x=async()=>{v.value.problemId="",v.value.username="",v.value.language=void 0,v.value.status=void 0,await n.push({query:{...l.query,page:1,page_size:c,problem_id:"",username:"",language:void 0,status:void 0}})},$=async(L,V)=>{V&&(g.value=!0);let A=!1;try{const{current:M,pageSize:J}=L,Q=await on(T,v.value.problemId,v.value.username,v.value.language,v.value.status,M,J);if(w.value=[],Q.code===0){if(!Q.data.has_auth){ke(i,"您目前没有权限查看评测记录"),T?await n.push({name:"contest-detail",params:{contestId:T}}):await n.push({name:"judge-list"});return}Q.data.list&&Q.data.list.length>0?(Q.data.list.forEach(ne=>{var G;const ae=Da(ne);(G=w.value)==null||G.push(ae),it(ne.status)&&(A=!0)}),d.value={...d.value,total:Q.data.total_count}):(ke(i,"未找到记录"),d.value={...d.value,total:0})}else V&&F(i,Q.code)}catch(M){console.error(M),V&&F(i,Fe())}finally{V&&(g.value=!1),A&&o&&(f=setTimeout(()=>{$({current:_,pageSize:c},!1)},5e3))}},U=async L=>{await n.push({query:{...l.query,page:L.current,page_size:L.pageSize}})};return me(async()=>{o=!0,b=Le(()=>l.query,L=>{Array.isArray(l.params.contestId)?T=Number(l.params.contestId[0]):T=Number(l.params.contestId),v.value.problemId=L.problem_id||"",v.value.username=L.username||"",L.language!=null?v.value.language=Number(L.language):v.value.language=void 0,L.status!=null?v.value.status=Number(L.status):v.value.status=void 0;const V=parseInt(L.page)||d.value.defaultCurrent,A=parseInt(L.page_size)||d.value.defaultPageSize;_=V,c=A,d.value.pageSizeOptions.includes(c)||(c=d.value.defaultPageSize),d.value={...d.value,current:_,pageSize:c},$({current:_,pageSize:c},!0)},{immediate:!0})}),Ve(()=>{o=!1,b&&b(),clearTimeout(f)}),(L,V)=>{const A=Ue,M=$e,J=Kt,Q=pt,ee=O,ne=we,ae=je,G=Re,ce=be,Z=lt,N=Ae("md-preview"),X=Te,te=nt;return D(),le(de,null,[t(ce,{style:{margin:"10px"}},{default:a(()=>[t(ae,{layout:"inline",onSubmit:h,onReset:x},{default:a(()=>[t(M,{label:"题号"},{default:a(()=>[t(A,{modelValue:v.value.problemId,"onUpdate:modelValue":V[0]||(V[0]=K=>v.value.problemId=K),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(M,{label:"用户"},{default:a(()=>[t(A,{modelValue:v.value.username,"onUpdate:modelValue":V[1]||(V[1]=K=>v.value.username=K),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(M,{label:"语言"},{default:a(()=>[t(Q,{modelValue:v.value.language,"onUpdate:modelValue":V[2]||(V[2]=K=>v.value.language=K),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:a(()=>[(D(!0),le(de,null,Ie(k.value,K=>(D(),E(J,{key:K.value,value:K.value,label:K.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(M,{label:"状态"},{default:a(()=>[t(Q,{modelValue:v.value.status,"onUpdate:modelValue":V[3]||(V[3]=K=>v.value.status=K),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:a(()=>[(D(!0),le(de,null,Ie(u.value,K=>(D(),E(J,{key:K.value,value:K.value,label:K.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(M,null,{default:a(()=>[t(ne,null,{default:a(()=>[t(ee,{theme:"primary",type:"submit"},{default:a(()=>V[7]||(V[7]=[P("搜索")])),_:1}),t(ee,{theme:"default",variant:"base",type:"reset"},{default:a(()=>V[8]||(V[8]=[P("重置")])),_:1})]),_:1})]),_:1})]),_:1}),t(G,{data:w.value,columns:I.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:d.value,loading:g.value,onPageChange:U,"table-layout":"auto"},null,8,["data","columns","pagination","loading"])]),_:1}),t(te,{visible:S.value,"onUpdate:visible":V[5]||(V[5]=K=>S.value=K),width:"800px","cancel-btn":null,"close-btn":!1,onConfirm:V[6]||(V[6]=K=>S.value=!1)},{header:a(()=>[t(Z,{onClick:V[4]||(V[4]=()=>{var K;y((K=m.value)==null?void 0:K.id)})},{default:a(()=>{var K,H,re;return[P(q(((K=m.value)==null?void 0:K.id)+" - "+fe(kt)((H=m.value)!=null&&H.language?(re=m.value)==null?void 0:re.language:fe(Tt).Unknown)),1)]}),_:1})]),default:a(()=>[t(X,{loading:s.value},{default:a(()=>{var K;return[t(N,{"model-value":(K=m.value)==null?void 0:K.code,"code-foldable":!1,style:{"min-height":"100px"}},null,8,["model-value"])]}),_:1},8,["loading"])]),_:1},8,["visible"])],64)}}}),sa=ue(Us,[["__scopeId","data-v-05589c5c"]]),zs={class:"dida-code-container"},As={key:2,class:"dida-edit-container"};function ra(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const Rs=ie({__name:"JudgeJobDetail",setup(e){const l=Se(),n=We(),i=qe(),{globalProperties:o}=pe();let b=!1,f,S=0,m=0;const s=p(""),T=p(null),v=p(""),I=p(0),g=p(null),_=p({from:"#5a96ff",to:"#00A870"}),c=p([{title:"ID",colKey:"id"},{title:"问题",colKey:"problemId",cell:(h,x)=>t(O,{variant:"text",onClick:()=>z(x.row.problemId)},{default:()=>[x.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(h,x)=>{const $=x.row.status,U=St($),L=Ta($);let V=[];return it($)&&V.push(t(Te,{text:x.row.state,size:"small",class:"dida-status-loading"},null)),V.push(t("span",null,[U])),t(O,{theme:L,variant:"outline"},ra(V)?V:{default:()=>[V]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"language",cell:(h,x)=>t("span",null,[kt(x.row.language)+" / "+x.row.codeLength])},{title:"作者",colKey:"author",width:200,cell:(h,x)=>t(O,{variant:"text",onClick:()=>C(x.row.authorUsername)},{default:()=>[x.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),d=p(!1),w=p(!1),k=p(),u=Ne(()=>i.hasAuth(ze.ManageJudge)),r=async()=>{if(!w.value){w.value=!0;try{const h=await cn(S);h.code===0?await j(!0):F(o,h.code)}catch(h){console.error(h),F(o,Fe())}finally{w.value=!1}}},z=h=>{h&&n.push({path:"/problem/"+h})},C=h=>{h&&n.push({path:"/user/"+h})},y=h=>{const x=h.status,$=St(x);let U;switch(x){case Oe.Init:case Oe.Rejudge:case Oe.Compiling:case Oe.Running:U="default";break;case Oe.Accept:U="success";break;case Oe.PE:U="warning";break;default:U="danger";break}return t(we,null,{default:()=>[t(O,{theme:"default",variant:"outline"},{default:()=>[h.taskId]}),t(O,{theme:U,variant:"outline"},ra($)?$:{default:()=>[$]}),t("span",null,[P("分数："),h.score]),t("span",null,[P("用时："),h.time]),t("span",null,[P("内存："),h.memory])]})},j=async h=>{var $;h&&(d.value=!0);let x=!1;try{const U=await ln(S);if(k.value=[],U.code===0){const L=U.data,V=Da(L);if(($=k.value)==null||$.push(V),s.value=V.judgerName,_.value.to="#00A870",it(L.status)?(g.value="active",V.taskTotal>0?(I.value=Number((V.taskCurrent/V.taskTotal*100).toFixed(2)),V.taskCurrent>=V.taskTotal&&(I.value=99)):I.value=0):(I.value=100,L.status===Oe.Accept?g.value="success":L.status===Oe.PE?(_.value.to="#F57C20",g.value="warning"):(_.value.to="#F56C6C",g.value="error")),L.code){const A=Gt(L.language);v.value=`\`\`\`${A}
${L.code}
\`\`\``}T.value=V,it(L.status)&&(x=!0)}else h&&F(o,U.code),m?await n.push({name:"contest-judge",params:{contestId:m}}):await n.push({name:"judge-list"})}catch(U){console.error(U),h&&F(o,Fe())}finally{h&&(d.value=!1),x&&b&&(f=setTimeout(()=>{j(!1)},5e3))}};return me(async()=>{if(b=!0,Array.isArray(l.params.judgeId)?S=Number(l.params.judgeId[0]):S=Number(l.params.judgeId),Array.isArray(l.params.contestId)?m=Number(l.params.contestId[0]):m=Number(l.params.contestId),!S){await n.push({name:"judge"});return}await j(!0)}),Ve(()=>{b=!1,clearTimeout(f)}),(h,x)=>{var G,ce,Z;const $=qt,U=Re,L=be,V=Ae("md-preview"),A=xe,M=Be,J=He,Q=Pe,ee=Sl,ne=Cl,ae=O;return D(),le(de,null,[t($,{color:_.value,status:g.value,class:"dida-job-progress",percentage:I.value},null,8,["color","status","percentage"]),t(L,{style:{margin:"10px"}},{default:a(()=>[t(U,{data:k.value,columns:c.value,"row-key":"id","vertical-align":"top",hover:!0,loading:d.value},null,8,["data","columns","loading"])]),_:1}),t(Q,null,{default:a(()=>[t(A,{span:8},{default:a(()=>[R("div",zs,[t(V,{"model-value":v.value,class:"dida-code-div"},null,8,["model-value"])])]),_:1}),t(A,{span:4},{default:a(()=>[t(J,{layout:"vertical",bordered:!0,style:{margin:"20px"}},{default:a(()=>[t(M,{label:"判题机"},{default:a(()=>[P(q(s.value),1)]),_:1}),t(M,{label:"判题时间"},{default:a(()=>{var N;return[P(q((N=T.value)==null?void 0:N.judgeTime),1)]}),_:1})]),_:1})]),_:1})]),_:1}),(G=T.value)!=null&&G.compileMessage?(D(),E(L,{key:0,class:"compile-message"},{default:a(()=>{var N;return[P(q((N=T.value)==null?void 0:N.compileMessage),1)]}),_:1})):oe("",!0),(ce=T.value)!=null&&ce.task&&((Z=T.value)==null?void 0:Z.task.length)>0?(D(),E(ne,{key:1,class:"task-panel"},{default:a(()=>{var N;return[(D(!0),le(de,null,Ie((N=T.value)==null?void 0:N.task,(X,te)=>(D(),E(ee,{key:X.taskId,header:()=>y(X)},{default:a(()=>[P(q(X.content)+" "+q(X.waHint),1)]),_:2},1032,["header"]))),128))]}),_:1})):oe("",!0),u.value?(D(),le("div",As,[t(ae,{onClick:r,loading:w.value},{default:a(()=>x[0]||(x[0]=[P("重新评测")])),_:1},8,["loading"])])):oe("",!0)],64)}}}),ia=ue(Rs,[["__scopeId","data-v-3eb6e961"]]),Ms={style:{margin:"10px"}},Es=ie({__name:"ContestList",setup(e){const l=Se(),n=We(),{globalProperties:i}=pe();let o=null;const b=p([{title:"ID",colKey:"id",cell:(k,u)=>t(O,{variant:"text",onClick:()=>I(u.row.id)},{default:()=>[u.row.id]})},{title:"标题",colKey:"title",cell:(k,u)=>t(O,{variant:"text",onClick:()=>I(u.row.id)},{default:()=>[u.row.title]})},{title:"负责人",colKey:"ownerNickname",cell:(k,u)=>t(O,{variant:"text",onClick:()=>Bt(n,u.row.ownerUsername)},{default:()=>[u.row.ownerNickname]})},{title:"权限",colKey:"private",cell:(k,u)=>u.row.private?"私有":"公开"},{title:"开始时间",colKey:"startTime"},{title:"结束时间",colKey:"endTime"}]),f=p(!1);let S=1,m=50;const s=p({current:S,pageSize:m,defaultCurrent:S,defaultPageSize:m,total:0,pageSizeOptions:[50,100]}),T=p(),v=p({title:"",username:""}),I=k=>{k&&n.push({path:"/contest/"+k})},g=async()=>{await n.push({query:{...l.query,title:v.value.title,username:v.value.username,page:1,page_size:s.value.defaultPageSize}})},_=async()=>{v.value.title="",v.value.username="",await n.push({query:{...l.query,title:"",username:"",page:1,page_size:s.value.defaultPageSize}})},c=async(k,u)=>{var r;f.value=!0;try{const{current:z,pageSize:C}=k,y=await bo(v.value.title,v.value.username,z,C);if(T.value=[],y.code===0){const j=y.data.list;for(let h=0;h<j.length;h++){const x=j[h],$=Ht(x);(r=T.value)==null||r.push($)}s.value={...s.value,total:y.data.total_count}}else u&&F(i,y.code)}catch(z){console.error(z),F(i,Fe())}finally{f.value=!1}},d=async k=>{await n.push({query:{...l.query,page:k.current,page_size:k.pageSize}})},w=()=>{n.push({name:"contest-create"})};return me(async()=>{o=Le(()=>l.query,k=>{v.value.title=k.title||"",v.value.username=k.username||"";const u=parseInt(k.page)||s.value.defaultCurrent,r=parseInt(k.page_size)||s.value.defaultPageSize;S=u,m=r,s.value={...s.value,current:S,pageSize:m},c({current:S,pageSize:m},!0)},{immediate:!0})}),Ve(()=>{o&&o()}),(k,u)=>{const r=Re,z=be,C=xe,y=Ue,j=$e,h=O,x=we,$=je,U=Pe;return D(),E(U,null,{default:a(()=>[t(C,{span:9},{default:a(()=>[t(z,{style:{margin:"10px"}},{default:a(()=>[t(r,{data:T.value,columns:b.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:s.value,loading:f.value,"table-layout":"auto",onPageChange:d,style:{"white-space":"nowrap"}},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(C,{span:3},{default:a(()=>[R("div",Ms,[t(z,{class:"sh-card"},{default:a(()=>[t($,{model:v.value,onSubmit:g,onReset:_},{default:a(()=>[t(j,{label:"标题"},{default:a(()=>[t(y,{modelValue:v.value.title,"onUpdate:modelValue":u[0]||(u[0]=L=>v.value.title=L),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(j,{label:"负责人"},{default:a(()=>[t(y,{modelValue:v.value.username,"onUpdate:modelValue":u[1]||(u[1]=L=>v.value.username=L),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(j,null,{default:a(()=>[t(x,null,{default:a(()=>[t(h,{theme:"primary",type:"submit"},{default:a(()=>u[2]||(u[2]=[P("提交")])),_:1}),t(h,{theme:"danger",type:"reset"},{default:a(()=>u[3]||(u[3]=[P("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(z,{class:"sh-card"},{default:a(()=>[t(x,null,{default:a(()=>[t(h,{onClick:w},{default:a(()=>u[4]||(u[4]=[P("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),ua=ue(Es,[["__scopeId","data-v-dcab2ec1"]]),qs={style:{margin:"20px"}},Ks={style:{margin:"10px"}},Fs={style:{"text-align":"center","align-content":"center",padding:"20px",height:"500px"}},Os={style:{"text-align":"center",width:"100%"}},Gs={class:"dida-operation-container"},Ns={style:{margin:"12px"}},Hs=ie({__name:"ContestDetail",setup(e){let l=Se();const{globalProperties:n}=pe(),i=Ye(),o=qe(),b=p(!1);let f=0;const S=p(!1),m=p(null),s=p(!1),T=p(!1),v=p(""),I=Ne(()=>o.hasAuth(ze.ManageContest)||m.value&&o.getUserId==m.value.ownerId),g=C=>{if(!C||!d)return"default";const y=d[C];if(!y)return"default";switch(y){case Ke.Accept:return"success";case Ke.Attempt:return"warning";default:return"default"}},_=p([{title:"问题ID",colKey:"index",cell:(C,y)=>{const j=g(y.row.index);return t(O,{variant:"dashed",theme:j,onClick:async()=>await Et(f,y.row.index)},{default:()=>[y.row.id]})}},{title:"标题",colKey:"title",cell:(C,y)=>t(O,{variant:"text",onClick:async()=>await Et(f,y.row.index)},{default:()=>[y.row.title]})},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),c=p([]);let d={},w=p(!1);const k=()=>{Y.push({name:"contest-edit",params:{contestId:f}})},u=async()=>{b.value=!0;try{const C=await So(f);if(C.code!==0){F(n,C.code);return}const y=C.data;ke(n,"查重报告已生成，请前往查看"),window.open(y,"_blank")}finally{b.value=!1}},r=async C=>{if(!o.isLogin()){await Y.push({name:"login"});return}if(!v.value){ve(n,"请输入密码");return}w.value=!0;try{const y=await ko(f,v.value);if(y.code!==0){F(n,y.code);return}ke(n,"申请访问成功"),await z()}catch(y){console.error("Error submitting contest password:",y),F(n,"提交密码失败，请稍后再试")}finally{w.value=!1}},z=async()=>{S.value=!0;const C=await po(f);if(C.code!==0){S.value=!1,F(n,C.code),await Y.push({name:"contest"});return}s.value=C.data.has_auth,T.value=C.data.need_password,m.value=Ht(C.data.contest),c.value=m.value.problems,d=C.data.attempt_status||{},i.setTitle(m.value.title+" - "+i.getTitle),S.value=!1};return me(async()=>{if(Array.isArray(l.params.contestId)?f=Number(l.params.contestId[0]):f=Number(l.params.contestId),!f){await Y.push({name:"contest"});return}await z()}),(C,y)=>{const j=Ct,h=Re,x=be,$=Ue,U=$e,L=O,V=je,A=xe,M=we,J=Be,Q=He,ee=Ae("md-preview"),ne=Pe,ae=Te;return D(),E(ae,{loading:S.value},{default:a(()=>[t(ne,{class:"dida-main-content"},{default:a(()=>[t(A,{span:6},{default:a(()=>{var G,ce,Z;return[R("div",qs,[R("h1",null,q((G=m.value)==null?void 0:G.title),1),(ce=m.value)!=null&&ce.notification?(D(),E(j,{key:0,theme:"info",message:(Z=m.value)==null?void 0:Z.notification},null,8,["message"])):oe("",!0)]),R("div",Ks,[s.value?(D(),E(x,{key:0},{default:a(()=>[t(h,{data:c.value,columns:_.value,"row-key":"id","table-layout":"auto","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1})):(D(),E(x,{key:1},{default:a(()=>[R("div",Fs,[t(j,{theme:"warning",message:"您没有查看本比赛的权限"}),T.value?(D(),E(V,{key:0,style:{margin:"20px auto 0",width:"200px"},onSubmit:r,"label-width":"0"},{default:a(()=>[t(U,null,{default:a(()=>[t($,{placeholder:"请输入密码",value:v.value,"onUpdate:value":y[0]||(y[0]=N=>v.value=N),style:{width:"300px"},type:"password",autocomplete:"new-password"},null,8,["value"])]),_:1}),t(U,null,{default:a(()=>[R("div",Os,[t(L,{theme:"primary",type:"submit",loading:fe(w)},{default:a(()=>y[1]||(y[1]=[P("提交")])),_:1},8,["loading"])])]),_:1})]),_:1})):oe("",!0)])]),_:1}))])]}),_:1}),t(A,{span:6},{default:a(()=>{var G;return[R("div",Gs,[t(M,null,{default:a(()=>[I.value?(D(),E(L,{key:0,onClick:u,loading:b.value},{default:a(()=>y[2]||(y[2]=[P("查重")])),_:1},8,["loading"])):oe("",!0),I.value?(D(),E(L,{key:1,onClick:k},{default:a(()=>y[3]||(y[3]=[P("编辑")])),_:1})):oe("",!0)]),_:1})]),R("div",Ns,[t(Q,{layout:"vertical",bordered:!0},{default:a(()=>[t(J,{label:"创建时间"},{default:a(()=>{var ce;return[P(q((ce=m.value)==null?void 0:ce.createTime),1)]}),_:1})]),_:1}),t(Q,{layout:"vertical",bordered:!0},{default:a(()=>[t(J,{label:"更新时间"},{default:a(()=>{var ce;return[P(q((ce=m.value)==null?void 0:ce.updateTime),1)]}),_:1})]),_:1}),t(Q,{layout:"vertical",bordered:!0},{default:a(()=>[t(J,{label:"开始时间"},{default:a(()=>{var ce;return[P(q((ce=m.value)==null?void 0:ce.startTime),1)]}),_:1})]),_:1}),t(Q,{layout:"vertical",bordered:!0},{default:a(()=>[t(J,{label:"结束时间"},{default:a(()=>{var ce;return[P(q((ce=m.value)==null?void 0:ce.endTime),1)]}),_:1})]),_:1})]),(G=m.value)!=null&&G.description?(D(),E(x,{key:0,style:{margin:"12px"}},{default:a(()=>{var ce;return[t(ee,{"model-value":(ce=m.value)==null?void 0:ce.description,class:"dida-content-description"},null,8,["model-value"])]}),_:1})):oe("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),Bs=ue(Hs,[["__scopeId","data-v-af022b1b"]]);function Ea(e){return e?Math.floor(e/1e9):0}function rt(e){if(e<=0)return"0秒";let l="";const n=Math.floor(e/3600);n>0&&(l+=`${n}小时`);const i=Math.floor(e%3600/60);return(i>0||n>0)&&(n>0&&i<10&&(l+="0"),l+=`${i}分钟`),e=e%60,(e>0||i>0||n>0)&&((n>0||i>0)&&e<10&&(l+="0"),l+=`${e.toFixed(0)}秒`),l}const Js=mt("contest",{state:()=>({starMembers:{}}),actions:{clear(){this.$patch({starMembers:{}})},addStarMember(e,l){this.starMembers[e]||(this.starMembers[e]={}),this.starMembers[e][l]=!0},removeStarMember(e,l){this.starMembers[e]&&(delete this.starMembers[e][l],Object.keys(this.starMembers[e]).length===0&&delete this.starMembers[e])},isStarMember(e,l){var n;return!!((n=this.starMembers[e])!=null&&n[l])}},persist:!0}),Ws={style:{margin:"10px 10px 40px"}},Ys={style:{"text-align":"right","margin-bottom":"10px"}},Xs={class:"table-scroll-wrapper"};function da(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const Zs=ie({__name:"ContestRank",setup(e){const l=Se(),n=We(),i=Js(),{globalProperties:o}=pe();let b=!1,f=null,S=0,m=null,s=null,T=0;const v=p(0),I=p(0),g=p(!1),_=p(!0),c=p(!0);let d=null,w=null,k=1,u=50;const r=p({current:k,pageSize:u,defaultCurrent:1,defaultPageSize:50,total:0,pageSizeOptions:[50,100,1e3]}),z=N=>i&&i.isStarMember(S,N),C=async N=>{r.value={...r.value,current:N.current,pageSize:N.pageSize},await n.push({query:{...l.query,page:N.current,page_size:N.pageSize}})},y=N=>{if(N==null)return"-";const X=Math.floor(N/3600).toString().padStart(2,"0"),te=Math.floor(N%3600/60).toString().padStart(2,"0"),K=(N%60).toFixed(0).toString().padStart(2,"0");return`${X}:${te}:${K}`},j=p({}),h=[{title:"Rank",colKey:"rank",align:"center",fixed:"left"},{title:"昵称",colKey:"nickname",fixed:"left",attrs:N=>{let X={};return z(N.row.userId)&&(X={backgroundColor:"rgba(255,165,30,0.5)"}),{style:X}},cell:(N,X)=>{const te=El(X.row.nickname,18);let K=null;return z(X.row.userId)?K=t(O,{shape:"circle",variant:"text",class:"rank-unstar-button",onClick:()=>{i.removeStarMember(S,X.row.userId),G()}},{default:()=>[t(al,{slot:"icon"},null)]}):K=t(O,{shape:"circle",variant:"text",class:"rank-star-button",onClick:()=>{i.addStarMember(S,X.row.userId),G()}},{default:()=>[t(ll,{slot:"icon"},null)]}),t("div",{class:"rank-nickname-cell"},[t(we,null,{default:()=>[t(Pl,{content:X.row.nickname},{default:()=>[t(O,{variant:"text",onClick:()=>n.push({name:"user",params:{username:X.row.username}})},da(te)?te:{default:()=>[te]})]}),K]})])}},{title:"Solved",colKey:"solved",align:"center",fixed:"left",cell:(N,X)=>t(O,{variant:"text",onClick:()=>n.push({name:"contest-judge",params:{contestId:S},query:{username:X.row.username,status:Oe.Accept}})},{default:()=>[X.row.solved]})},{title:"Penalty",colKey:"penalty",align:"center",fixed:"left",cell:(N,X)=>y(X.row.penalty)}],x=p([]),$=p(!1);let U=[],L=[];const V=p([]);let A=[];const M=({col:N,rowIndex:X})=>{if(N.colKey==="rank"){let te=r.value.current;r.value.current>Math.ceil(V.value.length/r.value.pageSize)&&(te=Math.ceil(V.value.length/r.value.pageSize));let K=r.value.pageSize*(te-1),H=1;for(let re=X+1;K+re<V.value.length&&V.value[K+re].rank===V.value[K+X].rank;re++)H++;return{rowspan:H}}},J=(N,{value:X})=>rt(X),Q=()=>{d&&clearInterval(d),d=setInterval(()=>{b&&Z(!1)},3e4),w&&clearInterval(w),w=setInterval(()=>{if(!b)return;v.value=(new Date().getTime()-m.getTime())/1e3;const N=Math.min(v.value,I.value);v.value=Math.min(v.value,N),G()},1e3)},ee=()=>{d&&(clearInterval(d),d=null),w&&(clearInterval(w),w=null)},ne=async N=>{c.value=N,N?(await Z(!1),Q()):ee()},ae=()=>{G(),r.value={...r.value,current:1}},G=()=>{V.value=[];let N=[];for(let W=0;W<U.length;W++){const he=U[W];let Ce={userId:he.author_id,username:he.author_username,nickname:he.author_nickname},ye=0,De=0;he.problems.forEach(Je=>{let Xe=-1,et=Je.lock||0;if(Je.ac){if(Xe=(new Date(Je.ac).getTime()-(m==null?void 0:m.getTime()))/1e3,Xe>v.value)return;ye++,De+=Xe,De+=Je.attempt*20*60}if(et>0&&T>0){const Vt=I.value-T;v.value<Vt&&(et=0)}const ot=Je.index;Ce[`problem_${ot}`]={acDuration:Xe,attempt:Je.attempt||0,lock:et}}),Ce.solved=ye,Ce.penalty=De,N.push(Ce)}N.sort((W,he)=>W.solved!==he.solved?he.solved-W.solved:W.penalty!==he.penalty?W.penalty-he.penalty:W.userId-he.userId);const X=L;let te=0,K=0,H=-1,re=-1;for(let W=0;W<N.length;W++)X&&X.includes(N[W].userId)?N[W].rank="*":(K++,(N[W].solved!==H||N[W].penalty!==re)&&(te=K,H=N[W].solved,re=N[W].penalty),N[W].rank=String(te));g.value&&(N=N.filter(W=>z(W.userId)));const _e=document.querySelectorAll("tbody tr"),ge={};A.forEach((W,he)=>{const Ce=_e[he];Ce&&(ge[W.userId]=Ce.getBoundingClientRect())}),r.value={...r.value,total:N.length},V.value=N;for(let W=0;W<V.value.length;W++)V.value[W].index=W+1;if(A=[...V.value],_.value){const W={},he=document.querySelectorAll("table tbody tr");V.value.forEach((Ce,ye)=>{const De=he[ye];De&&(W[Ce.userId]=De.getBoundingClientRect())}),requestAnimationFrame(()=>{const Ce=document.querySelectorAll("table tbody tr");V.value.forEach((ye,De)=>{const Je=Ce[De],Xe=ge[ye.userId],et=W[ye.userId];if(Xe&&et){const ot=Xe.top-et.top;ot!==0&&(Je.style.transition="none",Je.style.transform=`translateY(${ot}px)`)}}),requestAnimationFrame(()=>{document.querySelectorAll("table tbody tr").forEach(De=>{De.style.transition="transform 300ms ease",De.style.transform=""})})})}},ce=N=>{ne(!1),v.value=N;const X=Math.min(I.value,(new Date().getTime()-(m==null?void 0:m.getTime()))/1e3);v.value=Math.min(v.value,X),G()},Z=async N=>{N&&($.value=!0);try{const X=await ho(S);if(x.value=[...h],U=[],L=[],V.value=[],r.value={...r.value,total:0},X.code===0){if(!X.data.has_auth){ke(o,"您目前没有权限查看比赛排名"),await n.push({name:"contest-detail",params:{contestId:S}});return}X.data.problems.sort((H,re)=>H-re),X.data.problems.forEach((H,re)=>{x.value.push({colKey:`problem_${H}`,align:"center",title:()=>{let _e;return t(O,{variant:"text",onClick:()=>n.push({name:"contest-problem-detail",params:{contestId:S,problemIndex:H}})},da(_e=at(H))?_e:{default:()=>[_e]})},cell:(_e,ge)=>{const W=ge.row[`problem_${H}`];if(!W)return"";let he="";return W.acDuration>=0&&(he=y(W.acDuration)),W.attempt>0&&(he&&(he+=" "),he+=`(-${W.attempt})`),W.lock>0&&(he&&(he+=" "),he+=`(+${W.lock})`),t("span",null,[he])},attrs:_e=>{const ge=_e.row[`problem_${H}`];return ge?ge.acDuration>=0?{style:{backgroundColor:"rgba(130,255,30,0.5)"}}:ge.lock>0?{style:{backgroundColor:"rgb(255,180,50,0.5)"}}:ge.attempt>0?{style:{backgroundColor:"rgba(255,120,120,0.5)"}}:{}:{}}})});const te=X.data.contest;if(m=new Date(te.start_time),s=new Date(te.end_time),U=X.data.ranks,L=X.data.v_members||[],I.value=Math.floor((s.getTime()-m.getTime())/1e3),j.value={0:"0",[Math.floor(I.value/2)]:rt(Math.floor(I.value/2)),[I.value]:rt(I.value)},T=Ea(te.lock_rank_duration||0),X.data.is_locked&&T>0){const H=Math.max(0,I.value-T);j.value[H]=t("span",{style:"color: #0052d9"},[P("锁榜("),rt(H),P(")")])}v.value=Math.floor((new Date().getTime()-m.getTime())/1e3);const K=Math.min(v.value,I.value);v.value=Math.min(v.value,K),c.value=!0,Q(),G()}else N&&F(o,X.code)}catch(X){console.error(X),N&&F(o,Fe())}finally{N&&($.value=!1)}};return me(async()=>{b=!0,f=Le(()=>l.query,async N=>{if(Array.isArray(l.params.contestId)?S=Number(l.params.contestId[0]):S=Number(l.params.contestId),!S){await n.push({name:"contest"});return}const X=parseInt(N.page)||r.value.defaultCurrent,te=parseInt(N.page_size)||r.value.defaultPageSize;k=X,u=te,r.value={...r.value,current:k,pageSize:u},await Z(!0)},{immediate:!0})}),Ve(()=>{b=!1,f&&f(),ee()}),(N,X)=>{const te=ft,K=we,H=Il,re=Re,_e=be,ge=Pe;return D(),E(ge,null,{default:a(()=>[t(_e,{style:{margin:"10px",width:"100%"}},{default:a(()=>[R("div",Ws,[R("div",Ys,[t(K,null,{default:a(()=>[t(te,{size:"large",modelValue:g.value,"onUpdate:modelValue":X[0]||(X[0]=W=>g.value=W),onChange:ae},{label:a(W=>[P(q(W.value?"仅展示收藏":"未过滤收藏"),1)]),_:1},8,["modelValue"]),t(te,{size:"large",modelValue:_.value,"onUpdate:modelValue":X[1]||(X[1]=W=>_.value=W)},{label:a(W=>[P(q(W.value?"开启动画":"关闭动画"),1)]),_:1},8,["modelValue"]),t(te,{size:"large",modelValue:c.value,"onUpdate:modelValue":X[2]||(X[2]=W=>c.value=W),onChange:ne},{label:a(W=>[P(q(W.value?"自动刷新":"关闭刷新"),1)]),_:1},8,["modelValue"])]),_:1})]),t(H,{modelValue:v.value,"onUpdate:modelValue":X[3]||(X[3]=W=>v.value=W),marks:j.value,max:I.value,label:J,"tooltip-props":{placement:"top"},"input-number-props":{theme:"column",autoWidth:!0,format:fe(rt),onChange:ce},onChangeEnd:ce},null,8,["modelValue","marks","max","input-number-props"])]),R("div",Xs,[t(re,{data:V.value,columns:x.value,"row-key":"index","vertical-align":"middle",bordered:!0,hover:!0,"table-layout":"auto","rowspan-and-colspan":M,loading:$.value,class:"dida-contest-rank-table",pagination:r.value,onPageChange:C},null,8,["data","columns","loading","pagination"])])]),_:1})]),_:1})}}}),Qs=ue(Zs,[["__scopeId","data-v-838e6c28"]]),er={style:{margin:"10px"}},tr={style:{margin:"12px"}},ar={class:"dida-edit-container"},lr={class:"dida-description-editor"},nr=ie({__name:"ContestEdit",setup(e){let l=Se();const{globalProperties:n}=pe(),i=Ye(),o=p(0),b=p(!1),f=p(!1),S=p(!1),m=p(null),s=p({title:"",openTime:[],private:!0,password:"",problems:[],members:[],description:"",notification:"",lockRankDuration:0,alwaysLock:!0,submitAnytime:!1}),T=p(""),v=p(""),I=p(!1),g=async()=>{I.value=!0,S.value=!1,I.value=!1},_=async(u,r)=>{f.value=!0,await vt(u,r,n,()=>_o(o.value)),f.value=!1},c=async()=>{f.value=!0;try{const u={title:s.value.title,description:s.value.description,notification:s.value.notification,lock_rank_duration:s.value.lockRankDuration,always_lock:s.value.alwaysLock,problems:s.value.problems,members:s.value.members,private:s.value.private,password:s.value.password,submit_anytime:s.value.submitAnytime};s.value.openTime[0]&&(u.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(u.end_time=new Date(s.value.openTime[1]));const r=await yo(u);if(f.value=!0,r.code!==0){F(n,r.code);return}r.data!=null&&await Y.push({name:"contest-detail",params:{contestId:r.data}}),Ge(n,"创建成功")}finally{f.value=!1}},d=async()=>{f.value=!0;try{const u={id:Number(o.value),title:s.value.title,notification:s.value.notification,lock_rank_duration:s.value.lockRankDuration,always_lock:s.value.alwaysLock,problems:s.value.problems,members:s.value.members,private:s.value.private,password:s.value.password,submit_anytime:s.value.submitAnytime,description:s.value.description};s.value.openTime[0]&&(u.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(u.end_time=new Date(s.value.openTime[1]));const r=await wo(u);if(f.value=!0,r.code!==0){F(n,r.code);return}m.value&&(r.data.description!=null&&(s.value.description=r.data.description),r.data.update_time!=null&&(m.value.updateTime=new Date(r.data.update_time).toLocaleString())),Ge(n,"保存成功")}finally{f.value=!1}},w=u=>{s.value.description=u,b.value=!1},k=async()=>{const u=await fo(o.value);if(u.code!==0){F(n,u.code),console.error("contest get failed",u.code),await Y.push({name:"contest-list"});return}const r=u.data.contest;m.value=Ht(r),s.value.title=r.title,s.value.openTime=[],r.start_time?s.value.openTime.push(new Date(r.start_time)):s.value.openTime.push(""),r.end_time?s.value.openTime.push(new Date(r.end_time)):s.value.openTime.push(""),s.value.private=r.private,s.value.password=r.password||"",s.value.description=r.description||"",s.value.notification=r.notification||"",s.value.problems=u.data.problems,s.value.members=u.data.members,r.lock_rank_duration?s.value.lockRankDuration=Ea(r.lock_rank_duration):s.value.lockRankDuration=0,s.value.alwaysLock=r.always_lock,s.value.submitAnytime=r.submit_anytime,i.setTitle(r.title+" - "+i.getTitle);let z="";r.description&&(z=r.description),w(z)};return me(async()=>{Array.isArray(l.params.contestId)?o.value=Number(l.params.contestId[0]):o.value=Number(l.params.contestId),o.value?(b.value=!0,await k()):w("")}),(u,r)=>{const z=Ue,C=$e,y=Ft,j=ft,h=ya,x=je,$=be,U=xe,L=O,V=we,A=Be,M=He,J=Pe,Q=Ae("md-editor-v3"),ee=Te,ne=It,ae=nt;return D(),le(de,null,[t(ee,{loading:b.value},{default:a(()=>[t(J,null,{default:a(()=>[t(U,{span:8},{default:a(()=>[R("div",er,[t($,{class:"sh-card"},{default:a(()=>[t(x,{model:s.value,"label-width":"150px"},{default:a(()=>[t(C,{label:"标题"},{default:a(()=>[t(z,{modelValue:s.value.title,"onUpdate:modelValue":r[0]||(r[0]=G=>s.value.title=G),placeholder:"比赛标题"},null,8,["modelValue"])]),_:1}),t(C,{label:"通知"},{default:a(()=>[t(z,{modelValue:s.value.notification,"onUpdate:modelValue":r[1]||(r[1]=G=>s.value.notification=G),placeholder:"会更为醒目地提醒"},null,8,["modelValue"])]),_:1}),t(C,{label:"开启时间"},{default:a(()=>[t(y,{modelValue:s.value.openTime,"onUpdate:modelValue":r[2]||(r[2]=G=>s.value.openTime=G),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(C,{label:"提交限制"},{default:a(()=>[t(j,{modelValue:s.value.submitAnytime,"onUpdate:modelValue":r[3]||(r[3]=G=>s.value.submitAnytime=G)},{label:a(G=>[P(q(G.value?"结束仍能提交":"仅比赛期间提交"),1)]),_:1},8,["modelValue"])]),_:1}),t(C,{label:"锁榜时长"},{default:a(()=>[t(h,{modelValue:s.value.lockRankDuration,"onUpdate:modelValue":r[4]||(r[4]=G=>s.value.lockRankDuration=G),min:0,format:fe(rt),"auto-width":""},null,8,["modelValue","format"])]),_:1}),t(C,{label:"自动解锁"},{default:a(()=>[t(j,{modelValue:s.value.alwaysLock,"onUpdate:modelValue":r[5]||(r[5]=G=>s.value.alwaysLock=G)},{label:a(G=>[P(q(G.value?"结束后仍锁榜":"结束后解锁"),1)]),_:1},8,["modelValue"])]),_:1}),t(C,{label:"私有"},{default:a(()=>[t(j,{modelValue:s.value.private,"onUpdate:modelValue":r[6]||(r[6]=G=>s.value.private=G)},null,8,["modelValue"])]),_:1}),s.value.private?(D(),E(C,{key:0,label:"密码"},{default:a(()=>[t(z,{modelValue:s.value.password,"onUpdate:modelValue":r[7]||(r[7]=G=>s.value.password=G),type:"password",placeholder:"请输入访问密码，留空代表关闭密码访问"},null,8,["modelValue"])]),_:1})):oe("",!0),s.value.private?(D(),E(C,{key:1,label:"成员"},{default:a(()=>[t(Ma,{modelValue:s.value.members,"onUpdate:modelValue":r[8]||(r[8]=G=>s.value.members=G)},null,8,["modelValue"])]),_:1})):oe("",!0),t(C,{label:"问题"},{default:a(()=>[t(Ra,{modelValue:s.value.problems,"onUpdate:modelValue":r[9]||(r[9]=G=>s.value.problems=G)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(U,{span:4},{default:a(()=>[R("div",tr,[R("div",ar,[o.value?(D(),E(V,{key:0},{default:a(()=>[t(L,{onClick:d,theme:"danger",loading:f.value},{default:a(()=>r[13]||(r[13]=[P("保存")])),_:1},8,["loading"])]),_:1})):(D(),E(V,{key:1},{default:a(()=>[t(L,{onClick:c,theme:"danger",loading:f.value},{default:a(()=>r[14]||(r[14]=[P("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(D(),E(M,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(A,{label:"创建时间"},{default:a(()=>{var G;return[P(q((G=m.value)==null?void 0:G.createTime),1)]}),_:1}),t(A,{label:"更新时间"},{default:a(()=>{var G;return[P(q((G=m.value)==null?void 0:G.updateTime),1)]}),_:1}),t(A,{label:"创建用户"},{default:a(()=>{var G;return[P(q((G=m.value)==null?void 0:G.ownerNickname),1)]}),_:1})]),_:1})):oe("",!0)])]),_:1})]),_:1}),R("div",lr,[r[15]||(r[15]=R("p",null,"公告",-1)),t(Q,{id:"contest-description-editor",modelValue:s.value.description,"onUpdate:modelValue":r[10]||(r[10]=G=>s.value.description=G),onSave:d,onOnUploadImg:_,previewTheme:"cyanosis"},null,8,["modelValue"]),t(ee,{loading:f.value,attach:"#contest-description-editor","z-index":1e5},null,8,["loading"])])]),_:1},8,["loading"]),t(ae,{visible:S.value,"onUpdate:visible":r[12]||(r[12]=G=>S.value=G),onConfirm:g,header:T.value,"confirm-loading":I.value},{default:a(()=>[r[16]||(r[16]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(ne,{modelValue:v.value,"onUpdate:modelValue":r[11]||(r[11]=G=>v.value=G),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),ca=ue(nr,[["__scopeId","data-v-e76af3ed"]]);function Wt(e){const l={};return l.id=e.id,l.authorId=e.author_id,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.title=e.title,l.content=e.content,e.insert_time&&(l.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(l.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(l.updateTime=new Date(e.update_time).toLocaleString()),l.problemId=e.problem_id,l.problemTitle=e.problem_title,l.contestId=e.contest_id,l.contestTitle=e.contest_title,l.contestProblemIndex=e.contest_problem_index,l}function or(e){const l={};return l.id=e.id,l.authorId=e.author_id,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.content="",e.content&&(l.content=e.content),e.insert_time&&(l.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(l.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(l.updateTime=new Date(e.update_time).toLocaleString()),l}function sr(e){return B({url:"/discuss?id="+e,method:"get"})}function rr(e){return B({url:"/discuss/edit?id="+e,method:"get"})}function ir(e,l,n,i,o,b,f){const S={};return e?S.only_problem="1":S.only_problem="0",l&&(S.contest_id=l),n&&(S.problem_id=n),i&&(S.title=i),o&&(S.username=o),b&&(S.page=b),f&&(S.page_size=f),B({url:`/discuss/list?${new URLSearchParams(S).toString()}`,method:"get"})}function ur(e){return e||(e=0),B({url:"/discuss/image/token?id="+e,method:"get"})}function dr(e,l,n){return B({url:"/discuss/comment/list?id="+e+"&page="+l+"&page_size="+n,method:"get"})}function cr(e){return B({url:"/discuss/create",method:"post",data:e})}function mr(e){return B({url:"/discuss/edit",method:"post",data:e})}const pr={style:{margin:"10px"}};function fr(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const vr=ie({__name:"DiscussList",setup(e){const l=Se(),n=We(),{globalProperties:i}=pe();let o=!1,b=null,f=-1,S=p(!1);const m=p([]),s=[],T=[{title:"标题",colKey:"title",cell:(j,h)=>t(O,{variant:"text",onClick:()=>u(h.row.id)},{default:()=>[h.row.title]})},{title:"创建人",colKey:"authorNickname",width:"200",cell:(j,h)=>t(O,{variant:"text",onClick:async()=>await Bt(n,h.row.authorUsername)},{default:()=>[h.row.authorNickname]})},{title:"创建时间",colKey:"insertTime",width:"180"},{title:"更新时间",colKey:"updateTime",width:"180"}],v=p(!1);let I=1,g=50;const _=p({current:I,pageSize:g,defaultCurrent:I,defaultPageSize:g,total:0,pageSizeOptions:[50,100]}),c=p(),d=p({problemId:"",title:"",username:""}),w=j=>{j&&n.push({name:"problem-detail",params:{problemId:j}})},k=(j,h)=>{n.push({name:"contest-problem-detail",params:{contestId:j,problemIndex:h}})},u=j=>{if(j){if(f){n.push({name:"contest-discuss-detail",params:{contestId:f,discussId:j}});return}n.push({name:"discuss-detail",params:{discussId:j}})}},r=async()=>{await n.push({query:{...l.query,problem_id:d.value.problemId,title:d.value.title,username:d.value.username,page:1,page_size:_.value.defaultPageSize}})},z=async(j,h)=>{var x;v.value=!0;try{const{current:$,pageSize:U}=j,L=await ir(S.value,f,d.value.problemId,d.value.title,d.value.username,$,U);if(c.value=[],L.code===0){if(!L.data.has_auth){ke(i,"您目前没有权限查看讨论列表"),f?await n.push({name:"contest-detail",params:{contestId:f}}):await n.push({name:"discuss-list"});return}if(L.data.list){const V=L.data.list;for(let A=0;A<V.length;A++){const M=V[A],J=await Wt(M);(x=c.value)==null||x.push(J)}}_.value={..._.value,total:L.data.total_count}}else h&&F(i,L.code)}catch($){console.error($),F(i,Fe())}finally{v.value=!1}},C=async j=>{await n.push({query:{...l.query,page:j.current,page_size:j.pageSize}})},y=async()=>{await n.push({name:"discuss-create"})};return me(async()=>{o=!0,b=Le(()=>l.query,j=>{if(!o)return;S.value=l.name==="discuss-list-problem",Array.isArray(l.params.contestId)?f=Number(l.params.contestId[0]):f=Number(l.params.contestId),m.value=s,f?m.value=m.value.concat([{title:"问题ID",colKey:"contestProblemIndex",width:"100",cell:($,U)=>{let L;return U.row.contestProblemIndex?t(O,{variant:"text",onClick:()=>k(f,U.row.contestProblemIndex)},fr(L=at(U.row.contestProblemIndex))?L:{default:()=>[L]}):""}}]):m.value=m.value.concat([{title:"问题ID",colKey:"problemId",width:"100",cell:($,U)=>U.row.problemId?t(O,{variant:"text",onClick:()=>w(U.row.problemId)},{default:()=>[U.row.problemId]}):""}]),m.value=m.value.concat(T),d.value.problemId=j.problem_id||"",d.value.title=j.title||"",d.value.username=j.username||"";const h=parseInt(j.page)||_.value.defaultCurrent,x=parseInt(j.page_size)||_.value.defaultPageSize;I=h,g=x,_.value={..._.value,current:I,pageSize:g},z({current:I,pageSize:g},!0)},{immediate:!0})}),Ve(()=>{o=!1,b&&b()}),(j,h)=>{const x=Re,$=be,U=xe,L=Ue,V=$e,A=O,M=je,J=we,Q=Pe;return D(),E(Q,null,{default:a(()=>[t(U,{span:9},{default:a(()=>[t($,{style:{margin:"10px"}},{default:a(()=>[t(x,{data:c.value,columns:m.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:_.value,loading:v.value,"table-layout":"auto",onPageChange:C},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(U,{span:3},{default:a(()=>[R("div",pr,[t($,{class:"sh-card"},{default:a(()=>[t(M,{model:d.value},{default:a(()=>[t(V,{label:"问题ID"},{default:a(()=>[t(L,{modelValue:d.value.problemId,"onUpdate:modelValue":h[0]||(h[0]=ee=>d.value.problemId=ee),placeholder:"请输入完整问题ID"},null,8,["modelValue"])]),_:1}),t(V,{label:"标题"},{default:a(()=>[t(L,{modelValue:d.value.title,"onUpdate:modelValue":h[1]||(h[1]=ee=>d.value.title=ee),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(V,{label:"创建人"},{default:a(()=>[t(L,{modelValue:d.value.username,"onUpdate:modelValue":h[2]||(h[2]=ee=>d.value.username=ee),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(V,null,{default:a(()=>[t(A,{theme:"primary",onClick:r},{default:a(()=>h[3]||(h[3]=[P("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t($,{class:"sh-card"},{default:a(()=>[t(J,null,{default:a(()=>[t(A,{onClick:y},{default:a(()=>h[4]||(h[4]=[P("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),$t=ue(vr,[["__scopeId","data-v-52d475b4"]]),_r={key:0,style:{margin:"20px"}},gr={style:{margin:"10px"}},br={style:{margin:"10px"}},hr={style:{margin:"10px","text-align":"right"}},yr={style:{margin:"12px"}},wr={key:0,class:"dida-edit-container"},kr=ie({__name:"DiscussDetail",props:{discussId:{}},setup(e){const l=e;let n=Se();const{globalProperties:i}=pe();let o=null;const b=Ye(),f=qe();let S=p("");const m=p(""),s=p(!1),T=p(null);let v=p("");const I=p(!1);let g=1,_=20;const c=p({current:1,pageSize:20,total:0,defaultPageSize:_,defaultCurrent:g,pageSizeOptions:[20,50]}),d=p([]),w={},k=Ne(()=>f.hasAuth(ze.ManageDiscuss)||T.value&&f.getUserId==T.value.authorId),u=h=>{h&&Y.push({name:"discuss-list",query:{...n.query,title:"",tag:h.name}})},r=()=>{Y.push({name:"discuss-edit",params:{discussId:m.value}})},z=()=>t("div",{class:"t-pagination__total"},[`共 ${c.value.total} 条回复`]),C=()=>{},y=async(h,x)=>{var $;I.value=!0;try{const{current:U,pageSize:L}=h,V=await dr(m.value,U,L);if(d.value=[],V.code===0){const A=V.data.list;if(A)for(let M=0;M<A.length;M++){const J=A[M],Q=or(J);($=d.value)==null||$.push(Q)}c.value={...c.value,total:V.data.total_count}}else x&&F(i,V.code)}catch(U){console.error(U),F(i,Fe())}finally{I.value=!1}},j=async h=>{await Y.push({query:{...n.query,page:h.current,page_size:h.pageSize}})};return me(async()=>{if(m.value=l.discussId,m.value||(Array.isArray(n.params.discussId)?m.value=n.params.discussId[0]:m.value=n.params.discussId),!m.value){ve(i,"讨论不存在"),await Y.push({name:"discuss"});return}s.value=!0;const h=await sr(m.value);if(h.code!==0){s.value=!1,F(i,h.code),await Y.push({name:"discuss"});return}h.data.tags&&h.data.tags.forEach(x=>{w[x.id]=x}),T.value=Wt(h.data.discuss),b.setTitle(T.value.title+" - "+b.getTitle),S.value=T.value.content,s.value=!1,o=Le(()=>n.query,x=>{const $=parseInt(x.page)||c.value.defaultCurrent,U=parseInt(x.page_size)||c.value.defaultPageSize;g=$,_=U,c.value={...c.value,current:g,pageSize:_},y({current:g,pageSize:_},!0)},{immediate:!0})}),Ve(()=>{o&&o()}),(h,x)=>{const $=ka,U=wa,L=Ae("md-preview"),V=be,A=we,M=xl,J=Ae("md-editor-v3"),Q=Te,ee=O,ne=xe,ae=Be,G=He,ce=Pe;return D(),E(Q,{loading:s.value},{default:a(()=>[t(ce,{class:"dida-main-content"},{default:a(()=>[t(ne,{span:8},{default:a(()=>{var Z,N,X;return[(Z=T.value)!=null&&Z.problemTitle||(N=T.value)!=null&&N.contestTitle?(D(),le("div",_r,[t(U,{"max-item-width":"300"},{default:a(()=>{var te,K,H,re,_e;return[(te=T.value)!=null&&te.contestTitle?(D(),le(de,{key:0},[t($,{to:{name:"contest-detail",params:{contestId:(K=T.value)==null?void 0:K.contestId}}},{default:a(()=>{var ge;return[P(q((ge=T.value)==null?void 0:ge.contestTitle),1)]}),_:1},8,["to"]),(H=T.value)!=null&&H.contestProblemIndex?(D(),E($,{key:0,to:{name:"contest-problem-detail",params:{problemIndex:(re=T.value)==null?void 0:re.contestProblemIndex}}},{default:a(()=>{var ge,W;return[P(q(fe(at)((ge=T.value)==null?void 0:ge.contestProblemIndex))+" - "+q((W=T.value)==null?void 0:W.problemTitle),1)]}),_:1},8,["to"])):oe("",!0)],64)):(D(),le(de,{key:1},[t($,{to:{name:"discuss-list-problem"}},{default:a(()=>x[4]||(x[4]=[P(" 题目讨论")])),_:1}),t($,{to:{name:"problem-detail",params:{problemId:(_e=T.value)==null?void 0:_e.problemId}}},{default:a(()=>{var ge;return[P(q((ge=T.value)==null?void 0:ge.problemTitle),1)]}),_:1},8,["to"])],64))]}),_:1})])):oe("",!0),t(V,{style:{margin:"10px"},header:(X=T.value)==null?void 0:X.title,"header-bordered":!0},{default:a(()=>[t(L,{"model-value":fe(S),previewTheme:"cyanosis"},null,8,["model-value"])]),_:1},8,["header"]),(D(!0),le(de,null,Ie(d.value,(te,K)=>(D(),E(V,{key:K,style:{margin:"10px"},"header-bordered":""},{header:a(()=>[t(A,null,{default:a(()=>[R("span",null,q(te.authorNickname),1),R("span",null,q(te.insertTime),1)]),_:2},1024)]),default:a(()=>[t(L,{"model-value":te.content,previewTheme:"cyanosis"},null,8,["model-value"])]),_:2},1024))),128)),R("div",gr,[t(M,{modelValue:c.value.current,"onUpdate:modelValue":x[0]||(x[0]=te=>c.value.current=te),"page-size":c.value.pageSize,"onUpdate:pageSize":x[1]||(x[1]=te=>c.value.pageSize=te),total:c.value.total,"page-size-options":c.value.pageSizeOptions,"show-page-size":!1,"total-content":z,onChange:j},null,8,["modelValue","page-size","total","page-size-options"])]),R("div",br,[t(J,{id:"discuss-comment-editor",modelValue:fe(v),"onUpdate:modelValue":x[2]||(x[2]=te=>nl(v)?v.value=te:v=te),previewTheme:"cyanosis"},null,8,["modelValue"]),t(Q,{loading:!1,attach:"#discuss-comment-editor","z-index":1e5}),R("div",hr,[t(A,null,{default:a(()=>[t(ee,{theme:"primary",onClick:C},{default:a(()=>x[5]||(x[5]=[P("提交")])),_:1})]),_:1})])])]}),_:1}),t(ne,{span:4},{default:a(()=>[R("div",yr,[k.value?(D(),le("div",wr,[t(ee,{onClick:r},{default:a(()=>x[6]||(x[6]=[P("编辑")])),_:1})])):oe("",!0),t(G,{layout:"vertical",bordered:!0},{default:a(()=>[t(ae,{label:"创建时间"},{default:a(()=>{var Z;return[P(q((Z=T.value)==null?void 0:Z.insertTime),1)]}),_:1}),t(ae,{label:"编辑时间"},{default:a(()=>{var Z;return[P(q((Z=T.value)==null?void 0:Z.modifyTime),1)]}),_:1}),t(ae,{label:"更新时间"},{default:a(()=>{var Z;return[P(q((Z=T.value)==null?void 0:Z.updateTime),1)]}),_:1}),t(ae,{label:"创建用户"},{default:a(()=>[t(ee,{variant:"text",onClick:x[3]||(x[3]=async()=>{var Z;return await fe(Bt)(fe(Y),(Z=T.value)==null?void 0:Z.authorUsername)})},{default:a(()=>{var Z;return[P(q((Z=T.value)==null?void 0:Z.authorNickname),1)]}),_:1})]),_:1}),t(ae,{label:"标签"},{default:a(()=>[t(A,null,{default:a(()=>{var Z;return[(D(!0),le(de,null,Ie((Z=T.value)==null?void 0:Z.tags,N=>(D(),E(ee,{key:N.id,variant:"dashed",onClick:()=>u(N)},{default:a(()=>[P(q(N.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Ut=ue(kr,[["__scopeId","data-v-c38eb09a"]]),Sr={style:{margin:"10px"}},Cr={style:{margin:"12px"}},Ir={class:"dida-edit-container"},Pr={class:"dida-description-editor"},xr=ie({__name:"DiscussEdit",setup(e){let l=Se();const{globalProperties:n}=pe();let i=null;const o=p(0),b=p(!1),f=p(!1),S=p(null),m=p({title:"",problemId:"",content:""}),s=()=>{Y.push({name:"discuss-detail",params:{discussId:o.value}})};async function T(c,d){f.value=!0,await vt(c,d,n,()=>ur(o.value)),f.value=!1}const v=async()=>{f.value=!0;try{const c={title:m.value.title,content:m.value.content,problem_id:m.value.problemId},d=await cr(c);if(f.value=!0,d.code!==0){F(n,d.code);return}const w=d.data;await Y.push({name:"discuss-detail",params:{discussId:w}}),Ge(n,"创建成功")}finally{f.value=!1}},I=async()=>{f.value=!0;try{const c={id:o.value,title:m.value.title,content:m.value.content,problem_id:m.value.problemId},d=await mr(c);if(f.value=!0,d.code!==0){F(n,d.code);return}S.value&&d.data.modify_time!=null&&(S.value.modifyTime=new Date(d.data.modify_time).toLocaleString()),d.data.content!=null&&(m.value.content=d.data.content),Ge(n,"保存成功")}finally{f.value=!1}},g=async()=>{o.value?await I():await v()},_=async()=>{const c=await rr(o.value);if(c.code!==0){F(n,c.code),await Y.push({name:"discuss"});return}const d=c.data.discuss;S.value=Wt(d),m.value.title=d.title,m.value.content=d.content,m.value.problemId=d.problem_id,b.value=!1};return me(async()=>{i=Le(()=>l.params,async()=>{Array.isArray(l.params.discussId)?o.value=Number(l.params.discussId[0]):o.value=Number(l.params.discussId),o.value?(b.value=!0,await _()):(m.value.title="",m.value.problemId="",m.value.content="")},{immediate:!0})}),Ve(()=>{i&&(i(),i=null)}),(c,d)=>{const w=Ue,k=$e,u=je,r=be,z=xe,C=O,y=we,j=Be,h=He,x=Pe,$=Ae("md-editor-v3"),U=Te;return D(),E(U,{loading:b.value},{default:a(()=>[t(x,null,{default:a(()=>[t(z,{span:8},{default:a(()=>[R("div",Sr,[t(r,{class:"sh-form-card"},{default:a(()=>[t(u,{model:m.value},{default:a(()=>[t(k,{label:"标题"},{default:a(()=>[t(w,{modelValue:m.value.title,"onUpdate:modelValue":d[0]||(d[0]=L=>m.value.title=L),placeholder:"讨论标题"},null,8,["modelValue"])]),_:1}),t(k,{label:"关联题目"},{default:a(()=>[t(w,{modelValue:m.value.problemId,"onUpdate:modelValue":d[1]||(d[1]=L=>m.value.problemId=L),placeholder:"讨论题目"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(z,{span:4},{default:a(()=>[R("div",Cr,[R("div",Ir,[o.value?(D(),E(y,{key:0},{default:a(()=>[t(C,{onClick:I,theme:"danger",loading:f.value},{default:a(()=>d[3]||(d[3]=[P("保存")])),_:1},8,["loading"]),t(C,{onClick:s},{default:a(()=>d[4]||(d[4]=[P("查看")])),_:1})]),_:1})):(D(),E(y,{key:1},{default:a(()=>[t(C,{onClick:v,theme:"danger",loading:f.value},{default:a(()=>d[5]||(d[5]=[P("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(D(),E(h,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(j,{label:"创建时间"},{default:a(()=>{var L;return[P(q((L=S.value)==null?void 0:L.insertTime),1)]}),_:1}),t(j,{label:"更新时间"},{default:a(()=>{var L;return[P(q((L=S.value)==null?void 0:L.modifyTime),1)]}),_:1}),t(j,{label:"创建用户"},{default:a(()=>{var L;return[P(q((L=S.value)==null?void 0:L.authorNickname),1)]}),_:1})]),_:1})):oe("",!0)])]),_:1})]),_:1}),R("div",Pr,[t($,{id:"discuss-editor",modelValue:m.value.content,"onUpdate:modelValue":d[2]||(d[2]=L=>m.value.content=L),onSave:g,onOnUploadImg:T,previewTheme:"cyanosis"},null,8,["modelValue"]),t(U,{loading:f.value,attach:"#discuss-editor","z-index":1e5},null,8,["loading"])])]),_:1},8,["loading"])}}}),ma=ue(xr,[["__scopeId","data-v-164ac069"]]);function Tr(e,l){return B({url:"/rank/ac/all?page="+e+"&page_size="+l,method:"get"})}function Vr(e,l){return B({url:"/rank/ac/problem?page="+e+"&page_size="+l,method:"get"})}function Dr(e,l){return B({url:"/rank/ac/problem/today?page="+e+"&page_size="+l,method:"get"})}function Lr(e,l){return B({url:"/rank/ac/problem/day7?page="+e+"&page_size="+l,method:"get"})}function jr(e,l){return B({url:"/rank/ac/problem/day30?page="+e+"&page_size="+l,method:"get"})}function $r(e,l){return B({url:"/rank/ac/problem/year?page="+e+"&page_size="+l,method:"get"})}const Ur={style:{margin:"10px"}};function zt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const zr=ie({__name:"RankUser",props:{type:{}},setup(e){const l=Se(),n=We(),{globalProperties:i}=pe();let o=null;const b=e,f=p(""),S=p(""),m={all:{header:"统计所有用户在本站的提交记录",content:"优先以AC记录数量排序，如果相同则提交所用次数较少的优先，如果仍相同，注册较早的用户靠前"},problem:{header:"统计所有用户在本站的提交记录",content:"以题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-today":{header:"统计所有用户今日在本站的提交记录",content:"以今日题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-day7":{header:"统计所有用户最近7日在本站的提交记录",content:"以7日题目记录数量排序（从7日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-day30":{header:"统计所有用户最近30日在本站的提交记录",content:"以30日题目记录数量排序（从30日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-year":{header:"统计所有用户最近1年在本站的提交记录",content:"以最近1年题目记录数量排序（从365日前的0点开始计算），如果相同，注册较早的用户靠前"}},s=p([]),T=[{title:"序号",colKey:"index"},{title:"用户名",colKey:"username",cell:(y,j)=>t(O,{variant:"dashed",onClick:()=>k(j.row.username)},{default:()=>[j.row.username]})},{title:"昵称",colKey:"nickname"},{title:"Slogan",colKey:"slogan"}],v=[{title:"题目数量",colKey:"problem_count",cell:(y,j)=>{let h=0;return j.row.problem_count&&(h=j.row.problem_count),t(O,{variant:"dashed",onClick:()=>u(j.row.username)},zt(h)?h:{default:()=>[h]})}}],I=[{title:"正确",colKey:"accept",cell:(y,j)=>{let h=0;return j.row.accept&&(h=j.row.accept),t(O,{variant:"dashed",onClick:()=>u(j.row.username)},zt(h)?h:{default:()=>[h]})}},{title:"提交",colKey:"attempt",cell:(y,j)=>{let h=0;return j.row.attempt&&(h=j.row.attempt),t(O,{variant:"dashed",onClick:()=>r(j.row.username)},zt(h)?h:{default:()=>[h]})}}],g=p(!1);let _=1,c=50;const d=p({current:_,pageSize:c,defaultCurrent:_,defaultPageSize:c,total:0,pageSizeOptions:[50]}),w=p(),k=y=>{n.push({name:"user",params:{username:y}})},u=y=>{n.push({name:"judge-list",query:{username:y,status:Oe.Accept}})},r=y=>{n.push({name:"judge-list",query:{username:y}})},z=async(y,j)=>{g.value=!0;try{w.value=[];const{current:h,pageSize:x}=y;let $=null;switch(b.type){case"problem":$=await Vr(h,x);break;case"problem-today":$=await Dr(h,x);break;case"problem-day7":$=await Lr(h,x);break;case"problem-day30":$=await jr(h,x);break;case"problem-year":$=await $r(h,x);break;default:$=await Tr(h,x);break}if($.code===0){const U=$.data.list;if(!U||U.length<=0){d.value={...d.value,total:0},ke(i,"未找到记录");return}w.value=[];const L=d.value.pageSize*(d.value.current-1);let V=1;U.forEach(A=>{var J;const M=A;M.index=L+V++,(J=w.value)==null||J.push(M)}),d.value={...d.value,total:$.data.total_count}}else j&&F(i,$.code)}catch(h){console.error(h),F(i,Fe())}finally{g.value=!1}},C=async y=>{await n.push({query:{...l.query,page:y.current,page_size:y.pageSize}})};return me(async()=>{g.value=!0,o=Le(()=>l.query,y=>{switch(b.type&&m[b.type]?(f.value=m[b.type].header,S.value=m[b.type].content):(f.value=m.all.header,S.value=m.all.content),b.type){case"all":s.value=T.concat(I);break;default:s.value=T.concat(v);break}const j=parseInt(y.page)||d.value.defaultCurrent,h=parseInt(y.page_size)||d.value.defaultPageSize;_=j,c=h,d.value={...d.value,current:_,pageSize:c},z({current:_,pageSize:c},!0)},{immediate:!0})}),Ve(()=>{o&&o()}),(y,j)=>{const h=Re,x=be,$=xe,U=Pe;return D(),E(U,null,{default:a(()=>[t($,{span:9},{default:a(()=>[t(x,{style:{margin:"10px"}},{default:a(()=>[t(h,{data:w.value,columns:s.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:d.value,loading:g.value,"table-layout":"auto",onPageChange:C},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t($,{span:3},{default:a(()=>[R("div",Ur,[t(x,{class:"sh-card",header:f.value,"header-bordered":!0},{default:a(()=>[P(q(S.value),1)]),_:1},8,["header"])])]),_:1})]),_:1})}}}),st=ue(zr,[["__scopeId","data-v-13682529"]]),Ar={style:{display:"flex","align-items":"center"}},Rr={style:{color:"#409eff","margin-right":"20px"}},Mr={class:"dida-login-footer"},Er=ie({__name:"UserForget",setup(e){const{globalProperties:l}=pe(),n=qe(),i=p(!1),o=p(!1),b=p(!1),f=p("发送验证码");let S=null,m=-1;const s=p(!1),T=p(null),v=p(""),I=p({username:"",emailKey:"",password:"",confirmPassword:""}),_=p({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:z=>new Promise(C=>{const y=setTimeout(()=>{C(I.value.password===z),clearTimeout(y)})}),message:"两次密码不一致"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),c=()=>{ke(l,"重置成功")},d=async z=>{if(!b.value){i.value=!0,o.value=!0;try{const C=await Gn(z,I.value.username);C.code===0?(ke(l,"验证码发送成功"),v.value=C.data,o.value=!1,b.value=!0,S=new Date,f.value="60秒后重发",m=setInterval(()=>{const j=Math.floor((new Date().getTime()-(S==null?void 0:S.getTime()))/1e3);j>60?(f.value="发送验证码",b.value=!1,clearInterval(m)):f.value=`${60-j}秒后重发`},1e3)):F(l,C.code)}catch(C){console.error("Send email key error",C),ve(l,"发送验证码失败")}finally{i.value=!1}}},w=async()=>{var j;if(s.value=!0,b.value||o.value)return;await ct();const z=document.getElementById("cf-confirm-div");z&&z.remove();const C=document.createElement("div");C.id="cf-confirm-div",C.setAttribute("data-theme","light"),(j=T.value)==null||j.appendChild(C);const y=window;y.turnstile.ready(function(){y.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(h){s.value=!1,await d(h)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},k=p(()=>t(O,{onClick:w,disabled:b.value,loading:o.value,style:"width:120px"},{default:()=>[f.value]})),u=async()=>{i.value=!0;try{const z=await Nn(I.value.username,I.value.password,I.value.emailKey);z.code===0?(ke(l,"密码修改成功"),l.$router.push({name:"login"})):F(l,z.code)}catch(z){console.error("Modify password error",z),ve(l,"修改密码失败")}finally{i.value=!1}},r=async({validateResult:z,firstError:C,e:y})=>{if(!i.value){if(y.preventDefault(),z!==!0){ve(l,C);return}v.value?await u():await w()}};return me(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),Ve(()=>{}),(z,C)=>{const y=Ct,j=Ue,h=$e,x=ha,$=O,U=je,L=lt,V=be,A=nt;return D(),le(de,null,[t(V,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(y,{"max-line":1},{default:a(()=>C[6]||(C[6]=[R("span",null,"如果您未绑定邮箱或忘记用户名，可联系管理员寻求帮助",-1),R("span",null,"管理员邮箱：BoilTask@qq.com",-1)])),_:1}),t(y,{style:{"margin-top":"10px"}},{default:a(()=>C[7]||(C[7]=[R("p",null,"支持原acm.hpu.edu.cn、CodeOJ的用户直接登录",-1),R("p",null,"原DMOJ、hpuoj.com的用户，请先重置密码",-1),R("p",null,"可尝试学号/昵称等作为用户名登录，成功后有机会合并账户或修改用户名",-1)])),_:1}),t(U,{ref:"form",rules:_.value,data:I.value,colon:!0,onReset:c,onSubmit:r,class:"yj-login-form"},{default:a(()=>[t(h,{name:"username",label:"用户名"},{default:a(()=>[t(j,{modelValue:I.value.username,"onUpdate:modelValue":C[0]||(C[0]=M=>I.value.username=M),clearable:"",placeholder:"请输入完整用户名"},null,8,["modelValue"])]),_:1}),v.value?(D(),le(de,{key:0},[t(h,{name:"email",label:"发送邮箱"},{default:a(()=>[t(x,{append:k.value},{default:a(()=>[R("div",Ar,[R("span",Rr,q(v.value),1)])]),_:1},8,["append"])]),_:1}),t(h,{name:"emailKey",label:"验证码"},{default:a(()=>[t(j,{modelValue:I.value.emailKey,"onUpdate:modelValue":C[1]||(C[1]=M=>I.value.emailKey=M),clearable:"",placeholder:"请输入收到的验证码"},null,8,["modelValue"])]),_:1}),t(h,{name:"password",label:"新密码"},{default:a(()=>[t(j,{modelValue:I.value.password,"onUpdate:modelValue":C[2]||(C[2]=M=>I.value.password=M),type:"password",clearable:"",placeholder:"新密码"},null,8,["modelValue"])]),_:1}),t(h,{name:"confirmPassword",label:"确认密码"},{default:a(()=>[t(j,{modelValue:I.value.confirmPassword,"onUpdate:modelValue":C[3]||(C[3]=M=>I.value.confirmPassword=M),type:"password",clearable:"",placeholder:"请重复输入密码"},null,8,["modelValue"])]),_:1})],64)):oe("",!0),v.value?(D(),E(h,{key:1},{default:a(()=>[t($,{theme:"primary",type:"submit",block:"",loading:i.value},{default:a(()=>C[8]||(C[8]=[P("修改密码")])),_:1},8,["loading"])]),_:1})):(D(),E(h,{key:2},{default:a(()=>[t($,{theme:"primary",type:"submit",block:"",loading:i.value},{default:a(()=>C[9]||(C[9]=[P("重置密码")])),_:1},8,["loading"])]),_:1}))]),_:1},8,["rules","data"]),R("div",Mr,[t(L,{onClick:C[4]||(C[4]=()=>{fe(l).$router.push({name:"login"})})},{default:a(()=>C[10]||(C[10]=[P("返回登陆 ")])),_:1})])]),_:1}),t(A,{visible:s.value,"onUpdate:visible":C[5]||(C[5]=M=>s.value=M),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:a(()=>[R("div",{ref_key:"dialogContainer",ref:T,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),qr=ue(Er,[["__scopeId","data-v-e960b193"]]),Kr={class:"judger-status-panel"},Fr={class:"judger-status-panel"};function Or(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const Gr=ie({__name:"SystemStatus",setup(e){const{globalProperties:l}=pe(),n=p([]),i=p([]),o=p(!1);let b;const f=s=>{let T="失效",v="danger";const I=new Date,g=new Date(s.updateTime);return I.getTime()-g.getTime()>3e4?(T="离线",v="default"):s.cpuUsage>90?(T="CPU过高",v="warning"):s.memPercent>90?(T="内存过高",v="warning"):(T="在线",v="success"),t(we,null,{default:()=>[t("span",null,[s.key,P(" - "),s.name]),t("span",null,[s.updateTime]),t(tt,{theme:v,size:"small"},Or(T)?T:{default:()=>[T]})]})},S=async()=>{const s={};for(let k=0;k<n.value.length;k++){const u=n.value[k];s[u.key]={...u}}const T={};for(let k=0;k<i.value.length;k++){const u=i.value[k];T[u.key]={...u}}const v=[],I=[],g=await Xl();if(g.code!==0){F(l,g.code);return}const _=g.data.web,c={key:"didaoj"};_.name?c.name=_.name:c.name="-",_.update_time?c.updateTime=new Date(_.update_time).toLocaleString():c.updateTime="-",_.cpu_usage?c.cpuUsage=Number(_.cpu_usage):c.cpuUsage=0,_.mem_usage?c.memUsage=_.mem_usage/(1024*1024*1024):c.memUsage=0,_.mem_total?c.memTotal=_.mem_total/(1024*1024*1024):c.memTotal=0,c.memTotal>0?c.memPercent=Math.round(c.memUsage/c.memTotal*1e4)/100:c.memPercent=0,c.avgMessage=_.avg_message;const d=s[c.key];d?(c.cpuUsageFrom=d.cpuUsage,c.memPercentFrom=d.memPercent,c.memUsageFrom=d.memUsage,c.memTotalFrom=d.memTotal):(c.cpuUsageFrom=0,c.memPercentFrom=0,c.memUsageFrom=0,c.memTotalFrom=0),v.push(c),n.value=v;const w=g.data.judger;for(let k=0;k<w.length;k++){const u=w[k],r={key:u.key,name:u.name};u.name?r.name=u.name:r.name="-",u.update_time?r.updateTime=new Date(u.update_time).toLocaleString():r.updateTime="-",u.cpu_usage?r.cpuUsage=Number(u.cpu_usage):r.cpuUsage=0,u.mem_usage?r.memUsage=u.mem_usage/(1024*1024*1024):r.memUsage=0,u.mem_total?r.memTotal=u.mem_total/(1024*1024*1024):r.memTotal=0,r.memTotal>0?r.memPercent=Math.round(r.memUsage/r.memTotal*1e4)/100:r.memPercent=0,r.avgMessage=u.avg_message,T[u.key]?(r.cpuUsageFrom=T[u.key].cpuUsage,r.memPercentFrom=T[u.key].memPercent,r.memUsageFrom=T[u.key].memUsage,r.memTotalFrom=T[u.key].memTotal):(r.cpuUsageFrom=0,r.memPercentFrom=0,r.memUsageFrom=0,r.memTotalFrom=0),I.push(r)}i.value=I},m=async()=>{await S(),o.value=!1};return me(async()=>{i.value=[],n.value=[],o.value=!0,await m(),b=setInterval(()=>{m()},5e3)}),Ve(()=>{clearInterval(b)}),(s,T)=>{const v=Tl,I=we,g=be,_=Te;return D(),E(_,{loading:o.value},{default:a(()=>[t(g,{title:"接口状态",class:"judger-status"},{default:a(()=>[R("div",Kr,[(D(!0),le(de,null,Ie(n.value,c=>(D(),E(g,{key:c.key,header:()=>f(c),class:"judge-status-judger"},{footer:a(()=>[R("span",null," 负载信息："+q(c.avgMessage),1)]),default:a(()=>[t(I,{class:"judge-status-judger"},{default:a(()=>[t(v,{title:"CPU使用率",value:c.cpuUsage,animation:{valueFrom:c.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(v,{title:"内存使用率",value:c.memPercent,animation:{valueFrom:c.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(v,{title:"内存使用量",animation:{valueFrom:c.memUsageFrom,duration:2e3},"animation-start":!0,value:c.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(v,{title:"内存总量",value:c.memTotal,animation:{valueFrom:c.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1}),t(g,{title:"判题机状态",class:"judger-status"},{default:a(()=>[R("div",Fr,[(D(!0),le(de,null,Ie(i.value,c=>(D(),E(g,{key:c.key,header:()=>f(c),class:"judge-status-judger"},{footer:a(()=>[R("span",null," 负载信息："+q(c.avgMessage),1)]),default:a(()=>[t(I,{class:"judge-status-judger"},{default:a(()=>[t(v,{title:"CPU使用率",value:c.cpuUsage,animation:{valueFrom:c.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(v,{title:"内存使用率",value:c.memPercent,animation:{valueFrom:c.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(v,{title:"内存使用量",animation:{valueFrom:c.memUsageFrom,duration:2e3},"animation-start":!0,value:c.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(v,{title:"内存总量",value:c.memTotal,animation:{valueFrom:c.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1})]),_:1},8,["loading"])}}}),Nr=ue(Gr,[["__scopeId","data-v-d2b0a05b"]]),Hr=ie({__name:"ManageJudge",setup(e){const{globalProperties:l}=pe(),n=p(!1),i=p(!1),o=p({problemId:"",language:void 0,status:void 0}),b=p(!1),f=p([]);f.value=Ot();const S=p([]);S.value=Va();const m=async()=>{n.value=!0;try{const v=await rn();if(v.code!==0){F(l,v.code);return}ke(l,"重判成功"),await Y.push({name:"judge-list"})}catch(v){console.error(v),F(l,"重判失败")}finally{n.value=!1}},s=async()=>{if(!o.value.problemId&&!o.value.language&&!o.value.status){F(l,"请输入问题Id");return}b.value=!0;try{const v=await un(o.value.problemId,o.value.language,o.value.status);if(v.code!==0){F(l,v.code);return}ke(l,"重判成功"),await Y.push({name:"judge-list",query:{problem_id:o.value.problemId,language:o.value.language}})}catch(v){console.error(v),F(l,"重判失败")}finally{b.value=!1}},T=async()=>{i.value=!0;try{const v=await dn();if(v.code!==0){F(l,v.code);return}ke(l,"重判成功"),await Y.push({name:"judge-list"})}catch(v){console.error(v),F(l,"重判失败")}finally{i.value=!1}};return(v,I)=>{const g=O,_=be,c=Ue,d=$e,w=Kt,k=pt,u=we,r=je;return D(),le(de,null,[t(_,{class:"yj-manage-card",title:"重判最近提交"},{default:a(()=>[t(g,{onClick:m,loading:n.value},{default:a(()=>I[3]||(I[3]=[P("重判")])),_:1},8,["loading"])]),_:1}),t(_,{class:"yj-manage-card",title:"重判指定记录"},{default:a(()=>[t(r,{layout:"inline",onSubmit:s},{default:a(()=>[t(d,{label:"题号"},{default:a(()=>[t(c,{modelValue:o.value.problemId,"onUpdate:modelValue":I[0]||(I[0]=z=>o.value.problemId=z),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(d,{label:"语言"},{default:a(()=>[t(k,{modelValue:o.value.language,"onUpdate:modelValue":I[1]||(I[1]=z=>o.value.language=z),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:a(()=>[(D(!0),le(de,null,Ie(f.value,z=>(D(),E(w,{key:z.value,value:z.value,label:z.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"状态"},{default:a(()=>[t(k,{modelValue:o.value.status,"onUpdate:modelValue":I[2]||(I[2]=z=>o.value.status=z),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:a(()=>[(D(!0),le(de,null,Ie(S.value,z=>(D(),E(w,{key:z.value,value:z.value,label:z.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(d,null,{default:a(()=>[t(u,null,{default:a(()=>[t(g,{theme:"primary",type:"submit",loading:b.value},{default:a(()=>I[4]||(I[4]=[P("重判")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(_,{class:"yj-manage-card",title:"重判所有"},{default:a(()=>[t(g,{onClick:T,theme:"danger",loading:i.value},{default:a(()=>I[5]||(I[5]=[P("重判")])),_:1},8,["loading"])]),_:1})],64)}}}),Br=ue(Hr,[["__scopeId","data-v-6a706c72"]]),Jr=ie({__name:"ManageWeb",setup(e){const{globalProperties:l}=pe(),n=p({theme:"",content:""}),i=p({title:"",content:""}),o=p(!1),b=p(!1),f=p(!1);async function S(I,g){f.value=!0,await vt(I,g,l,Zl),f.value=!1}const m=async()=>{b.value=!0;try{const I=await Ql(n.value.theme,n.value.content);if(I.code!==0){F(l,I.code);return}ke(l,"保存成功")}catch(I){console.error(I),F(l,"保存失败")}finally{b.value=!1}},s=async()=>{f.value=!0;try{const I=i.value.content,g=await en(i.value.title,I);if(g.code!==0){F(l,g.code);return}i.value.content=g.data.content,ke(l,"保存成功")}catch(I){console.error(I),ve(l,"保存失败")}finally{f.value=!1}},T=async()=>{n.value=await Pa()},v=async()=>{try{i.value=await xa()}catch{ve(l,"加载公告失败"),i.value={title:"",content:""}}};return me(async()=>{o.value=!0;try{await T(),await v()}catch{ve(l,"加载数据失败")}o.value=!1}),(I,g)=>{const _=pt,c=$e,d=Ue,w=O,k=we,u=je,r=be,z=Ae("md-editor-v3"),C=Te;return D(),E(C,{loading:o.value},{default:a(()=>[t(r,{class:"yj-manage-card",title:"站点通知"},{default:a(()=>[t(u,{onSubmit:m},{default:a(()=>[t(c,{label:"主题"},{default:a(()=>[t(_,{modelValue:n.value.theme,"onUpdate:modelValue":g[0]||(g[0]=y=>n.value.theme=y),options:[{label:"success",value:"success"},{label:"info",value:"info"},{label:"warning",value:"warning"},{label:"error",value:"error"}],placeholder:"请选择主题"},null,8,["modelValue"])]),_:1}),t(c,{label:"内容"},{default:a(()=>[t(d,{modelValue:n.value.content,"onUpdate:modelValue":g[1]||(g[1]=y=>n.value.content=y),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),t(c,null,{default:a(()=>[t(k,null,{default:a(()=>[t(w,{theme:"primary",type:"submit",loading:b.value},{default:a(()=>g[4]||(g[4]=[P("保存")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(r,{class:"yj-manage-card",title:"首页公告"},{actions:a(()=>[t(w,{theme:"primary",loading:f.value,onClick:s},{default:a(()=>g[5]||(g[5]=[P("保存")])),_:1},8,["loading"])]),default:a(()=>[t(u,{onSubmit:s},{default:a(()=>[t(c,{label:"标题"},{default:a(()=>[t(d,{modelValue:i.value.title,"onUpdate:modelValue":g[2]||(g[2]=y=>i.value.title=y),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1}),t(C,{loading:f.value},{default:a(()=>[t(z,{modelValue:i.value.content,"onUpdate:modelValue":g[3]||(g[3]=y=>i.value.content=y),onSave:s,onOnUploadImg:S,previewTheme:"cyanosis",class:"dida-description-editor"},null,8,["modelValue"])]),_:1},8,["loading"])]),_:1})]),_:1},8,["loading"])}}}),Wr=ue(Jr,[["__scopeId","data-v-4d343ab4"]]),qa=[{name:"problem-list",tab:"problem",sidebar:"problem-list",path:"",title:"问题列表",icon:"list",component:mo},{name:"problem-detail",tab:"problem",sidebar:"problem-list",path:":problemId+",title:"问题详情",icon:"list",component:jt},{name:"problem-daily-list",tab:"problem",sidebar:"problem-daily-list",path:"daily",title:"每日一题",icon:"list",component:Ko},{name:"problem-daily-detail",tab:"problem",sidebar:"problem-daily-list",path:"daily/:dailyId+",title:"问题详情",icon:"list",component:jt},{name:"problem-recommend",tab:"problem",sidebar:"problem-recommend",path:"recommend/:problemId*",title:"问题推荐",icon:"cpu",needLogin:!0,component:Wo},{name:"problem-collection-list",tab:"problem",sidebar:"problem-collection-list",path:"collection",title:"题目集合",icon:"list",disableTabPath:!0,component:gs},{name:"collection-detail",tab:"collection-detail-tab",sidebar:"collection-detail",path:":collectionId+",title:"题集详情",icon:"cpu",component:ks},{name:"collection-rank",tab:"collection-detail-tab",sidebar:"collection-rank",path:":collectionId+/rank",title:"题集排名",icon:"list",component:Ss},{name:"collection-edit",tab:"collection-detail-tab",sidebar:"collection-edit",disableSidebar:!0,needLogin:!0,path:":collectionId+/edit",title:"题集编辑",icon:"list",component:na},{name:"collection-create",tab:"collection-detail-tab",sidebar:"collection-create",needLogin:!0,disableSidebar:!0,path:"create",title:"新建题集",icon:"list",component:na},{name:"judge-list",tab:"judge",sidebar:"judge-list",path:"",title:"评测列表",icon:"list",component:sa},{name:"judge-detail",tab:"judge",sidebar:"judge-list",path:":judgeId+",title:"评测详情",icon:"cpu",component:ia},{name:"contest-list",tab:"contest",sidebar:"contest-list",path:"",title:"比赛列表",icon:"list",component:ua},{name:"contest-recent",tab:"contest",sidebar:"contest-recent",path:"recent",title:"近期比赛",icon:"list",component:ua},{name:"contest-create",tab:"contest",sidebar:"contest-create",disableSidebar:!0,needLogin:!0,path:"create",title:"新建比赛",icon:"list",component:ca},{name:"contest-edit",tab:"contest-detail-tab",sidebar:"contest-edit",disableSidebar:!0,needLogin:!0,path:":contestId+/edit",title:"比赛编辑",icon:"list",component:ca},{name:"contest-detail",tab:"contest-detail-tab",sidebar:"contest-detail",path:":contestId+",title:"比赛详情",icon:"cpu",component:Bs},{name:"contest-problem-detail",tab:"contest-detail-tab",sidebar:"contest-problem-detail",path:":contestId+/problem/:problemIndex+",title:"问题详情",icon:"cpu",disableSidebar:!0,component:jt},{name:"contest-judge",tab:"contest-detail-tab",sidebar:"contest-judge",path:":contestId+/judge",title:"评测列表",icon:"list",component:sa},{name:"contest-judge-detail",tab:"contest-detail-tab",sidebar:"contest-judge-detail",path:":contestId+/judge/:judgeId+",title:"评测详情",icon:"cpu",component:ia,disableSidebar:!0},{name:"contest-rank",tab:"contest-detail-tab",sidebar:"contest-rank",path:":contestId+/rank",title:"比赛排名",icon:"list",component:Qs},{name:"contest-discuss",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss",title:"比赛讨论",icon:"list",component:$t},{name:"contest-discuss-detail",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss/:discussId+",title:"讨论详情",icon:"list",component:Ut},{name:"discuss-list",tab:"discuss",sidebar:"discuss-list",path:"",title:"讨论列表",icon:"list",component:$t},{name:"discuss-create",tab:"discuss",sidebar:"discuss-create",disableSidebar:!0,needLogin:!0,path:"create",title:"新建讨论",icon:"list",component:ma},{name:"discuss-edit",tab:"discuss-detail-tab",sidebar:"discuss-edit",disableSidebar:!0,needLogin:!0,path:":discussId+/edit",title:"编辑讨论",icon:"list",component:ma},{name:"discuss-list-problem",tab:"discuss",sidebar:"discuss-list-problem",path:"problem",title:"题目讨论",icon:"list",component:$t},{name:"discuss-detail",tab:"discuss",sidebar:"discuss-list",path:":discussId+",title:"讨论详情",icon:"list",component:Ut},{name:"rank-ac-all",tab:"rank",sidebar:"rank-ac-all",path:"ac",title:"AC排名",icon:"base-station",props:{type:"all"},component:st},{name:"rank-ac-problem",tab:"rank",sidebar:"rank-ac-problem",path:"ac/problem",title:"题量排名",icon:"base-station",props:{type:"problem"},component:st},{name:"rank-ac-problem-today",tab:"rank",sidebar:"rank-ac-problem-today",path:"ac/problem/today",title:"今日题量",icon:"base-station",props:{type:"problem-today"},component:st},{name:"rank-ac-problem-day7",tab:"rank",sidebar:"rank-ac-problem-day7",path:"ac/problem/day7",title:"7日题量",icon:"base-station",props:{type:"problem-day7"},component:st},{name:"rank-ac-problem-day30",tab:"rank",sidebar:"rank-ac-problem-day30",path:"ac/problem/day30",title:"30日题量",icon:"base-station",props:{type:"problem-day30"},component:st},{name:"rank-ac-problem-year",tab:"rank",sidebar:"rank-ac-problem-year",path:"ac/problem/year",title:"1年题量",icon:"base-station",props:{type:"problem-year"},component:st},{name:"system-status",tab:"system",sidebar:"system-status",path:"",title:"运行状态",icon:"base-station",component:Nr},{name:"system-about",tab:"system",sidebar:"system-about",path:"about",title:"关于",icon:"base-station",props:{discussId:"52"},component:Ut},{name:"manage-problem-create",tab:"manage",sidebar:"manage-problem-create",disableSidebar:!0,path:"problem",title:"新建问题",icon:"list",component:la,auths:[ze.ManageProblem]},{name:"manage-problem",tab:"manage",sidebar:"manage-problem",disableSidebar:!0,path:"problem/:problemId+",title:"问题编辑",icon:"list",component:la,auths:[ze.ManageProblem]},{name:"manage-problem-daily-create",tab:"manage",sidebar:"manage-problem-daily-create",disableSidebar:!0,path:"problem/daily",title:"新建每日一题",icon:"list",component:aa,auths:[ze.ManageProblemDaily]},{name:"manage-problem-daily",tab:"manage",sidebar:"manage-problem-daily",disableSidebar:!0,path:"problem/daily/:dailyId+",title:"编辑每日一题",icon:"list",component:aa,auths:[ze.ManageProblemDaily]},{name:"manage-problem-judge",tab:"manage",sidebar:"manage-problem-judge",disableSidebar:!0,path:"problem/:problemId+/judge",title:"评测数据",icon:"list",component:ss,auths:[ze.ManageProblem]},{name:"manage-web",tab:"manage",path:"web",sidebar:"manage-web",title:"站点管理",icon:"list",auths:[ze.ManageWeb],component:Wr},{name:"manage-judge",tab:"manage",path:"judge",sidebar:"manage-judge",title:"评测管理",icon:"list",auths:["i-manage-judge"],component:Br},{name:"login-forget",tab:"login",path:"forget",title:"忘记密码",component:qr}],pa=(e,l,n,i)=>{i.tab==n&&(i.disableSidebar&&l!=i.sidebar||i.sidebar==null||i.sidebar!=i.name||e.push({name:i.name,title:i.title,icon:i.icon,to:{name:i.name}}))},Yr=(e,l)=>{const n=[];return qa.forEach(i=>{if(Aa(i)){const o=[];i.children.forEach(b=>{pa(o,e,l,b)}),o.length>0&&n.push({title:i.title,children:o})}else pa(n,e,l,i)}),n},fa=(e,l)=>{const n=lo(l.tab),i={name:l.name,path:"/"+l.path,meta:{title:l.title+" - "+n.title,tab:l.tab,sidebar:l.sidebar,showSidebar:n.showSidebar,needLogin:n.needLogin||l.needLogin,tabAuths:n.auths,auths:l.auths},props:l.props,component:l.component};!n.disablePath&&!l.disableTabPath&&(i.path=n.path+i.path),e.push(i)},Xr=e=>{qa.forEach(l=>{Aa(l)?l.children.forEach(n=>{fa(e,n)}):fa(e,l)})},Zr={class:"sh-main"},Qr=ie({__name:"View403",setup(e){let l=Se();const n=p("");return me(()=>{l.query.target?n.value=l.query.target:n.value=l.fullPath}),(i,o)=>{const b=O;return D(),le("div",Zr,[R("p",null,q(n.value),1),o[2]||(o[2]=R("p",null,"该页面无访问权限，请更换访问目标或重新登陆后再试",-1)),t(b,{theme:"primary",onClick:o[0]||(o[0]=()=>i.$router.push("/"))},{default:a(()=>o[1]||(o[1]=[P("返回首页")])),_:1})])}}}),Ka=ue(Qr,[["__scopeId","data-v-8f62f1f8"]]),gt=[];oo(gt);Xr(gt);gt.push({path:"/403",name:"403",component:Ka});gt.push({path:"/:pathMatch(.*)*",name:"404",component:za});const Y=ol({history:sl("/"),routes:gt});Y.beforeEach((e,l,n)=>{if(e.name==null||!Y.hasRoute(e.name)){n({name:"home"});return}const i=e.matched[e.matched.length-1].meta;if(i.redirect){n({name:i.redirect});return}if(i.needLogin){const b=qe();if(b.getToken==null||b.getToken==""){n({name:"login",query:{redirect_uri:e.fullPath}});return}}const o=i.tabAuths;if(o&&!qe().hasAllAuths(o)){n({name:"403",query:{target:e.fullPath}});return}n()});Y.afterEach((e,l)=>{if(e.name===l.name)return;const n=Pt(),i=Ye();let o=null;if(e.matched.length>0&&(o=e.matched[e.matched.length-1].meta),o!=null&&o.title&&i.setTitle(o==null?void 0:o.title),o!=null&&o.showSidebar){n.setSidebarShow(!0);const b=Yr(o==null?void 0:o.sidebar,o==null?void 0:o.tab);n.setMenuList(b),n.setMenuActiveName(o==null?void 0:o.sidebar)}else n.setSidebarShow(!1);window.scrollTo(0,0)});const Fa=mt("login",{state:()=>({Loaded:!1}),getters:{isLoaded(){return this.Loaded}}}),ei=ie({__name:"HeaderContent",setup(e){const l=Fa(),n=qe(),{globalProperties:i}=pe(),o=p(l.isLoaded),b=p(!1),f=p(n.getUsername),S=p(n.getNickname),m=p(),s=()=>{m.value=no(n)};l.$subscribe((I,g)=>{o.value=g.Loaded}),n.$subscribe((I,g)=>{f.value=g.username,S.value=g.nickname,b.value=g.token!="",s()});const T=()=>{i.$router.currentRoute.value.name!=="login"&&i.$router.push({name:"login",query:{redirect_uri:i.$router.currentRoute.value.fullPath}})},v=()=>{n.clear(),i.$message.success({duration:3e3,content:"注销成功"}),i.$router.push({path:"/login",query:{redirect_uri:i.$router.currentRoute.value.fullPath}})};return me(()=>{s()}),(I,g)=>{const _=Ae("router-link"),c=Ca,d=Sa,w=Vl,k=Dl;return D(),E(k,{modelValue:I.$route.meta.tab,"onUpdate:modelValue":g[0]||(g[0]=u=>I.$route.meta.tab=u),class:"sh-menu","expand-type":"popup"},{logo:a(()=>[t(_,{to:"/",class:"sh-logo"},{default:a(()=>g[1]||(g[1]=[P("DidaOJ")])),_:1})]),operations:a(()=>[o.value&&b.value?(D(),E(w,{key:0,title:S.value},{icon:a(()=>[t(c,{name:"user"})]),default:a(()=>[t(d,{value:"user",to:{path:"/user/"+f.value}},{default:a(()=>g[2]||(g[2]=[P("个人空间")])),_:1},8,["to"]),t(d,{value:"user_logout",onClick:v},{default:a(()=>g[3]||(g[3]=[P(" 注销")])),_:1})]),_:1},8,["title"])):o.value?(D(),E(d,{key:2,value:"login",onClick:T},{icon:a(()=>[t(c,{name:"login"})]),default:a(()=>[g[5]||(g[5]=P(" 登录 "))]),_:1})):(D(),E(d,{key:1,value:"login"},{icon:a(()=>[t(c,{name:"login"})]),default:a(()=>[g[4]||(g[4]=P(" ... "))]),_:1}))]),default:a(()=>[(D(!0),le(de,null,Ie(m.value,u=>(D(),E(d,{key:u.name,value:u.name,to:{name:u.name}},{icon:a(()=>[u.icon?(D(),E(c,{key:0,name:u.icon},null,8,["name"])):oe("",!0)]),default:a(()=>[P(" "+q(u.title),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])}}}),ti=ue(ei,[["__scopeId","data-v-cdf693c2"]]),ai={id:"menu-container"},li=ie({__name:"SidebarContent",setup(e){const l=Pt(),n=p(!1),i=p(null),o=p(l.menuActiveName),b=p(l.menuList),f=p([]),S=p(!1),m=()=>{o.value=l.menuActiveName;const T=JSON.stringify(b.value),v=JSON.stringify(l.menuList);T!==v&&(f.value.push([...l.menuList]),s())},s=async()=>{if(f.value.length>0&&!S.value){for(S.value=!0;f.value.length>1;)f.value.shift();const T=f.value.shift();n.value=T.length<=0,b.value=[],await ct(),i.value&&i.value.updateActiveName(),await new Promise(I=>setTimeout(I,300)),b.value=T,await ct(),i.value&&i.value.updateActiveName();const v=300;await new Promise(I=>setTimeout(I,v)),S.value=!1,await s()}};return l.$subscribe((T,v)=>{m()}),me(()=>{m()}),(T,v)=>{const I=Ca,g=Sa,_=jl,c=Ll,d=Te;return D(),le(de,null,[R("div",ai,[t(c,{modelValue:o.value,"onUpdate:modelValue":v[0]||(v[0]=w=>o.value=w),theme:"light",class:"sh-menu-container"},{default:a(()=>[t(rl,{name:"move-left"},{default:a(()=>[(D(!0),le(de,null,Ie(b.value,(w,k)=>(D(),le(de,{key:k},[fe(so)(w)?(D(),E(_,{key:0,title:w.title},{default:a(()=>[(D(!0),le(de,null,Ie(w.children,(u,r)=>(D(),E(g,{key:u.name,value:u.name,to:u.to},Zt({default:a(()=>[P(" "+q(u.title),1)]),_:2},[u.icon?{name:"icon",fn:a(()=>[t(I,{name:u.icon,class:Mt(u.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))),128))]),_:2},1032,["title"])):(D(),E(g,{key:w.name,value:w.name,to:w.to},Zt({default:a(()=>[P(" "+q(w.title),1)]),_:2},[w.icon?{name:"icon",fn:a(()=>[t(I,{name:w.icon,class:Mt(w.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),t(d,{size:"small",loading:n.value,"show-overlay":!0,attach:"#menu-container",class:"sh-sidebar-loading",style:{"align-items":"flex-start","padding-top":"100px"}},null,8,["loading"])],64)}}}),ni=ue(li,[["__scopeId","data-v-96e2d89f"]]),oi={};function si(e,l){return null}const ri=ue(oi,[["render",si]]),ii={class:"footer"},ui={class:"footer-left"},di={class:"foot-time"},ci={class:"footer-center"},mi={href:"https://beiancx.miit.gov.cn/",target:"_blank"},pi={class:"footer-right"},fi={class:"foot-text"},vi={href:"https://github.com/hpu-developer/DiDaOJ-web",target:"_blank"},_i={class:"foot-text"},gi={href:"https://github.com/hpu-developer/DiDaOJ-go",target:"_blank"},bi=ie({__name:"FooterContent",setup(e){const l=p("");function n(){l.value=new Date().toLocaleString()}return me(()=>{n(),setInterval(()=>{n()},1e3)}),(i,o)=>{const b=O;return D(),le("div",ii,[R("div",ui,[R("p",di,q(l.value),1)]),R("div",ci,[R("a",mi,[t(b,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>o[0]||(o[0]=[P("豫ICP备15024677号-4")])),_:1})])]),R("div",pi,[R("p",fi,[R("a",vi,[t(b,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>o[1]||(o[1]=[P("@didaoj-web")])),_:1})])]),R("p",_i,[R("a",gi,[t(b,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>o[2]||(o[2]=[P("@didaoj-go")])),_:1})])])])])}}}),hi=ue(bi,[["__scopeId","data-v-44f2e4e7"]]),bt=20,At=100,Rt=50,yi=ie({__name:"ForceHiddenSidebarButton",setup(e){let l=Pt();const n=p({x:window.innerWidth-At-bt,y:window.innerHeight-Rt-bt}),i=p(window.innerWidth),o=p(window.innerHeight);let b=!1,f={x:0,y:0};const S=w=>{b=!0;const k=w.clientX??w.touches[0].clientX,u=w.clientY??w.touches[0].clientY;f={x:k-n.value.x,y:u-n.value.y},document.addEventListener("mousemove",m),document.addEventListener("touchmove",m),document.addEventListener("mouseup",s),document.addEventListener("touchend",s)},m=w=>{if(!b)return;const k=w.clientX??w.touches[0].clientX,u=w.clientY??w.touches[0].clientY;let r=k-f.x,z=u-f.y;r=Math.max(0,Math.min(r,i.value-At)),z=Math.max(0,Math.min(z,o.value-Rt)),n.value={x:r,y:z}},s=()=>{b=!1,document.removeEventListener("mousemove",m),document.removeEventListener("touchmove",m),document.removeEventListener("mouseup",s),document.removeEventListener("touchend",s)},T=()=>{i.value=window.innerWidth,o.value=window.innerHeight,n.value={x:Math.min(n.value.x,i.value-At-bt),y:Math.min(n.value.y,o.value-Rt-bt)}};let v=p(l.forceHiddenSidebar),I=p(l.forceHiddenSidebar);const g=()=>{v.value=!v.value,l.setForceHiddenSidebar(v.value)},_=()=>{I.value||(I.value=!0,l.setForceHiddenSidebar(v.value))},c=()=>{I.value&&(I.value=!1,l.setForceHiddenSidebar(!1))},d=w=>{w>=800?c():_()};return d(i.value),Le(i,w=>{d(w)}),me(()=>{window.addEventListener("resize",T)}),Ve(()=>{window.removeEventListener("resize",T)}),(w,k)=>{const u=O;return fe(I)?(D(),E(u,{key:0,class:"draggable-button",style:_a({top:`${n.value.y}px`,left:`${n.value.x}px`}),onMousedown:S,onTouchstart:S,variant:"dashed",theme:"primary",onClick:g},{default:a(()=>[P(q(fe(v)?"显示":"隐藏"),1)]),_:1},8,["style"])):oe("",!0)}}}),wi=ue(yi,[["__scopeId","data-v-1aee5506"]]),ht="DidaOJ",ki=ie({__name:"App",setup(e){const{globalProperties:l}=pe(),n=Fa(),i=qe(),o=Ye(),b=Pt();n.$patch({Loaded:!1});const f=i.getToken,S=p(!1),m=p(!1);o.title&&o.title.length>0?document.title=o.title+" - "+ht:document.title=ht,o.$subscribe((g,_)=>{_.title&&_.title.length>0?document.title=_.title+" - "+ht:document.title=ht}),b.$subscribe((g,_)=>{S.value=_.showSidebar,m.value=S.value&&!_.forceHiddenSidebar});const s=Se(),T=Ne(()=>{const g=s.meta.auths;return g?!i.hasAllAuths(g):!1});function v(){l.$message.warning({duration:3e3,content:"登陆状态失效"}),n.$patch({Loaded:!0}),i.clear()}const I=async()=>{const g=document.querySelectorAll("oj-problem");if(g.length===0)return;let _={};g.forEach(w=>{const k=w.getAttribute("id"),u=document.createElement("span");u.setAttribute("style","padding:5px"),w.replaceWith(u);const r=p("default");_[k]||(_[k]=[]),_[k].push(r);let z=k;k&&!k.includes("-")&&(z="DidaOJ-"+k),ba({render:()=>dl(O,{innerHTML:z,onClick:()=>{window.open(`/problem/${k}`,"_blank")},size:"small",variant:"outline",theme:r.value})}).mount(u)});const c=[];for(const w in _)c.push(w);const d=await hn(c);if(d.code===0)for(const w in _){const k=_[w];if(!k)continue;let u="primary";const r=d.data[w];if(r)switch(r){case Ke.Accept:u="success";break;case Ke.Attempt:u="warning";break}for(const z of k)z.value=u}};return me(()=>{document.addEventListener("DOMContentLoaded",()=>{new MutationObserver(()=>{ql(()=>{I()},1e3)()}).observe(document.body,{childList:!0,subtree:!0}),il.autoSpacingPage()}),f?Rn().then(g=>{g.code==0?(i.loadResponse(g.data),n.$patch({Loaded:!0})):(F(l,g.code),n.$patch({Loaded:!0}),i.clear())}).catch(g=>{console.log(g),v()}):n.$patch({Loaded:!0})}),(g,_)=>{const c=$l,d=zl,w=Ae("RouterView"),k=Al,u=Ul,r=Rl;return D(),le(de,null,[t(u,{class:"sh-app-layout"},{default:a(()=>[t(c,{class:"sh-header"},{default:a(()=>[t(ti)]),_:1}),t(u,null,{default:a(()=>[t(ul,{name:"slide"},{default:a(()=>[m.value?(D(),E(d,{key:0,class:"sh-sidebar"},{default:a(()=>[t(ni)]),_:1})):oe("",!0)]),_:1}),t(u,{class:Mt(["sh-main-layout",{expanded:!m.value}])},{default:a(()=>[t(ri),t(k,{class:"sh-main-content"},{default:a(()=>[T.value?(D(),E(Ka,{key:0})):(D(),E(w,{key:1}))]),_:1}),t(hi)]),_:1},8,["class"])]),_:1})]),_:1}),S.value?(D(),E(wi,{key:0})):oe("",!0),t(r,{container:"body",offset:["24px","80px"],size:"small"})],64)}}}),Si=ue(ki,[["__scopeId","data-v-66c2cfa5"]]);function Ci(e,l={}){const n=/\{\{%\s*(\w+)\s+([^%]+?)\s*%\}\}/g,i=l.renderers||{},o=e.renderer.rules.text??function(b,f){return b[f].content};e.renderer.rules.text=function(b,f,S,m,s){const v=b[f].content;return n.test(v)?v.replace(n,(g,_,c)=>{const d=i[_];if(typeof d=="function"){const w=c.trim().split(/\s+/);return d(w)}else return`<span class="shortcode-${_}">${_}: ${c.trim()}</span>`}):o(b,f,S,m,s)}}function Ii(e,l){const n=/\{\{%\s*(\w+)\s*%\}\}([\s\S]*?)\{\{%\s*\/\1\s*%\}\}/g;e.core.ruler.push("shortcode_color",i=>{for(const o of i.tokens){if(o.type!=="inline")continue;let b=o.content,f=!1;b=b.replace(n,(S,m,s)=>{var v;const T=(v=l.renderers)==null?void 0:v[m];return T?(f=!0,T([],s.trim())):S}),f&&(o.type="html_inline",o.tag="",o.attrs=null,o.content=b,o.children=[])}})}Kl({markdownItConfig(e){e.use(Lt,"align-left",{render(l,n){return l[n].nesting===1?`<div class="sh-align-left">
`:`</div>
`}}),e.use(Lt,"align-center",{render(l,n){return l[n].nesting===1?`<div class="sh-align-center">
`:`</div>
`}}),e.use(Lt,"align-right",{render(l,n){return l[n].nesting===1?`<div class="sh-align-right">
`:`</div>
`}}),e.use(Ci,{renderers:{problem:([l])=>`<oj-problem id="${l}">${l}</oj-problem>`}}),e.use(Ii,{renderers:{red:(l,n)=>`<span class="dida-font-red">${n}</span>`,green:(l,n)=>`<span class="dida-font-green">${n}</span>`,blue:(l,n)=>`<span class="dida-font-blue">${n}</span>`}})},markdownItPlugins(e){return[...e,{type:"linkAttr",plugin:pl,options:{matcher(l){return!l.startsWith("#")},attrs:{target:"_blank"}}}]}});const Oa=cl();Oa.use(ml);const ut=ba(Si);ut.use(Oa);ut.use(Y);ut.use(Ml);ut.use(Fl);ut.use(Ol);ut.mount("#app");Gl().then(()=>{console.log("Text cache reinitialized")}).catch(e=>{console.error("Text cache reinitialization failed",e)});
