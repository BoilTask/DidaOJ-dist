import{bm as Xe,bn as kt,n as te,r as p,o as ne,G as St,bo as J,bp as z,s as t,bq as n,br as R,F as Q,bs as ce,bt as q,bu as E,ap as S,u as Ee,bv as ie,bw as de,aD as oe,g as Zt,bx as Qt,by as Ct,bz as Re,bA as ea,J as we,q as ye,bB as Fe,y as je,c as Le,bC as Ge,bD as st,ac as ta,bE as It,bF as aa,bG as na,bH as Pt,aM as oa,bI as rt,a0 as la,bJ as sa,bK as ra,B as ua,bL as ia}from"./node_modules-x_y3cvPb.js";import{L as _e,C as re,S as pe,a as ca,T as da,b as ge,A as Tt,c as ma,d as pa,e as fa,f as _a,g as Ye,R as ve,B as G,F as ze,h as Ve,I as Ie,D as $e,i as De,j as ga,k as Ze,l as va,m as Pe,n as Lt,O as xt,P as ha,o as jt,p as zt,q as Vt,r as ba,s as ya,t as wa,u as ka,v as Sa,w as Ca,M as $t,x as Dt,y as Ia,H as Pa,z as Ta,E as La,G as xa,J as ja,K as za,N as Va,Q as $a,U as Da}from"./tdesign-vue-next-Hc291Gr-.js";import{V as le}from"./vditor-DArazWIS.js";import{e as vt}from"./monaco-editor-DCUKHC_e.js";import{H as Ra,v as Ua}from"./highlight.js-D9zWiMxS.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const _ of i.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&s(_)}).observe(document,{childList:!0,subtree:!0});function o(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerPolicy&&(i.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?i.credentials="include":l.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(l){if(l.ep)return;l.ep=!0;const i=o(l);fetch(l.href,i)}})();var xe=(e=>(e.Manage="i-manage",e.ManageJudge="i-manage-judge",e.ManageProblem="i-manage-problem",e))(xe||{});const Aa={"r-admin":["i-manage","i-manage-judge","i-manage-problem"]};function Ea(e){if(e==null)return[];const a=[];for(const o of e){const s=Aa[o];s!=null&&a.push(...s)}return[...new Set(a)]}function Fa(e,a){if(e==null||a==null)return!1;const o=Ea(e);for(const s of a)if(!o.includes(s))return!1;return!0}const be=Xe("user",{state:()=>({token:"",userId:-1,username:"",nickname:"",roles:[]}),getters:{getToken(){return this.token},getUserId(){return this.userId},getUsername(){return this.username},getNickname(){return this.nickname}},actions:{clear(){this.$patch({token:"",userId:-1,username:"",nickname:"",roles:[]})},loadResponse(e){this.$patch({token:e.token,userId:e.user_id,username:e.username,nickname:e.nickname,roles:e.roles})},isLogin(){return this.token!=null&&this.token!=""},hasAuth(e){return this.hasAllAuths([e])},hasAllAuths(e){return e?Fa(this.roles,e):!0}},persist:!0}),Te=Xe("webStyle",{state:()=>({title:""}),getters:{getTitle(){return this.title}},actions:{setTitle(e){this.title=e}}}),Qe=Xe("sidebarStyle",{state:()=>({showSidebar:!1,forceHiddenSidebar:!1,menuActiveName:"",menuList:[]}),getters:{getMenuList(){return this.menuList}},actions:{setSidebarShow(e){this.showSidebar=e},setForceHiddenSidebar(e){this.forceHiddenSidebar=e},setMenuActiveName(e){this.menuActiveName=e},clearMenuList(){this.menuList=[]},setMenuList(e){this.menuList=e},addMenuList(e){this.menuList.push(e)}}}),Ke=kt.create({timeout:6e4,withCredentials:!1,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});Ke.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function Ma(){return Ke({baseURL:"https://r2-oj.didapipa.com",url:"/system/notification.json?"+Date.now(),method:"get"})}function qa(){return Ke({baseURL:"https://r2-oj.didapipa.com",url:"/status/judger.json?"+Date.now(),method:"get"})}function Rt(e){return Ke({baseURL:"https://r2-oj.didapipa.com",url:"/status/judger/"+e+".json?"+Date.now(),method:"get"})}function Ga(e){return Ke({baseURL:"https://r2-oj.didapipa.com",url:"/status/web.json?"+Date.now(),method:"get"})}const Ka={class:"judger-status-panel"},Ha={class:"judger-status-panel"};function Na(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ee(e)}const Oa=te({__name:"SystemStatus",setup(e){const a=p([]),o=p([]),s=p(!1),l=p(!1);let i;const _=d=>{let u="失效",b="danger";const h=new Date,k=new Date(d.updateTime);return h.getTime()-k.getTime()>3e4?(u="离线",b="default"):d.cpuUsage>90?(u="CPU过高",b="warning"):d.memPercent>90?(u="内存过高",b="warning"):(u="在线",b="success"),t(pe,null,{default:()=>[t("span",null,[d.key,S(" - "),d.name]),t("span",null,[d.updateTime]),t(da,{theme:b,size:"small"},Na(u)?u:{default:()=>[u]})]})},P=async()=>{const d=[{key:"didaoj",name:"DidaOj"}],u={};for(let h=0;h<a.value.length;h++){const k=a.value[h];u[k.key]=k}const b=[];for(let h=0;h<d.length;h++){const k=d[h],m={key:k.key},f=await Ga(k.key);f&&(f.name?m.name=f.name:m.name="-",f.update_time?m.updateTime=new Date(f.update_time).toLocaleString():m.updateTime="-",f.cpu_usage?m.cpuUsage=Number(f.cpu_usage):m.cpuUsage=0,f.mem_usage?m.memUsage=f.mem_usage/(1024*1024*1024):m.memUsage=0,f.mem_total?m.memTotal=f.mem_total/(1024*1024*1024):m.memTotal=0,m.memTotal>0?m.memPercent=Math.round(m.memUsage/m.memTotal*1e4)/100:m.memPercent=0,m.avgMessage=f.avg_message,u[k.key]?(m.cpuUsageFrom=u[k.key].cpuUsage,m.memPercentFrom=u[k.key].memPercent,m.memUsageFrom=u[k.key].memUsage,m.memTotalFrom=u[k.key].memTotal):(m.cpuUsageFrom=0,m.memPercentFrom=0,m.memUsageFrom=0,m.memTotalFrom=0),b.push(m))}a.value=b},y=async()=>{const d=await qa(),u={};for(let h=0;h<o.value.length;h++){const k=o.value[h];u[k.key]=k}const b=[];for(let h=0;h<d.judgers.length;h++){const k=d.judgers[h],m={key:k.key,name:k.name},f=await Rt(k.key);f&&(f.name?m.name=f.name:m.name="-",f.update_time?m.updateTime=new Date(f.update_time).toLocaleString():m.updateTime="-",f.cpu_usage?m.cpuUsage=Number(f.cpu_usage):m.cpuUsage=0,f.mem_usage?m.memUsage=f.mem_usage/(1024*1024*1024):m.memUsage=0,f.mem_total?m.memTotal=f.mem_total/(1024*1024*1024):m.memTotal=0,m.memTotal>0?m.memPercent=Math.round(m.memUsage/m.memTotal*1e4)/100:m.memPercent=0,m.avgMessage=f.avg_message,u[k.key]?(m.cpuUsageFrom=u[k.key].cpuUsage,m.memPercentFrom=u[k.key].memPercent,m.memUsageFrom=u[k.key].memUsage,m.memTotalFrom=u[k.key].memTotal):(m.cpuUsageFrom=0,m.memPercentFrom=0,m.memUsageFrom=0,m.memTotalFrom=0),b.push(m))}o.value=b},g=async()=>{await P(),s.value=!1,await y(),l.value=!1};return ne(async()=>{o.value=[],a.value=[],l.value=!0,s.value=!0,await g(),i=setInterval(()=>{g()},5e3)}),St(()=>{clearInterval(i)}),(d,u)=>{const b=ca,h=pe,k=re,m=_e;return z(),J(Q,null,[t(k,{title:"接口状态",class:"judger-status"},{default:n(()=>[t(m,{loading:s.value},{default:n(()=>[R("div",Ka,[(z(!0),J(Q,null,ce(a.value,f=>(z(),q(k,{key:f.key,header:()=>_(f),class:"judge-status-judger"},{footer:n(()=>[R("span",null," 负载信息："+E(f.avgMessage),1)]),default:n(()=>[t(h,{class:"judge-status-judger"},{default:n(()=>[t(b,{title:"CPU使用率",value:f.cpuUsage,animation:{valueFrom:f.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(b,{title:"内存使用率",value:f.memPercent,animation:{valueFrom:f.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(b,{title:"内存使用量",animation:{valueFrom:f.memUsageFrom,duration:2e3},"animation-start":!0,value:f.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(b,{title:"内存总量",value:f.memTotal,animation:{valueFrom:f.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1},8,["loading"])]),_:1}),t(k,{title:"判题机状态",class:"judger-status"},{default:n(()=>[t(m,{loading:l.value},{default:n(()=>[R("div",Ha,[(z(!0),J(Q,null,ce(o.value,f=>(z(),q(k,{key:f.key,header:()=>_(f),class:"judge-status-judger"},{footer:n(()=>[R("span",null," 负载信息："+E(f.avgMessage),1)]),default:n(()=>[t(h,{class:"judge-status-judger"},{default:n(()=>[t(b,{title:"CPU使用率",value:f.cpuUsage,animation:{valueFrom:f.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(b,{title:"内存使用率",value:f.memPercent,animation:{valueFrom:f.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(b,{title:"内存使用量",animation:{valueFrom:f.memUsageFrom,duration:2e3},"animation-start":!0,value:f.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(b,{title:"内存总量",value:f.memTotal,animation:{valueFrom:f.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1},8,["loading"])]),_:1})],64)}}}),ee=(e,a)=>{const o=e.__vccOpts||e;for(const[s,l]of a)o[s]=l;return o},ut=ee(Oa,[["__scopeId","data-v-b8c98192"]]),Ba={style:{"text-align":"right"}},Ja=te({__name:"Hitokoto",setup(e){const a=p(!1),o=p(""),s=p(""),l=p(""),i=async()=>{a.value=!0;try{const P=await(await fetch("https://v1.hitokoto.cn")).json();s.value=P.hitokoto,l.value=P.creator,o.value="—— "+P.from}catch(_){s.value="一言获取失败了，但至少您还可以访问本站。",l.value="BoilTask",o.value="DidaOJ",console.error("Error fetching Hitokoto:",_)}finally{a.value=!1}};return ne(()=>{i()}),(_,P)=>{const y=re,g=_e;return z(),q(g,{loading:a.value},{default:n(()=>[t(y,{title:"一言 © Hitokoto"},{actions:n(()=>[S(" @"+E(l.value),1)]),default:n(()=>[R("div",null,[R("span",null,E(s.value),1),R("p",Ba,E(o.value),1)])]),_:1})]),_:1},8,["loading"])}}}),Wa={class:"sh-main"},Xa={class:"dida-swiper-div"},Ya=te({__name:"HomeView",setup(e){let a=-1;const o=p(null),s=async()=>{o.value=await Ma()};return ne(async()=>{await s(),a=setInterval(()=>{s()},3e4)}),St(()=>{clearInterval(a)}),(l,i)=>{const _=Tt,P=pa,y=ma,g=re,d=ge,u=Ye,b=_a,h=fa,k=ve;return z(),q(k,null,{default:n(()=>[t(d,{span:8},{default:n(()=>[R("div",Wa,[o.value?(z(),q(_,{key:0,style:{margin:"20px"},theme:o.value.theme},{default:n(()=>[S(E(o.value.content),1)]),_:1},8,["theme"])):ie("",!0),R("div",Xa,[t(y,{class:"dida-swiper"},{default:n(()=>[t(P,null,{default:n(()=>i[0]||(i[0]=[R("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1}),t(P,null,{default:n(()=>i[1]||(i[1]=[R("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1})]),_:1})]),t(g,{title:"正在完善，欢迎提供意见建议",style:{width:"500px",margin:"0 auto"}},{default:n(()=>i[2]||(i[2]=[R("p",null,[R("a",{href:"https://codeoj.cn/",target:"_blank"},"CodeOJ"),S("的迁移计划")],-1),R("p",null,"正在开发中",-1)])),_:1})])]),_:1}),t(d,{span:4},{default:n(()=>[t(Ja,{style:{margin:"10px"}}),t(ut),t(g,{style:{margin:"10px"},bordered:!0},{header:n(()=>i[3]||(i[3]=[R("b",null,"友情链接",-1)])),default:n(()=>[t(h,null,{default:n(()=>[t(b,null,{default:n(()=>[t(u,{href:"https://boiltask.com",target:"_blank"},{default:n(()=>i[4]||(i[4]=[S("BoilTask Blog")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),Za=ee(Ya,[["__scopeId","data-v-1e5edfb9"]]),Qa={class:"sh-main"},en=te({__name:"View404",setup(e){let a=de(),o=p(a.fullPath);return(s,l)=>{const i=G;return z(),J("div",Qa,[R("p",null,E(oe(o)),1),l[2]||(l[2]=R("p",null,"该页面无效或已被迁移，请重新选择访问目标",-1)),t(i,{theme:"primary",onClick:l[0]||(l[0]=()=>s.$router.push("/"))},{default:n(()=>l[1]||(l[1]=[S("返回首页")])),_:1})])}}}),Ut=ee(en,[["__scopeId","data-v-d4218944"]]);let it=null;async function tn(){it=await nn()}function an(e,a="zh"){if(it==null)return[!1,e.toString()];const o=it[e.toString()];if(!o)return[!1,e.toString()];let s=o[a];return s||(a="zh",s=o[a]),s?[!0,s]:[!1,e.toString()]}async function nn(){return new Promise((e,a)=>{e({404:{zh:"接口未找到"},1e3:{zh:"系统错误"},1002:{zh:"未知错误"},1003:{zh:"操作过于频繁，请稍后重试"},10001:{zh:"权限异常，请重新登陆后再试"},10002:{zh:"参数不符合要求"},10003:{zh:"未找到目标数据"},100001:{zh:"用户名不存在或密码不匹配"},100002:{zh:"邮件发送失败，可能是邮箱无效或达到了每日注册上限，如有问题可联系管理员解决"},100003:{zh:"验证码错误或已过期，请重新获取"},100004:{zh:"注册用户失败，可能存在同名用户"}})})}function ue(){const{appContext:e}=Zt();return{globalProperties:e.config.globalProperties}}function Ce(){return 1e3}function At(e,a,o=3e3){e.$message.success({duration:o,content:a})}function me(e,a,o=3e3){e.$message.info({duration:o,content:a})}function se(e,a,o=3e3){e.$message.error({duration:o,content:a})}function H(e,a,o=3e3){const[s,l]=an(a),i=s?l:`系统错误，错误提示[${l}]`;e.$message.error({duration:o,content:i})}const on="https://oj-api.didapipa.com/",X=kt.create({baseURL:on,timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});X.interceptors.request.use(e=>{const o=be().getToken;return o&&(e.headers["X-Token"]=o),e},e=>Promise.reject(e));X.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function ln(e){const a={};return a.id=e.id,a.username=e.username,a.nickname=e.nickname,a.email=e.email,a.slogan=e.slogan,a.organization=e.organization,a.accept=e.accept,a.attempt=e.attempt,e.email&&(a.avatar=`https://www.gravatar.com/avatar/${Qt(e.email.toLowerCase().trim())}?d=identicon&s=100`),a}function sn(e,a){return X({url:"/user/login",method:"post",data:{username:e,password:a}})}function rn(){return X({url:"/user/login/refresh",method:"post"})}function un(e){const a={username:e};return X({url:`/user/info?${new URLSearchParams(a).toString()}`,method:"get"})}function cn(e,a){return X({url:"/user/register/email",method:"post",data:{token:e,email:a}})}function dn(e,a,o,s,l){return X({url:"/user/register",method:"post",data:{username:e,password:a,email:o,key:s,nickname:l}})}const mn={class:"dida-login-footer"},pn=te({__name:"LoginView",setup(e){const{globalProperties:a}=ue(),o=be(),s=p(!1),l=p({username:"",password:""}),i=()=>{me(a,"重置成功")},_=({validateResult:P,firstError:y})=>{s.value||(s.value=!0,sn(l.value.username,l.value.password).then(g=>{if(g.code===0){o.loadResponse(g.data),me(a,"登录成功");let d=a.$route.query.redirect_uri;d||(d="/user/"+g.data.username),a.$router.push({path:d})}else H(a,g.code)}).catch(g=>{console.error("Login error",g),se(a,"登录失败")}).finally(()=>{s.value=!1}))};return ne(()=>{if(o.isLogin()){a.$router.push({path:"/user"});return}}),(P,y)=>{const g=Ie,d=Ve,u=G,b=ze,h=Ye,k=re;return z(),q(k,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:n(()=>[t(b,{ref:"form",data:l.value,colon:!0,onReset:i,onSubmit:_,class:"yj-login-form","label-width":0},{default:n(()=>[t(d,{name:"username"},{default:n(()=>[t(g,{modelValue:l.value.username,"onUpdate:modelValue":y[0]||(y[0]=m=>l.value.username=m),clearable:"",placeholder:"请输入用户名"},{"prefix-icon":n(()=>[t(oe(Ct))]),_:1},8,["modelValue"])]),_:1}),t(d,{name:"password"},{default:n(()=>[t(g,{modelValue:l.value.password,"onUpdate:modelValue":y[1]||(y[1]=m=>l.value.password=m),type:"password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":n(()=>[t(oe(Re))]),_:1},8,["modelValue"])]),_:1}),t(d,null,{default:n(()=>[t(u,{theme:"primary",type:"submit",block:"",loading:s.value},{default:n(()=>y[4]||(y[4]=[S("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),R("div",mn,[t(h,{onClick:y[2]||(y[2]=()=>{oe(a).$router.push({name:"login-forget"})})},{default:n(()=>y[5]||(y[5]=[S("忘记密码")])),_:1}),t(h,{onClick:y[3]||(y[3]=()=>{oe(a).$router.push({name:"register"})})},{default:n(()=>y[6]||(y[6]=[S("注册账户")])),_:1})])]),_:1})}}}),fn=ee(pn,[["__scopeId","data-v-be6a0deb"]]),_n={style:{margin:"12px"}},gn=te({__name:"UserView",setup(e){let a=de();const{globalProperties:o}=ue(),s=Te();let l="";const i=p(!1),_=p(null),P=p([]),y=async g=>{i.value=!0;try{let d=await un(g);if(d.code!==0){i.value=!1,H(o,d.code),await N.push({name:"home"});return}_.value=ln(d.data.user),P.value=d.data.problems_ac,s.setTitle(_.value.nickname+" - "+s.getTitle)}catch{se(o,"获取用户信息失败"),await N.push({name:"home"})}finally{i.value=!1}};return ea(async(g,d,u)=>{if(Array.isArray(g.params.username)?l=g.params.username[0]:l=g.params.username,!l){await N.push({name:"home"});return}await y(l),u()}),ne(async()=>{if(Array.isArray(a.params.username)?l=a.params.username[0]:l=a.params.username,!l){await N.push({name:"home"});return}await y(l)}),(g,d)=>{const u=G,b=pe,h=re,k=ge,m=ga,f=De,$=$e,D=ve,I=_e;return z(),q(I,{loading:i.value},{default:n(()=>[t(D,{class:"dida-main-content"},{default:n(()=>[t(k,{span:8},{default:n(()=>[t(h,{style:{margin:"10px"},title:"AC题目"},{default:n(()=>[t(b,{style:{"flex-wrap":"wrap"}},{default:n(()=>[(z(!0),J(Q,null,ce(P.value,w=>(z(),q(u,{key:w,size:"small",onClick:()=>oe(N).push({name:"problem-detail",params:{problemId:w}})},{default:n(()=>[S(E(w),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1}),t(k,{span:4},{default:n(()=>[R("div",_n,[t($,{layout:"vertical",bordered:!0},{default:n(()=>[t(f,{label:"头像"},{default:n(()=>{var w;return[t(m,{shape:"round",size:"100px",image:(w=_.value)==null?void 0:w.avatar,"hide-on-load-failed":!1},null,8,["image"])]}),_:1}),t(f,{label:"昵称"},{default:n(()=>{var w;return[S(E((w=_.value)==null?void 0:w.nickname),1)]}),_:1}),t(f,{label:"Slogan"},{default:n(()=>{var w;return[S(E((w=_.value)==null?void 0:w.slogan),1)]}),_:1}),t(f,{label:"邮箱"},{default:n(()=>{var w;return[S(E((w=_.value)==null?void 0:w.email),1)]}),_:1}),t(f,{label:"组织"},{default:n(()=>{var w;return[S(E((w=_.value)==null?void 0:w.organization),1)]}),_:1}),t(f,{label:"通过数量"},{default:n(()=>{var w;return[S(E((w=_.value)==null?void 0:w.accept),1)]}),_:1}),t(f,{label:"提交数量"},{default:n(()=>{var w;return[S(E((w=_.value)==null?void 0:w.attempt),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),vn=ee(gn,[["__scopeId","data-v-cef20b99"]]),hn={class:"dida-login-footer"},bn=te({__name:"RegisterView",setup(e){const{globalProperties:a}=ue(),o=be(),s=p(!1),l=p(!1),i=p(!1),_=p("发送验证码");let P=null,y=-1;const g=p(!1),d=p(null),u=p({username:"",password:"",confirmPassword:"",nickname:"",email:"",emailKey:""}),b=p(()=>t(G,{onClick:h,disabled:i.value,loading:l.value,style:"width:120px"},{default:()=>[_.value]})),h=async()=>{var I;if(!u.value.email){se(a,"请输入邮箱");return}if(!u.value.email.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)){se(a,"邮箱格式不正确");return}if(i.value||l.value)return;g.value=!0,await ye();const $=document.getElementById("cf-confirm-div");$&&$.remove();const D=document.createElement("div");D.id="cf-confirm-div",D.setAttribute("data-theme","light"),(I=d.value)==null||I.appendChild(D),window.turnstile.ready(function(){window.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(w){g.value=!1,await k(w)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},k=async $=>{if(!i.value){l.value=!0;try{const D=await cn($,u.value.email);if(D.code!==0){H(a,D.code);return}me(a,"发送验证码成功"),l.value=!1,i.value=!0,P=new Date,_.value="60秒后重发",y=setInterval(()=>{const w=Math.floor((new Date().getTime()-(P==null?void 0:P.getTime()))/1e3);w>60?(_.value="发送验证码",i.value=!1,clearInterval(y)):_.value=`${60-w}秒后重发`},1e3)}catch{se(a,"发送验证码失败")}finally{l.value=!1}}},m=()=>{me(a,"重置成功")},f=({validateResult:$,firstError:D})=>{if(!s.value){if(u.value.password!==u.value.confirmPassword){se(a,"两次密码不一致");return}s.value=!0,dn(u.value.username,u.value.password,u.value.email,u.value.emailKey,u.value.nickname).then(I=>{I.code===0?(me(a,"注册成功，可使用账号信息登录"),a.$router.push({name:"login"})):H(a,I.code)}).catch(I=>{console.error("Login error",I),se(a,"登录失败")}).finally(()=>{s.value=!1})}};return ne(()=>{if(o.isLogin()){a.$router.push({path:"/user"});return}}),we(()=>{clearInterval(y)}),($,D)=>{const I=Ie,w=Ve,F=va,T=G,L=ze,V=Ye,C=re,c=Ze;return z(),J(Q,null,[t(C,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:n(()=>[t(L,{ref:"form",data:u.value,colon:!0,onReset:m,onSubmit:f,class:"yj-login-form","label-width":0},{default:n(()=>[t(w,{name:"account"},{default:n(()=>[t(I,{modelValue:u.value.username,"onUpdate:modelValue":D[0]||(D[0]=r=>u.value.username=r),clearable:"",placeholder:"请输入用户名"},{"prefix-icon":n(()=>[t(oe(Ct))]),_:1},8,["modelValue"])]),_:1}),t(w,{name:"password"},{default:n(()=>[t(I,{modelValue:u.value.password,"onUpdate:modelValue":D[1]||(D[1]=r=>u.value.password=r),type:"password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":n(()=>[t(oe(Re))]),_:1},8,["modelValue"])]),_:1}),t(w,{name:"confirm-password"},{default:n(()=>[t(I,{modelValue:u.value.confirmPassword,"onUpdate:modelValue":D[2]||(D[2]=r=>u.value.confirmPassword=r),type:"password",clearable:"",placeholder:"请确认密码"},{"prefix-icon":n(()=>[t(oe(Re))]),_:1},8,["modelValue"])]),_:1}),t(w,{name:"nickname"},{default:n(()=>[t(I,{modelValue:u.value.nickname,"onUpdate:modelValue":D[3]||(D[3]=r=>u.value.nickname=r),clearable:"",placeholder:"昵称"},{"prefix-icon":n(()=>[t(oe(Re))]),_:1},8,["modelValue"])]),_:1}),t(w,{name:"email"},{default:n(()=>[t(I,{modelValue:u.value.email,"onUpdate:modelValue":D[4]||(D[4]=r=>u.value.email=r),clearable:"",placeholder:"邮箱"},{"prefix-icon":n(()=>[t(oe(Re))]),_:1},8,["modelValue"])]),_:1}),t(w,{name:"emailKey"},{default:n(()=>[t(F,{append:b.value},{default:n(()=>[t(I,{modelValue:u.value.emailKey,"onUpdate:modelValue":D[5]||(D[5]=r=>u.value.emailKey=r),clearable:"",placeholder:"验证码",style:{width:"240px"}},{"prefix-icon":n(()=>[t(oe(Re))]),_:1},8,["modelValue"])]),_:1},8,["append"])]),_:1}),t(w,null,{default:n(()=>[t(T,{theme:"primary",type:"submit",block:"",loading:s.value},{default:n(()=>D[8]||(D[8]=[S("注册")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),R("div",hn,[t(V,{onClick:D[6]||(D[6]=()=>{oe(a).$router.push({name:"login"})})},{default:n(()=>D[9]||(D[9]=[S("返回登陆 ")])),_:1})])]),_:1}),t(c,{visible:g.value,"onUpdate:visible":D[7]||(D[7]=r=>g.value=r),header:"请完成人机验证","close-btn":!1,footer:!1},{default:n(()=>[R("div",{ref_key:"dialogContainer",ref:d,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),yn=ee(bn,[["__scopeId","data-v-29f8d0f2"]]),dt=[{name:"home",path:"/",title:"首页",showSidebar:!1,disableGenerateTab:!0,component:Za},{name:"problem",path:"/problem",title:"题目",icon:"calculation",showSidebar:!0,redirect:"problem-list"},{name:"judge",path:"/judge",title:"评测",icon:"code",showSidebar:!0,redirect:"judge-list"},{name:"contest",path:"/contest",title:"比赛",icon:"application",showSidebar:!0,redirect:"contest-list"},{name:"contest-detail-tab",title:"比赛",path:"/contest",showSidebar:!0,disableGenerateTab:!0,redirect:"contest-list"},{name:"discuss",title:"讨论",path:"/discuss",icon:"sonic",showSidebar:!0,redirect:"discuss-list"},{name:"rank",path:"/rank",title:"排名",icon:"chart-column",showSidebar:!0,redirect:"rank-ac-all"},{name:"tool",path:"/tool",title:"工具",icon:"tools",showSidebar:!0,redirect:"tool-paste"},{name:"system",path:"/system",title:"系统",icon:"dashboard",showSidebar:!0,redirect:"system-status"},{name:"manage",path:"/manage",title:"管理",icon:"command",showSidebar:!0,redirect:"manage-judge",auths:[xe.Manage]},{name:"login",path:"/login",title:"登陆",showSidebar:!1,disableGenerateTab:!0,component:fn},{name:"register",path:"/register",title:"注册",showSidebar:!1,disableGenerateTab:!0,component:yn},{name:"user",path:"/user/:username+",title:"用户",showSidebar:!1,needLogin:!0,disableGenerateTab:!0,component:vn},{name:"404",path:"/404",title:"404",showSidebar:!1,disableGenerateTab:!0,component:Ut}],wn=e=>dt.find(a=>a.name==e),kn=e=>{const a=[];return dt.forEach(o=>{!o.disableGenerateTab&&e.hasAllAuths(o.auths)&&a.push(o)}),a},Sn=e=>{dt.forEach(a=>{const o={name:a.name,path:a.path,meta:{title:a.title,tab:a.name,showSidebar:a.showSidebar,needLogin:a.needLogin,redirect:a.redirect,tabAuths:a.auths},component:a.component};e.push(o)})};function Et(e){return e.children!==void 0}function Cn(e){return e.children!==void 0}var Ft=(e=>(e[e.Unknown=-1]="Unknown",e[e.C=0]="C",e[e.Cpp=1]="Cpp",e[e.Java=2]="Java",e[e.Python=3]="Python",e[e.Pascal=4]="Pascal",e[e.Golang=5]="Golang",e[e.Max=6]="Max",e))(Ft||{});function Mt(){const e=[-1,5,6];return Object.values(Ft).filter(a=>typeof a=="number"&&!e.includes(a)).map(a=>({value:a,label:qt(a)}))}function In(e){return e>-1&&e<6}function qt(e){switch(e){case 0:return"C";case 1:return"C++";case 2:return"Java";case 3:return"Python";case 4:return"Pascal";case 5:return"Golang";default:return"Unknown"}}function mt(e){switch(e){case 0:return"c";case 1:return"cpp";case 2:return"java";case 3:return"python";case 4:return"pascal";case 5:return"golang";default:return"text"}}var he=(e=>(e[e.Init=0]="Init",e[e.Rejudge=1]="Rejudge",e[e.Submitting=2]="Submitting",e[e.Queuing=3]="Queuing",e[e.Compiling=4]="Compiling",e[e.Running=5]="Running",e[e.Accept=6]="Accept",e[e.PE=7]="PE",e[e.WA=8]="WA",e[e.TLE=9]="TLE",e[e.MLE=10]="MLE",e[e.OLE=11]="OLE",e[e.RE=12]="RE",e[e.CE=13]="CE",e[e.CLE=14]="CLE",e[e.JudgeFail=15]="JudgeFail",e[e.SubmitFail=16]="SubmitFail",e[e.Unknown=17]="Unknown",e))(he||{});const Pn=e=>{switch(e){case 0:return"普通评测";case 1:return"特殊评测";default:return"未知"}},We=e=>{switch(e){case 0:return"等待处理";case 1:return"重新评测";case 2:return"提交中";case 3:return"队列中";case 4:return"编译中";case 5:return"运行中";case 6:return"通过";case 7:return"格式错误";case 8:return"答案错误";case 9:return"超时";case 10:return"内存超限";case 11:return"输出超限";case 12:return"运行错误";case 13:return"编译错误";case 14:return"编译超限";case 15:return"评测失败";case 16:return"提交失败";case 17:return"未知";default:return e}},Gt=e=>{switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return"default";case 6:return"success";case 7:return"warning";default:return"danger"}};function Tn(){const e=[17];return Object.values(he).filter(a=>typeof a=="number"&&!e.includes(a)).map(a=>({value:a,label:We(a)}))}function Ue(e){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return!0;default:return!1}}function Kt(e){var o;const a={};if(a.id=e.id,a.problemId=e.problem_id,a.status=e.status,Ue(e.status)?a.score="-":a.score=e.score.toString(),e.time?a.time=Math.ceil(e.time/1e6)+"ms":a.time="-",e.memory?a.memory=(e.memory/1024/1024).toFixed(2)+"MB":a.memory="-",a.language=qt(e.language),a.codeLength=e.code_length,e.approve_time?a.approveTime=new Date(e.approve_time).toLocaleString():a.approveTime="-",a.author=e.author,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.code=e.code,a.compileMessage=e.compile_message,a.taskCurrent=e.task_current,a.taskTotal=e.task_total,a.task=[],e.task)for(let s=0;s<((o=e.task)==null?void 0:o.length);s++){const l=e.task[s],i={};i.taskId=l.task_id,i.status=l.status,l.time?i.time=Math.ceil(l.time/1e6)+"ms":i.time="-",l.memory?i.memory=(l.memory/1024/1024).toFixed(2)+"MB":i.memory="-",i.score=l.score,i.content=l.content,i.waHint=l.wa_hint,!i.content&&!i.waHint&&(i.content="无提示信息"),a.task.push(i)}return e.judger&&(a.judger=e.judger),e.judge_time&&(a.judgeTime=new Date(e.judge_time).toLocaleString()),a}function Ln(e,a,o,s,l){return X({url:"/judge/approve",method:"post",data:{problem_id:e,contest_id:a,problem_index:o,language:s,code:l}})}function xn(e){return X({url:"/judge?id="+e,method:"get"})}function jn(e){return X({url:"/judge/code?id="+e,method:"get"})}function zn(e,a,o,s,l,i){const _=new URLSearchParams({problem_id:e,username:a,language:String(o),status:String(s),page:String(l),page_size:String(i)});return X({url:`/judge/list?${_.toString()}`,method:"get"})}function Vn(){return X({url:"/judge/rejudge/recently",method:"post"})}function $n(e){return X({url:"/judge/rejudge/problem",method:"post",data:{id:e}})}function Dn(){return X({url:"/judge/rejudge/all",method:"post",timeout:0})}function Rn(e){return X({url:"/judge/rejudge",method:"post",data:{id:Number(e)}})}var ct=(e=>(e[e.None=0]="None",e[e.Attempt=1]="Attempt",e[e.Accept=2]="Accept",e))(ct||{});function et(e,a){const o={};if(o.id=e.id,o.author=e.author,o.title=e.title,o.tags=[],e.tags)for(const s of e.tags){const l=a[s];l&&o.tags.push(l)}return o.accept=e.accept,o.attempt=e.attempt,e.description!=null&&(o.description=e.description),e.time_limit!=null&&(o.timeLimit=e.time_limit.toString()+" ms"),e.memory_limit!=null&&(o.memoryLimit=(e.memory_limit/1024).toFixed(2)+" MB"),e.judge_type!=null&&(o.judgeType=Pn(e.judge_type)),e.insert_time!=null&&(o.insertTime=new Date(e.insert_time).toLocaleString()),e.update_time!=null&&(o.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(o.creatorNickname=e.creator_nickname),e.source!=null&&(o.source=e.source),e.judge_md5!=null&&(o.judgeMd5=e.judge_md5),o}function Ht(e,a,o){const s={};return e?s.id=e:(s.contest_id=a,s.problem_index=o),X({url:`/problem?${new URLSearchParams(s).toString()}`,method:"get"})}function Nt(e){return X({url:"/problem/tag/list?max_count="+e,method:"get"})}function Un(e){return X({url:"/problem/judge?id="+e,method:"get"})}function An(e,a,o,s){const l={};return e&&(l.title=e),a&&(l.tag=a),o&&(l.page=o),s&&(l.page_size=s),X({url:`/problem/list?${new URLSearchParams(l).toString()}`,method:"get"})}function En(e,a,o,s,l,i,_){return X({url:"/problem/edit",method:"post",data:{id:e,title:a,time_limit:o,memory_limit:s,source:l,tags:i,description:_}})}function Fn(e,a){return X({url:"/problem/judge/data/download?id="+e+"&key="+a,method:"get"})}function Mn(e,a){const o=new FormData;return o.append("id",e),o.append("zip",a),X({url:"/problem/judge/data",method:"post",data:o,headers:{"Content-Type":"multipart/form-data"},timeout:1e3*60*5})}const qn={style:{margin:"10px"}};function Gn(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ee(e)}const Kn=te({__name:"ProblemList",setup(e){const a=de(),o=Fe(),{globalProperties:s}=ue();let l=null;const i=p(!1),_={};let P={};const y=p([{title:"ID",colKey:"id",cell:(T,L)=>{let V=$(L.row.id);return t(G,{variant:"dashed",theme:V,onClick:()=>f(L.row.id)},{default:()=>[L.row.id]})}},{title:"标题",colKey:"title",cell:(T,L)=>t(G,{variant:"text",onClick:()=>f(L.row.id)},{default:()=>[L.row.title]})},{title:"标签",colKey:"tags",cell:(T,L)=>{const V=L.row.tags;if(!V||V.length===0)return"";let C=[];for(let c=0;c<V.length;c++){const r=V[c];C.push(t(G,{key:c,theme:"default",variant:"outline",size:"small",onClick:()=>I(r)},{default:()=>[r.name]}))}return t(pe,null,Gn(C)?C:{default:()=>[C]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),g=p(!1);let d=1,u=50;const b=p({current:d,pageSize:u,defaultCurrent:d,defaultPageSize:u,total:0,pageSizeOptions:[50,100]}),h=p(),k=p(),m=p({title:"",tag:""}),f=T=>{T&&o.push({path:"/problem/"+T})},$=T=>{if(!T||!P)return"default";const L=P[T];if(!L)return"default";switch(L){case ct.Accept:return"success";case ct.Attempt:return"warning";default:return"default"}},D=async()=>{await o.push({query:{...a.query,title:m.value.title,tag:m.value.tag,page:1,page_size:b.value.defaultPageSize}})},I=T=>{T&&o.push({query:{...a.query,title:"",tag:T.name,page:1,page_size:b.value.defaultPageSize}})},w=async(T,L)=>{g.value=!0;try{const{current:V,pageSize:C}=T,c=await An(m.value.title,m.value.tag,V,C);if(h.value=[],c.code===0){const r=c.data.list;if(!r||r.length<=0){b.value={...b.value,total:0},P=null,me(s,"未找到记录");return}r.forEach(v=>{var j;const x=et(v,_);(j=h.value)==null||j.push(x)}),b.value={...b.value,total:c.data.total_count},P=c.data.problem_attempt_status}else L&&H(s,c.code)}catch(V){console.error(V),H(s,Ce())}finally{g.value=!1}},F=async T=>{await o.push({query:{...a.query,page:T.current,page_size:T.pageSize}})};return ne(async()=>{g.value=!0,k.value=[],Nt(-1).then(T=>{if(T.code===0){k.value=T.data.list,i.value=T.data.total_count>T.data.list.length;for(let L=0;L<T.data.list.length;L++){const V=T.data.list[L];_[V.id]=V}l=je(()=>a.query,L=>{m.value.title=L.title||"",m.value.tag=L.tag||"";const V=parseInt(L.page)||b.value.defaultCurrent,C=parseInt(L.page_size)||b.value.defaultPageSize;d=V,u=C,b.value={...b.value,current:d,pageSize:u},w({current:d,pageSize:u},!0)},{immediate:!0})}else i.value=!0}).catch(T=>{console.error(T),i.value=!0})}),we(()=>{l&&l()}),(T,L)=>{const V=Pe,C=re,c=ge,r=Ie,v=Ve,x=G,j=ze,U=ve;return z(),q(U,null,{default:n(()=>[t(c,{span:9},{default:n(()=>[t(C,{style:{margin:"10px"}},{default:n(()=>[t(V,{data:h.value,columns:y.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:b.value,loading:g.value,onPageChange:F},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(c,{span:3},{default:n(()=>[R("div",qn,[t(C,{class:"sh-card"},{default:n(()=>[t(j,{model:m.value,onSubmit:D},{default:n(()=>[t(v,{label:"标题"},{default:n(()=>[t(r,{modelValue:m.value.title,"onUpdate:modelValue":L[0]||(L[0]=A=>m.value.title=A),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(v,{label:"标签"},{default:n(()=>[t(r,{modelValue:m.value.tag,"onUpdate:modelValue":L[1]||(L[1]=A=>m.value.tag=A),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(v,null,{default:n(()=>[t(x,{theme:"primary",type:"submit"},{default:n(()=>L[3]||(L[3]=[S("搜索")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(C,{class:"sh-card sh-background-black"},{default:n(()=>[(z(!0),J(Q,null,ce(k.value,A=>(z(),q(x,{class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:()=>I(A)},{default:n(()=>[S(E(A.name),1)]),_:2},1032,["onClick"]))),256)),i.value?(z(),q(x,{key:0,class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:L[2]||(L[2]=()=>T.$router.push("/problem/tags"))},{default:n(()=>L[4]||(L[4]=[S(" ... ")])),_:1})):ie("",!0)]),_:1})])]),_:1})]),_:1})}}}),Hn=ee(Kn,[["__scopeId","data-v-76eb7f95"]]);function Ae(e){e.querySelectorAll("pre > code:not([data-copy-attached])").forEach(o=>{o.setAttribute("data-copy-attached","true");const s=o.parentElement,l=document.createElement("div");l.className="copy-wrapper";const i=document.createElement("button");i.className="copy-btn",i.innerText="复制",i.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(o.innerText),i.innerText="已复制",setTimeout(()=>i.innerText="复制",1500)}catch{i.innerText="失败"}}),s.replaceWith(l),l.appendChild(i),l.appendChild(s)})}function tt(e){let a="";for(;e>0;)e--,a=String.fromCharCode(65+e%26)+a,e=Math.floor(e/26);return a}async function Ot(e){const a={};if(a.id=e.id,a.ownerId=e.owner_id,a.ownerUsername=e.owner_username,a.ownerNickname=e.owner_nickname,a.title=e.title,a.startTime=new Date(e.start_time).toLocaleString(),a.endTime=new Date(e.end_time).toLocaleString(),e.descriptions){a.descriptions=[];const o={math:{inlineDigit:!0,engine:"KaTeX"}};for(let s=0;s<e.descriptions.length;s++){const l=e.descriptions[s],i={};i.title=l.title,i.content=await le.md2html(l.content,o),i.sort=l.sort,a.descriptions.push(i)}}if(a.notification=e.notification,e.problems){a.problems=[],e.problems.sort((o,s)=>o.index-s.index);for(let o=0;o<e.problems.length;o++){const s=e.problems[o];s.accept||(s.accept=0),s.attempt||(s.attempt=0),s.id=tt(s.index),a.problems.push(s)}}return a}function Nn(e){return X({url:"/contest?id="+e,method:"get"})}function On(e,a){return X({url:"/contest/list?page="+e+"&page_size="+a,method:"get"})}function Bn(e){return X({url:"/contest/create",method:"post",data:e})}const Jn=["innerHTML"],Wn={style:{margin:"12px"}},Xn={key:0,class:"dida-edit-container"},Yn={class:"dida-operation-container"},Zn={class:"dida-code-submit-div"},Qn=te({__name:"ProblemDetail",setup(e){let a=de();const{globalProperties:o}=ue(),s=Te(),l=be();let i=p(""),_="",P=0,y=0;const g=p(null),d=p(!1),u=p(null);let b=null;const h=p(null),k={},m=p(""),f=p([]);f.value=Mt();const $=Le(()=>l.hasAuth(xe.ManageProblem)),D=C=>{C&&N.push({name:"problem-list",query:{...a.query,title:"",tag:C.name}})},I=()=>{N.push({name:"manage-problem",params:{problemId:_}})},w=()=>{_?N.push({name:"judge-list",query:{problem_id:_}}):N.push({name:"contest-judge-list",params:{contestId:P,problemIndex:y}})},F=()=>{_?N.push({name:"discuss-list-problem",query:{problem_id:_}}):N.push({name:"contest-discuss",params:{contestId:P},query:{problem_id:tt(y)}})},T=()=>{N.push({name:"problem-recommend",params:{problemId:_}})},L=async()=>{if(!_){se(o,"问题ID无效");return}const C=parseInt(m.value);if(!In(C)){se(o,"请选择所编写的语言");return}const c=b==null?void 0:b.getValue();if(!c){se(o,"请输入所需提交的代码");return}const r=await Ln(_,P,y,C,c);if(r.code!==0){H(o,r.code);return}me(o,"提交成功，正在跳转到详情页面");const v=r.data.id;await N.push({path:"/judge/"+v})},V=C=>{b&&vt.setModelLanguage(b.getModel(),mt(C))};return ne(async()=>{if(Array.isArray(a.params.problemId)?_=a.params.problemId[0]:_=a.params.problemId,!_){if(Array.isArray(a.params.contestId)?P=a.params.contestId[0]:P=a.params.contestId,!P){se(o,"题目不存在"),await N.push({name:"problem"});return}if(Array.isArray(a.params.problemIndex)?y=parseInt(a.params.problemIndex[0]):y=parseInt(a.params.problemIndex),!y){se(o,"题目不存在"),await N.push({name:"problem"});return}}d.value=!0;let C=await Ht(_,P,y);if(C.code!==0){d.value=!1,H(o,C.code),await N.push({name:"problem"});return}C.data.tags&&C.data.tags.forEach(v=>{k[v.id]=v}),u.value=et(C.data.problem,k),s.setTitle(u.value.title+" - "+s.getTitle);let c=u.value.description;const r={math:{inlineDigit:!0,engine:"KaTeX"}};i.value=await le.md2html(c,r),await ye(()=>{g.value&&(le.mathRender(g.value),le.highlightRender({lineNumber:!0,enable:!0},g.value),Ae(g.value),h.value&&(b=vt.create(h.value,{value:"",language:"cpp",minimap:{enabled:!0},colorDecorators:!0,readOnly:!1,theme:"vs-dark"}))),d.value=!1})}),(C,c)=>{const r=re,v=ge,x=G,j=De,U=pe,A=$e,Y=xt,B=Lt,O=ve,W=_e;return z(),q(W,{loading:d.value},{default:n(()=>[t(O,{class:"dida-main-content"},{default:n(()=>[t(v,{span:8},{default:n(()=>[t(r,{style:{margin:"10px"}},{default:n(()=>[R("div",{innerHTML:oe(i),ref_key:"markdownRef",ref:g},null,8,Jn)]),_:1})]),_:1}),t(v,{span:4},{default:n(()=>[R("div",Wn,[$.value?(z(),J("div",Xn,[t(x,{onClick:I},{default:n(()=>c[1]||(c[1]=[S("编辑")])),_:1})])):ie("",!0),t(A,{layout:"vertical",bordered:!0},{default:n(()=>[t(j,{label:"标题"},{default:n(()=>{var M;return[S(E((M=u.value)==null?void 0:M.title),1)]}),_:1}),t(j,{label:"时间限制"},{default:n(()=>{var M;return[S(E((M=u.value)==null?void 0:M.timeLimit),1)]}),_:1}),t(j,{label:"内存限制"},{default:n(()=>{var M;return[S(E((M=u.value)==null?void 0:M.memoryLimit),1)]}),_:1}),t(j,{label:"判题方式"},{default:n(()=>{var M;return[S(E((M=u.value)==null?void 0:M.judgeType),1)]}),_:1}),t(j,{label:"正确提交"},{default:n(()=>{var M;return[S(E((M=u.value)==null?void 0:M.accept),1)]}),_:1}),t(j,{label:"提交总数"},{default:n(()=>{var M;return[S(E((M=u.value)==null?void 0:M.attempt),1)]}),_:1}),t(j,{label:"创建时间"},{default:n(()=>{var M;return[S(E((M=u.value)==null?void 0:M.insertTime),1)]}),_:1}),t(j,{label:"更新时间"},{default:n(()=>{var M;return[S(E((M=u.value)==null?void 0:M.updateTime),1)]}),_:1}),t(j,{label:"上传用户"},{default:n(()=>{var M;return[S(E((M=u.value)==null?void 0:M.creatorNickname),1)]}),_:1}),t(j,{label:"题目来源"},{default:n(()=>{var M;return[S(E((M=u.value)==null?void 0:M.source),1)]}),_:1}),oe(_)?(z(),q(j,{key:0,label:"标签"},{default:n(()=>[t(U,null,{default:n(()=>{var M;return[(z(!0),J(Q,null,ce((M=u.value)==null?void 0:M.tags,Z=>(z(),q(x,{key:Z.id,variant:"dashed",onClick:()=>D(Z)},{default:n(()=>[S(E(Z.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})):ie("",!0)]),_:1}),R("div",Yn,[t(U,null,{default:n(()=>[t(x,{onClick:w},{default:n(()=>c[2]||(c[2]=[S("提交记录")])),_:1}),t(x,{onClick:F},{default:n(()=>c[3]||(c[3]=[S("题目讨论")])),_:1}),oe(_)?(z(),q(x,{key:0,onClick:T},{default:n(()=>c[4]||(c[4]=[S("题目推荐")])),_:1})):ie("",!0)]),_:1})]),R("div",Zn,[t(U,null,{default:n(()=>[t(B,{modelValue:m.value,"onUpdate:modelValue":c[0]||(c[0]=M=>m.value=M),label:"语言：",placeholder:"请选择提交语言","auto-width":"",clearable:"",onChange:V},{default:n(()=>[(z(!0),J(Q,null,ce(f.value,M=>(z(),q(Y,{key:M.value,value:M.value,label:M.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),t(x,{onClick:L},{default:n(()=>c[5]||(c[5]=[S("提交")])),_:1})]),_:1}),R("div",{ref_key:"codeEditRef",ref:h,class:"dida-code-editor"},null,512)])])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),ht=ee(Qn,[["__scopeId","data-v-3faf9abf"]]),eo={};function to(e,a){return" TODO "}const ao=ee(eo,[["render",to]]),no=["innerHTML"];function oo(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ee(e)}const lo=te({__name:"JudgeJobList",setup(e){const a=de(),o=Fe(),{globalProperties:s}=ue();let l=!1,i=null;const _=p(!1),P=p(null),y=p(null),g=p(!1),d=p({problemId:"",username:"",language:void 0,status:void 0}),u=p([{title:"ID",colKey:"id",cell:(r,v)=>t(G,{variant:"text",onClick:()=>F(v.row.id)},{default:()=>[v.row.id]})},{title:"问题",colKey:"problemId",cell:(r,v)=>t(G,{variant:"text",onClick:()=>w(v.row.problemId)},{default:()=>[v.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(r,v)=>{const x=v.row.status,j=We(x),U=Gt(x);let A=[];return Ue(x)&&A.push(t(_e,{text:v.row.state,size:"small",class:"dida-status-loading"},null)),A.push(t("span",null,[j])),t(G,{theme:U,variant:"outline",onClick:()=>F(v.row.id)},oo(A)?A:{default:()=>[A]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"code",cell:(r,v)=>t(G,{theme:"default",onClick:()=>I(v.row)},{default:()=>[v.row.language+" / "+v.row.codeLength]})},{title:"作者",colKey:"author",width:200,cell:(r,v)=>t(G,{variant:"text",onClick:()=>T(v.row.authorUsername)},{default:()=>[v.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),b=p(!1);let h=1,k=50;const m=p({current:h,pageSize:k,defaultCurrent:h,defaultPageSize:k,total:0,pageSizeOptions:[50,100]}),f=p(),$=p([]);$.value=Mt();const D=p([]);D.value=Tn();const I=async r=>{g.value=!0,_.value=!0;try{P.value=r;const v=await jn(P.value.id);if(v.code===0){const x=v.data,U=`\`\`\`${mt(x.language)}
${x.code}
\`\`\``,A={};P.value.code=await le.md2html(U,A),await ye(()=>{y.value&&(le.highlightRender({lineNumber:!0,enable:!0},y.value),Ae(y.value))})}else H(s,v.code)}finally{g.value=!1}},w=r=>{r&&o.push({path:"/problem/"+r})},F=r=>{r&&o.push({name:"judge-detail",params:{judgeId:r}})},T=r=>{r&&o.push({path:"/user/"+r})},L=async()=>{await o.push({query:{...a.query,page:1,page_size:k,problem_id:d.value.problemId,username:d.value.username,language:d.value.language,status:d.value.status}})},V=async()=>{d.value.problemId="",d.value.username="",d.value.language=void 0,d.value.status=void 0,await o.push({query:{...a.query,page:1,page_size:k,problem_id:"",username:"",language:void 0,status:void 0}})},C=async(r,v)=>{v&&(b.value=!0);let x=!1;try{const{current:j,pageSize:U}=r,A=await zn(d.value.problemId,d.value.username,d.value.language,d.value.status,j,U);f.value=[],A.code===0?A.data.list&&A.data.list.length>0?(A.data.list.forEach(B=>{var W;const O=Kt(B);(W=f.value)==null||W.push(O),Ue(B.status)&&(x=!0)}),m.value={...m.value,total:A.data.total_count}):(me(s,"未找到记录"),m.value={...m.value,total:0}):v&&H(s,A.code)}catch(j){console.error(j),v&&H(s,Ce())}finally{v&&(b.value=!1),x&&l&&setTimeout(()=>{C({current:h,pageSize:k},!1)},5e3)}},c=async r=>{await o.push({query:{...a.query,page:r.current,page_size:r.pageSize}})};return ne(async()=>{l=!0,i=je(()=>a.query,r=>{d.value.problemId=r.problem_id||"",d.value.username=r.username||"",r.language!=null?d.value.language=Number(r.language):d.value.language=void 0,r.status!=null?d.value.status=Number(r.status):d.value.status=void 0;const v=parseInt(r.page)||m.value.defaultCurrent,x=parseInt(r.page_size)||m.value.defaultPageSize;h=v,k=x,m.value.pageSizeOptions.includes(k)||(k=m.value.defaultPageSize),m.value={...m.value,current:h,pageSize:k},C({current:h,pageSize:k},!0)},{immediate:!0})}),we(()=>{l=!1,i&&i()}),(r,v)=>{const x=Ie,j=Ve,U=xt,A=Lt,Y=G,B=pe,O=ze,W=Pe,M=re,Z=Ye,ae=_e,fe=Ze;return z(),J(Q,null,[t(M,{style:{margin:"10px"}},{default:n(()=>[t(O,{layout:"inline",onSubmit:L,onReset:V},{default:n(()=>[t(j,{label:"题号"},{default:n(()=>[t(x,{modelValue:d.value.problemId,"onUpdate:modelValue":v[0]||(v[0]=K=>d.value.problemId=K),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(j,{label:"用户"},{default:n(()=>[t(x,{modelValue:d.value.username,"onUpdate:modelValue":v[1]||(v[1]=K=>d.value.username=K),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(j,{label:"语言"},{default:n(()=>[t(A,{modelValue:d.value.language,"onUpdate:modelValue":v[2]||(v[2]=K=>d.value.language=K),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:n(()=>[(z(!0),J(Q,null,ce($.value,K=>(z(),q(U,{key:K.value,value:K.value,label:K.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(j,{label:"状态"},{default:n(()=>[t(A,{modelValue:d.value.status,"onUpdate:modelValue":v[3]||(v[3]=K=>d.value.status=K),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:n(()=>[(z(!0),J(Q,null,ce(D.value,K=>(z(),q(U,{key:K.value,value:K.value,label:K.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(j,null,{default:n(()=>[t(B,null,{default:n(()=>[t(Y,{theme:"primary",type:"submit"},{default:n(()=>v[7]||(v[7]=[S("搜索")])),_:1}),t(Y,{theme:"default",variant:"base",type:"reset"},{default:n(()=>v[8]||(v[8]=[S("重置")])),_:1})]),_:1})]),_:1})]),_:1}),t(W,{data:f.value,columns:u.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:m.value,loading:b.value,onPageChange:c,"table-layout":"auto"},null,8,["data","columns","pagination","loading"])]),_:1}),t(fe,{visible:_.value,"onUpdate:visible":v[5]||(v[5]=K=>_.value=K),width:"800px","cancel-btn":null,"close-btn":!1,onConfirm:v[6]||(v[6]=K=>_.value=!1)},{header:n(()=>[t(Z,{onClick:v[4]||(v[4]=()=>{var K;F((K=P.value)==null?void 0:K.id)})},{default:n(()=>{var K,ke;return[S(E(((K=P.value)==null?void 0:K.id)+" - "+((ke=P.value)==null?void 0:ke.language)),1)]}),_:1})]),default:n(()=>[t(ae,{loading:g.value},{default:n(()=>{var K;return[R("div",{innerHTML:(K=P.value)==null?void 0:K.code,ref_key:"markdownCodeRef",ref:y,style:{"min-height":"100px"}},null,8,no)]}),_:1},8,["loading"])]),_:1},8,["visible"])],64)}}}),so=ee(lo,[["__scopeId","data-v-c8e34db0"]]),ro={class:"dida-code-container"},uo=["innerHTML"],io={key:2,class:"dida-edit-container"};function bt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ee(e)}const co=te({__name:"JudgeJobDetail",setup(e){const a=de(),o=Fe(),s=be(),{globalProperties:l}=ue();let i=!1,_=-1;const P=p(""),y=p(null),g=p(""),d=p(null),u=p(0),b=p(null),h=p({from:"#5a96ff",to:"#00A870"});let k=!1;const m=p([{title:"ID",colKey:"id"},{title:"问题",colKey:"problemId",cell:(c,r)=>t(G,{variant:"text",onClick:()=>F(r.row.problemId)},{default:()=>[r.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(c,r)=>{const v=r.row.status,x=We(v),j=Gt(v);let U=[];return Ue(v)&&U.push(t(_e,{text:r.row.state,size:"small",class:"dida-status-loading"},null)),U.push(t("span",null,[x])),t(G,{theme:j,variant:"outline"},bt(U)?U:{default:()=>[U]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"language",cell:(c,r)=>t("span",null,[r.row.language+" / "+r.row.codeLength])},{title:"作者",colKey:"author",width:200,cell:(c,r)=>t(G,{variant:"text",onClick:()=>T(r.row.authorUsername)},{default:()=>[r.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),f=p(!1),$=p(!1),D=p(),I=Le(()=>s.hasAuth(xe.ManageJudge)),w=async()=>{if(!$.value){$.value=!0;try{const c=await Rn(_);c.code===0?await V(!0):H(l,c.code)}catch(c){console.error(c),H(l,Ce())}finally{$.value=!1}}},F=c=>{c&&o.push({path:"/problem/"+c})},T=c=>{c&&o.push({path:"/user/"+c})},L=c=>{const r=c.status,v=We(r);let x;switch(r){case he.Init:case he.Rejudge:case he.Compiling:case he.Running:x="default";break;case he.Accept:x="success";break;case he.PE:x="warning";break;default:x="danger";break}return t(pe,null,{default:()=>[t(G,{theme:"default",variant:"outline"},{default:()=>[c.taskId]}),t(G,{theme:x,variant:"outline"},bt(v)?v:{default:()=>[v]}),t("span",null,[S("分数："),c.score]),t("span",null,[S("用时："),c.time]),t("span",null,[S("内存："),c.memory])]})},V=async c=>{var v;c&&(f.value=!0);let r=!1;try{const x=await xn(_);if(D.value=[],x.code===0){const j=x.data,U=Kt(j);if((v=D.value)==null||v.push(U),j.judger){const Y=await Rt(j.judger);P.value=Y.name}else P.value="";h.value.to="#00A870",Ue(j.status)?(b.value="active",U.taskTotal>0?(u.value=U.taskCurrent/U.taskTotal*100,U.taskCurrent>=U.taskTotal&&(u.value=99)):u.value=0):(u.value=100,j.status===he.Accept?b.value="success":j.status===he.PE?(h.value.to="#F57C20",b.value="warning"):(h.value.to="#F56C6C",b.value="error"));const A={};if(j.code){const B=`\`\`\`${mt(j.language)}
${j.code}
\`\`\``;g.value=await le.md2html(B,A),await ye(()=>{d.value&&(k||(k=!0,le.highlightRender({lineNumber:!0,enable:!0},d.value)),Ae(d.value))})}y.value=U,Ue(j.status)&&(r=!0)}else c&&H(l,x.code)}catch(x){console.error(x),c&&H(l,Ce())}finally{c&&(f.value=!1),r&&i&&setTimeout(()=>{V(!1)},5e3)}};function C(){d.value&&d.value.parentElement&&(d.value.style.maxWidth=d.value.parentElement.clientWidth+"px")}return ne(async()=>{if(i=!0,Array.isArray(a.params.judgeId)?_=a.params.judgeId[0]:_=a.params.judgeId,!_){await o.push({name:"judge"});return}await V(!0),C(),window.addEventListener("resize",C)}),we(()=>{i=!1,window.removeEventListener("resize",C)}),(c,r)=>{var Z,ae;const v=ha,x=Pe,j=re,U=ge,A=De,Y=$e,B=ve,O=jt,W=zt,M=G;return z(),J(Q,null,[t(v,{color:h.value,status:b.value,class:"dida-job-progress",percentage:u.value},null,8,["color","status","percentage"]),t(j,{style:{margin:"10px"}},{default:n(()=>[t(x,{data:D.value,columns:m.value,"row-key":"id","vertical-align":"top",hover:!0,loading:f.value},null,8,["data","columns","loading"])]),_:1}),t(B,null,{default:n(()=>[t(U,{span:8},{default:n(()=>[R("div",ro,[R("div",{innerHTML:g.value,ref_key:"markdownCodeRef",ref:d,class:"dida-code-div"},null,8,uo)])]),_:1}),t(U,{span:4},{default:n(()=>[t(Y,{layout:"vertical",bordered:!0,style:{margin:"10px"}},{default:n(()=>[t(A,{label:"判题机"},{default:n(()=>[S(E(P.value),1)]),_:1}),t(A,{label:"判题时间"},{default:n(()=>{var fe;return[S(E((fe=y.value)==null?void 0:fe.judgeTime),1)]}),_:1})]),_:1})]),_:1})]),_:1}),(Z=y.value)!=null&&Z.compileMessage?(z(),q(j,{key:0,class:"compile-message"},{default:n(()=>{var fe;return[S(E((fe=y.value)==null?void 0:fe.compileMessage),1)]}),_:1})):ie("",!0),((ae=y.value)==null?void 0:ae.task.length)>0?(z(),q(W,{key:1,class:"task-panel"},{default:n(()=>{var fe;return[(z(!0),J(Q,null,ce((fe=y.value)==null?void 0:fe.task,(K,ke)=>(z(),q(O,{key:K.taskId,header:()=>L(K)},{default:n(()=>[S(E(K.content)+" "+E(K.waHint),1)]),_:2},1032,["header"]))),128))]}),_:1})):ie("",!0),I.value?(z(),J("div",io,[t(M,{onClick:w,loading:$.value},{default:n(()=>r[0]||(r[0]=[S("重新评测")])),_:1},8,["loading"])])):ie("",!0)],64)}}}),mo=ee(co,[["__scopeId","data-v-0a5d3889"]]),po={style:{margin:"10px"}},fo=te({__name:"ContestList",setup(e){const a=de(),o=Fe(),{globalProperties:s}=ue();let l=null;const i=p(!1),_=p(!1),P=p([{title:"ID",colKey:"id",width:"100",cell:(F,T)=>t(G,{variant:"text",onClick:()=>m(T.row.id)},{default:()=>[T.row.id]})},{title:"标题",colKey:"title",cell:(F,T)=>t(G,{variant:"text",onClick:()=>m(T.row.id)},{default:()=>[T.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),y=p(!1);let g=1,d=50;const u=p({current:g,pageSize:d,defaultCurrent:g,defaultPageSize:d,total:0,pageSizeOptions:[50,100]}),b=p(),h=p({title:"",username:""}),k=p({title:"",description:"",open_time:[]}),m=F=>{F&&o.push({path:"/contest/"+F})},f=async()=>{await o.push({query:{...a.query,title:h.value.title,username:h.value.username,page:1,page_size:u.value.defaultPageSize}})},$=async(F,T)=>{var L;y.value=!0;try{const{current:V,pageSize:C}=F,c=await On(V,C);if(b.value=[],c.code===0){const r=c.data.list;for(let v=0;v<r.length;v++){const x=r[v],j=await Ot(x);(L=b.value)==null||L.push(j)}u.value={...u.value,total:c.data.total_count}}else T&&H(s,c.code)}catch(V){console.error(V),H(s,Ce())}finally{y.value=!1}},D=async F=>{await o.push({query:{...a.query,page:F.current,page_size:F.pageSize}})},I=()=>{i.value=!0},w=async()=>{_.value=!0,console.log("contestCreateForm",k.value),Bn(k.value).then(F=>{F.code===0?(me(s,"创建比赛成功"),i.value=!1,o.push({path:"/contest/"+F.data.id})):H(s,F.code)}).finally(()=>{_.value=!1})};return ne(async()=>{l=je(()=>a.query,F=>{h.value.title=F.title||"",h.value.username=F.username||"";const T=parseInt(F.page)||u.value.defaultCurrent,L=parseInt(F.page_size)||u.value.defaultPageSize;g=T,d=L,u.value={...u.value,current:g,pageSize:d},$({current:g,pageSize:d},!0)},{immediate:!0})}),we(()=>{l&&l()}),(F,T)=>{const L=Pe,V=re,C=ge,c=Ie,r=Ve,v=G,x=ze,j=pe,U=ve,A=Vt,Y=Ze;return z(),J(Q,null,[t(U,null,{default:n(()=>[t(C,{span:9},{default:n(()=>[t(V,{style:{margin:"10px"}},{default:n(()=>[t(L,{data:b.value,columns:P.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:u.value,loading:y.value,onPageChange:D},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(C,{span:3},{default:n(()=>[R("div",po,[t(V,{class:"sh-card"},{default:n(()=>[t(x,{model:h.value},{default:n(()=>[t(r,{label:"标题"},{default:n(()=>[t(c,{modelValue:h.value.title,"onUpdate:modelValue":T[0]||(T[0]=B=>h.value.title=B),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(r,{label:"负责人"},{default:n(()=>[t(c,{modelValue:h.value.username,"onUpdate:modelValue":T[1]||(T[1]=B=>h.value.username=B),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(r,null,{default:n(()=>[t(v,{theme:"primary",onClick:f},{default:n(()=>T[6]||(T[6]=[S("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(V,{class:"sh-card"},{default:n(()=>[t(j,null,{default:n(()=>[t(v,{onClick:I},{default:n(()=>T[7]||(T[7]=[S("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),t(Y,{visible:i.value,"onUpdate:visible":T[5]||(T[5]=B=>i.value=B),header:"创建比赛",onConfirm:w,"confirm-loading":_.value},{default:n(()=>[t(x,{"label-width":80,model:k.value,onSubmit:T[4]||(T[4]=Ge(()=>{},["prevent"]))},{default:n(()=>[t(r,{label:"标题"},{default:n(()=>[t(c,{modelValue:k.value.title,"onUpdate:modelValue":T[2]||(T[2]=B=>k.value.title=B),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),t(r,{label:"开启时间"},{default:n(()=>[t(A,{"enable-time-picker":"","allow-input":"",clearable:"",modelValue:k.value.open_time,"onUpdate:modelValue":T[3]||(T[3]=B=>k.value.open_time=B)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Me=ee(fo,[["__scopeId","data-v-3e6ea683"]]),_o={style:{margin:"20px"}},go=["innerHTML"],vo={style:{margin:"12px"}},ho=te({__name:"ContestDetail",setup(e){let a=de();const{globalProperties:o}=ue(),s=Te();let l=0;const i=p(!1),_=p(null),P=p([{title:"问题ID",colKey:"id",cell:(d,u)=>t(G,{variant:"text",onClick:()=>g(l,u.row.index)},{default:()=>[u.row.id]})},{title:"标题",colKey:"title",cell:(d,u)=>t(G,{variant:"text",onClick:()=>g(l,u.row.index)},{default:()=>[u.row.title]})},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),y=p([]),g=(d,u)=>{N.push({name:"contest-problem-detail",params:{contestId:d,problemIndex:u}})};return ne(async()=>{if(Array.isArray(a.params.contestId)?l=a.params.contestId[0]:l=a.params.contestId,!l){await N.push({name:"contest"});return}i.value=!0;const d=await Nn(l);if(d.code!==0){i.value=!1,H(o,d.code),await N.push({name:"contest"});return}_.value=await Ot(d.data),y.value=_.value.problems,s.setTitle(_.value.title+" - "+s.getTitle),await ye(()=>{const u=document.querySelectorAll(".dida-content-description");u&&u.length>0&&u.forEach(b=>{le.mathRender(b),le.highlightRender({lineNumber:!0,enable:!0},b),Ae(b)}),i.value=!1})}),(d,u)=>{const b=Tt,h=G,k=pe,m=jt,f=zt,$=Pe,D=re,I=ge,w=De,F=$e,T=ve,L=_e;return z(),q(L,{loading:i.value},{default:n(()=>[t(T,{class:"dida-main-content"},{default:n(()=>[t(I,{span:8},{default:n(()=>{var V,C,c;return[R("div",_o,[R("h1",null,E((V=_.value)==null?void 0:V.title),1),(C=_.value)!=null&&C.notification?(z(),q(b,{key:0,theme:"info",message:(c=_.value)==null?void 0:c.notification},null,8,["message"])):ie("",!0)]),t(f,{"default-value":[0],"expand-icon":!1,borderless:!0},{default:n(()=>{var r;return[(z(!0),J(Q,null,ce((r=_.value)==null?void 0:r.descriptions,(v,x)=>(z(),q(m,{key:x,header:v.title},st({default:n(()=>[R("div",{innerHTML:v.content,class:"dida-content-description"},null,8,go)]),_:2},[x===0?{name:"headerRightContent",fn:n(()=>[t(k,{size:"small"},{default:n(()=>[t(h,{size:"small"},{default:n(()=>u[0]||(u[0]=[S("收起全部")])),_:1}),t(h,{size:"small"},{default:n(()=>u[1]||(u[1]=[S("展开全部")])),_:1})]),_:1})]),key:"0"}:void 0]),1032,["header"]))),128))]}),_:1}),t(D,{style:{margin:"10px"}},{default:n(()=>[t($,{data:y.value,columns:P.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1})]}),_:1}),t(I,{span:4},{default:n(()=>[R("div",vo,[t(F,{layout:"vertical",bordered:!0},{default:n(()=>[t(w,{label:"开始时间"},{default:n(()=>{var V;return[S(E((V=_.value)==null?void 0:V.startTime),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),bo=ee(ho,[["__scopeId","data-v-6fc9361e"]]);function Bt(e){const a={};return a.id=e.id,a.authorId=e.author_id,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.title=e.title,a.content=e.content,e.insert_time&&(a.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(a.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(a.updateTime=new Date(e.update_time).toLocaleString()),a.problemId=e.problem_id,a.problemTitle=e.problem_title,a.contestId=e.contest_id,a.contestTitle=e.contest_title,a.contestProblemIndex=e.contest_problem_index,a}async function yo(e){const a={};if(a.id=e.id,a.authorId=e.author_id,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.content="",e.content){const o={math:{inlineDigit:!0,engine:"KaTeX"}};a.content=await le.md2html(e.content,o)}return e.insert_time&&(a.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(a.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(a.updateTime=new Date(e.update_time).toLocaleString()),a}function wo(e){return X({url:"/discuss?id="+e,method:"get"})}function ko(e,a,o,s,l,i){const _={};return e&&(_.contest_id=e),a&&(_.problem_id=a),o&&(_.title=o),s&&(_.username=s),l&&(_.page=l),i&&(_.page_size=i),X({url:`/discuss/list?${new URLSearchParams(_).toString()}`,method:"get"})}function So(e,a,o){return X({url:"/discuss/comment/list?id="+e+"&page="+a+"&page_size="+o,method:"get"})}function Co(e){return X({url:"/discuss/create",method:"post",data:e})}const Io={style:{margin:"10px"}};function Po(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ee(e)}const To=te({__name:"DiscussList",setup(e){const a=de(),o=Fe(),{globalProperties:s}=ue();let l=null;const i=p(!1),_=p(!1);let P=0;const y=p([]),g=[],d=[{title:"标题",colKey:"title",cell:(c,r)=>t(G,{variant:"text",onClick:()=>w(r.row.id)},{default:()=>[r.row.title]})},{title:"创建人",colKey:"authorNickname",width:"200"},{title:"创建时间",colKey:"insertTime",width:"180"},{title:"更新时间",colKey:"updateTime",width:"180"}],u=p(!1);let b=1,h=50;const k=p({current:b,pageSize:h,defaultCurrent:b,defaultPageSize:h,total:0,pageSizeOptions:[50,100]}),m=p(),f=p({problemId:"",title:"",username:""}),$=p({title:"",description:"",open_time:[]}),D=c=>{c&&o.push({name:"problem-detail",params:{problemId:c}})},I=(c,r)=>{o.push({name:"contest-problem-detail",params:{contestId:c,problemIndex:r}})},w=c=>{if(c){if(P){o.push({name:"contest-discuss-detail",params:{contestId:P,discussId:c}});return}o.push({name:"discuss-detail",params:{discussId:c}})}},F=async()=>{await o.push({query:{...a.query,problem_id:f.value.problemId,title:f.value.title,username:f.value.username,page:1,page_size:k.value.defaultPageSize}})},T=async(c,r)=>{var v;u.value=!0;try{const{current:x,pageSize:j}=c,U=await ko(P,f.value.problemId,f.value.title,f.value.username,x,j);if(m.value=[],U.code===0){if(U.data.list){const A=U.data.list;for(let Y=0;Y<A.length;Y++){const B=A[Y],O=await Bt(B);(v=m.value)==null||v.push(O)}}k.value={...k.value,total:U.data.total_count}}else r&&H(s,U.code)}catch(x){console.error(x),H(s,Ce())}finally{u.value=!1}},L=async c=>{await o.push({query:{...a.query,page:c.current,page_size:c.pageSize}})},V=()=>{i.value=!0},C=async()=>{_.value=!0,console.log("discussCreateForm",$.value),Co($.value).then(c=>{c.code===0?(me(s,"创建比赛成功"),i.value=!1,o.push({path:"/discuss/"+c.data.id})):H(s,c.code)}).finally(()=>{_.value=!1})};return ne(async()=>{l=je(()=>a.query,c=>{Array.isArray(a.params.contestId)?P=a.params.contestId[0]:P=a.params.contestId,y.value=g,P?y.value=y.value.concat([{title:"问题ID",colKey:"contestProblemIndex",width:"100",cell:(x,j)=>{let U;return j.row.contestProblemIndex?t(G,{variant:"text",onClick:()=>I(P,j.row.contestProblemIndex)},Po(U=tt(j.row.contestProblemIndex))?U:{default:()=>[U]}):""}}]):y.value=y.value.concat([{title:"问题ID",colKey:"problemId",width:"100",cell:(x,j)=>j.row.problemId?t(G,{variant:"text",onClick:()=>D(j.row.problemId)},{default:()=>[j.row.problemId]}):""}]),y.value=y.value.concat(d),f.value.problemId=c.problem_id||"",f.value.title=c.title||"",f.value.username=c.username||"";const r=parseInt(c.page)||k.value.defaultCurrent,v=parseInt(c.page_size)||k.value.defaultPageSize;b=r,h=v,k.value={...k.value,current:b,pageSize:h},T({current:b,pageSize:h},!0)},{immediate:!0})}),we(()=>{l&&l()}),(c,r)=>{const v=Pe,x=re,j=ge,U=Ie,A=Ve,Y=G,B=ze,O=pe,W=ve,M=Vt,Z=Ze;return z(),J(Q,null,[t(W,null,{default:n(()=>[t(j,{span:9},{default:n(()=>[t(x,{style:{margin:"10px"}},{default:n(()=>[t(v,{data:m.value,columns:y.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:k.value,loading:u.value,"table-layout":"auto",onPageChange:L},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(j,{span:3},{default:n(()=>[R("div",Io,[t(x,{class:"sh-card"},{default:n(()=>[t(B,{model:f.value},{default:n(()=>[t(A,{label:"问题ID"},{default:n(()=>[t(U,{modelValue:f.value.problemId,"onUpdate:modelValue":r[0]||(r[0]=ae=>f.value.problemId=ae),placeholder:"请输入完整问题ID"},null,8,["modelValue"])]),_:1}),t(A,{label:"标题"},{default:n(()=>[t(U,{modelValue:f.value.title,"onUpdate:modelValue":r[1]||(r[1]=ae=>f.value.title=ae),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(A,{label:"创建人"},{default:n(()=>[t(U,{modelValue:f.value.username,"onUpdate:modelValue":r[2]||(r[2]=ae=>f.value.username=ae),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(A,null,{default:n(()=>[t(Y,{theme:"primary",onClick:F},{default:n(()=>r[7]||(r[7]=[S("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(x,{class:"sh-card"},{default:n(()=>[t(O,null,{default:n(()=>[t(Y,{onClick:V},{default:n(()=>r[8]||(r[8]=[S("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),t(Z,{visible:i.value,"onUpdate:visible":r[6]||(r[6]=ae=>i.value=ae),header:"创建比赛",onConfirm:C,"confirm-loading":_.value},{default:n(()=>[t(B,{"label-width":80,model:$.value,onSubmit:r[5]||(r[5]=Ge(()=>{},["prevent"]))},{default:n(()=>[t(A,{label:"标题"},{default:n(()=>[t(U,{modelValue:$.value.title,"onUpdate:modelValue":r[3]||(r[3]=ae=>$.value.title=ae),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),t(A,{label:"开启时间"},{default:n(()=>[t(M,{"enable-time-picker":"","allow-input":"",clearable:"",modelValue:$.value.open_time,"onUpdate:modelValue":r[4]||(r[4]=ae=>$.value.open_time=ae)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Oe=ee(To,[["__scopeId","data-v-ead0d59d"]]),Lo={key:0,style:{margin:"20px"}},xo=["innerHTML"],jo=["innerHTML"],zo={style:{margin:"10px"}},Vo={style:{margin:"10px"}},$o={style:{margin:"10px","text-align":"right"}},Do={style:{margin:"12px"}},Ro={key:0,class:"dida-edit-container"},Uo=te({__name:"DiscussDetail",props:{discussId:{}},setup(e){const a=e;let o=de();const{globalProperties:s}=ue();let l=null;const i=Te(),_=be();let P=p("");const y=p(""),g=p(null),d=p(!1),u=p(null),b=p(!1);let h=1,k=20;const m=p({current:1,total:0,defaultPageSize:k,defaultCurrent:h,pageSizeOptions:[20,50]}),f=p([]),$={},D=Le(()=>_.hasAuth(xe.ManageDiscuss)),I=C=>{C&&N.push({name:"discuss-list",query:{...o.query,title:"",tag:C.name}})},w=()=>{N.push({name:"manage-discuss",params:{discussId:y.value}})},F=()=>t("div",{class:"t-pagination__total"},[`共 ${m.value.total} 条回复`]),T=()=>{},L=async(C,c)=>{var r;b.value=!0;try{const{current:v,pageSize:x}=C,j=await So(y.value,v,x);if(f.value=[],j.code===0){const U=j.data.list;if(U)for(let A=0;A<U.length;A++){const Y=U[A],B=await yo(Y);(r=f.value)==null||r.push(B),await ye(()=>{const O=document.querySelectorAll(".dida-discuss-content");O&&O.length>0&&O.forEach(W=>{le.mathRender(W),le.highlightRender({lineNumber:!0,enable:!0},W),Ae(W)})})}m.value={...m.value,total:j.data.total_count}}else c&&H(s,j.code)}catch(v){console.error(v),H(s,Ce())}finally{b.value=!1}},V=async C=>{await N.push({query:{...o.query,page:C.current,page_size:C.pageSize}})};return ne(async()=>{if(y.value=a.discussId,y.value||(Array.isArray(o.params.discussId)?y.value=o.params.discussId[0]:y.value=o.params.discussId),!y.value){se(s,"讨论不存在"),await N.push({name:"discuss"});return}d.value=!0;const C=await wo(y.value);if(C.code!==0){d.value=!1,H(s,C.code),await N.push({name:"discuss"});return}C.data.tags&&C.data.tags.forEach(x=>{$[x.id]=x}),u.value=Bt(C.data.discuss),i.setTitle(u.value.title+" - "+i.getTitle);let c=u.value.content;const r={math:{inlineDigit:!0,engine:"KaTeX"}};P.value=await le.md2html(c,r),await ye(()=>{g.value&&(le.mathRender(g.value),le.highlightRender({lineNumber:!0,enable:!0},g.value),Ae(g.value)),d.value=!1}),l=je(()=>o.query,x=>{const j=parseInt(x.page)||m.value.defaultCurrent,U=parseInt(x.page_size)||m.value.defaultPageSize;h=j,k=U,m.value={...m.value,current:h,pageSize:k},L({current:h,pageSize:k},!0)},{immediate:!0});const v={after:()=>{}};new le("commentEditRef",v)}),we(()=>{l&&l()}),(C,c)=>{const r=ya,v=ba,x=re,j=pe,U=wa,A=G,Y=ge,B=De,O=$e,W=ve,M=_e;return z(),q(M,{loading:d.value},{default:n(()=>[t(W,{class:"dida-main-content"},{default:n(()=>[t(Y,{span:8},{default:n(()=>{var Z,ae,fe;return[(Z=u.value)!=null&&Z.problemTitle||(ae=u.value)!=null&&ae.contestTitle?(z(),J("div",Lo,[t(v,{"max-item-width":"300"},{default:n(()=>{var K,ke,pt,ft,_t;return[(K=u.value)!=null&&K.contestTitle?(z(),J(Q,{key:0},[t(r,{to:{name:"contest-detail",params:{contestId:(ke=u.value)==null?void 0:ke.contestId}}},{default:n(()=>{var Se;return[S(E((Se=u.value)==null?void 0:Se.contestTitle),1)]}),_:1},8,["to"]),(pt=u.value)!=null&&pt.contestProblemIndex?(z(),q(r,{key:0,to:{name:"contest-problem-detail",params:{problemIndex:(ft=u.value)==null?void 0:ft.contestProblemIndex}}},{default:n(()=>{var Se,gt;return[S(E(oe(tt)((Se=u.value)==null?void 0:Se.contestProblemIndex))+" - "+E((gt=u.value)==null?void 0:gt.problemTitle),1)]}),_:1},8,["to"])):ie("",!0)],64)):(z(),J(Q,{key:1},[t(r,{to:{name:"discuss-list-problem"}},{default:n(()=>c[2]||(c[2]=[S(" 问题讨论")])),_:1}),t(r,{to:{name:"problem-detail",params:{problemId:(_t=u.value)==null?void 0:_t.problemId}}},{default:n(()=>{var Se;return[S(E((Se=u.value)==null?void 0:Se.problemTitle),1)]}),_:1},8,["to"])],64))]}),_:1})])):ie("",!0),t(x,{style:{margin:"10px"},header:(fe=u.value)==null?void 0:fe.title,"header-bordered":!0},{default:n(()=>[R("div",{innerHTML:oe(P),class:"dida-discuss-content"},null,8,xo)]),_:1},8,["header"]),(z(!0),J(Q,null,ce(f.value,(K,ke)=>(z(),q(x,{key:ke,style:{margin:"10px"},"header-bordered":""},{header:n(()=>[t(j,null,{default:n(()=>[R("span",null,E(K.authorNickname),1),R("span",null,E(K.insertTime),1)]),_:2},1024)]),default:n(()=>[R("div",{innerHTML:K.content,class:"dida-discuss-content"},null,8,jo)]),_:2},1024))),128)),R("div",zo,[t(U,{modelValue:m.value.current,"onUpdate:modelValue":c[0]||(c[0]=K=>m.value.current=K),"page-size":m.value.pageSize,"onUpdate:pageSize":c[1]||(c[1]=K=>m.value.pageSize=K),total:m.value.total,"page-size-options":m.value.pageSizeOptions,"show-page-size":!1,"total-content":F,onChange:V},null,8,["modelValue","page-size","total","page-size-options"])]),R("div",Vo,[c[4]||(c[4]=R("div",{id:"commentEditRef",class:"dida-comment-editor"},null,-1)),R("div",$o,[t(j,null,{default:n(()=>[t(A,{theme:"primary",onClick:T},{default:n(()=>c[3]||(c[3]=[S("提交")])),_:1})]),_:1})])])]}),_:1}),t(Y,{span:4},{default:n(()=>[R("div",Do,[D.value?(z(),J("div",Ro,[t(A,{onClick:w},{default:n(()=>c[5]||(c[5]=[S("编辑")])),_:1})])):ie("",!0),t(O,{layout:"vertical",bordered:!0},{default:n(()=>[t(B,{label:"创建时间"},{default:n(()=>{var Z;return[S(E((Z=u.value)==null?void 0:Z.insertTime),1)]}),_:1}),t(B,{label:"编辑时间"},{default:n(()=>{var Z;return[S(E((Z=u.value)==null?void 0:Z.modifyTime),1)]}),_:1}),t(B,{label:"更新时间"},{default:n(()=>{var Z;return[S(E((Z=u.value)==null?void 0:Z.updateTime),1)]}),_:1}),t(B,{label:"创建用户"},{default:n(()=>{var Z;return[S(E((Z=u.value)==null?void 0:Z.authorNickname),1)]}),_:1}),t(B,{label:"标签"},{default:n(()=>[t(j,null,{default:n(()=>{var Z;return[(z(!0),J(Q,null,ce((Z=u.value)==null?void 0:Z.tags,ae=>(z(),q(A,{key:ae.id,variant:"dashed",onClick:()=>I(ae)},{default:n(()=>[S(E(ae.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),at=ee(Uo,[["__scopeId","data-v-8b88dec8"]]);function Ao(e,a){return X({url:"/rank/ac/all?page="+e+"&page_size="+a,method:"get"})}function Eo(e,a){return X({url:"/rank/ac/problem?page="+e+"&page_size="+a,method:"get"})}function Fo(e,a){return X({url:"/rank/ac/problem/today?page="+e+"&page_size="+a,method:"get"})}function Mo(e,a){return X({url:"/rank/ac/problem/day7?page="+e+"&page_size="+a,method:"get"})}function qo(e,a){return X({url:"/rank/ac/problem/year?page="+e+"&page_size="+a,method:"get"})}const Go={style:{margin:"10px"}};function nt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ee(e)}const Ko=te({__name:"RankUser",props:{type:{}},setup(e){const a=de(),o=Fe(),{globalProperties:s}=ue();let l=null;const i=e,_=p(""),P=p(""),y={all:{header:"统计所有用户在本站的提交记录",content:"优先以AC记录数量排序，如果相同则提交所用次数较少的优先，如果仍相同，注册较早的用户靠前"},problem:{header:"统计所有用户在本站的提交记录",content:"以题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-today":{header:"统计所有用户今日在本站的提交记录",content:"以今日题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-day7":{header:"统计所有用户最近7日在本站的提交记录",content:"以7日题目记录数量排序（从7日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-year":{header:"统计所有用户最近1年在本站的提交记录",content:"以最近1年题目记录数量排序（从365日前的0点开始计算），如果相同，注册较早的用户靠前"}},g=p([]),d=[{title:"序号",colKey:"index"},{title:"用户名",colKey:"username",cell:(L,V)=>t(G,{variant:"dashed",onClick:()=>D(V.row.username)},{default:()=>[V.row.username]})},{title:"昵称",colKey:"nickname"},{title:"Slogan",colKey:"slogan"}],u=[{title:"题目数量",colKey:"problem_count",cell:(L,V)=>{let C=0;return V.row.problem_count&&(C=V.row.problem_count),t(G,{variant:"dashed",onClick:()=>I(V.row.username)},nt(C)?C:{default:()=>[C]})}}],b=[{title:"正确",colKey:"accept",cell:(L,V)=>{let C=0;return V.row.accept&&(C=V.row.accept),t(G,{variant:"dashed",onClick:()=>I(V.row.username)},nt(C)?C:{default:()=>[C]})}},{title:"提交",colKey:"attempt",cell:(L,V)=>{let C=0;return V.row.attempt&&(C=V.row.attempt),t(G,{variant:"dashed",onClick:()=>w(V.row.username)},nt(C)?C:{default:()=>[C]})}}],h=p(!1);let k=1,m=50;const f=p({current:k,pageSize:m,defaultCurrent:k,defaultPageSize:m,total:0,pageSizeOptions:[50]}),$=p(),D=L=>{o.push({name:"user",params:{username:L}})},I=L=>{o.push({name:"judge-list",query:{username:L,status:he.Accept}})},w=L=>{o.push({name:"judge-list",query:{username:L}})},F=async(L,V)=>{h.value=!0;try{$.value=[];const{current:C,pageSize:c}=L;let r=null;switch(i.type){case"problem":r=await Eo(C,c);break;case"problem-today":r=await Fo(C,c);break;case"problem-day7":r=await Mo(C,c);break;case"problem-year":r=await qo(C,c);break;default:r=await Ao(C,c);break}if(r.code===0){const v=r.data.list;if(!v||v.length<=0){f.value={...f.value,total:0},me(s,"未找到记录");return}$.value=[];const x=f.value.pageSize*(f.value.current-1);let j=1;v.forEach(U=>{var Y;const A=U;A.index=x+j++,(Y=$.value)==null||Y.push(A)}),f.value={...f.value,total:r.data.total_count}}else V&&H(s,r.code)}catch(C){console.error(C),H(s,Ce())}finally{h.value=!1}},T=async L=>{await o.push({query:{...a.query,page:L.current,page_size:L.pageSize}})};return ne(async()=>{h.value=!0,l=je(()=>a.query,L=>{switch(i.type&&y[i.type]?(_.value=y[i.type].header,P.value=y[i.type].content):(_.value=y.all.header,P.value=y.all.content),i.type){case"all":g.value=d.concat(b);break;default:g.value=d.concat(u);break}const V=parseInt(L.page)||f.value.defaultCurrent,C=parseInt(L.page_size)||f.value.defaultPageSize;k=V,m=C,f.value={...f.value,current:k,pageSize:m},F({current:k,pageSize:m},!0)},{immediate:!0})}),we(()=>{l&&l()}),(L,V)=>{const C=Pe,c=re,r=ge,v=ve;return z(),q(v,null,{default:n(()=>[t(r,{span:9},{default:n(()=>[t(c,{style:{margin:"10px"}},{default:n(()=>[t(C,{data:$.value,columns:g.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:f.value,loading:h.value,"table-layout":"auto",onPageChange:T},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(r,{span:3},{default:n(()=>[R("div",Go,[t(c,{class:"sh-card",header:_.value,"header-bordered":!0},{default:n(()=>[S(E(P.value),1)]),_:1},8,["header"])])]),_:1})]),_:1})}}}),qe=ee(Ko,[["__scopeId","data-v-ad6297d7"]]),Ho=te({__name:"ManageJudge",setup(e){const{globalProperties:a}=ue(),o=p(""),s=p(!1),l=p(!1),i=p(!1),_=async()=>{s.value=!0;try{const g=await Vn();if(g.code!==0){H(a,g.code);return}me(a,"重判成功"),await N.push({name:"judge-list"})}catch(g){console.error(g),H(a,"重判失败")}finally{s.value=!1}},P=async()=>{if(o.value===""){H(a,"请输入问题Id");return}l.value=!0;try{const g=await $n(o.value);if(g.code!==0){H(a,g.code);return}me(a,"重判成功"),await N.push({name:"judge-list",query:{problem_id:o.value}})}catch(g){console.error(g),H(a,"重判失败")}finally{l.value=!1}},y=async()=>{i.value=!0;try{const g=await Dn();if(g.code!==0){H(a,g.code);return}me(a,"重判成功"),await N.push({name:"judge-list"})}catch(g){console.error(g),H(a,"重判失败")}finally{i.value=!1}};return(g,d)=>{const u=G,b=re,h=Ie,k=pe;return z(),J(Q,null,[t(b,{class:"yj-manage-card",title:"重判最近提交"},{default:n(()=>[t(u,{onClick:_,loading:s.value},{default:n(()=>d[1]||(d[1]=[S("重判")])),_:1},8,["loading"])]),_:1}),t(b,{class:"yj-manage-card",title:"重判问题"},{default:n(()=>[t(k,null,{default:n(()=>[t(h,{modelValue:o.value,"onUpdate:modelValue":d[0]||(d[0]=m=>o.value=m),placeholder:"输入问题Id"},null,8,["modelValue"]),t(u,{onClick:P,loading:l.value},{default:n(()=>d[2]||(d[2]=[S("重判")])),_:1},8,["loading"])]),_:1})]),_:1}),t(b,{class:"yj-manage-card",title:"重判所有"},{default:n(()=>[t(u,{onClick:y,theme:"danger",loading:i.value},{default:n(()=>d[3]||(d[3]=[S("重判")])),_:1},8,["loading"])]),_:1})],64)}}}),No=ee(Ho,[["__scopeId","data-v-14c853f1"]]),Oo={style:{margin:"10px"}},Bo={key:1},Jo={style:{margin:"12px"}},Wo={class:"dida-edit-container"},Xo=te({__name:"ProblemEdit",setup(e){let a=de();const{globalProperties:o}=ue(),s=Te(),l=p(""),i=p(!1);let _=null;const P=p(!1),y=p(null),g=p({title:"",timeLimit:0,memoryLimit:0,source:"",tags:[]}),d=p([]),u=p([]),b=Le(()=>{const I=[],w=d.value;for(let F=0,T=w.length;F<T;F++)w[F].value&&I.push(w[F].value);return I}),h=(I,w)=>{const{trigger:F,index:T,item:L}=w;if(F==="clear"&&(d.value=[]),["tag-remove","backspace"].includes(F)&&d.value.splice(T,1),F==="enter"){for(let C=0;C<u.value.length;C++){const c=u.value[C];if(c.label===L){for(let r=0;r<d.value.length;r++)if(d.value[r].label===c.label)return;d.value.push(c);return}}const V={label:L,value:L};d.value.push(V),u.value=u.value.concat(V)}},k=(I,{current:w,type:F})=>{if(!w){d.value=F==="check"?u.value.slice(1):[];return}if(F==="check"){const T=u.value.find(L=>L.value===w);if(!T)return;d.value.push(T)}else d.value=d.value.filter(T=>T.value!==w)},m=()=>{N.push({name:"problem-detail",params:{problemId:l.value}})},f=()=>{N.push({name:"manage-problem-judge",params:{problemId:l.value}})},$=async()=>{if(_){P.value=!0,g.value.tags=[];for(let I=0;I<d.value.length;I++){const w=d.value[I];w&&w.label&&g.value.tags.push(w.label)}try{const I=await En(l.value,g.value.title,g.value.timeLimit,g.value.memoryLimit,g.value.source,g.value.tags,_.getValue());if(P.value=!0,I.code!==0){H(o,I.code);return}I.data!=null&&(y.value.updateTime=new Date(I.data).toLocaleString()),At(o,"保存成功")}finally{P.value=!1}}},D=async()=>{const I=await Ht(l.value);if(I.code!==0){H(o,I.code),console.error("problem get failed",I.code),await N.push({name:"problem"});return}const w=I.data.problem;if(y.value=et(w,{}),g.value.title=w.title,g.value.timeLimit=w.time_limit,g.value.memoryLimit=w.memory_limit,g.value.source=w.source,g.value.tags=[],d.value=[],I.data.tags)for(let L=0;L<I.data.tags.length;L++){const V=I.data.tags[L];V&&V.name&&(g.value.tags.push(V.name),d.value.push({label:V.name,value:V.id}))}s.setTitle(w.title+" - "+s.getTitle);let F=w.description;const T={after:()=>{_==null||_.setValue(F)}};_=new le("codeEditRef",T),i.value=!1};return ne(async()=>{if(Array.isArray(a.params.problemId)?l.value=a.params.problemId[0]:l.value=a.params.problemId,!l.value){se(o,"题目不存在"),await N.push({name:"problem"});return}i.value=!0,Nt(-1).then(async I=>{I.code===0?(I.data.list&&I.data.list.forEach(w=>{u.value.push({label:w.name,value:w.id})}),await D()):(H(o,I.code),console.error("problem tag get failed",I.code),await N.push({name:"problem"}))}).catch(async I=>{console.error(I),H(o,"获取数据异常"),await N.push({name:"problem"})})}),(I,w)=>{const F=Ie,T=Ve,L=ka,V=Ca,C=Sa,c=ze,r=re,v=ge,x=G,j=pe,U=De,A=$e,Y=ve,B=_e;return z(),q(B,{loading:i.value},{default:n(()=>[t(Y,null,{default:n(()=>[t(v,{span:8},{default:n(()=>[R("div",Oo,[t(r,{class:"sh-card"},{default:n(()=>[t(c,{model:g.value},{default:n(()=>[t(T,{label:"标题"},{default:n(()=>[t(F,{modelValue:g.value.title,"onUpdate:modelValue":w[0]||(w[0]=O=>g.value.title=O),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),t(T,{label:"时间限制"},{default:n(()=>[t(L,{modelValue:g.value.timeLimit,"onUpdate:modelValue":w[1]||(w[1]=O=>g.value.timeLimit=O),theme:"normal",min:0},{suffix:n(()=>w[4]||(w[4]=[R("span",null,"ms",-1)])),_:1},8,["modelValue"])]),_:1}),t(T,{label:"内存限制"},{default:n(()=>[t(L,{modelValue:g.value.memoryLimit,"onUpdate:modelValue":w[2]||(w[2]=O=>g.value.memoryLimit=O),theme:"normal",min:0},{suffix:n(()=>w[5]||(w[5]=[R("span",null,"KB",-1)])),_:1},8,["modelValue"])]),_:1}),t(T,{label:"来源"},{default:n(()=>[t(F,{modelValue:g.value.source,"onUpdate:modelValue":w[3]||(w[3]=O=>g.value.source=O),placeholder:"请输入题目来源"},null,8,["modelValue"])]),_:1}),t(T,{label:"标签"},{default:n(()=>[t(C,{value:d.value,"allow-input":!0,placeholder:"请选择或输入","tag-input-props":{excessTagsDisplayType:"break-line"},"popup-props":{overlayInnerClassName:["narrow-scrollbar"],overlayInnerStyle:{maxHeight:"280px",overflowY:"auto",overscrollBehavior:"contain",padding:"6px"}},clearable:"",multiple:"",onTagChange:h},{panel:n(()=>[u.value.length?(z(),q(V,{key:0,value:b.value,options:u.value,onChange:k},null,8,["value","options"])):(z(),J("div",Bo,"暂无数据"))]),suffixIcon:n(()=>[t(oe(ta))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(v,{span:4},{default:n(()=>[R("div",Jo,[R("div",Wo,[t(j,null,{default:n(()=>[t(x,{onClick:$,theme:"danger",loading:P.value},{default:n(()=>w[6]||(w[6]=[S("保存")])),_:1},8,["loading"]),t(x,{onClick:f,theme:"warning"},{default:n(()=>w[7]||(w[7]=[S("判题数据")])),_:1}),t(x,{onClick:m},{default:n(()=>w[8]||(w[8]=[S("查看")])),_:1})]),_:1})]),t(A,{layout:"vertical",bordered:!0},{default:n(()=>[t(U,{label:"创建时间"},{default:n(()=>{var O;return[S(E((O=y.value)==null?void 0:O.insertTime),1)]}),_:1}),t(U,{label:"更新时间"},{default:n(()=>{var O;return[S(E((O=y.value)==null?void 0:O.updateTime),1)]}),_:1}),t(U,{label:"判题方式"},{default:n(()=>{var O;return[S(E((O=y.value)==null?void 0:O.judgeType),1)]}),_:1}),t(U,{label:"上传用户"},{default:n(()=>{var O;return[S(E((O=y.value)==null?void 0:O.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1}),w[9]||(w[9]=R("div",{id:"codeEditRef",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"])}}}),Yo=ee(Xo,[["__scopeId","data-v-e994311e"]]),Zo={style:{margin:"10px"}},Qo={style:{margin:"12px"}},el={class:"dida-edit-container"},tl=te({__name:"ProblemJudge",setup(e){let a=de();const{globalProperties:o}=ue(),s=Te(),l=p(""),i=p(!1),_=p(null);let P=null;const y=p(null),g=p(""),d=p(!1),u=p(!1),b=p([{title:"文件",colKey:"file"},{title:"大小",colKey:"size",width:150,cell:(c,r)=>r.row.size.toFixed(0)+" B"},{title:"最后修改时间",colKey:"lastModified",width:180,cell:(c,r)=>new Date(r.row.lastModified).toLocaleString()},{title:"操作",colKey:"action",width:100,cell:(c,r)=>t(G,{onClick:()=>D(r.row.file)},{default:()=>[S("下载")]})}]),h=p([]),k=Le(()=>({border:"2px dashed #ccc",borderRadius:"6px",padding:"20px",textAlign:"center",cursor:"pointer",backgroundColor:d.value?"#f0f9ff":"#fff",transition:"background-color 0.2s ease"})),m=Le(()=>g.value?`已选择：${g.value}`:d.value?"松开文件以上传":"拖拽文件到这里，或点击选择文件"),f=()=>{N.push({name:"problem-detail",params:{problemId:l.value}})},$=()=>{N.push({name:"manage-problem",params:{problemId:l.value}})},D=async c=>{const r=await Fn(l.value,c);if(r.code!==0){H(o,r.code);return}const v=document.createElement("a");v.href=r.data,v.target="_blank",v.click(),URL.revokeObjectURL(v.href)},I=async()=>{if(!P){se(o,"请选择压缩包");return}u.value=!0,Mn(l.value,P).then(async c=>{c.code==0?(y.value.value=null,P=null,g.value="",i.value=!0,At(o,"上传成功"),await C()):H(o,c.code)}).catch(c=>{console.log(c),o.$message.error({duration:3e3,content:"申请失败"})}).finally(()=>{u.value=!1})},w=()=>{var c;(c=y.value)==null||c.click()},F=c=>{const r=c.target.files[0];r&&(g.value=r.name,P=r)},T=c=>{d.value=!0},L=()=>{d.value=!1},V=c=>{c.preventDefault(),c.stopPropagation(),d.value=!1;const r=c.dataTransfer.files[0];if(r){g.value=r.name;const v=new DataTransfer;v.items.add(r),y.value.files=v.files,P=r}},C=async()=>{const c=await Un(l.value);if(c.code!==0){H(o,c.code),await N.push({name:"problem"});return}const r=c.data.problem;_.value=et(r,{}),s.setTitle(r.title+" - "+s.getTitle),h.value=[],c.data.judges?c.data.judges.forEach(v=>{h.value.push({file:v.key,size:v.size,lastModified:v.last_modified})}):se(o,"评测数据不存在"),i.value=!1};return ne(async()=>{if(Array.isArray(a.params.problemId)?l.value=a.params.problemId[0]:l.value=a.params.problemId,!l.value){se(o,"题目不存在"),await N.push({name:"problem"});return}i.value=!0,await C()}),(c,r)=>{const v=Pe,x=ge,j=G,U=pe,A=De,Y=$e,B=ve,O=_e;return z(),q(O,{loading:i.value},{default:n(()=>[t(B,null,{default:n(()=>[t(x,{span:7},{default:n(()=>[R("div",Zo,[R("div",{id:"drop-zone",style:It(k.value),onClick:w,onDragenter:Ge(T,["prevent"]),onDragover:r[0]||(r[0]=Ge(()=>{},["prevent"])),onDragleave:Ge(L,["prevent"]),onDrop:V},[R("input",{ref_key:"fileInput",ref:y,type:"file",style:{display:"none"},onChange:F},null,544),S(" "+E(m.value),1)],36)]),t(v,{data:h.value,columns:b.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1}),t(x,{span:5},{default:n(()=>[R("div",Qo,[R("div",el,[t(U,null,{default:n(()=>[t(j,{onClick:I,theme:"danger",loading:u.value},{default:n(()=>r[1]||(r[1]=[S("上传")])),_:1},8,["loading"]),t(j,{onClick:$,theme:"warning"},{default:n(()=>r[2]||(r[2]=[S("编辑")])),_:1}),t(j,{onClick:f},{default:n(()=>r[3]||(r[3]=[S("查看")])),_:1})]),_:1})]),t(Y,{layout:"vertical",bordered:!0},{default:n(()=>[t(A,{label:"标题"},{default:n(()=>{var W;return[S(E((W=_.value)==null?void 0:W.title),1)]}),_:1}),t(A,{label:"创建时间"},{default:n(()=>{var W;return[S(E((W=_.value)==null?void 0:W.insertTime),1)]}),_:1}),t(A,{label:"更新时间"},{default:n(()=>{var W;return[S(E((W=_.value)==null?void 0:W.updateTime),1)]}),_:1}),t(A,{label:"判题方式"},{default:n(()=>{var W;return[S(E((W=_.value)==null?void 0:W.judgeType),1)]}),_:1}),t(A,{label:"评测数据"},{default:n(()=>{var W;return[S(E((W=_.value)==null?void 0:W.judgeMd5),1)]}),_:1}),t(A,{label:"上传用户"},{default:n(()=>{var W;return[S(E((W=_.value)==null?void 0:W.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),al=ee(tl,[["__scopeId","data-v-3be5c9c9"]]),Jt=[{name:"problem-list",tab:"problem",sidebar:"problem-list",path:"",title:"问题列表",icon:"list",component:Hn},{name:"problem-detail",tab:"problem",sidebar:"problem-list",path:":problemId+",title:"问题详情",icon:"list",component:ht},{name:"problem-recommend",tab:"problem",sidebar:"problem-recommend",path:"recommend/:problemId*",title:"问题推荐",icon:"cpu",component:ao},{name:"judge-list",tab:"judge",sidebar:"judge-list",path:"",title:"评测列表",icon:"list",component:so},{name:"judge-detail",tab:"judge",sidebar:"judge-list",path:":judgeId+",title:"评测详情",icon:"cpu",component:mo},{name:"contest-list",tab:"contest",sidebar:"contest-list",path:"",title:"比赛列表",icon:"list",component:Me},{name:"contest-recent",tab:"contest",sidebar:"contest-recent",path:"recent",title:"近期比赛",icon:"list",component:Me},{name:"contest-detail",tab:"contest-detail-tab",sidebar:"contest-detail",path:":contestId+",title:"比赛详情",icon:"cpu",component:bo},{name:"contest-problem-detail",tab:"contest-detail-tab",sidebar:"contest-problem-detail",path:":contestId+/problem/:problemIndex+",title:"问题详情",icon:"cpu",component:ht},{name:"contest-judge",tab:"contest-detail-tab",sidebar:"contest-judge",path:":contestId+/judge",title:"评测列表",icon:"list",component:Me},{name:"contest-rank",tab:"contest-detail-tab",sidebar:"contest-rank",path:":contestId+/rank",title:"比赛排名",icon:"list",component:Me},{name:"contest-statistics",tab:"contest-detail-tab",sidebar:"contest-statistics",path:":contestId+/statistics",title:"结果统计",icon:"list",component:Me},{name:"contest-discuss",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss",title:"比赛讨论",icon:"list",component:Oe},{name:"contest-discuss-detail",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss/:discussId+",title:"讨论详情",icon:"list",component:at},{name:"discuss-list",tab:"discuss",sidebar:"discuss-list",path:"",title:"讨论列表",icon:"list",component:Oe},{name:"discuss-list-problem",tab:"discuss",sidebar:"discuss-list-problem",path:"problem",title:"问题讨论",icon:"list",component:Oe},{name:"discuss-list-judge",tab:"discuss",sidebar:"discuss-list-judge",path:"judge",title:"评测讨论",icon:"list",component:Oe},{name:"discuss-detail",tab:"discuss",sidebar:"discuss-list",path:":discussId+",title:"讨论详情",icon:"list",component:at},{name:"rank-ac-all",tab:"rank",sidebar:"rank-ac-all",path:"ac",title:"AC排名",icon:"base-station",props:{type:"all"},component:qe},{name:"rank-ac-problem",tab:"rank",sidebar:"rank-ac-problem",path:"ac/problem",title:"题量排名",icon:"base-station",props:{type:"problem"},component:qe},{name:"rank-ac-problem-today",tab:"rank",sidebar:"rank-ac-problem-today",path:"ac/problem/today",title:"今日题量",icon:"base-station",props:{type:"problem-today"},component:qe},{name:"rank-ac-problem-day7",tab:"rank",sidebar:"rank-ac-problem-day7",path:"ac/problem/day7",title:"7日题量",icon:"base-station",props:{type:"problem-day7"},component:qe},{name:"rank-ac-problem-year",tab:"rank",sidebar:"rank-ac-problem-year",path:"ac/problem/year",title:"1年题量",icon:"base-station",props:{type:"problem-year"},component:qe},{name:"tool-paste",tab:"tool",sidebar:"tool-paste",path:"paste",title:"码池",icon:"base-station",component:ut},{name:"system-status",tab:"system",sidebar:"system-status",path:"",title:"运行状态",icon:"base-station",component:ut},{name:"system-about",tab:"system",sidebar:"system-about",path:"about",title:"关于",icon:"base-station",props:{discussId:"52"},component:at},{name:"manage-problem",tab:"manage",sidebar:"manage-problem",disableSidebar:!0,path:"problem/:problemId+",title:"问题编辑",icon:"list",component:Yo,auths:[xe.ManageProblem]},{name:"manage-problem-judge",tab:"manage",sidebar:"manage-problem-judge",disableSidebar:!0,path:"problem/:problemId+/judge",title:"评测数据",icon:"list",component:al,auths:[xe.ManageProblem]},{name:"manage-judge",tab:"manage",path:"judge",sidebar:"manage-judge",title:"评测管理",icon:"list",auths:["i-manage-judge"],component:No}],yt=(e,a,o,s)=>{s.tab==o&&(s.disableSidebar&&a!=s.sidebar||s.sidebar==null||s.sidebar!=s.name||e.push({name:s.name,title:s.title,icon:s.icon,to:{name:s.name}}))},nl=(e,a)=>{const o=[];return Jt.forEach(s=>{if(Et(s)){const l=[];s.children.forEach(i=>{yt(l,e,a,i)}),l.length>0&&o.push({title:s.title,children:l})}else yt(o,e,a,s)}),o},wt=(e,a)=>{const o=wn(a.tab),s={name:a.name,path:"/"+a.path,meta:{title:a.title+" - "+o.title,tab:a.tab,sidebar:a.sidebar,showSidebar:o.showSidebar,needLogin:o.needLogin||a.needLogin,tabAuths:o.auths,auths:a.auths},props:a.props,component:a.component};o.disablePath||(s.path=o.path+s.path),e.push(s)},ol=e=>{Jt.forEach(a=>{Et(a)?a.children.forEach(o=>{wt(e,o)}):wt(e,a)})},ll={class:"sh-main"},sl=te({__name:"View403",setup(e){let a=de();const o=p("");return ne(()=>{a.query.target?o.value=a.query.target:o.value=a.fullPath}),(s,l)=>{const i=G;return z(),J("div",ll,[R("p",null,E(o.value),1),l[2]||(l[2]=R("p",null,"该页面无访问权限，请更换访问目标或重新登陆后再试",-1)),t(i,{theme:"primary",onClick:l[0]||(l[0]=()=>s.$router.push("/"))},{default:n(()=>l[1]||(l[1]=[S("返回首页")])),_:1})])}}}),Wt=ee(sl,[["__scopeId","data-v-777362b3"]]),He=[];Sn(He);ol(He);He.push({path:"/403",name:"403",component:Wt});He.push({path:"/:pathMatch(.*)*",name:"404",component:Ut});const N=aa({history:na("/"),routes:He});N.beforeEach((e,a,o)=>{if(e.name==null||!N.hasRoute(e.name)){o({name:"home"});return}const s=e.matched[e.matched.length-1].meta;if(s.redirect){o({name:s.redirect});return}if(s.needLogin){const i=be();if(i.getToken==null||i.getToken==""){o({name:"login",query:{redirect_uri:e.fullPath}});return}}const l=s.tabAuths;if(l&&!be().hasAllAuths(l)){o({name:"403",query:{target:e.fullPath}});return}o()});N.afterEach((e,a)=>{if(e.name===a.name)return;const o=Qe(),s=Te();let l=null;if(e.matched.length>0&&(l=e.matched[e.matched.length-1].meta),l!=null&&l.title&&s.setTitle(l==null?void 0:l.title),l!=null&&l.showSidebar){o.setSidebarShow(!0);const i=nl(l==null?void 0:l.sidebar,l==null?void 0:l.tab);o.setMenuList(i),o.setMenuActiveName(l==null?void 0:l.sidebar)}else o.setSidebarShow(!1)});const Xt=Xe("login",{state:()=>({Loaded:!1}),getters:{isLoaded(){return this.Loaded}}}),rl=te({__name:"HeaderContent",setup(e){const a=Xt(),o=be(),{globalProperties:s}=ue(),l=p(a.isLoaded),i=p(!1),_=p(o.getUsername),P=p(o.getNickname),y=p(),g=()=>{y.value=kn(o)};a.$subscribe((b,h)=>{l.value=h.Loaded}),o.$subscribe((b,h)=>{_.value=h.username,P.value=h.nickname,i.value=h.token!="",g()});const d=()=>{s.$router.currentRoute.value.name!=="login"&&s.$router.push({name:"login",query:{redirect_uri:s.$router.currentRoute.value.fullPath}})},u=()=>{o.clear(),s.$message.success({duration:3e3,content:"注销成功"}),s.$router.push({path:"/login",query:{redirect_uri:s.$router.currentRoute.value.fullPath}})};return ne(()=>{g()}),(b,h)=>{const k=Pt("router-link"),m=Dt,f=$t,$=Ia,D=Pa;return z(),q(D,{modelValue:b.$route.meta.tab,"onUpdate:modelValue":h[0]||(h[0]=I=>b.$route.meta.tab=I),class:"sh-menu","expand-type":"popup"},{logo:n(()=>[t(k,{to:"/",class:"sh-logo"},{default:n(()=>h[1]||(h[1]=[S("DidaOJ")])),_:1})]),operations:n(()=>[l.value&&i.value?(z(),q($,{key:0,title:P.value},{icon:n(()=>[t(m,{name:"user"})]),default:n(()=>[t(f,{value:"user",to:{path:"/user/"+_.value}},{default:n(()=>h[2]||(h[2]=[S("个人空间")])),_:1},8,["to"]),t(f,{value:"user_logout",onClick:u},{default:n(()=>h[3]||(h[3]=[S(" 注销")])),_:1})]),_:1},8,["title"])):l.value?(z(),q(f,{key:2,value:"login",onClick:d},{icon:n(()=>[t(m,{name:"login"})]),default:n(()=>[h[5]||(h[5]=S(" 登录 "))]),_:1})):(z(),q(f,{key:1,value:"login"},{icon:n(()=>[t(m,{name:"login"})]),default:n(()=>[h[4]||(h[4]=S(" ... "))]),_:1}))]),default:n(()=>[(z(!0),J(Q,null,ce(y.value,I=>(z(),q(f,{key:I.name,value:I.name,to:{name:I.name}},{icon:n(()=>[I.icon?(z(),q(m,{key:0,name:I.icon},null,8,["name"])):ie("",!0)]),default:n(()=>[S(" "+E(I.title),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])}}}),ul=ee(rl,[["__scopeId","data-v-c64d812f"]]),il={id:"menu-container"},cl=te({__name:"SidebarContent",setup(e){const a=Qe(),o=p(!1),s=p(null),l=p(a.menuActiveName),i=p(a.menuList),_=p([]),P=p(!1),y=()=>{l.value=a.menuActiveName;const d=JSON.stringify(i.value),u=JSON.stringify(a.menuList);d!==u&&(_.value.push([...a.menuList]),g())},g=async()=>{if(_.value.length>0&&!P.value){for(P.value=!0;_.value.length>1;)_.value.shift();const d=_.value.shift();o.value=d.length<=0,i.value=[],await ye(),s.value&&s.value.updateActiveName(),await new Promise(b=>setTimeout(b,300)),i.value=d,await ye(),s.value&&s.value.updateActiveName();const u=300;await new Promise(b=>setTimeout(b,u)),P.value=!1,await g()}};return a.$subscribe((d,u)=>{y()}),ne(()=>{y()}),(d,u)=>{const b=Dt,h=$t,k=La,m=Ta,f=_e;return z(),J(Q,null,[R("div",il,[t(m,{modelValue:l.value,"onUpdate:modelValue":u[0]||(u[0]=$=>l.value=$),theme:"light",class:"sh-menu-container"},{default:n(()=>[t(oa,{name:"move-left"},{default:n(()=>[(z(!0),J(Q,null,ce(i.value,($,D)=>(z(),J(Q,{key:D},[oe(Cn)($)?(z(),q(k,{key:0,title:$.title},{default:n(()=>[(z(!0),J(Q,null,ce($.children,(I,w)=>(z(),q(h,{key:I.name,value:I.name,to:I.to},st({default:n(()=>[S(" "+E(I.title),1)]),_:2},[I.icon?{name:"icon",fn:n(()=>[t(b,{name:I.icon,class:rt(I.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))),128))]),_:2},1032,["title"])):(z(),q(h,{key:$.name,value:$.name,to:$.to},st({default:n(()=>[S(" "+E($.title),1)]),_:2},[$.icon?{name:"icon",fn:n(()=>[t(b,{name:$.icon,class:rt($.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),t(f,{size:"small",loading:o.value,"show-overlay":!0,attach:"#menu-container",class:"sh-sidebar-loading",style:{"align-items":"flex-start","padding-top":"100px"}},null,8,["loading"])],64)}}}),dl=ee(cl,[["__scopeId","data-v-96e2d89f"]]),ml={};function pl(e,a){return null}const fl=ee(ml,[["render",pl]]),_l={class:"footer"},gl={class:"footer-left"},vl={class:"foot-time"},hl={class:"footer-center"},bl={href:"https://beiancx.miit.gov.cn/",target:"_blank"},yl={class:"footer-right"},wl={class:"foot-text"},kl={href:"https://github.com/hpu-developer/DiDaOJ-web",target:"_blank"},Sl={class:"foot-text"},Cl={href:"https://github.com/hpu-developer/DiDaOJ-go",target:"_blank"},Il=te({__name:"FooterContent",setup(e){const a=p("");function o(){a.value=new Date().toLocaleString()}return ne(()=>{o(),setInterval(()=>{o()},1e3)}),(s,l)=>{const i=G;return z(),J("div",_l,[R("div",gl,[R("p",vl,E(a.value),1)]),R("div",hl,[R("a",bl,[t(i,{theme:"default",variant:"outline",ghost:!0},{default:n(()=>l[0]||(l[0]=[S("豫ICP备15024677号-4")])),_:1})])]),R("div",yl,[R("p",wl,[R("a",kl,[t(i,{theme:"default",variant:"outline",ghost:!0},{default:n(()=>l[1]||(l[1]=[S("@didaoj-web")])),_:1})])]),R("p",Sl,[R("a",Cl,[t(i,{theme:"default",variant:"outline",ghost:!0},{default:n(()=>l[2]||(l[2]=[S("@didaoj-go")])),_:1})])])])])}}}),Pl=ee(Il,[["__scopeId","data-v-979fed79"]]),Be=20,ot=100,lt=50,Tl=te({__name:"ForceHiddenSidebarButton",setup(e){let a=Qe();const o=p({x:window.innerWidth-ot-Be,y:window.innerHeight-lt-Be}),s=p(window.innerWidth),l=p(window.innerHeight);let i=!1,_={x:0,y:0};const P=$=>{i=!0;const D=$.clientX??$.touches[0].clientX,I=$.clientY??$.touches[0].clientY;_={x:D-o.value.x,y:I-o.value.y},document.addEventListener("mousemove",y),document.addEventListener("touchmove",y),document.addEventListener("mouseup",g),document.addEventListener("touchend",g)},y=$=>{if(!i)return;const D=$.clientX??$.touches[0].clientX,I=$.clientY??$.touches[0].clientY;let w=D-_.x,F=I-_.y;w=Math.max(0,Math.min(w,s.value-ot)),F=Math.max(0,Math.min(F,l.value-lt)),o.value={x:w,y:F}},g=()=>{i=!1,document.removeEventListener("mousemove",y),document.removeEventListener("touchmove",y),document.removeEventListener("mouseup",g),document.removeEventListener("touchend",g)},d=()=>{s.value=window.innerWidth,l.value=window.innerHeight,o.value={x:Math.min(o.value.x,s.value-ot-Be),y:Math.min(o.value.y,l.value-lt-Be)}};let u=p(a.forceHiddenSidebar),b=p(a.forceHiddenSidebar);const h=()=>{u.value=!u.value,a.setForceHiddenSidebar(u.value)},k=()=>{b.value||(b.value=!0,a.setForceHiddenSidebar(u.value))},m=()=>{b.value&&(b.value=!1,a.setForceHiddenSidebar(!1))},f=$=>{$>=800?m():k()};return f(s.value),je(s,$=>{f($)}),ne(()=>{window.addEventListener("resize",d)}),we(()=>{window.removeEventListener("resize",d)}),($,D)=>{const I=G;return oe(b)?(z(),q(I,{key:0,class:"draggable-button",style:It({top:`${o.value.y}px`,left:`${o.value.x}px`}),onMousedown:P,onTouchstart:P,variant:"dashed",theme:"primary",onClick:h},{default:n(()=>[S(E(oe(u)?"显示":"隐藏"),1)]),_:1},8,["style"])):ie("",!0)}}}),Ll=ee(Tl,[["__scopeId","data-v-1aee5506"]]),Je="DidaOJ",xl=te({__name:"App",setup(e){const{globalProperties:a}=ue(),o=Xt(),s=be(),l=Te(),i=Qe();o.$patch({Loaded:!1});const _=s.getToken,P=p(!1),y=p(!1);l.title&&l.title.length>0?document.title=l.title+" - "+Je:document.title=Je,l.$subscribe((b,h)=>{h.title&&h.title.length>0?document.title=h.title+" - "+Je:document.title=Je}),i.$subscribe((b,h)=>{P.value=h.showSidebar,y.value=P.value&&!h.forceHiddenSidebar});const g=de(),d=Le(()=>{const b=g.meta.auths;return b?!s.hasAllAuths(b):!1});function u(){a.$message.warning({duration:3e3,content:"登陆状态失效"}),o.$patch({Loaded:!0}),s.clear()}return ne(()=>{if(_==""){o.$patch({Loaded:!0});return}rn().then(b=>{b.code==0?(s.loadResponse(b.data),o.$patch({Loaded:!0})):(H(a,b.code),o.$patch({Loaded:!0}),s.clear())}).catch(b=>{console.log(b),u()})}),(b,h)=>{const k=xa,m=za,f=Pt("RouterView"),$=Va,D=ja,I=$a;return z(),J(Q,null,[t(D,null,{default:n(()=>[t(k,{class:"sh-header"},{default:n(()=>[t(ul)]),_:1}),t(D,null,{default:n(()=>[t(la,{name:"slide"},{default:n(()=>[y.value?(z(),q(m,{key:0,class:"sh-sidebar"},{default:n(()=>[t(dl)]),_:1})):ie("",!0)]),_:1}),t(D,{class:rt(["sh-main-layout",{expanded:!y.value}])},{default:n(()=>[t(fl),t($,{class:"sh-main-content"},{default:n(()=>[d.value?(z(),q(Wt,{key:0})):(z(),q(f,{key:1}))]),_:1}),t(Pl)]),_:1},8,["class"])]),_:1})]),_:1}),P.value?(z(),q(Ll,{key:0})):ie("",!0),t(I,{container:"body",offset:["24px","80px"],size:"small"})],64)}}}),jl=ee(xl,[["__scopeId","data-v-9e122cb4"]]);Ra.registerLanguage("verilog",Ua);const Yt=sa();Yt.use(ra);const Ne=ua(jl);Ne.use(Yt);Ne.use(N);Ne.use(Da);Ne.use(ia);Ne.mount("#app");tn().then(()=>{console.log("Text cache reinitialized")}).catch(e=>{console.error("Text cache reinitialization failed",e)});
