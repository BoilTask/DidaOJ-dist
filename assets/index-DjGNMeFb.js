import{ct as mt,d as ie,a as d,o as me,cu as E,cv as L,cw as a,e as t,cx as z,cy as q,bE as V,cz as ma,aM as Ka,cA as Me,cB as le,cC as ae,F as ue,cD as Se,cE as Fa,cF as ke,bS as pe,cG as Oa,cH as Ga,cI as Na,b as Te,v as dt,cJ as Ha,cK as Be,j as Ge,w as Le,a9 as Qe,bc as Ba,bd as Wa,cL as Ja,cM as Ya,cN as Xa,br as Za,cO as yt,cP as pa,cQ as fa,cj as Qa,cR as el,cS as tl,cT as al,cU as ll,bX as nl,cV as Yt,cW as Rt,cX as ol,bf as sl,cY as rl,cZ as ul,aY as il,c_ as cl,c$ as dl}from"./node_modules-0I5abxol.js";import{L as Ve,C as be,R as Pe,a as xe,A as It,S as ml,b as pl,c as fl,d as vl,e as _l,f as nt,T as tt,B as G,F as je,g as Ue,I as $e,D as lt,h as va,i as we,j as We,k as Je,l as gl,m as ze,n as pt,o as ft,P as Et,O as qt,p as Kt,q as bl,r as _a,s as hl,t as yl,u as ga,v as ba,w as Pt,x as wl,y as kl,z as Cl,E as Sl,G as Il,H as Pl,M as ha,J as ya,K as xl,N as Vl,Q as Tl,U as Dl,V as Ll,W as jl,X as Ul,Y as $l,Z as zl,_ as Al}from"./tdesign-vue-next-Cq8R5Clx.js";import{u as fe,S as _e,a as he,b as F,G as Ke,H as xt,c as He,d as wa,e as Rl,f as Ml,E as El,M as ql,R as Kl}from"./md-editor-v3-ClUpwqzQ.js";import{e as Xt}from"./monaco-editor-ouHSYV7a.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))u(s);new MutationObserver(s=>{for(const y of s)if(y.type==="childList")for(const _ of y.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&u(_)}).observe(document,{childList:!0,subtree:!0});function n(s){const y={};return s.integrity&&(y.integrity=s.integrity),s.referrerPolicy&&(y.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?y.credentials="include":s.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function u(s){if(s.ep)return;s.ep=!0;const y=n(s);fetch(s.href,y)}})();var De=(e=>(e.ManageWeb="i-manage-web",e.ManageJudge="i-manage-judge",e.ManageProblem="i-manage-problem",e.ManageProblemDaily="i-manage-problem-daily",e.ManageContest="i-manage-contest",e.ManageCollection="i-manage-collection",e))(De||{});const Fl={"r-admin":["i-manage-web","i-manage-judge","i-manage-problem","i-manage-problem-daily","i-manage-contest","i-manage-collection"]};function Ol(e){if(e==null)return[];const l=[];for(const n of e){const u=Fl[n];u!=null&&l.push(...u)}return[...new Set(l)]}function Gl(e,l){if(e==null||l==null)return!1;const n=Ol(e);for(const u of l)if(!n.includes(u))return!1;return!0}const Ee=mt("user",{state:()=>({token:"",userId:-1,username:"",nickname:"",roles:[]}),getters:{getToken(){return this.token},getUserId(){return this.userId},getUsername(){return this.username},getNickname(){return this.nickname}},actions:{clear(){this.$patch({token:"",userId:-1,username:"",nickname:"",roles:[]})},loadResponse(e){this.$patch({token:e.token,userId:e.user_id,username:e.username,nickname:e.nickname,roles:e.roles})},isLogin(){return this.token!=null&&this.token!=""},hasAuth(e){return this.hasAllAuths([e])},hasAllAuths(e){return e?Gl(this.roles,e):!0}},persist:!0}),Ye=mt("webStyle",{state:()=>({title:""}),getters:{getTitle(){return this.title}},actions:{setTitle(e){this.title=e}}}),Vt=mt("sidebarStyle",{state:()=>({showSidebar:!1,forceHiddenSidebar:!1,menuActiveName:"",menuList:[]}),getters:{getMenuList(){return this.menuList}},actions:{setSidebarShow(e){this.showSidebar=e},setForceHiddenSidebar(e){this.forceHiddenSidebar=e},setMenuActiveName(e){this.menuActiveName=e},clearMenuList(){this.menuList=[]},setMenuList(e){this.menuList=e},addMenuList(e){this.menuList.push(e)}}}),Nl={style:{"text-align":"right"}},Hl=ie({__name:"Hitokoto",setup(e){const l=d(!1),n=d(""),u=d(""),s=d(""),y=async()=>{l.value=!0;try{const x=await(await fetch("https://v1.hitokoto.cn")).json();u.value=x.hitokoto,s.value=x.creator,n.value="—— "+x.from}catch(_){u.value="一言获取失败了，但至少您还可以访问本站。",s.value="BoilTask",n.value="DidaOJ",console.error("Error fetching Hitokoto:",_)}finally{l.value=!1}};return me(()=>{y()}),(_,x)=>{const f=be,o=Ve;return L(),E(o,{loading:l.value},{default:a(()=>[t(f,{title:"一言 © Hitokoto"},{actions:a(()=>[V(" @"+q(s.value),1)]),default:a(()=>[z("div",null,[z("span",null,q(u.value),1),z("p",Nl,q(n.value),1)])]),_:1})]),_:1},8,["loading"])}}}),Bl="https://oj-api.didapipa.com/",J=ma.create({baseURL:Bl,timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});J.interceptors.request.use(e=>{const n=Ee().getToken;return n&&(e.headers["X-Token"]=n),e},e=>Promise.reject(e));J.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});const Tt=ma.create({timeout:6e4,withCredentials:!1,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});Tt.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function ka(){return Tt({baseURL:"https://r2-oj.didapipa.com",url:"/system/notification.json?"+Date.now(),method:"get"})}function Ca(){return Tt({baseURL:"https://r2-oj.didapipa.com",url:"/system/announcement.json?"+Date.now(),method:"get"})}function Wl(){return J({url:"/system/status",method:"get"})}function Jl(){return J({url:"/system/image/token",method:"get"})}function Yl(e,l){return J({url:"/system/notification",method:"post",data:{theme:e,content:l}})}function Xl(e,l){return J({url:"/system/announcement",method:"post",data:{title:e,content:l}})}var Dt=(e=>(e[e.Unknown=-1]="Unknown",e[e.C=0]="C",e[e.Cpp=1]="Cpp",e[e.Java=2]="Java",e[e.Python=3]="Python",e[e.Pascal=4]="Pascal",e[e.Golang=5]="Golang",e[e.Lua=6]="Lua",e[e.TypeScript=7]="TypeScript",e[e.Max=8]="Max",e))(Dt||{});function Ft(){const e=[-1,8];return Object.values(Dt).filter(l=>typeof l=="number"&&!e.includes(l)).map(l=>({value:l,label:Ct(l)}))}function wt(e){return e>-1&&e<8}function Ct(e){switch(e){case 0:return"C";case 1:return"C++";case 2:return"Java";case 3:return"Python";case 4:return"Pascal";case 5:return"Golang";case 6:return"Lua";case 7:return"TypeScript";default:return"未知"}}function Ot(e){switch(e){case 0:return"c";case 1:return"cpp";case 2:return"java";case 3:return"python";case 4:return"pascal";case 5:return"go";case 6:return"lua";case 7:return"typescript";default:return"text"}}var Fe=(e=>(e[e.Init=0]="Init",e[e.Rejudge=1]="Rejudge",e[e.Submitting=2]="Submitting",e[e.Queuing=3]="Queuing",e[e.Compiling=4]="Compiling",e[e.Running=5]="Running",e[e.Accept=6]="Accept",e[e.PE=7]="PE",e[e.WA=8]="WA",e[e.TLE=9]="TLE",e[e.MLE=10]="MLE",e[e.OLE=11]="OLE",e[e.RE=12]="RE",e[e.CE=13]="CE",e[e.CLE=14]="CLE",e[e.JudgeFail=15]="JudgeFail",e[e.SubmitFail=16]="SubmitFail",e[e.Unknown=17]="Unknown",e[e.Max=18]="Max",e))(Fe||{});const Zl=e=>{switch(e){case 0:return"普通评测";case 1:return"特殊评测";default:return"未知"}},St=e=>{switch(e){case 0:return"等待处理";case 1:return"重新评测";case 2:return"提交中";case 3:return"队列中";case 4:return"编译中";case 5:return"运行中";case 6:return"通过";case 7:return"格式错误";case 8:return"答案错误";case 9:return"超时";case 10:return"内存超限";case 11:return"输出超限";case 12:return"运行错误";case 13:return"编译错误";case 14:return"编译超限";case 15:return"评测失败";case 16:return"提交失败";case 17:return"未知";default:return e}},Sa=e=>{switch(e){case 0:case 1:case 2:case 3:case 4:case 5:case 17:return"default";case 6:return"success";case 7:return"warning";default:return"danger"}};function Ia(){const e=[17,18];return Object.values(Fe).filter(l=>typeof l=="number"&&!e.includes(l)).map(l=>({value:l,label:St(l)}))}function kt(e){return e>=0&&e<17}function ut(e){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return!0;default:return!1}}function Pa(e){var n;const l={};if(l.id=e.id,l.problemId=e.problem_id,l.contestProblemIndex=e.contest_problem_index,l.status=e.status,ut(e.status)||!kt(e.status)?l.score="-":l.score=e.score.toString(),e.time?l.time=Math.ceil(e.time/1e6)+"ms":l.time="-",e.memory?l.memory=(e.memory/1024/1024).toFixed(2)+"MB":l.memory="-",l.language=e.language,l.codeLength=e.code_length,e.approve_time?l.approveTime=new Date(e.approve_time).toLocaleString():l.approveTime="-",l.author=e.author,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.code=e.code,l.compileMessage=e.compile_message,l.taskCurrent=e.task_current,l.taskTotal=e.task_total,l.task=[],e.task)for(let u=0;u<((n=e.task)==null?void 0:n.length);u++){const s=e.task[u],y={};y.taskId=s.task_id,y.status=s.status,s.time?y.time=Math.ceil(s.time/1e6)+"ms":y.time="-",s.memory?y.memory=(s.memory/1024/1024).toFixed(2)+"MB":y.memory="-",y.score=s.score,y.content=s.content,y.waHint=s.wa_hint,!y.content&&!y.waHint&&(y.content="无提示信息"),l.task.push(y)}return e.judger&&(l.judger=e.judger),e.judger_name?l.judgerName=e.judger_name:l.judgerName="-",e.judge_time&&(l.judgeTime=new Date(e.judge_time).toLocaleString()),l}function Ql(e,l,n,u,s){return J({url:"/judge/approve",method:"post",data:{problem_id:e,contest_id:l,problem_index:n,language:u,code:s}})}function en(e){return J({url:"/judge?id="+e,method:"get"})}function tn(e){return J({url:"/judge/code?id="+e,method:"get"})}function an(e,l,n,u,s,y,_){let x={problem_id:l,username:n,language:String(u),status:String(s),page:String(y),page_size:String(_)};return e&&(x.contest_id=String(e)),J({url:`/judge/list?${new URLSearchParams(x).toString()}`,method:"get"})}function ln(){return J({url:"/judge/statics/recently",method:"get"})}function nn(){return J({url:"/judge/rejudge/recently",method:"post"})}function on(e,l,n){const u={};return e!=null&&(u.problem_id=e),l!=null?u.language=l:u.language=Dt.Unknown,n!=null?u.status=n:u.status=18,J({url:"/judge/rejudge/search",method:"post",data:u})}function sn(){return J({url:"/judge/rejudge/all",method:"post",timeout:0})}function rn(e){return J({url:"/judge/rejudge",method:"post",data:{id:Number(e)}})}var Oe=(e=>(e[e.None=0]="None",e[e.Attempt=1]="Attempt",e[e.Accept=2]="Accept",e))(Oe||{});function vt(e,l){const n={};if(n.id=e.id,n.author=e.author,n.title=e.title,n.tags=[],e.tags)for(const u of e.tags){const s=l[u];s&&n.tags.push(s)}if(n.private=e.private,n.accept=e.accept,n.attempt=e.attempt,e.description!=null&&(n.description=e.description),e.time_limit!=null&&e.time_limit>=0?n.timeLimit=e.time_limit.toString()+" ms":n.timeLimit="未知",e.memory_limit!=null&&e.memory_limit>=0?n.memoryLimit=(e.memory_limit/1024).toFixed(2)+" MB":n.memoryLimit="未知",e.judge_type!=null&&(n.judgeType=Zl(e.judge_type)),e.insert_time!=null&&(n.insertTime=new Date(e.insert_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.source!=null){const u=/\[([^\]]+)\]\(([^)]+)\)/,s=e.source.match(u);s?(n.source=s[1],n.sourceUrl=s[2]):(n.source=e.source,n.sourceUrl="")}return e.judge_md5!=null&&(n.judgeMd5=e.judge_md5),e.origin_oj!=null&&(n.originOj=e.origin_oj),e.origin_id!=null&&(n.originId=e.origin_id),e.origin_url!=null&&(n.originUrl=e.origin_url),n}function xa(e,l){const n={};if(n.id=e.id,n.problemId=e.problem_id,n.title=e.title,n.tags=[],e.tags)for(const u of e.tags){const s=l[u];s&&n.tags.push(s)}return e.accept?n.accept=e.accept:n.accept=0,e.attempt?n.attempt=e.attempt:n.attempt=0,n.solution=e.solution,n.code=e.code,e.create_time!=null&&(n.createTime=new Date(e.create_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.updater_nickname!=null&&(n.updaterNickname=e.updater_nickname),n}function Va(e,l,n){const u={};return e?u.id=e:(u.contest_id=l,u.problem_index=n),J({url:`/problem?${new URLSearchParams(u).toString()}`,method:"get"})}function Ta(e){return J({url:"/problem/tag/list?max_count="+e,method:"get"})}function un(e){return J({url:"/problem/judge?id="+e,method:"get"})}function cn(e,l,n,u,s,y){const _={};return e&&(_.oj=e),l&&(_.title=l),n&&(_.tag=n),u!==void 0&&(_.private=u?"1":"0"),s&&(_.page=s),y&&(_.page_size=y),J({url:`/problem/list?${new URLSearchParams(_).toString()}`,method:"get"})}function dn(e){const l={};return e&&(l.problem_id=e),J({url:`/problem/recommend?${new URLSearchParams(l).toString()}`,method:"get"})}function mn(e){return J({url:"/problem/daily?id="+e,method:"get"})}function pn(e){return J({url:"/problem/daily/edit?id="+e,method:"get"})}function fn(){return J({url:"/problem/daily/recently",method:"get"})}function vn(e,l,n,u,s){const y={};return e&&(y.start_date=e),l&&(y.end_date=l),n&&(y.problem_id=n),u&&(y.page=u),s&&(y.page_size=s),J({url:`/problem/daily/list?${new URLSearchParams(y).toString()}`,method:"get"})}function Da(e,l){return J({url:"/problem/crawl",method:"post",data:{oj:e,id:l}})}function _n(e,l,n,u,s,y,_){return J({url:"/problem/create",method:"post",data:{title:e,time_limit:l,memory_limit:n,source:u,private:s,tags:y,description:_}})}function gn(e,l,n,u,s,y,_,x){return J({url:"/problem/edit",method:"post",data:{id:e,title:l,time_limit:n,memory_limit:u,source:s,private:y,tags:_,description:x}})}function bn(e,l,n,u){return J({url:"/problem/daily/create",method:"post",data:{id:e,problem_id:l,solution:n,code:u}})}function hn(e,l,n,u){return J({url:"/problem/daily/edit",method:"post",data:{id:e,problem_id:l,solution:n,code:u}})}function yn(e,l){return J({url:"/problem/judge/data/download?id="+e+"&key="+l,method:"get"})}function wn(e){return e||(e=""),J({url:"/problem/image/token?id="+e,method:"get"})}function kn(e){return e||(e=""),J({url:"/problem/daily/image/token?id="+e,method:"get"})}function Cn(e,l){const n=new FormData;return n.append("id",e),n.append("zip",l),J({url:"/problem/judge/data",method:"post",data:n,headers:{"Content-Type":"multipart/form-data"},timeout:1e3*60*5})}function Sn(e){return J({url:"/problem/parse",method:"post",data:{problems:e}})}const In={class:"sh-main"},Pn={class:"dida-swiper-div"},xn=ie({__name:"HomeView",setup(e){const{globalProperties:l}=fe();let n=-1;const u=d({theme:"info",content:""}),s=d({title:"",content:""}),y=d([]),_=d(!1),x=d(!1),f=d(!1),o=async()=>{u.value=await ka()},T=async()=>{try{const b=await Ca();s.value.title=b.title,s.value.content=b.content}catch{_e(l,"加载公告失败"),s.value={title:"公告加载失败",content:"请刷新页面重新获取"}}},p=async()=>{const b=await ln();if(b.code!==0){_e(l,"加载OJ统计数据失败");return}let g=[];for(const v of b.data){const C=new Date(v.date),c=`${C.getMonth()+1}-${C.getDate()}`;g.push({Date:c,Type:"Unaccept",Count:v.attempt-v.accept}),g.push({Date:c,Type:"Accept",Count:v.accept})}const i={type:"bar",data:[{id:"barData",values:g}],xField:"Date",yField:"Count",seriesField:"Type",stack:!0,legends:{visible:!0},bar:{state:{hover:{stroke:"#000",lineWidth:1}}},height:300};new Fa(i,{dom:"ojStaticsDiv"}).renderSync()},k=async()=>{y.value=[];const b=await fn();if(b.code!==0){_e(l,"加载每日问题数据失败");return}b.data.list&&b.data.list.length>0&&b.data.list.forEach(g=>{let i="default",m="未尝试";if(b.data.attempt_status){const C=b.data.attempt_status[g.problem_id];if(C)switch(C){case Oe.Accept:i="success",m="已解决";break;case Oe.Attempt:i="warning",m="待解决";break;default:i="default",m="未尝试"}}const v=`${g.title}`;y.value.push({id:g.id,title:v,problemId:g.problem_id,theme:i,tag:m})})};return me(async()=>{f.value=!0,_.value=!0,x.value=!0,(async()=>(await o(),n=setInterval(()=>{o()},3e4),await T(),f.value=!1))(),(async()=>(await p(),_.value=!1))(),(async()=>(await k(),x.value=!1))()}),Ka(()=>{clearInterval(n)}),(b,g)=>{const i=It,m=pl,v=ml,C=Ve,c=Me("md-preview"),r=be,A=xe,I=nt,h=_l,U=tt,P=vl,w=fl,j=Pe;return L(),E(C,{loading:f.value},{default:a(()=>[t(j,null,{default:a(()=>[t(A,{span:8},{default:a(()=>{var $;return[z("div",In,[u.value?(L(),E(i,{key:0,class:"dida-notification-div",theme:u.value.theme},{default:a(()=>[V(q(u.value.content),1)]),_:1},8,["theme"])):le("",!0),z("div",Pn,[t(v,{class:"dida-swiper"},{default:a(()=>[t(m,null,{default:a(()=>g[1]||(g[1]=[z("a",{href:"http://codeoj.cn",target:"_blank"},[z("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"})],-1)])),_:1}),t(m,null,{default:a(()=>g[2]||(g[2]=[z("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1})]),_:1})]),t(C,{loading:_.value&&!f.value},{default:a(()=>g[3]||(g[3]=[z("div",{id:"ojStaticsDiv",style:{"min-height":"200px"}},null,-1)])),_:1},8,["loading"]),t(r,{title:($=s.value)==null?void 0:$.title,style:{width:"calc(100% - 100px)",margin:"0 auto"}},{default:a(()=>{var D;return[t(c,{"model-value":(D=s.value)==null?void 0:D.content,previewTheme:"cyanosis"},null,8,["model-value"])]}),_:1},8,["title"])])]}),_:1}),t(A,{span:4},{default:a(()=>[t(r,{style:{margin:"10px"},bordered:!0},{default:a(()=>g[4]||(g[4]=[z("img",{src:"https://api.jysafe.cn/ip/",alt:"Welcome",style:{width:"100%"}},null,-1)])),_:1}),t(Hl,{style:{margin:"10px"}}),t(r,{style:{margin:"10px"},bordered:!0,title:"每日一题"},{actions:a(()=>[t(I,{onClick:g[0]||(g[0]=$=>b.$router.push({name:"problem-daily-list"}))},{default:a(()=>g[5]||(g[5]=[V("查看全部")])),_:1})]),default:a(()=>[t(C,{loading:x.value&&!f.value},{default:a(()=>[t(w,{split:!0,size:"small",style:{"min-height":"200px"}},{default:a(()=>[(L(!0),ae(ue,null,Se(y.value,$=>(L(),E(P,{key:$.id},{default:a(()=>[t(h,{style:{width:"100px"}},{description:a(()=>[t(I,{onClick:D=>b.$router.push({name:"problem-daily-detail",params:{dailyId:$.id}})},{default:a(()=>[V(q($.problemId),1)]),_:2},1032,["onClick"])]),_:2},1024),t(h,{style:{width:"200px"}},{description:a(()=>[t(I,{onClick:D=>b.$router.push({name:"problem-daily-detail",params:{dailyId:$.id}})},{default:a(()=>[V(q($.title),1)]),_:2},1032,["onClick"])]),_:2},1024),t(h,{style:{width:"135px"},description:$.id},null,8,["description"]),t(h,null,{description:a(()=>[t(U,{theme:$.theme},{default:a(()=>[V(q($.tag),1)]),_:2},1032,["theme"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["loading"])]),_:1}),t(r,{style:{margin:"10px"},bordered:!0},{header:a(()=>g[6]||(g[6]=[z("b",null,"友情链接",-1)])),default:a(()=>[t(w,null,{default:a(()=>[t(P,null,{default:a(()=>[t(I,{href:"https://boiltask.com",target:"_blank"},{default:a(()=>g[7]||(g[7]=[V("BoilTask Blog")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])}}}),ce=(e,l)=>{const n=e.__vccOpts||e;for(const[u,s]of l)n[u]=s;return n},Vn=ce(xn,[["__scopeId","data-v-df433117"]]),Tn={class:"sh-main"},Dn=ie({__name:"View404",setup(e){let l=ke(),n=d(l.fullPath);return(u,s)=>{const y=G;return L(),ae("div",Tn,[z("p",null,q(pe(n)),1),s[2]||(s[2]=z("p",null,"该页面无效或已被迁移，请重新选择访问目标",-1)),t(y,{theme:"primary",onClick:s[0]||(s[0]=()=>u.$router.push("/"))},{default:a(()=>s[1]||(s[1]=[V("返回首页")])),_:1})])}}}),La=ce(Dn,[["__scopeId","data-v-d4218944"]]);function Ln(e){const l={};return l.id=e.id,l.username=e.username,l.nickname=e.nickname,l.email=e.email,l.slogan=e.slogan,l.organization=e.organization,l.accept=e.accept,l.attempt=e.attempt,l.vjudgeId=e.vjudge_id,e.email&&(l.avatar=`https://www.gravatar.com/avatar/${Oa(e.email.toLowerCase().trim())}?d=identicon&s=100`),l}function jn(e,l){return J({url:"/user/login",method:"post",data:{username:e,password:l}})}function Un(){return J({url:"/user/login/refresh",method:"post"})}function $n(e){const l={username:e};return J({url:`/user/info?${new URLSearchParams(l).toString()}`,method:"get"})}function zn(e){const l="https://vjudge.net/user/solveDetail/"+encodeURIComponent(e);return Tt({url:l,method:"get"})}function An(e){return J({url:"/user/account/infos",method:"post",data:{users:e}})}function Rn(e){return J({url:"/user/parse",method:"post",data:{users:e}})}function Mn(e,l){return J({url:"/user/register/email",method:"post",data:{token:e,email:l}})}function En(e,l,n,u,s){return J({url:"/user/register",method:"post",data:{username:e,password:l,email:n,key:u,nickname:s}})}function qn(e,l){return J({url:"/user/forget",method:"post",data:{token:e,username:l}})}function Kn(e,l,n){return J({url:"/user/password/modify",method:"post",data:{username:e,password:l,key:n}})}const Fn={class:"dida-login-footer"},On=ie({__name:"LoginView",setup(e){const{globalProperties:l}=fe(),n=Ee(),u=d(!1),s=d({username:"",password:""}),y=()=>{he(l,"重置成功")},_=({validateResult:x,firstError:f})=>{u.value||(u.value=!0,jn(s.value.username,s.value.password).then(o=>{if(o.code===0){n.loadResponse(o.data),he(l,"登录成功");let T=l.$route.query.redirect_uri;T||(T="/user/"+o.data.username),l.$router.push({path:T})}else F(l,o.code)}).catch(o=>{console.error("Login error",o),_e(l,"登录失败")}).finally(()=>{u.value=!1}))};return me(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),(x,f)=>{const o=$e,T=Ue,p=G,k=je,b=nt,g=be;return L(),E(g,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(k,{ref:"form",data:s.value,colon:!0,onReset:y,onSubmit:_,class:"yj-login-form","label-width":0},{default:a(()=>[t(T,{name:"username"},{default:a(()=>[t(o,{modelValue:s.value.username,"onUpdate:modelValue":f[0]||(f[0]=i=>s.value.username=i),clearable:"",autocomplete:"username",placeholder:"请输入用户名"},{"prefix-icon":a(()=>[t(pe(Ga))]),_:1},8,["modelValue"])]),_:1}),t(T,{name:"password"},{default:a(()=>[t(o,{modelValue:s.value.password,"onUpdate:modelValue":f[1]||(f[1]=i=>s.value.password=i),type:"password",autocomplete:"current-password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":a(()=>[t(pe(Na))]),_:1},8,["modelValue"])]),_:1}),t(T,null,{default:a(()=>[t(p,{theme:"primary",type:"submit",block:"",loading:u.value},{default:a(()=>f[4]||(f[4]=[V("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),z("div",Fn,[t(b,{onClick:f[2]||(f[2]=()=>{pe(l).$router.push({name:"login-forget"})})},{default:a(()=>f[5]||(f[5]=[V("忘记密码 ")])),_:1}),t(b,{onClick:f[3]||(f[3]=()=>{pe(l).$router.push({name:"register"})})},{default:a(()=>f[6]||(f[6]=[V("注册账户 ")])),_:1})])]),_:1})}}}),Gn=ce(On,[["__scopeId","data-v-0466c42d"]]),Nn={class:"dida-login-footer"},Hn=ie({__name:"RegisterView",setup(e){const{globalProperties:l}=fe(),n=Ee(),u=d(!1),s=d(!1),y=d(!1),_=d("发送验证码");let x=null,f=-1;const o=d(!1),T=d(null),p=d({username:"",password:"",confirmPassword:"",nickname:"",email:"",emailKey:""}),b=d({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:c=>new Promise(r=>{const A=setTimeout(()=>{r(p.value.password===c),clearTimeout(A)})}),message:"两次密码不一致"}],nickname:[{required:!0,message:"请填写昵称"},{min:1,message:"昵称至少1个字符"},{max:30,message:"昵称最多30个字符"}],email:[{required:!0,message:"请填写邮箱"},{pattern:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"邮箱格式不正确"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),g=d(()=>t(G,{onClick:i,disabled:y.value,loading:s.value,style:"width:120px"},{default:()=>[_.value]})),i=async()=>{var I;if(!p.value.email){_e(l,"请输入邮箱");return}if(!p.value.email.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)){_e(l,"邮箱格式不正确");return}if(y.value||s.value)return;o.value=!0,await dt();const c=document.getElementById("cf-confirm-div");c&&c.remove();const r=document.createElement("div");r.id="cf-confirm-div",r.setAttribute("data-theme","light"),(I=T.value)==null||I.appendChild(r);const A=window;A.turnstile.ready(function(){A.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(h){o.value=!1,await m(h)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},m=async c=>{if(!y.value){s.value=!0;try{const r=await Mn(c,p.value.email);if(r.code!==0){F(l,r.code);return}he(l,"发送验证码成功"),s.value=!1,y.value=!0,x=new Date,_.value="60秒后重发",f=setInterval(()=>{const I=Math.floor((new Date().getTime()-(x==null?void 0:x.getTime()))/1e3);I>60?(_.value="发送验证码",y.value=!1,clearInterval(f)):_.value=`${60-I}秒后重发`},1e3)}catch{_e(l,"发送验证码失败")}finally{s.value=!1}}},v=()=>{he(l,"重置成功")},C=({validateResult:c,firstError:r,e:A})=>{if(!u.value){if(A.preventDefault(),c!==!0){_e(l,r);return}if(p.value.password!==p.value.confirmPassword){_e(l,"两次密码不一致");return}u.value=!0,En(p.value.username,p.value.password,p.value.email,p.value.emailKey,p.value.nickname).then(I=>{I.code===0?(he(l,"注册成功，可使用账号信息登录"),l.$router.push({name:"login"})):F(l,I.code)}).catch(I=>{console.error("Login error",I),_e(l,"登录失败")}).finally(()=>{u.value=!1})}};return me(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),Te(()=>{clearInterval(f)}),(c,r)=>{const A=$e,I=Ue,h=va,U=G,P=je,w=nt,j=be,$=lt;return L(),ae(ue,null,[t(j,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(P,{ref:"form",rules:b.value,data:p.value,colon:!0,onReset:v,onSubmit:C,class:"yj-login-form"},{default:a(()=>[t(I,{name:"username",label:"用户名"},{default:a(()=>[t(A,{modelValue:p.value.username,"onUpdate:modelValue":r[0]||(r[0]=D=>p.value.username=D),clearable:"",placeholder:"用于登录与查找"},null,8,["modelValue"])]),_:1}),t(I,{name:"password",label:"密码"},{default:a(()=>[t(A,{modelValue:p.value.password,"onUpdate:modelValue":r[1]||(r[1]=D=>p.value.password=D),type:"password",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(I,{name:"confirmPassword",label:"确认密码"},{default:a(()=>[t(A,{modelValue:p.value.confirmPassword,"onUpdate:modelValue":r[2]||(r[2]=D=>p.value.confirmPassword=D),type:"password",clearable:"",placeholder:"请确认密码"},null,8,["modelValue"])]),_:1}),t(I,{name:"nickname",label:"昵称"},{default:a(()=>[t(A,{modelValue:p.value.nickname,"onUpdate:modelValue":r[3]||(r[3]=D=>p.value.nickname=D),clearable:"",placeholder:"用于优先在网站各处展示"},null,8,["modelValue"])]),_:1}),t(I,{name:"email",label:"邮箱"},{default:a(()=>[t(A,{modelValue:p.value.email,"onUpdate:modelValue":r[4]||(r[4]=D=>p.value.email=D),clearable:"",placeholder:"请填写常用邮箱"},null,8,["modelValue"])]),_:1}),t(I,{name:"emailKey",label:"验证码"},{default:a(()=>[t(h,{append:g.value},{default:a(()=>[t(A,{modelValue:p.value.emailKey,"onUpdate:modelValue":r[5]||(r[5]=D=>p.value.emailKey=D),clearable:"",placeholder:"请输入验证码",style:{width:"140px"}},null,8,["modelValue"])]),_:1},8,["append"])]),_:1}),t(I,null,{default:a(()=>[t(U,{theme:"primary",type:"submit",block:"",loading:u.value},{default:a(()=>r[8]||(r[8]=[V("注册")])),_:1},8,["loading"])]),_:1})]),_:1},8,["rules","data"]),z("div",Nn,[t(w,{onClick:r[6]||(r[6]=()=>{pe(l).$router.push({name:"login"})})},{default:a(()=>r[9]||(r[9]=[V("返回登陆 ")])),_:1})])]),_:1}),t($,{visible:o.value,"onUpdate:visible":r[7]||(r[7]=D=>o.value=D),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:a(()=>[z("div",{ref_key:"dialogContainer",ref:T,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),Bn=ce(Hn,[["__scopeId","data-v-d25e7538"]]),Wn={key:0,style:{margin:"10px"}},Jn={key:1,style:{margin:"10px"}},Yn={style:{margin:"12px"}},Xn=ie({__name:"UserView",setup(e){let l=ke();const{globalProperties:n}=fe(),u=Ye();let s="";const y=d(!1),_=d(null),x=d([]),f=d([]),o=d([]),T=async p=>{y.value=!0;try{let k=await $n(p);if(k.code!==0){y.value=!1,F(n,k.code),await Z.push({name:"home"});return}if(_.value=Ln(k.data.user),x.value=k.data.problems_ac,u.setTitle(_.value.nickname+" - "+u.getTitle),_.value.vjudgeId){const b=await zn(_.value.vjudgeId);f.value=b.acRecords;for(const g in f.value)f.value[g].sort((i,m)=>i.length===m.length?i.localeCompare(m):i.length-m.length);o.value=b.failRecords;for(const g in o.value)o.value[g].sort((i,m)=>i.length===m.length?i.localeCompare(m):i.length-m.length)}}catch{_e(n,"获取用户信息失败"),await Z.push({name:"home"})}finally{y.value=!1}};return Ha(async(p,k,b)=>{if(Array.isArray(p.params.username)?s=p.params.username[0]:s=p.params.username,!s){await Z.push({name:"home"});return}await T(s),b()}),me(async()=>{if(Array.isArray(l.params.username)?s=l.params.username[0]:s=l.params.username,!s){await Z.push({name:"home"});return}await T(s)}),(p,k)=>{const b=G,g=we,i=be,m=nt,v=Je,C=We,c=xe,r=gl,A=Pe,I=Ve;return L(),E(I,{loading:y.value},{default:a(()=>[t(A,{class:"dida-main-content"},{default:a(()=>[t(c,{span:8},{default:a(()=>{var h;return[t(i,{style:{margin:"10px"},title:"AC题目"},{default:a(()=>[t(g,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(L(!0),ae(ue,null,Se(x.value,U=>(L(),E(b,{key:U,size:"small",onClick:()=>pe(Z).push({name:"problem-detail",params:{problemId:U}})},{default:a(()=>[V(q(U),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),(h=_.value)!=null&&h.vjudgeId?(L(),E(i,{key:0,style:{margin:"10px"},title:"vjudge.net"},{actions:a(()=>{var U;return[t(m,{href:"https://vjudge.net/user/"+((U=_.value)==null?void 0:U.vjudgeId),target:"_blank"},{default:a(()=>{var P;return[V("@"+q((P=_.value)==null?void 0:P.vjudgeId),1)]}),_:1},8,["href"])]}),default:a(()=>[f.value&&Object.keys(f.value).length>0?(L(),ae("div",Wn,[k[0]||(k[0]=z("div",{style:{margin:"5px"}},[z("span",null,"AC")],-1)),t(C,{layout:"vertical",bordered:!0},{default:a(()=>[(L(!0),ae(ue,null,Se(f.value,(U,P)=>(L(),E(v,{key:P,label:P},{default:a(()=>[t(g,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(L(!0),ae(ue,null,Se(U,w=>(L(),E(b,{key:w,size:"small",onClick:()=>pe(Z).push({name:"problem-detail",params:{problemId:P+"-"+w}})},{default:a(()=>[V(q(w),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):le("",!0),o.value&&Object.keys(o.value).length>0?(L(),ae("div",Jn,[k[1]||(k[1]=z("div",{style:{margin:"5px"}},[z("span",null,"Fail")],-1)),t(C,{layout:"vertical",bordered:!0},{default:a(()=>[(L(!0),ae(ue,null,Se(o.value,(U,P)=>(L(),E(v,{key:P,label:P},{default:a(()=>[t(g,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(L(!0),ae(ue,null,Se(U,w=>(L(),E(b,{key:w,size:"small",onClick:()=>pe(Z).push({name:"problem-detail",params:{problemId:P+"-"+w}})},{default:a(()=>[V(q(w),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):le("",!0)]),_:1})):le("",!0)]}),_:1}),t(c,{span:4},{default:a(()=>[z("div",Yn,[t(C,{layout:"vertical",bordered:!0},{default:a(()=>[t(v,{label:"头像"},{default:a(()=>{var h;return[t(r,{shape:"round",size:"100px",image:(h=_.value)==null?void 0:h.avatar,"hide-on-load-failed":!1},null,8,["image"])]}),_:1}),t(v,{label:"昵称"},{default:a(()=>{var h;return[V(q((h=_.value)==null?void 0:h.nickname),1)]}),_:1}),t(v,{label:"Slogan"},{default:a(()=>{var h;return[V(q((h=_.value)==null?void 0:h.slogan),1)]}),_:1}),t(v,{label:"邮箱"},{default:a(()=>{var h;return[V(q((h=_.value)==null?void 0:h.email),1)]}),_:1}),t(v,{label:"组织"},{default:a(()=>{var h;return[V(q((h=_.value)==null?void 0:h.organization),1)]}),_:1}),t(v,{label:"通过数量"},{default:a(()=>{var h;return[V(q((h=_.value)==null?void 0:h.accept),1)]}),_:1}),t(v,{label:"提交数量"},{default:a(()=>{var h;return[V(q((h=_.value)==null?void 0:h.attempt),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Zn=ce(Xn,[["__scopeId","data-v-6d730b5a"]]),Gt=[{name:"home",path:"/",title:"首页",showSidebar:!1,disableGenerateTab:!0,component:Vn},{name:"problem",path:"/problem",title:"题目",icon:"calculation",showSidebar:!0,redirect:"problem-list"},{name:"collection-detail-tab",title:"题集",path:"/collection",showSidebar:!0,disableGenerateTab:!0,redirect:"problem-collection-list"},{name:"judge",path:"/judge",title:"评测",icon:"code",showSidebar:!0,redirect:"judge-list"},{name:"contest",path:"/contest",title:"比赛",icon:"application",showSidebar:!0,redirect:"contest-list"},{name:"contest-detail-tab",title:"比赛",path:"/contest",showSidebar:!0,disableGenerateTab:!0,redirect:"contest-list"},{name:"discuss",title:"讨论",path:"/discuss",icon:"sonic",showSidebar:!0,redirect:"discuss-list"},{name:"rank",path:"/rank",title:"排名",icon:"chart-column",showSidebar:!0,redirect:"rank-ac-all"},{name:"system",path:"/system",title:"系统",icon:"dashboard",showSidebar:!0,redirect:"system-status"},{name:"manage",path:"/manage",title:"管理",icon:"command",showSidebar:!0,redirect:"manage-web",auths:[De.ManageWeb]},{name:"login",path:"/login",title:"登陆",showSidebar:!1,disableGenerateTab:!0,component:Gn},{name:"register",path:"/register",title:"注册",showSidebar:!1,disableGenerateTab:!0,component:Bn},{name:"user",path:"/user/:username+",title:"用户",showSidebar:!1,needLogin:!0,disableGenerateTab:!0,component:Zn},{name:"404",path:"/404",title:"404",showSidebar:!1,disableGenerateTab:!0,component:La}],Qn=e=>Gt.find(l=>l.name==e),eo=e=>{const l=[];return Gt.forEach(n=>{!n.disableGenerateTab&&e.hasAllAuths(n.auths)&&l.push(n)}),l},to=e=>{Gt.forEach(l=>{const n={name:l.name,path:l.path,meta:{title:l.title,tab:l.name,showSidebar:l.showSidebar,needLogin:l.needLogin,redirect:l.redirect,tabAuths:l.auths},component:l.component};e.push(n)})};function ja(e){return e.children!==void 0}function ao(e){return e.children!==void 0}const lo={style:{margin:"10px"}},no={key:0,class:"dida-operation-container"};function oo(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const so=ie({__name:"ProblemList",setup(e){const l=ke(),n=Be(),{globalProperties:u}=fe(),s=Ee();let y=null;const _=d(!1),x={};let f={};const o=d(!1),T=Ge(()=>s.hasAuth(De.ManageProblem)),p=d([{title:"ID",colKey:"id",cell:(D,S)=>{let M=I(S.row.id);return t(G,{variant:"dashed",theme:M,onClick:()=>A(S.row.id)},{default:()=>[S.row.id]})}},{title:"标题",colKey:"title",cell:(D,S)=>t(G,{variant:"text",onClick:()=>A(S.row.id)},{default:()=>[S.row.title]})},{title:"标签",colKey:"tags",cell:(D,S)=>{const M=S.row.tags;if(!M||M.length===0)return"";let R=[];for(let N=0;N<M.length;N++){const X=M[N];R.push(t(G,{key:N,theme:"default",variant:"outline",size:"small",onClick:()=>P(X)},{default:()=>[X.name]}))}return t(we,null,oo(R)?R:{default:()=>[R]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),k=d(!1);let b=1,g=50;const i=d({current:b,pageSize:g,defaultCurrent:b,defaultPageSize:g,total:0,pageSizeOptions:[50,100]}),m=d(),v=d(),C=[{label:"DidaOJ",value:"didaoj"},{label:"HDU",value:"hdu"},{label:"POJ",value:"poj"},{label:"NYOJ",value:"nyoj"}],c=d({oj:"",title:"",tag:"",private:!1}),r=d({oj:"",problem:""}),A=D=>{D&&n.push({path:"/problem/"+D})},I=D=>{if(!D||!f)return"default";const S=f[D];if(!S)return"default";switch(S){case Oe.Accept:return"success";case Oe.Attempt:return"warning";default:return"default"}},h=async()=>{await n.push({query:{...l.query,oj:c.value.oj,title:c.value.title,tag:c.value.tag,private:c.value.private?"1":"0",page:1,page_size:i.value.defaultPageSize}})},U=async()=>{try{o.value=!0;const D=await Da(r.value.oj,r.value.problem);D.code===0?(he(u,"搜索成功"),await n.push({name:"problem-detail",params:{problemId:D.data}})):F(u,D.code)}catch(D){console.error(D),F(u,Ke())}finally{o.value=!1}},P=D=>{D&&n.push({query:{...l.query,title:"",tag:D.name,page:1,page_size:i.value.defaultPageSize}})},w=()=>{n.push({name:"manage-problem-create"})},j=async(D,S)=>{k.value=!0;try{const{current:M,pageSize:R}=D,N=await cn(c.value.oj,c.value.title,c.value.tag,c.value.private,M,R);if(m.value=[],N.code===0){const X=N.data.list;if(!X||X.length<=0){i.value={...i.value,total:0},f={},he(u,"未找到记录");return}X.forEach(oe=>{var ee;const te=vt(oe,x);(ee=m.value)==null||ee.push(te)}),i.value={...i.value,total:N.data.total_count},f=N.data.problem_attempt_status}else S&&F(u,N.code)}catch(M){console.error(M),F(u,Ke())}finally{k.value=!1}},$=async D=>{await n.push({query:{...l.query,page:D.current,page_size:D.pageSize}})};return me(async()=>{k.value=!0,v.value=[],Ta(-1).then(D=>{if(D.code===0){v.value=D.data.list,_.value=D.data.total_count>D.data.list.length;for(let S=0;S<D.data.list.length;S++){const M=D.data.list[S];x[M.id]=M}y=Le(()=>l.query,S=>{c.value.oj=S.oj||"",c.value.title=S.title||"",c.value.tag=S.tag||"",c.value.private=S.private==="1";const M=parseInt(S.page)||i.value.defaultCurrent,R=parseInt(S.page_size)||i.value.defaultPageSize;b=M,g=R,i.value={...i.value,current:b,pageSize:g},j({current:b,pageSize:g},!0)},{immediate:!0})}else _.value=!0}).catch(D=>{console.error(D),_.value=!0})}),Te(()=>{y&&y()}),(D,S)=>{const M=ze,R=be,N=xe,X=G,oe=we,te=pt,ee=Ue,O=$e,de=ft,Q=je,W=Pe;return L(),E(W,null,{default:a(()=>[t(N,{span:9},{default:a(()=>[t(R,{style:{margin:"10px"}},{default:a(()=>[t(M,{data:m.value,columns:p.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:i.value,"table-layout":"auto",loading:k.value,onPageChange:$},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(N,{span:3},{default:a(()=>[z("div",lo,[T.value?(L(),ae("div",no,[t(oe,null,{default:a(()=>[t(X,{onClick:w},{default:a(()=>S[7]||(S[7]=[V("新建")])),_:1})]),_:1})])):le("",!0),t(R,{class:"sh-card"},{default:a(()=>[t(Q,{model:c.value,onSubmit:h},{default:a(()=>[t(ee,{label:"OJ"},{default:a(()=>[t(te,{modelValue:c.value.oj,"onUpdate:modelValue":S[0]||(S[0]=H=>c.value.oj=H),options:C,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(ee,{label:"标题"},{default:a(()=>[t(O,{modelValue:c.value.title,"onUpdate:modelValue":S[1]||(S[1]=H=>c.value.title=H),placeholder:"请输入关键词"},null,8,["modelValue"])]),_:1}),t(ee,{label:"标签"},{default:a(()=>[t(O,{modelValue:c.value.tag,"onUpdate:modelValue":S[2]||(S[2]=H=>c.value.tag=H),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),T.value?(L(),E(ee,{key:0,label:"私有"},{default:a(()=>[t(de,{modelValue:c.value.private,"onUpdate:modelValue":S[3]||(S[3]=H=>c.value.private=H)},null,8,["modelValue"])]),_:1})):le("",!0),t(ee,null,{default:a(()=>[t(X,{theme:"primary",type:"submit"},{default:a(()=>S[8]||(S[8]=[V("搜索")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(R,{class:"sh-card"},{default:a(()=>[t(Q,{model:r.value,onSubmit:U},{default:a(()=>[t(ee,{label:"OJ"},{default:a(()=>[t(te,{modelValue:r.value.oj,"onUpdate:modelValue":S[4]||(S[4]=H=>r.value.oj=H),options:C,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(ee,{label:"题目"},{default:a(()=>[t(O,{modelValue:r.value.problem,"onUpdate:modelValue":S[5]||(S[5]=H=>r.value.problem=H),placeholder:"请输入原始题号"},null,8,["modelValue"])]),_:1}),t(ee,null,{default:a(()=>[t(X,{theme:"primary",type:"submit",loading:o.value},{default:a(()=>S[9]||(S[9]=[V("前往")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),t(R,{class:"sh-card sh-background-black"},{default:a(()=>[(L(!0),ae(ue,null,Se(v.value,H=>(L(),E(X,{class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:()=>P(H)},{default:a(()=>[V(q(H.name),1)]),_:2},1032,["onClick"]))),256)),_.value?(L(),E(X,{key:0,class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:S[6]||(S[6]=()=>D.$router.push("/problem/tags"))},{default:a(()=>S[10]||(S[10]=[V(" ... ")])),_:1})):le("",!0)]),_:1})])]),_:1})]),_:1})}}}),ro=ce(so,[["__scopeId","data-v-bc7185f5"]]);function at(e){let l="";for(;e>0;)e--,l=String.fromCharCode(65+e%26)+l,e=Math.floor(e/26);return l}function Nt(e){const l={};if(l.id=e.id,l.ownerId=e.owner_id,l.ownerUsername=e.owner_username,l.ownerNickname=e.owner_nickname,l.title=e.title,l.startTime=new Date(e.start_time).toLocaleString(),l.endTime=new Date(e.end_time).toLocaleString(),l.createTime=new Date(e.create_time).toLocaleString(),l.updateTime=new Date(e.update_time).toLocaleString(),l.private=e.private,l.description=e.description,l.notification=e.notification,e.problems){l.problems=[],e.problems.sort((n,u)=>n.index-u.index);for(let n=0;n<e.problems.length;n++){const u=e.problems[n];let s={accept:0,attempt:0,author:"",id:"",private:!1,tags:[],title:""};s.index=u.index,s.id=at(u.index),s.title=u.title,u.accept?s.accept=u.accept:s.accept=0,u.attempt?s.attempt=u.attempt:s.attempt=0,l.problems.push(s)}}return l}function uo(e){return J({url:"/contest?id="+e,method:"get"})}function io(e){return J({url:"/contest/edit?id="+e,method:"get"})}function co(e){return J({url:"/contest/problem/list?id="+e,method:"get"})}function mo(e){return J({url:"/contest/image/token?id="+e,method:"get"})}function po(e,l){return J({url:"/contest/problem?id="+e+"&problem_index="+l,method:"get"})}function fo(e,l){return J({url:"/contest/list?page="+e+"&page_size="+l,method:"get"})}function vo(e){return J({url:"/contest/rank?id="+e,method:"get"})}function _o(e){return J({url:"/contest/create",method:"post",data:e})}function go(e){return J({url:"/contest/edit",method:"post",data:e})}function bo(e,l){return J({url:"/contest/password",method:"post",data:{id:e,password:l}})}function ho(e){return J({url:"/contest/dolos",method:"post",data:{id:e}})}const Ht=async(e,l)=>{l&&await e.push({name:"user",params:{username:l}})},Zt=e=>{const l=Z.resolve({name:"problem-detail",params:{problemId:e}});window.open(l.href,"_blank")},Mt=async(e,l)=>{await Z.push({name:"contest-problem-detail",params:{contestId:e,problemIndex:l}})},yo={class:"sh-button"},wo={style:{"margin-top":"16px"}},ko={__name:"SecretPanel",setup(e){const l=d(!1);return(n,u)=>{const s=G;return L(),ae("div",Ya(Xa(n.$attrs)),[z("div",yo,[t(s,{onClick:u[0]||(u[0]=y=>l.value=!l.value)},{default:a(()=>[V(q(l.value?"收起":"展开"),1)]),_:1})]),Ba(z("div",wo,[Ja(n.$slots,"default",{},void 0)],512),[[Wa,l.value]])],16)}}},Qt=ce(ko,[["__scopeId","data-v-83e9f414"]]),Co={key:1,style:{"text-align":"center"}},So={key:1,style:{"text-align":"center"}},Io={key:0,class:"dida-problems-container"},Po={style:{margin:"12px"}},xo={key:1},Vo={class:"dida-operation-container"},To={key:0,class:"dida-operation-container"},Do={class:"dida-code-submit-div"},Lo={class:"dida-code-editor-div"},jo=ie({__name:"ProblemDetail",setup(e){let l=ke();const{globalProperties:n}=fe();let u=null;const s=Ye(),y=Ee();let _=d(""),x="",f="",o=0,T=d(0);const p=d(!1),k=d(!1),b=d(!1),g=d(null);let i=null;const m=d(null),v=d(!1),C=d(!1),c={},r=d(""),A=d([]);A.value=Ft();const I=d([]),h=d(null),U=d(-1),P=d(-1),w=d(""),j=d("");let $=0;const D=Ge(()=>y.hasAuth(De.ManageProblem)),S=Ge(()=>y.hasAuth(De.ManageProblemDaily)),M=()=>{h.value&&clearInterval(h.value),h.value=setInterval(()=>{const K=U.value<=0,B=new Date(new Date().getTime()+$),re=B.getHours()*60*60+B.getMinutes()*60+B.getSeconds(),ge=18*60*60;re<ge?U.value=ge-re:U.value=-1,P.value=24*60*60-re,(!K&&U.value<=0||P.value<=0)&&se()},1e3)},R=()=>{h.value&&(clearInterval(h.value),h.value=null)},N=K=>{K&&Z.push({name:"problem-list",query:{...l.query,title:"",tag:K.name}})},X=async()=>{if(!f){_e(n,"每日问题ID无效");return}await Z.push({name:"manage-problem-daily",params:{dailyId:f}})},oe=async()=>{let K=x;if(!K)try{const B=await po(o,T.value);B.code===0?K=B.data:F(n,B.code)}catch{_e(n,"获取题目ID失败，请稍后再试");return}await Z.push({name:"manage-problem",params:{problemId:K}})},te=()=>{x?Z.push({name:"judge-list",query:{problem_id:x}}):Z.push({name:"contest-judge",params:{contestId:o},query:{problem_id:at(T.value)}})},ee=()=>{x?Z.push({name:"discuss-list-problem",query:{problem_id:x}}):Z.push({name:"contest-discuss",params:{contestId:o},query:{problem_id:at(T.value)}})},O=()=>{Z.push({name:"problem-recommend",params:{problemId:x}})},de=async()=>{var re,ge;const K=(re=g.value)==null?void 0:re.originOj,B=(ge=g.value)==null?void 0:ge.originId;if(!(!K||!B))try{v.value=!0;const ve=await Da(K,B);ve.code===0?(await H(),he(n,"更新成功")):F(n,ve.code)}catch{_e(n,"更新失败，请稍后再试")}finally{v.value=!1}},Q=async()=>{const K=parseInt(r.value);if(!wt(K)){_e(n,"请选择所编写的语言");return}const B=i==null?void 0:i.getValue();if(!B){_e(n,"请输入所需提交的代码");return}if(!x&&(!o||!T.value)){_e(n,"问题ID无效");return}C.value=!0;try{const re=await Ql(x,o,T.value,K,B);if(re.code!==0){F(n,re.code);return}he(n,"提交成功，正在跳转到详情页面");const ge=re.data.id;o?await Z.push({name:"contest-judge-detail",params:{contestId:o,judgeId:ge}}):await Z.push({name:"judge-detail",params:{judgeId:ge}})}finally{C.value=!1}},W=K=>{if(!i)return;const B=i.getModel();B&&Xt.setModelLanguage(B,Ot(K))},H=async()=>{I.value=[];let K=await Va(x,o,T.value);if(K.code!==0){b.value=!1,F(n,K.code),await Z.push({name:"problem"});return}K.data.tags&&K.data.tags.forEach(B=>{c[B.id]=B}),g.value=vt(K.data.problem,c),s.setTitle(g.value.title+" - "+s.getTitle),o&&(K=await co(o),K.code===0?(K.data.problems.sort((B,re)=>B-re),I.value=K.data.problems):F(n,K.code)),_.value=g.value.description,await dt(()=>{!i&&m.value&&(i=Xt.create(m.value,{value:"",language:"cpp",minimap:{enabled:!0},colorDecorators:!0,readOnly:!1,theme:"vs-dark"})),b.value=!1})},se=async()=>{R(),k.value=!1;const K=await mn(f);if(K.code!==0)return;k.value=!0;const B=K.data.problem_daily;x=B.problem_id,w.value=B.solution,j.value=B.code;const re=new Date(K.data.time);$=re.getTime()-new Date().getTime();const ge=re.toISOString().split("T")[0];if(f===ge){const ve=re.getHours()*60*60+re.getMinutes()*60+re.getSeconds(),Y=18*60*60;ve<Y?U.value=Y-ve:U.value=-1,P.value=24*60*60-ve}(U.value>=0||P.value>=0)&&M()};return me(async()=>{u=Le(()=>l.params,async()=>{if(k.value=!1,Array.isArray(l.params.problemId)?x=l.params.problemId[0]:x=l.params.problemId,x||(Array.isArray(l.params.dailyId)?f=l.params.dailyId[0]:f=l.params.dailyId,b.value=!0,await se(),b.value=!1),!x){if(Array.isArray(l.params.contestId)?o=Number(l.params.contestId[0]):o=Number(l.params.contestId),!o){_e(n,"题目不存在"),f?await Z.push({name:"problem-daily-list"}):await Z.push({name:"problem"});return}if(Array.isArray(l.params.problemIndex)?T.value=parseInt(l.params.problemIndex[0]):T.value=parseInt(l.params.problemIndex),!T.value){_e(n,"题目不存在"),await Z.push({name:"problem"});return}}p.value=!!o,b.value=!0,await H()},{immediate:!0}),m.value&&new ResizeObserver(()=>{i&&i.layout()}).observe(m.value)}),Te(()=>{u&&(u(),u=null),R()}),(K,B)=>{const re=Me("md-preview"),ge=be,ve=Et,Y=we,ye=xe,Ie=G,Ce=Je,qe=nt,Ne=We,Xe=qt,et=pt,ot=Pe,Lt=Ve;return L(),E(Lt,{loading:b.value},{default:a(()=>[t(ot,{class:"dida-main-content"},{default:a(()=>[t(ye,{span:8},{default:a(()=>[t(ge,{style:{margin:"10px"}},{default:a(()=>[t(re,{"model-value":pe(_),previewTheme:"cyanosis"},null,8,["model-value"])]),_:1}),k.value?(L(),E(ge,{key:0,style:{margin:"10px"},title:"题解"},{default:a(()=>[U.value<0?(L(),E(Qt,{key:0},{default:a(()=>[t(re,{"model-value":w.value,previewTheme:"cyanosis"},null,8,["model-value"])]),_:1})):(L(),ae("div",Co,[z("div",null,[t(Y,null,{default:a(()=>[B[2]||(B[2]=z("p",null,"距离解锁百分比",-1)),t(ve,{theme:"circle",color:{from:"#0052D9",to:"#00A870"},percentage:100-U.value/(18*60*60)*100,status:"active"},{label:a(()=>[V(q((100-U.value/(18*60*60)*100).toFixed(3))+"% ",1)]),default:a(()=>[B[1]||(B[1]=V(" > "))]),_:1},8,["percentage"])]),_:1})])]))]),_:1})):le("",!0),k.value?(L(),E(ge,{key:1,style:{margin:"10px"},title:"示例代码"},{default:a(()=>[P.value<0?(L(),E(Qt,{key:0},{default:a(()=>[t(re,{"model-value":j.value,previewTheme:"cyanosis"},null,8,["model-value"])]),_:1})):(L(),ae("div",So,[z("div",null,[t(Y,{style:{margin:"0 auto"}},{default:a(()=>[B[4]||(B[4]=z("p",null,"距离解锁百分比",-1)),t(ve,{theme:"circle",color:{from:"#0052D9",to:"#00A870"},percentage:100-P.value/(24*60*60)*100,status:"active"},{label:a(()=>[V(q((100-P.value/(24*60*60)*100).toFixed(3))+"% ",1)]),default:a(()=>[B[3]||(B[3]=V(" > "))]),_:1},8,["percentage"])]),_:1})])]))]),_:1})):le("",!0)]),_:1}),t(ye,{span:4},{default:a(()=>{var Wt;return[pe(o)?(L(),ae("div",Io,[t(Y,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(L(!0),ae(ue,null,Se(I.value,(Ae,ne)=>(L(),E(Ie,{key:ne,theme:Ae==pe(T)?"primary":"default",onClick:async()=>await pe(Mt)(pe(o),Ae)},{default:a(()=>[V(q(pe(at)(Ae)),1)]),_:2},1032,["theme","onClick"]))),128))]),_:1})])):le("",!0),z("div",Po,[t(Ne,{layout:"vertical",bordered:!0},{default:a(()=>{var Ae;return[t(Ce,{label:"ID"},{default:a(()=>{var ne;return[V(q((ne=g.value)==null?void 0:ne.id),1)]}),_:1}),t(Ce,{label:"标题"},{default:a(()=>{var ne;return[V(q((ne=g.value)==null?void 0:ne.title),1)]}),_:1}),t(Ce,{label:"时间限制"},{default:a(()=>{var ne;return[V(q((ne=g.value)==null?void 0:ne.timeLimit),1)]}),_:1}),t(Ce,{label:"内存限制"},{default:a(()=>{var ne;return[V(q((ne=g.value)==null?void 0:ne.memoryLimit),1)]}),_:1}),t(Ce,{label:"判题方式"},{default:a(()=>{var ne;return[V(q((ne=g.value)==null?void 0:ne.judgeType),1)]}),_:1}),p.value?le("",!0):(L(),E(Ce,{key:0,label:"正确提交"},{default:a(()=>{var ne;return[V(q((ne=g.value)==null?void 0:ne.accept),1)]}),_:1})),p.value?le("",!0):(L(),E(Ce,{key:1,label:"提交总数"},{default:a(()=>{var ne;return[V(q((ne=g.value)==null?void 0:ne.attempt),1)]}),_:1})),t(Ce,{label:"创建时间"},{default:a(()=>{var ne;return[V(q((ne=g.value)==null?void 0:ne.insertTime),1)]}),_:1}),t(Ce,{label:"更新时间"},{default:a(()=>{var ne;return[V(q((ne=g.value)==null?void 0:ne.updateTime),1)]}),_:1}),t(Ce,{label:"上传用户"},{default:a(()=>{var ne;return[V(q((ne=g.value)==null?void 0:ne.creatorNickname),1)]}),_:1}),p.value?le("",!0):(L(),E(Ce,{key:2,label:"题目来源"},{default:a(()=>{var ne,Ze,ct;return[(ne=g.value)!=null&&ne.sourceUrl?(L(),E(qe,{key:0,href:(Ze=g.value)==null?void 0:Ze.sourceUrl,target:"_blank"},{default:a(()=>{var Jt;return[V(q((Jt=g.value)==null?void 0:Jt.source),1)]}),_:1},8,["href"])):(L(),ae("span",xo,q((ct=g.value)==null?void 0:ct.source),1))]}),_:1})),D.value?(L(),E(Ce,{key:3,label:"是否私有"},{default:a(()=>{var ne;return[V(q((ne=g.value)!=null&&ne.private?"私有":"公开"),1)]}),_:1})):le("",!0),(Ae=g.value)!=null&&Ae.originUrl?(L(),E(Ce,{key:4,label:"原题链接"},{default:a(()=>{var ne;return[t(qe,{href:(ne=g.value)==null?void 0:ne.originUrl,target:"_blank"},{default:a(()=>{var Ze,ct;return[V(q((Ze=g.value)==null?void 0:Ze.originOj)+" - "+q((ct=g.value)==null?void 0:ct.originId),1)]}),_:1},8,["href"])]}),_:1})):le("",!0),pe(x)?(L(),E(Ce,{key:5,label:"标签"},{default:a(()=>[t(Y,null,{default:a(()=>{var ne;return[(L(!0),ae(ue,null,Se((ne=g.value)==null?void 0:ne.tags,Ze=>(L(),E(Ie,{key:Ze.id,variant:"dashed",onClick:()=>N(Ze)},{default:a(()=>[V(q(Ze.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})):le("",!0)]}),_:1}),z("div",Vo,[t(Y,null,{default:a(()=>[t(Ie,{onClick:te},{default:a(()=>B[5]||(B[5]=[V("提交记录")])),_:1}),t(Ie,{onClick:ee},{default:a(()=>B[6]||(B[6]=[V("题目讨论")])),_:1}),pe(x)?(L(),E(Ie,{key:0,onClick:O},{default:a(()=>B[7]||(B[7]=[V("题目推荐")])),_:1})):le("",!0)]),_:1})]),k.value&&S.value||D.value||(Wt=g.value)!=null&&Wt.originId?(L(),ae("div",To,[t(Y,null,{default:a(()=>{var Ae;return[k.value&&S.value?(L(),E(Ie,{key:0,onClick:X},{default:a(()=>B[8]||(B[8]=[V("每日一题")])),_:1})):le("",!0),D.value?(L(),E(Ie,{key:1,onClick:oe},{default:a(()=>B[9]||(B[9]=[V("编辑")])),_:1})):le("",!0),(Ae=g.value)!=null&&Ae.originId?(L(),E(Ie,{key:2,onClick:de,loading:v.value},{default:a(()=>B[10]||(B[10]=[V("更新描述 ")])),_:1},8,["loading"])):le("",!0)]}),_:1})])):le("",!0),z("div",Do,[t(Y,null,{default:a(()=>[t(et,{modelValue:r.value,"onUpdate:modelValue":B[0]||(B[0]=Ae=>r.value=Ae),label:"语言：",placeholder:"请选择提交语言","auto-width":"",clearable:"",onChange:W},{default:a(()=>[(L(!0),ae(ue,null,Se(A.value,Ae=>(L(),E(Xe,{key:Ae.value,value:Ae.value,label:Ae.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),t(Ie,{onClick:Q,loading:C.value},{default:a(()=>B[11]||(B[11]=[V("提交")])),_:1},8,["loading"])]),_:1}),z("div",Lo,[z("div",{ref_key:"codeEditRef",ref:m,class:"dida-code-editor"},null,512)])])])]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),jt=ce(jo,[["__scopeId","data-v-34ff9e78"]]),Uo={style:{margin:"10px"}},$o={key:0,class:"dida-operation-container"};function zo(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const Ao=ie({__name:"ProblemDailyList",setup(e){const l=ke(),n=Be(),{globalProperties:u}=fe(),s=Ee();let y=!1,_=null,x={},f={};const o=Ge(()=>s.hasAuth(De.ManageProblem)),T=d([{title:"日期",colKey:"id",cell:(P,w)=>t(G,{variant:"dashed",onClick:()=>v(w.row.id)},{default:()=>[w.row.id]})},{title:"ID",colKey:"problemId",cell:(P,w)=>{let j=C(w.row.problemId);return t(G,{variant:"dashed",theme:j,onClick:()=>v(w.row.id)},{default:()=>[w.row.problemId]})}},{title:"标题",colKey:"title",cell:(P,w)=>t(G,{variant:"text",onClick:()=>v(w.row.id)},{default:()=>[w.row.title]})},{title:"标签",colKey:"tags",cell:(P,w)=>{const j=w.row.tags;if(!j||j.length===0)return"";let $=[];for(let D=0;D<j.length;D++){const S=j[D];$.push(t(G,{key:D,theme:"default",variant:"outline",size:"small",onClick:()=>A(S)},{default:()=>[S.name]}))}return t(we,null,zo($)?$:{default:()=>[$]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),p=d(!1);let k=1,b=50;const g=d({current:k,pageSize:b,defaultCurrent:k,defaultPageSize:b,total:0,pageSizeOptions:[50,100]}),i=d([]),m=d({date:[],problemId:""}),v=P=>{P&&n.push({name:"problem-daily-detail",params:{dailyId:P}})},C=P=>{if(!P||!f)return"default";const w=f[P];if(!w)return"default";switch(w){case Oe.Accept:return"success";case Oe.Attempt:return"warning";default:return"default"}},c=async()=>{let P="";m.value.date&&m.value.date.length>1&&(P=m.value.date[0]+"~"+m.value.date[1]),await n.push({query:{...l.query,date:P,problem_id:m.value.problemId,page:1,page_size:g.value.defaultPageSize}})},r=async()=>{m.value.date=[],m.value.problemId="",await n.push({query:{...l.query,date:"",problem_id:"",page:1,page_size:g.value.defaultPageSize}})},A=P=>{P&&n.push({name:"problem-list",query:{...l.query,title:"",tag:P.name,page:1,page_size:g.value.defaultPageSize}})},I=()=>{n.push({name:"manage-problem-daily-create"})},h=async(P,w)=>{p.value=!0;try{const{current:j,pageSize:$}=P;let D="";m.value.date[0]&&(D=m.value.date[0]);let S="";m.value.date[1]&&(S=m.value.date[1]);const M=await vn(D,S,m.value.problemId,j,$);if(i.value=[],M.code===0){const R=M.data.list;if(!R||R.length<=0){g.value={...g.value,total:0},f={},he(u,"未找到记录");return}x={},M.data.tags&&M.data.tags.forEach(N=>{x[N.id]=N}),R.forEach(N=>{var oe;const X=xa(N,x);(oe=i.value)==null||oe.push(X)}),g.value={...g.value,total:M.data.total_count},f=M.data.attempt_status}else w&&F(u,M.code)}catch(j){console.error(j),F(u,Ke())}finally{p.value=!1}},U=async P=>{await n.push({query:{...l.query,page:P.current,page_size:P.pageSize}})};return me(async()=>{y=!0,p.value=!0,_=Le(()=>l.query,P=>{if(!y)return;if(m.value.date=[],P.date){const $=P.date.split("~");$.length===2&&(m.value.date=[$[0],$[1]])}m.value.problemId=P.problem_id||"";const w=parseInt(P.page)||g.value.defaultCurrent,j=parseInt(P.page_size)||g.value.defaultPageSize;k=w,b=j,g.value={...g.value,current:k,pageSize:b},h({current:k,pageSize:b},!0)},{immediate:!0})}),Te(()=>{y=!1,_&&_()}),(P,w)=>{const j=ze,$=be,D=xe,S=G,M=we,R=Kt,N=Ue,X=$e,oe=je,te=Pe;return L(),E(te,null,{default:a(()=>[t(D,{span:9},{default:a(()=>[t($,{style:{margin:"10px"}},{default:a(()=>[t(j,{data:i.value,columns:T.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:g.value,"table-layout":"auto",loading:p.value,onPageChange:U},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(D,{span:3},{default:a(()=>[z("div",Uo,[o.value?(L(),ae("div",$o,[t(M,null,{default:a(()=>[t(S,{onClick:I},{default:a(()=>w[2]||(w[2]=[V("新建")])),_:1})]),_:1})])):le("",!0),t($,{class:"sh-card"},{default:a(()=>[t(oe,{model:m.value,onSubmit:c,onReset:r},{default:a(()=>[t(N,{label:"日期","label-align":"top"},{default:a(()=>[t(R,{modelValue:m.value.date,"onUpdate:modelValue":w[0]||(w[0]=ee=>m.value.date=ee),"allow-input":"",clearable:"",format:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(N,{label:"问题","label-align":"top"},{default:a(()=>[t(X,{modelValue:m.value.problemId,"onUpdate:modelValue":w[1]||(w[1]=ee=>m.value.problemId=ee),placeholder:"请输入问题ID",clearable:""},null,8,["modelValue"])]),_:1}),t(N,{"label-align":"top"},{default:a(()=>[t(M,null,{default:a(()=>[t(S,{theme:"primary",type:"submit"},{default:a(()=>w[3]||(w[3]=[V("搜索")])),_:1}),t(S,{theme:"danger",type:"reset"},{default:a(()=>w[4]||(w[4]=[V("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t($,{class:"sh-card",header:"每日一题","header-bordered":!0},{default:a(()=>w[5]||(w[5]=[z("p",null,"由管理员团队精选的题目，每日0点更新。",-1),z("p",null,"当日下午6点提供题解，次日提供AC代码。",-1)])),_:1})])]),_:1})]),_:1})}}}),Ro=ce(Ao,[["__scopeId","data-v-5e0bb3cc"]]),Mo={style:{margin:"10px"}},Eo={style:{margin:"12px"}},qo={class:"dida-edit-container"},Ko=ie({__name:"ProblemDailyEdit",setup(e){let l=ke();const{globalProperties:n}=fe();let u=null;const s=d(""),y=d(!1),_=d(!1),x=d(null),f=d({date:"",problemId:"",solution:"",code:""}),o=()=>{Z.push({name:"problem-daily-detail",params:{dailyId:s.value}})};async function T(m,v){_.value=!0,await xt(m,v,n,()=>kn(s.value)),_.value=!1}const p=async()=>{_.value=!0;try{const m=f.value.date,v=await bn(m,f.value.problemId,f.value.solution,f.value.code);if(_.value=!0,v.code!==0){F(n,v.code);return}await Z.push({name:"manage-problem-daily",params:{dailyId:m}}),He(n,"创建成功")}finally{_.value=!1}},k=async()=>{_.value=!0;try{const m=await hn(s.value,f.value.problemId,f.value.solution,f.value.code);if(_.value=!0,m.code!==0){F(n,m.code);return}x.value&&(m.data.update_time!=null&&(x.value.updateTime=new Date(m.data.update_time).toLocaleString()),m.data.updater_nickname!=null&&(x.value.updaterNickname=m.data.updater_nickname)),m.data.solution!=null&&(f.value.solution=m.data.solution),m.data.code!=null&&(f.value.code=m.data.code),He(n,"保存成功")}finally{_.value=!1}},b=m=>{f.value.solution=m,y.value=!1},g=m=>{f.value.code=m,y.value=!1},i=async()=>{const m=await pn(s.value);if(m.code!==0){F(n,m.code),console.error("problem get failed",m.code),await Z.push({name:"problem"});return}const v=m.data;x.value=xa(v,{}),f.value.problemId=v.problem_id,b(v.solution),g(v.code)};return me(async()=>{u=Le(()=>l.params,async()=>{Array.isArray(l.params.dailyId)?s.value=l.params.dailyId[0]:s.value=l.params.dailyId,s.value?(y.value=!0,f.value.date=s.value,await i()):(b("暂无题解"),g("暂无标程"))},{immediate:!0})}),Te(()=>{u&&(u(),u=null)}),(m,v)=>{const C=It,c=bl,r=Ue,A=$e,I=je,h=be,U=xe,P=G,w=we,j=Je,$=We,D=Pe,S=Me("md-editor-v3"),M=Ve;return L(),E(M,{loading:y.value},{default:a(()=>[t(D,null,{default:a(()=>[t(U,{span:8},{default:a(()=>[z("div",Mo,[t(C,{theme:"info"},{default:a(()=>v[4]||(v[4]=[V("可以提前配置将来日期的题目，对外仅展示到截止到当天的题目")])),_:1}),t(h,{class:"sh-form-card"},{default:a(()=>[t(I,{model:f.value},{default:a(()=>[t(r,{label:"日期"},{default:a(()=>[t(c,{modelValue:f.value.date,"onUpdate:modelValue":v[0]||(v[0]=R=>f.value.date=R),disabled:s.value&&!0},null,8,["modelValue","disabled"])]),_:1}),t(r,{label:"问题ID"},{default:a(()=>[t(A,{modelValue:f.value.problemId,"onUpdate:modelValue":v[1]||(v[1]=R=>f.value.problemId=R),placeholder:"问题标题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(U,{span:4},{default:a(()=>[z("div",Eo,[z("div",qo,[s.value?(L(),E(w,{key:0},{default:a(()=>[t(P,{onClick:k,theme:"danger",loading:_.value},{default:a(()=>v[5]||(v[5]=[V("保存")])),_:1},8,["loading"]),t(P,{onClick:o},{default:a(()=>v[6]||(v[6]=[V("查看")])),_:1})]),_:1})):(L(),E(w,{key:1},{default:a(()=>[t(P,{onClick:p,theme:"danger",loading:_.value},{default:a(()=>v[7]||(v[7]=[V("创建")])),_:1},8,["loading"])]),_:1}))]),s.value?(L(),E($,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(j,{label:"创建时间"},{default:a(()=>{var R;return[V(q((R=x.value)==null?void 0:R.createTime),1)]}),_:1}),t(j,{label:"更新时间"},{default:a(()=>{var R;return[V(q((R=x.value)==null?void 0:R.updateTime),1)]}),_:1}),t(j,{label:"创建用户"},{default:a(()=>{var R;return[V(q((R=x.value)==null?void 0:R.creatorNickname),1)]}),_:1}),t(j,{label:"更新用户"},{default:a(()=>{var R;return[V(q((R=x.value)==null?void 0:R.updaterNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),z("div",null,[v[8]||(v[8]=z("p",{style:{"margin-left":"20px"}},"题解：",-1)),t(S,{id:"daily-solution-editor",modelValue:f.value.solution,"onUpdate:modelValue":v[2]||(v[2]=R=>f.value.solution=R),onSave:k,onOnUploadImg:T,previewTheme:"cyanosis"},null,8,["modelValue"]),t(M,{loading:_.value,attach:"#daily-solution-editor","z-index":1e5},null,8,["loading"])]),z("div",null,[v[9]||(v[9]=z("p",{style:{"margin-left":"20px"}},"标程：",-1)),t(S,{id:"daily-code-editor",modelValue:f.value.code,"onUpdate:modelValue":v[3]||(v[3]=R=>f.value.code=R),onSave:k,onOnUploadImg:T,previewTheme:"cyanosis"},null,8,["modelValue"]),t(M,{loading:_.value,attach:"#daily-code-editor","z-index":1e5},null,8,["loading"])])]),_:1},8,["loading"])}}}),ea=ce(Ko,[["__scopeId","data-v-b11269dd"]]),Fo={style:{margin:"10px"}};function Oo(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const Go=ie({__name:"ProblemRecommend",setup(e){const l=ke(),n=Be(),{globalProperties:u}=fe();let s=null,y="",_={},x={};const f=d([{title:"ID",colKey:"id",cell:(i,m)=>{let v=k(m.row.id);return t(G,{variant:"dashed",theme:v,onClick:()=>p(m.row.id)},{default:()=>[m.row.id]})}},{title:"标题",colKey:"title",cell:(i,m)=>t(G,{variant:"text",onClick:()=>p(m.row.id)},{default:()=>[m.row.title]})},{title:"标签",colKey:"tags",cell:(i,m)=>{const v=m.row.tags;if(!v||v.length===0)return"";let C=[];for(let c=0;c<v.length;c++){const r=v[c];C.push(t(G,{key:c,theme:"default",variant:"outline",size:"small",onClick:()=>b(r)},{default:()=>[r.name]}))}return t(we,null,Oo(C)?C:{default:()=>[C]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),o=d(!1),T=d(),p=i=>{i&&n.push({path:"/problem/"+i})},k=i=>{if(!i||!x)return"default";const m=x[i];if(!m)return"default";switch(m){case Oe.Accept:return"success";case Oe.Attempt:return"warning";default:return"default"}},b=i=>{i&&n.push({name:"problem-list",query:{tag:i.name}})},g=async i=>{o.value=!0;try{const m=await dn(y);if(T.value=[],m.code===0){const v=m.data.list;if(!v||v.length<=0){he(u,"暂无推荐题目");return}_={},m.data.tags&&m.data.tags.forEach(C=>{_[C.id]=C}),v.forEach(C=>{var r;const c=vt(C,_);(r=T.value)==null||r.push(c)})}else i&&F(u,m.code)}catch(m){console.error(m),F(u,Ke())}finally{o.value=!1}};return me(async()=>{o.value=!0,s=Le(()=>l.query,i=>{Array.isArray(l.params.problemId)?y=l.params.problemId[0]:y=l.params.problemId,g(!0)},{immediate:!0})}),Te(()=>{s&&s()}),(i,m)=>{const v=ze,C=be,c=xe,r=Pe;return L(),E(r,null,{default:a(()=>[t(c,{span:9},{default:a(()=>[t(C,{style:{margin:"10px"}},{default:a(()=>[t(v,{data:T.value,columns:f.value,"row-key":"id","vertical-align":"top",hover:!0,"table-layout":"auto",loading:o.value},null,8,["data","columns","loading"])]),_:1})]),_:1}),t(c,{span:3},{default:a(()=>[z("div",Fo,[t(C,{class:"sh-card",header:"题目推荐","header-bordered":!0},{default:a(()=>m[0]||(m[0]=[V(" 根据本站其他用户的提交记录推荐类似题目"),z("br",null,null,-1),V("依据推荐算法来计算，与本用户相似度最高的用户做的题，大概率被自己感兴趣。 ")])),_:1})])]),_:1})]),_:1})}}}),No=ce(Go,[["__scopeId","data-v-77972e8b"]]),Ho={style:{margin:"10px"}},Bo={key:1},Wo={style:{margin:"12px"}},Jo={class:"dida-edit-container"},Yo={class:"dida-description-editor"},Xo=ie({__name:"ProblemEdit",setup(e){let l=ke();const{globalProperties:n}=fe(),u=Ye(),s=d(""),y=d(!1),_=d(!1),x=d(!1),f=d(null),o=d({title:"",timeLimit:0,memoryLimit:0,source:"",private:!0,tags:[],description:""}),T=d([]),p=d([]),k=Ge(()=>{const I=[],h=T.value;for(let U=0,P=h.length;U<P;U++)h[U].value&&I.push(h[U].value);return I}),b=(I,h)=>{const{trigger:U,index:P,item:w}=h;if(U==="clear"&&(T.value=[]),["tag-remove","backspace"].includes(U)&&T.value.splice(P,1),U==="enter"){for(let $=0;$<p.value.length;$++){const D=p.value[$];if(D.label===w){for(let S=0;S<T.value.length;S++)if(T.value[S].label===D.label)return;T.value.push(D);return}}const j={label:w,value:w};T.value.push(j),p.value=p.value.concat(j)}},g=(I,{current:h,type:U})=>{if(!h){T.value=U==="check"?p.value.slice(1):[];return}if(U==="check"){const P=p.value.find(w=>w.value===h);if(!P)return;T.value.push(P)}else T.value=T.value.filter(P=>P.value!==h)},i=()=>{Z.push({name:"problem-detail",params:{problemId:s.value}})},m=()=>{Z.push({name:"manage-problem-judge",params:{problemId:s.value}})},v=async(I,h)=>{x.value=!0,await xt(I,h,n,()=>wn(s.value)),x.value=!1},C=async()=>{_.value=!0,o.value.tags=[];for(let I=0;I<T.value.length;I++){const h=T.value[I];h&&h.label&&o.value.tags.push(h.label)}try{const I=await _n(o.value.title,o.value.timeLimit,o.value.memoryLimit,o.value.source,o.value.private,o.value.tags,o.value.description);if(_.value=!0,I.code!==0){F(n,I.code);return}I.data!=null&&await Z.push({name:"problem-detail",params:{problemId:I.data}}),He(n,"创建成功")}finally{_.value=!1}},c=async()=>{_.value=!0,o.value.tags=[];for(let I=0;I<T.value.length;I++){const h=T.value[I];h&&h.label&&o.value.tags.push(h.label)}try{const I=await gn(s.value,o.value.title,o.value.timeLimit,o.value.memoryLimit,o.value.source,o.value.private,o.value.tags,o.value.description);if(_.value=!0,I.code!==0){F(n,I.code);return}f.value&&I.data.update_time!=null&&(f.value.updateTime=new Date(I.data.update_time).toLocaleString()),I.data.description!=null&&(o.value.description=I.data.description),He(n,"保存成功")}finally{_.value=!1}},r=I=>{o.value.description=I,y.value=!1},A=async()=>{const I=await Va(s.value,void 0,void 0);if(I.code!==0){F(n,I.code),console.error("problem get failed",I.code),await Z.push({name:"problem"});return}const h=I.data.problem;if(f.value=vt(h,{}),o.value.title=h.title,o.value.timeLimit=h.time_limit,o.value.memoryLimit=h.memory_limit,o.value.source=h.source,o.value.private=h.private,o.value.tags=[],T.value=[],I.data.tags)for(let P=0;P<I.data.tags.length;P++){const w=I.data.tags[P];w&&w.name&&(o.value.tags.push(w.name),T.value.push({label:w.name,value:w.id}))}u.setTitle(h.title+" - "+u.getTitle);let U=h.description;r(U)};return me(async()=>{Array.isArray(l.params.problemId)?s.value=l.params.problemId[0]:s.value=l.params.problemId,s.value?(y.value=!0,Ta(-1).then(async I=>{I.code===0?(I.data.list&&I.data.list.forEach(h=>{p.value.push({label:h.name,value:h.id})}),await A()):(F(n,I.code),console.error("problem tag get failed",I.code),await Z.push({name:"problem"}))}).catch(async I=>{console.error(I),F(n,"获取数据异常"),await Z.push({name:"problem"})})):(o.value.timeLimit=1e3,o.value.memoryLimit=65536,r(""))}),(I,h)=>{const U=$e,P=Ue,w=_a,j=ft,$=yl,D=hl,S=je,M=be,R=xe,N=G,X=we,oe=Je,te=We,ee=Pe,O=Me("md-editor-v3"),de=Ve;return L(),E(de,{loading:y.value},{default:a(()=>[t(ee,null,{default:a(()=>[t(R,{span:8},{default:a(()=>[z("div",Ho,[t(M,{class:"sh-card"},{default:a(()=>[t(S,{model:o.value},{default:a(()=>[t(P,{label:"标题"},{default:a(()=>[t(U,{modelValue:o.value.title,"onUpdate:modelValue":h[0]||(h[0]=Q=>o.value.title=Q),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),t(P,{label:"时间限制"},{default:a(()=>[t(w,{modelValue:o.value.timeLimit,"onUpdate:modelValue":h[1]||(h[1]=Q=>o.value.timeLimit=Q),theme:"normal",min:0},{suffix:a(()=>h[6]||(h[6]=[z("span",null,"ms",-1)])),_:1},8,["modelValue"])]),_:1}),t(P,{label:"内存限制"},{default:a(()=>[t(w,{modelValue:o.value.memoryLimit,"onUpdate:modelValue":h[2]||(h[2]=Q=>o.value.memoryLimit=Q),theme:"normal",min:0},{suffix:a(()=>h[7]||(h[7]=[z("span",null,"KB",-1)])),_:1},8,["modelValue"])]),_:1}),t(P,{label:"来源"},{default:a(()=>[t(U,{modelValue:o.value.source,"onUpdate:modelValue":h[3]||(h[3]=Q=>o.value.source=Q),placeholder:"请输入题目来源"},null,8,["modelValue"])]),_:1}),t(P,{label:"私有"},{default:a(()=>[t(j,{modelValue:o.value.private,"onUpdate:modelValue":h[4]||(h[4]=Q=>o.value.private=Q)},null,8,["modelValue"])]),_:1}),t(P,{label:"标签"},{default:a(()=>[t(D,{value:T.value,"allow-input":!0,placeholder:"请选择或输入","tag-input-props":{excessTagsDisplayType:"break-line"},"popup-props":{overlayInnerClassName:["narrow-scrollbar"],overlayInnerStyle:{maxHeight:"280px",overflowY:"auto",overscrollBehavior:"contain",padding:"6px"}},clearable:"",multiple:"",onTagChange:b},{panel:a(()=>[p.value.length?(L(),E($,{key:0,value:k.value,options:p.value,onChange:g},null,8,["value","options"])):(L(),ae("div",Bo,"暂无数据"))]),suffixIcon:a(()=>[t(pe(Za))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(R,{span:4},{default:a(()=>[z("div",Wo,[z("div",Jo,[s.value?(L(),E(X,{key:0},{default:a(()=>[t(N,{onClick:c,theme:"danger",loading:_.value},{default:a(()=>h[8]||(h[8]=[V("保存")])),_:1},8,["loading"]),t(N,{onClick:m,theme:"warning"},{default:a(()=>h[9]||(h[9]=[V("判题数据")])),_:1}),t(N,{onClick:i},{default:a(()=>h[10]||(h[10]=[V("查看")])),_:1})]),_:1})):(L(),E(X,{key:1},{default:a(()=>[t(N,{onClick:C,theme:"danger",loading:_.value},{default:a(()=>h[11]||(h[11]=[V("创建")])),_:1},8,["loading"])]),_:1}))]),s.value?(L(),E(te,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(oe,{label:"创建时间"},{default:a(()=>{var Q;return[V(q((Q=f.value)==null?void 0:Q.insertTime),1)]}),_:1}),t(oe,{label:"更新时间"},{default:a(()=>{var Q;return[V(q((Q=f.value)==null?void 0:Q.updateTime),1)]}),_:1}),t(oe,{label:"判题方式"},{default:a(()=>{var Q;return[V(q((Q=f.value)==null?void 0:Q.judgeType),1)]}),_:1}),t(oe,{label:"上传用户"},{default:a(()=>{var Q;return[V(q((Q=f.value)==null?void 0:Q.creatorNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),z("div",Yo,[h[12]||(h[12]=z("p",null,"题目描述",-1)),t(de,{loading:x.value||_.value},{default:a(()=>[t(O,{modelValue:o.value.description,"onUpdate:modelValue":h[5]||(h[5]=Q=>o.value.description=Q),onSave:c,onOnUploadImg:v,previewTheme:"cyanosis"},null,8,["modelValue"])]),_:1},8,["loading"])])]),_:1},8,["loading"])}}}),ta=ce(Xo,[["__scopeId","data-v-e72878e1"]]),Zo={style:{margin:"10px"}},Qo={style:{margin:"12px"}},es={class:"dida-edit-container"},ts=ie({__name:"ProblemJudge",setup(e){let l=ke();const{globalProperties:n}=fe(),u=Ye(),s=d(""),y=d(!1),_=d(null);let x=null;const f=d(null),o=d(""),T=d(!1),p=d(!1),k=d([{title:"文件",colKey:"file"},{title:"大小",colKey:"size",width:150,cell:(w,j)=>j.row.size.toFixed(0)+" B"},{title:"最后修改时间",colKey:"lastModified",width:180,cell:(w,j)=>new Date(j.row.lastModified).toLocaleString()},{title:"操作",colKey:"action",width:100,cell:(w,j)=>t(G,{onClick:()=>C(j.row.file)},{default:()=>[V("下载")]})}]),b=d([]),g=Ge(()=>({border:"2px dashed #ccc",borderRadius:"6px",padding:"20px",textAlign:"center",cursor:"pointer",backgroundColor:T.value?"#f0f9ff":"#fff",transition:"background-color 0.2s ease"})),i=Ge(()=>o.value?`已选择：${o.value}`:T.value?"松开文件以上传":"拖拽判题数据压缩包到这里，或点击选择文件"),m=()=>{Z.push({name:"problem-detail",params:{problemId:s.value}})},v=()=>{Z.push({name:"manage-problem",params:{problemId:s.value}})},C=async w=>{const j=await yn(s.value,w);if(j.code!==0){F(n,j.code);return}const $=document.createElement("a");$.href=j.data,$.target="_blank",$.click(),URL.revokeObjectURL($.href)},c=async()=>{if(!x){_e(n,"请选择压缩包");return}p.value=!0,Cn(s.value,x).then(async w=>{w.code==0?(f.value.value=null,x=null,o.value="",y.value=!0,He(n,"上传成功"),await P()):F(n,w.code)}).catch(w=>{console.log(w),n.$message.error({duration:3e3,content:"申请失败"})}).finally(()=>{p.value=!1})},r=()=>{var w;(w=f.value)==null||w.click()},A=w=>{const j=w.target.files[0];j&&(o.value=j.name,x=j)},I=w=>{T.value=!0},h=()=>{T.value=!1},U=w=>{w.preventDefault(),w.stopPropagation(),T.value=!1;const j=w.dataTransfer.files[0];if(j){o.value=j.name;const $=new DataTransfer;$.items.add(j),f.value.files=$.files,x=j}},P=async()=>{const w=await un(s.value);if(w.code!==0){F(n,w.code),await Z.push({name:"problem"});return}const j=w.data.problem;_.value=vt(j,{}),u.setTitle(j.title+" - "+u.getTitle),b.value=[],w.data.judges?w.data.judges.forEach($=>{b.value.push({file:$.key,size:$.size,lastModified:$.last_modified})}):_e(n,"评测数据不存在"),y.value=!1};return me(async()=>{if(Array.isArray(l.params.problemId)?s.value=l.params.problemId[0]:s.value=l.params.problemId,!s.value){_e(n,"题目不存在"),await Z.push({name:"problem"});return}y.value=!0,await P()}),(w,j)=>{const $=ze,D=xe,S=G,M=we,R=Je,N=We,X=Pe,oe=Ve;return L(),E(oe,{loading:y.value},{default:a(()=>[t(X,null,{default:a(()=>[t(D,{span:7},{default:a(()=>[z("div",Zo,[z("div",{id:"drop-zone",style:pa(g.value),onClick:r,onDragenter:yt(I,["prevent"]),onDragover:j[0]||(j[0]=yt(()=>{},["prevent"])),onDragleave:yt(h,["prevent"]),onDrop:U},[z("input",{ref_key:"fileInput",ref:f,type:"file",style:{display:"none"},onChange:A},null,544),V(" "+q(i.value),1)],36)]),t($,{data:b.value,columns:k.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1}),t(D,{span:5},{default:a(()=>[z("div",Qo,[z("div",es,[t(M,null,{default:a(()=>[t(S,{onClick:c,theme:"danger",loading:p.value},{default:a(()=>j[1]||(j[1]=[V("上传")])),_:1},8,["loading"]),t(S,{onClick:v,theme:"warning"},{default:a(()=>j[2]||(j[2]=[V("编辑")])),_:1}),t(S,{onClick:m},{default:a(()=>j[3]||(j[3]=[V("查看")])),_:1})]),_:1})]),t(N,{layout:"vertical",bordered:!0},{default:a(()=>[t(R,{label:"标题"},{default:a(()=>{var te;return[V(q((te=_.value)==null?void 0:te.title),1)]}),_:1}),t(R,{label:"创建时间"},{default:a(()=>{var te;return[V(q((te=_.value)==null?void 0:te.insertTime),1)]}),_:1}),t(R,{label:"更新时间"},{default:a(()=>{var te;return[V(q((te=_.value)==null?void 0:te.updateTime),1)]}),_:1}),t(R,{label:"判题方式"},{default:a(()=>{var te;return[V(q((te=_.value)==null?void 0:te.judgeType),1)]}),_:1}),t(R,{label:"评测数据"},{default:a(()=>{var te;return[V(q((te=_.value)==null?void 0:te.judgeMd5),1)]}),_:1}),t(R,{label:"上传用户"},{default:a(()=>{var te;return[V(q((te=_.value)==null?void 0:te.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),as=ce(ts,[["__scopeId","data-v-12b13fb1"]]);function Bt(e){const l={};return l.id=e.id,l.ownerId=e.owner_id,l.ownerUsername=e.owner_username,l.ownerNickname=e.owner_nickname,l.title=e.title,e.start_time?l.startTime=new Date(e.start_time).toLocaleString():l.startTime="无限制",e.end_time?l.endTime=new Date(e.end_time).toLocaleString():l.endTime="无限制",e.update_time?l.updateTime=new Date(e.update_time).toLocaleString():l.updateTime="",e.create_time?l.createTime=new Date(e.create_time).toLocaleString():l.createTime="",e.description?l.description=e.description:l.description="",l.problems=e.problems,l}function ls(e){return J({url:"/collection?id="+e,method:"get"})}function ns(e){return J({url:"/collection/edit?id="+e,method:"get"})}function os(e,l){return J({url:"/collection/list?page="+e+"&page_size="+l,method:"get"})}function ss(e){return J({url:"/collection/rank?id="+e,method:"get"})}function rs(e){return J({url:"/collection/create",method:"post",data:e})}function us(e){return J({url:"/collection/edit",method:"post",data:e})}function is(e){return J({url:"/collection/join",method:"post",data:{id:e}})}function cs(e){return J({url:"/collection/quit",method:"post",data:{id:e}})}const ds={style:{margin:"10px"}},ms=ie({__name:"CollectionList",setup(e){const l=ke(),n=Be(),{globalProperties:u}=fe();let s=null;d(!1),d(!1);const y=d([{title:"ID",colKey:"id",width:"100",cell:(v,C)=>t(G,{variant:"text",onClick:()=>k(C.row.id)},{default:()=>[C.row.id]})},{title:"标题",colKey:"title",cell:(v,C)=>t(G,{variant:"text",onClick:()=>k(C.row.id)},{default:()=>[C.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),_=d(!1);let x=1,f=50;const o=d({current:x,pageSize:f,defaultCurrent:x,defaultPageSize:f,total:0,pageSizeOptions:[50,100]}),T=d(),p=d({title:"",username:""});d({title:"",description:"",open_time:[]});const k=v=>{v&&n.push({path:"/collection/"+v})},b=async()=>{await n.push({query:{...l.query,title:p.value.title,username:p.value.username,page:1,page_size:o.value.defaultPageSize}})},g=async(v,C)=>{var c;_.value=!0;try{const{current:r,pageSize:A}=v,I=await os(r,A);if(T.value=[],I.code===0){const h=I.data.list;for(let U=0;U<h.length;U++){const P=h[U],w=Bt(P);(c=T.value)==null||c.push(w)}o.value={...o.value,total:I.data.total_count}}else C&&F(u,I.code)}catch(r){console.error(r),F(u,Ke())}finally{_.value=!1}},i=async v=>{await n.push({query:{...l.query,page:v.current,page_size:v.pageSize}})},m=async()=>{await n.push({name:"collection-create"})};return me(async()=>{s=Le(()=>l.query,v=>{p.value.title=v.title||"",p.value.username=v.username||"";const C=parseInt(v.page)||o.value.defaultCurrent,c=parseInt(v.page_size)||o.value.defaultPageSize;x=C,f=c,o.value={...o.value,current:x,pageSize:f},g({current:x,pageSize:f},!0)},{immediate:!0})}),Te(()=>{s&&s()}),(v,C)=>{const c=ze,r=be,A=xe,I=$e,h=Ue,U=G,P=je,w=we,j=Pe;return L(),E(j,null,{default:a(()=>[t(A,{span:9},{default:a(()=>[t(r,{style:{margin:"10px"}},{default:a(()=>[t(c,{data:T.value,columns:y.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:o.value,loading:_.value,onPageChange:i},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(A,{span:3},{default:a(()=>[z("div",ds,[t(r,{class:"sh-card"},{default:a(()=>[t(P,{model:p.value},{default:a(()=>[t(h,{label:"标题"},{default:a(()=>[t(I,{modelValue:p.value.title,"onUpdate:modelValue":C[0]||(C[0]=$=>p.value.title=$),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(h,{label:"负责人"},{default:a(()=>[t(I,{modelValue:p.value.username,"onUpdate:modelValue":C[1]||(C[1]=$=>p.value.username=$),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(h,null,{default:a(()=>[t(U,{theme:"primary",onClick:b},{default:a(()=>C[2]||(C[2]=[V("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(r,{class:"sh-card"},{default:a(()=>[t(w,null,{default:a(()=>[t(U,{onClick:m},{default:a(()=>C[3]||(C[3]=[V("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),ps=ce(ms,[["__scopeId","data-v-3c9d295e"]]),fs={style:{margin:"20px"}},vs={class:"dida-operation-container"},_s={style:{margin:"12px"}},gs=ie({__name:"CollectionDetail",setup(e){let l=ke();const{globalProperties:n}=fe(),u=Ye(),s=Ee();let y=0;const _=d(!1),x=d(null),f=d(!1),o=d(!1);let T={};const p=Ge(()=>s.hasAuth(De.ManageCollection)||x.value&&s.getUserId==x.value.ownerId),k=C=>{if(!C||!T)return"default";const c=T[C];if(!c)return"default";switch(c){case Oe.Accept:return"success";case Oe.Attempt:return"warning";default:return"default"}},b=d([{title:"问题ID",colKey:"id",cell:(C,c)=>{const r=k(c.row.id);return t(G,{variant:"dashed",theme:r,onClick:()=>Zt(c.row.id)},{default:()=>[c.row.id]})}},{title:"标题",colKey:"title",cell:(C,c)=>t(G,{variant:"text",onClick:()=>Zt(c.row.id)},{default:()=>[c.row.title]})},{title:"正确",colKey:"accept",cell:(C,c)=>c.row.accept?c.row.accept:0},{title:"提交",colKey:"attempt",cell:(C,c)=>c.row.attempt?c.row.attempt:0}]),g=d([]),i=async()=>{if(!s.isLogin()){await Z.push({name:"login"});return}o.value=!0;try{const C=await is(y);if(C.code!==0){F(n,C.code);return}f.value=!0,He(n,"加入成功")}finally{o.value=!1}},m=async()=>{if(!s.isLogin()){await Z.push({name:"login"});return}o.value=!0;try{const C=await cs(y);if(C.code!==0){F(n,C.code);return}f.value=!1,He(n,"退出成功")}finally{o.value=!1}},v=()=>{x.value&&Z.push({name:"collection-edit",params:{collectionId:x.value.id}})};return me(async()=>{if(Array.isArray(l.params.collectionId)?y=Number(l.params.collectionId[0]):y=Number(l.params.collectionId),!y){await Z.push({name:"problem-collection-list"});return}f.value=!1,_.value=!0;const C=await ls(y);if(C.code!==0){_.value=!1,F(n,C.code),await Z.push({name:"problem-collection-list"});return}f.value=C.data.joined,T=C.data.attempt_status||{},x.value=Bt(C.data.collection),g.value=[],C.data.collection.problems&&C.data.collection.problems.forEach(c=>{const r=C.data.problems.find(A=>A.id===c);g.value.push(r)}),u.setTitle(x.value.title+" - "+u.getTitle),_.value=!1}),(C,c)=>{const r=ba,A=ga,I=ze,h=be,U=xe,P=G,w=we,j=Je,$=We,D=Me("md-preview"),S=Pe,M=Ve;return L(),E(M,{loading:_.value},{default:a(()=>[t(S,{class:"dida-main-content"},{default:a(()=>[t(U,{span:6},{default:a(()=>[z("div",fs,[t(A,{"max-item-width":"300"},{default:a(()=>[t(r,{to:{name:"problem-collection-list"}},{default:a(()=>c[0]||(c[0]=[V("题目集合")])),_:1}),t(r,null,{default:a(()=>{var R;return[V(q((R=x.value)==null?void 0:R.title),1)]}),_:1})]),_:1})]),t(h,{style:{margin:"10px"}},{default:a(()=>[t(I,{data:g.value,columns:b.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),_:1})]),_:1}),t(U,{span:6},{default:a(()=>{var R;return[z("div",vs,[t(w,null,{default:a(()=>[f.value?(L(),E(P,{key:0,onClick:m,loading:o.value},{default:a(()=>c[1]||(c[1]=[V("退出")])),_:1},8,["loading"])):(L(),E(P,{key:1,onClick:i,loading:o.value},{default:a(()=>c[2]||(c[2]=[V("加入")])),_:1},8,["loading"])),p.value?(L(),E(P,{key:2,onClick:v},{default:a(()=>c[3]||(c[3]=[V("编辑")])),_:1})):le("",!0)]),_:1})]),z("div",_s,[t($,{layout:"vertical",bordered:!0},{default:a(()=>[t(j,{label:"创建者"},{default:a(()=>{var N;return[V(q((N=x.value)==null?void 0:N.ownerNickname),1)]}),_:1})]),_:1}),t($,{layout:"vertical",bordered:!0},{default:a(()=>[t(j,{label:"开始时间"},{default:a(()=>{var N;return[V(q((N=x.value)==null?void 0:N.startTime),1)]}),_:1})]),_:1}),t($,{layout:"vertical",bordered:!0},{default:a(()=>[t(j,{label:"结束时间"},{default:a(()=>{var N;return[V(q((N=x.value)==null?void 0:N.endTime),1)]}),_:1})]),_:1})]),(R=x.value)!=null&&R.description?(L(),E(h,{key:0,style:{margin:"10px"}},{default:a(()=>{var N;return[t(D,{"model-value":(N=x.value)==null?void 0:N.description},null,8,["model-value"])]}),_:1})):le("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),bs=ce(gs,[["__scopeId","data-v-042bd4bb"]]),hs=ie({__name:"CollectionRank",setup(e){const l=ke(),n=Be(),{globalProperties:u}=fe();let s=null,y=0,_=0;const x=d([{title:"Rank",colKey:"rank",align:"center"},{title:"序号",colKey:"index",align:"center"},{title:"Username",colKey:"username",cell:(k,b)=>t(G,{variant:"text",onClick:()=>n.push({name:"user",params:{username:b.row.username}})},{default:()=>[b.row.username]})},{title:"昵称",colKey:"nickname",cell:(k,b)=>t(G,{variant:"text",onClick:()=>n.push({name:"user",params:{username:b.row.username}})},{default:()=>[b.row.nickname]})},{title:"Count",colKey:"count",cell:(k,b)=>t(G,{variant:"text",onClick:()=>n.push({name:"judge-list",query:{username:b.row.username,status:Fe.Accept}})},{default:()=>[`${b.row.accept} / ${_}`]})},{title:"Progress",colKey:"progress",cell:(k,b)=>{let g=100;return _>0&&(g=Number((b.row.accept/_*100).toFixed(2))),t(Et,{percentage:g},null)}}]),f=d(!1),o=d([]),T=({col:k,rowIndex:b})=>{let g=1;for(let i=b+1;i<o.value.length&&o.value[i].rank===o.value[b].rank;i++)g++;if(k.colKey==="rank")return{rowspan:g}},p=async k=>{f.value=!0;try{const b=await ss(y);if(o.value=[],b.code===0){_=b.data.problem;const g=b.data.ranks,i=[];if(g){for(let C=0;C<g.length;C++){const c=g[C];let r={userId:c.author_id,username:c.author_username,nickname:c.author_nickname};r.accept=c.accept,i.push(r)}i.sort((C,c)=>C.accept!==c.accept?c.accept-C.accept:C.userId-c.userId);let m=0,v=-1;for(let C=0;C<i.length;C++)i[C].accept!==v&&(m=C+1,v=i[C].accept),i[C].index=C+1,i[C].rank=m}o.value=i}else k&&F(u,b.code)}catch(b){console.error(b),F(u,Ke())}finally{f.value=!1}};return me(async()=>{s=Le(()=>l.query,async()=>{if(Array.isArray(l.params.collectionId)?y=Number(l.params.collectionId[0]):y=Number(l.params.collectionId),!y){await n.push({name:"problem-collection-list"});return}await p(!0)},{immediate:!0})}),Te(()=>{s&&s()}),(k,b)=>{const g=ze,i=be,m=Pe;return L(),E(m,null,{default:a(()=>[t(i,{style:{margin:"10px"}},{default:a(()=>[z("div",null,[t(g,{data:o.value,columns:x.value,"row-key":"index","rowspan-and-colspan":T,"vertical-align":"middle",bordered:!0,hover:!0,loading:f.value},null,8,["data","columns","loading"])])]),_:1})]),_:1})}}});var Re=(e=>(e[e.Valid=0]="Valid",e[e.Duplicate=1]="Duplicate",e[e.Invalid=2]="Invalid",e))(Re||{});const ys={class:"dida-form-border"},ws={style:{"text-align":"right"}},ks=ie({name:"ParseProblemList",__name:"ParseProblemList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:l}=fe(),n=d(!1),u=d(!1),s=d(""),y=fa(e,"modelValue");let _=[];Le(y,async k=>{JSON.stringify(k)!==JSON.stringify(_)&&(await o(k),_=y.value)},{deep:!0});const x=d([]),f=d([{title:"有效性",colKey:"validType",cell:(k,b)=>{switch(b.row.valid){case Re.Valid:return t(tt,{theme:"success"},{default:()=>[V("有效")]});case Re.Duplicate:return t(tt,{theme:"warning"},{default:()=>[V("重复")]});case Re.Invalid:return t(tt,{theme:"danger"},{default:()=>[V("无效")]});default:return null}}},{title:"问题ID",colKey:"id"},{title:"标题",colKey:"title"}]),o=async k=>{const b=Array.from(new Set(k)),g=await Sn(b);if(g.code!==0){F(l,g.code),u.value=!1;return}const i=[],m=g.data.problems;let v=[];k.forEach(C=>{const c=m.find(r=>r.id===C);if(c){const r=i.find(A=>A.id===C);c.valid=r?Re.Duplicate:Re.Valid,i.push({id:C,title:c.title,valid:c.valid}),r||v.push(C)}else i.push({id:C,title:"-",valid:Re.Invalid})}),x.value=i,_=v,y.value=v},T=async()=>{u.value=!0;const k=wa(s.value);await o(k),n.value=!1,u.value=!1},p=()=>{x.value?s.value=x.value.map(k=>k.id).join(`
`):s.value="",n.value=!0};return(k,b)=>{const g=G,i=ze,m=Pt,v=lt;return L(),ae(ue,null,[z("div",ys,[z("div",ws,[t(g,{onClick:p},{default:a(()=>b[2]||(b[2]=[V("编辑")])),_:1})]),t(i,{data:x.value,columns:f.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(v,{visible:n.value,"onUpdate:visible":b[1]||(b[1]=C=>n.value=C),onConfirm:T,header:"请输入问题ID","confirm-loading":u.value},{default:a(()=>[b[3]||(b[3]=z("div",{style:{"margin-bottom":"10px"}},[z("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(m,{modelValue:s.value,"onUpdate:modelValue":b[0]||(b[0]=C=>s.value=C),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Ua=ce(ks,[["__scopeId","data-v-7f4ce589"]]),Cs={class:"dida-form-border"},Ss={style:{"text-align":"right"}},Is=ie({name:"ParseUserList",__name:"ParseUserList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:l}=fe(),n=d(!1),u=d(!1),s=d(""),y=fa(e,"modelValue");let _=[];Le(y,async g=>{JSON.stringify(g)!==JSON.stringify(_)&&(_=g,await T(g))},{deep:!0});const x=d(),f=d([{title:"有效性",colKey:"validType",cell:(g,i)=>{switch(i.row.valid){case Re.Valid:return t(tt,{theme:"success"},{default:()=>[V("有效")]});case Re.Duplicate:return t(tt,{theme:"warning"},{default:()=>[V("重复")]});case Re.Invalid:return t(tt,{theme:"danger"},{default:()=>[V("无效")]})}}},{title:"Username",colKey:"username"},{title:"昵称",colKey:"nickname"}]),o=(g,i)=>{if(g.code!==0){F(l,g.code),u.value=!1;return}const m=[],v=g.data.users;let C=[];i?i.forEach(c=>{let r=null;if(v&&(r=v.find(A=>A.username.toLowerCase()===c.toLowerCase())),r){const A=m.find(h=>h.username.toLowerCase()===c.toLowerCase()),I=A?Re.Duplicate:Re.Valid;m.push({id:r.id,username:r.username,nickname:r.nickname,valid:I}),A||C.push(r.id)}else m.push({id:-1,username:c,nickname:"-",valid:Re.Invalid})}):v&&v.forEach(c=>{const r=m.find(I=>I.id===c.id),A=r?Re.Duplicate:Re.Valid;m.push({id:c.id,username:c.username,nickname:c.nickname,valid:A}),r||C.push(c.id)}),x.value=m,_=C,y.value=C},T=async g=>{const i=Array.from(new Set(g)),m=await An(i);o(m)},p=async g=>{const i=Array.from(new Set(g)),m=await Rn(i);o(m,g)},k=async()=>{u.value=!0;const g=wa(s.value);await p(g),n.value=!1,u.value=!1},b=()=>{x.value?s.value=x.value.map(g=>g.username).join(`
`):s.value="",n.value=!0};return(g,i)=>{const m=G,v=ze,C=Pt,c=lt;return L(),ae(ue,null,[z("div",Cs,[z("div",Ss,[t(m,{onClick:b},{default:a(()=>i[2]||(i[2]=[V("编辑")])),_:1})]),t(v,{data:x.value,columns:f.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(c,{visible:n.value,"onUpdate:visible":i[1]||(i[1]=r=>n.value=r),onConfirm:k,header:"请输入用户Username","confirm-loading":u.value},{default:a(()=>[i[3]||(i[3]=z("div",{style:{"margin-bottom":"10px"}},[z("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(C,{modelValue:s.value,"onUpdate:modelValue":i[0]||(i[0]=r=>s.value=r),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),$a=ce(Is,[["__scopeId","data-v-d2170a86"]]),Ps={style:{margin:"10px"}},xs={style:{margin:"12px"}},Vs={class:"dida-edit-container"},Ts=ie({__name:"CollectionEdit",setup(e){let l=ke();const{globalProperties:n}=fe(),u=Ye(),s=d(""),y=d(!1),_=d(!1),x=d(!1),f=d(null),o=d({title:"",openTime:[],private:!0,problems:[],members:[],description:""}),T=d(""),p=d(""),k=d(!1),b=async()=>{k.value=!0,x.value=!1,k.value=!1},g=async()=>{_.value=!0;try{const c={title:o.value.title,problems:o.value.problems,members:o.value.members,private:o.value.private,description:o.value.description};o.value.openTime[0]&&(c.start_time=new Date(o.value.openTime[0])),o.value.openTime[1]&&(c.end_time=new Date(o.value.openTime[1]));const r=await rs(c);if(r.code!==0){F(n,r.code);return}r.data!=null&&await Z.push({name:"collection-detail",params:{collectionId:r.data}}),He(n,"创建成功")}finally{_.value=!1}},i=async()=>{_.value=!0;try{const c={id:Number(s.value),title:o.value.title,private:o.value.private,problems:o.value.problems,members:o.value.members,description:o.value.description};o.value.openTime[0]&&(c.start_time=new Date(o.value.openTime[0])),o.value.openTime[1]&&(c.end_time=new Date(o.value.openTime[1]));const r=await us(c);if(r.code!==0){F(n,r.code);return}r.data!=null&&f.value&&(f.value.updateTime=new Date(r.data).toLocaleString()),He(n,"保存成功")}finally{_.value=!1}},m=c=>{o.value.description=c,y.value=!1};async function v(c,r){_.value=!0,_e(n,"本界面暂不支持上传图片"),_.value=!1}const C=async()=>{const c=await ns(s.value);if(c.code!==0){F(n,c.code),console.error("collection get failed",c.code),await Z.push({name:"problem-collection-list"});return}const r=c.data.collection;f.value=Bt(r),o.value.title=r.title,o.value.openTime=[],r.start_time?o.value.openTime.push(new Date(r.start_time)):o.value.openTime.push(""),r.end_time?o.value.openTime.push(new Date(r.end_time)):o.value.openTime.push(""),o.value.private=r.private,o.value.description=r.description,o.value.problems=r.problems,o.value.members=r.members,u.setTitle(r.title+" - "+u.getTitle);let A="";r.description&&(A=r.description),m(A)};return me(async()=>{Array.isArray(l.params.collectionId)?s.value=l.params.collectionId[0]:s.value=l.params.collectionId,s.value?(y.value=!0,await C()):m("")}),(c,r)=>{const A=$e,I=Ue,h=Kt,U=ft,P=je,w=be,j=xe,$=G,D=we,S=Je,M=We,R=Pe,N=Me("md-editor-v3"),X=Ve,oe=Pt,te=lt;return L(),ae(ue,null,[t(X,{loading:y.value},{default:a(()=>[t(R,null,{default:a(()=>[t(j,{span:8},{default:a(()=>[z("div",Ps,[t(w,{class:"sh-card"},{default:a(()=>[t(P,{model:o.value},{default:a(()=>[t(I,{label:"标题"},{default:a(()=>[t(A,{modelValue:o.value.title,"onUpdate:modelValue":r[0]||(r[0]=ee=>o.value.title=ee),placeholder:"题集标题"},null,8,["modelValue"])]),_:1}),t(I,{label:"开启时间"},{default:a(()=>[t(h,{modelValue:o.value.openTime,"onUpdate:modelValue":r[1]||(r[1]=ee=>o.value.openTime=ee),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(I,{label:"私有"},{default:a(()=>[t(U,{modelValue:o.value.private,"onUpdate:modelValue":r[2]||(r[2]=ee=>o.value.private=ee)},null,8,["modelValue"])]),_:1}),t(I,{label:"成员"},{default:a(()=>[t($a,{modelValue:o.value.members,"onUpdate:modelValue":r[3]||(r[3]=ee=>o.value.members=ee)},null,8,["modelValue"])]),_:1}),t(I,{label:"问题"},{default:a(()=>[t(Ua,{modelValue:o.value.problems,"onUpdate:modelValue":r[4]||(r[4]=ee=>o.value.problems=ee)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(j,{span:4},{default:a(()=>[z("div",xs,[z("div",Vs,[s.value?(L(),E(D,{key:0},{default:a(()=>[t($,{onClick:i,theme:"danger",loading:_.value},{default:a(()=>r[8]||(r[8]=[V("保存")])),_:1},8,["loading"])]),_:1})):(L(),E(D,{key:1},{default:a(()=>[t($,{onClick:g,theme:"danger",loading:_.value},{default:a(()=>r[9]||(r[9]=[V("创建")])),_:1},8,["loading"])]),_:1}))]),s.value?(L(),E(M,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(S,{label:"创建时间"},{default:a(()=>{var ee;return[V(q((ee=f.value)==null?void 0:ee.createTime),1)]}),_:1}),t(S,{label:"更新时间"},{default:a(()=>{var ee;return[V(q((ee=f.value)==null?void 0:ee.updateTime),1)]}),_:1}),t(S,{label:"创建用户"},{default:a(()=>{var ee;return[V(q((ee=f.value)==null?void 0:ee.ownerNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),t(N,{id:"collection-description-editor",modelValue:o.value.description,"onUpdate:modelValue":r[5]||(r[5]=ee=>o.value.description=ee),onSave:i,onOnUploadImg:v,previewTheme:"cyanosis",class:"dida-description-editor"},null,8,["modelValue"]),t(X,{loading:_.value,attach:"#collection-description-editor","z-index":1e5},null,8,["loading"])]),_:1},8,["loading"]),t(te,{visible:x.value,"onUpdate:visible":r[7]||(r[7]=ee=>x.value=ee),onConfirm:b,header:T.value,"confirm-loading":k.value},{default:a(()=>[r[10]||(r[10]=z("div",{style:{"margin-bottom":"10px"}},[z("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(oe,{modelValue:p.value,"onUpdate:modelValue":r[6]||(r[6]=ee=>p.value=ee),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),aa=ce(Ts,[["__scopeId","data-v-2a875f8a"]]);function la(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const Ds=ie({__name:"JudgeJobList",setup(e){const l=ke(),n=Be(),{globalProperties:u}=fe();let s=!1,y=null,_;const x=d(!1),f=d(null),o=d(!1);let T=-1;const p=d({problemId:"",username:"",language:void 0,status:void 0}),k=d([{title:"ID",colKey:"id",cell:(D,S)=>{let M=null;return kt(S.row.status)&&wt(S.row.language)&&(M=()=>{h(S.row.id)}),t(G,{variant:"text",onClick:M},{default:()=>[S.row.id]})}},{title:"问题",colKey:"problemId",cell:(D,S)=>{if(T){let M;return t(G,{variant:"text",onClick:()=>I(T,S.row.contestProblemIndex)},la(M=at(S.row.contestProblemIndex))?M:{default:()=>[M]})}return t(G,{variant:"text",onClick:()=>A(S.row.problemId)},{default:()=>[S.row.problemId]})}},{title:"状态",colKey:"status",align:"center",cell:(D,S)=>{let M=null;kt(S.row.status)&&wt(S.row.language)&&(M=()=>{h(S.row.id)});const R=S.row.status,N=St(R);let X=!kt(R);const oe=Sa(R);let te=[];return ut(R)&&te.push(t(Ve,{text:S.row.state,size:"small",class:"dida-status-loading"},null)),te.push(t("span",null,[N])),t(G,{theme:oe,variant:"outline",onClick:M,disabled:X},la(te)?te:{default:()=>[te]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"code",cell:(D,S)=>{let M=!wt(S.row.language);return t(G,{theme:"default",onClick:()=>r(S.row),disabled:M},{default:()=>[Ct(S.row.language)+" / "+S.row.codeLength]})}},{title:"作者",colKey:"author",width:200,cell:(D,S)=>t(G,{variant:"text",onClick:()=>U(S.row.authorUsername)},{default:()=>[S.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),b=d(!1);let g=1,i=50;const m=d({current:g,pageSize:i,defaultCurrent:g,defaultPageSize:i,total:0,pageSizeOptions:[50,100]}),v=d(),C=d([]);C.value=Ft();const c=d([]);c.value=Ia();const r=async D=>{o.value=!0,x.value=!0;try{f.value=D;const S=await tn(Number(f.value.id));if(S.code===0){const M=S.data,R=Ot(M.language);f.value.code=`\`\`\`${R}
${M.code}
\`\`\``}else F(u,S.code)}finally{o.value=!1}},A=D=>{D&&n.push({path:"/problem/"+D})},I=(D,S)=>{n.push({name:"contest-problem-detail",params:{contestId:D,problemIndex:S}})},h=D=>{D&&(T>0?n.push({name:"contest-judge-detail",params:{contestId:T,judgeId:D}}):n.push({name:"judge-detail",params:{judgeId:D}}))},U=D=>{D&&n.push({path:"/user/"+D})},P=async()=>{await n.push({query:{...l.query,page:1,page_size:i,problem_id:p.value.problemId,username:p.value.username,language:p.value.language,status:p.value.status}})},w=async()=>{p.value.problemId="",p.value.username="",p.value.language=void 0,p.value.status=void 0,await n.push({query:{...l.query,page:1,page_size:i,problem_id:"",username:"",language:void 0,status:void 0}})},j=async(D,S)=>{S&&(b.value=!0);let M=!1;try{const{current:R,pageSize:N}=D,X=await an(T,p.value.problemId,p.value.username,p.value.language,p.value.status,R,N);if(v.value=[],X.code===0){if(!X.data.has_auth){he(u,"您目前没有权限查看评测记录"),T?await n.push({name:"contest-detail",params:{contestId:T}}):await n.push({name:"judge-list"});return}X.data.list&&X.data.list.length>0?(X.data.list.forEach(te=>{var O;const ee=Pa(te);(O=v.value)==null||O.push(ee),ut(te.status)&&(M=!0)}),m.value={...m.value,total:X.data.total_count}):(he(u,"未找到记录"),m.value={...m.value,total:0})}else S&&F(u,X.code)}catch(R){console.error(R),S&&F(u,Ke())}finally{S&&(b.value=!1),M&&s&&(_=setTimeout(()=>{j({current:g,pageSize:i},!1)},5e3))}},$=async D=>{await n.push({query:{...l.query,page:D.current,page_size:D.pageSize}})};return me(async()=>{s=!0,y=Le(()=>l.query,D=>{Array.isArray(l.params.contestId)?T=Number(l.params.contestId[0]):T=Number(l.params.contestId),p.value.problemId=D.problem_id||"",p.value.username=D.username||"",D.language!=null?p.value.language=Number(D.language):p.value.language=void 0,D.status!=null?p.value.status=Number(D.status):p.value.status=void 0;const S=parseInt(D.page)||m.value.defaultCurrent,M=parseInt(D.page_size)||m.value.defaultPageSize;g=S,i=M,m.value.pageSizeOptions.includes(i)||(i=m.value.defaultPageSize),m.value={...m.value,current:g,pageSize:i},j({current:g,pageSize:i},!0)},{immediate:!0})}),Te(()=>{s=!1,y&&y(),clearTimeout(_)}),(D,S)=>{const M=$e,R=Ue,N=qt,X=pt,oe=G,te=we,ee=je,O=ze,de=be,Q=nt,W=Me("md-preview"),H=Ve,se=lt;return L(),ae(ue,null,[t(de,{style:{margin:"10px"}},{default:a(()=>[t(ee,{layout:"inline",onSubmit:P,onReset:w},{default:a(()=>[t(R,{label:"题号"},{default:a(()=>[t(M,{modelValue:p.value.problemId,"onUpdate:modelValue":S[0]||(S[0]=K=>p.value.problemId=K),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(R,{label:"用户"},{default:a(()=>[t(M,{modelValue:p.value.username,"onUpdate:modelValue":S[1]||(S[1]=K=>p.value.username=K),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(R,{label:"语言"},{default:a(()=>[t(X,{modelValue:p.value.language,"onUpdate:modelValue":S[2]||(S[2]=K=>p.value.language=K),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:a(()=>[(L(!0),ae(ue,null,Se(C.value,K=>(L(),E(N,{key:K.value,value:K.value,label:K.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(R,{label:"状态"},{default:a(()=>[t(X,{modelValue:p.value.status,"onUpdate:modelValue":S[3]||(S[3]=K=>p.value.status=K),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:a(()=>[(L(!0),ae(ue,null,Se(c.value,K=>(L(),E(N,{key:K.value,value:K.value,label:K.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(R,null,{default:a(()=>[t(te,null,{default:a(()=>[t(oe,{theme:"primary",type:"submit"},{default:a(()=>S[7]||(S[7]=[V("搜索")])),_:1}),t(oe,{theme:"default",variant:"base",type:"reset"},{default:a(()=>S[8]||(S[8]=[V("重置")])),_:1})]),_:1})]),_:1})]),_:1}),t(O,{data:v.value,columns:k.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:m.value,loading:b.value,onPageChange:$,"table-layout":"auto"},null,8,["data","columns","pagination","loading"])]),_:1}),t(se,{visible:x.value,"onUpdate:visible":S[5]||(S[5]=K=>x.value=K),width:"800px","cancel-btn":null,"close-btn":!1,onConfirm:S[6]||(S[6]=K=>x.value=!1)},{header:a(()=>[t(Q,{onClick:S[4]||(S[4]=()=>{var K;h((K=f.value)==null?void 0:K.id)})},{default:a(()=>{var K,B,re;return[V(q(((K=f.value)==null?void 0:K.id)+" - "+pe(Ct)((B=f.value)!=null&&B.language?(re=f.value)==null?void 0:re.language:pe(Dt).Unknown)),1)]}),_:1})]),default:a(()=>[t(H,{loading:o.value},{default:a(()=>{var K;return[t(W,{"model-value":(K=f.value)==null?void 0:K.code,"code-foldable":!1,style:{"min-height":"100px"}},null,8,["model-value"])]}),_:1},8,["loading"])]),_:1},8,["visible"])],64)}}}),na=ce(Ds,[["__scopeId","data-v-05589c5c"]]),Ls={class:"dida-code-container"},js={key:2,class:"dida-edit-container"};function oa(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const Us=ie({__name:"JudgeJobDetail",setup(e){const l=ke(),n=Be(),u=Ee(),{globalProperties:s}=fe();let y=!1,_,x=0,f=0;const o=d(""),T=d(null),p=d(""),k=d(0),b=d(null),g=d({from:"#5a96ff",to:"#00A870"}),i=d([{title:"ID",colKey:"id"},{title:"问题",colKey:"problemId",cell:(P,w)=>t(G,{variant:"text",onClick:()=>A(w.row.problemId)},{default:()=>[w.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(P,w)=>{const j=w.row.status,$=St(j),D=Sa(j);let S=[];return ut(j)&&S.push(t(Ve,{text:w.row.state,size:"small",class:"dida-status-loading"},null)),S.push(t("span",null,[$])),t(G,{theme:D,variant:"outline"},oa(S)?S:{default:()=>[S]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"language",cell:(P,w)=>t("span",null,[Ct(w.row.language)+" / "+w.row.codeLength])},{title:"作者",colKey:"author",width:200,cell:(P,w)=>t(G,{variant:"text",onClick:()=>I(w.row.authorUsername)},{default:()=>[w.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),m=d(!1),v=d(!1),C=d(),c=Ge(()=>u.hasAuth(De.ManageJudge)),r=async()=>{if(!v.value){v.value=!0;try{const P=await rn(x);P.code===0?await U(!0):F(s,P.code)}catch(P){console.error(P),F(s,Ke())}finally{v.value=!1}}},A=P=>{P&&n.push({path:"/problem/"+P})},I=P=>{P&&n.push({path:"/user/"+P})},h=P=>{const w=P.status,j=St(w);let $;switch(w){case Fe.Init:case Fe.Rejudge:case Fe.Compiling:case Fe.Running:$="default";break;case Fe.Accept:$="success";break;case Fe.PE:$="warning";break;default:$="danger";break}return t(we,null,{default:()=>[t(G,{theme:"default",variant:"outline"},{default:()=>[P.taskId]}),t(G,{theme:$,variant:"outline"},oa(j)?j:{default:()=>[j]}),t("span",null,[V("分数："),P.score]),t("span",null,[V("用时："),P.time]),t("span",null,[V("内存："),P.memory])]})},U=async P=>{var j;P&&(m.value=!0);let w=!1;try{const $=await en(x);if(C.value=[],$.code===0){const D=$.data,S=Pa(D);if((j=C.value)==null||j.push(S),o.value=S.judgerName,g.value.to="#00A870",ut(D.status)?(b.value="active",S.taskTotal>0?(k.value=Number((S.taskCurrent/S.taskTotal*100).toFixed(2)),S.taskCurrent>=S.taskTotal&&(k.value=99)):k.value=0):(k.value=100,D.status===Fe.Accept?b.value="success":D.status===Fe.PE?(g.value.to="#F57C20",b.value="warning"):(g.value.to="#F56C6C",b.value="error")),D.code){const M=Ot(D.language);p.value=`\`\`\`${M}
${D.code}
\`\`\``}T.value=S,ut(D.status)&&(w=!0)}else P&&F(s,$.code),f?await n.push({name:"contest-judge",params:{contestId:f}}):await n.push({name:"judge-list"})}catch($){console.error($),P&&F(s,Ke())}finally{P&&(m.value=!1),w&&y&&(_=setTimeout(()=>{U(!1)},5e3))}};return me(async()=>{if(y=!0,Array.isArray(l.params.judgeId)?x=Number(l.params.judgeId[0]):x=Number(l.params.judgeId),Array.isArray(l.params.contestId)?f=Number(l.params.contestId[0]):f=Number(l.params.contestId),!x){await n.push({name:"judge"});return}await U(!0)}),Te(()=>{y=!1,clearTimeout(_)}),(P,w)=>{var O,de,Q;const j=Et,$=ze,D=be,S=Me("md-preview"),M=xe,R=Je,N=We,X=Pe,oe=wl,te=kl,ee=G;return L(),ae(ue,null,[t(j,{color:g.value,status:b.value,class:"dida-job-progress",percentage:k.value},null,8,["color","status","percentage"]),t(D,{style:{margin:"10px"}},{default:a(()=>[t($,{data:C.value,columns:i.value,"row-key":"id","vertical-align":"top",hover:!0,loading:m.value},null,8,["data","columns","loading"])]),_:1}),t(X,null,{default:a(()=>[t(M,{span:8},{default:a(()=>[z("div",Ls,[t(S,{"model-value":p.value,class:"dida-code-div"},null,8,["model-value"])])]),_:1}),t(M,{span:4},{default:a(()=>[t(N,{layout:"vertical",bordered:!0,style:{margin:"20px"}},{default:a(()=>[t(R,{label:"判题机"},{default:a(()=>[V(q(o.value),1)]),_:1}),t(R,{label:"判题时间"},{default:a(()=>{var W;return[V(q((W=T.value)==null?void 0:W.judgeTime),1)]}),_:1})]),_:1})]),_:1})]),_:1}),(O=T.value)!=null&&O.compileMessage?(L(),E(D,{key:0,class:"compile-message"},{default:a(()=>{var W;return[V(q((W=T.value)==null?void 0:W.compileMessage),1)]}),_:1})):le("",!0),(de=T.value)!=null&&de.task&&((Q=T.value)==null?void 0:Q.task.length)>0?(L(),E(te,{key:1,class:"task-panel"},{default:a(()=>{var W;return[(L(!0),ae(ue,null,Se((W=T.value)==null?void 0:W.task,(H,se)=>(L(),E(oe,{key:H.taskId,header:()=>h(H)},{default:a(()=>[V(q(H.content)+" "+q(H.waHint),1)]),_:2},1032,["header"]))),128))]}),_:1})):le("",!0),c.value?(L(),ae("div",js,[t(ee,{onClick:r,loading:v.value},{default:a(()=>w[0]||(w[0]=[V("重新评测")])),_:1},8,["loading"])])):le("",!0)],64)}}}),sa=ce(Us,[["__scopeId","data-v-d2032dd0"]]),$s={style:{margin:"10px"}},zs=ie({__name:"ContestList",setup(e){const l=ke(),n=Be(),{globalProperties:u}=fe();let s=null;const y=d([{title:"ID",colKey:"id",cell:(v,C)=>t(G,{variant:"text",onClick:()=>k(C.row.id)},{default:()=>[C.row.id]})},{title:"标题",colKey:"title",cell:(v,C)=>t(G,{variant:"text",onClick:()=>k(C.row.id)},{default:()=>[C.row.title]})},{title:"负责人",colKey:"ownerNickname",cell:(v,C)=>t(G,{variant:"text",onClick:()=>Ht(n,C.row.ownerUsername)},{default:()=>[C.row.ownerNickname]})},{title:"权限",colKey:"private",cell:(v,C)=>C.row.private?"私有":"公开"},{title:"开始时间",colKey:"startTime"},{title:"结束时间",colKey:"endTime"}]),_=d(!1);let x=1,f=50;const o=d({current:x,pageSize:f,defaultCurrent:x,defaultPageSize:f,total:0,pageSizeOptions:[50,100]}),T=d(),p=d({title:"",username:""}),k=v=>{v&&n.push({path:"/contest/"+v})},b=async()=>{await n.push({query:{...l.query,title:p.value.title,username:p.value.username,page:1,page_size:o.value.defaultPageSize}})},g=async(v,C)=>{var c;_.value=!0;try{const{current:r,pageSize:A}=v,I=await fo(r,A);if(T.value=[],I.code===0){const h=I.data.list;for(let U=0;U<h.length;U++){const P=h[U],w=Nt(P);(c=T.value)==null||c.push(w)}o.value={...o.value,total:I.data.total_count}}else C&&F(u,I.code)}catch(r){console.error(r),F(u,Ke())}finally{_.value=!1}},i=async v=>{await n.push({query:{...l.query,page:v.current,page_size:v.pageSize}})},m=()=>{n.push({name:"contest-create"})};return me(async()=>{s=Le(()=>l.query,v=>{p.value.title=v.title||"",p.value.username=v.username||"";const C=parseInt(v.page)||o.value.defaultCurrent,c=parseInt(v.page_size)||o.value.defaultPageSize;x=C,f=c,o.value={...o.value,current:x,pageSize:f},g({current:x,pageSize:f},!0)},{immediate:!0})}),Te(()=>{s&&s()}),(v,C)=>{const c=ze,r=be,A=xe,I=$e,h=Ue,U=G,P=je,w=we,j=Pe;return L(),E(j,null,{default:a(()=>[t(A,{span:9},{default:a(()=>[t(r,{style:{margin:"10px"}},{default:a(()=>[t(c,{data:T.value,columns:y.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:o.value,loading:_.value,"table-layout":"auto",onPageChange:i,style:{"white-space":"nowrap"}},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(A,{span:3},{default:a(()=>[z("div",$s,[t(r,{class:"sh-card"},{default:a(()=>[t(P,{model:p.value},{default:a(()=>[t(h,{label:"标题"},{default:a(()=>[t(I,{modelValue:p.value.title,"onUpdate:modelValue":C[0]||(C[0]=$=>p.value.title=$),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(h,{label:"负责人"},{default:a(()=>[t(I,{modelValue:p.value.username,"onUpdate:modelValue":C[1]||(C[1]=$=>p.value.username=$),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(h,null,{default:a(()=>[t(U,{theme:"primary",onClick:b},{default:a(()=>C[2]||(C[2]=[V("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(r,{class:"sh-card"},{default:a(()=>[t(w,null,{default:a(()=>[t(U,{onClick:m},{default:a(()=>C[3]||(C[3]=[V("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),ra=ce(zs,[["__scopeId","data-v-ce6320bd"]]),As={style:{margin:"20px"}},Rs={style:{margin:"10px"}},Ms={style:{"text-align":"center","align-content":"center",padding:"20px",height:"500px"}},Es={style:{"text-align":"center",width:"100%"}},qs={class:"dida-operation-container"},Ks={style:{margin:"12px"}},Fs=ie({__name:"ContestDetail",setup(e){let l=ke();const{globalProperties:n}=fe(),u=Ye(),s=Ee(),y=d(!1);let _=0;const x=d(!1),f=d(null),o=d(!1),T=d(!1),p=d(""),k=Ge(()=>s.hasAuth(De.ManageContest)||f.value&&s.getUserId==f.value.ownerId),b=I=>{if(!I||!m)return"default";const h=m[I];if(!h)return"default";switch(h){case Oe.Accept:return"success";case Oe.Attempt:return"warning";default:return"default"}},g=d([{title:"问题ID",colKey:"index",cell:(I,h)=>{const U=b(h.row.index);return t(G,{variant:"dashed",theme:U,onClick:async()=>await Mt(_,h.row.index)},{default:()=>[h.row.id]})}},{title:"标题",colKey:"title",cell:(I,h)=>t(G,{variant:"text",onClick:async()=>await Mt(_,h.row.index)},{default:()=>[h.row.title]})},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),i=d([]);let m={},v=d(!1);const C=()=>{Z.push({name:"contest-edit",params:{contestId:_}})},c=async()=>{y.value=!0;try{const I=await ho(_);if(I.code!==0){F(n,I.code);return}const h=I.data;he(n,"查重报告已生成，请前往查看"),window.open(h,"_blank")}finally{y.value=!1}},r=async I=>{if(!s.isLogin()){await Z.push({name:"login"});return}if(!p.value){_e(n,"请输入密码");return}v.value=!0;try{const h=await bo(_,p.value);if(h.code!==0){F(n,h.code);return}he(n,"申请访问成功"),await A()}catch(h){console.error("Error submitting contest password:",h),F(n,"提交密码失败，请稍后再试")}finally{v.value=!1}},A=async()=>{x.value=!0;const I=await uo(_);if(I.code!==0){x.value=!1,F(n,I.code),await Z.push({name:"contest"});return}o.value=I.data.has_auth,T.value=I.data.need_password,f.value=Nt(I.data.contest),i.value=f.value.problems,m=I.data.attempt_status||{},u.setTitle(f.value.title+" - "+u.getTitle),x.value=!1};return me(async()=>{if(Array.isArray(l.params.contestId)?_=Number(l.params.contestId[0]):_=Number(l.params.contestId),!_){await Z.push({name:"contest"});return}await A()}),(I,h)=>{const U=It,P=ze,w=be,j=$e,$=Ue,D=G,S=je,M=xe,R=we,N=Je,X=We,oe=Me("md-preview"),te=Pe,ee=Ve;return L(),E(ee,{loading:x.value},{default:a(()=>[t(te,{class:"dida-main-content"},{default:a(()=>[t(M,{span:6},{default:a(()=>{var O,de,Q;return[z("div",As,[z("h1",null,q((O=f.value)==null?void 0:O.title),1),(de=f.value)!=null&&de.notification?(L(),E(U,{key:0,theme:"info",message:(Q=f.value)==null?void 0:Q.notification},null,8,["message"])):le("",!0)]),z("div",Rs,[o.value?(L(),E(w,{key:0},{default:a(()=>[t(P,{data:i.value,columns:g.value,"row-key":"id","table-layout":"auto","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1})):(L(),E(w,{key:1},{default:a(()=>[z("div",Ms,[t(U,{theme:"warning",message:"您没有查看本比赛的权限"}),T.value?(L(),E(S,{key:0,style:{margin:"20px auto 0",width:"200px"},onSubmit:r,"label-width":"0"},{default:a(()=>[t($,null,{default:a(()=>[t(j,{placeholder:"请输入密码",value:p.value,"onUpdate:value":h[0]||(h[0]=W=>p.value=W),style:{width:"300px"},type:"password",autocomplete:"new-password"},null,8,["value"])]),_:1}),t($,null,{default:a(()=>[z("div",Es,[t(D,{theme:"primary",type:"submit",loading:pe(v)},{default:a(()=>h[1]||(h[1]=[V("提交")])),_:1},8,["loading"])])]),_:1})]),_:1})):le("",!0)])]),_:1}))])]}),_:1}),t(M,{span:6},{default:a(()=>{var O;return[z("div",qs,[t(R,null,{default:a(()=>[k.value?(L(),E(D,{key:0,onClick:c,loading:y.value},{default:a(()=>h[2]||(h[2]=[V("查重")])),_:1},8,["loading"])):le("",!0),k.value?(L(),E(D,{key:1,onClick:C},{default:a(()=>h[3]||(h[3]=[V("编辑")])),_:1})):le("",!0)]),_:1})]),z("div",Ks,[t(X,{layout:"vertical",bordered:!0},{default:a(()=>[t(N,{label:"创建时间"},{default:a(()=>{var de;return[V(q((de=f.value)==null?void 0:de.createTime),1)]}),_:1})]),_:1}),t(X,{layout:"vertical",bordered:!0},{default:a(()=>[t(N,{label:"更新时间"},{default:a(()=>{var de;return[V(q((de=f.value)==null?void 0:de.updateTime),1)]}),_:1})]),_:1}),t(X,{layout:"vertical",bordered:!0},{default:a(()=>[t(N,{label:"开始时间"},{default:a(()=>{var de;return[V(q((de=f.value)==null?void 0:de.startTime),1)]}),_:1})]),_:1}),t(X,{layout:"vertical",bordered:!0},{default:a(()=>[t(N,{label:"结束时间"},{default:a(()=>{var de;return[V(q((de=f.value)==null?void 0:de.endTime),1)]}),_:1})]),_:1})]),(O=f.value)!=null&&O.description?(L(),E(w,{key:0,style:{margin:"12px"}},{default:a(()=>{var de;return[t(oe,{"model-value":(de=f.value)==null?void 0:de.description,class:"dida-content-description"},null,8,["model-value"])]}),_:1})):le("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),Os=ce(Fs,[["__scopeId","data-v-af022b1b"]]);function za(e){return e?Math.floor(e/1e9):0}function rt(e){if(e<=0)return"0秒";let l="";const n=Math.floor(e/3600);n>0&&(l+=`${n}小时`);const u=Math.floor(e%3600/60);return(u>0||n>0)&&(n>0&&u<10&&(l+="0"),l+=`${u}分钟`),e=e%60,(e>0||u>0||n>0)&&((n>0||u>0)&&e<10&&(l+="0"),l+=`${e.toFixed(0)}秒`),l}const Gs=mt("contest",{state:()=>({starMembers:{}}),actions:{clear(){this.$patch({starMembers:{}})},addStarMember(e,l){this.starMembers[e]||(this.starMembers[e]={}),this.starMembers[e][l]=!0},removeStarMember(e,l){this.starMembers[e]&&(delete this.starMembers[e][l],Object.keys(this.starMembers[e]).length===0&&delete this.starMembers[e])},isStarMember(e,l){var n;return!!((n=this.starMembers[e])!=null&&n[l])}},persist:!0}),Ns={style:{margin:"10px 10px 40px"}},Hs={style:{"text-align":"right","margin-bottom":"10px"}},Bs={class:"table-scroll-wrapper"};function ua(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const Ws=ie({__name:"ContestRank",setup(e){const l=ke(),n=Be(),u=Gs(),{globalProperties:s}=fe();let y=!1,_=null,x=0,f=null,o=null,T=0;const p=d(0),k=d(0),b=d(!1),g=d(!0),i=d(!0);let m=null,v=null,C=1,c=50;const r=d({current:C,pageSize:c,defaultCurrent:1,defaultPageSize:50,total:0,pageSizeOptions:[50,100,1e3]}),A=W=>u&&u.isStarMember(x,W),I=async W=>{r.value={...r.value,current:W.current,pageSize:W.pageSize},await n.push({query:{...l.query,page:W.current,page_size:W.pageSize}})},h=W=>{if(W==null)return"-";const H=Math.floor(W/3600).toString().padStart(2,"0"),se=Math.floor(W%3600/60).toString().padStart(2,"0"),K=(W%60).toFixed(0).toString().padStart(2,"0");return`${H}:${se}:${K}`},U=d({}),P=[{title:"Rank",colKey:"rank",align:"center",fixed:"left"},{title:"昵称",colKey:"nickname",fixed:"left",attrs:W=>{let H={};return A(W.row.userId)&&(H={backgroundColor:"rgba(255,165,30,0.5)"}),{style:H}},cell:(W,H)=>{const se=Rl(H.row.nickname,18);let K=null;return A(H.row.userId)?K=t(G,{shape:"circle",variant:"text",class:"rank-unstar-button",onClick:()=>{u.removeStarMember(x,H.row.userId),O()}},{default:()=>[t(Qa,{slot:"icon"},null)]}):K=t(G,{shape:"circle",variant:"text",class:"rank-star-button",onClick:()=>{u.addStarMember(x,H.row.userId),O()}},{default:()=>[t(el,{slot:"icon"},null)]}),t("div",{class:"rank-nickname-cell"},[t(we,null,{default:()=>[t(Sl,{content:H.row.nickname},{default:()=>[t(G,{variant:"text",onClick:()=>n.push({name:"user",params:{username:H.row.username}})},ua(se)?se:{default:()=>[se]})]}),K]})])}},{title:"Solved",colKey:"solved",align:"center",fixed:"left",cell:(W,H)=>t(G,{variant:"text",onClick:()=>n.push({name:"contest-judge",params:{contestId:x},query:{username:H.row.username,status:Fe.Accept}})},{default:()=>[H.row.solved]})},{title:"Penalty",colKey:"penalty",align:"center",fixed:"left",cell:(W,H)=>h(H.row.penalty)}],w=d([]),j=d(!1);let $=[],D=[];const S=d([]);let M=[];const R=({col:W,rowIndex:H})=>{if(W.colKey==="rank"){let se=r.value.current;r.value.current>Math.ceil(S.value.length/r.value.pageSize)&&(se=Math.ceil(S.value.length/r.value.pageSize));let K=r.value.pageSize*(se-1),B=1;for(let re=H+1;K+re<S.value.length&&S.value[K+re].rank===S.value[K+H].rank;re++)B++;return{rowspan:B}}},N=(W,{value:H})=>rt(H),X=()=>{m&&clearInterval(m),m=setInterval(()=>{y&&Q(!1)},3e4),v&&clearInterval(v),v=setInterval(()=>{if(!y)return;p.value=(new Date().getTime()-f.getTime())/1e3;const W=Math.min(p.value,k.value);p.value=Math.min(p.value,W),O()},1e3)},oe=()=>{m&&(clearInterval(m),m=null),v&&(clearInterval(v),v=null)},te=async W=>{i.value=W,W?(await Q(!1),X()):oe()},ee=()=>{O(),r.value={...r.value,current:1}},O=()=>{S.value=[];let W=[];for(let Y=0;Y<$.length;Y++){const ye=$[Y];let Ie={userId:ye.author_id,username:ye.author_username,nickname:ye.author_nickname},Ce=0,qe=0;ye.problems.forEach(Ne=>{let Xe=-1,et=Ne.lock||0;if(Ne.ac){if(Xe=(new Date(Ne.ac).getTime()-(f==null?void 0:f.getTime()))/1e3,Xe>p.value)return;Ce++,qe+=Xe,qe+=Ne.attempt*20*60}if(et>0&&T>0){const Lt=k.value-T;p.value<Lt&&(et=0)}const ot=Ne.index;Ie[`problem_${ot}`]={acDuration:Xe,attempt:Ne.attempt||0,lock:et}}),Ie.solved=Ce,Ie.penalty=qe,W.push(Ie)}W.sort((Y,ye)=>Y.solved!==ye.solved?ye.solved-Y.solved:Y.penalty!==ye.penalty?Y.penalty-ye.penalty:Y.userId-ye.userId);const H=D;let se=0,K=0,B=-1,re=-1;for(let Y=0;Y<W.length;Y++)H&&H.includes(W[Y].userId)?W[Y].rank="*":(K++,(W[Y].solved!==B||W[Y].penalty!==re)&&(se=K,B=W[Y].solved,re=W[Y].penalty),W[Y].rank=String(se));b.value&&(W=W.filter(Y=>A(Y.userId)));const ge=document.querySelectorAll("tbody tr"),ve={};M.forEach((Y,ye)=>{const Ie=ge[ye];Ie&&(ve[Y.userId]=Ie.getBoundingClientRect())}),r.value={...r.value,total:W.length},S.value=W;for(let Y=0;Y<S.value.length;Y++)S.value[Y].index=Y+1;if(M=[...S.value],g.value){const Y={},ye=document.querySelectorAll("table tbody tr");S.value.forEach((Ie,Ce)=>{const qe=ye[Ce];qe&&(Y[Ie.userId]=qe.getBoundingClientRect())}),requestAnimationFrame(()=>{const Ie=document.querySelectorAll("table tbody tr");S.value.forEach((Ce,qe)=>{const Ne=Ie[qe],Xe=ve[Ce.userId],et=Y[Ce.userId];if(Xe&&et){const ot=Xe.top-et.top;ot!==0&&(Ne.style.transition="none",Ne.style.transform=`translateY(${ot}px)`)}}),requestAnimationFrame(()=>{document.querySelectorAll("table tbody tr").forEach(qe=>{qe.style.transition="transform 300ms ease",qe.style.transform=""})})})}},de=W=>{te(!1),p.value=W;const H=Math.min(k.value,(new Date().getTime()-(f==null?void 0:f.getTime()))/1e3);p.value=Math.min(p.value,H),O()},Q=async W=>{W&&(j.value=!0);try{const H=await vo(x);if(w.value=[...P],$=[],D=[],S.value=[],r.value={...r.value,total:0},H.code===0){if(!H.data.has_auth){he(s,"您目前没有权限查看比赛排名"),await n.push({name:"contest-detail",params:{contestId:x}});return}H.data.problems.sort((B,re)=>B-re),H.data.problems.forEach((B,re)=>{w.value.push({colKey:`problem_${B}`,align:"center",title:()=>{let ge;return t(G,{variant:"text",onClick:()=>n.push({name:"contest-problem-detail",params:{contestId:x,problemIndex:B}})},ua(ge=at(B))?ge:{default:()=>[ge]})},cell:(ge,ve)=>{const Y=ve.row[`problem_${B}`];if(!Y)return"";let ye="";return Y.acDuration>=0&&(ye=h(Y.acDuration)),Y.attempt>0&&(ye&&(ye+=" "),ye+=`(-${Y.attempt})`),Y.lock>0&&(ye&&(ye+=" "),ye+=`(+${Y.lock})`),t("span",null,[ye])},attrs:ge=>{const ve=ge.row[`problem_${B}`];return ve?ve.acDuration>=0?{style:{backgroundColor:"rgba(130,255,30,0.5)"}}:ve.lock>0?{style:{backgroundColor:"rgb(255,180,50,0.5)"}}:ve.attempt>0?{style:{backgroundColor:"rgba(255,120,120,0.5)"}}:{}:{}}})});const se=H.data.contest;if(f=new Date(se.start_time),o=new Date(se.end_time),$=H.data.ranks,D=H.data.v_members||[],k.value=Math.floor((o.getTime()-f.getTime())/1e3),U.value={0:"0",[Math.floor(k.value/2)]:rt(Math.floor(k.value/2)),[k.value]:rt(k.value)},T=za(se.lock_rank_duration||0),H.data.is_locked&&T>0){const B=Math.max(0,k.value-T);U.value[B]=t("span",{style:"color: #0052d9"},[V("锁榜("),rt(B),V(")")])}p.value=Math.floor((new Date().getTime()-f.getTime())/1e3);const K=Math.min(p.value,k.value);p.value=Math.min(p.value,K),i.value=!0,X(),O()}else W&&F(s,H.code)}catch(H){console.error(H),W&&F(s,Ke())}finally{W&&(j.value=!1)}};return me(async()=>{y=!0,_=Le(()=>l.query,async W=>{if(Array.isArray(l.params.contestId)?x=Number(l.params.contestId[0]):x=Number(l.params.contestId),!x){await n.push({name:"contest"});return}const H=parseInt(W.page)||r.value.defaultCurrent,se=parseInt(W.page_size)||r.value.defaultPageSize;C=H,c=se,r.value={...r.value,current:C,pageSize:c},await Q(!0)},{immediate:!0})}),Te(()=>{y=!1,_&&_(),oe()}),(W,H)=>{const se=ft,K=we,B=Cl,re=ze,ge=be,ve=Pe;return L(),E(ve,null,{default:a(()=>[t(ge,{style:{margin:"10px",width:"100%"}},{default:a(()=>[z("div",Ns,[z("div",Hs,[t(K,null,{default:a(()=>[t(se,{size:"large",modelValue:b.value,"onUpdate:modelValue":H[0]||(H[0]=Y=>b.value=Y),onChange:ee},{label:a(Y=>[V(q(Y.value?"仅展示收藏":"未过滤收藏"),1)]),_:1},8,["modelValue"]),t(se,{size:"large",modelValue:g.value,"onUpdate:modelValue":H[1]||(H[1]=Y=>g.value=Y)},{label:a(Y=>[V(q(Y.value?"开启动画":"关闭动画"),1)]),_:1},8,["modelValue"]),t(se,{size:"large",modelValue:i.value,"onUpdate:modelValue":H[2]||(H[2]=Y=>i.value=Y),onChange:te},{label:a(Y=>[V(q(Y.value?"自动刷新":"关闭刷新"),1)]),_:1},8,["modelValue"])]),_:1})]),t(B,{modelValue:p.value,"onUpdate:modelValue":H[3]||(H[3]=Y=>p.value=Y),marks:U.value,max:k.value,label:N,"tooltip-props":{placement:"top"},"input-number-props":{theme:"column",autoWidth:!0,format:pe(rt),onChange:de},onChangeEnd:de},null,8,["modelValue","marks","max","input-number-props"])]),z("div",Bs,[t(re,{data:S.value,columns:w.value,"row-key":"index","vertical-align":"middle",bordered:!0,hover:!0,"table-layout":"auto","rowspan-and-colspan":R,loading:j.value,class:"dida-contest-rank-table",pagination:r.value,onPageChange:I},null,8,["data","columns","loading","pagination"])])]),_:1})]),_:1})}}}),Js=ce(Ws,[["__scopeId","data-v-838e6c28"]]),Ys={style:{margin:"10px"}},Xs={style:{margin:"12px"}},Zs={class:"dida-edit-container"},Qs=ie({__name:"ContestEdit",setup(e){let l=ke();const{globalProperties:n}=fe(),u=Ye(),s=d(0),y=d(!1),_=d(!1),x=d(!1),f=d(null),o=d({title:"",openTime:[],private:!0,password:"",problems:[],members:[],description:"",notification:"",lockRankDuration:0,alwaysLock:!0,submitAnytime:!1}),T=d(""),p=d(""),k=d(!1),b=async()=>{k.value=!0,x.value=!1,k.value=!1},g=async(c,r)=>{_.value=!0,await xt(c,r,n,()=>mo(s.value)),_.value=!1},i=async()=>{_.value=!0;try{const c={title:o.value.title,description:o.value.description,notification:o.value.notification,lock_rank_duration:o.value.lockRankDuration,always_lock:o.value.alwaysLock,problems:o.value.problems,members:o.value.members,private:o.value.private,password:o.value.password,submit_anytime:o.value.submitAnytime};o.value.openTime[0]&&(c.start_time=new Date(o.value.openTime[0])),o.value.openTime[1]&&(c.end_time=new Date(o.value.openTime[1]));const r=await _o(c);if(_.value=!0,r.code!==0){F(n,r.code);return}r.data!=null&&await Z.push({name:"contest-detail",params:{contestId:r.data}}),He(n,"创建成功")}finally{_.value=!1}},m=async()=>{_.value=!0;try{const c={id:Number(s.value),title:o.value.title,notification:o.value.notification,lock_rank_duration:o.value.lockRankDuration,always_lock:o.value.alwaysLock,problems:o.value.problems,members:o.value.members,private:o.value.private,password:o.value.password,submit_anytime:o.value.submitAnytime,description:o.value.description};o.value.openTime[0]&&(c.start_time=new Date(o.value.openTime[0])),o.value.openTime[1]&&(c.end_time=new Date(o.value.openTime[1]));const r=await go(c);if(_.value=!0,r.code!==0){F(n,r.code);return}r.data!=null&&f.value&&(f.value.updateTime=new Date(r.data).toLocaleString()),He(n,"保存成功")}finally{_.value=!1}},v=c=>{o.value.description=c,y.value=!1},C=async()=>{const c=await io(s.value);if(c.code!==0){F(n,c.code),console.error("contest get failed",c.code),await Z.push({name:"contest-list"});return}const r=c.data.contest;f.value=Nt(r),o.value.title=r.title,o.value.openTime=[],r.start_time?o.value.openTime.push(new Date(r.start_time)):o.value.openTime.push(""),r.end_time?o.value.openTime.push(new Date(r.end_time)):o.value.openTime.push(""),o.value.private=r.private,o.value.password=r.password||"",o.value.description=r.description||"",o.value.notification=r.notification||"",o.value.problems=c.data.problems,o.value.members=c.data.members,r.lock_rank_duration?o.value.lockRankDuration=za(r.lock_rank_duration):o.value.lockRankDuration=0,o.value.alwaysLock=r.always_lock,o.value.submitAnytime=r.submit_anytime,u.setTitle(r.title+" - "+u.getTitle);let A="";r.description&&(A=r.description),v(A)};return me(async()=>{Array.isArray(l.params.contestId)?s.value=Number(l.params.contestId[0]):s.value=Number(l.params.contestId),s.value?(y.value=!0,await C()):v("")}),(c,r)=>{const A=$e,I=Ue,h=Kt,U=ft,P=_a,w=je,j=be,$=xe,D=G,S=we,M=Je,R=We,N=Pe,X=Me("md-editor-v3"),oe=Ve,te=Pt,ee=lt;return L(),ae(ue,null,[t(oe,{loading:y.value},{default:a(()=>[t(N,null,{default:a(()=>[t($,{span:8},{default:a(()=>[z("div",Ys,[t(j,{class:"sh-card"},{default:a(()=>[t(w,{model:o.value,"label-width":"150px"},{default:a(()=>[t(I,{label:"标题"},{default:a(()=>[t(A,{modelValue:o.value.title,"onUpdate:modelValue":r[0]||(r[0]=O=>o.value.title=O),placeholder:"比赛标题"},null,8,["modelValue"])]),_:1}),t(I,{label:"通知"},{default:a(()=>[t(A,{modelValue:o.value.notification,"onUpdate:modelValue":r[1]||(r[1]=O=>o.value.notification=O),placeholder:"会更为醒目地提醒"},null,8,["modelValue"])]),_:1}),t(I,{label:"开启时间"},{default:a(()=>[t(h,{modelValue:o.value.openTime,"onUpdate:modelValue":r[2]||(r[2]=O=>o.value.openTime=O),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(I,{label:"提交限制"},{default:a(()=>[t(U,{modelValue:o.value.submitAnytime,"onUpdate:modelValue":r[3]||(r[3]=O=>o.value.submitAnytime=O)},{label:a(O=>[V(q(O.value?"结束仍能提交":"仅比赛期间提交"),1)]),_:1},8,["modelValue"])]),_:1}),t(I,{label:"锁榜时长"},{default:a(()=>[t(P,{modelValue:o.value.lockRankDuration,"onUpdate:modelValue":r[4]||(r[4]=O=>o.value.lockRankDuration=O),min:0,format:pe(rt),"auto-width":""},null,8,["modelValue","format"])]),_:1}),t(I,{label:"自动解锁"},{default:a(()=>[t(U,{modelValue:o.value.alwaysLock,"onUpdate:modelValue":r[5]||(r[5]=O=>o.value.alwaysLock=O)},{label:a(O=>[V(q(O.value?"结束后仍锁榜":"结束后解锁"),1)]),_:1},8,["modelValue"])]),_:1}),t(I,{label:"私有"},{default:a(()=>[t(U,{modelValue:o.value.private,"onUpdate:modelValue":r[6]||(r[6]=O=>o.value.private=O)},null,8,["modelValue"])]),_:1}),o.value.private?(L(),E(I,{key:0,label:"密码"},{default:a(()=>[t(A,{modelValue:o.value.password,"onUpdate:modelValue":r[7]||(r[7]=O=>o.value.password=O),type:"password",placeholder:"请输入访问密码，留空代表关闭密码访问"},null,8,["modelValue"])]),_:1})):le("",!0),o.value.private?(L(),E(I,{key:1,label:"成员"},{default:a(()=>[t($a,{modelValue:o.value.members,"onUpdate:modelValue":r[8]||(r[8]=O=>o.value.members=O)},null,8,["modelValue"])]),_:1})):le("",!0),t(I,{label:"问题"},{default:a(()=>[t(Ua,{modelValue:o.value.problems,"onUpdate:modelValue":r[9]||(r[9]=O=>o.value.problems=O)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t($,{span:4},{default:a(()=>[z("div",Xs,[z("div",Zs,[s.value?(L(),E(S,{key:0},{default:a(()=>[t(D,{onClick:m,theme:"danger",loading:_.value},{default:a(()=>r[13]||(r[13]=[V("保存")])),_:1},8,["loading"])]),_:1})):(L(),E(S,{key:1},{default:a(()=>[t(D,{onClick:i,theme:"danger",loading:_.value},{default:a(()=>r[14]||(r[14]=[V("创建")])),_:1},8,["loading"])]),_:1}))]),s.value?(L(),E(R,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(M,{label:"创建时间"},{default:a(()=>{var O;return[V(q((O=f.value)==null?void 0:O.createTime),1)]}),_:1}),t(M,{label:"更新时间"},{default:a(()=>{var O;return[V(q((O=f.value)==null?void 0:O.updateTime),1)]}),_:1}),t(M,{label:"创建用户"},{default:a(()=>{var O;return[V(q((O=f.value)==null?void 0:O.ownerNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),t(X,{id:"contest-description-editor",modelValue:o.value.description,"onUpdate:modelValue":r[10]||(r[10]=O=>o.value.description=O),onSave:m,onOnUploadImg:g,previewTheme:"cyanosis",class:"dida-description-editor"},null,8,["modelValue"]),t(oe,{loading:_.value,attach:"#contest-description-editor","z-index":1e5},null,8,["loading"])]),_:1},8,["loading"]),t(ee,{visible:x.value,"onUpdate:visible":r[12]||(r[12]=O=>x.value=O),onConfirm:b,header:T.value,"confirm-loading":k.value},{default:a(()=>[r[15]||(r[15]=z("div",{style:{"margin-bottom":"10px"}},[z("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(te,{modelValue:p.value,"onUpdate:modelValue":r[11]||(r[11]=O=>p.value=O),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),ia=ce(Qs,[["__scopeId","data-v-92131603"]]);function Aa(e){const l={};return l.id=e.id,l.authorId=e.author_id,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.title=e.title,l.content=e.content,e.insert_time&&(l.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(l.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(l.updateTime=new Date(e.update_time).toLocaleString()),l.problemId=e.problem_id,l.problemTitle=e.problem_title,l.contestId=e.contest_id,l.contestTitle=e.contest_title,l.contestProblemIndex=e.contest_problem_index,l}function er(e){const l={};return l.id=e.id,l.authorId=e.author_id,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.content="",e.content&&(l.content=e.content),e.insert_time&&(l.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(l.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(l.updateTime=new Date(e.update_time).toLocaleString()),l}function tr(e){return J({url:"/discuss?id="+e,method:"get"})}function ar(e,l,n,u,s,y){const _={};return e&&(_.contest_id=e),l&&(_.problem_id=l),n&&(_.title=n),u&&(_.username=u),s&&(_.page=s),y&&(_.page_size=y),J({url:`/discuss/list?${new URLSearchParams(_).toString()}`,method:"get"})}function lr(e,l,n){return J({url:"/discuss/comment/list?id="+e+"&page="+l+"&page_size="+n,method:"get"})}function nr(e){return J({url:"/discuss/create",method:"post",data:e})}const or={style:{margin:"10px"}};function sr(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const rr=ie({__name:"DiscussList",setup(e){const l=ke(),n=Be(),{globalProperties:u}=fe();let s=null;const y=d(!1),_=d(!1);let x=-1;const f=d([]),o=[],T=[{title:"标题",colKey:"title",cell:(w,j)=>t(G,{variant:"text",onClick:()=>r(j.row.id)},{default:()=>[j.row.title]})},{title:"创建人",colKey:"authorNickname",width:"200",cell:(w,j)=>t(G,{variant:"text",onClick:async()=>await Ht(n,j.row.authorUsername)},{default:()=>[j.row.authorNickname]})},{title:"创建时间",colKey:"insertTime",width:"180"},{title:"更新时间",colKey:"updateTime",width:"180"}],p=d(!1);let k=1,b=50;const g=d({current:k,pageSize:b,defaultCurrent:k,defaultPageSize:b,total:0,pageSizeOptions:[50,100]}),i=d(),m=d({problemId:"",title:"",username:""}),v=d({title:"",content:""}),C=w=>{w&&n.push({name:"problem-detail",params:{problemId:w}})},c=(w,j)=>{n.push({name:"contest-problem-detail",params:{contestId:w,problemIndex:j}})},r=w=>{if(w){if(x){n.push({name:"contest-discuss-detail",params:{contestId:x,discussId:w}});return}n.push({name:"discuss-detail",params:{discussId:w}})}},A=async()=>{await n.push({query:{...l.query,problem_id:m.value.problemId,title:m.value.title,username:m.value.username,page:1,page_size:g.value.defaultPageSize}})},I=async(w,j)=>{var $;p.value=!0;try{const{current:D,pageSize:S}=w,M=await ar(x,m.value.problemId,m.value.title,m.value.username,D,S);if(i.value=[],M.code===0){if(!M.data.has_auth){he(u,"您目前没有权限查看讨论列表"),x?await n.push({name:"contest-detail",params:{contestId:x}}):await n.push({name:"discuss-list"});return}if(M.data.list){const R=M.data.list;for(let N=0;N<R.length;N++){const X=R[N],oe=await Aa(X);($=i.value)==null||$.push(oe)}}g.value={...g.value,total:M.data.total_count}}else j&&F(u,M.code)}catch(D){console.error(D),F(u,Ke())}finally{p.value=!1}},h=async w=>{await n.push({query:{...l.query,page:w.current,page_size:w.pageSize}})},U=()=>{y.value=!0},P=async()=>{_.value=!0,console.log("discussCreateForm",v.value),nr(v.value).then(w=>{w.code===0?(he(u,"创建比赛成功"),y.value=!1,n.push({path:"/discuss/"+w.data.id})):F(u,w.code)}).finally(()=>{_.value=!1})};return me(async()=>{s=Le(()=>l.query,w=>{Array.isArray(l.params.contestId)?x=Number(l.params.contestId[0]):x=Number(l.params.contestId),f.value=o,x?f.value=f.value.concat([{title:"问题ID",colKey:"contestProblemIndex",width:"100",cell:(D,S)=>{let M;return S.row.contestProblemIndex?t(G,{variant:"text",onClick:()=>c(x,S.row.contestProblemIndex)},sr(M=at(S.row.contestProblemIndex))?M:{default:()=>[M]}):""}}]):f.value=f.value.concat([{title:"问题ID",colKey:"problemId",width:"100",cell:(D,S)=>S.row.problemId?t(G,{variant:"text",onClick:()=>C(S.row.problemId)},{default:()=>[S.row.problemId]}):""}]),f.value=f.value.concat(T),m.value.problemId=w.problem_id||"",m.value.title=w.title||"",m.value.username=w.username||"";const j=parseInt(w.page)||g.value.defaultCurrent,$=parseInt(w.page_size)||g.value.defaultPageSize;k=j,b=$,g.value={...g.value,current:k,pageSize:b},I({current:k,pageSize:b},!0)},{immediate:!0})}),Te(()=>{s&&s()}),(w,j)=>{const $=ze,D=be,S=xe,M=$e,R=Ue,N=G,X=je,oe=we,te=Pe,ee=lt;return L(),ae(ue,null,[t(te,null,{default:a(()=>[t(S,{span:9},{default:a(()=>[t(D,{style:{margin:"10px"}},{default:a(()=>[t($,{data:i.value,columns:f.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:g.value,loading:p.value,"table-layout":"auto",onPageChange:h},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(S,{span:3},{default:a(()=>[z("div",or,[t(D,{class:"sh-card"},{default:a(()=>[t(X,{model:m.value},{default:a(()=>[t(R,{label:"问题ID"},{default:a(()=>[t(M,{modelValue:m.value.problemId,"onUpdate:modelValue":j[0]||(j[0]=O=>m.value.problemId=O),placeholder:"请输入完整问题ID"},null,8,["modelValue"])]),_:1}),t(R,{label:"标题"},{default:a(()=>[t(M,{modelValue:m.value.title,"onUpdate:modelValue":j[1]||(j[1]=O=>m.value.title=O),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(R,{label:"创建人"},{default:a(()=>[t(M,{modelValue:m.value.username,"onUpdate:modelValue":j[2]||(j[2]=O=>m.value.username=O),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(R,null,{default:a(()=>[t(N,{theme:"primary",onClick:A},{default:a(()=>j[6]||(j[6]=[V("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(D,{class:"sh-card"},{default:a(()=>[t(oe,null,{default:a(()=>[t(N,{onClick:U},{default:a(()=>j[7]||(j[7]=[V("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),t(ee,{visible:y.value,"onUpdate:visible":j[5]||(j[5]=O=>y.value=O),header:"创建讨论",onConfirm:P,"confirm-loading":_.value},{default:a(()=>[t(X,{"label-width":80,model:v.value,onSubmit:j[4]||(j[4]=yt(()=>{},["prevent"]))},{default:a(()=>[t(R,{label:"标题"},{default:a(()=>[t(M,{modelValue:v.value.title,"onUpdate:modelValue":j[3]||(j[3]=O=>v.value.title=O),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),gt=ce(rr,[["__scopeId","data-v-a2987da9"]]),ur={key:0,style:{margin:"20px"}},ir={style:{margin:"10px"}},cr={style:{margin:"10px"}},dr={style:{margin:"10px","text-align":"right"}},mr={style:{margin:"12px"}},pr={key:0,class:"dida-edit-container"},fr=ie({__name:"DiscussDetail",props:{discussId:{}},setup(e){const l=e;let n=ke();const{globalProperties:u}=fe();let s=null;const y=Ye(),_=Ee();let x=d("");const f=d(""),o=d(!1),T=d(null);let p=d("");const k=d(!1);let b=1,g=20;const i=d({current:1,pageSize:20,total:0,defaultPageSize:g,defaultCurrent:b,pageSizeOptions:[20,50]}),m=d([]),v={},C=Ge(()=>_.hasAuth(De.ManageDiscuss)),c=P=>{P&&Z.push({name:"discuss-list",query:{...n.query,title:"",tag:P.name}})},r=()=>{Z.push({name:"manage-discuss",params:{discussId:f.value}})},A=()=>t("div",{class:"t-pagination__total"},[`共 ${i.value.total} 条回复`]),I=()=>{},h=async(P,w)=>{var j;k.value=!0;try{const{current:$,pageSize:D}=P,S=await lr(f.value,$,D);if(m.value=[],S.code===0){const M=S.data.list;if(M)for(let R=0;R<M.length;R++){const N=M[R],X=er(N);(j=m.value)==null||j.push(X)}i.value={...i.value,total:S.data.total_count}}else w&&F(u,S.code)}catch($){console.error($),F(u,Ke())}finally{k.value=!1}},U=async P=>{await Z.push({query:{...n.query,page:P.current,page_size:P.pageSize}})};return me(async()=>{if(f.value=l.discussId,f.value||(Array.isArray(n.params.discussId)?f.value=n.params.discussId[0]:f.value=n.params.discussId),!f.value){_e(u,"讨论不存在"),await Z.push({name:"discuss"});return}o.value=!0;const P=await tr(f.value);if(P.code!==0){o.value=!1,F(u,P.code),await Z.push({name:"discuss"});return}P.data.tags&&P.data.tags.forEach(w=>{v[w.id]=w}),T.value=Aa(P.data.discuss),y.setTitle(T.value.title+" - "+y.getTitle),x.value=T.value.content,o.value=!1,s=Le(()=>n.query,w=>{const j=parseInt(w.page)||i.value.defaultCurrent,$=parseInt(w.page_size)||i.value.defaultPageSize;b=j,g=$,i.value={...i.value,current:b,pageSize:g},h({current:b,pageSize:g},!0)},{immediate:!0})}),Te(()=>{s&&s()}),(P,w)=>{const j=ba,$=ga,D=Me("md-preview"),S=be,M=we,R=Il,N=Me("MdEditor"),X=G,oe=xe,te=Je,ee=We,O=Pe,de=Ve;return L(),E(de,{loading:o.value},{default:a(()=>[t(O,{class:"dida-main-content"},{default:a(()=>[t(oe,{span:8},{default:a(()=>{var Q,W,H;return[(Q=T.value)!=null&&Q.problemTitle||(W=T.value)!=null&&W.contestTitle?(L(),ae("div",ur,[t($,{"max-item-width":"300"},{default:a(()=>{var se,K,B,re,ge;return[(se=T.value)!=null&&se.contestTitle?(L(),ae(ue,{key:0},[t(j,{to:{name:"contest-detail",params:{contestId:(K=T.value)==null?void 0:K.contestId}}},{default:a(()=>{var ve;return[V(q((ve=T.value)==null?void 0:ve.contestTitle),1)]}),_:1},8,["to"]),(B=T.value)!=null&&B.contestProblemIndex?(L(),E(j,{key:0,to:{name:"contest-problem-detail",params:{problemIndex:(re=T.value)==null?void 0:re.contestProblemIndex}}},{default:a(()=>{var ve,Y;return[V(q(pe(at)((ve=T.value)==null?void 0:ve.contestProblemIndex))+" - "+q((Y=T.value)==null?void 0:Y.problemTitle),1)]}),_:1},8,["to"])):le("",!0)],64)):(L(),ae(ue,{key:1},[t(j,{to:{name:"discuss-list-problem"}},{default:a(()=>w[4]||(w[4]=[V(" 问题讨论")])),_:1}),t(j,{to:{name:"problem-detail",params:{problemId:(ge=T.value)==null?void 0:ge.problemId}}},{default:a(()=>{var ve;return[V(q((ve=T.value)==null?void 0:ve.problemTitle),1)]}),_:1},8,["to"])],64))]}),_:1})])):le("",!0),t(S,{style:{margin:"10px"},header:(H=T.value)==null?void 0:H.title,"header-bordered":!0},{default:a(()=>[t(D,{"model-value":pe(x),previewTheme:"cyanosis"},null,8,["model-value"])]),_:1},8,["header"]),(L(!0),ae(ue,null,Se(m.value,(se,K)=>(L(),E(S,{key:K,style:{margin:"10px"},"header-bordered":""},{header:a(()=>[t(M,null,{default:a(()=>[z("span",null,q(se.authorNickname),1),z("span",null,q(se.insertTime),1)]),_:2},1024)]),default:a(()=>[t(D,{"model-value":se.content,previewTheme:"cyanosis"},null,8,["model-value"])]),_:2},1024))),128)),z("div",ir,[t(R,{modelValue:i.value.current,"onUpdate:modelValue":w[0]||(w[0]=se=>i.value.current=se),"page-size":i.value.pageSize,"onUpdate:pageSize":w[1]||(w[1]=se=>i.value.pageSize=se),total:i.value.total,"page-size-options":i.value.pageSizeOptions,"show-page-size":!1,"total-content":A,onChange:U},null,8,["modelValue","page-size","total","page-size-options"])]),z("div",cr,[t(N,{modelValue:pe(p),"onUpdate:modelValue":w[2]||(w[2]=se=>tl(p)?p.value=se:p=se),class:"dida-comment-editor"},null,8,["modelValue"]),z("div",dr,[t(M,null,{default:a(()=>[t(X,{theme:"primary",onClick:I},{default:a(()=>w[5]||(w[5]=[V("提交")])),_:1})]),_:1})])])]}),_:1}),t(oe,{span:4},{default:a(()=>[z("div",mr,[C.value?(L(),ae("div",pr,[t(X,{onClick:r},{default:a(()=>w[6]||(w[6]=[V("编辑")])),_:1})])):le("",!0),t(ee,{layout:"vertical",bordered:!0},{default:a(()=>[t(te,{label:"创建时间"},{default:a(()=>{var Q;return[V(q((Q=T.value)==null?void 0:Q.insertTime),1)]}),_:1}),t(te,{label:"编辑时间"},{default:a(()=>{var Q;return[V(q((Q=T.value)==null?void 0:Q.modifyTime),1)]}),_:1}),t(te,{label:"更新时间"},{default:a(()=>{var Q;return[V(q((Q=T.value)==null?void 0:Q.updateTime),1)]}),_:1}),t(te,{label:"创建用户"},{default:a(()=>[t(X,{variant:"text",onClick:w[3]||(w[3]=async()=>{var Q;return await pe(Ht)(pe(Z),(Q=T.value)==null?void 0:Q.authorUsername)})},{default:a(()=>{var Q;return[V(q((Q=T.value)==null?void 0:Q.authorNickname),1)]}),_:1})]),_:1}),t(te,{label:"标签"},{default:a(()=>[t(M,null,{default:a(()=>{var Q;return[(L(!0),ae(ue,null,Se((Q=T.value)==null?void 0:Q.tags,W=>(L(),E(X,{key:W.id,variant:"dashed",onClick:()=>c(W)},{default:a(()=>[V(q(W.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Ut=ce(fr,[["__scopeId","data-v-f78e3e48"]]);function vr(e,l){return J({url:"/rank/ac/all?page="+e+"&page_size="+l,method:"get"})}function _r(e,l){return J({url:"/rank/ac/problem?page="+e+"&page_size="+l,method:"get"})}function gr(e,l){return J({url:"/rank/ac/problem/today?page="+e+"&page_size="+l,method:"get"})}function br(e,l){return J({url:"/rank/ac/problem/day7?page="+e+"&page_size="+l,method:"get"})}function hr(e,l){return J({url:"/rank/ac/problem/day30?page="+e+"&page_size="+l,method:"get"})}function yr(e,l){return J({url:"/rank/ac/problem/year?page="+e+"&page_size="+l,method:"get"})}const wr={style:{margin:"10px"}};function $t(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const kr=ie({__name:"RankUser",props:{type:{}},setup(e){const l=ke(),n=Be(),{globalProperties:u}=fe();let s=null;const y=e,_=d(""),x=d(""),f={all:{header:"统计所有用户在本站的提交记录",content:"优先以AC记录数量排序，如果相同则提交所用次数较少的优先，如果仍相同，注册较早的用户靠前"},problem:{header:"统计所有用户在本站的提交记录",content:"以题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-today":{header:"统计所有用户今日在本站的提交记录",content:"以今日题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-day7":{header:"统计所有用户最近7日在本站的提交记录",content:"以7日题目记录数量排序（从7日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-day30":{header:"统计所有用户最近30日在本站的提交记录",content:"以30日题目记录数量排序（从30日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-year":{header:"统计所有用户最近1年在本站的提交记录",content:"以最近1年题目记录数量排序（从365日前的0点开始计算），如果相同，注册较早的用户靠前"}},o=d([]),T=[{title:"序号",colKey:"index"},{title:"用户名",colKey:"username",cell:(h,U)=>t(G,{variant:"dashed",onClick:()=>C(U.row.username)},{default:()=>[U.row.username]})},{title:"昵称",colKey:"nickname"},{title:"Slogan",colKey:"slogan"}],p=[{title:"题目数量",colKey:"problem_count",cell:(h,U)=>{let P=0;return U.row.problem_count&&(P=U.row.problem_count),t(G,{variant:"dashed",onClick:()=>c(U.row.username)},$t(P)?P:{default:()=>[P]})}}],k=[{title:"正确",colKey:"accept",cell:(h,U)=>{let P=0;return U.row.accept&&(P=U.row.accept),t(G,{variant:"dashed",onClick:()=>c(U.row.username)},$t(P)?P:{default:()=>[P]})}},{title:"提交",colKey:"attempt",cell:(h,U)=>{let P=0;return U.row.attempt&&(P=U.row.attempt),t(G,{variant:"dashed",onClick:()=>r(U.row.username)},$t(P)?P:{default:()=>[P]})}}],b=d(!1);let g=1,i=50;const m=d({current:g,pageSize:i,defaultCurrent:g,defaultPageSize:i,total:0,pageSizeOptions:[50]}),v=d(),C=h=>{n.push({name:"user",params:{username:h}})},c=h=>{n.push({name:"judge-list",query:{username:h,status:Fe.Accept}})},r=h=>{n.push({name:"judge-list",query:{username:h}})},A=async(h,U)=>{b.value=!0;try{v.value=[];const{current:P,pageSize:w}=h;let j=null;switch(y.type){case"problem":j=await _r(P,w);break;case"problem-today":j=await gr(P,w);break;case"problem-day7":j=await br(P,w);break;case"problem-day30":j=await hr(P,w);break;case"problem-year":j=await yr(P,w);break;default:j=await vr(P,w);break}if(j.code===0){const $=j.data.list;if(!$||$.length<=0){m.value={...m.value,total:0},he(u,"未找到记录");return}v.value=[];const D=m.value.pageSize*(m.value.current-1);let S=1;$.forEach(M=>{var N;const R=M;R.index=D+S++,(N=v.value)==null||N.push(R)}),m.value={...m.value,total:j.data.total_count}}else U&&F(u,j.code)}catch(P){console.error(P),F(u,Ke())}finally{b.value=!1}},I=async h=>{await n.push({query:{...l.query,page:h.current,page_size:h.pageSize}})};return me(async()=>{b.value=!0,s=Le(()=>l.query,h=>{switch(y.type&&f[y.type]?(_.value=f[y.type].header,x.value=f[y.type].content):(_.value=f.all.header,x.value=f.all.content),y.type){case"all":o.value=T.concat(k);break;default:o.value=T.concat(p);break}const U=parseInt(h.page)||m.value.defaultCurrent,P=parseInt(h.page_size)||m.value.defaultPageSize;g=U,i=P,m.value={...m.value,current:g,pageSize:i},A({current:g,pageSize:i},!0)},{immediate:!0})}),Te(()=>{s&&s()}),(h,U)=>{const P=ze,w=be,j=xe,$=Pe;return L(),E($,null,{default:a(()=>[t(j,{span:9},{default:a(()=>[t(w,{style:{margin:"10px"}},{default:a(()=>[t(P,{data:v.value,columns:o.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:m.value,loading:b.value,"table-layout":"auto",onPageChange:I},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(j,{span:3},{default:a(()=>[z("div",wr,[t(w,{class:"sh-card",header:_.value,"header-bordered":!0},{default:a(()=>[V(q(x.value),1)]),_:1},8,["header"])])]),_:1})]),_:1})}}}),st=ce(kr,[["__scopeId","data-v-13682529"]]),Cr={style:{display:"flex","align-items":"center"}},Sr={style:{color:"#409eff","margin-right":"20px"}},Ir={class:"dida-login-footer"},Pr=ie({__name:"UserForget",setup(e){const{globalProperties:l}=fe(),n=Ee(),u=d(!1),s=d(!1),y=d(!1),_=d("发送验证码");let x=null,f=-1;const o=d(!1),T=d(null),p=d(""),k=d({username:"",emailKey:"",password:"",confirmPassword:""}),g=d({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:A=>new Promise(I=>{const h=setTimeout(()=>{I(k.value.password===A),clearTimeout(h)})}),message:"两次密码不一致"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),i=()=>{he(l,"重置成功")},m=async A=>{if(!y.value){u.value=!0,s.value=!0;try{const I=await qn(A,k.value.username);I.code===0?(he(l,"验证码发送成功"),p.value=I.data,s.value=!1,y.value=!0,x=new Date,_.value="60秒后重发",f=setInterval(()=>{const U=Math.floor((new Date().getTime()-(x==null?void 0:x.getTime()))/1e3);U>60?(_.value="发送验证码",y.value=!1,clearInterval(f)):_.value=`${60-U}秒后重发`},1e3)):F(l,I.code)}catch(I){console.error("Send email key error",I),_e(l,"发送验证码失败")}finally{u.value=!1}}},v=async()=>{var U;if(o.value=!0,y.value||s.value)return;await dt();const A=document.getElementById("cf-confirm-div");A&&A.remove();const I=document.createElement("div");I.id="cf-confirm-div",I.setAttribute("data-theme","light"),(U=T.value)==null||U.appendChild(I);const h=window;h.turnstile.ready(function(){h.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(P){o.value=!1,await m(P)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},C=d(()=>t(G,{onClick:v,disabled:y.value,loading:s.value,style:"width:120px"},{default:()=>[_.value]})),c=async()=>{u.value=!0;try{const A=await Kn(k.value.username,k.value.password,k.value.emailKey);A.code===0?(he(l,"密码修改成功"),l.$router.push({name:"login"})):F(l,A.code)}catch(A){console.error("Modify password error",A),_e(l,"修改密码失败")}finally{u.value=!1}},r=async({validateResult:A,firstError:I,e:h})=>{if(!u.value){if(h.preventDefault(),A!==!0){_e(l,I);return}p.value?await c():await v()}};return me(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),Te(()=>{}),(A,I)=>{const h=It,U=$e,P=Ue,w=va,j=G,$=je,D=nt,S=be,M=lt;return L(),ae(ue,null,[t(S,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(h,{"max-line":1},{default:a(()=>I[6]||(I[6]=[z("span",null,"如果您未绑定邮箱或忘记用户名，可联系管理员寻求帮助",-1),z("span",null,"管理员邮箱：BoilTask@qq.com",-1)])),_:1}),t($,{ref:"form",rules:g.value,data:k.value,colon:!0,onReset:i,onSubmit:r,class:"yj-login-form"},{default:a(()=>[t(P,{name:"username",label:"用户名"},{default:a(()=>[t(U,{modelValue:k.value.username,"onUpdate:modelValue":I[0]||(I[0]=R=>k.value.username=R),clearable:"",placeholder:"请输入完整用户名"},null,8,["modelValue"])]),_:1}),p.value?(L(),ae(ue,{key:0},[t(P,{name:"email",label:"发送邮箱"},{default:a(()=>[t(w,{append:C.value},{default:a(()=>[z("div",Cr,[z("span",Sr,q(p.value),1)])]),_:1},8,["append"])]),_:1}),t(P,{name:"emailKey",label:"验证码"},{default:a(()=>[t(U,{modelValue:k.value.emailKey,"onUpdate:modelValue":I[1]||(I[1]=R=>k.value.emailKey=R),clearable:"",placeholder:"请输入收到的验证码"},null,8,["modelValue"])]),_:1}),t(P,{name:"password",label:"新密码"},{default:a(()=>[t(U,{modelValue:k.value.password,"onUpdate:modelValue":I[2]||(I[2]=R=>k.value.password=R),type:"password",clearable:"",placeholder:"新密码"},null,8,["modelValue"])]),_:1}),t(P,{name:"confirmPassword",label:"确认密码"},{default:a(()=>[t(U,{modelValue:k.value.confirmPassword,"onUpdate:modelValue":I[3]||(I[3]=R=>k.value.confirmPassword=R),type:"password",clearable:"",placeholder:"请重复输入密码"},null,8,["modelValue"])]),_:1})],64)):le("",!0),p.value?(L(),E(P,{key:1},{default:a(()=>[t(j,{theme:"primary",type:"submit",block:"",loading:u.value},{default:a(()=>I[7]||(I[7]=[V("修改密码")])),_:1},8,["loading"])]),_:1})):(L(),E(P,{key:2},{default:a(()=>[t(j,{theme:"primary",type:"submit",block:"",loading:u.value},{default:a(()=>I[8]||(I[8]=[V("重置密码")])),_:1},8,["loading"])]),_:1}))]),_:1},8,["rules","data"]),z("div",Ir,[t(D,{onClick:I[4]||(I[4]=()=>{pe(l).$router.push({name:"login"})})},{default:a(()=>I[9]||(I[9]=[V("返回登陆 ")])),_:1})])]),_:1}),t(M,{visible:o.value,"onUpdate:visible":I[5]||(I[5]=R=>o.value=R),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:a(()=>[z("div",{ref_key:"dialogContainer",ref:T,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),xr=ce(Pr,[["__scopeId","data-v-d3cb1db8"]]),Vr={class:"judger-status-panel"},Tr={class:"judger-status-panel"};function Dr(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const Lr=ie({__name:"SystemStatus",setup(e){const{globalProperties:l}=fe(),n=d([]),u=d([]),s=d(!1);let y;const _=o=>{let T="失效",p="danger";const k=new Date,b=new Date(o.updateTime);return k.getTime()-b.getTime()>3e4?(T="离线",p="default"):o.cpuUsage>90?(T="CPU过高",p="warning"):o.memPercent>90?(T="内存过高",p="warning"):(T="在线",p="success"),t(we,null,{default:()=>[t("span",null,[o.key,V(" - "),o.name]),t("span",null,[o.updateTime]),t(tt,{theme:p,size:"small"},Dr(T)?T:{default:()=>[T]})]})},x=async()=>{const o={};for(let C=0;C<n.value.length;C++){const c=n.value[C];o[c.key]={...c}}const T={};for(let C=0;C<u.value.length;C++){const c=u.value[C];T[c.key]={...c}}const p=[],k=[],b=await Wl();if(b.code!==0){F(l,b.code);return}const g=b.data.web,i={key:"didaoj"};g.name?i.name=g.name:i.name="-",g.update_time?i.updateTime=new Date(g.update_time).toLocaleString():i.updateTime="-",g.cpu_usage?i.cpuUsage=Number(g.cpu_usage):i.cpuUsage=0,g.mem_usage?i.memUsage=g.mem_usage/(1024*1024*1024):i.memUsage=0,g.mem_total?i.memTotal=g.mem_total/(1024*1024*1024):i.memTotal=0,i.memTotal>0?i.memPercent=Math.round(i.memUsage/i.memTotal*1e4)/100:i.memPercent=0,i.avgMessage=g.avg_message;const m=o[i.key];m?(i.cpuUsageFrom=m.cpuUsage,i.memPercentFrom=m.memPercent,i.memUsageFrom=m.memUsage,i.memTotalFrom=m.memTotal):(i.cpuUsageFrom=0,i.memPercentFrom=0,i.memUsageFrom=0,i.memTotalFrom=0),p.push(i),n.value=p;const v=b.data.judger;for(let C=0;C<v.length;C++){const c=v[C],r={key:c.key,name:c.name};c.name?r.name=c.name:r.name="-",c.update_time?r.updateTime=new Date(c.update_time).toLocaleString():r.updateTime="-",c.cpu_usage?r.cpuUsage=Number(c.cpu_usage):r.cpuUsage=0,c.mem_usage?r.memUsage=c.mem_usage/(1024*1024*1024):r.memUsage=0,c.mem_total?r.memTotal=c.mem_total/(1024*1024*1024):r.memTotal=0,r.memTotal>0?r.memPercent=Math.round(r.memUsage/r.memTotal*1e4)/100:r.memPercent=0,r.avgMessage=c.avg_message,T[c.key]?(r.cpuUsageFrom=T[c.key].cpuUsage,r.memPercentFrom=T[c.key].memPercent,r.memUsageFrom=T[c.key].memUsage,r.memTotalFrom=T[c.key].memTotal):(r.cpuUsageFrom=0,r.memPercentFrom=0,r.memUsageFrom=0,r.memTotalFrom=0),k.push(r)}u.value=k},f=async()=>{await x(),s.value=!1};return me(async()=>{u.value=[],n.value=[],s.value=!0,await f(),y=setInterval(()=>{f()},5e3)}),Te(()=>{clearInterval(y)}),(o,T)=>{const p=Pl,k=we,b=be,g=Ve;return L(),E(g,{loading:s.value},{default:a(()=>[t(b,{title:"接口状态",class:"judger-status"},{default:a(()=>[z("div",Vr,[(L(!0),ae(ue,null,Se(n.value,i=>(L(),E(b,{key:i.key,header:()=>_(i),class:"judge-status-judger"},{footer:a(()=>[z("span",null," 负载信息："+q(i.avgMessage),1)]),default:a(()=>[t(k,{class:"judge-status-judger"},{default:a(()=>[t(p,{title:"CPU使用率",value:i.cpuUsage,animation:{valueFrom:i.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(p,{title:"内存使用率",value:i.memPercent,animation:{valueFrom:i.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(p,{title:"内存使用量",animation:{valueFrom:i.memUsageFrom,duration:2e3},"animation-start":!0,value:i.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(p,{title:"内存总量",value:i.memTotal,animation:{valueFrom:i.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1}),t(b,{title:"判题机状态",class:"judger-status"},{default:a(()=>[z("div",Tr,[(L(!0),ae(ue,null,Se(u.value,i=>(L(),E(b,{key:i.key,header:()=>_(i),class:"judge-status-judger"},{footer:a(()=>[z("span",null," 负载信息："+q(i.avgMessage),1)]),default:a(()=>[t(k,{class:"judge-status-judger"},{default:a(()=>[t(p,{title:"CPU使用率",value:i.cpuUsage,animation:{valueFrom:i.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(p,{title:"内存使用率",value:i.memPercent,animation:{valueFrom:i.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(p,{title:"内存使用量",animation:{valueFrom:i.memUsageFrom,duration:2e3},"animation-start":!0,value:i.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(p,{title:"内存总量",value:i.memTotal,animation:{valueFrom:i.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1})]),_:1},8,["loading"])}}}),jr=ce(Lr,[["__scopeId","data-v-d2b0a05b"]]),Ur=ie({__name:"ManageJudge",setup(e){const{globalProperties:l}=fe(),n=d(!1),u=d(!1),s=d({problemId:"",language:void 0,status:void 0}),y=d(!1),_=d([]);_.value=Ft();const x=d([]);x.value=Ia();const f=async()=>{n.value=!0;try{const p=await nn();if(p.code!==0){F(l,p.code);return}he(l,"重判成功"),await Z.push({name:"judge-list"})}catch(p){console.error(p),F(l,"重判失败")}finally{n.value=!1}},o=async()=>{if(!s.value.problemId&&!s.value.language&&!s.value.status){F(l,"请输入问题Id");return}y.value=!0;try{const p=await on(s.value.problemId,s.value.language,s.value.status);if(p.code!==0){F(l,p.code);return}he(l,"重判成功"),await Z.push({name:"judge-list",query:{problem_id:s.value.problemId,language:s.value.language}})}catch(p){console.error(p),F(l,"重判失败")}finally{y.value=!1}},T=async()=>{u.value=!0;try{const p=await sn();if(p.code!==0){F(l,p.code);return}he(l,"重判成功"),await Z.push({name:"judge-list"})}catch(p){console.error(p),F(l,"重判失败")}finally{u.value=!1}};return(p,k)=>{const b=G,g=be,i=$e,m=Ue,v=qt,C=pt,c=we,r=je;return L(),ae(ue,null,[t(g,{class:"yj-manage-card",title:"重判最近提交"},{default:a(()=>[t(b,{onClick:f,loading:n.value},{default:a(()=>k[3]||(k[3]=[V("重判")])),_:1},8,["loading"])]),_:1}),t(g,{class:"yj-manage-card",title:"重判指定记录"},{default:a(()=>[t(r,{layout:"inline",onSubmit:o},{default:a(()=>[t(m,{label:"题号"},{default:a(()=>[t(i,{modelValue:s.value.problemId,"onUpdate:modelValue":k[0]||(k[0]=A=>s.value.problemId=A),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(m,{label:"语言"},{default:a(()=>[t(C,{modelValue:s.value.language,"onUpdate:modelValue":k[1]||(k[1]=A=>s.value.language=A),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:a(()=>[(L(!0),ae(ue,null,Se(_.value,A=>(L(),E(v,{key:A.value,value:A.value,label:A.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"状态"},{default:a(()=>[t(C,{modelValue:s.value.status,"onUpdate:modelValue":k[2]||(k[2]=A=>s.value.status=A),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:a(()=>[(L(!0),ae(ue,null,Se(x.value,A=>(L(),E(v,{key:A.value,value:A.value,label:A.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,null,{default:a(()=>[t(c,null,{default:a(()=>[t(b,{theme:"primary",type:"submit",loading:y.value},{default:a(()=>k[4]||(k[4]=[V("重判")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(g,{class:"yj-manage-card",title:"重判所有"},{default:a(()=>[t(b,{onClick:T,theme:"danger",loading:u.value},{default:a(()=>k[5]||(k[5]=[V("重判")])),_:1},8,["loading"])]),_:1})],64)}}}),$r=ce(Ur,[["__scopeId","data-v-6d48cbf2"]]),zr=ie({__name:"ManageWeb",setup(e){const{globalProperties:l}=fe(),n=d({theme:"",content:""}),u=d({title:"",content:""}),s=d(!1),y=d(!1),_=d(!1);async function x(k,b){_.value=!0,await xt(k,b,l,Jl),_.value=!1}const f=async()=>{y.value=!0;try{const k=await Yl(n.value.theme,n.value.content);if(k.code!==0){F(l,k.code);return}he(l,"保存成功")}catch(k){console.error(k),F(l,"保存失败")}finally{y.value=!1}},o=async()=>{_.value=!0;try{const k=u.value.content,b=await Xl(u.value.title,k);if(b.code!==0){F(l,b.code);return}u.value.content=b.data.content,he(l,"保存成功")}catch(k){console.error(k),_e(l,"保存失败")}finally{_.value=!1}},T=async()=>{n.value=await ka()},p=async()=>{try{u.value=await Ca()}catch{_e(l,"加载公告失败"),u.value={title:"",content:""}}};return me(async()=>{s.value=!0;try{await T(),await p()}catch{_e(l,"加载数据失败")}s.value=!1}),(k,b)=>{const g=pt,i=Ue,m=$e,v=G,C=we,c=je,r=be,A=Me("md-editor-v3"),I=Ve;return L(),E(I,{loading:s.value},{default:a(()=>[t(r,{class:"yj-manage-card",title:"站点通知"},{default:a(()=>[t(c,{onSubmit:f},{default:a(()=>[t(i,{label:"主题"},{default:a(()=>[t(g,{modelValue:n.value.theme,"onUpdate:modelValue":b[0]||(b[0]=h=>n.value.theme=h),options:[{label:"success",value:"success"},{label:"info",value:"info"},{label:"warning",value:"warning"},{label:"error",value:"error"}],placeholder:"请选择主题"},null,8,["modelValue"])]),_:1}),t(i,{label:"内容"},{default:a(()=>[t(m,{modelValue:n.value.content,"onUpdate:modelValue":b[1]||(b[1]=h=>n.value.content=h),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),t(i,null,{default:a(()=>[t(C,null,{default:a(()=>[t(v,{theme:"primary",type:"submit",loading:y.value},{default:a(()=>b[4]||(b[4]=[V("保存")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(r,{class:"yj-manage-card",title:"首页公告"},{actions:a(()=>[t(v,{theme:"primary",loading:_.value,onClick:o},{default:a(()=>b[5]||(b[5]=[V("保存")])),_:1},8,["loading"])]),default:a(()=>[t(c,{onSubmit:o},{default:a(()=>[t(i,{label:"标题"},{default:a(()=>[t(m,{modelValue:u.value.title,"onUpdate:modelValue":b[2]||(b[2]=h=>u.value.title=h),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1}),t(I,{loading:_.value},{default:a(()=>[t(A,{modelValue:u.value.content,"onUpdate:modelValue":b[3]||(b[3]=h=>u.value.content=h),onSave:o,onOnUploadImg:x,previewTheme:"cyanosis",class:"dida-description-editor"},null,8,["modelValue"])]),_:1},8,["loading"])]),_:1})]),_:1},8,["loading"])}}}),Ar=ce(zr,[["__scopeId","data-v-8c162eb5"]]),Ra=[{name:"problem-list",tab:"problem",sidebar:"problem-list",path:"",title:"问题列表",icon:"list",component:ro},{name:"problem-detail",tab:"problem",sidebar:"problem-list",path:":problemId+",title:"问题详情",icon:"list",component:jt},{name:"problem-daily-list",tab:"problem",sidebar:"problem-daily-list",path:"daily",title:"每日一题",icon:"list",component:Ro},{name:"problem-daily-detail",tab:"problem",sidebar:"problem-daily-list",path:"daily/:dailyId+",title:"问题详情",icon:"list",component:jt},{name:"problem-recommend",tab:"problem",sidebar:"problem-recommend",path:"recommend/:problemId*",title:"问题推荐",icon:"cpu",needLogin:!0,component:No},{name:"problem-collection-list",tab:"problem",sidebar:"problem-collection-list",path:"collection",title:"题目集合",icon:"list",disableTabPath:!0,component:ps},{name:"collection-detail",tab:"collection-detail-tab",sidebar:"collection-detail",path:":collectionId+",title:"题集详情",icon:"cpu",component:bs},{name:"collection-rank",tab:"collection-detail-tab",sidebar:"collection-rank",path:":collectionId+/rank",title:"题集排名",icon:"list",component:hs},{name:"collection-edit",tab:"collection-detail-tab",sidebar:"collection-edit",disableSidebar:!0,needLogin:!0,path:":collectionId+/edit",title:"题集编辑",icon:"list",component:aa},{name:"collection-create",tab:"collection-detail-tab",sidebar:"collection-create",needLogin:!0,disableSidebar:!0,path:"create",title:"新建题集",icon:"list",component:aa},{name:"judge-list",tab:"judge",sidebar:"judge-list",path:"",title:"评测列表",icon:"list",component:na},{name:"judge-detail",tab:"judge",sidebar:"judge-list",path:":judgeId+",title:"评测详情",icon:"cpu",component:sa},{name:"contest-list",tab:"contest",sidebar:"contest-list",path:"",title:"比赛列表",icon:"list",component:ra},{name:"contest-recent",tab:"contest",sidebar:"contest-recent",path:"recent",title:"近期比赛",icon:"list",component:ra},{name:"contest-create",tab:"contest",sidebar:"contest-create",disableSidebar:!0,needLogin:!0,path:"create",title:"新建比赛",icon:"list",component:ia},{name:"contest-edit",tab:"contest-detail-tab",sidebar:"contest-edit",disableSidebar:!0,needLogin:!0,path:":contestId+/edit",title:"比赛编辑",icon:"list",component:ia},{name:"contest-detail",tab:"contest-detail-tab",sidebar:"contest-detail",path:":contestId+",title:"比赛详情",icon:"cpu",component:Os},{name:"contest-problem-detail",tab:"contest-detail-tab",sidebar:"contest-problem-detail",path:":contestId+/problem/:problemIndex+",title:"问题详情",icon:"cpu",disableSidebar:!0,component:jt},{name:"contest-judge",tab:"contest-detail-tab",sidebar:"contest-judge",path:":contestId+/judge",title:"评测列表",icon:"list",component:na},{name:"contest-judge-detail",tab:"contest-detail-tab",sidebar:"contest-judge-detail",path:":contestId+/judge/:judgeId+",title:"评测详情",icon:"cpu",component:sa,disableSidebar:!0},{name:"contest-rank",tab:"contest-detail-tab",sidebar:"contest-rank",path:":contestId+/rank",title:"比赛排名",icon:"list",component:Js},{name:"contest-discuss",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss",title:"比赛讨论",icon:"list",component:gt},{name:"contest-discuss-detail",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss/:discussId+",title:"讨论详情",icon:"list",component:Ut},{name:"discuss-list",tab:"discuss",sidebar:"discuss-list",path:"",title:"讨论列表",icon:"list",component:gt},{name:"discuss-list-problem",tab:"discuss",sidebar:"discuss-list-problem",path:"problem",title:"问题讨论",icon:"list",component:gt},{name:"discuss-list-judge",tab:"discuss",sidebar:"discuss-list-judge",path:"judge",title:"评测讨论",icon:"list",component:gt},{name:"discuss-detail",tab:"discuss",sidebar:"discuss-list",path:":discussId+",title:"讨论详情",icon:"list",component:Ut},{name:"rank-ac-all",tab:"rank",sidebar:"rank-ac-all",path:"ac",title:"AC排名",icon:"base-station",props:{type:"all"},component:st},{name:"rank-ac-problem",tab:"rank",sidebar:"rank-ac-problem",path:"ac/problem",title:"题量排名",icon:"base-station",props:{type:"problem"},component:st},{name:"rank-ac-problem-today",tab:"rank",sidebar:"rank-ac-problem-today",path:"ac/problem/today",title:"今日题量",icon:"base-station",props:{type:"problem-today"},component:st},{name:"rank-ac-problem-day7",tab:"rank",sidebar:"rank-ac-problem-day7",path:"ac/problem/day7",title:"7日题量",icon:"base-station",props:{type:"problem-day7"},component:st},{name:"rank-ac-problem-day30",tab:"rank",sidebar:"rank-ac-problem-day30",path:"ac/problem/day30",title:"30日题量",icon:"base-station",props:{type:"problem-day30"},component:st},{name:"rank-ac-problem-year",tab:"rank",sidebar:"rank-ac-problem-year",path:"ac/problem/year",title:"1年题量",icon:"base-station",props:{type:"problem-year"},component:st},{name:"system-status",tab:"system",sidebar:"system-status",path:"",title:"运行状态",icon:"base-station",component:jr},{name:"system-about",tab:"system",sidebar:"system-about",path:"about",title:"关于",icon:"base-station",props:{discussId:"52"},component:Ut},{name:"manage-problem-create",tab:"manage",sidebar:"manage-problem-create",disableSidebar:!0,path:"problem",title:"新建问题",icon:"list",component:ta,auths:[De.ManageProblem]},{name:"manage-problem",tab:"manage",sidebar:"manage-problem",disableSidebar:!0,path:"problem/:problemId+",title:"问题编辑",icon:"list",component:ta,auths:[De.ManageProblem]},{name:"manage-problem-daily-create",tab:"manage",sidebar:"manage-problem-daily-create",disableSidebar:!0,path:"problem/daily",title:"新建每日一题",icon:"list",component:ea,auths:[De.ManageProblemDaily]},{name:"manage-problem-daily",tab:"manage",sidebar:"manage-problem-daily",disableSidebar:!0,path:"problem/daily/:dailyId+",title:"编辑每日一题",icon:"list",component:ea,auths:[De.ManageProblemDaily]},{name:"manage-problem-judge",tab:"manage",sidebar:"manage-problem-judge",disableSidebar:!0,path:"problem/:problemId+/judge",title:"评测数据",icon:"list",component:as,auths:[De.ManageProblem]},{name:"manage-web",tab:"manage",path:"web",sidebar:"manage-web",title:"站点管理",icon:"list",auths:[De.ManageWeb],component:Ar},{name:"manage-judge",tab:"manage",path:"judge",sidebar:"manage-judge",title:"评测管理",icon:"list",auths:["i-manage-judge"],component:$r},{name:"login-forget",tab:"login",path:"forget",title:"忘记密码",component:xr}],ca=(e,l,n,u)=>{u.tab==n&&(u.disableSidebar&&l!=u.sidebar||u.sidebar==null||u.sidebar!=u.name||e.push({name:u.name,title:u.title,icon:u.icon,to:{name:u.name}}))},Rr=(e,l)=>{const n=[];return Ra.forEach(u=>{if(ja(u)){const s=[];u.children.forEach(y=>{ca(s,e,l,y)}),s.length>0&&n.push({title:u.title,children:s})}else ca(n,e,l,u)}),n},da=(e,l)=>{const n=Qn(l.tab),u={name:l.name,path:"/"+l.path,meta:{title:l.title+" - "+n.title,tab:l.tab,sidebar:l.sidebar,showSidebar:n.showSidebar,needLogin:n.needLogin||l.needLogin,tabAuths:n.auths,auths:l.auths},props:l.props,component:l.component};!n.disablePath&&!l.disableTabPath&&(u.path=n.path+u.path),e.push(u)},Mr=e=>{Ra.forEach(l=>{ja(l)?l.children.forEach(n=>{da(e,n)}):da(e,l)})},Er={class:"sh-main"},qr=ie({__name:"View403",setup(e){let l=ke();const n=d("");return me(()=>{l.query.target?n.value=l.query.target:n.value=l.fullPath}),(u,s)=>{const y=G;return L(),ae("div",Er,[z("p",null,q(n.value),1),s[2]||(s[2]=z("p",null,"该页面无访问权限，请更换访问目标或重新登陆后再试",-1)),t(y,{theme:"primary",onClick:s[0]||(s[0]=()=>u.$router.push("/"))},{default:a(()=>s[1]||(s[1]=[V("返回首页")])),_:1})])}}}),Ma=ce(qr,[["__scopeId","data-v-777362b3"]]),_t=[];to(_t);Mr(_t);_t.push({path:"/403",name:"403",component:Ma});_t.push({path:"/:pathMatch(.*)*",name:"404",component:La});const Z=al({history:ll("/"),routes:_t});Z.beforeEach((e,l,n)=>{if(e.name==null||!Z.hasRoute(e.name)){n({name:"home"});return}const u=e.matched[e.matched.length-1].meta;if(u.redirect){n({name:u.redirect});return}if(u.needLogin){const y=Ee();if(y.getToken==null||y.getToken==""){n({name:"login",query:{redirect_uri:e.fullPath}});return}}const s=u.tabAuths;if(s&&!Ee().hasAllAuths(s)){n({name:"403",query:{target:e.fullPath}});return}n()});Z.afterEach((e,l)=>{if(e.name===l.name)return;const n=Vt(),u=Ye();let s=null;if(e.matched.length>0&&(s=e.matched[e.matched.length-1].meta),s!=null&&s.title&&u.setTitle(s==null?void 0:s.title),s!=null&&s.showSidebar){n.setSidebarShow(!0);const y=Rr(s==null?void 0:s.sidebar,s==null?void 0:s.tab);n.setMenuList(y),n.setMenuActiveName(s==null?void 0:s.sidebar)}else n.setSidebarShow(!1);window.scrollTo(0,0)});const Ea=mt("login",{state:()=>({Loaded:!1}),getters:{isLoaded(){return this.Loaded}}}),Kr=ie({__name:"HeaderContent",setup(e){const l=Ea(),n=Ee(),{globalProperties:u}=fe(),s=d(l.isLoaded),y=d(!1),_=d(n.getUsername),x=d(n.getNickname),f=d(),o=()=>{f.value=eo(n)};l.$subscribe((k,b)=>{s.value=b.Loaded}),n.$subscribe((k,b)=>{_.value=b.username,x.value=b.nickname,y.value=b.token!="",o()});const T=()=>{u.$router.currentRoute.value.name!=="login"&&u.$router.push({name:"login",query:{redirect_uri:u.$router.currentRoute.value.fullPath}})},p=()=>{n.clear(),u.$message.success({duration:3e3,content:"注销成功"}),u.$router.push({path:"/login",query:{redirect_uri:u.$router.currentRoute.value.fullPath}})};return me(()=>{o()}),(k,b)=>{const g=Me("router-link"),i=ya,m=ha,v=xl,C=Vl;return L(),E(C,{modelValue:k.$route.meta.tab,"onUpdate:modelValue":b[0]||(b[0]=c=>k.$route.meta.tab=c),class:"sh-menu","expand-type":"popup"},{logo:a(()=>[t(g,{to:"/",class:"sh-logo"},{default:a(()=>b[1]||(b[1]=[V("DidaOJ")])),_:1})]),operations:a(()=>[s.value&&y.value?(L(),E(v,{key:0,title:x.value},{icon:a(()=>[t(i,{name:"user"})]),default:a(()=>[t(m,{value:"user",to:{path:"/user/"+_.value}},{default:a(()=>b[2]||(b[2]=[V("个人空间")])),_:1},8,["to"]),t(m,{value:"user_logout",onClick:p},{default:a(()=>b[3]||(b[3]=[V(" 注销")])),_:1})]),_:1},8,["title"])):s.value?(L(),E(m,{key:2,value:"login",onClick:T},{icon:a(()=>[t(i,{name:"login"})]),default:a(()=>[b[5]||(b[5]=V(" 登录 "))]),_:1})):(L(),E(m,{key:1,value:"login"},{icon:a(()=>[t(i,{name:"login"})]),default:a(()=>[b[4]||(b[4]=V(" ... "))]),_:1}))]),default:a(()=>[(L(!0),ae(ue,null,Se(f.value,c=>(L(),E(m,{key:c.name,value:c.name,to:{name:c.name}},{icon:a(()=>[c.icon?(L(),E(i,{key:0,name:c.icon},null,8,["name"])):le("",!0)]),default:a(()=>[V(" "+q(c.title),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])}}}),Fr=ce(Kr,[["__scopeId","data-v-b7d90d1a"]]),Or={id:"menu-container"},Gr=ie({__name:"SidebarContent",setup(e){const l=Vt(),n=d(!1),u=d(null),s=d(l.menuActiveName),y=d(l.menuList),_=d([]),x=d(!1),f=()=>{s.value=l.menuActiveName;const T=JSON.stringify(y.value),p=JSON.stringify(l.menuList);T!==p&&(_.value.push([...l.menuList]),o())},o=async()=>{if(_.value.length>0&&!x.value){for(x.value=!0;_.value.length>1;)_.value.shift();const T=_.value.shift();n.value=T.length<=0,y.value=[],await dt(),u.value&&u.value.updateActiveName(),await new Promise(k=>setTimeout(k,300)),y.value=T,await dt(),u.value&&u.value.updateActiveName();const p=300;await new Promise(k=>setTimeout(k,p)),x.value=!1,await o()}};return l.$subscribe((T,p)=>{f()}),me(()=>{f()}),(T,p)=>{const k=ya,b=ha,g=Dl,i=Tl,m=Ve;return L(),ae(ue,null,[z("div",Or,[t(i,{modelValue:s.value,"onUpdate:modelValue":p[0]||(p[0]=v=>s.value=v),theme:"light",class:"sh-menu-container"},{default:a(()=>[t(nl,{name:"move-left"},{default:a(()=>[(L(!0),ae(ue,null,Se(y.value,(v,C)=>(L(),ae(ue,{key:C},[pe(ao)(v)?(L(),E(g,{key:0,title:v.title},{default:a(()=>[(L(!0),ae(ue,null,Se(v.children,(c,r)=>(L(),E(b,{key:c.name,value:c.name,to:c.to},Yt({default:a(()=>[V(" "+q(c.title),1)]),_:2},[c.icon?{name:"icon",fn:a(()=>[t(k,{name:c.icon,class:Rt(c.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))),128))]),_:2},1032,["title"])):(L(),E(b,{key:v.name,value:v.name,to:v.to},Yt({default:a(()=>[V(" "+q(v.title),1)]),_:2},[v.icon?{name:"icon",fn:a(()=>[t(k,{name:v.icon,class:Rt(v.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),t(m,{size:"small",loading:n.value,"show-overlay":!0,attach:"#menu-container",class:"sh-sidebar-loading",style:{"align-items":"flex-start","padding-top":"100px"}},null,8,["loading"])],64)}}}),Nr=ce(Gr,[["__scopeId","data-v-96e2d89f"]]),Hr={};function Br(e,l){return null}const Wr=ce(Hr,[["render",Br]]),Jr={class:"footer"},Yr={class:"footer-left"},Xr={class:"foot-time"},Zr={class:"footer-center"},Qr={href:"https://beiancx.miit.gov.cn/",target:"_blank"},eu={class:"footer-right"},tu={class:"foot-text"},au={href:"https://github.com/hpu-developer/DiDaOJ-web",target:"_blank"},lu={class:"foot-text"},nu={href:"https://github.com/hpu-developer/DiDaOJ-go",target:"_blank"},ou=ie({__name:"FooterContent",setup(e){const l=d("");function n(){l.value=new Date().toLocaleString()}return me(()=>{n(),setInterval(()=>{n()},1e3)}),(u,s)=>{const y=G;return L(),ae("div",Jr,[z("div",Yr,[z("p",Xr,q(l.value),1)]),z("div",Zr,[z("a",Qr,[t(y,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>s[0]||(s[0]=[V("豫ICP备15024677号-4")])),_:1})])]),z("div",eu,[z("p",tu,[z("a",au,[t(y,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>s[1]||(s[1]=[V("@didaoj-web")])),_:1})])]),z("p",lu,[z("a",nu,[t(y,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>s[2]||(s[2]=[V("@didaoj-go")])),_:1})])])])])}}}),su=ce(ou,[["__scopeId","data-v-44f2e4e7"]]),bt=20,zt=100,At=50,ru=ie({__name:"ForceHiddenSidebarButton",setup(e){let l=Vt();const n=d({x:window.innerWidth-zt-bt,y:window.innerHeight-At-bt}),u=d(window.innerWidth),s=d(window.innerHeight);let y=!1,_={x:0,y:0};const x=v=>{y=!0;const C=v.clientX??v.touches[0].clientX,c=v.clientY??v.touches[0].clientY;_={x:C-n.value.x,y:c-n.value.y},document.addEventListener("mousemove",f),document.addEventListener("touchmove",f),document.addEventListener("mouseup",o),document.addEventListener("touchend",o)},f=v=>{if(!y)return;const C=v.clientX??v.touches[0].clientX,c=v.clientY??v.touches[0].clientY;let r=C-_.x,A=c-_.y;r=Math.max(0,Math.min(r,u.value-zt)),A=Math.max(0,Math.min(A,s.value-At)),n.value={x:r,y:A}},o=()=>{y=!1,document.removeEventListener("mousemove",f),document.removeEventListener("touchmove",f),document.removeEventListener("mouseup",o),document.removeEventListener("touchend",o)},T=()=>{u.value=window.innerWidth,s.value=window.innerHeight,n.value={x:Math.min(n.value.x,u.value-zt-bt),y:Math.min(n.value.y,s.value-At-bt)}};let p=d(l.forceHiddenSidebar),k=d(l.forceHiddenSidebar);const b=()=>{p.value=!p.value,l.setForceHiddenSidebar(p.value)},g=()=>{k.value||(k.value=!0,l.setForceHiddenSidebar(p.value))},i=()=>{k.value&&(k.value=!1,l.setForceHiddenSidebar(!1))},m=v=>{v>=800?i():g()};return m(u.value),Le(u,v=>{m(v)}),me(()=>{window.addEventListener("resize",T)}),Te(()=>{window.removeEventListener("resize",T)}),(v,C)=>{const c=G;return pe(k)?(L(),E(c,{key:0,class:"draggable-button",style:pa({top:`${n.value.y}px`,left:`${n.value.x}px`}),onMousedown:x,onTouchstart:x,variant:"dashed",theme:"primary",onClick:b},{default:a(()=>[V(q(pe(p)?"显示":"隐藏"),1)]),_:1},8,["style"])):le("",!0)}}}),uu=ce(ru,[["__scopeId","data-v-1aee5506"]]),ht="DidaOJ",iu=ie({__name:"App",setup(e){const{globalProperties:l}=fe(),n=Ea(),u=Ee(),s=Ye(),y=Vt();n.$patch({Loaded:!1});const _=u.getToken,x=d(!1),f=d(!1);s.title&&s.title.length>0?document.title=s.title+" - "+ht:document.title=ht,s.$subscribe((k,b)=>{b.title&&b.title.length>0?document.title=b.title+" - "+ht:document.title=ht}),y.$subscribe((k,b)=>{x.value=b.showSidebar,f.value=x.value&&!b.forceHiddenSidebar});const o=ke(),T=Ge(()=>{const k=o.meta.auths;return k?!u.hasAllAuths(k):!1});function p(){l.$message.warning({duration:3e3,content:"登陆状态失效"}),n.$patch({Loaded:!0}),u.clear()}return me(()=>{document.addEventListener("DOMContentLoaded",()=>{ol.autoSpacingPage()}),_?Un().then(k=>{k.code==0?(u.loadResponse(k.data),n.$patch({Loaded:!0})):(F(l,k.code),n.$patch({Loaded:!0}),u.clear())}).catch(k=>{console.log(k),p()}):n.$patch({Loaded:!0})}),(k,b)=>{const g=Ll,i=Ul,m=Me("RouterView"),v=$l,C=jl,c=zl;return L(),ae(ue,null,[t(C,{class:"sh-app-layout"},{default:a(()=>[t(g,{class:"sh-header"},{default:a(()=>[t(Fr)]),_:1}),t(C,null,{default:a(()=>[t(sl,{name:"slide"},{default:a(()=>[f.value?(L(),E(i,{key:0,class:"sh-sidebar"},{default:a(()=>[t(Nr)]),_:1})):le("",!0)]),_:1}),t(C,{class:Rt(["sh-main-layout",{expanded:!f.value}])},{default:a(()=>[t(Wr),t(v,{class:"sh-main-content"},{default:a(()=>[T.value?(L(),E(Ma,{key:0})):(L(),E(m,{key:1}))]),_:1}),t(su)]),_:1},8,["class"])]),_:1})]),_:1}),x.value?(L(),E(uu,{key:0})):le("",!0),t(c,{container:"body",offset:["24px","80px"],size:"small"})],64)}}}),cu=ce(iu,[["__scopeId","data-v-62ffc342"]]);Ml({markdownItConfig(e){e.use(dl,"align-right",{render(l,n){return l[n].nesting===1?`<div class="sh-align-right">
`:`</div>
`}})},markdownItPlugins(e){return[...e,{type:"linkAttr",plugin:cl,options:{matcher(l){return!l.startsWith("#")},attrs:{target:"_blank"}}}]}});const qa=rl();qa.use(ul);const it=il(cu);it.use(qa);it.use(Z);it.use(Al);it.use(El);it.use(ql);it.mount("#app");Kl().then(()=>{console.log("Text cache reinitialized")}).catch(e=>{console.error("Text cache reinitialization failed",e)});
