import{ct as vt,d as ce,a as c,o as pe,cu as E,cv as V,cw as a,e as t,cx as R,cy as q,bE as P,cz as _a,aM as Ga,cA as Me,cB as le,cC as ee,F as me,cD as xe,cE as Ha,cF as Ba,cG as Se,bS as fe,cH as Ja,cI as Wa,cJ as Ya,b as De,v as pt,cK as Xa,cL as Xe,j as Je,w as $e,a9 as at,bc as Za,bd as Qa,cM as el,cN as tl,cO as al,br as ll,cP as Lt,cQ as ga,cR as ba,cj as nl,cS as ol,cT as sl,cU as rl,bX as il,cV as Qt,cW as Kt,cX as ul,bf as dl,aY as ha,z as cl,cY as ml,cZ as pl,c_ as fl,c$ as $t}from"./node_modules-DzJYoZ3M.js";import{L as Ve,C as be,R as Pe,a as Te,A as xt,S as vl,b as _l,c as gl,d as bl,e as hl,f as nt,T as et,B as O,F as Ue,g as ze,I as Ae,D as ot,h as ya,i as he,j as We,k as Ye,l as yl,m as Ee,n as _t,o as gt,P as Ft,O as Nt,p as Ot,q as wl,r as wa,s as kl,t as Sl,u as ka,v as Sa,w as Tt,x as Cl,y as Il,z as Pl,E as xl,G as Tl,H as Vl,J as Dl,M as Ca,K as Ia,N as jl,Q as Ll,U as $l,V as Ul,W as zl,X as Al,Y as Rl,Z as Ml,_ as El,$ as ql}from"./tdesign-vue-next-VkHX3IOx.js";import{u as _e,S as ge,a as we,b as N,G as He,H as dt,c as Ne,d as Kl,e as Pa,f as Fl,g as Nl,h as Ol,E as Gl,M as Hl,R as Bl}from"./md-editor-v3-WS7rfDbR.js";import{e as ea}from"./monaco-editor-ouHSYV7a.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const y of o)if(y.type==="childList")for(const f of y.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function n(o){const y={};return o.integrity&&(y.integrity=o.integrity),o.referrerPolicy&&(y.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?y.credentials="include":o.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function i(o){if(o.ep)return;o.ep=!0;const y=n(o);fetch(o.href,y)}})();var Le=(e=>(e.ManageWeb="i-manage-web",e.ManageJudge="i-manage-judge",e.ManageProblem="i-manage-problem",e.ManageProblemDaily="i-manage-problem-daily",e.ManageContest="i-manage-contest",e.ManageCollection="i-manage-collection",e.ManageDiscuss="i-manage-discuss",e))(Le||{});const Jl={"r-admin":["i-manage-web","i-manage-judge","i-manage-problem","i-manage-problem-daily","i-manage-contest","i-manage-collection","i-manage-discuss"]};function Wl(e){if(e==null)return[];const l=[];for(const n of e){const i=Jl[n];i!=null&&l.push(...i)}return[...new Set(l)]}function Yl(e,l){if(e==null||l==null)return!1;const n=Wl(e);for(const i of l)if(!n.includes(i))return!1;return!0}const Oe=vt("user",{state:()=>({token:"",userId:-1,username:"",nickname:"",roles:[]}),getters:{getToken(){return this.token},getUserId(){return this.userId},getUsername(){return this.username},getNickname(){return this.nickname}},actions:{clear(){this.$patch({token:"",userId:-1,username:"",nickname:"",roles:[]})},loadResponse(e){this.$patch({token:e.token,userId:e.user_id,username:e.username,nickname:e.nickname,roles:e.roles})},isLogin(){return this.token!=null&&this.token!=""},hasAuth(e){return this.hasAllAuths([e])},hasAllAuths(e){return e?Yl(this.roles,e):!0}},persist:!0}),Ze=vt("webStyle",{state:()=>({title:""}),getters:{getTitle(){return this.title}},actions:{setTitle(e){this.title=e}}}),Vt=vt("sidebarStyle",{state:()=>({showSidebar:!1,forceHiddenSidebar:!1,menuActiveName:"",menuList:[]}),getters:{getMenuList(){return this.menuList}},actions:{setSidebarShow(e){this.showSidebar=e},setForceHiddenSidebar(e){this.forceHiddenSidebar=e},setMenuActiveName(e){this.menuActiveName=e},clearMenuList(){this.menuList=[]},setMenuList(e){this.menuList=e},addMenuList(e){this.menuList.push(e)}}}),Xl={style:{"text-align":"right"}},Zl=ce({__name:"Hitokoto",setup(e){const l=c(!1),n=c(""),i=c(""),o=c(""),y=async()=>{l.value=!0;try{const C=await(await fetch("https://v1.hitokoto.cn")).json();i.value=C.hitokoto,o.value=C.creator,n.value="—— "+C.from}catch(f){i.value="一言获取失败了，但至少您还可以访问本站。",o.value="BoilTask",n.value="DidaOJ",console.error("Error fetching Hitokoto:",f)}finally{l.value=!1}};return pe(()=>{y()}),(f,C)=>{const p=be,s=Ve;return V(),E(s,{loading:l.value},{default:a(()=>[t(p,{title:"一言 © Hitokoto"},{actions:a(()=>[P(" @"+q(o.value),1)]),default:a(()=>[R("div",null,[R("span",null,q(i.value),1),R("p",Xl,q(n.value),1)])]),_:1})]),_:1},8,["loading"])}}}),Ql="https://oj-api.didapipa.com/",G=_a.create({baseURL:Ql,timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});G.interceptors.request.use(e=>{const n=Oe().getToken;return n&&(e.headers["X-Token"]=n),e},e=>Promise.reject(e));G.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});const Dt=_a.create({timeout:6e4,withCredentials:!1,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});Dt.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function xa(){return Dt({baseURL:"https://r2-oj.didapipa.com",url:"/system/notification.json?"+Date.now(),method:"get"})}function Ta(){return Dt({baseURL:"https://r2-oj.didapipa.com",url:"/system/announcement.json?"+Date.now(),method:"get"})}function en(){return G({url:"/system/status",method:"get"})}function tn(){return G({url:"/system/image/token",method:"get"})}function an(e,l){return G({url:"/system/notification",method:"post",data:{theme:e,content:l}})}function ln(e,l){return G({url:"/system/announcement",method:"post",data:{title:e,content:l}})}var jt=(e=>(e[e.Unknown=-1]="Unknown",e[e.C=0]="C",e[e.Cpp=1]="Cpp",e[e.Java=2]="Java",e[e.Python=3]="Python",e[e.Pascal=4]="Pascal",e[e.Golang=5]="Golang",e[e.Lua=6]="Lua",e[e.TypeScript=7]="TypeScript",e[e.Max=8]="Max",e))(jt||{});function Gt(){const e=[-1,8];return Object.values(jt).filter(l=>typeof l=="number"&&!e.includes(l)).map(l=>({value:l,label:It(l)}))}function St(e){return e>-1&&e<8}function It(e){switch(e){case 0:return"C";case 1:return"C++";case 2:return"Java";case 3:return"Python";case 4:return"Pascal";case 5:return"Golang";case 6:return"Lua";case 7:return"TypeScript";default:return"未知"}}function Ht(e){switch(e){case 0:return"c";case 1:return"cpp";case 2:return"java";case 3:return"python";case 4:return"pascal";case 5:return"go";case 6:return"lua";case 7:return"typescript";default:return"text"}}var Be=(e=>(e[e.Init=0]="Init",e[e.Rejudge=1]="Rejudge",e[e.Submitting=2]="Submitting",e[e.Queuing=3]="Queuing",e[e.Compiling=4]="Compiling",e[e.Running=5]="Running",e[e.Accept=6]="Accept",e[e.PE=7]="PE",e[e.WA=8]="WA",e[e.TLE=9]="TLE",e[e.MLE=10]="MLE",e[e.OLE=11]="OLE",e[e.RE=12]="RE",e[e.CE=13]="CE",e[e.CLE=14]="CLE",e[e.JudgeFail=15]="JudgeFail",e[e.SubmitFail=16]="SubmitFail",e[e.Unknown=17]="Unknown",e[e.Max=18]="Max",e))(Be||{});const nn=e=>{switch(e){case 0:return"普通评测";case 1:return"特殊评测";default:return"未知"}},Pt=e=>{switch(e){case 0:return"等待处理";case 1:return"重新评测";case 2:return"提交中";case 3:return"队列中";case 4:return"编译中";case 5:return"运行中";case 6:return"通过";case 7:return"格式错误";case 8:return"答案错误";case 9:return"超时";case 10:return"内存超限";case 11:return"输出超限";case 12:return"运行错误";case 13:return"编译错误";case 14:return"编译超限";case 15:return"评测失败";case 16:return"提交失败";case 17:return"未知";default:return e}},ta=e=>{if(e!==void 0)switch(e){case 0:return"已经提交到系统，请耐心等待评测结果";case 1:return"管理员发起了重新评测，请耐心等待评测结果";case 2:return"判题机已经接受了本次提交，正在提交到远程判官中";case 3:return"判题机已经接受了本次提交，正在排队等待评测";case 4:return"判题机正在编译您的代码，部分语言会在此步检查是否符合语法";case 5:return"您的代码正在运行，请等待运行结果";case 6:return"您的代码通过了测试用例，恭喜您！";case 7:return"您的代码基本正确，但可能存在空格、空行等格式错误，请认真对比输出要求";case 8:return"您的答案与标准答案存在区别，请继续思考有无未考虑的情况";case 9:return"运行您的代码所用的时间超过了题目限制，请思考时间上更优的解法";case 10:return"运行您的代码所用的内存超过了题目限制，请思考空间上更优的解法";case 11:return"您程序的输出内容远远多于了题目要求（一般是数倍于正确输出），请检查相关逻辑";case 12:return"在运行您程序的过程中发生了异常，可能是除零、数组越界等问题，请检查相关逻辑";case 13:return"您的代码在编译阶段发生了错误，可能是语法错误或其他编译问题，请检查相关逻辑";case 14:return"在编译您代码的过程中，所占用的资源远远超过了要求，请检查相关逻辑";case 15:return"评测过程中发生了异常，一般是判题机或远程判官的问题，可尝试联系管理员处理";case 16:return"在将您的代码提交到远程判官的过程中发生了错误，一般是判题机或远程判官的问题，可联系管理员处理";case 17:return"您的代码状态未知，有可能是您不具有权限，或者该代码状态被隐藏"}return"暂时无提示信息"},Va=e=>{switch(e){case 0:case 1:case 2:case 3:case 4:case 5:case 17:return"default";case 6:return"success";case 7:return"warning";default:return"danger"}};function Da(){const e=[17,18];return Object.values(Be).filter(l=>typeof l=="number"&&!e.includes(l)).map(l=>({value:l,label:Pt(l)}))}function Ct(e){return e>=0&&e<17}function ut(e){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return!0;default:return!1}}function ja(e){var n;const l={};if(l.id=e.id,l.problemId=e.problem_id,l.contestProblemIndex=e.contest_problem_index,l.status=e.status,ut(e.status)||!Ct(e.status)?l.score="-":l.score=(e.score/10).toString(),e.time?l.time=Math.ceil(e.time/1e6)+"ms":l.time="-",e.memory?l.memory=(e.memory/1024/1024).toFixed(2)+"MB":l.memory="-",l.language=e.language,l.codeLength=e.code_length,e.approve_time?l.approveTime=new Date(e.approve_time).toLocaleString():l.approveTime="-",l.author=e.author,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.code=e.code,l.compileMessage=e.compile_message,l.taskCurrent=e.task_current,l.taskTotal=e.task_total,l.task=[],e.task)for(let i=0;i<((n=e.task)==null?void 0:n.length);i++){const o=e.task[i],y={};y.taskId=o.task_id,y.status=o.status,o.time?y.time=Math.ceil(o.time/1e6)+"ms":y.time="-",o.memory?y.memory=(o.memory/1024/1024).toFixed(2)+"MB":y.memory="-",o.score?y.score=(o.score/10).toString():y.score="-",y.content=o.content,y.waHint=o.wa_hint,l.task.push(y)}return e.judger&&(l.judger=e.judger),e.judger_name?l.judgerName=e.judger_name:l.judgerName="-",e.judge_time&&(l.judgeTime=new Date(e.judge_time).toLocaleString()),l}function on(e,l,n,i,o){return G({url:"/judge/approve",method:"post",data:{problem_id:e,contest_id:l,problem_index:n,language:i,code:o}})}function sn(e,l){let n={id:e};return l&&(n.contest_id=l),G({url:"/judge?"+new URLSearchParams(n).toString(),method:"get"})}function rn(e){return G({url:"/judge/code?id="+e,method:"get"})}function un(e,l,n,i,o,y,f){let C={problem_id:l,username:n,language:String(i),status:String(o),page:String(y),page_size:String(f)};return e&&(C.contest_id=String(e)),G({url:`/judge/list?${new URLSearchParams(C).toString()}`,method:"get"})}function dn(){return G({url:"/judge/statics/recently",method:"get"})}function cn(){return G({url:"/judge/rejudge/recently",method:"post"})}function mn(e,l,n){const i={};return e!=null&&(i.problem_id=e),l!=null?i.language=l:i.language=jt.Unknown,n!=null?i.status=n:i.status=18,G({url:"/judge/rejudge/search",method:"post",data:i})}function pn(){return G({url:"/judge/rejudge/all",method:"post",timeout:0})}function fn(e){return G({url:"/judge/rejudge",method:"post",data:{id:Number(e)}})}var Ge=(e=>(e[e.None=0]="None",e[e.Attempt=1]="Attempt",e[e.Accept=2]="Accept",e))(Ge||{});function bt(e,l){const n={};if(n.id=e.id,n.author=e.author,n.title=e.title,n.tags=[],e.tags)for(const i of e.tags){const o=l[i];o&&n.tags.push(o)}if(n.private=e.private,n.accept=e.accept,n.attempt=e.attempt,e.description!=null&&(n.description=e.description),e.time_limit!=null&&e.time_limit>=0?n.timeLimit=e.time_limit.toString()+" ms":n.timeLimit="未知",e.memory_limit!=null&&e.memory_limit>=0?n.memoryLimit=(e.memory_limit/1024).toFixed(2)+" MB":n.memoryLimit="未知",e.judge_type!=null&&(n.judgeType=nn(e.judge_type)),e.insert_time!=null&&(n.insertTime=new Date(e.insert_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.source!=null){const i=/\[([^\]]+)\]\(([^)]+)\)/,o=e.source.match(i);o?(n.source=o[1],n.sourceUrl=o[2]):(n.source=e.source,n.sourceUrl="")}return e.judge_md5!=null&&(n.judgeMd5=e.judge_md5),e.origin_oj!=null&&(n.originOj=e.origin_oj),e.origin_id!=null&&(n.originId=e.origin_id),e.origin_url!=null&&(n.originUrl=e.origin_url),n}function La(e,l){const n={};if(n.id=e.id,n.problemId=e.problem_id,n.title=e.title,n.tags=[],e.tags)for(const i of e.tags){const o=l[i];o&&n.tags.push(o)}return e.accept?n.accept=e.accept:n.accept=0,e.attempt?n.attempt=e.attempt:n.attempt=0,n.solution=e.solution,n.code=e.code,e.create_time!=null&&(n.createTime=new Date(e.create_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.updater_nickname!=null&&(n.updaterNickname=e.updater_nickname),n}function $a(e,l,n){const i={};return e?i.id=e:(i.contest_id=l,i.problem_index=n),G({url:`/problem?${new URLSearchParams(i).toString()}`,method:"get"})}function Ua(e){return G({url:"/problem/tag/list?max_count="+e,method:"get"})}function vn(e){return G({url:"/problem/judge?id="+e,method:"get"})}function _n(e,l,n,i,o,y){const f={};return e&&(f.oj=e),l&&(f.title=l),n&&(f.tag=n),i!==void 0&&(f.private=i?"1":"0"),o&&(f.page=o),y&&(f.page_size=y),G({url:`/problem/list?${new URLSearchParams(f).toString()}`,method:"get"})}function gn(e){const l={};return e&&(l.problem_id=e),G({url:`/problem/recommend?${new URLSearchParams(l).toString()}`,method:"get"})}function bn(e){return G({url:"/problem/daily?id="+e,method:"get"})}function hn(e){return G({url:"/problem/daily/edit?id="+e,method:"get"})}function yn(){return G({url:"/problem/daily/recently",method:"get"})}function wn(e,l,n,i,o){const y={};return e&&(y.start_date=e),l&&(y.end_date=l),n&&(y.problem_id=n),i&&(y.page=i),o&&(y.page_size=o),G({url:`/problem/daily/list?${new URLSearchParams(y).toString()}`,method:"get"})}function kn(e){return G({url:"/problem/attempt/status",method:"get",params:{ids:e.join(",")}})}function za(e,l){return G({url:"/problem/crawl",method:"post",data:{oj:e,id:l}})}function Sn(e,l,n,i,o,y,f){return G({url:"/problem/create",method:"post",data:{title:e,time_limit:l,memory_limit:n,source:i,private:o,tags:y,description:f}})}function Cn(e,l,n,i,o,y,f,C){return G({url:"/problem/edit",method:"post",data:{id:e,title:l,time_limit:n,memory_limit:i,source:o,private:y,tags:f,description:C}})}function In(e,l,n,i){return G({url:"/problem/daily/create",method:"post",data:{id:e,problem_id:l,solution:n,code:i}})}function Pn(e,l,n,i){return G({url:"/problem/daily/edit",method:"post",data:{id:e,problem_id:l,solution:n,code:i}})}function xn(e,l){return G({url:"/problem/judge/data/download?id="+e+"&key="+l,method:"get"})}function Tn(e){return e||(e=""),G({url:"/problem/image/token?id="+e,method:"get"})}function Vn(e){return e||(e=""),G({url:"/problem/daily/image/token?id="+e,method:"get"})}function Dn(e,l){const n=new FormData;return n.append("id",e),n.append("zip",l),G({url:"/problem/judge/data",method:"post",data:n,headers:{"Content-Type":"multipart/form-data"},timeout:1e3*60*5})}function jn(e){return G({url:"/problem/parse",method:"post",data:{problems:e}})}const Ln={class:"sh-main"},$n={class:"dida-swiper-div"},Un=ce({__name:"HomeView",setup(e){const{globalProperties:l}=_e();let n=-1;const i=c({theme:"info",content:""}),o=c({title:"",content:""}),y=c([]),f=c(!1),C=c(!1),p=c(!1),s=async()=>{i.value=await xa()},$=async()=>{try{const k=await Ta();o.value.title=k.title,o.value.content=k.content}catch{ge(l,"加载公告失败"),o.value={title:"公告加载失败",content:"请刷新页面重新获取"}}},v=async()=>{const k=await dn();if(k.code!==0){ge(l,"加载OJ统计数据失败");return}let b=[];for(const _ of k.data){const g=new Date(_.date),d=`${g.getMonth()+1}-${g.getDate()}`;b.push({Date:d,Type:"Unaccept",Count:_.attempt-_.accept}),b.push({Date:d,Type:"Accept",Count:_.accept})}const S={type:"bar",data:[{id:"barData",values:b}],xField:"Date",yField:"Count",seriesField:"Type",stack:!0,legends:{visible:!0},bar:{state:{hover:{stroke:"#000",lineWidth:1}}},height:300};new Ha(S,{dom:"ojStaticsDiv"}).renderSync()},x=async()=>{y.value=[];const k=await yn();if(k.code!==0){ge(l,"加载每日问题数据失败");return}k.data.list&&k.data.list.length>0&&k.data.list.forEach(b=>{let S="default",u="未尝试";if(k.data.attempt_status){const g=k.data.attempt_status[b.problem_id];if(g)switch(g){case Ge.Accept:S="success",u="已解决";break;case Ge.Attempt:S="warning",u="待解决";break;default:S="default",u="未尝试"}}const _=`${b.title}`;y.value.push({id:b.id,title:_,problemId:b.problem_id,theme:S,tag:u})})};return pe(async()=>{p.value=!0,f.value=!0,C.value=!0,(async()=>(await s(),n=setInterval(()=>{s()},3e4),await $(),p.value=!1))(),(async()=>(await v(),f.value=!1))(),(async()=>(await x(),C.value=!1))()}),Ga(()=>{clearInterval(n)}),(k,b)=>{const S=xt,u=_l,_=vl,g=Ve,d=Me("md-preview"),r=be,A=Te,m=nt,w=hl,U=et,h=bl,I=gl,j=Pe;return V(),E(g,{loading:p.value},{default:a(()=>[t(j,null,{default:a(()=>[t(A,{span:8},{default:a(()=>{var D;return[R("div",Ln,[i.value?(V(),E(S,{key:0,class:"dida-notification-div",theme:i.value.theme},{default:a(()=>[P(q(i.value.content),1)]),_:1},8,["theme"])):le("",!0),R("div",$n,[t(_,{class:"dida-swiper"},{default:a(()=>[t(u,null,{default:a(()=>b[1]||(b[1]=[R("a",{href:"http://codeoj.cn",target:"_blank"},[R("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"})],-1)])),_:1}),t(u,null,{default:a(()=>b[2]||(b[2]=[R("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1})]),_:1})]),t(g,{loading:f.value&&!p.value},{default:a(()=>b[3]||(b[3]=[R("div",{id:"ojStaticsDiv",style:{"min-height":"200px"}},null,-1)])),_:1},8,["loading"]),t(r,{title:(D=o.value)==null?void 0:D.title,style:{width:"calc(100% - 100px)",margin:"0 auto"}},{default:a(()=>{var T;return[t(d,{"model-value":(T=o.value)==null?void 0:T.content,previewTheme:"cyanosis"},null,8,["model-value"])]}),_:1},8,["title"])])]}),_:1}),t(A,{span:4},{default:a(()=>[t(r,{style:{margin:"10px"},bordered:!0},{default:a(()=>b[4]||(b[4]=[R("img",{src:"https://api.jysafe.cn/ip/",alt:"Welcome",style:{width:"100%"}},null,-1)])),_:1}),t(Zl,{style:{margin:"10px"}}),t(r,{style:{margin:"10px"},bordered:!0,title:"每日一题"},{actions:a(()=>[t(m,{onClick:b[0]||(b[0]=D=>k.$router.push({name:"problem-daily-list"}))},{default:a(()=>b[5]||(b[5]=[P("查看全部")])),_:1})]),default:a(()=>[t(g,{loading:C.value&&!p.value},{default:a(()=>[t(I,{split:!0,size:"small",style:{"min-height":"200px"}},{default:a(()=>[(V(!0),ee(me,null,xe(y.value,D=>(V(),E(h,{key:D.id},{default:a(()=>[t(w,{style:{width:"100px"}},{description:a(()=>[t(m,{onClick:T=>k.$router.push({name:"problem-daily-detail",params:{dailyId:D.id}})},{default:a(()=>[P(q(D.problemId),1)]),_:2},1032,["onClick"])]),_:2},1024),t(w,{style:{width:"200px"}},{description:a(()=>[t(m,{onClick:T=>k.$router.push({name:"problem-daily-detail",params:{dailyId:D.id}})},{default:a(()=>[P(q(D.title),1)]),_:2},1032,["onClick"])]),_:2},1024),t(w,{style:{width:"135px"},description:D.id},null,8,["description"]),t(w,null,{description:a(()=>[t(U,{theme:D.theme},{default:a(()=>[P(q(D.tag),1)]),_:2},1032,["theme"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["loading"])]),_:1}),t(r,{style:{margin:"10px"},bordered:!0},{header:a(()=>b[6]||(b[6]=[R("b",null,"友情链接",-1)])),default:a(()=>[t(I,null,{default:a(()=>[t(h,null,{default:a(()=>[t(m,{href:"https://oi-wiki.org/",target:"_blank"},{default:a(()=>b[7]||(b[7]=[P("OI Wiki")])),_:1})]),_:1}),t(h,null,{default:a(()=>[t(m,{href:"https://boiltask.com",target:"_blank"},{default:a(()=>b[8]||(b[8]=[P("BoilTask Blog")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])}}}),de=(e,l)=>{const n=e.__vccOpts||e;for(const[i,o]of l)n[i]=o;return n},zn=de(Un,[["__scopeId","data-v-6863c4ff"]]),An={},Rn={style:{margin:"20px"}};function Mn(e,l){return V(),ee("div",Rn,l[0]||(l[0]=[Ba('<header data-v-f3135951><h1 data-v-f3135951>算法设计高级课程方案</h1><p data-v-f3135951>分治策略 · 动态规划 · 贪心算法 · 回溯算法</p></header><div class="section" data-v-f3135951><h2 data-v-f3135951>一、课程核心知识点</h2><div class="two-columns" data-v-f3135951><div class="column" data-v-f3135951><h3 data-v-f3135951>1. 分治策略 (Divide and Conquer)</h3><p data-v-f3135951>分治算法是一种将问题分解为若干子问题，递归解决子问题，再合并子问题解得到原问题解的算法策略:cite[1]:cite[4]。</p><ul data-v-f3135951><li data-v-f3135951><span class="highlight" data-v-f3135951>基本思想</span>：将大问题分解为k个较小规模的相同子问题</li><li data-v-f3135951><span class="highlight" data-v-f3135951>关键特征</span>：子问题相互独立且与原问题形式相同</li><li data-v-f3135951><span class="highlight" data-v-f3135951>典型应用</span>：归并排序、快速排序、大整数乘法</li><li data-v-f3135951><span class="highlight" data-v-f3135951>复杂度分析</span>：主定理(Master Theorem)的应用</li></ul><h3 data-v-f3135951>2. 动态规划 (Dynamic Programming)</h3><p data-v-f3135951>动态规划通过保存子问题的解避免重复计算，适用于具有最优子结构和重叠子问题性质的问题:cite[1]:cite[6]。</p><ul data-v-f3135951><li data-v-f3135951><span class="highlight" data-v-f3135951>基本思想</span>：记忆化存储，自底向上求解</li><li data-v-f3135951><span class="highlight" data-v-f3135951>关键特征</span>：最优子结构、重叠子问题、无后效性</li><li data-v-f3135951><span class="highlight" data-v-f3135951>典型应用</span>：背包问题、最长公共子序列、最短路径</li><li data-v-f3135951><span class="highlight" data-v-f3135951>设计步骤</span>：定义状态、状态转移方程、边界条件</li></ul></div><div class="column" data-v-f3135951><h3 data-v-f3135951>3. 贪心算法 (Greedy Algorithm)</h3><p data-v-f3135951>贪心算法在每一步做出局部最优选择，希望最终得到全局最优解:cite[1]:cite[5]。</p><ul data-v-f3135951><li data-v-f3135951><span class="highlight" data-v-f3135951>基本思想</span>：当前状态下做出最好选择，不回溯</li><li data-v-f3135951><span class="highlight" data-v-f3135951>关键特征</span>：贪心选择性质、最优子结构</li><li data-v-f3135951><span class="highlight" data-v-f3135951>典型应用</span>：霍夫曼编码、最小生成树、任务调度</li><li data-v-f3135951><span class="highlight" data-v-f3135951>局限性</span>：不保证全局最优，需证明正确性</li></ul><h3 data-v-f3135951>4. 回溯算法 (Backtracking)</h3><p data-v-f3135951>回溯法通过深度优先搜索解空间树，通过剪枝避免无效搜索:cite[1]:cite[7]。</p><ul data-v-f3135951><li data-v-f3135951><span class="highlight" data-v-f3135951>基本思想</span>：系统搜索解空间，走不通就回溯</li><li data-v-f3135951><span class="highlight" data-v-f3135951>关键特征</span>：解空间树、约束函数、限界函数</li><li data-v-f3135951><span class="highlight" data-v-f3135951>典型应用</span>：八皇后问题、图着色、组合优化</li><li data-v-f3135951><span class="highlight" data-v-f3135951>优化技巧</span>：剪枝策略、启发式搜索</li></ul></div></div></div><div class="section" data-v-f3135951><h2 data-v-f3135951>二、专题化案例建设</h2><p data-v-f3135951>从各大竞赛平台选取真实案例，将算法理论应用于实际问题解决。</p><div class="case-study" data-v-f3135951><h3 data-v-f3135951>案例1：电商平台优惠券分配优化（阿里天池）</h3><p data-v-f3135951><strong data-v-f3135951>适用算法</strong>：动态规划、贪心算法</p><p data-v-f3135951><strong data-v-f3135951>问题描述</strong>：在预算限制下，如何分配优惠券以最大化平台GMV。</p><p data-v-f3135951><strong data-v-f3135951>教学要点</strong>：</p><ul data-v-f3135951><li data-v-f3135951>建立价值-成本模型</li><li data-v-f3135951>设计状态转移方程</li><li data-v-f3135951>比较贪心策略与动态规划效果</li></ul></div><div class="case-study" data-v-f3135951><h3 data-v-f3135951>案例2：医疗影像分割（Kaggle）</h3><p data-v-f3135951><strong data-v-f3135951>适用算法</strong>：分治策略</p><p data-v-f3135951><strong data-v-f3135951>问题描述</strong>：将大型医疗影像分割处理，提高分析效率。</p><p data-v-f3135951><strong data-v-f3135951>教学要点</strong>：</p><ul data-v-f3135951><li data-v-f3135951>图像分块处理策略</li><li data-v-f3135951>并行计算与结果合并</li><li data-v-f3135951>分治粒度对性能的影响</li></ul></div><div class="case-study" data-v-f3135951><h3 data-v-f3135951>案例3：网络路由优化（华为开发者大赛）</h3><p data-v-f3135951><strong data-v-f3135951>适用算法</strong>：回溯算法</p><p data-v-f3135951><strong data-v-f3135951>问题描述</strong>：在复杂网络拓扑中找到最优数据传输路径。</p><p data-v-f3135951><strong data-v-f3135951>教学要点</strong>：</p><ul data-v-f3135951><li data-v-f3135951>解空间树的构建</li><li data-v-f3135951>剪枝条件设计</li><li data-v-f3135951>回溯与分支限界的比较</li></ul></div><table data-v-f3135951><tr data-v-f3135951><th data-v-f3135951>竞赛平台</th><th data-v-f3135951>案例类型</th><th data-v-f3135951>适用算法</th><th data-v-f3135951>技能培养重点</th></tr><tr data-v-f3135951><td data-v-f3135951>百度AI Studio</td><td data-v-f3135951>自然语言处理</td><td data-v-f3135951>动态规划</td><td data-v-f3135951>序列对齐、编辑距离</td></tr><tr data-v-f3135951><td data-v-f3135951>阿里天池</td><td data-v-f3135951>推荐系统</td><td data-v-f3135951>贪心算法</td><td data-v-f3135951>实时决策、局部最优</td></tr><tr data-v-f3135951><td data-v-f3135951>Kaggle</td><td data-v-f3135951>数据挖掘</td><td data-v-f3135951>分治策略</td><td data-v-f3135951>大数据处理、并行计算</td></tr><tr data-v-f3135951><td data-v-f3135951>华为云大赛</td><td data-v-f3135951>网络优化</td><td data-v-f3135951>回溯算法</td><td data-v-f3135951>解空间探索、剪枝优化</td></tr></table></div><div class="section" data-v-f3135951><h2 data-v-f3135951>三、学术训练模块</h2><p data-v-f3135951>精选与课程知识点相关的经典学术论文，培养学生学术研究能力。</p><div class="paper-analysis" data-v-f3135951><h3 data-v-f3135951>论文1：动态规划在生物信息学中的应用</h3><p data-v-f3135951><strong data-v-f3135951>关联知识点</strong>：动态规划</p><p data-v-f3135951><strong data-v-f3135951>核心内容</strong>：Smith-Waterman算法在序列比对中的应用</p><p data-v-f3135951><strong data-v-f3135951>教学安排</strong>：</p><ol data-v-f3135951><li data-v-f3135951>论文精读：算法设计思想</li><li data-v-f3135951>复现实验：实现基础算法</li><li data-v-f3135951>性能分析：时间复杂度与空间复杂度</li><li data-v-f3135951>改进讨论：可能的优化方向</li></ol></div><div class="paper-analysis" data-v-f3135951><h3 data-v-f3135951>论文2：贪心算法的近似比证明</h3><p data-v-f3135951><strong data-v-f3135951>关联知识点</strong>：贪心算法</p><p data-v-f3135951><strong data-v-f3135951>核心内容</strong>：集合覆盖问题的贪心算法近似比分析</p><p data-v-f3135951><strong data-v-f3135951>教学安排</strong>：</p><ol data-v-f3135951><li data-v-f3135951>问题建模：形式化描述集合覆盖</li><li data-v-f3135951>算法设计：贪心策略实现</li><li data-v-f3135951>理论证明：近似比推导</li><li data-v-f3135951>实验验证：与最优解比较</li></ol></div><div class="paper-analysis" data-v-f3135951><h3 data-v-f3135951>论文3：分治算法的并行化实现</h3><p data-v-f3135951><strong data-v-f3135951>关联知识点</strong>：分治策略</p><p data-v-f3135951><strong data-v-f3135951>核心内容</strong>：MapReduce框架下的分治算法设计</p><p data-v-f3135951><strong data-v-f3135951>教学安排</strong>：</p><ol data-v-f3135951><li data-v-f3135951>算法分解：任务划分策略</li><li data-v-f3135951>并行实现：MapReduce编程</li><li data-v-f3135951>性能评估：加速比分析</li><li data-v-f3135951>应用讨论：大数据场景适用性</li></ol></div></div><div class="section" data-v-f3135951><h2 data-v-f3135951>四、分类培养方案</h2><p data-v-f3135951>针对专业型硕士和学术型硕士的不同培养目标，设计差异化教学内容。</p><div class="two-columns" data-v-f3135951><div class="column learning-path" data-v-f3135951><h3 data-v-f3135951>专业型硕士培养路径</h3><p data-v-f3135951><strong data-v-f3135951>培养目标</strong>：算法工程实现能力、实际问题解决能力</p><p data-v-f3135951><strong data-v-f3135951>教学重点</strong>：</p><ul data-v-f3135951><li data-v-f3135951>算法实现技巧与优化</li><li data-v-f3135951>工业界案例分析</li><li data-v-f3135951>性能调优与工程实践</li><li data-v-f3135951>团队协作开发</li></ul><p data-v-f3135951><strong data-v-f3135951>评估方式</strong>：</p><ol data-v-f3135951><li data-v-f3135951>竞赛项目实战</li><li data-v-f3135951>算法优化报告</li><li data-v-f3135951>系统性能评测</li></ol></div><div class="column learning-path" data-v-f3135951><h3 data-v-f3135951>学术型硕士培养路径</h3><p data-v-f3135951><strong data-v-f3135951>培养目标</strong>：算法理论研究能力、创新思维能力</p><p data-v-f3135951><strong data-v-f3135951>教学重点</strong>：</p><ul data-v-f3135951><li data-v-f3135951>算法正确性证明</li><li data-v-f3135951>复杂度分析理论</li><li data-v-f3135951>前沿论文研读</li><li data-v-f3135951>算法改进与创新</li></ul><p data-v-f3135951><strong data-v-f3135951>评估方式</strong>：</p><ol data-v-f3135951><li data-v-f3135951>学术论文阅读报告</li><li data-v-f3135951>理论证明作业</li><li data-v-f3135951>研究性课题论文</li></ol></div></div><table data-v-f3135951><tr data-v-f3135951><th data-v-f3135951>教学环节</th><th data-v-f3135951>专业型硕士</th><th data-v-f3135951>学术型硕士</th></tr><tr data-v-f3135951><td data-v-f3135951>案例教学</td><td data-v-f3135951>70%课时</td><td data-v-f3135951>40%课时</td></tr><tr data-v-f3135951><td data-v-f3135951>理论证明</td><td data-v-f3135951>20%课时</td><td data-v-f3135951>50%课时</td></tr><tr data-v-f3135951><td data-v-f3135951>论文研读</td><td data-v-f3135951>10%课时</td><td data-v-f3135951>40%课时</td></tr><tr data-v-f3135951><td data-v-f3135951>实践项目</td><td data-v-f3135951>必做</td><td data-v-f3135951>选做</td></tr><tr data-v-f3135951><td data-v-f3135951>研究论文</td><td data-v-f3135951>选做</td><td data-v-f3135951>必做</td></tr></table></div><div class="section" data-v-f3135951><h2 data-v-f3135951>五、课程评估与反馈</h2><p data-v-f3135951>建立多元化的课程评估体系，持续改进教学质量。</p><h3 data-v-f3135951>1. 学生评估方式</h3><ul data-v-f3135951><li data-v-f3135951><span class="highlight" data-v-f3135951>平时作业</span>：算法实现与理论证明(30%)</li><li data-v-f3135951><span class="highlight" data-v-f3135951>期中项目</span>：竞赛案例解决方案(20%)</li><li data-v-f3135951><span class="highlight" data-v-f3135951>期末考核</span>：综合设计与理论分析(30%)</li><li data-v-f3135951><span class="highlight" data-v-f3135951>课堂参与</span>：讨论与报告(20%)</li></ul><h3 data-v-f3135951>2. 教学反馈机制</h3><ul data-v-f3135951><li data-v-f3135951>每周在线问卷调查</li><li data-v-f3135951>每月师生座谈会</li><li data-v-f3135951>课程内容动态调整</li><li data-v-f3135951>竞赛成绩追踪分析</li></ul></div>',6)]))}const En=de(An,[["render",Mn],["__scopeId","data-v-f3135951"]]),qn={class:"sh-main"},Kn=ce({__name:"View404",setup(e){let l=Se(),n=c(l.fullPath);return(i,o)=>{const y=O;return V(),ee("div",qn,[R("p",null,q(fe(n)),1),o[2]||(o[2]=R("p",null,"该页面无效或已被迁移，请重新选择访问目标",-1)),t(y,{theme:"primary",onClick:o[0]||(o[0]=()=>i.$router.push("/"))},{default:a(()=>o[1]||(o[1]=[P("返回首页")])),_:1})])}}}),Aa=de(Kn,[["__scopeId","data-v-d4218944"]]);function Fn(e){const l={};return l.id=e.id,l.username=e.username,l.nickname=e.nickname,l.email=e.email,l.slogan=e.slogan,l.organization=e.organization,l.accept=e.accept,l.attempt=e.attempt,l.vjudgeId=e.vjudge_id,e.email&&(l.avatar=`https://www.gravatar.com/avatar/${Ja(e.email.toLowerCase().trim())}?d=identicon&s=100`),l}function Nn(e,l){return G({url:"/user/login",method:"post",data:{username:e,password:l}})}function On(){return G({url:"/user/login/refresh",method:"post"})}function Gn(e){const l={username:e};return G({url:`/user/info?${new URLSearchParams(l).toString()}`,method:"get"})}function Hn(e){const l="https://vjudge.net/user/solveDetail/"+encodeURIComponent(e);return Dt({url:l,method:"get"})}function Bn(e){return G({url:"/user/account/infos",method:"post",data:{users:e}})}function Jn(e){return G({url:"/user/parse",method:"post",data:{users:e}})}function Wn(e,l){return G({url:"/user/register/email",method:"post",data:{token:e,email:l}})}function Yn(e,l,n,i,o){return G({url:"/user/register",method:"post",data:{username:e,password:l,email:n,key:i,nickname:o}})}function Xn(e,l){return G({url:"/user/forget",method:"post",data:{token:e,username:l}})}function Zn(e,l,n){return G({url:"/user/password/modify",method:"post",data:{username:e,password:l,key:n}})}const Qn={class:"dida-login-footer"},eo=ce({__name:"LoginView",setup(e){const{globalProperties:l}=_e(),n=Oe(),i=c(!1),o=c({username:"",password:""}),y=()=>{we(l,"重置成功")},f=({validateResult:C,firstError:p})=>{i.value||(i.value=!0,Nn(o.value.username,o.value.password).then(s=>{if(s.code===0){n.loadResponse(s.data),we(l,"登录成功");let $=l.$route.query.redirect_uri;$||($="/user/"+s.data.username),l.$router.push({path:$})}else N(l,s.code)}).catch(s=>{console.error("Login error",s),ge(l,"登录失败")}).finally(()=>{i.value=!1}))};return pe(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),(C,p)=>{const s=Ae,$=ze,v=O,x=Ue,k=nt,b=be;return V(),E(b,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(x,{ref:"form",data:o.value,colon:!0,onReset:y,onSubmit:f,class:"yj-login-form","label-width":0},{default:a(()=>[t($,{name:"username"},{default:a(()=>[t(s,{modelValue:o.value.username,"onUpdate:modelValue":p[0]||(p[0]=S=>o.value.username=S),clearable:"",autocomplete:"username",placeholder:"请输入用户名"},{"prefix-icon":a(()=>[t(fe(Wa))]),_:1},8,["modelValue"])]),_:1}),t($,{name:"password"},{default:a(()=>[t(s,{modelValue:o.value.password,"onUpdate:modelValue":p[1]||(p[1]=S=>o.value.password=S),type:"password",autocomplete:"current-password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":a(()=>[t(fe(Ya))]),_:1},8,["modelValue"])]),_:1}),t($,null,{default:a(()=>[t(v,{theme:"primary",type:"submit",block:"",loading:i.value},{default:a(()=>p[4]||(p[4]=[P("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),R("div",Qn,[t(k,{onClick:p[2]||(p[2]=()=>{fe(l).$router.push({name:"login-forget"})})},{default:a(()=>p[5]||(p[5]=[P("忘记密码 ")])),_:1}),t(k,{onClick:p[3]||(p[3]=()=>{fe(l).$router.push({name:"register"})})},{default:a(()=>p[6]||(p[6]=[P("注册账户 ")])),_:1})])]),_:1})}}}),to=de(eo,[["__scopeId","data-v-524b77f9"]]),ao={class:"dida-login-footer"},lo=ce({__name:"RegisterView",setup(e){const{globalProperties:l}=_e(),n=Oe(),i=c(!1),o=c(!1),y=c(!1),f=c("发送验证码");let C=null,p=-1;const s=c(!1),$=c(null),v=c({username:"",password:"",confirmPassword:"",nickname:"",email:"",emailKey:""}),k=c({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:d=>new Promise(r=>{const A=setTimeout(()=>{r(v.value.password===d),clearTimeout(A)})}),message:"两次密码不一致"}],nickname:[{required:!0,message:"请填写昵称"},{min:1,message:"昵称至少1个字符"},{max:30,message:"昵称最多30个字符"}],email:[{required:!0,message:"请填写邮箱"},{pattern:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"邮箱格式不正确"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),b=c(()=>t(O,{onClick:S,disabled:y.value,loading:o.value,style:"width:120px"},{default:()=>[f.value]})),S=async()=>{var m;if(!v.value.email){ge(l,"请输入邮箱");return}if(!v.value.email.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)){ge(l,"邮箱格式不正确");return}if(y.value||o.value)return;s.value=!0,await pt();const d=document.getElementById("cf-confirm-div");d&&d.remove();const r=document.createElement("div");r.id="cf-confirm-div",r.setAttribute("data-theme","light"),(m=$.value)==null||m.appendChild(r);const A=window;A.turnstile.ready(function(){A.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(w){s.value=!1,await u(w)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},u=async d=>{if(!y.value){o.value=!0;try{const r=await Wn(d,v.value.email);if(r.code!==0){N(l,r.code);return}we(l,"发送验证码成功"),o.value=!1,y.value=!0,C=new Date,f.value="60秒后重发",p=setInterval(()=>{const m=Math.floor((new Date().getTime()-(C==null?void 0:C.getTime()))/1e3);m>60?(f.value="发送验证码",y.value=!1,clearInterval(p)):f.value=`${60-m}秒后重发`},1e3)}catch{ge(l,"发送验证码失败")}finally{o.value=!1}}},_=()=>{we(l,"重置成功")},g=({validateResult:d,firstError:r,e:A})=>{if(!i.value){if(A.preventDefault(),d!==!0){ge(l,r);return}if(v.value.password!==v.value.confirmPassword){ge(l,"两次密码不一致");return}i.value=!0,Yn(v.value.username,v.value.password,v.value.email,v.value.emailKey,v.value.nickname).then(m=>{m.code===0?(we(l,"注册成功，可使用账号信息登录"),l.$router.push({name:"login"})):N(l,m.code)}).catch(m=>{console.error("Login error",m),ge(l,"登录失败")}).finally(()=>{i.value=!1})}};return pe(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),De(()=>{clearInterval(p)}),(d,r)=>{const A=Ae,m=ze,w=ya,U=O,h=Ue,I=nt,j=be,D=ot;return V(),ee(me,null,[t(j,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(h,{ref:"form",rules:k.value,data:v.value,colon:!0,onReset:_,onSubmit:g,class:"yj-login-form"},{default:a(()=>[t(m,{name:"username",label:"用户名"},{default:a(()=>[t(A,{modelValue:v.value.username,"onUpdate:modelValue":r[0]||(r[0]=T=>v.value.username=T),clearable:"",placeholder:"用于登录与查找"},null,8,["modelValue"])]),_:1}),t(m,{name:"password",label:"密码"},{default:a(()=>[t(A,{modelValue:v.value.password,"onUpdate:modelValue":r[1]||(r[1]=T=>v.value.password=T),type:"password",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(m,{name:"confirmPassword",label:"确认密码"},{default:a(()=>[t(A,{modelValue:v.value.confirmPassword,"onUpdate:modelValue":r[2]||(r[2]=T=>v.value.confirmPassword=T),type:"password",clearable:"",placeholder:"请确认密码"},null,8,["modelValue"])]),_:1}),t(m,{name:"nickname",label:"昵称"},{default:a(()=>[t(A,{modelValue:v.value.nickname,"onUpdate:modelValue":r[3]||(r[3]=T=>v.value.nickname=T),clearable:"",placeholder:"用于优先在网站各处展示"},null,8,["modelValue"])]),_:1}),t(m,{name:"email",label:"邮箱"},{default:a(()=>[t(A,{modelValue:v.value.email,"onUpdate:modelValue":r[4]||(r[4]=T=>v.value.email=T),clearable:"",placeholder:"请填写常用邮箱"},null,8,["modelValue"])]),_:1}),t(m,{name:"emailKey",label:"验证码"},{default:a(()=>[t(w,{append:b.value},{default:a(()=>[t(A,{modelValue:v.value.emailKey,"onUpdate:modelValue":r[5]||(r[5]=T=>v.value.emailKey=T),clearable:"",placeholder:"请输入验证码",style:{width:"140px"}},null,8,["modelValue"])]),_:1},8,["append"])]),_:1}),t(m,null,{default:a(()=>[t(U,{theme:"primary",type:"submit",block:"",loading:i.value},{default:a(()=>r[8]||(r[8]=[P("注册")])),_:1},8,["loading"])]),_:1})]),_:1},8,["rules","data"]),R("div",ao,[t(I,{onClick:r[6]||(r[6]=()=>{fe(l).$router.push({name:"login"})})},{default:a(()=>r[9]||(r[9]=[P("返回登陆 ")])),_:1})])]),_:1}),t(D,{visible:s.value,"onUpdate:visible":r[7]||(r[7]=T=>s.value=T),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:a(()=>[R("div",{ref_key:"dialogContainer",ref:$,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),no=de(lo,[["__scopeId","data-v-9b5f4fc7"]]),oo={key:0,style:{margin:"10px"}},so={key:1,style:{margin:"10px"}},ro={style:{margin:"12px"}},io=ce({__name:"UserView",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze();let o="";const y=c(!1),f=c(null),C=c([]),p=c([]),s=c([]),$=async v=>{y.value=!0;try{let x=await Gn(v);if(x.code!==0){y.value=!1,N(n,x.code),await Y.push({name:"home"});return}if(f.value=Fn(x.data.user),C.value=x.data.problems_ac,i.setTitle(f.value.nickname+" - "+i.getTitle),f.value.vjudgeId){const k=await Hn(f.value.vjudgeId);p.value=k.acRecords;for(const b in p.value)p.value[b].sort((S,u)=>S.length===u.length?S.localeCompare(u):S.length-u.length);s.value=k.failRecords;for(const b in s.value)s.value[b].sort((S,u)=>S.length===u.length?S.localeCompare(u):S.length-u.length)}}catch{ge(n,"获取用户信息失败"),await Y.push({name:"home"})}finally{y.value=!1}};return Xa(async(v,x,k)=>{if(Array.isArray(v.params.username)?o=v.params.username[0]:o=v.params.username,!o){await Y.push({name:"home"});return}await $(o),k()}),pe(async()=>{if(Array.isArray(l.params.username)?o=l.params.username[0]:o=l.params.username,!o){await Y.push({name:"home"});return}await $(o)}),(v,x)=>{const k=O,b=he,S=be,u=nt,_=Ye,g=We,d=Te,r=yl,A=Pe,m=Ve;return V(),E(m,{loading:y.value},{default:a(()=>[t(A,{class:"dida-main-content"},{default:a(()=>[t(d,{span:8},{default:a(()=>{var w;return[t(S,{style:{margin:"10px"},title:"AC题目"},{default:a(()=>[t(b,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(V(!0),ee(me,null,xe(C.value,U=>(V(),E(k,{key:U,size:"small",onClick:()=>fe(Y).push({name:"problem-detail",params:{problemId:U}})},{default:a(()=>[P(q(U),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),(w=f.value)!=null&&w.vjudgeId?(V(),E(S,{key:0,style:{margin:"10px"},title:"vjudge.net"},{actions:a(()=>{var U;return[t(u,{href:"https://vjudge.net/user/"+((U=f.value)==null?void 0:U.vjudgeId),target:"_blank"},{default:a(()=>{var h;return[P("@"+q((h=f.value)==null?void 0:h.vjudgeId),1)]}),_:1},8,["href"])]}),default:a(()=>[p.value&&Object.keys(p.value).length>0?(V(),ee("div",oo,[x[0]||(x[0]=R("div",{style:{margin:"5px"}},[R("span",null,"AC")],-1)),t(g,{layout:"vertical",bordered:!0},{default:a(()=>[(V(!0),ee(me,null,xe(p.value,(U,h)=>(V(),E(_,{key:h,label:h},{default:a(()=>[t(b,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(V(!0),ee(me,null,xe(U,I=>(V(),E(k,{key:I,size:"small",onClick:()=>fe(Y).push({name:"problem-detail",params:{problemId:h+"-"+I}})},{default:a(()=>[P(q(I),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):le("",!0),s.value&&Object.keys(s.value).length>0?(V(),ee("div",so,[x[1]||(x[1]=R("div",{style:{margin:"5px"}},[R("span",null,"Fail")],-1)),t(g,{layout:"vertical",bordered:!0},{default:a(()=>[(V(!0),ee(me,null,xe(s.value,(U,h)=>(V(),E(_,{key:h,label:h},{default:a(()=>[t(b,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(V(!0),ee(me,null,xe(U,I=>(V(),E(k,{key:I,size:"small",onClick:()=>fe(Y).push({name:"problem-detail",params:{problemId:h+"-"+I}})},{default:a(()=>[P(q(I),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):le("",!0)]),_:1})):le("",!0)]}),_:1}),t(d,{span:4},{default:a(()=>[R("div",ro,[t(g,{layout:"vertical",bordered:!0},{default:a(()=>[t(_,{label:"头像"},{default:a(()=>{var w;return[t(r,{shape:"round",size:"100px",image:(w=f.value)==null?void 0:w.avatar,"hide-on-load-failed":!1},null,8,["image"])]}),_:1}),t(_,{label:"昵称"},{default:a(()=>{var w;return[P(q((w=f.value)==null?void 0:w.nickname),1)]}),_:1}),t(_,{label:"Slogan"},{default:a(()=>{var w;return[P(q((w=f.value)==null?void 0:w.slogan),1)]}),_:1}),t(_,{label:"邮箱"},{default:a(()=>{var w;return[P(q((w=f.value)==null?void 0:w.email),1)]}),_:1}),t(_,{label:"组织"},{default:a(()=>{var w;return[P(q((w=f.value)==null?void 0:w.organization),1)]}),_:1}),t(_,{label:"通过数量"},{default:a(()=>{var w;return[P(q((w=f.value)==null?void 0:w.accept),1)]}),_:1}),t(_,{label:"提交数量"},{default:a(()=>{var w;return[P(q((w=f.value)==null?void 0:w.attempt),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),uo=de(io,[["__scopeId","data-v-555e19aa"]]),Bt=[{name:"home",path:"/",title:"首页",showSidebar:!1,disableGenerateTab:!0,component:zn},{name:"problem",path:"/problem",title:"题目",icon:"calculation",showSidebar:!0,redirect:"problem-list"},{name:"collection-detail-tab",title:"题集",path:"/collection",showSidebar:!0,disableGenerateTab:!0,redirect:"problem-collection-list"},{name:"judge",path:"/judge",title:"评测",icon:"code",showSidebar:!0,redirect:"judge-list"},{name:"contest",path:"/contest",title:"比赛",icon:"application",showSidebar:!0,redirect:"contest-list"},{name:"contest-detail-tab",title:"比赛",path:"/contest",showSidebar:!0,disableGenerateTab:!0,redirect:"contest-list"},{name:"discuss",title:"讨论",path:"/discuss",icon:"sonic",showSidebar:!0,redirect:"discuss-list"},{name:"discuss-detail-tab",title:"讨论",path:"/discuss",showSidebar:!0,disableGenerateTab:!0,redirect:"discuss-list"},{name:"rank",path:"/rank",title:"排名",icon:"chart-column",showSidebar:!0,redirect:"rank-ac-all"},{name:"study",path:"/study",title:"研习",icon:"book-open",showSidebar:!1,component:En},{name:"system",path:"/system",title:"系统",icon:"dashboard",showSidebar:!0,redirect:"system-status"},{name:"manage",path:"/manage",title:"管理",icon:"command",showSidebar:!0,redirect:"manage-web",auths:[Le.ManageWeb]},{name:"login",path:"/login",title:"登陆",showSidebar:!1,disableGenerateTab:!0,component:to},{name:"register",path:"/register",title:"注册",showSidebar:!1,disableGenerateTab:!0,component:no},{name:"user",path:"/user/:username+",title:"用户",showSidebar:!1,needLogin:!0,disableGenerateTab:!0,component:uo},{name:"404",path:"/404",title:"404",showSidebar:!1,disableGenerateTab:!0,component:Aa}],co=e=>Bt.find(l=>l.name==e),mo=e=>{const l=[];return Bt.forEach(n=>{!n.disableGenerateTab&&e.hasAllAuths(n.auths)&&l.push(n)}),l},po=e=>{Bt.forEach(l=>{const n={name:l.name,path:l.path,meta:{title:l.title,tab:l.name,showSidebar:l.showSidebar,needLogin:l.needLogin,redirect:l.redirect,tabAuths:l.auths},component:l.component};e.push(n)})};function Ra(e){return e.children!==void 0}function fo(e){return e.children!==void 0}const vo={style:{margin:"10px"}},_o={key:0,class:"dida-operation-container"};function go(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!at(e)}const bo=ce({__name:"ProblemList",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e(),o=Oe();let y=null;const f=c(!1),C={};let p={};const s=c(!1),$=Je(()=>o.hasAuth(Le.ManageProblem)),v=c([{title:"ID",colKey:"id",cell:(z,L)=>{let M=m(L.row.id);return t(O,{variant:"dashed",theme:M,onClick:()=>A(L.row.id)},{default:()=>[L.row.id]})}},{title:"标题",colKey:"title",cell:(z,L)=>t(O,{variant:"text",onClick:()=>A(L.row.id)},{default:()=>[L.row.title]})},{title:"标签",colKey:"tags",cell:(z,L)=>{const M=L.row.tags;if(!M||M.length===0)return"";let F=[];for(let te=0;te<M.length;te++){const X=M[te];F.push(t(O,{key:te,theme:"default",variant:"outline",size:"small",onClick:()=>I(X)},{default:()=>[X.name]}))}return t(he,null,go(F)?F:{default:()=>[F]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),x=c(!1);let k=1,b=50;const S=c({current:k,pageSize:b,defaultCurrent:k,defaultPageSize:b,total:0,pageSizeOptions:[50,100]}),u=c(),_=c(),g=[{label:"DidaOJ",value:"didaoj"},{label:"HDU",value:"hdu"},{label:"POJ",value:"poj"},{label:"NYOJ",value:"nyoj"}],d=c({oj:"",title:"",tag:"",private:!1}),r=c({oj:"",problem:""}),A=z=>{z&&n.push({path:"/problem/"+z})},m=z=>{if(!z||!p)return"default";const L=p[z];if(!L)return"default";switch(L){case Ge.Accept:return"success";case Ge.Attempt:return"warning";default:return"default"}},w=async()=>{await n.push({query:{...l.query,oj:d.value.oj,title:d.value.title,tag:d.value.tag,private:d.value.private?"1":"0",page:1,page_size:S.value.defaultPageSize}})},U=async()=>{d.value.oj="",d.value.title="",d.value.tag="",d.value.private=!1,await n.push({query:{...l.query,oj:"",title:"",tag:"",private:"0",page:1,page_size:S.value.defaultPageSize}})},h=async()=>{try{s.value=!0;const z=await za(r.value.oj,r.value.problem);z.code===0?(we(i,"搜索成功"),await n.push({name:"problem-detail",params:{problemId:z.data}})):N(i,z.code)}catch(z){console.error(z),N(i,He())}finally{s.value=!1}},I=z=>{z&&n.push({query:{...l.query,title:"",tag:z.name,page:1,page_size:S.value.defaultPageSize}})},j=()=>{n.push({name:"manage-problem-create"})},D=async(z,L)=>{x.value=!0;try{const{current:M,pageSize:F}=z,te=await _n(d.value.oj,d.value.title,d.value.tag,d.value.private,M,F);if(u.value=[],te.code===0){const X=te.data.list;if(!X||X.length<=0){S.value={...S.value,total:0},p={},we(i,"未找到记录");return}X.forEach(ae=>{var B;const Q=bt(ae,C);(B=u.value)==null||B.push(Q)}),S.value={...S.value,total:te.data.total_count},p=te.data.problem_attempt_status}else L&&N(i,te.code)}catch(M){console.error(M),N(i,He())}finally{x.value=!1}},T=async z=>{await n.push({query:{...l.query,page:z.current,page_size:z.pageSize}})};return pe(async()=>{x.value=!0,_.value=[],Ua(-1).then(z=>{if(z.code===0){_.value=z.data.list,f.value=z.data.total_count>z.data.list.length;for(let L=0;L<z.data.list.length;L++){const M=z.data.list[L];C[M.id]=M}y=$e(()=>l.query,L=>{d.value.oj=L.oj||"",d.value.title=L.title||"",d.value.tag=L.tag||"",d.value.private=L.private==="1";const M=parseInt(L.page)||S.value.defaultCurrent,F=parseInt(L.page_size)||S.value.defaultPageSize;k=M,b=F,S.value={...S.value,current:k,pageSize:b},D({current:k,pageSize:b},!0)},{immediate:!0})}else f.value=!0}).catch(z=>{console.error(z),f.value=!0})}),De(()=>{y&&y()}),(z,L)=>{const M=Ee,F=be,te=Te,X=O,ae=he,Q=_t,B=ze,ie=Ae,ue=gt,ye=Ue,W=Pe;return V(),E(W,null,{default:a(()=>[t(te,{span:9},{default:a(()=>[t(F,{style:{margin:"10px"}},{default:a(()=>[t(M,{data:u.value,columns:v.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:S.value,"table-layout":"auto",loading:x.value,onPageChange:T},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(te,{span:3},{default:a(()=>[R("div",vo,[$.value?(V(),ee("div",_o,[t(ae,null,{default:a(()=>[t(X,{onClick:j},{default:a(()=>L[7]||(L[7]=[P("新建")])),_:1})]),_:1})])):le("",!0),t(F,{class:"sh-card"},{default:a(()=>[t(ye,{model:d.value,onSubmit:w,onReset:U},{default:a(()=>[t(B,{label:"OJ"},{default:a(()=>[t(Q,{modelValue:d.value.oj,"onUpdate:modelValue":L[0]||(L[0]=K=>d.value.oj=K),options:g,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(B,{label:"标题"},{default:a(()=>[t(ie,{modelValue:d.value.title,"onUpdate:modelValue":L[1]||(L[1]=K=>d.value.title=K),placeholder:"请输入关键词"},null,8,["modelValue"])]),_:1}),t(B,{label:"标签"},{default:a(()=>[t(ie,{modelValue:d.value.tag,"onUpdate:modelValue":L[2]||(L[2]=K=>d.value.tag=K),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),$.value?(V(),E(B,{key:0,label:"私有"},{default:a(()=>[t(ue,{modelValue:d.value.private,"onUpdate:modelValue":L[3]||(L[3]=K=>d.value.private=K)},null,8,["modelValue"])]),_:1})):le("",!0),t(B,null,{default:a(()=>[t(ae,null,{default:a(()=>[t(X,{theme:"primary",type:"submit"},{default:a(()=>L[8]||(L[8]=[P("搜索")])),_:1}),t(X,{theme:"danger",type:"reset"},{default:a(()=>L[9]||(L[9]=[P("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(F,{class:"sh-card"},{default:a(()=>[t(ye,{model:r.value,onSubmit:h},{default:a(()=>[t(B,{label:"OJ"},{default:a(()=>[t(Q,{modelValue:r.value.oj,"onUpdate:modelValue":L[4]||(L[4]=K=>r.value.oj=K),options:g,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(B,{label:"题目"},{default:a(()=>[t(ie,{modelValue:r.value.problem,"onUpdate:modelValue":L[5]||(L[5]=K=>r.value.problem=K),placeholder:"请输入原始题号"},null,8,["modelValue"])]),_:1}),t(B,null,{default:a(()=>[t(X,{theme:"primary",type:"submit",loading:s.value},{default:a(()=>L[10]||(L[10]=[P("前往")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),t(F,{class:"sh-card sh-background-black"},{default:a(()=>[(V(!0),ee(me,null,xe(_.value,K=>(V(),E(X,{class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:()=>I(K)},{default:a(()=>[P(q(K.name),1)]),_:2},1032,["onClick"]))),256)),f.value?(V(),E(X,{key:0,class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:L[6]||(L[6]=()=>z.$router.push("/problem/tags"))},{default:a(()=>L[11]||(L[11]=[P(" ... ")])),_:1})):le("",!0)]),_:1})])]),_:1})]),_:1})}}}),ho=de(bo,[["__scopeId","data-v-dbe06f89"]]);function tt(e){let l="";for(;e>0;)e--,l=String.fromCharCode(65+e%26)+l,e=Math.floor(e/26);return l}function Jt(e){const l={};if(l.id=e.id,l.ownerId=e.owner_id,l.ownerUsername=e.owner_username,l.ownerNickname=e.owner_nickname,l.title=e.title,l.startTime=new Date(e.start_time).toLocaleString(),l.endTime=new Date(e.end_time).toLocaleString(),l.createTime=new Date(e.create_time).toLocaleString(),l.updateTime=new Date(e.update_time).toLocaleString(),l.private=e.private,l.description=e.description,l.notification=e.notification,e.problems){l.problems=[],e.problems.sort((n,i)=>n.index-i.index);for(let n=0;n<e.problems.length;n++){const i=e.problems[n];let o={accept:0,attempt:0,author:"",id:"",private:!1,tags:[],title:""};o.index=i.index,o.id=tt(i.index),o.title=i.title,i.accept?o.accept=i.accept:o.accept=0,i.attempt?o.attempt=i.attempt:o.attempt=0,l.problems.push(o)}}return l}function yo(e){return G({url:"/contest?id="+e,method:"get"})}function wo(e){return G({url:"/contest/edit?id="+e,method:"get"})}function ko(e){return G({url:"/contest/problem/list?id="+e,method:"get"})}function So(e){return e||(e=0),G({url:"/contest/image/token?id="+e,method:"get"})}function Co(e,l){return G({url:"/contest/problem?id="+e+"&problem_index="+l,method:"get"})}function Io(e,l,n,i){const o={};return e&&(o.title=e),l&&(o.username=l),n&&(o.page=String(n)),i&&(o.page_size=String(i)),G({url:`/contest/list?${new URLSearchParams(o).toString()}`,method:"get"})}function Po(e){return G({url:"/contest/rank?id="+e,method:"get"})}function xo(e){return G({url:"/contest/create",method:"post",data:e})}function To(e){return G({url:"/contest/edit",method:"post",data:e})}function Vo(e,l){return G({url:"/contest/password",method:"post",data:{id:e,password:l}})}function Do(e){return G({url:"/contest/dolos",method:"post",data:{id:e}})}const Wt=async(e,l)=>{l&&await e.push({name:"user",params:{username:l}})},aa=e=>{const l=Y.resolve({name:"problem-detail",params:{problemId:e}});window.open(l.href,"_blank")},ft=async(e,l)=>{await Y.push({name:"contest-problem-detail",params:{contestId:e,problemIndex:l}})},jo={class:"sh-button"},Lo={style:{"margin-top":"16px"}},$o={__name:"SecretPanel",setup(e){const l=c(!1);return(n,i)=>{const o=O;return V(),ee("div",tl(al(n.$attrs)),[R("div",jo,[t(o,{onClick:i[0]||(i[0]=y=>l.value=!l.value)},{default:a(()=>[P(q(l.value?"收起":"展开"),1)]),_:1})]),Za(R("div",Lo,[el(n.$slots,"default",{},void 0)],512),[[Qa,l.value]])],16)}}},la=de($o,[["__scopeId","data-v-23f11aab"]]),Uo={key:1,style:{"text-align":"center"}},zo={key:1,style:{"text-align":"center"}},Ao={key:0,class:"dida-problems-container"},Ro={style:{margin:"12px"}},Mo={key:1},Eo={class:"dida-operation-container"},qo={key:0,class:"dida-operation-container"},Ko={class:"dida-code-submit-div"},Fo={class:"dida-code-editor-div"},No=ce({__name:"ProblemDetail",setup(e){let l=Se();const{globalProperties:n}=_e();let i=null;const o=Ze(),y=Oe();let f=c(""),C="",p="",s=0,$=c(0);const v=c(!1),x=c(!1),k=c(!1),b=c(null);let S=null;const u=c(null),_=c(!1),g=c(!1),d={},r=c(""),A=c([]);A.value=Gt();const m=c([]),w=c(null),U=c(-1),h=c(-1),I=c(""),j=c("");let D=0;const T=Je(()=>y.hasAuth(Le.ManageProblem)),z=Je(()=>y.hasAuth(Le.ManageProblemDaily)),L=()=>{w.value&&clearInterval(w.value),w.value=setInterval(()=>{const Z=U.value<=0,J=new Date(new Date().getTime()+D),oe=J.getHours()*60*60+J.getMinutes()*60+J.getSeconds(),ne=18*60*60;oe<ne?U.value=ne-oe:U.value=-1,h.value=24*60*60-oe,(!Z&&U.value<=0||h.value<=0)&&K()},1e3)},M=()=>{w.value&&(clearInterval(w.value),w.value=null)},F=Z=>{Z&&Y.push({name:"problem-list",query:{...l.query,title:"",tag:Z.name}})},te=async()=>{if(!p){ge(n,"每日问题ID无效");return}await Y.push({name:"manage-problem-daily",params:{dailyId:p}})},X=async()=>{let Z=C;if(!Z)try{const J=await Co(s,$.value);J.code===0?Z=J.data:N(n,J.code)}catch{ge(n,"获取题目ID失败，请稍后再试");return}await Y.push({name:"manage-problem",params:{problemId:Z}})},ae=()=>{C?Y.push({name:"judge-list",query:{problem_id:C}}):Y.push({name:"contest-judge",params:{contestId:s},query:{problem_id:tt($.value)}})},Q=()=>{C?Y.push({name:"discuss-list-problem",query:{problem_id:C}}):Y.push({name:"contest-discuss",params:{contestId:s},query:{problem_id:tt($.value)}})},B=()=>{Y.push({name:"problem-recommend",params:{problemId:C}})},ie=async()=>{var oe,ne;const Z=(oe=b.value)==null?void 0:oe.originOj,J=(ne=b.value)==null?void 0:ne.originId;if(!(!Z||!J))try{_.value=!0;const Ie=await za(Z,J);Ie.code===0?(await W(),we(n,"更新成功")):N(n,Ie.code)}catch{ge(n,"更新失败，请稍后再试")}finally{_.value=!1}},ue=async()=>{const Z=parseInt(r.value);if(!St(Z)){ge(n,"请选择所编写的语言");return}const J=S==null?void 0:S.getValue();if(!J){ge(n,"请输入所需提交的代码");return}if(!C&&(!s||!$.value)){ge(n,"问题ID无效");return}g.value=!0;try{const oe=await on(C,s,$.value,Z,J);if(oe.code!==0){N(n,oe.code);return}we(n,"提交成功，正在跳转到详情页面");const ne=oe.data.id;s?await Y.push({name:"contest-judge-detail",params:{contestId:s,judgeId:ne}}):await Y.push({name:"judge-detail",params:{judgeId:ne}})}finally{g.value=!1}},ye=Z=>{if(!S)return;const J=S.getModel();J&&ea.setModelLanguage(J,Ht(Z))},W=async()=>{m.value=[];let Z=await $a(C,s,$.value);if(Z.code!==0){k.value=!1,N(n,Z.code),await Y.push({name:"problem"});return}Z.data.tags&&Z.data.tags.forEach(J=>{d[J.id]=J}),b.value=bt(Z.data.problem,d),o.setTitle(b.value.title+" - "+o.getTitle),s&&(Z=await ko(s),Z.code===0?(Z.data.problems.sort((J,oe)=>J-oe),m.value=Z.data.problems):N(n,Z.code)),f.value=b.value.description,await pt(()=>{!S&&u.value&&(S=ea.create(u.value,{value:"",language:"cpp",minimap:{enabled:!0},colorDecorators:!0,readOnly:!1,theme:"vs-dark"})),k.value=!1})},K=async()=>{M(),x.value=!1;const Z=await bn(p);if(Z.code!==0)return;x.value=!0;const J=Z.data.problem_daily;C=J.problem_id,I.value=J.solution,j.value=J.code;const oe=new Date(Z.data.time);D=oe.getTime()-new Date().getTime();const ne=new Date(oe.getTime()),Ie=ne.getFullYear(),Ce=String(ne.getMonth()+1).padStart(2,"0"),H=String(ne.getDate()).padStart(2,"0"),se=`${Ie}-${Ce}-${H}`;if(p===se){const ve=oe.getHours()*60*60+oe.getMinutes()*60+oe.getSeconds(),je=18*60*60;ve<je?U.value=je-ve:U.value=-1,h.value=24*60*60-ve}(U.value>=0||h.value>=0)&&L()};return pe(async()=>{i=$e(()=>l.params,async()=>{if(x.value=!1,Array.isArray(l.params.problemId)?C=l.params.problemId[0]:C=l.params.problemId,C||(Array.isArray(l.params.dailyId)?p=l.params.dailyId[0]:p=l.params.dailyId,k.value=!0,await K(),k.value=!1),!C){if(Array.isArray(l.params.contestId)?s=Number(l.params.contestId[0]):s=Number(l.params.contestId),!s){ge(n,"题目不存在"),p?await Y.push({name:"problem-daily-list"}):await Y.push({name:"problem"});return}if(Array.isArray(l.params.problemIndex)?$.value=parseInt(l.params.problemIndex[0]):$.value=parseInt(l.params.problemIndex),!$.value){ge(n,"题目不存在"),await Y.push({name:"problem"});return}}v.value=!!s,k.value=!0,await W()},{immediate:!0}),u.value&&new ResizeObserver(()=>{S&&S.layout()}).observe(u.value)}),De(()=>{i&&(i(),i=null),M()}),(Z,J)=>{const oe=Me("md-preview"),ne=be,Ie=Ft,Ce=he,H=Te,se=O,ve=Ye,je=nt,Re=We,ke=Nt,qe=_t,lt=Pe,st=Ve;return V(),E(st,{loading:k.value},{default:a(()=>[t(lt,{class:"dida-main-content"},{default:a(()=>[t(H,{span:8},{default:a(()=>[t(ne,{style:{margin:"10px"}},{default:a(()=>[t(oe,{"model-value":fe(f),previewTheme:"cyanosis"},null,8,["model-value"])]),_:1}),x.value?(V(),E(ne,{key:0,style:{margin:"10px"},title:"题解"},{default:a(()=>[U.value<0?(V(),E(la,{key:0},{default:a(()=>[t(oe,{"model-value":I.value,previewTheme:"cyanosis"},null,8,["model-value"])]),_:1})):(V(),ee("div",Uo,[R("div",null,[t(Ce,null,{default:a(()=>[J[2]||(J[2]=R("p",null,"距离解锁百分比",-1)),t(Ie,{theme:"circle",color:{from:"#0052D9",to:"#00A870"},percentage:100-U.value/(18*60*60)*100,status:"active"},{label:a(()=>[P(q((100-U.value/(18*60*60)*100).toFixed(3))+"% ",1)]),default:a(()=>[J[1]||(J[1]=P(" > "))]),_:1},8,["percentage"])]),_:1})])]))]),_:1})):le("",!0),x.value?(V(),E(ne,{key:1,style:{margin:"10px"},title:"示例代码"},{default:a(()=>[h.value<0?(V(),E(la,{key:0},{default:a(()=>[t(oe,{"model-value":j.value,previewTheme:"cyanosis"},null,8,["model-value"])]),_:1})):(V(),ee("div",zo,[R("div",null,[t(Ce,{style:{margin:"0 auto"}},{default:a(()=>[J[4]||(J[4]=R("p",null,"距离解锁百分比",-1)),t(Ie,{theme:"circle",color:{from:"#0052D9",to:"#00A870"},percentage:100-h.value/(24*60*60)*100,status:"active"},{label:a(()=>[P(q((100-h.value/(24*60*60)*100).toFixed(3))+"% ",1)]),default:a(()=>[J[3]||(J[3]=P(" > "))]),_:1},8,["percentage"])]),_:1})])]))]),_:1})):le("",!0)]),_:1}),t(H,{span:4},{default:a(()=>{var yt;return[fe(s)?(V(),ee("div",Ao,[t(Ce,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(V(!0),ee(me,null,xe(m.value,(Ke,re)=>(V(),E(se,{key:re,theme:Ke==fe($)?"primary":"default",onClick:async()=>await fe(ft)(fe(s),Ke)},{default:a(()=>[P(q(fe(tt)(Ke)),1)]),_:2},1032,["theme","onClick"]))),128))]),_:1})])):le("",!0),R("div",Ro,[t(Re,{layout:"vertical",bordered:!0},{default:a(()=>{var Ke;return[t(ve,{label:"ID"},{default:a(()=>{var re;return[P(q((re=b.value)==null?void 0:re.id),1)]}),_:1}),t(ve,{label:"标题"},{default:a(()=>{var re;return[P(q((re=b.value)==null?void 0:re.title),1)]}),_:1}),t(ve,{label:"时间限制"},{default:a(()=>{var re;return[P(q((re=b.value)==null?void 0:re.timeLimit),1)]}),_:1}),t(ve,{label:"内存限制"},{default:a(()=>{var re;return[P(q((re=b.value)==null?void 0:re.memoryLimit),1)]}),_:1}),t(ve,{label:"判题方式"},{default:a(()=>{var re;return[P(q((re=b.value)==null?void 0:re.judgeType),1)]}),_:1}),v.value?le("",!0):(V(),E(ve,{key:0,label:"正确提交"},{default:a(()=>{var re;return[P(q((re=b.value)==null?void 0:re.accept),1)]}),_:1})),v.value?le("",!0):(V(),E(ve,{key:1,label:"提交总数"},{default:a(()=>{var re;return[P(q((re=b.value)==null?void 0:re.attempt),1)]}),_:1})),t(ve,{label:"创建时间"},{default:a(()=>{var re;return[P(q((re=b.value)==null?void 0:re.insertTime),1)]}),_:1}),t(ve,{label:"更新时间"},{default:a(()=>{var re;return[P(q((re=b.value)==null?void 0:re.updateTime),1)]}),_:1}),t(ve,{label:"上传用户"},{default:a(()=>{var re;return[P(q((re=b.value)==null?void 0:re.creatorNickname),1)]}),_:1}),v.value?le("",!0):(V(),E(ve,{key:2,label:"题目来源"},{default:a(()=>{var re,Qe,mt;return[(re=b.value)!=null&&re.sourceUrl?(V(),E(je,{key:0,href:(Qe=b.value)==null?void 0:Qe.sourceUrl,target:"_blank"},{default:a(()=>{var Zt;return[P(q((Zt=b.value)==null?void 0:Zt.source),1)]}),_:1},8,["href"])):(V(),ee("span",Mo,q((mt=b.value)==null?void 0:mt.source),1))]}),_:1})),T.value?(V(),E(ve,{key:3,label:"是否私有"},{default:a(()=>{var re;return[P(q((re=b.value)!=null&&re.private?"私有":"公开"),1)]}),_:1})):le("",!0),(Ke=b.value)!=null&&Ke.originUrl?(V(),E(ve,{key:4,label:"原题链接"},{default:a(()=>{var re;return[t(je,{href:(re=b.value)==null?void 0:re.originUrl,target:"_blank"},{default:a(()=>{var Qe,mt;return[P(q((Qe=b.value)==null?void 0:Qe.originOj)+" - "+q((mt=b.value)==null?void 0:mt.originId),1)]}),_:1},8,["href"])]}),_:1})):le("",!0),fe(C)?(V(),E(ve,{key:5,label:"标签"},{default:a(()=>[t(Ce,null,{default:a(()=>{var re;return[(V(!0),ee(me,null,xe((re=b.value)==null?void 0:re.tags,Qe=>(V(),E(se,{key:Qe.id,variant:"dashed",onClick:()=>F(Qe)},{default:a(()=>[P(q(Qe.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})):le("",!0)]}),_:1}),R("div",Eo,[t(Ce,null,{default:a(()=>[t(se,{onClick:ae},{default:a(()=>J[5]||(J[5]=[P("提交记录")])),_:1}),t(se,{onClick:Q},{default:a(()=>J[6]||(J[6]=[P("题目讨论")])),_:1}),fe(C)?(V(),E(se,{key:0,onClick:B},{default:a(()=>J[7]||(J[7]=[P("题目推荐")])),_:1})):le("",!0)]),_:1})]),x.value&&z.value||T.value||(yt=b.value)!=null&&yt.originId?(V(),ee("div",qo,[t(Ce,null,{default:a(()=>{var Ke;return[x.value&&z.value?(V(),E(se,{key:0,onClick:te},{default:a(()=>J[8]||(J[8]=[P("每日一题")])),_:1})):le("",!0),T.value?(V(),E(se,{key:1,onClick:X},{default:a(()=>J[9]||(J[9]=[P("编辑")])),_:1})):le("",!0),(Ke=b.value)!=null&&Ke.originId?(V(),E(se,{key:2,onClick:ie,loading:_.value},{default:a(()=>J[10]||(J[10]=[P("更新描述 ")])),_:1},8,["loading"])):le("",!0)]}),_:1})])):le("",!0),R("div",Ko,[t(Ce,null,{default:a(()=>[t(qe,{modelValue:r.value,"onUpdate:modelValue":J[0]||(J[0]=Ke=>r.value=Ke),label:"语言：",placeholder:"请选择提交语言","auto-width":"",clearable:"",onChange:ye},{default:a(()=>[(V(!0),ee(me,null,xe(A.value,Ke=>(V(),E(ke,{key:Ke.value,value:Ke.value,label:Ke.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),t(se,{onClick:ue,loading:g.value},{default:a(()=>J[11]||(J[11]=[P("提交")])),_:1},8,["loading"])]),_:1}),R("div",Fo,[R("div",{ref_key:"codeEditRef",ref:u,class:"dida-code-editor"},null,512)])])])]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),Ut=de(No,[["__scopeId","data-v-bf97b778"]]),Oo={style:{margin:"10px"}},Go={key:0,class:"dida-operation-container"};function Ho(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!at(e)}const Bo=ce({__name:"ProblemDailyList",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e(),o=Oe();let y=!1,f=null,C={},p={};const s=Je(()=>o.hasAuth(Le.ManageProblem)),$=c([{title:"日期",colKey:"id",cell:(h,I)=>t(O,{variant:"dashed",onClick:()=>_(I.row.id)},{default:()=>[I.row.id]})},{title:"ID",colKey:"problemId",cell:(h,I)=>{let j=g(I.row.problemId);return t(O,{variant:"dashed",theme:j,onClick:()=>_(I.row.id)},{default:()=>[I.row.problemId]})}},{title:"标题",colKey:"title",cell:(h,I)=>t(O,{variant:"text",onClick:()=>_(I.row.id)},{default:()=>[I.row.title]})},{title:"标签",colKey:"tags",cell:(h,I)=>{const j=I.row.tags;if(!j||j.length===0)return"";let D=[];for(let T=0;T<j.length;T++){const z=j[T];D.push(t(O,{key:T,theme:"default",variant:"outline",size:"small",onClick:()=>A(z)},{default:()=>[z.name]}))}return t(he,null,Ho(D)?D:{default:()=>[D]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),v=c(!1);let x=1,k=50;const b=c({current:x,pageSize:k,defaultCurrent:x,defaultPageSize:k,total:0,pageSizeOptions:[50,100]}),S=c([]),u=c({date:[],problemId:""}),_=h=>{h&&n.push({name:"problem-daily-detail",params:{dailyId:h}})},g=h=>{if(!h||!p)return"default";const I=p[h];if(!I)return"default";switch(I){case Ge.Accept:return"success";case Ge.Attempt:return"warning";default:return"default"}},d=async()=>{let h="";u.value.date&&u.value.date.length>1&&(h=u.value.date[0]+"~"+u.value.date[1]),await n.push({query:{...l.query,date:h,problem_id:u.value.problemId,page:1,page_size:b.value.defaultPageSize}})},r=async()=>{u.value.date=[],u.value.problemId="",await n.push({query:{...l.query,date:"",problem_id:"",page:1,page_size:b.value.defaultPageSize}})},A=h=>{h&&n.push({name:"problem-list",query:{...l.query,title:"",tag:h.name,page:1,page_size:b.value.defaultPageSize}})},m=()=>{n.push({name:"manage-problem-daily-create"})},w=async(h,I)=>{v.value=!0;try{const{current:j,pageSize:D}=h;let T="";u.value.date[0]&&(T=u.value.date[0]);let z="";u.value.date[1]&&(z=u.value.date[1]);const L=await wn(T,z,u.value.problemId,j,D);if(S.value=[],L.code===0){const M=L.data.list;if(!M||M.length<=0){b.value={...b.value,total:0},p={},we(i,"未找到记录");return}C={},L.data.tags&&L.data.tags.forEach(F=>{C[F.id]=F}),M.forEach(F=>{var X;const te=La(F,C);(X=S.value)==null||X.push(te)}),b.value={...b.value,total:L.data.total_count},p=L.data.attempt_status}else I&&N(i,L.code)}catch(j){console.error(j),N(i,He())}finally{v.value=!1}},U=async h=>{await n.push({query:{...l.query,page:h.current,page_size:h.pageSize}})};return pe(async()=>{y=!0,v.value=!0,f=$e(()=>l.query,h=>{if(!y)return;if(u.value.date=[],h.date){const D=h.date.split("~");D.length===2&&(u.value.date=[D[0],D[1]])}u.value.problemId=h.problem_id||"";const I=parseInt(h.page)||b.value.defaultCurrent,j=parseInt(h.page_size)||b.value.defaultPageSize;x=I,k=j,b.value={...b.value,current:x,pageSize:k},w({current:x,pageSize:k},!0)},{immediate:!0})}),De(()=>{y=!1,f&&f()}),(h,I)=>{const j=Ee,D=be,T=Te,z=O,L=he,M=Ot,F=ze,te=Ae,X=Ue,ae=Pe;return V(),E(ae,null,{default:a(()=>[t(T,{span:9},{default:a(()=>[t(D,{style:{margin:"10px"}},{default:a(()=>[t(j,{data:S.value,columns:$.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:b.value,"table-layout":"auto",loading:v.value,onPageChange:U},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(T,{span:3},{default:a(()=>[R("div",Oo,[s.value?(V(),ee("div",Go,[t(L,null,{default:a(()=>[t(z,{onClick:m},{default:a(()=>I[2]||(I[2]=[P("新建")])),_:1})]),_:1})])):le("",!0),t(D,{class:"sh-card"},{default:a(()=>[t(X,{model:u.value,onSubmit:d,onReset:r},{default:a(()=>[t(F,{label:"日期","label-align":"top"},{default:a(()=>[t(M,{modelValue:u.value.date,"onUpdate:modelValue":I[0]||(I[0]=Q=>u.value.date=Q),"allow-input":"",clearable:"",format:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(F,{label:"问题","label-align":"top"},{default:a(()=>[t(te,{modelValue:u.value.problemId,"onUpdate:modelValue":I[1]||(I[1]=Q=>u.value.problemId=Q),placeholder:"请输入问题ID",clearable:""},null,8,["modelValue"])]),_:1}),t(F,{"label-align":"top"},{default:a(()=>[t(L,null,{default:a(()=>[t(z,{theme:"primary",type:"submit"},{default:a(()=>I[3]||(I[3]=[P("搜索")])),_:1}),t(z,{theme:"danger",type:"reset"},{default:a(()=>I[4]||(I[4]=[P("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(D,{class:"sh-card",header:"每日一题","header-bordered":!0},{default:a(()=>I[5]||(I[5]=[R("p",null,"由管理员团队精选的题目，每日0点更新。",-1),R("p",null,"当日下午6点提供题解，次日提供AC代码。",-1)])),_:1})])]),_:1})]),_:1})}}}),Jo=de(Bo,[["__scopeId","data-v-b97b04ec"]]),Wo={style:{margin:"10px"}},Yo={style:{margin:"12px"}},Xo={class:"dida-edit-container"},Zo=ce({__name:"ProblemDailyEdit",setup(e){let l=Se();const{globalProperties:n}=_e();let i=null;const o=c(""),y=c(!1),f=c(!1),C=c(null),p=c({date:"",problemId:"",solution:"",code:""}),s=()=>{Y.push({name:"problem-daily-detail",params:{dailyId:o.value}})};async function $(u,_){f.value=!0,await dt(u,_,n,()=>Vn(o.value)),f.value=!1}const v=async()=>{f.value=!0;try{const u=p.value.date,_=await In(u,p.value.problemId,p.value.solution,p.value.code);if(f.value=!0,_.code!==0){N(n,_.code);return}await Y.push({name:"manage-problem-daily",params:{dailyId:u}}),Ne(n,"创建成功")}finally{f.value=!1}},x=async()=>{f.value=!0;try{const u=await Pn(o.value,p.value.problemId,p.value.solution,p.value.code);if(f.value=!0,u.code!==0){N(n,u.code);return}C.value&&(u.data.update_time!=null&&(C.value.updateTime=new Date(u.data.update_time).toLocaleString()),u.data.updater_nickname!=null&&(C.value.updaterNickname=u.data.updater_nickname)),u.data.solution!=null&&(p.value.solution=u.data.solution),u.data.code!=null&&(p.value.code=u.data.code),Ne(n,"保存成功")}finally{f.value=!1}},k=u=>{p.value.solution=u,y.value=!1},b=u=>{p.value.code=u,y.value=!1},S=async()=>{const u=await hn(o.value);if(u.code!==0){N(n,u.code),console.error("problem get failed",u.code),await Y.push({name:"problem"});return}const _=u.data;C.value=La(_,{}),p.value.problemId=_.problem_id,k(_.solution),b(_.code)};return pe(async()=>{i=$e(()=>l.params,async()=>{Array.isArray(l.params.dailyId)?o.value=l.params.dailyId[0]:o.value=l.params.dailyId,o.value?(y.value=!0,p.value.date=o.value,await S()):(k("暂无题解"),b("暂无标程"))},{immediate:!0})}),De(()=>{i&&(i(),i=null)}),(u,_)=>{const g=xt,d=wl,r=ze,A=Ae,m=Ue,w=be,U=Te,h=O,I=he,j=Ye,D=We,T=Pe,z=Me("md-editor-v3"),L=Ve;return V(),E(L,{loading:y.value},{default:a(()=>[t(T,null,{default:a(()=>[t(U,{span:8},{default:a(()=>[R("div",Wo,[t(g,{theme:"info"},{default:a(()=>_[4]||(_[4]=[P("可以提前配置将来日期的题目，对外仅展示到截止到当天的题目")])),_:1}),t(w,{class:"sh-form-card"},{default:a(()=>[t(m,{model:p.value},{default:a(()=>[t(r,{label:"日期"},{default:a(()=>[t(d,{modelValue:p.value.date,"onUpdate:modelValue":_[0]||(_[0]=M=>p.value.date=M),disabled:o.value&&!0},null,8,["modelValue","disabled"])]),_:1}),t(r,{label:"问题ID"},{default:a(()=>[t(A,{modelValue:p.value.problemId,"onUpdate:modelValue":_[1]||(_[1]=M=>p.value.problemId=M),placeholder:"问题标题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(U,{span:4},{default:a(()=>[R("div",Yo,[R("div",Xo,[o.value?(V(),E(I,{key:0},{default:a(()=>[t(h,{onClick:x,theme:"danger",loading:f.value},{default:a(()=>_[5]||(_[5]=[P("保存")])),_:1},8,["loading"]),t(h,{onClick:s},{default:a(()=>_[6]||(_[6]=[P("查看")])),_:1})]),_:1})):(V(),E(I,{key:1},{default:a(()=>[t(h,{onClick:v,theme:"danger",loading:f.value},{default:a(()=>_[7]||(_[7]=[P("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(V(),E(D,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(j,{label:"创建时间"},{default:a(()=>{var M;return[P(q((M=C.value)==null?void 0:M.createTime),1)]}),_:1}),t(j,{label:"更新时间"},{default:a(()=>{var M;return[P(q((M=C.value)==null?void 0:M.updateTime),1)]}),_:1}),t(j,{label:"创建用户"},{default:a(()=>{var M;return[P(q((M=C.value)==null?void 0:M.creatorNickname),1)]}),_:1}),t(j,{label:"更新用户"},{default:a(()=>{var M;return[P(q((M=C.value)==null?void 0:M.updaterNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),R("div",null,[_[8]||(_[8]=R("p",{style:{"margin-left":"20px"}},"题解：",-1)),t(z,{id:"daily-solution-editor",modelValue:p.value.solution,"onUpdate:modelValue":_[2]||(_[2]=M=>p.value.solution=M),onSave:x,onOnUploadImg:$,previewTheme:"cyanosis"},null,8,["modelValue"]),t(L,{loading:f.value,attach:"#daily-solution-editor","z-index":1e5},null,8,["loading"])]),R("div",null,[_[9]||(_[9]=R("p",{style:{"margin-left":"20px"}},"标程：",-1)),t(z,{id:"daily-code-editor",modelValue:p.value.code,"onUpdate:modelValue":_[3]||(_[3]=M=>p.value.code=M),onSave:x,onOnUploadImg:$,previewTheme:"cyanosis"},null,8,["modelValue"]),t(L,{loading:f.value,attach:"#daily-code-editor","z-index":1e5},null,8,["loading"])])]),_:1},8,["loading"])}}}),na=de(Zo,[["__scopeId","data-v-fe63fd0d"]]),Qo={style:{margin:"10px"}};function es(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!at(e)}const ts=ce({__name:"ProblemRecommend",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=null,y="",f={},C={};const p=c([{title:"ID",colKey:"id",cell:(S,u)=>{let _=x(u.row.id);return t(O,{variant:"dashed",theme:_,onClick:()=>v(u.row.id)},{default:()=>[u.row.id]})}},{title:"标题",colKey:"title",cell:(S,u)=>t(O,{variant:"text",onClick:()=>v(u.row.id)},{default:()=>[u.row.title]})},{title:"标签",colKey:"tags",cell:(S,u)=>{const _=u.row.tags;if(!_||_.length===0)return"";let g=[];for(let d=0;d<_.length;d++){const r=_[d];g.push(t(O,{key:d,theme:"default",variant:"outline",size:"small",onClick:()=>k(r)},{default:()=>[r.name]}))}return t(he,null,es(g)?g:{default:()=>[g]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),s=c(!1),$=c(),v=S=>{S&&n.push({path:"/problem/"+S})},x=S=>{if(!S||!C)return"default";const u=C[S];if(!u)return"default";switch(u){case Ge.Accept:return"success";case Ge.Attempt:return"warning";default:return"default"}},k=S=>{S&&n.push({name:"problem-list",query:{tag:S.name}})},b=async S=>{s.value=!0;try{const u=await gn(y);if($.value=[],u.code===0){const _=u.data.list;if(!_||_.length<=0){we(i,"暂无推荐题目");return}f={},u.data.tags&&u.data.tags.forEach(g=>{f[g.id]=g}),_.forEach(g=>{var r;const d=bt(g,f);(r=$.value)==null||r.push(d)})}else S&&N(i,u.code)}catch(u){console.error(u),N(i,He())}finally{s.value=!1}};return pe(async()=>{s.value=!0,o=$e(()=>l.query,S=>{Array.isArray(l.params.problemId)?y=l.params.problemId[0]:y=l.params.problemId,b(!0)},{immediate:!0})}),De(()=>{o&&o()}),(S,u)=>{const _=Ee,g=be,d=Te,r=Pe;return V(),E(r,null,{default:a(()=>[t(d,{span:9},{default:a(()=>[t(g,{style:{margin:"10px"}},{default:a(()=>[t(_,{data:$.value,columns:p.value,"row-key":"id","vertical-align":"top",hover:!0,"table-layout":"auto",loading:s.value},null,8,["data","columns","loading"])]),_:1})]),_:1}),t(d,{span:3},{default:a(()=>[R("div",Qo,[t(g,{class:"sh-card",header:"题目推荐","header-bordered":!0},{default:a(()=>u[0]||(u[0]=[P(" 根据本站其他用户的提交记录推荐类似题目"),R("br",null,null,-1),P("依据推荐算法来计算，与本用户相似度最高的用户做的题，大概率被自己感兴趣。 ")])),_:1})])]),_:1})]),_:1})}}}),as=de(ts,[["__scopeId","data-v-77972e8b"]]),ls={style:{margin:"10px"}},ns={key:1},os={style:{margin:"12px"}},ss={class:"dida-edit-container"},rs={class:"dida-description-editor"},is=ce({__name:"ProblemEdit",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze(),o=c(""),y=c(!1),f=c(!1),C=c(!1),p=c(null),s=c({title:"",timeLimit:0,memoryLimit:0,source:"",private:!0,tags:[],description:""}),$=c([]),v=c([]),x=Je(()=>{const m=[],w=$.value;for(let U=0,h=w.length;U<h;U++)w[U].value&&m.push(w[U].value);return m}),k=(m,w)=>{const{trigger:U,index:h,item:I}=w;if(U==="clear"&&($.value=[]),["tag-remove","backspace"].includes(U)&&$.value.splice(h,1),U==="enter"){for(let D=0;D<v.value.length;D++){const T=v.value[D];if(T.label===I){for(let z=0;z<$.value.length;z++)if($.value[z].label===T.label)return;$.value.push(T);return}}const j={label:I,value:I};$.value.push(j),v.value=v.value.concat(j)}},b=(m,{current:w,type:U})=>{if(!w){$.value=U==="check"?v.value.slice(1):[];return}if(U==="check"){const h=v.value.find(I=>I.value===w);if(!h)return;$.value.push(h)}else $.value=$.value.filter(h=>h.value!==w)},S=()=>{Y.push({name:"problem-detail",params:{problemId:o.value}})},u=()=>{Y.push({name:"manage-problem-judge",params:{problemId:o.value}})},_=async(m,w)=>{C.value=!0,await dt(m,w,n,()=>Tn(o.value)),C.value=!1},g=async()=>{f.value=!0,s.value.tags=[];for(let m=0;m<$.value.length;m++){const w=$.value[m];w&&w.label&&s.value.tags.push(w.label)}try{const m=await Sn(s.value.title,s.value.timeLimit,s.value.memoryLimit,s.value.source,s.value.private,s.value.tags,s.value.description);if(f.value=!0,m.code!==0){N(n,m.code);return}m.data!=null&&await Y.push({name:"problem-detail",params:{problemId:m.data}}),Ne(n,"创建成功")}finally{f.value=!1}},d=async()=>{f.value=!0,s.value.tags=[];for(let m=0;m<$.value.length;m++){const w=$.value[m];w&&w.label&&s.value.tags.push(w.label)}try{const m=await Cn(o.value,s.value.title,s.value.timeLimit,s.value.memoryLimit,s.value.source,s.value.private,s.value.tags,s.value.description);if(f.value=!0,m.code!==0){N(n,m.code);return}p.value&&m.data.update_time!=null&&(p.value.updateTime=new Date(m.data.update_time).toLocaleString()),m.data.description!=null&&(s.value.description=m.data.description),Ne(n,"保存成功")}finally{f.value=!1}},r=m=>{s.value.description=m,y.value=!1},A=async()=>{const m=await $a(o.value,void 0,void 0);if(m.code!==0){N(n,m.code),console.error("problem get failed",m.code),await Y.push({name:"problem"});return}const w=m.data.problem;if(p.value=bt(w,{}),s.value.title=w.title,s.value.timeLimit=w.time_limit,s.value.memoryLimit=w.memory_limit,s.value.source=w.source,s.value.private=w.private,s.value.tags=[],$.value=[],m.data.tags)for(let h=0;h<m.data.tags.length;h++){const I=m.data.tags[h];I&&I.name&&(s.value.tags.push(I.name),$.value.push({label:I.name,value:I.id}))}i.setTitle(w.title+" - "+i.getTitle);let U=w.description;r(U)};return pe(async()=>{Array.isArray(l.params.problemId)?o.value=l.params.problemId[0]:o.value=l.params.problemId,o.value?(y.value=!0,Ua(-1).then(async m=>{m.code===0?(m.data.list&&m.data.list.forEach(w=>{v.value.push({label:w.name,value:w.id})}),await A()):(N(n,m.code),console.error("problem tag get failed",m.code),await Y.push({name:"problem"}))}).catch(async m=>{console.error(m),N(n,"获取数据异常"),await Y.push({name:"problem"})})):(s.value.timeLimit=1e3,s.value.memoryLimit=65536,r(""))}),(m,w)=>{const U=Ae,h=ze,I=wa,j=gt,D=Sl,T=kl,z=Ue,L=be,M=Te,F=O,te=he,X=Ye,ae=We,Q=Pe,B=Me("md-editor-v3"),ie=Ve;return V(),E(ie,{loading:y.value},{default:a(()=>[t(Q,null,{default:a(()=>[t(M,{span:8},{default:a(()=>[R("div",ls,[t(L,{class:"sh-card"},{default:a(()=>[t(z,{model:s.value},{default:a(()=>[t(h,{label:"标题"},{default:a(()=>[t(U,{modelValue:s.value.title,"onUpdate:modelValue":w[0]||(w[0]=ue=>s.value.title=ue),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),t(h,{label:"时间限制"},{default:a(()=>[t(I,{modelValue:s.value.timeLimit,"onUpdate:modelValue":w[1]||(w[1]=ue=>s.value.timeLimit=ue),theme:"normal",min:0},{suffix:a(()=>w[6]||(w[6]=[R("span",null,"ms",-1)])),_:1},8,["modelValue"])]),_:1}),t(h,{label:"内存限制"},{default:a(()=>[t(I,{modelValue:s.value.memoryLimit,"onUpdate:modelValue":w[2]||(w[2]=ue=>s.value.memoryLimit=ue),theme:"normal",min:0},{suffix:a(()=>w[7]||(w[7]=[R("span",null,"KB",-1)])),_:1},8,["modelValue"])]),_:1}),t(h,{label:"来源"},{default:a(()=>[t(U,{modelValue:s.value.source,"onUpdate:modelValue":w[3]||(w[3]=ue=>s.value.source=ue),placeholder:"请输入题目来源"},null,8,["modelValue"])]),_:1}),t(h,{label:"私有"},{default:a(()=>[t(j,{modelValue:s.value.private,"onUpdate:modelValue":w[4]||(w[4]=ue=>s.value.private=ue)},null,8,["modelValue"])]),_:1}),t(h,{label:"标签"},{default:a(()=>[t(T,{value:$.value,"allow-input":!0,placeholder:"请选择或输入","tag-input-props":{excessTagsDisplayType:"break-line"},"popup-props":{overlayInnerClassName:["narrow-scrollbar"],overlayInnerStyle:{maxHeight:"280px",overflowY:"auto",overscrollBehavior:"contain",padding:"6px"}},clearable:"",multiple:"",onTagChange:k},{panel:a(()=>[v.value.length?(V(),E(D,{key:0,value:x.value,options:v.value,onChange:b},null,8,["value","options"])):(V(),ee("div",ns,"暂无数据"))]),suffixIcon:a(()=>[t(fe(ll))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(M,{span:4},{default:a(()=>[R("div",os,[R("div",ss,[o.value?(V(),E(te,{key:0},{default:a(()=>[t(F,{onClick:d,theme:"danger",loading:f.value},{default:a(()=>w[8]||(w[8]=[P("保存")])),_:1},8,["loading"]),t(F,{onClick:u,theme:"warning"},{default:a(()=>w[9]||(w[9]=[P("判题数据")])),_:1}),t(F,{onClick:S},{default:a(()=>w[10]||(w[10]=[P("查看")])),_:1})]),_:1})):(V(),E(te,{key:1},{default:a(()=>[t(F,{onClick:g,theme:"danger",loading:f.value},{default:a(()=>w[11]||(w[11]=[P("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(V(),E(ae,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(X,{label:"创建时间"},{default:a(()=>{var ue;return[P(q((ue=p.value)==null?void 0:ue.insertTime),1)]}),_:1}),t(X,{label:"更新时间"},{default:a(()=>{var ue;return[P(q((ue=p.value)==null?void 0:ue.updateTime),1)]}),_:1}),t(X,{label:"判题方式"},{default:a(()=>{var ue;return[P(q((ue=p.value)==null?void 0:ue.judgeType),1)]}),_:1}),t(X,{label:"上传用户"},{default:a(()=>{var ue;return[P(q((ue=p.value)==null?void 0:ue.creatorNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),R("div",rs,[w[12]||(w[12]=R("p",null,"题目描述",-1)),t(ie,{loading:C.value||f.value},{default:a(()=>[t(B,{modelValue:s.value.description,"onUpdate:modelValue":w[5]||(w[5]=ue=>s.value.description=ue),onSave:d,onOnUploadImg:_,previewTheme:"cyanosis"},null,8,["modelValue"])]),_:1},8,["loading"])])]),_:1},8,["loading"])}}}),oa=de(is,[["__scopeId","data-v-e349d9e2"]]),us={style:{margin:"10px"}},ds={style:{margin:"12px"}},cs={class:"dida-edit-container"},ms=ce({__name:"ProblemJudge",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze(),o=c(""),y=c(!1),f=c(null);let C=null;const p=c(null),s=c(""),$=c(!1),v=c(!1),x=c([{title:"文件",colKey:"file"},{title:"大小",colKey:"size",width:150,cell:(I,j)=>{let D=j.row.size,T;return D>10*1024?D>1024*1024?T=(D/(1024*1024)).toFixed(3)+" MB":T=(D/1024).toFixed(3)+" KB":T=D+" B",T}},{title:"最后修改时间",colKey:"lastModified",width:180,cell:(I,j)=>new Date(j.row.lastModified).toLocaleString()},{title:"操作",colKey:"action",width:100,cell:(I,j)=>t(O,{onClick:()=>g(j.row.file)},{default:()=>[P("下载")]})}]),k=c([]),b=Je(()=>({border:"2px dashed #ccc",borderRadius:"6px",padding:"20px",textAlign:"center",cursor:"pointer",backgroundColor:$.value?"#f0f9ff":"#fff",transition:"background-color 0.2s ease"})),S=Je(()=>s.value?`已选择：${s.value}`:$.value?"松开文件以上传":"拖拽判题数据压缩包到这里，或点击选择文件"),u=()=>{Y.push({name:"problem-detail",params:{problemId:o.value}})},_=()=>{Y.push({name:"manage-problem",params:{problemId:o.value}})},g=async I=>{const j=await xn(o.value,I);if(j.code!==0){N(n,j.code);return}const D=document.createElement("a");D.href=j.data,D.target="_blank",D.click(),URL.revokeObjectURL(D.href)},d=async()=>{if(!C){ge(n,"请选择压缩包");return}v.value=!0,Dn(o.value,C).then(async I=>{I.code==0?(p.value.value=null,C=null,s.value="",y.value=!0,Ne(n,"上传成功"),await h()):Kl(n,I.code,I.data)}).catch(I=>{console.log(I),n.$message.error({duration:3e3,content:"上传失败"})}).finally(()=>{v.value=!1})},r=()=>{var I;(I=p.value)==null||I.click()},A=I=>{const j=I.target.files[0];j&&(s.value=j.name,C=j)},m=I=>{$.value=!0},w=()=>{$.value=!1},U=I=>{I.preventDefault(),I.stopPropagation(),$.value=!1;const j=I.dataTransfer.files[0];if(j){s.value=j.name;const D=new DataTransfer;D.items.add(j),p.value.files=D.files,C=j}},h=async()=>{const I=await vn(o.value);if(I.code!==0){N(n,I.code),await Y.push({name:"problem"});return}const j=I.data.problem;f.value=bt(j,{}),i.setTitle(j.title+" - "+i.getTitle),k.value=[],I.data.judges?(I.data.judges.forEach(D=>{k.value.push({file:D.key,size:D.size,lastModified:D.last_modified})}),k.value.sort((D,T)=>D.file.endsWith(".zip")&&!T.file.endsWith(".zip")?-1:!D.file.endsWith(".zip")&&T.file.endsWith(".zip")?1:D.file.endsWith(".yaml")&&!T.file.endsWith(".yaml")?-1:!D.file.endsWith(".yaml")&&T.file.endsWith(".yaml")?1:0)):ge(n,"评测数据不存在"),y.value=!1};return pe(async()=>{if(Array.isArray(l.params.problemId)?o.value=l.params.problemId[0]:o.value=l.params.problemId,!o.value){ge(n,"题目不存在"),await Y.push({name:"problem"});return}y.value=!0,await h()}),(I,j)=>{const D=Ee,T=Te,z=O,L=he,M=Ye,F=We,te=Pe,X=Ve;return V(),E(X,{loading:y.value},{default:a(()=>[t(te,null,{default:a(()=>[t(T,{span:7},{default:a(()=>[R("div",us,[R("div",{id:"drop-zone",style:ga(b.value),onClick:r,onDragenter:Lt(m,["prevent"]),onDragover:j[0]||(j[0]=Lt(()=>{},["prevent"])),onDragleave:Lt(w,["prevent"]),onDrop:U},[R("input",{ref_key:"fileInput",ref:p,type:"file",style:{display:"none"},onChange:A},null,544),P(" "+q(S.value),1)],36)]),t(D,{data:k.value,columns:x.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1}),t(T,{span:5},{default:a(()=>[R("div",ds,[R("div",cs,[t(L,null,{default:a(()=>[t(z,{onClick:d,theme:"danger",loading:v.value},{default:a(()=>j[1]||(j[1]=[P("上传")])),_:1},8,["loading"]),t(z,{onClick:_,theme:"warning"},{default:a(()=>j[2]||(j[2]=[P("编辑")])),_:1}),t(z,{onClick:u},{default:a(()=>j[3]||(j[3]=[P("查看")])),_:1})]),_:1})]),t(F,{layout:"vertical",bordered:!0},{default:a(()=>[t(M,{label:"标题"},{default:a(()=>{var ae;return[P(q((ae=f.value)==null?void 0:ae.title),1)]}),_:1}),t(M,{label:"创建时间"},{default:a(()=>{var ae;return[P(q((ae=f.value)==null?void 0:ae.insertTime),1)]}),_:1}),t(M,{label:"更新时间"},{default:a(()=>{var ae;return[P(q((ae=f.value)==null?void 0:ae.updateTime),1)]}),_:1}),t(M,{label:"判题方式"},{default:a(()=>{var ae;return[P(q((ae=f.value)==null?void 0:ae.judgeType),1)]}),_:1}),t(M,{label:"评测数据"},{default:a(()=>{var ae;return[P(q((ae=f.value)==null?void 0:ae.judgeMd5),1)]}),_:1}),t(M,{label:"上传用户"},{default:a(()=>{var ae;return[P(q((ae=f.value)==null?void 0:ae.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),ps=de(ms,[["__scopeId","data-v-0098ef39"]]);function Yt(e){const l={};return l.id=e.id,l.ownerId=e.owner_id,l.ownerUsername=e.owner_username,l.ownerNickname=e.owner_nickname,l.title=e.title,e.start_time?l.startTime=new Date(e.start_time).toLocaleString():l.startTime="无限制",e.end_time?l.endTime=new Date(e.end_time).toLocaleString():l.endTime="无限制",e.update_time?l.updateTime=new Date(e.update_time).toLocaleString():l.updateTime="",e.create_time?l.createTime=new Date(e.create_time).toLocaleString():l.createTime="",e.description?l.description=e.description:l.description="",l.problems=e.problems,l}function fs(e){return G({url:"/collection?id="+e,method:"get"})}function vs(e){return G({url:"/collection/edit?id="+e,method:"get"})}function _s(e,l){return G({url:"/collection/list?page="+e+"&page_size="+l,method:"get"})}function gs(e){return G({url:"/collection/rank?id="+e,method:"get"})}function bs(e){return G({url:"/collection/create",method:"post",data:e})}function hs(e){return G({url:"/collection/edit",method:"post",data:e})}function ys(e){return G({url:"/collection/join",method:"post",data:{id:e}})}function ws(e){return G({url:"/collection/quit",method:"post",data:{id:e}})}const ks={style:{margin:"10px"}},Ss=ce({__name:"CollectionList",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=null;c(!1),c(!1);const y=c([{title:"ID",colKey:"id",width:"100",cell:(_,g)=>t(O,{variant:"text",onClick:()=>x(g.row.id)},{default:()=>[g.row.id]})},{title:"标题",colKey:"title",cell:(_,g)=>t(O,{variant:"text",onClick:()=>x(g.row.id)},{default:()=>[g.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),f=c(!1);let C=1,p=50;const s=c({current:C,pageSize:p,defaultCurrent:C,defaultPageSize:p,total:0,pageSizeOptions:[50,100]}),$=c(),v=c({title:"",username:""});c({title:"",description:"",open_time:[]});const x=_=>{_&&n.push({path:"/collection/"+_})},k=async()=>{await n.push({query:{...l.query,title:v.value.title,username:v.value.username,page:1,page_size:s.value.defaultPageSize}})},b=async(_,g)=>{var d;f.value=!0;try{const{current:r,pageSize:A}=_,m=await _s(r,A);if($.value=[],m.code===0){const w=m.data.list;for(let U=0;U<w.length;U++){const h=w[U],I=Yt(h);(d=$.value)==null||d.push(I)}s.value={...s.value,total:m.data.total_count}}else g&&N(i,m.code)}catch(r){console.error(r),N(i,He())}finally{f.value=!1}},S=async _=>{await n.push({query:{...l.query,page:_.current,page_size:_.pageSize}})},u=async()=>{await n.push({name:"collection-create"})};return pe(async()=>{o=$e(()=>l.query,_=>{v.value.title=_.title||"",v.value.username=_.username||"";const g=parseInt(_.page)||s.value.defaultCurrent,d=parseInt(_.page_size)||s.value.defaultPageSize;C=g,p=d,s.value={...s.value,current:C,pageSize:p},b({current:C,pageSize:p},!0)},{immediate:!0})}),De(()=>{o&&o()}),(_,g)=>{const d=Ee,r=be,A=Te,m=Ae,w=ze,U=O,h=Ue,I=he,j=Pe;return V(),E(j,null,{default:a(()=>[t(A,{span:9},{default:a(()=>[t(r,{style:{margin:"10px"}},{default:a(()=>[t(d,{data:$.value,columns:y.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:s.value,loading:f.value,onPageChange:S},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(A,{span:3},{default:a(()=>[R("div",ks,[t(r,{class:"sh-card"},{default:a(()=>[t(h,{model:v.value},{default:a(()=>[t(w,{label:"标题"},{default:a(()=>[t(m,{modelValue:v.value.title,"onUpdate:modelValue":g[0]||(g[0]=D=>v.value.title=D),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(w,{label:"负责人"},{default:a(()=>[t(m,{modelValue:v.value.username,"onUpdate:modelValue":g[1]||(g[1]=D=>v.value.username=D),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(w,null,{default:a(()=>[t(U,{theme:"primary",onClick:k},{default:a(()=>g[2]||(g[2]=[P("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(r,{class:"sh-card"},{default:a(()=>[t(I,null,{default:a(()=>[t(U,{onClick:u},{default:a(()=>g[3]||(g[3]=[P("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),Cs=de(Ss,[["__scopeId","data-v-cffb6215"]]),Is={style:{margin:"20px"}},Ps={class:"dida-operation-container"},xs={style:{margin:"12px"}},Ts=ce({__name:"CollectionDetail",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze(),o=Oe();let y=0;const f=c(!1),C=c(null),p=c(!1),s=c(!1);let $={};const v=Je(()=>o.hasAuth(Le.ManageCollection)||C.value&&o.getUserId==C.value.ownerId),x=g=>{if(!g||!$)return"default";const d=$[g];if(!d)return"default";switch(d){case Ge.Accept:return"success";case Ge.Attempt:return"warning";default:return"default"}},k=c([{title:"问题ID",colKey:"id",cell:(g,d)=>{const r=x(d.row.id);return t(O,{variant:"dashed",theme:r,onClick:()=>aa(d.row.id)},{default:()=>[d.row.id]})}},{title:"标题",colKey:"title",cell:(g,d)=>t(O,{variant:"text",onClick:()=>aa(d.row.id)},{default:()=>[d.row.title]})},{title:"正确",colKey:"accept",cell:(g,d)=>d.row.accept?d.row.accept:0},{title:"提交",colKey:"attempt",cell:(g,d)=>d.row.attempt?d.row.attempt:0}]),b=c([]),S=async()=>{if(!o.isLogin()){await Y.push({name:"login"});return}s.value=!0;try{const g=await ys(y);if(g.code!==0){N(n,g.code);return}p.value=!0,Ne(n,"加入成功")}finally{s.value=!1}},u=async()=>{if(!o.isLogin()){await Y.push({name:"login"});return}s.value=!0;try{const g=await ws(y);if(g.code!==0){N(n,g.code);return}p.value=!1,Ne(n,"退出成功")}finally{s.value=!1}},_=()=>{C.value&&Y.push({name:"collection-edit",params:{collectionId:C.value.id}})};return pe(async()=>{if(Array.isArray(l.params.collectionId)?y=Number(l.params.collectionId[0]):y=Number(l.params.collectionId),!y){await Y.push({name:"problem-collection-list"});return}p.value=!1,f.value=!0;const g=await fs(y);if(g.code!==0){f.value=!1,N(n,g.code),await Y.push({name:"problem-collection-list"});return}p.value=g.data.joined,$=g.data.attempt_status||{},C.value=Yt(g.data.collection),b.value=[],g.data.collection.problems&&g.data.collection.problems.forEach(d=>{const r=g.data.problems.find(A=>A.id===d);b.value.push(r)}),i.setTitle(C.value.title+" - "+i.getTitle),f.value=!1}),(g,d)=>{const r=Sa,A=ka,m=Ee,w=be,U=Te,h=O,I=he,j=Ye,D=We,T=Me("md-preview"),z=Pe,L=Ve;return V(),E(L,{loading:f.value},{default:a(()=>[t(z,{class:"dida-main-content"},{default:a(()=>[t(U,{span:6},{default:a(()=>[R("div",Is,[t(A,{"max-item-width":"300"},{default:a(()=>[t(r,{to:{name:"problem-collection-list"}},{default:a(()=>d[0]||(d[0]=[P("题目集合")])),_:1}),t(r,null,{default:a(()=>{var M;return[P(q((M=C.value)==null?void 0:M.title),1)]}),_:1})]),_:1})]),t(w,{style:{margin:"10px"}},{default:a(()=>[t(m,{data:b.value,columns:k.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),_:1})]),_:1}),t(U,{span:6},{default:a(()=>{var M;return[R("div",Ps,[t(I,null,{default:a(()=>[p.value?(V(),E(h,{key:0,onClick:u,loading:s.value},{default:a(()=>d[1]||(d[1]=[P("退出")])),_:1},8,["loading"])):(V(),E(h,{key:1,onClick:S,loading:s.value},{default:a(()=>d[2]||(d[2]=[P("加入")])),_:1},8,["loading"])),v.value?(V(),E(h,{key:2,onClick:_},{default:a(()=>d[3]||(d[3]=[P("编辑")])),_:1})):le("",!0)]),_:1})]),R("div",xs,[t(D,{layout:"vertical",bordered:!0},{default:a(()=>[t(j,{label:"创建者"},{default:a(()=>{var F;return[P(q((F=C.value)==null?void 0:F.ownerNickname),1)]}),_:1})]),_:1}),t(D,{layout:"vertical",bordered:!0},{default:a(()=>[t(j,{label:"开始时间"},{default:a(()=>{var F;return[P(q((F=C.value)==null?void 0:F.startTime),1)]}),_:1})]),_:1}),t(D,{layout:"vertical",bordered:!0},{default:a(()=>[t(j,{label:"结束时间"},{default:a(()=>{var F;return[P(q((F=C.value)==null?void 0:F.endTime),1)]}),_:1})]),_:1})]),(M=C.value)!=null&&M.description?(V(),E(w,{key:0,style:{margin:"10px"}},{default:a(()=>{var F;return[t(T,{"model-value":(F=C.value)==null?void 0:F.description},null,8,["model-value"])]}),_:1})):le("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),Vs=de(Ts,[["__scopeId","data-v-042bd4bb"]]),Ds=ce({__name:"CollectionRank",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=null,y=0,f=0;const C=c([{title:"Rank",colKey:"rank",align:"center"},{title:"序号",colKey:"index",align:"center"},{title:"Username",colKey:"username",cell:(x,k)=>t(O,{variant:"text",onClick:()=>n.push({name:"user",params:{username:k.row.username}})},{default:()=>[k.row.username]})},{title:"昵称",colKey:"nickname",cell:(x,k)=>t(O,{variant:"text",onClick:()=>n.push({name:"user",params:{username:k.row.username}})},{default:()=>[k.row.nickname]})},{title:"Count",colKey:"count",cell:(x,k)=>t(O,{variant:"text",onClick:()=>n.push({name:"judge-list",query:{username:k.row.username,status:Be.Accept}})},{default:()=>[`${k.row.accept} / ${f}`]})},{title:"Progress",colKey:"progress",cell:(x,k)=>{let b=100;return f>0&&(b=Number((k.row.accept/f*100).toFixed(2))),t(Ft,{percentage:b},null)}}]),p=c(!1),s=c([]),$=({col:x,rowIndex:k})=>{let b=1;for(let S=k+1;S<s.value.length&&s.value[S].rank===s.value[k].rank;S++)b++;if(x.colKey==="rank")return{rowspan:b}},v=async x=>{p.value=!0;try{const k=await gs(y);if(s.value=[],k.code===0){f=k.data.problem;const b=k.data.ranks,S=[];if(b){for(let g=0;g<b.length;g++){const d=b[g];let r={userId:d.author_id,username:d.author_username,nickname:d.author_nickname};r.accept=d.accept,S.push(r)}S.sort((g,d)=>g.accept!==d.accept?d.accept-g.accept:g.userId-d.userId);let u=0,_=-1;for(let g=0;g<S.length;g++)S[g].accept!==_&&(u=g+1,_=S[g].accept),S[g].index=g+1,S[g].rank=u}s.value=S}else x&&N(i,k.code)}catch(k){console.error(k),N(i,He())}finally{p.value=!1}};return pe(async()=>{o=$e(()=>l.query,async()=>{if(Array.isArray(l.params.collectionId)?y=Number(l.params.collectionId[0]):y=Number(l.params.collectionId),!y){await n.push({name:"problem-collection-list"});return}await v(!0)},{immediate:!0})}),De(()=>{o&&o()}),(x,k)=>{const b=Ee,S=be,u=Pe;return V(),E(u,null,{default:a(()=>[t(S,{style:{margin:"10px"}},{default:a(()=>[R("div",null,[t(b,{data:s.value,columns:C.value,"row-key":"index","rowspan-and-colspan":$,"vertical-align":"middle",bordered:!0,hover:!0,loading:p.value},null,8,["data","columns","loading"])])]),_:1})]),_:1})}}});var Fe=(e=>(e[e.Valid=0]="Valid",e[e.Duplicate=1]="Duplicate",e[e.Invalid=2]="Invalid",e))(Fe||{});const js={class:"dida-form-border"},Ls={style:{"text-align":"right"}},$s=ce({name:"ParseProblemList",__name:"ParseProblemList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:l}=_e(),n=c(!1),i=c(!1),o=c(""),y=ba(e,"modelValue");let f=[];$e(y,async x=>{JSON.stringify(x)!==JSON.stringify(f)&&(await s(x),f=y.value)},{deep:!0});const C=c([]),p=c([{title:"有效性",colKey:"validType",cell:(x,k)=>{switch(k.row.valid){case Fe.Valid:return t(et,{theme:"success"},{default:()=>[P("有效")]});case Fe.Duplicate:return t(et,{theme:"warning"},{default:()=>[P("重复")]});case Fe.Invalid:return t(et,{theme:"danger"},{default:()=>[P("无效")]});default:return null}}},{title:"问题ID",colKey:"id"},{title:"标题",colKey:"title"}]),s=async x=>{const k=Array.from(new Set(x)),b=await jn(k);if(b.code!==0){N(l,b.code),i.value=!1;return}const S=[],u=b.data.problems;let _=[];x.forEach(g=>{const d=u.find(r=>r.id===g);if(d){const r=S.find(A=>A.id===g);d.valid=r?Fe.Duplicate:Fe.Valid,S.push({id:g,title:d.title,valid:d.valid}),r||_.push(g)}else S.push({id:g,title:"-",valid:Fe.Invalid})}),C.value=S,f=_,y.value=_},$=async()=>{i.value=!0;const x=Pa(o.value);await s(x),n.value=!1,i.value=!1},v=()=>{C.value?o.value=C.value.map(x=>x.id).join(`
`):o.value="",n.value=!0};return(x,k)=>{const b=O,S=Ee,u=Tt,_=ot;return V(),ee(me,null,[R("div",js,[R("div",Ls,[t(b,{onClick:v},{default:a(()=>k[2]||(k[2]=[P("编辑")])),_:1})]),t(S,{data:C.value,columns:p.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(_,{visible:n.value,"onUpdate:visible":k[1]||(k[1]=g=>n.value=g),onConfirm:$,header:"请输入问题ID","confirm-loading":i.value},{default:a(()=>[k[3]||(k[3]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(u,{modelValue:o.value,"onUpdate:modelValue":k[0]||(k[0]=g=>o.value=g),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Ma=de($s,[["__scopeId","data-v-b0352688"]]),Us={class:"dida-form-border"},zs={style:{"text-align":"right"}},As=ce({name:"ParseUserList",__name:"ParseUserList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:l}=_e(),n=c(!1),i=c(!1),o=c(""),y=ba(e,"modelValue");let f=[];$e(y,async b=>{JSON.stringify(b)!==JSON.stringify(f)&&(f=b,await $(b))},{deep:!0});const C=c(),p=c([{title:"有效性",colKey:"validType",cell:(b,S)=>{switch(S.row.valid){case Fe.Valid:return t(et,{theme:"success"},{default:()=>[P("有效")]});case Fe.Duplicate:return t(et,{theme:"warning"},{default:()=>[P("重复")]});case Fe.Invalid:return t(et,{theme:"danger"},{default:()=>[P("无效")]})}}},{title:"Username",colKey:"username"},{title:"昵称",colKey:"nickname"}]),s=(b,S)=>{if(b.code!==0){N(l,b.code),i.value=!1;return}const u=[],_=b.data.users;let g=[];S?S.forEach(d=>{let r=null;if(_&&(r=_.find(A=>A.username.toLowerCase()===d.toLowerCase())),r){const A=u.find(w=>w.username.toLowerCase()===d.toLowerCase()),m=A?Fe.Duplicate:Fe.Valid;u.push({id:r.id,username:r.username,nickname:r.nickname,valid:m}),A||g.push(r.id)}else u.push({id:-1,username:d,nickname:"-",valid:Fe.Invalid})}):_&&_.forEach(d=>{const r=u.find(m=>m.id===d.id),A=r?Fe.Duplicate:Fe.Valid;u.push({id:d.id,username:d.username,nickname:d.nickname,valid:A}),r||g.push(d.id)}),C.value=u,f=g,y.value=g},$=async b=>{const S=Array.from(new Set(b)),u=await Bn(S);s(u)},v=async b=>{const S=Array.from(new Set(b)),u=await Jn(S);s(u,b)},x=async()=>{i.value=!0;const b=Pa(o.value);await v(b),n.value=!1,i.value=!1},k=()=>{C.value?o.value=C.value.map(b=>b.username).join(`
`):o.value="",n.value=!0};return(b,S)=>{const u=O,_=Ee,g=Tt,d=ot;return V(),ee(me,null,[R("div",Us,[R("div",zs,[t(u,{onClick:k},{default:a(()=>S[2]||(S[2]=[P("编辑")])),_:1})]),t(_,{data:C.value,columns:p.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(d,{visible:n.value,"onUpdate:visible":S[1]||(S[1]=r=>n.value=r),onConfirm:x,header:"请输入用户Username","confirm-loading":i.value},{default:a(()=>[S[3]||(S[3]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(g,{modelValue:o.value,"onUpdate:modelValue":S[0]||(S[0]=r=>o.value=r),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Ea=de(As,[["__scopeId","data-v-b0b99852"]]),Rs={style:{margin:"10px"}},Ms={style:{margin:"12px"}},Es={class:"dida-edit-container"},qs=ce({__name:"CollectionEdit",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze(),o=c(""),y=c(!1),f=c(!1),C=c(!1),p=c(null),s=c({title:"",openTime:[],private:!0,problems:[],members:[],description:""}),$=c(""),v=c(""),x=c(!1),k=async()=>{x.value=!0,C.value=!1,x.value=!1},b=async()=>{f.value=!0;try{const d={title:s.value.title,problems:s.value.problems,members:s.value.members,private:s.value.private,description:s.value.description};s.value.openTime[0]&&(d.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(d.end_time=new Date(s.value.openTime[1]));const r=await bs(d);if(r.code!==0){N(n,r.code);return}r.data!=null&&await Y.push({name:"collection-detail",params:{collectionId:r.data}}),Ne(n,"创建成功")}finally{f.value=!1}},S=async()=>{f.value=!0;try{const d={id:Number(o.value),title:s.value.title,private:s.value.private,problems:s.value.problems,members:s.value.members,description:s.value.description};s.value.openTime[0]&&(d.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(d.end_time=new Date(s.value.openTime[1]));const r=await hs(d);if(r.code!==0){N(n,r.code);return}r.data!=null&&p.value&&(p.value.updateTime=new Date(r.data).toLocaleString()),Ne(n,"保存成功")}finally{f.value=!1}},u=d=>{s.value.description=d,y.value=!1};async function _(d,r){f.value=!0,ge(n,"本界面暂不支持上传图片"),f.value=!1}const g=async()=>{const d=await vs(o.value);if(d.code!==0){N(n,d.code),console.error("collection get failed",d.code),await Y.push({name:"problem-collection-list"});return}const r=d.data.collection;p.value=Yt(r),s.value.title=r.title,s.value.openTime=[],r.start_time?s.value.openTime.push(new Date(r.start_time)):s.value.openTime.push(""),r.end_time?s.value.openTime.push(new Date(r.end_time)):s.value.openTime.push(""),s.value.private=r.private,s.value.description=r.description,s.value.problems=r.problems,s.value.members=r.members,i.setTitle(r.title+" - "+i.getTitle);let A="";r.description&&(A=r.description),u(A)};return pe(async()=>{Array.isArray(l.params.collectionId)?o.value=l.params.collectionId[0]:o.value=l.params.collectionId,o.value?(y.value=!0,await g()):u("")}),(d,r)=>{const A=Ae,m=ze,w=Ot,U=gt,h=Ue,I=be,j=Te,D=O,T=he,z=Ye,L=We,M=Pe,F=Me("md-editor-v3"),te=Ve,X=Tt,ae=ot;return V(),ee(me,null,[t(te,{loading:y.value},{default:a(()=>[t(M,null,{default:a(()=>[t(j,{span:8},{default:a(()=>[R("div",Rs,[t(I,{class:"sh-card"},{default:a(()=>[t(h,{model:s.value},{default:a(()=>[t(m,{label:"标题"},{default:a(()=>[t(A,{modelValue:s.value.title,"onUpdate:modelValue":r[0]||(r[0]=Q=>s.value.title=Q),placeholder:"题集标题"},null,8,["modelValue"])]),_:1}),t(m,{label:"开启时间"},{default:a(()=>[t(w,{modelValue:s.value.openTime,"onUpdate:modelValue":r[1]||(r[1]=Q=>s.value.openTime=Q),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(m,{label:"私有"},{default:a(()=>[t(U,{modelValue:s.value.private,"onUpdate:modelValue":r[2]||(r[2]=Q=>s.value.private=Q)},null,8,["modelValue"])]),_:1}),t(m,{label:"成员"},{default:a(()=>[t(Ea,{modelValue:s.value.members,"onUpdate:modelValue":r[3]||(r[3]=Q=>s.value.members=Q)},null,8,["modelValue"])]),_:1}),t(m,{label:"问题"},{default:a(()=>[t(Ma,{modelValue:s.value.problems,"onUpdate:modelValue":r[4]||(r[4]=Q=>s.value.problems=Q)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(j,{span:4},{default:a(()=>[R("div",Ms,[R("div",Es,[o.value?(V(),E(T,{key:0},{default:a(()=>[t(D,{onClick:S,theme:"danger",loading:f.value},{default:a(()=>r[8]||(r[8]=[P("保存")])),_:1},8,["loading"])]),_:1})):(V(),E(T,{key:1},{default:a(()=>[t(D,{onClick:b,theme:"danger",loading:f.value},{default:a(()=>r[9]||(r[9]=[P("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(V(),E(L,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(z,{label:"创建时间"},{default:a(()=>{var Q;return[P(q((Q=p.value)==null?void 0:Q.createTime),1)]}),_:1}),t(z,{label:"更新时间"},{default:a(()=>{var Q;return[P(q((Q=p.value)==null?void 0:Q.updateTime),1)]}),_:1}),t(z,{label:"创建用户"},{default:a(()=>{var Q;return[P(q((Q=p.value)==null?void 0:Q.ownerNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),t(F,{id:"collection-description-editor",modelValue:s.value.description,"onUpdate:modelValue":r[5]||(r[5]=Q=>s.value.description=Q),onSave:S,onOnUploadImg:_,previewTheme:"cyanosis",class:"dida-description-editor"},null,8,["modelValue"]),t(te,{loading:f.value,attach:"#collection-description-editor","z-index":1e5},null,8,["loading"])]),_:1},8,["loading"]),t(ae,{visible:C.value,"onUpdate:visible":r[7]||(r[7]=Q=>C.value=Q),onConfirm:k,header:$.value,"confirm-loading":x.value},{default:a(()=>[r[10]||(r[10]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(X,{modelValue:v.value,"onUpdate:modelValue":r[6]||(r[6]=Q=>v.value=Q),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),sa=de(qs,[["__scopeId","data-v-79ccaf8c"]]);function ra(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!at(e)}const Ks=ce({__name:"JudgeJobList",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=!1,y=null,f;const C=c(!1),p=c(null),s=c(!1);let $=-1;const v=c({problemId:"",username:"",language:void 0,status:void 0}),x=c([{title:"ID",colKey:"id",cell:(D,T)=>{let z=null;return Ct(T.row.status)&&St(T.row.language)&&(z=()=>{m(T.row.id)}),t(O,{variant:"text",onClick:z},{default:()=>[T.row.id]})}},{title:"问题",colKey:"problemId",cell:(D,T)=>{if($){let z;return t(O,{variant:"text",onClick:()=>ft($,T.row.contestProblemIndex)},ra(z=tt(T.row.contestProblemIndex))?z:{default:()=>[z]})}return t(O,{variant:"text",onClick:()=>A(T.row.problemId)},{default:()=>[T.row.problemId]})}},{title:"状态",colKey:"status",align:"center",cell:(D,T)=>{let z=null;Ct(T.row.status)&&St(T.row.language)&&(z=()=>{m(T.row.id)});const L=T.row.status,M=Pt(L);let F=!Ct(L);const te=Va(L);let X=[];return ut(L)&&X.push(t(Ve,{text:T.row.state,size:"small",class:"dida-status-loading"},null)),X.push(t("span",null,[M])),t(O,{theme:te,variant:"outline",onClick:z,disabled:F},ra(X)?X:{default:()=>[X]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"code",cell:(D,T)=>{let z=!St(T.row.language);return t(O,{theme:"default",onClick:()=>r(T.row),disabled:z},{default:()=>[It(T.row.language)+" / "+T.row.codeLength]})}},{title:"作者",colKey:"author",width:200,cell:(D,T)=>t(O,{variant:"text",onClick:()=>w(T.row.authorUsername)},{default:()=>[T.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),k=c(!1);let b=1,S=50;const u=c({current:b,pageSize:S,defaultCurrent:b,defaultPageSize:S,total:0,pageSizeOptions:[50,100]}),_=c(),g=c([]);g.value=Gt();const d=c([]);d.value=Da();const r=async D=>{s.value=!0,C.value=!0;try{p.value=D;const T=await rn(Number(p.value.id));if(T.code===0){const z=T.data,L=Ht(z.language);p.value.code=`\`\`\`${L}
${z.code}
\`\`\``}else N(i,T.code)}finally{s.value=!1}},A=D=>{D&&n.push({path:"/problem/"+D})},m=D=>{D&&($>0?n.push({name:"contest-judge-detail",params:{contestId:$,judgeId:D}}):n.push({name:"judge-detail",params:{judgeId:D}}))},w=D=>{D&&n.push({path:"/user/"+D})},U=async()=>{await n.push({query:{...l.query,page:1,page_size:S,problem_id:v.value.problemId,username:v.value.username,language:v.value.language,status:v.value.status}})},h=async()=>{v.value.problemId="",v.value.username="",v.value.language=void 0,v.value.status=void 0,await n.push({query:{...l.query,page:1,page_size:S,problem_id:"",username:"",language:void 0,status:void 0}})},I=async(D,T)=>{T&&(k.value=!0);let z=!1;try{const{current:L,pageSize:M}=D,F=await un($,v.value.problemId,v.value.username,v.value.language,v.value.status,L,M);if(_.value=[],F.code===0){if(!F.data.has_auth){we(i,"您目前没有权限查看评测记录"),$?await n.push({name:"contest-detail",params:{contestId:$}}):await n.push({name:"judge-list"});return}F.data.list&&F.data.list.length>0?(F.data.list.forEach(X=>{var Q;const ae=ja(X);(Q=_.value)==null||Q.push(ae),ut(X.status)&&(z=!0)}),u.value={...u.value,total:F.data.total_count}):(we(i,"未找到记录"),u.value={...u.value,total:0})}else T&&N(i,F.code)}catch(L){console.error(L),T&&N(i,He())}finally{T&&(k.value=!1),z&&o&&(clearTimeout(f),f=setTimeout(()=>{I({current:b,pageSize:S},!1)},5e3))}},j=async D=>{await n.push({query:{...l.query,page:D.current,page_size:D.pageSize}})};return pe(async()=>{o=!0,y=$e(()=>l.query,D=>{Array.isArray(l.params.contestId)?$=Number(l.params.contestId[0]):$=Number(l.params.contestId),v.value.problemId=D.problem_id||"",v.value.username=D.username||"",D.language!=null?v.value.language=Number(D.language):v.value.language=void 0,D.status!=null?v.value.status=Number(D.status):v.value.status=void 0;const T=parseInt(D.page)||u.value.defaultCurrent,z=parseInt(D.page_size)||u.value.defaultPageSize;b=T,S=z,u.value.pageSizeOptions.includes(S)||(S=u.value.defaultPageSize),u.value={...u.value,current:b,pageSize:S},I({current:b,pageSize:S},!0)},{immediate:!0})}),De(()=>{o=!1,y&&y(),clearTimeout(f)}),(D,T)=>{const z=Ae,L=ze,M=Nt,F=_t,te=O,X=he,ae=Ue,Q=Ee,B=be,ie=nt,ue=Me("md-preview"),ye=Ve,W=ot;return V(),ee(me,null,[t(B,{style:{margin:"10px"}},{default:a(()=>[t(ae,{layout:"inline",onSubmit:U,onReset:h},{default:a(()=>[t(L,{label:"题号"},{default:a(()=>[t(z,{modelValue:v.value.problemId,"onUpdate:modelValue":T[0]||(T[0]=K=>v.value.problemId=K),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(L,{label:"用户"},{default:a(()=>[t(z,{modelValue:v.value.username,"onUpdate:modelValue":T[1]||(T[1]=K=>v.value.username=K),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(L,{label:"语言"},{default:a(()=>[t(F,{modelValue:v.value.language,"onUpdate:modelValue":T[2]||(T[2]=K=>v.value.language=K),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:a(()=>[(V(!0),ee(me,null,xe(g.value,K=>(V(),E(M,{key:K.value,value:K.value,label:K.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(L,{label:"状态"},{default:a(()=>[t(F,{modelValue:v.value.status,"onUpdate:modelValue":T[3]||(T[3]=K=>v.value.status=K),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:a(()=>[(V(!0),ee(me,null,xe(d.value,K=>(V(),E(M,{key:K.value,value:K.value,label:K.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(L,null,{default:a(()=>[t(X,null,{default:a(()=>[t(te,{theme:"primary",type:"submit"},{default:a(()=>T[7]||(T[7]=[P("搜索")])),_:1}),t(te,{theme:"default",variant:"base",type:"reset"},{default:a(()=>T[8]||(T[8]=[P("重置")])),_:1})]),_:1})]),_:1})]),_:1}),t(Q,{data:_.value,columns:x.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:u.value,loading:k.value,onPageChange:j,"table-layout":"auto"},null,8,["data","columns","pagination","loading"])]),_:1}),t(W,{visible:C.value,"onUpdate:visible":T[5]||(T[5]=K=>C.value=K),width:"800px","cancel-btn":null,"close-btn":!1,onConfirm:T[6]||(T[6]=K=>C.value=!1)},{header:a(()=>[t(ie,{onClick:T[4]||(T[4]=()=>{var K;m((K=p.value)==null?void 0:K.id)})},{default:a(()=>{var K,Z,J;return[P(q(((K=p.value)==null?void 0:K.id)+" - "+fe(It)((Z=p.value)!=null&&Z.language?(J=p.value)==null?void 0:J.language:fe(jt).Unknown)),1)]}),_:1})]),default:a(()=>[t(ye,{loading:s.value},{default:a(()=>{var K;return[t(ue,{"model-value":(K=p.value)==null?void 0:K.code,"code-foldable":!1,style:{"min-height":"100px"}},null,8,["model-value"])]}),_:1},8,["loading"])]),_:1},8,["visible"])],64)}}}),ia=de(Ks,[["__scopeId","data-v-444c636c"]]),Fs={class:"dida-code-container"},Ns={style:{margin:"20px"}},Os={key:2,class:"dida-edit-container"};function zt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!at(e)}const Gs=ce({__name:"JudgeJobDetail",setup(e){const l=Se(),n=Xe(),i=Oe(),{globalProperties:o}=_e();let y=!1,f,C=0,p=0;const s=c(""),$=c(null),v=c(""),x=c(0),k=c(null),b=c({from:"#5a96ff",to:"#00A870"}),S=c([{title:"ID",colKey:"id"},{title:"问题",colKey:"problemId",cell:(h,I)=>{if(p){let j;return t(O,{variant:"text",onClick:()=>ft(p,I.row.contestProblemIndex)},zt(j=tt(I.row.contestProblemIndex))?j:{default:()=>[j]})}return t(O,{variant:"text",onClick:()=>A(I.row.problemId)},{default:()=>[I.row.problemId]})}},{title:"状态",colKey:"status",align:"center",cell:(h,I)=>{const j=I.row.status,D=Pt(j),T=Va(j);let z=[];return ut(j)&&z.push(t(Ve,{text:I.row.state,size:"small",class:"dida-status-loading"},null)),z.push(t("span",null,[D])),t(O,{theme:T,variant:"outline"},zt(z)?z:{default:()=>[z]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"language",cell:(h,I)=>t("span",null,[It(I.row.language)+" / "+I.row.codeLength])},{title:"作者",colKey:"author",width:200,cell:(h,I)=>t(O,{variant:"text",onClick:()=>m(I.row.authorUsername)},{default:()=>[I.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),u=c(!1),_=c(!1),g=c(),d=Je(()=>i.hasAuth(Le.ManageJudge)),r=async()=>{if(!_.value){_.value=!0;try{const h=await fn(C);h.code===0?await U(!0):N(o,h.code)}catch(h){console.error(h),N(o,He())}finally{_.value=!1}}},A=h=>{h&&n.push({path:"/problem/"+h})},m=h=>{h&&n.push({path:"/user/"+h})},w=h=>{const I=h.status,j=Pt(I);let D;switch(I){case Be.Init:case Be.Rejudge:case Be.Compiling:case Be.Running:D="default";break;case Be.Accept:D="success";break;case Be.PE:D="warning";break;default:D="danger";break}return t(he,null,{default:()=>[t(O,{theme:"default",variant:"outline"},{default:()=>[h.taskId]}),t(O,{theme:D,variant:"outline"},zt(j)?j:{default:()=>[j]}),t("span",null,[P("分数："),h.score]),t("span",null,[P("用时："),h.time]),t("span",null,[P("内存："),h.memory])]})},U=async h=>{var j;h&&(u.value=!0);let I=!1;try{const D=await sn(C,p);if(g.value=[],D.code===0){const T=D.data,z=ja(T);if((j=g.value)==null||j.push(z),s.value=z.judgerName,b.value.to="#00A870",ut(T.status)?(k.value="active",z.taskTotal>0?(x.value=Number((z.taskCurrent/z.taskTotal*100).toFixed(2)),z.taskCurrent>=z.taskTotal&&(x.value=99)):x.value=0):(x.value=100,T.status===Be.Accept?k.value="success":T.status===Be.PE?(b.value.to="#F57C20",k.value="warning"):(b.value.to="#F56C6C",k.value="error")),T.code){const L=Ht(T.language);v.value=`\`\`\`${L}
${T.code}
\`\`\``}$.value=z,ut(T.status)&&(I=!0)}else h&&N(o,D.code),p?await n.push({name:"contest-judge",params:{contestId:p}}):await n.push({name:"judge-list"})}catch(D){console.error(D),h&&N(o,He())}finally{h&&(u.value=!1),I&&y&&(f=setTimeout(()=>{U(!1)},5e3))}};return pe(async()=>{if(y=!0,Array.isArray(l.params.judgeId)?C=Number(l.params.judgeId[0]):C=Number(l.params.judgeId),Array.isArray(l.params.contestId)?p=Number(l.params.contestId[0]):p=Number(l.params.contestId),!C){await n.push({name:"judge"});return}await U(!0)}),De(()=>{y=!1,clearTimeout(f)}),(h,I)=>{var B,ie,ue;const j=Ft,D=Ee,T=be,z=Me("md-preview"),L=Te,M=Ye,F=We,te=Pe,X=Cl,ae=Il,Q=O;return V(),ee(me,null,[t(j,{color:b.value,status:k.value,class:"dida-job-progress",percentage:x.value},null,8,["color","status","percentage"]),t(T,{style:{margin:"10px"}},{default:a(()=>[t(D,{data:g.value,columns:S.value,"row-key":"id","vertical-align":"top",hover:!0,loading:u.value},null,8,["data","columns","loading"])]),_:1}),t(te,null,{default:a(()=>[t(L,{span:8},{default:a(()=>[R("div",Fs,[t(z,{"model-value":v.value,class:"dida-code-div"},null,8,["model-value"])])]),_:1}),t(L,{span:4},{default:a(()=>[R("div",Ns,[t(F,{layout:"vertical",bordered:!0},{default:a(()=>[t(M,{label:"判题机"},{default:a(()=>[P(q(s.value),1)]),_:1}),t(M,{label:"判题时间"},{default:a(()=>{var ye;return[P(q((ye=$.value)==null?void 0:ye.judgeTime),1)]}),_:1})]),_:1}),t(T,{class:"dida-card-tips"},{default:a(()=>{var ye;return[P(q(u.value?"数据正在加载，请等待":fe(ta)((ye=$.value)==null?void 0:ye.status)),1)]}),_:1})])]),_:1})]),_:1}),(B=$.value)!=null&&B.compileMessage?(V(),E(T,{key:0,class:"compile-message"},{default:a(()=>{var ye;return[P(q((ye=$.value)==null?void 0:ye.compileMessage),1)]}),_:1})):le("",!0),(ie=$.value)!=null&&ie.task&&((ue=$.value)==null?void 0:ue.task.length)>0?(V(),E(ae,{key:1,class:"task-panel"},{default:a(()=>{var ye;return[(V(!0),ee(me,null,xe((ye=$.value)==null?void 0:ye.task,(W,K)=>(V(),E(X,{key:W.taskId,header:()=>w(W)},{default:a(()=>[t(T,null,{default:a(()=>[P(q(fe(ta)(W.status)),1)]),_:2},1024),W.content?(V(),E(T,{key:0,class:"dida-card-tips"},{default:a(()=>[t(z,{"model-value":W.content},null,8,["model-value"])]),_:2},1024)):le("",!0),W.waHint?(V(),E(T,{key:1,class:"dida-card-tips"},{default:a(()=>[t(z,{"model-value":W.waHint},null,8,["model-value"])]),_:2},1024)):le("",!0)]),_:2},1032,["header"]))),128))]}),_:1})):le("",!0),d.value?(V(),ee("div",Os,[t(Q,{onClick:r,loading:_.value},{default:a(()=>I[0]||(I[0]=[P("重新评测")])),_:1},8,["loading"])])):le("",!0)],64)}}}),ua=de(Gs,[["__scopeId","data-v-aab721fd"]]),Hs={style:{margin:"10px"}},Bs=ce({__name:"ContestList",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=null;const y=c([{title:"ID",colKey:"id",cell:(g,d)=>t(O,{variant:"text",onClick:()=>x(d.row.id)},{default:()=>[d.row.id]})},{title:"标题",colKey:"title",cell:(g,d)=>t(O,{variant:"text",onClick:()=>x(d.row.id)},{default:()=>[d.row.title]})},{title:"负责人",colKey:"ownerNickname",cell:(g,d)=>t(O,{variant:"text",onClick:()=>Wt(n,d.row.ownerUsername)},{default:()=>[d.row.ownerNickname]})},{title:"权限",colKey:"private",cell:(g,d)=>d.row.private?"私有":"公开"},{title:"开始时间",colKey:"startTime"},{title:"结束时间",colKey:"endTime"}]),f=c(!1);let C=1,p=50;const s=c({current:C,pageSize:p,defaultCurrent:C,defaultPageSize:p,total:0,pageSizeOptions:[50,100]}),$=c(),v=c({title:"",username:""}),x=g=>{g&&n.push({path:"/contest/"+g})},k=async()=>{await n.push({query:{...l.query,title:v.value.title,username:v.value.username,page:1,page_size:s.value.defaultPageSize}})},b=async()=>{v.value.title="",v.value.username="",await n.push({query:{...l.query,title:"",username:"",page:1,page_size:s.value.defaultPageSize}})},S=async(g,d)=>{var r;f.value=!0;try{const{current:A,pageSize:m}=g,w=await Io(v.value.title,v.value.username,A,m);if($.value=[],w.code===0){const U=w.data.list;for(let h=0;h<U.length;h++){const I=U[h],j=Jt(I);(r=$.value)==null||r.push(j)}s.value={...s.value,total:w.data.total_count}}else d&&N(i,w.code)}catch(A){console.error(A),N(i,He())}finally{f.value=!1}},u=async g=>{await n.push({query:{...l.query,page:g.current,page_size:g.pageSize}})},_=()=>{n.push({name:"contest-create"})};return pe(async()=>{o=$e(()=>l.query,g=>{v.value.title=g.title||"",v.value.username=g.username||"";const d=parseInt(g.page)||s.value.defaultCurrent,r=parseInt(g.page_size)||s.value.defaultPageSize;C=d,p=r,s.value={...s.value,current:C,pageSize:p},S({current:C,pageSize:p},!0)},{immediate:!0})}),De(()=>{o&&o()}),(g,d)=>{const r=Ee,A=be,m=Te,w=Ae,U=ze,h=O,I=he,j=Ue,D=Pe;return V(),E(D,null,{default:a(()=>[t(m,{span:9},{default:a(()=>[t(A,{style:{margin:"10px"}},{default:a(()=>[t(r,{data:$.value,columns:y.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:s.value,loading:f.value,"table-layout":"auto",onPageChange:u,style:{"white-space":"nowrap"}},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(m,{span:3},{default:a(()=>[R("div",Hs,[t(A,{class:"sh-card"},{default:a(()=>[t(j,{model:v.value,onSubmit:k,onReset:b},{default:a(()=>[t(U,{label:"标题"},{default:a(()=>[t(w,{modelValue:v.value.title,"onUpdate:modelValue":d[0]||(d[0]=T=>v.value.title=T),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(U,{label:"负责人"},{default:a(()=>[t(w,{modelValue:v.value.username,"onUpdate:modelValue":d[1]||(d[1]=T=>v.value.username=T),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(U,null,{default:a(()=>[t(I,null,{default:a(()=>[t(h,{theme:"primary",type:"submit"},{default:a(()=>d[2]||(d[2]=[P("提交")])),_:1}),t(h,{theme:"danger",type:"reset"},{default:a(()=>d[3]||(d[3]=[P("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(A,{class:"sh-card"},{default:a(()=>[t(I,null,{default:a(()=>[t(h,{onClick:_},{default:a(()=>d[4]||(d[4]=[P("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),da=de(Bs,[["__scopeId","data-v-dcab2ec1"]]),Js={style:{margin:"20px"}},Ws={style:{margin:"10px"}},Ys={style:{"text-align":"center","align-content":"center",padding:"20px",height:"500px"}},Xs={style:{"text-align":"center",width:"100%"}},Zs={class:"dida-operation-container"},Qs={style:{margin:"12px"}},er=ce({__name:"ContestDetail",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze(),o=Oe(),y=c(!1);let f=0;const C=c(!1),p=c(null),s=c(!1),$=c(!1),v=c(""),x=Je(()=>o.hasAuth(Le.ManageContest)||p.value&&o.getUserId==p.value.ownerId),k=m=>{if(!m||!u)return"default";const w=u[m];if(!w)return"default";switch(w){case Ge.Accept:return"success";case Ge.Attempt:return"warning";default:return"default"}},b=c([{title:"问题ID",colKey:"index",cell:(m,w)=>{const U=k(w.row.index);return t(O,{variant:"dashed",theme:U,onClick:async()=>await ft(f,w.row.index)},{default:()=>[w.row.id]})}},{title:"标题",colKey:"title",cell:(m,w)=>t(O,{variant:"text",onClick:async()=>await ft(f,w.row.index)},{default:()=>[w.row.title]})},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),S=c([]);let u={},_=c(!1);const g=()=>{Y.push({name:"contest-edit",params:{contestId:f}})},d=async()=>{y.value=!0;try{const m=await Do(f);if(m.code!==0){N(n,m.code);return}const w=m.data;we(n,"查重报告已生成，请前往查看"),window.open(w,"_blank")}finally{y.value=!1}},r=async m=>{if(!o.isLogin()){await Y.push({name:"login"});return}if(!v.value){ge(n,"请输入密码");return}_.value=!0;try{const w=await Vo(f,v.value);if(w.code!==0){N(n,w.code);return}we(n,"申请访问成功"),await A()}catch(w){console.error("Error submitting contest password:",w),N(n,"提交密码失败，请稍后再试")}finally{_.value=!1}},A=async()=>{C.value=!0;const m=await yo(f);if(m.code!==0){C.value=!1,N(n,m.code),await Y.push({name:"contest"});return}s.value=m.data.has_auth,$.value=m.data.need_password,p.value=Jt(m.data.contest),S.value=p.value.problems,u=m.data.attempt_status||{},i.setTitle(p.value.title+" - "+i.getTitle),C.value=!1};return pe(async()=>{if(Array.isArray(l.params.contestId)?f=Number(l.params.contestId[0]):f=Number(l.params.contestId),!f){await Y.push({name:"contest"});return}await A()}),(m,w)=>{const U=xt,h=Ee,I=be,j=Ae,D=ze,T=O,z=Ue,L=Te,M=he,F=Ye,te=We,X=Me("md-preview"),ae=Pe,Q=Ve;return V(),E(Q,{loading:C.value},{default:a(()=>[t(ae,{class:"dida-main-content"},{default:a(()=>[t(L,{span:6},{default:a(()=>{var B,ie,ue;return[R("div",Js,[R("h1",null,q((B=p.value)==null?void 0:B.title),1),(ie=p.value)!=null&&ie.notification?(V(),E(U,{key:0,theme:"info",message:(ue=p.value)==null?void 0:ue.notification},null,8,["message"])):le("",!0)]),R("div",Ws,[s.value?(V(),E(I,{key:0},{default:a(()=>[t(h,{data:S.value,columns:b.value,"row-key":"id","table-layout":"auto","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1})):(V(),E(I,{key:1},{default:a(()=>[R("div",Ys,[t(U,{theme:"warning",message:"您没有查看本比赛的权限"}),$.value?(V(),E(z,{key:0,style:{margin:"20px auto 0",width:"200px"},onSubmit:r,"label-width":"0"},{default:a(()=>[t(D,null,{default:a(()=>[t(j,{placeholder:"请输入密码",value:v.value,"onUpdate:value":w[0]||(w[0]=ye=>v.value=ye),style:{width:"300px"},type:"password",autocomplete:"new-password"},null,8,["value"])]),_:1}),t(D,null,{default:a(()=>[R("div",Xs,[t(T,{theme:"primary",type:"submit",loading:fe(_)},{default:a(()=>w[1]||(w[1]=[P("提交")])),_:1},8,["loading"])])]),_:1})]),_:1})):le("",!0)])]),_:1}))])]}),_:1}),t(L,{span:6},{default:a(()=>{var B;return[R("div",Zs,[t(M,null,{default:a(()=>[x.value?(V(),E(T,{key:0,onClick:d,loading:y.value},{default:a(()=>w[2]||(w[2]=[P("查重")])),_:1},8,["loading"])):le("",!0),x.value?(V(),E(T,{key:1,onClick:g},{default:a(()=>w[3]||(w[3]=[P("编辑")])),_:1})):le("",!0)]),_:1})]),R("div",Qs,[t(te,{layout:"vertical",bordered:!0},{default:a(()=>[t(F,{label:"创建时间"},{default:a(()=>{var ie;return[P(q((ie=p.value)==null?void 0:ie.createTime),1)]}),_:1})]),_:1}),t(te,{layout:"vertical",bordered:!0},{default:a(()=>[t(F,{label:"更新时间"},{default:a(()=>{var ie;return[P(q((ie=p.value)==null?void 0:ie.updateTime),1)]}),_:1})]),_:1}),t(te,{layout:"vertical",bordered:!0},{default:a(()=>[t(F,{label:"开始时间"},{default:a(()=>{var ie;return[P(q((ie=p.value)==null?void 0:ie.startTime),1)]}),_:1})]),_:1}),t(te,{layout:"vertical",bordered:!0},{default:a(()=>[t(F,{label:"结束时间"},{default:a(()=>{var ie;return[P(q((ie=p.value)==null?void 0:ie.endTime),1)]}),_:1})]),_:1})]),(B=p.value)!=null&&B.description?(V(),E(I,{key:0,style:{margin:"12px"}},{default:a(()=>{var ie;return[t(X,{"model-value":(ie=p.value)==null?void 0:ie.description,class:"dida-content-description"},null,8,["model-value"])]}),_:1})):le("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),tr=de(er,[["__scopeId","data-v-af022b1b"]]);function qa(e){return e?Math.floor(e/1e9):0}function it(e){if(e<=0)return"0秒";let l="";const n=Math.floor(e/3600);n>0&&(l+=`${n}小时`);const i=Math.floor(e%3600/60);return(i>0||n>0)&&(n>0&&i<10&&(l+="0"),l+=`${i}分钟`),e=e%60,(e>0||i>0||n>0)&&((n>0||i>0)&&e<10&&(l+="0"),l+=`${e.toFixed(0)}秒`),l}const ar=vt("contest",{state:()=>({starMembers:{}}),actions:{clear(){this.$patch({starMembers:{}})},addStarMember(e,l){this.starMembers[e]||(this.starMembers[e]={}),this.starMembers[e][l]=!0},removeStarMember(e,l){this.starMembers[e]&&(delete this.starMembers[e][l],Object.keys(this.starMembers[e]).length===0&&delete this.starMembers[e])},isStarMember(e,l){var n;return!!((n=this.starMembers[e])!=null&&n[l])}},persist:!0}),lr={style:{margin:"10px 10px 40px"}},nr={style:{"text-align":"right","margin-bottom":"10px"}},or={class:"table-scroll-wrapper"};function ca(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!at(e)}const sr=ce({__name:"ContestRank",setup(e){const l=Se(),n=Xe(),i=ar(),{globalProperties:o}=_e();let y=!1,f=null,C=0,p=null,s=null,$=0;const v=c(0),x=c(0),k=c(!1),b=c(!0),S=c(!0);let u=null,_=null,g=1,d=50;const r=c({current:g,pageSize:d,defaultCurrent:1,defaultPageSize:50,total:0,pageSizeOptions:[50,100,1e3]}),A=W=>i&&i.isStarMember(C,W),m=async W=>{r.value={...r.value,current:W.current,pageSize:W.pageSize},await n.push({query:{...l.query,page:W.current,page_size:W.pageSize}})},w=W=>{if(W==null)return"-";const K=Math.floor(W/3600).toString().padStart(2,"0"),Z=Math.floor(W%3600/60).toString().padStart(2,"0"),J=(W%60).toFixed(0).toString().padStart(2,"0");return`${K}:${Z}:${J}`},U=c({});let h={userId:0,ac:-1};const I=[{title:"Rank",colKey:"rank",align:"center",fixed:"left"},{title:"昵称",colKey:"nickname",fixed:"left",attrs:W=>{let K={};return A(W.row.userId)&&(K={backgroundColor:"rgba(255,165,30,0.5)"}),{style:K}},cell:(W,K)=>{const Z=Fl(K.row.nickname,18);let J=null;return A(K.row.userId)?J=t(O,{shape:"circle",variant:"text",class:"rank-unstar-button",onClick:()=>{i.removeStarMember(C,K.row.userId),ie()}},{default:()=>[t(nl,{slot:"icon"},null)]}):J=t(O,{shape:"circle",variant:"text",class:"rank-star-button",onClick:()=>{i.addStarMember(C,K.row.userId),ie()}},{default:()=>[t(ol,{slot:"icon"},null)]}),t("div",{class:"rank-nickname-cell"},[t(he,null,{default:()=>[t(xl,{content:K.row.nickname},{default:()=>[t(O,{variant:"text",onClick:()=>n.push({name:"user",params:{username:K.row.username}})},ca(Z)?Z:{default:()=>[Z]})]}),J]})])}},{title:"Solved",colKey:"solved",align:"center",fixed:"left",cell:(W,K)=>t(O,{variant:"text",onClick:()=>n.push({name:"contest-judge",params:{contestId:C},query:{username:K.row.username,status:Be.Accept}})},{default:()=>[K.row.solved]})},{title:"Penalty",colKey:"penalty",align:"center",fixed:"left",cell:(W,K)=>w(K.row.penalty)}],j=c([]),D=c(!1);let T=[],z=[];const L=c([]);let M=[];const F=({col:W,rowIndex:K})=>{if(W.colKey==="rank"){let Z=r.value.current;r.value.current>Math.ceil(L.value.length/r.value.pageSize)&&(Z=Math.ceil(L.value.length/r.value.pageSize));let J=r.value.pageSize*(Z-1),oe=1;for(let ne=K+1;J+ne<L.value.length&&L.value[J+ne].rank===L.value[J+K].rank;ne++)oe++;return{rowspan:oe}}},te=(W,{value:K})=>it(K),X=()=>{u&&clearInterval(u),u=setInterval(()=>{y&&ye(!1)},3e4),_&&clearInterval(_),_=setInterval(()=>{if(!y)return;v.value=(new Date().getTime()-p.getTime())/1e3;const W=Math.min(v.value,x.value);v.value=Math.min(v.value,W),ie()},1e3)},ae=()=>{u&&(clearInterval(u),u=null),_&&(clearInterval(_),_=null)},Q=async W=>{S.value=W,W?(await ye(!1),X()):ae()},B=()=>{ie(),r.value={...r.value,current:1}},ie=()=>{L.value=[];let W=[];h={};for(let H=0;H<T.length;H++){const se=T[H];let ve={userId:se.author_id,username:se.author_username,nickname:se.author_nickname},je=0,Re=0;se.problems.forEach(ke=>{let qe=-1,lt=ke.lock||0;if(ke.ac){if(qe=(new Date(ke.ac).getTime()-(p==null?void 0:p.getTime()))/1e3,qe>v.value)return;je++,Re+=qe,Re+=ke.attempt*20*60,h[ke.index]===void 0?h[ke.index]={userId:se.author_id,ac:qe}:h[ke.index].ac>qe&&(h[ke.index].userId=se.author_id,h[ke.index].ac=qe)}if(lt>0&&$>0){const yt=x.value-$;v.value<yt&&(lt=0)}const st=ke.index;ve[`problem_${st}`]={acDuration:qe,attempt:ke.attempt||0,lock:lt}}),ve.solved=je,ve.penalty=Re,W.push(ve)}W.sort((H,se)=>H.solved!==se.solved?se.solved-H.solved:H.penalty!==se.penalty?H.penalty-se.penalty:H.userId-se.userId);const K=z;let Z=0,J=0,oe=-1,ne=-1;for(let H=0;H<W.length;H++)K&&K.includes(W[H].userId)?W[H].rank="*":(J++,(W[H].solved!==oe||W[H].penalty!==ne)&&(Z=J,oe=W[H].solved,ne=W[H].penalty),W[H].rank=String(Z));k.value&&(W=W.filter(H=>A(H.userId)));const Ie=document.querySelectorAll("tbody tr"),Ce={};M.forEach((H,se)=>{const ve=Ie[se];ve&&(Ce[H.userId]=ve.getBoundingClientRect())}),r.value={...r.value,total:W.length},L.value=W;for(let H=0;H<L.value.length;H++)L.value[H].index=H+1;if(M=[...L.value],b.value){const H={},se=document.querySelectorAll("table tbody tr");L.value.forEach((ve,je)=>{const Re=se[je];Re&&(H[ve.userId]=Re.getBoundingClientRect())}),requestAnimationFrame(()=>{const ve=document.querySelectorAll("table tbody tr");L.value.forEach((je,Re)=>{const ke=ve[Re],qe=Ce[je.userId],lt=H[je.userId];if(qe&&lt){const st=qe.top-lt.top;st!==0&&(ke.style.transition="none",ke.style.transform=`translateY(${st}px)`)}}),requestAnimationFrame(()=>{document.querySelectorAll("table tbody tr").forEach(Re=>{Re.style.transition="transform 300ms ease",Re.style.transform=""})})})}},ue=W=>{Q(!1),v.value=W;const K=Math.min(x.value,(new Date().getTime()-(p==null?void 0:p.getTime()))/1e3);v.value=Math.min(v.value,K),ie()},ye=async W=>{W&&(D.value=!0);try{const K=await Po(C);if(j.value=[...I],T=[],z=[],L.value=[],r.value={...r.value,total:0},K.code===0){if(!K.data.has_auth){we(o,"您目前没有权限查看比赛排名"),await n.push({name:"contest-detail",params:{contestId:C}});return}K.data.problems.sort((oe,ne)=>oe-ne),K.data.problems.forEach((oe,ne)=>{j.value.push({colKey:`problem_${oe}`,align:"center",title:()=>{let Ie;return t(O,{variant:"text",onClick:()=>n.push({name:"contest-problem-detail",params:{contestId:C,problemIndex:oe}})},ca(Ie=tt(oe))?Ie:{default:()=>[Ie]})},cell:(Ie,Ce)=>{const H=Ce.row[`problem_${oe}`];if(!H)return"";let se="";return H.acDuration>=0&&(se=w(H.acDuration)),H.attempt>0&&(se&&(se+=" "),se+=`(-${H.attempt})`),H.lock>0&&(se&&(se+=" "),se+=`(+${H.lock})`),t("span",null,[se])},attrs:Ie=>{const Ce=Ie.row[`problem_${oe}`];if(!Ce)return{};if(Ce.acDuration>=0){const H=h[oe];if(H!==void 0){const se=Ie.row.userId;if(H.userId===se)return{style:{backgroundColor:"rgba(65,155,5,0.5)"}}}return{style:{backgroundColor:"rgba(130,255,30,0.5)"}}}return Ce.lock>0?{style:{backgroundColor:"rgb(255,180,50,0.5)"}}:Ce.attempt>0?{style:{backgroundColor:"rgba(255,120,120,0.5)"}}:{}}})});const Z=K.data.contest;if(p=new Date(Z.start_time),s=new Date(Z.end_time),T=K.data.ranks,z=K.data.v_members||[],x.value=Math.floor((s.getTime()-p.getTime())/1e3),U.value={0:"0",[Math.floor(x.value/2)]:it(Math.floor(x.value/2)),[x.value]:it(x.value)},$=qa(Z.lock_rank_duration||0),K.data.is_locked&&$>0){const oe=Math.max(0,x.value-$);U.value[oe]=t("span",{style:"color: #0052d9"},[P("锁榜("),it(oe),P(")")])}v.value=Math.floor((new Date().getTime()-p.getTime())/1e3);const J=Math.min(v.value,x.value);v.value=Math.min(v.value,J),S.value=!0,X(),ie()}else W&&N(o,K.code)}catch(K){console.error(K),W&&N(o,He())}finally{W&&(D.value=!1)}};return pe(async()=>{y=!0,f=$e(()=>l.query,async W=>{if(Array.isArray(l.params.contestId)?C=Number(l.params.contestId[0]):C=Number(l.params.contestId),!C){await n.push({name:"contest"});return}const K=parseInt(W.page)||r.value.defaultCurrent,Z=parseInt(W.page_size)||r.value.defaultPageSize;g=K,d=Z,r.value={...r.value,current:g,pageSize:d},await ye(!0)},{immediate:!0})}),De(()=>{y=!1,f&&f(),ae()}),(W,K)=>{const Z=gt,J=he,oe=Pl,ne=Ee,Ie=be,Ce=Pe;return V(),E(Ce,null,{default:a(()=>[t(Ie,{style:{margin:"10px",width:"100%"}},{default:a(()=>[R("div",lr,[R("div",nr,[t(J,null,{default:a(()=>[t(Z,{size:"large",modelValue:k.value,"onUpdate:modelValue":K[0]||(K[0]=H=>k.value=H),onChange:B},{label:a(H=>[P(q(H.value?"仅展示收藏":"未过滤收藏"),1)]),_:1},8,["modelValue"]),t(Z,{size:"large",modelValue:b.value,"onUpdate:modelValue":K[1]||(K[1]=H=>b.value=H)},{label:a(H=>[P(q(H.value?"开启动画":"关闭动画"),1)]),_:1},8,["modelValue"]),t(Z,{size:"large",modelValue:S.value,"onUpdate:modelValue":K[2]||(K[2]=H=>S.value=H),onChange:Q},{label:a(H=>[P(q(H.value?"自动刷新":"关闭刷新"),1)]),_:1},8,["modelValue"])]),_:1})]),t(oe,{modelValue:v.value,"onUpdate:modelValue":K[3]||(K[3]=H=>v.value=H),marks:U.value,max:x.value,label:te,"tooltip-props":{placement:"top"},"input-number-props":{theme:"column",autoWidth:!0,format:fe(it),onChange:ue},onChangeEnd:ue},null,8,["modelValue","marks","max","input-number-props"])]),R("div",or,[t(ne,{data:L.value,columns:j.value,"row-key":"index","vertical-align":"middle",bordered:!0,hover:!0,"table-layout":"auto","rowspan-and-colspan":F,loading:D.value,class:"dida-contest-rank-table",pagination:r.value,onPageChange:m},null,8,["data","columns","loading","pagination"])])]),_:1})]),_:1})}}}),rr=de(sr,[["__scopeId","data-v-f762ba2d"]]),ir={style:{margin:"10px"}},ur={style:{margin:"12px"}},dr={class:"dida-edit-container"},cr={class:"dida-description-editor"},mr=ce({__name:"ContestEdit",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze(),o=c(0),y=c(!1),f=c(!1),C=c(!1),p=c(null),s=c({title:"",openTime:[],private:!0,password:"",problems:[],members:[],description:"",notification:"",lockRankDuration:0,alwaysLock:!0,submitAnytime:!1}),$=c(""),v=c(""),x=c(!1),k=async()=>{x.value=!0,C.value=!1,x.value=!1},b=async(d,r)=>{f.value=!0,await dt(d,r,n,()=>So(o.value)),f.value=!1},S=async()=>{f.value=!0;try{const d={title:s.value.title,description:s.value.description,notification:s.value.notification,lock_rank_duration:s.value.lockRankDuration,always_lock:s.value.alwaysLock,problems:s.value.problems,members:s.value.members,private:s.value.private,password:s.value.password,submit_anytime:s.value.submitAnytime};s.value.openTime[0]&&(d.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(d.end_time=new Date(s.value.openTime[1]));const r=await xo(d);if(f.value=!0,r.code!==0){N(n,r.code);return}r.data!=null&&await Y.push({name:"contest-detail",params:{contestId:r.data}}),Ne(n,"创建成功")}finally{f.value=!1}},u=async()=>{f.value=!0;try{const d={id:Number(o.value),title:s.value.title,notification:s.value.notification,lock_rank_duration:s.value.lockRankDuration,always_lock:s.value.alwaysLock,problems:s.value.problems,members:s.value.members,private:s.value.private,password:s.value.password,submit_anytime:s.value.submitAnytime,description:s.value.description};s.value.openTime[0]&&(d.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(d.end_time=new Date(s.value.openTime[1]));const r=await To(d);if(f.value=!0,r.code!==0){N(n,r.code);return}p.value&&(r.data.description!=null&&(s.value.description=r.data.description),r.data.update_time!=null&&(p.value.updateTime=new Date(r.data.update_time).toLocaleString())),Ne(n,"保存成功")}finally{f.value=!1}},_=d=>{s.value.description=d,y.value=!1},g=async()=>{const d=await wo(o.value);if(d.code!==0){N(n,d.code),console.error("contest get failed",d.code),await Y.push({name:"contest-list"});return}const r=d.data.contest;p.value=Jt(r),s.value.title=r.title,s.value.openTime=[],r.start_time?s.value.openTime.push(new Date(r.start_time)):s.value.openTime.push(""),r.end_time?s.value.openTime.push(new Date(r.end_time)):s.value.openTime.push(""),s.value.private=r.private,s.value.password=r.password||"",s.value.description=r.description||"",s.value.notification=r.notification||"",s.value.problems=d.data.problems,s.value.members=d.data.members,r.lock_rank_duration?s.value.lockRankDuration=qa(r.lock_rank_duration):s.value.lockRankDuration=0,s.value.alwaysLock=r.always_lock,s.value.submitAnytime=r.submit_anytime,i.setTitle(r.title+" - "+i.getTitle);let A="";r.description&&(A=r.description),_(A)};return pe(async()=>{Array.isArray(l.params.contestId)?o.value=Number(l.params.contestId[0]):o.value=Number(l.params.contestId),o.value?(y.value=!0,await g()):_("")}),(d,r)=>{const A=Ae,m=ze,w=Ot,U=gt,h=wa,I=Ue,j=be,D=Te,T=O,z=he,L=Ye,M=We,F=Pe,te=Me("md-editor-v3"),X=Ve,ae=Tt,Q=ot;return V(),ee(me,null,[t(X,{loading:y.value},{default:a(()=>[t(F,null,{default:a(()=>[t(D,{span:8},{default:a(()=>[R("div",ir,[t(j,{class:"sh-card"},{default:a(()=>[t(I,{model:s.value,"label-width":"150px"},{default:a(()=>[t(m,{label:"标题"},{default:a(()=>[t(A,{modelValue:s.value.title,"onUpdate:modelValue":r[0]||(r[0]=B=>s.value.title=B),placeholder:"比赛标题"},null,8,["modelValue"])]),_:1}),t(m,{label:"通知"},{default:a(()=>[t(A,{modelValue:s.value.notification,"onUpdate:modelValue":r[1]||(r[1]=B=>s.value.notification=B),placeholder:"会更为醒目地提醒"},null,8,["modelValue"])]),_:1}),t(m,{label:"开启时间"},{default:a(()=>[t(w,{modelValue:s.value.openTime,"onUpdate:modelValue":r[2]||(r[2]=B=>s.value.openTime=B),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(m,{label:"提交限制"},{default:a(()=>[t(U,{modelValue:s.value.submitAnytime,"onUpdate:modelValue":r[3]||(r[3]=B=>s.value.submitAnytime=B)},{label:a(B=>[P(q(B.value?"结束仍能提交":"仅比赛期间提交"),1)]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"锁榜时长"},{default:a(()=>[t(h,{modelValue:s.value.lockRankDuration,"onUpdate:modelValue":r[4]||(r[4]=B=>s.value.lockRankDuration=B),min:0,format:fe(it),"auto-width":""},null,8,["modelValue","format"])]),_:1}),t(m,{label:"自动解锁"},{default:a(()=>[t(U,{modelValue:s.value.alwaysLock,"onUpdate:modelValue":r[5]||(r[5]=B=>s.value.alwaysLock=B)},{label:a(B=>[P(q(B.value?"结束后仍锁榜":"结束后解锁"),1)]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"私有"},{default:a(()=>[t(U,{modelValue:s.value.private,"onUpdate:modelValue":r[6]||(r[6]=B=>s.value.private=B)},null,8,["modelValue"])]),_:1}),s.value.private?(V(),E(m,{key:0,label:"密码"},{default:a(()=>[t(A,{modelValue:s.value.password,"onUpdate:modelValue":r[7]||(r[7]=B=>s.value.password=B),type:"password",placeholder:"请输入访问密码，留空代表关闭密码访问"},null,8,["modelValue"])]),_:1})):le("",!0),s.value.private?(V(),E(m,{key:1,label:"成员"},{default:a(()=>[t(Ea,{modelValue:s.value.members,"onUpdate:modelValue":r[8]||(r[8]=B=>s.value.members=B)},null,8,["modelValue"])]),_:1})):le("",!0),t(m,{label:"问题"},{default:a(()=>[t(Ma,{modelValue:s.value.problems,"onUpdate:modelValue":r[9]||(r[9]=B=>s.value.problems=B)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(D,{span:4},{default:a(()=>[R("div",ur,[R("div",dr,[o.value?(V(),E(z,{key:0},{default:a(()=>[t(T,{onClick:u,theme:"danger",loading:f.value},{default:a(()=>r[13]||(r[13]=[P("保存")])),_:1},8,["loading"])]),_:1})):(V(),E(z,{key:1},{default:a(()=>[t(T,{onClick:S,theme:"danger",loading:f.value},{default:a(()=>r[14]||(r[14]=[P("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(V(),E(M,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(L,{label:"创建时间"},{default:a(()=>{var B;return[P(q((B=p.value)==null?void 0:B.createTime),1)]}),_:1}),t(L,{label:"更新时间"},{default:a(()=>{var B;return[P(q((B=p.value)==null?void 0:B.updateTime),1)]}),_:1}),t(L,{label:"创建用户"},{default:a(()=>{var B;return[P(q((B=p.value)==null?void 0:B.ownerNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),R("div",cr,[r[15]||(r[15]=R("p",null,"公告",-1)),t(te,{id:"contest-description-editor",modelValue:s.value.description,"onUpdate:modelValue":r[10]||(r[10]=B=>s.value.description=B),onSave:u,onOnUploadImg:b,previewTheme:"cyanosis"},null,8,["modelValue"]),t(X,{loading:f.value,attach:"#contest-description-editor","z-index":1e5},null,8,["loading"])])]),_:1},8,["loading"]),t(Q,{visible:C.value,"onUpdate:visible":r[12]||(r[12]=B=>C.value=B),onConfirm:k,header:$.value,"confirm-loading":x.value},{default:a(()=>[r[16]||(r[16]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(ae,{modelValue:v.value,"onUpdate:modelValue":r[11]||(r[11]=B=>v.value=B),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),ma=de(mr,[["__scopeId","data-v-e76af3ed"]]);function Xt(e){const l={};return l.id=e.id,l.authorId=e.author_id,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.title=e.title,l.content=e.content,e.insert_time&&(l.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(l.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(l.updateTime=new Date(e.update_time).toLocaleString()),l.problemId=e.problem_id,l.problemTitle=e.problem_title,l.contestId=e.contest_id,l.contestTitle=e.contest_title,l.contestProblemIndex=e.contest_problem_index,l}function pr(e){const l={};return l.id=e.id,l.authorId=e.author_id,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.content="",e.content&&(l.content=e.content),e.insert_time&&(l.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(l.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(l.updateTime=new Date(e.update_time).toLocaleString()),l}function fr(e){return G({url:"/discuss?id="+e,method:"get"})}function vr(e){return G({url:"/discuss/edit?id="+e,method:"get"})}function _r(e,l,n,i,o,y,f){const C={};return e?C.only_problem="1":C.only_problem="0",l&&(C.contest_id=l),n&&(C.problem_id=n),i&&(C.title=i),o&&(C.username=o),y&&(C.page=y),f&&(C.page_size=f),G({url:`/discuss/list?${new URLSearchParams(C).toString()}`,method:"get"})}function gr(e){return e||(e=0),G({url:"/discuss/image/token?id="+e,method:"get"})}function br(e,l){return e||(e=0),l||(l=0),G({url:"/discuss/comment/image/token?id="+e+"&comment_id="+l,method:"get"})}function hr(e,l,n){return G({url:"/discuss/comment/list?id="+e+"&page="+l+"&page_size="+n,method:"get"})}function yr(e){return G({url:"/discuss/create",method:"post",data:e})}function wr(e){return G({url:"/discuss/edit",method:"post",data:e})}function kr(e){return G({url:"/discuss/comment/create",method:"post",data:e})}function Sr(e){return G({url:"/discuss/comment/edit",method:"post",data:e})}const Cr={style:{margin:"10px"}};function Ir(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!at(e)}const Pr=ce({__name:"DiscussList",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=!1,y=null,f=-1,C=c(!1);const p=c([]),s=[],$=[{title:"标题",colKey:"title",cell:(U,h)=>t(O,{variant:"text",onClick:()=>d(h.row.id)},{default:()=>[h.row.title]})},{title:"创建人",colKey:"authorNickname",width:"200",cell:(U,h)=>t(O,{variant:"text",onClick:async()=>await Wt(n,h.row.authorUsername)},{default:()=>[h.row.authorNickname]})},{title:"创建时间",colKey:"insertTime",width:"180"},{title:"更新时间",colKey:"updateTime",width:"180"}],v=c(!1);let x=1,k=50;const b=c({current:x,pageSize:k,defaultCurrent:x,defaultPageSize:k,total:0,pageSizeOptions:[50,100]}),S=c(),u=c({problemId:"",title:"",username:""}),_=U=>{U&&n.push({name:"problem-detail",params:{problemId:U}})},g=(U,h)=>{n.push({name:"contest-problem-detail",params:{contestId:U,problemIndex:h}})},d=U=>{if(U){if(f){n.push({name:"contest-discuss-detail",params:{contestId:f,discussId:U}});return}n.push({name:"discuss-detail",params:{discussId:U}})}},r=async()=>{await n.push({query:{...l.query,problem_id:u.value.problemId,title:u.value.title,username:u.value.username,page:1,page_size:b.value.defaultPageSize}})},A=async(U,h)=>{var I;v.value=!0;try{const{current:j,pageSize:D}=U,T=await _r(C.value,f,u.value.problemId,u.value.title,u.value.username,j,D);if(S.value=[],T.code===0){if(!T.data.has_auth){we(i,"您目前没有权限查看讨论列表"),f?await n.push({name:"contest-detail",params:{contestId:f}}):await n.push({name:"discuss-list"});return}if(T.data.list){const z=T.data.list;for(let L=0;L<z.length;L++){const M=z[L],F=await Xt(M);(I=S.value)==null||I.push(F)}}b.value={...b.value,total:T.data.total_count}}else h&&N(i,T.code)}catch(j){console.error(j),N(i,He())}finally{v.value=!1}},m=async U=>{await n.push({query:{...l.query,page:U.current,page_size:U.pageSize}})},w=async()=>{await n.push({name:"discuss-create"})};return pe(async()=>{o=!0,y=$e(()=>l.query,U=>{if(!o)return;C.value=l.name==="discuss-list-problem",Array.isArray(l.params.contestId)?f=Number(l.params.contestId[0]):f=Number(l.params.contestId),p.value=s,f?p.value=p.value.concat([{title:"问题ID",colKey:"contestProblemIndex",width:"100",cell:(j,D)=>{let T;return D.row.contestProblemIndex?t(O,{variant:"text",onClick:()=>g(f,D.row.contestProblemIndex)},Ir(T=tt(D.row.contestProblemIndex))?T:{default:()=>[T]}):""}}]):p.value=p.value.concat([{title:"问题ID",colKey:"problemId",width:"100",cell:(j,D)=>D.row.problemId?t(O,{variant:"text",onClick:()=>_(D.row.problemId)},{default:()=>[D.row.problemId]}):""}]),p.value=p.value.concat($),u.value.problemId=U.problem_id||"",u.value.title=U.title||"",u.value.username=U.username||"";const h=parseInt(U.page)||b.value.defaultCurrent,I=parseInt(U.page_size)||b.value.defaultPageSize;x=h,k=I,b.value={...b.value,current:x,pageSize:k},A({current:x,pageSize:k},!0)},{immediate:!0})}),De(()=>{o=!1,y&&y()}),(U,h)=>{const I=Ee,j=be,D=Te,T=Ae,z=ze,L=O,M=Ue,F=he,te=Pe;return V(),E(te,null,{default:a(()=>[t(D,{span:9},{default:a(()=>[t(j,{style:{margin:"10px"}},{default:a(()=>[t(I,{data:S.value,columns:p.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:b.value,loading:v.value,"table-layout":"auto",onPageChange:m},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(D,{span:3},{default:a(()=>[R("div",Cr,[t(j,{class:"sh-card"},{default:a(()=>[t(M,{model:u.value},{default:a(()=>[t(z,{label:"问题ID"},{default:a(()=>[t(T,{modelValue:u.value.problemId,"onUpdate:modelValue":h[0]||(h[0]=X=>u.value.problemId=X),placeholder:"请输入完整问题ID"},null,8,["modelValue"])]),_:1}),t(z,{label:"标题"},{default:a(()=>[t(T,{modelValue:u.value.title,"onUpdate:modelValue":h[1]||(h[1]=X=>u.value.title=X),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(z,{label:"创建人"},{default:a(()=>[t(T,{modelValue:u.value.username,"onUpdate:modelValue":h[2]||(h[2]=X=>u.value.username=X),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(z,null,{default:a(()=>[t(L,{theme:"primary",onClick:r},{default:a(()=>h[3]||(h[3]=[P("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(j,{class:"sh-card"},{default:a(()=>[t(F,null,{default:a(()=>[t(L,{onClick:w},{default:a(()=>h[4]||(h[4]=[P("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),At=de(Pr,[["__scopeId","data-v-52d475b4"]]),xr={key:0,style:{margin:"20px"}},Tr={class:"dida-operation-container"},Vr={class:"dida-operation-container"},Dr={style:{margin:"10px"}},jr={style:{margin:"10px"}},Lr={style:{margin:"10px"},class:"dida-operation-container"},$r={style:{margin:"12px"}},Ur={key:0,class:"dida-edit-container"},zr=ce({__name:"DiscussDetail",props:{discussId:{}},setup(e){const l=e;let n=Se();const{globalProperties:i}=_e();let o=!1,y=null;const f=Ze(),C=Oe();let p=c("");const s=c(0),$=c(!1),v=c(null),x=c(!1),k=c(!1),b=c(0),S=c("");let u=1,_=20;const g=c({current:1,pageSize:20,total:0,defaultPageSize:_,defaultCurrent:u,pageSizeOptions:[20,50]}),d=c([]),r=Je(()=>C.hasAuth(Le.ManageDiscuss)),A=Je(()=>C.hasAuth(Le.ManageDiscuss)||v.value&&C.getUserId==v.value.authorId),m=()=>{Y.push({name:"discuss-edit",params:{discussId:s.value}})},w=()=>t("div",{class:"t-pagination__total"},[`共 ${g.value.total} 条回复`]),U=(z,L)=>{b.value=z,S.value=L;const M=document.getElementById("discuss-comment-editor");M&&M.scrollIntoView({behavior:"smooth"})},h=()=>{b.value=0,S.value="";const z=document.getElementById("discuss-comment-editor");z&&z.scrollIntoView({behavior:"smooth"})},I=async()=>{k.value=!0;try{let z;if(b.value){const L={id:b.value,discuss_id:s.value,content:S.value};if(z=await Sr(L),z.code!==0){N(i,z.code);return}Ne(i,"编辑成功"),b.value=0,S.value="",u===1?await D({current:1,pageSize:_},!0):await Y.push({query:{current:1}});const M=document.getElementById("comment-divider");M&&M.scrollIntoView({behavior:"smooth"})}else{const L={discuss_id:s.value,content:S.value};if(z=await kr(L),z.code!==0){N(i,z.code);return}Ne(i,"编辑成功"),b.value=0,S.value="",u===1?await D({current:1,pageSize:_},!0):await Y.push({query:{current:1}});const M=document.getElementById("comment-divider");M&&M.scrollIntoView({behavior:"smooth"})}}finally{k.value=!1}},j=async(z,L)=>{k.value=!0,await dt(z,L,i,()=>br(s.value,b.value)),k.value=!1},D=async(z,L)=>{var M;x.value=!0;try{const{current:F,pageSize:te}=z,X=await hr(s.value,F,te);if(d.value=[],X.code===0){const ae=X.data.list;if(ae)for(let Q=0;Q<ae.length;Q++){const B=ae[Q],ie=pr(B);(M=d.value)==null||M.push(ie)}g.value={...g.value,total:X.data.total_count}}else L&&N(i,X.code)}catch(F){console.error(F),N(i,He())}finally{x.value=!1}},T=async z=>{await Y.push({query:{...n.query,page:z.current,page_size:z.pageSize}})};return pe(async()=>{if(o=!0,s.value=Number(l.discussId),s.value||(Array.isArray(n.params.discussId)?s.value=Number(n.params.discussId[0]):s.value=Number(n.params.discussId)),!s.value){ge(i,"讨论不存在"),await Y.push({name:"discuss"});return}$.value=!0;const z=await fr(s.value);if(z.code!==0){$.value=!1,N(i,z.code),await Y.push({name:"discuss"});return}v.value=Xt(z.data.discuss),f.setTitle(v.value.title+" - "+f.getTitle),p.value=v.value.content,$.value=!1,y=$e(()=>n.query,L=>{if(!o)return;const M=parseInt(L.page)||g.value.defaultCurrent,F=parseInt(L.page_size)||g.value.defaultPageSize;u=M,_=F,g.value={...g.value,current:u,pageSize:_},D({current:u,pageSize:_},!0)},{immediate:!0})}),De(()=>{o=!1,y&&y()}),(z,L)=>{const M=Sa,F=ka,te=Me("md-preview"),X=be,ae=Tl,Q=he,B=O,ie=Vl,ue=et,ye=Me("md-editor-v3"),W=Ve,K=Te,Z=Ye,J=We,oe=Pe;return V(),E(W,{loading:$.value},{default:a(()=>[t(oe,{class:"dida-main-content"},{default:a(()=>[t(K,{span:8},{default:a(()=>{var ne,Ie,Ce;return[(ne=v.value)!=null&&ne.problemTitle||(Ie=v.value)!=null&&Ie.contestTitle?(V(),ee("div",xr,[t(F,{"max-item-width":"300"},{default:a(()=>{var H,se,ve,je,Re;return[(H=v.value)!=null&&H.contestTitle?(V(),ee(me,{key:0},[t(M,{to:{name:"contest-detail",params:{contestId:(se=v.value)==null?void 0:se.contestId}}},{default:a(()=>{var ke;return[P(q((ke=v.value)==null?void 0:ke.contestTitle),1)]}),_:1},8,["to"]),(ve=v.value)!=null&&ve.contestProblemIndex?(V(),E(M,{key:0,to:{name:"contest-problem-detail",params:{problemIndex:(je=v.value)==null?void 0:je.contestProblemIndex}}},{default:a(()=>{var ke,qe;return[P(q(fe(tt)((ke=v.value)==null?void 0:ke.contestProblemIndex))+" - "+q((qe=v.value)==null?void 0:qe.problemTitle),1)]}),_:1},8,["to"])):le("",!0)],64)):(V(),ee(me,{key:1},[t(M,{to:{name:"discuss-list-problem"}},{default:a(()=>L[4]||(L[4]=[P(" 题目讨论")])),_:1}),t(M,{to:{name:"problem-detail",params:{problemId:(Re=v.value)==null?void 0:Re.problemId}}},{default:a(()=>{var ke;return[P(q((ke=v.value)==null?void 0:ke.problemTitle),1)]}),_:1},8,["to"])],64))]}),_:1})])):le("",!0),t(X,{style:{margin:"10px"},header:(Ce=v.value)==null?void 0:Ce.title,"header-bordered":!0},{default:a(()=>[t(te,{"model-value":fe(p),previewTheme:"cyanosis"},null,8,["model-value"])]),_:1},8,["header"]),t(ae,{id:"comment-divider"},{default:a(()=>L[5]||(L[5]=[P("评论区")])),_:1}),(V(!0),ee(me,null,xe(d.value,(H,se)=>(V(),E(X,{key:se,style:{margin:"10px"},"header-bordered":""},{header:a(()=>[R("div",Tr,[t(Q,null,{default:a(()=>[R("span",null,q(H.authorNickname),1),R("span",null,q(H.insertTime),1)]),_:2},1024)]),R("div",Vr,[t(Q,null,{default:a(()=>[r.value||fe(C).getUserId===H.authorId?(V(),E(B,{key:0,onClick:()=>{U(H.id,H.content)}},{default:a(()=>L[6]||(L[6]=[P(" 编辑 ")])),_:2},1032,["onClick"])):le("",!0)]),_:2},1024)])]),default:a(()=>[t(te,{"model-value":H.content,previewTheme:"cyanosis"},null,8,["model-value"])]),_:2},1024))),128)),R("div",Dr,[t(ie,{modelValue:g.value.current,"onUpdate:modelValue":L[0]||(L[0]=H=>g.value.current=H),"page-size":g.value.pageSize,"onUpdate:pageSize":L[1]||(L[1]=H=>g.value.pageSize=H),total:g.value.total,"page-size-options":g.value.pageSizeOptions,"show-page-size":!1,"total-content":w,onChange:T},null,8,["modelValue","page-size","total","page-size-options"])]),t(ae),R("div",jr,[R("div",Lr,[t(ue,{style:{margin:"10px"}},{default:a(()=>[P(q(b.value?"编辑回复":"发表回复"),1)]),_:1}),t(Q,null,{default:a(()=>[t(B,{theme:"danger",onClick:h},{default:a(()=>L[7]||(L[7]=[P("清除")])),_:1}),t(B,{theme:"primary",onClick:I,loading:k.value},{default:a(()=>L[8]||(L[8]=[P("提交")])),_:1},8,["loading"])]),_:1})]),t(ye,{id:"discuss-comment-editor",modelValue:S.value,"onUpdate:modelValue":L[2]||(L[2]=H=>S.value=H),previewTheme:"cyanosis",onSave:I,onOnUploadImg:j},null,8,["modelValue"]),t(W,{loading:k.value,attach:"#discuss-comment-editor","z-index":1e5},null,8,["loading"])])]}),_:1}),t(K,{span:4},{default:a(()=>[R("div",$r,[A.value?(V(),ee("div",Ur,[t(B,{onClick:m},{default:a(()=>L[9]||(L[9]=[P("编辑")])),_:1})])):le("",!0),t(J,{layout:"vertical",bordered:!0},{default:a(()=>[t(Z,{label:"创建时间"},{default:a(()=>{var ne;return[P(q((ne=v.value)==null?void 0:ne.insertTime),1)]}),_:1}),t(Z,{label:"编辑时间"},{default:a(()=>{var ne;return[P(q((ne=v.value)==null?void 0:ne.modifyTime),1)]}),_:1}),t(Z,{label:"更新时间"},{default:a(()=>{var ne;return[P(q((ne=v.value)==null?void 0:ne.updateTime),1)]}),_:1}),t(Z,{label:"创建用户"},{default:a(()=>[t(B,{variant:"text",onClick:L[3]||(L[3]=async()=>{var ne;return await fe(Wt)(fe(Y),(ne=v.value)==null?void 0:ne.authorUsername)})},{default:a(()=>{var ne;return[P(q((ne=v.value)==null?void 0:ne.authorNickname),1)]}),_:1})]),_:1}),t(Z,{label:"标签"})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Rt=de(zr,[["__scopeId","data-v-3d044029"]]),Ar={style:{margin:"10px"}},Rr={style:{margin:"12px"}},Mr={class:"dida-edit-container"},Er={class:"dida-description-editor"},qr=ce({__name:"DiscussEdit",setup(e){let l=Se();const{globalProperties:n}=_e();let i=null;const o=c(0),y=c(!1),f=c(!1),C=c(null),p=c({title:"",problemId:"",content:""}),s=()=>{Y.push({name:"discuss-detail",params:{discussId:o.value}})};async function $(S,u){f.value=!0,await dt(S,u,n,()=>gr(o.value)),f.value=!1}const v=async()=>{f.value=!0;try{const S={title:p.value.title,content:p.value.content,problem_id:p.value.problemId},u=await yr(S);if(f.value=!0,u.code!==0){N(n,u.code);return}const _=u.data;await Y.push({name:"discuss-detail",params:{discussId:_}}),Ne(n,"创建成功")}finally{f.value=!1}},x=async()=>{f.value=!0;try{const S={id:o.value,title:p.value.title,content:p.value.content,problem_id:p.value.problemId},u=await wr(S);if(f.value=!0,u.code!==0){N(n,u.code);return}C.value&&u.data.modify_time!=null&&(C.value.modifyTime=new Date(u.data.modify_time).toLocaleString()),u.data.content!=null&&(p.value.content=u.data.content),Ne(n,"保存成功")}finally{f.value=!1}},k=async()=>{o.value?await x():await v()},b=async()=>{const S=await vr(o.value);if(S.code!==0){N(n,S.code),await Y.push({name:"discuss"});return}const u=S.data.discuss;C.value=Xt(u),p.value.title=u.title,p.value.content=u.content,p.value.problemId=u.problem_id,y.value=!1};return pe(async()=>{i=$e(()=>l.params,async()=>{Array.isArray(l.params.discussId)?o.value=Number(l.params.discussId[0]):o.value=Number(l.params.discussId),o.value?(y.value=!0,await b()):(p.value.title="",p.value.problemId="",p.value.content="")},{immediate:!0})}),De(()=>{i&&(i(),i=null)}),(S,u)=>{const _=Ae,g=ze,d=Ue,r=be,A=Te,m=O,w=he,U=Ye,h=We,I=Pe,j=Me("md-editor-v3"),D=Ve;return V(),E(D,{loading:y.value},{default:a(()=>[t(I,null,{default:a(()=>[t(A,{span:8},{default:a(()=>[R("div",Ar,[t(r,{class:"sh-form-card"},{default:a(()=>[t(d,{model:p.value},{default:a(()=>[t(g,{label:"标题"},{default:a(()=>[t(_,{modelValue:p.value.title,"onUpdate:modelValue":u[0]||(u[0]=T=>p.value.title=T),placeholder:"讨论标题"},null,8,["modelValue"])]),_:1}),t(g,{label:"关联题目"},{default:a(()=>[t(_,{modelValue:p.value.problemId,"onUpdate:modelValue":u[1]||(u[1]=T=>p.value.problemId=T),placeholder:"讨论题目"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(A,{span:4},{default:a(()=>[R("div",Rr,[R("div",Mr,[o.value?(V(),E(w,{key:0},{default:a(()=>[t(m,{onClick:x,theme:"danger",loading:f.value},{default:a(()=>u[3]||(u[3]=[P("保存")])),_:1},8,["loading"]),t(m,{onClick:s},{default:a(()=>u[4]||(u[4]=[P("查看")])),_:1})]),_:1})):(V(),E(w,{key:1},{default:a(()=>[t(m,{onClick:v,theme:"danger",loading:f.value},{default:a(()=>u[5]||(u[5]=[P("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(V(),E(h,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(U,{label:"创建时间"},{default:a(()=>{var T;return[P(q((T=C.value)==null?void 0:T.insertTime),1)]}),_:1}),t(U,{label:"更新时间"},{default:a(()=>{var T;return[P(q((T=C.value)==null?void 0:T.modifyTime),1)]}),_:1}),t(U,{label:"创建用户"},{default:a(()=>{var T;return[P(q((T=C.value)==null?void 0:T.authorNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),R("div",Er,[t(j,{id:"discuss-editor",modelValue:p.value.content,"onUpdate:modelValue":u[2]||(u[2]=T=>p.value.content=T),onSave:k,onOnUploadImg:$,previewTheme:"cyanosis"},null,8,["modelValue"]),t(D,{loading:f.value,attach:"#discuss-editor","z-index":1e5},null,8,["loading"])])]),_:1},8,["loading"])}}}),pa=de(qr,[["__scopeId","data-v-164ac069"]]);function Kr(e,l){return G({url:"/rank/ac/all?page="+e+"&page_size="+l,method:"get"})}function Fr(e,l){return G({url:"/rank/ac/problem?page="+e+"&page_size="+l,method:"get"})}function Nr(e,l){return G({url:"/rank/ac/problem/today?page="+e+"&page_size="+l,method:"get"})}function Or(e,l){return G({url:"/rank/ac/problem/day7?page="+e+"&page_size="+l,method:"get"})}function Gr(e,l){return G({url:"/rank/ac/problem/day30?page="+e+"&page_size="+l,method:"get"})}function Hr(e,l){return G({url:"/rank/ac/problem/year?page="+e+"&page_size="+l,method:"get"})}const Br={style:{margin:"10px"}};function Mt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!at(e)}const Jr=ce({__name:"RankUser",props:{type:{}},setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=null;const y=e,f=c(""),C=c(""),p={all:{header:"统计所有用户在本站的提交记录",content:"优先以AC记录数量排序，如果相同则提交所用次数较少的优先，如果仍相同，注册较早的用户靠前"},problem:{header:"统计所有用户在本站的提交记录",content:"以题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-today":{header:"统计所有用户今日在本站的提交记录",content:"以今日题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-day7":{header:"统计所有用户最近7日在本站的提交记录",content:"以7日题目记录数量排序（从7日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-day30":{header:"统计所有用户最近30日在本站的提交记录",content:"以30日题目记录数量排序（从30日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-year":{header:"统计所有用户最近1年在本站的提交记录",content:"以最近1年题目记录数量排序（从365日前的0点开始计算），如果相同，注册较早的用户靠前"}},s=c([]),$=[{title:"序号",colKey:"index"},{title:"用户名",colKey:"username",cell:(w,U)=>t(O,{variant:"dashed",onClick:()=>g(U.row.username)},{default:()=>[U.row.username]})},{title:"昵称",colKey:"nickname"},{title:"Slogan",colKey:"slogan"}],v=[{title:"题目数量",colKey:"problem_count",cell:(w,U)=>{let h=0;return U.row.problem_count&&(h=U.row.problem_count),t(O,{variant:"dashed",onClick:()=>d(U.row.username)},Mt(h)?h:{default:()=>[h]})}}],x=[{title:"正确",colKey:"accept",cell:(w,U)=>{let h=0;return U.row.accept&&(h=U.row.accept),t(O,{variant:"dashed",onClick:()=>d(U.row.username)},Mt(h)?h:{default:()=>[h]})}},{title:"提交",colKey:"attempt",cell:(w,U)=>{let h=0;return U.row.attempt&&(h=U.row.attempt),t(O,{variant:"dashed",onClick:()=>r(U.row.username)},Mt(h)?h:{default:()=>[h]})}}],k=c(!1);let b=1,S=50;const u=c({current:b,pageSize:S,defaultCurrent:b,defaultPageSize:S,total:0,pageSizeOptions:[50]}),_=c(),g=w=>{n.push({name:"user",params:{username:w}})},d=w=>{n.push({name:"judge-list",query:{username:w,status:Be.Accept}})},r=w=>{n.push({name:"judge-list",query:{username:w}})},A=async(w,U)=>{k.value=!0;try{_.value=[];const{current:h,pageSize:I}=w;let j=null;switch(y.type){case"problem":j=await Fr(h,I);break;case"problem-today":j=await Nr(h,I);break;case"problem-day7":j=await Or(h,I);break;case"problem-day30":j=await Gr(h,I);break;case"problem-year":j=await Hr(h,I);break;default:j=await Kr(h,I);break}if(j.code===0){const D=j.data.list;if(!D||D.length<=0){u.value={...u.value,total:0},we(i,"未找到记录");return}_.value=[];const T=u.value.pageSize*(u.value.current-1);let z=1;D.forEach(L=>{var F;const M=L;M.index=T+z++,(F=_.value)==null||F.push(M)}),u.value={...u.value,total:j.data.total_count}}else U&&N(i,j.code)}catch(h){console.error(h),N(i,He())}finally{k.value=!1}},m=async w=>{await n.push({query:{...l.query,page:w.current,page_size:w.pageSize}})};return pe(async()=>{k.value=!0,o=$e(()=>l.query,w=>{switch(y.type&&p[y.type]?(f.value=p[y.type].header,C.value=p[y.type].content):(f.value=p.all.header,C.value=p.all.content),y.type){case"all":s.value=$.concat(x);break;default:s.value=$.concat(v);break}const U=parseInt(w.page)||u.value.defaultCurrent,h=parseInt(w.page_size)||u.value.defaultPageSize;b=U,S=h,u.value={...u.value,current:b,pageSize:S},A({current:b,pageSize:S},!0)},{immediate:!0})}),De(()=>{o&&o()}),(w,U)=>{const h=Ee,I=be,j=Te,D=Pe;return V(),E(D,null,{default:a(()=>[t(j,{span:9},{default:a(()=>[t(I,{style:{margin:"10px"}},{default:a(()=>[t(h,{data:_.value,columns:s.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:u.value,loading:k.value,"table-layout":"auto",onPageChange:m},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(j,{span:3},{default:a(()=>[R("div",Br,[t(I,{class:"sh-card",header:f.value,"header-bordered":!0},{default:a(()=>[P(q(C.value),1)]),_:1},8,["header"])])]),_:1})]),_:1})}}}),rt=de(Jr,[["__scopeId","data-v-13682529"]]),Wr={style:{display:"flex","align-items":"center"}},Yr={style:{color:"#409eff","margin-right":"20px"}},Xr={class:"dida-login-footer"},Zr=ce({__name:"UserForget",setup(e){const{globalProperties:l}=_e(),n=Oe(),i=c(!1),o=c(!1),y=c(!1),f=c("发送验证码");let C=null,p=-1;const s=c(!1),$=c(null),v=c(""),x=c({username:"",emailKey:"",password:"",confirmPassword:""}),b=c({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:A=>new Promise(m=>{const w=setTimeout(()=>{m(x.value.password===A),clearTimeout(w)})}),message:"两次密码不一致"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),S=()=>{we(l,"重置成功")},u=async A=>{if(!y.value){i.value=!0,o.value=!0;try{const m=await Xn(A,x.value.username);m.code===0?(we(l,"验证码发送成功"),v.value=m.data,o.value=!1,y.value=!0,C=new Date,f.value="60秒后重发",p=setInterval(()=>{const U=Math.floor((new Date().getTime()-(C==null?void 0:C.getTime()))/1e3);U>60?(f.value="发送验证码",y.value=!1,clearInterval(p)):f.value=`${60-U}秒后重发`},1e3)):N(l,m.code)}catch(m){console.error("Send email key error",m),ge(l,"发送验证码失败")}finally{i.value=!1}}},_=async()=>{var U;if(s.value=!0,y.value||o.value)return;await pt();const A=document.getElementById("cf-confirm-div");A&&A.remove();const m=document.createElement("div");m.id="cf-confirm-div",m.setAttribute("data-theme","light"),(U=$.value)==null||U.appendChild(m);const w=window;w.turnstile.ready(function(){w.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(h){s.value=!1,await u(h)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},g=c(()=>t(O,{onClick:_,disabled:y.value,loading:o.value,style:"width:120px"},{default:()=>[f.value]})),d=async()=>{i.value=!0;try{const A=await Zn(x.value.username,x.value.password,x.value.emailKey);A.code===0?(we(l,"密码修改成功"),l.$router.push({name:"login"})):N(l,A.code)}catch(A){console.error("Modify password error",A),ge(l,"修改密码失败")}finally{i.value=!1}},r=async({validateResult:A,firstError:m,e:w})=>{if(!i.value){if(w.preventDefault(),A!==!0){ge(l,m);return}v.value?await d():await _()}};return pe(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),De(()=>{}),(A,m)=>{const w=xt,U=Ae,h=ze,I=ya,j=O,D=Ue,T=nt,z=be,L=ot;return V(),ee(me,null,[t(z,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(w,{"max-line":1},{default:a(()=>m[6]||(m[6]=[R("span",null,"如果您未绑定邮箱或忘记用户名，可联系管理员寻求帮助",-1),R("span",null,"管理员邮箱：BoilTask@qq.com",-1)])),_:1}),t(w,{style:{"margin-top":"10px"}},{default:a(()=>m[7]||(m[7]=[R("p",null,"支持原acm.hpu.edu.cn、CodeOJ的用户直接登录",-1),R("p",null,"原DMOJ、hpuoj.com的用户，请先重置密码",-1),R("p",null,"可尝试学号/昵称等作为用户名登录，成功后有机会合并账户或修改用户名",-1)])),_:1}),t(D,{ref:"form",rules:b.value,data:x.value,colon:!0,onReset:S,onSubmit:r,class:"yj-login-form"},{default:a(()=>[t(h,{name:"username",label:"用户名"},{default:a(()=>[t(U,{modelValue:x.value.username,"onUpdate:modelValue":m[0]||(m[0]=M=>x.value.username=M),clearable:"",placeholder:"请输入完整用户名"},null,8,["modelValue"])]),_:1}),v.value?(V(),ee(me,{key:0},[t(h,{name:"email",label:"发送邮箱"},{default:a(()=>[t(I,{append:g.value},{default:a(()=>[R("div",Wr,[R("span",Yr,q(v.value),1)])]),_:1},8,["append"])]),_:1}),t(h,{name:"emailKey",label:"验证码"},{default:a(()=>[t(U,{modelValue:x.value.emailKey,"onUpdate:modelValue":m[1]||(m[1]=M=>x.value.emailKey=M),clearable:"",placeholder:"请输入收到的验证码"},null,8,["modelValue"])]),_:1}),t(h,{name:"password",label:"新密码"},{default:a(()=>[t(U,{modelValue:x.value.password,"onUpdate:modelValue":m[2]||(m[2]=M=>x.value.password=M),type:"password",clearable:"",placeholder:"新密码"},null,8,["modelValue"])]),_:1}),t(h,{name:"confirmPassword",label:"确认密码"},{default:a(()=>[t(U,{modelValue:x.value.confirmPassword,"onUpdate:modelValue":m[3]||(m[3]=M=>x.value.confirmPassword=M),type:"password",clearable:"",placeholder:"请重复输入密码"},null,8,["modelValue"])]),_:1})],64)):le("",!0),v.value?(V(),E(h,{key:1},{default:a(()=>[t(j,{theme:"primary",type:"submit",block:"",loading:i.value},{default:a(()=>m[8]||(m[8]=[P("修改密码")])),_:1},8,["loading"])]),_:1})):(V(),E(h,{key:2},{default:a(()=>[t(j,{theme:"primary",type:"submit",block:"",loading:i.value},{default:a(()=>m[9]||(m[9]=[P("重置密码")])),_:1},8,["loading"])]),_:1}))]),_:1},8,["rules","data"]),R("div",Xr,[t(T,{onClick:m[4]||(m[4]=()=>{fe(l).$router.push({name:"login"})})},{default:a(()=>m[10]||(m[10]=[P("返回登陆 ")])),_:1})])]),_:1}),t(L,{visible:s.value,"onUpdate:visible":m[5]||(m[5]=M=>s.value=M),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:a(()=>[R("div",{ref_key:"dialogContainer",ref:$,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),Qr=de(Zr,[["__scopeId","data-v-e960b193"]]),ei={class:"judger-status-panel"},ti={style:{"text-align":"center","margin-bottom":"20px"}},ai={class:"judger-status-panel"};function li(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!at(e)}const ni=ce({__name:"SystemStatus",setup(e){const{globalProperties:l}=_e(),n=c([]),i=c([]),o=c(!1),y=c(0),f=c(0),C=c(null),p=c(0),s=c(0),$=c(0);let v=-1,x;const k=u=>{let _="失效",g="danger";const d=new Date,r=new Date(u.updateTime);return d.getTime()-r.getTime()>3e4?(_="离线",g="default"):u.cpuUsage>90?(_="CPU过高",g="warning"):u.memPercent>90?(_="内存过高",g="warning"):(_="在线",g="success"),t(he,null,{default:()=>[t("span",null,[u.key,P(" - "),u.name]),t("span",null,[u.updateTime]),t(et,{theme:g,size:"small"},li(_)?_:{default:()=>[_]})]})},b=async()=>{const u={};for(let h=0;h<n.value.length;h++){const I=n.value[h];u[I.key]={...I}}const _={};for(let h=0;h<i.value.length;h++){const I=i.value[h];_[I.key]={...I}}const g=[],d=[],r=await en();if(r.code!==0){N(l,r.code);return}const A=r.data.web,m={key:"didaoj"};A.name?m.name=A.name:m.name="-",A.update_time?m.updateTime=new Date(A.update_time).toLocaleString():m.updateTime="-",A.cpu_usage?m.cpuUsage=Number(A.cpu_usage):m.cpuUsage=0,A.mem_usage?m.memUsage=A.mem_usage/(1024*1024*1024):m.memUsage=0,A.mem_total?m.memTotal=A.mem_total/(1024*1024*1024):m.memTotal=0,m.memTotal>0?m.memPercent=Math.round(m.memUsage/m.memTotal*1e4)/100:m.memPercent=0,m.avgMessage=A.avg_message;const w=u[m.key];w?(m.cpuUsageFrom=w.cpuUsage,m.memPercentFrom=w.memPercent,m.memUsageFrom=w.memUsage,m.memTotalFrom=w.memTotal):(m.cpuUsageFrom=0,m.memPercentFrom=0,m.memUsageFrom=0,m.memTotalFrom=0),g.push(m),n.value=g;const U=r.data.judger;for(let h=0;h<U.length;h++){const I=U[h],j={key:I.key,name:I.name};I.name?j.name=I.name:j.name="-",I.update_time?j.updateTime=new Date(I.update_time).toLocaleString():j.updateTime="-",I.max_job?j.maxJob=Number(I.max_job):j.maxJob=0,I.cpu_usage?j.cpuUsage=Number(I.cpu_usage):j.cpuUsage=0,I.mem_usage?j.memUsage=I.mem_usage/(1024*1024*1024):j.memUsage=0,I.mem_total?j.memTotal=I.mem_total/(1024*1024*1024):j.memTotal=0,j.memTotal>0?j.memPercent=Math.round(j.memUsage/j.memTotal*1e4)/100:j.memPercent=0,j.avgMessage=I.avg_message,_[I.key]?(j.maxJobFrom=_[I.key].maxJob,j.cpuUsageFrom=_[I.key].cpuUsage,j.memPercentFrom=_[I.key].memPercent,j.memUsageFrom=_[I.key].memUsage,j.memTotalFrom=_[I.key].memTotal):(j.maxJobFrom=0,j.cpuUsageFrom=0,j.memPercentFrom=0,j.memUsageFrom=0,j.memTotalFrom=0),d.push(j)}i.value=d,y.value=f.value,f.value=r.data.judge_job,$.value=s.value,C.value?s.value=(f.value-p.value)/((new Date().getTime()-C.value.getTime())/1e3)*60:(C.value=new Date,p.value=f.value,s.value=0,$.value=0),f.value?(clearTimeout(v),v=-1):v<0&&(v=setTimeout(()=>{C.value=null,p.value=0},1e4))},S=async()=>{await b(),o.value=!1};return pe(async()=>{i.value=[],n.value=[],o.value=!0,await S(),x=setInterval(()=>{S()},5e3)}),De(()=>{clearInterval(x)}),(u,_)=>{const g=Dl,d=he,r=be,A=Ve;return V(),E(A,{loading:o.value},{default:a(()=>[t(r,{title:"接口状态",class:"judger-status"},{default:a(()=>[R("div",ei,[(V(!0),ee(me,null,xe(n.value,m=>(V(),E(r,{key:m.key,header:()=>k(m),class:"judge-status-judger"},{footer:a(()=>[R("span",null," 负载信息："+q(m.avgMessage),1)]),default:a(()=>[t(d,{class:"judge-status-judger"},{default:a(()=>[t(g,{title:"CPU使用率",value:m.cpuUsage,animation:{valueFrom:m.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(g,{title:"内存使用率",value:m.memPercent,animation:{valueFrom:m.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(g,{title:"内存使用量",animation:{valueFrom:m.memUsageFrom,duration:2e3},"animation-start":!0,value:m.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(g,{title:"内存总量",value:m.memTotal,animation:{valueFrom:m.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1}),t(r,{title:"判题机状态",class:"judger-status"},{default:a(()=>[R("div",ti,[t(d,null,{default:a(()=>[t(g,{title:"未完成的评测数量",value:f.value,animation:{valueFrom:y.value,duration:4e3},"animation-start":!0},null,8,["value","animation"]),C.value?(V(),E(g,{key:0,title:"评测数量趋势",value:s.value,animation:{valueFrom:$.value,duration:4e3},"animation-start":!0,decimalPlaces:2,unit:"/分钟"},null,8,["value","animation"])):(V(),E(g,{key:1,title:"评测数量趋势",format:()=>"样本较少"}))]),_:1})]),R("div",ai,[(V(!0),ee(me,null,xe(i.value,m=>(V(),E(r,{key:m.key,header:()=>k(m),class:"judge-status-judger"},{footer:a(()=>[R("span",null," 负载信息："+q(m.avgMessage),1)]),default:a(()=>[t(d,{class:"judge-status-judger"},{default:a(()=>[t(g,{title:"并发",value:m.maxJob,animation:{valueFrom:m.maxJob,duration:2e3},"animation-start":!0},null,8,["value","animation"]),t(g,{title:"CPU使用率",value:m.cpuUsage,animation:{valueFrom:m.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(g,{title:"内存使用率",value:m.memPercent,animation:{valueFrom:m.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(g,{title:"内存使用量",animation:{valueFrom:m.memUsageFrom,duration:2e3},"animation-start":!0,value:m.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(g,{title:"内存总量",value:m.memTotal,animation:{valueFrom:m.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1})]),_:1},8,["loading"])}}}),oi=de(ni,[["__scopeId","data-v-8c7320e9"]]),si=ce({__name:"ManageJudge",setup(e){const{globalProperties:l}=_e(),n=c(!1),i=c(!1),o=c({problemId:"",language:void 0,status:void 0}),y=c(!1),f=c([]);f.value=Gt();const C=c([]);C.value=Da();const p=async()=>{n.value=!0;try{const v=await cn();if(v.code!==0){N(l,v.code);return}we(l,"重判成功"),await Y.push({name:"judge-list"})}catch(v){console.error(v),N(l,"重判失败")}finally{n.value=!1}},s=async()=>{if(!o.value.problemId&&!o.value.language&&!o.value.status){N(l,"请输入问题Id");return}y.value=!0;try{const v=await mn(o.value.problemId,o.value.language,o.value.status);if(v.code!==0){N(l,v.code);return}we(l,"重判成功"),await Y.push({name:"judge-list",query:{problem_id:o.value.problemId,language:o.value.language}})}catch(v){console.error(v),N(l,"重判失败")}finally{y.value=!1}},$=async()=>{i.value=!0;try{const v=await pn();if(v.code!==0){N(l,v.code);return}we(l,"重判成功"),await Y.push({name:"judge-list"})}catch(v){console.error(v),N(l,"重判失败")}finally{i.value=!1}};return(v,x)=>{const k=O,b=be,S=Ae,u=ze,_=Nt,g=_t,d=he,r=Ue;return V(),ee(me,null,[t(b,{class:"yj-manage-card",title:"重判最近提交"},{default:a(()=>[t(k,{onClick:p,loading:n.value},{default:a(()=>x[3]||(x[3]=[P("重判")])),_:1},8,["loading"])]),_:1}),t(b,{class:"yj-manage-card",title:"重判指定记录"},{default:a(()=>[t(r,{layout:"inline",onSubmit:s},{default:a(()=>[t(u,{label:"题号"},{default:a(()=>[t(S,{modelValue:o.value.problemId,"onUpdate:modelValue":x[0]||(x[0]=A=>o.value.problemId=A),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(u,{label:"语言"},{default:a(()=>[t(g,{modelValue:o.value.language,"onUpdate:modelValue":x[1]||(x[1]=A=>o.value.language=A),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:a(()=>[(V(!0),ee(me,null,xe(f.value,A=>(V(),E(_,{key:A.value,value:A.value,label:A.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"状态"},{default:a(()=>[t(g,{modelValue:o.value.status,"onUpdate:modelValue":x[2]||(x[2]=A=>o.value.status=A),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:a(()=>[(V(!0),ee(me,null,xe(C.value,A=>(V(),E(_,{key:A.value,value:A.value,label:A.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,null,{default:a(()=>[t(d,null,{default:a(()=>[t(k,{theme:"primary",type:"submit",loading:y.value},{default:a(()=>x[4]||(x[4]=[P("重判")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(b,{class:"yj-manage-card",title:"重判所有"},{default:a(()=>[t(k,{onClick:$,theme:"danger",loading:i.value},{default:a(()=>x[5]||(x[5]=[P("重判")])),_:1},8,["loading"])]),_:1})],64)}}}),ri=de(si,[["__scopeId","data-v-6a706c72"]]),ii=ce({__name:"ManageWeb",setup(e){const{globalProperties:l}=_e(),n=c({theme:"",content:""}),i=c({title:"",content:""}),o=c(!1),y=c(!1),f=c(!1);async function C(x,k){f.value=!0,await dt(x,k,l,tn),f.value=!1}const p=async()=>{y.value=!0;try{const x=await an(n.value.theme,n.value.content);if(x.code!==0){N(l,x.code);return}we(l,"保存成功")}catch(x){console.error(x),N(l,"保存失败")}finally{y.value=!1}},s=async()=>{f.value=!0;try{const x=i.value.content,k=await ln(i.value.title,x);if(k.code!==0){N(l,k.code);return}i.value.content=k.data.content,we(l,"保存成功")}catch(x){console.error(x),ge(l,"保存失败")}finally{f.value=!1}},$=async()=>{n.value=await xa()},v=async()=>{try{i.value=await Ta()}catch{ge(l,"加载公告失败"),i.value={title:"",content:""}}};return pe(async()=>{o.value=!0;try{await $(),await v()}catch{ge(l,"加载数据失败")}o.value=!1}),(x,k)=>{const b=_t,S=ze,u=Ae,_=O,g=he,d=Ue,r=be,A=Me("md-editor-v3"),m=Ve;return V(),E(m,{loading:o.value},{default:a(()=>[t(r,{class:"yj-manage-card",title:"站点通知"},{default:a(()=>[t(d,{onSubmit:p},{default:a(()=>[t(S,{label:"主题"},{default:a(()=>[t(b,{modelValue:n.value.theme,"onUpdate:modelValue":k[0]||(k[0]=w=>n.value.theme=w),options:[{label:"success",value:"success"},{label:"info",value:"info"},{label:"warning",value:"warning"},{label:"error",value:"error"}],placeholder:"请选择主题"},null,8,["modelValue"])]),_:1}),t(S,{label:"内容"},{default:a(()=>[t(u,{modelValue:n.value.content,"onUpdate:modelValue":k[1]||(k[1]=w=>n.value.content=w),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),t(S,null,{default:a(()=>[t(g,null,{default:a(()=>[t(_,{theme:"primary",type:"submit",loading:y.value},{default:a(()=>k[4]||(k[4]=[P("保存")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(r,{class:"yj-manage-card",title:"首页公告"},{actions:a(()=>[t(_,{theme:"primary",loading:f.value,onClick:s},{default:a(()=>k[5]||(k[5]=[P("保存")])),_:1},8,["loading"])]),default:a(()=>[t(d,{onSubmit:s},{default:a(()=>[t(S,{label:"标题"},{default:a(()=>[t(u,{modelValue:i.value.title,"onUpdate:modelValue":k[2]||(k[2]=w=>i.value.title=w),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1}),t(m,{loading:f.value},{default:a(()=>[t(A,{modelValue:i.value.content,"onUpdate:modelValue":k[3]||(k[3]=w=>i.value.content=w),onSave:s,onOnUploadImg:C,previewTheme:"cyanosis",class:"dida-description-editor"},null,8,["modelValue"])]),_:1},8,["loading"])]),_:1})]),_:1},8,["loading"])}}}),ui=de(ii,[["__scopeId","data-v-4d343ab4"]]),Ka=[{name:"problem-list",tab:"problem",sidebar:"problem-list",path:"",title:"问题列表",icon:"list",component:ho},{name:"problem-detail",tab:"problem",sidebar:"problem-list",path:":problemId+",title:"问题详情",icon:"list",component:Ut},{name:"problem-daily-list",tab:"problem",sidebar:"problem-daily-list",path:"daily",title:"每日一题",icon:"list",component:Jo},{name:"problem-daily-detail",tab:"problem",sidebar:"problem-daily-list",path:"daily/:dailyId+",title:"问题详情",icon:"list",component:Ut},{name:"problem-recommend",tab:"problem",sidebar:"problem-recommend",path:"recommend/:problemId*",title:"问题推荐",icon:"cpu",needLogin:!0,component:as},{name:"problem-collection-list",tab:"problem",sidebar:"problem-collection-list",path:"collection",title:"题目集合",icon:"list",disableTabPath:!0,component:Cs},{name:"collection-detail",tab:"collection-detail-tab",sidebar:"collection-detail",path:":collectionId+",title:"题集详情",icon:"cpu",component:Vs},{name:"collection-rank",tab:"collection-detail-tab",sidebar:"collection-rank",path:":collectionId+/rank",title:"题集排名",icon:"list",component:Ds},{name:"collection-edit",tab:"collection-detail-tab",sidebar:"collection-edit",disableSidebar:!0,needLogin:!0,path:":collectionId+/edit",title:"题集编辑",icon:"list",component:sa},{name:"collection-create",tab:"collection-detail-tab",sidebar:"collection-create",needLogin:!0,disableSidebar:!0,path:"create",title:"新建题集",icon:"list",component:sa},{name:"judge-list",tab:"judge",sidebar:"judge-list",path:"",title:"评测列表",icon:"list",component:ia},{name:"judge-detail",tab:"judge",sidebar:"judge-list",path:":judgeId+",title:"评测详情",icon:"cpu",component:ua},{name:"contest-list",tab:"contest",sidebar:"contest-list",path:"",title:"比赛列表",icon:"list",component:da},{name:"contest-recent",tab:"contest",sidebar:"contest-recent",path:"recent",title:"近期比赛",icon:"list",component:da},{name:"contest-create",tab:"contest",sidebar:"contest-create",disableSidebar:!0,needLogin:!0,path:"create",title:"新建比赛",icon:"list",component:ma},{name:"contest-edit",tab:"contest-detail-tab",sidebar:"contest-edit",disableSidebar:!0,needLogin:!0,path:":contestId+/edit",title:"比赛编辑",icon:"list",component:ma},{name:"contest-detail",tab:"contest-detail-tab",sidebar:"contest-detail",path:":contestId+",title:"比赛详情",icon:"cpu",component:tr},{name:"contest-problem-detail",tab:"contest-detail-tab",sidebar:"contest-problem-detail",path:":contestId+/problem/:problemIndex+",title:"问题详情",icon:"cpu",disableSidebar:!0,component:Ut},{name:"contest-judge",tab:"contest-detail-tab",sidebar:"contest-judge",path:":contestId+/judge",title:"评测列表",icon:"list",component:ia},{name:"contest-judge-detail",tab:"contest-detail-tab",sidebar:"contest-judge-detail",path:":contestId+/judge/:judgeId+",title:"评测详情",icon:"cpu",component:ua,disableSidebar:!0},{name:"contest-rank",tab:"contest-detail-tab",sidebar:"contest-rank",path:":contestId+/rank",title:"比赛排名",icon:"list",component:rr},{name:"contest-discuss",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss",title:"比赛讨论",icon:"list",component:At},{name:"contest-discuss-detail",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss/:discussId+",title:"讨论详情",icon:"list",component:Rt},{name:"discuss-list",tab:"discuss",sidebar:"discuss-list",path:"",title:"讨论列表",icon:"list",component:At},{name:"discuss-create",tab:"discuss",sidebar:"discuss-create",disableSidebar:!0,needLogin:!0,path:"create",title:"新建讨论",icon:"list",component:pa},{name:"discuss-edit",tab:"discuss-detail-tab",sidebar:"discuss-edit",disableSidebar:!0,needLogin:!0,path:":discussId+/edit",title:"编辑讨论",icon:"list",component:pa},{name:"discuss-list-problem",tab:"discuss",sidebar:"discuss-list-problem",path:"problem",title:"题目讨论",icon:"list",component:At},{name:"discuss-detail",tab:"discuss",sidebar:"discuss-list",path:":discussId+",title:"讨论详情",icon:"list",component:Rt},{name:"rank-ac-all",tab:"rank",sidebar:"rank-ac-all",path:"ac",title:"AC排名",icon:"base-station",props:{type:"all"},component:rt},{name:"rank-ac-problem",tab:"rank",sidebar:"rank-ac-problem",path:"ac/problem",title:"题量排名",icon:"base-station",props:{type:"problem"},component:rt},{name:"rank-ac-problem-today",tab:"rank",sidebar:"rank-ac-problem-today",path:"ac/problem/today",title:"今日题量",icon:"base-station",props:{type:"problem-today"},component:rt},{name:"rank-ac-problem-day7",tab:"rank",sidebar:"rank-ac-problem-day7",path:"ac/problem/day7",title:"7日题量",icon:"base-station",props:{type:"problem-day7"},component:rt},{name:"rank-ac-problem-day30",tab:"rank",sidebar:"rank-ac-problem-day30",path:"ac/problem/day30",title:"30日题量",icon:"base-station",props:{type:"problem-day30"},component:rt},{name:"rank-ac-problem-year",tab:"rank",sidebar:"rank-ac-problem-year",path:"ac/problem/year",title:"1年题量",icon:"base-station",props:{type:"problem-year"},component:rt},{name:"system-status",tab:"system",sidebar:"system-status",path:"",title:"运行状态",icon:"base-station",component:oi},{name:"system-about",tab:"system",sidebar:"system-about",path:"about",title:"关于",icon:"base-station",props:{discussId:"93"},component:Rt},{name:"manage-problem-create",tab:"manage",sidebar:"manage-problem-create",disableSidebar:!0,path:"problem",title:"新建问题",icon:"list",component:oa,auths:[Le.ManageProblem]},{name:"manage-problem",tab:"manage",sidebar:"manage-problem",disableSidebar:!0,path:"problem/:problemId+",title:"问题编辑",icon:"list",component:oa,auths:[Le.ManageProblem]},{name:"manage-problem-daily-create",tab:"manage",sidebar:"manage-problem-daily-create",disableSidebar:!0,path:"problem/daily",title:"新建每日一题",icon:"list",component:na,auths:[Le.ManageProblemDaily]},{name:"manage-problem-daily",tab:"manage",sidebar:"manage-problem-daily",disableSidebar:!0,path:"problem/daily/:dailyId+",title:"编辑每日一题",icon:"list",component:na,auths:[Le.ManageProblemDaily]},{name:"manage-problem-judge",tab:"manage",sidebar:"manage-problem-judge",disableSidebar:!0,path:"problem/:problemId+/judge",title:"评测数据",icon:"list",component:ps,auths:[Le.ManageProblem]},{name:"manage-web",tab:"manage",path:"web",sidebar:"manage-web",title:"站点管理",icon:"list",auths:[Le.ManageWeb],component:ui},{name:"manage-judge",tab:"manage",path:"judge",sidebar:"manage-judge",title:"评测管理",icon:"list",auths:["i-manage-judge"],component:ri},{name:"login-forget",tab:"login",path:"forget",title:"忘记密码",component:Qr}],fa=(e,l,n,i)=>{i.tab==n&&(i.disableSidebar&&l!=i.sidebar||i.sidebar==null||i.sidebar!=i.name||e.push({name:i.name,title:i.title,icon:i.icon,to:{name:i.name}}))},di=(e,l)=>{const n=[];return Ka.forEach(i=>{if(Ra(i)){const o=[];i.children.forEach(y=>{fa(o,e,l,y)}),o.length>0&&n.push({title:i.title,children:o})}else fa(n,e,l,i)}),n},va=(e,l)=>{const n=co(l.tab),i={name:l.name,path:"/"+l.path,meta:{title:l.title+" - "+n.title,tab:l.tab,sidebar:l.sidebar,showSidebar:n.showSidebar,needLogin:n.needLogin||l.needLogin,tabAuths:n.auths,auths:l.auths},props:l.props,component:l.component};!n.disablePath&&!l.disableTabPath&&(i.path=n.path+i.path),e.push(i)},ci=e=>{Ka.forEach(l=>{Ra(l)?l.children.forEach(n=>{va(e,n)}):va(e,l)})},mi={class:"sh-main"},pi=ce({__name:"View403",setup(e){let l=Se();const n=c("");return pe(()=>{l.query.target?n.value=l.query.target:n.value=l.fullPath}),(i,o)=>{const y=O;return V(),ee("div",mi,[R("p",null,q(n.value),1),o[2]||(o[2]=R("p",null,"该页面无访问权限，请更换访问目标或重新登陆后再试",-1)),t(y,{theme:"primary",onClick:o[0]||(o[0]=()=>i.$router.push("/"))},{default:a(()=>o[1]||(o[1]=[P("返回首页")])),_:1})])}}}),Fa=de(pi,[["__scopeId","data-v-8f62f1f8"]]),ht=[];po(ht);ci(ht);ht.push({path:"/403",name:"403",component:Fa});ht.push({path:"/:pathMatch(.*)*",name:"404",component:Aa});const Y=sl({history:rl("/"),routes:ht});Y.beforeEach((e,l,n)=>{if(e.name==null||!Y.hasRoute(e.name)){n({name:"home"});return}const i=e.matched[e.matched.length-1].meta;if(i.redirect){n({name:i.redirect});return}if(i.needLogin){const y=Oe();if(y.getToken==null||y.getToken==""){n({name:"login",query:{redirect_uri:e.fullPath}});return}}const o=i.tabAuths;if(o&&!Oe().hasAllAuths(o)){n({name:"403",query:{target:e.fullPath}});return}n()});Y.afterEach((e,l)=>{if(e.name===l.name)return;const n=Vt(),i=Ze();let o=null;if(e.matched.length>0&&(o=e.matched[e.matched.length-1].meta),o!=null&&o.title&&i.setTitle(o==null?void 0:o.title),o!=null&&o.showSidebar){n.setSidebarShow(!0);const y=di(o==null?void 0:o.sidebar,o==null?void 0:o.tab);n.setMenuList(y),n.setMenuActiveName(o==null?void 0:o.sidebar)}else n.setSidebarShow(!1);window.scrollTo(0,0)});const Na=vt("login",{state:()=>({Loaded:!1}),getters:{isLoaded(){return this.Loaded}}}),fi=ce({__name:"HeaderContent",setup(e){const l=Na(),n=Oe(),{globalProperties:i}=_e(),o=c(l.isLoaded),y=c(!1),f=c(n.getUsername),C=c(n.getNickname),p=c(),s=()=>{p.value=mo(n)};l.$subscribe((x,k)=>{o.value=k.Loaded}),n.$subscribe((x,k)=>{f.value=k.username,C.value=k.nickname,y.value=k.token!="",s()});const $=()=>{i.$router.currentRoute.value.name!=="login"&&i.$router.push({name:"login",query:{redirect_uri:i.$router.currentRoute.value.fullPath}})},v=()=>{n.clear(),i.$message.success({duration:3e3,content:"注销成功"}),i.$router.push({path:"/login",query:{redirect_uri:i.$router.currentRoute.value.fullPath}})};return pe(()=>{s()}),(x,k)=>{const b=Me("router-link"),S=Ia,u=Ca,_=jl,g=Ll;return V(),E(g,{modelValue:x.$route.meta.tab,"onUpdate:modelValue":k[0]||(k[0]=d=>x.$route.meta.tab=d),class:"sh-menu","expand-type":"popup"},{logo:a(()=>[t(b,{to:"/",class:"sh-logo"},{default:a(()=>k[1]||(k[1]=[P("DidaOJ")])),_:1})]),operations:a(()=>[o.value&&y.value?(V(),E(_,{key:0,title:C.value},{icon:a(()=>[t(S,{name:"user"})]),default:a(()=>[t(u,{value:"user",to:{path:"/user/"+f.value}},{default:a(()=>k[2]||(k[2]=[P("个人空间")])),_:1},8,["to"]),t(u,{value:"user_logout",onClick:v},{default:a(()=>k[3]||(k[3]=[P(" 注销")])),_:1})]),_:1},8,["title"])):o.value?(V(),E(u,{key:2,value:"login",onClick:$},{icon:a(()=>[t(S,{name:"login"})]),default:a(()=>[k[5]||(k[5]=P(" 登录 "))]),_:1})):(V(),E(u,{key:1,value:"login"},{icon:a(()=>[t(S,{name:"login"})]),default:a(()=>[k[4]||(k[4]=P(" ... "))]),_:1}))]),default:a(()=>[(V(!0),ee(me,null,xe(p.value,d=>(V(),E(u,{key:d.name,value:d.name,to:{name:d.name}},{icon:a(()=>[d.icon?(V(),E(S,{key:0,name:d.icon},null,8,["name"])):le("",!0)]),default:a(()=>[P(" "+q(d.title),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])}}}),vi=de(fi,[["__scopeId","data-v-7a3c4090"]]),_i={id:"menu-container"},gi=ce({__name:"SidebarContent",setup(e){const l=Vt(),n=c(!1),i=c(null),o=c(l.menuActiveName),y=c(l.menuList),f=c([]),C=c(!1),p=()=>{o.value=l.menuActiveName;const $=JSON.stringify(y.value),v=JSON.stringify(l.menuList);$!==v&&(f.value.push([...l.menuList]),s())},s=async()=>{if(f.value.length>0&&!C.value){for(C.value=!0;f.value.length>1;)f.value.shift();const $=f.value.shift();n.value=$.length<=0,y.value=[],await pt(),i.value&&i.value.updateActiveName(),await new Promise(x=>setTimeout(x,300)),y.value=$,await pt(),i.value&&i.value.updateActiveName();const v=300;await new Promise(x=>setTimeout(x,v)),C.value=!1,await s()}};return l.$subscribe(($,v)=>{p()}),pe(()=>{p()}),($,v)=>{const x=Ia,k=Ca,b=Ul,S=$l,u=Ve;return V(),ee(me,null,[R("div",_i,[t(S,{modelValue:o.value,"onUpdate:modelValue":v[0]||(v[0]=_=>o.value=_),theme:"light",class:"sh-menu-container"},{default:a(()=>[t(il,{name:"move-left"},{default:a(()=>[(V(!0),ee(me,null,xe(y.value,(_,g)=>(V(),ee(me,{key:g},[fe(fo)(_)?(V(),E(b,{key:0,title:_.title},{default:a(()=>[(V(!0),ee(me,null,xe(_.children,(d,r)=>(V(),E(k,{key:d.name,value:d.name,to:d.to},Qt({default:a(()=>[P(" "+q(d.title),1)]),_:2},[d.icon?{name:"icon",fn:a(()=>[t(x,{name:d.icon,class:Kt(d.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))),128))]),_:2},1032,["title"])):(V(),E(k,{key:_.name,value:_.name,to:_.to},Qt({default:a(()=>[P(" "+q(_.title),1)]),_:2},[_.icon?{name:"icon",fn:a(()=>[t(x,{name:_.icon,class:Kt(_.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),t(u,{size:"small",loading:n.value,"show-overlay":!0,attach:"#menu-container",class:"sh-sidebar-loading",style:{"align-items":"flex-start","padding-top":"100px"}},null,8,["loading"])],64)}}}),bi=de(gi,[["__scopeId","data-v-96e2d89f"]]),hi={};function yi(e,l){return null}const wi=de(hi,[["render",yi]]),ki={class:"footer"},Si={class:"footer-left"},Ci={class:"foot-time"},Ii={class:"footer-center"},Pi={href:"https://beiancx.miit.gov.cn/",target:"_blank"},xi={class:"footer-right"},Ti={class:"foot-text"},Vi={href:"https://github.com/hpu-developer/DiDaOJ-web",target:"_blank"},Di={class:"foot-text"},ji={href:"https://github.com/hpu-developer/DiDaOJ-go",target:"_blank"},Li=ce({__name:"FooterContent",setup(e){const l=c("");function n(){l.value=new Date().toLocaleString()}return pe(()=>{n(),setInterval(()=>{n()},1e3)}),(i,o)=>{const y=O;return V(),ee("div",ki,[R("div",Si,[R("p",Ci,q(l.value),1)]),R("div",Ii,[R("a",Pi,[t(y,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>o[0]||(o[0]=[P("豫ICP备15024677号-4")])),_:1})])]),R("div",xi,[R("p",Ti,[R("a",Vi,[t(y,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>o[1]||(o[1]=[P("@didaoj-web")])),_:1})])]),R("p",Di,[R("a",ji,[t(y,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>o[2]||(o[2]=[P("@didaoj-go")])),_:1})])])])])}}}),$i=de(Li,[["__scopeId","data-v-44f2e4e7"]]),wt=20,Et=100,qt=50,Ui=ce({__name:"ForceHiddenSidebarButton",setup(e){let l=Vt();const n=c({x:window.innerWidth-Et-wt,y:window.innerHeight-qt-wt}),i=c(window.innerWidth),o=c(window.innerHeight);let y=!1,f={x:0,y:0};const C=_=>{y=!0;const g=_.clientX??_.touches[0].clientX,d=_.clientY??_.touches[0].clientY;f={x:g-n.value.x,y:d-n.value.y},document.addEventListener("mousemove",p),document.addEventListener("touchmove",p),document.addEventListener("mouseup",s),document.addEventListener("touchend",s)},p=_=>{if(!y)return;const g=_.clientX??_.touches[0].clientX,d=_.clientY??_.touches[0].clientY;let r=g-f.x,A=d-f.y;r=Math.max(0,Math.min(r,i.value-Et)),A=Math.max(0,Math.min(A,o.value-qt)),n.value={x:r,y:A}},s=()=>{y=!1,document.removeEventListener("mousemove",p),document.removeEventListener("touchmove",p),document.removeEventListener("mouseup",s),document.removeEventListener("touchend",s)},$=()=>{i.value=window.innerWidth,o.value=window.innerHeight,n.value={x:Math.min(n.value.x,i.value-Et-wt),y:Math.min(n.value.y,o.value-qt-wt)}};let v=c(l.forceHiddenSidebar),x=c(l.forceHiddenSidebar);const k=()=>{v.value=!v.value,l.setForceHiddenSidebar(v.value)},b=()=>{x.value||(x.value=!0,l.setForceHiddenSidebar(v.value))},S=()=>{x.value&&(x.value=!1,l.setForceHiddenSidebar(!1))},u=_=>{_>=800?S():b()};return u(i.value),$e(i,_=>{u(_)}),pe(()=>{window.addEventListener("resize",$)}),De(()=>{window.removeEventListener("resize",$)}),(_,g)=>{const d=O;return fe(x)?(V(),E(d,{key:0,class:"draggable-button",style:ga({top:`${n.value.y}px`,left:`${n.value.x}px`}),onMousedown:C,onTouchstart:C,variant:"dashed",theme:"primary",onClick:k},{default:a(()=>[P(q(fe(v)?"显示":"隐藏"),1)]),_:1},8,["style"])):le("",!0)}}}),zi=de(Ui,[["__scopeId","data-v-1aee5506"]]),kt="DidaOJ",Ai=ce({__name:"App",setup(e){const{globalProperties:l}=_e(),n=Na(),i=Oe(),o=Ze(),y=Vt();n.$patch({Loaded:!1});const f=i.getToken,C=c(!1),p=c(!1);o.title&&o.title.length>0?document.title=o.title+" - "+kt:document.title=kt,o.$subscribe((k,b)=>{b.title&&b.title.length>0?document.title=b.title+" - "+kt:document.title=kt}),y.$subscribe((k,b)=>{C.value=b.showSidebar,p.value=C.value&&!b.forceHiddenSidebar});const s=Se(),$=Je(()=>{const k=s.meta.auths;return k?!i.hasAllAuths(k):!1});function v(){l.$message.warning({duration:3e3,content:"登陆状态失效"}),n.$patch({Loaded:!0}),i.clear()}const x=async()=>{const k=document.querySelectorAll("oj-problem");if(k.length===0)return;let b={};k.forEach(_=>{const g=_.getAttribute("id"),d=document.createElement("span");d.setAttribute("style","padding:5px"),_.replaceWith(d);const r=c("default");b[g]||(b[g]=[]),b[g].push(r);let A=g;g&&!g.includes("-")&&(A="DidaOJ-"+g),ha({render:()=>cl(O,{innerHTML:A,onClick:()=>{window.open(`/problem/${g}`,"_blank")},size:"small",variant:"outline",theme:r.value})}).mount(d)});const S=[];for(const _ in b)S.push(_);const u=await kn(S);if(u.code===0)for(const _ in b){const g=b[_];if(!g)continue;let d="primary";const r=u.data[_];if(r)switch(r){case Ge.Accept:d="success";break;case Ge.Attempt:d="warning";break}for(const A of g)A.value=d}};return pe(()=>{document.addEventListener("DOMContentLoaded",()=>{new MutationObserver(()=>{Nl(()=>{x()},1e3)()}).observe(document.body,{childList:!0,subtree:!0}),ul.autoSpacingPage()}),f?On().then(k=>{k.code==0?(i.loadResponse(k.data),n.$patch({Loaded:!0})):(N(l,k.code),n.$patch({Loaded:!0}),i.clear())}).catch(k=>{console.log(k),v()}):n.$patch({Loaded:!0})}),(k,b)=>{const S=zl,u=Rl,_=Me("RouterView"),g=Ml,d=Al,r=El;return V(),ee(me,null,[t(d,{class:"sh-app-layout"},{default:a(()=>[t(S,{class:"sh-header"},{default:a(()=>[t(vi)]),_:1}),t(d,null,{default:a(()=>[t(dl,{name:"slide"},{default:a(()=>[p.value?(V(),E(u,{key:0,class:"sh-sidebar"},{default:a(()=>[t(bi)]),_:1})):le("",!0)]),_:1}),t(d,{class:Kt(["sh-main-layout",{expanded:!p.value}])},{default:a(()=>[t(wi),t(g,{class:"sh-main-content"},{default:a(()=>[$.value?(V(),E(Fa,{key:0})):(V(),E(_,{key:1}))]),_:1}),t($i)]),_:1},8,["class"])]),_:1})]),_:1}),C.value?(V(),E(zi,{key:0})):le("",!0),t(r,{container:"body",offset:["24px","80px"],size:"small"})],64)}}}),Ri=de(Ai,[["__scopeId","data-v-66c2cfa5"]]);function Mi(e,l={}){const n=/\{\{%\s*(\w+)\s+([^%]+?)\s*%\}\}/g,i=l.renderers||{},o=e.renderer.rules.text??function(y,f){return y[f].content};e.renderer.rules.text=function(y,f,C,p,s){const v=y[f].content;return n.test(v)?v.replace(n,(k,b,S)=>{const u=i[b];if(typeof u=="function"){const _=S.trim().split(/\s+/);return u(_)}else return`<span class="shortcode-${b}">${b}: ${S.trim()}</span>`}):o(y,f,C,p,s)}}function Ei(e,l){const n=/\{\{%\s*(\w+)\s*%\}\}([\s\S]*?)\{\{%\s*\/\1\s*%\}\}/g;e.core.ruler.push("shortcode_color",i=>{for(const o of i.tokens){if(o.type!=="inline")continue;let y=o.content,f=!1;y=y.replace(n,(C,p,s)=>{var v;const $=(v=l.renderers)==null?void 0:v[p];return $?(f=!0,$([],s.trim())):C}),f&&(o.type="html_inline",o.tag="",o.attrs=null,o.content=y,o.children=[])}})}Ol({markdownItConfig(e){e.use($t,"align-left",{render(l,n){return l[n].nesting===1?`<div class="sh-align-left">
`:`</div>
`}}),e.use($t,"align-center",{render(l,n){return l[n].nesting===1?`<div class="sh-align-center">
`:`</div>
`}}),e.use($t,"align-right",{render(l,n){return l[n].nesting===1?`<div class="sh-align-right">
`:`</div>
`}}),e.use(Mi,{renderers:{problem:([l])=>`<oj-problem id="${l}">${l}</oj-problem>`}}),e.use(Ei,{renderers:{red:(l,n)=>`<span class="dida-font-red">${n}</span>`,green:(l,n)=>`<span class="dida-font-green">${n}</span>`,blue:(l,n)=>`<span class="dida-font-blue">${n}</span>`}})},markdownItPlugins(e){return[...e,{type:"linkAttr",plugin:fl,options:{matcher(l){return!l.startsWith("#")},attrs:{target:"_blank"}}}]}});const Oa=ml();Oa.use(pl);const ct=ha(Ri);ct.use(Oa);ct.use(Y);ct.use(ql);ct.use(Gl);ct.use(Hl);ct.mount("#app");Bl().then(()=>{console.log("Text cache reinitialized")}).catch(e=>{console.error("Text cache reinitialization failed",e)});
