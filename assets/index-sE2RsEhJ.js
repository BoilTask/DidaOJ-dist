import{bl as st,bm as qt,L as Q,r as v,q as le,t as Mt,bn as Y,bo as D,v as t,bp as l,bq as A,F as Z,br as me,bs as M,bt as q,au as L,a as qe,bu as te,bv as ie,aI as de,j as ga,bw as ba,bx as ha,by as ya,u as Ie,H as ze,bz as wa,bA as Re,n as Ae,w as xe,bB as Ft,bC as nt,ah as ka,bD as Nt,bE as Ca,bF as Sa,bG as Gt,aN as Ia,bH as Pt,bI as _t,a5 as Pa,bJ as Ta,bK as xa,N as Va,bL as La}from"./node_modules-BxvVsS-w.js";import{L as we,C as se,S as pe,a as ja,T as Fe,b as be,A as bt,c as Da,d as $a,e as za,f as Ua,g as He,R as ve,B as G,F as Le,h as je,I as De,D as Me,i as Ot,j as Ee,k as Ke,l as Aa,m as ke,n as rt,o as it,O as ht,p as Ht,q as Bt,P as Jt,r as ut,s as Wt,t as Ra,u as Ea,v as Ka,w as qa,x as Ma,y as Fa,z as Na,M as Yt,E as Xt,G as Ga,H as Oa,J as Ha,K as Ba,N as Ja,Q as Wa,U as Ya,V as Xa,W as Za,X as Qa}from"./tdesign-vue-next-DRerEWiA.js";import{V as re}from"./vditor-DArazWIS.js";import{e as Tt}from"./monaco-editor-BHsDS0An.js";import{H as el,v as tl}from"./highlight.js-D9zWiMxS.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const g of c.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&r(g)}).observe(document,{childList:!0,subtree:!0});function n(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(o){if(o.ep)return;o.ep=!0;const c=n(o);fetch(o.href,c)}})();var $e=(e=>(e.Manage="i-manage",e.ManageJudge="i-manage-judge",e.ManageProblem="i-manage-problem",e.ManageContest="i-manage-contest",e.ManageCollection="i-manage-collection",e))($e||{});const al={"r-admin":["i-manage","i-manage-judge","i-manage-problem","i-manage-contest","i-manage-collection"]};function ll(e){if(e==null)return[];const a=[];for(const n of e){const r=al[n];r!=null&&a.push(...r)}return[...new Set(a)]}function nl(e,a){if(e==null||a==null)return!1;const n=ll(e);for(const r of a)if(!n.includes(r))return!1;return!0}const Se=st("user",{state:()=>({token:"",userId:-1,username:"",nickname:"",roles:[]}),getters:{getToken(){return this.token},getUserId(){return this.userId},getUsername(){return this.username},getNickname(){return this.nickname}},actions:{clear(){this.$patch({token:"",userId:-1,username:"",nickname:"",roles:[]})},loadResponse(e){this.$patch({token:e.token,userId:e.user_id,username:e.username,nickname:e.nickname,roles:e.roles})},isLogin(){return this.token!=null&&this.token!=""},hasAuth(e){return this.hasAllAuths([e])},hasAllAuths(e){return e?nl(this.roles,e):!0}},persist:!0}),Ue=st("webStyle",{state:()=>({title:""}),getters:{getTitle(){return this.title}},actions:{setTitle(e){this.title=e}}}),ct=st("sidebarStyle",{state:()=>({showSidebar:!1,forceHiddenSidebar:!1,menuActiveName:"",menuList:[]}),getters:{getMenuList(){return this.menuList}},actions:{setSidebarShow(e){this.showSidebar=e},setForceHiddenSidebar(e){this.forceHiddenSidebar=e},setMenuActiveName(e){this.menuActiveName=e},clearMenuList(){this.menuList=[]},setMenuList(e){this.menuList=e},addMenuList(e){this.menuList.push(e)}}}),Je=qt.create({timeout:6e4,withCredentials:!1,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});Je.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function ol(){return Je({baseURL:"https://r2-oj.didapipa.com",url:"/system/notification.json?"+Date.now(),method:"get"})}function sl(){return Je({baseURL:"https://r2-oj.didapipa.com",url:"/status/judger.json?"+Date.now(),method:"get"})}function Zt(e){return Je({baseURL:"https://r2-oj.didapipa.com",url:"/status/judger/"+e+".json?"+Date.now(),method:"get"})}function rl(e){return Je({baseURL:"https://r2-oj.didapipa.com",url:"/status/web.json?"+Date.now(),method:"get"})}const il={class:"judger-status-panel"},ul={class:"judger-status-panel"};function cl(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!qe(e)}const dl=Q({__name:"SystemStatus",setup(e){const a=v([]),n=v([]),r=v(!1),o=v(!1);let c;const g=d=>{let f="失效",u="danger";const _=new Date,m=new Date(d.updateTime);return _.getTime()-m.getTime()>3e4?(f="离线",u="default"):d.cpuUsage>90?(f="CPU过高",u="warning"):d.memPercent>90?(f="内存过高",u="warning"):(f="在线",u="success"),t(pe,null,{default:()=>[t("span",null,[d.key,L(" - "),d.name]),t("span",null,[d.updateTime]),t(Fe,{theme:u,size:"small"},cl(f)?f:{default:()=>[f]})]})},y=async()=>{const d=[{key:"didaoj",name:"DidaOj"}],f={};for(let _=0;_<a.value.length;_++){const m=a.value[_];f[m.key]=m}const u=[];for(let _=0;_<d.length;_++){const m=d[_],s={key:m.key},p=await rl(m.key);p&&(p.name?s.name=p.name:s.name="-",p.update_time?s.updateTime=new Date(p.update_time).toLocaleString():s.updateTime="-",p.cpu_usage?s.cpuUsage=Number(p.cpu_usage):s.cpuUsage=0,p.mem_usage?s.memUsage=p.mem_usage/(1024*1024*1024):s.memUsage=0,p.mem_total?s.memTotal=p.mem_total/(1024*1024*1024):s.memTotal=0,s.memTotal>0?s.memPercent=Math.round(s.memUsage/s.memTotal*1e4)/100:s.memPercent=0,s.avgMessage=p.avg_message,f[m.key]?(s.cpuUsageFrom=f[m.key].cpuUsage,s.memPercentFrom=f[m.key].memPercent,s.memUsageFrom=f[m.key].memUsage,s.memTotalFrom=f[m.key].memTotal):(s.cpuUsageFrom=0,s.memPercentFrom=0,s.memUsageFrom=0,s.memTotalFrom=0),u.push(s))}a.value=u},P=async()=>{const d=await sl(),f={};for(let _=0;_<n.value.length;_++){const m=n.value[_];f[m.key]=m}const u=[];for(let _=0;_<d.judgers.length;_++){const m=d.judgers[_],s={key:m.key,name:m.name},p=await Zt(m.key);p&&(p.name?s.name=p.name:s.name="-",p.update_time?s.updateTime=new Date(p.update_time).toLocaleString():s.updateTime="-",p.cpu_usage?s.cpuUsage=Number(p.cpu_usage):s.cpuUsage=0,p.mem_usage?s.memUsage=p.mem_usage/(1024*1024*1024):s.memUsage=0,p.mem_total?s.memTotal=p.mem_total/(1024*1024*1024):s.memTotal=0,s.memTotal>0?s.memPercent=Math.round(s.memUsage/s.memTotal*1e4)/100:s.memPercent=0,s.avgMessage=p.avg_message,f[m.key]?(s.cpuUsageFrom=f[m.key].cpuUsage,s.memPercentFrom=f[m.key].memPercent,s.memUsageFrom=f[m.key].memUsage,s.memTotalFrom=f[m.key].memTotal):(s.cpuUsageFrom=0,s.memPercentFrom=0,s.memUsageFrom=0,s.memTotalFrom=0),u.push(s))}n.value=u},b=async()=>{await y(),r.value=!1,await P(),o.value=!1};return le(async()=>{n.value=[],a.value=[],o.value=!0,r.value=!0,await b(),c=setInterval(()=>{b()},5e3)}),Mt(()=>{clearInterval(c)}),(d,f)=>{const u=ja,_=pe,m=se,s=we;return D(),Y(Z,null,[t(m,{title:"接口状态",class:"judger-status"},{default:l(()=>[t(s,{loading:r.value},{default:l(()=>[A("div",il,[(D(!0),Y(Z,null,me(a.value,p=>(D(),M(m,{key:p.key,header:()=>g(p),class:"judge-status-judger"},{footer:l(()=>[A("span",null," 负载信息："+q(p.avgMessage),1)]),default:l(()=>[t(_,{class:"judge-status-judger"},{default:l(()=>[t(u,{title:"CPU使用率",value:p.cpuUsage,animation:{valueFrom:p.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(u,{title:"内存使用率",value:p.memPercent,animation:{valueFrom:p.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(u,{title:"内存使用量",animation:{valueFrom:p.memUsageFrom,duration:2e3},"animation-start":!0,value:p.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(u,{title:"内存总量",value:p.memTotal,animation:{valueFrom:p.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1},8,["loading"])]),_:1}),t(m,{title:"判题机状态",class:"judger-status"},{default:l(()=>[t(s,{loading:o.value},{default:l(()=>[A("div",ul,[(D(!0),Y(Z,null,me(n.value,p=>(D(),M(m,{key:p.key,header:()=>g(p),class:"judge-status-judger"},{footer:l(()=>[A("span",null," 负载信息："+q(p.avgMessage),1)]),default:l(()=>[t(_,{class:"judge-status-judger"},{default:l(()=>[t(u,{title:"CPU使用率",value:p.cpuUsage,animation:{valueFrom:p.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(u,{title:"内存使用率",value:p.memPercent,animation:{valueFrom:p.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(u,{title:"内存使用量",animation:{valueFrom:p.memUsageFrom,duration:2e3},"animation-start":!0,value:p.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(u,{title:"内存总量",value:p.memTotal,animation:{valueFrom:p.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1},8,["loading"])]),_:1})],64)}}}),ee=(e,a)=>{const n=e.__vccOpts||e;for(const[r,o]of a)n[r]=o;return n},vt=ee(dl,[["__scopeId","data-v-1fb43cc1"]]),ml={style:{"text-align":"right"}},pl=Q({__name:"Hitokoto",setup(e){const a=v(!1),n=v(""),r=v(""),o=v(""),c=async()=>{a.value=!0;try{const y=await(await fetch("https://v1.hitokoto.cn")).json();r.value=y.hitokoto,o.value=y.creator,n.value="—— "+y.from}catch(g){r.value="一言获取失败了，但至少您还可以访问本站。",o.value="BoilTask",n.value="DidaOJ",console.error("Error fetching Hitokoto:",g)}finally{a.value=!1}};return le(()=>{c()}),(g,y)=>{const P=se,b=we;return D(),M(b,{loading:a.value},{default:l(()=>[t(P,{title:"一言 © Hitokoto"},{actions:l(()=>[L(" @"+q(o.value),1)]),default:l(()=>[A("div",null,[A("span",null,q(r.value),1),A("p",ml,q(n.value),1)])]),_:1})]),_:1},8,["loading"])}}}),fl={class:"sh-main"},_l={class:"dida-swiper-div"},vl=Q({__name:"HomeView",setup(e){let a=-1;const n=v(null),r=async()=>{n.value=await ol()};return le(async()=>{await r(),a=setInterval(()=>{r()},3e4)}),Mt(()=>{clearInterval(a)}),(o,c)=>{const g=bt,y=$a,P=Da,b=se,d=be,f=He,u=Ua,_=za,m=ve;return D(),M(m,null,{default:l(()=>[t(d,{span:8},{default:l(()=>[A("div",fl,[n.value?(D(),M(g,{key:0,style:{margin:"20px"},theme:n.value.theme},{default:l(()=>[L(q(n.value.content),1)]),_:1},8,["theme"])):te("",!0),A("div",_l,[t(P,{class:"dida-swiper"},{default:l(()=>[t(y,null,{default:l(()=>c[0]||(c[0]=[A("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1}),t(y,null,{default:l(()=>c[1]||(c[1]=[A("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1})]),_:1})]),t(b,{title:"正在完善，欢迎提供意见建议",style:{width:"500px",margin:"0 auto"}},{default:l(()=>c[2]||(c[2]=[A("p",null,[A("a",{href:"https://codeoj.cn/",target:"_blank"},"CodeOJ"),L("的迁移计划")],-1),A("p",null,"正在开发中",-1)])),_:1})])]),_:1}),t(d,{span:4},{default:l(()=>[t(pl,{style:{margin:"10px"}}),t(vt),t(b,{style:{margin:"10px"},bordered:!0},{header:l(()=>c[3]||(c[3]=[A("b",null,"友情链接",-1)])),default:l(()=>[t(_,null,{default:l(()=>[t(u,null,{default:l(()=>[t(f,{href:"https://boiltask.com",target:"_blank"},{default:l(()=>c[4]||(c[4]=[L("BoilTask Blog")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),gl=ee(vl,[["__scopeId","data-v-aba0b66b"]]),bl={class:"sh-main"},hl=Q({__name:"View404",setup(e){let a=ie(),n=v(a.fullPath);return(r,o)=>{const c=G;return D(),Y("div",bl,[A("p",null,q(de(n)),1),o[2]||(o[2]=A("p",null,"该页面无效或已被迁移，请重新选择访问目标",-1)),t(c,{theme:"primary",onClick:o[0]||(o[0]=()=>r.$router.push("/"))},{default:l(()=>o[1]||(o[1]=[L("返回首页")])),_:1})])}}}),Qt=ee(hl,[["__scopeId","data-v-d4218944"]]);let gt=null;async function yl(){gt=await kl()}function wl(e,a="zh"){if(gt==null)return[!1,e.toString()];const n=gt[e.toString()];if(!n)return[!1,e.toString()];let r=n[a];return r||(a="zh",r=n[a]),r?[!0,r]:[!1,e.toString()]}async function kl(){return new Promise(e=>{e({404:{zh:"接口未找到"},1e3:{zh:"系统错误，请重试或等待管理员修复"},1001:{zh:"系统异常，请重试或等待管理员修复"},1002:{zh:"未知错误"},1003:{zh:"操作过于频繁，请稍后重试"},10001:{zh:"权限异常，请重新登陆后再试"},10002:{zh:"参数不符合要求"},10003:{zh:"未找到目标数据"},100001:{zh:"用户名不存在或密码不匹配"},100002:{zh:"邮件发送失败，可能是邮箱无效或达到了每日注册上限，如有问题可联系管理员解决"},100003:{zh:"验证码错误或已过期，请重新获取"},100004:{zh:"注册用户失败，可能存在同名用户"},100005:{zh:"用户名不存在，或您未在本系统绑定邮箱，请联系管理员寻求帮助"},100006:{zh:"验证码错误或已过期，请重新获取"},100007:{zh:"已存在相同标题的题目"},100008:{zh:"已存在相同标题的比赛"},100009:{zh:"已存在相同标题的题集"},100010:{zh:"未发现有效题目"},100011:{zh:"题目数量超过限制，无法添加"}})})}function oe(){const{appContext:e}=ga();return{globalProperties:e.config.globalProperties}}function Te(){return 1e3}function Ne(e,a,n=3e3){e.$message.success({duration:n,content:a})}function _e(e,a,n=3e3){e.$message.info({duration:n,content:a})}function ce(e,a,n=3e3){e.$message.error({duration:n,content:a})}function B(e,a,n=3e3){const[r,o]=wl(a),c=r?o:`系统错误，错误提示[${o}]`;e.$message.error({duration:n,content:c})}function Cl(e,a){return e.length<=a?e:e.slice(0,a)+"..."}function ea(e){return e.trim().split(/\s+/).flatMap(r=>r.split(",")).filter(r=>r.trim()!=="")}const Sl="https://oj-api.didapipa.com/",W=qt.create({baseURL:Sl,timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});W.interceptors.request.use(e=>{const n=Se().getToken;return n&&(e.headers["X-Token"]=n),e},e=>Promise.reject(e));W.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function Il(e){const a={};return a.id=e.id,a.username=e.username,a.nickname=e.nickname,a.email=e.email,a.slogan=e.slogan,a.organization=e.organization,a.accept=e.accept,a.attempt=e.attempt,a.vjudgeId=e.vjudge_id,e.email&&(a.avatar=`https://www.gravatar.com/avatar/${ba(e.email.toLowerCase().trim())}?d=identicon&s=100`),a}function Pl(e,a){return W({url:"/user/login",method:"post",data:{username:e,password:a}})}function Tl(){return W({url:"/user/login/refresh",method:"post"})}function xl(e){const a={username:e};return W({url:`/user/info?${new URLSearchParams(a).toString()}`,method:"get"})}function Vl(e){const a="https://vjudge.net/user/solveDetail/"+encodeURIComponent(e);return Je({url:a,method:"get"})}function Ll(e){return W({url:"/user/account/infos",method:"post",data:{users:e}})}function jl(e){return W({url:"/user/parse",method:"post",data:{users:e}})}function Dl(e,a){return W({url:"/user/register/email",method:"post",data:{token:e,email:a}})}function $l(e,a,n,r,o){return W({url:"/user/register",method:"post",data:{username:e,password:a,email:n,key:r,nickname:o}})}function zl(e,a){return W({url:"/user/forget",method:"post",data:{token:e,username:a}})}function Ul(e,a,n){return W({url:"/user/password/modify",method:"post",data:{username:e,password:a,key:n}})}const Al={class:"dida-login-footer"},Rl=Q({__name:"LoginView",setup(e){const{globalProperties:a}=oe(),n=Se(),r=v(!1),o=v({username:"",password:""}),c=()=>{_e(a,"重置成功")},g=({validateResult:y,firstError:P})=>{r.value||(r.value=!0,Pl(o.value.username,o.value.password).then(b=>{if(b.code===0){n.loadResponse(b.data),_e(a,"登录成功");let d=a.$route.query.redirect_uri;d||(d="/user/"+b.data.username),a.$router.push({path:d})}else B(a,b.code)}).catch(b=>{console.error("Login error",b),ce(a,"登录失败")}).finally(()=>{r.value=!1}))};return le(()=>{if(n.isLogin()){a.$router.push({path:"/user"});return}}),(y,P)=>{const b=De,d=je,f=G,u=Le,_=He,m=se;return D(),M(m,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:l(()=>[t(u,{ref:"form",data:o.value,colon:!0,onReset:c,onSubmit:g,class:"yj-login-form","label-width":0},{default:l(()=>[t(d,{name:"username"},{default:l(()=>[t(b,{modelValue:o.value.username,"onUpdate:modelValue":P[0]||(P[0]=s=>o.value.username=s),clearable:"",placeholder:"请输入用户名"},{"prefix-icon":l(()=>[t(de(ha))]),_:1},8,["modelValue"])]),_:1}),t(d,{name:"password"},{default:l(()=>[t(b,{modelValue:o.value.password,"onUpdate:modelValue":P[1]||(P[1]=s=>o.value.password=s),type:"password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":l(()=>[t(de(ya))]),_:1},8,["modelValue"])]),_:1}),t(d,null,{default:l(()=>[t(f,{theme:"primary",type:"submit",block:"",loading:r.value},{default:l(()=>P[4]||(P[4]=[L("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),A("div",Al,[t(_,{onClick:P[2]||(P[2]=()=>{de(a).$router.push({name:"login-forget"})})},{default:l(()=>P[5]||(P[5]=[L("忘记密码")])),_:1}),t(_,{onClick:P[3]||(P[3]=()=>{de(a).$router.push({name:"register"})})},{default:l(()=>P[6]||(P[6]=[L("注册账户")])),_:1})])]),_:1})}}}),El=ee(Rl,[["__scopeId","data-v-be6a0deb"]]),Kl={class:"dida-login-footer"},ql=Q({__name:"RegisterView",setup(e){const{globalProperties:a}=oe(),n=Se(),r=v(!1),o=v(!1),c=v(!1),g=v("发送验证码");let y=null,P=-1;const b=v(!1),d=v(null),f=v({username:"",password:"",confirmPassword:"",nickname:"",email:"",emailKey:""}),_=v({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:h=>new Promise(i=>{const V=setTimeout(()=>{i(f.value.password===h),clearTimeout(V)})}),message:"两次密码不一致"}],nickname:[{required:!0,message:"请填写昵称"},{min:1,message:"昵称至少1个字符"},{max:30,message:"昵称最多30个字符"}],email:[{required:!0,message:"请填写邮箱"},{pattern:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"邮箱格式不正确"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),m=v(()=>t(G,{onClick:s,disabled:c.value,loading:o.value,style:"width:120px"},{default:()=>[g.value]})),s=async()=>{var w;if(!f.value.email){ce(a,"请输入邮箱");return}if(!f.value.email.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)){ce(a,"邮箱格式不正确");return}if(c.value||o.value)return;b.value=!0,await ze();const h=document.getElementById("cf-confirm-div");h&&h.remove();const i=document.createElement("div");i.id="cf-confirm-div",i.setAttribute("data-theme","light"),(w=d.value)==null||w.appendChild(i);const V=window;V.turnstile.ready(function(){V.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(U){b.value=!1,await p(U)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},p=async h=>{if(!c.value){o.value=!0;try{const i=await Dl(h,f.value.email);if(i.code!==0){B(a,i.code);return}_e(a,"发送验证码成功"),o.value=!1,c.value=!0,y=new Date,g.value="60秒后重发",P=setInterval(()=>{const w=Math.floor((new Date().getTime()-(y==null?void 0:y.getTime()))/1e3);w>60?(g.value="发送验证码",c.value=!1,clearInterval(P)):g.value=`${60-w}秒后重发`},1e3)}catch{ce(a,"发送验证码失败")}finally{o.value=!1}}},k=()=>{_e(a,"重置成功")},I=({validateResult:h,firstError:i,e:V})=>{if(!r.value){if(V.preventDefault(),h!==!0){ce(a,i);return}if(f.value.password!==f.value.confirmPassword){ce(a,"两次密码不一致");return}r.value=!0,$l(f.value.username,f.value.password,f.value.email,f.value.emailKey,f.value.nickname).then(w=>{w.code===0?(_e(a,"注册成功，可使用账号信息登录"),a.$router.push({name:"login"})):B(a,w.code)}).catch(w=>{console.error("Login error",w),ce(a,"登录失败")}).finally(()=>{r.value=!1})}};return le(()=>{if(n.isLogin()){a.$router.push({path:"/user"});return}}),Ie(()=>{clearInterval(P)}),(h,i)=>{const V=De,w=je,U=Ot,j=G,$=Le,T=He,S=se,E=Me;return D(),Y(Z,null,[t(S,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:l(()=>[t($,{ref:"form",rules:_.value,data:f.value,colon:!0,onReset:k,onSubmit:I,class:"yj-login-form"},{default:l(()=>[t(w,{name:"username",label:"用户名"},{default:l(()=>[t(V,{modelValue:f.value.username,"onUpdate:modelValue":i[0]||(i[0]=z=>f.value.username=z),clearable:"",placeholder:"用于登录与查找"},null,8,["modelValue"])]),_:1}),t(w,{name:"password",label:"密码"},{default:l(()=>[t(V,{modelValue:f.value.password,"onUpdate:modelValue":i[1]||(i[1]=z=>f.value.password=z),type:"password",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(w,{name:"confirmPassword",label:"确认密码"},{default:l(()=>[t(V,{modelValue:f.value.confirmPassword,"onUpdate:modelValue":i[2]||(i[2]=z=>f.value.confirmPassword=z),type:"password",clearable:"",placeholder:"请确认密码"},null,8,["modelValue"])]),_:1}),t(w,{name:"nickname",label:"昵称"},{default:l(()=>[t(V,{modelValue:f.value.nickname,"onUpdate:modelValue":i[3]||(i[3]=z=>f.value.nickname=z),clearable:"",placeholder:"用于优先在网站各处展示"},null,8,["modelValue"])]),_:1}),t(w,{name:"email",label:"邮箱"},{default:l(()=>[t(V,{modelValue:f.value.email,"onUpdate:modelValue":i[4]||(i[4]=z=>f.value.email=z),clearable:"",placeholder:"请填写常用邮箱"},null,8,["modelValue"])]),_:1}),t(w,{name:"emailKey",label:"验证码"},{default:l(()=>[t(U,{append:m.value},{default:l(()=>[t(V,{modelValue:f.value.emailKey,"onUpdate:modelValue":i[5]||(i[5]=z=>f.value.emailKey=z),clearable:"",placeholder:"请输入验证码",style:{width:"140px"}},null,8,["modelValue"])]),_:1},8,["append"])]),_:1}),t(w,null,{default:l(()=>[t(j,{theme:"primary",type:"submit",block:"",loading:r.value},{default:l(()=>i[8]||(i[8]=[L("注册")])),_:1},8,["loading"])]),_:1})]),_:1},8,["rules","data"]),A("div",Kl,[t(T,{onClick:i[6]||(i[6]=()=>{de(a).$router.push({name:"login"})})},{default:l(()=>i[9]||(i[9]=[L("返回登陆 ")])),_:1})])]),_:1}),t(E,{visible:b.value,"onUpdate:visible":i[7]||(i[7]=z=>b.value=z),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:l(()=>[A("div",{ref_key:"dialogContainer",ref:d,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),Ml=ee(ql,[["__scopeId","data-v-9b5f4fc7"]]),Fl={key:0,style:{margin:"10px"}},Nl={key:1,style:{margin:"10px"}},Gl={style:{margin:"12px"}},Ol=Q({__name:"UserView",setup(e){let a=ie();const{globalProperties:n}=oe(),r=Ue();let o="";const c=v(!1),g=v(null),y=v([]),P=v([]),b=v([]),d=async f=>{c.value=!0;try{let u=await xl(f);if(u.code!==0){c.value=!1,B(n,u.code),await J.push({name:"home"});return}if(g.value=Il(u.data.user),y.value=u.data.problems_ac,r.setTitle(g.value.nickname+" - "+r.getTitle),g.value.vjudgeId){const _=await Vl(g.value.vjudgeId);P.value=_.acRecords;for(const m in P.value)P.value[m].sort((s,p)=>s.length===p.length?s.localeCompare(p):s.length-p.length);b.value=_.failRecords;for(const m in b.value)b.value[m].sort((s,p)=>s.length===p.length?s.localeCompare(p):s.length-p.length)}}catch{ce(n,"获取用户信息失败"),await J.push({name:"home"})}finally{c.value=!1}};return wa(async(f,u,_)=>{if(Array.isArray(f.params.username)?o=f.params.username[0]:o=f.params.username,!o){await J.push({name:"home"});return}await d(o),_()}),le(async()=>{if(Array.isArray(a.params.username)?o=a.params.username[0]:o=a.params.username,!o){await J.push({name:"home"});return}await d(o)}),(f,u)=>{const _=G,m=pe,s=se,p=He,k=Ke,I=Ee,h=be,i=Aa,V=ve,w=we;return D(),M(w,{loading:c.value},{default:l(()=>[t(V,{class:"dida-main-content"},{default:l(()=>[t(h,{span:8},{default:l(()=>{var U;return[t(s,{style:{margin:"10px"},title:"AC题目"},{default:l(()=>[t(m,{style:{"flex-wrap":"wrap"}},{default:l(()=>[(D(!0),Y(Z,null,me(y.value,j=>(D(),M(_,{key:j,size:"small",onClick:()=>de(J).push({name:"problem-detail",params:{problemId:j}})},{default:l(()=>[L(q(j),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),(U=g.value)!=null&&U.vjudgeId?(D(),M(s,{key:0,style:{margin:"10px"},title:"vjudge.net"},{actions:l(()=>{var j;return[t(p,{href:"https://vjudge.net/user/"+((j=g.value)==null?void 0:j.vjudgeId),target:"_blank"},{default:l(()=>{var $;return[L("@"+q(($=g.value)==null?void 0:$.vjudgeId),1)]}),_:1},8,["href"])]}),default:l(()=>[P.value&&Object.keys(P.value).length>0?(D(),Y("div",Fl,[u[0]||(u[0]=A("div",{style:{margin:"5px"}},[A("span",null,"AC")],-1)),t(I,{layout:"vertical",bordered:!0},{default:l(()=>[(D(!0),Y(Z,null,me(P.value,(j,$)=>(D(),M(k,{key:$,label:$},{default:l(()=>[t(m,{style:{"flex-wrap":"wrap"}},{default:l(()=>[(D(!0),Y(Z,null,me(j,T=>(D(),M(_,{key:T,size:"small",onClick:()=>de(J).push({name:"problem-detail",params:{problemId:$+"-"+T}})},{default:l(()=>[L(q(T),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):te("",!0),b.value&&Object.keys(b.value).length>0?(D(),Y("div",Nl,[u[1]||(u[1]=A("div",{style:{margin:"5px"}},[A("span",null,"Fail")],-1)),t(I,{layout:"vertical",bordered:!0},{default:l(()=>[(D(!0),Y(Z,null,me(b.value,(j,$)=>(D(),M(k,{key:$,label:$},{default:l(()=>[t(m,{style:{"flex-wrap":"wrap"}},{default:l(()=>[(D(!0),Y(Z,null,me(j,T=>(D(),M(_,{key:T,size:"small",onClick:()=>de(J).push({name:"problem-detail",params:{problemId:$+"-"+T}})},{default:l(()=>[L(q(T),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):te("",!0)]),_:1})):te("",!0)]}),_:1}),t(h,{span:4},{default:l(()=>[A("div",Gl,[t(I,{layout:"vertical",bordered:!0},{default:l(()=>[t(k,{label:"头像"},{default:l(()=>{var U;return[t(i,{shape:"round",size:"100px",image:(U=g.value)==null?void 0:U.avatar,"hide-on-load-failed":!1},null,8,["image"])]}),_:1}),t(k,{label:"昵称"},{default:l(()=>{var U;return[L(q((U=g.value)==null?void 0:U.nickname),1)]}),_:1}),t(k,{label:"Slogan"},{default:l(()=>{var U;return[L(q((U=g.value)==null?void 0:U.slogan),1)]}),_:1}),t(k,{label:"邮箱"},{default:l(()=>{var U;return[L(q((U=g.value)==null?void 0:U.email),1)]}),_:1}),t(k,{label:"组织"},{default:l(()=>{var U;return[L(q((U=g.value)==null?void 0:U.organization),1)]}),_:1}),t(k,{label:"通过数量"},{default:l(()=>{var U;return[L(q((U=g.value)==null?void 0:U.accept),1)]}),_:1}),t(k,{label:"提交数量"},{default:l(()=>{var U;return[L(q((U=g.value)==null?void 0:U.attempt),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Hl=ee(Ol,[["__scopeId","data-v-555e19aa"]]),yt=[{name:"home",path:"/",title:"首页",showSidebar:!1,disableGenerateTab:!0,component:gl},{name:"problem",path:"/problem",title:"题目",icon:"calculation",showSidebar:!0,redirect:"problem-list"},{name:"collection-detail-tab",title:"题集",path:"/collection",showSidebar:!0,disableGenerateTab:!0,redirect:"problem-collection-list"},{name:"judge",path:"/judge",title:"评测",icon:"code",showSidebar:!0,redirect:"judge-list"},{name:"contest",path:"/contest",title:"比赛",icon:"application",showSidebar:!0,redirect:"contest-list"},{name:"contest-detail-tab",title:"比赛",path:"/contest",showSidebar:!0,disableGenerateTab:!0,redirect:"contest-list"},{name:"discuss",title:"讨论",path:"/discuss",icon:"sonic",showSidebar:!0,redirect:"discuss-list"},{name:"rank",path:"/rank",title:"排名",icon:"chart-column",showSidebar:!0,redirect:"rank-ac-all"},{name:"tool",path:"/tool",title:"工具",icon:"tools",showSidebar:!0,redirect:"tool-paste"},{name:"system",path:"/system",title:"系统",icon:"dashboard",showSidebar:!0,redirect:"system-status"},{name:"manage",path:"/manage",title:"管理",icon:"command",showSidebar:!0,redirect:"manage-judge",auths:[$e.Manage]},{name:"login",path:"/login",title:"登陆",showSidebar:!1,disableGenerateTab:!0,component:El},{name:"register",path:"/register",title:"注册",showSidebar:!1,disableGenerateTab:!0,component:Ml},{name:"user",path:"/user/:username+",title:"用户",showSidebar:!1,needLogin:!0,disableGenerateTab:!0,component:Hl},{name:"404",path:"/404",title:"404",showSidebar:!1,disableGenerateTab:!0,component:Qt}],Bl=e=>yt.find(a=>a.name==e),Jl=e=>{const a=[];return yt.forEach(n=>{!n.disableGenerateTab&&e.hasAllAuths(n.auths)&&a.push(n)}),a},Wl=e=>{yt.forEach(a=>{const n={name:a.name,path:a.path,meta:{title:a.title,tab:a.name,showSidebar:a.showSidebar,needLogin:a.needLogin,redirect:a.redirect,tabAuths:a.auths},component:a.component};e.push(n)})};function ta(e){return e.children!==void 0}function Yl(e){return e.children!==void 0}var wt=(e=>(e[e.Unknown=-1]="Unknown",e[e.C=0]="C",e[e.Cpp=1]="Cpp",e[e.Java=2]="Java",e[e.Python=3]="Python",e[e.Pascal=4]="Pascal",e[e.Golang=5]="Golang",e[e.Lua=6]="Lua",e[e.TypeScript=7]="TypeScript",e[e.Max=8]="Max",e))(wt||{});function kt(){const e=[-1,8];return Object.values(wt).filter(a=>typeof a=="number"&&!e.includes(a)).map(a=>({value:a,label:aa(a)}))}function Xl(e){return e>-1&&e<8}function aa(e){switch(e){case 0:return"C";case 1:return"C++";case 2:return"Java";case 3:return"Python";case 4:return"Pascal";case 5:return"Golang";case 6:return"Lua";case 7:return"TypeScript";default:return"Unknown"}}function Ct(e){switch(e){case 0:return"c";case 1:return"cpp";case 2:return"java";case 3:return"python";case 4:return"pascal";case 5:return"go";case 6:return"lua";case 7:return"typescript";default:return"text"}}var Pe=(e=>(e[e.Init=0]="Init",e[e.Rejudge=1]="Rejudge",e[e.Submitting=2]="Submitting",e[e.Queuing=3]="Queuing",e[e.Compiling=4]="Compiling",e[e.Running=5]="Running",e[e.Accept=6]="Accept",e[e.PE=7]="PE",e[e.WA=8]="WA",e[e.TLE=9]="TLE",e[e.MLE=10]="MLE",e[e.OLE=11]="OLE",e[e.RE=12]="RE",e[e.CE=13]="CE",e[e.CLE=14]="CLE",e[e.JudgeFail=15]="JudgeFail",e[e.SubmitFail=16]="SubmitFail",e[e.Unknown=17]="Unknown",e[e.Max=18]="Max",e))(Pe||{});const Zl=e=>{switch(e){case 0:return"普通评测";case 1:return"特殊评测";default:return"未知"}},ot=e=>{switch(e){case 0:return"等待处理";case 1:return"重新评测";case 2:return"提交中";case 3:return"队列中";case 4:return"编译中";case 5:return"运行中";case 6:return"通过";case 7:return"格式错误";case 8:return"答案错误";case 9:return"超时";case 10:return"内存超限";case 11:return"输出超限";case 12:return"运行错误";case 13:return"编译错误";case 14:return"编译超限";case 15:return"评测失败";case 16:return"提交失败";case 17:return"未知";default:return e}},la=e=>{switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return"default";case 6:return"success";case 7:return"warning";default:return"danger"}};function na(){const e=[17,18];return Object.values(Pe).filter(a=>typeof a=="number"&&!e.includes(a)).map(a=>({value:a,label:ot(a)}))}function Be(e){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return!0;default:return!1}}function oa(e){var n;const a={};if(a.id=e.id,a.problemId=e.problem_id,a.contestProblemIndex=e.contest_problem_index,a.status=e.status,Be(e.status)?a.score="-":a.score=e.score.toString(),e.time?a.time=Math.ceil(e.time/1e6)+"ms":a.time="-",e.memory?a.memory=(e.memory/1024/1024).toFixed(2)+"MB":a.memory="-",a.language=aa(e.language),a.codeLength=e.code_length,e.approve_time?a.approveTime=new Date(e.approve_time).toLocaleString():a.approveTime="-",a.author=e.author,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.code=e.code,a.compileMessage=e.compile_message,a.taskCurrent=e.task_current,a.taskTotal=e.task_total,a.task=[],e.task)for(let r=0;r<((n=e.task)==null?void 0:n.length);r++){const o=e.task[r],c={};c.taskId=o.task_id,c.status=o.status,o.time?c.time=Math.ceil(o.time/1e6)+"ms":c.time="-",o.memory?c.memory=(o.memory/1024/1024).toFixed(2)+"MB":c.memory="-",c.score=o.score,c.content=o.content,c.waHint=o.wa_hint,!c.content&&!c.waHint&&(c.content="无提示信息"),a.task.push(c)}return e.judger&&(a.judger=e.judger),e.judge_time&&(a.judgeTime=new Date(e.judge_time).toLocaleString()),a}function Ql(e,a,n,r,o){return W({url:"/judge/approve",method:"post",data:{problem_id:e,contest_id:a,problem_index:n,language:r,code:o}})}function en(e){return W({url:"/judge?id="+e,method:"get"})}function tn(e){return W({url:"/judge/code?id="+e,method:"get"})}function an(e,a,n,r,o,c,g){const y=new URLSearchParams({contest_id:String(e),problem_id:a,username:n,language:String(r),status:String(o),page:String(c),page_size:String(g)});return W({url:`/judge/list?${y.toString()}`,method:"get"})}function ln(){return W({url:"/judge/rejudge/recently",method:"post"})}function nn(e,a,n){const r={};return e!=null&&(r.problem_id=e),a!=null?r.language=a:r.language=wt.Unknown,n!=null?r.status=n:r.status=18,W({url:"/judge/rejudge/search",method:"post",data:r})}function on(){return W({url:"/judge/rejudge/all",method:"post",timeout:0})}function sn(e){return W({url:"/judge/rejudge",method:"post",data:{id:Number(e)}})}var Xe=(e=>(e[e.None=0]="None",e[e.Attempt=1]="Attempt",e[e.Accept=2]="Accept",e))(Xe||{});function Ze(e,a){const n={};if(n.id=e.id,n.author=e.author,n.title=e.title,n.tags=[],e.tags)for(const r of e.tags){const o=a[r];o&&n.tags.push(o)}if(n.private=e.private,n.accept=e.accept,n.attempt=e.attempt,e.description!=null&&(n.description=e.description),e.time_limit!=null&&e.time_limit>=0?n.timeLimit=e.time_limit.toString()+" ms":n.timeLimit="未知",e.memory_limit!=null&&e.memory_limit>=0?n.memoryLimit=(e.memory_limit/1024).toFixed(2)+" MB":n.memoryLimit="未知",e.judge_type!=null&&(n.judgeType=Zl(e.judge_type)),e.insert_time!=null&&(n.insertTime=new Date(e.insert_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.source!=null){const r=/\[([^\]]+)\]\(([^)]+)\)/,o=e.source.match(r);o?(n.source=o[1],n.sourceUrl=o[2]):(n.source=e.source,n.sourceUrl="")}return e.judge_md5!=null&&(n.judgeMd5=e.judge_md5),e.origin_oj!=null&&(n.originOj=e.origin_oj),e.origin_id!=null&&(n.originId=e.origin_id),e.origin_url!=null&&(n.originUrl=e.origin_url),n}function sa(e,a,n){const r={};return e?r.id=e:(r.contest_id=a,r.problem_index=n),W({url:`/problem?${new URLSearchParams(r).toString()}`,method:"get"})}function ra(e){return W({url:"/problem/tag/list?max_count="+e,method:"get"})}function rn(e){return W({url:"/problem/judge?id="+e,method:"get"})}function un(e,a,n,r,o,c){const g={};return e&&(g.oj=e),a&&(g.title=a),n&&(g.tag=n),r!==void 0&&(g.private=r?"1":"0"),o&&(g.page=o),c&&(g.page_size=c),W({url:`/problem/list?${new URLSearchParams(g).toString()}`,method:"get"})}function cn(e){const a={};return e&&(a.problem_id=e),W({url:`/problem/recommend?${new URLSearchParams(a).toString()}`,method:"get"})}function ia(e,a){return W({url:"/problem/crawl",method:"post",data:{oj:e,id:a}})}function dn(e,a,n,r,o,c,g){return W({url:"/problem/create",method:"post",data:{title:e,time_limit:a,memory_limit:n,source:r,private:o,tags:c,description:g}})}function mn(e,a,n,r,o,c,g,y){return W({url:"/problem/edit",method:"post",data:{id:e,title:a,time_limit:n,memory_limit:r,source:o,private:c,tags:g,description:y}})}function pn(e,a){return W({url:"/problem/judge/data/download?id="+e+"&key="+a,method:"get"})}function fn(e,a){const n=new FormData;return n.append("id",e),n.append("zip",a),W({url:"/problem/judge/data",method:"post",data:n,headers:{"Content-Type":"multipart/form-data"},timeout:1e3*60*5})}function _n(e){return W({url:"/problem/parse",method:"post",data:{problems:e}})}const vn={style:{margin:"10px"}},gn={key:0,class:"dida-operation-container"};function bn(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!qe(e)}const hn=Q({__name:"ProblemList",setup(e){const a=ie(),n=Re(),{globalProperties:r}=oe(),o=Se();let c=null;const g=v(!1),y={};let P={};const b=v(!1),d=Ae(()=>o.hasAuth($e.ManageProblem)),f=v([{title:"ID",colKey:"id",cell:(z,C)=>{let x=w(C.row.id);return t(G,{variant:"dashed",theme:x,onClick:()=>V(C.row.id)},{default:()=>[C.row.id]})}},{title:"标题",colKey:"title",cell:(z,C)=>t(G,{variant:"text",onClick:()=>V(C.row.id)},{default:()=>[C.row.title]})},{title:"标签",colKey:"tags",cell:(z,C)=>{const x=C.row.tags;if(!x||x.length===0)return"";let R=[];for(let O=0;O<x.length;O++){const N=x[O];R.push(t(G,{key:O,theme:"default",variant:"outline",size:"small",onClick:()=>$(N)},{default:()=>[N.name]}))}return t(pe,null,bn(R)?R:{default:()=>[R]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),u=v(!1);let _=1,m=50;const s=v({current:_,pageSize:m,defaultCurrent:_,defaultPageSize:m,total:0,pageSizeOptions:[50,100]}),p=v(),k=v(),I=[{label:"DidaOJ",value:"didaoj"},{label:"HDU",value:"hdu"},{label:"POJ",value:"poj"},{label:"NYOJ",value:"nyoj"}],h=v({oj:"",title:"",tag:"",private:!1}),i=v({oj:"",problem:""}),V=z=>{z&&n.push({path:"/problem/"+z})},w=z=>{if(!z||!P)return"default";const C=P[z];if(!C)return"default";switch(C){case Xe.Accept:return"success";case Xe.Attempt:return"warning";default:return"default"}},U=async()=>{await n.push({query:{...a.query,oj:h.value.oj,title:h.value.title,tag:h.value.tag,private:h.value.private?"1":"0",page:1,page_size:s.value.defaultPageSize}})},j=async()=>{try{b.value=!0;const z=await ia(i.value.oj,i.value.problem);z.code===0?(_e(r,"搜索成功"),await n.push({name:"problem-detail",params:{problemId:z.data}})):B(r,z.code)}catch(z){console.error(z),B(r,Te())}finally{b.value=!1}},$=z=>{z&&n.push({query:{...a.query,title:"",tag:z.name,page:1,page_size:s.value.defaultPageSize}})},T=()=>{n.push({name:"manage-problem-create"})},S=async(z,C)=>{u.value=!0;try{const{current:x,pageSize:R}=z,O=await un(h.value.oj,h.value.title,h.value.tag,h.value.private,x,R);if(p.value=[],O.code===0){const N=O.data.list;if(!N||N.length<=0){s.value={...s.value,total:0},P={},_e(r,"未找到记录");return}N.forEach(X=>{var ne;const K=Ze(X,y);(ne=p.value)==null||ne.push(K)}),s.value={...s.value,total:O.data.total_count},P=O.data.problem_attempt_status}else C&&B(r,O.code)}catch(x){console.error(x),B(r,Te())}finally{u.value=!1}},E=async z=>{await n.push({query:{...a.query,page:z.current,page_size:z.pageSize}})};return le(async()=>{u.value=!0,k.value=[],ra(-1).then(z=>{if(z.code===0){k.value=z.data.list,g.value=z.data.total_count>z.data.list.length;for(let C=0;C<z.data.list.length;C++){const x=z.data.list[C];y[x.id]=x}c=xe(()=>a.query,C=>{h.value.oj=C.oj||"",h.value.title=C.title||"",h.value.tag=C.tag||"",h.value.private=C.private==="1";const x=parseInt(C.page)||s.value.defaultCurrent,R=parseInt(C.page_size)||s.value.defaultPageSize;_=x,m=R,s.value={...s.value,current:_,pageSize:m},S({current:_,pageSize:m},!0)},{immediate:!0})}else g.value=!0}).catch(z=>{console.error(z),g.value=!0})}),Ie(()=>{c&&c()}),(z,C)=>{const x=ke,R=se,O=be,N=G,X=pe,K=rt,ne=je,H=De,ge=it,Ve=Le,fe=ve;return D(),M(fe,null,{default:l(()=>[t(O,{span:9},{default:l(()=>[t(R,{style:{margin:"10px"}},{default:l(()=>[t(x,{data:p.value,columns:f.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:s.value,"table-layout":"auto",loading:u.value,onPageChange:E},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(O,{span:3},{default:l(()=>[A("div",vn,[d.value?(D(),Y("div",gn,[t(X,null,{default:l(()=>[t(N,{onClick:T},{default:l(()=>C[7]||(C[7]=[L("新建")])),_:1})]),_:1})])):te("",!0),t(R,{class:"sh-card"},{default:l(()=>[t(Ve,{model:h.value,onSubmit:U},{default:l(()=>[t(ne,{label:"OJ"},{default:l(()=>[t(K,{modelValue:h.value.oj,"onUpdate:modelValue":C[0]||(C[0]=ae=>h.value.oj=ae),options:I,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(ne,{label:"标题"},{default:l(()=>[t(H,{modelValue:h.value.title,"onUpdate:modelValue":C[1]||(C[1]=ae=>h.value.title=ae),placeholder:"请输入关键词"},null,8,["modelValue"])]),_:1}),t(ne,{label:"标签"},{default:l(()=>[t(H,{modelValue:h.value.tag,"onUpdate:modelValue":C[2]||(C[2]=ae=>h.value.tag=ae),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),d.value?(D(),M(ne,{key:0,label:"私有"},{default:l(()=>[t(ge,{modelValue:h.value.private,"onUpdate:modelValue":C[3]||(C[3]=ae=>h.value.private=ae)},null,8,["modelValue"])]),_:1})):te("",!0),t(ne,null,{default:l(()=>[t(N,{theme:"primary",type:"submit"},{default:l(()=>C[8]||(C[8]=[L("搜索")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(R,{class:"sh-card"},{default:l(()=>[t(Ve,{model:i.value,onSubmit:j},{default:l(()=>[t(ne,{label:"OJ"},{default:l(()=>[t(K,{modelValue:i.value.oj,"onUpdate:modelValue":C[4]||(C[4]=ae=>i.value.oj=ae),options:I,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(ne,{label:"题目"},{default:l(()=>[t(H,{modelValue:i.value.problem,"onUpdate:modelValue":C[5]||(C[5]=ae=>i.value.problem=ae),placeholder:"请输入原始题号"},null,8,["modelValue"])]),_:1}),t(ne,null,{default:l(()=>[t(N,{theme:"primary",type:"submit",loading:b.value},{default:l(()=>C[9]||(C[9]=[L("前往")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),t(R,{class:"sh-card sh-background-black"},{default:l(()=>[(D(!0),Y(Z,null,me(k.value,ae=>(D(),M(N,{class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:()=>$(ae)},{default:l(()=>[L(q(ae.name),1)]),_:2},1032,["onClick"]))),256)),g.value?(D(),M(N,{key:0,class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:C[6]||(C[6]=()=>z.$router.push("/problem/tags"))},{default:l(()=>C[10]||(C[10]=[L(" ... ")])),_:1})):te("",!0)]),_:1})])]),_:1})]),_:1})}}}),yn=ee(hn,[["__scopeId","data-v-bc7185f5"]]);function Ge(e){e.querySelectorAll("pre > code:not([data-copy-attached])").forEach(n=>{n.setAttribute("data-copy-attached","true");const r=n.parentElement,o=document.createElement("div");o.className="copy-wrapper";const c=document.createElement("button");c.className="copy-btn",c.innerText="复制",c.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(n.innerText),c.innerText="已复制",setTimeout(()=>c.innerText="复制",1500)}catch{c.innerText="失败"}}),r.replaceWith(o),o.appendChild(c),o.appendChild(r)})}function Oe(e){let a="";for(;e>0;)e--,a=String.fromCharCode(65+e%26)+a,e=Math.floor(e/26);return a}async function St(e){const a={};a.id=e.id,a.ownerId=e.owner_id,a.ownerUsername=e.owner_username,a.ownerNickname=e.owner_nickname,a.title=e.title,a.startTime=new Date(e.start_time).toLocaleString(),a.endTime=new Date(e.end_time).toLocaleString(),a.createTime=new Date(e.create_time).toLocaleString(),a.updateTime=new Date(e.update_time).toLocaleString();const n={math:{inlineDigit:!0,engine:"KaTeX"}};if(a.description=await re.md2html(e.description,n),a.notification=e.notification,e.problems){a.problems=[],e.problems.sort((r,o)=>r.index-o.index);for(let r=0;r<e.problems.length;r++){const o=e.problems[r];let c={accept:0,attempt:0,author:"",id:"",private:!1,tags:[],title:""};c.id=Oe(o.index),c.title=o.title,o.accept?c.accept=o.accept:c.accept=0,o.attempt?c.attempt=o.attempt:c.attempt=0,a.problems.push(c)}}return a}function wn(e){return W({url:"/contest?id="+e,method:"get"})}function kn(e){return W({url:"/contest/edit?id="+e,method:"get"})}function Cn(e,a){return W({url:"/contest/list?page="+e+"&page_size="+a,method:"get"})}function Sn(e){return W({url:"/contest/rank?id="+e,method:"get"})}function In(e){return W({url:"/contest/create",method:"post",data:e})}function Pn(e){return W({url:"/contest/edit",method:"post",data:e})}const Tn=["innerHTML"],xn={style:{margin:"12px"}},Vn={key:1},Ln={class:"dida-operation-container"},jn={class:"dida-operation-container"},Dn={class:"dida-code-submit-div"},$n=Q({__name:"ProblemDetail",setup(e){let a=ie();const{globalProperties:n}=oe(),r=Ue(),o=Se();let c=v(""),g="",y=0,P=0;const b=v(!1),d=v(null),f=v(!1),u=v(null);let _=null;const m=v(null),s=v(!1),p=v(!1),k={},I=v(""),h=v([]);h.value=kt();const i=Ae(()=>o.hasAuth($e.ManageProblem)),V=C=>{C&&J.push({name:"problem-list",query:{...a.query,title:"",tag:C.name}})},w=()=>{J.push({name:"manage-problem",params:{problemId:g}})},U=()=>{g?J.push({name:"judge-list",query:{problem_id:g}}):J.push({name:"contest-judge",params:{contestId:y},query:{problem_id:Oe(P)}})},j=()=>{g?J.push({name:"discuss-list-problem",query:{problem_id:g}}):J.push({name:"contest-discuss",params:{contestId:y},query:{problem_id:Oe(P)}})},$=()=>{J.push({name:"problem-recommend",params:{problemId:g}})},T=async()=>{var R,O;const C=(R=u.value)==null?void 0:R.originOj,x=(O=u.value)==null?void 0:O.originId;if(!(!C||!x))try{s.value=!0;const N=await ia(C,x);N.code===0?(await z(),_e(n,"更新成功")):B(n,N.code)}catch{ce(n,"更新失败，请稍后再试")}finally{s.value=!1}},S=async()=>{if(!g){ce(n,"问题ID无效");return}const C=parseInt(I.value);if(!Xl(C)){ce(n,"请选择所编写的语言");return}const x=_==null?void 0:_.getValue();if(!x){ce(n,"请输入所需提交的代码");return}p.value=!0;try{const R=await Ql(g,y,P,C,x);if(R.code!==0){B(n,R.code);return}_e(n,"提交成功，正在跳转到详情页面");const O=R.data.id;await J.push({path:"/judge/"+O})}finally{p.value=!1}},E=C=>{if(!_)return;const x=_.getModel();x&&Tt.setModelLanguage(x,Ct(C))},z=async()=>{let C=await sa(g,y,P);if(C.code!==0){f.value=!1,B(n,C.code),await J.push({name:"problem"});return}C.data.tags&&C.data.tags.forEach(O=>{k[O.id]=O}),u.value=Ze(C.data.problem,k),r.setTitle(u.value.title+" - "+r.getTitle);let x=u.value.description;const R={math:{inlineDigit:!0,engine:"KaTeX"}};c.value=await re.md2html(x,R),await ze(()=>{d.value&&(re.mathRender(d.value),re.highlightRender({lineNumber:!0,enable:!0},d.value),Ge(d.value),!_&&m.value&&(_=Tt.create(m.value,{value:"",language:"cpp",minimap:{enabled:!0},colorDecorators:!0,readOnly:!1,theme:"vs-dark"}))),f.value=!1})};return le(async()=>{if(Array.isArray(a.params.problemId)?g=a.params.problemId[0]:g=a.params.problemId,!g){if(Array.isArray(a.params.contestId)?y=Number(a.params.contestId[0]):y=Number(a.params.contestId),!y){ce(n,"题目不存在"),await J.push({name:"problem"});return}if(Array.isArray(a.params.problemIndex)?P=parseInt(a.params.problemIndex[0]):P=parseInt(a.params.problemIndex),!P){ce(n,"题目不存在"),await J.push({name:"problem"});return}}b.value=!!y,f.value=!0,await z()}),(C,x)=>{const R=se,O=be,N=Ke,X=He,K=G,ne=pe,H=Ee,ge=ht,Ve=rt,fe=ve,ae=we;return D(),M(ae,{loading:f.value},{default:l(()=>[t(fe,{class:"dida-main-content"},{default:l(()=>[t(O,{span:8},{default:l(()=>[t(R,{style:{margin:"10px"}},{default:l(()=>[A("div",{innerHTML:de(c),ref_key:"markdownRef",ref:d},null,8,Tn)]),_:1})]),_:1}),t(O,{span:4},{default:l(()=>[A("div",xn,[t(H,{layout:"vertical",bordered:!0},{default:l(()=>{var ue;return[t(N,{label:"标题"},{default:l(()=>{var F;return[L(q((F=u.value)==null?void 0:F.title),1)]}),_:1}),t(N,{label:"时间限制"},{default:l(()=>{var F;return[L(q((F=u.value)==null?void 0:F.timeLimit),1)]}),_:1}),t(N,{label:"内存限制"},{default:l(()=>{var F;return[L(q((F=u.value)==null?void 0:F.memoryLimit),1)]}),_:1}),t(N,{label:"判题方式"},{default:l(()=>{var F;return[L(q((F=u.value)==null?void 0:F.judgeType),1)]}),_:1}),t(N,{label:"正确提交"},{default:l(()=>{var F;return[L(q((F=u.value)==null?void 0:F.accept),1)]}),_:1}),t(N,{label:"提交总数"},{default:l(()=>{var F;return[L(q((F=u.value)==null?void 0:F.attempt),1)]}),_:1}),t(N,{label:"创建时间"},{default:l(()=>{var F;return[L(q((F=u.value)==null?void 0:F.insertTime),1)]}),_:1}),t(N,{label:"更新时间"},{default:l(()=>{var F;return[L(q((F=u.value)==null?void 0:F.updateTime),1)]}),_:1}),t(N,{label:"上传用户"},{default:l(()=>{var F;return[L(q((F=u.value)==null?void 0:F.creatorNickname),1)]}),_:1}),b.value?te("",!0):(D(),M(N,{key:0,label:"题目来源"},{default:l(()=>{var F,he,Ce;return[(F=u.value)!=null&&F.sourceUrl?(D(),M(X,{key:0,href:(he=u.value)==null?void 0:he.sourceUrl,target:"_blank"},{default:l(()=>{var We;return[L(q((We=u.value)==null?void 0:We.source),1)]}),_:1},8,["href"])):(D(),Y("span",Vn,q((Ce=u.value)==null?void 0:Ce.source),1))]}),_:1})),i.value?(D(),M(N,{key:1,label:"是否私有"},{default:l(()=>{var F;return[L(q((F=u.value)!=null&&F.private?"私有":"公开"),1)]}),_:1})):te("",!0),(ue=u.value)!=null&&ue.originUrl?(D(),M(N,{key:2,label:"原题链接"},{default:l(()=>{var F;return[t(X,{href:(F=u.value)==null?void 0:F.originUrl,target:"_blank"},{default:l(()=>{var he,Ce;return[L(q((he=u.value)==null?void 0:he.originOj)+" - "+q((Ce=u.value)==null?void 0:Ce.originId),1)]}),_:1},8,["href"])]}),_:1})):te("",!0),de(g)?(D(),M(N,{key:3,label:"标签"},{default:l(()=>[t(ne,null,{default:l(()=>{var F;return[(D(!0),Y(Z,null,me((F=u.value)==null?void 0:F.tags,he=>(D(),M(K,{key:he.id,variant:"dashed",onClick:()=>V(he)},{default:l(()=>[L(q(he.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})):te("",!0)]}),_:1}),A("div",Ln,[t(ne,null,{default:l(()=>[t(K,{onClick:U},{default:l(()=>x[1]||(x[1]=[L("提交记录")])),_:1}),t(K,{onClick:j},{default:l(()=>x[2]||(x[2]=[L("题目讨论")])),_:1}),de(g)?(D(),M(K,{key:0,onClick:$},{default:l(()=>x[3]||(x[3]=[L("题目推荐")])),_:1})):te("",!0)]),_:1})]),A("div",jn,[t(ne,null,{default:l(()=>{var ue;return[i.value?(D(),M(K,{key:0,onClick:w},{default:l(()=>x[4]||(x[4]=[L("编辑")])),_:1})):te("",!0),(ue=u.value)!=null&&ue.originId?(D(),M(K,{key:1,onClick:T,loading:s.value},{default:l(()=>x[5]||(x[5]=[L("更新描述 ")])),_:1},8,["loading"])):te("",!0)]}),_:1})]),A("div",Dn,[t(ne,null,{default:l(()=>[t(Ve,{modelValue:I.value,"onUpdate:modelValue":x[0]||(x[0]=ue=>I.value=ue),label:"语言：",placeholder:"请选择提交语言","auto-width":"",clearable:"",onChange:E},{default:l(()=>[(D(!0),Y(Z,null,me(h.value,ue=>(D(),M(ge,{key:ue.value,value:ue.value,label:ue.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),t(K,{onClick:S,loading:p.value},{default:l(()=>x[6]||(x[6]=[L("提交")])),_:1},8,["loading"])]),_:1}),A("div",{ref_key:"codeEditRef",ref:m,class:"dida-code-editor"},null,512)])])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),xt=ee($n,[["__scopeId","data-v-e5bb36b6"]]),zn={style:{margin:"10px"}};function Un(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!qe(e)}const An=Q({__name:"ProblemRecommend",setup(e){const a=ie(),n=Re(),{globalProperties:r}=oe();let o=null,c="",g={},y={};const P=v([{title:"ID",colKey:"id",cell:(s,p)=>{let k=u(p.row.id);return t(G,{variant:"dashed",theme:k,onClick:()=>f(p.row.id)},{default:()=>[p.row.id]})}},{title:"标题",colKey:"title",cell:(s,p)=>t(G,{variant:"text",onClick:()=>f(p.row.id)},{default:()=>[p.row.title]})},{title:"标签",colKey:"tags",cell:(s,p)=>{const k=p.row.tags;if(!k||k.length===0)return"";let I=[];for(let h=0;h<k.length;h++){const i=k[h];I.push(t(G,{key:h,theme:"default",variant:"outline",size:"small",onClick:()=>_(i)},{default:()=>[i.name]}))}return t(pe,null,Un(I)?I:{default:()=>[I]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),b=v(!1),d=v(),f=s=>{s&&n.push({path:"/problem/"+s})},u=s=>{if(!s||!y)return"default";const p=y[s];if(!p)return"default";switch(p){case Xe.Accept:return"success";case Xe.Attempt:return"warning";default:return"default"}},_=s=>{s&&n.push({name:"problem-list",query:{tag:s.name}})},m=async s=>{b.value=!0;try{const p=await cn(c);if(d.value=[],p.code===0){const k=p.data.list;if(!k||k.length<=0){_e(r,"暂无推荐题目");return}g={},p.data.tags&&p.data.tags.forEach(I=>{g[I.id]=I}),k.forEach(I=>{var i;const h=Ze(I,g);(i=d.value)==null||i.push(h)})}else s&&B(r,p.code)}catch(p){console.error(p),B(r,Te())}finally{b.value=!1}};return le(async()=>{b.value=!0,o=xe(()=>a.query,s=>{Array.isArray(a.params.problemId)?c=a.params.problemId[0]:c=a.params.problemId,m(!0)},{immediate:!0})}),Ie(()=>{o&&o()}),(s,p)=>{const k=ke,I=se,h=be,i=ve;return D(),M(i,null,{default:l(()=>[t(h,{span:9},{default:l(()=>[t(I,{style:{margin:"10px"}},{default:l(()=>[t(k,{data:d.value,columns:P.value,"row-key":"id","vertical-align":"top",hover:!0,"table-layout":"auto",loading:b.value},null,8,["data","columns","loading"])]),_:1})]),_:1}),t(h,{span:3},{default:l(()=>[A("div",zn,[t(I,{class:"sh-card",header:"题目推荐","header-bordered":!0},{default:l(()=>p[0]||(p[0]=[L(" 根据本站其他用户的提交记录推荐类似题目"),A("br",null,null,-1),L("依据推荐算法来计算，与本用户相似度最高的用户做的题，大概率被自己感兴趣。 ")])),_:1})])]),_:1})]),_:1})}}}),Rn=ee(An,[["__scopeId","data-v-77972e8b"]]);async function It(e){const a={};if(a.id=e.id,a.ownerId=e.owner_id,a.ownerUsername=e.owner_username,a.ownerNickname=e.owner_nickname,a.title=e.title,e.start_time?a.startTime=new Date(e.start_time).toLocaleString():a.startTime="无限制",e.end_time?a.endTime=new Date(e.end_time).toLocaleString():a.endTime="无限制",e.update_time?a.updateTime=new Date(e.update_time).toLocaleString():a.updateTime="",e.create_time?a.createTime=new Date(e.create_time).toLocaleString():a.createTime="",e.description){const n={math:{inlineDigit:!0,engine:"KaTeX"}};a.description=await re.md2html(e.description,n)}else a.description="";return a.problems=e.problems,a}function En(e){return W({url:"/collection?id="+e,method:"get"})}function Kn(e){return W({url:"/collection/edit?id="+e,method:"get"})}function qn(e,a){return W({url:"/collection/list?page="+e+"&page_size="+a,method:"get"})}function Mn(e){return W({url:"/collection/rank?id="+e,method:"get"})}function Fn(e){return W({url:"/collection/create",method:"post",data:e})}function Nn(e){return W({url:"/collection/edit",method:"post",data:e})}const Gn={style:{margin:"10px"}},On=Q({__name:"CollectionList",setup(e){const a=ie(),n=Re(),{globalProperties:r}=oe();let o=null;v(!1),v(!1);const c=v([{title:"ID",colKey:"id",width:"100",cell:(k,I)=>t(G,{variant:"text",onClick:()=>u(I.row.id)},{default:()=>[I.row.id]})},{title:"标题",colKey:"title",cell:(k,I)=>t(G,{variant:"text",onClick:()=>u(I.row.id)},{default:()=>[I.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),g=v(!1);let y=1,P=50;const b=v({current:y,pageSize:P,defaultCurrent:y,defaultPageSize:P,total:0,pageSizeOptions:[50,100]}),d=v(),f=v({title:"",username:""});v({title:"",description:"",open_time:[]});const u=k=>{k&&n.push({path:"/collection/"+k})},_=async()=>{await n.push({query:{...a.query,title:f.value.title,username:f.value.username,page:1,page_size:b.value.defaultPageSize}})},m=async(k,I)=>{var h;g.value=!0;try{const{current:i,pageSize:V}=k,w=await qn(i,V);if(d.value=[],w.code===0){const U=w.data.list;for(let j=0;j<U.length;j++){const $=U[j],T=await It($);(h=d.value)==null||h.push(T)}b.value={...b.value,total:w.data.total_count}}else I&&B(r,w.code)}catch(i){console.error(i),B(r,Te())}finally{g.value=!1}},s=async k=>{await n.push({query:{...a.query,page:k.current,page_size:k.pageSize}})},p=async()=>{await n.push({name:"collection-create"})};return le(async()=>{o=xe(()=>a.query,k=>{f.value.title=k.title||"",f.value.username=k.username||"";const I=parseInt(k.page)||b.value.defaultCurrent,h=parseInt(k.page_size)||b.value.defaultPageSize;y=I,P=h,b.value={...b.value,current:y,pageSize:P},m({current:y,pageSize:P},!0)},{immediate:!0})}),Ie(()=>{o&&o()}),(k,I)=>{const h=ke,i=se,V=be,w=De,U=je,j=G,$=Le,T=pe,S=ve;return D(),M(S,null,{default:l(()=>[t(V,{span:9},{default:l(()=>[t(i,{style:{margin:"10px"}},{default:l(()=>[t(h,{data:d.value,columns:c.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:b.value,loading:g.value,onPageChange:s},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(V,{span:3},{default:l(()=>[A("div",Gn,[t(i,{class:"sh-card"},{default:l(()=>[t($,{model:f.value},{default:l(()=>[t(U,{label:"标题"},{default:l(()=>[t(w,{modelValue:f.value.title,"onUpdate:modelValue":I[0]||(I[0]=E=>f.value.title=E),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(U,{label:"负责人"},{default:l(()=>[t(w,{modelValue:f.value.username,"onUpdate:modelValue":I[1]||(I[1]=E=>f.value.username=E),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(U,null,{default:l(()=>[t(j,{theme:"primary",onClick:_},{default:l(()=>I[2]||(I[2]=[L("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(i,{class:"sh-card"},{default:l(()=>[t(T,null,{default:l(()=>[t(j,{onClick:p},{default:l(()=>I[3]||(I[3]=[L("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),Hn=ee(On,[["__scopeId","data-v-29832c46"]]),Bn={style:{margin:"20px"}},Jn={class:"dida-operation-container"},Wn={style:{margin:"12px"}},Yn=["innerHTML"],Xn=Q({__name:"CollectionDetail",setup(e){let a=ie();const{globalProperties:n}=oe(),r=Ue(),o=Se();let c=0;const g=v(!1),y=v(null),P=Ae(()=>o.hasAuth($e.ManageCollection)||y.value&&o.getUserId==y.value.ownerId),b=v([{title:"问题ID",colKey:"id",cell:(_,m)=>t(G,{variant:"text",onClick:()=>f(m.row.id)},{default:()=>[m.row.id]})},{title:"标题",colKey:"title",cell:(_,m)=>t(G,{variant:"text",onClick:()=>f(m.row.id)},{default:()=>[m.row.title]})},{title:"正确",colKey:"accept",cell:(_,m)=>m.row.accept?m.row.accept:0},{title:"提交",colKey:"attempt",cell:(_,m)=>m.row.attempt?m.row.attempt:0}]),d=v([]),f=_=>{J.push({name:"problem-detail",params:{problemId:_}})},u=()=>{y.value&&J.push({name:"collection-edit",params:{collectionId:y.value.id}})};return le(async()=>{if(Array.isArray(a.params.collectionId)?c=Number(a.params.collectionId[0]):c=Number(a.params.collectionId),!c){await J.push({name:"problem-collection-list"});return}g.value=!0;const _=await En(c);if(_.code!==0){g.value=!1,B(n,_.code),await J.push({name:"problem-collection-list"});return}y.value=await It(_.data.collection),d.value=[],_.data.collection.problems&&_.data.collection.problems.forEach(m=>{const s=_.data.problems.find(p=>p.id===m);d.value.push(s)}),r.setTitle(y.value.title+" - "+r.getTitle),await ze(()=>{const m=document.querySelectorAll(".dida-content-description");m&&m.length>0&&m.forEach(s=>{re.mathRender(s),re.highlightRender({lineNumber:!0,enable:!0},s),Ge(s)}),g.value=!1})}),(_,m)=>{const s=Bt,p=Ht,k=ke,I=se,h=be,i=G,V=pe,w=Ke,U=Ee,j=ve,$=we;return D(),M($,{loading:g.value},{default:l(()=>[t(j,{class:"dida-main-content"},{default:l(()=>[t(h,{span:6},{default:l(()=>[A("div",Bn,[t(p,{"max-item-width":"300"},{default:l(()=>[t(s,{to:{name:"problem-collection-list"}},{default:l(()=>m[0]||(m[0]=[L("题目集合")])),_:1}),t(s,null,{default:l(()=>{var T;return[L(q((T=y.value)==null?void 0:T.title),1)]}),_:1})]),_:1})]),t(I,{style:{margin:"10px"}},{default:l(()=>[t(k,{data:d.value,columns:b.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),_:1})]),_:1}),t(h,{span:6},{default:l(()=>{var T;return[A("div",Jn,[t(V,null,{default:l(()=>[P.value?(D(),M(i,{key:0,onClick:u},{default:l(()=>m[1]||(m[1]=[L("编辑")])),_:1})):te("",!0)]),_:1})]),A("div",Wn,[t(U,{layout:"vertical",bordered:!0},{default:l(()=>[t(w,{label:"创建者"},{default:l(()=>{var S;return[L(q((S=y.value)==null?void 0:S.ownerNickname),1)]}),_:1})]),_:1}),t(U,{layout:"vertical",bordered:!0},{default:l(()=>[t(w,{label:"开始时间"},{default:l(()=>{var S;return[L(q((S=y.value)==null?void 0:S.startTime),1)]}),_:1})]),_:1}),t(U,{layout:"vertical",bordered:!0},{default:l(()=>[t(w,{label:"结束时间"},{default:l(()=>{var S;return[L(q((S=y.value)==null?void 0:S.endTime),1)]}),_:1})]),_:1})]),(T=y.value)!=null&&T.description?(D(),M(I,{key:0,style:{margin:"10px"}},{default:l(()=>{var S;return[A("div",{innerHTML:(S=y.value)==null?void 0:S.description,class:"dida-content-description"},null,8,Yn)]}),_:1})):te("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),Zn=ee(Xn,[["__scopeId","data-v-0105a065"]]),Qn=Q({__name:"CollectionRank",setup(e){const a=ie(),n=Re(),{globalProperties:r}=oe();let o=null,c=0,g=0;const y=v([{title:"Rank",colKey:"rank",align:"center"},{title:"序号",colKey:"index",align:"center"},{title:"Username",colKey:"username",cell:(u,_)=>t(G,{variant:"text",onClick:()=>n.push({name:"user",params:{username:_.row.username}})},{default:()=>[_.row.username]})},{title:"昵称",colKey:"nickname",cell:(u,_)=>t(G,{variant:"text",onClick:()=>n.push({name:"user",params:{username:_.row.username}})},{default:()=>[_.row.nickname]})},{title:"Count",colKey:"count",cell:(u,_)=>t(G,{variant:"text",onClick:()=>n.push({name:"judge-list",query:{username:_.row.username,status:Pe.Accept}})},{default:()=>[`${_.row.accept} / ${g}`]})},{title:"Progress",colKey:"progress",cell:(u,_)=>{let m=100;return g>0&&(m=Number((_.row.accept/g*100).toFixed(2))),t(Jt,{percentage:m},null)}}]),P=v(!1),b=v([]),d=({col:u,rowIndex:_})=>{let m=1;for(let s=_+1;s<b.value.length&&b.value[s].rank===b.value[_].rank;s++)m++;if(u.colKey==="rank")return{rowspan:m}},f=async u=>{P.value=!0;try{const _=await Mn(c);if(b.value=[],_.code===0){g=_.data.problem;const m=_.data.ranks,s=[];if(m){for(let I=0;I<m.length;I++){const h=m[I];let i={userId:h.author_id,username:h.author_username,nickname:h.author_nickname};i.accept=h.accept,s.push(i)}s.sort((I,h)=>I.accept!==h.accept?h.accept-I.accept:I.userId-h.userId);let p=0,k=-1;for(let I=0;I<s.length;I++)s[I].accept!==k&&(p=I+1,k=s[I].accept),s[I].index=I+1,s[I].rank=p}b.value=s}else u&&B(r,_.code)}catch(_){console.error(_),B(r,Te())}finally{P.value=!1}};return le(async()=>{o=xe(()=>a.query,async()=>{if(Array.isArray(a.params.collectionId)?c=Number(a.params.collectionId[0]):c=Number(a.params.collectionId),!c){await n.push({name:"problem-collection-list"});return}await f(!0)},{immediate:!0})}),Ie(()=>{o&&o()}),(u,_)=>{const m=ke,s=se,p=ve;return D(),M(p,null,{default:l(()=>[t(s,{style:{margin:"10px"}},{default:l(()=>[A("div",null,[t(m,{data:b.value,columns:y.value,"row-key":"index","rowspan-and-colspan":d,"vertical-align":"middle",bordered:!0,hover:!0,loading:P.value},null,8,["data","columns","loading"])])]),_:1})]),_:1})}}});var ye=(e=>(e[e.Valid=0]="Valid",e[e.Duplicate=1]="Duplicate",e[e.Invalid=2]="Invalid",e))(ye||{});const eo={class:"dida-form-border"},to={style:{"text-align":"right"}},ao=Q({name:"ParseProblemList",__name:"ParseProblemList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:a}=oe(),n=v(!1),r=v(!1),o=v(""),c=Ft(e,"modelValue");let g=[];xe(c,async u=>{JSON.stringify(u)!==JSON.stringify(g)&&(await b(u),g=c.value)},{deep:!0});const y=v([]),P=v([{title:"有效性",colKey:"validType",cell:(u,_)=>{switch(_.row.valid){case ye.Valid:return t(Fe,{theme:"success"},{default:()=>[L("有效")]});case ye.Duplicate:return t(Fe,{theme:"warning"},{default:()=>[L("重复")]});case ye.Invalid:return t(Fe,{theme:"danger"},{default:()=>[L("无效")]});default:return null}}},{title:"问题ID",colKey:"id"},{title:"标题",colKey:"title"}]),b=async u=>{const _=Array.from(new Set(u)),m=await _n(_);if(m.code!==0){B(a,m.code),r.value=!1;return}const s=[],p=m.data.problems;let k=[];u.forEach(I=>{const h=p.find(i=>i.id===I);if(h){const i=s.find(V=>V.id===I);h.valid=i?ye.Duplicate:ye.Valid,s.push({id:I,title:h.title,valid:h.valid}),i||k.push(I)}else s.push({id:I,title:"-",valid:ye.Invalid})}),y.value=s,g=k,c.value=k},d=async()=>{r.value=!0;const u=ea(o.value);await b(u),n.value=!1,r.value=!1},f=()=>{y.value?o.value=y.value.map(u=>u.id).join(`
`):o.value="",n.value=!0};return(u,_)=>{const m=G,s=ke,p=ut,k=Me;return D(),Y(Z,null,[A("div",eo,[A("div",to,[t(m,{onClick:f},{default:l(()=>_[2]||(_[2]=[L("编辑")])),_:1})]),t(s,{data:y.value,columns:P.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(k,{visible:n.value,"onUpdate:visible":_[1]||(_[1]=I=>n.value=I),onConfirm:d,header:"请输入问题ID","confirm-loading":r.value},{default:l(()=>[_[3]||(_[3]=A("div",{style:{"margin-bottom":"10px"}},[A("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(p,{modelValue:o.value,"onUpdate:modelValue":_[0]||(_[0]=I=>o.value=I),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),ua=ee(ao,[["__scopeId","data-v-b0352688"]]),lo={class:"dida-form-border"},no={style:{"text-align":"right"}},oo=Q({name:"ParseUserList",__name:"ParseUserList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:a}=oe(),n=v(!1),r=v(!1),o=v(""),c=Ft(e,"modelValue");let g=[];xe(c,async m=>{JSON.stringify(m)!==JSON.stringify(g)&&(g=m,await d(m))},{deep:!0});const y=v(),P=v([{title:"有效性",colKey:"validType",cell:(m,s)=>{switch(s.row.valid){case ye.Valid:return t(Fe,{theme:"success"},{default:()=>[L("有效")]});case ye.Duplicate:return t(Fe,{theme:"warning"},{default:()=>[L("重复")]});case ye.Invalid:return t(Fe,{theme:"danger"},{default:()=>[L("无效")]})}}},{title:"Username",colKey:"username"},{title:"昵称",colKey:"nickname"}]),b=(m,s)=>{if(m.code!==0){B(a,m.code),r.value=!1;return}const p=[],k=m.data.users;let I=[];s?s.forEach(h=>{let i=null;if(k&&(i=k.find(V=>V.username.toLowerCase()===h.toLowerCase())),i){const V=p.find(U=>U.username.toLowerCase()===h.toLowerCase()),w=V?ye.Duplicate:ye.Valid;p.push({id:i.id,username:i.username,nickname:i.nickname,valid:w}),V||I.push(i.id)}else p.push({id:-1,username:h,nickname:"-",valid:ye.Invalid})}):k&&k.forEach(h=>{const i=p.find(w=>w.id===h.id),V=i?ye.Duplicate:ye.Valid;p.push({id:h.id,username:h.username,nickname:h.nickname,valid:V}),i||I.push(h.id)}),y.value=p,g=I,c.value=I},d=async m=>{const s=Array.from(new Set(m)),p=await Ll(s);b(p)},f=async m=>{const s=Array.from(new Set(m)),p=await jl(s);b(p,m)},u=async()=>{r.value=!0;const m=ea(o.value);await f(m),n.value=!1,r.value=!1},_=()=>{y.value?o.value=y.value.map(m=>m.username).join(`
`):o.value="",n.value=!0};return(m,s)=>{const p=G,k=ke,I=ut,h=Me;return D(),Y(Z,null,[A("div",lo,[A("div",no,[t(p,{onClick:_},{default:l(()=>s[2]||(s[2]=[L("编辑")])),_:1})]),t(k,{data:y.value,columns:P.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(h,{visible:n.value,"onUpdate:visible":s[1]||(s[1]=i=>n.value=i),onConfirm:u,header:"请输入用户Username","confirm-loading":r.value},{default:l(()=>[s[3]||(s[3]=A("div",{style:{"margin-bottom":"10px"}},[A("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(I,{modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=i=>o.value=i),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),ca=ee(oo,[["__scopeId","data-v-b0b99852"]]),so={style:{margin:"10px"}},ro={style:{margin:"12px"}},io={class:"dida-edit-container"},uo=Q({__name:"CollectionEdit",setup(e){let a=ie();const{globalProperties:n}=oe(),r=Ue(),o=v(""),c=v(!1);let g=null;const y=v(!1),P=v(!1),b=v(null),d=v({title:"",openTime:[],private:!0,problems:[],members:[],description:""}),f=v(""),u=v(""),_=v(!1),m=async()=>{_.value=!0,P.value=!1,_.value=!1},s=async()=>{if(g){y.value=!0;try{const h={title:d.value.title,description:g.getValue(),problems:d.value.problems,members:d.value.members,start_time:d.value.openTime[0],end_time:d.value.openTime[1],private:d.value.private},i=await Fn(h);if(y.value=!0,i.code!==0){B(n,i.code);return}i.data!=null&&await J.push({name:"collection-detail",params:{collectionId:i.data}}),Ne(n,"创建成功")}finally{y.value=!1}}},p=async()=>{if(g){y.value=!0;try{const h={id:Number(o.value),title:d.value.title,private:d.value.private,problems:d.value.problems,members:d.value.members,description:g.getValue()};d.value.openTime[0]&&(h.start_time=new Date(d.value.openTime[0])),d.value.openTime[1]&&(h.end_time=new Date(d.value.openTime[1]));const i=await Nn(h);if(y.value=!0,i.code!==0){B(n,i.code);return}i.data!=null&&(b.value.updateTime=new Date(i.data).toLocaleString()),Ne(n,"保存成功")}finally{y.value=!1}}},k=h=>{const i={after:()=>{g==null||g.setValue(h),c.value=!1}};g=new re("collectionEditDiv",i)},I=async()=>{const h=await Kn(o.value);if(h.code!==0){B(n,h.code),console.error("collection get failed",h.code),await J.push({name:"problem-collection-list"});return}const i=h.data.collection;b.value=await It(i),d.value.title=i.title,d.value.openTime=[],i.start_time?d.value.openTime.push(new Date(i.start_time)):d.value.openTime.push(""),i.end_time?d.value.openTime.push(new Date(i.end_time)):d.value.openTime.push(""),d.value.private=i.private,d.value.description=i.description,d.value.problems=i.problems,d.value.members=i.members,r.setTitle(i.title+" - "+r.getTitle);let V="";i.description&&(V=i.description),k(V)};return le(async()=>{Array.isArray(a.params.collectionId)?o.value=a.params.collectionId[0]:o.value=a.params.collectionId,o.value?(c.value=!0,await I()):k("")}),(h,i)=>{const V=De,w=je,U=Wt,j=it,$=Le,T=se,S=be,E=G,z=pe,C=Ke,x=Ee,R=ve,O=we,N=ut,X=Me;return D(),Y(Z,null,[t(O,{loading:c.value},{default:l(()=>[t(R,null,{default:l(()=>[t(S,{span:8},{default:l(()=>[A("div",so,[t(T,{class:"sh-card"},{default:l(()=>[t($,{model:d.value},{default:l(()=>[t(w,{label:"标题"},{default:l(()=>[t(V,{modelValue:d.value.title,"onUpdate:modelValue":i[0]||(i[0]=K=>d.value.title=K),placeholder:"题集标题"},null,8,["modelValue"])]),_:1}),t(w,{label:"开启时间"},{default:l(()=>[t(U,{modelValue:d.value.openTime,"onUpdate:modelValue":i[1]||(i[1]=K=>d.value.openTime=K),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(w,{label:"私有"},{default:l(()=>[t(j,{modelValue:d.value.private,"onUpdate:modelValue":i[2]||(i[2]=K=>d.value.private=K)},null,8,["modelValue"])]),_:1}),t(w,{label:"成员"},{default:l(()=>[t(ca,{modelValue:d.value.members,"onUpdate:modelValue":i[3]||(i[3]=K=>d.value.members=K)},null,8,["modelValue"])]),_:1}),t(w,{label:"问题测试"},{default:l(()=>[t(ua,{modelValue:d.value.problems,"onUpdate:modelValue":i[4]||(i[4]=K=>d.value.problems=K)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(S,{span:4},{default:l(()=>[A("div",ro,[A("div",io,[o.value?(D(),M(z,{key:0},{default:l(()=>[t(E,{onClick:p,theme:"danger",loading:y.value},{default:l(()=>i[7]||(i[7]=[L("保存")])),_:1},8,["loading"])]),_:1})):(D(),M(z,{key:1},{default:l(()=>[t(E,{onClick:s,theme:"danger",loading:y.value},{default:l(()=>i[8]||(i[8]=[L("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(D(),M(x,{key:0,layout:"vertical",bordered:!0},{default:l(()=>[t(C,{label:"创建时间"},{default:l(()=>{var K;return[L(q((K=b.value)==null?void 0:K.createTime),1)]}),_:1}),t(C,{label:"更新时间"},{default:l(()=>{var K;return[L(q((K=b.value)==null?void 0:K.updateTime),1)]}),_:1}),t(C,{label:"创建用户"},{default:l(()=>{var K;return[L(q((K=b.value)==null?void 0:K.ownerNickname),1)]}),_:1})]),_:1})):te("",!0)])]),_:1})]),_:1}),i[9]||(i[9]=A("div",{id:"collectionEditDiv",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"]),t(X,{visible:P.value,"onUpdate:visible":i[6]||(i[6]=K=>P.value=K),onConfirm:m,header:f.value,"confirm-loading":_.value},{default:l(()=>[i[10]||(i[10]=A("div",{style:{"margin-bottom":"10px"}},[A("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(N,{modelValue:u.value,"onUpdate:modelValue":i[5]||(i[5]=K=>u.value=K),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),Vt=ee(uo,[["__scopeId","data-v-d5eac4d4"]]),co=["innerHTML"];function Lt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!qe(e)}const mo=Q({__name:"JudgeJobList",setup(e){const a=ie(),n=Re(),{globalProperties:r}=oe();let o=!1,c=null,g;const y=v(!1),P=v(null),b=v(null),d=v(!1);let f=-1;const u=v({problemId:"",username:"",language:void 0,status:void 0}),_=v([{title:"ID",colKey:"id",cell:(C,x)=>t(G,{variant:"text",onClick:()=>j(x.row.id)},{default:()=>[x.row.id]})},{title:"问题",colKey:"problemId",cell:(C,x)=>{if(f){let R;return t(G,{variant:"text",onClick:()=>U(f,x.row.contestProblemIndex)},Lt(R=Oe(x.row.contestProblemIndex))?R:{default:()=>[R]})}return t(G,{variant:"text",onClick:()=>w(x.row.problemId)},{default:()=>[x.row.problemId]})}},{title:"状态",colKey:"status",align:"center",cell:(C,x)=>{const R=x.row.status,O=ot(R),N=la(R);let X=[];return Be(R)&&X.push(t(we,{text:x.row.state,size:"small",class:"dida-status-loading"},null)),X.push(t("span",null,[O])),t(G,{theme:N,variant:"outline",onClick:()=>j(x.row.id)},Lt(X)?X:{default:()=>[X]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"code",cell:(C,x)=>t(G,{theme:"default",onClick:()=>V(x.row)},{default:()=>[x.row.language+" / "+x.row.codeLength]})},{title:"作者",colKey:"author",width:200,cell:(C,x)=>t(G,{variant:"text",onClick:()=>$(x.row.authorUsername)},{default:()=>[x.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),m=v(!1);let s=1,p=50;const k=v({current:s,pageSize:p,defaultCurrent:s,defaultPageSize:p,total:0,pageSizeOptions:[50,100]}),I=v(),h=v([]);h.value=kt();const i=v([]);i.value=na();const V=async C=>{d.value=!0,y.value=!0;try{P.value=C;const x=await tn(Number(P.value.id));if(x.code===0){const R=x.data,N=`\`\`\`${Ct(R.language)}
${R.code}
\`\`\``,X={};P.value.code=await re.md2html(N,X),await ze(()=>{b.value&&(re.highlightRender({lineNumber:!0,enable:!0},b.value),Ge(b.value))})}else B(r,x.code)}finally{d.value=!1}},w=C=>{C&&n.push({path:"/problem/"+C})},U=(C,x)=>{n.push({name:"contest-problem-detail",params:{contestId:C,problemIndex:x}})},j=C=>{C&&(f>0?n.push({name:"contest-judge-detail",params:{contestId:f,judgeId:C}}):n.push({name:"judge-detail",params:{judgeId:C}}))},$=C=>{C&&n.push({path:"/user/"+C})},T=async()=>{await n.push({query:{...a.query,page:1,page_size:p,problem_id:u.value.problemId,username:u.value.username,language:u.value.language,status:u.value.status}})},S=async()=>{u.value.problemId="",u.value.username="",u.value.language=void 0,u.value.status=void 0,await n.push({query:{...a.query,page:1,page_size:p,problem_id:"",username:"",language:void 0,status:void 0}})},E=async(C,x)=>{x&&(m.value=!0);let R=!1;try{const{current:O,pageSize:N}=C,X=await an(f,u.value.problemId,u.value.username,u.value.language,u.value.status,O,N);I.value=[],X.code===0?X.data.list&&X.data.list.length>0?(X.data.list.forEach(ne=>{var ge;const H=oa(ne);(ge=I.value)==null||ge.push(H),Be(ne.status)&&(R=!0)}),k.value={...k.value,total:X.data.total_count}):(_e(r,"未找到记录"),k.value={...k.value,total:0}):x&&B(r,X.code)}catch(O){console.error(O),x&&B(r,Te())}finally{x&&(m.value=!1),R&&o&&(g=setTimeout(()=>{E({current:s,pageSize:p},!1)},5e3))}},z=async C=>{await n.push({query:{...a.query,page:C.current,page_size:C.pageSize}})};return le(async()=>{o=!0,c=xe(()=>a.query,C=>{Array.isArray(a.params.contestId)?f=Number(a.params.contestId[0]):f=Number(a.params.contestId),u.value.problemId=C.problem_id||"",u.value.username=C.username||"",C.language!=null?u.value.language=Number(C.language):u.value.language=void 0,C.status!=null?u.value.status=Number(C.status):u.value.status=void 0;const x=parseInt(C.page)||k.value.defaultCurrent,R=parseInt(C.page_size)||k.value.defaultPageSize;s=x,p=R,k.value.pageSizeOptions.includes(p)||(p=k.value.defaultPageSize),k.value={...k.value,current:s,pageSize:p},E({current:s,pageSize:p},!0)},{immediate:!0})}),Ie(()=>{o=!1,c&&c(),clearTimeout(g)}),(C,x)=>{const R=De,O=je,N=ht,X=rt,K=G,ne=pe,H=Le,ge=ke,Ve=se,fe=He,ae=we,ue=Me;return D(),Y(Z,null,[t(Ve,{style:{margin:"10px"}},{default:l(()=>[t(H,{layout:"inline",onSubmit:T,onReset:S},{default:l(()=>[t(O,{label:"题号"},{default:l(()=>[t(R,{modelValue:u.value.problemId,"onUpdate:modelValue":x[0]||(x[0]=F=>u.value.problemId=F),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(O,{label:"用户"},{default:l(()=>[t(R,{modelValue:u.value.username,"onUpdate:modelValue":x[1]||(x[1]=F=>u.value.username=F),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(O,{label:"语言"},{default:l(()=>[t(X,{modelValue:u.value.language,"onUpdate:modelValue":x[2]||(x[2]=F=>u.value.language=F),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:l(()=>[(D(!0),Y(Z,null,me(h.value,F=>(D(),M(N,{key:F.value,value:F.value,label:F.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(O,{label:"状态"},{default:l(()=>[t(X,{modelValue:u.value.status,"onUpdate:modelValue":x[3]||(x[3]=F=>u.value.status=F),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:l(()=>[(D(!0),Y(Z,null,me(i.value,F=>(D(),M(N,{key:F.value,value:F.value,label:F.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(O,null,{default:l(()=>[t(ne,null,{default:l(()=>[t(K,{theme:"primary",type:"submit"},{default:l(()=>x[7]||(x[7]=[L("搜索")])),_:1}),t(K,{theme:"default",variant:"base",type:"reset"},{default:l(()=>x[8]||(x[8]=[L("重置")])),_:1})]),_:1})]),_:1})]),_:1}),t(ge,{data:I.value,columns:_.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:k.value,loading:m.value,onPageChange:z,"table-layout":"auto"},null,8,["data","columns","pagination","loading"])]),_:1}),t(ue,{visible:y.value,"onUpdate:visible":x[5]||(x[5]=F=>y.value=F),width:"800px","cancel-btn":null,"close-btn":!1,onConfirm:x[6]||(x[6]=F=>y.value=!1)},{header:l(()=>[t(fe,{onClick:x[4]||(x[4]=()=>{var F;j((F=P.value)==null?void 0:F.id)})},{default:l(()=>{var F,he;return[L(q(((F=P.value)==null?void 0:F.id)+" - "+((he=P.value)==null?void 0:he.language)),1)]}),_:1})]),default:l(()=>[t(ae,{loading:d.value},{default:l(()=>{var F;return[A("div",{innerHTML:(F=P.value)==null?void 0:F.code,ref_key:"markdownCodeRef",ref:b,style:{"min-height":"100px"}},null,8,co)]}),_:1},8,["loading"])]),_:1},8,["visible"])],64)}}}),jt=ee(mo,[["__scopeId","data-v-375cd905"]]),po={class:"dida-code-container"},fo=["innerHTML"],_o={key:2,class:"dida-edit-container"};function Dt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!qe(e)}const vo=Q({__name:"JudgeJobDetail",setup(e){const a=ie(),n=Re(),r=Se(),{globalProperties:o}=oe();let c=!1,g,y=-1;const P=v(""),b=v(null),d=v(""),f=v(null),u=v(0),_=v(null),m=v({from:"#5a96ff",to:"#00A870"});let s=!1;const p=v([{title:"ID",colKey:"id"},{title:"问题",colKey:"problemId",cell:(S,E)=>t(G,{variant:"text",onClick:()=>w(E.row.problemId)},{default:()=>[E.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(S,E)=>{const z=E.row.status,C=ot(z),x=la(z);let R=[];return Be(z)&&R.push(t(we,{text:E.row.state,size:"small",class:"dida-status-loading"},null)),R.push(t("span",null,[C])),t(G,{theme:x,variant:"outline"},Dt(R)?R:{default:()=>[R]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"language",cell:(S,E)=>t("span",null,[E.row.language+" / "+E.row.codeLength])},{title:"作者",colKey:"author",width:200,cell:(S,E)=>t(G,{variant:"text",onClick:()=>U(E.row.authorUsername)},{default:()=>[E.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),k=v(!1),I=v(!1),h=v(),i=Ae(()=>r.hasAuth($e.ManageJudge)),V=async()=>{if(!I.value){I.value=!0;try{const S=await sn(y);S.code===0?await $(!0):B(o,S.code)}catch(S){console.error(S),B(o,Te())}finally{I.value=!1}}},w=S=>{S&&n.push({path:"/problem/"+S})},U=S=>{S&&n.push({path:"/user/"+S})},j=S=>{const E=S.status,z=ot(E);let C;switch(E){case Pe.Init:case Pe.Rejudge:case Pe.Compiling:case Pe.Running:C="default";break;case Pe.Accept:C="success";break;case Pe.PE:C="warning";break;default:C="danger";break}return t(pe,null,{default:()=>[t(G,{theme:"default",variant:"outline"},{default:()=>[S.taskId]}),t(G,{theme:C,variant:"outline"},Dt(z)?z:{default:()=>[z]}),t("span",null,[L("分数："),S.score]),t("span",null,[L("用时："),S.time]),t("span",null,[L("内存："),S.memory])]})},$=async S=>{var z;S&&(k.value=!0);let E=!1;try{const C=await en(y);if(h.value=[],C.code===0){const x=C.data,R=oa(x);if((z=h.value)==null||z.push(R),x.judger){const N=await Zt(x.judger);P.value=N.name}else P.value="";m.value.to="#00A870",Be(x.status)?(_.value="active",R.taskTotal>0?(u.value=R.taskCurrent/R.taskTotal*100,R.taskCurrent>=R.taskTotal&&(u.value=99)):u.value=0):(u.value=100,x.status===Pe.Accept?_.value="success":x.status===Pe.PE?(m.value.to="#F57C20",_.value="warning"):(m.value.to="#F56C6C",_.value="error"));const O={};if(x.code){const X=`\`\`\`${Ct(x.language)}
${x.code}
\`\`\``;d.value=await re.md2html(X,O),await ze(()=>{f.value&&(s||(s=!0,re.highlightRender({lineNumber:!0,enable:!0},f.value)),Ge(f.value))})}b.value=R,Be(x.status)&&(E=!0)}else S&&B(o,C.code)}catch(C){console.error(C),S&&B(o,Te())}finally{S&&(k.value=!1),E&&c&&(g=setTimeout(()=>{$(!1)},5e3))}};function T(){f.value&&f.value.parentElement&&(f.value.style.maxWidth=f.value.parentElement.clientWidth+"px")}return le(async()=>{if(c=!0,Array.isArray(a.params.judgeId)?y=Number(a.params.judgeId[0]):y=Number(a.params.judgeId),!y){await n.push({name:"judge"});return}await $(!0),T(),window.addEventListener("resize",T)}),Ie(()=>{c=!1,window.removeEventListener("resize",T),clearTimeout(g)}),(S,E)=>{var ge,Ve,fe;const z=Jt,C=ke,x=se,R=be,O=Ke,N=Ee,X=ve,K=Ra,ne=Ea,H=G;return D(),Y(Z,null,[t(z,{color:m.value,status:_.value,class:"dida-job-progress",percentage:u.value},null,8,["color","status","percentage"]),t(x,{style:{margin:"10px"}},{default:l(()=>[t(C,{data:h.value,columns:p.value,"row-key":"id","vertical-align":"top",hover:!0,loading:k.value},null,8,["data","columns","loading"])]),_:1}),t(X,null,{default:l(()=>[t(R,{span:8},{default:l(()=>[A("div",po,[A("div",{innerHTML:d.value,ref_key:"markdownCodeRef",ref:f,class:"dida-code-div"},null,8,fo)])]),_:1}),t(R,{span:4},{default:l(()=>[t(N,{layout:"vertical",bordered:!0,style:{margin:"10px"}},{default:l(()=>[t(O,{label:"判题机"},{default:l(()=>[L(q(P.value),1)]),_:1}),t(O,{label:"判题时间"},{default:l(()=>{var ae;return[L(q((ae=b.value)==null?void 0:ae.judgeTime),1)]}),_:1})]),_:1})]),_:1})]),_:1}),(ge=b.value)!=null&&ge.compileMessage?(D(),M(x,{key:0,class:"compile-message"},{default:l(()=>{var ae;return[L(q((ae=b.value)==null?void 0:ae.compileMessage),1)]}),_:1})):te("",!0),(Ve=b.value)!=null&&Ve.task&&((fe=b.value)==null?void 0:fe.task.length)>0?(D(),M(ne,{key:1,class:"task-panel"},{default:l(()=>{var ae;return[(D(!0),Y(Z,null,me((ae=b.value)==null?void 0:ae.task,(ue,F)=>(D(),M(K,{key:ue.taskId,header:()=>j(ue)},{default:l(()=>[L(q(ue.content)+" "+q(ue.waHint),1)]),_:2},1032,["header"]))),128))]}),_:1})):te("",!0),i.value?(D(),Y("div",_o,[t(H,{onClick:V,loading:I.value},{default:l(()=>E[0]||(E[0]=[L("重新评测")])),_:1},8,["loading"])])):te("",!0)],64)}}}),$t=ee(vo,[["__scopeId","data-v-574eda0b"]]),go={style:{margin:"10px"}},bo=Q({__name:"ContestList",setup(e){const a=ie(),n=Re(),{globalProperties:r}=oe();let o=null;const c=v([{title:"ID",colKey:"id",width:"100",cell:(k,I)=>t(G,{variant:"text",onClick:()=>u(I.row.id)},{default:()=>[I.row.id]})},{title:"标题",colKey:"title",cell:(k,I)=>t(G,{variant:"text",onClick:()=>u(I.row.id)},{default:()=>[I.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),g=v(!1);let y=1,P=50;const b=v({current:y,pageSize:P,defaultCurrent:y,defaultPageSize:P,total:0,pageSizeOptions:[50,100]}),d=v(),f=v({title:"",username:""}),u=k=>{k&&n.push({path:"/contest/"+k})},_=async()=>{await n.push({query:{...a.query,title:f.value.title,username:f.value.username,page:1,page_size:b.value.defaultPageSize}})},m=async(k,I)=>{var h;g.value=!0;try{const{current:i,pageSize:V}=k,w=await Cn(i,V);if(d.value=[],w.code===0){const U=w.data.list;for(let j=0;j<U.length;j++){const $=U[j],T=await St($);(h=d.value)==null||h.push(T)}b.value={...b.value,total:w.data.total_count}}else I&&B(r,w.code)}catch(i){console.error(i),B(r,Te())}finally{g.value=!1}},s=async k=>{await n.push({query:{...a.query,page:k.current,page_size:k.pageSize}})},p=()=>{n.push({name:"contest-create"})};return le(async()=>{o=xe(()=>a.query,k=>{f.value.title=k.title||"",f.value.username=k.username||"";const I=parseInt(k.page)||b.value.defaultCurrent,h=parseInt(k.page_size)||b.value.defaultPageSize;y=I,P=h,b.value={...b.value,current:y,pageSize:P},m({current:y,pageSize:P},!0)},{immediate:!0})}),Ie(()=>{o&&o()}),(k,I)=>{const h=ke,i=se,V=be,w=De,U=je,j=G,$=Le,T=pe,S=ve;return D(),M(S,null,{default:l(()=>[t(V,{span:9},{default:l(()=>[t(i,{style:{margin:"10px"}},{default:l(()=>[t(h,{data:d.value,columns:c.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:b.value,loading:g.value,onPageChange:s},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(V,{span:3},{default:l(()=>[A("div",go,[t(i,{class:"sh-card"},{default:l(()=>[t($,{model:f.value},{default:l(()=>[t(U,{label:"标题"},{default:l(()=>[t(w,{modelValue:f.value.title,"onUpdate:modelValue":I[0]||(I[0]=E=>f.value.title=E),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(U,{label:"负责人"},{default:l(()=>[t(w,{modelValue:f.value.username,"onUpdate:modelValue":I[1]||(I[1]=E=>f.value.username=E),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(U,null,{default:l(()=>[t(j,{theme:"primary",onClick:_},{default:l(()=>I[2]||(I[2]=[L("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(i,{class:"sh-card"},{default:l(()=>[t(T,null,{default:l(()=>[t(j,{onClick:p},{default:l(()=>I[3]||(I[3]=[L("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),zt=ee(bo,[["__scopeId","data-v-2de83a00"]]),ho={style:{margin:"20px"}},yo={class:"dida-operation-container"},wo={style:{margin:"12px"}},ko=["innerHTML"],Co=Q({__name:"ContestDetail",setup(e){let a=ie();const{globalProperties:n}=oe(),r=Ue(),o=Se();let c=0;const g=v(!1),y=v(null),P=Ae(()=>o.hasAuth($e.ManageContest)||y.value&&o.getUserId==y.value.ownerId),b=v([{title:"问题ID",colKey:"id",cell:(_,m)=>t(G,{variant:"text",onClick:()=>f(c,m.row.index)},{default:()=>[m.row.id]})},{title:"标题",colKey:"title",cell:(_,m)=>t(G,{variant:"text",onClick:()=>f(c,m.row.index)},{default:()=>[m.row.title]})},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),d=v([]),f=(_,m)=>{J.push({name:"contest-problem-detail",params:{contestId:_,problemIndex:m}})},u=()=>{J.push({name:"contest-edit",params:{contestId:c}})};return le(async()=>{if(Array.isArray(a.params.contestId)?c=Number(a.params.contestId[0]):c=Number(a.params.contestId),!c){await J.push({name:"contest"});return}g.value=!0;const _=await wn(c);if(_.code!==0){g.value=!1,B(n,_.code),await J.push({name:"contest"});return}y.value=await St(_.data),d.value=y.value.problems,r.setTitle(y.value.title+" - "+r.getTitle),await ze(()=>{const m=document.querySelectorAll(".dida-content-description");m&&m.length>0&&m.forEach(s=>{re.mathRender(s),re.highlightRender({lineNumber:!0,enable:!0},s),Ge(s)}),g.value=!1})}),(_,m)=>{const s=bt,p=ke,k=se,I=be,h=G,i=pe,V=Ke,w=Ee,U=ve,j=we;return D(),M(j,{loading:g.value},{default:l(()=>[t(U,{class:"dida-main-content"},{default:l(()=>[t(I,{span:6},{default:l(()=>{var $,T,S;return[A("div",ho,[A("h1",null,q(($=y.value)==null?void 0:$.title),1),(T=y.value)!=null&&T.notification?(D(),M(s,{key:0,theme:"info",message:(S=y.value)==null?void 0:S.notification},null,8,["message"])):te("",!0)]),t(k,{style:{margin:"10px"}},{default:l(()=>[t(p,{data:d.value,columns:b.value,"row-key":"id","table-layout":"auto","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1})]}),_:1}),t(I,{span:6},{default:l(()=>{var $;return[A("div",yo,[t(i,null,{default:l(()=>[P.value?(D(),M(h,{key:0,onClick:u},{default:l(()=>m[0]||(m[0]=[L("编辑")])),_:1})):te("",!0)]),_:1})]),A("div",wo,[t(w,{layout:"vertical",bordered:!0},{default:l(()=>[t(V,{label:"开始时间"},{default:l(()=>{var T;return[L(q((T=y.value)==null?void 0:T.startTime),1)]}),_:1})]),_:1}),t(w,{layout:"vertical",bordered:!0},{default:l(()=>[t(V,{label:"结束时间"},{default:l(()=>{var T;return[L(q((T=y.value)==null?void 0:T.endTime),1)]}),_:1})]),_:1})]),($=y.value)!=null&&$.description?(D(),M(k,{key:0,style:{margin:"12px"}},{default:l(()=>{var T;return[A("div",{innerHTML:(T=y.value)==null?void 0:T.description,class:"dida-content-description"},null,8,ko)]}),_:1})):te("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),So=ee(Co,[["__scopeId","data-v-359cf039"]]),Io={class:"table-scroll-wrapper"};function Ut(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!qe(e)}const Po=Q({__name:"ContestRank",setup(e){const a=ie(),n=Re(),{globalProperties:r}=oe();let o=null,c=0;const g=_=>{if(_==null)return"-";const m=Math.floor(_/3600).toString().padStart(2,"0"),s=Math.floor(_%3600/60).toString().padStart(2,"0"),p=(_%60).toString().padStart(2,"0");return`${m}:${s}:${p}`},y=[{title:"Rank",colKey:"rank",align:"center",fixed:"left"},{title:"昵称",colKey:"nickname",fixed:"left",cell:(_,m)=>{const s=Cl(m.row.nickname,18);return t(Ka,{content:m.row.nickname},{default:()=>[t(G,{variant:"text",onClick:()=>n.push({name:"user",params:{username:m.row.username}})},Ut(s)?s:{default:()=>[s]})]})}},{title:"Solved",colKey:"solved",align:"center",fixed:"left",cell:(_,m)=>t(G,{variant:"text",onClick:()=>n.push({name:"contest-judge",params:{contestId:c},query:{username:m.row.username,status:Pe.Accept}})},{default:()=>[m.row.solved]})},{title:"Penalty",colKey:"penalty",align:"center",fixed:"left",cell:(_,m)=>g(m.row.penalty)}],P=v([]),b=v(!1),d=v([]),f=({col:_,rowIndex:m})=>{let s=1;for(let p=m+1;p<d.value.length&&d.value[p].rank===d.value[m].rank;p++)s++;if(_.colKey==="rank")return{rowspan:s}},u=async _=>{b.value=!0;try{const m=await Sn(c);if(P.value=y,d.value=[],m.code===0){m.data.problems.sort((j,$)=>j-$),m.data.problems.forEach((j,$)=>{P.value.push({colKey:`problem_${j}`,align:"center",title:()=>{let T;return t(G,{variant:"text",onClick:()=>n.push({name:"contest-problem-detail",params:{contestId:c,problemIndex:j}})},Ut(T=Oe(j))?T:{default:()=>[T]})},cell:(T,S)=>{const E=S.row[`problem_${j}`];if(!E)return"";let z="";return E.acDuration>=0&&(z=g(E.acDuration)),E.attempt>0&&(z&&(z+=" "),z+=`(-${E.attempt})`),t("span",null,[z])},attrs:T=>{const S=T.row[`problem_${j}`];return S?S.acDuration>=0?{style:{backgroundColor:"rgba(130,255,30,0.5)"}}:{style:{backgroundColor:"rgba(255,120,120,0.5)"}}:{}}})});const s=m.data.contest,p=new Date(s.start_time),k=m.data.ranks,I=[];for(let j=0;j<k.length;j++){const $=k[j];let T={userId:$.author_id,username:$.author_username,nickname:$.author_nickname},S=0,E=0;$.problems.forEach(z=>{let C=-1;z.ac&&(S++,C=(new Date(z.ac).getTime()-p.getTime())/1e3,E+=C,E+=z.attempt*20*60);const x=z.index;T[`problem_${x}`]={acDuration:C,attempt:z.attempt}}),T.solved=S,T.penalty=E,I.push(T)}I.sort((j,$)=>j.solved!==$.solved?$.solved-j.solved:j.penalty-$.penalty);const h=s.v_members;let i=0,V=0,w=-1,U=-1;for(let j=0;j<I.length;j++)I[j].index=j+1,h&&h.includes(I[j].userId)?I[j].rank="*":(V++,(I[j].solved!==w||I[j].penalty!==U)&&(i=V,w=I[j].solved,U=I[j].penalty),I[j].rank=String(i));d.value=I}else _&&B(r,m.code)}catch(m){console.error(m),B(r,Te())}finally{b.value=!1}};return le(async()=>{o=xe(()=>a.query,async()=>{if(Array.isArray(a.params.contestId)?c=Number(a.params.contestId[0]):c=Number(a.params.contestId),!c){await n.push({name:"contest"});return}await u(!0)},{immediate:!0})}),Ie(()=>{o&&o()}),(_,m)=>{const s=ke,p=se,k=ve;return D(),M(k,null,{default:l(()=>[t(p,{style:{margin:"10px",width:"100%"}},{default:l(()=>[A("div",Io,[t(s,{data:d.value,columns:P.value,"row-key":"index","vertical-align":"middle",bordered:!0,hover:!0,"table-layout":"auto","rowspan-and-colspan":f,loading:b.value,class:"dida-contest-rank-table"},null,8,["data","columns","loading"])])]),_:1})]),_:1})}}}),To=ee(Po,[["__scopeId","data-v-a50beeb6"]]),xo={style:{margin:"10px"}},Vo={style:{margin:"12px"}},Lo={class:"dida-edit-container"},jo=Q({__name:"ContestEdit",setup(e){let a=ie();const{globalProperties:n}=oe(),r=Ue(),o=v(""),c=v(!1);let g=null;const y=v(!1),P=v(!1),b=v(null),d=v({title:"",openTime:[],private:!0,problems:[],members:[],description:"",notification:""}),f=v(""),u=v(""),_=v(!1),m=async()=>{_.value=!0,P.value=!1,_.value=!1},s=async()=>{if(g){y.value=!0;try{const h={title:d.value.title,description:g.getValue(),notification:d.value.notification,problems:d.value.problems,members:d.value.members,start_time:d.value.openTime[0],end_time:d.value.openTime[1],private:d.value.private},i=await In(h);if(y.value=!0,i.code!==0){B(n,i.code);return}i.data!=null&&await J.push({name:"contest-detail",params:{contestId:i.data}}),Ne(n,"创建成功")}finally{y.value=!1}}},p=async()=>{if(g){y.value=!0;try{const h={id:Number(o.value),title:d.value.title,private:d.value.private,problems:d.value.problems,members:d.value.members,description:g.getValue(),notification:d.value.notification};d.value.openTime[0]&&(h.start_time=new Date(d.value.openTime[0])),d.value.openTime[1]&&(h.end_time=new Date(d.value.openTime[1]));const i=await Pn(h);if(y.value=!0,i.code!==0){B(n,i.code);return}i.data!=null&&(b.value.updateTime=new Date(i.data).toLocaleString()),Ne(n,"保存成功")}finally{y.value=!1}}},k=h=>{const i={after:()=>{g==null||g.setValue(h),c.value=!1}};g=new re("contestEditDiv",i)},I=async()=>{const h=await kn(o.value);if(h.code!==0){B(n,h.code),console.error("contest get failed",h.code),await J.push({name:"contest-list"});return}const i=h.data.contest;b.value=await St(i),d.value.title=i.title,d.value.openTime=[],i.start_time?d.value.openTime.push(new Date(i.start_time)):d.value.openTime.push(""),i.end_time?d.value.openTime.push(new Date(i.end_time)):d.value.openTime.push(""),d.value.private=i.private,d.value.description=i.description||"",d.value.notification=i.notification||"",d.value.problems=h.data.problems,d.value.members=h.data.members,r.setTitle(i.title+" - "+r.getTitle);let V="";i.description&&(V=i.description),k(V)};return le(async()=>{Array.isArray(a.params.contestId)?o.value=a.params.contestId[0]:o.value=a.params.contestId,o.value?(c.value=!0,await I()):k("")}),(h,i)=>{const V=De,w=je,U=Wt,j=it,$=Le,T=se,S=be,E=G,z=pe,C=Ke,x=Ee,R=ve,O=we,N=ut,X=Me;return D(),Y(Z,null,[t(O,{loading:c.value},{default:l(()=>[t(R,null,{default:l(()=>[t(S,{span:8},{default:l(()=>[A("div",xo,[t(T,{class:"sh-card"},{default:l(()=>[t($,{model:d.value},{default:l(()=>[t(w,{label:"标题"},{default:l(()=>[t(V,{modelValue:d.value.title,"onUpdate:modelValue":i[0]||(i[0]=K=>d.value.title=K),placeholder:"比赛标题"},null,8,["modelValue"])]),_:1}),t(w,{label:"开启时间"},{default:l(()=>[t(U,{modelValue:d.value.openTime,"onUpdate:modelValue":i[1]||(i[1]=K=>d.value.openTime=K),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(w,{label:"通知"},{default:l(()=>[t(V,{modelValue:d.value.notification,"onUpdate:modelValue":i[2]||(i[2]=K=>d.value.notification=K),placeholder:"会更为醒目地提醒"},null,8,["modelValue"])]),_:1}),t(w,{label:"私有"},{default:l(()=>[t(j,{modelValue:d.value.private,"onUpdate:modelValue":i[3]||(i[3]=K=>d.value.private=K)},null,8,["modelValue"])]),_:1}),t(w,{label:"成员"},{default:l(()=>[t(ca,{modelValue:d.value.members,"onUpdate:modelValue":i[4]||(i[4]=K=>d.value.members=K)},null,8,["modelValue"])]),_:1}),t(w,{label:"问题"},{default:l(()=>[t(ua,{modelValue:d.value.problems,"onUpdate:modelValue":i[5]||(i[5]=K=>d.value.problems=K)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(S,{span:4},{default:l(()=>[A("div",Vo,[A("div",Lo,[o.value?(D(),M(z,{key:0},{default:l(()=>[t(E,{onClick:p,theme:"danger",loading:y.value},{default:l(()=>i[8]||(i[8]=[L("保存")])),_:1},8,["loading"])]),_:1})):(D(),M(z,{key:1},{default:l(()=>[t(E,{onClick:s,theme:"danger",loading:y.value},{default:l(()=>i[9]||(i[9]=[L("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(D(),M(x,{key:0,layout:"vertical",bordered:!0},{default:l(()=>[t(C,{label:"创建时间"},{default:l(()=>{var K;return[L(q((K=b.value)==null?void 0:K.createTime),1)]}),_:1}),t(C,{label:"更新时间"},{default:l(()=>{var K;return[L(q((K=b.value)==null?void 0:K.updateTime),1)]}),_:1}),t(C,{label:"创建用户"},{default:l(()=>{var K;return[L(q((K=b.value)==null?void 0:K.ownerNickname),1)]}),_:1})]),_:1})):te("",!0)])]),_:1})]),_:1}),i[10]||(i[10]=A("div",{id:"contestEditDiv",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"]),t(X,{visible:P.value,"onUpdate:visible":i[7]||(i[7]=K=>P.value=K),onConfirm:m,header:f.value,"confirm-loading":_.value},{default:l(()=>[i[11]||(i[11]=A("div",{style:{"margin-bottom":"10px"}},[A("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(N,{modelValue:u.value,"onUpdate:modelValue":i[6]||(i[6]=K=>u.value=K),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),At=ee(jo,[["__scopeId","data-v-2f54131b"]]);function da(e){const a={};return a.id=e.id,a.authorId=e.author_id,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.title=e.title,a.content=e.content,e.insert_time&&(a.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(a.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(a.updateTime=new Date(e.update_time).toLocaleString()),a.problemId=e.problem_id,a.problemTitle=e.problem_title,a.contestId=e.contest_id,a.contestTitle=e.contest_title,a.contestProblemIndex=e.contest_problem_index,a}async function Do(e){const a={};if(a.id=e.id,a.authorId=e.author_id,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.content="",e.content){const n={math:{inlineDigit:!0,engine:"KaTeX"}};a.content=await re.md2html(e.content,n)}return e.insert_time&&(a.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(a.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(a.updateTime=new Date(e.update_time).toLocaleString()),a}function $o(e){return W({url:"/discuss?id="+e,method:"get"})}function zo(e,a,n,r,o,c){const g={};return e&&(g.contest_id=e),a&&(g.problem_id=a),n&&(g.title=n),r&&(g.username=r),o&&(g.page=o),c&&(g.page_size=c),W({url:`/discuss/list?${new URLSearchParams(g).toString()}`,method:"get"})}function Uo(e,a,n){return W({url:"/discuss/comment/list?id="+e+"&page="+a+"&page_size="+n,method:"get"})}function Ao(e){return W({url:"/discuss/create",method:"post",data:e})}const ma=async(e,a)=>{a&&await e.push({name:"user",params:{username:a}})},Ro={style:{margin:"10px"}};function Eo(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!qe(e)}const Ko=Q({__name:"DiscussList",setup(e){const a=ie(),n=Re(),{globalProperties:r}=oe();let o=null;const c=v(!1),g=v(!1);let y=-1;const P=v([]),b=[],d=[{title:"标题",colKey:"title",cell:(T,S)=>t(G,{variant:"text",onClick:()=>i(S.row.id)},{default:()=>[S.row.title]})},{title:"创建人",colKey:"authorNickname",width:"200",cell:(T,S)=>t(G,{variant:"text",onClick:async()=>await ma(n,S.row.authorUsername)},{default:()=>[S.row.authorNickname]})},{title:"创建时间",colKey:"insertTime",width:"180"},{title:"更新时间",colKey:"updateTime",width:"180"}],f=v(!1);let u=1,_=50;const m=v({current:u,pageSize:_,defaultCurrent:u,defaultPageSize:_,total:0,pageSizeOptions:[50,100]}),s=v(),p=v({problemId:"",title:"",username:""}),k=v({title:"",content:""}),I=T=>{T&&n.push({name:"problem-detail",params:{problemId:T}})},h=(T,S)=>{n.push({name:"contest-problem-detail",params:{contestId:T,problemIndex:S}})},i=T=>{if(T){if(y){n.push({name:"contest-discuss-detail",params:{contestId:y,discussId:T}});return}n.push({name:"discuss-detail",params:{discussId:T}})}},V=async()=>{await n.push({query:{...a.query,problem_id:p.value.problemId,title:p.value.title,username:p.value.username,page:1,page_size:m.value.defaultPageSize}})},w=async(T,S)=>{var E;f.value=!0;try{const{current:z,pageSize:C}=T,x=await zo(y,p.value.problemId,p.value.title,p.value.username,z,C);if(s.value=[],x.code===0){if(x.data.list){const R=x.data.list;for(let O=0;O<R.length;O++){const N=R[O],X=await da(N);(E=s.value)==null||E.push(X)}}m.value={...m.value,total:x.data.total_count}}else S&&B(r,x.code)}catch(z){console.error(z),B(r,Te())}finally{f.value=!1}},U=async T=>{await n.push({query:{...a.query,page:T.current,page_size:T.pageSize}})},j=()=>{c.value=!0},$=async()=>{g.value=!0,console.log("discussCreateForm",k.value),Ao(k.value).then(T=>{T.code===0?(_e(r,"创建比赛成功"),c.value=!1,n.push({path:"/discuss/"+T.data.id})):B(r,T.code)}).finally(()=>{g.value=!1})};return le(async()=>{o=xe(()=>a.query,T=>{Array.isArray(a.params.contestId)?y=Number(a.params.contestId[0]):y=Number(a.params.contestId),P.value=b,y?P.value=P.value.concat([{title:"问题ID",colKey:"contestProblemIndex",width:"100",cell:(z,C)=>{let x;return C.row.contestProblemIndex?t(G,{variant:"text",onClick:()=>h(y,C.row.contestProblemIndex)},Eo(x=Oe(C.row.contestProblemIndex))?x:{default:()=>[x]}):""}}]):P.value=P.value.concat([{title:"问题ID",colKey:"problemId",width:"100",cell:(z,C)=>C.row.problemId?t(G,{variant:"text",onClick:()=>I(C.row.problemId)},{default:()=>[C.row.problemId]}):""}]),P.value=P.value.concat(d),p.value.problemId=T.problem_id||"",p.value.title=T.title||"",p.value.username=T.username||"";const S=parseInt(T.page)||m.value.defaultCurrent,E=parseInt(T.page_size)||m.value.defaultPageSize;u=S,_=E,m.value={...m.value,current:u,pageSize:_},w({current:u,pageSize:_},!0)},{immediate:!0})}),Ie(()=>{o&&o()}),(T,S)=>{const E=ke,z=se,C=be,x=De,R=je,O=G,N=Le,X=pe,K=ve,ne=Me;return D(),Y(Z,null,[t(K,null,{default:l(()=>[t(C,{span:9},{default:l(()=>[t(z,{style:{margin:"10px"}},{default:l(()=>[t(E,{data:s.value,columns:P.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:m.value,loading:f.value,"table-layout":"auto",onPageChange:U},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(C,{span:3},{default:l(()=>[A("div",Ro,[t(z,{class:"sh-card"},{default:l(()=>[t(N,{model:p.value},{default:l(()=>[t(R,{label:"问题ID"},{default:l(()=>[t(x,{modelValue:p.value.problemId,"onUpdate:modelValue":S[0]||(S[0]=H=>p.value.problemId=H),placeholder:"请输入完整问题ID"},null,8,["modelValue"])]),_:1}),t(R,{label:"标题"},{default:l(()=>[t(x,{modelValue:p.value.title,"onUpdate:modelValue":S[1]||(S[1]=H=>p.value.title=H),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(R,{label:"创建人"},{default:l(()=>[t(x,{modelValue:p.value.username,"onUpdate:modelValue":S[2]||(S[2]=H=>p.value.username=H),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(R,null,{default:l(()=>[t(O,{theme:"primary",onClick:V},{default:l(()=>S[6]||(S[6]=[L("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(z,{class:"sh-card"},{default:l(()=>[t(X,null,{default:l(()=>[t(O,{onClick:j},{default:l(()=>S[7]||(S[7]=[L("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),t(ne,{visible:c.value,"onUpdate:visible":S[5]||(S[5]=H=>c.value=H),header:"创建讨论",onConfirm:$,"confirm-loading":g.value},{default:l(()=>[t(N,{"label-width":80,model:k.value,onSubmit:S[4]||(S[4]=nt(()=>{},["prevent"]))},{default:l(()=>[t(R,{label:"标题"},{default:l(()=>[t(x,{modelValue:k.value.title,"onUpdate:modelValue":S[3]||(S[3]=H=>k.value.title=H),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),tt=ee(Ko,[["__scopeId","data-v-428fc50f"]]),qo={key:0,style:{margin:"20px"}},Mo=["innerHTML"],Fo=["innerHTML"],No={style:{margin:"10px"}},Go={style:{margin:"10px"}},Oo={style:{margin:"10px","text-align":"right"}},Ho={style:{margin:"12px"}},Bo={key:0,class:"dida-edit-container"},Jo=Q({__name:"DiscussDetail",props:{discussId:{}},setup(e){const a=e;let n=ie();const{globalProperties:r}=oe();let o=null;const c=Ue(),g=Se();let y=v("");const P=v(""),b=v(null),d=v(!1),f=v(null),u=v(!1);let _=1,m=20;const s=v({current:1,total:0,defaultPageSize:m,defaultCurrent:_,pageSizeOptions:[20,50]}),p=v([]),k={},I=Ae(()=>g.hasAuth($e.ManageDiscuss)),h=$=>{$&&J.push({name:"discuss-list",query:{...n.query,title:"",tag:$.name}})},i=()=>{J.push({name:"manage-discuss",params:{discussId:P.value}})},V=()=>t("div",{class:"t-pagination__total"},[`共 ${s.value.total} 条回复`]),w=()=>{},U=async($,T)=>{var S;u.value=!0;try{const{current:E,pageSize:z}=$,C=await Uo(P.value,E,z);if(p.value=[],C.code===0){const x=C.data.list;if(x)for(let R=0;R<x.length;R++){const O=x[R],N=await Do(O);(S=p.value)==null||S.push(N),await ze(()=>{const X=document.querySelectorAll(".dida-discuss-content");X&&X.length>0&&X.forEach(K=>{re.mathRender(K),re.highlightRender({lineNumber:!0,enable:!0},K),Ge(K)})})}s.value={...s.value,total:C.data.total_count}}else T&&B(r,C.code)}catch(E){console.error(E),B(r,Te())}finally{u.value=!1}},j=async $=>{await J.push({query:{...n.query,page:$.current,page_size:$.pageSize}})};return le(async()=>{if(P.value=a.discussId,P.value||(Array.isArray(n.params.discussId)?P.value=n.params.discussId[0]:P.value=n.params.discussId),!P.value){ce(r,"讨论不存在"),await J.push({name:"discuss"});return}d.value=!0;const $=await $o(P.value);if($.code!==0){d.value=!1,B(r,$.code),await J.push({name:"discuss"});return}$.data.tags&&$.data.tags.forEach(z=>{k[z.id]=z}),f.value=da($.data.discuss),c.setTitle(f.value.title+" - "+c.getTitle);let T=f.value.content;const S={math:{inlineDigit:!0,engine:"KaTeX"}};y.value=await re.md2html(T,S),await ze(()=>{b.value&&(re.mathRender(b.value),re.highlightRender({lineNumber:!0,enable:!0},b.value),Ge(b.value)),d.value=!1}),o=xe(()=>n.query,z=>{const C=parseInt(z.page)||s.value.defaultCurrent,x=parseInt(z.page_size)||s.value.defaultPageSize;_=C,m=x,s.value={...s.value,current:_,pageSize:m},U({current:_,pageSize:m},!0)},{immediate:!0});const E={after:()=>{}};new re("commentEditRef",E)}),Ie(()=>{o&&o()}),($,T)=>{const S=Bt,E=Ht,z=se,C=pe,x=qa,R=G,O=be,N=Ke,X=Ee,K=ve,ne=we;return D(),M(ne,{loading:d.value},{default:l(()=>[t(K,{class:"dida-main-content"},{default:l(()=>[t(O,{span:8},{default:l(()=>{var H,ge,Ve;return[(H=f.value)!=null&&H.problemTitle||(ge=f.value)!=null&&ge.contestTitle?(D(),Y("div",qo,[t(E,{"max-item-width":"300"},{default:l(()=>{var fe,ae,ue,F,he;return[(fe=f.value)!=null&&fe.contestTitle?(D(),Y(Z,{key:0},[t(S,{to:{name:"contest-detail",params:{contestId:(ae=f.value)==null?void 0:ae.contestId}}},{default:l(()=>{var Ce;return[L(q((Ce=f.value)==null?void 0:Ce.contestTitle),1)]}),_:1},8,["to"]),(ue=f.value)!=null&&ue.contestProblemIndex?(D(),M(S,{key:0,to:{name:"contest-problem-detail",params:{problemIndex:(F=f.value)==null?void 0:F.contestProblemIndex}}},{default:l(()=>{var Ce,We;return[L(q(de(Oe)((Ce=f.value)==null?void 0:Ce.contestProblemIndex))+" - "+q((We=f.value)==null?void 0:We.problemTitle),1)]}),_:1},8,["to"])):te("",!0)],64)):(D(),Y(Z,{key:1},[t(S,{to:{name:"discuss-list-problem"}},{default:l(()=>T[3]||(T[3]=[L(" 问题讨论")])),_:1}),t(S,{to:{name:"problem-detail",params:{problemId:(he=f.value)==null?void 0:he.problemId}}},{default:l(()=>{var Ce;return[L(q((Ce=f.value)==null?void 0:Ce.problemTitle),1)]}),_:1},8,["to"])],64))]}),_:1})])):te("",!0),t(z,{style:{margin:"10px"},header:(Ve=f.value)==null?void 0:Ve.title,"header-bordered":!0},{default:l(()=>[A("div",{innerHTML:de(y),class:"dida-discuss-content"},null,8,Mo)]),_:1},8,["header"]),(D(!0),Y(Z,null,me(p.value,(fe,ae)=>(D(),M(z,{key:ae,style:{margin:"10px"},"header-bordered":""},{header:l(()=>[t(C,null,{default:l(()=>[A("span",null,q(fe.authorNickname),1),A("span",null,q(fe.insertTime),1)]),_:2},1024)]),default:l(()=>[A("div",{innerHTML:fe.content,class:"dida-discuss-content"},null,8,Fo)]),_:2},1024))),128)),A("div",No,[t(x,{modelValue:s.value.current,"onUpdate:modelValue":T[0]||(T[0]=fe=>s.value.current=fe),"page-size":s.value.pageSize,"onUpdate:pageSize":T[1]||(T[1]=fe=>s.value.pageSize=fe),total:s.value.total,"page-size-options":s.value.pageSizeOptions,"show-page-size":!1,"total-content":V,onChange:j},null,8,["modelValue","page-size","total","page-size-options"])]),A("div",Go,[T[5]||(T[5]=A("div",{id:"commentEditRef",class:"dida-comment-editor"},null,-1)),A("div",Oo,[t(C,null,{default:l(()=>[t(R,{theme:"primary",onClick:w},{default:l(()=>T[4]||(T[4]=[L("提交")])),_:1})]),_:1})])])]}),_:1}),t(O,{span:4},{default:l(()=>[A("div",Ho,[I.value?(D(),Y("div",Bo,[t(R,{onClick:i},{default:l(()=>T[6]||(T[6]=[L("编辑")])),_:1})])):te("",!0),t(X,{layout:"vertical",bordered:!0},{default:l(()=>[t(N,{label:"创建时间"},{default:l(()=>{var H;return[L(q((H=f.value)==null?void 0:H.insertTime),1)]}),_:1}),t(N,{label:"编辑时间"},{default:l(()=>{var H;return[L(q((H=f.value)==null?void 0:H.modifyTime),1)]}),_:1}),t(N,{label:"更新时间"},{default:l(()=>{var H;return[L(q((H=f.value)==null?void 0:H.updateTime),1)]}),_:1}),t(N,{label:"创建用户"},{default:l(()=>[t(R,{variant:"text",onClick:T[2]||(T[2]=async()=>{var H;return await de(ma)(de(J),(H=f.value)==null?void 0:H.authorUsername)})},{default:l(()=>{var H;return[L(q((H=f.value)==null?void 0:H.authorNickname),1)]}),_:1})]),_:1}),t(N,{label:"标签"},{default:l(()=>[t(C,null,{default:l(()=>{var H;return[(D(!0),Y(Z,null,me((H=f.value)==null?void 0:H.tags,ge=>(D(),M(R,{key:ge.id,variant:"dashed",onClick:()=>h(ge)},{default:l(()=>[L(q(ge.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),dt=ee(Jo,[["__scopeId","data-v-03948cc8"]]);function Wo(e,a){return W({url:"/rank/ac/all?page="+e+"&page_size="+a,method:"get"})}function Yo(e,a){return W({url:"/rank/ac/problem?page="+e+"&page_size="+a,method:"get"})}function Xo(e,a){return W({url:"/rank/ac/problem/today?page="+e+"&page_size="+a,method:"get"})}function Zo(e,a){return W({url:"/rank/ac/problem/day7?page="+e+"&page_size="+a,method:"get"})}function Qo(e,a){return W({url:"/rank/ac/problem/year?page="+e+"&page_size="+a,method:"get"})}const es={style:{margin:"10px"}};function mt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!qe(e)}const ts=Q({__name:"RankUser",props:{type:{}},setup(e){const a=ie(),n=Re(),{globalProperties:r}=oe();let o=null;const c=e,g=v(""),y=v(""),P={all:{header:"统计所有用户在本站的提交记录",content:"优先以AC记录数量排序，如果相同则提交所用次数较少的优先，如果仍相同，注册较早的用户靠前"},problem:{header:"统计所有用户在本站的提交记录",content:"以题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-today":{header:"统计所有用户今日在本站的提交记录",content:"以今日题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-day7":{header:"统计所有用户最近7日在本站的提交记录",content:"以7日题目记录数量排序（从7日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-year":{header:"统计所有用户最近1年在本站的提交记录",content:"以最近1年题目记录数量排序（从365日前的0点开始计算），如果相同，注册较早的用户靠前"}},b=v([]),d=[{title:"序号",colKey:"index"},{title:"用户名",colKey:"username",cell:(U,j)=>t(G,{variant:"dashed",onClick:()=>I(j.row.username)},{default:()=>[j.row.username]})},{title:"昵称",colKey:"nickname"},{title:"Slogan",colKey:"slogan"}],f=[{title:"题目数量",colKey:"problem_count",cell:(U,j)=>{let $=0;return j.row.problem_count&&($=j.row.problem_count),t(G,{variant:"dashed",onClick:()=>h(j.row.username)},mt($)?$:{default:()=>[$]})}}],u=[{title:"正确",colKey:"accept",cell:(U,j)=>{let $=0;return j.row.accept&&($=j.row.accept),t(G,{variant:"dashed",onClick:()=>h(j.row.username)},mt($)?$:{default:()=>[$]})}},{title:"提交",colKey:"attempt",cell:(U,j)=>{let $=0;return j.row.attempt&&($=j.row.attempt),t(G,{variant:"dashed",onClick:()=>i(j.row.username)},mt($)?$:{default:()=>[$]})}}],_=v(!1);let m=1,s=50;const p=v({current:m,pageSize:s,defaultCurrent:m,defaultPageSize:s,total:0,pageSizeOptions:[50]}),k=v(),I=U=>{n.push({name:"user",params:{username:U}})},h=U=>{n.push({name:"judge-list",query:{username:U,status:Pe.Accept}})},i=U=>{n.push({name:"judge-list",query:{username:U}})},V=async(U,j)=>{_.value=!0;try{k.value=[];const{current:$,pageSize:T}=U;let S=null;switch(c.type){case"problem":S=await Yo($,T);break;case"problem-today":S=await Xo($,T);break;case"problem-day7":S=await Zo($,T);break;case"problem-year":S=await Qo($,T);break;default:S=await Wo($,T);break}if(S.code===0){const E=S.data.list;if(!E||E.length<=0){p.value={...p.value,total:0},_e(r,"未找到记录");return}k.value=[];const z=p.value.pageSize*(p.value.current-1);let C=1;E.forEach(x=>{var O;const R=x;R.index=z+C++,(O=k.value)==null||O.push(R)}),p.value={...p.value,total:S.data.total_count}}else j&&B(r,S.code)}catch($){console.error($),B(r,Te())}finally{_.value=!1}},w=async U=>{await n.push({query:{...a.query,page:U.current,page_size:U.pageSize}})};return le(async()=>{_.value=!0,o=xe(()=>a.query,U=>{switch(c.type&&P[c.type]?(g.value=P[c.type].header,y.value=P[c.type].content):(g.value=P.all.header,y.value=P.all.content),c.type){case"all":b.value=d.concat(u);break;default:b.value=d.concat(f);break}const j=parseInt(U.page)||p.value.defaultCurrent,$=parseInt(U.page_size)||p.value.defaultPageSize;m=j,s=$,p.value={...p.value,current:m,pageSize:s},V({current:m,pageSize:s},!0)},{immediate:!0})}),Ie(()=>{o&&o()}),(U,j)=>{const $=ke,T=se,S=be,E=ve;return D(),M(E,null,{default:l(()=>[t(S,{span:9},{default:l(()=>[t(T,{style:{margin:"10px"}},{default:l(()=>[t($,{data:k.value,columns:b.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:p.value,loading:_.value,"table-layout":"auto",onPageChange:w},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(S,{span:3},{default:l(()=>[A("div",es,[t(T,{class:"sh-card",header:g.value,"header-bordered":!0},{default:l(()=>[L(q(y.value),1)]),_:1},8,["header"])])]),_:1})]),_:1})}}}),Ye=ee(ts,[["__scopeId","data-v-9bbfd60b"]]),as=Q({__name:"ManageJudge",setup(e){const{globalProperties:a}=oe(),n=v(!1),r=v(!1),o=v({problemId:"",language:void 0,status:void 0}),c=v(!1),g=v([]);g.value=kt();const y=v([]);y.value=na();const P=async()=>{n.value=!0;try{const f=await ln();if(f.code!==0){B(a,f.code);return}_e(a,"重判成功"),await J.push({name:"judge-list"})}catch(f){console.error(f),B(a,"重判失败")}finally{n.value=!1}},b=async()=>{if(!o.value.problemId&&!o.value.language&&!o.value.status){B(a,"请输入问题Id");return}c.value=!0;try{const f=await nn(o.value.problemId,o.value.language,o.value.status);if(f.code!==0){B(a,f.code);return}_e(a,"重判成功"),await J.push({name:"judge-list",query:{problem_id:o.value.problemId,language:o.value.language}})}catch(f){console.error(f),B(a,"重判失败")}finally{c.value=!1}},d=async()=>{r.value=!0;try{const f=await on();if(f.code!==0){B(a,f.code);return}_e(a,"重判成功"),await J.push({name:"judge-list"})}catch(f){console.error(f),B(a,"重判失败")}finally{r.value=!1}};return(f,u)=>{const _=G,m=se,s=De,p=je,k=ht,I=rt,h=pe,i=Le;return D(),Y(Z,null,[t(m,{class:"yj-manage-card",title:"重判最近提交"},{default:l(()=>[t(_,{onClick:P,loading:n.value},{default:l(()=>u[3]||(u[3]=[L("重判")])),_:1},8,["loading"])]),_:1}),t(m,{class:"yj-manage-card",title:"重判指定记录"},{default:l(()=>[t(i,{layout:"inline",onSubmit:b},{default:l(()=>[t(p,{label:"题号"},{default:l(()=>[t(s,{modelValue:o.value.problemId,"onUpdate:modelValue":u[0]||(u[0]=V=>o.value.problemId=V),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(p,{label:"语言"},{default:l(()=>[t(I,{modelValue:o.value.language,"onUpdate:modelValue":u[1]||(u[1]=V=>o.value.language=V),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:l(()=>[(D(!0),Y(Z,null,me(g.value,V=>(D(),M(k,{key:V.value,value:V.value,label:V.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"状态"},{default:l(()=>[t(I,{modelValue:o.value.status,"onUpdate:modelValue":u[2]||(u[2]=V=>o.value.status=V),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:l(()=>[(D(!0),Y(Z,null,me(y.value,V=>(D(),M(k,{key:V.value,value:V.value,label:V.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(p,null,{default:l(()=>[t(h,null,{default:l(()=>[t(_,{theme:"primary",type:"submit",loading:c.value},{default:l(()=>u[4]||(u[4]=[L("重判")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(m,{class:"yj-manage-card",title:"重判所有"},{default:l(()=>[t(_,{onClick:d,theme:"danger",loading:r.value},{default:l(()=>u[5]||(u[5]=[L("重判")])),_:1},8,["loading"])]),_:1})],64)}}}),ls=ee(as,[["__scopeId","data-v-6a706c72"]]),ns={style:{margin:"10px"}},os={key:1},ss={style:{margin:"12px"}},rs={class:"dida-edit-container"},is=Q({__name:"ProblemEdit",setup(e){let a=ie();const{globalProperties:n}=oe(),r=Ue(),o=v(""),c=v(!1);let g=null;const y=v(!1),P=v(null),b=v({title:"",timeLimit:0,memoryLimit:0,source:"",private:!0,tags:[]}),d=v([]),f=v([]),u=Ae(()=>{const V=[],w=d.value;for(let U=0,j=w.length;U<j;U++)w[U].value&&V.push(w[U].value);return V}),_=(V,w)=>{const{trigger:U,index:j,item:$}=w;if(U==="clear"&&(d.value=[]),["tag-remove","backspace"].includes(U)&&d.value.splice(j,1),U==="enter"){for(let S=0;S<f.value.length;S++){const E=f.value[S];if(E.label===$){for(let z=0;z<d.value.length;z++)if(d.value[z].label===E.label)return;d.value.push(E);return}}const T={label:$,value:$};d.value.push(T),f.value=f.value.concat(T)}},m=(V,{current:w,type:U})=>{if(!w){d.value=U==="check"?f.value.slice(1):[];return}if(U==="check"){const j=f.value.find($=>$.value===w);if(!j)return;d.value.push(j)}else d.value=d.value.filter(j=>j.value!==w)},s=()=>{J.push({name:"problem-detail",params:{problemId:o.value}})},p=()=>{J.push({name:"manage-problem-judge",params:{problemId:o.value}})},k=async()=>{if(g){y.value=!0,b.value.tags=[];for(let V=0;V<d.value.length;V++){const w=d.value[V];w&&w.label&&b.value.tags.push(w.label)}try{const V=await dn(b.value.title,b.value.timeLimit,b.value.memoryLimit,b.value.source,b.value.private,b.value.tags,g.getValue());if(y.value=!0,V.code!==0){B(n,V.code);return}V.data!=null&&await J.push({name:"problem-detail",params:{problemId:V.data}}),Ne(n,"创建成功")}finally{y.value=!1}}},I=async()=>{if(g){y.value=!0,b.value.tags=[];for(let V=0;V<d.value.length;V++){const w=d.value[V];w&&w.label&&b.value.tags.push(w.label)}try{const V=await mn(o.value,b.value.title,b.value.timeLimit,b.value.memoryLimit,b.value.source,b.value.private,b.value.tags,g.getValue());if(y.value=!0,V.code!==0){B(n,V.code);return}V.data!=null&&(P.value.updateTime=new Date(V.data).toLocaleString()),Ne(n,"保存成功")}finally{y.value=!1}}},h=V=>{const w={after:()=>{g==null||g.setValue(V),c.value=!1}};g=new re("problemEditDiv",w)},i=async()=>{const V=await sa(o.value,void 0,void 0);if(V.code!==0){B(n,V.code),console.error("problem get failed",V.code),await J.push({name:"problem"});return}const w=V.data.problem;if(P.value=Ze(w,{}),b.value.title=w.title,b.value.timeLimit=w.time_limit,b.value.memoryLimit=w.memory_limit,b.value.source=w.source,b.value.private=w.private,b.value.tags=[],d.value=[],V.data.tags)for(let j=0;j<V.data.tags.length;j++){const $=V.data.tags[j];$&&$.name&&(b.value.tags.push($.name),d.value.push({label:$.name,value:$.id}))}r.setTitle(w.title+" - "+r.getTitle);let U=w.description;h(U)};return le(async()=>{Array.isArray(a.params.problemId)?o.value=a.params.problemId[0]:o.value=a.params.problemId,o.value?(c.value=!0,ra(-1).then(async V=>{V.code===0?(V.data.list&&V.data.list.forEach(w=>{f.value.push({label:w.name,value:w.id})}),await i()):(B(n,V.code),console.error("problem tag get failed",V.code),await J.push({name:"problem"}))}).catch(async V=>{console.error(V),B(n,"获取数据异常"),await J.push({name:"problem"})})):(b.value.timeLimit=1e3,b.value.memoryLimit=65536,h(""))}),(V,w)=>{const U=De,j=je,$=Ma,T=it,S=Na,E=Fa,z=Le,C=se,x=be,R=G,O=pe,N=Ke,X=Ee,K=ve,ne=we;return D(),M(ne,{loading:c.value},{default:l(()=>[t(K,null,{default:l(()=>[t(x,{span:8},{default:l(()=>[A("div",ns,[t(C,{class:"sh-card"},{default:l(()=>[t(z,{model:b.value},{default:l(()=>[t(j,{label:"标题"},{default:l(()=>[t(U,{modelValue:b.value.title,"onUpdate:modelValue":w[0]||(w[0]=H=>b.value.title=H),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),t(j,{label:"时间限制"},{default:l(()=>[t($,{modelValue:b.value.timeLimit,"onUpdate:modelValue":w[1]||(w[1]=H=>b.value.timeLimit=H),theme:"normal",min:0},{suffix:l(()=>w[5]||(w[5]=[A("span",null,"ms",-1)])),_:1},8,["modelValue"])]),_:1}),t(j,{label:"内存限制"},{default:l(()=>[t($,{modelValue:b.value.memoryLimit,"onUpdate:modelValue":w[2]||(w[2]=H=>b.value.memoryLimit=H),theme:"normal",min:0},{suffix:l(()=>w[6]||(w[6]=[A("span",null,"KB",-1)])),_:1},8,["modelValue"])]),_:1}),t(j,{label:"来源"},{default:l(()=>[t(U,{modelValue:b.value.source,"onUpdate:modelValue":w[3]||(w[3]=H=>b.value.source=H),placeholder:"请输入题目来源"},null,8,["modelValue"])]),_:1}),t(j,{label:"私有"},{default:l(()=>[t(T,{modelValue:b.value.private,"onUpdate:modelValue":w[4]||(w[4]=H=>b.value.private=H)},null,8,["modelValue"])]),_:1}),t(j,{label:"标签"},{default:l(()=>[t(E,{value:d.value,"allow-input":!0,placeholder:"请选择或输入","tag-input-props":{excessTagsDisplayType:"break-line"},"popup-props":{overlayInnerClassName:["narrow-scrollbar"],overlayInnerStyle:{maxHeight:"280px",overflowY:"auto",overscrollBehavior:"contain",padding:"6px"}},clearable:"",multiple:"",onTagChange:_},{panel:l(()=>[f.value.length?(D(),M(S,{key:0,value:u.value,options:f.value,onChange:m},null,8,["value","options"])):(D(),Y("div",os,"暂无数据"))]),suffixIcon:l(()=>[t(de(ka))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(x,{span:4},{default:l(()=>[A("div",ss,[A("div",rs,[o.value?(D(),M(O,{key:0},{default:l(()=>[t(R,{onClick:I,theme:"danger",loading:y.value},{default:l(()=>w[7]||(w[7]=[L("保存")])),_:1},8,["loading"]),t(R,{onClick:p,theme:"warning"},{default:l(()=>w[8]||(w[8]=[L("判题数据")])),_:1}),t(R,{onClick:s},{default:l(()=>w[9]||(w[9]=[L("查看")])),_:1})]),_:1})):(D(),M(O,{key:1},{default:l(()=>[t(R,{onClick:k,theme:"danger",loading:y.value},{default:l(()=>w[10]||(w[10]=[L("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(D(),M(X,{key:0,layout:"vertical",bordered:!0},{default:l(()=>[t(N,{label:"创建时间"},{default:l(()=>{var H;return[L(q((H=P.value)==null?void 0:H.insertTime),1)]}),_:1}),t(N,{label:"更新时间"},{default:l(()=>{var H;return[L(q((H=P.value)==null?void 0:H.updateTime),1)]}),_:1}),t(N,{label:"判题方式"},{default:l(()=>{var H;return[L(q((H=P.value)==null?void 0:H.judgeType),1)]}),_:1}),t(N,{label:"上传用户"},{default:l(()=>{var H;return[L(q((H=P.value)==null?void 0:H.creatorNickname),1)]}),_:1})]),_:1})):te("",!0)])]),_:1})]),_:1}),w[11]||(w[11]=A("div",{id:"problemEditDiv",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"])}}}),Rt=ee(is,[["__scopeId","data-v-583e6955"]]),us={style:{margin:"10px"}},cs={style:{margin:"12px"}},ds={class:"dida-edit-container"},ms=Q({__name:"ProblemJudge",setup(e){let a=ie();const{globalProperties:n}=oe(),r=Ue(),o=v(""),c=v(!1),g=v(null);let y=null;const P=v(null),b=v(""),d=v(!1),f=v(!1),u=v([{title:"文件",colKey:"file"},{title:"大小",colKey:"size",width:150,cell:(T,S)=>S.row.size.toFixed(0)+" B"},{title:"最后修改时间",colKey:"lastModified",width:180,cell:(T,S)=>new Date(S.row.lastModified).toLocaleString()},{title:"操作",colKey:"action",width:100,cell:(T,S)=>t(G,{onClick:()=>I(S.row.file)},{default:()=>[L("下载")]})}]),_=v([]),m=Ae(()=>({border:"2px dashed #ccc",borderRadius:"6px",padding:"20px",textAlign:"center",cursor:"pointer",backgroundColor:d.value?"#f0f9ff":"#fff",transition:"background-color 0.2s ease"})),s=Ae(()=>b.value?`已选择：${b.value}`:d.value?"松开文件以上传":"拖拽文件到这里，或点击选择文件"),p=()=>{J.push({name:"problem-detail",params:{problemId:o.value}})},k=()=>{J.push({name:"manage-problem",params:{problemId:o.value}})},I=async T=>{const S=await pn(o.value,T);if(S.code!==0){B(n,S.code);return}const E=document.createElement("a");E.href=S.data,E.target="_blank",E.click(),URL.revokeObjectURL(E.href)},h=async()=>{if(!y){ce(n,"请选择压缩包");return}f.value=!0,fn(o.value,y).then(async T=>{T.code==0?(P.value.value=null,y=null,b.value="",c.value=!0,Ne(n,"上传成功"),await $()):B(n,T.code)}).catch(T=>{console.log(T),n.$message.error({duration:3e3,content:"申请失败"})}).finally(()=>{f.value=!1})},i=()=>{var T;(T=P.value)==null||T.click()},V=T=>{const S=T.target.files[0];S&&(b.value=S.name,y=S)},w=T=>{d.value=!0},U=()=>{d.value=!1},j=T=>{T.preventDefault(),T.stopPropagation(),d.value=!1;const S=T.dataTransfer.files[0];if(S){b.value=S.name;const E=new DataTransfer;E.items.add(S),P.value.files=E.files,y=S}},$=async()=>{const T=await rn(o.value);if(T.code!==0){B(n,T.code),await J.push({name:"problem"});return}const S=T.data.problem;g.value=Ze(S,{}),r.setTitle(S.title+" - "+r.getTitle),_.value=[],T.data.judges?T.data.judges.forEach(E=>{_.value.push({file:E.key,size:E.size,lastModified:E.last_modified})}):ce(n,"评测数据不存在"),c.value=!1};return le(async()=>{if(Array.isArray(a.params.problemId)?o.value=a.params.problemId[0]:o.value=a.params.problemId,!o.value){ce(n,"题目不存在"),await J.push({name:"problem"});return}c.value=!0,await $()}),(T,S)=>{const E=ke,z=be,C=G,x=pe,R=Ke,O=Ee,N=ve,X=we;return D(),M(X,{loading:c.value},{default:l(()=>[t(N,null,{default:l(()=>[t(z,{span:7},{default:l(()=>[A("div",us,[A("div",{id:"drop-zone",style:Nt(m.value),onClick:i,onDragenter:nt(w,["prevent"]),onDragover:S[0]||(S[0]=nt(()=>{},["prevent"])),onDragleave:nt(U,["prevent"]),onDrop:j},[A("input",{ref_key:"fileInput",ref:P,type:"file",style:{display:"none"},onChange:V},null,544),L(" "+q(s.value),1)],36)]),t(E,{data:_.value,columns:u.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1}),t(z,{span:5},{default:l(()=>[A("div",cs,[A("div",ds,[t(x,null,{default:l(()=>[t(C,{onClick:h,theme:"danger",loading:f.value},{default:l(()=>S[1]||(S[1]=[L("上传")])),_:1},8,["loading"]),t(C,{onClick:k,theme:"warning"},{default:l(()=>S[2]||(S[2]=[L("编辑")])),_:1}),t(C,{onClick:p},{default:l(()=>S[3]||(S[3]=[L("查看")])),_:1})]),_:1})]),t(O,{layout:"vertical",bordered:!0},{default:l(()=>[t(R,{label:"标题"},{default:l(()=>{var K;return[L(q((K=g.value)==null?void 0:K.title),1)]}),_:1}),t(R,{label:"创建时间"},{default:l(()=>{var K;return[L(q((K=g.value)==null?void 0:K.insertTime),1)]}),_:1}),t(R,{label:"更新时间"},{default:l(()=>{var K;return[L(q((K=g.value)==null?void 0:K.updateTime),1)]}),_:1}),t(R,{label:"判题方式"},{default:l(()=>{var K;return[L(q((K=g.value)==null?void 0:K.judgeType),1)]}),_:1}),t(R,{label:"评测数据"},{default:l(()=>{var K;return[L(q((K=g.value)==null?void 0:K.judgeMd5),1)]}),_:1}),t(R,{label:"上传用户"},{default:l(()=>{var K;return[L(q((K=g.value)==null?void 0:K.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),ps=ee(ms,[["__scopeId","data-v-17986e38"]]),fs={style:{display:"flex","align-items":"center"}},_s={style:{color:"#409eff","margin-right":"20px"}},vs={class:"dida-login-footer"},gs=Q({__name:"UserForget",setup(e){const{globalProperties:a}=oe(),n=Se(),r=v(!1),o=v(!1),c=v(!1),g=v("发送验证码");let y=null,P=-1;const b=v(!1),d=v(null),f=v(""),u=v({username:"",emailKey:"",password:"",confirmPassword:""}),m=v({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:V=>new Promise(w=>{const U=setTimeout(()=>{w(u.value.password===V),clearTimeout(U)})}),message:"两次密码不一致"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),s=()=>{_e(a,"重置成功")},p=async V=>{if(!c.value){r.value=!0,o.value=!0;try{const w=await zl(V,u.value.username);w.code===0?(_e(a,"验证码发送成功"),f.value=w.data,o.value=!1,c.value=!0,y=new Date,g.value="60秒后重发",P=setInterval(()=>{const j=Math.floor((new Date().getTime()-(y==null?void 0:y.getTime()))/1e3);j>60?(g.value="发送验证码",c.value=!1,clearInterval(P)):g.value=`${60-j}秒后重发`},1e3)):B(a,w.code)}catch(w){console.error("Send email key error",w),ce(a,"发送验证码失败")}finally{r.value=!1}}},k=async()=>{var j;if(b.value=!0,c.value||o.value)return;await ze();const V=document.getElementById("cf-confirm-div");V&&V.remove();const w=document.createElement("div");w.id="cf-confirm-div",w.setAttribute("data-theme","light"),(j=d.value)==null||j.appendChild(w);const U=window;U.turnstile.ready(function(){U.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function($){b.value=!1,await p($)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},I=v(()=>t(G,{onClick:k,disabled:c.value,loading:o.value,style:"width:120px"},{default:()=>[g.value]})),h=async()=>{r.value=!0;try{const V=await Ul(u.value.username,u.value.password,u.value.emailKey);V.code===0?(_e(a,"密码修改成功"),a.$router.push({name:"login"})):B(a,V.code)}catch(V){console.error("Modify password error",V),ce(a,"修改密码失败")}finally{r.value=!1}},i=async({validateResult:V,firstError:w,e:U})=>{if(!r.value){if(U.preventDefault(),V!==!0){ce(a,w);return}f.value?await h():await k()}};return le(()=>{if(n.isLogin()){a.$router.push({path:"/user"});return}}),Ie(()=>{}),(V,w)=>{const U=bt,j=De,$=je,T=Ot,S=G,E=Le,z=He,C=se,x=Me;return D(),Y(Z,null,[t(C,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:l(()=>[t(U,{"max-line":1},{default:l(()=>w[6]||(w[6]=[A("span",null,"如果您未绑定邮箱或忘记用户名，可联系管理员寻求帮助",-1),A("span",null,"管理员邮箱：BoilTask@qq.com",-1)])),_:1}),t(E,{ref:"form",rules:m.value,data:u.value,colon:!0,onReset:s,onSubmit:i,class:"yj-login-form"},{default:l(()=>[t($,{name:"username",label:"用户名"},{default:l(()=>[t(j,{modelValue:u.value.username,"onUpdate:modelValue":w[0]||(w[0]=R=>u.value.username=R),clearable:"",placeholder:"请输入完整用户名"},null,8,["modelValue"])]),_:1}),f.value?(D(),Y(Z,{key:0},[t($,{name:"email",label:"发送邮箱"},{default:l(()=>[t(T,{append:I.value},{default:l(()=>[A("div",fs,[A("span",_s,q(f.value),1)])]),_:1},8,["append"])]),_:1}),t($,{name:"emailKey",label:"验证码"},{default:l(()=>[t(j,{modelValue:u.value.emailKey,"onUpdate:modelValue":w[1]||(w[1]=R=>u.value.emailKey=R),clearable:"",placeholder:"请输入收到的验证码"},null,8,["modelValue"])]),_:1}),t($,{name:"password",label:"新密码"},{default:l(()=>[t(j,{modelValue:u.value.password,"onUpdate:modelValue":w[2]||(w[2]=R=>u.value.password=R),type:"password",clearable:"",placeholder:"新密码"},null,8,["modelValue"])]),_:1}),t($,{name:"confirmPassword",label:"确认密码"},{default:l(()=>[t(j,{modelValue:u.value.confirmPassword,"onUpdate:modelValue":w[3]||(w[3]=R=>u.value.confirmPassword=R),type:"password",clearable:"",placeholder:"请重复输入密码"},null,8,["modelValue"])]),_:1})],64)):te("",!0),f.value?(D(),M($,{key:1},{default:l(()=>[t(S,{theme:"primary",type:"submit",block:"",loading:r.value},{default:l(()=>w[7]||(w[7]=[L("修改密码")])),_:1},8,["loading"])]),_:1})):(D(),M($,{key:2},{default:l(()=>[t(S,{theme:"primary",type:"submit",block:"",loading:r.value},{default:l(()=>w[8]||(w[8]=[L("重置密码")])),_:1},8,["loading"])]),_:1}))]),_:1},8,["rules","data"]),A("div",vs,[t(z,{onClick:w[4]||(w[4]=()=>{de(a).$router.push({name:"login"})})},{default:l(()=>w[9]||(w[9]=[L("返回登陆 ")])),_:1})])]),_:1}),t(x,{visible:b.value,"onUpdate:visible":w[5]||(w[5]=R=>b.value=R),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:l(()=>[A("div",{ref_key:"dialogContainer",ref:d,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),bs=ee(gs,[["__scopeId","data-v-c3586c6f"]]),pa=[{name:"problem-list",tab:"problem",sidebar:"problem-list",path:"",title:"问题列表",icon:"list",component:yn},{name:"problem-detail",tab:"problem",sidebar:"problem-list",path:":problemId+",title:"问题详情",icon:"list",component:xt},{name:"problem-recommend",tab:"problem",sidebar:"problem-recommend",path:"recommend/:problemId*",title:"问题推荐",icon:"cpu",needLogin:!0,component:Rn},{name:"problem-collection-list",tab:"problem",sidebar:"problem-collection-list",path:"collection",title:"题目集合",icon:"list",disableTabPath:!0,component:Hn},{name:"collection-detail",tab:"collection-detail-tab",sidebar:"collection-detail",path:":collectionId+",title:"题集详情",icon:"cpu",component:Zn},{name:"collection-rank",tab:"collection-detail-tab",sidebar:"collection-rank",path:":collectionId+/rank",title:"题集排名",icon:"list",component:Qn},{name:"collection-edit",tab:"collection-detail-tab",sidebar:"collection-edit",disableSidebar:!0,needLogin:!0,path:":collectionId+/edit",title:"题集编辑",icon:"list",component:Vt},{name:"collection-create",tab:"collection-detail-tab",sidebar:"collection-create",needLogin:!0,disableSidebar:!0,path:"create",title:"新建题集",icon:"list",component:Vt},{name:"judge-list",tab:"judge",sidebar:"judge-list",path:"",title:"评测列表",icon:"list",component:jt},{name:"judge-detail",tab:"judge",sidebar:"judge-list",path:":judgeId+",title:"评测详情",icon:"cpu",component:$t},{name:"contest-list",tab:"contest",sidebar:"contest-list",path:"",title:"比赛列表",icon:"list",component:zt},{name:"contest-recent",tab:"contest",sidebar:"contest-recent",path:"recent",title:"近期比赛",icon:"list",component:zt},{name:"contest-create",tab:"contest",sidebar:"contest-create",disableSidebar:!0,needLogin:!0,path:"create",title:"新建比赛",icon:"list",component:At},{name:"contest-edit",tab:"contest-detail-tab",sidebar:"contest-edit",disableSidebar:!0,needLogin:!0,path:":contestId+/edit",title:"比赛编辑",icon:"list",component:At},{name:"contest-detail",tab:"contest-detail-tab",sidebar:"contest-detail",path:":contestId+",title:"比赛详情",icon:"cpu",component:So},{name:"contest-problem-detail",tab:"contest-detail-tab",sidebar:"contest-problem-detail",path:":contestId+/problem/:problemIndex+",title:"问题详情",icon:"cpu",disableSidebar:!0,component:xt},{name:"contest-judge",tab:"contest-detail-tab",sidebar:"contest-judge",path:":contestId+/judge",title:"评测列表",icon:"list",component:jt},{name:"contest-judge-detail",tab:"contest-detail-tab",sidebar:"contest-judge-detail",path:":contestId+/judge/:judgeId+",title:"评测详情",icon:"cpu",component:$t,disableSidebar:!0},{name:"contest-rank",tab:"contest-detail-tab",sidebar:"contest-rank",path:":contestId+/rank",title:"比赛排名",icon:"list",component:To},{name:"contest-discuss",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss",title:"比赛讨论",icon:"list",component:tt},{name:"contest-discuss-detail",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss/:discussId+",title:"讨论详情",icon:"list",component:dt},{name:"discuss-list",tab:"discuss",sidebar:"discuss-list",path:"",title:"讨论列表",icon:"list",component:tt},{name:"discuss-list-problem",tab:"discuss",sidebar:"discuss-list-problem",path:"problem",title:"问题讨论",icon:"list",component:tt},{name:"discuss-list-judge",tab:"discuss",sidebar:"discuss-list-judge",path:"judge",title:"评测讨论",icon:"list",component:tt},{name:"discuss-detail",tab:"discuss",sidebar:"discuss-list",path:":discussId+",title:"讨论详情",icon:"list",component:dt},{name:"rank-ac-all",tab:"rank",sidebar:"rank-ac-all",path:"ac",title:"AC排名",icon:"base-station",props:{type:"all"},component:Ye},{name:"rank-ac-problem",tab:"rank",sidebar:"rank-ac-problem",path:"ac/problem",title:"题量排名",icon:"base-station",props:{type:"problem"},component:Ye},{name:"rank-ac-problem-today",tab:"rank",sidebar:"rank-ac-problem-today",path:"ac/problem/today",title:"今日题量",icon:"base-station",props:{type:"problem-today"},component:Ye},{name:"rank-ac-problem-day7",tab:"rank",sidebar:"rank-ac-problem-day7",path:"ac/problem/day7",title:"7日题量",icon:"base-station",props:{type:"problem-day7"},component:Ye},{name:"rank-ac-problem-year",tab:"rank",sidebar:"rank-ac-problem-year",path:"ac/problem/year",title:"1年题量",icon:"base-station",props:{type:"problem-year"},component:Ye},{name:"tool-paste",tab:"tool",sidebar:"tool-paste",path:"paste",title:"码池",icon:"base-station",component:vt},{name:"system-status",tab:"system",sidebar:"system-status",path:"",title:"运行状态",icon:"base-station",component:vt},{name:"system-about",tab:"system",sidebar:"system-about",path:"about",title:"关于",icon:"base-station",props:{discussId:"52"},component:dt},{name:"manage-problem-create",tab:"manage",sidebar:"manage-problem-create",disableSidebar:!0,path:"problem",title:"新建问题",icon:"list",component:Rt,auths:[$e.ManageProblem]},{name:"manage-problem",tab:"manage",sidebar:"manage-problem",disableSidebar:!0,path:"problem/:problemId+",title:"问题编辑",icon:"list",component:Rt,auths:[$e.ManageProblem]},{name:"manage-problem-judge",tab:"manage",sidebar:"manage-problem-judge",disableSidebar:!0,path:"problem/:problemId+/judge",title:"评测数据",icon:"list",component:ps,auths:[$e.ManageProblem]},{name:"manage-judge",tab:"manage",path:"judge",sidebar:"manage-judge",title:"评测管理",icon:"list",auths:["i-manage-judge"],component:ls},{name:"login-forget",tab:"login",path:"forget",title:"忘记密码",component:bs}],Et=(e,a,n,r)=>{r.tab==n&&(r.disableSidebar&&a!=r.sidebar||r.sidebar==null||r.sidebar!=r.name||e.push({name:r.name,title:r.title,icon:r.icon,to:{name:r.name}}))},hs=(e,a)=>{const n=[];return pa.forEach(r=>{if(ta(r)){const o=[];r.children.forEach(c=>{Et(o,e,a,c)}),o.length>0&&n.push({title:r.title,children:o})}else Et(n,e,a,r)}),n},Kt=(e,a)=>{const n=Bl(a.tab),r={name:a.name,path:"/"+a.path,meta:{title:a.title+" - "+n.title,tab:a.tab,sidebar:a.sidebar,showSidebar:n.showSidebar,needLogin:n.needLogin||a.needLogin,tabAuths:n.auths,auths:a.auths},props:a.props,component:a.component};!n.disablePath&&!a.disableTabPath&&(r.path=n.path+r.path),e.push(r)},ys=e=>{pa.forEach(a=>{ta(a)?a.children.forEach(n=>{Kt(e,n)}):Kt(e,a)})},ws={class:"sh-main"},ks=Q({__name:"View403",setup(e){let a=ie();const n=v("");return le(()=>{a.query.target?n.value=a.query.target:n.value=a.fullPath}),(r,o)=>{const c=G;return D(),Y("div",ws,[A("p",null,q(n.value),1),o[2]||(o[2]=A("p",null,"该页面无访问权限，请更换访问目标或重新登陆后再试",-1)),t(c,{theme:"primary",onClick:o[0]||(o[0]=()=>r.$router.push("/"))},{default:l(()=>o[1]||(o[1]=[L("返回首页")])),_:1})])}}}),fa=ee(ks,[["__scopeId","data-v-8f62f1f8"]]),Qe=[];Wl(Qe);ys(Qe);Qe.push({path:"/403",name:"403",component:fa});Qe.push({path:"/:pathMatch(.*)*",name:"404",component:Qt});const J=Ca({history:Sa("/"),routes:Qe});J.beforeEach((e,a,n)=>{if(e.name==null||!J.hasRoute(e.name)){n({name:"home"});return}const r=e.matched[e.matched.length-1].meta;if(r.redirect){n({name:r.redirect});return}if(r.needLogin){const c=Se();if(c.getToken==null||c.getToken==""){n({name:"login",query:{redirect_uri:e.fullPath}});return}}const o=r.tabAuths;if(o&&!Se().hasAllAuths(o)){n({name:"403",query:{target:e.fullPath}});return}n()});J.afterEach((e,a)=>{if(e.name===a.name)return;const n=ct(),r=Ue();let o=null;if(e.matched.length>0&&(o=e.matched[e.matched.length-1].meta),o!=null&&o.title&&r.setTitle(o==null?void 0:o.title),o!=null&&o.showSidebar){n.setSidebarShow(!0);const c=hs(o==null?void 0:o.sidebar,o==null?void 0:o.tab);n.setMenuList(c),n.setMenuActiveName(o==null?void 0:o.sidebar)}else n.setSidebarShow(!1)});const _a=st("login",{state:()=>({Loaded:!1}),getters:{isLoaded(){return this.Loaded}}}),Cs=Q({__name:"HeaderContent",setup(e){const a=_a(),n=Se(),{globalProperties:r}=oe(),o=v(a.isLoaded),c=v(!1),g=v(n.getUsername),y=v(n.getNickname),P=v(),b=()=>{P.value=Jl(n)};a.$subscribe((u,_)=>{o.value=_.Loaded}),n.$subscribe((u,_)=>{g.value=_.username,y.value=_.nickname,c.value=_.token!="",b()});const d=()=>{r.$router.currentRoute.value.name!=="login"&&r.$router.push({name:"login",query:{redirect_uri:r.$router.currentRoute.value.fullPath}})},f=()=>{n.clear(),r.$message.success({duration:3e3,content:"注销成功"}),r.$router.push({path:"/login",query:{redirect_uri:r.$router.currentRoute.value.fullPath}})};return le(()=>{b()}),(u,_)=>{const m=Gt("router-link"),s=Xt,p=Yt,k=Ga,I=Oa;return D(),M(I,{modelValue:u.$route.meta.tab,"onUpdate:modelValue":_[0]||(_[0]=h=>u.$route.meta.tab=h),class:"sh-menu","expand-type":"popup"},{logo:l(()=>[t(m,{to:"/",class:"sh-logo"},{default:l(()=>_[1]||(_[1]=[L("DidaOJ")])),_:1})]),operations:l(()=>[o.value&&c.value?(D(),M(k,{key:0,title:y.value},{icon:l(()=>[t(s,{name:"user"})]),default:l(()=>[t(p,{value:"user",to:{path:"/user/"+g.value}},{default:l(()=>_[2]||(_[2]=[L("个人空间")])),_:1},8,["to"]),t(p,{value:"user_logout",onClick:f},{default:l(()=>_[3]||(_[3]=[L(" 注销")])),_:1})]),_:1},8,["title"])):o.value?(D(),M(p,{key:2,value:"login",onClick:d},{icon:l(()=>[t(s,{name:"login"})]),default:l(()=>[_[5]||(_[5]=L(" 登录 "))]),_:1})):(D(),M(p,{key:1,value:"login"},{icon:l(()=>[t(s,{name:"login"})]),default:l(()=>[_[4]||(_[4]=L(" ... "))]),_:1}))]),default:l(()=>[(D(!0),Y(Z,null,me(P.value,h=>(D(),M(p,{key:h.name,value:h.name,to:{name:h.name}},{icon:l(()=>[h.icon?(D(),M(s,{key:0,name:h.icon},null,8,["name"])):te("",!0)]),default:l(()=>[L(" "+q(h.title),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])}}}),Ss=ee(Cs,[["__scopeId","data-v-c64d812f"]]),Is={id:"menu-container"},Ps=Q({__name:"SidebarContent",setup(e){const a=ct(),n=v(!1),r=v(null),o=v(a.menuActiveName),c=v(a.menuList),g=v([]),y=v(!1),P=()=>{o.value=a.menuActiveName;const d=JSON.stringify(c.value),f=JSON.stringify(a.menuList);d!==f&&(g.value.push([...a.menuList]),b())},b=async()=>{if(g.value.length>0&&!y.value){for(y.value=!0;g.value.length>1;)g.value.shift();const d=g.value.shift();n.value=d.length<=0,c.value=[],await ze(),r.value&&r.value.updateActiveName(),await new Promise(u=>setTimeout(u,300)),c.value=d,await ze(),r.value&&r.value.updateActiveName();const f=300;await new Promise(u=>setTimeout(u,f)),y.value=!1,await b()}};return a.$subscribe((d,f)=>{P()}),le(()=>{P()}),(d,f)=>{const u=Xt,_=Yt,m=Ba,s=Ha,p=we;return D(),Y(Z,null,[A("div",Is,[t(s,{modelValue:o.value,"onUpdate:modelValue":f[0]||(f[0]=k=>o.value=k),theme:"light",class:"sh-menu-container"},{default:l(()=>[t(Ia,{name:"move-left"},{default:l(()=>[(D(!0),Y(Z,null,me(c.value,(k,I)=>(D(),Y(Z,{key:I},[de(Yl)(k)?(D(),M(m,{key:0,title:k.title},{default:l(()=>[(D(!0),Y(Z,null,me(k.children,(h,i)=>(D(),M(_,{key:h.name,value:h.name,to:h.to},Pt({default:l(()=>[L(" "+q(h.title),1)]),_:2},[h.icon?{name:"icon",fn:l(()=>[t(u,{name:h.icon,class:_t(h.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))),128))]),_:2},1032,["title"])):(D(),M(_,{key:k.name,value:k.name,to:k.to},Pt({default:l(()=>[L(" "+q(k.title),1)]),_:2},[k.icon?{name:"icon",fn:l(()=>[t(u,{name:k.icon,class:_t(k.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),t(p,{size:"small",loading:n.value,"show-overlay":!0,attach:"#menu-container",class:"sh-sidebar-loading",style:{"align-items":"flex-start","padding-top":"100px"}},null,8,["loading"])],64)}}}),Ts=ee(Ps,[["__scopeId","data-v-96e2d89f"]]),xs={};function Vs(e,a){return null}const Ls=ee(xs,[["render",Vs]]),js={class:"footer"},Ds={class:"footer-left"},$s={class:"foot-time"},zs={class:"footer-center"},Us={href:"https://beiancx.miit.gov.cn/",target:"_blank"},As={class:"footer-right"},Rs={class:"foot-text"},Es={href:"https://github.com/hpu-developer/DiDaOJ-web",target:"_blank"},Ks={class:"foot-text"},qs={href:"https://github.com/hpu-developer/DiDaOJ-go",target:"_blank"},Ms=Q({__name:"FooterContent",setup(e){const a=v("");function n(){a.value=new Date().toLocaleString()}return le(()=>{n(),setInterval(()=>{n()},1e3)}),(r,o)=>{const c=G;return D(),Y("div",js,[A("div",Ds,[A("p",$s,q(a.value),1)]),A("div",zs,[A("a",Us,[t(c,{theme:"default",variant:"outline",ghost:!0},{default:l(()=>o[0]||(o[0]=[L("豫ICP备15024677号-4")])),_:1})])]),A("div",As,[A("p",Rs,[A("a",Es,[t(c,{theme:"default",variant:"outline",ghost:!0},{default:l(()=>o[1]||(o[1]=[L("@didaoj-web")])),_:1})])]),A("p",Ks,[A("a",qs,[t(c,{theme:"default",variant:"outline",ghost:!0},{default:l(()=>o[2]||(o[2]=[L("@didaoj-go")])),_:1})])])])])}}}),Fs=ee(Ms,[["__scopeId","data-v-979fed79"]]),at=20,pt=100,ft=50,Ns=Q({__name:"ForceHiddenSidebarButton",setup(e){let a=ct();const n=v({x:window.innerWidth-pt-at,y:window.innerHeight-ft-at}),r=v(window.innerWidth),o=v(window.innerHeight);let c=!1,g={x:0,y:0};const y=k=>{c=!0;const I=k.clientX??k.touches[0].clientX,h=k.clientY??k.touches[0].clientY;g={x:I-n.value.x,y:h-n.value.y},document.addEventListener("mousemove",P),document.addEventListener("touchmove",P),document.addEventListener("mouseup",b),document.addEventListener("touchend",b)},P=k=>{if(!c)return;const I=k.clientX??k.touches[0].clientX,h=k.clientY??k.touches[0].clientY;let i=I-g.x,V=h-g.y;i=Math.max(0,Math.min(i,r.value-pt)),V=Math.max(0,Math.min(V,o.value-ft)),n.value={x:i,y:V}},b=()=>{c=!1,document.removeEventListener("mousemove",P),document.removeEventListener("touchmove",P),document.removeEventListener("mouseup",b),document.removeEventListener("touchend",b)},d=()=>{r.value=window.innerWidth,o.value=window.innerHeight,n.value={x:Math.min(n.value.x,r.value-pt-at),y:Math.min(n.value.y,o.value-ft-at)}};let f=v(a.forceHiddenSidebar),u=v(a.forceHiddenSidebar);const _=()=>{f.value=!f.value,a.setForceHiddenSidebar(f.value)},m=()=>{u.value||(u.value=!0,a.setForceHiddenSidebar(f.value))},s=()=>{u.value&&(u.value=!1,a.setForceHiddenSidebar(!1))},p=k=>{k>=800?s():m()};return p(r.value),xe(r,k=>{p(k)}),le(()=>{window.addEventListener("resize",d)}),Ie(()=>{window.removeEventListener("resize",d)}),(k,I)=>{const h=G;return de(u)?(D(),M(h,{key:0,class:"draggable-button",style:Nt({top:`${n.value.y}px`,left:`${n.value.x}px`}),onMousedown:y,onTouchstart:y,variant:"dashed",theme:"primary",onClick:_},{default:l(()=>[L(q(de(f)?"显示":"隐藏"),1)]),_:1},8,["style"])):te("",!0)}}}),Gs=ee(Ns,[["__scopeId","data-v-1aee5506"]]),lt="DidaOJ",Os=Q({__name:"App",setup(e){const{globalProperties:a}=oe(),n=_a(),r=Se(),o=Ue(),c=ct();n.$patch({Loaded:!1});const g=r.getToken,y=v(!1),P=v(!1);o.title&&o.title.length>0?document.title=o.title+" - "+lt:document.title=lt,o.$subscribe((u,_)=>{_.title&&_.title.length>0?document.title=_.title+" - "+lt:document.title=lt}),c.$subscribe((u,_)=>{y.value=_.showSidebar,P.value=y.value&&!_.forceHiddenSidebar});const b=ie(),d=Ae(()=>{const u=b.meta.auths;return u?!r.hasAllAuths(u):!1});function f(){a.$message.warning({duration:3e3,content:"登陆状态失效"}),n.$patch({Loaded:!0}),r.clear()}return le(()=>{if(g==""){n.$patch({Loaded:!0});return}Tl().then(u=>{u.code==0?(r.loadResponse(u.data),n.$patch({Loaded:!0})):(B(a,u.code),n.$patch({Loaded:!0}),r.clear())}).catch(u=>{console.log(u),f()})}),(u,_)=>{const m=Ja,s=Ya,p=Gt("RouterView"),k=Xa,I=Wa,h=Za;return D(),Y(Z,null,[t(I,null,{default:l(()=>[t(m,{class:"sh-header"},{default:l(()=>[t(Ss)]),_:1}),t(I,null,{default:l(()=>[t(Pa,{name:"slide"},{default:l(()=>[P.value?(D(),M(s,{key:0,class:"sh-sidebar"},{default:l(()=>[t(Ts)]),_:1})):te("",!0)]),_:1}),t(I,{class:_t(["sh-main-layout",{expanded:!P.value}])},{default:l(()=>[t(Ls),t(k,{class:"sh-main-content"},{default:l(()=>[d.value?(D(),M(fa,{key:0})):(D(),M(p,{key:1}))]),_:1}),t(Fs)]),_:1},8,["class"])]),_:1})]),_:1}),y.value?(D(),M(Gs,{key:0})):te("",!0),t(h,{container:"body",offset:["24px","80px"],size:"small"})],64)}}}),Hs=ee(Os,[["__scopeId","data-v-9e122cb4"]]);el.registerLanguage("verilog",tl);const va=Ta();va.use(xa);const et=Va(Hs);et.use(va);et.use(J);et.use(Qa);et.use(La);et.mount("#app");yl().then(()=>{console.log("Text cache reinitialized")}).catch(e=>{console.error("Text cache reinitialization failed",e)});
