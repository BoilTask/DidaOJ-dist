import{ct as mt,d as ue,a as m,o as ce,cu as M,cv as L,cw as a,e as t,cx as z,cy as E,bE as x,cz as fa,aM as Fa,cA as Ae,cB as le,cC as te,F as de,cD as Ie,cE as Ga,cF as Ce,bS as fe,cG as Na,cH as Oa,cI as Ha,b as Te,v as ct,cJ as Ba,cK as Ye,j as Oe,w as Le,a9 as Qe,bc as Wa,bd as Ya,cL as Ja,cM as Xa,cN as Za,br as Qa,cO as Dt,cP as va,cQ as _a,cj as el,cR as tl,cS as al,cT as ll,cU as nl,bX as ol,cV as Xt,cW as Rt,cX as sl,bf as rl,cY as ul,cZ as il,aY as dl,c_ as cl,c$ as ml}from"./node_modules-0I5abxol.js";import{L as Ve,C as be,R as Pe,a as xe,A as St,S as pl,b as fl,c as vl,d as _l,e as gl,f as lt,T as tt,B as G,F as je,g as Ue,I as $e,D as nt,h as ga,i as we,j as He,k as Be,l as bl,m as Re,n as pt,o as ft,P as Et,O as qt,p as Kt,q as hl,r as ba,s as yl,t as wl,u as ha,v as ya,w as It,x as kl,y as Cl,z as Sl,E as Il,G as Pl,H as xl,M as wa,J as ka,K as Vl,N as Tl,Q as Dl,U as Ll,V as jl,W as Ul,X as $l,Y as zl,Z as Al,_ as Rl}from"./tdesign-vue-next-Cq8R5Clx.js";import{u as pe,S as ve,a as ke,b as F,G as Ke,H as vt,c as Ge,d as Ca,e as Ml,f as El,E as ql,M as Kl,R as Fl}from"./md-editor-v3-DBv2stFg.js";import{e as Zt}from"./monaco-editor-ouHSYV7a.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))u(o);new MutationObserver(o=>{for(const b of o)if(b.type==="childList")for(const f of b.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&u(f)}).observe(document,{childList:!0,subtree:!0});function n(o){const b={};return o.integrity&&(b.integrity=o.integrity),o.referrerPolicy&&(b.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?b.credentials="include":o.crossOrigin==="anonymous"?b.credentials="omit":b.credentials="same-origin",b}function u(o){if(o.ep)return;o.ep=!0;const b=n(o);fetch(o.href,b)}})();var ze=(e=>(e.ManageWeb="i-manage-web",e.ManageJudge="i-manage-judge",e.ManageProblem="i-manage-problem",e.ManageProblemDaily="i-manage-problem-daily",e.ManageContest="i-manage-contest",e.ManageCollection="i-manage-collection",e.ManageDiscuss="i-manage-discuss",e))(ze||{});const Gl={"r-admin":["i-manage-web","i-manage-judge","i-manage-problem","i-manage-problem-daily","i-manage-contest","i-manage-collection","i-manage-discuss"]};function Nl(e){if(e==null)return[];const l=[];for(const n of e){const u=Gl[n];u!=null&&l.push(...u)}return[...new Set(l)]}function Ol(e,l){if(e==null||l==null)return!1;const n=Nl(e);for(const u of l)if(!n.includes(u))return!1;return!0}const qe=mt("user",{state:()=>({token:"",userId:-1,username:"",nickname:"",roles:[]}),getters:{getToken(){return this.token},getUserId(){return this.userId},getUsername(){return this.username},getNickname(){return this.nickname}},actions:{clear(){this.$patch({token:"",userId:-1,username:"",nickname:"",roles:[]})},loadResponse(e){this.$patch({token:e.token,userId:e.user_id,username:e.username,nickname:e.nickname,roles:e.roles})},isLogin(){return this.token!=null&&this.token!=""},hasAuth(e){return this.hasAllAuths([e])},hasAllAuths(e){return e?Ol(this.roles,e):!0}},persist:!0}),Je=mt("webStyle",{state:()=>({title:""}),getters:{getTitle(){return this.title}},actions:{setTitle(e){this.title=e}}}),Pt=mt("sidebarStyle",{state:()=>({showSidebar:!1,forceHiddenSidebar:!1,menuActiveName:"",menuList:[]}),getters:{getMenuList(){return this.menuList}},actions:{setSidebarShow(e){this.showSidebar=e},setForceHiddenSidebar(e){this.forceHiddenSidebar=e},setMenuActiveName(e){this.menuActiveName=e},clearMenuList(){this.menuList=[]},setMenuList(e){this.menuList=e},addMenuList(e){this.menuList.push(e)}}}),Hl={style:{"text-align":"right"}},Bl=ue({__name:"Hitokoto",setup(e){const l=m(!1),n=m(""),u=m(""),o=m(""),b=async()=>{l.value=!0;try{const S=await(await fetch("https://v1.hitokoto.cn")).json();u.value=S.hitokoto,o.value=S.creator,n.value="—— "+S.from}catch(f){u.value="一言获取失败了，但至少您还可以访问本站。",o.value="BoilTask",n.value="DidaOJ",console.error("Error fetching Hitokoto:",f)}finally{l.value=!1}};return ce(()=>{b()}),(f,S)=>{const d=be,s=Ve;return L(),M(s,{loading:l.value},{default:a(()=>[t(d,{title:"一言 © Hitokoto"},{actions:a(()=>[x(" @"+E(o.value),1)]),default:a(()=>[z("div",null,[z("span",null,E(u.value),1),z("p",Hl,E(n.value),1)])]),_:1})]),_:1},8,["loading"])}}}),Wl="https://oj-api.didapipa.com/",B=fa.create({baseURL:Wl,timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});B.interceptors.request.use(e=>{const n=qe().getToken;return n&&(e.headers["X-Token"]=n),e},e=>Promise.reject(e));B.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});const xt=fa.create({timeout:6e4,withCredentials:!1,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});xt.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function Sa(){return xt({baseURL:"https://r2-oj.didapipa.com",url:"/system/notification.json?"+Date.now(),method:"get"})}function Ia(){return xt({baseURL:"https://r2-oj.didapipa.com",url:"/system/announcement.json?"+Date.now(),method:"get"})}function Yl(){return B({url:"/system/status",method:"get"})}function Jl(){return B({url:"/system/image/token",method:"get"})}function Xl(e,l){return B({url:"/system/notification",method:"post",data:{theme:e,content:l}})}function Zl(e,l){return B({url:"/system/announcement",method:"post",data:{title:e,content:l}})}var Vt=(e=>(e[e.Unknown=-1]="Unknown",e[e.C=0]="C",e[e.Cpp=1]="Cpp",e[e.Java=2]="Java",e[e.Python=3]="Python",e[e.Pascal=4]="Pascal",e[e.Golang=5]="Golang",e[e.Lua=6]="Lua",e[e.TypeScript=7]="TypeScript",e[e.Max=8]="Max",e))(Vt||{});function Ft(){const e=[-1,8];return Object.values(Vt).filter(l=>typeof l=="number"&&!e.includes(l)).map(l=>({value:l,label:kt(l)}))}function yt(e){return e>-1&&e<8}function kt(e){switch(e){case 0:return"C";case 1:return"C++";case 2:return"Java";case 3:return"Python";case 4:return"Pascal";case 5:return"Golang";case 6:return"Lua";case 7:return"TypeScript";default:return"未知"}}function Gt(e){switch(e){case 0:return"c";case 1:return"cpp";case 2:return"java";case 3:return"python";case 4:return"pascal";case 5:return"go";case 6:return"lua";case 7:return"typescript";default:return"text"}}var Fe=(e=>(e[e.Init=0]="Init",e[e.Rejudge=1]="Rejudge",e[e.Submitting=2]="Submitting",e[e.Queuing=3]="Queuing",e[e.Compiling=4]="Compiling",e[e.Running=5]="Running",e[e.Accept=6]="Accept",e[e.PE=7]="PE",e[e.WA=8]="WA",e[e.TLE=9]="TLE",e[e.MLE=10]="MLE",e[e.OLE=11]="OLE",e[e.RE=12]="RE",e[e.CE=13]="CE",e[e.CLE=14]="CLE",e[e.JudgeFail=15]="JudgeFail",e[e.SubmitFail=16]="SubmitFail",e[e.Unknown=17]="Unknown",e[e.Max=18]="Max",e))(Fe||{});const Ql=e=>{switch(e){case 0:return"普通评测";case 1:return"特殊评测";default:return"未知"}},Ct=e=>{switch(e){case 0:return"等待处理";case 1:return"重新评测";case 2:return"提交中";case 3:return"队列中";case 4:return"编译中";case 5:return"运行中";case 6:return"通过";case 7:return"格式错误";case 8:return"答案错误";case 9:return"超时";case 10:return"内存超限";case 11:return"输出超限";case 12:return"运行错误";case 13:return"编译错误";case 14:return"编译超限";case 15:return"评测失败";case 16:return"提交失败";case 17:return"未知";default:return e}},Pa=e=>{switch(e){case 0:case 1:case 2:case 3:case 4:case 5:case 17:return"default";case 6:return"success";case 7:return"warning";default:return"danger"}};function xa(){const e=[17,18];return Object.values(Fe).filter(l=>typeof l=="number"&&!e.includes(l)).map(l=>({value:l,label:Ct(l)}))}function wt(e){return e>=0&&e<17}function ut(e){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return!0;default:return!1}}function Va(e){var n;const l={};if(l.id=e.id,l.problemId=e.problem_id,l.contestProblemIndex=e.contest_problem_index,l.status=e.status,ut(e.status)||!wt(e.status)?l.score="-":l.score=e.score.toString(),e.time?l.time=Math.ceil(e.time/1e6)+"ms":l.time="-",e.memory?l.memory=(e.memory/1024/1024).toFixed(2)+"MB":l.memory="-",l.language=e.language,l.codeLength=e.code_length,e.approve_time?l.approveTime=new Date(e.approve_time).toLocaleString():l.approveTime="-",l.author=e.author,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.code=e.code,l.compileMessage=e.compile_message,l.taskCurrent=e.task_current,l.taskTotal=e.task_total,l.task=[],e.task)for(let u=0;u<((n=e.task)==null?void 0:n.length);u++){const o=e.task[u],b={};b.taskId=o.task_id,b.status=o.status,o.time?b.time=Math.ceil(o.time/1e6)+"ms":b.time="-",o.memory?b.memory=(o.memory/1024/1024).toFixed(2)+"MB":b.memory="-",b.score=o.score,b.content=o.content,b.waHint=o.wa_hint,!b.content&&!b.waHint&&(b.content="无提示信息"),l.task.push(b)}return e.judger&&(l.judger=e.judger),e.judger_name?l.judgerName=e.judger_name:l.judgerName="-",e.judge_time&&(l.judgeTime=new Date(e.judge_time).toLocaleString()),l}function en(e,l,n,u,o){return B({url:"/judge/approve",method:"post",data:{problem_id:e,contest_id:l,problem_index:n,language:u,code:o}})}function tn(e){return B({url:"/judge?id="+e,method:"get"})}function an(e){return B({url:"/judge/code?id="+e,method:"get"})}function ln(e,l,n,u,o,b,f){let S={problem_id:l,username:n,language:String(u),status:String(o),page:String(b),page_size:String(f)};return e&&(S.contest_id=String(e)),B({url:`/judge/list?${new URLSearchParams(S).toString()}`,method:"get"})}function nn(){return B({url:"/judge/statics/recently",method:"get"})}function on(){return B({url:"/judge/rejudge/recently",method:"post"})}function sn(e,l,n){const u={};return e!=null&&(u.problem_id=e),l!=null?u.language=l:u.language=Vt.Unknown,n!=null?u.status=n:u.status=18,B({url:"/judge/rejudge/search",method:"post",data:u})}function rn(){return B({url:"/judge/rejudge/all",method:"post",timeout:0})}function un(e){return B({url:"/judge/rejudge",method:"post",data:{id:Number(e)}})}var Ne=(e=>(e[e.None=0]="None",e[e.Attempt=1]="Attempt",e[e.Accept=2]="Accept",e))(Ne||{});function _t(e,l){const n={};if(n.id=e.id,n.author=e.author,n.title=e.title,n.tags=[],e.tags)for(const u of e.tags){const o=l[u];o&&n.tags.push(o)}if(n.private=e.private,n.accept=e.accept,n.attempt=e.attempt,e.description!=null&&(n.description=e.description),e.time_limit!=null&&e.time_limit>=0?n.timeLimit=e.time_limit.toString()+" ms":n.timeLimit="未知",e.memory_limit!=null&&e.memory_limit>=0?n.memoryLimit=(e.memory_limit/1024).toFixed(2)+" MB":n.memoryLimit="未知",e.judge_type!=null&&(n.judgeType=Ql(e.judge_type)),e.insert_time!=null&&(n.insertTime=new Date(e.insert_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.source!=null){const u=/\[([^\]]+)\]\(([^)]+)\)/,o=e.source.match(u);o?(n.source=o[1],n.sourceUrl=o[2]):(n.source=e.source,n.sourceUrl="")}return e.judge_md5!=null&&(n.judgeMd5=e.judge_md5),e.origin_oj!=null&&(n.originOj=e.origin_oj),e.origin_id!=null&&(n.originId=e.origin_id),e.origin_url!=null&&(n.originUrl=e.origin_url),n}function Ta(e,l){const n={};if(n.id=e.id,n.problemId=e.problem_id,n.title=e.title,n.tags=[],e.tags)for(const u of e.tags){const o=l[u];o&&n.tags.push(o)}return e.accept?n.accept=e.accept:n.accept=0,e.attempt?n.attempt=e.attempt:n.attempt=0,n.solution=e.solution,n.code=e.code,e.create_time!=null&&(n.createTime=new Date(e.create_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.updater_nickname!=null&&(n.updaterNickname=e.updater_nickname),n}function Da(e,l,n){const u={};return e?u.id=e:(u.contest_id=l,u.problem_index=n),B({url:`/problem?${new URLSearchParams(u).toString()}`,method:"get"})}function La(e){return B({url:"/problem/tag/list?max_count="+e,method:"get"})}function dn(e){return B({url:"/problem/judge?id="+e,method:"get"})}function cn(e,l,n,u,o,b){const f={};return e&&(f.oj=e),l&&(f.title=l),n&&(f.tag=n),u!==void 0&&(f.private=u?"1":"0"),o&&(f.page=o),b&&(f.page_size=b),B({url:`/problem/list?${new URLSearchParams(f).toString()}`,method:"get"})}function mn(e){const l={};return e&&(l.problem_id=e),B({url:`/problem/recommend?${new URLSearchParams(l).toString()}`,method:"get"})}function pn(e){return B({url:"/problem/daily?id="+e,method:"get"})}function fn(e){return B({url:"/problem/daily/edit?id="+e,method:"get"})}function vn(){return B({url:"/problem/daily/recently",method:"get"})}function _n(e,l,n,u,o){const b={};return e&&(b.start_date=e),l&&(b.end_date=l),n&&(b.problem_id=n),u&&(b.page=u),o&&(b.page_size=o),B({url:`/problem/daily/list?${new URLSearchParams(b).toString()}`,method:"get"})}function ja(e,l){return B({url:"/problem/crawl",method:"post",data:{oj:e,id:l}})}function gn(e,l,n,u,o,b,f){return B({url:"/problem/create",method:"post",data:{title:e,time_limit:l,memory_limit:n,source:u,private:o,tags:b,description:f}})}function bn(e,l,n,u,o,b,f,S){return B({url:"/problem/edit",method:"post",data:{id:e,title:l,time_limit:n,memory_limit:u,source:o,private:b,tags:f,description:S}})}function hn(e,l,n,u){return B({url:"/problem/daily/create",method:"post",data:{id:e,problem_id:l,solution:n,code:u}})}function yn(e,l,n,u){return B({url:"/problem/daily/edit",method:"post",data:{id:e,problem_id:l,solution:n,code:u}})}function wn(e,l){return B({url:"/problem/judge/data/download?id="+e+"&key="+l,method:"get"})}function kn(e){return e||(e=""),B({url:"/problem/image/token?id="+e,method:"get"})}function Cn(e){return e||(e=""),B({url:"/problem/daily/image/token?id="+e,method:"get"})}function Sn(e,l){const n=new FormData;return n.append("id",e),n.append("zip",l),B({url:"/problem/judge/data",method:"post",data:n,headers:{"Content-Type":"multipart/form-data"},timeout:1e3*60*5})}function In(e){return B({url:"/problem/parse",method:"post",data:{problems:e}})}const Pn={class:"sh-main"},xn={class:"dida-swiper-div"},Vn=ue({__name:"HomeView",setup(e){const{globalProperties:l}=pe();let n=-1;const u=m({theme:"info",content:""}),o=m({title:"",content:""}),b=m([]),f=m(!1),S=m(!1),d=m(!1),s=async()=>{u.value=await Sa()},T=async()=>{try{const h=await Ia();o.value.title=h.title,o.value.content=h.content}catch{ve(l,"加载公告失败"),o.value={title:"公告加载失败",content:"请刷新页面重新获取"}}},v=async()=>{const h=await nn();if(h.code!==0){ve(l,"加载OJ统计数据失败");return}let _=[];for(const g of h.data){const C=new Date(g.date),c=`${C.getMonth()+1}-${C.getDate()}`;_.push({Date:c,Type:"Unaccept",Count:g.attempt-g.accept}),_.push({Date:c,Type:"Accept",Count:g.accept})}const i={type:"bar",data:[{id:"barData",values:_}],xField:"Date",yField:"Count",seriesField:"Type",stack:!0,legends:{visible:!0},bar:{state:{hover:{stroke:"#000",lineWidth:1}}},height:300};new Ga(i,{dom:"ojStaticsDiv"}).renderSync()},k=async()=>{b.value=[];const h=await vn();if(h.code!==0){ve(l,"加载每日问题数据失败");return}h.data.list&&h.data.list.length>0&&h.data.list.forEach(_=>{let i="default",p="未尝试";if(h.data.attempt_status){const C=h.data.attempt_status[_.problem_id];if(C)switch(C){case Ne.Accept:i="success",p="已解决";break;case Ne.Attempt:i="warning",p="待解决";break;default:i="default",p="未尝试"}}const g=`${_.title}`;b.value.push({id:_.id,title:g,problemId:_.problem_id,theme:i,tag:p})})};return ce(async()=>{d.value=!0,f.value=!0,S.value=!0,(async()=>(await s(),n=setInterval(()=>{s()},3e4),await T(),d.value=!1))(),(async()=>(await v(),f.value=!1))(),(async()=>(await k(),S.value=!1))()}),Fa(()=>{clearInterval(n)}),(h,_)=>{const i=St,p=fl,g=pl,C=Ve,c=Ae("md-preview"),r=be,A=xe,I=lt,y=gl,j=tt,w=_l,V=vl,$=Pe;return L(),M(C,{loading:d.value},{default:a(()=>[t($,null,{default:a(()=>[t(A,{span:8},{default:a(()=>{var U;return[z("div",Pn,[u.value?(L(),M(i,{key:0,class:"dida-notification-div",theme:u.value.theme},{default:a(()=>[x(E(u.value.content),1)]),_:1},8,["theme"])):le("",!0),z("div",xn,[t(g,{class:"dida-swiper"},{default:a(()=>[t(p,null,{default:a(()=>_[1]||(_[1]=[z("a",{href:"http://codeoj.cn",target:"_blank"},[z("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"})],-1)])),_:1}),t(p,null,{default:a(()=>_[2]||(_[2]=[z("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1})]),_:1})]),t(C,{loading:f.value&&!d.value},{default:a(()=>_[3]||(_[3]=[z("div",{id:"ojStaticsDiv",style:{"min-height":"200px"}},null,-1)])),_:1},8,["loading"]),t(r,{title:(U=o.value)==null?void 0:U.title,style:{width:"calc(100% - 100px)",margin:"0 auto"}},{default:a(()=>{var D;return[t(c,{"model-value":(D=o.value)==null?void 0:D.content,previewTheme:"cyanosis"},null,8,["model-value"])]}),_:1},8,["title"])])]}),_:1}),t(A,{span:4},{default:a(()=>[t(r,{style:{margin:"10px"},bordered:!0},{default:a(()=>_[4]||(_[4]=[z("img",{src:"https://api.jysafe.cn/ip/",alt:"Welcome",style:{width:"100%"}},null,-1)])),_:1}),t(Bl,{style:{margin:"10px"}}),t(r,{style:{margin:"10px"},bordered:!0,title:"每日一题"},{actions:a(()=>[t(I,{onClick:_[0]||(_[0]=U=>h.$router.push({name:"problem-daily-list"}))},{default:a(()=>_[5]||(_[5]=[x("查看全部")])),_:1})]),default:a(()=>[t(C,{loading:S.value&&!d.value},{default:a(()=>[t(V,{split:!0,size:"small",style:{"min-height":"200px"}},{default:a(()=>[(L(!0),te(de,null,Ie(b.value,U=>(L(),M(w,{key:U.id},{default:a(()=>[t(y,{style:{width:"100px"}},{description:a(()=>[t(I,{onClick:D=>h.$router.push({name:"problem-daily-detail",params:{dailyId:U.id}})},{default:a(()=>[x(E(U.problemId),1)]),_:2},1032,["onClick"])]),_:2},1024),t(y,{style:{width:"200px"}},{description:a(()=>[t(I,{onClick:D=>h.$router.push({name:"problem-daily-detail",params:{dailyId:U.id}})},{default:a(()=>[x(E(U.title),1)]),_:2},1032,["onClick"])]),_:2},1024),t(y,{style:{width:"135px"},description:U.id},null,8,["description"]),t(y,null,{description:a(()=>[t(j,{theme:U.theme},{default:a(()=>[x(E(U.tag),1)]),_:2},1032,["theme"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["loading"])]),_:1}),t(r,{style:{margin:"10px"},bordered:!0},{header:a(()=>_[6]||(_[6]=[z("b",null,"友情链接",-1)])),default:a(()=>[t(V,null,{default:a(()=>[t(w,null,{default:a(()=>[t(I,{href:"https://boiltask.com",target:"_blank"},{default:a(()=>_[7]||(_[7]=[x("BoilTask Blog")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])}}}),ie=(e,l)=>{const n=e.__vccOpts||e;for(const[u,o]of l)n[u]=o;return n},Tn=ie(Vn,[["__scopeId","data-v-805a64dc"]]),Dn={class:"sh-main"},Ln=ue({__name:"View404",setup(e){let l=Ce(),n=m(l.fullPath);return(u,o)=>{const b=G;return L(),te("div",Dn,[z("p",null,E(fe(n)),1),o[2]||(o[2]=z("p",null,"该页面无效或已被迁移，请重新选择访问目标",-1)),t(b,{theme:"primary",onClick:o[0]||(o[0]=()=>u.$router.push("/"))},{default:a(()=>o[1]||(o[1]=[x("返回首页")])),_:1})])}}}),Ua=ie(Ln,[["__scopeId","data-v-d4218944"]]);function jn(e){const l={};return l.id=e.id,l.username=e.username,l.nickname=e.nickname,l.email=e.email,l.slogan=e.slogan,l.organization=e.organization,l.accept=e.accept,l.attempt=e.attempt,l.vjudgeId=e.vjudge_id,e.email&&(l.avatar=`https://www.gravatar.com/avatar/${Na(e.email.toLowerCase().trim())}?d=identicon&s=100`),l}function Un(e,l){return B({url:"/user/login",method:"post",data:{username:e,password:l}})}function $n(){return B({url:"/user/login/refresh",method:"post"})}function zn(e){const l={username:e};return B({url:`/user/info?${new URLSearchParams(l).toString()}`,method:"get"})}function An(e){const l="https://vjudge.net/user/solveDetail/"+encodeURIComponent(e);return xt({url:l,method:"get"})}function Rn(e){return B({url:"/user/account/infos",method:"post",data:{users:e}})}function Mn(e){return B({url:"/user/parse",method:"post",data:{users:e}})}function En(e,l){return B({url:"/user/register/email",method:"post",data:{token:e,email:l}})}function qn(e,l,n,u,o){return B({url:"/user/register",method:"post",data:{username:e,password:l,email:n,key:u,nickname:o}})}function Kn(e,l){return B({url:"/user/forget",method:"post",data:{token:e,username:l}})}function Fn(e,l,n){return B({url:"/user/password/modify",method:"post",data:{username:e,password:l,key:n}})}const Gn={class:"dida-login-footer"},Nn=ue({__name:"LoginView",setup(e){const{globalProperties:l}=pe(),n=qe(),u=m(!1),o=m({username:"",password:""}),b=()=>{ke(l,"重置成功")},f=({validateResult:S,firstError:d})=>{u.value||(u.value=!0,Un(o.value.username,o.value.password).then(s=>{if(s.code===0){n.loadResponse(s.data),ke(l,"登录成功");let T=l.$route.query.redirect_uri;T||(T="/user/"+s.data.username),l.$router.push({path:T})}else F(l,s.code)}).catch(s=>{console.error("Login error",s),ve(l,"登录失败")}).finally(()=>{u.value=!1}))};return ce(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),(S,d)=>{const s=$e,T=Ue,v=G,k=je,h=lt,_=be;return L(),M(_,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(k,{ref:"form",data:o.value,colon:!0,onReset:b,onSubmit:f,class:"yj-login-form","label-width":0},{default:a(()=>[t(T,{name:"username"},{default:a(()=>[t(s,{modelValue:o.value.username,"onUpdate:modelValue":d[0]||(d[0]=i=>o.value.username=i),clearable:"",autocomplete:"username",placeholder:"请输入用户名"},{"prefix-icon":a(()=>[t(fe(Oa))]),_:1},8,["modelValue"])]),_:1}),t(T,{name:"password"},{default:a(()=>[t(s,{modelValue:o.value.password,"onUpdate:modelValue":d[1]||(d[1]=i=>o.value.password=i),type:"password",autocomplete:"current-password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":a(()=>[t(fe(Ha))]),_:1},8,["modelValue"])]),_:1}),t(T,null,{default:a(()=>[t(v,{theme:"primary",type:"submit",block:"",loading:u.value},{default:a(()=>d[4]||(d[4]=[x("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),z("div",Gn,[t(h,{onClick:d[2]||(d[2]=()=>{fe(l).$router.push({name:"login-forget"})})},{default:a(()=>d[5]||(d[5]=[x("忘记密码 ")])),_:1}),t(h,{onClick:d[3]||(d[3]=()=>{fe(l).$router.push({name:"register"})})},{default:a(()=>d[6]||(d[6]=[x("注册账户 ")])),_:1})])]),_:1})}}}),On=ie(Nn,[["__scopeId","data-v-524b77f9"]]),Hn={class:"dida-login-footer"},Bn=ue({__name:"RegisterView",setup(e){const{globalProperties:l}=pe(),n=qe(),u=m(!1),o=m(!1),b=m(!1),f=m("发送验证码");let S=null,d=-1;const s=m(!1),T=m(null),v=m({username:"",password:"",confirmPassword:"",nickname:"",email:"",emailKey:""}),h=m({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:c=>new Promise(r=>{const A=setTimeout(()=>{r(v.value.password===c),clearTimeout(A)})}),message:"两次密码不一致"}],nickname:[{required:!0,message:"请填写昵称"},{min:1,message:"昵称至少1个字符"},{max:30,message:"昵称最多30个字符"}],email:[{required:!0,message:"请填写邮箱"},{pattern:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"邮箱格式不正确"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),_=m(()=>t(G,{onClick:i,disabled:b.value,loading:o.value,style:"width:120px"},{default:()=>[f.value]})),i=async()=>{var I;if(!v.value.email){ve(l,"请输入邮箱");return}if(!v.value.email.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)){ve(l,"邮箱格式不正确");return}if(b.value||o.value)return;s.value=!0,await ct();const c=document.getElementById("cf-confirm-div");c&&c.remove();const r=document.createElement("div");r.id="cf-confirm-div",r.setAttribute("data-theme","light"),(I=T.value)==null||I.appendChild(r);const A=window;A.turnstile.ready(function(){A.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(y){s.value=!1,await p(y)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},p=async c=>{if(!b.value){o.value=!0;try{const r=await En(c,v.value.email);if(r.code!==0){F(l,r.code);return}ke(l,"发送验证码成功"),o.value=!1,b.value=!0,S=new Date,f.value="60秒后重发",d=setInterval(()=>{const I=Math.floor((new Date().getTime()-(S==null?void 0:S.getTime()))/1e3);I>60?(f.value="发送验证码",b.value=!1,clearInterval(d)):f.value=`${60-I}秒后重发`},1e3)}catch{ve(l,"发送验证码失败")}finally{o.value=!1}}},g=()=>{ke(l,"重置成功")},C=({validateResult:c,firstError:r,e:A})=>{if(!u.value){if(A.preventDefault(),c!==!0){ve(l,r);return}if(v.value.password!==v.value.confirmPassword){ve(l,"两次密码不一致");return}u.value=!0,qn(v.value.username,v.value.password,v.value.email,v.value.emailKey,v.value.nickname).then(I=>{I.code===0?(ke(l,"注册成功，可使用账号信息登录"),l.$router.push({name:"login"})):F(l,I.code)}).catch(I=>{console.error("Login error",I),ve(l,"登录失败")}).finally(()=>{u.value=!1})}};return ce(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),Te(()=>{clearInterval(d)}),(c,r)=>{const A=$e,I=Ue,y=ga,j=G,w=je,V=lt,$=be,U=nt;return L(),te(de,null,[t($,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(w,{ref:"form",rules:h.value,data:v.value,colon:!0,onReset:g,onSubmit:C,class:"yj-login-form"},{default:a(()=>[t(I,{name:"username",label:"用户名"},{default:a(()=>[t(A,{modelValue:v.value.username,"onUpdate:modelValue":r[0]||(r[0]=D=>v.value.username=D),clearable:"",placeholder:"用于登录与查找"},null,8,["modelValue"])]),_:1}),t(I,{name:"password",label:"密码"},{default:a(()=>[t(A,{modelValue:v.value.password,"onUpdate:modelValue":r[1]||(r[1]=D=>v.value.password=D),type:"password",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(I,{name:"confirmPassword",label:"确认密码"},{default:a(()=>[t(A,{modelValue:v.value.confirmPassword,"onUpdate:modelValue":r[2]||(r[2]=D=>v.value.confirmPassword=D),type:"password",clearable:"",placeholder:"请确认密码"},null,8,["modelValue"])]),_:1}),t(I,{name:"nickname",label:"昵称"},{default:a(()=>[t(A,{modelValue:v.value.nickname,"onUpdate:modelValue":r[3]||(r[3]=D=>v.value.nickname=D),clearable:"",placeholder:"用于优先在网站各处展示"},null,8,["modelValue"])]),_:1}),t(I,{name:"email",label:"邮箱"},{default:a(()=>[t(A,{modelValue:v.value.email,"onUpdate:modelValue":r[4]||(r[4]=D=>v.value.email=D),clearable:"",placeholder:"请填写常用邮箱"},null,8,["modelValue"])]),_:1}),t(I,{name:"emailKey",label:"验证码"},{default:a(()=>[t(y,{append:_.value},{default:a(()=>[t(A,{modelValue:v.value.emailKey,"onUpdate:modelValue":r[5]||(r[5]=D=>v.value.emailKey=D),clearable:"",placeholder:"请输入验证码",style:{width:"140px"}},null,8,["modelValue"])]),_:1},8,["append"])]),_:1}),t(I,null,{default:a(()=>[t(j,{theme:"primary",type:"submit",block:"",loading:u.value},{default:a(()=>r[8]||(r[8]=[x("注册")])),_:1},8,["loading"])]),_:1})]),_:1},8,["rules","data"]),z("div",Hn,[t(V,{onClick:r[6]||(r[6]=()=>{fe(l).$router.push({name:"login"})})},{default:a(()=>r[9]||(r[9]=[x("返回登陆 ")])),_:1})])]),_:1}),t(U,{visible:s.value,"onUpdate:visible":r[7]||(r[7]=D=>s.value=D),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:a(()=>[z("div",{ref_key:"dialogContainer",ref:T,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),Wn=ie(Bn,[["__scopeId","data-v-9b5f4fc7"]]),Yn={key:0,style:{margin:"10px"}},Jn={key:1,style:{margin:"10px"}},Xn={style:{margin:"12px"}},Zn=ue({__name:"UserView",setup(e){let l=Ce();const{globalProperties:n}=pe(),u=Je();let o="";const b=m(!1),f=m(null),S=m([]),d=m([]),s=m([]),T=async v=>{b.value=!0;try{let k=await zn(v);if(k.code!==0){b.value=!1,F(n,k.code),await X.push({name:"home"});return}if(f.value=jn(k.data.user),S.value=k.data.problems_ac,u.setTitle(f.value.nickname+" - "+u.getTitle),f.value.vjudgeId){const h=await An(f.value.vjudgeId);d.value=h.acRecords;for(const _ in d.value)d.value[_].sort((i,p)=>i.length===p.length?i.localeCompare(p):i.length-p.length);s.value=h.failRecords;for(const _ in s.value)s.value[_].sort((i,p)=>i.length===p.length?i.localeCompare(p):i.length-p.length)}}catch{ve(n,"获取用户信息失败"),await X.push({name:"home"})}finally{b.value=!1}};return Ba(async(v,k,h)=>{if(Array.isArray(v.params.username)?o=v.params.username[0]:o=v.params.username,!o){await X.push({name:"home"});return}await T(o),h()}),ce(async()=>{if(Array.isArray(l.params.username)?o=l.params.username[0]:o=l.params.username,!o){await X.push({name:"home"});return}await T(o)}),(v,k)=>{const h=G,_=we,i=be,p=lt,g=Be,C=He,c=xe,r=bl,A=Pe,I=Ve;return L(),M(I,{loading:b.value},{default:a(()=>[t(A,{class:"dida-main-content"},{default:a(()=>[t(c,{span:8},{default:a(()=>{var y;return[t(i,{style:{margin:"10px"},title:"AC题目"},{default:a(()=>[t(_,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(L(!0),te(de,null,Ie(S.value,j=>(L(),M(h,{key:j,size:"small",onClick:()=>fe(X).push({name:"problem-detail",params:{problemId:j}})},{default:a(()=>[x(E(j),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),(y=f.value)!=null&&y.vjudgeId?(L(),M(i,{key:0,style:{margin:"10px"},title:"vjudge.net"},{actions:a(()=>{var j;return[t(p,{href:"https://vjudge.net/user/"+((j=f.value)==null?void 0:j.vjudgeId),target:"_blank"},{default:a(()=>{var w;return[x("@"+E((w=f.value)==null?void 0:w.vjudgeId),1)]}),_:1},8,["href"])]}),default:a(()=>[d.value&&Object.keys(d.value).length>0?(L(),te("div",Yn,[k[0]||(k[0]=z("div",{style:{margin:"5px"}},[z("span",null,"AC")],-1)),t(C,{layout:"vertical",bordered:!0},{default:a(()=>[(L(!0),te(de,null,Ie(d.value,(j,w)=>(L(),M(g,{key:w,label:w},{default:a(()=>[t(_,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(L(!0),te(de,null,Ie(j,V=>(L(),M(h,{key:V,size:"small",onClick:()=>fe(X).push({name:"problem-detail",params:{problemId:w+"-"+V}})},{default:a(()=>[x(E(V),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):le("",!0),s.value&&Object.keys(s.value).length>0?(L(),te("div",Jn,[k[1]||(k[1]=z("div",{style:{margin:"5px"}},[z("span",null,"Fail")],-1)),t(C,{layout:"vertical",bordered:!0},{default:a(()=>[(L(!0),te(de,null,Ie(s.value,(j,w)=>(L(),M(g,{key:w,label:w},{default:a(()=>[t(_,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(L(!0),te(de,null,Ie(j,V=>(L(),M(h,{key:V,size:"small",onClick:()=>fe(X).push({name:"problem-detail",params:{problemId:w+"-"+V}})},{default:a(()=>[x(E(V),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):le("",!0)]),_:1})):le("",!0)]}),_:1}),t(c,{span:4},{default:a(()=>[z("div",Xn,[t(C,{layout:"vertical",bordered:!0},{default:a(()=>[t(g,{label:"头像"},{default:a(()=>{var y;return[t(r,{shape:"round",size:"100px",image:(y=f.value)==null?void 0:y.avatar,"hide-on-load-failed":!1},null,8,["image"])]}),_:1}),t(g,{label:"昵称"},{default:a(()=>{var y;return[x(E((y=f.value)==null?void 0:y.nickname),1)]}),_:1}),t(g,{label:"Slogan"},{default:a(()=>{var y;return[x(E((y=f.value)==null?void 0:y.slogan),1)]}),_:1}),t(g,{label:"邮箱"},{default:a(()=>{var y;return[x(E((y=f.value)==null?void 0:y.email),1)]}),_:1}),t(g,{label:"组织"},{default:a(()=>{var y;return[x(E((y=f.value)==null?void 0:y.organization),1)]}),_:1}),t(g,{label:"通过数量"},{default:a(()=>{var y;return[x(E((y=f.value)==null?void 0:y.accept),1)]}),_:1}),t(g,{label:"提交数量"},{default:a(()=>{var y;return[x(E((y=f.value)==null?void 0:y.attempt),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Qn=ie(Zn,[["__scopeId","data-v-555e19aa"]]),Nt=[{name:"home",path:"/",title:"首页",showSidebar:!1,disableGenerateTab:!0,component:Tn},{name:"problem",path:"/problem",title:"题目",icon:"calculation",showSidebar:!0,redirect:"problem-list"},{name:"collection-detail-tab",title:"题集",path:"/collection",showSidebar:!0,disableGenerateTab:!0,redirect:"problem-collection-list"},{name:"judge",path:"/judge",title:"评测",icon:"code",showSidebar:!0,redirect:"judge-list"},{name:"contest",path:"/contest",title:"比赛",icon:"application",showSidebar:!0,redirect:"contest-list"},{name:"contest-detail-tab",title:"比赛",path:"/contest",showSidebar:!0,disableGenerateTab:!0,redirect:"contest-list"},{name:"discuss",title:"讨论",path:"/discuss",icon:"sonic",showSidebar:!0,redirect:"discuss-list"},{name:"discuss-detail-tab",title:"讨论",path:"/discuss",showSidebar:!0,disableGenerateTab:!0,redirect:"discuss-list"},{name:"rank",path:"/rank",title:"排名",icon:"chart-column",showSidebar:!0,redirect:"rank-ac-all"},{name:"system",path:"/system",title:"系统",icon:"dashboard",showSidebar:!0,redirect:"system-status"},{name:"manage",path:"/manage",title:"管理",icon:"command",showSidebar:!0,redirect:"manage-web",auths:[ze.ManageWeb]},{name:"login",path:"/login",title:"登陆",showSidebar:!1,disableGenerateTab:!0,component:On},{name:"register",path:"/register",title:"注册",showSidebar:!1,disableGenerateTab:!0,component:Wn},{name:"user",path:"/user/:username+",title:"用户",showSidebar:!1,needLogin:!0,disableGenerateTab:!0,component:Qn},{name:"404",path:"/404",title:"404",showSidebar:!1,disableGenerateTab:!0,component:Ua}],eo=e=>Nt.find(l=>l.name==e),to=e=>{const l=[];return Nt.forEach(n=>{!n.disableGenerateTab&&e.hasAllAuths(n.auths)&&l.push(n)}),l},ao=e=>{Nt.forEach(l=>{const n={name:l.name,path:l.path,meta:{title:l.title,tab:l.name,showSidebar:l.showSidebar,needLogin:l.needLogin,redirect:l.redirect,tabAuths:l.auths},component:l.component};e.push(n)})};function $a(e){return e.children!==void 0}function lo(e){return e.children!==void 0}const no={style:{margin:"10px"}},oo={key:0,class:"dida-operation-container"};function so(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const ro=ue({__name:"ProblemList",setup(e){const l=Ce(),n=Ye(),{globalProperties:u}=pe(),o=qe();let b=null;const f=m(!1),S={};let d={};const s=m(!1),T=Oe(()=>o.hasAuth(ze.ManageProblem)),v=m([{title:"ID",colKey:"id",cell:(D,P)=>{let q=I(P.row.id);return t(G,{variant:"dashed",theme:q,onClick:()=>A(P.row.id)},{default:()=>[P.row.id]})}},{title:"标题",colKey:"title",cell:(D,P)=>t(G,{variant:"text",onClick:()=>A(P.row.id)},{default:()=>[P.row.title]})},{title:"标签",colKey:"tags",cell:(D,P)=>{const q=P.row.tags;if(!q||q.length===0)return"";let R=[];for(let W=0;W<q.length;W++){const ee=q[W];R.push(t(G,{key:W,theme:"default",variant:"outline",size:"small",onClick:()=>w(ee)},{default:()=>[ee.name]}))}return t(we,null,so(R)?R:{default:()=>[R]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),k=m(!1);let h=1,_=50;const i=m({current:h,pageSize:_,defaultCurrent:h,defaultPageSize:_,total:0,pageSizeOptions:[50,100]}),p=m(),g=m(),C=[{label:"DidaOJ",value:"didaoj"},{label:"HDU",value:"hdu"},{label:"POJ",value:"poj"},{label:"NYOJ",value:"nyoj"}],c=m({oj:"",title:"",tag:"",private:!1}),r=m({oj:"",problem:""}),A=D=>{D&&n.push({path:"/problem/"+D})},I=D=>{if(!D||!d)return"default";const P=d[D];if(!P)return"default";switch(P){case Ne.Accept:return"success";case Ne.Attempt:return"warning";default:return"default"}},y=async()=>{await n.push({query:{...l.query,oj:c.value.oj,title:c.value.title,tag:c.value.tag,private:c.value.private?"1":"0",page:1,page_size:i.value.defaultPageSize}})},j=async()=>{try{s.value=!0;const D=await ja(r.value.oj,r.value.problem);D.code===0?(ke(u,"搜索成功"),await n.push({name:"problem-detail",params:{problemId:D.data}})):F(u,D.code)}catch(D){console.error(D),F(u,Ke())}finally{s.value=!1}},w=D=>{D&&n.push({query:{...l.query,title:"",tag:D.name,page:1,page_size:i.value.defaultPageSize}})},V=()=>{n.push({name:"manage-problem-create"})},$=async(D,P)=>{k.value=!0;try{const{current:q,pageSize:R}=D,W=await cn(c.value.oj,c.value.title,c.value.tag,c.value.private,q,R);if(p.value=[],W.code===0){const ee=W.data.list;if(!ee||ee.length<=0){i.value={...i.value,total:0},d={},ke(u,"未找到记录");return}ee.forEach(ne=>{var Z;const ae=_t(ne,S);(Z=p.value)==null||Z.push(ae)}),i.value={...i.value,total:W.data.total_count},d=W.data.problem_attempt_status}else P&&F(u,W.code)}catch(q){console.error(q),F(u,Ke())}finally{k.value=!1}},U=async D=>{await n.push({query:{...l.query,page:D.current,page_size:D.pageSize}})};return ce(async()=>{k.value=!0,g.value=[],La(-1).then(D=>{if(D.code===0){g.value=D.data.list,f.value=D.data.total_count>D.data.list.length;for(let P=0;P<D.data.list.length;P++){const q=D.data.list[P];S[q.id]=q}b=Le(()=>l.query,P=>{c.value.oj=P.oj||"",c.value.title=P.title||"",c.value.tag=P.tag||"",c.value.private=P.private==="1";const q=parseInt(P.page)||i.value.defaultCurrent,R=parseInt(P.page_size)||i.value.defaultPageSize;h=q,_=R,i.value={...i.value,current:h,pageSize:_},$({current:h,pageSize:_},!0)},{immediate:!0})}else f.value=!0}).catch(D=>{console.error(D),f.value=!0})}),Te(()=>{b&&b()}),(D,P)=>{const q=Re,R=be,W=xe,ee=G,ne=we,ae=pt,Z=Ue,Y=$e,me=ft,Q=je,H=Pe;return L(),M(H,null,{default:a(()=>[t(W,{span:9},{default:a(()=>[t(R,{style:{margin:"10px"}},{default:a(()=>[t(q,{data:p.value,columns:v.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:i.value,"table-layout":"auto",loading:k.value,onPageChange:U},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(W,{span:3},{default:a(()=>[z("div",no,[T.value?(L(),te("div",oo,[t(ne,null,{default:a(()=>[t(ee,{onClick:V},{default:a(()=>P[7]||(P[7]=[x("新建")])),_:1})]),_:1})])):le("",!0),t(R,{class:"sh-card"},{default:a(()=>[t(Q,{model:c.value,onSubmit:y},{default:a(()=>[t(Z,{label:"OJ"},{default:a(()=>[t(ae,{modelValue:c.value.oj,"onUpdate:modelValue":P[0]||(P[0]=N=>c.value.oj=N),options:C,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(Z,{label:"标题"},{default:a(()=>[t(Y,{modelValue:c.value.title,"onUpdate:modelValue":P[1]||(P[1]=N=>c.value.title=N),placeholder:"请输入关键词"},null,8,["modelValue"])]),_:1}),t(Z,{label:"标签"},{default:a(()=>[t(Y,{modelValue:c.value.tag,"onUpdate:modelValue":P[2]||(P[2]=N=>c.value.tag=N),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),T.value?(L(),M(Z,{key:0,label:"私有"},{default:a(()=>[t(me,{modelValue:c.value.private,"onUpdate:modelValue":P[3]||(P[3]=N=>c.value.private=N)},null,8,["modelValue"])]),_:1})):le("",!0),t(Z,null,{default:a(()=>[t(ee,{theme:"primary",type:"submit"},{default:a(()=>P[8]||(P[8]=[x("搜索")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(R,{class:"sh-card"},{default:a(()=>[t(Q,{model:r.value,onSubmit:j},{default:a(()=>[t(Z,{label:"OJ"},{default:a(()=>[t(ae,{modelValue:r.value.oj,"onUpdate:modelValue":P[4]||(P[4]=N=>r.value.oj=N),options:C,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(Z,{label:"题目"},{default:a(()=>[t(Y,{modelValue:r.value.problem,"onUpdate:modelValue":P[5]||(P[5]=N=>r.value.problem=N),placeholder:"请输入原始题号"},null,8,["modelValue"])]),_:1}),t(Z,null,{default:a(()=>[t(ee,{theme:"primary",type:"submit",loading:s.value},{default:a(()=>P[9]||(P[9]=[x("前往")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),t(R,{class:"sh-card sh-background-black"},{default:a(()=>[(L(!0),te(de,null,Ie(g.value,N=>(L(),M(ee,{class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:()=>w(N)},{default:a(()=>[x(E(N.name),1)]),_:2},1032,["onClick"]))),256)),f.value?(L(),M(ee,{key:0,class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:P[6]||(P[6]=()=>D.$router.push("/problem/tags"))},{default:a(()=>P[10]||(P[10]=[x(" ... ")])),_:1})):le("",!0)]),_:1})])]),_:1})]),_:1})}}}),uo=ie(ro,[["__scopeId","data-v-bc7185f5"]]);function at(e){let l="";for(;e>0;)e--,l=String.fromCharCode(65+e%26)+l,e=Math.floor(e/26);return l}function Ot(e){const l={};if(l.id=e.id,l.ownerId=e.owner_id,l.ownerUsername=e.owner_username,l.ownerNickname=e.owner_nickname,l.title=e.title,l.startTime=new Date(e.start_time).toLocaleString(),l.endTime=new Date(e.end_time).toLocaleString(),l.createTime=new Date(e.create_time).toLocaleString(),l.updateTime=new Date(e.update_time).toLocaleString(),l.private=e.private,l.description=e.description,l.notification=e.notification,e.problems){l.problems=[],e.problems.sort((n,u)=>n.index-u.index);for(let n=0;n<e.problems.length;n++){const u=e.problems[n];let o={accept:0,attempt:0,author:"",id:"",private:!1,tags:[],title:""};o.index=u.index,o.id=at(u.index),o.title=u.title,u.accept?o.accept=u.accept:o.accept=0,u.attempt?o.attempt=u.attempt:o.attempt=0,l.problems.push(o)}}return l}function io(e){return B({url:"/contest?id="+e,method:"get"})}function co(e){return B({url:"/contest/edit?id="+e,method:"get"})}function mo(e){return B({url:"/contest/problem/list?id="+e,method:"get"})}function po(e){return e||(e=0),B({url:"/contest/image/token?id="+e,method:"get"})}function fo(e,l){return B({url:"/contest/problem?id="+e+"&problem_index="+l,method:"get"})}function vo(e,l){return B({url:"/contest/list?page="+e+"&page_size="+l,method:"get"})}function _o(e){return B({url:"/contest/rank?id="+e,method:"get"})}function go(e){return B({url:"/contest/create",method:"post",data:e})}function bo(e){return B({url:"/contest/edit",method:"post",data:e})}function ho(e,l){return B({url:"/contest/password",method:"post",data:{id:e,password:l}})}function yo(e){return B({url:"/contest/dolos",method:"post",data:{id:e}})}const Ht=async(e,l)=>{l&&await e.push({name:"user",params:{username:l}})},Qt=e=>{const l=X.resolve({name:"problem-detail",params:{problemId:e}});window.open(l.href,"_blank")},Mt=async(e,l)=>{await X.push({name:"contest-problem-detail",params:{contestId:e,problemIndex:l}})},wo={class:"sh-button"},ko={style:{"margin-top":"16px"}},Co={__name:"SecretPanel",setup(e){const l=m(!1);return(n,u)=>{const o=G;return L(),te("div",Xa(Za(n.$attrs)),[z("div",wo,[t(o,{onClick:u[0]||(u[0]=b=>l.value=!l.value)},{default:a(()=>[x(E(l.value?"收起":"展开"),1)]),_:1})]),Wa(z("div",ko,[Ja(n.$slots,"default",{},void 0)],512),[[Ya,l.value]])],16)}}},ea=ie(Co,[["__scopeId","data-v-23f11aab"]]),So={key:1,style:{"text-align":"center"}},Io={key:1,style:{"text-align":"center"}},Po={key:0,class:"dida-problems-container"},xo={style:{margin:"12px"}},Vo={key:1},To={class:"dida-operation-container"},Do={key:0,class:"dida-operation-container"},Lo={class:"dida-code-submit-div"},jo={class:"dida-code-editor-div"},Uo=ue({__name:"ProblemDetail",setup(e){let l=Ce();const{globalProperties:n}=pe();let u=null;const o=Je(),b=qe();let f=m(""),S="",d="",s=0,T=m(0);const v=m(!1),k=m(!1),h=m(!1),_=m(null);let i=null;const p=m(null),g=m(!1),C=m(!1),c={},r=m(""),A=m([]);A.value=Ft();const I=m([]),y=m(null),j=m(-1),w=m(-1),V=m(""),$=m("");let U=0;const D=Oe(()=>b.hasAuth(ze.ManageProblem)),P=Oe(()=>b.hasAuth(ze.ManageProblemDaily)),q=()=>{y.value&&clearInterval(y.value),y.value=setInterval(()=>{const K=j.value<=0,O=new Date(new Date().getTime()+U),re=O.getHours()*60*60+O.getMinutes()*60+O.getSeconds(),_e=18*60*60;re<_e?j.value=_e-re:j.value=-1,w.value=24*60*60-re,(!K&&j.value<=0||w.value<=0)&&se()},1e3)},R=()=>{y.value&&(clearInterval(y.value),y.value=null)},W=K=>{K&&X.push({name:"problem-list",query:{...l.query,title:"",tag:K.name}})},ee=async()=>{if(!d){ve(n,"每日问题ID无效");return}await X.push({name:"manage-problem-daily",params:{dailyId:d}})},ne=async()=>{let K=S;if(!K)try{const O=await fo(s,T.value);O.code===0?K=O.data:F(n,O.code)}catch{ve(n,"获取题目ID失败，请稍后再试");return}await X.push({name:"manage-problem",params:{problemId:K}})},ae=()=>{S?X.push({name:"judge-list",query:{problem_id:S}}):X.push({name:"contest-judge",params:{contestId:s},query:{problem_id:at(T.value)}})},Z=()=>{S?X.push({name:"discuss-list-problem",query:{problem_id:S}}):X.push({name:"contest-discuss",params:{contestId:s},query:{problem_id:at(T.value)}})},Y=()=>{X.push({name:"problem-recommend",params:{problemId:S}})},me=async()=>{var re,_e;const K=(re=_.value)==null?void 0:re.originOj,O=(_e=_.value)==null?void 0:_e.originId;if(!(!K||!O))try{g.value=!0;const ge=await ja(K,O);ge.code===0?(await N(),ke(n,"更新成功")):F(n,ge.code)}catch{ve(n,"更新失败，请稍后再试")}finally{g.value=!1}},Q=async()=>{const K=parseInt(r.value);if(!yt(K)){ve(n,"请选择所编写的语言");return}const O=i==null?void 0:i.getValue();if(!O){ve(n,"请输入所需提交的代码");return}if(!S&&(!s||!T.value)){ve(n,"问题ID无效");return}C.value=!0;try{const re=await en(S,s,T.value,K,O);if(re.code!==0){F(n,re.code);return}ke(n,"提交成功，正在跳转到详情页面");const _e=re.data.id;s?await X.push({name:"contest-judge-detail",params:{contestId:s,judgeId:_e}}):await X.push({name:"judge-detail",params:{judgeId:_e}})}finally{C.value=!1}},H=K=>{if(!i)return;const O=i.getModel();O&&Zt.setModelLanguage(O,Gt(K))},N=async()=>{I.value=[];let K=await Da(S,s,T.value);if(K.code!==0){h.value=!1,F(n,K.code),await X.push({name:"problem"});return}K.data.tags&&K.data.tags.forEach(O=>{c[O.id]=O}),_.value=_t(K.data.problem,c),o.setTitle(_.value.title+" - "+o.getTitle),s&&(K=await mo(s),K.code===0?(K.data.problems.sort((O,re)=>O-re),I.value=K.data.problems):F(n,K.code)),f.value=_.value.description,await ct(()=>{!i&&p.value&&(i=Zt.create(p.value,{value:"",language:"cpp",minimap:{enabled:!0},colorDecorators:!0,readOnly:!1,theme:"vs-dark"})),h.value=!1})},se=async()=>{R(),k.value=!1;const K=await pn(d);if(K.code!==0)return;k.value=!0;const O=K.data.problem_daily;S=O.problem_id,V.value=O.solution,$.value=O.code;const re=new Date(K.data.time);U=re.getTime()-new Date().getTime();const _e=new Date(re.getTime()),ge=_e.getFullYear(),J=String(_e.getMonth()+1).padStart(2,"0"),he=String(_e.getDate()).padStart(2,"0"),Se=`${ge}-${J}-${he}`;if(d===Se){const ye=re.getHours()*60*60+re.getMinutes()*60+re.getSeconds(),De=18*60*60;ye<De?j.value=De-ye:j.value=-1,w.value=24*60*60-ye}(j.value>=0||w.value>=0)&&q()};return ce(async()=>{u=Le(()=>l.params,async()=>{if(k.value=!1,Array.isArray(l.params.problemId)?S=l.params.problemId[0]:S=l.params.problemId,S||(Array.isArray(l.params.dailyId)?d=l.params.dailyId[0]:d=l.params.dailyId,h.value=!0,await se(),h.value=!1),!S){if(Array.isArray(l.params.contestId)?s=Number(l.params.contestId[0]):s=Number(l.params.contestId),!s){ve(n,"题目不存在"),d?await X.push({name:"problem-daily-list"}):await X.push({name:"problem"});return}if(Array.isArray(l.params.problemIndex)?T.value=parseInt(l.params.problemIndex[0]):T.value=parseInt(l.params.problemIndex),!T.value){ve(n,"题目不存在"),await X.push({name:"problem"});return}}v.value=!!s,h.value=!0,await N()},{immediate:!0}),p.value&&new ResizeObserver(()=>{i&&i.layout()}).observe(p.value)}),Te(()=>{u&&(u(),u=null),R()}),(K,O)=>{const re=Ae("md-preview"),_e=be,ge=Et,J=we,he=xe,Se=G,ye=Be,De=lt,We=He,Xe=qt,et=pt,ot=Pe,Tt=Ve;return L(),M(Tt,{loading:h.value},{default:a(()=>[t(ot,{class:"dida-main-content"},{default:a(()=>[t(he,{span:8},{default:a(()=>[t(_e,{style:{margin:"10px"}},{default:a(()=>[t(re,{"model-value":fe(f),previewTheme:"cyanosis"},null,8,["model-value"])]),_:1}),k.value?(L(),M(_e,{key:0,style:{margin:"10px"},title:"题解"},{default:a(()=>[j.value<0?(L(),M(ea,{key:0},{default:a(()=>[t(re,{"model-value":V.value,previewTheme:"cyanosis"},null,8,["model-value"])]),_:1})):(L(),te("div",So,[z("div",null,[t(J,null,{default:a(()=>[O[2]||(O[2]=z("p",null,"距离解锁百分比",-1)),t(ge,{theme:"circle",color:{from:"#0052D9",to:"#00A870"},percentage:100-j.value/(18*60*60)*100,status:"active"},{label:a(()=>[x(E((100-j.value/(18*60*60)*100).toFixed(3))+"% ",1)]),default:a(()=>[O[1]||(O[1]=x(" > "))]),_:1},8,["percentage"])]),_:1})])]))]),_:1})):le("",!0),k.value?(L(),M(_e,{key:1,style:{margin:"10px"},title:"示例代码"},{default:a(()=>[w.value<0?(L(),M(ea,{key:0},{default:a(()=>[t(re,{"model-value":$.value,previewTheme:"cyanosis"},null,8,["model-value"])]),_:1})):(L(),te("div",Io,[z("div",null,[t(J,{style:{margin:"0 auto"}},{default:a(()=>[O[4]||(O[4]=z("p",null,"距离解锁百分比",-1)),t(ge,{theme:"circle",color:{from:"#0052D9",to:"#00A870"},percentage:100-w.value/(24*60*60)*100,status:"active"},{label:a(()=>[x(E((100-w.value/(24*60*60)*100).toFixed(3))+"% ",1)]),default:a(()=>[O[3]||(O[3]=x(" > "))]),_:1},8,["percentage"])]),_:1})])]))]),_:1})):le("",!0)]),_:1}),t(he,{span:4},{default:a(()=>{var Yt;return[fe(s)?(L(),te("div",Po,[t(J,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(L(!0),te(de,null,Ie(I.value,(Me,oe)=>(L(),M(Se,{key:oe,theme:Me==fe(T)?"primary":"default",onClick:async()=>await fe(Mt)(fe(s),Me)},{default:a(()=>[x(E(fe(at)(Me)),1)]),_:2},1032,["theme","onClick"]))),128))]),_:1})])):le("",!0),z("div",xo,[t(We,{layout:"vertical",bordered:!0},{default:a(()=>{var Me;return[t(ye,{label:"ID"},{default:a(()=>{var oe;return[x(E((oe=_.value)==null?void 0:oe.id),1)]}),_:1}),t(ye,{label:"标题"},{default:a(()=>{var oe;return[x(E((oe=_.value)==null?void 0:oe.title),1)]}),_:1}),t(ye,{label:"时间限制"},{default:a(()=>{var oe;return[x(E((oe=_.value)==null?void 0:oe.timeLimit),1)]}),_:1}),t(ye,{label:"内存限制"},{default:a(()=>{var oe;return[x(E((oe=_.value)==null?void 0:oe.memoryLimit),1)]}),_:1}),t(ye,{label:"判题方式"},{default:a(()=>{var oe;return[x(E((oe=_.value)==null?void 0:oe.judgeType),1)]}),_:1}),v.value?le("",!0):(L(),M(ye,{key:0,label:"正确提交"},{default:a(()=>{var oe;return[x(E((oe=_.value)==null?void 0:oe.accept),1)]}),_:1})),v.value?le("",!0):(L(),M(ye,{key:1,label:"提交总数"},{default:a(()=>{var oe;return[x(E((oe=_.value)==null?void 0:oe.attempt),1)]}),_:1})),t(ye,{label:"创建时间"},{default:a(()=>{var oe;return[x(E((oe=_.value)==null?void 0:oe.insertTime),1)]}),_:1}),t(ye,{label:"更新时间"},{default:a(()=>{var oe;return[x(E((oe=_.value)==null?void 0:oe.updateTime),1)]}),_:1}),t(ye,{label:"上传用户"},{default:a(()=>{var oe;return[x(E((oe=_.value)==null?void 0:oe.creatorNickname),1)]}),_:1}),v.value?le("",!0):(L(),M(ye,{key:2,label:"题目来源"},{default:a(()=>{var oe,Ze,dt;return[(oe=_.value)!=null&&oe.sourceUrl?(L(),M(De,{key:0,href:(Ze=_.value)==null?void 0:Ze.sourceUrl,target:"_blank"},{default:a(()=>{var Jt;return[x(E((Jt=_.value)==null?void 0:Jt.source),1)]}),_:1},8,["href"])):(L(),te("span",Vo,E((dt=_.value)==null?void 0:dt.source),1))]}),_:1})),D.value?(L(),M(ye,{key:3,label:"是否私有"},{default:a(()=>{var oe;return[x(E((oe=_.value)!=null&&oe.private?"私有":"公开"),1)]}),_:1})):le("",!0),(Me=_.value)!=null&&Me.originUrl?(L(),M(ye,{key:4,label:"原题链接"},{default:a(()=>{var oe;return[t(De,{href:(oe=_.value)==null?void 0:oe.originUrl,target:"_blank"},{default:a(()=>{var Ze,dt;return[x(E((Ze=_.value)==null?void 0:Ze.originOj)+" - "+E((dt=_.value)==null?void 0:dt.originId),1)]}),_:1},8,["href"])]}),_:1})):le("",!0),fe(S)?(L(),M(ye,{key:5,label:"标签"},{default:a(()=>[t(J,null,{default:a(()=>{var oe;return[(L(!0),te(de,null,Ie((oe=_.value)==null?void 0:oe.tags,Ze=>(L(),M(Se,{key:Ze.id,variant:"dashed",onClick:()=>W(Ze)},{default:a(()=>[x(E(Ze.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})):le("",!0)]}),_:1}),z("div",To,[t(J,null,{default:a(()=>[t(Se,{onClick:ae},{default:a(()=>O[5]||(O[5]=[x("提交记录")])),_:1}),t(Se,{onClick:Z},{default:a(()=>O[6]||(O[6]=[x("题目讨论")])),_:1}),fe(S)?(L(),M(Se,{key:0,onClick:Y},{default:a(()=>O[7]||(O[7]=[x("题目推荐")])),_:1})):le("",!0)]),_:1})]),k.value&&P.value||D.value||(Yt=_.value)!=null&&Yt.originId?(L(),te("div",Do,[t(J,null,{default:a(()=>{var Me;return[k.value&&P.value?(L(),M(Se,{key:0,onClick:ee},{default:a(()=>O[8]||(O[8]=[x("每日一题")])),_:1})):le("",!0),D.value?(L(),M(Se,{key:1,onClick:ne},{default:a(()=>O[9]||(O[9]=[x("编辑")])),_:1})):le("",!0),(Me=_.value)!=null&&Me.originId?(L(),M(Se,{key:2,onClick:me,loading:g.value},{default:a(()=>O[10]||(O[10]=[x("更新描述 ")])),_:1},8,["loading"])):le("",!0)]}),_:1})])):le("",!0),z("div",Lo,[t(J,null,{default:a(()=>[t(et,{modelValue:r.value,"onUpdate:modelValue":O[0]||(O[0]=Me=>r.value=Me),label:"语言：",placeholder:"请选择提交语言","auto-width":"",clearable:"",onChange:H},{default:a(()=>[(L(!0),te(de,null,Ie(A.value,Me=>(L(),M(Xe,{key:Me.value,value:Me.value,label:Me.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),t(Se,{onClick:Q,loading:C.value},{default:a(()=>O[11]||(O[11]=[x("提交")])),_:1},8,["loading"])]),_:1}),z("div",jo,[z("div",{ref_key:"codeEditRef",ref:p,class:"dida-code-editor"},null,512)])])])]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),Lt=ie(Uo,[["__scopeId","data-v-bf97b778"]]),$o={style:{margin:"10px"}},zo={key:0,class:"dida-operation-container"};function Ao(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const Ro=ue({__name:"ProblemDailyList",setup(e){const l=Ce(),n=Ye(),{globalProperties:u}=pe(),o=qe();let b=!1,f=null,S={},d={};const s=Oe(()=>o.hasAuth(ze.ManageProblem)),T=m([{title:"日期",colKey:"id",cell:(w,V)=>t(G,{variant:"dashed",onClick:()=>g(V.row.id)},{default:()=>[V.row.id]})},{title:"ID",colKey:"problemId",cell:(w,V)=>{let $=C(V.row.problemId);return t(G,{variant:"dashed",theme:$,onClick:()=>g(V.row.id)},{default:()=>[V.row.problemId]})}},{title:"标题",colKey:"title",cell:(w,V)=>t(G,{variant:"text",onClick:()=>g(V.row.id)},{default:()=>[V.row.title]})},{title:"标签",colKey:"tags",cell:(w,V)=>{const $=V.row.tags;if(!$||$.length===0)return"";let U=[];for(let D=0;D<$.length;D++){const P=$[D];U.push(t(G,{key:D,theme:"default",variant:"outline",size:"small",onClick:()=>A(P)},{default:()=>[P.name]}))}return t(we,null,Ao(U)?U:{default:()=>[U]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),v=m(!1);let k=1,h=50;const _=m({current:k,pageSize:h,defaultCurrent:k,defaultPageSize:h,total:0,pageSizeOptions:[50,100]}),i=m([]),p=m({date:[],problemId:""}),g=w=>{w&&n.push({name:"problem-daily-detail",params:{dailyId:w}})},C=w=>{if(!w||!d)return"default";const V=d[w];if(!V)return"default";switch(V){case Ne.Accept:return"success";case Ne.Attempt:return"warning";default:return"default"}},c=async()=>{let w="";p.value.date&&p.value.date.length>1&&(w=p.value.date[0]+"~"+p.value.date[1]),await n.push({query:{...l.query,date:w,problem_id:p.value.problemId,page:1,page_size:_.value.defaultPageSize}})},r=async()=>{p.value.date=[],p.value.problemId="",await n.push({query:{...l.query,date:"",problem_id:"",page:1,page_size:_.value.defaultPageSize}})},A=w=>{w&&n.push({name:"problem-list",query:{...l.query,title:"",tag:w.name,page:1,page_size:_.value.defaultPageSize}})},I=()=>{n.push({name:"manage-problem-daily-create"})},y=async(w,V)=>{v.value=!0;try{const{current:$,pageSize:U}=w;let D="";p.value.date[0]&&(D=p.value.date[0]);let P="";p.value.date[1]&&(P=p.value.date[1]);const q=await _n(D,P,p.value.problemId,$,U);if(i.value=[],q.code===0){const R=q.data.list;if(!R||R.length<=0){_.value={..._.value,total:0},d={},ke(u,"未找到记录");return}S={},q.data.tags&&q.data.tags.forEach(W=>{S[W.id]=W}),R.forEach(W=>{var ne;const ee=Ta(W,S);(ne=i.value)==null||ne.push(ee)}),_.value={..._.value,total:q.data.total_count},d=q.data.attempt_status}else V&&F(u,q.code)}catch($){console.error($),F(u,Ke())}finally{v.value=!1}},j=async w=>{await n.push({query:{...l.query,page:w.current,page_size:w.pageSize}})};return ce(async()=>{b=!0,v.value=!0,f=Le(()=>l.query,w=>{if(!b)return;if(p.value.date=[],w.date){const U=w.date.split("~");U.length===2&&(p.value.date=[U[0],U[1]])}p.value.problemId=w.problem_id||"";const V=parseInt(w.page)||_.value.defaultCurrent,$=parseInt(w.page_size)||_.value.defaultPageSize;k=V,h=$,_.value={..._.value,current:k,pageSize:h},y({current:k,pageSize:h},!0)},{immediate:!0})}),Te(()=>{b=!1,f&&f()}),(w,V)=>{const $=Re,U=be,D=xe,P=G,q=we,R=Kt,W=Ue,ee=$e,ne=je,ae=Pe;return L(),M(ae,null,{default:a(()=>[t(D,{span:9},{default:a(()=>[t(U,{style:{margin:"10px"}},{default:a(()=>[t($,{data:i.value,columns:T.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:_.value,"table-layout":"auto",loading:v.value,onPageChange:j},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(D,{span:3},{default:a(()=>[z("div",$o,[s.value?(L(),te("div",zo,[t(q,null,{default:a(()=>[t(P,{onClick:I},{default:a(()=>V[2]||(V[2]=[x("新建")])),_:1})]),_:1})])):le("",!0),t(U,{class:"sh-card"},{default:a(()=>[t(ne,{model:p.value,onSubmit:c,onReset:r},{default:a(()=>[t(W,{label:"日期","label-align":"top"},{default:a(()=>[t(R,{modelValue:p.value.date,"onUpdate:modelValue":V[0]||(V[0]=Z=>p.value.date=Z),"allow-input":"",clearable:"",format:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(W,{label:"问题","label-align":"top"},{default:a(()=>[t(ee,{modelValue:p.value.problemId,"onUpdate:modelValue":V[1]||(V[1]=Z=>p.value.problemId=Z),placeholder:"请输入问题ID",clearable:""},null,8,["modelValue"])]),_:1}),t(W,{"label-align":"top"},{default:a(()=>[t(q,null,{default:a(()=>[t(P,{theme:"primary",type:"submit"},{default:a(()=>V[3]||(V[3]=[x("搜索")])),_:1}),t(P,{theme:"danger",type:"reset"},{default:a(()=>V[4]||(V[4]=[x("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(U,{class:"sh-card",header:"每日一题","header-bordered":!0},{default:a(()=>V[5]||(V[5]=[z("p",null,"由管理员团队精选的题目，每日0点更新。",-1),z("p",null,"当日下午6点提供题解，次日提供AC代码。",-1)])),_:1})])]),_:1})]),_:1})}}}),Mo=ie(Ro,[["__scopeId","data-v-b97b04ec"]]),Eo={style:{margin:"10px"}},qo={style:{margin:"12px"}},Ko={class:"dida-edit-container"},Fo=ue({__name:"ProblemDailyEdit",setup(e){let l=Ce();const{globalProperties:n}=pe();let u=null;const o=m(""),b=m(!1),f=m(!1),S=m(null),d=m({date:"",problemId:"",solution:"",code:""}),s=()=>{X.push({name:"problem-daily-detail",params:{dailyId:o.value}})};async function T(p,g){f.value=!0,await vt(p,g,n,()=>Cn(o.value)),f.value=!1}const v=async()=>{f.value=!0;try{const p=d.value.date,g=await hn(p,d.value.problemId,d.value.solution,d.value.code);if(f.value=!0,g.code!==0){F(n,g.code);return}await X.push({name:"manage-problem-daily",params:{dailyId:p}}),Ge(n,"创建成功")}finally{f.value=!1}},k=async()=>{f.value=!0;try{const p=await yn(o.value,d.value.problemId,d.value.solution,d.value.code);if(f.value=!0,p.code!==0){F(n,p.code);return}S.value&&(p.data.update_time!=null&&(S.value.updateTime=new Date(p.data.update_time).toLocaleString()),p.data.updater_nickname!=null&&(S.value.updaterNickname=p.data.updater_nickname)),p.data.solution!=null&&(d.value.solution=p.data.solution),p.data.code!=null&&(d.value.code=p.data.code),Ge(n,"保存成功")}finally{f.value=!1}},h=p=>{d.value.solution=p,b.value=!1},_=p=>{d.value.code=p,b.value=!1},i=async()=>{const p=await fn(o.value);if(p.code!==0){F(n,p.code),console.error("problem get failed",p.code),await X.push({name:"problem"});return}const g=p.data;S.value=Ta(g,{}),d.value.problemId=g.problem_id,h(g.solution),_(g.code)};return ce(async()=>{u=Le(()=>l.params,async()=>{Array.isArray(l.params.dailyId)?o.value=l.params.dailyId[0]:o.value=l.params.dailyId,o.value?(b.value=!0,d.value.date=o.value,await i()):(h("暂无题解"),_("暂无标程"))},{immediate:!0})}),Te(()=>{u&&(u(),u=null)}),(p,g)=>{const C=St,c=hl,r=Ue,A=$e,I=je,y=be,j=xe,w=G,V=we,$=Be,U=He,D=Pe,P=Ae("md-editor-v3"),q=Ve;return L(),M(q,{loading:b.value},{default:a(()=>[t(D,null,{default:a(()=>[t(j,{span:8},{default:a(()=>[z("div",Eo,[t(C,{theme:"info"},{default:a(()=>g[4]||(g[4]=[x("可以提前配置将来日期的题目，对外仅展示到截止到当天的题目")])),_:1}),t(y,{class:"sh-form-card"},{default:a(()=>[t(I,{model:d.value},{default:a(()=>[t(r,{label:"日期"},{default:a(()=>[t(c,{modelValue:d.value.date,"onUpdate:modelValue":g[0]||(g[0]=R=>d.value.date=R),disabled:o.value&&!0},null,8,["modelValue","disabled"])]),_:1}),t(r,{label:"问题ID"},{default:a(()=>[t(A,{modelValue:d.value.problemId,"onUpdate:modelValue":g[1]||(g[1]=R=>d.value.problemId=R),placeholder:"问题标题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(j,{span:4},{default:a(()=>[z("div",qo,[z("div",Ko,[o.value?(L(),M(V,{key:0},{default:a(()=>[t(w,{onClick:k,theme:"danger",loading:f.value},{default:a(()=>g[5]||(g[5]=[x("保存")])),_:1},8,["loading"]),t(w,{onClick:s},{default:a(()=>g[6]||(g[6]=[x("查看")])),_:1})]),_:1})):(L(),M(V,{key:1},{default:a(()=>[t(w,{onClick:v,theme:"danger",loading:f.value},{default:a(()=>g[7]||(g[7]=[x("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(L(),M(U,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t($,{label:"创建时间"},{default:a(()=>{var R;return[x(E((R=S.value)==null?void 0:R.createTime),1)]}),_:1}),t($,{label:"更新时间"},{default:a(()=>{var R;return[x(E((R=S.value)==null?void 0:R.updateTime),1)]}),_:1}),t($,{label:"创建用户"},{default:a(()=>{var R;return[x(E((R=S.value)==null?void 0:R.creatorNickname),1)]}),_:1}),t($,{label:"更新用户"},{default:a(()=>{var R;return[x(E((R=S.value)==null?void 0:R.updaterNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),z("div",null,[g[8]||(g[8]=z("p",{style:{"margin-left":"20px"}},"题解：",-1)),t(P,{id:"daily-solution-editor",modelValue:d.value.solution,"onUpdate:modelValue":g[2]||(g[2]=R=>d.value.solution=R),onSave:k,onOnUploadImg:T,previewTheme:"cyanosis"},null,8,["modelValue"]),t(q,{loading:f.value,attach:"#daily-solution-editor","z-index":1e5},null,8,["loading"])]),z("div",null,[g[9]||(g[9]=z("p",{style:{"margin-left":"20px"}},"标程：",-1)),t(P,{id:"daily-code-editor",modelValue:d.value.code,"onUpdate:modelValue":g[3]||(g[3]=R=>d.value.code=R),onSave:k,onOnUploadImg:T,previewTheme:"cyanosis"},null,8,["modelValue"]),t(q,{loading:f.value,attach:"#daily-code-editor","z-index":1e5},null,8,["loading"])])]),_:1},8,["loading"])}}}),ta=ie(Fo,[["__scopeId","data-v-fe63fd0d"]]),Go={style:{margin:"10px"}};function No(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const Oo=ue({__name:"ProblemRecommend",setup(e){const l=Ce(),n=Ye(),{globalProperties:u}=pe();let o=null,b="",f={},S={};const d=m([{title:"ID",colKey:"id",cell:(i,p)=>{let g=k(p.row.id);return t(G,{variant:"dashed",theme:g,onClick:()=>v(p.row.id)},{default:()=>[p.row.id]})}},{title:"标题",colKey:"title",cell:(i,p)=>t(G,{variant:"text",onClick:()=>v(p.row.id)},{default:()=>[p.row.title]})},{title:"标签",colKey:"tags",cell:(i,p)=>{const g=p.row.tags;if(!g||g.length===0)return"";let C=[];for(let c=0;c<g.length;c++){const r=g[c];C.push(t(G,{key:c,theme:"default",variant:"outline",size:"small",onClick:()=>h(r)},{default:()=>[r.name]}))}return t(we,null,No(C)?C:{default:()=>[C]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),s=m(!1),T=m(),v=i=>{i&&n.push({path:"/problem/"+i})},k=i=>{if(!i||!S)return"default";const p=S[i];if(!p)return"default";switch(p){case Ne.Accept:return"success";case Ne.Attempt:return"warning";default:return"default"}},h=i=>{i&&n.push({name:"problem-list",query:{tag:i.name}})},_=async i=>{s.value=!0;try{const p=await mn(b);if(T.value=[],p.code===0){const g=p.data.list;if(!g||g.length<=0){ke(u,"暂无推荐题目");return}f={},p.data.tags&&p.data.tags.forEach(C=>{f[C.id]=C}),g.forEach(C=>{var r;const c=_t(C,f);(r=T.value)==null||r.push(c)})}else i&&F(u,p.code)}catch(p){console.error(p),F(u,Ke())}finally{s.value=!1}};return ce(async()=>{s.value=!0,o=Le(()=>l.query,i=>{Array.isArray(l.params.problemId)?b=l.params.problemId[0]:b=l.params.problemId,_(!0)},{immediate:!0})}),Te(()=>{o&&o()}),(i,p)=>{const g=Re,C=be,c=xe,r=Pe;return L(),M(r,null,{default:a(()=>[t(c,{span:9},{default:a(()=>[t(C,{style:{margin:"10px"}},{default:a(()=>[t(g,{data:T.value,columns:d.value,"row-key":"id","vertical-align":"top",hover:!0,"table-layout":"auto",loading:s.value},null,8,["data","columns","loading"])]),_:1})]),_:1}),t(c,{span:3},{default:a(()=>[z("div",Go,[t(C,{class:"sh-card",header:"题目推荐","header-bordered":!0},{default:a(()=>p[0]||(p[0]=[x(" 根据本站其他用户的提交记录推荐类似题目"),z("br",null,null,-1),x("依据推荐算法来计算，与本用户相似度最高的用户做的题，大概率被自己感兴趣。 ")])),_:1})])]),_:1})]),_:1})}}}),Ho=ie(Oo,[["__scopeId","data-v-77972e8b"]]),Bo={style:{margin:"10px"}},Wo={key:1},Yo={style:{margin:"12px"}},Jo={class:"dida-edit-container"},Xo={class:"dida-description-editor"},Zo=ue({__name:"ProblemEdit",setup(e){let l=Ce();const{globalProperties:n}=pe(),u=Je(),o=m(""),b=m(!1),f=m(!1),S=m(!1),d=m(null),s=m({title:"",timeLimit:0,memoryLimit:0,source:"",private:!0,tags:[],description:""}),T=m([]),v=m([]),k=Oe(()=>{const I=[],y=T.value;for(let j=0,w=y.length;j<w;j++)y[j].value&&I.push(y[j].value);return I}),h=(I,y)=>{const{trigger:j,index:w,item:V}=y;if(j==="clear"&&(T.value=[]),["tag-remove","backspace"].includes(j)&&T.value.splice(w,1),j==="enter"){for(let U=0;U<v.value.length;U++){const D=v.value[U];if(D.label===V){for(let P=0;P<T.value.length;P++)if(T.value[P].label===D.label)return;T.value.push(D);return}}const $={label:V,value:V};T.value.push($),v.value=v.value.concat($)}},_=(I,{current:y,type:j})=>{if(!y){T.value=j==="check"?v.value.slice(1):[];return}if(j==="check"){const w=v.value.find(V=>V.value===y);if(!w)return;T.value.push(w)}else T.value=T.value.filter(w=>w.value!==y)},i=()=>{X.push({name:"problem-detail",params:{problemId:o.value}})},p=()=>{X.push({name:"manage-problem-judge",params:{problemId:o.value}})},g=async(I,y)=>{S.value=!0,await vt(I,y,n,()=>kn(o.value)),S.value=!1},C=async()=>{f.value=!0,s.value.tags=[];for(let I=0;I<T.value.length;I++){const y=T.value[I];y&&y.label&&s.value.tags.push(y.label)}try{const I=await gn(s.value.title,s.value.timeLimit,s.value.memoryLimit,s.value.source,s.value.private,s.value.tags,s.value.description);if(f.value=!0,I.code!==0){F(n,I.code);return}I.data!=null&&await X.push({name:"problem-detail",params:{problemId:I.data}}),Ge(n,"创建成功")}finally{f.value=!1}},c=async()=>{f.value=!0,s.value.tags=[];for(let I=0;I<T.value.length;I++){const y=T.value[I];y&&y.label&&s.value.tags.push(y.label)}try{const I=await bn(o.value,s.value.title,s.value.timeLimit,s.value.memoryLimit,s.value.source,s.value.private,s.value.tags,s.value.description);if(f.value=!0,I.code!==0){F(n,I.code);return}d.value&&I.data.update_time!=null&&(d.value.updateTime=new Date(I.data.update_time).toLocaleString()),I.data.description!=null&&(s.value.description=I.data.description),Ge(n,"保存成功")}finally{f.value=!1}},r=I=>{s.value.description=I,b.value=!1},A=async()=>{const I=await Da(o.value,void 0,void 0);if(I.code!==0){F(n,I.code),console.error("problem get failed",I.code),await X.push({name:"problem"});return}const y=I.data.problem;if(d.value=_t(y,{}),s.value.title=y.title,s.value.timeLimit=y.time_limit,s.value.memoryLimit=y.memory_limit,s.value.source=y.source,s.value.private=y.private,s.value.tags=[],T.value=[],I.data.tags)for(let w=0;w<I.data.tags.length;w++){const V=I.data.tags[w];V&&V.name&&(s.value.tags.push(V.name),T.value.push({label:V.name,value:V.id}))}u.setTitle(y.title+" - "+u.getTitle);let j=y.description;r(j)};return ce(async()=>{Array.isArray(l.params.problemId)?o.value=l.params.problemId[0]:o.value=l.params.problemId,o.value?(b.value=!0,La(-1).then(async I=>{I.code===0?(I.data.list&&I.data.list.forEach(y=>{v.value.push({label:y.name,value:y.id})}),await A()):(F(n,I.code),console.error("problem tag get failed",I.code),await X.push({name:"problem"}))}).catch(async I=>{console.error(I),F(n,"获取数据异常"),await X.push({name:"problem"})})):(s.value.timeLimit=1e3,s.value.memoryLimit=65536,r(""))}),(I,y)=>{const j=$e,w=Ue,V=ba,$=ft,U=wl,D=yl,P=je,q=be,R=xe,W=G,ee=we,ne=Be,ae=He,Z=Pe,Y=Ae("md-editor-v3"),me=Ve;return L(),M(me,{loading:b.value},{default:a(()=>[t(Z,null,{default:a(()=>[t(R,{span:8},{default:a(()=>[z("div",Bo,[t(q,{class:"sh-card"},{default:a(()=>[t(P,{model:s.value},{default:a(()=>[t(w,{label:"标题"},{default:a(()=>[t(j,{modelValue:s.value.title,"onUpdate:modelValue":y[0]||(y[0]=Q=>s.value.title=Q),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),t(w,{label:"时间限制"},{default:a(()=>[t(V,{modelValue:s.value.timeLimit,"onUpdate:modelValue":y[1]||(y[1]=Q=>s.value.timeLimit=Q),theme:"normal",min:0},{suffix:a(()=>y[6]||(y[6]=[z("span",null,"ms",-1)])),_:1},8,["modelValue"])]),_:1}),t(w,{label:"内存限制"},{default:a(()=>[t(V,{modelValue:s.value.memoryLimit,"onUpdate:modelValue":y[2]||(y[2]=Q=>s.value.memoryLimit=Q),theme:"normal",min:0},{suffix:a(()=>y[7]||(y[7]=[z("span",null,"KB",-1)])),_:1},8,["modelValue"])]),_:1}),t(w,{label:"来源"},{default:a(()=>[t(j,{modelValue:s.value.source,"onUpdate:modelValue":y[3]||(y[3]=Q=>s.value.source=Q),placeholder:"请输入题目来源"},null,8,["modelValue"])]),_:1}),t(w,{label:"私有"},{default:a(()=>[t($,{modelValue:s.value.private,"onUpdate:modelValue":y[4]||(y[4]=Q=>s.value.private=Q)},null,8,["modelValue"])]),_:1}),t(w,{label:"标签"},{default:a(()=>[t(D,{value:T.value,"allow-input":!0,placeholder:"请选择或输入","tag-input-props":{excessTagsDisplayType:"break-line"},"popup-props":{overlayInnerClassName:["narrow-scrollbar"],overlayInnerStyle:{maxHeight:"280px",overflowY:"auto",overscrollBehavior:"contain",padding:"6px"}},clearable:"",multiple:"",onTagChange:h},{panel:a(()=>[v.value.length?(L(),M(U,{key:0,value:k.value,options:v.value,onChange:_},null,8,["value","options"])):(L(),te("div",Wo,"暂无数据"))]),suffixIcon:a(()=>[t(fe(Qa))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(R,{span:4},{default:a(()=>[z("div",Yo,[z("div",Jo,[o.value?(L(),M(ee,{key:0},{default:a(()=>[t(W,{onClick:c,theme:"danger",loading:f.value},{default:a(()=>y[8]||(y[8]=[x("保存")])),_:1},8,["loading"]),t(W,{onClick:p,theme:"warning"},{default:a(()=>y[9]||(y[9]=[x("判题数据")])),_:1}),t(W,{onClick:i},{default:a(()=>y[10]||(y[10]=[x("查看")])),_:1})]),_:1})):(L(),M(ee,{key:1},{default:a(()=>[t(W,{onClick:C,theme:"danger",loading:f.value},{default:a(()=>y[11]||(y[11]=[x("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(L(),M(ae,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(ne,{label:"创建时间"},{default:a(()=>{var Q;return[x(E((Q=d.value)==null?void 0:Q.insertTime),1)]}),_:1}),t(ne,{label:"更新时间"},{default:a(()=>{var Q;return[x(E((Q=d.value)==null?void 0:Q.updateTime),1)]}),_:1}),t(ne,{label:"判题方式"},{default:a(()=>{var Q;return[x(E((Q=d.value)==null?void 0:Q.judgeType),1)]}),_:1}),t(ne,{label:"上传用户"},{default:a(()=>{var Q;return[x(E((Q=d.value)==null?void 0:Q.creatorNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),z("div",Xo,[y[12]||(y[12]=z("p",null,"题目描述",-1)),t(me,{loading:S.value||f.value},{default:a(()=>[t(Y,{modelValue:s.value.description,"onUpdate:modelValue":y[5]||(y[5]=Q=>s.value.description=Q),onSave:c,onOnUploadImg:g,previewTheme:"cyanosis"},null,8,["modelValue"])]),_:1},8,["loading"])])]),_:1},8,["loading"])}}}),aa=ie(Zo,[["__scopeId","data-v-e349d9e2"]]),Qo={style:{margin:"10px"}},es={style:{margin:"12px"}},ts={class:"dida-edit-container"},as=ue({__name:"ProblemJudge",setup(e){let l=Ce();const{globalProperties:n}=pe(),u=Je(),o=m(""),b=m(!1),f=m(null);let S=null;const d=m(null),s=m(""),T=m(!1),v=m(!1),k=m([{title:"文件",colKey:"file"},{title:"大小",colKey:"size",width:150,cell:(V,$)=>$.row.size.toFixed(0)+" B"},{title:"最后修改时间",colKey:"lastModified",width:180,cell:(V,$)=>new Date($.row.lastModified).toLocaleString()},{title:"操作",colKey:"action",width:100,cell:(V,$)=>t(G,{onClick:()=>C($.row.file)},{default:()=>[x("下载")]})}]),h=m([]),_=Oe(()=>({border:"2px dashed #ccc",borderRadius:"6px",padding:"20px",textAlign:"center",cursor:"pointer",backgroundColor:T.value?"#f0f9ff":"#fff",transition:"background-color 0.2s ease"})),i=Oe(()=>s.value?`已选择：${s.value}`:T.value?"松开文件以上传":"拖拽判题数据压缩包到这里，或点击选择文件"),p=()=>{X.push({name:"problem-detail",params:{problemId:o.value}})},g=()=>{X.push({name:"manage-problem",params:{problemId:o.value}})},C=async V=>{const $=await wn(o.value,V);if($.code!==0){F(n,$.code);return}const U=document.createElement("a");U.href=$.data,U.target="_blank",U.click(),URL.revokeObjectURL(U.href)},c=async()=>{if(!S){ve(n,"请选择压缩包");return}v.value=!0,Sn(o.value,S).then(async V=>{V.code==0?(d.value.value=null,S=null,s.value="",b.value=!0,Ge(n,"上传成功"),await w()):F(n,V.code)}).catch(V=>{console.log(V),n.$message.error({duration:3e3,content:"申请失败"})}).finally(()=>{v.value=!1})},r=()=>{var V;(V=d.value)==null||V.click()},A=V=>{const $=V.target.files[0];$&&(s.value=$.name,S=$)},I=V=>{T.value=!0},y=()=>{T.value=!1},j=V=>{V.preventDefault(),V.stopPropagation(),T.value=!1;const $=V.dataTransfer.files[0];if($){s.value=$.name;const U=new DataTransfer;U.items.add($),d.value.files=U.files,S=$}},w=async()=>{const V=await dn(o.value);if(V.code!==0){F(n,V.code),await X.push({name:"problem"});return}const $=V.data.problem;f.value=_t($,{}),u.setTitle($.title+" - "+u.getTitle),h.value=[],V.data.judges?V.data.judges.forEach(U=>{h.value.push({file:U.key,size:U.size,lastModified:U.last_modified})}):ve(n,"评测数据不存在"),b.value=!1};return ce(async()=>{if(Array.isArray(l.params.problemId)?o.value=l.params.problemId[0]:o.value=l.params.problemId,!o.value){ve(n,"题目不存在"),await X.push({name:"problem"});return}b.value=!0,await w()}),(V,$)=>{const U=Re,D=xe,P=G,q=we,R=Be,W=He,ee=Pe,ne=Ve;return L(),M(ne,{loading:b.value},{default:a(()=>[t(ee,null,{default:a(()=>[t(D,{span:7},{default:a(()=>[z("div",Qo,[z("div",{id:"drop-zone",style:va(_.value),onClick:r,onDragenter:Dt(I,["prevent"]),onDragover:$[0]||($[0]=Dt(()=>{},["prevent"])),onDragleave:Dt(y,["prevent"]),onDrop:j},[z("input",{ref_key:"fileInput",ref:d,type:"file",style:{display:"none"},onChange:A},null,544),x(" "+E(i.value),1)],36)]),t(U,{data:h.value,columns:k.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1}),t(D,{span:5},{default:a(()=>[z("div",es,[z("div",ts,[t(q,null,{default:a(()=>[t(P,{onClick:c,theme:"danger",loading:v.value},{default:a(()=>$[1]||($[1]=[x("上传")])),_:1},8,["loading"]),t(P,{onClick:g,theme:"warning"},{default:a(()=>$[2]||($[2]=[x("编辑")])),_:1}),t(P,{onClick:p},{default:a(()=>$[3]||($[3]=[x("查看")])),_:1})]),_:1})]),t(W,{layout:"vertical",bordered:!0},{default:a(()=>[t(R,{label:"标题"},{default:a(()=>{var ae;return[x(E((ae=f.value)==null?void 0:ae.title),1)]}),_:1}),t(R,{label:"创建时间"},{default:a(()=>{var ae;return[x(E((ae=f.value)==null?void 0:ae.insertTime),1)]}),_:1}),t(R,{label:"更新时间"},{default:a(()=>{var ae;return[x(E((ae=f.value)==null?void 0:ae.updateTime),1)]}),_:1}),t(R,{label:"判题方式"},{default:a(()=>{var ae;return[x(E((ae=f.value)==null?void 0:ae.judgeType),1)]}),_:1}),t(R,{label:"评测数据"},{default:a(()=>{var ae;return[x(E((ae=f.value)==null?void 0:ae.judgeMd5),1)]}),_:1}),t(R,{label:"上传用户"},{default:a(()=>{var ae;return[x(E((ae=f.value)==null?void 0:ae.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),ls=ie(as,[["__scopeId","data-v-12b13fb1"]]);function Bt(e){const l={};return l.id=e.id,l.ownerId=e.owner_id,l.ownerUsername=e.owner_username,l.ownerNickname=e.owner_nickname,l.title=e.title,e.start_time?l.startTime=new Date(e.start_time).toLocaleString():l.startTime="无限制",e.end_time?l.endTime=new Date(e.end_time).toLocaleString():l.endTime="无限制",e.update_time?l.updateTime=new Date(e.update_time).toLocaleString():l.updateTime="",e.create_time?l.createTime=new Date(e.create_time).toLocaleString():l.createTime="",e.description?l.description=e.description:l.description="",l.problems=e.problems,l}function ns(e){return B({url:"/collection?id="+e,method:"get"})}function os(e){return B({url:"/collection/edit?id="+e,method:"get"})}function ss(e,l){return B({url:"/collection/list?page="+e+"&page_size="+l,method:"get"})}function rs(e){return B({url:"/collection/rank?id="+e,method:"get"})}function us(e){return B({url:"/collection/create",method:"post",data:e})}function is(e){return B({url:"/collection/edit",method:"post",data:e})}function ds(e){return B({url:"/collection/join",method:"post",data:{id:e}})}function cs(e){return B({url:"/collection/quit",method:"post",data:{id:e}})}const ms={style:{margin:"10px"}},ps=ue({__name:"CollectionList",setup(e){const l=Ce(),n=Ye(),{globalProperties:u}=pe();let o=null;m(!1),m(!1);const b=m([{title:"ID",colKey:"id",width:"100",cell:(g,C)=>t(G,{variant:"text",onClick:()=>k(C.row.id)},{default:()=>[C.row.id]})},{title:"标题",colKey:"title",cell:(g,C)=>t(G,{variant:"text",onClick:()=>k(C.row.id)},{default:()=>[C.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),f=m(!1);let S=1,d=50;const s=m({current:S,pageSize:d,defaultCurrent:S,defaultPageSize:d,total:0,pageSizeOptions:[50,100]}),T=m(),v=m({title:"",username:""});m({title:"",description:"",open_time:[]});const k=g=>{g&&n.push({path:"/collection/"+g})},h=async()=>{await n.push({query:{...l.query,title:v.value.title,username:v.value.username,page:1,page_size:s.value.defaultPageSize}})},_=async(g,C)=>{var c;f.value=!0;try{const{current:r,pageSize:A}=g,I=await ss(r,A);if(T.value=[],I.code===0){const y=I.data.list;for(let j=0;j<y.length;j++){const w=y[j],V=Bt(w);(c=T.value)==null||c.push(V)}s.value={...s.value,total:I.data.total_count}}else C&&F(u,I.code)}catch(r){console.error(r),F(u,Ke())}finally{f.value=!1}},i=async g=>{await n.push({query:{...l.query,page:g.current,page_size:g.pageSize}})},p=async()=>{await n.push({name:"collection-create"})};return ce(async()=>{o=Le(()=>l.query,g=>{v.value.title=g.title||"",v.value.username=g.username||"";const C=parseInt(g.page)||s.value.defaultCurrent,c=parseInt(g.page_size)||s.value.defaultPageSize;S=C,d=c,s.value={...s.value,current:S,pageSize:d},_({current:S,pageSize:d},!0)},{immediate:!0})}),Te(()=>{o&&o()}),(g,C)=>{const c=Re,r=be,A=xe,I=$e,y=Ue,j=G,w=je,V=we,$=Pe;return L(),M($,null,{default:a(()=>[t(A,{span:9},{default:a(()=>[t(r,{style:{margin:"10px"}},{default:a(()=>[t(c,{data:T.value,columns:b.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:s.value,loading:f.value,onPageChange:i},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(A,{span:3},{default:a(()=>[z("div",ms,[t(r,{class:"sh-card"},{default:a(()=>[t(w,{model:v.value},{default:a(()=>[t(y,{label:"标题"},{default:a(()=>[t(I,{modelValue:v.value.title,"onUpdate:modelValue":C[0]||(C[0]=U=>v.value.title=U),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(y,{label:"负责人"},{default:a(()=>[t(I,{modelValue:v.value.username,"onUpdate:modelValue":C[1]||(C[1]=U=>v.value.username=U),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(y,null,{default:a(()=>[t(j,{theme:"primary",onClick:h},{default:a(()=>C[2]||(C[2]=[x("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(r,{class:"sh-card"},{default:a(()=>[t(V,null,{default:a(()=>[t(j,{onClick:p},{default:a(()=>C[3]||(C[3]=[x("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),fs=ie(ps,[["__scopeId","data-v-cffb6215"]]),vs={style:{margin:"20px"}},_s={class:"dida-operation-container"},gs={style:{margin:"12px"}},bs=ue({__name:"CollectionDetail",setup(e){let l=Ce();const{globalProperties:n}=pe(),u=Je(),o=qe();let b=0;const f=m(!1),S=m(null),d=m(!1),s=m(!1);let T={};const v=Oe(()=>o.hasAuth(ze.ManageCollection)||S.value&&o.getUserId==S.value.ownerId),k=C=>{if(!C||!T)return"default";const c=T[C];if(!c)return"default";switch(c){case Ne.Accept:return"success";case Ne.Attempt:return"warning";default:return"default"}},h=m([{title:"问题ID",colKey:"id",cell:(C,c)=>{const r=k(c.row.id);return t(G,{variant:"dashed",theme:r,onClick:()=>Qt(c.row.id)},{default:()=>[c.row.id]})}},{title:"标题",colKey:"title",cell:(C,c)=>t(G,{variant:"text",onClick:()=>Qt(c.row.id)},{default:()=>[c.row.title]})},{title:"正确",colKey:"accept",cell:(C,c)=>c.row.accept?c.row.accept:0},{title:"提交",colKey:"attempt",cell:(C,c)=>c.row.attempt?c.row.attempt:0}]),_=m([]),i=async()=>{if(!o.isLogin()){await X.push({name:"login"});return}s.value=!0;try{const C=await ds(b);if(C.code!==0){F(n,C.code);return}d.value=!0,Ge(n,"加入成功")}finally{s.value=!1}},p=async()=>{if(!o.isLogin()){await X.push({name:"login"});return}s.value=!0;try{const C=await cs(b);if(C.code!==0){F(n,C.code);return}d.value=!1,Ge(n,"退出成功")}finally{s.value=!1}},g=()=>{S.value&&X.push({name:"collection-edit",params:{collectionId:S.value.id}})};return ce(async()=>{if(Array.isArray(l.params.collectionId)?b=Number(l.params.collectionId[0]):b=Number(l.params.collectionId),!b){await X.push({name:"problem-collection-list"});return}d.value=!1,f.value=!0;const C=await ns(b);if(C.code!==0){f.value=!1,F(n,C.code),await X.push({name:"problem-collection-list"});return}d.value=C.data.joined,T=C.data.attempt_status||{},S.value=Bt(C.data.collection),_.value=[],C.data.collection.problems&&C.data.collection.problems.forEach(c=>{const r=C.data.problems.find(A=>A.id===c);_.value.push(r)}),u.setTitle(S.value.title+" - "+u.getTitle),f.value=!1}),(C,c)=>{const r=ya,A=ha,I=Re,y=be,j=xe,w=G,V=we,$=Be,U=He,D=Ae("md-preview"),P=Pe,q=Ve;return L(),M(q,{loading:f.value},{default:a(()=>[t(P,{class:"dida-main-content"},{default:a(()=>[t(j,{span:6},{default:a(()=>[z("div",vs,[t(A,{"max-item-width":"300"},{default:a(()=>[t(r,{to:{name:"problem-collection-list"}},{default:a(()=>c[0]||(c[0]=[x("题目集合")])),_:1}),t(r,null,{default:a(()=>{var R;return[x(E((R=S.value)==null?void 0:R.title),1)]}),_:1})]),_:1})]),t(y,{style:{margin:"10px"}},{default:a(()=>[t(I,{data:_.value,columns:h.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),_:1})]),_:1}),t(j,{span:6},{default:a(()=>{var R;return[z("div",_s,[t(V,null,{default:a(()=>[d.value?(L(),M(w,{key:0,onClick:p,loading:s.value},{default:a(()=>c[1]||(c[1]=[x("退出")])),_:1},8,["loading"])):(L(),M(w,{key:1,onClick:i,loading:s.value},{default:a(()=>c[2]||(c[2]=[x("加入")])),_:1},8,["loading"])),v.value?(L(),M(w,{key:2,onClick:g},{default:a(()=>c[3]||(c[3]=[x("编辑")])),_:1})):le("",!0)]),_:1})]),z("div",gs,[t(U,{layout:"vertical",bordered:!0},{default:a(()=>[t($,{label:"创建者"},{default:a(()=>{var W;return[x(E((W=S.value)==null?void 0:W.ownerNickname),1)]}),_:1})]),_:1}),t(U,{layout:"vertical",bordered:!0},{default:a(()=>[t($,{label:"开始时间"},{default:a(()=>{var W;return[x(E((W=S.value)==null?void 0:W.startTime),1)]}),_:1})]),_:1}),t(U,{layout:"vertical",bordered:!0},{default:a(()=>[t($,{label:"结束时间"},{default:a(()=>{var W;return[x(E((W=S.value)==null?void 0:W.endTime),1)]}),_:1})]),_:1})]),(R=S.value)!=null&&R.description?(L(),M(y,{key:0,style:{margin:"10px"}},{default:a(()=>{var W;return[t(D,{"model-value":(W=S.value)==null?void 0:W.description},null,8,["model-value"])]}),_:1})):le("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),hs=ie(bs,[["__scopeId","data-v-042bd4bb"]]),ys=ue({__name:"CollectionRank",setup(e){const l=Ce(),n=Ye(),{globalProperties:u}=pe();let o=null,b=0,f=0;const S=m([{title:"Rank",colKey:"rank",align:"center"},{title:"序号",colKey:"index",align:"center"},{title:"Username",colKey:"username",cell:(k,h)=>t(G,{variant:"text",onClick:()=>n.push({name:"user",params:{username:h.row.username}})},{default:()=>[h.row.username]})},{title:"昵称",colKey:"nickname",cell:(k,h)=>t(G,{variant:"text",onClick:()=>n.push({name:"user",params:{username:h.row.username}})},{default:()=>[h.row.nickname]})},{title:"Count",colKey:"count",cell:(k,h)=>t(G,{variant:"text",onClick:()=>n.push({name:"judge-list",query:{username:h.row.username,status:Fe.Accept}})},{default:()=>[`${h.row.accept} / ${f}`]})},{title:"Progress",colKey:"progress",cell:(k,h)=>{let _=100;return f>0&&(_=Number((h.row.accept/f*100).toFixed(2))),t(Et,{percentage:_},null)}}]),d=m(!1),s=m([]),T=({col:k,rowIndex:h})=>{let _=1;for(let i=h+1;i<s.value.length&&s.value[i].rank===s.value[h].rank;i++)_++;if(k.colKey==="rank")return{rowspan:_}},v=async k=>{d.value=!0;try{const h=await rs(b);if(s.value=[],h.code===0){f=h.data.problem;const _=h.data.ranks,i=[];if(_){for(let C=0;C<_.length;C++){const c=_[C];let r={userId:c.author_id,username:c.author_username,nickname:c.author_nickname};r.accept=c.accept,i.push(r)}i.sort((C,c)=>C.accept!==c.accept?c.accept-C.accept:C.userId-c.userId);let p=0,g=-1;for(let C=0;C<i.length;C++)i[C].accept!==g&&(p=C+1,g=i[C].accept),i[C].index=C+1,i[C].rank=p}s.value=i}else k&&F(u,h.code)}catch(h){console.error(h),F(u,Ke())}finally{d.value=!1}};return ce(async()=>{o=Le(()=>l.query,async()=>{if(Array.isArray(l.params.collectionId)?b=Number(l.params.collectionId[0]):b=Number(l.params.collectionId),!b){await n.push({name:"problem-collection-list"});return}await v(!0)},{immediate:!0})}),Te(()=>{o&&o()}),(k,h)=>{const _=Re,i=be,p=Pe;return L(),M(p,null,{default:a(()=>[t(i,{style:{margin:"10px"}},{default:a(()=>[z("div",null,[t(_,{data:s.value,columns:S.value,"row-key":"index","rowspan-and-colspan":T,"vertical-align":"middle",bordered:!0,hover:!0,loading:d.value},null,8,["data","columns","loading"])])]),_:1})]),_:1})}}});var Ee=(e=>(e[e.Valid=0]="Valid",e[e.Duplicate=1]="Duplicate",e[e.Invalid=2]="Invalid",e))(Ee||{});const ws={class:"dida-form-border"},ks={style:{"text-align":"right"}},Cs=ue({name:"ParseProblemList",__name:"ParseProblemList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:l}=pe(),n=m(!1),u=m(!1),o=m(""),b=_a(e,"modelValue");let f=[];Le(b,async k=>{JSON.stringify(k)!==JSON.stringify(f)&&(await s(k),f=b.value)},{deep:!0});const S=m([]),d=m([{title:"有效性",colKey:"validType",cell:(k,h)=>{switch(h.row.valid){case Ee.Valid:return t(tt,{theme:"success"},{default:()=>[x("有效")]});case Ee.Duplicate:return t(tt,{theme:"warning"},{default:()=>[x("重复")]});case Ee.Invalid:return t(tt,{theme:"danger"},{default:()=>[x("无效")]});default:return null}}},{title:"问题ID",colKey:"id"},{title:"标题",colKey:"title"}]),s=async k=>{const h=Array.from(new Set(k)),_=await In(h);if(_.code!==0){F(l,_.code),u.value=!1;return}const i=[],p=_.data.problems;let g=[];k.forEach(C=>{const c=p.find(r=>r.id===C);if(c){const r=i.find(A=>A.id===C);c.valid=r?Ee.Duplicate:Ee.Valid,i.push({id:C,title:c.title,valid:c.valid}),r||g.push(C)}else i.push({id:C,title:"-",valid:Ee.Invalid})}),S.value=i,f=g,b.value=g},T=async()=>{u.value=!0;const k=Ca(o.value);await s(k),n.value=!1,u.value=!1},v=()=>{S.value?o.value=S.value.map(k=>k.id).join(`
`):o.value="",n.value=!0};return(k,h)=>{const _=G,i=Re,p=It,g=nt;return L(),te(de,null,[z("div",ws,[z("div",ks,[t(_,{onClick:v},{default:a(()=>h[2]||(h[2]=[x("编辑")])),_:1})]),t(i,{data:S.value,columns:d.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(g,{visible:n.value,"onUpdate:visible":h[1]||(h[1]=C=>n.value=C),onConfirm:T,header:"请输入问题ID","confirm-loading":u.value},{default:a(()=>[h[3]||(h[3]=z("div",{style:{"margin-bottom":"10px"}},[z("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(p,{modelValue:o.value,"onUpdate:modelValue":h[0]||(h[0]=C=>o.value=C),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),za=ie(Cs,[["__scopeId","data-v-b0352688"]]),Ss={class:"dida-form-border"},Is={style:{"text-align":"right"}},Ps=ue({name:"ParseUserList",__name:"ParseUserList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:l}=pe(),n=m(!1),u=m(!1),o=m(""),b=_a(e,"modelValue");let f=[];Le(b,async _=>{JSON.stringify(_)!==JSON.stringify(f)&&(f=_,await T(_))},{deep:!0});const S=m(),d=m([{title:"有效性",colKey:"validType",cell:(_,i)=>{switch(i.row.valid){case Ee.Valid:return t(tt,{theme:"success"},{default:()=>[x("有效")]});case Ee.Duplicate:return t(tt,{theme:"warning"},{default:()=>[x("重复")]});case Ee.Invalid:return t(tt,{theme:"danger"},{default:()=>[x("无效")]})}}},{title:"Username",colKey:"username"},{title:"昵称",colKey:"nickname"}]),s=(_,i)=>{if(_.code!==0){F(l,_.code),u.value=!1;return}const p=[],g=_.data.users;let C=[];i?i.forEach(c=>{let r=null;if(g&&(r=g.find(A=>A.username.toLowerCase()===c.toLowerCase())),r){const A=p.find(y=>y.username.toLowerCase()===c.toLowerCase()),I=A?Ee.Duplicate:Ee.Valid;p.push({id:r.id,username:r.username,nickname:r.nickname,valid:I}),A||C.push(r.id)}else p.push({id:-1,username:c,nickname:"-",valid:Ee.Invalid})}):g&&g.forEach(c=>{const r=p.find(I=>I.id===c.id),A=r?Ee.Duplicate:Ee.Valid;p.push({id:c.id,username:c.username,nickname:c.nickname,valid:A}),r||C.push(c.id)}),S.value=p,f=C,b.value=C},T=async _=>{const i=Array.from(new Set(_)),p=await Rn(i);s(p)},v=async _=>{const i=Array.from(new Set(_)),p=await Mn(i);s(p,_)},k=async()=>{u.value=!0;const _=Ca(o.value);await v(_),n.value=!1,u.value=!1},h=()=>{S.value?o.value=S.value.map(_=>_.username).join(`
`):o.value="",n.value=!0};return(_,i)=>{const p=G,g=Re,C=It,c=nt;return L(),te(de,null,[z("div",Ss,[z("div",Is,[t(p,{onClick:h},{default:a(()=>i[2]||(i[2]=[x("编辑")])),_:1})]),t(g,{data:S.value,columns:d.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(c,{visible:n.value,"onUpdate:visible":i[1]||(i[1]=r=>n.value=r),onConfirm:k,header:"请输入用户Username","confirm-loading":u.value},{default:a(()=>[i[3]||(i[3]=z("div",{style:{"margin-bottom":"10px"}},[z("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(C,{modelValue:o.value,"onUpdate:modelValue":i[0]||(i[0]=r=>o.value=r),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Aa=ie(Ps,[["__scopeId","data-v-b0b99852"]]),xs={style:{margin:"10px"}},Vs={style:{margin:"12px"}},Ts={class:"dida-edit-container"},Ds=ue({__name:"CollectionEdit",setup(e){let l=Ce();const{globalProperties:n}=pe(),u=Je(),o=m(""),b=m(!1),f=m(!1),S=m(!1),d=m(null),s=m({title:"",openTime:[],private:!0,problems:[],members:[],description:""}),T=m(""),v=m(""),k=m(!1),h=async()=>{k.value=!0,S.value=!1,k.value=!1},_=async()=>{f.value=!0;try{const c={title:s.value.title,problems:s.value.problems,members:s.value.members,private:s.value.private,description:s.value.description};s.value.openTime[0]&&(c.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(c.end_time=new Date(s.value.openTime[1]));const r=await us(c);if(r.code!==0){F(n,r.code);return}r.data!=null&&await X.push({name:"collection-detail",params:{collectionId:r.data}}),Ge(n,"创建成功")}finally{f.value=!1}},i=async()=>{f.value=!0;try{const c={id:Number(o.value),title:s.value.title,private:s.value.private,problems:s.value.problems,members:s.value.members,description:s.value.description};s.value.openTime[0]&&(c.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(c.end_time=new Date(s.value.openTime[1]));const r=await is(c);if(r.code!==0){F(n,r.code);return}r.data!=null&&d.value&&(d.value.updateTime=new Date(r.data).toLocaleString()),Ge(n,"保存成功")}finally{f.value=!1}},p=c=>{s.value.description=c,b.value=!1};async function g(c,r){f.value=!0,ve(n,"本界面暂不支持上传图片"),f.value=!1}const C=async()=>{const c=await os(o.value);if(c.code!==0){F(n,c.code),console.error("collection get failed",c.code),await X.push({name:"problem-collection-list"});return}const r=c.data.collection;d.value=Bt(r),s.value.title=r.title,s.value.openTime=[],r.start_time?s.value.openTime.push(new Date(r.start_time)):s.value.openTime.push(""),r.end_time?s.value.openTime.push(new Date(r.end_time)):s.value.openTime.push(""),s.value.private=r.private,s.value.description=r.description,s.value.problems=r.problems,s.value.members=r.members,u.setTitle(r.title+" - "+u.getTitle);let A="";r.description&&(A=r.description),p(A)};return ce(async()=>{Array.isArray(l.params.collectionId)?o.value=l.params.collectionId[0]:o.value=l.params.collectionId,o.value?(b.value=!0,await C()):p("")}),(c,r)=>{const A=$e,I=Ue,y=Kt,j=ft,w=je,V=be,$=xe,U=G,D=we,P=Be,q=He,R=Pe,W=Ae("md-editor-v3"),ee=Ve,ne=It,ae=nt;return L(),te(de,null,[t(ee,{loading:b.value},{default:a(()=>[t(R,null,{default:a(()=>[t($,{span:8},{default:a(()=>[z("div",xs,[t(V,{class:"sh-card"},{default:a(()=>[t(w,{model:s.value},{default:a(()=>[t(I,{label:"标题"},{default:a(()=>[t(A,{modelValue:s.value.title,"onUpdate:modelValue":r[0]||(r[0]=Z=>s.value.title=Z),placeholder:"题集标题"},null,8,["modelValue"])]),_:1}),t(I,{label:"开启时间"},{default:a(()=>[t(y,{modelValue:s.value.openTime,"onUpdate:modelValue":r[1]||(r[1]=Z=>s.value.openTime=Z),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(I,{label:"私有"},{default:a(()=>[t(j,{modelValue:s.value.private,"onUpdate:modelValue":r[2]||(r[2]=Z=>s.value.private=Z)},null,8,["modelValue"])]),_:1}),t(I,{label:"成员"},{default:a(()=>[t(Aa,{modelValue:s.value.members,"onUpdate:modelValue":r[3]||(r[3]=Z=>s.value.members=Z)},null,8,["modelValue"])]),_:1}),t(I,{label:"问题"},{default:a(()=>[t(za,{modelValue:s.value.problems,"onUpdate:modelValue":r[4]||(r[4]=Z=>s.value.problems=Z)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t($,{span:4},{default:a(()=>[z("div",Vs,[z("div",Ts,[o.value?(L(),M(D,{key:0},{default:a(()=>[t(U,{onClick:i,theme:"danger",loading:f.value},{default:a(()=>r[8]||(r[8]=[x("保存")])),_:1},8,["loading"])]),_:1})):(L(),M(D,{key:1},{default:a(()=>[t(U,{onClick:_,theme:"danger",loading:f.value},{default:a(()=>r[9]||(r[9]=[x("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(L(),M(q,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(P,{label:"创建时间"},{default:a(()=>{var Z;return[x(E((Z=d.value)==null?void 0:Z.createTime),1)]}),_:1}),t(P,{label:"更新时间"},{default:a(()=>{var Z;return[x(E((Z=d.value)==null?void 0:Z.updateTime),1)]}),_:1}),t(P,{label:"创建用户"},{default:a(()=>{var Z;return[x(E((Z=d.value)==null?void 0:Z.ownerNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),t(W,{id:"collection-description-editor",modelValue:s.value.description,"onUpdate:modelValue":r[5]||(r[5]=Z=>s.value.description=Z),onSave:i,onOnUploadImg:g,previewTheme:"cyanosis",class:"dida-description-editor"},null,8,["modelValue"]),t(ee,{loading:f.value,attach:"#collection-description-editor","z-index":1e5},null,8,["loading"])]),_:1},8,["loading"]),t(ae,{visible:S.value,"onUpdate:visible":r[7]||(r[7]=Z=>S.value=Z),onConfirm:h,header:T.value,"confirm-loading":k.value},{default:a(()=>[r[10]||(r[10]=z("div",{style:{"margin-bottom":"10px"}},[z("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(ne,{modelValue:v.value,"onUpdate:modelValue":r[6]||(r[6]=Z=>v.value=Z),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),la=ie(Ds,[["__scopeId","data-v-79ccaf8c"]]);function na(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const Ls=ue({__name:"JudgeJobList",setup(e){const l=Ce(),n=Ye(),{globalProperties:u}=pe();let o=!1,b=null,f;const S=m(!1),d=m(null),s=m(!1);let T=-1;const v=m({problemId:"",username:"",language:void 0,status:void 0}),k=m([{title:"ID",colKey:"id",cell:(D,P)=>{let q=null;return wt(P.row.status)&&yt(P.row.language)&&(q=()=>{y(P.row.id)}),t(G,{variant:"text",onClick:q},{default:()=>[P.row.id]})}},{title:"问题",colKey:"problemId",cell:(D,P)=>{if(T){let q;return t(G,{variant:"text",onClick:()=>I(T,P.row.contestProblemIndex)},na(q=at(P.row.contestProblemIndex))?q:{default:()=>[q]})}return t(G,{variant:"text",onClick:()=>A(P.row.problemId)},{default:()=>[P.row.problemId]})}},{title:"状态",colKey:"status",align:"center",cell:(D,P)=>{let q=null;wt(P.row.status)&&yt(P.row.language)&&(q=()=>{y(P.row.id)});const R=P.row.status,W=Ct(R);let ee=!wt(R);const ne=Pa(R);let ae=[];return ut(R)&&ae.push(t(Ve,{text:P.row.state,size:"small",class:"dida-status-loading"},null)),ae.push(t("span",null,[W])),t(G,{theme:ne,variant:"outline",onClick:q,disabled:ee},na(ae)?ae:{default:()=>[ae]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"code",cell:(D,P)=>{let q=!yt(P.row.language);return t(G,{theme:"default",onClick:()=>r(P.row),disabled:q},{default:()=>[kt(P.row.language)+" / "+P.row.codeLength]})}},{title:"作者",colKey:"author",width:200,cell:(D,P)=>t(G,{variant:"text",onClick:()=>j(P.row.authorUsername)},{default:()=>[P.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),h=m(!1);let _=1,i=50;const p=m({current:_,pageSize:i,defaultCurrent:_,defaultPageSize:i,total:0,pageSizeOptions:[50,100]}),g=m(),C=m([]);C.value=Ft();const c=m([]);c.value=xa();const r=async D=>{s.value=!0,S.value=!0;try{d.value=D;const P=await an(Number(d.value.id));if(P.code===0){const q=P.data,R=Gt(q.language);d.value.code=`\`\`\`${R}
${q.code}
\`\`\``}else F(u,P.code)}finally{s.value=!1}},A=D=>{D&&n.push({path:"/problem/"+D})},I=(D,P)=>{n.push({name:"contest-problem-detail",params:{contestId:D,problemIndex:P}})},y=D=>{D&&(T>0?n.push({name:"contest-judge-detail",params:{contestId:T,judgeId:D}}):n.push({name:"judge-detail",params:{judgeId:D}}))},j=D=>{D&&n.push({path:"/user/"+D})},w=async()=>{await n.push({query:{...l.query,page:1,page_size:i,problem_id:v.value.problemId,username:v.value.username,language:v.value.language,status:v.value.status}})},V=async()=>{v.value.problemId="",v.value.username="",v.value.language=void 0,v.value.status=void 0,await n.push({query:{...l.query,page:1,page_size:i,problem_id:"",username:"",language:void 0,status:void 0}})},$=async(D,P)=>{P&&(h.value=!0);let q=!1;try{const{current:R,pageSize:W}=D,ee=await ln(T,v.value.problemId,v.value.username,v.value.language,v.value.status,R,W);if(g.value=[],ee.code===0){if(!ee.data.has_auth){ke(u,"您目前没有权限查看评测记录"),T?await n.push({name:"contest-detail",params:{contestId:T}}):await n.push({name:"judge-list"});return}ee.data.list&&ee.data.list.length>0?(ee.data.list.forEach(ae=>{var Y;const Z=Va(ae);(Y=g.value)==null||Y.push(Z),ut(ae.status)&&(q=!0)}),p.value={...p.value,total:ee.data.total_count}):(ke(u,"未找到记录"),p.value={...p.value,total:0})}else P&&F(u,ee.code)}catch(R){console.error(R),P&&F(u,Ke())}finally{P&&(h.value=!1),q&&o&&(f=setTimeout(()=>{$({current:_,pageSize:i},!1)},5e3))}},U=async D=>{await n.push({query:{...l.query,page:D.current,page_size:D.pageSize}})};return ce(async()=>{o=!0,b=Le(()=>l.query,D=>{Array.isArray(l.params.contestId)?T=Number(l.params.contestId[0]):T=Number(l.params.contestId),v.value.problemId=D.problem_id||"",v.value.username=D.username||"",D.language!=null?v.value.language=Number(D.language):v.value.language=void 0,D.status!=null?v.value.status=Number(D.status):v.value.status=void 0;const P=parseInt(D.page)||p.value.defaultCurrent,q=parseInt(D.page_size)||p.value.defaultPageSize;_=P,i=q,p.value.pageSizeOptions.includes(i)||(i=p.value.defaultPageSize),p.value={...p.value,current:_,pageSize:i},$({current:_,pageSize:i},!0)},{immediate:!0})}),Te(()=>{o=!1,b&&b(),clearTimeout(f)}),(D,P)=>{const q=$e,R=Ue,W=qt,ee=pt,ne=G,ae=we,Z=je,Y=Re,me=be,Q=lt,H=Ae("md-preview"),N=Ve,se=nt;return L(),te(de,null,[t(me,{style:{margin:"10px"}},{default:a(()=>[t(Z,{layout:"inline",onSubmit:w,onReset:V},{default:a(()=>[t(R,{label:"题号"},{default:a(()=>[t(q,{modelValue:v.value.problemId,"onUpdate:modelValue":P[0]||(P[0]=K=>v.value.problemId=K),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(R,{label:"用户"},{default:a(()=>[t(q,{modelValue:v.value.username,"onUpdate:modelValue":P[1]||(P[1]=K=>v.value.username=K),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(R,{label:"语言"},{default:a(()=>[t(ee,{modelValue:v.value.language,"onUpdate:modelValue":P[2]||(P[2]=K=>v.value.language=K),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:a(()=>[(L(!0),te(de,null,Ie(C.value,K=>(L(),M(W,{key:K.value,value:K.value,label:K.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(R,{label:"状态"},{default:a(()=>[t(ee,{modelValue:v.value.status,"onUpdate:modelValue":P[3]||(P[3]=K=>v.value.status=K),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:a(()=>[(L(!0),te(de,null,Ie(c.value,K=>(L(),M(W,{key:K.value,value:K.value,label:K.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(R,null,{default:a(()=>[t(ae,null,{default:a(()=>[t(ne,{theme:"primary",type:"submit"},{default:a(()=>P[7]||(P[7]=[x("搜索")])),_:1}),t(ne,{theme:"default",variant:"base",type:"reset"},{default:a(()=>P[8]||(P[8]=[x("重置")])),_:1})]),_:1})]),_:1})]),_:1}),t(Y,{data:g.value,columns:k.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:p.value,loading:h.value,onPageChange:U,"table-layout":"auto"},null,8,["data","columns","pagination","loading"])]),_:1}),t(se,{visible:S.value,"onUpdate:visible":P[5]||(P[5]=K=>S.value=K),width:"800px","cancel-btn":null,"close-btn":!1,onConfirm:P[6]||(P[6]=K=>S.value=!1)},{header:a(()=>[t(Q,{onClick:P[4]||(P[4]=()=>{var K;y((K=d.value)==null?void 0:K.id)})},{default:a(()=>{var K,O,re;return[x(E(((K=d.value)==null?void 0:K.id)+" - "+fe(kt)((O=d.value)!=null&&O.language?(re=d.value)==null?void 0:re.language:fe(Vt).Unknown)),1)]}),_:1})]),default:a(()=>[t(N,{loading:s.value},{default:a(()=>{var K;return[t(H,{"model-value":(K=d.value)==null?void 0:K.code,"code-foldable":!1,style:{"min-height":"100px"}},null,8,["model-value"])]}),_:1},8,["loading"])]),_:1},8,["visible"])],64)}}}),oa=ie(Ls,[["__scopeId","data-v-05589c5c"]]),js={class:"dida-code-container"},Us={key:2,class:"dida-edit-container"};function sa(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const $s=ue({__name:"JudgeJobDetail",setup(e){const l=Ce(),n=Ye(),u=qe(),{globalProperties:o}=pe();let b=!1,f,S=0,d=0;const s=m(""),T=m(null),v=m(""),k=m(0),h=m(null),_=m({from:"#5a96ff",to:"#00A870"}),i=m([{title:"ID",colKey:"id"},{title:"问题",colKey:"problemId",cell:(w,V)=>t(G,{variant:"text",onClick:()=>A(V.row.problemId)},{default:()=>[V.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(w,V)=>{const $=V.row.status,U=Ct($),D=Pa($);let P=[];return ut($)&&P.push(t(Ve,{text:V.row.state,size:"small",class:"dida-status-loading"},null)),P.push(t("span",null,[U])),t(G,{theme:D,variant:"outline"},sa(P)?P:{default:()=>[P]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"language",cell:(w,V)=>t("span",null,[kt(V.row.language)+" / "+V.row.codeLength])},{title:"作者",colKey:"author",width:200,cell:(w,V)=>t(G,{variant:"text",onClick:()=>I(V.row.authorUsername)},{default:()=>[V.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),p=m(!1),g=m(!1),C=m(),c=Oe(()=>u.hasAuth(ze.ManageJudge)),r=async()=>{if(!g.value){g.value=!0;try{const w=await un(S);w.code===0?await j(!0):F(o,w.code)}catch(w){console.error(w),F(o,Ke())}finally{g.value=!1}}},A=w=>{w&&n.push({path:"/problem/"+w})},I=w=>{w&&n.push({path:"/user/"+w})},y=w=>{const V=w.status,$=Ct(V);let U;switch(V){case Fe.Init:case Fe.Rejudge:case Fe.Compiling:case Fe.Running:U="default";break;case Fe.Accept:U="success";break;case Fe.PE:U="warning";break;default:U="danger";break}return t(we,null,{default:()=>[t(G,{theme:"default",variant:"outline"},{default:()=>[w.taskId]}),t(G,{theme:U,variant:"outline"},sa($)?$:{default:()=>[$]}),t("span",null,[x("分数："),w.score]),t("span",null,[x("用时："),w.time]),t("span",null,[x("内存："),w.memory])]})},j=async w=>{var $;w&&(p.value=!0);let V=!1;try{const U=await tn(S);if(C.value=[],U.code===0){const D=U.data,P=Va(D);if(($=C.value)==null||$.push(P),s.value=P.judgerName,_.value.to="#00A870",ut(D.status)?(h.value="active",P.taskTotal>0?(k.value=Number((P.taskCurrent/P.taskTotal*100).toFixed(2)),P.taskCurrent>=P.taskTotal&&(k.value=99)):k.value=0):(k.value=100,D.status===Fe.Accept?h.value="success":D.status===Fe.PE?(_.value.to="#F57C20",h.value="warning"):(_.value.to="#F56C6C",h.value="error")),D.code){const q=Gt(D.language);v.value=`\`\`\`${q}
${D.code}
\`\`\``}T.value=P,ut(D.status)&&(V=!0)}else w&&F(o,U.code),d?await n.push({name:"contest-judge",params:{contestId:d}}):await n.push({name:"judge-list"})}catch(U){console.error(U),w&&F(o,Ke())}finally{w&&(p.value=!1),V&&b&&(f=setTimeout(()=>{j(!1)},5e3))}};return ce(async()=>{if(b=!0,Array.isArray(l.params.judgeId)?S=Number(l.params.judgeId[0]):S=Number(l.params.judgeId),Array.isArray(l.params.contestId)?d=Number(l.params.contestId[0]):d=Number(l.params.contestId),!S){await n.push({name:"judge"});return}await j(!0)}),Te(()=>{b=!1,clearTimeout(f)}),(w,V)=>{var Y,me,Q;const $=Et,U=Re,D=be,P=Ae("md-preview"),q=xe,R=Be,W=He,ee=Pe,ne=kl,ae=Cl,Z=G;return L(),te(de,null,[t($,{color:_.value,status:h.value,class:"dida-job-progress",percentage:k.value},null,8,["color","status","percentage"]),t(D,{style:{margin:"10px"}},{default:a(()=>[t(U,{data:C.value,columns:i.value,"row-key":"id","vertical-align":"top",hover:!0,loading:p.value},null,8,["data","columns","loading"])]),_:1}),t(ee,null,{default:a(()=>[t(q,{span:8},{default:a(()=>[z("div",js,[t(P,{"model-value":v.value,class:"dida-code-div"},null,8,["model-value"])])]),_:1}),t(q,{span:4},{default:a(()=>[t(W,{layout:"vertical",bordered:!0,style:{margin:"20px"}},{default:a(()=>[t(R,{label:"判题机"},{default:a(()=>[x(E(s.value),1)]),_:1}),t(R,{label:"判题时间"},{default:a(()=>{var H;return[x(E((H=T.value)==null?void 0:H.judgeTime),1)]}),_:1})]),_:1})]),_:1})]),_:1}),(Y=T.value)!=null&&Y.compileMessage?(L(),M(D,{key:0,class:"compile-message"},{default:a(()=>{var H;return[x(E((H=T.value)==null?void 0:H.compileMessage),1)]}),_:1})):le("",!0),(me=T.value)!=null&&me.task&&((Q=T.value)==null?void 0:Q.task.length)>0?(L(),M(ae,{key:1,class:"task-panel"},{default:a(()=>{var H;return[(L(!0),te(de,null,Ie((H=T.value)==null?void 0:H.task,(N,se)=>(L(),M(ne,{key:N.taskId,header:()=>y(N)},{default:a(()=>[x(E(N.content)+" "+E(N.waHint),1)]),_:2},1032,["header"]))),128))]}),_:1})):le("",!0),c.value?(L(),te("div",Us,[t(Z,{onClick:r,loading:g.value},{default:a(()=>V[0]||(V[0]=[x("重新评测")])),_:1},8,["loading"])])):le("",!0)],64)}}}),ra=ie($s,[["__scopeId","data-v-3eb6e961"]]),zs={style:{margin:"10px"}},As=ue({__name:"ContestList",setup(e){const l=Ce(),n=Ye(),{globalProperties:u}=pe();let o=null;const b=m([{title:"ID",colKey:"id",cell:(g,C)=>t(G,{variant:"text",onClick:()=>k(C.row.id)},{default:()=>[C.row.id]})},{title:"标题",colKey:"title",cell:(g,C)=>t(G,{variant:"text",onClick:()=>k(C.row.id)},{default:()=>[C.row.title]})},{title:"负责人",colKey:"ownerNickname",cell:(g,C)=>t(G,{variant:"text",onClick:()=>Ht(n,C.row.ownerUsername)},{default:()=>[C.row.ownerNickname]})},{title:"权限",colKey:"private",cell:(g,C)=>C.row.private?"私有":"公开"},{title:"开始时间",colKey:"startTime"},{title:"结束时间",colKey:"endTime"}]),f=m(!1);let S=1,d=50;const s=m({current:S,pageSize:d,defaultCurrent:S,defaultPageSize:d,total:0,pageSizeOptions:[50,100]}),T=m(),v=m({title:"",username:""}),k=g=>{g&&n.push({path:"/contest/"+g})},h=async()=>{await n.push({query:{...l.query,title:v.value.title,username:v.value.username,page:1,page_size:s.value.defaultPageSize}})},_=async(g,C)=>{var c;f.value=!0;try{const{current:r,pageSize:A}=g,I=await vo(r,A);if(T.value=[],I.code===0){const y=I.data.list;for(let j=0;j<y.length;j++){const w=y[j],V=Ot(w);(c=T.value)==null||c.push(V)}s.value={...s.value,total:I.data.total_count}}else C&&F(u,I.code)}catch(r){console.error(r),F(u,Ke())}finally{f.value=!1}},i=async g=>{await n.push({query:{...l.query,page:g.current,page_size:g.pageSize}})},p=()=>{n.push({name:"contest-create"})};return ce(async()=>{o=Le(()=>l.query,g=>{v.value.title=g.title||"",v.value.username=g.username||"";const C=parseInt(g.page)||s.value.defaultCurrent,c=parseInt(g.page_size)||s.value.defaultPageSize;S=C,d=c,s.value={...s.value,current:S,pageSize:d},_({current:S,pageSize:d},!0)},{immediate:!0})}),Te(()=>{o&&o()}),(g,C)=>{const c=Re,r=be,A=xe,I=$e,y=Ue,j=G,w=je,V=we,$=Pe;return L(),M($,null,{default:a(()=>[t(A,{span:9},{default:a(()=>[t(r,{style:{margin:"10px"}},{default:a(()=>[t(c,{data:T.value,columns:b.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:s.value,loading:f.value,"table-layout":"auto",onPageChange:i,style:{"white-space":"nowrap"}},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(A,{span:3},{default:a(()=>[z("div",zs,[t(r,{class:"sh-card"},{default:a(()=>[t(w,{model:v.value},{default:a(()=>[t(y,{label:"标题"},{default:a(()=>[t(I,{modelValue:v.value.title,"onUpdate:modelValue":C[0]||(C[0]=U=>v.value.title=U),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(y,{label:"负责人"},{default:a(()=>[t(I,{modelValue:v.value.username,"onUpdate:modelValue":C[1]||(C[1]=U=>v.value.username=U),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(y,null,{default:a(()=>[t(j,{theme:"primary",onClick:h},{default:a(()=>C[2]||(C[2]=[x("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(r,{class:"sh-card"},{default:a(()=>[t(V,null,{default:a(()=>[t(j,{onClick:p},{default:a(()=>C[3]||(C[3]=[x("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),ua=ie(As,[["__scopeId","data-v-ce6320bd"]]),Rs={style:{margin:"20px"}},Ms={style:{margin:"10px"}},Es={style:{"text-align":"center","align-content":"center",padding:"20px",height:"500px"}},qs={style:{"text-align":"center",width:"100%"}},Ks={class:"dida-operation-container"},Fs={style:{margin:"12px"}},Gs=ue({__name:"ContestDetail",setup(e){let l=Ce();const{globalProperties:n}=pe(),u=Je(),o=qe(),b=m(!1);let f=0;const S=m(!1),d=m(null),s=m(!1),T=m(!1),v=m(""),k=Oe(()=>o.hasAuth(ze.ManageContest)||d.value&&o.getUserId==d.value.ownerId),h=I=>{if(!I||!p)return"default";const y=p[I];if(!y)return"default";switch(y){case Ne.Accept:return"success";case Ne.Attempt:return"warning";default:return"default"}},_=m([{title:"问题ID",colKey:"index",cell:(I,y)=>{const j=h(y.row.index);return t(G,{variant:"dashed",theme:j,onClick:async()=>await Mt(f,y.row.index)},{default:()=>[y.row.id]})}},{title:"标题",colKey:"title",cell:(I,y)=>t(G,{variant:"text",onClick:async()=>await Mt(f,y.row.index)},{default:()=>[y.row.title]})},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),i=m([]);let p={},g=m(!1);const C=()=>{X.push({name:"contest-edit",params:{contestId:f}})},c=async()=>{b.value=!0;try{const I=await yo(f);if(I.code!==0){F(n,I.code);return}const y=I.data;ke(n,"查重报告已生成，请前往查看"),window.open(y,"_blank")}finally{b.value=!1}},r=async I=>{if(!o.isLogin()){await X.push({name:"login"});return}if(!v.value){ve(n,"请输入密码");return}g.value=!0;try{const y=await ho(f,v.value);if(y.code!==0){F(n,y.code);return}ke(n,"申请访问成功"),await A()}catch(y){console.error("Error submitting contest password:",y),F(n,"提交密码失败，请稍后再试")}finally{g.value=!1}},A=async()=>{S.value=!0;const I=await io(f);if(I.code!==0){S.value=!1,F(n,I.code),await X.push({name:"contest"});return}s.value=I.data.has_auth,T.value=I.data.need_password,d.value=Ot(I.data.contest),i.value=d.value.problems,p=I.data.attempt_status||{},u.setTitle(d.value.title+" - "+u.getTitle),S.value=!1};return ce(async()=>{if(Array.isArray(l.params.contestId)?f=Number(l.params.contestId[0]):f=Number(l.params.contestId),!f){await X.push({name:"contest"});return}await A()}),(I,y)=>{const j=St,w=Re,V=be,$=$e,U=Ue,D=G,P=je,q=xe,R=we,W=Be,ee=He,ne=Ae("md-preview"),ae=Pe,Z=Ve;return L(),M(Z,{loading:S.value},{default:a(()=>[t(ae,{class:"dida-main-content"},{default:a(()=>[t(q,{span:6},{default:a(()=>{var Y,me,Q;return[z("div",Rs,[z("h1",null,E((Y=d.value)==null?void 0:Y.title),1),(me=d.value)!=null&&me.notification?(L(),M(j,{key:0,theme:"info",message:(Q=d.value)==null?void 0:Q.notification},null,8,["message"])):le("",!0)]),z("div",Ms,[s.value?(L(),M(V,{key:0},{default:a(()=>[t(w,{data:i.value,columns:_.value,"row-key":"id","table-layout":"auto","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1})):(L(),M(V,{key:1},{default:a(()=>[z("div",Es,[t(j,{theme:"warning",message:"您没有查看本比赛的权限"}),T.value?(L(),M(P,{key:0,style:{margin:"20px auto 0",width:"200px"},onSubmit:r,"label-width":"0"},{default:a(()=>[t(U,null,{default:a(()=>[t($,{placeholder:"请输入密码",value:v.value,"onUpdate:value":y[0]||(y[0]=H=>v.value=H),style:{width:"300px"},type:"password",autocomplete:"new-password"},null,8,["value"])]),_:1}),t(U,null,{default:a(()=>[z("div",qs,[t(D,{theme:"primary",type:"submit",loading:fe(g)},{default:a(()=>y[1]||(y[1]=[x("提交")])),_:1},8,["loading"])])]),_:1})]),_:1})):le("",!0)])]),_:1}))])]}),_:1}),t(q,{span:6},{default:a(()=>{var Y;return[z("div",Ks,[t(R,null,{default:a(()=>[k.value?(L(),M(D,{key:0,onClick:c,loading:b.value},{default:a(()=>y[2]||(y[2]=[x("查重")])),_:1},8,["loading"])):le("",!0),k.value?(L(),M(D,{key:1,onClick:C},{default:a(()=>y[3]||(y[3]=[x("编辑")])),_:1})):le("",!0)]),_:1})]),z("div",Fs,[t(ee,{layout:"vertical",bordered:!0},{default:a(()=>[t(W,{label:"创建时间"},{default:a(()=>{var me;return[x(E((me=d.value)==null?void 0:me.createTime),1)]}),_:1})]),_:1}),t(ee,{layout:"vertical",bordered:!0},{default:a(()=>[t(W,{label:"更新时间"},{default:a(()=>{var me;return[x(E((me=d.value)==null?void 0:me.updateTime),1)]}),_:1})]),_:1}),t(ee,{layout:"vertical",bordered:!0},{default:a(()=>[t(W,{label:"开始时间"},{default:a(()=>{var me;return[x(E((me=d.value)==null?void 0:me.startTime),1)]}),_:1})]),_:1}),t(ee,{layout:"vertical",bordered:!0},{default:a(()=>[t(W,{label:"结束时间"},{default:a(()=>{var me;return[x(E((me=d.value)==null?void 0:me.endTime),1)]}),_:1})]),_:1})]),(Y=d.value)!=null&&Y.description?(L(),M(V,{key:0,style:{margin:"12px"}},{default:a(()=>{var me;return[t(ne,{"model-value":(me=d.value)==null?void 0:me.description,class:"dida-content-description"},null,8,["model-value"])]}),_:1})):le("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),Ns=ie(Gs,[["__scopeId","data-v-af022b1b"]]);function Ra(e){return e?Math.floor(e/1e9):0}function rt(e){if(e<=0)return"0秒";let l="";const n=Math.floor(e/3600);n>0&&(l+=`${n}小时`);const u=Math.floor(e%3600/60);return(u>0||n>0)&&(n>0&&u<10&&(l+="0"),l+=`${u}分钟`),e=e%60,(e>0||u>0||n>0)&&((n>0||u>0)&&e<10&&(l+="0"),l+=`${e.toFixed(0)}秒`),l}const Os=mt("contest",{state:()=>({starMembers:{}}),actions:{clear(){this.$patch({starMembers:{}})},addStarMember(e,l){this.starMembers[e]||(this.starMembers[e]={}),this.starMembers[e][l]=!0},removeStarMember(e,l){this.starMembers[e]&&(delete this.starMembers[e][l],Object.keys(this.starMembers[e]).length===0&&delete this.starMembers[e])},isStarMember(e,l){var n;return!!((n=this.starMembers[e])!=null&&n[l])}},persist:!0}),Hs={style:{margin:"10px 10px 40px"}},Bs={style:{"text-align":"right","margin-bottom":"10px"}},Ws={class:"table-scroll-wrapper"};function ia(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const Ys=ue({__name:"ContestRank",setup(e){const l=Ce(),n=Ye(),u=Os(),{globalProperties:o}=pe();let b=!1,f=null,S=0,d=null,s=null,T=0;const v=m(0),k=m(0),h=m(!1),_=m(!0),i=m(!0);let p=null,g=null,C=1,c=50;const r=m({current:C,pageSize:c,defaultCurrent:1,defaultPageSize:50,total:0,pageSizeOptions:[50,100,1e3]}),A=H=>u&&u.isStarMember(S,H),I=async H=>{r.value={...r.value,current:H.current,pageSize:H.pageSize},await n.push({query:{...l.query,page:H.current,page_size:H.pageSize}})},y=H=>{if(H==null)return"-";const N=Math.floor(H/3600).toString().padStart(2,"0"),se=Math.floor(H%3600/60).toString().padStart(2,"0"),K=(H%60).toFixed(0).toString().padStart(2,"0");return`${N}:${se}:${K}`},j=m({}),w=[{title:"Rank",colKey:"rank",align:"center",fixed:"left"},{title:"昵称",colKey:"nickname",fixed:"left",attrs:H=>{let N={};return A(H.row.userId)&&(N={backgroundColor:"rgba(255,165,30,0.5)"}),{style:N}},cell:(H,N)=>{const se=Ml(N.row.nickname,18);let K=null;return A(N.row.userId)?K=t(G,{shape:"circle",variant:"text",class:"rank-unstar-button",onClick:()=>{u.removeStarMember(S,N.row.userId),Y()}},{default:()=>[t(el,{slot:"icon"},null)]}):K=t(G,{shape:"circle",variant:"text",class:"rank-star-button",onClick:()=>{u.addStarMember(S,N.row.userId),Y()}},{default:()=>[t(tl,{slot:"icon"},null)]}),t("div",{class:"rank-nickname-cell"},[t(we,null,{default:()=>[t(Il,{content:N.row.nickname},{default:()=>[t(G,{variant:"text",onClick:()=>n.push({name:"user",params:{username:N.row.username}})},ia(se)?se:{default:()=>[se]})]}),K]})])}},{title:"Solved",colKey:"solved",align:"center",fixed:"left",cell:(H,N)=>t(G,{variant:"text",onClick:()=>n.push({name:"contest-judge",params:{contestId:S},query:{username:N.row.username,status:Fe.Accept}})},{default:()=>[N.row.solved]})},{title:"Penalty",colKey:"penalty",align:"center",fixed:"left",cell:(H,N)=>y(N.row.penalty)}],V=m([]),$=m(!1);let U=[],D=[];const P=m([]);let q=[];const R=({col:H,rowIndex:N})=>{if(H.colKey==="rank"){let se=r.value.current;r.value.current>Math.ceil(P.value.length/r.value.pageSize)&&(se=Math.ceil(P.value.length/r.value.pageSize));let K=r.value.pageSize*(se-1),O=1;for(let re=N+1;K+re<P.value.length&&P.value[K+re].rank===P.value[K+N].rank;re++)O++;return{rowspan:O}}},W=(H,{value:N})=>rt(N),ee=()=>{p&&clearInterval(p),p=setInterval(()=>{b&&Q(!1)},3e4),g&&clearInterval(g),g=setInterval(()=>{if(!b)return;v.value=(new Date().getTime()-d.getTime())/1e3;const H=Math.min(v.value,k.value);v.value=Math.min(v.value,H),Y()},1e3)},ne=()=>{p&&(clearInterval(p),p=null),g&&(clearInterval(g),g=null)},ae=async H=>{i.value=H,H?(await Q(!1),ee()):ne()},Z=()=>{Y(),r.value={...r.value,current:1}},Y=()=>{P.value=[];let H=[];for(let J=0;J<U.length;J++){const he=U[J];let Se={userId:he.author_id,username:he.author_username,nickname:he.author_nickname},ye=0,De=0;he.problems.forEach(We=>{let Xe=-1,et=We.lock||0;if(We.ac){if(Xe=(new Date(We.ac).getTime()-(d==null?void 0:d.getTime()))/1e3,Xe>v.value)return;ye++,De+=Xe,De+=We.attempt*20*60}if(et>0&&T>0){const Tt=k.value-T;v.value<Tt&&(et=0)}const ot=We.index;Se[`problem_${ot}`]={acDuration:Xe,attempt:We.attempt||0,lock:et}}),Se.solved=ye,Se.penalty=De,H.push(Se)}H.sort((J,he)=>J.solved!==he.solved?he.solved-J.solved:J.penalty!==he.penalty?J.penalty-he.penalty:J.userId-he.userId);const N=D;let se=0,K=0,O=-1,re=-1;for(let J=0;J<H.length;J++)N&&N.includes(H[J].userId)?H[J].rank="*":(K++,(H[J].solved!==O||H[J].penalty!==re)&&(se=K,O=H[J].solved,re=H[J].penalty),H[J].rank=String(se));h.value&&(H=H.filter(J=>A(J.userId)));const _e=document.querySelectorAll("tbody tr"),ge={};q.forEach((J,he)=>{const Se=_e[he];Se&&(ge[J.userId]=Se.getBoundingClientRect())}),r.value={...r.value,total:H.length},P.value=H;for(let J=0;J<P.value.length;J++)P.value[J].index=J+1;if(q=[...P.value],_.value){const J={},he=document.querySelectorAll("table tbody tr");P.value.forEach((Se,ye)=>{const De=he[ye];De&&(J[Se.userId]=De.getBoundingClientRect())}),requestAnimationFrame(()=>{const Se=document.querySelectorAll("table tbody tr");P.value.forEach((ye,De)=>{const We=Se[De],Xe=ge[ye.userId],et=J[ye.userId];if(Xe&&et){const ot=Xe.top-et.top;ot!==0&&(We.style.transition="none",We.style.transform=`translateY(${ot}px)`)}}),requestAnimationFrame(()=>{document.querySelectorAll("table tbody tr").forEach(De=>{De.style.transition="transform 300ms ease",De.style.transform=""})})})}},me=H=>{ae(!1),v.value=H;const N=Math.min(k.value,(new Date().getTime()-(d==null?void 0:d.getTime()))/1e3);v.value=Math.min(v.value,N),Y()},Q=async H=>{H&&($.value=!0);try{const N=await _o(S);if(V.value=[...w],U=[],D=[],P.value=[],r.value={...r.value,total:0},N.code===0){if(!N.data.has_auth){ke(o,"您目前没有权限查看比赛排名"),await n.push({name:"contest-detail",params:{contestId:S}});return}N.data.problems.sort((O,re)=>O-re),N.data.problems.forEach((O,re)=>{V.value.push({colKey:`problem_${O}`,align:"center",title:()=>{let _e;return t(G,{variant:"text",onClick:()=>n.push({name:"contest-problem-detail",params:{contestId:S,problemIndex:O}})},ia(_e=at(O))?_e:{default:()=>[_e]})},cell:(_e,ge)=>{const J=ge.row[`problem_${O}`];if(!J)return"";let he="";return J.acDuration>=0&&(he=y(J.acDuration)),J.attempt>0&&(he&&(he+=" "),he+=`(-${J.attempt})`),J.lock>0&&(he&&(he+=" "),he+=`(+${J.lock})`),t("span",null,[he])},attrs:_e=>{const ge=_e.row[`problem_${O}`];return ge?ge.acDuration>=0?{style:{backgroundColor:"rgba(130,255,30,0.5)"}}:ge.lock>0?{style:{backgroundColor:"rgb(255,180,50,0.5)"}}:ge.attempt>0?{style:{backgroundColor:"rgba(255,120,120,0.5)"}}:{}:{}}})});const se=N.data.contest;if(d=new Date(se.start_time),s=new Date(se.end_time),U=N.data.ranks,D=N.data.v_members||[],k.value=Math.floor((s.getTime()-d.getTime())/1e3),j.value={0:"0",[Math.floor(k.value/2)]:rt(Math.floor(k.value/2)),[k.value]:rt(k.value)},T=Ra(se.lock_rank_duration||0),N.data.is_locked&&T>0){const O=Math.max(0,k.value-T);j.value[O]=t("span",{style:"color: #0052d9"},[x("锁榜("),rt(O),x(")")])}v.value=Math.floor((new Date().getTime()-d.getTime())/1e3);const K=Math.min(v.value,k.value);v.value=Math.min(v.value,K),i.value=!0,ee(),Y()}else H&&F(o,N.code)}catch(N){console.error(N),H&&F(o,Ke())}finally{H&&($.value=!1)}};return ce(async()=>{b=!0,f=Le(()=>l.query,async H=>{if(Array.isArray(l.params.contestId)?S=Number(l.params.contestId[0]):S=Number(l.params.contestId),!S){await n.push({name:"contest"});return}const N=parseInt(H.page)||r.value.defaultCurrent,se=parseInt(H.page_size)||r.value.defaultPageSize;C=N,c=se,r.value={...r.value,current:C,pageSize:c},await Q(!0)},{immediate:!0})}),Te(()=>{b=!1,f&&f(),ne()}),(H,N)=>{const se=ft,K=we,O=Sl,re=Re,_e=be,ge=Pe;return L(),M(ge,null,{default:a(()=>[t(_e,{style:{margin:"10px",width:"100%"}},{default:a(()=>[z("div",Hs,[z("div",Bs,[t(K,null,{default:a(()=>[t(se,{size:"large",modelValue:h.value,"onUpdate:modelValue":N[0]||(N[0]=J=>h.value=J),onChange:Z},{label:a(J=>[x(E(J.value?"仅展示收藏":"未过滤收藏"),1)]),_:1},8,["modelValue"]),t(se,{size:"large",modelValue:_.value,"onUpdate:modelValue":N[1]||(N[1]=J=>_.value=J)},{label:a(J=>[x(E(J.value?"开启动画":"关闭动画"),1)]),_:1},8,["modelValue"]),t(se,{size:"large",modelValue:i.value,"onUpdate:modelValue":N[2]||(N[2]=J=>i.value=J),onChange:ae},{label:a(J=>[x(E(J.value?"自动刷新":"关闭刷新"),1)]),_:1},8,["modelValue"])]),_:1})]),t(O,{modelValue:v.value,"onUpdate:modelValue":N[3]||(N[3]=J=>v.value=J),marks:j.value,max:k.value,label:W,"tooltip-props":{placement:"top"},"input-number-props":{theme:"column",autoWidth:!0,format:fe(rt),onChange:me},onChangeEnd:me},null,8,["modelValue","marks","max","input-number-props"])]),z("div",Ws,[t(re,{data:P.value,columns:V.value,"row-key":"index","vertical-align":"middle",bordered:!0,hover:!0,"table-layout":"auto","rowspan-and-colspan":R,loading:$.value,class:"dida-contest-rank-table",pagination:r.value,onPageChange:I},null,8,["data","columns","loading","pagination"])])]),_:1})]),_:1})}}}),Js=ie(Ys,[["__scopeId","data-v-838e6c28"]]),Xs={style:{margin:"10px"}},Zs={style:{margin:"12px"}},Qs={class:"dida-edit-container"},er={class:"dida-description-editor"},tr=ue({__name:"ContestEdit",setup(e){let l=Ce();const{globalProperties:n}=pe(),u=Je(),o=m(0),b=m(!1),f=m(!1),S=m(!1),d=m(null),s=m({title:"",openTime:[],private:!0,password:"",problems:[],members:[],description:"",notification:"",lockRankDuration:0,alwaysLock:!0,submitAnytime:!1}),T=m(""),v=m(""),k=m(!1),h=async()=>{k.value=!0,S.value=!1,k.value=!1},_=async(c,r)=>{f.value=!0,await vt(c,r,n,()=>po(o.value)),f.value=!1},i=async()=>{f.value=!0;try{const c={title:s.value.title,description:s.value.description,notification:s.value.notification,lock_rank_duration:s.value.lockRankDuration,always_lock:s.value.alwaysLock,problems:s.value.problems,members:s.value.members,private:s.value.private,password:s.value.password,submit_anytime:s.value.submitAnytime};s.value.openTime[0]&&(c.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(c.end_time=new Date(s.value.openTime[1]));const r=await go(c);if(f.value=!0,r.code!==0){F(n,r.code);return}r.data!=null&&await X.push({name:"contest-detail",params:{contestId:r.data}}),Ge(n,"创建成功")}finally{f.value=!1}},p=async()=>{f.value=!0;try{const c={id:Number(o.value),title:s.value.title,notification:s.value.notification,lock_rank_duration:s.value.lockRankDuration,always_lock:s.value.alwaysLock,problems:s.value.problems,members:s.value.members,private:s.value.private,password:s.value.password,submit_anytime:s.value.submitAnytime,description:s.value.description};s.value.openTime[0]&&(c.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(c.end_time=new Date(s.value.openTime[1]));const r=await bo(c);if(f.value=!0,r.code!==0){F(n,r.code);return}d.value&&(r.data.description!=null&&(s.value.description=r.data.description),r.data.update_time!=null&&(d.value.updateTime=new Date(r.data.update_time).toLocaleString())),Ge(n,"保存成功")}finally{f.value=!1}},g=c=>{s.value.description=c,b.value=!1},C=async()=>{const c=await co(o.value);if(c.code!==0){F(n,c.code),console.error("contest get failed",c.code),await X.push({name:"contest-list"});return}const r=c.data.contest;d.value=Ot(r),s.value.title=r.title,s.value.openTime=[],r.start_time?s.value.openTime.push(new Date(r.start_time)):s.value.openTime.push(""),r.end_time?s.value.openTime.push(new Date(r.end_time)):s.value.openTime.push(""),s.value.private=r.private,s.value.password=r.password||"",s.value.description=r.description||"",s.value.notification=r.notification||"",s.value.problems=c.data.problems,s.value.members=c.data.members,r.lock_rank_duration?s.value.lockRankDuration=Ra(r.lock_rank_duration):s.value.lockRankDuration=0,s.value.alwaysLock=r.always_lock,s.value.submitAnytime=r.submit_anytime,u.setTitle(r.title+" - "+u.getTitle);let A="";r.description&&(A=r.description),g(A)};return ce(async()=>{Array.isArray(l.params.contestId)?o.value=Number(l.params.contestId[0]):o.value=Number(l.params.contestId),o.value?(b.value=!0,await C()):g("")}),(c,r)=>{const A=$e,I=Ue,y=Kt,j=ft,w=ba,V=je,$=be,U=xe,D=G,P=we,q=Be,R=He,W=Pe,ee=Ae("md-editor-v3"),ne=Ve,ae=It,Z=nt;return L(),te(de,null,[t(ne,{loading:b.value},{default:a(()=>[t(W,null,{default:a(()=>[t(U,{span:8},{default:a(()=>[z("div",Xs,[t($,{class:"sh-card"},{default:a(()=>[t(V,{model:s.value,"label-width":"150px"},{default:a(()=>[t(I,{label:"标题"},{default:a(()=>[t(A,{modelValue:s.value.title,"onUpdate:modelValue":r[0]||(r[0]=Y=>s.value.title=Y),placeholder:"比赛标题"},null,8,["modelValue"])]),_:1}),t(I,{label:"通知"},{default:a(()=>[t(A,{modelValue:s.value.notification,"onUpdate:modelValue":r[1]||(r[1]=Y=>s.value.notification=Y),placeholder:"会更为醒目地提醒"},null,8,["modelValue"])]),_:1}),t(I,{label:"开启时间"},{default:a(()=>[t(y,{modelValue:s.value.openTime,"onUpdate:modelValue":r[2]||(r[2]=Y=>s.value.openTime=Y),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(I,{label:"提交限制"},{default:a(()=>[t(j,{modelValue:s.value.submitAnytime,"onUpdate:modelValue":r[3]||(r[3]=Y=>s.value.submitAnytime=Y)},{label:a(Y=>[x(E(Y.value?"结束仍能提交":"仅比赛期间提交"),1)]),_:1},8,["modelValue"])]),_:1}),t(I,{label:"锁榜时长"},{default:a(()=>[t(w,{modelValue:s.value.lockRankDuration,"onUpdate:modelValue":r[4]||(r[4]=Y=>s.value.lockRankDuration=Y),min:0,format:fe(rt),"auto-width":""},null,8,["modelValue","format"])]),_:1}),t(I,{label:"自动解锁"},{default:a(()=>[t(j,{modelValue:s.value.alwaysLock,"onUpdate:modelValue":r[5]||(r[5]=Y=>s.value.alwaysLock=Y)},{label:a(Y=>[x(E(Y.value?"结束后仍锁榜":"结束后解锁"),1)]),_:1},8,["modelValue"])]),_:1}),t(I,{label:"私有"},{default:a(()=>[t(j,{modelValue:s.value.private,"onUpdate:modelValue":r[6]||(r[6]=Y=>s.value.private=Y)},null,8,["modelValue"])]),_:1}),s.value.private?(L(),M(I,{key:0,label:"密码"},{default:a(()=>[t(A,{modelValue:s.value.password,"onUpdate:modelValue":r[7]||(r[7]=Y=>s.value.password=Y),type:"password",placeholder:"请输入访问密码，留空代表关闭密码访问"},null,8,["modelValue"])]),_:1})):le("",!0),s.value.private?(L(),M(I,{key:1,label:"成员"},{default:a(()=>[t(Aa,{modelValue:s.value.members,"onUpdate:modelValue":r[8]||(r[8]=Y=>s.value.members=Y)},null,8,["modelValue"])]),_:1})):le("",!0),t(I,{label:"问题"},{default:a(()=>[t(za,{modelValue:s.value.problems,"onUpdate:modelValue":r[9]||(r[9]=Y=>s.value.problems=Y)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(U,{span:4},{default:a(()=>[z("div",Zs,[z("div",Qs,[o.value?(L(),M(P,{key:0},{default:a(()=>[t(D,{onClick:p,theme:"danger",loading:f.value},{default:a(()=>r[13]||(r[13]=[x("保存")])),_:1},8,["loading"])]),_:1})):(L(),M(P,{key:1},{default:a(()=>[t(D,{onClick:i,theme:"danger",loading:f.value},{default:a(()=>r[14]||(r[14]=[x("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(L(),M(R,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(q,{label:"创建时间"},{default:a(()=>{var Y;return[x(E((Y=d.value)==null?void 0:Y.createTime),1)]}),_:1}),t(q,{label:"更新时间"},{default:a(()=>{var Y;return[x(E((Y=d.value)==null?void 0:Y.updateTime),1)]}),_:1}),t(q,{label:"创建用户"},{default:a(()=>{var Y;return[x(E((Y=d.value)==null?void 0:Y.ownerNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),z("div",er,[r[15]||(r[15]=z("p",null,"公告",-1)),t(ee,{id:"contest-description-editor",modelValue:s.value.description,"onUpdate:modelValue":r[10]||(r[10]=Y=>s.value.description=Y),onSave:p,onOnUploadImg:_,previewTheme:"cyanosis"},null,8,["modelValue"]),t(ne,{loading:f.value,attach:"#contest-description-editor","z-index":1e5},null,8,["loading"])])]),_:1},8,["loading"]),t(Z,{visible:S.value,"onUpdate:visible":r[12]||(r[12]=Y=>S.value=Y),onConfirm:h,header:T.value,"confirm-loading":k.value},{default:a(()=>[r[16]||(r[16]=z("div",{style:{"margin-bottom":"10px"}},[z("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(ae,{modelValue:v.value,"onUpdate:modelValue":r[11]||(r[11]=Y=>v.value=Y),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),da=ie(tr,[["__scopeId","data-v-e76af3ed"]]);function Wt(e){const l={};return l.id=e.id,l.authorId=e.author_id,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.title=e.title,l.content=e.content,e.insert_time&&(l.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(l.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(l.updateTime=new Date(e.update_time).toLocaleString()),l.problemId=e.problem_id,l.problemTitle=e.problem_title,l.contestId=e.contest_id,l.contestTitle=e.contest_title,l.contestProblemIndex=e.contest_problem_index,l}function ar(e){const l={};return l.id=e.id,l.authorId=e.author_id,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.content="",e.content&&(l.content=e.content),e.insert_time&&(l.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(l.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(l.updateTime=new Date(e.update_time).toLocaleString()),l}function lr(e){return B({url:"/discuss?id="+e,method:"get"})}function nr(e){return B({url:"/discuss/edit?id="+e,method:"get"})}function or(e,l,n,u,o,b,f){const S={};return e?S.only_problem="1":S.only_problem="0",l&&(S.contest_id=l),n&&(S.problem_id=n),u&&(S.title=u),o&&(S.username=o),b&&(S.page=b),f&&(S.page_size=f),B({url:`/discuss/list?${new URLSearchParams(S).toString()}`,method:"get"})}function sr(e){return e||(e=0),B({url:"/discuss/image/token?id="+e,method:"get"})}function rr(e,l,n){return B({url:"/discuss/comment/list?id="+e+"&page="+l+"&page_size="+n,method:"get"})}function ur(e){return B({url:"/discuss/create",method:"post",data:e})}function ir(e){return B({url:"/discuss/edit",method:"post",data:e})}const dr={style:{margin:"10px"}};function cr(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const mr=ue({__name:"DiscussList",setup(e){const l=Ce(),n=Ye(),{globalProperties:u}=pe();let o=!1,b=null,f=-1,S=m(!1);const d=m([]),s=[],T=[{title:"标题",colKey:"title",cell:(j,w)=>t(G,{variant:"text",onClick:()=>c(w.row.id)},{default:()=>[w.row.title]})},{title:"创建人",colKey:"authorNickname",width:"200",cell:(j,w)=>t(G,{variant:"text",onClick:async()=>await Ht(n,w.row.authorUsername)},{default:()=>[w.row.authorNickname]})},{title:"创建时间",colKey:"insertTime",width:"180"},{title:"更新时间",colKey:"updateTime",width:"180"}],v=m(!1);let k=1,h=50;const _=m({current:k,pageSize:h,defaultCurrent:k,defaultPageSize:h,total:0,pageSizeOptions:[50,100]}),i=m(),p=m({problemId:"",title:"",username:""}),g=j=>{j&&n.push({name:"problem-detail",params:{problemId:j}})},C=(j,w)=>{n.push({name:"contest-problem-detail",params:{contestId:j,problemIndex:w}})},c=j=>{if(j){if(f){n.push({name:"contest-discuss-detail",params:{contestId:f,discussId:j}});return}n.push({name:"discuss-detail",params:{discussId:j}})}},r=async()=>{await n.push({query:{...l.query,problem_id:p.value.problemId,title:p.value.title,username:p.value.username,page:1,page_size:_.value.defaultPageSize}})},A=async(j,w)=>{var V;v.value=!0;try{const{current:$,pageSize:U}=j,D=await or(S.value,f,p.value.problemId,p.value.title,p.value.username,$,U);if(i.value=[],D.code===0){if(!D.data.has_auth){ke(u,"您目前没有权限查看讨论列表"),f?await n.push({name:"contest-detail",params:{contestId:f}}):await n.push({name:"discuss-list"});return}if(D.data.list){const P=D.data.list;for(let q=0;q<P.length;q++){const R=P[q],W=await Wt(R);(V=i.value)==null||V.push(W)}}_.value={..._.value,total:D.data.total_count}}else w&&F(u,D.code)}catch($){console.error($),F(u,Ke())}finally{v.value=!1}},I=async j=>{await n.push({query:{...l.query,page:j.current,page_size:j.pageSize}})},y=async()=>{await n.push({name:"discuss-create"})};return ce(async()=>{o=!0,b=Le(()=>l.query,j=>{if(!o)return;S.value=l.name==="discuss-list-problem",Array.isArray(l.params.contestId)?f=Number(l.params.contestId[0]):f=Number(l.params.contestId),d.value=s,f?d.value=d.value.concat([{title:"问题ID",colKey:"contestProblemIndex",width:"100",cell:($,U)=>{let D;return U.row.contestProblemIndex?t(G,{variant:"text",onClick:()=>C(f,U.row.contestProblemIndex)},cr(D=at(U.row.contestProblemIndex))?D:{default:()=>[D]}):""}}]):d.value=d.value.concat([{title:"问题ID",colKey:"problemId",width:"100",cell:($,U)=>U.row.problemId?t(G,{variant:"text",onClick:()=>g(U.row.problemId)},{default:()=>[U.row.problemId]}):""}]),d.value=d.value.concat(T),p.value.problemId=j.problem_id||"",p.value.title=j.title||"",p.value.username=j.username||"";const w=parseInt(j.page)||_.value.defaultCurrent,V=parseInt(j.page_size)||_.value.defaultPageSize;k=w,h=V,_.value={..._.value,current:k,pageSize:h},A({current:k,pageSize:h},!0)},{immediate:!0})}),Te(()=>{o=!1,b&&b()}),(j,w)=>{const V=Re,$=be,U=xe,D=$e,P=Ue,q=G,R=je,W=we,ee=Pe;return L(),M(ee,null,{default:a(()=>[t(U,{span:9},{default:a(()=>[t($,{style:{margin:"10px"}},{default:a(()=>[t(V,{data:i.value,columns:d.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:_.value,loading:v.value,"table-layout":"auto",onPageChange:I},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(U,{span:3},{default:a(()=>[z("div",dr,[t($,{class:"sh-card"},{default:a(()=>[t(R,{model:p.value},{default:a(()=>[t(P,{label:"问题ID"},{default:a(()=>[t(D,{modelValue:p.value.problemId,"onUpdate:modelValue":w[0]||(w[0]=ne=>p.value.problemId=ne),placeholder:"请输入完整问题ID"},null,8,["modelValue"])]),_:1}),t(P,{label:"标题"},{default:a(()=>[t(D,{modelValue:p.value.title,"onUpdate:modelValue":w[1]||(w[1]=ne=>p.value.title=ne),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(P,{label:"创建人"},{default:a(()=>[t(D,{modelValue:p.value.username,"onUpdate:modelValue":w[2]||(w[2]=ne=>p.value.username=ne),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(P,null,{default:a(()=>[t(q,{theme:"primary",onClick:r},{default:a(()=>w[3]||(w[3]=[x("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t($,{class:"sh-card"},{default:a(()=>[t(W,null,{default:a(()=>[t(q,{onClick:y},{default:a(()=>w[4]||(w[4]=[x("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),jt=ie(mr,[["__scopeId","data-v-52d475b4"]]),pr={key:0,style:{margin:"20px"}},fr={style:{margin:"10px"}},vr={style:{margin:"10px"}},_r={style:{margin:"10px","text-align":"right"}},gr={style:{margin:"12px"}},br={key:0,class:"dida-edit-container"},hr=ue({__name:"DiscussDetail",props:{discussId:{}},setup(e){const l=e;let n=Ce();const{globalProperties:u}=pe();let o=null;const b=Je(),f=qe();let S=m("");const d=m(""),s=m(!1),T=m(null);let v=m("");const k=m(!1);let h=1,_=20;const i=m({current:1,pageSize:20,total:0,defaultPageSize:_,defaultCurrent:h,pageSizeOptions:[20,50]}),p=m([]),g={},C=Oe(()=>f.hasAuth(ze.ManageDiscuss)||T.value&&f.getUserId==T.value.authorId),c=w=>{w&&X.push({name:"discuss-list",query:{...n.query,title:"",tag:w.name}})},r=()=>{X.push({name:"discuss-edit",params:{discussId:d.value}})},A=()=>t("div",{class:"t-pagination__total"},[`共 ${i.value.total} 条回复`]),I=()=>{},y=async(w,V)=>{var $;k.value=!0;try{const{current:U,pageSize:D}=w,P=await rr(d.value,U,D);if(p.value=[],P.code===0){const q=P.data.list;if(q)for(let R=0;R<q.length;R++){const W=q[R],ee=ar(W);($=p.value)==null||$.push(ee)}i.value={...i.value,total:P.data.total_count}}else V&&F(u,P.code)}catch(U){console.error(U),F(u,Ke())}finally{k.value=!1}},j=async w=>{await X.push({query:{...n.query,page:w.current,page_size:w.pageSize}})};return ce(async()=>{if(d.value=l.discussId,d.value||(Array.isArray(n.params.discussId)?d.value=n.params.discussId[0]:d.value=n.params.discussId),!d.value){ve(u,"讨论不存在"),await X.push({name:"discuss"});return}s.value=!0;const w=await lr(d.value);if(w.code!==0){s.value=!1,F(u,w.code),await X.push({name:"discuss"});return}w.data.tags&&w.data.tags.forEach(V=>{g[V.id]=V}),T.value=Wt(w.data.discuss),b.setTitle(T.value.title+" - "+b.getTitle),S.value=T.value.content,s.value=!1,o=Le(()=>n.query,V=>{const $=parseInt(V.page)||i.value.defaultCurrent,U=parseInt(V.page_size)||i.value.defaultPageSize;h=$,_=U,i.value={...i.value,current:h,pageSize:_},y({current:h,pageSize:_},!0)},{immediate:!0})}),Te(()=>{o&&o()}),(w,V)=>{const $=ya,U=ha,D=Ae("md-preview"),P=be,q=we,R=Pl,W=Ae("md-editor-v3"),ee=Ve,ne=G,ae=xe,Z=Be,Y=He,me=Pe;return L(),M(ee,{loading:s.value},{default:a(()=>[t(me,{class:"dida-main-content"},{default:a(()=>[t(ae,{span:8},{default:a(()=>{var Q,H,N;return[(Q=T.value)!=null&&Q.problemTitle||(H=T.value)!=null&&H.contestTitle?(L(),te("div",pr,[t(U,{"max-item-width":"300"},{default:a(()=>{var se,K,O,re,_e;return[(se=T.value)!=null&&se.contestTitle?(L(),te(de,{key:0},[t($,{to:{name:"contest-detail",params:{contestId:(K=T.value)==null?void 0:K.contestId}}},{default:a(()=>{var ge;return[x(E((ge=T.value)==null?void 0:ge.contestTitle),1)]}),_:1},8,["to"]),(O=T.value)!=null&&O.contestProblemIndex?(L(),M($,{key:0,to:{name:"contest-problem-detail",params:{problemIndex:(re=T.value)==null?void 0:re.contestProblemIndex}}},{default:a(()=>{var ge,J;return[x(E(fe(at)((ge=T.value)==null?void 0:ge.contestProblemIndex))+" - "+E((J=T.value)==null?void 0:J.problemTitle),1)]}),_:1},8,["to"])):le("",!0)],64)):(L(),te(de,{key:1},[t($,{to:{name:"discuss-list-problem"}},{default:a(()=>V[4]||(V[4]=[x(" 题目讨论")])),_:1}),t($,{to:{name:"problem-detail",params:{problemId:(_e=T.value)==null?void 0:_e.problemId}}},{default:a(()=>{var ge;return[x(E((ge=T.value)==null?void 0:ge.problemTitle),1)]}),_:1},8,["to"])],64))]}),_:1})])):le("",!0),t(P,{style:{margin:"10px"},header:(N=T.value)==null?void 0:N.title,"header-bordered":!0},{default:a(()=>[t(D,{"model-value":fe(S),previewTheme:"cyanosis"},null,8,["model-value"])]),_:1},8,["header"]),(L(!0),te(de,null,Ie(p.value,(se,K)=>(L(),M(P,{key:K,style:{margin:"10px"},"header-bordered":""},{header:a(()=>[t(q,null,{default:a(()=>[z("span",null,E(se.authorNickname),1),z("span",null,E(se.insertTime),1)]),_:2},1024)]),default:a(()=>[t(D,{"model-value":se.content,previewTheme:"cyanosis"},null,8,["model-value"])]),_:2},1024))),128)),z("div",fr,[t(R,{modelValue:i.value.current,"onUpdate:modelValue":V[0]||(V[0]=se=>i.value.current=se),"page-size":i.value.pageSize,"onUpdate:pageSize":V[1]||(V[1]=se=>i.value.pageSize=se),total:i.value.total,"page-size-options":i.value.pageSizeOptions,"show-page-size":!1,"total-content":A,onChange:j},null,8,["modelValue","page-size","total","page-size-options"])]),z("div",vr,[t(W,{id:"discuss-comment-editor",modelValue:fe(v),"onUpdate:modelValue":V[2]||(V[2]=se=>al(v)?v.value=se:v=se),previewTheme:"cyanosis"},null,8,["modelValue"]),t(ee,{loading:!1,attach:"#discuss-comment-editor","z-index":1e5}),z("div",_r,[t(q,null,{default:a(()=>[t(ne,{theme:"primary",onClick:I},{default:a(()=>V[5]||(V[5]=[x("提交")])),_:1})]),_:1})])])]}),_:1}),t(ae,{span:4},{default:a(()=>[z("div",gr,[C.value?(L(),te("div",br,[t(ne,{onClick:r},{default:a(()=>V[6]||(V[6]=[x("编辑")])),_:1})])):le("",!0),t(Y,{layout:"vertical",bordered:!0},{default:a(()=>[t(Z,{label:"创建时间"},{default:a(()=>{var Q;return[x(E((Q=T.value)==null?void 0:Q.insertTime),1)]}),_:1}),t(Z,{label:"编辑时间"},{default:a(()=>{var Q;return[x(E((Q=T.value)==null?void 0:Q.modifyTime),1)]}),_:1}),t(Z,{label:"更新时间"},{default:a(()=>{var Q;return[x(E((Q=T.value)==null?void 0:Q.updateTime),1)]}),_:1}),t(Z,{label:"创建用户"},{default:a(()=>[t(ne,{variant:"text",onClick:V[3]||(V[3]=async()=>{var Q;return await fe(Ht)(fe(X),(Q=T.value)==null?void 0:Q.authorUsername)})},{default:a(()=>{var Q;return[x(E((Q=T.value)==null?void 0:Q.authorNickname),1)]}),_:1})]),_:1}),t(Z,{label:"标签"},{default:a(()=>[t(q,null,{default:a(()=>{var Q;return[(L(!0),te(de,null,Ie((Q=T.value)==null?void 0:Q.tags,H=>(L(),M(ne,{key:H.id,variant:"dashed",onClick:()=>c(H)},{default:a(()=>[x(E(H.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Ut=ie(hr,[["__scopeId","data-v-c38eb09a"]]),yr={style:{margin:"10px"}},wr={style:{margin:"12px"}},kr={class:"dida-edit-container"},Cr={class:"dida-description-editor"},Sr=ue({__name:"DiscussEdit",setup(e){let l=Ce();const{globalProperties:n}=pe();let u=null;const o=m(0),b=m(!1),f=m(!1),S=m(null),d=m({title:"",problemId:"",content:""}),s=()=>{X.push({name:"discuss-detail",params:{discussId:o.value}})};async function T(_,i){f.value=!0,await vt(_,i,n,()=>sr(o.value)),f.value=!1}const v=async()=>{f.value=!0;try{const _={title:d.value.title,content:d.value.content,problem_id:d.value.problemId},i=await ur(_);if(f.value=!0,i.code!==0){F(n,i.code);return}const p=i.data;await X.push({name:"discuss-detail",params:{discussId:p}}),Ge(n,"创建成功")}finally{f.value=!1}},k=async()=>{f.value=!0;try{const _={id:o.value,title:d.value.title,content:d.value.content,problem_id:d.value.problemId},i=await ir(_);if(f.value=!0,i.code!==0){F(n,i.code);return}S.value&&i.data.update_time!=null&&(S.value.updateTime=new Date(i.data.update_time).toLocaleString()),i.data.content!=null&&(d.value.content=i.data.content),Ge(n,"保存成功")}finally{f.value=!1}},h=async()=>{const _=await nr(o.value);if(_.code!==0){F(n,_.code),await X.push({name:"discuss"});return}const i=_.data.discuss;S.value=Wt(i),d.value.title=i.title,d.value.content=i.content,d.value.problemId=i.problem_id,b.value=!1};return ce(async()=>{u=Le(()=>l.params,async()=>{Array.isArray(l.params.discussId)?o.value=Number(l.params.discussId[0]):o.value=Number(l.params.discussId),o.value?(b.value=!0,await h()):(d.value.title="",d.value.problemId="",d.value.content="")},{immediate:!0})}),Te(()=>{u&&(u(),u=null)}),(_,i)=>{const p=$e,g=Ue,C=je,c=be,r=xe,A=G,I=we,y=Be,j=He,w=Pe,V=Ae("md-editor-v3"),$=Ve;return L(),M($,{loading:b.value},{default:a(()=>[t(w,null,{default:a(()=>[t(r,{span:8},{default:a(()=>[z("div",yr,[t(c,{class:"sh-form-card"},{default:a(()=>[t(C,{model:d.value},{default:a(()=>[t(g,{label:"标题"},{default:a(()=>[t(p,{modelValue:d.value.title,"onUpdate:modelValue":i[0]||(i[0]=U=>d.value.title=U),placeholder:"讨论标题"},null,8,["modelValue"])]),_:1}),t(g,{label:"关联题目"},{default:a(()=>[t(p,{modelValue:d.value.problemId,"onUpdate:modelValue":i[1]||(i[1]=U=>d.value.problemId=U),placeholder:"讨论题目"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(r,{span:4},{default:a(()=>[z("div",wr,[z("div",kr,[o.value?(L(),M(I,{key:0},{default:a(()=>[t(A,{onClick:k,theme:"danger",loading:f.value},{default:a(()=>i[3]||(i[3]=[x("保存")])),_:1},8,["loading"]),t(A,{onClick:s},{default:a(()=>i[4]||(i[4]=[x("查看")])),_:1})]),_:1})):(L(),M(I,{key:1},{default:a(()=>[t(A,{onClick:v,theme:"danger",loading:f.value},{default:a(()=>i[5]||(i[5]=[x("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(L(),M(j,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(y,{label:"创建时间"},{default:a(()=>{var U;return[x(E((U=S.value)==null?void 0:U.insertTime),1)]}),_:1}),t(y,{label:"更新时间"},{default:a(()=>{var U;return[x(E((U=S.value)==null?void 0:U.modifyTime),1)]}),_:1}),t(y,{label:"创建用户"},{default:a(()=>{var U;return[x(E((U=S.value)==null?void 0:U.authorNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),z("div",Cr,[t(V,{id:"discuss-editor",modelValue:d.value.content,"onUpdate:modelValue":i[2]||(i[2]=U=>d.value.content=U),onSave:k,onOnUploadImg:T,previewTheme:"cyanosis"},null,8,["modelValue"]),t($,{loading:f.value,attach:"#discuss-editor","z-index":1e5},null,8,["loading"])])]),_:1},8,["loading"])}}}),ca=ie(Sr,[["__scopeId","data-v-ef3dfb3e"]]);function Ir(e,l){return B({url:"/rank/ac/all?page="+e+"&page_size="+l,method:"get"})}function Pr(e,l){return B({url:"/rank/ac/problem?page="+e+"&page_size="+l,method:"get"})}function xr(e,l){return B({url:"/rank/ac/problem/today?page="+e+"&page_size="+l,method:"get"})}function Vr(e,l){return B({url:"/rank/ac/problem/day7?page="+e+"&page_size="+l,method:"get"})}function Tr(e,l){return B({url:"/rank/ac/problem/day30?page="+e+"&page_size="+l,method:"get"})}function Dr(e,l){return B({url:"/rank/ac/problem/year?page="+e+"&page_size="+l,method:"get"})}const Lr={style:{margin:"10px"}};function $t(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const jr=ue({__name:"RankUser",props:{type:{}},setup(e){const l=Ce(),n=Ye(),{globalProperties:u}=pe();let o=null;const b=e,f=m(""),S=m(""),d={all:{header:"统计所有用户在本站的提交记录",content:"优先以AC记录数量排序，如果相同则提交所用次数较少的优先，如果仍相同，注册较早的用户靠前"},problem:{header:"统计所有用户在本站的提交记录",content:"以题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-today":{header:"统计所有用户今日在本站的提交记录",content:"以今日题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-day7":{header:"统计所有用户最近7日在本站的提交记录",content:"以7日题目记录数量排序（从7日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-day30":{header:"统计所有用户最近30日在本站的提交记录",content:"以30日题目记录数量排序（从30日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-year":{header:"统计所有用户最近1年在本站的提交记录",content:"以最近1年题目记录数量排序（从365日前的0点开始计算），如果相同，注册较早的用户靠前"}},s=m([]),T=[{title:"序号",colKey:"index"},{title:"用户名",colKey:"username",cell:(y,j)=>t(G,{variant:"dashed",onClick:()=>C(j.row.username)},{default:()=>[j.row.username]})},{title:"昵称",colKey:"nickname"},{title:"Slogan",colKey:"slogan"}],v=[{title:"题目数量",colKey:"problem_count",cell:(y,j)=>{let w=0;return j.row.problem_count&&(w=j.row.problem_count),t(G,{variant:"dashed",onClick:()=>c(j.row.username)},$t(w)?w:{default:()=>[w]})}}],k=[{title:"正确",colKey:"accept",cell:(y,j)=>{let w=0;return j.row.accept&&(w=j.row.accept),t(G,{variant:"dashed",onClick:()=>c(j.row.username)},$t(w)?w:{default:()=>[w]})}},{title:"提交",colKey:"attempt",cell:(y,j)=>{let w=0;return j.row.attempt&&(w=j.row.attempt),t(G,{variant:"dashed",onClick:()=>r(j.row.username)},$t(w)?w:{default:()=>[w]})}}],h=m(!1);let _=1,i=50;const p=m({current:_,pageSize:i,defaultCurrent:_,defaultPageSize:i,total:0,pageSizeOptions:[50]}),g=m(),C=y=>{n.push({name:"user",params:{username:y}})},c=y=>{n.push({name:"judge-list",query:{username:y,status:Fe.Accept}})},r=y=>{n.push({name:"judge-list",query:{username:y}})},A=async(y,j)=>{h.value=!0;try{g.value=[];const{current:w,pageSize:V}=y;let $=null;switch(b.type){case"problem":$=await Pr(w,V);break;case"problem-today":$=await xr(w,V);break;case"problem-day7":$=await Vr(w,V);break;case"problem-day30":$=await Tr(w,V);break;case"problem-year":$=await Dr(w,V);break;default:$=await Ir(w,V);break}if($.code===0){const U=$.data.list;if(!U||U.length<=0){p.value={...p.value,total:0},ke(u,"未找到记录");return}g.value=[];const D=p.value.pageSize*(p.value.current-1);let P=1;U.forEach(q=>{var W;const R=q;R.index=D+P++,(W=g.value)==null||W.push(R)}),p.value={...p.value,total:$.data.total_count}}else j&&F(u,$.code)}catch(w){console.error(w),F(u,Ke())}finally{h.value=!1}},I=async y=>{await n.push({query:{...l.query,page:y.current,page_size:y.pageSize}})};return ce(async()=>{h.value=!0,o=Le(()=>l.query,y=>{switch(b.type&&d[b.type]?(f.value=d[b.type].header,S.value=d[b.type].content):(f.value=d.all.header,S.value=d.all.content),b.type){case"all":s.value=T.concat(k);break;default:s.value=T.concat(v);break}const j=parseInt(y.page)||p.value.defaultCurrent,w=parseInt(y.page_size)||p.value.defaultPageSize;_=j,i=w,p.value={...p.value,current:_,pageSize:i},A({current:_,pageSize:i},!0)},{immediate:!0})}),Te(()=>{o&&o()}),(y,j)=>{const w=Re,V=be,$=xe,U=Pe;return L(),M(U,null,{default:a(()=>[t($,{span:9},{default:a(()=>[t(V,{style:{margin:"10px"}},{default:a(()=>[t(w,{data:g.value,columns:s.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:p.value,loading:h.value,"table-layout":"auto",onPageChange:I},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t($,{span:3},{default:a(()=>[z("div",Lr,[t(V,{class:"sh-card",header:f.value,"header-bordered":!0},{default:a(()=>[x(E(S.value),1)]),_:1},8,["header"])])]),_:1})]),_:1})}}}),st=ie(jr,[["__scopeId","data-v-13682529"]]),Ur={style:{display:"flex","align-items":"center"}},$r={style:{color:"#409eff","margin-right":"20px"}},zr={class:"dida-login-footer"},Ar=ue({__name:"UserForget",setup(e){const{globalProperties:l}=pe(),n=qe(),u=m(!1),o=m(!1),b=m(!1),f=m("发送验证码");let S=null,d=-1;const s=m(!1),T=m(null),v=m(""),k=m({username:"",emailKey:"",password:"",confirmPassword:""}),_=m({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:A=>new Promise(I=>{const y=setTimeout(()=>{I(k.value.password===A),clearTimeout(y)})}),message:"两次密码不一致"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),i=()=>{ke(l,"重置成功")},p=async A=>{if(!b.value){u.value=!0,o.value=!0;try{const I=await Kn(A,k.value.username);I.code===0?(ke(l,"验证码发送成功"),v.value=I.data,o.value=!1,b.value=!0,S=new Date,f.value="60秒后重发",d=setInterval(()=>{const j=Math.floor((new Date().getTime()-(S==null?void 0:S.getTime()))/1e3);j>60?(f.value="发送验证码",b.value=!1,clearInterval(d)):f.value=`${60-j}秒后重发`},1e3)):F(l,I.code)}catch(I){console.error("Send email key error",I),ve(l,"发送验证码失败")}finally{u.value=!1}}},g=async()=>{var j;if(s.value=!0,b.value||o.value)return;await ct();const A=document.getElementById("cf-confirm-div");A&&A.remove();const I=document.createElement("div");I.id="cf-confirm-div",I.setAttribute("data-theme","light"),(j=T.value)==null||j.appendChild(I);const y=window;y.turnstile.ready(function(){y.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(w){s.value=!1,await p(w)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},C=m(()=>t(G,{onClick:g,disabled:b.value,loading:o.value,style:"width:120px"},{default:()=>[f.value]})),c=async()=>{u.value=!0;try{const A=await Fn(k.value.username,k.value.password,k.value.emailKey);A.code===0?(ke(l,"密码修改成功"),l.$router.push({name:"login"})):F(l,A.code)}catch(A){console.error("Modify password error",A),ve(l,"修改密码失败")}finally{u.value=!1}},r=async({validateResult:A,firstError:I,e:y})=>{if(!u.value){if(y.preventDefault(),A!==!0){ve(l,I);return}v.value?await c():await g()}};return ce(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),Te(()=>{}),(A,I)=>{const y=St,j=$e,w=Ue,V=ga,$=G,U=je,D=lt,P=be,q=nt;return L(),te(de,null,[t(P,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(y,{"max-line":1},{default:a(()=>I[6]||(I[6]=[z("span",null,"如果您未绑定邮箱或忘记用户名，可联系管理员寻求帮助",-1),z("span",null,"管理员邮箱：BoilTask@qq.com",-1)])),_:1}),t(U,{ref:"form",rules:_.value,data:k.value,colon:!0,onReset:i,onSubmit:r,class:"yj-login-form"},{default:a(()=>[t(w,{name:"username",label:"用户名"},{default:a(()=>[t(j,{modelValue:k.value.username,"onUpdate:modelValue":I[0]||(I[0]=R=>k.value.username=R),clearable:"",placeholder:"请输入完整用户名"},null,8,["modelValue"])]),_:1}),v.value?(L(),te(de,{key:0},[t(w,{name:"email",label:"发送邮箱"},{default:a(()=>[t(V,{append:C.value},{default:a(()=>[z("div",Ur,[z("span",$r,E(v.value),1)])]),_:1},8,["append"])]),_:1}),t(w,{name:"emailKey",label:"验证码"},{default:a(()=>[t(j,{modelValue:k.value.emailKey,"onUpdate:modelValue":I[1]||(I[1]=R=>k.value.emailKey=R),clearable:"",placeholder:"请输入收到的验证码"},null,8,["modelValue"])]),_:1}),t(w,{name:"password",label:"新密码"},{default:a(()=>[t(j,{modelValue:k.value.password,"onUpdate:modelValue":I[2]||(I[2]=R=>k.value.password=R),type:"password",clearable:"",placeholder:"新密码"},null,8,["modelValue"])]),_:1}),t(w,{name:"confirmPassword",label:"确认密码"},{default:a(()=>[t(j,{modelValue:k.value.confirmPassword,"onUpdate:modelValue":I[3]||(I[3]=R=>k.value.confirmPassword=R),type:"password",clearable:"",placeholder:"请重复输入密码"},null,8,["modelValue"])]),_:1})],64)):le("",!0),v.value?(L(),M(w,{key:1},{default:a(()=>[t($,{theme:"primary",type:"submit",block:"",loading:u.value},{default:a(()=>I[7]||(I[7]=[x("修改密码")])),_:1},8,["loading"])]),_:1})):(L(),M(w,{key:2},{default:a(()=>[t($,{theme:"primary",type:"submit",block:"",loading:u.value},{default:a(()=>I[8]||(I[8]=[x("重置密码")])),_:1},8,["loading"])]),_:1}))]),_:1},8,["rules","data"]),z("div",zr,[t(D,{onClick:I[4]||(I[4]=()=>{fe(l).$router.push({name:"login"})})},{default:a(()=>I[9]||(I[9]=[x("返回登陆 ")])),_:1})])]),_:1}),t(q,{visible:s.value,"onUpdate:visible":I[5]||(I[5]=R=>s.value=R),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:a(()=>[z("div",{ref_key:"dialogContainer",ref:T,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),Rr=ie(Ar,[["__scopeId","data-v-c3586c6f"]]),Mr={class:"judger-status-panel"},Er={class:"judger-status-panel"};function qr(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const Kr=ue({__name:"SystemStatus",setup(e){const{globalProperties:l}=pe(),n=m([]),u=m([]),o=m(!1);let b;const f=s=>{let T="失效",v="danger";const k=new Date,h=new Date(s.updateTime);return k.getTime()-h.getTime()>3e4?(T="离线",v="default"):s.cpuUsage>90?(T="CPU过高",v="warning"):s.memPercent>90?(T="内存过高",v="warning"):(T="在线",v="success"),t(we,null,{default:()=>[t("span",null,[s.key,x(" - "),s.name]),t("span",null,[s.updateTime]),t(tt,{theme:v,size:"small"},qr(T)?T:{default:()=>[T]})]})},S=async()=>{const s={};for(let C=0;C<n.value.length;C++){const c=n.value[C];s[c.key]={...c}}const T={};for(let C=0;C<u.value.length;C++){const c=u.value[C];T[c.key]={...c}}const v=[],k=[],h=await Yl();if(h.code!==0){F(l,h.code);return}const _=h.data.web,i={key:"didaoj"};_.name?i.name=_.name:i.name="-",_.update_time?i.updateTime=new Date(_.update_time).toLocaleString():i.updateTime="-",_.cpu_usage?i.cpuUsage=Number(_.cpu_usage):i.cpuUsage=0,_.mem_usage?i.memUsage=_.mem_usage/(1024*1024*1024):i.memUsage=0,_.mem_total?i.memTotal=_.mem_total/(1024*1024*1024):i.memTotal=0,i.memTotal>0?i.memPercent=Math.round(i.memUsage/i.memTotal*1e4)/100:i.memPercent=0,i.avgMessage=_.avg_message;const p=s[i.key];p?(i.cpuUsageFrom=p.cpuUsage,i.memPercentFrom=p.memPercent,i.memUsageFrom=p.memUsage,i.memTotalFrom=p.memTotal):(i.cpuUsageFrom=0,i.memPercentFrom=0,i.memUsageFrom=0,i.memTotalFrom=0),v.push(i),n.value=v;const g=h.data.judger;for(let C=0;C<g.length;C++){const c=g[C],r={key:c.key,name:c.name};c.name?r.name=c.name:r.name="-",c.update_time?r.updateTime=new Date(c.update_time).toLocaleString():r.updateTime="-",c.cpu_usage?r.cpuUsage=Number(c.cpu_usage):r.cpuUsage=0,c.mem_usage?r.memUsage=c.mem_usage/(1024*1024*1024):r.memUsage=0,c.mem_total?r.memTotal=c.mem_total/(1024*1024*1024):r.memTotal=0,r.memTotal>0?r.memPercent=Math.round(r.memUsage/r.memTotal*1e4)/100:r.memPercent=0,r.avgMessage=c.avg_message,T[c.key]?(r.cpuUsageFrom=T[c.key].cpuUsage,r.memPercentFrom=T[c.key].memPercent,r.memUsageFrom=T[c.key].memUsage,r.memTotalFrom=T[c.key].memTotal):(r.cpuUsageFrom=0,r.memPercentFrom=0,r.memUsageFrom=0,r.memTotalFrom=0),k.push(r)}u.value=k},d=async()=>{await S(),o.value=!1};return ce(async()=>{u.value=[],n.value=[],o.value=!0,await d(),b=setInterval(()=>{d()},5e3)}),Te(()=>{clearInterval(b)}),(s,T)=>{const v=xl,k=we,h=be,_=Ve;return L(),M(_,{loading:o.value},{default:a(()=>[t(h,{title:"接口状态",class:"judger-status"},{default:a(()=>[z("div",Mr,[(L(!0),te(de,null,Ie(n.value,i=>(L(),M(h,{key:i.key,header:()=>f(i),class:"judge-status-judger"},{footer:a(()=>[z("span",null," 负载信息："+E(i.avgMessage),1)]),default:a(()=>[t(k,{class:"judge-status-judger"},{default:a(()=>[t(v,{title:"CPU使用率",value:i.cpuUsage,animation:{valueFrom:i.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(v,{title:"内存使用率",value:i.memPercent,animation:{valueFrom:i.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(v,{title:"内存使用量",animation:{valueFrom:i.memUsageFrom,duration:2e3},"animation-start":!0,value:i.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(v,{title:"内存总量",value:i.memTotal,animation:{valueFrom:i.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1}),t(h,{title:"判题机状态",class:"judger-status"},{default:a(()=>[z("div",Er,[(L(!0),te(de,null,Ie(u.value,i=>(L(),M(h,{key:i.key,header:()=>f(i),class:"judge-status-judger"},{footer:a(()=>[z("span",null," 负载信息："+E(i.avgMessage),1)]),default:a(()=>[t(k,{class:"judge-status-judger"},{default:a(()=>[t(v,{title:"CPU使用率",value:i.cpuUsage,animation:{valueFrom:i.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(v,{title:"内存使用率",value:i.memPercent,animation:{valueFrom:i.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(v,{title:"内存使用量",animation:{valueFrom:i.memUsageFrom,duration:2e3},"animation-start":!0,value:i.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(v,{title:"内存总量",value:i.memTotal,animation:{valueFrom:i.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1})]),_:1},8,["loading"])}}}),Fr=ie(Kr,[["__scopeId","data-v-d2b0a05b"]]),Gr=ue({__name:"ManageJudge",setup(e){const{globalProperties:l}=pe(),n=m(!1),u=m(!1),o=m({problemId:"",language:void 0,status:void 0}),b=m(!1),f=m([]);f.value=Ft();const S=m([]);S.value=xa();const d=async()=>{n.value=!0;try{const v=await on();if(v.code!==0){F(l,v.code);return}ke(l,"重判成功"),await X.push({name:"judge-list"})}catch(v){console.error(v),F(l,"重判失败")}finally{n.value=!1}},s=async()=>{if(!o.value.problemId&&!o.value.language&&!o.value.status){F(l,"请输入问题Id");return}b.value=!0;try{const v=await sn(o.value.problemId,o.value.language,o.value.status);if(v.code!==0){F(l,v.code);return}ke(l,"重判成功"),await X.push({name:"judge-list",query:{problem_id:o.value.problemId,language:o.value.language}})}catch(v){console.error(v),F(l,"重判失败")}finally{b.value=!1}},T=async()=>{u.value=!0;try{const v=await rn();if(v.code!==0){F(l,v.code);return}ke(l,"重判成功"),await X.push({name:"judge-list"})}catch(v){console.error(v),F(l,"重判失败")}finally{u.value=!1}};return(v,k)=>{const h=G,_=be,i=$e,p=Ue,g=qt,C=pt,c=we,r=je;return L(),te(de,null,[t(_,{class:"yj-manage-card",title:"重判最近提交"},{default:a(()=>[t(h,{onClick:d,loading:n.value},{default:a(()=>k[3]||(k[3]=[x("重判")])),_:1},8,["loading"])]),_:1}),t(_,{class:"yj-manage-card",title:"重判指定记录"},{default:a(()=>[t(r,{layout:"inline",onSubmit:s},{default:a(()=>[t(p,{label:"题号"},{default:a(()=>[t(i,{modelValue:o.value.problemId,"onUpdate:modelValue":k[0]||(k[0]=A=>o.value.problemId=A),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(p,{label:"语言"},{default:a(()=>[t(C,{modelValue:o.value.language,"onUpdate:modelValue":k[1]||(k[1]=A=>o.value.language=A),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:a(()=>[(L(!0),te(de,null,Ie(f.value,A=>(L(),M(g,{key:A.value,value:A.value,label:A.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"状态"},{default:a(()=>[t(C,{modelValue:o.value.status,"onUpdate:modelValue":k[2]||(k[2]=A=>o.value.status=A),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:a(()=>[(L(!0),te(de,null,Ie(S.value,A=>(L(),M(g,{key:A.value,value:A.value,label:A.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(p,null,{default:a(()=>[t(c,null,{default:a(()=>[t(h,{theme:"primary",type:"submit",loading:b.value},{default:a(()=>k[4]||(k[4]=[x("重判")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(_,{class:"yj-manage-card",title:"重判所有"},{default:a(()=>[t(h,{onClick:T,theme:"danger",loading:u.value},{default:a(()=>k[5]||(k[5]=[x("重判")])),_:1},8,["loading"])]),_:1})],64)}}}),Nr=ie(Gr,[["__scopeId","data-v-6a706c72"]]),Or=ue({__name:"ManageWeb",setup(e){const{globalProperties:l}=pe(),n=m({theme:"",content:""}),u=m({title:"",content:""}),o=m(!1),b=m(!1),f=m(!1);async function S(k,h){f.value=!0,await vt(k,h,l,Jl),f.value=!1}const d=async()=>{b.value=!0;try{const k=await Xl(n.value.theme,n.value.content);if(k.code!==0){F(l,k.code);return}ke(l,"保存成功")}catch(k){console.error(k),F(l,"保存失败")}finally{b.value=!1}},s=async()=>{f.value=!0;try{const k=u.value.content,h=await Zl(u.value.title,k);if(h.code!==0){F(l,h.code);return}u.value.content=h.data.content,ke(l,"保存成功")}catch(k){console.error(k),ve(l,"保存失败")}finally{f.value=!1}},T=async()=>{n.value=await Sa()},v=async()=>{try{u.value=await Ia()}catch{ve(l,"加载公告失败"),u.value={title:"",content:""}}};return ce(async()=>{o.value=!0;try{await T(),await v()}catch{ve(l,"加载数据失败")}o.value=!1}),(k,h)=>{const _=pt,i=Ue,p=$e,g=G,C=we,c=je,r=be,A=Ae("md-editor-v3"),I=Ve;return L(),M(I,{loading:o.value},{default:a(()=>[t(r,{class:"yj-manage-card",title:"站点通知"},{default:a(()=>[t(c,{onSubmit:d},{default:a(()=>[t(i,{label:"主题"},{default:a(()=>[t(_,{modelValue:n.value.theme,"onUpdate:modelValue":h[0]||(h[0]=y=>n.value.theme=y),options:[{label:"success",value:"success"},{label:"info",value:"info"},{label:"warning",value:"warning"},{label:"error",value:"error"}],placeholder:"请选择主题"},null,8,["modelValue"])]),_:1}),t(i,{label:"内容"},{default:a(()=>[t(p,{modelValue:n.value.content,"onUpdate:modelValue":h[1]||(h[1]=y=>n.value.content=y),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),t(i,null,{default:a(()=>[t(C,null,{default:a(()=>[t(g,{theme:"primary",type:"submit",loading:b.value},{default:a(()=>h[4]||(h[4]=[x("保存")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(r,{class:"yj-manage-card",title:"首页公告"},{actions:a(()=>[t(g,{theme:"primary",loading:f.value,onClick:s},{default:a(()=>h[5]||(h[5]=[x("保存")])),_:1},8,["loading"])]),default:a(()=>[t(c,{onSubmit:s},{default:a(()=>[t(i,{label:"标题"},{default:a(()=>[t(p,{modelValue:u.value.title,"onUpdate:modelValue":h[2]||(h[2]=y=>u.value.title=y),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1}),t(I,{loading:f.value},{default:a(()=>[t(A,{modelValue:u.value.content,"onUpdate:modelValue":h[3]||(h[3]=y=>u.value.content=y),onSave:s,onOnUploadImg:S,previewTheme:"cyanosis",class:"dida-description-editor"},null,8,["modelValue"])]),_:1},8,["loading"])]),_:1})]),_:1},8,["loading"])}}}),Hr=ie(Or,[["__scopeId","data-v-4d343ab4"]]),Ma=[{name:"problem-list",tab:"problem",sidebar:"problem-list",path:"",title:"问题列表",icon:"list",component:uo},{name:"problem-detail",tab:"problem",sidebar:"problem-list",path:":problemId+",title:"问题详情",icon:"list",component:Lt},{name:"problem-daily-list",tab:"problem",sidebar:"problem-daily-list",path:"daily",title:"每日一题",icon:"list",component:Mo},{name:"problem-daily-detail",tab:"problem",sidebar:"problem-daily-list",path:"daily/:dailyId+",title:"问题详情",icon:"list",component:Lt},{name:"problem-recommend",tab:"problem",sidebar:"problem-recommend",path:"recommend/:problemId*",title:"问题推荐",icon:"cpu",needLogin:!0,component:Ho},{name:"problem-collection-list",tab:"problem",sidebar:"problem-collection-list",path:"collection",title:"题目集合",icon:"list",disableTabPath:!0,component:fs},{name:"collection-detail",tab:"collection-detail-tab",sidebar:"collection-detail",path:":collectionId+",title:"题集详情",icon:"cpu",component:hs},{name:"collection-rank",tab:"collection-detail-tab",sidebar:"collection-rank",path:":collectionId+/rank",title:"题集排名",icon:"list",component:ys},{name:"collection-edit",tab:"collection-detail-tab",sidebar:"collection-edit",disableSidebar:!0,needLogin:!0,path:":collectionId+/edit",title:"题集编辑",icon:"list",component:la},{name:"collection-create",tab:"collection-detail-tab",sidebar:"collection-create",needLogin:!0,disableSidebar:!0,path:"create",title:"新建题集",icon:"list",component:la},{name:"judge-list",tab:"judge",sidebar:"judge-list",path:"",title:"评测列表",icon:"list",component:oa},{name:"judge-detail",tab:"judge",sidebar:"judge-list",path:":judgeId+",title:"评测详情",icon:"cpu",component:ra},{name:"contest-list",tab:"contest",sidebar:"contest-list",path:"",title:"比赛列表",icon:"list",component:ua},{name:"contest-recent",tab:"contest",sidebar:"contest-recent",path:"recent",title:"近期比赛",icon:"list",component:ua},{name:"contest-create",tab:"contest",sidebar:"contest-create",disableSidebar:!0,needLogin:!0,path:"create",title:"新建比赛",icon:"list",component:da},{name:"contest-edit",tab:"contest-detail-tab",sidebar:"contest-edit",disableSidebar:!0,needLogin:!0,path:":contestId+/edit",title:"比赛编辑",icon:"list",component:da},{name:"contest-detail",tab:"contest-detail-tab",sidebar:"contest-detail",path:":contestId+",title:"比赛详情",icon:"cpu",component:Ns},{name:"contest-problem-detail",tab:"contest-detail-tab",sidebar:"contest-problem-detail",path:":contestId+/problem/:problemIndex+",title:"问题详情",icon:"cpu",disableSidebar:!0,component:Lt},{name:"contest-judge",tab:"contest-detail-tab",sidebar:"contest-judge",path:":contestId+/judge",title:"评测列表",icon:"list",component:oa},{name:"contest-judge-detail",tab:"contest-detail-tab",sidebar:"contest-judge-detail",path:":contestId+/judge/:judgeId+",title:"评测详情",icon:"cpu",component:ra,disableSidebar:!0},{name:"contest-rank",tab:"contest-detail-tab",sidebar:"contest-rank",path:":contestId+/rank",title:"比赛排名",icon:"list",component:Js},{name:"contest-discuss",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss",title:"比赛讨论",icon:"list",component:jt},{name:"contest-discuss-detail",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss/:discussId+",title:"讨论详情",icon:"list",component:Ut},{name:"discuss-list",tab:"discuss",sidebar:"discuss-list",path:"",title:"讨论列表",icon:"list",component:jt},{name:"discuss-create",tab:"discuss",sidebar:"discuss-create",disableSidebar:!0,needLogin:!0,path:"create",title:"新建讨论",icon:"list",component:ca},{name:"discuss-edit",tab:"discuss-detail-tab",sidebar:"discuss-edit",disableSidebar:!0,needLogin:!0,path:":discussId+/edit",title:"编辑讨论",icon:"list",component:ca},{name:"discuss-list-problem",tab:"discuss",sidebar:"discuss-list-problem",path:"problem",title:"题目讨论",icon:"list",component:jt},{name:"discuss-detail",tab:"discuss",sidebar:"discuss-list",path:":discussId+",title:"讨论详情",icon:"list",component:Ut},{name:"rank-ac-all",tab:"rank",sidebar:"rank-ac-all",path:"ac",title:"AC排名",icon:"base-station",props:{type:"all"},component:st},{name:"rank-ac-problem",tab:"rank",sidebar:"rank-ac-problem",path:"ac/problem",title:"题量排名",icon:"base-station",props:{type:"problem"},component:st},{name:"rank-ac-problem-today",tab:"rank",sidebar:"rank-ac-problem-today",path:"ac/problem/today",title:"今日题量",icon:"base-station",props:{type:"problem-today"},component:st},{name:"rank-ac-problem-day7",tab:"rank",sidebar:"rank-ac-problem-day7",path:"ac/problem/day7",title:"7日题量",icon:"base-station",props:{type:"problem-day7"},component:st},{name:"rank-ac-problem-day30",tab:"rank",sidebar:"rank-ac-problem-day30",path:"ac/problem/day30",title:"30日题量",icon:"base-station",props:{type:"problem-day30"},component:st},{name:"rank-ac-problem-year",tab:"rank",sidebar:"rank-ac-problem-year",path:"ac/problem/year",title:"1年题量",icon:"base-station",props:{type:"problem-year"},component:st},{name:"system-status",tab:"system",sidebar:"system-status",path:"",title:"运行状态",icon:"base-station",component:Fr},{name:"system-about",tab:"system",sidebar:"system-about",path:"about",title:"关于",icon:"base-station",props:{discussId:"52"},component:Ut},{name:"manage-problem-create",tab:"manage",sidebar:"manage-problem-create",disableSidebar:!0,path:"problem",title:"新建问题",icon:"list",component:aa,auths:[ze.ManageProblem]},{name:"manage-problem",tab:"manage",sidebar:"manage-problem",disableSidebar:!0,path:"problem/:problemId+",title:"问题编辑",icon:"list",component:aa,auths:[ze.ManageProblem]},{name:"manage-problem-daily-create",tab:"manage",sidebar:"manage-problem-daily-create",disableSidebar:!0,path:"problem/daily",title:"新建每日一题",icon:"list",component:ta,auths:[ze.ManageProblemDaily]},{name:"manage-problem-daily",tab:"manage",sidebar:"manage-problem-daily",disableSidebar:!0,path:"problem/daily/:dailyId+",title:"编辑每日一题",icon:"list",component:ta,auths:[ze.ManageProblemDaily]},{name:"manage-problem-judge",tab:"manage",sidebar:"manage-problem-judge",disableSidebar:!0,path:"problem/:problemId+/judge",title:"评测数据",icon:"list",component:ls,auths:[ze.ManageProblem]},{name:"manage-web",tab:"manage",path:"web",sidebar:"manage-web",title:"站点管理",icon:"list",auths:[ze.ManageWeb],component:Hr},{name:"manage-judge",tab:"manage",path:"judge",sidebar:"manage-judge",title:"评测管理",icon:"list",auths:["i-manage-judge"],component:Nr},{name:"login-forget",tab:"login",path:"forget",title:"忘记密码",component:Rr}],ma=(e,l,n,u)=>{u.tab==n&&(u.disableSidebar&&l!=u.sidebar||u.sidebar==null||u.sidebar!=u.name||e.push({name:u.name,title:u.title,icon:u.icon,to:{name:u.name}}))},Br=(e,l)=>{const n=[];return Ma.forEach(u=>{if($a(u)){const o=[];u.children.forEach(b=>{ma(o,e,l,b)}),o.length>0&&n.push({title:u.title,children:o})}else ma(n,e,l,u)}),n},pa=(e,l)=>{const n=eo(l.tab),u={name:l.name,path:"/"+l.path,meta:{title:l.title+" - "+n.title,tab:l.tab,sidebar:l.sidebar,showSidebar:n.showSidebar,needLogin:n.needLogin||l.needLogin,tabAuths:n.auths,auths:l.auths},props:l.props,component:l.component};!n.disablePath&&!l.disableTabPath&&(u.path=n.path+u.path),e.push(u)},Wr=e=>{Ma.forEach(l=>{$a(l)?l.children.forEach(n=>{pa(e,n)}):pa(e,l)})},Yr={class:"sh-main"},Jr=ue({__name:"View403",setup(e){let l=Ce();const n=m("");return ce(()=>{l.query.target?n.value=l.query.target:n.value=l.fullPath}),(u,o)=>{const b=G;return L(),te("div",Yr,[z("p",null,E(n.value),1),o[2]||(o[2]=z("p",null,"该页面无访问权限，请更换访问目标或重新登陆后再试",-1)),t(b,{theme:"primary",onClick:o[0]||(o[0]=()=>u.$router.push("/"))},{default:a(()=>o[1]||(o[1]=[x("返回首页")])),_:1})])}}}),Ea=ie(Jr,[["__scopeId","data-v-8f62f1f8"]]),gt=[];ao(gt);Wr(gt);gt.push({path:"/403",name:"403",component:Ea});gt.push({path:"/:pathMatch(.*)*",name:"404",component:Ua});const X=ll({history:nl("/"),routes:gt});X.beforeEach((e,l,n)=>{if(e.name==null||!X.hasRoute(e.name)){n({name:"home"});return}const u=e.matched[e.matched.length-1].meta;if(u.redirect){n({name:u.redirect});return}if(u.needLogin){const b=qe();if(b.getToken==null||b.getToken==""){n({name:"login",query:{redirect_uri:e.fullPath}});return}}const o=u.tabAuths;if(o&&!qe().hasAllAuths(o)){n({name:"403",query:{target:e.fullPath}});return}n()});X.afterEach((e,l)=>{if(e.name===l.name)return;const n=Pt(),u=Je();let o=null;if(e.matched.length>0&&(o=e.matched[e.matched.length-1].meta),o!=null&&o.title&&u.setTitle(o==null?void 0:o.title),o!=null&&o.showSidebar){n.setSidebarShow(!0);const b=Br(o==null?void 0:o.sidebar,o==null?void 0:o.tab);n.setMenuList(b),n.setMenuActiveName(o==null?void 0:o.sidebar)}else n.setSidebarShow(!1);window.scrollTo(0,0)});const qa=mt("login",{state:()=>({Loaded:!1}),getters:{isLoaded(){return this.Loaded}}}),Xr=ue({__name:"HeaderContent",setup(e){const l=qa(),n=qe(),{globalProperties:u}=pe(),o=m(l.isLoaded),b=m(!1),f=m(n.getUsername),S=m(n.getNickname),d=m(),s=()=>{d.value=to(n)};l.$subscribe((k,h)=>{o.value=h.Loaded}),n.$subscribe((k,h)=>{f.value=h.username,S.value=h.nickname,b.value=h.token!="",s()});const T=()=>{u.$router.currentRoute.value.name!=="login"&&u.$router.push({name:"login",query:{redirect_uri:u.$router.currentRoute.value.fullPath}})},v=()=>{n.clear(),u.$message.success({duration:3e3,content:"注销成功"}),u.$router.push({path:"/login",query:{redirect_uri:u.$router.currentRoute.value.fullPath}})};return ce(()=>{s()}),(k,h)=>{const _=Ae("router-link"),i=ka,p=wa,g=Vl,C=Tl;return L(),M(C,{modelValue:k.$route.meta.tab,"onUpdate:modelValue":h[0]||(h[0]=c=>k.$route.meta.tab=c),class:"sh-menu","expand-type":"popup"},{logo:a(()=>[t(_,{to:"/",class:"sh-logo"},{default:a(()=>h[1]||(h[1]=[x("DidaOJ")])),_:1})]),operations:a(()=>[o.value&&b.value?(L(),M(g,{key:0,title:S.value},{icon:a(()=>[t(i,{name:"user"})]),default:a(()=>[t(p,{value:"user",to:{path:"/user/"+f.value}},{default:a(()=>h[2]||(h[2]=[x("个人空间")])),_:1},8,["to"]),t(p,{value:"user_logout",onClick:v},{default:a(()=>h[3]||(h[3]=[x(" 注销")])),_:1})]),_:1},8,["title"])):o.value?(L(),M(p,{key:2,value:"login",onClick:T},{icon:a(()=>[t(i,{name:"login"})]),default:a(()=>[h[5]||(h[5]=x(" 登录 "))]),_:1})):(L(),M(p,{key:1,value:"login"},{icon:a(()=>[t(i,{name:"login"})]),default:a(()=>[h[4]||(h[4]=x(" ... "))]),_:1}))]),default:a(()=>[(L(!0),te(de,null,Ie(d.value,c=>(L(),M(p,{key:c.name,value:c.name,to:{name:c.name}},{icon:a(()=>[c.icon?(L(),M(i,{key:0,name:c.icon},null,8,["name"])):le("",!0)]),default:a(()=>[x(" "+E(c.title),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])}}}),Zr=ie(Xr,[["__scopeId","data-v-cdf693c2"]]),Qr={id:"menu-container"},eu=ue({__name:"SidebarContent",setup(e){const l=Pt(),n=m(!1),u=m(null),o=m(l.menuActiveName),b=m(l.menuList),f=m([]),S=m(!1),d=()=>{o.value=l.menuActiveName;const T=JSON.stringify(b.value),v=JSON.stringify(l.menuList);T!==v&&(f.value.push([...l.menuList]),s())},s=async()=>{if(f.value.length>0&&!S.value){for(S.value=!0;f.value.length>1;)f.value.shift();const T=f.value.shift();n.value=T.length<=0,b.value=[],await ct(),u.value&&u.value.updateActiveName(),await new Promise(k=>setTimeout(k,300)),b.value=T,await ct(),u.value&&u.value.updateActiveName();const v=300;await new Promise(k=>setTimeout(k,v)),S.value=!1,await s()}};return l.$subscribe((T,v)=>{d()}),ce(()=>{d()}),(T,v)=>{const k=ka,h=wa,_=Ll,i=Dl,p=Ve;return L(),te(de,null,[z("div",Qr,[t(i,{modelValue:o.value,"onUpdate:modelValue":v[0]||(v[0]=g=>o.value=g),theme:"light",class:"sh-menu-container"},{default:a(()=>[t(ol,{name:"move-left"},{default:a(()=>[(L(!0),te(de,null,Ie(b.value,(g,C)=>(L(),te(de,{key:C},[fe(lo)(g)?(L(),M(_,{key:0,title:g.title},{default:a(()=>[(L(!0),te(de,null,Ie(g.children,(c,r)=>(L(),M(h,{key:c.name,value:c.name,to:c.to},Xt({default:a(()=>[x(" "+E(c.title),1)]),_:2},[c.icon?{name:"icon",fn:a(()=>[t(k,{name:c.icon,class:Rt(c.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))),128))]),_:2},1032,["title"])):(L(),M(h,{key:g.name,value:g.name,to:g.to},Xt({default:a(()=>[x(" "+E(g.title),1)]),_:2},[g.icon?{name:"icon",fn:a(()=>[t(k,{name:g.icon,class:Rt(g.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),t(p,{size:"small",loading:n.value,"show-overlay":!0,attach:"#menu-container",class:"sh-sidebar-loading",style:{"align-items":"flex-start","padding-top":"100px"}},null,8,["loading"])],64)}}}),tu=ie(eu,[["__scopeId","data-v-96e2d89f"]]),au={};function lu(e,l){return null}const nu=ie(au,[["render",lu]]),ou={class:"footer"},su={class:"footer-left"},ru={class:"foot-time"},uu={class:"footer-center"},iu={href:"https://beiancx.miit.gov.cn/",target:"_blank"},du={class:"footer-right"},cu={class:"foot-text"},mu={href:"https://github.com/hpu-developer/DiDaOJ-web",target:"_blank"},pu={class:"foot-text"},fu={href:"https://github.com/hpu-developer/DiDaOJ-go",target:"_blank"},vu=ue({__name:"FooterContent",setup(e){const l=m("");function n(){l.value=new Date().toLocaleString()}return ce(()=>{n(),setInterval(()=>{n()},1e3)}),(u,o)=>{const b=G;return L(),te("div",ou,[z("div",su,[z("p",ru,E(l.value),1)]),z("div",uu,[z("a",iu,[t(b,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>o[0]||(o[0]=[x("豫ICP备15024677号-4")])),_:1})])]),z("div",du,[z("p",cu,[z("a",mu,[t(b,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>o[1]||(o[1]=[x("@didaoj-web")])),_:1})])]),z("p",pu,[z("a",fu,[t(b,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>o[2]||(o[2]=[x("@didaoj-go")])),_:1})])])])])}}}),_u=ie(vu,[["__scopeId","data-v-44f2e4e7"]]),bt=20,zt=100,At=50,gu=ue({__name:"ForceHiddenSidebarButton",setup(e){let l=Pt();const n=m({x:window.innerWidth-zt-bt,y:window.innerHeight-At-bt}),u=m(window.innerWidth),o=m(window.innerHeight);let b=!1,f={x:0,y:0};const S=g=>{b=!0;const C=g.clientX??g.touches[0].clientX,c=g.clientY??g.touches[0].clientY;f={x:C-n.value.x,y:c-n.value.y},document.addEventListener("mousemove",d),document.addEventListener("touchmove",d),document.addEventListener("mouseup",s),document.addEventListener("touchend",s)},d=g=>{if(!b)return;const C=g.clientX??g.touches[0].clientX,c=g.clientY??g.touches[0].clientY;let r=C-f.x,A=c-f.y;r=Math.max(0,Math.min(r,u.value-zt)),A=Math.max(0,Math.min(A,o.value-At)),n.value={x:r,y:A}},s=()=>{b=!1,document.removeEventListener("mousemove",d),document.removeEventListener("touchmove",d),document.removeEventListener("mouseup",s),document.removeEventListener("touchend",s)},T=()=>{u.value=window.innerWidth,o.value=window.innerHeight,n.value={x:Math.min(n.value.x,u.value-zt-bt),y:Math.min(n.value.y,o.value-At-bt)}};let v=m(l.forceHiddenSidebar),k=m(l.forceHiddenSidebar);const h=()=>{v.value=!v.value,l.setForceHiddenSidebar(v.value)},_=()=>{k.value||(k.value=!0,l.setForceHiddenSidebar(v.value))},i=()=>{k.value&&(k.value=!1,l.setForceHiddenSidebar(!1))},p=g=>{g>=800?i():_()};return p(u.value),Le(u,g=>{p(g)}),ce(()=>{window.addEventListener("resize",T)}),Te(()=>{window.removeEventListener("resize",T)}),(g,C)=>{const c=G;return fe(k)?(L(),M(c,{key:0,class:"draggable-button",style:va({top:`${n.value.y}px`,left:`${n.value.x}px`}),onMousedown:S,onTouchstart:S,variant:"dashed",theme:"primary",onClick:h},{default:a(()=>[x(E(fe(v)?"显示":"隐藏"),1)]),_:1},8,["style"])):le("",!0)}}}),bu=ie(gu,[["__scopeId","data-v-1aee5506"]]),ht="DidaOJ",hu=ue({__name:"App",setup(e){const{globalProperties:l}=pe(),n=qa(),u=qe(),o=Je(),b=Pt();n.$patch({Loaded:!1});const f=u.getToken,S=m(!1),d=m(!1);o.title&&o.title.length>0?document.title=o.title+" - "+ht:document.title=ht,o.$subscribe((k,h)=>{h.title&&h.title.length>0?document.title=h.title+" - "+ht:document.title=ht}),b.$subscribe((k,h)=>{S.value=h.showSidebar,d.value=S.value&&!h.forceHiddenSidebar});const s=Ce(),T=Oe(()=>{const k=s.meta.auths;return k?!u.hasAllAuths(k):!1});function v(){l.$message.warning({duration:3e3,content:"登陆状态失效"}),n.$patch({Loaded:!0}),u.clear()}return ce(()=>{document.addEventListener("DOMContentLoaded",()=>{sl.autoSpacingPage()}),f?$n().then(k=>{k.code==0?(u.loadResponse(k.data),n.$patch({Loaded:!0})):(F(l,k.code),n.$patch({Loaded:!0}),u.clear())}).catch(k=>{console.log(k),v()}):n.$patch({Loaded:!0})}),(k,h)=>{const _=jl,i=$l,p=Ae("RouterView"),g=zl,C=Ul,c=Al;return L(),te(de,null,[t(C,{class:"sh-app-layout"},{default:a(()=>[t(_,{class:"sh-header"},{default:a(()=>[t(Zr)]),_:1}),t(C,null,{default:a(()=>[t(rl,{name:"slide"},{default:a(()=>[d.value?(L(),M(i,{key:0,class:"sh-sidebar"},{default:a(()=>[t(tu)]),_:1})):le("",!0)]),_:1}),t(C,{class:Rt(["sh-main-layout",{expanded:!d.value}])},{default:a(()=>[t(nu),t(g,{class:"sh-main-content"},{default:a(()=>[T.value?(L(),M(Ea,{key:0})):(L(),M(p,{key:1}))]),_:1}),t(_u)]),_:1},8,["class"])]),_:1})]),_:1}),S.value?(L(),M(bu,{key:0})):le("",!0),t(c,{container:"body",offset:["24px","80px"],size:"small"})],64)}}}),yu=ie(hu,[["__scopeId","data-v-0d3686fd"]]);function wu(e,l={}){const n=/\{\{%\s*(\w+)\s+([^%]+?)\s*%\}\}/g,u=l.renderers||{},o=e.renderer.rules.text??function(b,f){return b[f].content};e.renderer.rules.text=function(b,f,S,d,s){const v=b[f].content;return n.test(v)?v.replace(n,(h,_,i)=>{const p=u[_];if(typeof p=="function"){const g=i.trim().split(/\s+/);return p(g)}else return`<span class="shortcode-${_}">${_}: ${i.trim()}</span>`}):o(b,f,S,d,s)}}El({markdownItConfig(e){e.use(ml,"align-right",{render(l,n){return l[n].nesting===1?`<div class="sh-align-right">
`:`</div>
`}}),e.use(wu,{renderers:{problem:([l])=>`<a href="/problem/${l}" target="_blank" class="sh-problem-tag t-tag t-tag--default t-tag--dark" data-id="${l}">${l}</a>`}})},markdownItPlugins(e){return[...e,{type:"linkAttr",plugin:cl,options:{matcher(l){return!l.startsWith("#")},attrs:{target:"_blank"}}}]}});const Ka=ul();Ka.use(il);const it=dl(yu);it.use(Ka);it.use(X);it.use(Rl);it.use(ql);it.use(Kl);it.mount("#app");Fl().then(()=>{console.log("Text cache reinitialized")}).catch(e=>{console.error("Text cache reinitialization failed",e)});
