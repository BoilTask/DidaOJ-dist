import{ct as pt,d as de,a as m,o as fe,cu as M,cv as D,cw as a,e as t,cx as A,cy as q,bE as x,cz as _a,aM as Na,cA as Re,cB as le,cC as ae,F as pe,cD as Pe,cE as Ha,cF as Se,bS as ve,cG as Ba,cH as Wa,cI as Ja,b as De,v as mt,cJ as Ya,cK as Xe,j as Be,w as $e,a9 as tt,bc as Xa,bd as Za,cL as Qa,cM as el,cN as tl,br as al,cO as Dt,cP as ga,cQ as ba,cj as ll,cR as nl,cS as ol,cT as sl,bX as rl,cU as Zt,cV as Et,cW as il,bf as ul,aY as ha,z as dl,cX as cl,cY as ml,cZ as pl,c_ as jt}from"./node_modules-DOFHNO3z.js";import{L as Ve,C as he,R as Ie,a as Te,A as Ct,S as fl,b as vl,c as _l,d as gl,e as bl,f as lt,T as et,B as G,F as Ue,g as ze,I as Ae,D as nt,h as ya,i as we,j as We,k as Je,l as hl,m as Ee,n as ft,o as vt,P as qt,O as Kt,p as Ft,q as yl,r as wa,s as wl,t as kl,u as ka,v as Sa,w as It,x as Sl,y as Cl,z as Il,E as Pl,G as xl,H as Tl,J as Vl,M as Ca,K as Ia,N as Dl,Q as jl,U as Ll,V as $l,W as Ul,X as zl,Y as Al,Z as Rl,_ as El,$ as Ml}from"./tdesign-vue-next-C58KpEaq.js";import{u as _e,S as ge,a as ke,b as O,G as Ne,H as ut,c as Ke,d as ql,e as Pa,f as Kl,g as Fl,h as Ol,E as Gl,M as Nl,R as Hl}from"./md-editor-v3-DcBrwSpW.js";import{e as Qt}from"./monaco-editor-ouHSYV7a.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const y of o)if(y.type==="childList")for(const v of y.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&i(v)}).observe(document,{childList:!0,subtree:!0});function n(o){const y={};return o.integrity&&(y.integrity=o.integrity),o.referrerPolicy&&(y.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?y.credentials="include":o.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function i(o){if(o.ep)return;o.ep=!0;const y=n(o);fetch(o.href,y)}})();var Le=(e=>(e.ManageWeb="i-manage-web",e.ManageJudge="i-manage-judge",e.ManageProblem="i-manage-problem",e.ManageProblemDaily="i-manage-problem-daily",e.ManageContest="i-manage-contest",e.ManageCollection="i-manage-collection",e.ManageDiscuss="i-manage-discuss",e))(Le||{});const Bl={"r-admin":["i-manage-web","i-manage-judge","i-manage-problem","i-manage-problem-daily","i-manage-contest","i-manage-collection","i-manage-discuss"]};function Wl(e){if(e==null)return[];const l=[];for(const n of e){const i=Bl[n];i!=null&&l.push(...i)}return[...new Set(l)]}function Jl(e,l){if(e==null||l==null)return!1;const n=Wl(e);for(const i of l)if(!n.includes(i))return!1;return!0}const Fe=pt("user",{state:()=>({token:"",userId:-1,username:"",nickname:"",roles:[]}),getters:{getToken(){return this.token},getUserId(){return this.userId},getUsername(){return this.username},getNickname(){return this.nickname}},actions:{clear(){this.$patch({token:"",userId:-1,username:"",nickname:"",roles:[]})},loadResponse(e){this.$patch({token:e.token,userId:e.user_id,username:e.username,nickname:e.nickname,roles:e.roles})},isLogin(){return this.token!=null&&this.token!=""},hasAuth(e){return this.hasAllAuths([e])},hasAllAuths(e){return e?Jl(this.roles,e):!0}},persist:!0}),Ze=pt("webStyle",{state:()=>({title:""}),getters:{getTitle(){return this.title}},actions:{setTitle(e){this.title=e}}}),Pt=pt("sidebarStyle",{state:()=>({showSidebar:!1,forceHiddenSidebar:!1,menuActiveName:"",menuList:[]}),getters:{getMenuList(){return this.menuList}},actions:{setSidebarShow(e){this.showSidebar=e},setForceHiddenSidebar(e){this.forceHiddenSidebar=e},setMenuActiveName(e){this.menuActiveName=e},clearMenuList(){this.menuList=[]},setMenuList(e){this.menuList=e},addMenuList(e){this.menuList.push(e)}}}),Yl={style:{"text-align":"right"}},Xl=de({__name:"Hitokoto",setup(e){const l=m(!1),n=m(""),i=m(""),o=m(""),y=async()=>{l.value=!0;try{const S=await(await fetch("https://v1.hitokoto.cn")).json();i.value=S.hitokoto,o.value=S.creator,n.value="—— "+S.from}catch(v){i.value="一言获取失败了，但至少您还可以访问本站。",o.value="BoilTask",n.value="DidaOJ",console.error("Error fetching Hitokoto:",v)}finally{l.value=!1}};return fe(()=>{y()}),(v,S)=>{const f=he,s=Ve;return D(),M(s,{loading:l.value},{default:a(()=>[t(f,{title:"一言 © Hitokoto"},{actions:a(()=>[x(" @"+q(o.value),1)]),default:a(()=>[A("div",null,[A("span",null,q(i.value),1),A("p",Yl,q(n.value),1)])]),_:1})]),_:1},8,["loading"])}}}),Zl="https://oj-api.didapipa.com/",N=_a.create({baseURL:Zl,timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});N.interceptors.request.use(e=>{const n=Fe().getToken;return n&&(e.headers["X-Token"]=n),e},e=>Promise.reject(e));N.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});const xt=_a.create({timeout:6e4,withCredentials:!1,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});xt.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function xa(){return xt({baseURL:"https://r2-oj.didapipa.com",url:"/system/notification.json?"+Date.now(),method:"get"})}function Ta(){return xt({baseURL:"https://r2-oj.didapipa.com",url:"/system/announcement.json?"+Date.now(),method:"get"})}function Ql(){return N({url:"/system/status",method:"get"})}function en(){return N({url:"/system/image/token",method:"get"})}function tn(e,l){return N({url:"/system/notification",method:"post",data:{theme:e,content:l}})}function an(e,l){return N({url:"/system/announcement",method:"post",data:{title:e,content:l}})}var Tt=(e=>(e[e.Unknown=-1]="Unknown",e[e.C=0]="C",e[e.Cpp=1]="Cpp",e[e.Java=2]="Java",e[e.Python=3]="Python",e[e.Pascal=4]="Pascal",e[e.Golang=5]="Golang",e[e.Lua=6]="Lua",e[e.TypeScript=7]="TypeScript",e[e.Max=8]="Max",e))(Tt||{});function Ot(){const e=[-1,8];return Object.values(Tt).filter(l=>typeof l=="number"&&!e.includes(l)).map(l=>({value:l,label:kt(l)}))}function yt(e){return e>-1&&e<8}function kt(e){switch(e){case 0:return"C";case 1:return"C++";case 2:return"Java";case 3:return"Python";case 4:return"Pascal";case 5:return"Golang";case 6:return"Lua";case 7:return"TypeScript";default:return"未知"}}function Gt(e){switch(e){case 0:return"c";case 1:return"cpp";case 2:return"java";case 3:return"python";case 4:return"pascal";case 5:return"go";case 6:return"lua";case 7:return"typescript";default:return"text"}}var He=(e=>(e[e.Init=0]="Init",e[e.Rejudge=1]="Rejudge",e[e.Submitting=2]="Submitting",e[e.Queuing=3]="Queuing",e[e.Compiling=4]="Compiling",e[e.Running=5]="Running",e[e.Accept=6]="Accept",e[e.PE=7]="PE",e[e.WA=8]="WA",e[e.TLE=9]="TLE",e[e.MLE=10]="MLE",e[e.OLE=11]="OLE",e[e.RE=12]="RE",e[e.CE=13]="CE",e[e.CLE=14]="CLE",e[e.JudgeFail=15]="JudgeFail",e[e.SubmitFail=16]="SubmitFail",e[e.Unknown=17]="Unknown",e[e.Max=18]="Max",e))(He||{});const ln=e=>{switch(e){case 0:return"普通评测";case 1:return"特殊评测";default:return"未知"}},St=e=>{switch(e){case 0:return"等待处理";case 1:return"重新评测";case 2:return"提交中";case 3:return"队列中";case 4:return"编译中";case 5:return"运行中";case 6:return"通过";case 7:return"格式错误";case 8:return"答案错误";case 9:return"超时";case 10:return"内存超限";case 11:return"输出超限";case 12:return"运行错误";case 13:return"编译错误";case 14:return"编译超限";case 15:return"评测失败";case 16:return"提交失败";case 17:return"未知";default:return e}},ea=e=>{if(e!==void 0)switch(e){case 0:return"已经提交到系统，请耐心等待评测结果";case 1:return"管理员发起了重新评测，请耐心等待评测结果";case 2:return"判题机已经接受了本次提交，正在提交到远程判官中";case 3:return"判题机已经接受了本次提交，正在排队等待评测";case 4:return"判题机正在编译您的代码，部分语言会在此步检查是否符合语法";case 5:return"您的代码正在运行，请等待运行结果";case 6:return"您的代码通过了测试用例，恭喜您！";case 7:return"您的代码基本正确，但可能存在空格、空行等格式错误，请认真对比输出要求";case 8:return"您的答案与标准答案存在区别，请继续思考有无未考虑的情况";case 9:return"运行您的代码所用的时间超过了题目限制，请思考时间上更优的解法";case 10:return"运行您的代码所用的内存超过了题目限制，请思考空间上更优的解法";case 11:return"您程序的输出内容远远多于了题目要求（一般是数倍于正确输出），请检查相关逻辑";case 12:return"在运行您程序的过程中发生了异常，可能是除零、数组越界等问题，请检查相关逻辑";case 13:return"您的代码在编译阶段发生了错误，可能是语法错误或其他编译问题，请检查相关逻辑";case 14:return"在编译您代码的过程中，所占用的资源远远超过了要求，请检查相关逻辑";case 15:return"评测过程中发生了异常，一般是判题机或远程判官的问题，可尝试联系管理员处理";case 16:return"在将您的代码提交到远程判官的过程中发生了错误，一般是判题机或远程判官的问题，可联系管理员处理";case 17:return"您的代码状态未知，有可能是您不具有权限，或者该代码状态被隐藏"}return"暂时无提示信息"},Va=e=>{switch(e){case 0:case 1:case 2:case 3:case 4:case 5:case 17:return"default";case 6:return"success";case 7:return"warning";default:return"danger"}};function Da(){const e=[17,18];return Object.values(He).filter(l=>typeof l=="number"&&!e.includes(l)).map(l=>({value:l,label:St(l)}))}function wt(e){return e>=0&&e<17}function it(e){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return!0;default:return!1}}function ja(e){var n;const l={};if(l.id=e.id,l.problemId=e.problem_id,l.contestProblemIndex=e.contest_problem_index,l.status=e.status,it(e.status)||!wt(e.status)?l.score="-":l.score=(e.score/10).toString(),e.time?l.time=Math.ceil(e.time/1e6)+"ms":l.time="-",e.memory?l.memory=(e.memory/1024/1024).toFixed(2)+"MB":l.memory="-",l.language=e.language,l.codeLength=e.code_length,e.approve_time?l.approveTime=new Date(e.approve_time).toLocaleString():l.approveTime="-",l.author=e.author,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.code=e.code,l.compileMessage=e.compile_message,l.taskCurrent=e.task_current,l.taskTotal=e.task_total,l.task=[],e.task)for(let i=0;i<((n=e.task)==null?void 0:n.length);i++){const o=e.task[i],y={};y.taskId=o.task_id,y.status=o.status,o.time?y.time=Math.ceil(o.time/1e6)+"ms":y.time="-",o.memory?y.memory=(o.memory/1024/1024).toFixed(2)+"MB":y.memory="-",o.score?y.score=(o.score/10).toString():y.score="-",y.content=o.content,y.waHint=o.wa_hint,l.task.push(y)}return e.judger&&(l.judger=e.judger),e.judger_name?l.judgerName=e.judger_name:l.judgerName="-",e.judge_time&&(l.judgeTime=new Date(e.judge_time).toLocaleString()),l}function nn(e,l,n,i,o){return N({url:"/judge/approve",method:"post",data:{problem_id:e,contest_id:l,problem_index:n,language:i,code:o}})}function on(e){return N({url:"/judge?id="+e,method:"get"})}function sn(e){return N({url:"/judge/code?id="+e,method:"get"})}function rn(e,l,n,i,o,y,v){let S={problem_id:l,username:n,language:String(i),status:String(o),page:String(y),page_size:String(v)};return e&&(S.contest_id=String(e)),N({url:`/judge/list?${new URLSearchParams(S).toString()}`,method:"get"})}function un(){return N({url:"/judge/statics/recently",method:"get"})}function dn(){return N({url:"/judge/rejudge/recently",method:"post"})}function cn(e,l,n){const i={};return e!=null&&(i.problem_id=e),l!=null?i.language=l:i.language=Tt.Unknown,n!=null?i.status=n:i.status=18,N({url:"/judge/rejudge/search",method:"post",data:i})}function mn(){return N({url:"/judge/rejudge/all",method:"post",timeout:0})}function pn(e){return N({url:"/judge/rejudge",method:"post",data:{id:Number(e)}})}var Oe=(e=>(e[e.None=0]="None",e[e.Attempt=1]="Attempt",e[e.Accept=2]="Accept",e))(Oe||{});function _t(e,l){const n={};if(n.id=e.id,n.author=e.author,n.title=e.title,n.tags=[],e.tags)for(const i of e.tags){const o=l[i];o&&n.tags.push(o)}if(n.private=e.private,n.accept=e.accept,n.attempt=e.attempt,e.description!=null&&(n.description=e.description),e.time_limit!=null&&e.time_limit>=0?n.timeLimit=e.time_limit.toString()+" ms":n.timeLimit="未知",e.memory_limit!=null&&e.memory_limit>=0?n.memoryLimit=(e.memory_limit/1024).toFixed(2)+" MB":n.memoryLimit="未知",e.judge_type!=null&&(n.judgeType=ln(e.judge_type)),e.insert_time!=null&&(n.insertTime=new Date(e.insert_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.source!=null){const i=/\[([^\]]+)\]\(([^)]+)\)/,o=e.source.match(i);o?(n.source=o[1],n.sourceUrl=o[2]):(n.source=e.source,n.sourceUrl="")}return e.judge_md5!=null&&(n.judgeMd5=e.judge_md5),e.origin_oj!=null&&(n.originOj=e.origin_oj),e.origin_id!=null&&(n.originId=e.origin_id),e.origin_url!=null&&(n.originUrl=e.origin_url),n}function La(e,l){const n={};if(n.id=e.id,n.problemId=e.problem_id,n.title=e.title,n.tags=[],e.tags)for(const i of e.tags){const o=l[i];o&&n.tags.push(o)}return e.accept?n.accept=e.accept:n.accept=0,e.attempt?n.attempt=e.attempt:n.attempt=0,n.solution=e.solution,n.code=e.code,e.create_time!=null&&(n.createTime=new Date(e.create_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.updater_nickname!=null&&(n.updaterNickname=e.updater_nickname),n}function $a(e,l,n){const i={};return e?i.id=e:(i.contest_id=l,i.problem_index=n),N({url:`/problem?${new URLSearchParams(i).toString()}`,method:"get"})}function Ua(e){return N({url:"/problem/tag/list?max_count="+e,method:"get"})}function fn(e){return N({url:"/problem/judge?id="+e,method:"get"})}function vn(e,l,n,i,o,y){const v={};return e&&(v.oj=e),l&&(v.title=l),n&&(v.tag=n),i!==void 0&&(v.private=i?"1":"0"),o&&(v.page=o),y&&(v.page_size=y),N({url:`/problem/list?${new URLSearchParams(v).toString()}`,method:"get"})}function _n(e){const l={};return e&&(l.problem_id=e),N({url:`/problem/recommend?${new URLSearchParams(l).toString()}`,method:"get"})}function gn(e){return N({url:"/problem/daily?id="+e,method:"get"})}function bn(e){return N({url:"/problem/daily/edit?id="+e,method:"get"})}function hn(){return N({url:"/problem/daily/recently",method:"get"})}function yn(e,l,n,i,o){const y={};return e&&(y.start_date=e),l&&(y.end_date=l),n&&(y.problem_id=n),i&&(y.page=i),o&&(y.page_size=o),N({url:`/problem/daily/list?${new URLSearchParams(y).toString()}`,method:"get"})}function wn(e){return N({url:"/problem/attempt/status",method:"get",params:{ids:e.join(",")}})}function za(e,l){return N({url:"/problem/crawl",method:"post",data:{oj:e,id:l}})}function kn(e,l,n,i,o,y,v){return N({url:"/problem/create",method:"post",data:{title:e,time_limit:l,memory_limit:n,source:i,private:o,tags:y,description:v}})}function Sn(e,l,n,i,o,y,v,S){return N({url:"/problem/edit",method:"post",data:{id:e,title:l,time_limit:n,memory_limit:i,source:o,private:y,tags:v,description:S}})}function Cn(e,l,n,i){return N({url:"/problem/daily/create",method:"post",data:{id:e,problem_id:l,solution:n,code:i}})}function In(e,l,n,i){return N({url:"/problem/daily/edit",method:"post",data:{id:e,problem_id:l,solution:n,code:i}})}function Pn(e,l){return N({url:"/problem/judge/data/download?id="+e+"&key="+l,method:"get"})}function xn(e){return e||(e=""),N({url:"/problem/image/token?id="+e,method:"get"})}function Tn(e){return e||(e=""),N({url:"/problem/daily/image/token?id="+e,method:"get"})}function Vn(e,l){const n=new FormData;return n.append("id",e),n.append("zip",l),N({url:"/problem/judge/data",method:"post",data:n,headers:{"Content-Type":"multipart/form-data"},timeout:1e3*60*5})}function Dn(e){return N({url:"/problem/parse",method:"post",data:{problems:e}})}const jn={class:"sh-main"},Ln={class:"dida-swiper-div"},$n=de({__name:"HomeView",setup(e){const{globalProperties:l}=_e();let n=-1;const i=m({theme:"info",content:""}),o=m({title:"",content:""}),y=m([]),v=m(!1),S=m(!1),f=m(!1),s=async()=>{i.value=await xa()},$=async()=>{try{const _=await Ta();o.value.title=_.title,o.value.content=_.content}catch{ge(l,"加载公告失败"),o.value={title:"公告加载失败",content:"请刷新页面重新获取"}}},p=async()=>{const _=await un();if(_.code!==0){ge(l,"加载OJ统计数据失败");return}let g=[];for(const d of _.data){const w=new Date(d.date),c=`${w.getMonth()+1}-${w.getDate()}`;g.push({Date:c,Type:"Unaccept",Count:d.attempt-d.accept}),g.push({Date:c,Type:"Accept",Count:d.accept})}const h={type:"bar",data:[{id:"barData",values:g}],xField:"Date",yField:"Count",seriesField:"Type",stack:!0,legends:{visible:!0},bar:{state:{hover:{stroke:"#000",lineWidth:1}}},height:300};new Ha(h,{dom:"ojStaticsDiv"}).renderSync()},C=async()=>{y.value=[];const _=await hn();if(_.code!==0){ge(l,"加载每日问题数据失败");return}_.data.list&&_.data.list.length>0&&_.data.list.forEach(g=>{let h="default",u="未尝试";if(_.data.attempt_status){const w=_.data.attempt_status[g.problem_id];if(w)switch(w){case Oe.Accept:h="success",u="已解决";break;case Oe.Attempt:h="warning",u="待解决";break;default:h="default",u="未尝试"}}const d=`${g.title}`;y.value.push({id:g.id,title:d,problemId:g.problem_id,theme:h,tag:u})})};return fe(async()=>{f.value=!0,v.value=!0,S.value=!0,(async()=>(await s(),n=setInterval(()=>{s()},3e4),await $(),f.value=!1))(),(async()=>(await p(),v.value=!1))(),(async()=>(await C(),S.value=!1))()}),Na(()=>{clearInterval(n)}),(_,g)=>{const h=Ct,u=vl,d=fl,w=Ve,c=Re("md-preview"),r=he,j=Te,b=lt,k=bl,U=et,I=gl,T=_l,R=Ie;return D(),M(w,{loading:f.value},{default:a(()=>[t(R,null,{default:a(()=>[t(j,{span:8},{default:a(()=>{var z;return[A("div",jn,[i.value?(D(),M(h,{key:0,class:"dida-notification-div",theme:i.value.theme},{default:a(()=>[x(q(i.value.content),1)]),_:1},8,["theme"])):le("",!0),A("div",Ln,[t(d,{class:"dida-swiper"},{default:a(()=>[t(u,null,{default:a(()=>g[1]||(g[1]=[A("a",{href:"http://codeoj.cn",target:"_blank"},[A("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"})],-1)])),_:1}),t(u,null,{default:a(()=>g[2]||(g[2]=[A("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1})]),_:1})]),t(w,{loading:v.value&&!f.value},{default:a(()=>g[3]||(g[3]=[A("div",{id:"ojStaticsDiv",style:{"min-height":"200px"}},null,-1)])),_:1},8,["loading"]),t(r,{title:(z=o.value)==null?void 0:z.title,style:{width:"calc(100% - 100px)",margin:"0 auto"}},{default:a(()=>{var V;return[t(c,{"model-value":(V=o.value)==null?void 0:V.content,previewTheme:"cyanosis"},null,8,["model-value"])]}),_:1},8,["title"])])]}),_:1}),t(j,{span:4},{default:a(()=>[t(r,{style:{margin:"10px"},bordered:!0},{default:a(()=>g[4]||(g[4]=[A("img",{src:"https://api.jysafe.cn/ip/",alt:"Welcome",style:{width:"100%"}},null,-1)])),_:1}),t(Xl,{style:{margin:"10px"}}),t(r,{style:{margin:"10px"},bordered:!0,title:"每日一题"},{actions:a(()=>[t(b,{onClick:g[0]||(g[0]=z=>_.$router.push({name:"problem-daily-list"}))},{default:a(()=>g[5]||(g[5]=[x("查看全部")])),_:1})]),default:a(()=>[t(w,{loading:S.value&&!f.value},{default:a(()=>[t(T,{split:!0,size:"small",style:{"min-height":"200px"}},{default:a(()=>[(D(!0),ae(pe,null,Pe(y.value,z=>(D(),M(I,{key:z.id},{default:a(()=>[t(k,{style:{width:"100px"}},{description:a(()=>[t(b,{onClick:V=>_.$router.push({name:"problem-daily-detail",params:{dailyId:z.id}})},{default:a(()=>[x(q(z.problemId),1)]),_:2},1032,["onClick"])]),_:2},1024),t(k,{style:{width:"200px"}},{description:a(()=>[t(b,{onClick:V=>_.$router.push({name:"problem-daily-detail",params:{dailyId:z.id}})},{default:a(()=>[x(q(z.title),1)]),_:2},1032,["onClick"])]),_:2},1024),t(k,{style:{width:"135px"},description:z.id},null,8,["description"]),t(k,null,{description:a(()=>[t(U,{theme:z.theme},{default:a(()=>[x(q(z.tag),1)]),_:2},1032,["theme"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["loading"])]),_:1}),t(r,{style:{margin:"10px"},bordered:!0},{header:a(()=>g[6]||(g[6]=[A("b",null,"友情链接",-1)])),default:a(()=>[t(T,null,{default:a(()=>[t(I,null,{default:a(()=>[t(b,{href:"https://boiltask.com",target:"_blank"},{default:a(()=>g[7]||(g[7]=[x("BoilTask Blog")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])}}}),ce=(e,l)=>{const n=e.__vccOpts||e;for(const[i,o]of l)n[i]=o;return n},Un=ce($n,[["__scopeId","data-v-df433117"]]),zn={class:"sh-main"},An=de({__name:"View404",setup(e){let l=Se(),n=m(l.fullPath);return(i,o)=>{const y=G;return D(),ae("div",zn,[A("p",null,q(ve(n)),1),o[2]||(o[2]=A("p",null,"该页面无效或已被迁移，请重新选择访问目标",-1)),t(y,{theme:"primary",onClick:o[0]||(o[0]=()=>i.$router.push("/"))},{default:a(()=>o[1]||(o[1]=[x("返回首页")])),_:1})])}}}),Aa=ce(An,[["__scopeId","data-v-d4218944"]]);function Rn(e){const l={};return l.id=e.id,l.username=e.username,l.nickname=e.nickname,l.email=e.email,l.slogan=e.slogan,l.organization=e.organization,l.accept=e.accept,l.attempt=e.attempt,l.vjudgeId=e.vjudge_id,e.email&&(l.avatar=`https://www.gravatar.com/avatar/${Ba(e.email.toLowerCase().trim())}?d=identicon&s=100`),l}function En(e,l){return N({url:"/user/login",method:"post",data:{username:e,password:l}})}function Mn(){return N({url:"/user/login/refresh",method:"post"})}function qn(e){const l={username:e};return N({url:`/user/info?${new URLSearchParams(l).toString()}`,method:"get"})}function Kn(e){const l="https://vjudge.net/user/solveDetail/"+encodeURIComponent(e);return xt({url:l,method:"get"})}function Fn(e){return N({url:"/user/account/infos",method:"post",data:{users:e}})}function On(e){return N({url:"/user/parse",method:"post",data:{users:e}})}function Gn(e,l){return N({url:"/user/register/email",method:"post",data:{token:e,email:l}})}function Nn(e,l,n,i,o){return N({url:"/user/register",method:"post",data:{username:e,password:l,email:n,key:i,nickname:o}})}function Hn(e,l){return N({url:"/user/forget",method:"post",data:{token:e,username:l}})}function Bn(e,l,n){return N({url:"/user/password/modify",method:"post",data:{username:e,password:l,key:n}})}const Wn={class:"dida-login-footer"},Jn=de({__name:"LoginView",setup(e){const{globalProperties:l}=_e(),n=Fe(),i=m(!1),o=m({username:"",password:""}),y=()=>{ke(l,"重置成功")},v=({validateResult:S,firstError:f})=>{i.value||(i.value=!0,En(o.value.username,o.value.password).then(s=>{if(s.code===0){n.loadResponse(s.data),ke(l,"登录成功");let $=l.$route.query.redirect_uri;$||($="/user/"+s.data.username),l.$router.push({path:$})}else O(l,s.code)}).catch(s=>{console.error("Login error",s),ge(l,"登录失败")}).finally(()=>{i.value=!1}))};return fe(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),(S,f)=>{const s=Ae,$=ze,p=G,C=Ue,_=lt,g=he;return D(),M(g,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(C,{ref:"form",data:o.value,colon:!0,onReset:y,onSubmit:v,class:"yj-login-form","label-width":0},{default:a(()=>[t($,{name:"username"},{default:a(()=>[t(s,{modelValue:o.value.username,"onUpdate:modelValue":f[0]||(f[0]=h=>o.value.username=h),clearable:"",autocomplete:"username",placeholder:"请输入用户名"},{"prefix-icon":a(()=>[t(ve(Wa))]),_:1},8,["modelValue"])]),_:1}),t($,{name:"password"},{default:a(()=>[t(s,{modelValue:o.value.password,"onUpdate:modelValue":f[1]||(f[1]=h=>o.value.password=h),type:"password",autocomplete:"current-password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":a(()=>[t(ve(Ja))]),_:1},8,["modelValue"])]),_:1}),t($,null,{default:a(()=>[t(p,{theme:"primary",type:"submit",block:"",loading:i.value},{default:a(()=>f[4]||(f[4]=[x("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),A("div",Wn,[t(_,{onClick:f[2]||(f[2]=()=>{ve(l).$router.push({name:"login-forget"})})},{default:a(()=>f[5]||(f[5]=[x("忘记密码 ")])),_:1}),t(_,{onClick:f[3]||(f[3]=()=>{ve(l).$router.push({name:"register"})})},{default:a(()=>f[6]||(f[6]=[x("注册账户 ")])),_:1})])]),_:1})}}}),Yn=ce(Jn,[["__scopeId","data-v-0466c42d"]]),Xn={class:"dida-login-footer"},Zn=de({__name:"RegisterView",setup(e){const{globalProperties:l}=_e(),n=Fe(),i=m(!1),o=m(!1),y=m(!1),v=m("发送验证码");let S=null,f=-1;const s=m(!1),$=m(null),p=m({username:"",password:"",confirmPassword:"",nickname:"",email:"",emailKey:""}),_=m({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:c=>new Promise(r=>{const j=setTimeout(()=>{r(p.value.password===c),clearTimeout(j)})}),message:"两次密码不一致"}],nickname:[{required:!0,message:"请填写昵称"},{min:1,message:"昵称至少1个字符"},{max:30,message:"昵称最多30个字符"}],email:[{required:!0,message:"请填写邮箱"},{pattern:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"邮箱格式不正确"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),g=m(()=>t(G,{onClick:h,disabled:y.value,loading:o.value,style:"width:120px"},{default:()=>[v.value]})),h=async()=>{var b;if(!p.value.email){ge(l,"请输入邮箱");return}if(!p.value.email.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)){ge(l,"邮箱格式不正确");return}if(y.value||o.value)return;s.value=!0,await mt();const c=document.getElementById("cf-confirm-div");c&&c.remove();const r=document.createElement("div");r.id="cf-confirm-div",r.setAttribute("data-theme","light"),(b=$.value)==null||b.appendChild(r);const j=window;j.turnstile.ready(function(){j.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(k){s.value=!1,await u(k)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},u=async c=>{if(!y.value){o.value=!0;try{const r=await Gn(c,p.value.email);if(r.code!==0){O(l,r.code);return}ke(l,"发送验证码成功"),o.value=!1,y.value=!0,S=new Date,v.value="60秒后重发",f=setInterval(()=>{const b=Math.floor((new Date().getTime()-(S==null?void 0:S.getTime()))/1e3);b>60?(v.value="发送验证码",y.value=!1,clearInterval(f)):v.value=`${60-b}秒后重发`},1e3)}catch{ge(l,"发送验证码失败")}finally{o.value=!1}}},d=()=>{ke(l,"重置成功")},w=({validateResult:c,firstError:r,e:j})=>{if(!i.value){if(j.preventDefault(),c!==!0){ge(l,r);return}if(p.value.password!==p.value.confirmPassword){ge(l,"两次密码不一致");return}i.value=!0,Nn(p.value.username,p.value.password,p.value.email,p.value.emailKey,p.value.nickname).then(b=>{b.code===0?(ke(l,"注册成功，可使用账号信息登录"),l.$router.push({name:"login"})):O(l,b.code)}).catch(b=>{console.error("Login error",b),ge(l,"登录失败")}).finally(()=>{i.value=!1})}};return fe(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),De(()=>{clearInterval(f)}),(c,r)=>{const j=Ae,b=ze,k=ya,U=G,I=Ue,T=lt,R=he,z=nt;return D(),ae(pe,null,[t(R,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(I,{ref:"form",rules:_.value,data:p.value,colon:!0,onReset:d,onSubmit:w,class:"yj-login-form"},{default:a(()=>[t(b,{name:"username",label:"用户名"},{default:a(()=>[t(j,{modelValue:p.value.username,"onUpdate:modelValue":r[0]||(r[0]=V=>p.value.username=V),clearable:"",placeholder:"用于登录与查找"},null,8,["modelValue"])]),_:1}),t(b,{name:"password",label:"密码"},{default:a(()=>[t(j,{modelValue:p.value.password,"onUpdate:modelValue":r[1]||(r[1]=V=>p.value.password=V),type:"password",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(b,{name:"confirmPassword",label:"确认密码"},{default:a(()=>[t(j,{modelValue:p.value.confirmPassword,"onUpdate:modelValue":r[2]||(r[2]=V=>p.value.confirmPassword=V),type:"password",clearable:"",placeholder:"请确认密码"},null,8,["modelValue"])]),_:1}),t(b,{name:"nickname",label:"昵称"},{default:a(()=>[t(j,{modelValue:p.value.nickname,"onUpdate:modelValue":r[3]||(r[3]=V=>p.value.nickname=V),clearable:"",placeholder:"用于优先在网站各处展示"},null,8,["modelValue"])]),_:1}),t(b,{name:"email",label:"邮箱"},{default:a(()=>[t(j,{modelValue:p.value.email,"onUpdate:modelValue":r[4]||(r[4]=V=>p.value.email=V),clearable:"",placeholder:"请填写常用邮箱"},null,8,["modelValue"])]),_:1}),t(b,{name:"emailKey",label:"验证码"},{default:a(()=>[t(k,{append:g.value},{default:a(()=>[t(j,{modelValue:p.value.emailKey,"onUpdate:modelValue":r[5]||(r[5]=V=>p.value.emailKey=V),clearable:"",placeholder:"请输入验证码",style:{width:"140px"}},null,8,["modelValue"])]),_:1},8,["append"])]),_:1}),t(b,null,{default:a(()=>[t(U,{theme:"primary",type:"submit",block:"",loading:i.value},{default:a(()=>r[8]||(r[8]=[x("注册")])),_:1},8,["loading"])]),_:1})]),_:1},8,["rules","data"]),A("div",Xn,[t(T,{onClick:r[6]||(r[6]=()=>{ve(l).$router.push({name:"login"})})},{default:a(()=>r[9]||(r[9]=[x("返回登陆 ")])),_:1})])]),_:1}),t(z,{visible:s.value,"onUpdate:visible":r[7]||(r[7]=V=>s.value=V),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:a(()=>[A("div",{ref_key:"dialogContainer",ref:$,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),Qn=ce(Zn,[["__scopeId","data-v-d25e7538"]]),eo={key:0,style:{margin:"10px"}},to={key:1,style:{margin:"10px"}},ao={style:{margin:"12px"}},lo=de({__name:"UserView",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze();let o="";const y=m(!1),v=m(null),S=m([]),f=m([]),s=m([]),$=async p=>{y.value=!0;try{let C=await qn(p);if(C.code!==0){y.value=!1,O(n,C.code),await X.push({name:"home"});return}if(v.value=Rn(C.data.user),S.value=C.data.problems_ac,i.setTitle(v.value.nickname+" - "+i.getTitle),v.value.vjudgeId){const _=await Kn(v.value.vjudgeId);f.value=_.acRecords;for(const g in f.value)f.value[g].sort((h,u)=>h.length===u.length?h.localeCompare(u):h.length-u.length);s.value=_.failRecords;for(const g in s.value)s.value[g].sort((h,u)=>h.length===u.length?h.localeCompare(u):h.length-u.length)}}catch{ge(n,"获取用户信息失败"),await X.push({name:"home"})}finally{y.value=!1}};return Ya(async(p,C,_)=>{if(Array.isArray(p.params.username)?o=p.params.username[0]:o=p.params.username,!o){await X.push({name:"home"});return}await $(o),_()}),fe(async()=>{if(Array.isArray(l.params.username)?o=l.params.username[0]:o=l.params.username,!o){await X.push({name:"home"});return}await $(o)}),(p,C)=>{const _=G,g=we,h=he,u=lt,d=Je,w=We,c=Te,r=hl,j=Ie,b=Ve;return D(),M(b,{loading:y.value},{default:a(()=>[t(j,{class:"dida-main-content"},{default:a(()=>[t(c,{span:8},{default:a(()=>{var k;return[t(h,{style:{margin:"10px"},title:"AC题目"},{default:a(()=>[t(g,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(D(!0),ae(pe,null,Pe(S.value,U=>(D(),M(_,{key:U,size:"small",onClick:()=>ve(X).push({name:"problem-detail",params:{problemId:U}})},{default:a(()=>[x(q(U),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),(k=v.value)!=null&&k.vjudgeId?(D(),M(h,{key:0,style:{margin:"10px"},title:"vjudge.net"},{actions:a(()=>{var U;return[t(u,{href:"https://vjudge.net/user/"+((U=v.value)==null?void 0:U.vjudgeId),target:"_blank"},{default:a(()=>{var I;return[x("@"+q((I=v.value)==null?void 0:I.vjudgeId),1)]}),_:1},8,["href"])]}),default:a(()=>[f.value&&Object.keys(f.value).length>0?(D(),ae("div",eo,[C[0]||(C[0]=A("div",{style:{margin:"5px"}},[A("span",null,"AC")],-1)),t(w,{layout:"vertical",bordered:!0},{default:a(()=>[(D(!0),ae(pe,null,Pe(f.value,(U,I)=>(D(),M(d,{key:I,label:I},{default:a(()=>[t(g,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(D(!0),ae(pe,null,Pe(U,T=>(D(),M(_,{key:T,size:"small",onClick:()=>ve(X).push({name:"problem-detail",params:{problemId:I+"-"+T}})},{default:a(()=>[x(q(T),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):le("",!0),s.value&&Object.keys(s.value).length>0?(D(),ae("div",to,[C[1]||(C[1]=A("div",{style:{margin:"5px"}},[A("span",null,"Fail")],-1)),t(w,{layout:"vertical",bordered:!0},{default:a(()=>[(D(!0),ae(pe,null,Pe(s.value,(U,I)=>(D(),M(d,{key:I,label:I},{default:a(()=>[t(g,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(D(!0),ae(pe,null,Pe(U,T=>(D(),M(_,{key:T,size:"small",onClick:()=>ve(X).push({name:"problem-detail",params:{problemId:I+"-"+T}})},{default:a(()=>[x(q(T),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):le("",!0)]),_:1})):le("",!0)]}),_:1}),t(c,{span:4},{default:a(()=>[A("div",ao,[t(w,{layout:"vertical",bordered:!0},{default:a(()=>[t(d,{label:"头像"},{default:a(()=>{var k;return[t(r,{shape:"round",size:"100px",image:(k=v.value)==null?void 0:k.avatar,"hide-on-load-failed":!1},null,8,["image"])]}),_:1}),t(d,{label:"昵称"},{default:a(()=>{var k;return[x(q((k=v.value)==null?void 0:k.nickname),1)]}),_:1}),t(d,{label:"Slogan"},{default:a(()=>{var k;return[x(q((k=v.value)==null?void 0:k.slogan),1)]}),_:1}),t(d,{label:"邮箱"},{default:a(()=>{var k;return[x(q((k=v.value)==null?void 0:k.email),1)]}),_:1}),t(d,{label:"组织"},{default:a(()=>{var k;return[x(q((k=v.value)==null?void 0:k.organization),1)]}),_:1}),t(d,{label:"通过数量"},{default:a(()=>{var k;return[x(q((k=v.value)==null?void 0:k.accept),1)]}),_:1}),t(d,{label:"提交数量"},{default:a(()=>{var k;return[x(q((k=v.value)==null?void 0:k.attempt),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),no=ce(lo,[["__scopeId","data-v-6d730b5a"]]),Nt=[{name:"home",path:"/",title:"首页",showSidebar:!1,disableGenerateTab:!0,component:Un},{name:"problem",path:"/problem",title:"题目",icon:"calculation",showSidebar:!0,redirect:"problem-list"},{name:"collection-detail-tab",title:"题集",path:"/collection",showSidebar:!0,disableGenerateTab:!0,redirect:"problem-collection-list"},{name:"judge",path:"/judge",title:"评测",icon:"code",showSidebar:!0,redirect:"judge-list"},{name:"contest",path:"/contest",title:"比赛",icon:"application",showSidebar:!0,redirect:"contest-list"},{name:"contest-detail-tab",title:"比赛",path:"/contest",showSidebar:!0,disableGenerateTab:!0,redirect:"contest-list"},{name:"discuss",title:"讨论",path:"/discuss",icon:"sonic",showSidebar:!0,redirect:"discuss-list"},{name:"discuss-detail-tab",title:"讨论",path:"/discuss",showSidebar:!0,disableGenerateTab:!0,redirect:"discuss-list"},{name:"rank",path:"/rank",title:"排名",icon:"chart-column",showSidebar:!0,redirect:"rank-ac-all"},{name:"system",path:"/system",title:"系统",icon:"dashboard",showSidebar:!0,redirect:"system-status"},{name:"manage",path:"/manage",title:"管理",icon:"command",showSidebar:!0,redirect:"manage-web",auths:[Le.ManageWeb]},{name:"login",path:"/login",title:"登陆",showSidebar:!1,disableGenerateTab:!0,component:Yn},{name:"register",path:"/register",title:"注册",showSidebar:!1,disableGenerateTab:!0,component:Qn},{name:"user",path:"/user/:username+",title:"用户",showSidebar:!1,needLogin:!0,disableGenerateTab:!0,component:no},{name:"404",path:"/404",title:"404",showSidebar:!1,disableGenerateTab:!0,component:Aa}],oo=e=>Nt.find(l=>l.name==e),so=e=>{const l=[];return Nt.forEach(n=>{!n.disableGenerateTab&&e.hasAllAuths(n.auths)&&l.push(n)}),l},ro=e=>{Nt.forEach(l=>{const n={name:l.name,path:l.path,meta:{title:l.title,tab:l.name,showSidebar:l.showSidebar,needLogin:l.needLogin,redirect:l.redirect,tabAuths:l.auths},component:l.component};e.push(n)})};function Ra(e){return e.children!==void 0}function io(e){return e.children!==void 0}const uo={style:{margin:"10px"}},co={key:0,class:"dida-operation-container"};function mo(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const po=de({__name:"ProblemList",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e(),o=Fe();let y=null;const v=m(!1),S={};let f={};const s=m(!1),$=Be(()=>o.hasAuth(Le.ManageProblem)),p=m([{title:"ID",colKey:"id",cell:(P,L)=>{let E=b(L.row.id);return t(G,{variant:"dashed",theme:E,onClick:()=>j(L.row.id)},{default:()=>[L.row.id]})}},{title:"标题",colKey:"title",cell:(P,L)=>t(G,{variant:"text",onClick:()=>j(L.row.id)},{default:()=>[L.row.title]})},{title:"标签",colKey:"tags",cell:(P,L)=>{const E=L.row.tags;if(!E||E.length===0)return"";let H=[];for(let Z=0;Z<E.length;Z++){const Q=E[Z];H.push(t(G,{key:Z,theme:"default",variant:"outline",size:"small",onClick:()=>T(Q)},{default:()=>[Q.name]}))}return t(we,null,mo(H)?H:{default:()=>[H]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),C=m(!1);let _=1,g=50;const h=m({current:_,pageSize:g,defaultCurrent:_,defaultPageSize:g,total:0,pageSizeOptions:[50,100]}),u=m(),d=m(),w=[{label:"DidaOJ",value:"didaoj"},{label:"HDU",value:"hdu"},{label:"POJ",value:"poj"},{label:"NYOJ",value:"nyoj"}],c=m({oj:"",title:"",tag:"",private:!1}),r=m({oj:"",problem:""}),j=P=>{P&&n.push({path:"/problem/"+P})},b=P=>{if(!P||!f)return"default";const L=f[P];if(!L)return"default";switch(L){case Oe.Accept:return"success";case Oe.Attempt:return"warning";default:return"default"}},k=async()=>{await n.push({query:{...l.query,oj:c.value.oj,title:c.value.title,tag:c.value.tag,private:c.value.private?"1":"0",page:1,page_size:h.value.defaultPageSize}})},U=async()=>{c.value.oj="",c.value.title="",c.value.tag="",c.value.private=!1,await n.push({query:{...l.query,oj:"",title:"",tag:"",private:"0",page:1,page_size:h.value.defaultPageSize}})},I=async()=>{try{s.value=!0;const P=await za(r.value.oj,r.value.problem);P.code===0?(ke(i,"搜索成功"),await n.push({name:"problem-detail",params:{problemId:P.data}})):O(i,P.code)}catch(P){console.error(P),O(i,Ne())}finally{s.value=!1}},T=P=>{P&&n.push({query:{...l.query,title:"",tag:P.name,page:1,page_size:h.value.defaultPageSize}})},R=()=>{n.push({name:"manage-problem-create"})},z=async(P,L)=>{C.value=!0;try{const{current:E,pageSize:H}=P,Z=await vn(c.value.oj,c.value.title,c.value.tag,c.value.private,E,H);if(u.value=[],Z.code===0){const Q=Z.data.list;if(!Q||Q.length<=0){h.value={...h.value,total:0},f={},ke(i,"未找到记录");return}Q.forEach(ee=>{var F;const te=_t(ee,S);(F=u.value)==null||F.push(te)}),h.value={...h.value,total:Z.data.total_count},f=Z.data.problem_attempt_status}else L&&O(i,Z.code)}catch(E){console.error(E),O(i,Ne())}finally{C.value=!1}},V=async P=>{await n.push({query:{...l.query,page:P.current,page_size:P.pageSize}})};return fe(async()=>{C.value=!0,d.value=[],Ua(-1).then(P=>{if(P.code===0){d.value=P.data.list,v.value=P.data.total_count>P.data.list.length;for(let L=0;L<P.data.list.length;L++){const E=P.data.list[L];S[E.id]=E}y=$e(()=>l.query,L=>{c.value.oj=L.oj||"",c.value.title=L.title||"",c.value.tag=L.tag||"",c.value.private=L.private==="1";const E=parseInt(L.page)||h.value.defaultCurrent,H=parseInt(L.page_size)||h.value.defaultPageSize;_=E,g=H,h.value={...h.value,current:_,pageSize:g},z({current:_,pageSize:g},!0)},{immediate:!0})}else v.value=!0}).catch(P=>{console.error(P),v.value=!0})}),De(()=>{y&&y()}),(P,L)=>{const E=Ee,H=he,Z=Te,Q=G,ee=we,te=ft,F=ze,me=Ae,ie=vt,W=Ue,J=Ie;return D(),M(J,null,{default:a(()=>[t(Z,{span:9},{default:a(()=>[t(H,{style:{margin:"10px"}},{default:a(()=>[t(E,{data:u.value,columns:p.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:h.value,"table-layout":"auto",loading:C.value,onPageChange:V},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(Z,{span:3},{default:a(()=>[A("div",uo,[$.value?(D(),ae("div",co,[t(ee,null,{default:a(()=>[t(Q,{onClick:R},{default:a(()=>L[7]||(L[7]=[x("新建")])),_:1})]),_:1})])):le("",!0),t(H,{class:"sh-card"},{default:a(()=>[t(W,{model:c.value,onSubmit:k,onReset:U},{default:a(()=>[t(F,{label:"OJ"},{default:a(()=>[t(te,{modelValue:c.value.oj,"onUpdate:modelValue":L[0]||(L[0]=ne=>c.value.oj=ne),options:w,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(F,{label:"标题"},{default:a(()=>[t(me,{modelValue:c.value.title,"onUpdate:modelValue":L[1]||(L[1]=ne=>c.value.title=ne),placeholder:"请输入关键词"},null,8,["modelValue"])]),_:1}),t(F,{label:"标签"},{default:a(()=>[t(me,{modelValue:c.value.tag,"onUpdate:modelValue":L[2]||(L[2]=ne=>c.value.tag=ne),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),$.value?(D(),M(F,{key:0,label:"私有"},{default:a(()=>[t(ie,{modelValue:c.value.private,"onUpdate:modelValue":L[3]||(L[3]=ne=>c.value.private=ne)},null,8,["modelValue"])]),_:1})):le("",!0),t(F,null,{default:a(()=>[t(ee,null,{default:a(()=>[t(Q,{theme:"primary",type:"submit"},{default:a(()=>L[8]||(L[8]=[x("搜索")])),_:1}),t(Q,{theme:"danger",type:"reset"},{default:a(()=>L[9]||(L[9]=[x("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(H,{class:"sh-card"},{default:a(()=>[t(W,{model:r.value,onSubmit:I},{default:a(()=>[t(F,{label:"OJ"},{default:a(()=>[t(te,{modelValue:r.value.oj,"onUpdate:modelValue":L[4]||(L[4]=ne=>r.value.oj=ne),options:w,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(F,{label:"题目"},{default:a(()=>[t(me,{modelValue:r.value.problem,"onUpdate:modelValue":L[5]||(L[5]=ne=>r.value.problem=ne),placeholder:"请输入原始题号"},null,8,["modelValue"])]),_:1}),t(F,null,{default:a(()=>[t(Q,{theme:"primary",type:"submit",loading:s.value},{default:a(()=>L[10]||(L[10]=[x("前往")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),t(H,{class:"sh-card sh-background-black"},{default:a(()=>[(D(!0),ae(pe,null,Pe(d.value,ne=>(D(),M(Q,{class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:()=>T(ne)},{default:a(()=>[x(q(ne.name),1)]),_:2},1032,["onClick"]))),256)),v.value?(D(),M(Q,{key:0,class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:L[6]||(L[6]=()=>P.$router.push("/problem/tags"))},{default:a(()=>L[11]||(L[11]=[x(" ... ")])),_:1})):le("",!0)]),_:1})])]),_:1})]),_:1})}}}),fo=ce(po,[["__scopeId","data-v-dbe06f89"]]);function at(e){let l="";for(;e>0;)e--,l=String.fromCharCode(65+e%26)+l,e=Math.floor(e/26);return l}function Ht(e){const l={};if(l.id=e.id,l.ownerId=e.owner_id,l.ownerUsername=e.owner_username,l.ownerNickname=e.owner_nickname,l.title=e.title,l.startTime=new Date(e.start_time).toLocaleString(),l.endTime=new Date(e.end_time).toLocaleString(),l.createTime=new Date(e.create_time).toLocaleString(),l.updateTime=new Date(e.update_time).toLocaleString(),l.private=e.private,l.description=e.description,l.notification=e.notification,e.problems){l.problems=[],e.problems.sort((n,i)=>n.index-i.index);for(let n=0;n<e.problems.length;n++){const i=e.problems[n];let o={accept:0,attempt:0,author:"",id:"",private:!1,tags:[],title:""};o.index=i.index,o.id=at(i.index),o.title=i.title,i.accept?o.accept=i.accept:o.accept=0,i.attempt?o.attempt=i.attempt:o.attempt=0,l.problems.push(o)}}return l}function vo(e){return N({url:"/contest?id="+e,method:"get"})}function _o(e){return N({url:"/contest/edit?id="+e,method:"get"})}function go(e){return N({url:"/contest/problem/list?id="+e,method:"get"})}function bo(e){return e||(e=0),N({url:"/contest/image/token?id="+e,method:"get"})}function ho(e,l){return N({url:"/contest/problem?id="+e+"&problem_index="+l,method:"get"})}function yo(e,l,n,i){const o={};return e&&(o.title=e),l&&(o.username=l),n&&(o.page=String(n)),i&&(o.page_size=String(i)),N({url:`/contest/list?${new URLSearchParams(o).toString()}`,method:"get"})}function wo(e){return N({url:"/contest/rank?id="+e,method:"get"})}function ko(e){return N({url:"/contest/create",method:"post",data:e})}function So(e){return N({url:"/contest/edit",method:"post",data:e})}function Co(e,l){return N({url:"/contest/password",method:"post",data:{id:e,password:l}})}function Io(e){return N({url:"/contest/dolos",method:"post",data:{id:e}})}const Bt=async(e,l)=>{l&&await e.push({name:"user",params:{username:l}})},ta=e=>{const l=X.resolve({name:"problem-detail",params:{problemId:e}});window.open(l.href,"_blank")},Mt=async(e,l)=>{await X.push({name:"contest-problem-detail",params:{contestId:e,problemIndex:l}})},Po={class:"sh-button"},xo={style:{"margin-top":"16px"}},To={__name:"SecretPanel",setup(e){const l=m(!1);return(n,i)=>{const o=G;return D(),ae("div",el(tl(n.$attrs)),[A("div",Po,[t(o,{onClick:i[0]||(i[0]=y=>l.value=!l.value)},{default:a(()=>[x(q(l.value?"收起":"展开"),1)]),_:1})]),Xa(A("div",xo,[Qa(n.$slots,"default",{},void 0)],512),[[Za,l.value]])],16)}}},aa=ce(To,[["__scopeId","data-v-83e9f414"]]),Vo={key:1,style:{"text-align":"center"}},Do={key:1,style:{"text-align":"center"}},jo={key:0,class:"dida-problems-container"},Lo={style:{margin:"12px"}},$o={key:1},Uo={class:"dida-operation-container"},zo={key:0,class:"dida-operation-container"},Ao={class:"dida-code-submit-div"},Ro={class:"dida-code-editor-div"},Eo=de({__name:"ProblemDetail",setup(e){let l=Se();const{globalProperties:n}=_e();let i=null;const o=Ze(),y=Fe();let v=m(""),S="",f="",s=0,$=m(0);const p=m(!1),C=m(!1),_=m(!1),g=m(null);let h=null;const u=m(null),d=m(!1),w=m(!1),c={},r=m(""),j=m([]);j.value=Ot();const b=m([]),k=m(null),U=m(-1),I=m(-1),T=m(""),R=m("");let z=0;const V=Be(()=>y.hasAuth(Le.ManageProblem)),P=Be(()=>y.hasAuth(Le.ManageProblemDaily)),L=()=>{k.value&&clearInterval(k.value),k.value=setInterval(()=>{const K=U.value<=0,B=new Date(new Date().getTime()+z),ue=B.getHours()*60*60+B.getMinutes()*60+B.getSeconds(),oe=18*60*60;ue<oe?U.value=oe-ue:U.value=-1,I.value=24*60*60-ue,(!K&&U.value<=0||I.value<=0)&&ne()},1e3)},E=()=>{k.value&&(clearInterval(k.value),k.value=null)},H=K=>{K&&X.push({name:"problem-list",query:{...l.query,title:"",tag:K.name}})},Z=async()=>{if(!f){ge(n,"每日问题ID无效");return}await X.push({name:"manage-problem-daily",params:{dailyId:f}})},Q=async()=>{let K=S;if(!K)try{const B=await ho(s,$.value);B.code===0?K=B.data:O(n,B.code)}catch{ge(n,"获取题目ID失败，请稍后再试");return}await X.push({name:"manage-problem",params:{problemId:K}})},ee=()=>{S?X.push({name:"judge-list",query:{problem_id:S}}):X.push({name:"contest-judge",params:{contestId:s},query:{problem_id:at($.value)}})},te=()=>{S?X.push({name:"discuss-list-problem",query:{problem_id:S}}):X.push({name:"contest-discuss",params:{contestId:s},query:{problem_id:at($.value)}})},F=()=>{X.push({name:"problem-recommend",params:{problemId:S}})},me=async()=>{var ue,oe;const K=(ue=g.value)==null?void 0:ue.originOj,B=(oe=g.value)==null?void 0:oe.originId;if(!(!K||!B))try{d.value=!0;const Ce=await za(K,B);Ce.code===0?(await J(),ke(n,"更新成功")):O(n,Ce.code)}catch{ge(n,"更新失败，请稍后再试")}finally{d.value=!1}},ie=async()=>{const K=parseInt(r.value);if(!yt(K)){ge(n,"请选择所编写的语言");return}const B=h==null?void 0:h.getValue();if(!B){ge(n,"请输入所需提交的代码");return}if(!S&&(!s||!$.value)){ge(n,"问题ID无效");return}w.value=!0;try{const ue=await nn(S,s,$.value,K,B);if(ue.code!==0){O(n,ue.code);return}ke(n,"提交成功，正在跳转到详情页面");const oe=ue.data.id;s?await X.push({name:"contest-judge-detail",params:{contestId:s,judgeId:oe}}):await X.push({name:"judge-detail",params:{judgeId:oe}})}finally{w.value=!1}},W=K=>{if(!h)return;const B=h.getModel();B&&Qt.setModelLanguage(B,Gt(K))},J=async()=>{b.value=[];let K=await $a(S,s,$.value);if(K.code!==0){_.value=!1,O(n,K.code),await X.push({name:"problem"});return}K.data.tags&&K.data.tags.forEach(B=>{c[B.id]=B}),g.value=_t(K.data.problem,c),o.setTitle(g.value.title+" - "+o.getTitle),s&&(K=await go(s),K.code===0?(K.data.problems.sort((B,ue)=>B-ue),b.value=K.data.problems):O(n,K.code)),v.value=g.value.description,await mt(()=>{!h&&u.value&&(h=Qt.create(u.value,{value:"",language:"cpp",minimap:{enabled:!0},colorDecorators:!0,readOnly:!1,theme:"vs-dark"})),_.value=!1})},ne=async()=>{E(),C.value=!1;const K=await gn(f);if(K.code!==0)return;C.value=!0;const B=K.data.problem_daily;S=B.problem_id,T.value=B.solution,R.value=B.code;const ue=new Date(K.data.time);z=ue.getTime()-new Date().getTime();const oe=new Date(ue.getTime()),Ce=oe.getFullYear(),Y=String(oe.getMonth()+1).padStart(2,"0"),se=String(oe.getDate()).padStart(2,"0"),ye=`${Ce}-${Y}-${se}`;if(f===ye){const be=ue.getHours()*60*60+ue.getMinutes()*60+ue.getSeconds(),xe=18*60*60;be<xe?U.value=xe-be:U.value=-1,I.value=24*60*60-be}(U.value>=0||I.value>=0)&&L()};return fe(async()=>{i=$e(()=>l.params,async()=>{if(C.value=!1,Array.isArray(l.params.problemId)?S=l.params.problemId[0]:S=l.params.problemId,S||(Array.isArray(l.params.dailyId)?f=l.params.dailyId[0]:f=l.params.dailyId,_.value=!0,await ne(),_.value=!1),!S){if(Array.isArray(l.params.contestId)?s=Number(l.params.contestId[0]):s=Number(l.params.contestId),!s){ge(n,"题目不存在"),f?await X.push({name:"problem-daily-list"}):await X.push({name:"problem"});return}if(Array.isArray(l.params.problemIndex)?$.value=parseInt(l.params.problemIndex[0]):$.value=parseInt(l.params.problemIndex),!$.value){ge(n,"题目不存在"),await X.push({name:"problem"});return}}p.value=!!s,_.value=!0,await J()},{immediate:!0}),u.value&&new ResizeObserver(()=>{h&&h.layout()}).observe(u.value)}),De(()=>{i&&(i(),i=null),E()}),(K,B)=>{const ue=Re("md-preview"),oe=he,Ce=qt,Y=we,se=Te,ye=G,be=Je,xe=lt,Ge=We,je=Kt,Ye=ft,ot=Ie,Vt=Ve;return D(),M(Vt,{loading:_.value},{default:a(()=>[t(ot,{class:"dida-main-content"},{default:a(()=>[t(se,{span:8},{default:a(()=>[t(oe,{style:{margin:"10px"}},{default:a(()=>[t(ue,{"model-value":ve(v),previewTheme:"cyanosis"},null,8,["model-value"])]),_:1}),C.value?(D(),M(oe,{key:0,style:{margin:"10px"},title:"题解"},{default:a(()=>[U.value<0?(D(),M(aa,{key:0},{default:a(()=>[t(ue,{"model-value":T.value,previewTheme:"cyanosis"},null,8,["model-value"])]),_:1})):(D(),ae("div",Vo,[A("div",null,[t(Y,null,{default:a(()=>[B[2]||(B[2]=A("p",null,"距离解锁百分比",-1)),t(Ce,{theme:"circle",color:{from:"#0052D9",to:"#00A870"},percentage:100-U.value/(18*60*60)*100,status:"active"},{label:a(()=>[x(q((100-U.value/(18*60*60)*100).toFixed(3))+"% ",1)]),default:a(()=>[B[1]||(B[1]=x(" > "))]),_:1},8,["percentage"])]),_:1})])]))]),_:1})):le("",!0),C.value?(D(),M(oe,{key:1,style:{margin:"10px"},title:"示例代码"},{default:a(()=>[I.value<0?(D(),M(aa,{key:0},{default:a(()=>[t(ue,{"model-value":R.value,previewTheme:"cyanosis"},null,8,["model-value"])]),_:1})):(D(),ae("div",Do,[A("div",null,[t(Y,{style:{margin:"0 auto"}},{default:a(()=>[B[4]||(B[4]=A("p",null,"距离解锁百分比",-1)),t(Ce,{theme:"circle",color:{from:"#0052D9",to:"#00A870"},percentage:100-I.value/(24*60*60)*100,status:"active"},{label:a(()=>[x(q((100-I.value/(24*60*60)*100).toFixed(3))+"% ",1)]),default:a(()=>[B[3]||(B[3]=x(" > "))]),_:1},8,["percentage"])]),_:1})])]))]),_:1})):le("",!0)]),_:1}),t(se,{span:4},{default:a(()=>{var Yt;return[ve(s)?(D(),ae("div",jo,[t(Y,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(D(!0),ae(pe,null,Pe(b.value,(Me,re)=>(D(),M(ye,{key:re,theme:Me==ve($)?"primary":"default",onClick:async()=>await ve(Mt)(ve(s),Me)},{default:a(()=>[x(q(ve(at)(Me)),1)]),_:2},1032,["theme","onClick"]))),128))]),_:1})])):le("",!0),A("div",Lo,[t(Ge,{layout:"vertical",bordered:!0},{default:a(()=>{var Me;return[t(be,{label:"ID"},{default:a(()=>{var re;return[x(q((re=g.value)==null?void 0:re.id),1)]}),_:1}),t(be,{label:"标题"},{default:a(()=>{var re;return[x(q((re=g.value)==null?void 0:re.title),1)]}),_:1}),t(be,{label:"时间限制"},{default:a(()=>{var re;return[x(q((re=g.value)==null?void 0:re.timeLimit),1)]}),_:1}),t(be,{label:"内存限制"},{default:a(()=>{var re;return[x(q((re=g.value)==null?void 0:re.memoryLimit),1)]}),_:1}),t(be,{label:"判题方式"},{default:a(()=>{var re;return[x(q((re=g.value)==null?void 0:re.judgeType),1)]}),_:1}),p.value?le("",!0):(D(),M(be,{key:0,label:"正确提交"},{default:a(()=>{var re;return[x(q((re=g.value)==null?void 0:re.accept),1)]}),_:1})),p.value?le("",!0):(D(),M(be,{key:1,label:"提交总数"},{default:a(()=>{var re;return[x(q((re=g.value)==null?void 0:re.attempt),1)]}),_:1})),t(be,{label:"创建时间"},{default:a(()=>{var re;return[x(q((re=g.value)==null?void 0:re.insertTime),1)]}),_:1}),t(be,{label:"更新时间"},{default:a(()=>{var re;return[x(q((re=g.value)==null?void 0:re.updateTime),1)]}),_:1}),t(be,{label:"上传用户"},{default:a(()=>{var re;return[x(q((re=g.value)==null?void 0:re.creatorNickname),1)]}),_:1}),p.value?le("",!0):(D(),M(be,{key:2,label:"题目来源"},{default:a(()=>{var re,Qe,ct;return[(re=g.value)!=null&&re.sourceUrl?(D(),M(xe,{key:0,href:(Qe=g.value)==null?void 0:Qe.sourceUrl,target:"_blank"},{default:a(()=>{var Xt;return[x(q((Xt=g.value)==null?void 0:Xt.source),1)]}),_:1},8,["href"])):(D(),ae("span",$o,q((ct=g.value)==null?void 0:ct.source),1))]}),_:1})),V.value?(D(),M(be,{key:3,label:"是否私有"},{default:a(()=>{var re;return[x(q((re=g.value)!=null&&re.private?"私有":"公开"),1)]}),_:1})):le("",!0),(Me=g.value)!=null&&Me.originUrl?(D(),M(be,{key:4,label:"原题链接"},{default:a(()=>{var re;return[t(xe,{href:(re=g.value)==null?void 0:re.originUrl,target:"_blank"},{default:a(()=>{var Qe,ct;return[x(q((Qe=g.value)==null?void 0:Qe.originOj)+" - "+q((ct=g.value)==null?void 0:ct.originId),1)]}),_:1},8,["href"])]}),_:1})):le("",!0),ve(S)?(D(),M(be,{key:5,label:"标签"},{default:a(()=>[t(Y,null,{default:a(()=>{var re;return[(D(!0),ae(pe,null,Pe((re=g.value)==null?void 0:re.tags,Qe=>(D(),M(ye,{key:Qe.id,variant:"dashed",onClick:()=>H(Qe)},{default:a(()=>[x(q(Qe.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})):le("",!0)]}),_:1}),A("div",Uo,[t(Y,null,{default:a(()=>[t(ye,{onClick:ee},{default:a(()=>B[5]||(B[5]=[x("提交记录")])),_:1}),t(ye,{onClick:te},{default:a(()=>B[6]||(B[6]=[x("题目讨论")])),_:1}),ve(S)?(D(),M(ye,{key:0,onClick:F},{default:a(()=>B[7]||(B[7]=[x("题目推荐")])),_:1})):le("",!0)]),_:1})]),C.value&&P.value||V.value||(Yt=g.value)!=null&&Yt.originId?(D(),ae("div",zo,[t(Y,null,{default:a(()=>{var Me;return[C.value&&P.value?(D(),M(ye,{key:0,onClick:Z},{default:a(()=>B[8]||(B[8]=[x("每日一题")])),_:1})):le("",!0),V.value?(D(),M(ye,{key:1,onClick:Q},{default:a(()=>B[9]||(B[9]=[x("编辑")])),_:1})):le("",!0),(Me=g.value)!=null&&Me.originId?(D(),M(ye,{key:2,onClick:me,loading:d.value},{default:a(()=>B[10]||(B[10]=[x("更新描述 ")])),_:1},8,["loading"])):le("",!0)]}),_:1})])):le("",!0),A("div",Ao,[t(Y,null,{default:a(()=>[t(Ye,{modelValue:r.value,"onUpdate:modelValue":B[0]||(B[0]=Me=>r.value=Me),label:"语言：",placeholder:"请选择提交语言","auto-width":"",clearable:"",onChange:W},{default:a(()=>[(D(!0),ae(pe,null,Pe(j.value,Me=>(D(),M(je,{key:Me.value,value:Me.value,label:Me.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),t(ye,{onClick:ie,loading:w.value},{default:a(()=>B[11]||(B[11]=[x("提交")])),_:1},8,["loading"])]),_:1}),A("div",Ro,[A("div",{ref_key:"codeEditRef",ref:u,class:"dida-code-editor"},null,512)])])])]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),Lt=ce(Eo,[["__scopeId","data-v-bf97b778"]]),Mo={style:{margin:"10px"}},qo={key:0,class:"dida-operation-container"};function Ko(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const Fo=de({__name:"ProblemDailyList",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e(),o=Fe();let y=!1,v=null,S={},f={};const s=Be(()=>o.hasAuth(Le.ManageProblem)),$=m([{title:"日期",colKey:"id",cell:(I,T)=>t(G,{variant:"dashed",onClick:()=>d(T.row.id)},{default:()=>[T.row.id]})},{title:"ID",colKey:"problemId",cell:(I,T)=>{let R=w(T.row.problemId);return t(G,{variant:"dashed",theme:R,onClick:()=>d(T.row.id)},{default:()=>[T.row.problemId]})}},{title:"标题",colKey:"title",cell:(I,T)=>t(G,{variant:"text",onClick:()=>d(T.row.id)},{default:()=>[T.row.title]})},{title:"标签",colKey:"tags",cell:(I,T)=>{const R=T.row.tags;if(!R||R.length===0)return"";let z=[];for(let V=0;V<R.length;V++){const P=R[V];z.push(t(G,{key:V,theme:"default",variant:"outline",size:"small",onClick:()=>j(P)},{default:()=>[P.name]}))}return t(we,null,Ko(z)?z:{default:()=>[z]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),p=m(!1);let C=1,_=50;const g=m({current:C,pageSize:_,defaultCurrent:C,defaultPageSize:_,total:0,pageSizeOptions:[50,100]}),h=m([]),u=m({date:[],problemId:""}),d=I=>{I&&n.push({name:"problem-daily-detail",params:{dailyId:I}})},w=I=>{if(!I||!f)return"default";const T=f[I];if(!T)return"default";switch(T){case Oe.Accept:return"success";case Oe.Attempt:return"warning";default:return"default"}},c=async()=>{let I="";u.value.date&&u.value.date.length>1&&(I=u.value.date[0]+"~"+u.value.date[1]),await n.push({query:{...l.query,date:I,problem_id:u.value.problemId,page:1,page_size:g.value.defaultPageSize}})},r=async()=>{u.value.date=[],u.value.problemId="",await n.push({query:{...l.query,date:"",problem_id:"",page:1,page_size:g.value.defaultPageSize}})},j=I=>{I&&n.push({name:"problem-list",query:{...l.query,title:"",tag:I.name,page:1,page_size:g.value.defaultPageSize}})},b=()=>{n.push({name:"manage-problem-daily-create"})},k=async(I,T)=>{p.value=!0;try{const{current:R,pageSize:z}=I;let V="";u.value.date[0]&&(V=u.value.date[0]);let P="";u.value.date[1]&&(P=u.value.date[1]);const L=await yn(V,P,u.value.problemId,R,z);if(h.value=[],L.code===0){const E=L.data.list;if(!E||E.length<=0){g.value={...g.value,total:0},f={},ke(i,"未找到记录");return}S={},L.data.tags&&L.data.tags.forEach(H=>{S[H.id]=H}),E.forEach(H=>{var Q;const Z=La(H,S);(Q=h.value)==null||Q.push(Z)}),g.value={...g.value,total:L.data.total_count},f=L.data.attempt_status}else T&&O(i,L.code)}catch(R){console.error(R),O(i,Ne())}finally{p.value=!1}},U=async I=>{await n.push({query:{...l.query,page:I.current,page_size:I.pageSize}})};return fe(async()=>{y=!0,p.value=!0,v=$e(()=>l.query,I=>{if(!y)return;if(u.value.date=[],I.date){const z=I.date.split("~");z.length===2&&(u.value.date=[z[0],z[1]])}u.value.problemId=I.problem_id||"";const T=parseInt(I.page)||g.value.defaultCurrent,R=parseInt(I.page_size)||g.value.defaultPageSize;C=T,_=R,g.value={...g.value,current:C,pageSize:_},k({current:C,pageSize:_},!0)},{immediate:!0})}),De(()=>{y=!1,v&&v()}),(I,T)=>{const R=Ee,z=he,V=Te,P=G,L=we,E=Ft,H=ze,Z=Ae,Q=Ue,ee=Ie;return D(),M(ee,null,{default:a(()=>[t(V,{span:9},{default:a(()=>[t(z,{style:{margin:"10px"}},{default:a(()=>[t(R,{data:h.value,columns:$.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:g.value,"table-layout":"auto",loading:p.value,onPageChange:U},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(V,{span:3},{default:a(()=>[A("div",Mo,[s.value?(D(),ae("div",qo,[t(L,null,{default:a(()=>[t(P,{onClick:b},{default:a(()=>T[2]||(T[2]=[x("新建")])),_:1})]),_:1})])):le("",!0),t(z,{class:"sh-card"},{default:a(()=>[t(Q,{model:u.value,onSubmit:c,onReset:r},{default:a(()=>[t(H,{label:"日期","label-align":"top"},{default:a(()=>[t(E,{modelValue:u.value.date,"onUpdate:modelValue":T[0]||(T[0]=te=>u.value.date=te),"allow-input":"",clearable:"",format:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(H,{label:"问题","label-align":"top"},{default:a(()=>[t(Z,{modelValue:u.value.problemId,"onUpdate:modelValue":T[1]||(T[1]=te=>u.value.problemId=te),placeholder:"请输入问题ID",clearable:""},null,8,["modelValue"])]),_:1}),t(H,{"label-align":"top"},{default:a(()=>[t(L,null,{default:a(()=>[t(P,{theme:"primary",type:"submit"},{default:a(()=>T[3]||(T[3]=[x("搜索")])),_:1}),t(P,{theme:"danger",type:"reset"},{default:a(()=>T[4]||(T[4]=[x("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(z,{class:"sh-card",header:"每日一题","header-bordered":!0},{default:a(()=>T[5]||(T[5]=[A("p",null,"由管理员团队精选的题目，每日0点更新。",-1),A("p",null,"当日下午6点提供题解，次日提供AC代码。",-1)])),_:1})])]),_:1})]),_:1})}}}),Oo=ce(Fo,[["__scopeId","data-v-5e0bb3cc"]]),Go={style:{margin:"10px"}},No={style:{margin:"12px"}},Ho={class:"dida-edit-container"},Bo=de({__name:"ProblemDailyEdit",setup(e){let l=Se();const{globalProperties:n}=_e();let i=null;const o=m(""),y=m(!1),v=m(!1),S=m(null),f=m({date:"",problemId:"",solution:"",code:""}),s=()=>{X.push({name:"problem-daily-detail",params:{dailyId:o.value}})};async function $(u,d){v.value=!0,await ut(u,d,n,()=>Tn(o.value)),v.value=!1}const p=async()=>{v.value=!0;try{const u=f.value.date,d=await Cn(u,f.value.problemId,f.value.solution,f.value.code);if(v.value=!0,d.code!==0){O(n,d.code);return}await X.push({name:"manage-problem-daily",params:{dailyId:u}}),Ke(n,"创建成功")}finally{v.value=!1}},C=async()=>{v.value=!0;try{const u=await In(o.value,f.value.problemId,f.value.solution,f.value.code);if(v.value=!0,u.code!==0){O(n,u.code);return}S.value&&(u.data.update_time!=null&&(S.value.updateTime=new Date(u.data.update_time).toLocaleString()),u.data.updater_nickname!=null&&(S.value.updaterNickname=u.data.updater_nickname)),u.data.solution!=null&&(f.value.solution=u.data.solution),u.data.code!=null&&(f.value.code=u.data.code),Ke(n,"保存成功")}finally{v.value=!1}},_=u=>{f.value.solution=u,y.value=!1},g=u=>{f.value.code=u,y.value=!1},h=async()=>{const u=await bn(o.value);if(u.code!==0){O(n,u.code),console.error("problem get failed",u.code),await X.push({name:"problem"});return}const d=u.data;S.value=La(d,{}),f.value.problemId=d.problem_id,_(d.solution),g(d.code)};return fe(async()=>{i=$e(()=>l.params,async()=>{Array.isArray(l.params.dailyId)?o.value=l.params.dailyId[0]:o.value=l.params.dailyId,o.value?(y.value=!0,f.value.date=o.value,await h()):(_("暂无题解"),g("暂无标程"))},{immediate:!0})}),De(()=>{i&&(i(),i=null)}),(u,d)=>{const w=Ct,c=yl,r=ze,j=Ae,b=Ue,k=he,U=Te,I=G,T=we,R=Je,z=We,V=Ie,P=Re("md-editor-v3"),L=Ve;return D(),M(L,{loading:y.value},{default:a(()=>[t(V,null,{default:a(()=>[t(U,{span:8},{default:a(()=>[A("div",Go,[t(w,{theme:"info"},{default:a(()=>d[4]||(d[4]=[x("可以提前配置将来日期的题目，对外仅展示到截止到当天的题目")])),_:1}),t(k,{class:"sh-form-card"},{default:a(()=>[t(b,{model:f.value},{default:a(()=>[t(r,{label:"日期"},{default:a(()=>[t(c,{modelValue:f.value.date,"onUpdate:modelValue":d[0]||(d[0]=E=>f.value.date=E),disabled:o.value&&!0},null,8,["modelValue","disabled"])]),_:1}),t(r,{label:"问题ID"},{default:a(()=>[t(j,{modelValue:f.value.problemId,"onUpdate:modelValue":d[1]||(d[1]=E=>f.value.problemId=E),placeholder:"问题标题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(U,{span:4},{default:a(()=>[A("div",No,[A("div",Ho,[o.value?(D(),M(T,{key:0},{default:a(()=>[t(I,{onClick:C,theme:"danger",loading:v.value},{default:a(()=>d[5]||(d[5]=[x("保存")])),_:1},8,["loading"]),t(I,{onClick:s},{default:a(()=>d[6]||(d[6]=[x("查看")])),_:1})]),_:1})):(D(),M(T,{key:1},{default:a(()=>[t(I,{onClick:p,theme:"danger",loading:v.value},{default:a(()=>d[7]||(d[7]=[x("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(D(),M(z,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(R,{label:"创建时间"},{default:a(()=>{var E;return[x(q((E=S.value)==null?void 0:E.createTime),1)]}),_:1}),t(R,{label:"更新时间"},{default:a(()=>{var E;return[x(q((E=S.value)==null?void 0:E.updateTime),1)]}),_:1}),t(R,{label:"创建用户"},{default:a(()=>{var E;return[x(q((E=S.value)==null?void 0:E.creatorNickname),1)]}),_:1}),t(R,{label:"更新用户"},{default:a(()=>{var E;return[x(q((E=S.value)==null?void 0:E.updaterNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),A("div",null,[d[8]||(d[8]=A("p",{style:{"margin-left":"20px"}},"题解：",-1)),t(P,{id:"daily-solution-editor",modelValue:f.value.solution,"onUpdate:modelValue":d[2]||(d[2]=E=>f.value.solution=E),onSave:C,onOnUploadImg:$,previewTheme:"cyanosis"},null,8,["modelValue"]),t(L,{loading:v.value,attach:"#daily-solution-editor","z-index":1e5},null,8,["loading"])]),A("div",null,[d[9]||(d[9]=A("p",{style:{"margin-left":"20px"}},"标程：",-1)),t(P,{id:"daily-code-editor",modelValue:f.value.code,"onUpdate:modelValue":d[3]||(d[3]=E=>f.value.code=E),onSave:C,onOnUploadImg:$,previewTheme:"cyanosis"},null,8,["modelValue"]),t(L,{loading:v.value,attach:"#daily-code-editor","z-index":1e5},null,8,["loading"])])]),_:1},8,["loading"])}}}),la=ce(Bo,[["__scopeId","data-v-b11269dd"]]),Wo={style:{margin:"10px"}};function Jo(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const Yo=de({__name:"ProblemRecommend",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=null,y="",v={},S={};const f=m([{title:"ID",colKey:"id",cell:(h,u)=>{let d=C(u.row.id);return t(G,{variant:"dashed",theme:d,onClick:()=>p(u.row.id)},{default:()=>[u.row.id]})}},{title:"标题",colKey:"title",cell:(h,u)=>t(G,{variant:"text",onClick:()=>p(u.row.id)},{default:()=>[u.row.title]})},{title:"标签",colKey:"tags",cell:(h,u)=>{const d=u.row.tags;if(!d||d.length===0)return"";let w=[];for(let c=0;c<d.length;c++){const r=d[c];w.push(t(G,{key:c,theme:"default",variant:"outline",size:"small",onClick:()=>_(r)},{default:()=>[r.name]}))}return t(we,null,Jo(w)?w:{default:()=>[w]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),s=m(!1),$=m(),p=h=>{h&&n.push({path:"/problem/"+h})},C=h=>{if(!h||!S)return"default";const u=S[h];if(!u)return"default";switch(u){case Oe.Accept:return"success";case Oe.Attempt:return"warning";default:return"default"}},_=h=>{h&&n.push({name:"problem-list",query:{tag:h.name}})},g=async h=>{s.value=!0;try{const u=await _n(y);if($.value=[],u.code===0){const d=u.data.list;if(!d||d.length<=0){ke(i,"暂无推荐题目");return}v={},u.data.tags&&u.data.tags.forEach(w=>{v[w.id]=w}),d.forEach(w=>{var r;const c=_t(w,v);(r=$.value)==null||r.push(c)})}else h&&O(i,u.code)}catch(u){console.error(u),O(i,Ne())}finally{s.value=!1}};return fe(async()=>{s.value=!0,o=$e(()=>l.query,h=>{Array.isArray(l.params.problemId)?y=l.params.problemId[0]:y=l.params.problemId,g(!0)},{immediate:!0})}),De(()=>{o&&o()}),(h,u)=>{const d=Ee,w=he,c=Te,r=Ie;return D(),M(r,null,{default:a(()=>[t(c,{span:9},{default:a(()=>[t(w,{style:{margin:"10px"}},{default:a(()=>[t(d,{data:$.value,columns:f.value,"row-key":"id","vertical-align":"top",hover:!0,"table-layout":"auto",loading:s.value},null,8,["data","columns","loading"])]),_:1})]),_:1}),t(c,{span:3},{default:a(()=>[A("div",Wo,[t(w,{class:"sh-card",header:"题目推荐","header-bordered":!0},{default:a(()=>u[0]||(u[0]=[x(" 根据本站其他用户的提交记录推荐类似题目"),A("br",null,null,-1),x("依据推荐算法来计算，与本用户相似度最高的用户做的题，大概率被自己感兴趣。 ")])),_:1})])]),_:1})]),_:1})}}}),Xo=ce(Yo,[["__scopeId","data-v-77972e8b"]]),Zo={style:{margin:"10px"}},Qo={key:1},es={style:{margin:"12px"}},ts={class:"dida-edit-container"},as={class:"dida-description-editor"},ls=de({__name:"ProblemEdit",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze(),o=m(""),y=m(!1),v=m(!1),S=m(!1),f=m(null),s=m({title:"",timeLimit:0,memoryLimit:0,source:"",private:!0,tags:[],description:""}),$=m([]),p=m([]),C=Be(()=>{const b=[],k=$.value;for(let U=0,I=k.length;U<I;U++)k[U].value&&b.push(k[U].value);return b}),_=(b,k)=>{const{trigger:U,index:I,item:T}=k;if(U==="clear"&&($.value=[]),["tag-remove","backspace"].includes(U)&&$.value.splice(I,1),U==="enter"){for(let z=0;z<p.value.length;z++){const V=p.value[z];if(V.label===T){for(let P=0;P<$.value.length;P++)if($.value[P].label===V.label)return;$.value.push(V);return}}const R={label:T,value:T};$.value.push(R),p.value=p.value.concat(R)}},g=(b,{current:k,type:U})=>{if(!k){$.value=U==="check"?p.value.slice(1):[];return}if(U==="check"){const I=p.value.find(T=>T.value===k);if(!I)return;$.value.push(I)}else $.value=$.value.filter(I=>I.value!==k)},h=()=>{X.push({name:"problem-detail",params:{problemId:o.value}})},u=()=>{X.push({name:"manage-problem-judge",params:{problemId:o.value}})},d=async(b,k)=>{S.value=!0,await ut(b,k,n,()=>xn(o.value)),S.value=!1},w=async()=>{v.value=!0,s.value.tags=[];for(let b=0;b<$.value.length;b++){const k=$.value[b];k&&k.label&&s.value.tags.push(k.label)}try{const b=await kn(s.value.title,s.value.timeLimit,s.value.memoryLimit,s.value.source,s.value.private,s.value.tags,s.value.description);if(v.value=!0,b.code!==0){O(n,b.code);return}b.data!=null&&await X.push({name:"problem-detail",params:{problemId:b.data}}),Ke(n,"创建成功")}finally{v.value=!1}},c=async()=>{v.value=!0,s.value.tags=[];for(let b=0;b<$.value.length;b++){const k=$.value[b];k&&k.label&&s.value.tags.push(k.label)}try{const b=await Sn(o.value,s.value.title,s.value.timeLimit,s.value.memoryLimit,s.value.source,s.value.private,s.value.tags,s.value.description);if(v.value=!0,b.code!==0){O(n,b.code);return}f.value&&b.data.update_time!=null&&(f.value.updateTime=new Date(b.data.update_time).toLocaleString()),b.data.description!=null&&(s.value.description=b.data.description),Ke(n,"保存成功")}finally{v.value=!1}},r=b=>{s.value.description=b,y.value=!1},j=async()=>{const b=await $a(o.value,void 0,void 0);if(b.code!==0){O(n,b.code),console.error("problem get failed",b.code),await X.push({name:"problem"});return}const k=b.data.problem;if(f.value=_t(k,{}),s.value.title=k.title,s.value.timeLimit=k.time_limit,s.value.memoryLimit=k.memory_limit,s.value.source=k.source,s.value.private=k.private,s.value.tags=[],$.value=[],b.data.tags)for(let I=0;I<b.data.tags.length;I++){const T=b.data.tags[I];T&&T.name&&(s.value.tags.push(T.name),$.value.push({label:T.name,value:T.id}))}i.setTitle(k.title+" - "+i.getTitle);let U=k.description;r(U)};return fe(async()=>{Array.isArray(l.params.problemId)?o.value=l.params.problemId[0]:o.value=l.params.problemId,o.value?(y.value=!0,Ua(-1).then(async b=>{b.code===0?(b.data.list&&b.data.list.forEach(k=>{p.value.push({label:k.name,value:k.id})}),await j()):(O(n,b.code),console.error("problem tag get failed",b.code),await X.push({name:"problem"}))}).catch(async b=>{console.error(b),O(n,"获取数据异常"),await X.push({name:"problem"})})):(s.value.timeLimit=1e3,s.value.memoryLimit=65536,r(""))}),(b,k)=>{const U=Ae,I=ze,T=wa,R=vt,z=kl,V=wl,P=Ue,L=he,E=Te,H=G,Z=we,Q=Je,ee=We,te=Ie,F=Re("md-editor-v3"),me=Ve;return D(),M(me,{loading:y.value},{default:a(()=>[t(te,null,{default:a(()=>[t(E,{span:8},{default:a(()=>[A("div",Zo,[t(L,{class:"sh-card"},{default:a(()=>[t(P,{model:s.value},{default:a(()=>[t(I,{label:"标题"},{default:a(()=>[t(U,{modelValue:s.value.title,"onUpdate:modelValue":k[0]||(k[0]=ie=>s.value.title=ie),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),t(I,{label:"时间限制"},{default:a(()=>[t(T,{modelValue:s.value.timeLimit,"onUpdate:modelValue":k[1]||(k[1]=ie=>s.value.timeLimit=ie),theme:"normal",min:0},{suffix:a(()=>k[6]||(k[6]=[A("span",null,"ms",-1)])),_:1},8,["modelValue"])]),_:1}),t(I,{label:"内存限制"},{default:a(()=>[t(T,{modelValue:s.value.memoryLimit,"onUpdate:modelValue":k[2]||(k[2]=ie=>s.value.memoryLimit=ie),theme:"normal",min:0},{suffix:a(()=>k[7]||(k[7]=[A("span",null,"KB",-1)])),_:1},8,["modelValue"])]),_:1}),t(I,{label:"来源"},{default:a(()=>[t(U,{modelValue:s.value.source,"onUpdate:modelValue":k[3]||(k[3]=ie=>s.value.source=ie),placeholder:"请输入题目来源"},null,8,["modelValue"])]),_:1}),t(I,{label:"私有"},{default:a(()=>[t(R,{modelValue:s.value.private,"onUpdate:modelValue":k[4]||(k[4]=ie=>s.value.private=ie)},null,8,["modelValue"])]),_:1}),t(I,{label:"标签"},{default:a(()=>[t(V,{value:$.value,"allow-input":!0,placeholder:"请选择或输入","tag-input-props":{excessTagsDisplayType:"break-line"},"popup-props":{overlayInnerClassName:["narrow-scrollbar"],overlayInnerStyle:{maxHeight:"280px",overflowY:"auto",overscrollBehavior:"contain",padding:"6px"}},clearable:"",multiple:"",onTagChange:_},{panel:a(()=>[p.value.length?(D(),M(z,{key:0,value:C.value,options:p.value,onChange:g},null,8,["value","options"])):(D(),ae("div",Qo,"暂无数据"))]),suffixIcon:a(()=>[t(ve(al))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(E,{span:4},{default:a(()=>[A("div",es,[A("div",ts,[o.value?(D(),M(Z,{key:0},{default:a(()=>[t(H,{onClick:c,theme:"danger",loading:v.value},{default:a(()=>k[8]||(k[8]=[x("保存")])),_:1},8,["loading"]),t(H,{onClick:u,theme:"warning"},{default:a(()=>k[9]||(k[9]=[x("判题数据")])),_:1}),t(H,{onClick:h},{default:a(()=>k[10]||(k[10]=[x("查看")])),_:1})]),_:1})):(D(),M(Z,{key:1},{default:a(()=>[t(H,{onClick:w,theme:"danger",loading:v.value},{default:a(()=>k[11]||(k[11]=[x("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(D(),M(ee,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(Q,{label:"创建时间"},{default:a(()=>{var ie;return[x(q((ie=f.value)==null?void 0:ie.insertTime),1)]}),_:1}),t(Q,{label:"更新时间"},{default:a(()=>{var ie;return[x(q((ie=f.value)==null?void 0:ie.updateTime),1)]}),_:1}),t(Q,{label:"判题方式"},{default:a(()=>{var ie;return[x(q((ie=f.value)==null?void 0:ie.judgeType),1)]}),_:1}),t(Q,{label:"上传用户"},{default:a(()=>{var ie;return[x(q((ie=f.value)==null?void 0:ie.creatorNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),A("div",as,[k[12]||(k[12]=A("p",null,"题目描述",-1)),t(me,{loading:S.value||v.value},{default:a(()=>[t(F,{modelValue:s.value.description,"onUpdate:modelValue":k[5]||(k[5]=ie=>s.value.description=ie),onSave:c,onOnUploadImg:d,previewTheme:"cyanosis"},null,8,["modelValue"])]),_:1},8,["loading"])])]),_:1},8,["loading"])}}}),na=ce(ls,[["__scopeId","data-v-e349d9e2"]]),ns={style:{margin:"10px"}},os={style:{margin:"12px"}},ss={class:"dida-edit-container"},rs=de({__name:"ProblemJudge",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze(),o=m(""),y=m(!1),v=m(null);let S=null;const f=m(null),s=m(""),$=m(!1),p=m(!1),C=m([{title:"文件",colKey:"file"},{title:"大小",colKey:"size",width:150,cell:(T,R)=>{let z=R.row.size,V;return z>10*1024?z>1024*1024?V=(z/(1024*1024)).toFixed(3)+" MB":V=(z/1024).toFixed(3)+" KB":V=z+" B",V}},{title:"最后修改时间",colKey:"lastModified",width:180,cell:(T,R)=>new Date(R.row.lastModified).toLocaleString()},{title:"操作",colKey:"action",width:100,cell:(T,R)=>t(G,{onClick:()=>w(R.row.file)},{default:()=>[x("下载")]})}]),_=m([]),g=Be(()=>({border:"2px dashed #ccc",borderRadius:"6px",padding:"20px",textAlign:"center",cursor:"pointer",backgroundColor:$.value?"#f0f9ff":"#fff",transition:"background-color 0.2s ease"})),h=Be(()=>s.value?`已选择：${s.value}`:$.value?"松开文件以上传":"拖拽判题数据压缩包到这里，或点击选择文件"),u=()=>{X.push({name:"problem-detail",params:{problemId:o.value}})},d=()=>{X.push({name:"manage-problem",params:{problemId:o.value}})},w=async T=>{const R=await Pn(o.value,T);if(R.code!==0){O(n,R.code);return}const z=document.createElement("a");z.href=R.data,z.target="_blank",z.click(),URL.revokeObjectURL(z.href)},c=async()=>{if(!S){ge(n,"请选择压缩包");return}p.value=!0,Vn(o.value,S).then(async T=>{T.code==0?(f.value.value=null,S=null,s.value="",y.value=!0,Ke(n,"上传成功"),await I()):ql(n,T.code,T.data)}).catch(T=>{console.log(T),n.$message.error({duration:3e3,content:"上传失败"})}).finally(()=>{p.value=!1})},r=()=>{var T;(T=f.value)==null||T.click()},j=T=>{const R=T.target.files[0];R&&(s.value=R.name,S=R)},b=T=>{$.value=!0},k=()=>{$.value=!1},U=T=>{T.preventDefault(),T.stopPropagation(),$.value=!1;const R=T.dataTransfer.files[0];if(R){s.value=R.name;const z=new DataTransfer;z.items.add(R),f.value.files=z.files,S=R}},I=async()=>{const T=await fn(o.value);if(T.code!==0){O(n,T.code),await X.push({name:"problem"});return}const R=T.data.problem;v.value=_t(R,{}),i.setTitle(R.title+" - "+i.getTitle),_.value=[],T.data.judges?(T.data.judges.forEach(z=>{_.value.push({file:z.key,size:z.size,lastModified:z.last_modified})}),_.value.sort((z,V)=>z.file.endsWith(".zip")&&!V.file.endsWith(".zip")?-1:!z.file.endsWith(".zip")&&V.file.endsWith(".zip")?1:z.file.endsWith(".yaml")&&!V.file.endsWith(".yaml")?-1:!z.file.endsWith(".yaml")&&V.file.endsWith(".yaml")?1:0)):ge(n,"评测数据不存在"),y.value=!1};return fe(async()=>{if(Array.isArray(l.params.problemId)?o.value=l.params.problemId[0]:o.value=l.params.problemId,!o.value){ge(n,"题目不存在"),await X.push({name:"problem"});return}y.value=!0,await I()}),(T,R)=>{const z=Ee,V=Te,P=G,L=we,E=Je,H=We,Z=Ie,Q=Ve;return D(),M(Q,{loading:y.value},{default:a(()=>[t(Z,null,{default:a(()=>[t(V,{span:7},{default:a(()=>[A("div",ns,[A("div",{id:"drop-zone",style:ga(g.value),onClick:r,onDragenter:Dt(b,["prevent"]),onDragover:R[0]||(R[0]=Dt(()=>{},["prevent"])),onDragleave:Dt(k,["prevent"]),onDrop:U},[A("input",{ref_key:"fileInput",ref:f,type:"file",style:{display:"none"},onChange:j},null,544),x(" "+q(h.value),1)],36)]),t(z,{data:_.value,columns:C.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1}),t(V,{span:5},{default:a(()=>[A("div",os,[A("div",ss,[t(L,null,{default:a(()=>[t(P,{onClick:c,theme:"danger",loading:p.value},{default:a(()=>R[1]||(R[1]=[x("上传")])),_:1},8,["loading"]),t(P,{onClick:d,theme:"warning"},{default:a(()=>R[2]||(R[2]=[x("编辑")])),_:1}),t(P,{onClick:u},{default:a(()=>R[3]||(R[3]=[x("查看")])),_:1})]),_:1})]),t(H,{layout:"vertical",bordered:!0},{default:a(()=>[t(E,{label:"标题"},{default:a(()=>{var ee;return[x(q((ee=v.value)==null?void 0:ee.title),1)]}),_:1}),t(E,{label:"创建时间"},{default:a(()=>{var ee;return[x(q((ee=v.value)==null?void 0:ee.insertTime),1)]}),_:1}),t(E,{label:"更新时间"},{default:a(()=>{var ee;return[x(q((ee=v.value)==null?void 0:ee.updateTime),1)]}),_:1}),t(E,{label:"判题方式"},{default:a(()=>{var ee;return[x(q((ee=v.value)==null?void 0:ee.judgeType),1)]}),_:1}),t(E,{label:"评测数据"},{default:a(()=>{var ee;return[x(q((ee=v.value)==null?void 0:ee.judgeMd5),1)]}),_:1}),t(E,{label:"上传用户"},{default:a(()=>{var ee;return[x(q((ee=v.value)==null?void 0:ee.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),is=ce(rs,[["__scopeId","data-v-0098ef39"]]);function Wt(e){const l={};return l.id=e.id,l.ownerId=e.owner_id,l.ownerUsername=e.owner_username,l.ownerNickname=e.owner_nickname,l.title=e.title,e.start_time?l.startTime=new Date(e.start_time).toLocaleString():l.startTime="无限制",e.end_time?l.endTime=new Date(e.end_time).toLocaleString():l.endTime="无限制",e.update_time?l.updateTime=new Date(e.update_time).toLocaleString():l.updateTime="",e.create_time?l.createTime=new Date(e.create_time).toLocaleString():l.createTime="",e.description?l.description=e.description:l.description="",l.problems=e.problems,l}function us(e){return N({url:"/collection?id="+e,method:"get"})}function ds(e){return N({url:"/collection/edit?id="+e,method:"get"})}function cs(e,l){return N({url:"/collection/list?page="+e+"&page_size="+l,method:"get"})}function ms(e){return N({url:"/collection/rank?id="+e,method:"get"})}function ps(e){return N({url:"/collection/create",method:"post",data:e})}function fs(e){return N({url:"/collection/edit",method:"post",data:e})}function vs(e){return N({url:"/collection/join",method:"post",data:{id:e}})}function _s(e){return N({url:"/collection/quit",method:"post",data:{id:e}})}const gs={style:{margin:"10px"}},bs=de({__name:"CollectionList",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=null;m(!1),m(!1);const y=m([{title:"ID",colKey:"id",width:"100",cell:(d,w)=>t(G,{variant:"text",onClick:()=>C(w.row.id)},{default:()=>[w.row.id]})},{title:"标题",colKey:"title",cell:(d,w)=>t(G,{variant:"text",onClick:()=>C(w.row.id)},{default:()=>[w.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),v=m(!1);let S=1,f=50;const s=m({current:S,pageSize:f,defaultCurrent:S,defaultPageSize:f,total:0,pageSizeOptions:[50,100]}),$=m(),p=m({title:"",username:""});m({title:"",description:"",open_time:[]});const C=d=>{d&&n.push({path:"/collection/"+d})},_=async()=>{await n.push({query:{...l.query,title:p.value.title,username:p.value.username,page:1,page_size:s.value.defaultPageSize}})},g=async(d,w)=>{var c;v.value=!0;try{const{current:r,pageSize:j}=d,b=await cs(r,j);if($.value=[],b.code===0){const k=b.data.list;for(let U=0;U<k.length;U++){const I=k[U],T=Wt(I);(c=$.value)==null||c.push(T)}s.value={...s.value,total:b.data.total_count}}else w&&O(i,b.code)}catch(r){console.error(r),O(i,Ne())}finally{v.value=!1}},h=async d=>{await n.push({query:{...l.query,page:d.current,page_size:d.pageSize}})},u=async()=>{await n.push({name:"collection-create"})};return fe(async()=>{o=$e(()=>l.query,d=>{p.value.title=d.title||"",p.value.username=d.username||"";const w=parseInt(d.page)||s.value.defaultCurrent,c=parseInt(d.page_size)||s.value.defaultPageSize;S=w,f=c,s.value={...s.value,current:S,pageSize:f},g({current:S,pageSize:f},!0)},{immediate:!0})}),De(()=>{o&&o()}),(d,w)=>{const c=Ee,r=he,j=Te,b=Ae,k=ze,U=G,I=Ue,T=we,R=Ie;return D(),M(R,null,{default:a(()=>[t(j,{span:9},{default:a(()=>[t(r,{style:{margin:"10px"}},{default:a(()=>[t(c,{data:$.value,columns:y.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:s.value,loading:v.value,onPageChange:h},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(j,{span:3},{default:a(()=>[A("div",gs,[t(r,{class:"sh-card"},{default:a(()=>[t(I,{model:p.value},{default:a(()=>[t(k,{label:"标题"},{default:a(()=>[t(b,{modelValue:p.value.title,"onUpdate:modelValue":w[0]||(w[0]=z=>p.value.title=z),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(k,{label:"负责人"},{default:a(()=>[t(b,{modelValue:p.value.username,"onUpdate:modelValue":w[1]||(w[1]=z=>p.value.username=z),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(k,null,{default:a(()=>[t(U,{theme:"primary",onClick:_},{default:a(()=>w[2]||(w[2]=[x("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(r,{class:"sh-card"},{default:a(()=>[t(T,null,{default:a(()=>[t(U,{onClick:u},{default:a(()=>w[3]||(w[3]=[x("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),hs=ce(bs,[["__scopeId","data-v-3c9d295e"]]),ys={style:{margin:"20px"}},ws={class:"dida-operation-container"},ks={style:{margin:"12px"}},Ss=de({__name:"CollectionDetail",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze(),o=Fe();let y=0;const v=m(!1),S=m(null),f=m(!1),s=m(!1);let $={};const p=Be(()=>o.hasAuth(Le.ManageCollection)||S.value&&o.getUserId==S.value.ownerId),C=w=>{if(!w||!$)return"default";const c=$[w];if(!c)return"default";switch(c){case Oe.Accept:return"success";case Oe.Attempt:return"warning";default:return"default"}},_=m([{title:"问题ID",colKey:"id",cell:(w,c)=>{const r=C(c.row.id);return t(G,{variant:"dashed",theme:r,onClick:()=>ta(c.row.id)},{default:()=>[c.row.id]})}},{title:"标题",colKey:"title",cell:(w,c)=>t(G,{variant:"text",onClick:()=>ta(c.row.id)},{default:()=>[c.row.title]})},{title:"正确",colKey:"accept",cell:(w,c)=>c.row.accept?c.row.accept:0},{title:"提交",colKey:"attempt",cell:(w,c)=>c.row.attempt?c.row.attempt:0}]),g=m([]),h=async()=>{if(!o.isLogin()){await X.push({name:"login"});return}s.value=!0;try{const w=await vs(y);if(w.code!==0){O(n,w.code);return}f.value=!0,Ke(n,"加入成功")}finally{s.value=!1}},u=async()=>{if(!o.isLogin()){await X.push({name:"login"});return}s.value=!0;try{const w=await _s(y);if(w.code!==0){O(n,w.code);return}f.value=!1,Ke(n,"退出成功")}finally{s.value=!1}},d=()=>{S.value&&X.push({name:"collection-edit",params:{collectionId:S.value.id}})};return fe(async()=>{if(Array.isArray(l.params.collectionId)?y=Number(l.params.collectionId[0]):y=Number(l.params.collectionId),!y){await X.push({name:"problem-collection-list"});return}f.value=!1,v.value=!0;const w=await us(y);if(w.code!==0){v.value=!1,O(n,w.code),await X.push({name:"problem-collection-list"});return}f.value=w.data.joined,$=w.data.attempt_status||{},S.value=Wt(w.data.collection),g.value=[],w.data.collection.problems&&w.data.collection.problems.forEach(c=>{const r=w.data.problems.find(j=>j.id===c);g.value.push(r)}),i.setTitle(S.value.title+" - "+i.getTitle),v.value=!1}),(w,c)=>{const r=Sa,j=ka,b=Ee,k=he,U=Te,I=G,T=we,R=Je,z=We,V=Re("md-preview"),P=Ie,L=Ve;return D(),M(L,{loading:v.value},{default:a(()=>[t(P,{class:"dida-main-content"},{default:a(()=>[t(U,{span:6},{default:a(()=>[A("div",ys,[t(j,{"max-item-width":"300"},{default:a(()=>[t(r,{to:{name:"problem-collection-list"}},{default:a(()=>c[0]||(c[0]=[x("题目集合")])),_:1}),t(r,null,{default:a(()=>{var E;return[x(q((E=S.value)==null?void 0:E.title),1)]}),_:1})]),_:1})]),t(k,{style:{margin:"10px"}},{default:a(()=>[t(b,{data:g.value,columns:_.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),_:1})]),_:1}),t(U,{span:6},{default:a(()=>{var E;return[A("div",ws,[t(T,null,{default:a(()=>[f.value?(D(),M(I,{key:0,onClick:u,loading:s.value},{default:a(()=>c[1]||(c[1]=[x("退出")])),_:1},8,["loading"])):(D(),M(I,{key:1,onClick:h,loading:s.value},{default:a(()=>c[2]||(c[2]=[x("加入")])),_:1},8,["loading"])),p.value?(D(),M(I,{key:2,onClick:d},{default:a(()=>c[3]||(c[3]=[x("编辑")])),_:1})):le("",!0)]),_:1})]),A("div",ks,[t(z,{layout:"vertical",bordered:!0},{default:a(()=>[t(R,{label:"创建者"},{default:a(()=>{var H;return[x(q((H=S.value)==null?void 0:H.ownerNickname),1)]}),_:1})]),_:1}),t(z,{layout:"vertical",bordered:!0},{default:a(()=>[t(R,{label:"开始时间"},{default:a(()=>{var H;return[x(q((H=S.value)==null?void 0:H.startTime),1)]}),_:1})]),_:1}),t(z,{layout:"vertical",bordered:!0},{default:a(()=>[t(R,{label:"结束时间"},{default:a(()=>{var H;return[x(q((H=S.value)==null?void 0:H.endTime),1)]}),_:1})]),_:1})]),(E=S.value)!=null&&E.description?(D(),M(k,{key:0,style:{margin:"10px"}},{default:a(()=>{var H;return[t(V,{"model-value":(H=S.value)==null?void 0:H.description},null,8,["model-value"])]}),_:1})):le("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),Cs=ce(Ss,[["__scopeId","data-v-042bd4bb"]]),Is=de({__name:"CollectionRank",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=null,y=0,v=0;const S=m([{title:"Rank",colKey:"rank",align:"center"},{title:"序号",colKey:"index",align:"center"},{title:"Username",colKey:"username",cell:(C,_)=>t(G,{variant:"text",onClick:()=>n.push({name:"user",params:{username:_.row.username}})},{default:()=>[_.row.username]})},{title:"昵称",colKey:"nickname",cell:(C,_)=>t(G,{variant:"text",onClick:()=>n.push({name:"user",params:{username:_.row.username}})},{default:()=>[_.row.nickname]})},{title:"Count",colKey:"count",cell:(C,_)=>t(G,{variant:"text",onClick:()=>n.push({name:"judge-list",query:{username:_.row.username,status:He.Accept}})},{default:()=>[`${_.row.accept} / ${v}`]})},{title:"Progress",colKey:"progress",cell:(C,_)=>{let g=100;return v>0&&(g=Number((_.row.accept/v*100).toFixed(2))),t(qt,{percentage:g},null)}}]),f=m(!1),s=m([]),$=({col:C,rowIndex:_})=>{let g=1;for(let h=_+1;h<s.value.length&&s.value[h].rank===s.value[_].rank;h++)g++;if(C.colKey==="rank")return{rowspan:g}},p=async C=>{f.value=!0;try{const _=await ms(y);if(s.value=[],_.code===0){v=_.data.problem;const g=_.data.ranks,h=[];if(g){for(let w=0;w<g.length;w++){const c=g[w];let r={userId:c.author_id,username:c.author_username,nickname:c.author_nickname};r.accept=c.accept,h.push(r)}h.sort((w,c)=>w.accept!==c.accept?c.accept-w.accept:w.userId-c.userId);let u=0,d=-1;for(let w=0;w<h.length;w++)h[w].accept!==d&&(u=w+1,d=h[w].accept),h[w].index=w+1,h[w].rank=u}s.value=h}else C&&O(i,_.code)}catch(_){console.error(_),O(i,Ne())}finally{f.value=!1}};return fe(async()=>{o=$e(()=>l.query,async()=>{if(Array.isArray(l.params.collectionId)?y=Number(l.params.collectionId[0]):y=Number(l.params.collectionId),!y){await n.push({name:"problem-collection-list"});return}await p(!0)},{immediate:!0})}),De(()=>{o&&o()}),(C,_)=>{const g=Ee,h=he,u=Ie;return D(),M(u,null,{default:a(()=>[t(h,{style:{margin:"10px"}},{default:a(()=>[A("div",null,[t(g,{data:s.value,columns:S.value,"row-key":"index","rowspan-and-colspan":$,"vertical-align":"middle",bordered:!0,hover:!0,loading:f.value},null,8,["data","columns","loading"])])]),_:1})]),_:1})}}});var qe=(e=>(e[e.Valid=0]="Valid",e[e.Duplicate=1]="Duplicate",e[e.Invalid=2]="Invalid",e))(qe||{});const Ps={class:"dida-form-border"},xs={style:{"text-align":"right"}},Ts=de({name:"ParseProblemList",__name:"ParseProblemList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:l}=_e(),n=m(!1),i=m(!1),o=m(""),y=ba(e,"modelValue");let v=[];$e(y,async C=>{JSON.stringify(C)!==JSON.stringify(v)&&(await s(C),v=y.value)},{deep:!0});const S=m([]),f=m([{title:"有效性",colKey:"validType",cell:(C,_)=>{switch(_.row.valid){case qe.Valid:return t(et,{theme:"success"},{default:()=>[x("有效")]});case qe.Duplicate:return t(et,{theme:"warning"},{default:()=>[x("重复")]});case qe.Invalid:return t(et,{theme:"danger"},{default:()=>[x("无效")]});default:return null}}},{title:"问题ID",colKey:"id"},{title:"标题",colKey:"title"}]),s=async C=>{const _=Array.from(new Set(C)),g=await Dn(_);if(g.code!==0){O(l,g.code),i.value=!1;return}const h=[],u=g.data.problems;let d=[];C.forEach(w=>{const c=u.find(r=>r.id===w);if(c){const r=h.find(j=>j.id===w);c.valid=r?qe.Duplicate:qe.Valid,h.push({id:w,title:c.title,valid:c.valid}),r||d.push(w)}else h.push({id:w,title:"-",valid:qe.Invalid})}),S.value=h,v=d,y.value=d},$=async()=>{i.value=!0;const C=Pa(o.value);await s(C),n.value=!1,i.value=!1},p=()=>{S.value?o.value=S.value.map(C=>C.id).join(`
`):o.value="",n.value=!0};return(C,_)=>{const g=G,h=Ee,u=It,d=nt;return D(),ae(pe,null,[A("div",Ps,[A("div",xs,[t(g,{onClick:p},{default:a(()=>_[2]||(_[2]=[x("编辑")])),_:1})]),t(h,{data:S.value,columns:f.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(d,{visible:n.value,"onUpdate:visible":_[1]||(_[1]=w=>n.value=w),onConfirm:$,header:"请输入问题ID","confirm-loading":i.value},{default:a(()=>[_[3]||(_[3]=A("div",{style:{"margin-bottom":"10px"}},[A("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(u,{modelValue:o.value,"onUpdate:modelValue":_[0]||(_[0]=w=>o.value=w),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Ea=ce(Ts,[["__scopeId","data-v-7f4ce589"]]),Vs={class:"dida-form-border"},Ds={style:{"text-align":"right"}},js=de({name:"ParseUserList",__name:"ParseUserList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:l}=_e(),n=m(!1),i=m(!1),o=m(""),y=ba(e,"modelValue");let v=[];$e(y,async g=>{JSON.stringify(g)!==JSON.stringify(v)&&(v=g,await $(g))},{deep:!0});const S=m(),f=m([{title:"有效性",colKey:"validType",cell:(g,h)=>{switch(h.row.valid){case qe.Valid:return t(et,{theme:"success"},{default:()=>[x("有效")]});case qe.Duplicate:return t(et,{theme:"warning"},{default:()=>[x("重复")]});case qe.Invalid:return t(et,{theme:"danger"},{default:()=>[x("无效")]})}}},{title:"Username",colKey:"username"},{title:"昵称",colKey:"nickname"}]),s=(g,h)=>{if(g.code!==0){O(l,g.code),i.value=!1;return}const u=[],d=g.data.users;let w=[];h?h.forEach(c=>{let r=null;if(d&&(r=d.find(j=>j.username.toLowerCase()===c.toLowerCase())),r){const j=u.find(k=>k.username.toLowerCase()===c.toLowerCase()),b=j?qe.Duplicate:qe.Valid;u.push({id:r.id,username:r.username,nickname:r.nickname,valid:b}),j||w.push(r.id)}else u.push({id:-1,username:c,nickname:"-",valid:qe.Invalid})}):d&&d.forEach(c=>{const r=u.find(b=>b.id===c.id),j=r?qe.Duplicate:qe.Valid;u.push({id:c.id,username:c.username,nickname:c.nickname,valid:j}),r||w.push(c.id)}),S.value=u,v=w,y.value=w},$=async g=>{const h=Array.from(new Set(g)),u=await Fn(h);s(u)},p=async g=>{const h=Array.from(new Set(g)),u=await On(h);s(u,g)},C=async()=>{i.value=!0;const g=Pa(o.value);await p(g),n.value=!1,i.value=!1},_=()=>{S.value?o.value=S.value.map(g=>g.username).join(`
`):o.value="",n.value=!0};return(g,h)=>{const u=G,d=Ee,w=It,c=nt;return D(),ae(pe,null,[A("div",Vs,[A("div",Ds,[t(u,{onClick:_},{default:a(()=>h[2]||(h[2]=[x("编辑")])),_:1})]),t(d,{data:S.value,columns:f.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(c,{visible:n.value,"onUpdate:visible":h[1]||(h[1]=r=>n.value=r),onConfirm:C,header:"请输入用户Username","confirm-loading":i.value},{default:a(()=>[h[3]||(h[3]=A("div",{style:{"margin-bottom":"10px"}},[A("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(w,{modelValue:o.value,"onUpdate:modelValue":h[0]||(h[0]=r=>o.value=r),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Ma=ce(js,[["__scopeId","data-v-d2170a86"]]),Ls={style:{margin:"10px"}},$s={style:{margin:"12px"}},Us={class:"dida-edit-container"},zs=de({__name:"CollectionEdit",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze(),o=m(""),y=m(!1),v=m(!1),S=m(!1),f=m(null),s=m({title:"",openTime:[],private:!0,problems:[],members:[],description:""}),$=m(""),p=m(""),C=m(!1),_=async()=>{C.value=!0,S.value=!1,C.value=!1},g=async()=>{v.value=!0;try{const c={title:s.value.title,problems:s.value.problems,members:s.value.members,private:s.value.private,description:s.value.description};s.value.openTime[0]&&(c.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(c.end_time=new Date(s.value.openTime[1]));const r=await ps(c);if(r.code!==0){O(n,r.code);return}r.data!=null&&await X.push({name:"collection-detail",params:{collectionId:r.data}}),Ke(n,"创建成功")}finally{v.value=!1}},h=async()=>{v.value=!0;try{const c={id:Number(o.value),title:s.value.title,private:s.value.private,problems:s.value.problems,members:s.value.members,description:s.value.description};s.value.openTime[0]&&(c.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(c.end_time=new Date(s.value.openTime[1]));const r=await fs(c);if(r.code!==0){O(n,r.code);return}r.data!=null&&f.value&&(f.value.updateTime=new Date(r.data).toLocaleString()),Ke(n,"保存成功")}finally{v.value=!1}},u=c=>{s.value.description=c,y.value=!1};async function d(c,r){v.value=!0,ge(n,"本界面暂不支持上传图片"),v.value=!1}const w=async()=>{const c=await ds(o.value);if(c.code!==0){O(n,c.code),console.error("collection get failed",c.code),await X.push({name:"problem-collection-list"});return}const r=c.data.collection;f.value=Wt(r),s.value.title=r.title,s.value.openTime=[],r.start_time?s.value.openTime.push(new Date(r.start_time)):s.value.openTime.push(""),r.end_time?s.value.openTime.push(new Date(r.end_time)):s.value.openTime.push(""),s.value.private=r.private,s.value.description=r.description,s.value.problems=r.problems,s.value.members=r.members,i.setTitle(r.title+" - "+i.getTitle);let j="";r.description&&(j=r.description),u(j)};return fe(async()=>{Array.isArray(l.params.collectionId)?o.value=l.params.collectionId[0]:o.value=l.params.collectionId,o.value?(y.value=!0,await w()):u("")}),(c,r)=>{const j=Ae,b=ze,k=Ft,U=vt,I=Ue,T=he,R=Te,z=G,V=we,P=Je,L=We,E=Ie,H=Re("md-editor-v3"),Z=Ve,Q=It,ee=nt;return D(),ae(pe,null,[t(Z,{loading:y.value},{default:a(()=>[t(E,null,{default:a(()=>[t(R,{span:8},{default:a(()=>[A("div",Ls,[t(T,{class:"sh-card"},{default:a(()=>[t(I,{model:s.value},{default:a(()=>[t(b,{label:"标题"},{default:a(()=>[t(j,{modelValue:s.value.title,"onUpdate:modelValue":r[0]||(r[0]=te=>s.value.title=te),placeholder:"题集标题"},null,8,["modelValue"])]),_:1}),t(b,{label:"开启时间"},{default:a(()=>[t(k,{modelValue:s.value.openTime,"onUpdate:modelValue":r[1]||(r[1]=te=>s.value.openTime=te),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(b,{label:"私有"},{default:a(()=>[t(U,{modelValue:s.value.private,"onUpdate:modelValue":r[2]||(r[2]=te=>s.value.private=te)},null,8,["modelValue"])]),_:1}),t(b,{label:"成员"},{default:a(()=>[t(Ma,{modelValue:s.value.members,"onUpdate:modelValue":r[3]||(r[3]=te=>s.value.members=te)},null,8,["modelValue"])]),_:1}),t(b,{label:"问题"},{default:a(()=>[t(Ea,{modelValue:s.value.problems,"onUpdate:modelValue":r[4]||(r[4]=te=>s.value.problems=te)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(R,{span:4},{default:a(()=>[A("div",$s,[A("div",Us,[o.value?(D(),M(V,{key:0},{default:a(()=>[t(z,{onClick:h,theme:"danger",loading:v.value},{default:a(()=>r[8]||(r[8]=[x("保存")])),_:1},8,["loading"])]),_:1})):(D(),M(V,{key:1},{default:a(()=>[t(z,{onClick:g,theme:"danger",loading:v.value},{default:a(()=>r[9]||(r[9]=[x("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(D(),M(L,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(P,{label:"创建时间"},{default:a(()=>{var te;return[x(q((te=f.value)==null?void 0:te.createTime),1)]}),_:1}),t(P,{label:"更新时间"},{default:a(()=>{var te;return[x(q((te=f.value)==null?void 0:te.updateTime),1)]}),_:1}),t(P,{label:"创建用户"},{default:a(()=>{var te;return[x(q((te=f.value)==null?void 0:te.ownerNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),t(H,{id:"collection-description-editor",modelValue:s.value.description,"onUpdate:modelValue":r[5]||(r[5]=te=>s.value.description=te),onSave:h,onOnUploadImg:d,previewTheme:"cyanosis",class:"dida-description-editor"},null,8,["modelValue"]),t(Z,{loading:v.value,attach:"#collection-description-editor","z-index":1e5},null,8,["loading"])]),_:1},8,["loading"]),t(ee,{visible:S.value,"onUpdate:visible":r[7]||(r[7]=te=>S.value=te),onConfirm:_,header:$.value,"confirm-loading":C.value},{default:a(()=>[r[10]||(r[10]=A("div",{style:{"margin-bottom":"10px"}},[A("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(Q,{modelValue:p.value,"onUpdate:modelValue":r[6]||(r[6]=te=>p.value=te),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),oa=ce(zs,[["__scopeId","data-v-2a875f8a"]]);function sa(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const As=de({__name:"JudgeJobList",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=!1,y=null,v;const S=m(!1),f=m(null),s=m(!1);let $=-1;const p=m({problemId:"",username:"",language:void 0,status:void 0}),C=m([{title:"ID",colKey:"id",cell:(V,P)=>{let L=null;return wt(P.row.status)&&yt(P.row.language)&&(L=()=>{k(P.row.id)}),t(G,{variant:"text",onClick:L},{default:()=>[P.row.id]})}},{title:"问题",colKey:"problemId",cell:(V,P)=>{if($){let L;return t(G,{variant:"text",onClick:()=>b($,P.row.contestProblemIndex)},sa(L=at(P.row.contestProblemIndex))?L:{default:()=>[L]})}return t(G,{variant:"text",onClick:()=>j(P.row.problemId)},{default:()=>[P.row.problemId]})}},{title:"状态",colKey:"status",align:"center",cell:(V,P)=>{let L=null;wt(P.row.status)&&yt(P.row.language)&&(L=()=>{k(P.row.id)});const E=P.row.status,H=St(E);let Z=!wt(E);const Q=Va(E);let ee=[];return it(E)&&ee.push(t(Ve,{text:P.row.state,size:"small",class:"dida-status-loading"},null)),ee.push(t("span",null,[H])),t(G,{theme:Q,variant:"outline",onClick:L,disabled:Z},sa(ee)?ee:{default:()=>[ee]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"code",cell:(V,P)=>{let L=!yt(P.row.language);return t(G,{theme:"default",onClick:()=>r(P.row),disabled:L},{default:()=>[kt(P.row.language)+" / "+P.row.codeLength]})}},{title:"作者",colKey:"author",width:200,cell:(V,P)=>t(G,{variant:"text",onClick:()=>U(P.row.authorUsername)},{default:()=>[P.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),_=m(!1);let g=1,h=50;const u=m({current:g,pageSize:h,defaultCurrent:g,defaultPageSize:h,total:0,pageSizeOptions:[50,100]}),d=m(),w=m([]);w.value=Ot();const c=m([]);c.value=Da();const r=async V=>{s.value=!0,S.value=!0;try{f.value=V;const P=await sn(Number(f.value.id));if(P.code===0){const L=P.data,E=Gt(L.language);f.value.code=`\`\`\`${E}
${L.code}
\`\`\``}else O(i,P.code)}finally{s.value=!1}},j=V=>{V&&n.push({path:"/problem/"+V})},b=(V,P)=>{n.push({name:"contest-problem-detail",params:{contestId:V,problemIndex:P}})},k=V=>{V&&($>0?n.push({name:"contest-judge-detail",params:{contestId:$,judgeId:V}}):n.push({name:"judge-detail",params:{judgeId:V}}))},U=V=>{V&&n.push({path:"/user/"+V})},I=async()=>{await n.push({query:{...l.query,page:1,page_size:h,problem_id:p.value.problemId,username:p.value.username,language:p.value.language,status:p.value.status}})},T=async()=>{p.value.problemId="",p.value.username="",p.value.language=void 0,p.value.status=void 0,await n.push({query:{...l.query,page:1,page_size:h,problem_id:"",username:"",language:void 0,status:void 0}})},R=async(V,P)=>{P&&(_.value=!0);let L=!1;try{const{current:E,pageSize:H}=V,Z=await rn($,p.value.problemId,p.value.username,p.value.language,p.value.status,E,H);if(d.value=[],Z.code===0){if(!Z.data.has_auth){ke(i,"您目前没有权限查看评测记录"),$?await n.push({name:"contest-detail",params:{contestId:$}}):await n.push({name:"judge-list"});return}Z.data.list&&Z.data.list.length>0?(Z.data.list.forEach(ee=>{var F;const te=ja(ee);(F=d.value)==null||F.push(te),it(ee.status)&&(L=!0)}),u.value={...u.value,total:Z.data.total_count}):(ke(i,"未找到记录"),u.value={...u.value,total:0})}else P&&O(i,Z.code)}catch(E){console.error(E),P&&O(i,Ne())}finally{P&&(_.value=!1),L&&o&&(v=setTimeout(()=>{R({current:g,pageSize:h},!1)},5e3))}},z=async V=>{await n.push({query:{...l.query,page:V.current,page_size:V.pageSize}})};return fe(async()=>{o=!0,y=$e(()=>l.query,V=>{Array.isArray(l.params.contestId)?$=Number(l.params.contestId[0]):$=Number(l.params.contestId),p.value.problemId=V.problem_id||"",p.value.username=V.username||"",V.language!=null?p.value.language=Number(V.language):p.value.language=void 0,V.status!=null?p.value.status=Number(V.status):p.value.status=void 0;const P=parseInt(V.page)||u.value.defaultCurrent,L=parseInt(V.page_size)||u.value.defaultPageSize;g=P,h=L,u.value.pageSizeOptions.includes(h)||(h=u.value.defaultPageSize),u.value={...u.value,current:g,pageSize:h},R({current:g,pageSize:h},!0)},{immediate:!0})}),De(()=>{o=!1,y&&y(),clearTimeout(v)}),(V,P)=>{const L=Ae,E=ze,H=Kt,Z=ft,Q=G,ee=we,te=Ue,F=Ee,me=he,ie=lt,W=Re("md-preview"),J=Ve,ne=nt;return D(),ae(pe,null,[t(me,{style:{margin:"10px"}},{default:a(()=>[t(te,{layout:"inline",onSubmit:I,onReset:T},{default:a(()=>[t(E,{label:"题号"},{default:a(()=>[t(L,{modelValue:p.value.problemId,"onUpdate:modelValue":P[0]||(P[0]=K=>p.value.problemId=K),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(E,{label:"用户"},{default:a(()=>[t(L,{modelValue:p.value.username,"onUpdate:modelValue":P[1]||(P[1]=K=>p.value.username=K),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(E,{label:"语言"},{default:a(()=>[t(Z,{modelValue:p.value.language,"onUpdate:modelValue":P[2]||(P[2]=K=>p.value.language=K),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:a(()=>[(D(!0),ae(pe,null,Pe(w.value,K=>(D(),M(H,{key:K.value,value:K.value,label:K.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(E,{label:"状态"},{default:a(()=>[t(Z,{modelValue:p.value.status,"onUpdate:modelValue":P[3]||(P[3]=K=>p.value.status=K),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:a(()=>[(D(!0),ae(pe,null,Pe(c.value,K=>(D(),M(H,{key:K.value,value:K.value,label:K.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(E,null,{default:a(()=>[t(ee,null,{default:a(()=>[t(Q,{theme:"primary",type:"submit"},{default:a(()=>P[7]||(P[7]=[x("搜索")])),_:1}),t(Q,{theme:"default",variant:"base",type:"reset"},{default:a(()=>P[8]||(P[8]=[x("重置")])),_:1})]),_:1})]),_:1})]),_:1}),t(F,{data:d.value,columns:C.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:u.value,loading:_.value,onPageChange:z,"table-layout":"auto"},null,8,["data","columns","pagination","loading"])]),_:1}),t(ne,{visible:S.value,"onUpdate:visible":P[5]||(P[5]=K=>S.value=K),width:"800px","cancel-btn":null,"close-btn":!1,onConfirm:P[6]||(P[6]=K=>S.value=!1)},{header:a(()=>[t(ie,{onClick:P[4]||(P[4]=()=>{var K;k((K=f.value)==null?void 0:K.id)})},{default:a(()=>{var K,B,ue;return[x(q(((K=f.value)==null?void 0:K.id)+" - "+ve(kt)((B=f.value)!=null&&B.language?(ue=f.value)==null?void 0:ue.language:ve(Tt).Unknown)),1)]}),_:1})]),default:a(()=>[t(J,{loading:s.value},{default:a(()=>{var K;return[t(W,{"model-value":(K=f.value)==null?void 0:K.code,"code-foldable":!1,style:{"min-height":"100px"}},null,8,["model-value"])]}),_:1},8,["loading"])]),_:1},8,["visible"])],64)}}}),ra=ce(As,[["__scopeId","data-v-05589c5c"]]),Rs={class:"dida-code-container"},Es={style:{margin:"20px"}},Ms={key:2,class:"dida-edit-container"};function ia(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const qs=de({__name:"JudgeJobDetail",setup(e){const l=Se(),n=Xe(),i=Fe(),{globalProperties:o}=_e();let y=!1,v,S=0,f=0;const s=m(""),$=m(null),p=m(""),C=m(0),_=m(null),g=m({from:"#5a96ff",to:"#00A870"}),h=m([{title:"ID",colKey:"id"},{title:"问题",colKey:"problemId",cell:(I,T)=>t(G,{variant:"text",onClick:()=>j(T.row.problemId)},{default:()=>[T.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(I,T)=>{const R=T.row.status,z=St(R),V=Va(R);let P=[];return it(R)&&P.push(t(Ve,{text:T.row.state,size:"small",class:"dida-status-loading"},null)),P.push(t("span",null,[z])),t(G,{theme:V,variant:"outline"},ia(P)?P:{default:()=>[P]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"language",cell:(I,T)=>t("span",null,[kt(T.row.language)+" / "+T.row.codeLength])},{title:"作者",colKey:"author",width:200,cell:(I,T)=>t(G,{variant:"text",onClick:()=>b(T.row.authorUsername)},{default:()=>[T.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),u=m(!1),d=m(!1),w=m(),c=Be(()=>i.hasAuth(Le.ManageJudge)),r=async()=>{if(!d.value){d.value=!0;try{const I=await pn(S);I.code===0?await U(!0):O(o,I.code)}catch(I){console.error(I),O(o,Ne())}finally{d.value=!1}}},j=I=>{I&&n.push({path:"/problem/"+I})},b=I=>{I&&n.push({path:"/user/"+I})},k=I=>{const T=I.status,R=St(T);let z;switch(T){case He.Init:case He.Rejudge:case He.Compiling:case He.Running:z="default";break;case He.Accept:z="success";break;case He.PE:z="warning";break;default:z="danger";break}return t(we,null,{default:()=>[t(G,{theme:"default",variant:"outline"},{default:()=>[I.taskId]}),t(G,{theme:z,variant:"outline"},ia(R)?R:{default:()=>[R]}),t("span",null,[x("分数："),I.score]),t("span",null,[x("用时："),I.time]),t("span",null,[x("内存："),I.memory])]})},U=async I=>{var R;I&&(u.value=!0);let T=!1;try{const z=await on(S);if(w.value=[],z.code===0){const V=z.data,P=ja(V);if((R=w.value)==null||R.push(P),s.value=P.judgerName,g.value.to="#00A870",it(V.status)?(_.value="active",P.taskTotal>0?(C.value=Number((P.taskCurrent/P.taskTotal*100).toFixed(2)),P.taskCurrent>=P.taskTotal&&(C.value=99)):C.value=0):(C.value=100,V.status===He.Accept?_.value="success":V.status===He.PE?(g.value.to="#F57C20",_.value="warning"):(g.value.to="#F56C6C",_.value="error")),V.code){const L=Gt(V.language);p.value=`\`\`\`${L}
${V.code}
\`\`\``}$.value=P,it(V.status)&&(T=!0)}else I&&O(o,z.code),f?await n.push({name:"contest-judge",params:{contestId:f}}):await n.push({name:"judge-list"})}catch(z){console.error(z),I&&O(o,Ne())}finally{I&&(u.value=!1),T&&y&&(v=setTimeout(()=>{U(!1)},5e3))}};return fe(async()=>{if(y=!0,Array.isArray(l.params.judgeId)?S=Number(l.params.judgeId[0]):S=Number(l.params.judgeId),Array.isArray(l.params.contestId)?f=Number(l.params.contestId[0]):f=Number(l.params.contestId),!S){await n.push({name:"judge"});return}await U(!0)}),De(()=>{y=!1,clearTimeout(v)}),(I,T)=>{var F,me,ie;const R=qt,z=Ee,V=he,P=Re("md-preview"),L=Te,E=Je,H=We,Z=Ie,Q=Sl,ee=Cl,te=G;return D(),ae(pe,null,[t(R,{color:g.value,status:_.value,class:"dida-job-progress",percentage:C.value},null,8,["color","status","percentage"]),t(V,{style:{margin:"10px"}},{default:a(()=>[t(z,{data:w.value,columns:h.value,"row-key":"id","vertical-align":"top",hover:!0,loading:u.value},null,8,["data","columns","loading"])]),_:1}),t(Z,null,{default:a(()=>[t(L,{span:8},{default:a(()=>[A("div",Rs,[t(P,{"model-value":p.value,class:"dida-code-div"},null,8,["model-value"])])]),_:1}),t(L,{span:4},{default:a(()=>[A("div",Es,[t(H,{layout:"vertical",bordered:!0},{default:a(()=>[t(E,{label:"判题机"},{default:a(()=>[x(q(s.value),1)]),_:1}),t(E,{label:"判题时间"},{default:a(()=>{var W;return[x(q((W=$.value)==null?void 0:W.judgeTime),1)]}),_:1})]),_:1}),t(V,{class:"dida-card-tips"},{default:a(()=>{var W;return[x(q(u.value?"数据正在加载，请等待":ve(ea)((W=$.value)==null?void 0:W.status)),1)]}),_:1})])]),_:1})]),_:1}),(F=$.value)!=null&&F.compileMessage?(D(),M(V,{key:0,class:"compile-message"},{default:a(()=>{var W;return[x(q((W=$.value)==null?void 0:W.compileMessage),1)]}),_:1})):le("",!0),(me=$.value)!=null&&me.task&&((ie=$.value)==null?void 0:ie.task.length)>0?(D(),M(ee,{key:1,class:"task-panel"},{default:a(()=>{var W;return[(D(!0),ae(pe,null,Pe((W=$.value)==null?void 0:W.task,(J,ne)=>(D(),M(Q,{key:J.taskId,header:()=>k(J)},{default:a(()=>[t(V,null,{default:a(()=>[x(q(ve(ea)(J.status)),1)]),_:2},1024),J.content?(D(),M(V,{key:0,class:"dida-card-tips"},{default:a(()=>[t(P,{"model-value":J.content},null,8,["model-value"])]),_:2},1024)):le("",!0),J.waHint?(D(),M(V,{key:1,class:"dida-card-tips"},{default:a(()=>[t(P,{"model-value":J.waHint},null,8,["model-value"])]),_:2},1024)):le("",!0)]),_:2},1032,["header"]))),128))]}),_:1})):le("",!0),c.value?(D(),ae("div",Ms,[t(te,{onClick:r,loading:d.value},{default:a(()=>T[0]||(T[0]=[x("重新评测")])),_:1},8,["loading"])])):le("",!0)],64)}}}),ua=ce(qs,[["__scopeId","data-v-88602fda"]]),Ks={style:{margin:"10px"}},Fs=de({__name:"ContestList",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=null;const y=m([{title:"ID",colKey:"id",cell:(w,c)=>t(G,{variant:"text",onClick:()=>C(c.row.id)},{default:()=>[c.row.id]})},{title:"标题",colKey:"title",cell:(w,c)=>t(G,{variant:"text",onClick:()=>C(c.row.id)},{default:()=>[c.row.title]})},{title:"负责人",colKey:"ownerNickname",cell:(w,c)=>t(G,{variant:"text",onClick:()=>Bt(n,c.row.ownerUsername)},{default:()=>[c.row.ownerNickname]})},{title:"权限",colKey:"private",cell:(w,c)=>c.row.private?"私有":"公开"},{title:"开始时间",colKey:"startTime"},{title:"结束时间",colKey:"endTime"}]),v=m(!1);let S=1,f=50;const s=m({current:S,pageSize:f,defaultCurrent:S,defaultPageSize:f,total:0,pageSizeOptions:[50,100]}),$=m(),p=m({title:"",username:""}),C=w=>{w&&n.push({path:"/contest/"+w})},_=async()=>{await n.push({query:{...l.query,title:p.value.title,username:p.value.username,page:1,page_size:s.value.defaultPageSize}})},g=async()=>{p.value.title="",p.value.username="",await n.push({query:{...l.query,title:"",username:"",page:1,page_size:s.value.defaultPageSize}})},h=async(w,c)=>{var r;v.value=!0;try{const{current:j,pageSize:b}=w,k=await yo(p.value.title,p.value.username,j,b);if($.value=[],k.code===0){const U=k.data.list;for(let I=0;I<U.length;I++){const T=U[I],R=Ht(T);(r=$.value)==null||r.push(R)}s.value={...s.value,total:k.data.total_count}}else c&&O(i,k.code)}catch(j){console.error(j),O(i,Ne())}finally{v.value=!1}},u=async w=>{await n.push({query:{...l.query,page:w.current,page_size:w.pageSize}})},d=()=>{n.push({name:"contest-create"})};return fe(async()=>{o=$e(()=>l.query,w=>{p.value.title=w.title||"",p.value.username=w.username||"";const c=parseInt(w.page)||s.value.defaultCurrent,r=parseInt(w.page_size)||s.value.defaultPageSize;S=c,f=r,s.value={...s.value,current:S,pageSize:f},h({current:S,pageSize:f},!0)},{immediate:!0})}),De(()=>{o&&o()}),(w,c)=>{const r=Ee,j=he,b=Te,k=Ae,U=ze,I=G,T=we,R=Ue,z=Ie;return D(),M(z,null,{default:a(()=>[t(b,{span:9},{default:a(()=>[t(j,{style:{margin:"10px"}},{default:a(()=>[t(r,{data:$.value,columns:y.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:s.value,loading:v.value,"table-layout":"auto",onPageChange:u,style:{"white-space":"nowrap"}},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(b,{span:3},{default:a(()=>[A("div",Ks,[t(j,{class:"sh-card"},{default:a(()=>[t(R,{model:p.value,onSubmit:_,onReset:g},{default:a(()=>[t(U,{label:"标题"},{default:a(()=>[t(k,{modelValue:p.value.title,"onUpdate:modelValue":c[0]||(c[0]=V=>p.value.title=V),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(U,{label:"负责人"},{default:a(()=>[t(k,{modelValue:p.value.username,"onUpdate:modelValue":c[1]||(c[1]=V=>p.value.username=V),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(U,null,{default:a(()=>[t(T,null,{default:a(()=>[t(I,{theme:"primary",type:"submit"},{default:a(()=>c[2]||(c[2]=[x("提交")])),_:1}),t(I,{theme:"danger",type:"reset"},{default:a(()=>c[3]||(c[3]=[x("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(j,{class:"sh-card"},{default:a(()=>[t(T,null,{default:a(()=>[t(I,{onClick:d},{default:a(()=>c[4]||(c[4]=[x("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),da=ce(Fs,[["__scopeId","data-v-d94af270"]]),Os={style:{margin:"20px"}},Gs={style:{margin:"10px"}},Ns={style:{"text-align":"center","align-content":"center",padding:"20px",height:"500px"}},Hs={style:{"text-align":"center",width:"100%"}},Bs={class:"dida-operation-container"},Ws={style:{margin:"12px"}},Js=de({__name:"ContestDetail",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze(),o=Fe(),y=m(!1);let v=0;const S=m(!1),f=m(null),s=m(!1),$=m(!1),p=m(""),C=Be(()=>o.hasAuth(Le.ManageContest)||f.value&&o.getUserId==f.value.ownerId),_=b=>{if(!b||!u)return"default";const k=u[b];if(!k)return"default";switch(k){case Oe.Accept:return"success";case Oe.Attempt:return"warning";default:return"default"}},g=m([{title:"问题ID",colKey:"index",cell:(b,k)=>{const U=_(k.row.index);return t(G,{variant:"dashed",theme:U,onClick:async()=>await Mt(v,k.row.index)},{default:()=>[k.row.id]})}},{title:"标题",colKey:"title",cell:(b,k)=>t(G,{variant:"text",onClick:async()=>await Mt(v,k.row.index)},{default:()=>[k.row.title]})},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),h=m([]);let u={},d=m(!1);const w=()=>{X.push({name:"contest-edit",params:{contestId:v}})},c=async()=>{y.value=!0;try{const b=await Io(v);if(b.code!==0){O(n,b.code);return}const k=b.data;ke(n,"查重报告已生成，请前往查看"),window.open(k,"_blank")}finally{y.value=!1}},r=async b=>{if(!o.isLogin()){await X.push({name:"login"});return}if(!p.value){ge(n,"请输入密码");return}d.value=!0;try{const k=await Co(v,p.value);if(k.code!==0){O(n,k.code);return}ke(n,"申请访问成功"),await j()}catch(k){console.error("Error submitting contest password:",k),O(n,"提交密码失败，请稍后再试")}finally{d.value=!1}},j=async()=>{S.value=!0;const b=await vo(v);if(b.code!==0){S.value=!1,O(n,b.code),await X.push({name:"contest"});return}s.value=b.data.has_auth,$.value=b.data.need_password,f.value=Ht(b.data.contest),h.value=f.value.problems,u=b.data.attempt_status||{},i.setTitle(f.value.title+" - "+i.getTitle),S.value=!1};return fe(async()=>{if(Array.isArray(l.params.contestId)?v=Number(l.params.contestId[0]):v=Number(l.params.contestId),!v){await X.push({name:"contest"});return}await j()}),(b,k)=>{const U=Ct,I=Ee,T=he,R=Ae,z=ze,V=G,P=Ue,L=Te,E=we,H=Je,Z=We,Q=Re("md-preview"),ee=Ie,te=Ve;return D(),M(te,{loading:S.value},{default:a(()=>[t(ee,{class:"dida-main-content"},{default:a(()=>[t(L,{span:6},{default:a(()=>{var F,me,ie;return[A("div",Os,[A("h1",null,q((F=f.value)==null?void 0:F.title),1),(me=f.value)!=null&&me.notification?(D(),M(U,{key:0,theme:"info",message:(ie=f.value)==null?void 0:ie.notification},null,8,["message"])):le("",!0)]),A("div",Gs,[s.value?(D(),M(T,{key:0},{default:a(()=>[t(I,{data:h.value,columns:g.value,"row-key":"id","table-layout":"auto","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1})):(D(),M(T,{key:1},{default:a(()=>[A("div",Ns,[t(U,{theme:"warning",message:"您没有查看本比赛的权限"}),$.value?(D(),M(P,{key:0,style:{margin:"20px auto 0",width:"200px"},onSubmit:r,"label-width":"0"},{default:a(()=>[t(z,null,{default:a(()=>[t(R,{placeholder:"请输入密码",value:p.value,"onUpdate:value":k[0]||(k[0]=W=>p.value=W),style:{width:"300px"},type:"password",autocomplete:"new-password"},null,8,["value"])]),_:1}),t(z,null,{default:a(()=>[A("div",Hs,[t(V,{theme:"primary",type:"submit",loading:ve(d)},{default:a(()=>k[1]||(k[1]=[x("提交")])),_:1},8,["loading"])])]),_:1})]),_:1})):le("",!0)])]),_:1}))])]}),_:1}),t(L,{span:6},{default:a(()=>{var F;return[A("div",Bs,[t(E,null,{default:a(()=>[C.value?(D(),M(V,{key:0,onClick:c,loading:y.value},{default:a(()=>k[2]||(k[2]=[x("查重")])),_:1},8,["loading"])):le("",!0),C.value?(D(),M(V,{key:1,onClick:w},{default:a(()=>k[3]||(k[3]=[x("编辑")])),_:1})):le("",!0)]),_:1})]),A("div",Ws,[t(Z,{layout:"vertical",bordered:!0},{default:a(()=>[t(H,{label:"创建时间"},{default:a(()=>{var me;return[x(q((me=f.value)==null?void 0:me.createTime),1)]}),_:1})]),_:1}),t(Z,{layout:"vertical",bordered:!0},{default:a(()=>[t(H,{label:"更新时间"},{default:a(()=>{var me;return[x(q((me=f.value)==null?void 0:me.updateTime),1)]}),_:1})]),_:1}),t(Z,{layout:"vertical",bordered:!0},{default:a(()=>[t(H,{label:"开始时间"},{default:a(()=>{var me;return[x(q((me=f.value)==null?void 0:me.startTime),1)]}),_:1})]),_:1}),t(Z,{layout:"vertical",bordered:!0},{default:a(()=>[t(H,{label:"结束时间"},{default:a(()=>{var me;return[x(q((me=f.value)==null?void 0:me.endTime),1)]}),_:1})]),_:1})]),(F=f.value)!=null&&F.description?(D(),M(T,{key:0,style:{margin:"12px"}},{default:a(()=>{var me;return[t(Q,{"model-value":(me=f.value)==null?void 0:me.description,class:"dida-content-description"},null,8,["model-value"])]}),_:1})):le("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),Ys=ce(Js,[["__scopeId","data-v-af022b1b"]]);function qa(e){return e?Math.floor(e/1e9):0}function rt(e){if(e<=0)return"0秒";let l="";const n=Math.floor(e/3600);n>0&&(l+=`${n}小时`);const i=Math.floor(e%3600/60);return(i>0||n>0)&&(n>0&&i<10&&(l+="0"),l+=`${i}分钟`),e=e%60,(e>0||i>0||n>0)&&((n>0||i>0)&&e<10&&(l+="0"),l+=`${e.toFixed(0)}秒`),l}const Xs=pt("contest",{state:()=>({starMembers:{}}),actions:{clear(){this.$patch({starMembers:{}})},addStarMember(e,l){this.starMembers[e]||(this.starMembers[e]={}),this.starMembers[e][l]=!0},removeStarMember(e,l){this.starMembers[e]&&(delete this.starMembers[e][l],Object.keys(this.starMembers[e]).length===0&&delete this.starMembers[e])},isStarMember(e,l){var n;return!!((n=this.starMembers[e])!=null&&n[l])}},persist:!0}),Zs={style:{margin:"10px 10px 40px"}},Qs={style:{"text-align":"right","margin-bottom":"10px"}},er={class:"table-scroll-wrapper"};function ca(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const tr=de({__name:"ContestRank",setup(e){const l=Se(),n=Xe(),i=Xs(),{globalProperties:o}=_e();let y=!1,v=null,S=0,f=null,s=null,$=0;const p=m(0),C=m(0),_=m(!1),g=m(!0),h=m(!0);let u=null,d=null,w=1,c=50;const r=m({current:w,pageSize:c,defaultCurrent:1,defaultPageSize:50,total:0,pageSizeOptions:[50,100,1e3]}),j=W=>i&&i.isStarMember(S,W),b=async W=>{r.value={...r.value,current:W.current,pageSize:W.pageSize},await n.push({query:{...l.query,page:W.current,page_size:W.pageSize}})},k=W=>{if(W==null)return"-";const J=Math.floor(W/3600).toString().padStart(2,"0"),ne=Math.floor(W%3600/60).toString().padStart(2,"0"),K=(W%60).toFixed(0).toString().padStart(2,"0");return`${J}:${ne}:${K}`},U=m({}),I=[{title:"Rank",colKey:"rank",align:"center",fixed:"left"},{title:"昵称",colKey:"nickname",fixed:"left",attrs:W=>{let J={};return j(W.row.userId)&&(J={backgroundColor:"rgba(255,165,30,0.5)"}),{style:J}},cell:(W,J)=>{const ne=Kl(J.row.nickname,18);let K=null;return j(J.row.userId)?K=t(G,{shape:"circle",variant:"text",class:"rank-unstar-button",onClick:()=>{i.removeStarMember(S,J.row.userId),F()}},{default:()=>[t(ll,{slot:"icon"},null)]}):K=t(G,{shape:"circle",variant:"text",class:"rank-star-button",onClick:()=>{i.addStarMember(S,J.row.userId),F()}},{default:()=>[t(nl,{slot:"icon"},null)]}),t("div",{class:"rank-nickname-cell"},[t(we,null,{default:()=>[t(Pl,{content:J.row.nickname},{default:()=>[t(G,{variant:"text",onClick:()=>n.push({name:"user",params:{username:J.row.username}})},ca(ne)?ne:{default:()=>[ne]})]}),K]})])}},{title:"Solved",colKey:"solved",align:"center",fixed:"left",cell:(W,J)=>t(G,{variant:"text",onClick:()=>n.push({name:"contest-judge",params:{contestId:S},query:{username:J.row.username,status:He.Accept}})},{default:()=>[J.row.solved]})},{title:"Penalty",colKey:"penalty",align:"center",fixed:"left",cell:(W,J)=>k(J.row.penalty)}],T=m([]),R=m(!1);let z=[],V=[];const P=m([]);let L=[];const E=({col:W,rowIndex:J})=>{if(W.colKey==="rank"){let ne=r.value.current;r.value.current>Math.ceil(P.value.length/r.value.pageSize)&&(ne=Math.ceil(P.value.length/r.value.pageSize));let K=r.value.pageSize*(ne-1),B=1;for(let ue=J+1;K+ue<P.value.length&&P.value[K+ue].rank===P.value[K+J].rank;ue++)B++;return{rowspan:B}}},H=(W,{value:J})=>rt(J),Z=()=>{u&&clearInterval(u),u=setInterval(()=>{y&&ie(!1)},3e4),d&&clearInterval(d),d=setInterval(()=>{if(!y)return;p.value=(new Date().getTime()-f.getTime())/1e3;const W=Math.min(p.value,C.value);p.value=Math.min(p.value,W),F()},1e3)},Q=()=>{u&&(clearInterval(u),u=null),d&&(clearInterval(d),d=null)},ee=async W=>{h.value=W,W?(await ie(!1),Z()):Q()},te=()=>{F(),r.value={...r.value,current:1}},F=()=>{P.value=[];let W=[];for(let Y=0;Y<z.length;Y++){const se=z[Y];let ye={userId:se.author_id,username:se.author_username,nickname:se.author_nickname},be=0,xe=0;se.problems.forEach(Ge=>{let je=-1,Ye=Ge.lock||0;if(Ge.ac){if(je=(new Date(Ge.ac).getTime()-(f==null?void 0:f.getTime()))/1e3,je>p.value)return;be++,xe+=je,xe+=Ge.attempt*20*60}if(Ye>0&&$>0){const Vt=C.value-$;p.value<Vt&&(Ye=0)}const ot=Ge.index;ye[`problem_${ot}`]={acDuration:je,attempt:Ge.attempt||0,lock:Ye}}),ye.solved=be,ye.penalty=xe,W.push(ye)}W.sort((Y,se)=>Y.solved!==se.solved?se.solved-Y.solved:Y.penalty!==se.penalty?Y.penalty-se.penalty:Y.userId-se.userId);const J=V;let ne=0,K=0,B=-1,ue=-1;for(let Y=0;Y<W.length;Y++)J&&J.includes(W[Y].userId)?W[Y].rank="*":(K++,(W[Y].solved!==B||W[Y].penalty!==ue)&&(ne=K,B=W[Y].solved,ue=W[Y].penalty),W[Y].rank=String(ne));_.value&&(W=W.filter(Y=>j(Y.userId)));const oe=document.querySelectorAll("tbody tr"),Ce={};L.forEach((Y,se)=>{const ye=oe[se];ye&&(Ce[Y.userId]=ye.getBoundingClientRect())}),r.value={...r.value,total:W.length},P.value=W;for(let Y=0;Y<P.value.length;Y++)P.value[Y].index=Y+1;if(L=[...P.value],g.value){const Y={},se=document.querySelectorAll("table tbody tr");P.value.forEach((ye,be)=>{const xe=se[be];xe&&(Y[ye.userId]=xe.getBoundingClientRect())}),requestAnimationFrame(()=>{const ye=document.querySelectorAll("table tbody tr");P.value.forEach((be,xe)=>{const Ge=ye[xe],je=Ce[be.userId],Ye=Y[be.userId];if(je&&Ye){const ot=je.top-Ye.top;ot!==0&&(Ge.style.transition="none",Ge.style.transform=`translateY(${ot}px)`)}}),requestAnimationFrame(()=>{document.querySelectorAll("table tbody tr").forEach(xe=>{xe.style.transition="transform 300ms ease",xe.style.transform=""})})})}},me=W=>{ee(!1),p.value=W;const J=Math.min(C.value,(new Date().getTime()-(f==null?void 0:f.getTime()))/1e3);p.value=Math.min(p.value,J),F()},ie=async W=>{W&&(R.value=!0);try{const J=await wo(S);if(T.value=[...I],z=[],V=[],P.value=[],r.value={...r.value,total:0},J.code===0){if(!J.data.has_auth){ke(o,"您目前没有权限查看比赛排名"),await n.push({name:"contest-detail",params:{contestId:S}});return}J.data.problems.sort((B,ue)=>B-ue),J.data.problems.forEach((B,ue)=>{T.value.push({colKey:`problem_${B}`,align:"center",title:()=>{let oe;return t(G,{variant:"text",onClick:()=>n.push({name:"contest-problem-detail",params:{contestId:S,problemIndex:B}})},ca(oe=at(B))?oe:{default:()=>[oe]})},cell:(oe,Ce)=>{const Y=Ce.row[`problem_${B}`];if(!Y)return"";let se="";return Y.acDuration>=0&&(se=k(Y.acDuration)),Y.attempt>0&&(se&&(se+=" "),se+=`(-${Y.attempt})`),Y.lock>0&&(se&&(se+=" "),se+=`(+${Y.lock})`),t("span",null,[se])},attrs:oe=>{const Ce=oe.row[`problem_${B}`];return Ce?Ce.acDuration>=0?{style:{backgroundColor:"rgba(130,255,30,0.5)"}}:Ce.lock>0?{style:{backgroundColor:"rgb(255,180,50,0.5)"}}:Ce.attempt>0?{style:{backgroundColor:"rgba(255,120,120,0.5)"}}:{}:{}}})});const ne=J.data.contest;if(f=new Date(ne.start_time),s=new Date(ne.end_time),z=J.data.ranks,V=J.data.v_members||[],C.value=Math.floor((s.getTime()-f.getTime())/1e3),U.value={0:"0",[Math.floor(C.value/2)]:rt(Math.floor(C.value/2)),[C.value]:rt(C.value)},$=qa(ne.lock_rank_duration||0),J.data.is_locked&&$>0){const B=Math.max(0,C.value-$);U.value[B]=t("span",{style:"color: #0052d9"},[x("锁榜("),rt(B),x(")")])}p.value=Math.floor((new Date().getTime()-f.getTime())/1e3);const K=Math.min(p.value,C.value);p.value=Math.min(p.value,K),h.value=!0,Z(),F()}else W&&O(o,J.code)}catch(J){console.error(J),W&&O(o,Ne())}finally{W&&(R.value=!1)}};return fe(async()=>{y=!0,v=$e(()=>l.query,async W=>{if(Array.isArray(l.params.contestId)?S=Number(l.params.contestId[0]):S=Number(l.params.contestId),!S){await n.push({name:"contest"});return}const J=parseInt(W.page)||r.value.defaultCurrent,ne=parseInt(W.page_size)||r.value.defaultPageSize;w=J,c=ne,r.value={...r.value,current:w,pageSize:c},await ie(!0)},{immediate:!0})}),De(()=>{y=!1,v&&v(),Q()}),(W,J)=>{const ne=vt,K=we,B=Il,ue=Ee,oe=he,Ce=Ie;return D(),M(Ce,null,{default:a(()=>[t(oe,{style:{margin:"10px",width:"100%"}},{default:a(()=>[A("div",Zs,[A("div",Qs,[t(K,null,{default:a(()=>[t(ne,{size:"large",modelValue:_.value,"onUpdate:modelValue":J[0]||(J[0]=Y=>_.value=Y),onChange:te},{label:a(Y=>[x(q(Y.value?"仅展示收藏":"未过滤收藏"),1)]),_:1},8,["modelValue"]),t(ne,{size:"large",modelValue:g.value,"onUpdate:modelValue":J[1]||(J[1]=Y=>g.value=Y)},{label:a(Y=>[x(q(Y.value?"开启动画":"关闭动画"),1)]),_:1},8,["modelValue"]),t(ne,{size:"large",modelValue:h.value,"onUpdate:modelValue":J[2]||(J[2]=Y=>h.value=Y),onChange:ee},{label:a(Y=>[x(q(Y.value?"自动刷新":"关闭刷新"),1)]),_:1},8,["modelValue"])]),_:1})]),t(B,{modelValue:p.value,"onUpdate:modelValue":J[3]||(J[3]=Y=>p.value=Y),marks:U.value,max:C.value,label:H,"tooltip-props":{placement:"top"},"input-number-props":{theme:"column",autoWidth:!0,format:ve(rt),onChange:me},onChangeEnd:me},null,8,["modelValue","marks","max","input-number-props"])]),A("div",er,[t(ue,{data:P.value,columns:T.value,"row-key":"index","vertical-align":"middle",bordered:!0,hover:!0,"table-layout":"auto","rowspan-and-colspan":E,loading:R.value,class:"dida-contest-rank-table",pagination:r.value,onPageChange:b},null,8,["data","columns","loading","pagination"])])]),_:1})]),_:1})}}}),ar=ce(tr,[["__scopeId","data-v-838e6c28"]]),lr={style:{margin:"10px"}},nr={style:{margin:"12px"}},or={class:"dida-edit-container"},sr={class:"dida-description-editor"},rr=de({__name:"ContestEdit",setup(e){let l=Se();const{globalProperties:n}=_e(),i=Ze(),o=m(0),y=m(!1),v=m(!1),S=m(!1),f=m(null),s=m({title:"",openTime:[],private:!0,password:"",problems:[],members:[],description:"",notification:"",lockRankDuration:0,alwaysLock:!0,submitAnytime:!1}),$=m(""),p=m(""),C=m(!1),_=async()=>{C.value=!0,S.value=!1,C.value=!1},g=async(c,r)=>{v.value=!0,await ut(c,r,n,()=>bo(o.value)),v.value=!1},h=async()=>{v.value=!0;try{const c={title:s.value.title,description:s.value.description,notification:s.value.notification,lock_rank_duration:s.value.lockRankDuration,always_lock:s.value.alwaysLock,problems:s.value.problems,members:s.value.members,private:s.value.private,password:s.value.password,submit_anytime:s.value.submitAnytime};s.value.openTime[0]&&(c.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(c.end_time=new Date(s.value.openTime[1]));const r=await ko(c);if(v.value=!0,r.code!==0){O(n,r.code);return}r.data!=null&&await X.push({name:"contest-detail",params:{contestId:r.data}}),Ke(n,"创建成功")}finally{v.value=!1}},u=async()=>{v.value=!0;try{const c={id:Number(o.value),title:s.value.title,notification:s.value.notification,lock_rank_duration:s.value.lockRankDuration,always_lock:s.value.alwaysLock,problems:s.value.problems,members:s.value.members,private:s.value.private,password:s.value.password,submit_anytime:s.value.submitAnytime,description:s.value.description};s.value.openTime[0]&&(c.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(c.end_time=new Date(s.value.openTime[1]));const r=await So(c);if(v.value=!0,r.code!==0){O(n,r.code);return}f.value&&(r.data.description!=null&&(s.value.description=r.data.description),r.data.update_time!=null&&(f.value.updateTime=new Date(r.data.update_time).toLocaleString())),Ke(n,"保存成功")}finally{v.value=!1}},d=c=>{s.value.description=c,y.value=!1},w=async()=>{const c=await _o(o.value);if(c.code!==0){O(n,c.code),console.error("contest get failed",c.code),await X.push({name:"contest-list"});return}const r=c.data.contest;f.value=Ht(r),s.value.title=r.title,s.value.openTime=[],r.start_time?s.value.openTime.push(new Date(r.start_time)):s.value.openTime.push(""),r.end_time?s.value.openTime.push(new Date(r.end_time)):s.value.openTime.push(""),s.value.private=r.private,s.value.password=r.password||"",s.value.description=r.description||"",s.value.notification=r.notification||"",s.value.problems=c.data.problems,s.value.members=c.data.members,r.lock_rank_duration?s.value.lockRankDuration=qa(r.lock_rank_duration):s.value.lockRankDuration=0,s.value.alwaysLock=r.always_lock,s.value.submitAnytime=r.submit_anytime,i.setTitle(r.title+" - "+i.getTitle);let j="";r.description&&(j=r.description),d(j)};return fe(async()=>{Array.isArray(l.params.contestId)?o.value=Number(l.params.contestId[0]):o.value=Number(l.params.contestId),o.value?(y.value=!0,await w()):d("")}),(c,r)=>{const j=Ae,b=ze,k=Ft,U=vt,I=wa,T=Ue,R=he,z=Te,V=G,P=we,L=Je,E=We,H=Ie,Z=Re("md-editor-v3"),Q=Ve,ee=It,te=nt;return D(),ae(pe,null,[t(Q,{loading:y.value},{default:a(()=>[t(H,null,{default:a(()=>[t(z,{span:8},{default:a(()=>[A("div",lr,[t(R,{class:"sh-card"},{default:a(()=>[t(T,{model:s.value,"label-width":"150px"},{default:a(()=>[t(b,{label:"标题"},{default:a(()=>[t(j,{modelValue:s.value.title,"onUpdate:modelValue":r[0]||(r[0]=F=>s.value.title=F),placeholder:"比赛标题"},null,8,["modelValue"])]),_:1}),t(b,{label:"通知"},{default:a(()=>[t(j,{modelValue:s.value.notification,"onUpdate:modelValue":r[1]||(r[1]=F=>s.value.notification=F),placeholder:"会更为醒目地提醒"},null,8,["modelValue"])]),_:1}),t(b,{label:"开启时间"},{default:a(()=>[t(k,{modelValue:s.value.openTime,"onUpdate:modelValue":r[2]||(r[2]=F=>s.value.openTime=F),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(b,{label:"提交限制"},{default:a(()=>[t(U,{modelValue:s.value.submitAnytime,"onUpdate:modelValue":r[3]||(r[3]=F=>s.value.submitAnytime=F)},{label:a(F=>[x(q(F.value?"结束仍能提交":"仅比赛期间提交"),1)]),_:1},8,["modelValue"])]),_:1}),t(b,{label:"锁榜时长"},{default:a(()=>[t(I,{modelValue:s.value.lockRankDuration,"onUpdate:modelValue":r[4]||(r[4]=F=>s.value.lockRankDuration=F),min:0,format:ve(rt),"auto-width":""},null,8,["modelValue","format"])]),_:1}),t(b,{label:"自动解锁"},{default:a(()=>[t(U,{modelValue:s.value.alwaysLock,"onUpdate:modelValue":r[5]||(r[5]=F=>s.value.alwaysLock=F)},{label:a(F=>[x(q(F.value?"结束后仍锁榜":"结束后解锁"),1)]),_:1},8,["modelValue"])]),_:1}),t(b,{label:"私有"},{default:a(()=>[t(U,{modelValue:s.value.private,"onUpdate:modelValue":r[6]||(r[6]=F=>s.value.private=F)},null,8,["modelValue"])]),_:1}),s.value.private?(D(),M(b,{key:0,label:"密码"},{default:a(()=>[t(j,{modelValue:s.value.password,"onUpdate:modelValue":r[7]||(r[7]=F=>s.value.password=F),type:"password",placeholder:"请输入访问密码，留空代表关闭密码访问"},null,8,["modelValue"])]),_:1})):le("",!0),s.value.private?(D(),M(b,{key:1,label:"成员"},{default:a(()=>[t(Ma,{modelValue:s.value.members,"onUpdate:modelValue":r[8]||(r[8]=F=>s.value.members=F)},null,8,["modelValue"])]),_:1})):le("",!0),t(b,{label:"问题"},{default:a(()=>[t(Ea,{modelValue:s.value.problems,"onUpdate:modelValue":r[9]||(r[9]=F=>s.value.problems=F)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(z,{span:4},{default:a(()=>[A("div",nr,[A("div",or,[o.value?(D(),M(P,{key:0},{default:a(()=>[t(V,{onClick:u,theme:"danger",loading:v.value},{default:a(()=>r[13]||(r[13]=[x("保存")])),_:1},8,["loading"])]),_:1})):(D(),M(P,{key:1},{default:a(()=>[t(V,{onClick:h,theme:"danger",loading:v.value},{default:a(()=>r[14]||(r[14]=[x("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(D(),M(E,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(L,{label:"创建时间"},{default:a(()=>{var F;return[x(q((F=f.value)==null?void 0:F.createTime),1)]}),_:1}),t(L,{label:"更新时间"},{default:a(()=>{var F;return[x(q((F=f.value)==null?void 0:F.updateTime),1)]}),_:1}),t(L,{label:"创建用户"},{default:a(()=>{var F;return[x(q((F=f.value)==null?void 0:F.ownerNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),A("div",sr,[r[15]||(r[15]=A("p",null,"公告",-1)),t(Z,{id:"contest-description-editor",modelValue:s.value.description,"onUpdate:modelValue":r[10]||(r[10]=F=>s.value.description=F),onSave:u,onOnUploadImg:g,previewTheme:"cyanosis"},null,8,["modelValue"]),t(Q,{loading:v.value,attach:"#contest-description-editor","z-index":1e5},null,8,["loading"])])]),_:1},8,["loading"]),t(te,{visible:S.value,"onUpdate:visible":r[12]||(r[12]=F=>S.value=F),onConfirm:_,header:$.value,"confirm-loading":C.value},{default:a(()=>[r[16]||(r[16]=A("div",{style:{"margin-bottom":"10px"}},[A("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(ee,{modelValue:p.value,"onUpdate:modelValue":r[11]||(r[11]=F=>p.value=F),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),ma=ce(rr,[["__scopeId","data-v-6b7ea9fb"]]);function Jt(e){const l={};return l.id=e.id,l.authorId=e.author_id,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.title=e.title,l.content=e.content,e.insert_time&&(l.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(l.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(l.updateTime=new Date(e.update_time).toLocaleString()),l.problemId=e.problem_id,l.problemTitle=e.problem_title,l.contestId=e.contest_id,l.contestTitle=e.contest_title,l.contestProblemIndex=e.contest_problem_index,l}function ir(e){const l={};return l.id=e.id,l.authorId=e.author_id,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.content="",e.content&&(l.content=e.content),e.insert_time&&(l.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(l.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(l.updateTime=new Date(e.update_time).toLocaleString()),l}function ur(e){return N({url:"/discuss?id="+e,method:"get"})}function dr(e){return N({url:"/discuss/edit?id="+e,method:"get"})}function cr(e,l,n,i,o,y,v){const S={};return e?S.only_problem="1":S.only_problem="0",l&&(S.contest_id=l),n&&(S.problem_id=n),i&&(S.title=i),o&&(S.username=o),y&&(S.page=y),v&&(S.page_size=v),N({url:`/discuss/list?${new URLSearchParams(S).toString()}`,method:"get"})}function mr(e){return e||(e=0),N({url:"/discuss/image/token?id="+e,method:"get"})}function pr(e,l){return e||(e=0),l||(l=0),N({url:"/discuss/comment/image/token?id="+e+"&comment_id="+l,method:"get"})}function fr(e,l,n){return N({url:"/discuss/comment/list?id="+e+"&page="+l+"&page_size="+n,method:"get"})}function vr(e){return N({url:"/discuss/create",method:"post",data:e})}function _r(e){return N({url:"/discuss/edit",method:"post",data:e})}function gr(e){return N({url:"/discuss/comment/create",method:"post",data:e})}function br(e){return N({url:"/discuss/comment/edit",method:"post",data:e})}const hr={style:{margin:"10px"}};function yr(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const wr=de({__name:"DiscussList",setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=!1,y=null,v=-1,S=m(!1);const f=m([]),s=[],$=[{title:"标题",colKey:"title",cell:(U,I)=>t(G,{variant:"text",onClick:()=>c(I.row.id)},{default:()=>[I.row.title]})},{title:"创建人",colKey:"authorNickname",width:"200",cell:(U,I)=>t(G,{variant:"text",onClick:async()=>await Bt(n,I.row.authorUsername)},{default:()=>[I.row.authorNickname]})},{title:"创建时间",colKey:"insertTime",width:"180"},{title:"更新时间",colKey:"updateTime",width:"180"}],p=m(!1);let C=1,_=50;const g=m({current:C,pageSize:_,defaultCurrent:C,defaultPageSize:_,total:0,pageSizeOptions:[50,100]}),h=m(),u=m({problemId:"",title:"",username:""}),d=U=>{U&&n.push({name:"problem-detail",params:{problemId:U}})},w=(U,I)=>{n.push({name:"contest-problem-detail",params:{contestId:U,problemIndex:I}})},c=U=>{if(U){if(v){n.push({name:"contest-discuss-detail",params:{contestId:v,discussId:U}});return}n.push({name:"discuss-detail",params:{discussId:U}})}},r=async()=>{await n.push({query:{...l.query,problem_id:u.value.problemId,title:u.value.title,username:u.value.username,page:1,page_size:g.value.defaultPageSize}})},j=async(U,I)=>{var T;p.value=!0;try{const{current:R,pageSize:z}=U,V=await cr(S.value,v,u.value.problemId,u.value.title,u.value.username,R,z);if(h.value=[],V.code===0){if(!V.data.has_auth){ke(i,"您目前没有权限查看讨论列表"),v?await n.push({name:"contest-detail",params:{contestId:v}}):await n.push({name:"discuss-list"});return}if(V.data.list){const P=V.data.list;for(let L=0;L<P.length;L++){const E=P[L],H=await Jt(E);(T=h.value)==null||T.push(H)}}g.value={...g.value,total:V.data.total_count}}else I&&O(i,V.code)}catch(R){console.error(R),O(i,Ne())}finally{p.value=!1}},b=async U=>{await n.push({query:{...l.query,page:U.current,page_size:U.pageSize}})},k=async()=>{await n.push({name:"discuss-create"})};return fe(async()=>{o=!0,y=$e(()=>l.query,U=>{if(!o)return;S.value=l.name==="discuss-list-problem",Array.isArray(l.params.contestId)?v=Number(l.params.contestId[0]):v=Number(l.params.contestId),f.value=s,v?f.value=f.value.concat([{title:"问题ID",colKey:"contestProblemIndex",width:"100",cell:(R,z)=>{let V;return z.row.contestProblemIndex?t(G,{variant:"text",onClick:()=>w(v,z.row.contestProblemIndex)},yr(V=at(z.row.contestProblemIndex))?V:{default:()=>[V]}):""}}]):f.value=f.value.concat([{title:"问题ID",colKey:"problemId",width:"100",cell:(R,z)=>z.row.problemId?t(G,{variant:"text",onClick:()=>d(z.row.problemId)},{default:()=>[z.row.problemId]}):""}]),f.value=f.value.concat($),u.value.problemId=U.problem_id||"",u.value.title=U.title||"",u.value.username=U.username||"";const I=parseInt(U.page)||g.value.defaultCurrent,T=parseInt(U.page_size)||g.value.defaultPageSize;C=I,_=T,g.value={...g.value,current:C,pageSize:_},j({current:C,pageSize:_},!0)},{immediate:!0})}),De(()=>{o=!1,y&&y()}),(U,I)=>{const T=Ee,R=he,z=Te,V=Ae,P=ze,L=G,E=Ue,H=we,Z=Ie;return D(),M(Z,null,{default:a(()=>[t(z,{span:9},{default:a(()=>[t(R,{style:{margin:"10px"}},{default:a(()=>[t(T,{data:h.value,columns:f.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:g.value,loading:p.value,"table-layout":"auto",onPageChange:b},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(z,{span:3},{default:a(()=>[A("div",hr,[t(R,{class:"sh-card"},{default:a(()=>[t(E,{model:u.value},{default:a(()=>[t(P,{label:"问题ID"},{default:a(()=>[t(V,{modelValue:u.value.problemId,"onUpdate:modelValue":I[0]||(I[0]=Q=>u.value.problemId=Q),placeholder:"请输入完整问题ID"},null,8,["modelValue"])]),_:1}),t(P,{label:"标题"},{default:a(()=>[t(V,{modelValue:u.value.title,"onUpdate:modelValue":I[1]||(I[1]=Q=>u.value.title=Q),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(P,{label:"创建人"},{default:a(()=>[t(V,{modelValue:u.value.username,"onUpdate:modelValue":I[2]||(I[2]=Q=>u.value.username=Q),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(P,null,{default:a(()=>[t(L,{theme:"primary",onClick:r},{default:a(()=>I[3]||(I[3]=[x("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(R,{class:"sh-card"},{default:a(()=>[t(H,null,{default:a(()=>[t(L,{onClick:k},{default:a(()=>I[4]||(I[4]=[x("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),$t=ce(wr,[["__scopeId","data-v-d6935e64"]]),kr={key:0,style:{margin:"20px"}},Sr={class:"dida-operation-container"},Cr={class:"dida-operation-container"},Ir={style:{margin:"10px"}},Pr={style:{margin:"10px"}},xr={style:{margin:"10px"},class:"dida-operation-container"},Tr={style:{margin:"12px"}},Vr={key:0,class:"dida-edit-container"},Dr=de({__name:"DiscussDetail",props:{discussId:{}},setup(e){const l=e;let n=Se();const{globalProperties:i}=_e();let o=!1,y=null;const v=Ze(),S=Fe();let f=m("");const s=m(0),$=m(!1),p=m(null),C=m(!1),_=m(!1),g=m(0),h=m("");let u=1,d=20;const w=m({current:1,pageSize:20,total:0,defaultPageSize:d,defaultCurrent:u,pageSizeOptions:[20,50]}),c=m([]),r=Be(()=>S.hasAuth(Le.ManageDiscuss)),j=Be(()=>S.hasAuth(Le.ManageDiscuss)||p.value&&S.getUserId==p.value.authorId),b=()=>{X.push({name:"discuss-edit",params:{discussId:s.value}})},k=()=>t("div",{class:"t-pagination__total"},[`共 ${w.value.total} 条回复`]),U=(P,L)=>{g.value=P,h.value=L;const E=document.getElementById("discuss-comment-editor");E&&E.scrollIntoView({behavior:"smooth"})},I=()=>{g.value=0,h.value="";const P=document.getElementById("discuss-comment-editor");P&&P.scrollIntoView({behavior:"smooth"})},T=async()=>{_.value=!0;try{let P;if(g.value){const L={id:g.value,discuss_id:s.value,content:h.value};if(P=await br(L),P.code!==0){O(i,P.code);return}Ke(i,"编辑成功"),g.value=0,h.value="",u===1?await z({current:1,pageSize:d},!0):await X.push({query:{current:1}});const E=document.getElementById("comment-divider");E&&E.scrollIntoView({behavior:"smooth"})}else{const L={discuss_id:s.value,content:h.value};if(P=await gr(L),P.code!==0){O(i,P.code);return}Ke(i,"编辑成功"),g.value=0,h.value="",u===1?await z({current:1,pageSize:d},!0):await X.push({query:{current:1}});const E=document.getElementById("comment-divider");E&&E.scrollIntoView({behavior:"smooth"})}}finally{_.value=!1}},R=async(P,L)=>{_.value=!0,await ut(P,L,i,()=>pr(s.value,g.value)),_.value=!1},z=async(P,L)=>{var E;C.value=!0;try{const{current:H,pageSize:Z}=P,Q=await fr(s.value,H,Z);if(c.value=[],Q.code===0){const ee=Q.data.list;if(ee)for(let te=0;te<ee.length;te++){const F=ee[te],me=ir(F);(E=c.value)==null||E.push(me)}w.value={...w.value,total:Q.data.total_count}}else L&&O(i,Q.code)}catch(H){console.error(H),O(i,Ne())}finally{C.value=!1}},V=async P=>{await X.push({query:{...n.query,page:P.current,page_size:P.pageSize}})};return fe(async()=>{if(o=!0,s.value=Number(l.discussId),s.value||(Array.isArray(n.params.discussId)?s.value=Number(n.params.discussId[0]):s.value=Number(n.params.discussId)),!s.value){ge(i,"讨论不存在"),await X.push({name:"discuss"});return}$.value=!0;const P=await ur(s.value);if(P.code!==0){$.value=!1,O(i,P.code),await X.push({name:"discuss"});return}p.value=Jt(P.data.discuss),v.setTitle(p.value.title+" - "+v.getTitle),f.value=p.value.content,$.value=!1,y=$e(()=>n.query,L=>{if(!o)return;const E=parseInt(L.page)||w.value.defaultCurrent,H=parseInt(L.page_size)||w.value.defaultPageSize;u=E,d=H,w.value={...w.value,current:u,pageSize:d},z({current:u,pageSize:d},!0)},{immediate:!0})}),De(()=>{o=!1,y&&y()}),(P,L)=>{const E=Sa,H=ka,Z=Re("md-preview"),Q=he,ee=xl,te=we,F=G,me=Tl,ie=et,W=Re("md-editor-v3"),J=Ve,ne=Te,K=Je,B=We,ue=Ie;return D(),M(J,{loading:$.value},{default:a(()=>[t(ue,{class:"dida-main-content"},{default:a(()=>[t(ne,{span:8},{default:a(()=>{var oe,Ce,Y;return[(oe=p.value)!=null&&oe.problemTitle||(Ce=p.value)!=null&&Ce.contestTitle?(D(),ae("div",kr,[t(H,{"max-item-width":"300"},{default:a(()=>{var se,ye,be,xe,Ge;return[(se=p.value)!=null&&se.contestTitle?(D(),ae(pe,{key:0},[t(E,{to:{name:"contest-detail",params:{contestId:(ye=p.value)==null?void 0:ye.contestId}}},{default:a(()=>{var je;return[x(q((je=p.value)==null?void 0:je.contestTitle),1)]}),_:1},8,["to"]),(be=p.value)!=null&&be.contestProblemIndex?(D(),M(E,{key:0,to:{name:"contest-problem-detail",params:{problemIndex:(xe=p.value)==null?void 0:xe.contestProblemIndex}}},{default:a(()=>{var je,Ye;return[x(q(ve(at)((je=p.value)==null?void 0:je.contestProblemIndex))+" - "+q((Ye=p.value)==null?void 0:Ye.problemTitle),1)]}),_:1},8,["to"])):le("",!0)],64)):(D(),ae(pe,{key:1},[t(E,{to:{name:"discuss-list-problem"}},{default:a(()=>L[4]||(L[4]=[x(" 题目讨论")])),_:1}),t(E,{to:{name:"problem-detail",params:{problemId:(Ge=p.value)==null?void 0:Ge.problemId}}},{default:a(()=>{var je;return[x(q((je=p.value)==null?void 0:je.problemTitle),1)]}),_:1},8,["to"])],64))]}),_:1})])):le("",!0),t(Q,{style:{margin:"10px"},header:(Y=p.value)==null?void 0:Y.title,"header-bordered":!0},{default:a(()=>[t(Z,{"model-value":ve(f),previewTheme:"cyanosis"},null,8,["model-value"])]),_:1},8,["header"]),t(ee,{id:"comment-divider"}),(D(!0),ae(pe,null,Pe(c.value,(se,ye)=>(D(),M(Q,{key:ye,style:{margin:"10px"},"header-bordered":""},{header:a(()=>[A("div",Sr,[t(te,null,{default:a(()=>[A("span",null,q(se.authorNickname),1),A("span",null,q(se.insertTime),1)]),_:2},1024)]),A("div",Cr,[t(te,null,{default:a(()=>[r.value||ve(S).getUserId===se.authorId?(D(),M(F,{key:0,onClick:()=>{U(se.id,se.content)}},{default:a(()=>L[5]||(L[5]=[x(" 编辑 ")])),_:2},1032,["onClick"])):le("",!0)]),_:2},1024)])]),default:a(()=>[t(Z,{"model-value":se.content,previewTheme:"cyanosis"},null,8,["model-value"])]),_:2},1024))),128)),A("div",Ir,[t(me,{modelValue:w.value.current,"onUpdate:modelValue":L[0]||(L[0]=se=>w.value.current=se),"page-size":w.value.pageSize,"onUpdate:pageSize":L[1]||(L[1]=se=>w.value.pageSize=se),total:w.value.total,"page-size-options":w.value.pageSizeOptions,"show-page-size":!1,"total-content":k,onChange:V},null,8,["modelValue","page-size","total","page-size-options"])]),t(ee),A("div",Pr,[A("div",xr,[t(ie,{style:{margin:"10px"}},{default:a(()=>[x(q(g.value?"编辑回复":"发表回复"),1)]),_:1}),t(te,null,{default:a(()=>[t(F,{theme:"danger",onClick:I},{default:a(()=>L[6]||(L[6]=[x("清除")])),_:1}),t(F,{theme:"primary",onClick:T,loading:_.value},{default:a(()=>L[7]||(L[7]=[x("提交")])),_:1},8,["loading"])]),_:1})]),t(W,{id:"discuss-comment-editor",modelValue:h.value,"onUpdate:modelValue":L[2]||(L[2]=se=>h.value=se),previewTheme:"cyanosis",onSave:T,onOnUploadImg:R},null,8,["modelValue"]),t(J,{loading:_.value,attach:"#discuss-comment-editor","z-index":1e5},null,8,["loading"])])]}),_:1}),t(ne,{span:4},{default:a(()=>[A("div",Tr,[j.value?(D(),ae("div",Vr,[t(F,{onClick:b},{default:a(()=>L[8]||(L[8]=[x("编辑")])),_:1})])):le("",!0),t(B,{layout:"vertical",bordered:!0},{default:a(()=>[t(K,{label:"创建时间"},{default:a(()=>{var oe;return[x(q((oe=p.value)==null?void 0:oe.insertTime),1)]}),_:1}),t(K,{label:"编辑时间"},{default:a(()=>{var oe;return[x(q((oe=p.value)==null?void 0:oe.modifyTime),1)]}),_:1}),t(K,{label:"更新时间"},{default:a(()=>{var oe;return[x(q((oe=p.value)==null?void 0:oe.updateTime),1)]}),_:1}),t(K,{label:"创建用户"},{default:a(()=>[t(F,{variant:"text",onClick:L[3]||(L[3]=async()=>{var oe;return await ve(Bt)(ve(X),(oe=p.value)==null?void 0:oe.authorUsername)})},{default:a(()=>{var oe;return[x(q((oe=p.value)==null?void 0:oe.authorNickname),1)]}),_:1})]),_:1}),t(K,{label:"标签"})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Ut=ce(Dr,[["__scopeId","data-v-f39b7692"]]),jr={style:{margin:"10px"}},Lr={style:{margin:"12px"}},$r={class:"dida-edit-container"},Ur={class:"dida-description-editor"},zr=de({__name:"DiscussEdit",setup(e){let l=Se();const{globalProperties:n}=_e();let i=null;const o=m(0),y=m(!1),v=m(!1),S=m(null),f=m({title:"",problemId:"",content:""}),s=()=>{X.push({name:"discuss-detail",params:{discussId:o.value}})};async function $(h,u){v.value=!0,await ut(h,u,n,()=>mr(o.value)),v.value=!1}const p=async()=>{v.value=!0;try{const h={title:f.value.title,content:f.value.content,problem_id:f.value.problemId},u=await vr(h);if(v.value=!0,u.code!==0){O(n,u.code);return}const d=u.data;await X.push({name:"discuss-detail",params:{discussId:d}}),Ke(n,"创建成功")}finally{v.value=!1}},C=async()=>{v.value=!0;try{const h={id:o.value,title:f.value.title,content:f.value.content,problem_id:f.value.problemId},u=await _r(h);if(v.value=!0,u.code!==0){O(n,u.code);return}S.value&&u.data.modify_time!=null&&(S.value.modifyTime=new Date(u.data.modify_time).toLocaleString()),u.data.content!=null&&(f.value.content=u.data.content),Ke(n,"保存成功")}finally{v.value=!1}},_=async()=>{o.value?await C():await p()},g=async()=>{const h=await dr(o.value);if(h.code!==0){O(n,h.code),await X.push({name:"discuss"});return}const u=h.data.discuss;S.value=Jt(u),f.value.title=u.title,f.value.content=u.content,f.value.problemId=u.problem_id,y.value=!1};return fe(async()=>{i=$e(()=>l.params,async()=>{Array.isArray(l.params.discussId)?o.value=Number(l.params.discussId[0]):o.value=Number(l.params.discussId),o.value?(y.value=!0,await g()):(f.value.title="",f.value.problemId="",f.value.content="")},{immediate:!0})}),De(()=>{i&&(i(),i=null)}),(h,u)=>{const d=Ae,w=ze,c=Ue,r=he,j=Te,b=G,k=we,U=Je,I=We,T=Ie,R=Re("md-editor-v3"),z=Ve;return D(),M(z,{loading:y.value},{default:a(()=>[t(T,null,{default:a(()=>[t(j,{span:8},{default:a(()=>[A("div",jr,[t(r,{class:"sh-form-card"},{default:a(()=>[t(c,{model:f.value},{default:a(()=>[t(w,{label:"标题"},{default:a(()=>[t(d,{modelValue:f.value.title,"onUpdate:modelValue":u[0]||(u[0]=V=>f.value.title=V),placeholder:"讨论标题"},null,8,["modelValue"])]),_:1}),t(w,{label:"关联题目"},{default:a(()=>[t(d,{modelValue:f.value.problemId,"onUpdate:modelValue":u[1]||(u[1]=V=>f.value.problemId=V),placeholder:"讨论题目"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(j,{span:4},{default:a(()=>[A("div",Lr,[A("div",$r,[o.value?(D(),M(k,{key:0},{default:a(()=>[t(b,{onClick:C,theme:"danger",loading:v.value},{default:a(()=>u[3]||(u[3]=[x("保存")])),_:1},8,["loading"]),t(b,{onClick:s},{default:a(()=>u[4]||(u[4]=[x("查看")])),_:1})]),_:1})):(D(),M(k,{key:1},{default:a(()=>[t(b,{onClick:p,theme:"danger",loading:v.value},{default:a(()=>u[5]||(u[5]=[x("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(D(),M(I,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(U,{label:"创建时间"},{default:a(()=>{var V;return[x(q((V=S.value)==null?void 0:V.insertTime),1)]}),_:1}),t(U,{label:"更新时间"},{default:a(()=>{var V;return[x(q((V=S.value)==null?void 0:V.modifyTime),1)]}),_:1}),t(U,{label:"创建用户"},{default:a(()=>{var V;return[x(q((V=S.value)==null?void 0:V.authorNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),A("div",Ur,[t(R,{id:"discuss-editor",modelValue:f.value.content,"onUpdate:modelValue":u[2]||(u[2]=V=>f.value.content=V),onSave:_,onOnUploadImg:$,previewTheme:"cyanosis"},null,8,["modelValue"]),t(z,{loading:v.value,attach:"#discuss-editor","z-index":1e5},null,8,["loading"])])]),_:1},8,["loading"])}}}),pa=ce(zr,[["__scopeId","data-v-164ac069"]]);function Ar(e,l){return N({url:"/rank/ac/all?page="+e+"&page_size="+l,method:"get"})}function Rr(e,l){return N({url:"/rank/ac/problem?page="+e+"&page_size="+l,method:"get"})}function Er(e,l){return N({url:"/rank/ac/problem/today?page="+e+"&page_size="+l,method:"get"})}function Mr(e,l){return N({url:"/rank/ac/problem/day7?page="+e+"&page_size="+l,method:"get"})}function qr(e,l){return N({url:"/rank/ac/problem/day30?page="+e+"&page_size="+l,method:"get"})}function Kr(e,l){return N({url:"/rank/ac/problem/year?page="+e+"&page_size="+l,method:"get"})}const Fr={style:{margin:"10px"}};function zt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const Or=de({__name:"RankUser",props:{type:{}},setup(e){const l=Se(),n=Xe(),{globalProperties:i}=_e();let o=null;const y=e,v=m(""),S=m(""),f={all:{header:"统计所有用户在本站的提交记录",content:"优先以AC记录数量排序，如果相同则提交所用次数较少的优先，如果仍相同，注册较早的用户靠前"},problem:{header:"统计所有用户在本站的提交记录",content:"以题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-today":{header:"统计所有用户今日在本站的提交记录",content:"以今日题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-day7":{header:"统计所有用户最近7日在本站的提交记录",content:"以7日题目记录数量排序（从7日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-day30":{header:"统计所有用户最近30日在本站的提交记录",content:"以30日题目记录数量排序（从30日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-year":{header:"统计所有用户最近1年在本站的提交记录",content:"以最近1年题目记录数量排序（从365日前的0点开始计算），如果相同，注册较早的用户靠前"}},s=m([]),$=[{title:"序号",colKey:"index"},{title:"用户名",colKey:"username",cell:(k,U)=>t(G,{variant:"dashed",onClick:()=>w(U.row.username)},{default:()=>[U.row.username]})},{title:"昵称",colKey:"nickname"},{title:"Slogan",colKey:"slogan"}],p=[{title:"题目数量",colKey:"problem_count",cell:(k,U)=>{let I=0;return U.row.problem_count&&(I=U.row.problem_count),t(G,{variant:"dashed",onClick:()=>c(U.row.username)},zt(I)?I:{default:()=>[I]})}}],C=[{title:"正确",colKey:"accept",cell:(k,U)=>{let I=0;return U.row.accept&&(I=U.row.accept),t(G,{variant:"dashed",onClick:()=>c(U.row.username)},zt(I)?I:{default:()=>[I]})}},{title:"提交",colKey:"attempt",cell:(k,U)=>{let I=0;return U.row.attempt&&(I=U.row.attempt),t(G,{variant:"dashed",onClick:()=>r(U.row.username)},zt(I)?I:{default:()=>[I]})}}],_=m(!1);let g=1,h=50;const u=m({current:g,pageSize:h,defaultCurrent:g,defaultPageSize:h,total:0,pageSizeOptions:[50]}),d=m(),w=k=>{n.push({name:"user",params:{username:k}})},c=k=>{n.push({name:"judge-list",query:{username:k,status:He.Accept}})},r=k=>{n.push({name:"judge-list",query:{username:k}})},j=async(k,U)=>{_.value=!0;try{d.value=[];const{current:I,pageSize:T}=k;let R=null;switch(y.type){case"problem":R=await Rr(I,T);break;case"problem-today":R=await Er(I,T);break;case"problem-day7":R=await Mr(I,T);break;case"problem-day30":R=await qr(I,T);break;case"problem-year":R=await Kr(I,T);break;default:R=await Ar(I,T);break}if(R.code===0){const z=R.data.list;if(!z||z.length<=0){u.value={...u.value,total:0},ke(i,"未找到记录");return}d.value=[];const V=u.value.pageSize*(u.value.current-1);let P=1;z.forEach(L=>{var H;const E=L;E.index=V+P++,(H=d.value)==null||H.push(E)}),u.value={...u.value,total:R.data.total_count}}else U&&O(i,R.code)}catch(I){console.error(I),O(i,Ne())}finally{_.value=!1}},b=async k=>{await n.push({query:{...l.query,page:k.current,page_size:k.pageSize}})};return fe(async()=>{_.value=!0,o=$e(()=>l.query,k=>{switch(y.type&&f[y.type]?(v.value=f[y.type].header,S.value=f[y.type].content):(v.value=f.all.header,S.value=f.all.content),y.type){case"all":s.value=$.concat(C);break;default:s.value=$.concat(p);break}const U=parseInt(k.page)||u.value.defaultCurrent,I=parseInt(k.page_size)||u.value.defaultPageSize;g=U,h=I,u.value={...u.value,current:g,pageSize:h},j({current:g,pageSize:h},!0)},{immediate:!0})}),De(()=>{o&&o()}),(k,U)=>{const I=Ee,T=he,R=Te,z=Ie;return D(),M(z,null,{default:a(()=>[t(R,{span:9},{default:a(()=>[t(T,{style:{margin:"10px"}},{default:a(()=>[t(I,{data:d.value,columns:s.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:u.value,loading:_.value,"table-layout":"auto",onPageChange:b},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(R,{span:3},{default:a(()=>[A("div",Fr,[t(T,{class:"sh-card",header:v.value,"header-bordered":!0},{default:a(()=>[x(q(S.value),1)]),_:1},8,["header"])])]),_:1})]),_:1})}}}),st=ce(Or,[["__scopeId","data-v-13682529"]]),Gr={style:{display:"flex","align-items":"center"}},Nr={style:{color:"#409eff","margin-right":"20px"}},Hr={class:"dida-login-footer"},Br=de({__name:"UserForget",setup(e){const{globalProperties:l}=_e(),n=Fe(),i=m(!1),o=m(!1),y=m(!1),v=m("发送验证码");let S=null,f=-1;const s=m(!1),$=m(null),p=m(""),C=m({username:"",emailKey:"",password:"",confirmPassword:""}),g=m({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:j=>new Promise(b=>{const k=setTimeout(()=>{b(C.value.password===j),clearTimeout(k)})}),message:"两次密码不一致"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),h=()=>{ke(l,"重置成功")},u=async j=>{if(!y.value){i.value=!0,o.value=!0;try{const b=await Hn(j,C.value.username);b.code===0?(ke(l,"验证码发送成功"),p.value=b.data,o.value=!1,y.value=!0,S=new Date,v.value="60秒后重发",f=setInterval(()=>{const U=Math.floor((new Date().getTime()-(S==null?void 0:S.getTime()))/1e3);U>60?(v.value="发送验证码",y.value=!1,clearInterval(f)):v.value=`${60-U}秒后重发`},1e3)):O(l,b.code)}catch(b){console.error("Send email key error",b),ge(l,"发送验证码失败")}finally{i.value=!1}}},d=async()=>{var U;if(s.value=!0,y.value||o.value)return;await mt();const j=document.getElementById("cf-confirm-div");j&&j.remove();const b=document.createElement("div");b.id="cf-confirm-div",b.setAttribute("data-theme","light"),(U=$.value)==null||U.appendChild(b);const k=window;k.turnstile.ready(function(){k.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(I){s.value=!1,await u(I)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},w=m(()=>t(G,{onClick:d,disabled:y.value,loading:o.value,style:"width:120px"},{default:()=>[v.value]})),c=async()=>{i.value=!0;try{const j=await Bn(C.value.username,C.value.password,C.value.emailKey);j.code===0?(ke(l,"密码修改成功"),l.$router.push({name:"login"})):O(l,j.code)}catch(j){console.error("Modify password error",j),ge(l,"修改密码失败")}finally{i.value=!1}},r=async({validateResult:j,firstError:b,e:k})=>{if(!i.value){if(k.preventDefault(),j!==!0){ge(l,b);return}p.value?await c():await d()}};return fe(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),De(()=>{}),(j,b)=>{const k=Ct,U=Ae,I=ze,T=ya,R=G,z=Ue,V=lt,P=he,L=nt;return D(),ae(pe,null,[t(P,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(k,{"max-line":1},{default:a(()=>b[6]||(b[6]=[A("span",null,"如果您未绑定邮箱或忘记用户名，可联系管理员寻求帮助",-1),A("span",null,"管理员邮箱：BoilTask@qq.com",-1)])),_:1}),t(k,{style:{"margin-top":"10px"}},{default:a(()=>b[7]||(b[7]=[A("p",null,"支持原acm.hpu.edu.cn、CodeOJ的用户直接登录",-1),A("p",null,"原DMOJ、hpuoj.com的用户，请先重置密码",-1),A("p",null,"可尝试学号/昵称等作为用户名登录，成功后有机会合并账户或修改用户名",-1)])),_:1}),t(z,{ref:"form",rules:g.value,data:C.value,colon:!0,onReset:h,onSubmit:r,class:"yj-login-form"},{default:a(()=>[t(I,{name:"username",label:"用户名"},{default:a(()=>[t(U,{modelValue:C.value.username,"onUpdate:modelValue":b[0]||(b[0]=E=>C.value.username=E),clearable:"",placeholder:"请输入完整用户名"},null,8,["modelValue"])]),_:1}),p.value?(D(),ae(pe,{key:0},[t(I,{name:"email",label:"发送邮箱"},{default:a(()=>[t(T,{append:w.value},{default:a(()=>[A("div",Gr,[A("span",Nr,q(p.value),1)])]),_:1},8,["append"])]),_:1}),t(I,{name:"emailKey",label:"验证码"},{default:a(()=>[t(U,{modelValue:C.value.emailKey,"onUpdate:modelValue":b[1]||(b[1]=E=>C.value.emailKey=E),clearable:"",placeholder:"请输入收到的验证码"},null,8,["modelValue"])]),_:1}),t(I,{name:"password",label:"新密码"},{default:a(()=>[t(U,{modelValue:C.value.password,"onUpdate:modelValue":b[2]||(b[2]=E=>C.value.password=E),type:"password",clearable:"",placeholder:"新密码"},null,8,["modelValue"])]),_:1}),t(I,{name:"confirmPassword",label:"确认密码"},{default:a(()=>[t(U,{modelValue:C.value.confirmPassword,"onUpdate:modelValue":b[3]||(b[3]=E=>C.value.confirmPassword=E),type:"password",clearable:"",placeholder:"请重复输入密码"},null,8,["modelValue"])]),_:1})],64)):le("",!0),p.value?(D(),M(I,{key:1},{default:a(()=>[t(R,{theme:"primary",type:"submit",block:"",loading:i.value},{default:a(()=>b[8]||(b[8]=[x("修改密码")])),_:1},8,["loading"])]),_:1})):(D(),M(I,{key:2},{default:a(()=>[t(R,{theme:"primary",type:"submit",block:"",loading:i.value},{default:a(()=>b[9]||(b[9]=[x("重置密码")])),_:1},8,["loading"])]),_:1}))]),_:1},8,["rules","data"]),A("div",Hr,[t(V,{onClick:b[4]||(b[4]=()=>{ve(l).$router.push({name:"login"})})},{default:a(()=>b[10]||(b[10]=[x("返回登陆 ")])),_:1})])]),_:1}),t(L,{visible:s.value,"onUpdate:visible":b[5]||(b[5]=E=>s.value=E),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:a(()=>[A("div",{ref_key:"dialogContainer",ref:$,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),Wr=ce(Br,[["__scopeId","data-v-e960b193"]]),Jr={class:"judger-status-panel"},Yr={style:{"text-align":"center","margin-bottom":"20px"}},Xr={class:"judger-status-panel"};function Zr(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const Qr=de({__name:"SystemStatus",setup(e){const{globalProperties:l}=_e(),n=m([]),i=m([]),o=m(!1),y=m(0),v=m(0);let S;const f=p=>{let C="失效",_="danger";const g=new Date,h=new Date(p.updateTime);return g.getTime()-h.getTime()>3e4?(C="离线",_="default"):p.cpuUsage>90?(C="CPU过高",_="warning"):p.memPercent>90?(C="内存过高",_="warning"):(C="在线",_="success"),t(we,null,{default:()=>[t("span",null,[p.key,x(" - "),p.name]),t("span",null,[p.updateTime]),t(et,{theme:_,size:"small"},Zr(C)?C:{default:()=>[C]})]})},s=async()=>{const p={};for(let r=0;r<n.value.length;r++){const j=n.value[r];p[j.key]={...j}}const C={};for(let r=0;r<i.value.length;r++){const j=i.value[r];C[j.key]={...j}}const _=[],g=[],h=await Ql();if(h.code!==0){O(l,h.code);return}const u=h.data.web,d={key:"didaoj"};u.name?d.name=u.name:d.name="-",u.update_time?d.updateTime=new Date(u.update_time).toLocaleString():d.updateTime="-",u.cpu_usage?d.cpuUsage=Number(u.cpu_usage):d.cpuUsage=0,u.mem_usage?d.memUsage=u.mem_usage/(1024*1024*1024):d.memUsage=0,u.mem_total?d.memTotal=u.mem_total/(1024*1024*1024):d.memTotal=0,d.memTotal>0?d.memPercent=Math.round(d.memUsage/d.memTotal*1e4)/100:d.memPercent=0,d.avgMessage=u.avg_message;const w=p[d.key];w?(d.cpuUsageFrom=w.cpuUsage,d.memPercentFrom=w.memPercent,d.memUsageFrom=w.memUsage,d.memTotalFrom=w.memTotal):(d.cpuUsageFrom=0,d.memPercentFrom=0,d.memUsageFrom=0,d.memTotalFrom=0),_.push(d),n.value=_;const c=h.data.judger;for(let r=0;r<c.length;r++){const j=c[r],b={key:j.key,name:j.name};j.name?b.name=j.name:b.name="-",j.update_time?b.updateTime=new Date(j.update_time).toLocaleString():b.updateTime="-",j.cpu_usage?b.cpuUsage=Number(j.cpu_usage):b.cpuUsage=0,j.mem_usage?b.memUsage=j.mem_usage/(1024*1024*1024):b.memUsage=0,j.mem_total?b.memTotal=j.mem_total/(1024*1024*1024):b.memTotal=0,b.memTotal>0?b.memPercent=Math.round(b.memUsage/b.memTotal*1e4)/100:b.memPercent=0,b.avgMessage=j.avg_message,C[j.key]?(b.cpuUsageFrom=C[j.key].cpuUsage,b.memPercentFrom=C[j.key].memPercent,b.memUsageFrom=C[j.key].memUsage,b.memTotalFrom=C[j.key].memTotal):(b.cpuUsageFrom=0,b.memPercentFrom=0,b.memUsageFrom=0,b.memTotalFrom=0),g.push(b)}i.value=g,y.value=v.value,v.value=h.data.judge_job},$=async()=>{await s(),o.value=!1};return fe(async()=>{i.value=[],n.value=[],o.value=!0,await $(),S=setInterval(()=>{$()},5e3)}),De(()=>{clearInterval(S)}),(p,C)=>{const _=Vl,g=we,h=he,u=Ve;return D(),M(u,{loading:o.value},{default:a(()=>[t(h,{title:"接口状态",class:"judger-status"},{default:a(()=>[A("div",Jr,[(D(!0),ae(pe,null,Pe(n.value,d=>(D(),M(h,{key:d.key,header:()=>f(d),class:"judge-status-judger"},{footer:a(()=>[A("span",null," 负载信息："+q(d.avgMessage),1)]),default:a(()=>[t(g,{class:"judge-status-judger"},{default:a(()=>[t(_,{title:"CPU使用率",value:d.cpuUsage,animation:{valueFrom:d.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(_,{title:"内存使用率",value:d.memPercent,animation:{valueFrom:d.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(_,{title:"内存使用量",animation:{valueFrom:d.memUsageFrom,duration:2e3},"animation-start":!0,value:d.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(_,{title:"内存总量",value:d.memTotal,animation:{valueFrom:d.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1}),t(h,{title:"判题机状态",class:"judger-status"},{default:a(()=>[A("div",Yr,[t(_,{title:"未完成的评测数量",value:v.value,animation:{valueFrom:y.value,duration:4e3},"animation-start":!0},null,8,["value","animation"])]),A("div",Xr,[(D(!0),ae(pe,null,Pe(i.value,d=>(D(),M(h,{key:d.key,header:()=>f(d),class:"judge-status-judger"},{footer:a(()=>[A("span",null," 负载信息："+q(d.avgMessage),1)]),default:a(()=>[t(g,{class:"judge-status-judger"},{default:a(()=>[t(_,{title:"CPU使用率",value:d.cpuUsage,animation:{valueFrom:d.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(_,{title:"内存使用率",value:d.memPercent,animation:{valueFrom:d.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(_,{title:"内存使用量",animation:{valueFrom:d.memUsageFrom,duration:2e3},"animation-start":!0,value:d.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(_,{title:"内存总量",value:d.memTotal,animation:{valueFrom:d.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1})]),_:1},8,["loading"])}}}),ei=ce(Qr,[["__scopeId","data-v-d4d5542c"]]),ti=de({__name:"ManageJudge",setup(e){const{globalProperties:l}=_e(),n=m(!1),i=m(!1),o=m({problemId:"",language:void 0,status:void 0}),y=m(!1),v=m([]);v.value=Ot();const S=m([]);S.value=Da();const f=async()=>{n.value=!0;try{const p=await dn();if(p.code!==0){O(l,p.code);return}ke(l,"重判成功"),await X.push({name:"judge-list"})}catch(p){console.error(p),O(l,"重判失败")}finally{n.value=!1}},s=async()=>{if(!o.value.problemId&&!o.value.language&&!o.value.status){O(l,"请输入问题Id");return}y.value=!0;try{const p=await cn(o.value.problemId,o.value.language,o.value.status);if(p.code!==0){O(l,p.code);return}ke(l,"重判成功"),await X.push({name:"judge-list",query:{problem_id:o.value.problemId,language:o.value.language}})}catch(p){console.error(p),O(l,"重判失败")}finally{y.value=!1}},$=async()=>{i.value=!0;try{const p=await mn();if(p.code!==0){O(l,p.code);return}ke(l,"重判成功"),await X.push({name:"judge-list"})}catch(p){console.error(p),O(l,"重判失败")}finally{i.value=!1}};return(p,C)=>{const _=G,g=he,h=Ae,u=ze,d=Kt,w=ft,c=we,r=Ue;return D(),ae(pe,null,[t(g,{class:"yj-manage-card",title:"重判最近提交"},{default:a(()=>[t(_,{onClick:f,loading:n.value},{default:a(()=>C[3]||(C[3]=[x("重判")])),_:1},8,["loading"])]),_:1}),t(g,{class:"yj-manage-card",title:"重判指定记录"},{default:a(()=>[t(r,{layout:"inline",onSubmit:s},{default:a(()=>[t(u,{label:"题号"},{default:a(()=>[t(h,{modelValue:o.value.problemId,"onUpdate:modelValue":C[0]||(C[0]=j=>o.value.problemId=j),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(u,{label:"语言"},{default:a(()=>[t(w,{modelValue:o.value.language,"onUpdate:modelValue":C[1]||(C[1]=j=>o.value.language=j),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:a(()=>[(D(!0),ae(pe,null,Pe(v.value,j=>(D(),M(d,{key:j.value,value:j.value,label:j.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"状态"},{default:a(()=>[t(w,{modelValue:o.value.status,"onUpdate:modelValue":C[2]||(C[2]=j=>o.value.status=j),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:a(()=>[(D(!0),ae(pe,null,Pe(S.value,j=>(D(),M(d,{key:j.value,value:j.value,label:j.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,null,{default:a(()=>[t(c,null,{default:a(()=>[t(_,{theme:"primary",type:"submit",loading:y.value},{default:a(()=>C[4]||(C[4]=[x("重判")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(g,{class:"yj-manage-card",title:"重判所有"},{default:a(()=>[t(_,{onClick:$,theme:"danger",loading:i.value},{default:a(()=>C[5]||(C[5]=[x("重判")])),_:1},8,["loading"])]),_:1})],64)}}}),ai=ce(ti,[["__scopeId","data-v-6d48cbf2"]]),li=de({__name:"ManageWeb",setup(e){const{globalProperties:l}=_e(),n=m({theme:"",content:""}),i=m({title:"",content:""}),o=m(!1),y=m(!1),v=m(!1);async function S(C,_){v.value=!0,await ut(C,_,l,en),v.value=!1}const f=async()=>{y.value=!0;try{const C=await tn(n.value.theme,n.value.content);if(C.code!==0){O(l,C.code);return}ke(l,"保存成功")}catch(C){console.error(C),O(l,"保存失败")}finally{y.value=!1}},s=async()=>{v.value=!0;try{const C=i.value.content,_=await an(i.value.title,C);if(_.code!==0){O(l,_.code);return}i.value.content=_.data.content,ke(l,"保存成功")}catch(C){console.error(C),ge(l,"保存失败")}finally{v.value=!1}},$=async()=>{n.value=await xa()},p=async()=>{try{i.value=await Ta()}catch{ge(l,"加载公告失败"),i.value={title:"",content:""}}};return fe(async()=>{o.value=!0;try{await $(),await p()}catch{ge(l,"加载数据失败")}o.value=!1}),(C,_)=>{const g=ft,h=ze,u=Ae,d=G,w=we,c=Ue,r=he,j=Re("md-editor-v3"),b=Ve;return D(),M(b,{loading:o.value},{default:a(()=>[t(r,{class:"yj-manage-card",title:"站点通知"},{default:a(()=>[t(c,{onSubmit:f},{default:a(()=>[t(h,{label:"主题"},{default:a(()=>[t(g,{modelValue:n.value.theme,"onUpdate:modelValue":_[0]||(_[0]=k=>n.value.theme=k),options:[{label:"success",value:"success"},{label:"info",value:"info"},{label:"warning",value:"warning"},{label:"error",value:"error"}],placeholder:"请选择主题"},null,8,["modelValue"])]),_:1}),t(h,{label:"内容"},{default:a(()=>[t(u,{modelValue:n.value.content,"onUpdate:modelValue":_[1]||(_[1]=k=>n.value.content=k),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),t(h,null,{default:a(()=>[t(w,null,{default:a(()=>[t(d,{theme:"primary",type:"submit",loading:y.value},{default:a(()=>_[4]||(_[4]=[x("保存")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(r,{class:"yj-manage-card",title:"首页公告"},{actions:a(()=>[t(d,{theme:"primary",loading:v.value,onClick:s},{default:a(()=>_[5]||(_[5]=[x("保存")])),_:1},8,["loading"])]),default:a(()=>[t(c,{onSubmit:s},{default:a(()=>[t(h,{label:"标题"},{default:a(()=>[t(u,{modelValue:i.value.title,"onUpdate:modelValue":_[2]||(_[2]=k=>i.value.title=k),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1}),t(b,{loading:v.value},{default:a(()=>[t(j,{modelValue:i.value.content,"onUpdate:modelValue":_[3]||(_[3]=k=>i.value.content=k),onSave:s,onOnUploadImg:S,previewTheme:"cyanosis",class:"dida-description-editor"},null,8,["modelValue"])]),_:1},8,["loading"])]),_:1})]),_:1},8,["loading"])}}}),ni=ce(li,[["__scopeId","data-v-8c162eb5"]]),Ka=[{name:"problem-list",tab:"problem",sidebar:"problem-list",path:"",title:"问题列表",icon:"list",component:fo},{name:"problem-detail",tab:"problem",sidebar:"problem-list",path:":problemId+",title:"问题详情",icon:"list",component:Lt},{name:"problem-daily-list",tab:"problem",sidebar:"problem-daily-list",path:"daily",title:"每日一题",icon:"list",component:Oo},{name:"problem-daily-detail",tab:"problem",sidebar:"problem-daily-list",path:"daily/:dailyId+",title:"问题详情",icon:"list",component:Lt},{name:"problem-recommend",tab:"problem",sidebar:"problem-recommend",path:"recommend/:problemId*",title:"问题推荐",icon:"cpu",needLogin:!0,component:Xo},{name:"problem-collection-list",tab:"problem",sidebar:"problem-collection-list",path:"collection",title:"题目集合",icon:"list",disableTabPath:!0,component:hs},{name:"collection-detail",tab:"collection-detail-tab",sidebar:"collection-detail",path:":collectionId+",title:"题集详情",icon:"cpu",component:Cs},{name:"collection-rank",tab:"collection-detail-tab",sidebar:"collection-rank",path:":collectionId+/rank",title:"题集排名",icon:"list",component:Is},{name:"collection-edit",tab:"collection-detail-tab",sidebar:"collection-edit",disableSidebar:!0,needLogin:!0,path:":collectionId+/edit",title:"题集编辑",icon:"list",component:oa},{name:"collection-create",tab:"collection-detail-tab",sidebar:"collection-create",needLogin:!0,disableSidebar:!0,path:"create",title:"新建题集",icon:"list",component:oa},{name:"judge-list",tab:"judge",sidebar:"judge-list",path:"",title:"评测列表",icon:"list",component:ra},{name:"judge-detail",tab:"judge",sidebar:"judge-list",path:":judgeId+",title:"评测详情",icon:"cpu",component:ua},{name:"contest-list",tab:"contest",sidebar:"contest-list",path:"",title:"比赛列表",icon:"list",component:da},{name:"contest-recent",tab:"contest",sidebar:"contest-recent",path:"recent",title:"近期比赛",icon:"list",component:da},{name:"contest-create",tab:"contest",sidebar:"contest-create",disableSidebar:!0,needLogin:!0,path:"create",title:"新建比赛",icon:"list",component:ma},{name:"contest-edit",tab:"contest-detail-tab",sidebar:"contest-edit",disableSidebar:!0,needLogin:!0,path:":contestId+/edit",title:"比赛编辑",icon:"list",component:ma},{name:"contest-detail",tab:"contest-detail-tab",sidebar:"contest-detail",path:":contestId+",title:"比赛详情",icon:"cpu",component:Ys},{name:"contest-problem-detail",tab:"contest-detail-tab",sidebar:"contest-problem-detail",path:":contestId+/problem/:problemIndex+",title:"问题详情",icon:"cpu",disableSidebar:!0,component:Lt},{name:"contest-judge",tab:"contest-detail-tab",sidebar:"contest-judge",path:":contestId+/judge",title:"评测列表",icon:"list",component:ra},{name:"contest-judge-detail",tab:"contest-detail-tab",sidebar:"contest-judge-detail",path:":contestId+/judge/:judgeId+",title:"评测详情",icon:"cpu",component:ua,disableSidebar:!0},{name:"contest-rank",tab:"contest-detail-tab",sidebar:"contest-rank",path:":contestId+/rank",title:"比赛排名",icon:"list",component:ar},{name:"contest-discuss",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss",title:"比赛讨论",icon:"list",component:$t},{name:"contest-discuss-detail",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss/:discussId+",title:"讨论详情",icon:"list",component:Ut},{name:"discuss-list",tab:"discuss",sidebar:"discuss-list",path:"",title:"讨论列表",icon:"list",component:$t},{name:"discuss-create",tab:"discuss",sidebar:"discuss-create",disableSidebar:!0,needLogin:!0,path:"create",title:"新建讨论",icon:"list",component:pa},{name:"discuss-edit",tab:"discuss-detail-tab",sidebar:"discuss-edit",disableSidebar:!0,needLogin:!0,path:":discussId+/edit",title:"编辑讨论",icon:"list",component:pa},{name:"discuss-list-problem",tab:"discuss",sidebar:"discuss-list-problem",path:"problem",title:"题目讨论",icon:"list",component:$t},{name:"discuss-detail",tab:"discuss",sidebar:"discuss-list",path:":discussId+",title:"讨论详情",icon:"list",component:Ut},{name:"rank-ac-all",tab:"rank",sidebar:"rank-ac-all",path:"ac",title:"AC排名",icon:"base-station",props:{type:"all"},component:st},{name:"rank-ac-problem",tab:"rank",sidebar:"rank-ac-problem",path:"ac/problem",title:"题量排名",icon:"base-station",props:{type:"problem"},component:st},{name:"rank-ac-problem-today",tab:"rank",sidebar:"rank-ac-problem-today",path:"ac/problem/today",title:"今日题量",icon:"base-station",props:{type:"problem-today"},component:st},{name:"rank-ac-problem-day7",tab:"rank",sidebar:"rank-ac-problem-day7",path:"ac/problem/day7",title:"7日题量",icon:"base-station",props:{type:"problem-day7"},component:st},{name:"rank-ac-problem-day30",tab:"rank",sidebar:"rank-ac-problem-day30",path:"ac/problem/day30",title:"30日题量",icon:"base-station",props:{type:"problem-day30"},component:st},{name:"rank-ac-problem-year",tab:"rank",sidebar:"rank-ac-problem-year",path:"ac/problem/year",title:"1年题量",icon:"base-station",props:{type:"problem-year"},component:st},{name:"system-status",tab:"system",sidebar:"system-status",path:"",title:"运行状态",icon:"base-station",component:ei},{name:"system-about",tab:"system",sidebar:"system-about",path:"about",title:"关于",icon:"base-station",props:{discussId:"93"},component:Ut},{name:"manage-problem-create",tab:"manage",sidebar:"manage-problem-create",disableSidebar:!0,path:"problem",title:"新建问题",icon:"list",component:na,auths:[Le.ManageProblem]},{name:"manage-problem",tab:"manage",sidebar:"manage-problem",disableSidebar:!0,path:"problem/:problemId+",title:"问题编辑",icon:"list",component:na,auths:[Le.ManageProblem]},{name:"manage-problem-daily-create",tab:"manage",sidebar:"manage-problem-daily-create",disableSidebar:!0,path:"problem/daily",title:"新建每日一题",icon:"list",component:la,auths:[Le.ManageProblemDaily]},{name:"manage-problem-daily",tab:"manage",sidebar:"manage-problem-daily",disableSidebar:!0,path:"problem/daily/:dailyId+",title:"编辑每日一题",icon:"list",component:la,auths:[Le.ManageProblemDaily]},{name:"manage-problem-judge",tab:"manage",sidebar:"manage-problem-judge",disableSidebar:!0,path:"problem/:problemId+/judge",title:"评测数据",icon:"list",component:is,auths:[Le.ManageProblem]},{name:"manage-web",tab:"manage",path:"web",sidebar:"manage-web",title:"站点管理",icon:"list",auths:[Le.ManageWeb],component:ni},{name:"manage-judge",tab:"manage",path:"judge",sidebar:"manage-judge",title:"评测管理",icon:"list",auths:["i-manage-judge"],component:ai},{name:"login-forget",tab:"login",path:"forget",title:"忘记密码",component:Wr}],fa=(e,l,n,i)=>{i.tab==n&&(i.disableSidebar&&l!=i.sidebar||i.sidebar==null||i.sidebar!=i.name||e.push({name:i.name,title:i.title,icon:i.icon,to:{name:i.name}}))},oi=(e,l)=>{const n=[];return Ka.forEach(i=>{if(Ra(i)){const o=[];i.children.forEach(y=>{fa(o,e,l,y)}),o.length>0&&n.push({title:i.title,children:o})}else fa(n,e,l,i)}),n},va=(e,l)=>{const n=oo(l.tab),i={name:l.name,path:"/"+l.path,meta:{title:l.title+" - "+n.title,tab:l.tab,sidebar:l.sidebar,showSidebar:n.showSidebar,needLogin:n.needLogin||l.needLogin,tabAuths:n.auths,auths:l.auths},props:l.props,component:l.component};!n.disablePath&&!l.disableTabPath&&(i.path=n.path+i.path),e.push(i)},si=e=>{Ka.forEach(l=>{Ra(l)?l.children.forEach(n=>{va(e,n)}):va(e,l)})},ri={class:"sh-main"},ii=de({__name:"View403",setup(e){let l=Se();const n=m("");return fe(()=>{l.query.target?n.value=l.query.target:n.value=l.fullPath}),(i,o)=>{const y=G;return D(),ae("div",ri,[A("p",null,q(n.value),1),o[2]||(o[2]=A("p",null,"该页面无访问权限，请更换访问目标或重新登陆后再试",-1)),t(y,{theme:"primary",onClick:o[0]||(o[0]=()=>i.$router.push("/"))},{default:a(()=>o[1]||(o[1]=[x("返回首页")])),_:1})])}}}),Fa=ce(ii,[["__scopeId","data-v-777362b3"]]),gt=[];ro(gt);si(gt);gt.push({path:"/403",name:"403",component:Fa});gt.push({path:"/:pathMatch(.*)*",name:"404",component:Aa});const X=ol({history:sl("/"),routes:gt});X.beforeEach((e,l,n)=>{if(e.name==null||!X.hasRoute(e.name)){n({name:"home"});return}const i=e.matched[e.matched.length-1].meta;if(i.redirect){n({name:i.redirect});return}if(i.needLogin){const y=Fe();if(y.getToken==null||y.getToken==""){n({name:"login",query:{redirect_uri:e.fullPath}});return}}const o=i.tabAuths;if(o&&!Fe().hasAllAuths(o)){n({name:"403",query:{target:e.fullPath}});return}n()});X.afterEach((e,l)=>{if(e.name===l.name)return;const n=Pt(),i=Ze();let o=null;if(e.matched.length>0&&(o=e.matched[e.matched.length-1].meta),o!=null&&o.title&&i.setTitle(o==null?void 0:o.title),o!=null&&o.showSidebar){n.setSidebarShow(!0);const y=oi(o==null?void 0:o.sidebar,o==null?void 0:o.tab);n.setMenuList(y),n.setMenuActiveName(o==null?void 0:o.sidebar)}else n.setSidebarShow(!1);window.scrollTo(0,0)});const Oa=pt("login",{state:()=>({Loaded:!1}),getters:{isLoaded(){return this.Loaded}}}),ui=de({__name:"HeaderContent",setup(e){const l=Oa(),n=Fe(),{globalProperties:i}=_e(),o=m(l.isLoaded),y=m(!1),v=m(n.getUsername),S=m(n.getNickname),f=m(),s=()=>{f.value=so(n)};l.$subscribe((C,_)=>{o.value=_.Loaded}),n.$subscribe((C,_)=>{v.value=_.username,S.value=_.nickname,y.value=_.token!="",s()});const $=()=>{i.$router.currentRoute.value.name!=="login"&&i.$router.push({name:"login",query:{redirect_uri:i.$router.currentRoute.value.fullPath}})},p=()=>{n.clear(),i.$message.success({duration:3e3,content:"注销成功"}),i.$router.push({path:"/login",query:{redirect_uri:i.$router.currentRoute.value.fullPath}})};return fe(()=>{s()}),(C,_)=>{const g=Re("router-link"),h=Ia,u=Ca,d=Dl,w=jl;return D(),M(w,{modelValue:C.$route.meta.tab,"onUpdate:modelValue":_[0]||(_[0]=c=>C.$route.meta.tab=c),class:"sh-menu","expand-type":"popup"},{logo:a(()=>[t(g,{to:"/",class:"sh-logo"},{default:a(()=>_[1]||(_[1]=[x("DidaOJ")])),_:1})]),operations:a(()=>[o.value&&y.value?(D(),M(d,{key:0,title:S.value},{icon:a(()=>[t(h,{name:"user"})]),default:a(()=>[t(u,{value:"user",to:{path:"/user/"+v.value}},{default:a(()=>_[2]||(_[2]=[x("个人空间")])),_:1},8,["to"]),t(u,{value:"user_logout",onClick:p},{default:a(()=>_[3]||(_[3]=[x(" 注销")])),_:1})]),_:1},8,["title"])):o.value?(D(),M(u,{key:2,value:"login",onClick:$},{icon:a(()=>[t(h,{name:"login"})]),default:a(()=>[_[5]||(_[5]=x(" 登录 "))]),_:1})):(D(),M(u,{key:1,value:"login"},{icon:a(()=>[t(h,{name:"login"})]),default:a(()=>[_[4]||(_[4]=x(" ... "))]),_:1}))]),default:a(()=>[(D(!0),ae(pe,null,Pe(f.value,c=>(D(),M(u,{key:c.name,value:c.name,to:{name:c.name}},{icon:a(()=>[c.icon?(D(),M(h,{key:0,name:c.icon},null,8,["name"])):le("",!0)]),default:a(()=>[x(" "+q(c.title),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])}}}),di=ce(ui,[["__scopeId","data-v-b7d90d1a"]]),ci={id:"menu-container"},mi=de({__name:"SidebarContent",setup(e){const l=Pt(),n=m(!1),i=m(null),o=m(l.menuActiveName),y=m(l.menuList),v=m([]),S=m(!1),f=()=>{o.value=l.menuActiveName;const $=JSON.stringify(y.value),p=JSON.stringify(l.menuList);$!==p&&(v.value.push([...l.menuList]),s())},s=async()=>{if(v.value.length>0&&!S.value){for(S.value=!0;v.value.length>1;)v.value.shift();const $=v.value.shift();n.value=$.length<=0,y.value=[],await mt(),i.value&&i.value.updateActiveName(),await new Promise(C=>setTimeout(C,300)),y.value=$,await mt(),i.value&&i.value.updateActiveName();const p=300;await new Promise(C=>setTimeout(C,p)),S.value=!1,await s()}};return l.$subscribe(($,p)=>{f()}),fe(()=>{f()}),($,p)=>{const C=Ia,_=Ca,g=$l,h=Ll,u=Ve;return D(),ae(pe,null,[A("div",ci,[t(h,{modelValue:o.value,"onUpdate:modelValue":p[0]||(p[0]=d=>o.value=d),theme:"light",class:"sh-menu-container"},{default:a(()=>[t(rl,{name:"move-left"},{default:a(()=>[(D(!0),ae(pe,null,Pe(y.value,(d,w)=>(D(),ae(pe,{key:w},[ve(io)(d)?(D(),M(g,{key:0,title:d.title},{default:a(()=>[(D(!0),ae(pe,null,Pe(d.children,(c,r)=>(D(),M(_,{key:c.name,value:c.name,to:c.to},Zt({default:a(()=>[x(" "+q(c.title),1)]),_:2},[c.icon?{name:"icon",fn:a(()=>[t(C,{name:c.icon,class:Et(c.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))),128))]),_:2},1032,["title"])):(D(),M(_,{key:d.name,value:d.name,to:d.to},Zt({default:a(()=>[x(" "+q(d.title),1)]),_:2},[d.icon?{name:"icon",fn:a(()=>[t(C,{name:d.icon,class:Et(d.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),t(u,{size:"small",loading:n.value,"show-overlay":!0,attach:"#menu-container",class:"sh-sidebar-loading",style:{"align-items":"flex-start","padding-top":"100px"}},null,8,["loading"])],64)}}}),pi=ce(mi,[["__scopeId","data-v-96e2d89f"]]),fi={};function vi(e,l){return null}const _i=ce(fi,[["render",vi]]),gi={class:"footer"},bi={class:"footer-left"},hi={class:"foot-time"},yi={class:"footer-center"},wi={href:"https://beiancx.miit.gov.cn/",target:"_blank"},ki={class:"footer-right"},Si={class:"foot-text"},Ci={href:"https://github.com/hpu-developer/DiDaOJ-web",target:"_blank"},Ii={class:"foot-text"},Pi={href:"https://github.com/hpu-developer/DiDaOJ-go",target:"_blank"},xi=de({__name:"FooterContent",setup(e){const l=m("");function n(){l.value=new Date().toLocaleString()}return fe(()=>{n(),setInterval(()=>{n()},1e3)}),(i,o)=>{const y=G;return D(),ae("div",gi,[A("div",bi,[A("p",hi,q(l.value),1)]),A("div",yi,[A("a",wi,[t(y,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>o[0]||(o[0]=[x("豫ICP备15024677号-4")])),_:1})])]),A("div",ki,[A("p",Si,[A("a",Ci,[t(y,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>o[1]||(o[1]=[x("@didaoj-web")])),_:1})])]),A("p",Ii,[A("a",Pi,[t(y,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>o[2]||(o[2]=[x("@didaoj-go")])),_:1})])])])])}}}),Ti=ce(xi,[["__scopeId","data-v-44f2e4e7"]]),bt=20,At=100,Rt=50,Vi=de({__name:"ForceHiddenSidebarButton",setup(e){let l=Pt();const n=m({x:window.innerWidth-At-bt,y:window.innerHeight-Rt-bt}),i=m(window.innerWidth),o=m(window.innerHeight);let y=!1,v={x:0,y:0};const S=d=>{y=!0;const w=d.clientX??d.touches[0].clientX,c=d.clientY??d.touches[0].clientY;v={x:w-n.value.x,y:c-n.value.y},document.addEventListener("mousemove",f),document.addEventListener("touchmove",f),document.addEventListener("mouseup",s),document.addEventListener("touchend",s)},f=d=>{if(!y)return;const w=d.clientX??d.touches[0].clientX,c=d.clientY??d.touches[0].clientY;let r=w-v.x,j=c-v.y;r=Math.max(0,Math.min(r,i.value-At)),j=Math.max(0,Math.min(j,o.value-Rt)),n.value={x:r,y:j}},s=()=>{y=!1,document.removeEventListener("mousemove",f),document.removeEventListener("touchmove",f),document.removeEventListener("mouseup",s),document.removeEventListener("touchend",s)},$=()=>{i.value=window.innerWidth,o.value=window.innerHeight,n.value={x:Math.min(n.value.x,i.value-At-bt),y:Math.min(n.value.y,o.value-Rt-bt)}};let p=m(l.forceHiddenSidebar),C=m(l.forceHiddenSidebar);const _=()=>{p.value=!p.value,l.setForceHiddenSidebar(p.value)},g=()=>{C.value||(C.value=!0,l.setForceHiddenSidebar(p.value))},h=()=>{C.value&&(C.value=!1,l.setForceHiddenSidebar(!1))},u=d=>{d>=800?h():g()};return u(i.value),$e(i,d=>{u(d)}),fe(()=>{window.addEventListener("resize",$)}),De(()=>{window.removeEventListener("resize",$)}),(d,w)=>{const c=G;return ve(C)?(D(),M(c,{key:0,class:"draggable-button",style:ga({top:`${n.value.y}px`,left:`${n.value.x}px`}),onMousedown:S,onTouchstart:S,variant:"dashed",theme:"primary",onClick:_},{default:a(()=>[x(q(ve(p)?"显示":"隐藏"),1)]),_:1},8,["style"])):le("",!0)}}}),Di=ce(Vi,[["__scopeId","data-v-1aee5506"]]),ht="DidaOJ",ji=de({__name:"App",setup(e){const{globalProperties:l}=_e(),n=Oa(),i=Fe(),o=Ze(),y=Pt();n.$patch({Loaded:!1});const v=i.getToken,S=m(!1),f=m(!1);o.title&&o.title.length>0?document.title=o.title+" - "+ht:document.title=ht,o.$subscribe((_,g)=>{g.title&&g.title.length>0?document.title=g.title+" - "+ht:document.title=ht}),y.$subscribe((_,g)=>{S.value=g.showSidebar,f.value=S.value&&!g.forceHiddenSidebar});const s=Se(),$=Be(()=>{const _=s.meta.auths;return _?!i.hasAllAuths(_):!1});function p(){l.$message.warning({duration:3e3,content:"登陆状态失效"}),n.$patch({Loaded:!0}),i.clear()}const C=async()=>{const _=document.querySelectorAll("oj-problem");if(_.length===0)return;let g={};_.forEach(d=>{const w=d.getAttribute("id"),c=document.createElement("span");c.setAttribute("style","padding:5px"),d.replaceWith(c);const r=m("default");g[w]||(g[w]=[]),g[w].push(r);let j=w;w&&!w.includes("-")&&(j="DidaOJ-"+w),ha({render:()=>dl(G,{innerHTML:j,onClick:()=>{window.open(`/problem/${w}`,"_blank")},size:"small",variant:"outline",theme:r.value})}).mount(c)});const h=[];for(const d in g)h.push(d);const u=await wn(h);if(u.code===0)for(const d in g){const w=g[d];if(!w)continue;let c="primary";const r=u.data[d];if(r)switch(r){case Oe.Accept:c="success";break;case Oe.Attempt:c="warning";break}for(const j of w)j.value=c}};return fe(()=>{document.addEventListener("DOMContentLoaded",()=>{new MutationObserver(()=>{Fl(()=>{C()},1e3)()}).observe(document.body,{childList:!0,subtree:!0}),il.autoSpacingPage()}),v?Mn().then(_=>{_.code==0?(i.loadResponse(_.data),n.$patch({Loaded:!0})):(O(l,_.code),n.$patch({Loaded:!0}),i.clear())}).catch(_=>{console.log(_),p()}):n.$patch({Loaded:!0})}),(_,g)=>{const h=Ul,u=Al,d=Re("RouterView"),w=Rl,c=zl,r=El;return D(),ae(pe,null,[t(c,{class:"sh-app-layout"},{default:a(()=>[t(h,{class:"sh-header"},{default:a(()=>[t(di)]),_:1}),t(c,null,{default:a(()=>[t(ul,{name:"slide"},{default:a(()=>[f.value?(D(),M(u,{key:0,class:"sh-sidebar"},{default:a(()=>[t(pi)]),_:1})):le("",!0)]),_:1}),t(c,{class:Et(["sh-main-layout",{expanded:!f.value}])},{default:a(()=>[t(_i),t(w,{class:"sh-main-content"},{default:a(()=>[$.value?(D(),M(Fa,{key:0})):(D(),M(d,{key:1}))]),_:1}),t(Ti)]),_:1},8,["class"])]),_:1})]),_:1}),S.value?(D(),M(Di,{key:0})):le("",!0),t(r,{container:"body",offset:["24px","80px"],size:"small"})],64)}}}),Li=ce(ji,[["__scopeId","data-v-f9446443"]]);function $i(e,l={}){const n=/\{\{%\s*(\w+)\s+([^%]+?)\s*%\}\}/g,i=l.renderers||{},o=e.renderer.rules.text??function(y,v){return y[v].content};e.renderer.rules.text=function(y,v,S,f,s){const p=y[v].content;return n.test(p)?p.replace(n,(_,g,h)=>{const u=i[g];if(typeof u=="function"){const d=h.trim().split(/\s+/);return u(d)}else return`<span class="shortcode-${g}">${g}: ${h.trim()}</span>`}):o(y,v,S,f,s)}}function Ui(e,l){const n=/\{\{%\s*(\w+)\s*%\}\}([\s\S]*?)\{\{%\s*\/\1\s*%\}\}/g;e.core.ruler.push("shortcode_color",i=>{for(const o of i.tokens){if(o.type!=="inline")continue;let y=o.content,v=!1;y=y.replace(n,(S,f,s)=>{var p;const $=(p=l.renderers)==null?void 0:p[f];return $?(v=!0,$([],s.trim())):S}),v&&(o.type="html_inline",o.tag="",o.attrs=null,o.content=y,o.children=[])}})}Ol({markdownItConfig(e){e.use(jt,"align-left",{render(l,n){return l[n].nesting===1?`<div class="sh-align-left">
`:`</div>
`}}),e.use(jt,"align-center",{render(l,n){return l[n].nesting===1?`<div class="sh-align-center">
`:`</div>
`}}),e.use(jt,"align-right",{render(l,n){return l[n].nesting===1?`<div class="sh-align-right">
`:`</div>
`}}),e.use($i,{renderers:{problem:([l])=>`<oj-problem id="${l}">${l}</oj-problem>`}}),e.use(Ui,{renderers:{red:(l,n)=>`<span class="dida-font-red">${n}</span>`,green:(l,n)=>`<span class="dida-font-green">${n}</span>`,blue:(l,n)=>`<span class="dida-font-blue">${n}</span>`}})},markdownItPlugins(e){return[...e,{type:"linkAttr",plugin:pl,options:{matcher(l){return!l.startsWith("#")},attrs:{target:"_blank"}}}]}});const Ga=cl();Ga.use(ml);const dt=ha(Li);dt.use(Ga);dt.use(X);dt.use(Ml);dt.use(Gl);dt.use(Nl);dt.mount("#app");Hl().then(()=>{console.log("Text cache reinitialized")}).catch(e=>{console.error("Text cache reinitialization failed",e)});
