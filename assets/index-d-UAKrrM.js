import{bm as et,bn as It,n as ee,r as m,o as ae,G as Pt,bo as W,bp as D,s as a,bq as n,br as U,F as Q,bs as pe,bt as G,bu as E,ap as T,u as Ae,bv as ue,bw as ce,aD as re,g as Qt,bx as ea,by as ta,bz as aa,J as we,q as ke,bA as na,bB as Ue,y as Le,c as De,bC as Ne,bD as rt,ac as oa,bE as Tt,bF as la,bG as sa,bH as xt,aM as ra,bI as ut,a0 as ua,bJ as ia,bK as ca,B as da,bL as ma}from"./node_modules-x_y3cvPb.js";import{L as be,C as oe,S as _e,a as pa,T as fa,b as he,A as mt,c as _a,d as ga,e as va,f as ba,g as He,R as ge,B as K,F as je,h as ze,I as Ie,D as Oe,i as Lt,j as Ee,k as qe,l as ha,m as Pe,n as jt,O as zt,P as ya,o as $t,p as Vt,q as wa,r as ka,s as Sa,t as Ca,u as Ia,v as Pa,w as Ta,M as Dt,x as Rt,y as xa,H as La,z as ja,E as za,G as $a,J as Va,K as Da,N as Ra,Q as Aa,U as Ua}from"./tdesign-vue-next-UxLz_uvk.js";import{V as se}from"./vditor-DArazWIS.js";import{e as gt}from"./monaco-editor-DCUKHC_e.js";import{H as Ea,v as qa}from"./highlight.js-D9zWiMxS.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const u of l)if(u.type==="childList")for(const y of u.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&s(y)}).observe(document,{childList:!0,subtree:!0});function o(l){const u={};return l.integrity&&(u.integrity=l.integrity),l.referrerPolicy&&(u.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?u.credentials="include":l.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function s(l){if(l.ep)return;l.ep=!0;const u=o(l);fetch(l.href,u)}})();var Re=(e=>(e.Manage="i-manage",e.ManageJudge="i-manage-judge",e.ManageProblem="i-manage-problem",e))(Re||{});const Ma={"r-admin":["i-manage","i-manage-judge","i-manage-problem"]};function Ka(e){if(e==null)return[];const t=[];for(const o of e){const s=Ma[o];s!=null&&t.push(...s)}return[...new Set(t)]}function Fa(e,t){if(e==null||t==null)return!1;const o=Ka(e);for(const s of t)if(!o.includes(s))return!1;return!0}const ye=et("user",{state:()=>({token:"",userId:-1,username:"",nickname:"",roles:[]}),getters:{getToken(){return this.token},getUserId(){return this.userId},getUsername(){return this.username},getNickname(){return this.nickname}},actions:{clear(){this.$patch({token:"",userId:-1,username:"",nickname:"",roles:[]})},loadResponse(e){this.$patch({token:e.token,userId:e.user_id,username:e.username,nickname:e.nickname,roles:e.roles})},isLogin(){return this.token!=null&&this.token!=""},hasAuth(e){return this.hasAllAuths([e])},hasAllAuths(e){return e?Fa(this.roles,e):!0}},persist:!0}),$e=et("webStyle",{state:()=>({title:""}),getters:{getTitle(){return this.title}},actions:{setTitle(e){this.title=e}}}),tt=et("sidebarStyle",{state:()=>({showSidebar:!1,forceHiddenSidebar:!1,menuActiveName:"",menuList:[]}),getters:{getMenuList(){return this.menuList}},actions:{setSidebarShow(e){this.showSidebar=e},setForceHiddenSidebar(e){this.forceHiddenSidebar=e},setMenuActiveName(e){this.menuActiveName=e},clearMenuList(){this.menuList=[]},setMenuList(e){this.menuList=e},addMenuList(e){this.menuList.push(e)}}}),Be=It.create({timeout:6e4,withCredentials:!1,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});Be.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function Ga(){return Be({baseURL:"https://r2-oj.didapipa.com",url:"/system/notification.json?"+Date.now(),method:"get"})}function Na(){return Be({baseURL:"https://r2-oj.didapipa.com",url:"/status/judger.json?"+Date.now(),method:"get"})}function At(e){return Be({baseURL:"https://r2-oj.didapipa.com",url:"/status/judger/"+e+".json?"+Date.now(),method:"get"})}function Ha(e){return Be({baseURL:"https://r2-oj.didapipa.com",url:"/status/web.json?"+Date.now(),method:"get"})}const Oa={class:"judger-status-panel"},Ba={class:"judger-status-panel"};function Ja(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ae(e)}const Wa=ee({__name:"SystemStatus",setup(e){const t=m([]),o=m([]),s=m(!1),l=m(!1);let u;const y=h=>{let r="失效",i="danger";const v=new Date,C=new Date(h.updateTime);return v.getTime()-C.getTime()>3e4?(r="离线",i="default"):h.cpuUsage>90?(r="CPU过高",i="warning"):h.memPercent>90?(r="内存过高",i="warning"):(r="在线",i="success"),a(_e,null,{default:()=>[a("span",null,[h.key,T(" - "),h.name]),a("span",null,[h.updateTime]),a(fa,{theme:i,size:"small"},Ja(r)?r:{default:()=>[r]})]})},z=async()=>{const h=[{key:"didaoj",name:"DidaOj"}],r={};for(let v=0;v<t.value.length;v++){const C=t.value[v];r[C.key]=C}const i=[];for(let v=0;v<h.length;v++){const C=h[v],p={key:C.key},f=await Ha(C.key);f&&(f.name?p.name=f.name:p.name="-",f.update_time?p.updateTime=new Date(f.update_time).toLocaleString():p.updateTime="-",f.cpu_usage?p.cpuUsage=Number(f.cpu_usage):p.cpuUsage=0,f.mem_usage?p.memUsage=f.mem_usage/(1024*1024*1024):p.memUsage=0,f.mem_total?p.memTotal=f.mem_total/(1024*1024*1024):p.memTotal=0,p.memTotal>0?p.memPercent=Math.round(p.memUsage/p.memTotal*1e4)/100:p.memPercent=0,p.avgMessage=f.avg_message,r[C.key]?(p.cpuUsageFrom=r[C.key].cpuUsage,p.memPercentFrom=r[C.key].memPercent,p.memUsageFrom=r[C.key].memUsage,p.memTotalFrom=r[C.key].memTotal):(p.cpuUsageFrom=0,p.memPercentFrom=0,p.memUsageFrom=0,p.memTotalFrom=0),i.push(p))}t.value=i},w=async()=>{const h=await Na(),r={};for(let v=0;v<o.value.length;v++){const C=o.value[v];r[C.key]=C}const i=[];for(let v=0;v<h.judgers.length;v++){const C=h.judgers[v],p={key:C.key,name:C.name},f=await At(C.key);f&&(f.name?p.name=f.name:p.name="-",f.update_time?p.updateTime=new Date(f.update_time).toLocaleString():p.updateTime="-",f.cpu_usage?p.cpuUsage=Number(f.cpu_usage):p.cpuUsage=0,f.mem_usage?p.memUsage=f.mem_usage/(1024*1024*1024):p.memUsage=0,f.mem_total?p.memTotal=f.mem_total/(1024*1024*1024):p.memTotal=0,p.memTotal>0?p.memPercent=Math.round(p.memUsage/p.memTotal*1e4)/100:p.memPercent=0,p.avgMessage=f.avg_message,r[C.key]?(p.cpuUsageFrom=r[C.key].cpuUsage,p.memPercentFrom=r[C.key].memPercent,p.memUsageFrom=r[C.key].memUsage,p.memTotalFrom=r[C.key].memTotal):(p.cpuUsageFrom=0,p.memPercentFrom=0,p.memUsageFrom=0,p.memTotalFrom=0),i.push(p))}o.value=i},_=async()=>{await z(),s.value=!1,await w(),l.value=!1};return ae(async()=>{o.value=[],t.value=[],l.value=!0,s.value=!0,await _(),u=setInterval(()=>{_()},5e3)}),Pt(()=>{clearInterval(u)}),(h,r)=>{const i=pa,v=_e,C=oe,p=be;return D(),W(Q,null,[a(C,{title:"接口状态",class:"judger-status"},{default:n(()=>[a(p,{loading:s.value},{default:n(()=>[U("div",Oa,[(D(!0),W(Q,null,pe(t.value,f=>(D(),G(C,{key:f.key,header:()=>y(f),class:"judge-status-judger"},{footer:n(()=>[U("span",null," 负载信息："+E(f.avgMessage),1)]),default:n(()=>[a(v,{class:"judge-status-judger"},{default:n(()=>[a(i,{title:"CPU使用率",value:f.cpuUsage,animation:{valueFrom:f.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),a(i,{title:"内存使用率",value:f.memPercent,animation:{valueFrom:f.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),a(i,{title:"内存使用量",animation:{valueFrom:f.memUsageFrom,duration:2e3},"animation-start":!0,value:f.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),a(i,{title:"内存总量",value:f.memTotal,animation:{valueFrom:f.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1},8,["loading"])]),_:1}),a(C,{title:"判题机状态",class:"judger-status"},{default:n(()=>[a(p,{loading:l.value},{default:n(()=>[U("div",Ba,[(D(!0),W(Q,null,pe(o.value,f=>(D(),G(C,{key:f.key,header:()=>y(f),class:"judge-status-judger"},{footer:n(()=>[U("span",null," 负载信息："+E(f.avgMessage),1)]),default:n(()=>[a(v,{class:"judge-status-judger"},{default:n(()=>[a(i,{title:"CPU使用率",value:f.cpuUsage,animation:{valueFrom:f.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),a(i,{title:"内存使用率",value:f.memPercent,animation:{valueFrom:f.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),a(i,{title:"内存使用量",animation:{valueFrom:f.memUsageFrom,duration:2e3},"animation-start":!0,value:f.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),a(i,{title:"内存总量",value:f.memTotal,animation:{valueFrom:f.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1},8,["loading"])]),_:1})],64)}}}),te=(e,t)=>{const o=e.__vccOpts||e;for(const[s,l]of t)o[s]=l;return o},it=te(Wa,[["__scopeId","data-v-1fb43cc1"]]),Xa={style:{"text-align":"right"}},Ya=ee({__name:"Hitokoto",setup(e){const t=m(!1),o=m(""),s=m(""),l=m(""),u=async()=>{t.value=!0;try{const z=await(await fetch("https://v1.hitokoto.cn")).json();s.value=z.hitokoto,l.value=z.creator,o.value="—— "+z.from}catch(y){s.value="一言获取失败了，但至少您还可以访问本站。",l.value="BoilTask",o.value="DidaOJ",console.error("Error fetching Hitokoto:",y)}finally{t.value=!1}};return ae(()=>{u()}),(y,z)=>{const w=oe,_=be;return D(),G(_,{loading:t.value},{default:n(()=>[a(w,{title:"一言 © Hitokoto"},{actions:n(()=>[T(" @"+E(l.value),1)]),default:n(()=>[U("div",null,[U("span",null,E(s.value),1),U("p",Xa,E(o.value),1)])]),_:1})]),_:1},8,["loading"])}}}),Za={class:"sh-main"},Qa={class:"dida-swiper-div"},en=ee({__name:"HomeView",setup(e){let t=-1;const o=m(null),s=async()=>{o.value=await Ga()};return ae(async()=>{await s(),t=setInterval(()=>{s()},3e4)}),Pt(()=>{clearInterval(t)}),(l,u)=>{const y=mt,z=ga,w=_a,_=oe,h=he,r=He,i=ba,v=va,C=ge;return D(),G(C,null,{default:n(()=>[a(h,{span:8},{default:n(()=>[U("div",Za,[o.value?(D(),G(y,{key:0,style:{margin:"20px"},theme:o.value.theme},{default:n(()=>[T(E(o.value.content),1)]),_:1},8,["theme"])):ue("",!0),U("div",Qa,[a(w,{class:"dida-swiper"},{default:n(()=>[a(z,null,{default:n(()=>u[0]||(u[0]=[U("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1}),a(z,null,{default:n(()=>u[1]||(u[1]=[U("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1})]),_:1})]),a(_,{title:"正在完善，欢迎提供意见建议",style:{width:"500px",margin:"0 auto"}},{default:n(()=>u[2]||(u[2]=[U("p",null,[U("a",{href:"https://codeoj.cn/",target:"_blank"},"CodeOJ"),T("的迁移计划")],-1),U("p",null,"正在开发中",-1)])),_:1})])]),_:1}),a(h,{span:4},{default:n(()=>[a(Ya,{style:{margin:"10px"}}),a(it),a(_,{style:{margin:"10px"},bordered:!0},{header:n(()=>u[3]||(u[3]=[U("b",null,"友情链接",-1)])),default:n(()=>[a(v,null,{default:n(()=>[a(i,null,{default:n(()=>[a(r,{href:"https://boiltask.com",target:"_blank"},{default:n(()=>u[4]||(u[4]=[T("BoilTask Blog")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),tn=te(en,[["__scopeId","data-v-aba0b66b"]]),an={class:"sh-main"},nn=ee({__name:"View404",setup(e){let t=ce(),o=m(t.fullPath);return(s,l)=>{const u=K;return D(),W("div",an,[U("p",null,E(re(o)),1),l[2]||(l[2]=U("p",null,"该页面无效或已被迁移，请重新选择访问目标",-1)),a(u,{theme:"primary",onClick:l[0]||(l[0]=()=>s.$router.push("/"))},{default:n(()=>l[1]||(l[1]=[T("返回首页")])),_:1})])}}}),Ut=te(nn,[["__scopeId","data-v-d4218944"]]);let ct=null;async function on(){ct=await sn()}function ln(e,t="zh"){if(ct==null)return[!1,e.toString()];const o=ct[e.toString()];if(!o)return[!1,e.toString()];let s=o[t];return s||(t="zh",s=o[t]),s?[!0,s]:[!1,e.toString()]}async function sn(){return new Promise((e,t)=>{e({404:{zh:"接口未找到"},1e3:{zh:"系统错误，请重试或等待管理员修复"},1001:{zh:"系统异常，请重试或等待管理员修复"},1002:{zh:"未知错误"},1003:{zh:"操作过于频繁，请稍后重试"},10001:{zh:"权限异常，请重新登陆后再试"},10002:{zh:"参数不符合要求"},10003:{zh:"未找到目标数据"},100001:{zh:"用户名不存在或密码不匹配"},100002:{zh:"邮件发送失败，可能是邮箱无效或达到了每日注册上限，如有问题可联系管理员解决"},100003:{zh:"验证码错误或已过期，请重新获取"},100004:{zh:"注册用户失败，可能存在同名用户"},100005:{zh:"用户名不存在，或您未在本系统绑定邮箱，请联系管理员寻求帮助"},100006:{zh:"验证码错误或已过期，请重新获取"}})})}function le(){const{appContext:e}=Qt();return{globalProperties:e.config.globalProperties}}function Ce(){return 1e3}function Et(e,t,o=3e3){e.$message.success({duration:o,content:t})}function ie(e,t,o=3e3){e.$message.info({duration:o,content:t})}function ne(e,t,o=3e3){e.$message.error({duration:o,content:t})}function N(e,t,o=3e3){const[s,l]=ln(t),u=s?l:`系统错误，错误提示[${l}]`;e.$message.error({duration:o,content:u})}const rn="https://oj-api.didapipa.com/",X=It.create({baseURL:rn,timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});X.interceptors.request.use(e=>{const o=ye().getToken;return o&&(e.headers["X-Token"]=o),e},e=>Promise.reject(e));X.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function un(e){const t={};return t.id=e.id,t.username=e.username,t.nickname=e.nickname,t.email=e.email,t.slogan=e.slogan,t.organization=e.organization,t.accept=e.accept,t.attempt=e.attempt,e.email&&(t.avatar=`https://www.gravatar.com/avatar/${ea(e.email.toLowerCase().trim())}?d=identicon&s=100`),t}function cn(e,t){return X({url:"/user/login",method:"post",data:{username:e,password:t}})}function dn(){return X({url:"/user/login/refresh",method:"post"})}function mn(e){const t={username:e};return X({url:`/user/info?${new URLSearchParams(t).toString()}`,method:"get"})}function pn(e,t){return X({url:"/user/register/email",method:"post",data:{token:e,email:t}})}function fn(e,t,o,s,l){return X({url:"/user/register",method:"post",data:{username:e,password:t,email:o,key:s,nickname:l}})}function _n(e,t){return X({url:"/user/forget",method:"post",data:{token:e,username:t}})}function gn(e,t,o){return X({url:"/user/password/modify",method:"post",data:{username:e,password:t,key:o}})}const vn={class:"dida-login-footer"},bn=ee({__name:"LoginView",setup(e){const{globalProperties:t}=le(),o=ye(),s=m(!1),l=m({username:"",password:""}),u=()=>{ie(t,"重置成功")},y=({validateResult:z,firstError:w})=>{s.value||(s.value=!0,cn(l.value.username,l.value.password).then(_=>{if(_.code===0){o.loadResponse(_.data),ie(t,"登录成功");let h=t.$route.query.redirect_uri;h||(h="/user/"+_.data.username),t.$router.push({path:h})}else N(t,_.code)}).catch(_=>{console.error("Login error",_),ne(t,"登录失败")}).finally(()=>{s.value=!1}))};return ae(()=>{if(o.isLogin()){t.$router.push({path:"/user"});return}}),(z,w)=>{const _=Ie,h=ze,r=K,i=je,v=He,C=oe;return D(),G(C,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:n(()=>[a(i,{ref:"form",data:l.value,colon:!0,onReset:u,onSubmit:y,class:"yj-login-form","label-width":0},{default:n(()=>[a(h,{name:"username"},{default:n(()=>[a(_,{modelValue:l.value.username,"onUpdate:modelValue":w[0]||(w[0]=p=>l.value.username=p),clearable:"",placeholder:"请输入用户名"},{"prefix-icon":n(()=>[a(re(ta))]),_:1},8,["modelValue"])]),_:1}),a(h,{name:"password"},{default:n(()=>[a(_,{modelValue:l.value.password,"onUpdate:modelValue":w[1]||(w[1]=p=>l.value.password=p),type:"password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":n(()=>[a(re(aa))]),_:1},8,["modelValue"])]),_:1}),a(h,null,{default:n(()=>[a(r,{theme:"primary",type:"submit",block:"",loading:s.value},{default:n(()=>w[4]||(w[4]=[T("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),U("div",vn,[a(v,{onClick:w[2]||(w[2]=()=>{re(t).$router.push({name:"login-forget"})})},{default:n(()=>w[5]||(w[5]=[T("忘记密码")])),_:1}),a(v,{onClick:w[3]||(w[3]=()=>{re(t).$router.push({name:"register"})})},{default:n(()=>w[6]||(w[6]=[T("注册账户")])),_:1})])]),_:1})}}}),hn=te(bn,[["__scopeId","data-v-be6a0deb"]]),yn={class:"dida-login-footer"},wn=ee({__name:"RegisterView",setup(e){const{globalProperties:t}=le(),o=ye(),s=m(!1),l=m(!1),u=m(!1),y=m("发送验证码");let z=null,w=-1;const _=m(!1),h=m(null),r=m({username:"",password:"",confirmPassword:"",nickname:"",email:"",emailKey:""}),v=m({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:I=>new Promise(g=>{const x=setTimeout(()=>{g(r.value.password===I),clearTimeout(x)})}),message:"两次密码不一致"}],nickname:[{required:!0,message:"请填写昵称"},{min:1,message:"昵称至少1个字符"},{max:30,message:"昵称最多30个字符"}],email:[{required:!0,message:"请填写邮箱"},{pattern:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"邮箱格式不正确"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),C=m(()=>a(K,{onClick:p,disabled:u.value,loading:l.value,style:"width:120px"},{default:()=>[y.value]})),p=async()=>{var c;if(!r.value.email){ne(t,"请输入邮箱");return}if(!r.value.email.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)){ne(t,"邮箱格式不正确");return}if(u.value||l.value)return;_.value=!0,await ke();const I=document.getElementById("cf-confirm-div");I&&I.remove();const g=document.createElement("div");g.id="cf-confirm-div",g.setAttribute("data-theme","light"),(c=h.value)==null||c.appendChild(g);const x=window;x.turnstile.ready(function(){x.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(j){_.value=!1,await f(j)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},f=async I=>{if(!u.value){l.value=!0;try{const g=await pn(I,r.value.email);if(g.code!==0){N(t,g.code);return}ie(t,"发送验证码成功"),l.value=!1,u.value=!0,z=new Date,y.value="60秒后重发",w=setInterval(()=>{const c=Math.floor((new Date().getTime()-(z==null?void 0:z.getTime()))/1e3);c>60?(y.value="发送验证码",u.value=!1,clearInterval(w)):y.value=`${60-c}秒后重发`},1e3)}catch{ne(t,"发送验证码失败")}finally{l.value=!1}}},L=()=>{ie(t,"重置成功")},q=({validateResult:I,firstError:g,e:x})=>{if(!s.value){if(x.preventDefault(),I!==!0){ne(t,g);return}if(r.value.password!==r.value.confirmPassword){ne(t,"两次密码不一致");return}s.value=!0,fn(r.value.username,r.value.password,r.value.email,r.value.emailKey,r.value.nickname).then(c=>{c.code===0?(ie(t,"注册成功，可使用账号信息登录"),t.$router.push({name:"login"})):N(t,c.code)}).catch(c=>{console.error("Login error",c),ne(t,"登录失败")}).finally(()=>{s.value=!1})}};return ae(()=>{if(o.isLogin()){t.$router.push({path:"/user"});return}}),we(()=>{clearInterval(w)}),(I,g)=>{const x=Ie,c=ze,j=Lt,$=K,k=je,b=He,d=oe,V=Oe;return D(),W(Q,null,[a(d,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:n(()=>[a(k,{ref:"form",rules:v.value,data:r.value,colon:!0,onReset:L,onSubmit:q,class:"yj-login-form"},{default:n(()=>[a(c,{name:"username",label:"用户名"},{default:n(()=>[a(x,{modelValue:r.value.username,"onUpdate:modelValue":g[0]||(g[0]=A=>r.value.username=A),clearable:"",placeholder:"用于登录与查找"},null,8,["modelValue"])]),_:1}),a(c,{name:"password",label:"密码"},{default:n(()=>[a(x,{modelValue:r.value.password,"onUpdate:modelValue":g[1]||(g[1]=A=>r.value.password=A),type:"password",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),a(c,{name:"confirmPassword",label:"确认密码"},{default:n(()=>[a(x,{modelValue:r.value.confirmPassword,"onUpdate:modelValue":g[2]||(g[2]=A=>r.value.confirmPassword=A),type:"password",clearable:"",placeholder:"请确认密码"},null,8,["modelValue"])]),_:1}),a(c,{name:"nickname",label:"昵称"},{default:n(()=>[a(x,{modelValue:r.value.nickname,"onUpdate:modelValue":g[3]||(g[3]=A=>r.value.nickname=A),clearable:"",placeholder:"用于优先在网站各处展示"},null,8,["modelValue"])]),_:1}),a(c,{name:"email",label:"邮箱"},{default:n(()=>[a(x,{modelValue:r.value.email,"onUpdate:modelValue":g[4]||(g[4]=A=>r.value.email=A),clearable:"",placeholder:"请填写常用邮箱"},null,8,["modelValue"])]),_:1}),a(c,{name:"emailKey",label:"验证码"},{default:n(()=>[a(j,{append:C.value},{default:n(()=>[a(x,{modelValue:r.value.emailKey,"onUpdate:modelValue":g[5]||(g[5]=A=>r.value.emailKey=A),clearable:"",placeholder:"请输入验证码",style:{width:"140px"}},null,8,["modelValue"])]),_:1},8,["append"])]),_:1}),a(c,null,{default:n(()=>[a($,{theme:"primary",type:"submit",block:"",loading:s.value},{default:n(()=>g[8]||(g[8]=[T("注册")])),_:1},8,["loading"])]),_:1})]),_:1},8,["rules","data"]),U("div",yn,[a(b,{onClick:g[6]||(g[6]=()=>{re(t).$router.push({name:"login"})})},{default:n(()=>g[9]||(g[9]=[T("返回登陆 ")])),_:1})])]),_:1}),a(V,{visible:_.value,"onUpdate:visible":g[7]||(g[7]=A=>_.value=A),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:n(()=>[U("div",{ref_key:"dialogContainer",ref:h,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),kn=te(wn,[["__scopeId","data-v-9b5f4fc7"]]),Sn={style:{margin:"12px"}},Cn=ee({__name:"UserView",setup(e){let t=ce();const{globalProperties:o}=le(),s=$e();let l="";const u=m(!1),y=m(null),z=m([]),w=async _=>{u.value=!0;try{let h=await mn(_);if(h.code!==0){u.value=!1,N(o,h.code),await O.push({name:"home"});return}y.value=un(h.data.user),z.value=h.data.problems_ac,s.setTitle(y.value.nickname+" - "+s.getTitle)}catch{ne(o,"获取用户信息失败"),await O.push({name:"home"})}finally{u.value=!1}};return na(async(_,h,r)=>{if(Array.isArray(_.params.username)?l=_.params.username[0]:l=_.params.username,!l){await O.push({name:"home"});return}await w(l),r()}),ae(async()=>{if(Array.isArray(t.params.username)?l=t.params.username[0]:l=t.params.username,!l){await O.push({name:"home"});return}await w(l)}),(_,h)=>{const r=K,i=_e,v=oe,C=he,p=ha,f=qe,L=Ee,q=ge,I=be;return D(),G(I,{loading:u.value},{default:n(()=>[a(q,{class:"dida-main-content"},{default:n(()=>[a(C,{span:8},{default:n(()=>[a(v,{style:{margin:"10px"},title:"AC题目"},{default:n(()=>[a(i,{style:{"flex-wrap":"wrap"}},{default:n(()=>[(D(!0),W(Q,null,pe(z.value,g=>(D(),G(r,{key:g,size:"small",onClick:()=>re(O).push({name:"problem-detail",params:{problemId:g}})},{default:n(()=>[T(E(g),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1}),a(C,{span:4},{default:n(()=>[U("div",Sn,[a(L,{layout:"vertical",bordered:!0},{default:n(()=>[a(f,{label:"头像"},{default:n(()=>{var g;return[a(p,{shape:"round",size:"100px",image:(g=y.value)==null?void 0:g.avatar,"hide-on-load-failed":!1},null,8,["image"])]}),_:1}),a(f,{label:"昵称"},{default:n(()=>{var g;return[T(E((g=y.value)==null?void 0:g.nickname),1)]}),_:1}),a(f,{label:"Slogan"},{default:n(()=>{var g;return[T(E((g=y.value)==null?void 0:g.slogan),1)]}),_:1}),a(f,{label:"邮箱"},{default:n(()=>{var g;return[T(E((g=y.value)==null?void 0:g.email),1)]}),_:1}),a(f,{label:"组织"},{default:n(()=>{var g;return[T(E((g=y.value)==null?void 0:g.organization),1)]}),_:1}),a(f,{label:"通过数量"},{default:n(()=>{var g;return[T(E((g=y.value)==null?void 0:g.accept),1)]}),_:1}),a(f,{label:"提交数量"},{default:n(()=>{var g;return[T(E((g=y.value)==null?void 0:g.attempt),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),In=te(Cn,[["__scopeId","data-v-7d1db43a"]]),pt=[{name:"home",path:"/",title:"首页",showSidebar:!1,disableGenerateTab:!0,component:tn},{name:"problem",path:"/problem",title:"题目",icon:"calculation",showSidebar:!0,redirect:"problem-list"},{name:"judge",path:"/judge",title:"评测",icon:"code",showSidebar:!0,redirect:"judge-list"},{name:"contest",path:"/contest",title:"比赛",icon:"application",showSidebar:!0,redirect:"contest-list"},{name:"contest-detail-tab",title:"比赛",path:"/contest",showSidebar:!0,disableGenerateTab:!0,redirect:"contest-list"},{name:"discuss",title:"讨论",path:"/discuss",icon:"sonic",showSidebar:!0,redirect:"discuss-list"},{name:"rank",path:"/rank",title:"排名",icon:"chart-column",showSidebar:!0,redirect:"rank-ac-all"},{name:"tool",path:"/tool",title:"工具",icon:"tools",showSidebar:!0,redirect:"tool-paste"},{name:"system",path:"/system",title:"系统",icon:"dashboard",showSidebar:!0,redirect:"system-status"},{name:"manage",path:"/manage",title:"管理",icon:"command",showSidebar:!0,redirect:"manage-judge",auths:[Re.Manage]},{name:"login",path:"/login",title:"登陆",showSidebar:!1,disableGenerateTab:!0,component:hn},{name:"register",path:"/register",title:"注册",showSidebar:!1,disableGenerateTab:!0,component:kn},{name:"user",path:"/user/:username+",title:"用户",showSidebar:!1,needLogin:!0,disableGenerateTab:!0,component:In},{name:"404",path:"/404",title:"404",showSidebar:!1,disableGenerateTab:!0,component:Ut}],Pn=e=>pt.find(t=>t.name==e),Tn=e=>{const t=[];return pt.forEach(o=>{!o.disableGenerateTab&&e.hasAllAuths(o.auths)&&t.push(o)}),t},xn=e=>{pt.forEach(t=>{const o={name:t.name,path:t.path,meta:{title:t.title,tab:t.name,showSidebar:t.showSidebar,needLogin:t.needLogin,redirect:t.redirect,tabAuths:t.auths},component:t.component};e.push(o)})};function qt(e){return e.children!==void 0}function Ln(e){return e.children!==void 0}var Mt=(e=>(e[e.Unknown=-1]="Unknown",e[e.C=0]="C",e[e.Cpp=1]="Cpp",e[e.Java=2]="Java",e[e.Python=3]="Python",e[e.Pascal=4]="Pascal",e[e.Golang=5]="Golang",e[e.Max=6]="Max",e))(Mt||{});function Kt(){const e=[-1,5,6];return Object.values(Mt).filter(t=>typeof t=="number"&&!e.includes(t)).map(t=>({value:t,label:Ft(t)}))}function jn(e){return e>-1&&e<6}function Ft(e){switch(e){case 0:return"C";case 1:return"C++";case 2:return"Java";case 3:return"Python";case 4:return"Pascal";case 5:return"Golang";default:return"Unknown"}}function ft(e){switch(e){case 0:return"c";case 1:return"cpp";case 2:return"java";case 3:return"python";case 4:return"pascal";case 5:return"golang";default:return"text"}}var ve=(e=>(e[e.Init=0]="Init",e[e.Rejudge=1]="Rejudge",e[e.Submitting=2]="Submitting",e[e.Queuing=3]="Queuing",e[e.Compiling=4]="Compiling",e[e.Running=5]="Running",e[e.Accept=6]="Accept",e[e.PE=7]="PE",e[e.WA=8]="WA",e[e.TLE=9]="TLE",e[e.MLE=10]="MLE",e[e.OLE=11]="OLE",e[e.RE=12]="RE",e[e.CE=13]="CE",e[e.CLE=14]="CLE",e[e.JudgeFail=15]="JudgeFail",e[e.SubmitFail=16]="SubmitFail",e[e.Unknown=17]="Unknown",e))(ve||{});const zn=e=>{switch(e){case 0:return"普通评测";case 1:return"特殊评测";default:return"未知"}},Qe=e=>{switch(e){case 0:return"等待处理";case 1:return"重新评测";case 2:return"提交中";case 3:return"队列中";case 4:return"编译中";case 5:return"运行中";case 6:return"通过";case 7:return"格式错误";case 8:return"答案错误";case 9:return"超时";case 10:return"内存超限";case 11:return"输出超限";case 12:return"运行错误";case 13:return"编译错误";case 14:return"编译超限";case 15:return"评测失败";case 16:return"提交失败";case 17:return"未知";default:return e}},Gt=e=>{switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return"default";case 6:return"success";case 7:return"warning";default:return"danger"}};function $n(){const e=[17];return Object.values(ve).filter(t=>typeof t=="number"&&!e.includes(t)).map(t=>({value:t,label:Qe(t)}))}function Me(e){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return!0;default:return!1}}function Nt(e){var o;const t={};if(t.id=e.id,t.problemId=e.problem_id,t.contestProblemIndex=e.contest_problem_index,t.status=e.status,Me(e.status)?t.score="-":t.score=e.score.toString(),e.time?t.time=Math.ceil(e.time/1e6)+"ms":t.time="-",e.memory?t.memory=(e.memory/1024/1024).toFixed(2)+"MB":t.memory="-",t.language=Ft(e.language),t.codeLength=e.code_length,e.approve_time?t.approveTime=new Date(e.approve_time).toLocaleString():t.approveTime="-",t.author=e.author,t.authorUsername=e.author_username,t.authorNickname=e.author_nickname,t.code=e.code,t.compileMessage=e.compile_message,t.taskCurrent=e.task_current,t.taskTotal=e.task_total,t.task=[],e.task)for(let s=0;s<((o=e.task)==null?void 0:o.length);s++){const l=e.task[s],u={};u.taskId=l.task_id,u.status=l.status,l.time?u.time=Math.ceil(l.time/1e6)+"ms":u.time="-",l.memory?u.memory=(l.memory/1024/1024).toFixed(2)+"MB":u.memory="-",u.score=l.score,u.content=l.content,u.waHint=l.wa_hint,!u.content&&!u.waHint&&(u.content="无提示信息"),t.task.push(u)}return e.judger&&(t.judger=e.judger),e.judge_time&&(t.judgeTime=new Date(e.judge_time).toLocaleString()),t}function Vn(e,t,o,s,l){return X({url:"/judge/approve",method:"post",data:{problem_id:e,contest_id:t,problem_index:o,language:s,code:l}})}function Dn(e){return X({url:"/judge?id="+e,method:"get"})}function Rn(e){return X({url:"/judge/code?id="+e,method:"get"})}function An(e,t,o,s,l,u,y){const z=new URLSearchParams({contest_id:String(e),problem_id:t,username:o,language:String(s),status:String(l),page:String(u),page_size:String(y)});return X({url:`/judge/list?${z.toString()}`,method:"get"})}function Un(){return X({url:"/judge/rejudge/recently",method:"post"})}function En(e){return X({url:"/judge/rejudge/problem",method:"post",data:{id:e}})}function qn(){return X({url:"/judge/rejudge/all",method:"post",timeout:0})}function Mn(e){return X({url:"/judge/rejudge",method:"post",data:{id:Number(e)}})}var dt=(e=>(e[e.None=0]="None",e[e.Attempt=1]="Attempt",e[e.Accept=2]="Accept",e))(dt||{});function at(e,t){const o={};if(o.id=e.id,o.author=e.author,o.title=e.title,o.tags=[],e.tags)for(const s of e.tags){const l=t[s];l&&o.tags.push(l)}return o.accept=e.accept,o.attempt=e.attempt,e.description!=null&&(o.description=e.description),e.time_limit!=null&&(o.timeLimit=e.time_limit.toString()+" ms"),e.memory_limit!=null&&(o.memoryLimit=(e.memory_limit/1024).toFixed(2)+" MB"),e.judge_type!=null&&(o.judgeType=zn(e.judge_type)),e.insert_time!=null&&(o.insertTime=new Date(e.insert_time).toLocaleString()),e.update_time!=null&&(o.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(o.creatorNickname=e.creator_nickname),e.source!=null&&(o.source=e.source),e.judge_md5!=null&&(o.judgeMd5=e.judge_md5),o}function Ht(e,t,o){const s={};return e?s.id=e:(s.contest_id=t,s.problem_index=o),X({url:`/problem?${new URLSearchParams(s).toString()}`,method:"get"})}function Ot(e){return X({url:"/problem/tag/list?max_count="+e,method:"get"})}function Kn(e){return X({url:"/problem/judge?id="+e,method:"get"})}function Fn(e,t,o,s){const l={};return e&&(l.title=e),t&&(l.tag=t),o&&(l.page=o),s&&(l.page_size=s),X({url:`/problem/list?${new URLSearchParams(l).toString()}`,method:"get"})}function Gn(e,t,o,s,l,u,y){return X({url:"/problem/edit",method:"post",data:{id:e,title:t,time_limit:o,memory_limit:s,source:l,tags:u,description:y}})}function Nn(e,t){return X({url:"/problem/judge/data/download?id="+e+"&key="+t,method:"get"})}function Hn(e,t){const o=new FormData;return o.append("id",e),o.append("zip",t),X({url:"/problem/judge/data",method:"post",data:o,headers:{"Content-Type":"multipart/form-data"},timeout:1e3*60*5})}const On={style:{margin:"10px"}};function Bn(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ae(e)}const Jn=ee({__name:"ProblemList",setup(e){const t=ce(),o=Ue(),{globalProperties:s}=le();let l=null;const u=m(!1),y={};let z={};const w=m([{title:"ID",colKey:"id",cell:(c,j)=>{let $=L(j.row.id);return a(K,{variant:"dashed",theme:$,onClick:()=>f(j.row.id)},{default:()=>[j.row.id]})}},{title:"标题",colKey:"title",cell:(c,j)=>a(K,{variant:"text",onClick:()=>f(j.row.id)},{default:()=>[j.row.title]})},{title:"标签",colKey:"tags",cell:(c,j)=>{const $=j.row.tags;if(!$||$.length===0)return"";let k=[];for(let b=0;b<$.length;b++){const d=$[b];k.push(a(K,{key:b,theme:"default",variant:"outline",size:"small",onClick:()=>I(d)},{default:()=>[d.name]}))}return a(_e,null,Bn(k)?k:{default:()=>[k]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),_=m(!1);let h=1,r=50;const i=m({current:h,pageSize:r,defaultCurrent:h,defaultPageSize:r,total:0,pageSizeOptions:[50,100]}),v=m(),C=m(),p=m({title:"",tag:""}),f=c=>{c&&o.push({path:"/problem/"+c})},L=c=>{if(!c||!z)return"default";const j=z[c];if(!j)return"default";switch(j){case dt.Accept:return"success";case dt.Attempt:return"warning";default:return"default"}},q=async()=>{await o.push({query:{...t.query,title:p.value.title,tag:p.value.tag,page:1,page_size:i.value.defaultPageSize}})},I=c=>{c&&o.push({query:{...t.query,title:"",tag:c.name,page:1,page_size:i.value.defaultPageSize}})},g=async(c,j)=>{_.value=!0;try{const{current:$,pageSize:k}=c,b=await Fn(p.value.title,p.value.tag,$,k);if(v.value=[],b.code===0){const d=b.data.list;if(!d||d.length<=0){i.value={...i.value,total:0},z=null,ie(s,"未找到记录");return}d.forEach(V=>{var P;const A=at(V,y);(P=v.value)==null||P.push(A)}),i.value={...i.value,total:b.data.total_count},z=b.data.problem_attempt_status}else j&&N(s,b.code)}catch($){console.error($),N(s,Ce())}finally{_.value=!1}},x=async c=>{await o.push({query:{...t.query,page:c.current,page_size:c.pageSize}})};return ae(async()=>{_.value=!0,C.value=[],Ot(-1).then(c=>{if(c.code===0){C.value=c.data.list,u.value=c.data.total_count>c.data.list.length;for(let j=0;j<c.data.list.length;j++){const $=c.data.list[j];y[$.id]=$}l=Le(()=>t.query,j=>{p.value.title=j.title||"",p.value.tag=j.tag||"";const $=parseInt(j.page)||i.value.defaultCurrent,k=parseInt(j.page_size)||i.value.defaultPageSize;h=$,r=k,i.value={...i.value,current:h,pageSize:r},g({current:h,pageSize:r},!0)},{immediate:!0})}else u.value=!0}).catch(c=>{console.error(c),u.value=!0})}),we(()=>{l&&l()}),(c,j)=>{const $=Pe,k=oe,b=he,d=Ie,V=ze,A=K,P=je,S=ge;return D(),G(S,null,{default:n(()=>[a(b,{span:9},{default:n(()=>[a(k,{style:{margin:"10px"}},{default:n(()=>[a($,{data:v.value,columns:w.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:i.value,loading:_.value,onPageChange:x},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),a(b,{span:3},{default:n(()=>[U("div",On,[a(k,{class:"sh-card"},{default:n(()=>[a(P,{model:p.value,onSubmit:q},{default:n(()=>[a(V,{label:"标题"},{default:n(()=>[a(d,{modelValue:p.value.title,"onUpdate:modelValue":j[0]||(j[0]=R=>p.value.title=R),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),a(V,{label:"标签"},{default:n(()=>[a(d,{modelValue:p.value.tag,"onUpdate:modelValue":j[1]||(j[1]=R=>p.value.tag=R),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),a(V,null,{default:n(()=>[a(A,{theme:"primary",type:"submit"},{default:n(()=>j[3]||(j[3]=[T("搜索")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(k,{class:"sh-card sh-background-black"},{default:n(()=>[(D(!0),W(Q,null,pe(C.value,R=>(D(),G(A,{class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:()=>I(R)},{default:n(()=>[T(E(R.name),1)]),_:2},1032,["onClick"]))),256)),u.value?(D(),G(A,{key:0,class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:j[2]||(j[2]=()=>c.$router.push("/problem/tags"))},{default:n(()=>j[4]||(j[4]=[T(" ... ")])),_:1})):ue("",!0)]),_:1})])]),_:1})]),_:1})}}}),Wn=te(Jn,[["__scopeId","data-v-e3a0978e"]]);function Ke(e){e.querySelectorAll("pre > code:not([data-copy-attached])").forEach(o=>{o.setAttribute("data-copy-attached","true");const s=o.parentElement,l=document.createElement("div");l.className="copy-wrapper";const u=document.createElement("button");u.className="copy-btn",u.innerText="复制",u.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(o.innerText),u.innerText="已复制",setTimeout(()=>u.innerText="复制",1500)}catch{u.innerText="失败"}}),s.replaceWith(l),l.appendChild(u),l.appendChild(s)})}function xe(e){let t="";for(;e>0;)e--,t=String.fromCharCode(65+e%26)+t,e=Math.floor(e/26);return t}async function Bt(e){const t={};if(t.id=e.id,t.ownerId=e.owner_id,t.ownerUsername=e.owner_username,t.ownerNickname=e.owner_nickname,t.title=e.title,t.startTime=new Date(e.start_time).toLocaleString(),t.endTime=new Date(e.end_time).toLocaleString(),e.descriptions){t.descriptions=[];const o={math:{inlineDigit:!0,engine:"KaTeX"}};for(let s=0;s<e.descriptions.length;s++){const l=e.descriptions[s],u={};u.title=l.title,u.content=await se.md2html(l.content,o),u.sort=l.sort,t.descriptions.push(u)}}if(t.notification=e.notification,e.problems){t.problems=[],e.problems.sort((o,s)=>o.index-s.index);for(let o=0;o<e.problems.length;o++){const s=e.problems[o];s.accept||(s.accept=0),s.attempt||(s.attempt=0),s.id=xe(s.index),t.problems.push(s)}}return t}function Xn(e){return X({url:"/contest?id="+e,method:"get"})}function Yn(e,t){return X({url:"/contest/list?page="+e+"&page_size="+t,method:"get"})}function Zn(e){return X({url:"/contest/rank?id="+e,method:"get"})}function Qn(e){return X({url:"/contest/create",method:"post",data:e})}const eo=["innerHTML"],to={style:{margin:"12px"}},ao={key:0,class:"dida-edit-container"},no={class:"dida-operation-container"},oo={class:"dida-code-submit-div"},lo=ee({__name:"ProblemDetail",setup(e){let t=ce();const{globalProperties:o}=le(),s=$e(),l=ye();let u=m(""),y="",z=0,w=0;const _=m(null),h=m(!1),r=m(null);let i=null;const v=m(null),C={},p=m(""),f=m([]);f.value=Kt();const L=De(()=>l.hasAuth(Re.ManageProblem)),q=k=>{k&&O.push({name:"problem-list",query:{...t.query,title:"",tag:k.name}})},I=()=>{O.push({name:"manage-problem",params:{problemId:y}})},g=()=>{y?O.push({name:"judge-list",query:{problem_id:y}}):O.push({name:"contest-judge",params:{contestId:z},query:{problem_id:xe(w)}})},x=()=>{y?O.push({name:"discuss-list-problem",query:{problem_id:y}}):O.push({name:"contest-discuss",params:{contestId:z},query:{problem_id:xe(w)}})},c=()=>{O.push({name:"problem-recommend",params:{problemId:y}})},j=async()=>{if(!y){ne(o,"问题ID无效");return}const k=parseInt(p.value);if(!jn(k)){ne(o,"请选择所编写的语言");return}const b=i==null?void 0:i.getValue();if(!b){ne(o,"请输入所需提交的代码");return}const d=await Vn(y,z,w,k,b);if(d.code!==0){N(o,d.code);return}ie(o,"提交成功，正在跳转到详情页面");const V=d.data.id;await O.push({path:"/judge/"+V})},$=k=>{i&&gt.setModelLanguage(i.getModel(),ft(k))};return ae(async()=>{if(Array.isArray(t.params.problemId)?y=t.params.problemId[0]:y=t.params.problemId,!y){if(Array.isArray(t.params.contestId)?z=t.params.contestId[0]:z=t.params.contestId,!z){ne(o,"题目不存在"),await O.push({name:"problem"});return}if(Array.isArray(t.params.problemIndex)?w=parseInt(t.params.problemIndex[0]):w=parseInt(t.params.problemIndex),!w){ne(o,"题目不存在"),await O.push({name:"problem"});return}}h.value=!0;let k=await Ht(y,z,w);if(k.code!==0){h.value=!1,N(o,k.code),await O.push({name:"problem"});return}k.data.tags&&k.data.tags.forEach(V=>{C[V.id]=V}),r.value=at(k.data.problem,C),s.setTitle(r.value.title+" - "+s.getTitle);let b=r.value.description;const d={math:{inlineDigit:!0,engine:"KaTeX"}};u.value=await se.md2html(b,d),await ke(()=>{_.value&&(se.mathRender(_.value),se.highlightRender({lineNumber:!0,enable:!0},_.value),Ke(_.value),v.value&&(i=gt.create(v.value,{value:"",language:"cpp",minimap:{enabled:!0},colorDecorators:!0,readOnly:!1,theme:"vs-dark"}))),h.value=!1})}),(k,b)=>{const d=oe,V=he,A=K,P=qe,S=_e,R=Ee,B=zt,H=jt,M=ge,Y=be;return D(),G(Y,{loading:h.value},{default:n(()=>[a(M,{class:"dida-main-content"},{default:n(()=>[a(V,{span:8},{default:n(()=>[a(d,{style:{margin:"10px"}},{default:n(()=>[U("div",{innerHTML:re(u),ref_key:"markdownRef",ref:_},null,8,eo)]),_:1})]),_:1}),a(V,{span:4},{default:n(()=>[U("div",to,[L.value?(D(),W("div",ao,[a(A,{onClick:I},{default:n(()=>b[1]||(b[1]=[T("编辑")])),_:1})])):ue("",!0),a(R,{layout:"vertical",bordered:!0},{default:n(()=>[a(P,{label:"标题"},{default:n(()=>{var F;return[T(E((F=r.value)==null?void 0:F.title),1)]}),_:1}),a(P,{label:"时间限制"},{default:n(()=>{var F;return[T(E((F=r.value)==null?void 0:F.timeLimit),1)]}),_:1}),a(P,{label:"内存限制"},{default:n(()=>{var F;return[T(E((F=r.value)==null?void 0:F.memoryLimit),1)]}),_:1}),a(P,{label:"判题方式"},{default:n(()=>{var F;return[T(E((F=r.value)==null?void 0:F.judgeType),1)]}),_:1}),a(P,{label:"正确提交"},{default:n(()=>{var F;return[T(E((F=r.value)==null?void 0:F.accept),1)]}),_:1}),a(P,{label:"提交总数"},{default:n(()=>{var F;return[T(E((F=r.value)==null?void 0:F.attempt),1)]}),_:1}),a(P,{label:"创建时间"},{default:n(()=>{var F;return[T(E((F=r.value)==null?void 0:F.insertTime),1)]}),_:1}),a(P,{label:"更新时间"},{default:n(()=>{var F;return[T(E((F=r.value)==null?void 0:F.updateTime),1)]}),_:1}),a(P,{label:"上传用户"},{default:n(()=>{var F;return[T(E((F=r.value)==null?void 0:F.creatorNickname),1)]}),_:1}),a(P,{label:"题目来源"},{default:n(()=>{var F;return[T(E((F=r.value)==null?void 0:F.source),1)]}),_:1}),re(y)?(D(),G(P,{key:0,label:"标签"},{default:n(()=>[a(S,null,{default:n(()=>{var F;return[(D(!0),W(Q,null,pe((F=r.value)==null?void 0:F.tags,J=>(D(),G(A,{key:J.id,variant:"dashed",onClick:()=>q(J)},{default:n(()=>[T(E(J.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})):ue("",!0)]),_:1}),U("div",no,[a(S,null,{default:n(()=>[a(A,{onClick:g},{default:n(()=>b[2]||(b[2]=[T("提交记录")])),_:1}),a(A,{onClick:x},{default:n(()=>b[3]||(b[3]=[T("题目讨论")])),_:1}),re(y)?(D(),G(A,{key:0,onClick:c},{default:n(()=>b[4]||(b[4]=[T("题目推荐")])),_:1})):ue("",!0)]),_:1})]),U("div",oo,[a(S,null,{default:n(()=>[a(H,{modelValue:p.value,"onUpdate:modelValue":b[0]||(b[0]=F=>p.value=F),label:"语言：",placeholder:"请选择提交语言","auto-width":"",clearable:"",onChange:$},{default:n(()=>[(D(!0),W(Q,null,pe(f.value,F=>(D(),G(B,{key:F.value,value:F.value,label:F.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),a(A,{onClick:j},{default:n(()=>b[5]||(b[5]=[T("提交")])),_:1})]),_:1}),U("div",{ref_key:"codeEditRef",ref:v,class:"dida-code-editor"},null,512)])])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),vt=te(lo,[["__scopeId","data-v-538dbeb4"]]),so={};function ro(e,t){return" TODO "}const uo=te(so,[["render",ro]]),io=["innerHTML"];function bt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ae(e)}const co=ee({__name:"JudgeJobList",setup(e){const t=ce(),o=Ue(),{globalProperties:s}=le();let l=!1,u=null,y;const z=m(!1),w=m(null),_=m(null),h=m(!1);let r=-1;const i=m({problemId:"",username:"",language:void 0,status:void 0}),v=m([{title:"ID",colKey:"id",cell:(P,S)=>a(K,{variant:"text",onClick:()=>$(S.row.id)},{default:()=>[S.row.id]})},{title:"问题",colKey:"problemId",cell:(P,S)=>{if(r){let R;return a(K,{variant:"text",onClick:()=>j(r,S.row.contestProblemIndex)},bt(R=xe(S.row.contestProblemIndex))?R:{default:()=>[R]})}return a(K,{variant:"text",onClick:()=>c(S.row.problemId)},{default:()=>[S.row.problemId]})}},{title:"状态",colKey:"status",align:"center",cell:(P,S)=>{const R=S.row.status,B=Qe(R),H=Gt(R);let M=[];return Me(R)&&M.push(a(be,{text:S.row.state,size:"small",class:"dida-status-loading"},null)),M.push(a("span",null,[B])),a(K,{theme:H,variant:"outline",onClick:()=>$(S.row.id)},bt(M)?M:{default:()=>[M]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"code",cell:(P,S)=>a(K,{theme:"default",onClick:()=>x(S.row)},{default:()=>[S.row.language+" / "+S.row.codeLength]})},{title:"作者",colKey:"author",width:200,cell:(P,S)=>a(K,{variant:"text",onClick:()=>k(S.row.authorUsername)},{default:()=>[S.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),C=m(!1);let p=1,f=50;const L=m({current:p,pageSize:f,defaultCurrent:p,defaultPageSize:f,total:0,pageSizeOptions:[50,100]}),q=m(),I=m([]);I.value=Kt();const g=m([]);g.value=$n();const x=async P=>{h.value=!0,z.value=!0;try{w.value=P;const S=await Rn(Number(w.value.id));if(S.code===0){const R=S.data,H=`\`\`\`${ft(R.language)}
${R.code}
\`\`\``,M={};w.value.code=await se.md2html(H,M),await ke(()=>{_.value&&(se.highlightRender({lineNumber:!0,enable:!0},_.value),Ke(_.value))})}else N(s,S.code)}finally{h.value=!1}},c=P=>{P&&o.push({path:"/problem/"+P})},j=(P,S)=>{o.push({name:"contest-problem-detail",params:{contestId:P,problemIndex:S}})},$=P=>{P&&(r>0?o.push({name:"contest-judge-detail",params:{contestId:r,judgeId:P}}):o.push({name:"judge-detail",params:{judgeId:P}}))},k=P=>{P&&o.push({path:"/user/"+P})},b=async()=>{await o.push({query:{...t.query,page:1,page_size:f,problem_id:i.value.problemId,username:i.value.username,language:i.value.language,status:i.value.status}})},d=async()=>{i.value.problemId="",i.value.username="",i.value.language=void 0,i.value.status=void 0,await o.push({query:{...t.query,page:1,page_size:f,problem_id:"",username:"",language:void 0,status:void 0}})},V=async(P,S)=>{S&&(C.value=!0);let R=!1;try{const{current:B,pageSize:H}=P,M=await An(r,i.value.problemId,i.value.username,i.value.language,i.value.status,B,H);q.value=[],M.code===0?M.data.list&&M.data.list.length>0?(M.data.list.forEach(F=>{var fe;const J=Nt(F);(fe=q.value)==null||fe.push(J),Me(F.status)&&(R=!0)}),L.value={...L.value,total:M.data.total_count}):(ie(s,"未找到记录"),L.value={...L.value,total:0}):S&&N(s,M.code)}catch(B){console.error(B),S&&N(s,Ce())}finally{S&&(C.value=!1),R&&l&&(y=setTimeout(()=>{V({current:p,pageSize:f},!1)},5e3))}},A=async P=>{await o.push({query:{...t.query,page:P.current,page_size:P.pageSize}})};return ae(async()=>{l=!0,u=Le(()=>t.query,P=>{Array.isArray(t.params.contestId)?r=Number(t.params.contestId[0]):r=Number(t.params.contestId),i.value.problemId=P.problem_id||"",i.value.username=P.username||"",P.language!=null?i.value.language=Number(P.language):i.value.language=void 0,P.status!=null?i.value.status=Number(P.status):i.value.status=void 0;const S=parseInt(P.page)||L.value.defaultCurrent,R=parseInt(P.page_size)||L.value.defaultPageSize;p=S,f=R,L.value.pageSizeOptions.includes(f)||(f=L.value.defaultPageSize),L.value={...L.value,current:p,pageSize:f},V({current:p,pageSize:f},!0)},{immediate:!0})}),we(()=>{l=!1,u&&u(),clearTimeout(y)}),(P,S)=>{const R=Ie,B=ze,H=zt,M=jt,Y=K,F=_e,J=je,fe=Pe,Ve=oe,de=He,me=be,Se=Oe;return D(),W(Q,null,[a(Ve,{style:{margin:"10px"}},{default:n(()=>[a(J,{layout:"inline",onSubmit:b,onReset:d},{default:n(()=>[a(B,{label:"题号"},{default:n(()=>[a(R,{modelValue:i.value.problemId,"onUpdate:modelValue":S[0]||(S[0]=Z=>i.value.problemId=Z),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),a(B,{label:"用户"},{default:n(()=>[a(R,{modelValue:i.value.username,"onUpdate:modelValue":S[1]||(S[1]=Z=>i.value.username=Z),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),a(B,{label:"语言"},{default:n(()=>[a(M,{modelValue:i.value.language,"onUpdate:modelValue":S[2]||(S[2]=Z=>i.value.language=Z),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:n(()=>[(D(!0),W(Q,null,pe(I.value,Z=>(D(),G(H,{key:Z.value,value:Z.value,label:Z.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(B,{label:"状态"},{default:n(()=>[a(M,{modelValue:i.value.status,"onUpdate:modelValue":S[3]||(S[3]=Z=>i.value.status=Z),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:n(()=>[(D(!0),W(Q,null,pe(g.value,Z=>(D(),G(H,{key:Z.value,value:Z.value,label:Z.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(B,null,{default:n(()=>[a(F,null,{default:n(()=>[a(Y,{theme:"primary",type:"submit"},{default:n(()=>S[7]||(S[7]=[T("搜索")])),_:1}),a(Y,{theme:"default",variant:"base",type:"reset"},{default:n(()=>S[8]||(S[8]=[T("重置")])),_:1})]),_:1})]),_:1})]),_:1}),a(fe,{data:q.value,columns:v.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:L.value,loading:C.value,onPageChange:A,"table-layout":"auto"},null,8,["data","columns","pagination","loading"])]),_:1}),a(Se,{visible:z.value,"onUpdate:visible":S[5]||(S[5]=Z=>z.value=Z),width:"800px","cancel-btn":null,"close-btn":!1,onConfirm:S[6]||(S[6]=Z=>z.value=!1)},{header:n(()=>[a(de,{onClick:S[4]||(S[4]=()=>{var Z;$((Z=w.value)==null?void 0:Z.id)})},{default:n(()=>{var Z,Fe;return[T(E(((Z=w.value)==null?void 0:Z.id)+" - "+((Fe=w.value)==null?void 0:Fe.language)),1)]}),_:1})]),default:n(()=>[a(me,{loading:h.value},{default:n(()=>{var Z;return[U("div",{innerHTML:(Z=w.value)==null?void 0:Z.code,ref_key:"markdownCodeRef",ref:_,style:{"min-height":"100px"}},null,8,io)]}),_:1},8,["loading"])]),_:1},8,["visible"])],64)}}}),ht=te(co,[["__scopeId","data-v-ae344c2e"]]),mo={class:"dida-code-container"},po=["innerHTML"],fo={key:2,class:"dida-edit-container"};function yt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ae(e)}const _o=ee({__name:"JudgeJobDetail",setup(e){const t=ce(),o=Ue(),s=ye(),{globalProperties:l}=le();let u=!1,y,z=-1;const w=m(""),_=m(null),h=m(""),r=m(null),i=m(0),v=m(null),C=m({from:"#5a96ff",to:"#00A870"});let p=!1;const f=m([{title:"ID",colKey:"id"},{title:"问题",colKey:"problemId",cell:(d,V)=>a(K,{variant:"text",onClick:()=>c(V.row.problemId)},{default:()=>[V.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(d,V)=>{const A=V.row.status,P=Qe(A),S=Gt(A);let R=[];return Me(A)&&R.push(a(be,{text:V.row.state,size:"small",class:"dida-status-loading"},null)),R.push(a("span",null,[P])),a(K,{theme:S,variant:"outline"},yt(R)?R:{default:()=>[R]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"language",cell:(d,V)=>a("span",null,[V.row.language+" / "+V.row.codeLength])},{title:"作者",colKey:"author",width:200,cell:(d,V)=>a(K,{variant:"text",onClick:()=>j(V.row.authorUsername)},{default:()=>[V.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),L=m(!1),q=m(!1),I=m(),g=De(()=>s.hasAuth(Re.ManageJudge)),x=async()=>{if(!q.value){q.value=!0;try{const d=await Mn(z);d.code===0?await k(!0):N(l,d.code)}catch(d){console.error(d),N(l,Ce())}finally{q.value=!1}}},c=d=>{d&&o.push({path:"/problem/"+d})},j=d=>{d&&o.push({path:"/user/"+d})},$=d=>{const V=d.status,A=Qe(V);let P;switch(V){case ve.Init:case ve.Rejudge:case ve.Compiling:case ve.Running:P="default";break;case ve.Accept:P="success";break;case ve.PE:P="warning";break;default:P="danger";break}return a(_e,null,{default:()=>[a(K,{theme:"default",variant:"outline"},{default:()=>[d.taskId]}),a(K,{theme:P,variant:"outline"},yt(A)?A:{default:()=>[A]}),a("span",null,[T("分数："),d.score]),a("span",null,[T("用时："),d.time]),a("span",null,[T("内存："),d.memory])]})},k=async d=>{var A;d&&(L.value=!0);let V=!1;try{const P=await Dn(z);if(I.value=[],P.code===0){const S=P.data,R=Nt(S);if((A=I.value)==null||A.push(R),S.judger){const H=await At(S.judger);w.value=H.name}else w.value="";C.value.to="#00A870",Me(S.status)?(v.value="active",R.taskTotal>0?(i.value=R.taskCurrent/R.taskTotal*100,R.taskCurrent>=R.taskTotal&&(i.value=99)):i.value=0):(i.value=100,S.status===ve.Accept?v.value="success":S.status===ve.PE?(C.value.to="#F57C20",v.value="warning"):(C.value.to="#F56C6C",v.value="error"));const B={};if(S.code){const M=`\`\`\`${ft(S.language)}
${S.code}
\`\`\``;h.value=await se.md2html(M,B),await ke(()=>{r.value&&(p||(p=!0,se.highlightRender({lineNumber:!0,enable:!0},r.value)),Ke(r.value))})}_.value=R,Me(S.status)&&(V=!0)}else d&&N(l,P.code)}catch(P){console.error(P),d&&N(l,Ce())}finally{d&&(L.value=!1),V&&u&&(y=setTimeout(()=>{k(!1)},5e3))}};function b(){r.value&&r.value.parentElement&&(r.value.style.maxWidth=r.value.parentElement.clientWidth+"px")}return ae(async()=>{if(u=!0,Array.isArray(t.params.judgeId)?z=Number(t.params.judgeId[0]):z=Number(t.params.judgeId),!z){await o.push({name:"judge"});return}await k(!0),b(),window.addEventListener("resize",b)}),we(()=>{u=!1,window.removeEventListener("resize",b),clearTimeout(y)}),(d,V)=>{var fe,Ve,de;const A=ya,P=Pe,S=oe,R=he,B=qe,H=Ee,M=ge,Y=$t,F=Vt,J=K;return D(),W(Q,null,[a(A,{color:C.value,status:v.value,class:"dida-job-progress",percentage:i.value},null,8,["color","status","percentage"]),a(S,{style:{margin:"10px"}},{default:n(()=>[a(P,{data:I.value,columns:f.value,"row-key":"id","vertical-align":"top",hover:!0,loading:L.value},null,8,["data","columns","loading"])]),_:1}),a(M,null,{default:n(()=>[a(R,{span:8},{default:n(()=>[U("div",mo,[U("div",{innerHTML:h.value,ref_key:"markdownCodeRef",ref:r,class:"dida-code-div"},null,8,po)])]),_:1}),a(R,{span:4},{default:n(()=>[a(H,{layout:"vertical",bordered:!0,style:{margin:"10px"}},{default:n(()=>[a(B,{label:"判题机"},{default:n(()=>[T(E(w.value),1)]),_:1}),a(B,{label:"判题时间"},{default:n(()=>{var me;return[T(E((me=_.value)==null?void 0:me.judgeTime),1)]}),_:1})]),_:1})]),_:1})]),_:1}),(fe=_.value)!=null&&fe.compileMessage?(D(),G(S,{key:0,class:"compile-message"},{default:n(()=>{var me;return[T(E((me=_.value)==null?void 0:me.compileMessage),1)]}),_:1})):ue("",!0),(Ve=_.value)!=null&&Ve.task&&((de=_.value)==null?void 0:de.task.length)>0?(D(),G(F,{key:1,class:"task-panel"},{default:n(()=>{var me;return[(D(!0),W(Q,null,pe((me=_.value)==null?void 0:me.task,(Se,Z)=>(D(),G(Y,{key:Se.taskId,header:()=>$(Se)},{default:n(()=>[T(E(Se.content)+" "+E(Se.waHint),1)]),_:2},1032,["header"]))),128))]}),_:1})):ue("",!0),g.value?(D(),W("div",fo,[a(J,{onClick:x,loading:q.value},{default:n(()=>V[0]||(V[0]=[T("重新评测")])),_:1},8,["loading"])])):ue("",!0)],64)}}}),wt=te(_o,[["__scopeId","data-v-c193991c"]]),go={style:{margin:"10px"}},vo=ee({__name:"ContestList",setup(e){const t=ce(),o=Ue(),{globalProperties:s}=le();let l=null;const u=m(!1),y=m(!1),z=m([{title:"ID",colKey:"id",width:"100",cell:(x,c)=>a(K,{variant:"text",onClick:()=>p(c.row.id)},{default:()=>[c.row.id]})},{title:"标题",colKey:"title",cell:(x,c)=>a(K,{variant:"text",onClick:()=>p(c.row.id)},{default:()=>[c.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),w=m(!1);let _=1,h=50;const r=m({current:_,pageSize:h,defaultCurrent:_,defaultPageSize:h,total:0,pageSizeOptions:[50,100]}),i=m(),v=m({title:"",username:""}),C=m({title:"",description:"",open_time:[]}),p=x=>{x&&o.push({path:"/contest/"+x})},f=async()=>{await o.push({query:{...t.query,title:v.value.title,username:v.value.username,page:1,page_size:r.value.defaultPageSize}})},L=async(x,c)=>{var j;w.value=!0;try{const{current:$,pageSize:k}=x,b=await Yn($,k);if(i.value=[],b.code===0){const d=b.data.list;for(let V=0;V<d.length;V++){const A=d[V],P=await Bt(A);(j=i.value)==null||j.push(P)}r.value={...r.value,total:b.data.total_count}}else c&&N(s,b.code)}catch($){console.error($),N(s,Ce())}finally{w.value=!1}},q=async x=>{await o.push({query:{...t.query,page:x.current,page_size:x.pageSize}})},I=()=>{u.value=!0},g=async()=>{y.value=!0,console.log("contestCreateForm",C.value),Qn(C.value).then(x=>{x.code===0?(ie(s,"创建比赛成功"),u.value=!1,o.push({path:"/contest/"+x.data.id})):N(s,x.code)}).finally(()=>{y.value=!1})};return ae(async()=>{l=Le(()=>t.query,x=>{v.value.title=x.title||"",v.value.username=x.username||"";const c=parseInt(x.page)||r.value.defaultCurrent,j=parseInt(x.page_size)||r.value.defaultPageSize;_=c,h=j,r.value={...r.value,current:_,pageSize:h},L({current:_,pageSize:h},!0)},{immediate:!0})}),we(()=>{l&&l()}),(x,c)=>{const j=Pe,$=oe,k=he,b=Ie,d=ze,V=K,A=je,P=_e,S=ge,R=wa,B=Oe;return D(),W(Q,null,[a(S,null,{default:n(()=>[a(k,{span:9},{default:n(()=>[a($,{style:{margin:"10px"}},{default:n(()=>[a(j,{data:i.value,columns:z.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:r.value,loading:w.value,onPageChange:q},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),a(k,{span:3},{default:n(()=>[U("div",go,[a($,{class:"sh-card"},{default:n(()=>[a(A,{model:v.value},{default:n(()=>[a(d,{label:"标题"},{default:n(()=>[a(b,{modelValue:v.value.title,"onUpdate:modelValue":c[0]||(c[0]=H=>v.value.title=H),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),a(d,{label:"负责人"},{default:n(()=>[a(b,{modelValue:v.value.username,"onUpdate:modelValue":c[1]||(c[1]=H=>v.value.username=H),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),a(d,null,{default:n(()=>[a(V,{theme:"primary",onClick:f},{default:n(()=>c[6]||(c[6]=[T("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a($,{class:"sh-card"},{default:n(()=>[a(P,null,{default:n(()=>[a(V,{onClick:I},{default:n(()=>c[7]||(c[7]=[T("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),a(B,{visible:u.value,"onUpdate:visible":c[5]||(c[5]=H=>u.value=H),header:"创建比赛",onConfirm:g,"confirm-loading":y.value},{default:n(()=>[a(A,{"label-width":80,model:C.value,onSubmit:c[4]||(c[4]=Ne(()=>{},["prevent"]))},{default:n(()=>[a(d,{label:"标题"},{default:n(()=>[a(b,{modelValue:C.value.title,"onUpdate:modelValue":c[2]||(c[2]=H=>C.value.title=H),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),a(d,{label:"开启时间"},{default:n(()=>[a(R,{"enable-time-picker":"","allow-input":"",clearable:"",modelValue:C.value.open_time,"onUpdate:modelValue":c[3]||(c[3]=H=>C.value.open_time=H)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),kt=te(vo,[["__scopeId","data-v-3e6ea683"]]),bo={style:{margin:"20px"}},ho=["innerHTML"],yo={style:{margin:"12px"}},wo=ee({__name:"ContestDetail",setup(e){let t=ce();const{globalProperties:o}=le(),s=$e();let l=0;const u=m(!1),y=m(null),z=m([{title:"问题ID",colKey:"id",cell:(h,r)=>a(K,{variant:"text",onClick:()=>_(l,r.row.index)},{default:()=>[r.row.id]})},{title:"标题",colKey:"title",cell:(h,r)=>a(K,{variant:"text",onClick:()=>_(l,r.row.index)},{default:()=>[r.row.title]})},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),w=m([]),_=(h,r)=>{O.push({name:"contest-problem-detail",params:{contestId:h,problemIndex:r}})};return ae(async()=>{if(Array.isArray(t.params.contestId)?l=Number(t.params.contestId[0]):l=Number(t.params.contestId),!l){await O.push({name:"contest"});return}u.value=!0;const h=await Xn(l);if(h.code!==0){u.value=!1,N(o,h.code),await O.push({name:"contest"});return}y.value=await Bt(h.data),w.value=y.value.problems,s.setTitle(y.value.title+" - "+s.getTitle),await ke(()=>{const r=document.querySelectorAll(".dida-content-description");r&&r.length>0&&r.forEach(i=>{se.mathRender(i),se.highlightRender({lineNumber:!0,enable:!0},i),Ke(i)}),u.value=!1})}),(h,r)=>{const i=mt,v=K,C=_e,p=$t,f=Vt,L=Pe,q=oe,I=he,g=qe,x=Ee,c=ge,j=be;return D(),G(j,{loading:u.value},{default:n(()=>[a(c,{class:"dida-main-content"},{default:n(()=>[a(I,{span:8},{default:n(()=>{var $,k,b;return[U("div",bo,[U("h1",null,E(($=y.value)==null?void 0:$.title),1),(k=y.value)!=null&&k.notification?(D(),G(i,{key:0,theme:"info",message:(b=y.value)==null?void 0:b.notification},null,8,["message"])):ue("",!0)]),a(f,{"default-value":[0],"expand-icon":!1,borderless:!0},{default:n(()=>{var d;return[(D(!0),W(Q,null,pe((d=y.value)==null?void 0:d.descriptions,(V,A)=>(D(),G(p,{key:A,header:V.title},rt({default:n(()=>[U("div",{innerHTML:V.content,class:"dida-content-description"},null,8,ho)]),_:2},[A===0?{name:"headerRightContent",fn:n(()=>[a(C,{size:"small"},{default:n(()=>[a(v,{size:"small"},{default:n(()=>r[0]||(r[0]=[T("收起全部")])),_:1}),a(v,{size:"small"},{default:n(()=>r[1]||(r[1]=[T("展开全部")])),_:1})]),_:1})]),key:"0"}:void 0]),1032,["header"]))),128))]}),_:1}),a(q,{style:{margin:"10px"}},{default:n(()=>[a(L,{data:w.value,columns:z.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1})]}),_:1}),a(I,{span:4},{default:n(()=>[U("div",yo,[a(x,{layout:"vertical",bordered:!0},{default:n(()=>[a(g,{label:"开始时间"},{default:n(()=>{var $;return[T(E(($=y.value)==null?void 0:$.startTime),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),ko=te(wo,[["__scopeId","data-v-0c96c05a"]]);function So(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ae(e)}const Co=ee({__name:"ContestRank",setup(e){const t=ce(),o=Ue(),{globalProperties:s}=le();let l=null,u=0;const y=i=>{if(i==null)return"-";const v=Math.floor(i/3600).toString().padStart(2,"0"),C=Math.floor(i%3600/60).toString().padStart(2,"0"),p=(i%60).toString().padStart(2,"0");return`${v}:${C}:${p}`},z=[{title:"Rank",colKey:"rank",align:"center",width:"100",cell:(i,v)=>a(K,{variant:"text",onClick:()=>o.push({name:"contest-user-rank",params:{contestId:u,userId:v.row.user_id}})},{default:()=>[v.row.rank]})},{title:"Nickname",colKey:"nickname",width:"200",cell:(i,v)=>a(K,{variant:"text",onClick:()=>o.push({name:"user",params:{username:v.row.username}})},{default:()=>[v.row.nickname]})},{title:"Solved",colKey:"solved",align:"center",width:"100",cell:(i,v)=>a(K,{variant:"text",onClick:()=>o.push({name:"contest-judge",params:{contestId:u},query:{username:v.row.username,status:ve.Accept}})},{default:()=>[v.row.solved]})},{title:"Penalty",colKey:"penalty",align:"center",width:"100",cell:(i,v)=>y(v.row.penalty)}],w=m([]),_=m(!1),h=m(),r=async i=>{_.value=!0;try{const v=await Zn(u);if(w.value=z,h.value=[],v.code===0){v.data.problems.sort((L,q)=>L-q),v.data.problems.forEach((L,q)=>{w.value.push({title:xe(L),colKey:`problem_${L}`,align:"center",width:"100",title:(I,{colIndex:g})=>{let x;return a(K,{variant:"text",onClick:()=>o.push({name:"contest-problem-detail",params:{contestId:u,problemIndex:L}})},So(x=xe(L))?x:{default:()=>[x]})},cell:(I,g)=>{const x=g.row[`problem_${L}`];if(!x)return"";let c="";return x.acDuration>=0&&(c=y(x.acDuration)),x.attempt>0&&(c&&(c+=" "),c+=`(-${x.attempt})`),a("span",null,[c])},attrs:I=>{const g=I.row[`problem_${L}`];return g?g.acDuration>=0?{style:{backgroundColor:"rgba(130,255,30,0.5)"}}:{style:{backgroundColor:"rgba(255,120,120,0.5)"}}:{}}})});const C=new Date(v.data.start_time),p=v.data.ranks,f=[];for(let L=0;L<p.length;L++){const q=p[L];let I={username:q.author_username,nickname:q.author_nickname},g=0,x=0;q.problems.forEach((c,j)=>{let $=-1;c.ac&&(g++,$=(new Date(c.ac).getTime()-C.getTime())/1e3,x+=$,x+=c.attempt*20*60);const k=c.index;I[`problem_${k}`]={acDuration:$,attempt:c.attempt}}),I.solved=g,I.penalty=x,f.push(I)}f.sort((L,q)=>L.solved!==q.solved?q.solved-L.solved:L.penalty-q.penalty);for(let L=0;L<f.length;L++)f[L].rank=L+1;h.value=f}else i&&N(s,v.code)}catch(v){console.error(v),N(s,Ce())}finally{_.value=!1}};return ae(async()=>{l=Le(()=>t.query,async i=>{if(Array.isArray(t.params.contestId)?u=Number(t.params.contestId[0]):u=Number(t.params.contestId),!u){await o.push({name:"contest"});return}await r(!0)},{immediate:!0})}),we(()=>{l&&l()}),(i,v)=>{const C=Pe,p=oe,f=ge;return D(),G(f,null,{default:n(()=>[a(p,{style:{margin:"10px"}},{default:n(()=>[a(C,{data:h.value,columns:w.value,"row-key":"id","vertical-align":"top",hover:!0,"table-layout":"fixed",loading:_.value},null,8,["data","columns","loading"])]),_:1})]),_:1})}}});function Jt(e){const t={};return t.id=e.id,t.authorId=e.author_id,t.authorUsername=e.author_username,t.authorNickname=e.author_nickname,t.title=e.title,t.content=e.content,e.insert_time&&(t.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(t.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(t.updateTime=new Date(e.update_time).toLocaleString()),t.problemId=e.problem_id,t.problemTitle=e.problem_title,t.contestId=e.contest_id,t.contestTitle=e.contest_title,t.contestProblemIndex=e.contest_problem_index,t}async function Io(e){const t={};if(t.id=e.id,t.authorId=e.author_id,t.authorUsername=e.author_username,t.authorNickname=e.author_nickname,t.content="",e.content){const o={math:{inlineDigit:!0,engine:"KaTeX"}};t.content=await se.md2html(e.content,o)}return e.insert_time&&(t.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(t.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(t.updateTime=new Date(e.update_time).toLocaleString()),t}function Po(e){return X({url:"/discuss?id="+e,method:"get"})}function To(e,t,o,s,l,u){const y={};return e&&(y.contest_id=e),t&&(y.problem_id=t),o&&(y.title=o),s&&(y.username=s),l&&(y.page=l),u&&(y.page_size=u),X({url:`/discuss/list?${new URLSearchParams(y).toString()}`,method:"get"})}function xo(e,t,o){return X({url:"/discuss/comment/list?id="+e+"&page="+t+"&page_size="+o,method:"get"})}function Lo(e){return X({url:"/discuss/create",method:"post",data:e})}const jo={style:{margin:"10px"}};function zo(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ae(e)}const $o=ee({__name:"DiscussList",setup(e){const t=ce(),o=Ue(),{globalProperties:s}=le();let l=null;const u=m(!1),y=m(!1);let z=-1;const w=m([]),_=[],h=[{title:"标题",colKey:"title",cell:(b,d)=>a(K,{variant:"text",onClick:()=>g(d.row.id)},{default:()=>[d.row.title]})},{title:"创建人",colKey:"authorNickname",width:"200"},{title:"创建时间",colKey:"insertTime",width:"180"},{title:"更新时间",colKey:"updateTime",width:"180"}],r=m(!1);let i=1,v=50;const C=m({current:i,pageSize:v,defaultCurrent:i,defaultPageSize:v,total:0,pageSizeOptions:[50,100]}),p=m(),f=m({problemId:"",title:"",username:""}),L=m({title:"",content:""}),q=b=>{b&&o.push({name:"problem-detail",params:{problemId:b}})},I=(b,d)=>{o.push({name:"contest-problem-detail",params:{contestId:b,problemIndex:d}})},g=b=>{if(b){if(z){o.push({name:"contest-discuss-detail",params:{contestId:z,discussId:b}});return}o.push({name:"discuss-detail",params:{discussId:b}})}},x=async()=>{await o.push({query:{...t.query,problem_id:f.value.problemId,title:f.value.title,username:f.value.username,page:1,page_size:C.value.defaultPageSize}})},c=async(b,d)=>{var V;r.value=!0;try{const{current:A,pageSize:P}=b,S=await To(z,f.value.problemId,f.value.title,f.value.username,A,P);if(p.value=[],S.code===0){if(S.data.list){const R=S.data.list;for(let B=0;B<R.length;B++){const H=R[B],M=await Jt(H);(V=p.value)==null||V.push(M)}}C.value={...C.value,total:S.data.total_count}}else d&&N(s,S.code)}catch(A){console.error(A),N(s,Ce())}finally{r.value=!1}},j=async b=>{await o.push({query:{...t.query,page:b.current,page_size:b.pageSize}})},$=()=>{u.value=!0},k=async()=>{y.value=!0,console.log("discussCreateForm",L.value),Lo(L.value).then(b=>{b.code===0?(ie(s,"创建比赛成功"),u.value=!1,o.push({path:"/discuss/"+b.data.id})):N(s,b.code)}).finally(()=>{y.value=!1})};return ae(async()=>{l=Le(()=>t.query,b=>{Array.isArray(t.params.contestId)?z=Number(t.params.contestId[0]):z=Number(t.params.contestId),w.value=_,z?w.value=w.value.concat([{title:"问题ID",colKey:"contestProblemIndex",width:"100",cell:(A,P)=>{let S;return P.row.contestProblemIndex?a(K,{variant:"text",onClick:()=>I(z,P.row.contestProblemIndex)},zo(S=xe(P.row.contestProblemIndex))?S:{default:()=>[S]}):""}}]):w.value=w.value.concat([{title:"问题ID",colKey:"problemId",width:"100",cell:(A,P)=>P.row.problemId?a(K,{variant:"text",onClick:()=>q(P.row.problemId)},{default:()=>[P.row.problemId]}):""}]),w.value=w.value.concat(h),f.value.problemId=b.problem_id||"",f.value.title=b.title||"",f.value.username=b.username||"";const d=parseInt(b.page)||C.value.defaultCurrent,V=parseInt(b.page_size)||C.value.defaultPageSize;i=d,v=V,C.value={...C.value,current:i,pageSize:v},c({current:i,pageSize:v},!0)},{immediate:!0})}),we(()=>{l&&l()}),(b,d)=>{const V=Pe,A=oe,P=he,S=Ie,R=ze,B=K,H=je,M=_e,Y=ge,F=Oe;return D(),W(Q,null,[a(Y,null,{default:n(()=>[a(P,{span:9},{default:n(()=>[a(A,{style:{margin:"10px"}},{default:n(()=>[a(V,{data:p.value,columns:w.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:C.value,loading:r.value,"table-layout":"auto",onPageChange:j},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),a(P,{span:3},{default:n(()=>[U("div",jo,[a(A,{class:"sh-card"},{default:n(()=>[a(H,{model:f.value},{default:n(()=>[a(R,{label:"问题ID"},{default:n(()=>[a(S,{modelValue:f.value.problemId,"onUpdate:modelValue":d[0]||(d[0]=J=>f.value.problemId=J),placeholder:"请输入完整问题ID"},null,8,["modelValue"])]),_:1}),a(R,{label:"标题"},{default:n(()=>[a(S,{modelValue:f.value.title,"onUpdate:modelValue":d[1]||(d[1]=J=>f.value.title=J),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),a(R,{label:"创建人"},{default:n(()=>[a(S,{modelValue:f.value.username,"onUpdate:modelValue":d[2]||(d[2]=J=>f.value.username=J),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),a(R,null,{default:n(()=>[a(B,{theme:"primary",onClick:x},{default:n(()=>d[6]||(d[6]=[T("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(A,{class:"sh-card"},{default:n(()=>[a(M,null,{default:n(()=>[a(B,{onClick:$},{default:n(()=>d[7]||(d[7]=[T("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),a(F,{visible:u.value,"onUpdate:visible":d[5]||(d[5]=J=>u.value=J),header:"创建讨论",onConfirm:k,"confirm-loading":y.value},{default:n(()=>[a(H,{"label-width":80,model:L.value,onSubmit:d[4]||(d[4]=Ne(()=>{},["prevent"]))},{default:n(()=>[a(R,{label:"标题"},{default:n(()=>[a(S,{modelValue:L.value.title,"onUpdate:modelValue":d[3]||(d[3]=J=>L.value.title=J),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Xe=te($o,[["__scopeId","data-v-b991b10d"]]),Vo={key:0,style:{margin:"20px"}},Do=["innerHTML"],Ro=["innerHTML"],Ao={style:{margin:"10px"}},Uo={style:{margin:"10px"}},Eo={style:{margin:"10px","text-align":"right"}},qo={style:{margin:"12px"}},Mo={key:0,class:"dida-edit-container"},Ko=ee({__name:"DiscussDetail",props:{discussId:{}},setup(e){const t=e;let o=ce();const{globalProperties:s}=le();let l=null;const u=$e(),y=ye();let z=m("");const w=m(""),_=m(null),h=m(!1),r=m(null),i=m(!1);let v=1,C=20;const p=m({current:1,total:0,defaultPageSize:C,defaultCurrent:v,pageSizeOptions:[20,50]}),f=m([]),L={},q=De(()=>y.hasAuth(Re.ManageDiscuss)),I=k=>{k&&O.push({name:"discuss-list",query:{...o.query,title:"",tag:k.name}})},g=()=>{O.push({name:"manage-discuss",params:{discussId:w.value}})},x=()=>a("div",{class:"t-pagination__total"},[`共 ${p.value.total} 条回复`]),c=()=>{},j=async(k,b)=>{var d;i.value=!0;try{const{current:V,pageSize:A}=k,P=await xo(w.value,V,A);if(f.value=[],P.code===0){const S=P.data.list;if(S)for(let R=0;R<S.length;R++){const B=S[R],H=await Io(B);(d=f.value)==null||d.push(H),await ke(()=>{const M=document.querySelectorAll(".dida-discuss-content");M&&M.length>0&&M.forEach(Y=>{se.mathRender(Y),se.highlightRender({lineNumber:!0,enable:!0},Y),Ke(Y)})})}p.value={...p.value,total:P.data.total_count}}else b&&N(s,P.code)}catch(V){console.error(V),N(s,Ce())}finally{i.value=!1}},$=async k=>{await O.push({query:{...o.query,page:k.current,page_size:k.pageSize}})};return ae(async()=>{if(w.value=t.discussId,w.value||(Array.isArray(o.params.discussId)?w.value=o.params.discussId[0]:w.value=o.params.discussId),!w.value){ne(s,"讨论不存在"),await O.push({name:"discuss"});return}h.value=!0;const k=await Po(w.value);if(k.code!==0){h.value=!1,N(s,k.code),await O.push({name:"discuss"});return}k.data.tags&&k.data.tags.forEach(A=>{L[A.id]=A}),r.value=Jt(k.data.discuss),u.setTitle(r.value.title+" - "+u.getTitle);let b=r.value.content;const d={math:{inlineDigit:!0,engine:"KaTeX"}};z.value=await se.md2html(b,d),await ke(()=>{_.value&&(se.mathRender(_.value),se.highlightRender({lineNumber:!0,enable:!0},_.value),Ke(_.value)),h.value=!1}),l=Le(()=>o.query,A=>{const P=parseInt(A.page)||p.value.defaultCurrent,S=parseInt(A.page_size)||p.value.defaultPageSize;v=P,C=S,p.value={...p.value,current:v,pageSize:C},j({current:v,pageSize:C},!0)},{immediate:!0});const V={after:()=>{}};new se("commentEditRef",V)}),we(()=>{l&&l()}),(k,b)=>{const d=Sa,V=ka,A=oe,P=_e,S=Ca,R=K,B=he,H=qe,M=Ee,Y=ge,F=be;return D(),G(F,{loading:h.value},{default:n(()=>[a(Y,{class:"dida-main-content"},{default:n(()=>[a(B,{span:8},{default:n(()=>{var J,fe,Ve;return[(J=r.value)!=null&&J.problemTitle||(fe=r.value)!=null&&fe.contestTitle?(D(),W("div",Vo,[a(V,{"max-item-width":"300"},{default:n(()=>{var de,me,Se,Z,Fe;return[(de=r.value)!=null&&de.contestTitle?(D(),W(Q,{key:0},[a(d,{to:{name:"contest-detail",params:{contestId:(me=r.value)==null?void 0:me.contestId}}},{default:n(()=>{var Te;return[T(E((Te=r.value)==null?void 0:Te.contestTitle),1)]}),_:1},8,["to"]),(Se=r.value)!=null&&Se.contestProblemIndex?(D(),G(d,{key:0,to:{name:"contest-problem-detail",params:{problemIndex:(Z=r.value)==null?void 0:Z.contestProblemIndex}}},{default:n(()=>{var Te,_t;return[T(E(re(xe)((Te=r.value)==null?void 0:Te.contestProblemIndex))+" - "+E((_t=r.value)==null?void 0:_t.problemTitle),1)]}),_:1},8,["to"])):ue("",!0)],64)):(D(),W(Q,{key:1},[a(d,{to:{name:"discuss-list-problem"}},{default:n(()=>b[2]||(b[2]=[T(" 问题讨论")])),_:1}),a(d,{to:{name:"problem-detail",params:{problemId:(Fe=r.value)==null?void 0:Fe.problemId}}},{default:n(()=>{var Te;return[T(E((Te=r.value)==null?void 0:Te.problemTitle),1)]}),_:1},8,["to"])],64))]}),_:1})])):ue("",!0),a(A,{style:{margin:"10px"},header:(Ve=r.value)==null?void 0:Ve.title,"header-bordered":!0},{default:n(()=>[U("div",{innerHTML:re(z),class:"dida-discuss-content"},null,8,Do)]),_:1},8,["header"]),(D(!0),W(Q,null,pe(f.value,(de,me)=>(D(),G(A,{key:me,style:{margin:"10px"},"header-bordered":""},{header:n(()=>[a(P,null,{default:n(()=>[U("span",null,E(de.authorNickname),1),U("span",null,E(de.insertTime),1)]),_:2},1024)]),default:n(()=>[U("div",{innerHTML:de.content,class:"dida-discuss-content"},null,8,Ro)]),_:2},1024))),128)),U("div",Ao,[a(S,{modelValue:p.value.current,"onUpdate:modelValue":b[0]||(b[0]=de=>p.value.current=de),"page-size":p.value.pageSize,"onUpdate:pageSize":b[1]||(b[1]=de=>p.value.pageSize=de),total:p.value.total,"page-size-options":p.value.pageSizeOptions,"show-page-size":!1,"total-content":x,onChange:$},null,8,["modelValue","page-size","total","page-size-options"])]),U("div",Uo,[b[4]||(b[4]=U("div",{id:"commentEditRef",class:"dida-comment-editor"},null,-1)),U("div",Eo,[a(P,null,{default:n(()=>[a(R,{theme:"primary",onClick:c},{default:n(()=>b[3]||(b[3]=[T("提交")])),_:1})]),_:1})])])]}),_:1}),a(B,{span:4},{default:n(()=>[U("div",qo,[q.value?(D(),W("div",Mo,[a(R,{onClick:g},{default:n(()=>b[5]||(b[5]=[T("编辑")])),_:1})])):ue("",!0),a(M,{layout:"vertical",bordered:!0},{default:n(()=>[a(H,{label:"创建时间"},{default:n(()=>{var J;return[T(E((J=r.value)==null?void 0:J.insertTime),1)]}),_:1}),a(H,{label:"编辑时间"},{default:n(()=>{var J;return[T(E((J=r.value)==null?void 0:J.modifyTime),1)]}),_:1}),a(H,{label:"更新时间"},{default:n(()=>{var J;return[T(E((J=r.value)==null?void 0:J.updateTime),1)]}),_:1}),a(H,{label:"创建用户"},{default:n(()=>{var J;return[T(E((J=r.value)==null?void 0:J.authorNickname),1)]}),_:1}),a(H,{label:"标签"},{default:n(()=>[a(P,null,{default:n(()=>{var J;return[(D(!0),W(Q,null,pe((J=r.value)==null?void 0:J.tags,fe=>(D(),G(R,{key:fe.id,variant:"dashed",onClick:()=>I(fe)},{default:n(()=>[T(E(fe.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),nt=te(Ko,[["__scopeId","data-v-376050e6"]]);function Fo(e,t){return X({url:"/rank/ac/all?page="+e+"&page_size="+t,method:"get"})}function Go(e,t){return X({url:"/rank/ac/problem?page="+e+"&page_size="+t,method:"get"})}function No(e,t){return X({url:"/rank/ac/problem/today?page="+e+"&page_size="+t,method:"get"})}function Ho(e,t){return X({url:"/rank/ac/problem/day7?page="+e+"&page_size="+t,method:"get"})}function Oo(e,t){return X({url:"/rank/ac/problem/year?page="+e+"&page_size="+t,method:"get"})}const Bo={style:{margin:"10px"}};function ot(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ae(e)}const Jo=ee({__name:"RankUser",props:{type:{}},setup(e){const t=ce(),o=Ue(),{globalProperties:s}=le();let l=null;const u=e,y=m(""),z=m(""),w={all:{header:"统计所有用户在本站的提交记录",content:"优先以AC记录数量排序，如果相同则提交所用次数较少的优先，如果仍相同，注册较早的用户靠前"},problem:{header:"统计所有用户在本站的提交记录",content:"以题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-today":{header:"统计所有用户今日在本站的提交记录",content:"以今日题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-day7":{header:"统计所有用户最近7日在本站的提交记录",content:"以7日题目记录数量排序（从7日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-year":{header:"统计所有用户最近1年在本站的提交记录",content:"以最近1年题目记录数量排序（从365日前的0点开始计算），如果相同，注册较早的用户靠前"}},_=m([]),h=[{title:"序号",colKey:"index"},{title:"用户名",colKey:"username",cell:(j,$)=>a(K,{variant:"dashed",onClick:()=>q($.row.username)},{default:()=>[$.row.username]})},{title:"昵称",colKey:"nickname"},{title:"Slogan",colKey:"slogan"}],r=[{title:"题目数量",colKey:"problem_count",cell:(j,$)=>{let k=0;return $.row.problem_count&&(k=$.row.problem_count),a(K,{variant:"dashed",onClick:()=>I($.row.username)},ot(k)?k:{default:()=>[k]})}}],i=[{title:"正确",colKey:"accept",cell:(j,$)=>{let k=0;return $.row.accept&&(k=$.row.accept),a(K,{variant:"dashed",onClick:()=>I($.row.username)},ot(k)?k:{default:()=>[k]})}},{title:"提交",colKey:"attempt",cell:(j,$)=>{let k=0;return $.row.attempt&&(k=$.row.attempt),a(K,{variant:"dashed",onClick:()=>g($.row.username)},ot(k)?k:{default:()=>[k]})}}],v=m(!1);let C=1,p=50;const f=m({current:C,pageSize:p,defaultCurrent:C,defaultPageSize:p,total:0,pageSizeOptions:[50]}),L=m(),q=j=>{o.push({name:"user",params:{username:j}})},I=j=>{o.push({name:"judge-list",query:{username:j,status:ve.Accept}})},g=j=>{o.push({name:"judge-list",query:{username:j}})},x=async(j,$)=>{v.value=!0;try{L.value=[];const{current:k,pageSize:b}=j;let d=null;switch(u.type){case"problem":d=await Go(k,b);break;case"problem-today":d=await No(k,b);break;case"problem-day7":d=await Ho(k,b);break;case"problem-year":d=await Oo(k,b);break;default:d=await Fo(k,b);break}if(d.code===0){const V=d.data.list;if(!V||V.length<=0){f.value={...f.value,total:0},ie(s,"未找到记录");return}L.value=[];const A=f.value.pageSize*(f.value.current-1);let P=1;V.forEach(S=>{var B;const R=S;R.index=A+P++,(B=L.value)==null||B.push(R)}),f.value={...f.value,total:d.data.total_count}}else $&&N(s,d.code)}catch(k){console.error(k),N(s,Ce())}finally{v.value=!1}},c=async j=>{await o.push({query:{...t.query,page:j.current,page_size:j.pageSize}})};return ae(async()=>{v.value=!0,l=Le(()=>t.query,j=>{switch(u.type&&w[u.type]?(y.value=w[u.type].header,z.value=w[u.type].content):(y.value=w.all.header,z.value=w.all.content),u.type){case"all":_.value=h.concat(i);break;default:_.value=h.concat(r);break}const $=parseInt(j.page)||f.value.defaultCurrent,k=parseInt(j.page_size)||f.value.defaultPageSize;C=$,p=k,f.value={...f.value,current:C,pageSize:p},x({current:C,pageSize:p},!0)},{immediate:!0})}),we(()=>{l&&l()}),(j,$)=>{const k=Pe,b=oe,d=he,V=ge;return D(),G(V,null,{default:n(()=>[a(d,{span:9},{default:n(()=>[a(b,{style:{margin:"10px"}},{default:n(()=>[a(k,{data:L.value,columns:_.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:f.value,loading:v.value,"table-layout":"auto",onPageChange:c},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),a(d,{span:3},{default:n(()=>[U("div",Bo,[a(b,{class:"sh-card",header:y.value,"header-bordered":!0},{default:n(()=>[T(E(z.value),1)]),_:1},8,["header"])])]),_:1})]),_:1})}}}),Ge=te(Jo,[["__scopeId","data-v-9bbfd60b"]]),Wo=ee({__name:"ManageJudge",setup(e){const{globalProperties:t}=le(),o=m(""),s=m(!1),l=m(!1),u=m(!1),y=async()=>{s.value=!0;try{const _=await Un();if(_.code!==0){N(t,_.code);return}ie(t,"重判成功"),await O.push({name:"judge-list"})}catch(_){console.error(_),N(t,"重判失败")}finally{s.value=!1}},z=async()=>{if(o.value===""){N(t,"请输入问题Id");return}l.value=!0;try{const _=await En(o.value);if(_.code!==0){N(t,_.code);return}ie(t,"重判成功"),await O.push({name:"judge-list",query:{problem_id:o.value}})}catch(_){console.error(_),N(t,"重判失败")}finally{l.value=!1}},w=async()=>{u.value=!0;try{const _=await qn();if(_.code!==0){N(t,_.code);return}ie(t,"重判成功"),await O.push({name:"judge-list"})}catch(_){console.error(_),N(t,"重判失败")}finally{u.value=!1}};return(_,h)=>{const r=K,i=oe,v=Ie,C=_e;return D(),W(Q,null,[a(i,{class:"yj-manage-card",title:"重判最近提交"},{default:n(()=>[a(r,{onClick:y,loading:s.value},{default:n(()=>h[1]||(h[1]=[T("重判")])),_:1},8,["loading"])]),_:1}),a(i,{class:"yj-manage-card",title:"重判问题"},{default:n(()=>[a(C,null,{default:n(()=>[a(v,{modelValue:o.value,"onUpdate:modelValue":h[0]||(h[0]=p=>o.value=p),placeholder:"输入问题Id"},null,8,["modelValue"]),a(r,{onClick:z,loading:l.value},{default:n(()=>h[2]||(h[2]=[T("重判")])),_:1},8,["loading"])]),_:1})]),_:1}),a(i,{class:"yj-manage-card",title:"重判所有"},{default:n(()=>[a(r,{onClick:w,theme:"danger",loading:u.value},{default:n(()=>h[3]||(h[3]=[T("重判")])),_:1},8,["loading"])]),_:1})],64)}}}),Xo=te(Wo,[["__scopeId","data-v-e1e4c968"]]),Yo={style:{margin:"10px"}},Zo={key:1},Qo={style:{margin:"12px"}},el={class:"dida-edit-container"},tl=ee({__name:"ProblemEdit",setup(e){let t=ce();const{globalProperties:o}=le(),s=$e(),l=m(""),u=m(!1);let y=null;const z=m(!1),w=m(null),_=m({title:"",timeLimit:0,memoryLimit:0,source:"",tags:[]}),h=m([]),r=m([]),i=De(()=>{const I=[],g=h.value;for(let x=0,c=g.length;x<c;x++)g[x].value&&I.push(g[x].value);return I}),v=(I,g)=>{const{trigger:x,index:c,item:j}=g;if(x==="clear"&&(h.value=[]),["tag-remove","backspace"].includes(x)&&h.value.splice(c,1),x==="enter"){for(let k=0;k<r.value.length;k++){const b=r.value[k];if(b.label===j){for(let d=0;d<h.value.length;d++)if(h.value[d].label===b.label)return;h.value.push(b);return}}const $={label:j,value:j};h.value.push($),r.value=r.value.concat($)}},C=(I,{current:g,type:x})=>{if(!g){h.value=x==="check"?r.value.slice(1):[];return}if(x==="check"){const c=r.value.find(j=>j.value===g);if(!c)return;h.value.push(c)}else h.value=h.value.filter(c=>c.value!==g)},p=()=>{O.push({name:"problem-detail",params:{problemId:l.value}})},f=()=>{O.push({name:"manage-problem-judge",params:{problemId:l.value}})},L=async()=>{if(y){z.value=!0,_.value.tags=[];for(let I=0;I<h.value.length;I++){const g=h.value[I];g&&g.label&&_.value.tags.push(g.label)}try{const I=await Gn(l.value,_.value.title,_.value.timeLimit,_.value.memoryLimit,_.value.source,_.value.tags,y.getValue());if(z.value=!0,I.code!==0){N(o,I.code);return}I.data!=null&&(w.value.updateTime=new Date(I.data).toLocaleString()),Et(o,"保存成功")}finally{z.value=!1}}},q=async()=>{const I=await Ht(l.value);if(I.code!==0){N(o,I.code),console.error("problem get failed",I.code),await O.push({name:"problem"});return}const g=I.data.problem;if(w.value=at(g,{}),_.value.title=g.title,_.value.timeLimit=g.time_limit,_.value.memoryLimit=g.memory_limit,_.value.source=g.source,_.value.tags=[],h.value=[],I.data.tags)for(let j=0;j<I.data.tags.length;j++){const $=I.data.tags[j];$&&$.name&&(_.value.tags.push($.name),h.value.push({label:$.name,value:$.id}))}s.setTitle(g.title+" - "+s.getTitle);let x=g.description;const c={after:()=>{y==null||y.setValue(x)}};y=new se("codeEditRef",c),u.value=!1};return ae(async()=>{if(Array.isArray(t.params.problemId)?l.value=t.params.problemId[0]:l.value=t.params.problemId,!l.value){ne(o,"题目不存在"),await O.push({name:"problem"});return}u.value=!0,Ot(-1).then(async I=>{I.code===0?(I.data.list&&I.data.list.forEach(g=>{r.value.push({label:g.name,value:g.id})}),await q()):(N(o,I.code),console.error("problem tag get failed",I.code),await O.push({name:"problem"}))}).catch(async I=>{console.error(I),N(o,"获取数据异常"),await O.push({name:"problem"})})}),(I,g)=>{const x=Ie,c=ze,j=Ia,$=Ta,k=Pa,b=je,d=oe,V=he,A=K,P=_e,S=qe,R=Ee,B=ge,H=be;return D(),G(H,{loading:u.value},{default:n(()=>[a(B,null,{default:n(()=>[a(V,{span:8},{default:n(()=>[U("div",Yo,[a(d,{class:"sh-card"},{default:n(()=>[a(b,{model:_.value},{default:n(()=>[a(c,{label:"标题"},{default:n(()=>[a(x,{modelValue:_.value.title,"onUpdate:modelValue":g[0]||(g[0]=M=>_.value.title=M),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),a(c,{label:"时间限制"},{default:n(()=>[a(j,{modelValue:_.value.timeLimit,"onUpdate:modelValue":g[1]||(g[1]=M=>_.value.timeLimit=M),theme:"normal",min:0},{suffix:n(()=>g[4]||(g[4]=[U("span",null,"ms",-1)])),_:1},8,["modelValue"])]),_:1}),a(c,{label:"内存限制"},{default:n(()=>[a(j,{modelValue:_.value.memoryLimit,"onUpdate:modelValue":g[2]||(g[2]=M=>_.value.memoryLimit=M),theme:"normal",min:0},{suffix:n(()=>g[5]||(g[5]=[U("span",null,"KB",-1)])),_:1},8,["modelValue"])]),_:1}),a(c,{label:"来源"},{default:n(()=>[a(x,{modelValue:_.value.source,"onUpdate:modelValue":g[3]||(g[3]=M=>_.value.source=M),placeholder:"请输入题目来源"},null,8,["modelValue"])]),_:1}),a(c,{label:"标签"},{default:n(()=>[a(k,{value:h.value,"allow-input":!0,placeholder:"请选择或输入","tag-input-props":{excessTagsDisplayType:"break-line"},"popup-props":{overlayInnerClassName:["narrow-scrollbar"],overlayInnerStyle:{maxHeight:"280px",overflowY:"auto",overscrollBehavior:"contain",padding:"6px"}},clearable:"",multiple:"",onTagChange:v},{panel:n(()=>[r.value.length?(D(),G($,{key:0,value:i.value,options:r.value,onChange:C},null,8,["value","options"])):(D(),W("div",Zo,"暂无数据"))]),suffixIcon:n(()=>[a(re(oa))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),a(V,{span:4},{default:n(()=>[U("div",Qo,[U("div",el,[a(P,null,{default:n(()=>[a(A,{onClick:L,theme:"danger",loading:z.value},{default:n(()=>g[6]||(g[6]=[T("保存")])),_:1},8,["loading"]),a(A,{onClick:f,theme:"warning"},{default:n(()=>g[7]||(g[7]=[T("判题数据")])),_:1}),a(A,{onClick:p},{default:n(()=>g[8]||(g[8]=[T("查看")])),_:1})]),_:1})]),a(R,{layout:"vertical",bordered:!0},{default:n(()=>[a(S,{label:"创建时间"},{default:n(()=>{var M;return[T(E((M=w.value)==null?void 0:M.insertTime),1)]}),_:1}),a(S,{label:"更新时间"},{default:n(()=>{var M;return[T(E((M=w.value)==null?void 0:M.updateTime),1)]}),_:1}),a(S,{label:"判题方式"},{default:n(()=>{var M;return[T(E((M=w.value)==null?void 0:M.judgeType),1)]}),_:1}),a(S,{label:"上传用户"},{default:n(()=>{var M;return[T(E((M=w.value)==null?void 0:M.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1}),g[9]||(g[9]=U("div",{id:"codeEditRef",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"])}}}),al=te(tl,[["__scopeId","data-v-b8d494d1"]]),nl={style:{margin:"10px"}},ol={style:{margin:"12px"}},ll={class:"dida-edit-container"},sl=ee({__name:"ProblemJudge",setup(e){let t=ce();const{globalProperties:o}=le(),s=$e(),l=m(""),u=m(!1),y=m(null);let z=null;const w=m(null),_=m(""),h=m(!1),r=m(!1),i=m([{title:"文件",colKey:"file"},{title:"大小",colKey:"size",width:150,cell:(b,d)=>d.row.size.toFixed(0)+" B"},{title:"最后修改时间",colKey:"lastModified",width:180,cell:(b,d)=>new Date(d.row.lastModified).toLocaleString()},{title:"操作",colKey:"action",width:100,cell:(b,d)=>a(K,{onClick:()=>q(d.row.file)},{default:()=>[T("下载")]})}]),v=m([]),C=De(()=>({border:"2px dashed #ccc",borderRadius:"6px",padding:"20px",textAlign:"center",cursor:"pointer",backgroundColor:h.value?"#f0f9ff":"#fff",transition:"background-color 0.2s ease"})),p=De(()=>_.value?`已选择：${_.value}`:h.value?"松开文件以上传":"拖拽文件到这里，或点击选择文件"),f=()=>{O.push({name:"problem-detail",params:{problemId:l.value}})},L=()=>{O.push({name:"manage-problem",params:{problemId:l.value}})},q=async b=>{const d=await Nn(l.value,b);if(d.code!==0){N(o,d.code);return}const V=document.createElement("a");V.href=d.data,V.target="_blank",V.click(),URL.revokeObjectURL(V.href)},I=async()=>{if(!z){ne(o,"请选择压缩包");return}r.value=!0,Hn(l.value,z).then(async b=>{b.code==0?(w.value.value=null,z=null,_.value="",u.value=!0,Et(o,"上传成功"),await k()):N(o,b.code)}).catch(b=>{console.log(b),o.$message.error({duration:3e3,content:"申请失败"})}).finally(()=>{r.value=!1})},g=()=>{var b;(b=w.value)==null||b.click()},x=b=>{const d=b.target.files[0];d&&(_.value=d.name,z=d)},c=b=>{h.value=!0},j=()=>{h.value=!1},$=b=>{b.preventDefault(),b.stopPropagation(),h.value=!1;const d=b.dataTransfer.files[0];if(d){_.value=d.name;const V=new DataTransfer;V.items.add(d),w.value.files=V.files,z=d}},k=async()=>{const b=await Kn(l.value);if(b.code!==0){N(o,b.code),await O.push({name:"problem"});return}const d=b.data.problem;y.value=at(d,{}),s.setTitle(d.title+" - "+s.getTitle),v.value=[],b.data.judges?b.data.judges.forEach(V=>{v.value.push({file:V.key,size:V.size,lastModified:V.last_modified})}):ne(o,"评测数据不存在"),u.value=!1};return ae(async()=>{if(Array.isArray(t.params.problemId)?l.value=t.params.problemId[0]:l.value=t.params.problemId,!l.value){ne(o,"题目不存在"),await O.push({name:"problem"});return}u.value=!0,await k()}),(b,d)=>{const V=Pe,A=he,P=K,S=_e,R=qe,B=Ee,H=ge,M=be;return D(),G(M,{loading:u.value},{default:n(()=>[a(H,null,{default:n(()=>[a(A,{span:7},{default:n(()=>[U("div",nl,[U("div",{id:"drop-zone",style:Tt(C.value),onClick:g,onDragenter:Ne(c,["prevent"]),onDragover:d[0]||(d[0]=Ne(()=>{},["prevent"])),onDragleave:Ne(j,["prevent"]),onDrop:$},[U("input",{ref_key:"fileInput",ref:w,type:"file",style:{display:"none"},onChange:x},null,544),T(" "+E(p.value),1)],36)]),a(V,{data:v.value,columns:i.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1}),a(A,{span:5},{default:n(()=>[U("div",ol,[U("div",ll,[a(S,null,{default:n(()=>[a(P,{onClick:I,theme:"danger",loading:r.value},{default:n(()=>d[1]||(d[1]=[T("上传")])),_:1},8,["loading"]),a(P,{onClick:L,theme:"warning"},{default:n(()=>d[2]||(d[2]=[T("编辑")])),_:1}),a(P,{onClick:f},{default:n(()=>d[3]||(d[3]=[T("查看")])),_:1})]),_:1})]),a(B,{layout:"vertical",bordered:!0},{default:n(()=>[a(R,{label:"标题"},{default:n(()=>{var Y;return[T(E((Y=y.value)==null?void 0:Y.title),1)]}),_:1}),a(R,{label:"创建时间"},{default:n(()=>{var Y;return[T(E((Y=y.value)==null?void 0:Y.insertTime),1)]}),_:1}),a(R,{label:"更新时间"},{default:n(()=>{var Y;return[T(E((Y=y.value)==null?void 0:Y.updateTime),1)]}),_:1}),a(R,{label:"判题方式"},{default:n(()=>{var Y;return[T(E((Y=y.value)==null?void 0:Y.judgeType),1)]}),_:1}),a(R,{label:"评测数据"},{default:n(()=>{var Y;return[T(E((Y=y.value)==null?void 0:Y.judgeMd5),1)]}),_:1}),a(R,{label:"上传用户"},{default:n(()=>{var Y;return[T(E((Y=y.value)==null?void 0:Y.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),rl=te(sl,[["__scopeId","data-v-17986e38"]]),ul={style:{display:"flex","align-items":"center"}},il={style:{color:"#409eff","margin-right":"20px"}},cl={class:"dida-login-footer"},dl=ee({__name:"UserForget",setup(e){const{globalProperties:t}=le(),o=ye(),s=m(!1),l=m(!1),u=m(!1),y=m("发送验证码");let z=null,w=-1;const _=m(!1),h=m(null),r=m(""),i=m({username:"",emailKey:"",password:"",confirmPassword:""}),C=m({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:x=>new Promise(c=>{const j=setTimeout(()=>{c(i.value.password===x),clearTimeout(j)})}),message:"两次密码不一致"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),p=()=>{ie(t,"重置成功")},f=async x=>{if(!u.value){s.value=!0,l.value=!0;try{const c=await _n(x,i.value.username);c.code===0?(ie(t,"验证码发送成功"),r.value=c.data,l.value=!1,u.value=!0,z=new Date,y.value="60秒后重发",w=setInterval(()=>{const $=Math.floor((new Date().getTime()-(z==null?void 0:z.getTime()))/1e3);$>60?(y.value="发送验证码",u.value=!1,clearInterval(w)):y.value=`${60-$}秒后重发`},1e3)):N(t,c.code)}catch(c){console.error("Send email key error",c),ne(t,"发送验证码失败")}finally{s.value=!1}}},L=async()=>{var $;if(_.value=!0,u.value||l.value)return;await ke();const x=document.getElementById("cf-confirm-div");x&&x.remove();const c=document.createElement("div");c.id="cf-confirm-div",c.setAttribute("data-theme","light"),($=h.value)==null||$.appendChild(c);const j=window;j.turnstile.ready(function(){j.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(k){_.value=!1,await f(k)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},q=m(()=>a(K,{onClick:L,disabled:u.value,loading:l.value,style:"width:120px"},{default:()=>[y.value]})),I=async()=>{s.value=!0;try{const x=await gn(i.value.username,i.value.password,i.value.emailKey);x.code===0?(ie(t,"密码修改成功"),t.$router.push({name:"login"})):N(t,x.code)}catch(x){console.error("Modify password error",x),ne(t,"修改密码失败")}finally{s.value=!1}},g=async({validateResult:x,firstError:c,e:j})=>{if(!s.value){if(j.preventDefault(),x!==!0){ne(t,c);return}r.value?await I():await L()}};return ae(()=>{if(o.isLogin()){t.$router.push({path:"/user"});return}}),we(()=>{}),(x,c)=>{const j=mt,$=Ie,k=ze,b=Lt,d=K,V=je,A=He,P=oe,S=Oe;return D(),W(Q,null,[a(P,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:n(()=>[a(j,{"max-line":1},{default:n(()=>c[6]||(c[6]=[U("span",null,"如果您未绑定邮箱或忘记用户名，可联系管理员寻求帮助",-1),U("span",null,"管理员邮箱：BoilTask@qq.com",-1)])),_:1}),a(V,{ref:"form",rules:C.value,data:i.value,colon:!0,onReset:p,onSubmit:g,class:"yj-login-form"},{default:n(()=>[a(k,{name:"username",label:"用户名"},{default:n(()=>[a($,{modelValue:i.value.username,"onUpdate:modelValue":c[0]||(c[0]=R=>i.value.username=R),clearable:"",placeholder:"请输入完整用户名"},null,8,["modelValue"])]),_:1}),r.value?(D(),W(Q,{key:0},[a(k,{name:"email",label:"发送邮箱"},{default:n(()=>[a(b,{append:q.value},{default:n(()=>[U("div",ul,[U("span",il,E(r.value),1)])]),_:1},8,["append"])]),_:1}),a(k,{name:"emailKey",label:"验证码"},{default:n(()=>[a($,{modelValue:i.value.emailKey,"onUpdate:modelValue":c[1]||(c[1]=R=>i.value.emailKey=R),clearable:"",placeholder:"请输入收到的验证码"},null,8,["modelValue"])]),_:1}),a(k,{name:"password",label:"新密码"},{default:n(()=>[a($,{modelValue:i.value.password,"onUpdate:modelValue":c[2]||(c[2]=R=>i.value.password=R),type:"password",clearable:"",placeholder:"新密码"},null,8,["modelValue"])]),_:1}),a(k,{name:"confirmPassword",label:"确认密码"},{default:n(()=>[a($,{modelValue:i.value.confirmPassword,"onUpdate:modelValue":c[3]||(c[3]=R=>i.value.confirmPassword=R),type:"password",clearable:"",placeholder:"请重复输入密码"},null,8,["modelValue"])]),_:1})],64)):ue("",!0),r.value?(D(),G(k,{key:1},{default:n(()=>[a(d,{theme:"primary",type:"submit",block:"",loading:s.value},{default:n(()=>c[7]||(c[7]=[T("修改密码")])),_:1},8,["loading"])]),_:1})):(D(),G(k,{key:2},{default:n(()=>[a(d,{theme:"primary",type:"submit",block:"",loading:s.value},{default:n(()=>c[8]||(c[8]=[T("重置密码")])),_:1},8,["loading"])]),_:1}))]),_:1},8,["rules","data"]),U("div",cl,[a(A,{onClick:c[4]||(c[4]=()=>{re(t).$router.push({name:"login"})})},{default:n(()=>c[9]||(c[9]=[T("返回登陆 ")])),_:1})])]),_:1}),a(S,{visible:_.value,"onUpdate:visible":c[5]||(c[5]=R=>_.value=R),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:n(()=>[U("div",{ref_key:"dialogContainer",ref:h,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),ml=te(dl,[["__scopeId","data-v-c3586c6f"]]),Wt=[{name:"problem-list",tab:"problem",sidebar:"problem-list",path:"",title:"问题列表",icon:"list",component:Wn},{name:"problem-detail",tab:"problem",sidebar:"problem-list",path:":problemId+",title:"问题详情",icon:"list",component:vt},{name:"problem-recommend",tab:"problem",sidebar:"problem-recommend",path:"recommend/:problemId*",title:"问题推荐",icon:"cpu",needLogin:!0,component:uo},{name:"judge-list",tab:"judge",sidebar:"judge-list",path:"",title:"评测列表",icon:"list",component:ht},{name:"judge-detail",tab:"judge",sidebar:"judge-list",path:":judgeId+",title:"评测详情",icon:"cpu",component:wt},{name:"contest-list",tab:"contest",sidebar:"contest-list",path:"",title:"比赛列表",icon:"list",component:kt},{name:"contest-recent",tab:"contest",sidebar:"contest-recent",path:"recent",title:"近期比赛",icon:"list",component:kt},{name:"contest-detail",tab:"contest-detail-tab",sidebar:"contest-detail",path:":contestId+",title:"比赛详情",icon:"cpu",component:ko},{name:"contest-problem-detail",tab:"contest-detail-tab",sidebar:"contest-problem-detail",path:":contestId+/problem/:problemIndex+",title:"问题详情",icon:"cpu",disableSidebar:!0,component:vt},{name:"contest-judge",tab:"contest-detail-tab",sidebar:"contest-judge",path:":contestId+/judge",title:"评测列表",icon:"list",component:ht},{name:"contest-judge-detail",tab:"contest-detail-tab",sidebar:"contest-judge-detail",path:":contestId+/judge/:judgeId+",title:"评测详情",icon:"cpu",component:wt,disableSidebar:!0},{name:"contest-rank",tab:"contest-detail-tab",sidebar:"contest-rank",path:":contestId+/rank",title:"比赛排名",icon:"list",component:Co},{name:"contest-discuss",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss",title:"比赛讨论",icon:"list",component:Xe},{name:"contest-discuss-detail",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss/:discussId+",title:"讨论详情",icon:"list",component:nt},{name:"discuss-list",tab:"discuss",sidebar:"discuss-list",path:"",title:"讨论列表",icon:"list",component:Xe},{name:"discuss-list-problem",tab:"discuss",sidebar:"discuss-list-problem",path:"problem",title:"问题讨论",icon:"list",component:Xe},{name:"discuss-list-judge",tab:"discuss",sidebar:"discuss-list-judge",path:"judge",title:"评测讨论",icon:"list",component:Xe},{name:"discuss-detail",tab:"discuss",sidebar:"discuss-list",path:":discussId+",title:"讨论详情",icon:"list",component:nt},{name:"rank-ac-all",tab:"rank",sidebar:"rank-ac-all",path:"ac",title:"AC排名",icon:"base-station",props:{type:"all"},component:Ge},{name:"rank-ac-problem",tab:"rank",sidebar:"rank-ac-problem",path:"ac/problem",title:"题量排名",icon:"base-station",props:{type:"problem"},component:Ge},{name:"rank-ac-problem-today",tab:"rank",sidebar:"rank-ac-problem-today",path:"ac/problem/today",title:"今日题量",icon:"base-station",props:{type:"problem-today"},component:Ge},{name:"rank-ac-problem-day7",tab:"rank",sidebar:"rank-ac-problem-day7",path:"ac/problem/day7",title:"7日题量",icon:"base-station",props:{type:"problem-day7"},component:Ge},{name:"rank-ac-problem-year",tab:"rank",sidebar:"rank-ac-problem-year",path:"ac/problem/year",title:"1年题量",icon:"base-station",props:{type:"problem-year"},component:Ge},{name:"tool-paste",tab:"tool",sidebar:"tool-paste",path:"paste",title:"码池",icon:"base-station",component:it},{name:"system-status",tab:"system",sidebar:"system-status",path:"",title:"运行状态",icon:"base-station",component:it},{name:"system-about",tab:"system",sidebar:"system-about",path:"about",title:"关于",icon:"base-station",props:{discussId:"52"},component:nt},{name:"manage-problem",tab:"manage",sidebar:"manage-problem",disableSidebar:!0,path:"problem/:problemId+",title:"问题编辑",icon:"list",component:al,auths:[Re.ManageProblem]},{name:"manage-problem-judge",tab:"manage",sidebar:"manage-problem-judge",disableSidebar:!0,path:"problem/:problemId+/judge",title:"评测数据",icon:"list",component:rl,auths:[Re.ManageProblem]},{name:"manage-judge",tab:"manage",path:"judge",sidebar:"manage-judge",title:"评测管理",icon:"list",auths:["i-manage-judge"],component:Xo},{name:"login-forget",tab:"login",path:"forget",title:"忘记密码",component:ml}],St=(e,t,o,s)=>{s.tab==o&&(s.disableSidebar&&t!=s.sidebar||s.sidebar==null||s.sidebar!=s.name||e.push({name:s.name,title:s.title,icon:s.icon,to:{name:s.name}}))},pl=(e,t)=>{const o=[];return Wt.forEach(s=>{if(qt(s)){const l=[];s.children.forEach(u=>{St(l,e,t,u)}),l.length>0&&o.push({title:s.title,children:l})}else St(o,e,t,s)}),o},Ct=(e,t)=>{const o=Pn(t.tab),s={name:t.name,path:"/"+t.path,meta:{title:t.title+" - "+o.title,tab:t.tab,sidebar:t.sidebar,showSidebar:o.showSidebar,needLogin:o.needLogin||t.needLogin,tabAuths:o.auths,auths:t.auths},props:t.props,component:t.component};o.disablePath||(s.path=o.path+s.path),e.push(s)},fl=e=>{Wt.forEach(t=>{qt(t)?t.children.forEach(o=>{Ct(e,o)}):Ct(e,t)})},_l={class:"sh-main"},gl=ee({__name:"View403",setup(e){let t=ce();const o=m("");return ae(()=>{t.query.target?o.value=t.query.target:o.value=t.fullPath}),(s,l)=>{const u=K;return D(),W("div",_l,[U("p",null,E(o.value),1),l[2]||(l[2]=U("p",null,"该页面无访问权限，请更换访问目标或重新登陆后再试",-1)),a(u,{theme:"primary",onClick:l[0]||(l[0]=()=>s.$router.push("/"))},{default:n(()=>l[1]||(l[1]=[T("返回首页")])),_:1})])}}}),Xt=te(gl,[["__scopeId","data-v-8f62f1f8"]]),Je=[];xn(Je);fl(Je);Je.push({path:"/403",name:"403",component:Xt});Je.push({path:"/:pathMatch(.*)*",name:"404",component:Ut});const O=la({history:sa("/"),routes:Je});O.beforeEach((e,t,o)=>{if(e.name==null||!O.hasRoute(e.name)){o({name:"home"});return}const s=e.matched[e.matched.length-1].meta;if(s.redirect){o({name:s.redirect});return}if(s.needLogin){const u=ye();if(u.getToken==null||u.getToken==""){o({name:"login",query:{redirect_uri:e.fullPath}});return}}const l=s.tabAuths;if(l&&!ye().hasAllAuths(l)){o({name:"403",query:{target:e.fullPath}});return}o()});O.afterEach((e,t)=>{if(e.name===t.name)return;const o=tt(),s=$e();let l=null;if(e.matched.length>0&&(l=e.matched[e.matched.length-1].meta),l!=null&&l.title&&s.setTitle(l==null?void 0:l.title),l!=null&&l.showSidebar){o.setSidebarShow(!0);const u=pl(l==null?void 0:l.sidebar,l==null?void 0:l.tab);o.setMenuList(u),o.setMenuActiveName(l==null?void 0:l.sidebar)}else o.setSidebarShow(!1)});const Yt=et("login",{state:()=>({Loaded:!1}),getters:{isLoaded(){return this.Loaded}}}),vl=ee({__name:"HeaderContent",setup(e){const t=Yt(),o=ye(),{globalProperties:s}=le(),l=m(t.isLoaded),u=m(!1),y=m(o.getUsername),z=m(o.getNickname),w=m(),_=()=>{w.value=Tn(o)};t.$subscribe((i,v)=>{l.value=v.Loaded}),o.$subscribe((i,v)=>{y.value=v.username,z.value=v.nickname,u.value=v.token!="",_()});const h=()=>{s.$router.currentRoute.value.name!=="login"&&s.$router.push({name:"login",query:{redirect_uri:s.$router.currentRoute.value.fullPath}})},r=()=>{o.clear(),s.$message.success({duration:3e3,content:"注销成功"}),s.$router.push({path:"/login",query:{redirect_uri:s.$router.currentRoute.value.fullPath}})};return ae(()=>{_()}),(i,v)=>{const C=xt("router-link"),p=Rt,f=Dt,L=xa,q=La;return D(),G(q,{modelValue:i.$route.meta.tab,"onUpdate:modelValue":v[0]||(v[0]=I=>i.$route.meta.tab=I),class:"sh-menu","expand-type":"popup"},{logo:n(()=>[a(C,{to:"/",class:"sh-logo"},{default:n(()=>v[1]||(v[1]=[T("DidaOJ")])),_:1})]),operations:n(()=>[l.value&&u.value?(D(),G(L,{key:0,title:z.value},{icon:n(()=>[a(p,{name:"user"})]),default:n(()=>[a(f,{value:"user",to:{path:"/user/"+y.value}},{default:n(()=>v[2]||(v[2]=[T("个人空间")])),_:1},8,["to"]),a(f,{value:"user_logout",onClick:r},{default:n(()=>v[3]||(v[3]=[T(" 注销")])),_:1})]),_:1},8,["title"])):l.value?(D(),G(f,{key:2,value:"login",onClick:h},{icon:n(()=>[a(p,{name:"login"})]),default:n(()=>[v[5]||(v[5]=T(" 登录 "))]),_:1})):(D(),G(f,{key:1,value:"login"},{icon:n(()=>[a(p,{name:"login"})]),default:n(()=>[v[4]||(v[4]=T(" ... "))]),_:1}))]),default:n(()=>[(D(!0),W(Q,null,pe(w.value,I=>(D(),G(f,{key:I.name,value:I.name,to:{name:I.name}},{icon:n(()=>[I.icon?(D(),G(p,{key:0,name:I.icon},null,8,["name"])):ue("",!0)]),default:n(()=>[T(" "+E(I.title),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])}}}),bl=te(vl,[["__scopeId","data-v-c64d812f"]]),hl={id:"menu-container"},yl=ee({__name:"SidebarContent",setup(e){const t=tt(),o=m(!1),s=m(null),l=m(t.menuActiveName),u=m(t.menuList),y=m([]),z=m(!1),w=()=>{l.value=t.menuActiveName;const h=JSON.stringify(u.value),r=JSON.stringify(t.menuList);h!==r&&(y.value.push([...t.menuList]),_())},_=async()=>{if(y.value.length>0&&!z.value){for(z.value=!0;y.value.length>1;)y.value.shift();const h=y.value.shift();o.value=h.length<=0,u.value=[],await ke(),s.value&&s.value.updateActiveName(),await new Promise(i=>setTimeout(i,300)),u.value=h,await ke(),s.value&&s.value.updateActiveName();const r=300;await new Promise(i=>setTimeout(i,r)),z.value=!1,await _()}};return t.$subscribe((h,r)=>{w()}),ae(()=>{w()}),(h,r)=>{const i=Rt,v=Dt,C=za,p=ja,f=be;return D(),W(Q,null,[U("div",hl,[a(p,{modelValue:l.value,"onUpdate:modelValue":r[0]||(r[0]=L=>l.value=L),theme:"light",class:"sh-menu-container"},{default:n(()=>[a(ra,{name:"move-left"},{default:n(()=>[(D(!0),W(Q,null,pe(u.value,(L,q)=>(D(),W(Q,{key:q},[re(Ln)(L)?(D(),G(C,{key:0,title:L.title},{default:n(()=>[(D(!0),W(Q,null,pe(L.children,(I,g)=>(D(),G(v,{key:I.name,value:I.name,to:I.to},rt({default:n(()=>[T(" "+E(I.title),1)]),_:2},[I.icon?{name:"icon",fn:n(()=>[a(i,{name:I.icon,class:ut(I.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))),128))]),_:2},1032,["title"])):(D(),G(v,{key:L.name,value:L.name,to:L.to},rt({default:n(()=>[T(" "+E(L.title),1)]),_:2},[L.icon?{name:"icon",fn:n(()=>[a(i,{name:L.icon,class:ut(L.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),a(f,{size:"small",loading:o.value,"show-overlay":!0,attach:"#menu-container",class:"sh-sidebar-loading",style:{"align-items":"flex-start","padding-top":"100px"}},null,8,["loading"])],64)}}}),wl=te(yl,[["__scopeId","data-v-96e2d89f"]]),kl={};function Sl(e,t){return null}const Cl=te(kl,[["render",Sl]]),Il={class:"footer"},Pl={class:"footer-left"},Tl={class:"foot-time"},xl={class:"footer-center"},Ll={href:"https://beiancx.miit.gov.cn/",target:"_blank"},jl={class:"footer-right"},zl={class:"foot-text"},$l={href:"https://github.com/hpu-developer/DiDaOJ-web",target:"_blank"},Vl={class:"foot-text"},Dl={href:"https://github.com/hpu-developer/DiDaOJ-go",target:"_blank"},Rl=ee({__name:"FooterContent",setup(e){const t=m("");function o(){t.value=new Date().toLocaleString()}return ae(()=>{o(),setInterval(()=>{o()},1e3)}),(s,l)=>{const u=K;return D(),W("div",Il,[U("div",Pl,[U("p",Tl,E(t.value),1)]),U("div",xl,[U("a",Ll,[a(u,{theme:"default",variant:"outline",ghost:!0},{default:n(()=>l[0]||(l[0]=[T("豫ICP备15024677号-4")])),_:1})])]),U("div",jl,[U("p",zl,[U("a",$l,[a(u,{theme:"default",variant:"outline",ghost:!0},{default:n(()=>l[1]||(l[1]=[T("@didaoj-web")])),_:1})])]),U("p",Vl,[U("a",Dl,[a(u,{theme:"default",variant:"outline",ghost:!0},{default:n(()=>l[2]||(l[2]=[T("@didaoj-go")])),_:1})])])])])}}}),Al=te(Rl,[["__scopeId","data-v-979fed79"]]),Ye=20,lt=100,st=50,Ul=ee({__name:"ForceHiddenSidebarButton",setup(e){let t=tt();const o=m({x:window.innerWidth-lt-Ye,y:window.innerHeight-st-Ye}),s=m(window.innerWidth),l=m(window.innerHeight);let u=!1,y={x:0,y:0};const z=L=>{u=!0;const q=L.clientX??L.touches[0].clientX,I=L.clientY??L.touches[0].clientY;y={x:q-o.value.x,y:I-o.value.y},document.addEventListener("mousemove",w),document.addEventListener("touchmove",w),document.addEventListener("mouseup",_),document.addEventListener("touchend",_)},w=L=>{if(!u)return;const q=L.clientX??L.touches[0].clientX,I=L.clientY??L.touches[0].clientY;let g=q-y.x,x=I-y.y;g=Math.max(0,Math.min(g,s.value-lt)),x=Math.max(0,Math.min(x,l.value-st)),o.value={x:g,y:x}},_=()=>{u=!1,document.removeEventListener("mousemove",w),document.removeEventListener("touchmove",w),document.removeEventListener("mouseup",_),document.removeEventListener("touchend",_)},h=()=>{s.value=window.innerWidth,l.value=window.innerHeight,o.value={x:Math.min(o.value.x,s.value-lt-Ye),y:Math.min(o.value.y,l.value-st-Ye)}};let r=m(t.forceHiddenSidebar),i=m(t.forceHiddenSidebar);const v=()=>{r.value=!r.value,t.setForceHiddenSidebar(r.value)},C=()=>{i.value||(i.value=!0,t.setForceHiddenSidebar(r.value))},p=()=>{i.value&&(i.value=!1,t.setForceHiddenSidebar(!1))},f=L=>{L>=800?p():C()};return f(s.value),Le(s,L=>{f(L)}),ae(()=>{window.addEventListener("resize",h)}),we(()=>{window.removeEventListener("resize",h)}),(L,q)=>{const I=K;return re(i)?(D(),G(I,{key:0,class:"draggable-button",style:Tt({top:`${o.value.y}px`,left:`${o.value.x}px`}),onMousedown:z,onTouchstart:z,variant:"dashed",theme:"primary",onClick:v},{default:n(()=>[T(E(re(r)?"显示":"隐藏"),1)]),_:1},8,["style"])):ue("",!0)}}}),El=te(Ul,[["__scopeId","data-v-1aee5506"]]),Ze="DidaOJ",ql=ee({__name:"App",setup(e){const{globalProperties:t}=le(),o=Yt(),s=ye(),l=$e(),u=tt();o.$patch({Loaded:!1});const y=s.getToken,z=m(!1),w=m(!1);l.title&&l.title.length>0?document.title=l.title+" - "+Ze:document.title=Ze,l.$subscribe((i,v)=>{v.title&&v.title.length>0?document.title=v.title+" - "+Ze:document.title=Ze}),u.$subscribe((i,v)=>{z.value=v.showSidebar,w.value=z.value&&!v.forceHiddenSidebar});const _=ce(),h=De(()=>{const i=_.meta.auths;return i?!s.hasAllAuths(i):!1});function r(){t.$message.warning({duration:3e3,content:"登陆状态失效"}),o.$patch({Loaded:!0}),s.clear()}return ae(()=>{if(y==""){o.$patch({Loaded:!0});return}dn().then(i=>{i.code==0?(s.loadResponse(i.data),o.$patch({Loaded:!0})):(N(t,i.code),o.$patch({Loaded:!0}),s.clear())}).catch(i=>{console.log(i),r()})}),(i,v)=>{const C=$a,p=Da,f=xt("RouterView"),L=Ra,q=Va,I=Aa;return D(),W(Q,null,[a(q,null,{default:n(()=>[a(C,{class:"sh-header"},{default:n(()=>[a(bl)]),_:1}),a(q,null,{default:n(()=>[a(ua,{name:"slide"},{default:n(()=>[w.value?(D(),G(p,{key:0,class:"sh-sidebar"},{default:n(()=>[a(wl)]),_:1})):ue("",!0)]),_:1}),a(q,{class:ut(["sh-main-layout",{expanded:!w.value}])},{default:n(()=>[a(Cl),a(L,{class:"sh-main-content"},{default:n(()=>[h.value?(D(),G(Xt,{key:0})):(D(),G(f,{key:1}))]),_:1}),a(Al)]),_:1},8,["class"])]),_:1})]),_:1}),z.value?(D(),G(El,{key:0})):ue("",!0),a(I,{container:"body",offset:["24px","80px"],size:"small"})],64)}}}),Ml=te(ql,[["__scopeId","data-v-9e122cb4"]]);Ea.registerLanguage("verilog",qa);const Zt=ia();Zt.use(ca);const We=da(Ml);We.use(Zt);We.use(O);We.use(Ua);We.use(ma);We.mount("#app");on().then(()=>{console.log("Text cache reinitialized")}).catch(e=>{console.error("Text cache reinitialization failed",e)});
