import{ct as pt,d as de,a as p,o as fe,cu as M,cv as D,cw as a,e as t,cx as U,cy as q,bE as x,cz as _a,aM as Na,cA as Re,cB as le,cC as ae,F as pe,cD as Pe,cE as Ha,cF as Se,bS as ve,cG as Ba,cH as Ja,cI as Wa,b as De,v as mt,cJ as Ya,cK as Xe,j as Be,w as $e,a9 as tt,bc as Xa,bd as Za,cL as Qa,cM as el,cN as tl,br as al,cO as Dt,cP as ga,cQ as ba,cj as ll,cR as nl,cS as ol,cT as sl,bX as rl,cU as Zt,cV as Et,cW as ul,bf as il,aY as ha,z as dl,cX as cl,cY as ml,cZ as pl,c_ as Lt}from"./node_modules-DOFHNO3z.js";import{L as Te,C as he,R as Ie,a as Ve,A as Ct,S as fl,b as vl,c as _l,d as gl,e as bl,f as lt,T as et,B as G,F as Ue,g as ze,I as Ae,D as nt,h as ya,i as we,j as Je,k as We,l as hl,m as Ee,n as ft,o as vt,P as qt,O as Kt,p as Ft,q as yl,r as wa,s as wl,t as kl,u as ka,v as Sa,w as It,x as Sl,y as Cl,z as Il,E as Pl,G as xl,H as Vl,J as Tl,M as Ca,K as Ia,N as Dl,Q as Ll,U as jl,V as $l,W as Ul,X as zl,Y as Al,Z as Rl,_ as El,$ as Ml}from"./tdesign-vue-next-C58KpEaq.js";import{u as _e,S as ge,a as ke,b as F,G as Ne,H as it,c as Ke,d as Pa,e as ql,f as Kl,g as Fl,E as Ol,M as Gl,R as Nl}from"./md-editor-v3-BA5CYRuO.js";import{e as Qt}from"./monaco-editor-ouHSYV7a.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))u(o);new MutationObserver(o=>{for(const y of o)if(y.type==="childList")for(const v of y.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&u(v)}).observe(document,{childList:!0,subtree:!0});function n(o){const y={};return o.integrity&&(y.integrity=o.integrity),o.referrerPolicy&&(y.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?y.credentials="include":o.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function u(o){if(o.ep)return;o.ep=!0;const y=n(o);fetch(o.href,y)}})();var je=(e=>(e.ManageWeb="i-manage-web",e.ManageJudge="i-manage-judge",e.ManageProblem="i-manage-problem",e.ManageProblemDaily="i-manage-problem-daily",e.ManageContest="i-manage-contest",e.ManageCollection="i-manage-collection",e.ManageDiscuss="i-manage-discuss",e))(je||{});const Hl={"r-admin":["i-manage-web","i-manage-judge","i-manage-problem","i-manage-problem-daily","i-manage-contest","i-manage-collection","i-manage-discuss"]};function Bl(e){if(e==null)return[];const l=[];for(const n of e){const u=Hl[n];u!=null&&l.push(...u)}return[...new Set(l)]}function Jl(e,l){if(e==null||l==null)return!1;const n=Bl(e);for(const u of l)if(!n.includes(u))return!1;return!0}const Fe=pt("user",{state:()=>({token:"",userId:-1,username:"",nickname:"",roles:[]}),getters:{getToken(){return this.token},getUserId(){return this.userId},getUsername(){return this.username},getNickname(){return this.nickname}},actions:{clear(){this.$patch({token:"",userId:-1,username:"",nickname:"",roles:[]})},loadResponse(e){this.$patch({token:e.token,userId:e.user_id,username:e.username,nickname:e.nickname,roles:e.roles})},isLogin(){return this.token!=null&&this.token!=""},hasAuth(e){return this.hasAllAuths([e])},hasAllAuths(e){return e?Jl(this.roles,e):!0}},persist:!0}),Ze=pt("webStyle",{state:()=>({title:""}),getters:{getTitle(){return this.title}},actions:{setTitle(e){this.title=e}}}),Pt=pt("sidebarStyle",{state:()=>({showSidebar:!1,forceHiddenSidebar:!1,menuActiveName:"",menuList:[]}),getters:{getMenuList(){return this.menuList}},actions:{setSidebarShow(e){this.showSidebar=e},setForceHiddenSidebar(e){this.forceHiddenSidebar=e},setMenuActiveName(e){this.menuActiveName=e},clearMenuList(){this.menuList=[]},setMenuList(e){this.menuList=e},addMenuList(e){this.menuList.push(e)}}}),Wl={style:{"text-align":"right"}},Yl=de({__name:"Hitokoto",setup(e){const l=p(!1),n=p(""),u=p(""),o=p(""),y=async()=>{l.value=!0;try{const k=await(await fetch("https://v1.hitokoto.cn")).json();u.value=k.hitokoto,o.value=k.creator,n.value="—— "+k.from}catch(v){u.value="一言获取失败了，但至少您还可以访问本站。",o.value="BoilTask",n.value="DidaOJ",console.error("Error fetching Hitokoto:",v)}finally{l.value=!1}};return fe(()=>{y()}),(v,k)=>{const f=he,s=Te;return D(),M(s,{loading:l.value},{default:a(()=>[t(f,{title:"一言 © Hitokoto"},{actions:a(()=>[x(" @"+q(o.value),1)]),default:a(()=>[U("div",null,[U("span",null,q(u.value),1),U("p",Wl,q(n.value),1)])]),_:1})]),_:1},8,["loading"])}}}),Xl="https://oj-api.didapipa.com/",N=_a.create({baseURL:Xl,timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});N.interceptors.request.use(e=>{const n=Fe().getToken;return n&&(e.headers["X-Token"]=n),e},e=>Promise.reject(e));N.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});const xt=_a.create({timeout:6e4,withCredentials:!1,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});xt.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function xa(){return xt({baseURL:"https://r2-oj.didapipa.com",url:"/system/notification.json?"+Date.now(),method:"get"})}function Va(){return xt({baseURL:"https://r2-oj.didapipa.com",url:"/system/announcement.json?"+Date.now(),method:"get"})}function Zl(){return N({url:"/system/status",method:"get"})}function Ql(){return N({url:"/system/image/token",method:"get"})}function en(e,l){return N({url:"/system/notification",method:"post",data:{theme:e,content:l}})}function tn(e,l){return N({url:"/system/announcement",method:"post",data:{title:e,content:l}})}var Vt=(e=>(e[e.Unknown=-1]="Unknown",e[e.C=0]="C",e[e.Cpp=1]="Cpp",e[e.Java=2]="Java",e[e.Python=3]="Python",e[e.Pascal=4]="Pascal",e[e.Golang=5]="Golang",e[e.Lua=6]="Lua",e[e.TypeScript=7]="TypeScript",e[e.Max=8]="Max",e))(Vt||{});function Ot(){const e=[-1,8];return Object.values(Vt).filter(l=>typeof l=="number"&&!e.includes(l)).map(l=>({value:l,label:kt(l)}))}function yt(e){return e>-1&&e<8}function kt(e){switch(e){case 0:return"C";case 1:return"C++";case 2:return"Java";case 3:return"Python";case 4:return"Pascal";case 5:return"Golang";case 6:return"Lua";case 7:return"TypeScript";default:return"未知"}}function Gt(e){switch(e){case 0:return"c";case 1:return"cpp";case 2:return"java";case 3:return"python";case 4:return"pascal";case 5:return"go";case 6:return"lua";case 7:return"typescript";default:return"text"}}var He=(e=>(e[e.Init=0]="Init",e[e.Rejudge=1]="Rejudge",e[e.Submitting=2]="Submitting",e[e.Queuing=3]="Queuing",e[e.Compiling=4]="Compiling",e[e.Running=5]="Running",e[e.Accept=6]="Accept",e[e.PE=7]="PE",e[e.WA=8]="WA",e[e.TLE=9]="TLE",e[e.MLE=10]="MLE",e[e.OLE=11]="OLE",e[e.RE=12]="RE",e[e.CE=13]="CE",e[e.CLE=14]="CLE",e[e.JudgeFail=15]="JudgeFail",e[e.SubmitFail=16]="SubmitFail",e[e.Unknown=17]="Unknown",e[e.Max=18]="Max",e))(He||{});const an=e=>{switch(e){case 0:return"普通评测";case 1:return"特殊评测";default:return"未知"}},St=e=>{switch(e){case 0:return"等待处理";case 1:return"重新评测";case 2:return"提交中";case 3:return"队列中";case 4:return"编译中";case 5:return"运行中";case 6:return"通过";case 7:return"格式错误";case 8:return"答案错误";case 9:return"超时";case 10:return"内存超限";case 11:return"输出超限";case 12:return"运行错误";case 13:return"编译错误";case 14:return"编译超限";case 15:return"评测失败";case 16:return"提交失败";case 17:return"未知";default:return e}},ea=e=>{if(e!==void 0)switch(e){case 0:return"已经提交到系统，请耐心等待评测结果";case 1:return"管理员发起了重新评测，请耐心等待评测结果";case 2:return"判题机已经接受了本次提交，正在提交到远程判官中";case 3:return"判题机已经接受了本次提交，正在排队等待评测";case 4:return"判题机正在编译您的代码，部分语言会在此步检查是否符合语法";case 5:return"您的代码正在运行，请等待运行结果";case 6:return"您的代码通过了测试用例，恭喜您！";case 7:return"您的代码基本正确，但可能存在空格、空行等格式错误，请认真对比输出要求";case 8:return"您的答案与标准答案存在区别，请继续思考有无未考虑的情况";case 9:return"运行您的代码所用的时间超过了题目限制，请思考时间上更优的解法";case 10:return"运行您的代码所用的内存超过了题目限制，请思考空间上更优的解法";case 11:return"您程序的输出内容远远多于了题目要求（一般是数倍于正确输出），请检查相关逻辑";case 12:return"在运行您程序的过程中发生了异常，可能是除零、数组越界等问题，请检查相关逻辑";case 13:return"您的代码在编译阶段发生了错误，可能是语法错误或其他编译问题，请检查相关逻辑";case 14:return"在编译您代码的过程中，所占用的资源远远超过了要求，请检查相关逻辑";case 15:return"评测过程中发生了异常，一般是判题机或远程判官的问题，可尝试联系管理员处理";case 16:return"在将您的代码提交到远程判官的过程中发生了错误，一般是判题机或远程判官的问题，可联系管理员处理";case 17:return"您的代码状态未知，有可能是您不具有权限，或者该代码状态被隐藏"}return"暂时无提示信息"},Ta=e=>{switch(e){case 0:case 1:case 2:case 3:case 4:case 5:case 17:return"default";case 6:return"success";case 7:return"warning";default:return"danger"}};function Da(){const e=[17,18];return Object.values(He).filter(l=>typeof l=="number"&&!e.includes(l)).map(l=>({value:l,label:St(l)}))}function wt(e){return e>=0&&e<17}function ut(e){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return!0;default:return!1}}function La(e){var n;const l={};if(l.id=e.id,l.problemId=e.problem_id,l.contestProblemIndex=e.contest_problem_index,l.status=e.status,ut(e.status)||!wt(e.status)?l.score="-":l.score=(e.score/10).toString(),e.time?l.time=Math.ceil(e.time/1e6)+"ms":l.time="-",e.memory?l.memory=(e.memory/1024/1024).toFixed(2)+"MB":l.memory="-",l.language=e.language,l.codeLength=e.code_length,e.approve_time?l.approveTime=new Date(e.approve_time).toLocaleString():l.approveTime="-",l.author=e.author,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.code=e.code,l.compileMessage=e.compile_message,l.taskCurrent=e.task_current,l.taskTotal=e.task_total,l.task=[],e.task)for(let u=0;u<((n=e.task)==null?void 0:n.length);u++){const o=e.task[u],y={};y.taskId=o.task_id,y.status=o.status,o.time?y.time=Math.ceil(o.time/1e6)+"ms":y.time="-",o.memory?y.memory=(o.memory/1024/1024).toFixed(2)+"MB":y.memory="-",y.score=o.score,y.content=o.content,y.waHint=o.wa_hint,l.task.push(y)}return e.judger&&(l.judger=e.judger),e.judger_name?l.judgerName=e.judger_name:l.judgerName="-",e.judge_time&&(l.judgeTime=new Date(e.judge_time).toLocaleString()),l}function ln(e,l,n,u,o){return N({url:"/judge/approve",method:"post",data:{problem_id:e,contest_id:l,problem_index:n,language:u,code:o}})}function nn(e){return N({url:"/judge?id="+e,method:"get"})}function on(e){return N({url:"/judge/code?id="+e,method:"get"})}function sn(e,l,n,u,o,y,v){let k={problem_id:l,username:n,language:String(u),status:String(o),page:String(y),page_size:String(v)};return e&&(k.contest_id=String(e)),N({url:`/judge/list?${new URLSearchParams(k).toString()}`,method:"get"})}function rn(){return N({url:"/judge/statics/recently",method:"get"})}function un(){return N({url:"/judge/rejudge/recently",method:"post"})}function dn(e,l,n){const u={};return e!=null&&(u.problem_id=e),l!=null?u.language=l:u.language=Vt.Unknown,n!=null?u.status=n:u.status=18,N({url:"/judge/rejudge/search",method:"post",data:u})}function cn(){return N({url:"/judge/rejudge/all",method:"post",timeout:0})}function mn(e){return N({url:"/judge/rejudge",method:"post",data:{id:Number(e)}})}var Oe=(e=>(e[e.None=0]="None",e[e.Attempt=1]="Attempt",e[e.Accept=2]="Accept",e))(Oe||{});function _t(e,l){const n={};if(n.id=e.id,n.author=e.author,n.title=e.title,n.tags=[],e.tags)for(const u of e.tags){const o=l[u];o&&n.tags.push(o)}if(n.private=e.private,n.accept=e.accept,n.attempt=e.attempt,e.description!=null&&(n.description=e.description),e.time_limit!=null&&e.time_limit>=0?n.timeLimit=e.time_limit.toString()+" ms":n.timeLimit="未知",e.memory_limit!=null&&e.memory_limit>=0?n.memoryLimit=(e.memory_limit/1024).toFixed(2)+" MB":n.memoryLimit="未知",e.judge_type!=null&&(n.judgeType=an(e.judge_type)),e.insert_time!=null&&(n.insertTime=new Date(e.insert_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.source!=null){const u=/\[([^\]]+)\]\(([^)]+)\)/,o=e.source.match(u);o?(n.source=o[1],n.sourceUrl=o[2]):(n.source=e.source,n.sourceUrl="")}return e.judge_md5!=null&&(n.judgeMd5=e.judge_md5),e.origin_oj!=null&&(n.originOj=e.origin_oj),e.origin_id!=null&&(n.originId=e.origin_id),e.origin_url!=null&&(n.originUrl=e.origin_url),n}function ja(e,l){const n={};if(n.id=e.id,n.problemId=e.problem_id,n.title=e.title,n.tags=[],e.tags)for(const u of e.tags){const o=l[u];o&&n.tags.push(o)}return e.accept?n.accept=e.accept:n.accept=0,e.attempt?n.attempt=e.attempt:n.attempt=0,n.solution=e.solution,n.code=e.code,e.create_time!=null&&(n.createTime=new Date(e.create_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.updater_nickname!=null&&(n.updaterNickname=e.updater_nickname),n}function $a(e,l,n){const u={};return e?u.id=e:(u.contest_id=l,u.problem_index=n),N({url:`/problem?${new URLSearchParams(u).toString()}`,method:"get"})}function Ua(e){return N({url:"/problem/tag/list?max_count="+e,method:"get"})}function pn(e){return N({url:"/problem/judge?id="+e,method:"get"})}function fn(e,l,n,u,o,y){const v={};return e&&(v.oj=e),l&&(v.title=l),n&&(v.tag=n),u!==void 0&&(v.private=u?"1":"0"),o&&(v.page=o),y&&(v.page_size=y),N({url:`/problem/list?${new URLSearchParams(v).toString()}`,method:"get"})}function vn(e){const l={};return e&&(l.problem_id=e),N({url:`/problem/recommend?${new URLSearchParams(l).toString()}`,method:"get"})}function _n(e){return N({url:"/problem/daily?id="+e,method:"get"})}function gn(e){return N({url:"/problem/daily/edit?id="+e,method:"get"})}function bn(){return N({url:"/problem/daily/recently",method:"get"})}function hn(e,l,n,u,o){const y={};return e&&(y.start_date=e),l&&(y.end_date=l),n&&(y.problem_id=n),u&&(y.page=u),o&&(y.page_size=o),N({url:`/problem/daily/list?${new URLSearchParams(y).toString()}`,method:"get"})}function yn(e){return N({url:"/problem/attempt/status",method:"get",params:{ids:e.join(",")}})}function za(e,l){return N({url:"/problem/crawl",method:"post",data:{oj:e,id:l}})}function wn(e,l,n,u,o,y,v){return N({url:"/problem/create",method:"post",data:{title:e,time_limit:l,memory_limit:n,source:u,private:o,tags:y,description:v}})}function kn(e,l,n,u,o,y,v,k){return N({url:"/problem/edit",method:"post",data:{id:e,title:l,time_limit:n,memory_limit:u,source:o,private:y,tags:v,description:k}})}function Sn(e,l,n,u){return N({url:"/problem/daily/create",method:"post",data:{id:e,problem_id:l,solution:n,code:u}})}function Cn(e,l,n,u){return N({url:"/problem/daily/edit",method:"post",data:{id:e,problem_id:l,solution:n,code:u}})}function In(e,l){return N({url:"/problem/judge/data/download?id="+e+"&key="+l,method:"get"})}function Pn(e){return e||(e=""),N({url:"/problem/image/token?id="+e,method:"get"})}function xn(e){return e||(e=""),N({url:"/problem/daily/image/token?id="+e,method:"get"})}function Vn(e,l){const n=new FormData;return n.append("id",e),n.append("zip",l),N({url:"/problem/judge/data",method:"post",data:n,headers:{"Content-Type":"multipart/form-data"},timeout:1e3*60*5})}function Tn(e){return N({url:"/problem/parse",method:"post",data:{problems:e}})}const Dn={class:"sh-main"},Ln={class:"dida-swiper-div"},jn=de({__name:"HomeView",setup(e){const{globalProperties:l}=_e();let n=-1;const u=p({theme:"info",content:""}),o=p({title:"",content:""}),y=p([]),v=p(!1),k=p(!1),f=p(!1),s=async()=>{u.value=await xa()},V=async()=>{try{const g=await Va();o.value.title=g.title,o.value.content=g.content}catch{ge(l,"加载公告失败"),o.value={title:"公告加载失败",content:"请刷新页面重新获取"}}},c=async()=>{const g=await rn();if(g.code!==0){ge(l,"加载OJ统计数据失败");return}let _=[];for(const h of g.data){const b=new Date(h.date),i=`${b.getMonth()+1}-${b.getDate()}`;_.push({Date:i,Type:"Unaccept",Count:h.attempt-h.accept}),_.push({Date:i,Type:"Accept",Count:h.accept})}const m={type:"bar",data:[{id:"barData",values:_}],xField:"Date",yField:"Count",seriesField:"Type",stack:!0,legends:{visible:!0},bar:{state:{hover:{stroke:"#000",lineWidth:1}}},height:300};new Ha(m,{dom:"ojStaticsDiv"}).renderSync()},P=async()=>{y.value=[];const g=await bn();if(g.code!==0){ge(l,"加载每日问题数据失败");return}g.data.list&&g.data.list.length>0&&g.data.list.forEach(_=>{let m="default",d="未尝试";if(g.data.attempt_status){const b=g.data.attempt_status[_.problem_id];if(b)switch(b){case Oe.Accept:m="success",d="已解决";break;case Oe.Attempt:m="warning",d="待解决";break;default:m="default",d="未尝试"}}const h=`${_.title}`;y.value.push({id:_.id,title:h,problemId:_.problem_id,theme:m,tag:d})})};return fe(async()=>{f.value=!0,v.value=!0,k.value=!0,(async()=>(await s(),n=setInterval(()=>{s()},3e4),await V(),f.value=!1))(),(async()=>(await c(),v.value=!1))(),(async()=>(await P(),k.value=!1))()}),Na(()=>{clearInterval(n)}),(g,_)=>{const m=Ct,d=vl,h=fl,b=Te,i=Re("md-preview"),r=he,R=Ve,I=lt,w=bl,$=et,S=gl,T=_l,z=Ie;return D(),M(b,{loading:f.value},{default:a(()=>[t(z,null,{default:a(()=>[t(R,{span:8},{default:a(()=>{var A;return[U("div",Dn,[u.value?(D(),M(m,{key:0,class:"dida-notification-div",theme:u.value.theme},{default:a(()=>[x(q(u.value.content),1)]),_:1},8,["theme"])):le("",!0),U("div",Ln,[t(h,{class:"dida-swiper"},{default:a(()=>[t(d,null,{default:a(()=>_[1]||(_[1]=[U("a",{href:"http://codeoj.cn",target:"_blank"},[U("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"})],-1)])),_:1}),t(d,null,{default:a(()=>_[2]||(_[2]=[U("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1})]),_:1})]),t(b,{loading:v.value&&!f.value},{default:a(()=>_[3]||(_[3]=[U("div",{id:"ojStaticsDiv",style:{"min-height":"200px"}},null,-1)])),_:1},8,["loading"]),t(r,{title:(A=o.value)==null?void 0:A.title,style:{width:"calc(100% - 100px)",margin:"0 auto"}},{default:a(()=>{var L;return[t(i,{"model-value":(L=o.value)==null?void 0:L.content,previewTheme:"cyanosis"},null,8,["model-value"])]}),_:1},8,["title"])])]}),_:1}),t(R,{span:4},{default:a(()=>[t(r,{style:{margin:"10px"},bordered:!0},{default:a(()=>_[4]||(_[4]=[U("img",{src:"https://api.jysafe.cn/ip/",alt:"Welcome",style:{width:"100%"}},null,-1)])),_:1}),t(Yl,{style:{margin:"10px"}}),t(r,{style:{margin:"10px"},bordered:!0,title:"每日一题"},{actions:a(()=>[t(I,{onClick:_[0]||(_[0]=A=>g.$router.push({name:"problem-daily-list"}))},{default:a(()=>_[5]||(_[5]=[x("查看全部")])),_:1})]),default:a(()=>[t(b,{loading:k.value&&!f.value},{default:a(()=>[t(T,{split:!0,size:"small",style:{"min-height":"200px"}},{default:a(()=>[(D(!0),ae(pe,null,Pe(y.value,A=>(D(),M(S,{key:A.id},{default:a(()=>[t(w,{style:{width:"100px"}},{description:a(()=>[t(I,{onClick:L=>g.$router.push({name:"problem-daily-detail",params:{dailyId:A.id}})},{default:a(()=>[x(q(A.problemId),1)]),_:2},1032,["onClick"])]),_:2},1024),t(w,{style:{width:"200px"}},{description:a(()=>[t(I,{onClick:L=>g.$router.push({name:"problem-daily-detail",params:{dailyId:A.id}})},{default:a(()=>[x(q(A.title),1)]),_:2},1032,["onClick"])]),_:2},1024),t(w,{style:{width:"135px"},description:A.id},null,8,["description"]),t(w,null,{description:a(()=>[t($,{theme:A.theme},{default:a(()=>[x(q(A.tag),1)]),_:2},1032,["theme"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["loading"])]),_:1}),t(r,{style:{margin:"10px"},bordered:!0},{header:a(()=>_[6]||(_[6]=[U("b",null,"友情链接",-1)])),default:a(()=>[t(T,null,{default:a(()=>[t(S,null,{default:a(()=>[t(I,{href:"https://boiltask.com",target:"_blank"},{default:a(()=>_[7]||(_[7]=[x("BoilTask Blog")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])}}}),ce=(e,l)=>{const n=e.__vccOpts||e;for(const[u,o]of l)n[u]=o;return n},$n=ce(jn,[["__scopeId","data-v-805a64dc"]]),Un={class:"sh-main"},zn=de({__name:"View404",setup(e){let l=Se(),n=p(l.fullPath);return(u,o)=>{const y=G;return D(),ae("div",Un,[U("p",null,q(ve(n)),1),o[2]||(o[2]=U("p",null,"该页面无效或已被迁移，请重新选择访问目标",-1)),t(y,{theme:"primary",onClick:o[0]||(o[0]=()=>u.$router.push("/"))},{default:a(()=>o[1]||(o[1]=[x("返回首页")])),_:1})])}}}),Aa=ce(zn,[["__scopeId","data-v-d4218944"]]);function An(e){const l={};return l.id=e.id,l.username=e.username,l.nickname=e.nickname,l.email=e.email,l.slogan=e.slogan,l.organization=e.organization,l.accept=e.accept,l.attempt=e.attempt,l.vjudgeId=e.vjudge_id,e.email&&(l.avatar=`https://www.gravatar.com/avatar/${Ba(e.email.toLowerCase().trim())}?d=identicon&s=100`),l}function Rn(e,l){return N({url:"/user/login",method:"post",data:{username:e,password:l}})}function En(){return N({url:"/user/login/refresh",method:"post"})}function Mn(e){const l={username:e};return N({url:`/user/info?${new URLSearchParams(l).toString()}`,method:"get"})}function qn(e){const l="https://vjudge.net/user/solveDetail/"+encodeURIComponent(e);return xt({url:l,method:"get"})}function Kn(e){return N({url:"/user/account/infos",method:"post",data:{users:e}})}function Fn(e){return N({url:"/user/parse",method:"post",data:{users:e}})}function On(e,l){return N({url:"/user/register/email",method:"post",data:{token:e,email:l}})}function Gn(e,l,n,u,o){return N({url:"/user/register",method:"post",data:{username:e,password:l,email:n,key:u,nickname:o}})}function Nn(e,l){return N({url:"/user/forget",method:"post",data:{token:e,username:l}})}function Hn(e,l,n){return N({url:"/user/password/modify",method:"post",data:{username:e,password:l,key:n}})}const Bn={class:"dida-login-footer"},Jn=de({__name:"LoginView",setup(e){const{globalProperties:l}=_e(),n=Fe(),u=p(!1),o=p({username:"",password:""}),y=()=>{ke(l,"重置成功")},v=({validateResult:k,firstError:f})=>{u.value||(u.value=!0,Rn(o.value.username,o.value.password).then(s=>{if(s.code===0){n.loadResponse(s.data),ke(l,"登录成功");let V=l.$route.query.redirect_uri;V||(V="/user/"+s.data.username),l.$router.push({path:V})}else F(l,s.code)}).catch(s=>{console.error("Login error",s),ge(l,"登录失败")}).finally(()=>{u.value=!1}))};return fe(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),(k,f)=>{const s=Ae,V=ze,c=G,P=Ue,g=lt,_=he;return D(),M(_,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(P,{ref:"form",data:o.value,colon:!0,onReset:y,onSubmit:v,class:"yj-login-form","label-width":0},{default:a(()=>[t(V,{name:"username"},{default:a(()=>[t(s,{modelValue:o.value.username,"onUpdate:modelValue":f[0]||(f[0]=m=>o.value.username=m),clearable:"",autocomplete:"username",placeholder:"请输入用户名"},{"prefix-icon":a(()=>[t(ve(Ja))]),_:1},8,["modelValue"])]),_:1}),t(V,{name:"password"},{default:a(()=>[t(s,{modelValue:o.value.password,"onUpdate:modelValue":f[1]||(f[1]=m=>o.value.password=m),type:"password",autocomplete:"current-password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":a(()=>[t(ve(Wa))]),_:1},8,["modelValue"])]),_:1}),t(V,null,{default:a(()=>[t(c,{theme:"primary",type:"submit",block:"",loading:u.value},{default:a(()=>f[4]||(f[4]=[x("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),U("div",Bn,[t(g,{onClick:f[2]||(f[2]=()=>{ve(l).$router.push({name:"login-forget"})})},{default:a(()=>f[5]||(f[5]=[x("忘记密码 ")])),_:1}),t(g,{onClick:f[3]||(f[3]=()=>{ve(l).$router.push({name:"register"})})},{default:a(()=>f[6]||(f[6]=[x("注册账户 ")])),_:1})])]),_:1})}}}),Wn=ce(Jn,[["__scopeId","data-v-524b77f9"]]),Yn={class:"dida-login-footer"},Xn=de({__name:"RegisterView",setup(e){const{globalProperties:l}=_e(),n=Fe(),u=p(!1),o=p(!1),y=p(!1),v=p("发送验证码");let k=null,f=-1;const s=p(!1),V=p(null),c=p({username:"",password:"",confirmPassword:"",nickname:"",email:"",emailKey:""}),g=p({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:i=>new Promise(r=>{const R=setTimeout(()=>{r(c.value.password===i),clearTimeout(R)})}),message:"两次密码不一致"}],nickname:[{required:!0,message:"请填写昵称"},{min:1,message:"昵称至少1个字符"},{max:30,message:"昵称最多30个字符"}],email:[{required:!0,message:"请填写邮箱"},{pattern:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"邮箱格式不正确"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),_=p(()=>t(G,{onClick:m,disabled:y.value,loading:o.value,style:"width:120px"},{default:()=>[v.value]})),m=async()=>{var I;if(!c.value.email){ge(l,"请输入邮箱");return}if(!c.value.email.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)){ge(l,"邮箱格式不正确");return}if(y.value||o.value)return;s.value=!0,await mt();const i=document.getElementById("cf-confirm-div");i&&i.remove();const r=document.createElement("div");r.id="cf-confirm-div",r.setAttribute("data-theme","light"),(I=V.value)==null||I.appendChild(r);const R=window;R.turnstile.ready(function(){R.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(w){s.value=!1,await d(w)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},d=async i=>{if(!y.value){o.value=!0;try{const r=await On(i,c.value.email);if(r.code!==0){F(l,r.code);return}ke(l,"发送验证码成功"),o.value=!1,y.value=!0,k=new Date,v.value="60秒后重发",f=setInterval(()=>{const I=Math.floor((new Date().getTime()-(k==null?void 0:k.getTime()))/1e3);I>60?(v.value="发送验证码",y.value=!1,clearInterval(f)):v.value=`${60-I}秒后重发`},1e3)}catch{ge(l,"发送验证码失败")}finally{o.value=!1}}},h=()=>{ke(l,"重置成功")},b=({validateResult:i,firstError:r,e:R})=>{if(!u.value){if(R.preventDefault(),i!==!0){ge(l,r);return}if(c.value.password!==c.value.confirmPassword){ge(l,"两次密码不一致");return}u.value=!0,Gn(c.value.username,c.value.password,c.value.email,c.value.emailKey,c.value.nickname).then(I=>{I.code===0?(ke(l,"注册成功，可使用账号信息登录"),l.$router.push({name:"login"})):F(l,I.code)}).catch(I=>{console.error("Login error",I),ge(l,"登录失败")}).finally(()=>{u.value=!1})}};return fe(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),De(()=>{clearInterval(f)}),(i,r)=>{const R=Ae,I=ze,w=ya,$=G,S=Ue,T=lt,z=he,A=nt;return D(),ae(pe,null,[t(z,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(S,{ref:"form",rules:g.value,data:c.value,colon:!0,onReset:h,onSubmit:b,class:"yj-login-form"},{default:a(()=>[t(I,{name:"username",label:"用户名"},{default:a(()=>[t(R,{modelValue:c.value.username,"onUpdate:modelValue":r[0]||(r[0]=L=>c.value.username=L),clearable:"",placeholder:"用于登录与查找"},null,8,["modelValue"])]),_:1}),t(I,{name:"password",label:"密码"},{default:a(()=>[t(R,{modelValue:c.value.password,"onUpdate:modelValue":r[1]||(r[1]=L=>c.value.password=L),type:"password",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(I,{name:"confirmPassword",label:"确认密码"},{default:a(()=>[t(R,{modelValue:c.value.confirmPassword,"onUpdate:modelValue":r[2]||(r[2]=L=>c.value.confirmPassword=L),type:"password",clearable:"",placeholder:"请确认密码"},null,8,["modelValue"])]),_:1}),t(I,{name:"nickname",label:"昵称"},{default:a(()=>[t(R,{modelValue:c.value.nickname,"onUpdate:modelValue":r[3]||(r[3]=L=>c.value.nickname=L),clearable:"",placeholder:"用于优先在网站各处展示"},null,8,["modelValue"])]),_:1}),t(I,{name:"email",label:"邮箱"},{default:a(()=>[t(R,{modelValue:c.value.email,"onUpdate:modelValue":r[4]||(r[4]=L=>c.value.email=L),clearable:"",placeholder:"请填写常用邮箱"},null,8,["modelValue"])]),_:1}),t(I,{name:"emailKey",label:"验证码"},{default:a(()=>[t(w,{append:_.value},{default:a(()=>[t(R,{modelValue:c.value.emailKey,"onUpdate:modelValue":r[5]||(r[5]=L=>c.value.emailKey=L),clearable:"",placeholder:"请输入验证码",style:{width:"140px"}},null,8,["modelValue"])]),_:1},8,["append"])]),_:1}),t(I,null,{default:a(()=>[t($,{theme:"primary",type:"submit",block:"",loading:u.value},{default:a(()=>r[8]||(r[8]=[x("注册")])),_:1},8,["loading"])]),_:1})]),_:1},8,["rules","data"]),U("div",Yn,[t(T,{onClick:r[6]||(r[6]=()=>{ve(l).$router.push({name:"login"})})},{default:a(()=>r[9]||(r[9]=[x("返回登陆 ")])),_:1})])]),_:1}),t(A,{visible:s.value,"onUpdate:visible":r[7]||(r[7]=L=>s.value=L),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:a(()=>[U("div",{ref_key:"dialogContainer",ref:V,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),Zn=ce(Xn,[["__scopeId","data-v-9b5f4fc7"]]),Qn={key:0,style:{margin:"10px"}},eo={key:1,style:{margin:"10px"}},to={style:{margin:"12px"}},ao=de({__name:"UserView",setup(e){let l=Se();const{globalProperties:n}=_e(),u=Ze();let o="";const y=p(!1),v=p(null),k=p([]),f=p([]),s=p([]),V=async c=>{y.value=!0;try{let P=await Mn(c);if(P.code!==0){y.value=!1,F(n,P.code),await X.push({name:"home"});return}if(v.value=An(P.data.user),k.value=P.data.problems_ac,u.setTitle(v.value.nickname+" - "+u.getTitle),v.value.vjudgeId){const g=await qn(v.value.vjudgeId);f.value=g.acRecords;for(const _ in f.value)f.value[_].sort((m,d)=>m.length===d.length?m.localeCompare(d):m.length-d.length);s.value=g.failRecords;for(const _ in s.value)s.value[_].sort((m,d)=>m.length===d.length?m.localeCompare(d):m.length-d.length)}}catch{ge(n,"获取用户信息失败"),await X.push({name:"home"})}finally{y.value=!1}};return Ya(async(c,P,g)=>{if(Array.isArray(c.params.username)?o=c.params.username[0]:o=c.params.username,!o){await X.push({name:"home"});return}await V(o),g()}),fe(async()=>{if(Array.isArray(l.params.username)?o=l.params.username[0]:o=l.params.username,!o){await X.push({name:"home"});return}await V(o)}),(c,P)=>{const g=G,_=we,m=he,d=lt,h=We,b=Je,i=Ve,r=hl,R=Ie,I=Te;return D(),M(I,{loading:y.value},{default:a(()=>[t(R,{class:"dida-main-content"},{default:a(()=>[t(i,{span:8},{default:a(()=>{var w;return[t(m,{style:{margin:"10px"},title:"AC题目"},{default:a(()=>[t(_,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(D(!0),ae(pe,null,Pe(k.value,$=>(D(),M(g,{key:$,size:"small",onClick:()=>ve(X).push({name:"problem-detail",params:{problemId:$}})},{default:a(()=>[x(q($),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),(w=v.value)!=null&&w.vjudgeId?(D(),M(m,{key:0,style:{margin:"10px"},title:"vjudge.net"},{actions:a(()=>{var $;return[t(d,{href:"https://vjudge.net/user/"+(($=v.value)==null?void 0:$.vjudgeId),target:"_blank"},{default:a(()=>{var S;return[x("@"+q((S=v.value)==null?void 0:S.vjudgeId),1)]}),_:1},8,["href"])]}),default:a(()=>[f.value&&Object.keys(f.value).length>0?(D(),ae("div",Qn,[P[0]||(P[0]=U("div",{style:{margin:"5px"}},[U("span",null,"AC")],-1)),t(b,{layout:"vertical",bordered:!0},{default:a(()=>[(D(!0),ae(pe,null,Pe(f.value,($,S)=>(D(),M(h,{key:S,label:S},{default:a(()=>[t(_,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(D(!0),ae(pe,null,Pe($,T=>(D(),M(g,{key:T,size:"small",onClick:()=>ve(X).push({name:"problem-detail",params:{problemId:S+"-"+T}})},{default:a(()=>[x(q(T),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):le("",!0),s.value&&Object.keys(s.value).length>0?(D(),ae("div",eo,[P[1]||(P[1]=U("div",{style:{margin:"5px"}},[U("span",null,"Fail")],-1)),t(b,{layout:"vertical",bordered:!0},{default:a(()=>[(D(!0),ae(pe,null,Pe(s.value,($,S)=>(D(),M(h,{key:S,label:S},{default:a(()=>[t(_,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(D(!0),ae(pe,null,Pe($,T=>(D(),M(g,{key:T,size:"small",onClick:()=>ve(X).push({name:"problem-detail",params:{problemId:S+"-"+T}})},{default:a(()=>[x(q(T),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):le("",!0)]),_:1})):le("",!0)]}),_:1}),t(i,{span:4},{default:a(()=>[U("div",to,[t(b,{layout:"vertical",bordered:!0},{default:a(()=>[t(h,{label:"头像"},{default:a(()=>{var w;return[t(r,{shape:"round",size:"100px",image:(w=v.value)==null?void 0:w.avatar,"hide-on-load-failed":!1},null,8,["image"])]}),_:1}),t(h,{label:"昵称"},{default:a(()=>{var w;return[x(q((w=v.value)==null?void 0:w.nickname),1)]}),_:1}),t(h,{label:"Slogan"},{default:a(()=>{var w;return[x(q((w=v.value)==null?void 0:w.slogan),1)]}),_:1}),t(h,{label:"邮箱"},{default:a(()=>{var w;return[x(q((w=v.value)==null?void 0:w.email),1)]}),_:1}),t(h,{label:"组织"},{default:a(()=>{var w;return[x(q((w=v.value)==null?void 0:w.organization),1)]}),_:1}),t(h,{label:"通过数量"},{default:a(()=>{var w;return[x(q((w=v.value)==null?void 0:w.accept),1)]}),_:1}),t(h,{label:"提交数量"},{default:a(()=>{var w;return[x(q((w=v.value)==null?void 0:w.attempt),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),lo=ce(ao,[["__scopeId","data-v-555e19aa"]]),Nt=[{name:"home",path:"/",title:"首页",showSidebar:!1,disableGenerateTab:!0,component:$n},{name:"problem",path:"/problem",title:"题目",icon:"calculation",showSidebar:!0,redirect:"problem-list"},{name:"collection-detail-tab",title:"题集",path:"/collection",showSidebar:!0,disableGenerateTab:!0,redirect:"problem-collection-list"},{name:"judge",path:"/judge",title:"评测",icon:"code",showSidebar:!0,redirect:"judge-list"},{name:"contest",path:"/contest",title:"比赛",icon:"application",showSidebar:!0,redirect:"contest-list"},{name:"contest-detail-tab",title:"比赛",path:"/contest",showSidebar:!0,disableGenerateTab:!0,redirect:"contest-list"},{name:"discuss",title:"讨论",path:"/discuss",icon:"sonic",showSidebar:!0,redirect:"discuss-list"},{name:"discuss-detail-tab",title:"讨论",path:"/discuss",showSidebar:!0,disableGenerateTab:!0,redirect:"discuss-list"},{name:"rank",path:"/rank",title:"排名",icon:"chart-column",showSidebar:!0,redirect:"rank-ac-all"},{name:"system",path:"/system",title:"系统",icon:"dashboard",showSidebar:!0,redirect:"system-status"},{name:"manage",path:"/manage",title:"管理",icon:"command",showSidebar:!0,redirect:"manage-web",auths:[je.ManageWeb]},{name:"login",path:"/login",title:"登陆",showSidebar:!1,disableGenerateTab:!0,component:Wn},{name:"register",path:"/register",title:"注册",showSidebar:!1,disableGenerateTab:!0,component:Zn},{name:"user",path:"/user/:username+",title:"用户",showSidebar:!1,needLogin:!0,disableGenerateTab:!0,component:lo},{name:"404",path:"/404",title:"404",showSidebar:!1,disableGenerateTab:!0,component:Aa}],no=e=>Nt.find(l=>l.name==e),oo=e=>{const l=[];return Nt.forEach(n=>{!n.disableGenerateTab&&e.hasAllAuths(n.auths)&&l.push(n)}),l},so=e=>{Nt.forEach(l=>{const n={name:l.name,path:l.path,meta:{title:l.title,tab:l.name,showSidebar:l.showSidebar,needLogin:l.needLogin,redirect:l.redirect,tabAuths:l.auths},component:l.component};e.push(n)})};function Ra(e){return e.children!==void 0}function ro(e){return e.children!==void 0}const uo={style:{margin:"10px"}},io={key:0,class:"dida-operation-container"};function co(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const mo=de({__name:"ProblemList",setup(e){const l=Se(),n=Xe(),{globalProperties:u}=_e(),o=Fe();let y=null;const v=p(!1),k={};let f={};const s=p(!1),V=Be(()=>o.hasAuth(je.ManageProblem)),c=p([{title:"ID",colKey:"id",cell:(C,j)=>{let E=I(j.row.id);return t(G,{variant:"dashed",theme:E,onClick:()=>R(j.row.id)},{default:()=>[j.row.id]})}},{title:"标题",colKey:"title",cell:(C,j)=>t(G,{variant:"text",onClick:()=>R(j.row.id)},{default:()=>[j.row.title]})},{title:"标签",colKey:"tags",cell:(C,j)=>{const E=j.row.tags;if(!E||E.length===0)return"";let H=[];for(let Z=0;Z<E.length;Z++){const Q=E[Z];H.push(t(G,{key:Z,theme:"default",variant:"outline",size:"small",onClick:()=>T(Q)},{default:()=>[Q.name]}))}return t(we,null,co(H)?H:{default:()=>[H]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),P=p(!1);let g=1,_=50;const m=p({current:g,pageSize:_,defaultCurrent:g,defaultPageSize:_,total:0,pageSizeOptions:[50,100]}),d=p(),h=p(),b=[{label:"DidaOJ",value:"didaoj"},{label:"HDU",value:"hdu"},{label:"POJ",value:"poj"},{label:"NYOJ",value:"nyoj"}],i=p({oj:"",title:"",tag:"",private:!1}),r=p({oj:"",problem:""}),R=C=>{C&&n.push({path:"/problem/"+C})},I=C=>{if(!C||!f)return"default";const j=f[C];if(!j)return"default";switch(j){case Oe.Accept:return"success";case Oe.Attempt:return"warning";default:return"default"}},w=async()=>{await n.push({query:{...l.query,oj:i.value.oj,title:i.value.title,tag:i.value.tag,private:i.value.private?"1":"0",page:1,page_size:m.value.defaultPageSize}})},$=async()=>{i.value.oj="",i.value.title="",i.value.tag="",i.value.private=!1,await n.push({query:{...l.query,oj:"",title:"",tag:"",private:"0",page:1,page_size:m.value.defaultPageSize}})},S=async()=>{try{s.value=!0;const C=await za(r.value.oj,r.value.problem);C.code===0?(ke(u,"搜索成功"),await n.push({name:"problem-detail",params:{problemId:C.data}})):F(u,C.code)}catch(C){console.error(C),F(u,Ne())}finally{s.value=!1}},T=C=>{C&&n.push({query:{...l.query,title:"",tag:C.name,page:1,page_size:m.value.defaultPageSize}})},z=()=>{n.push({name:"manage-problem-create"})},A=async(C,j)=>{P.value=!0;try{const{current:E,pageSize:H}=C,Z=await fn(i.value.oj,i.value.title,i.value.tag,i.value.private,E,H);if(d.value=[],Z.code===0){const Q=Z.data.list;if(!Q||Q.length<=0){m.value={...m.value,total:0},f={},ke(u,"未找到记录");return}Q.forEach(ee=>{var O;const te=_t(ee,k);(O=d.value)==null||O.push(te)}),m.value={...m.value,total:Z.data.total_count},f=Z.data.problem_attempt_status}else j&&F(u,Z.code)}catch(E){console.error(E),F(u,Ne())}finally{P.value=!1}},L=async C=>{await n.push({query:{...l.query,page:C.current,page_size:C.pageSize}})};return fe(async()=>{P.value=!0,h.value=[],Ua(-1).then(C=>{if(C.code===0){h.value=C.data.list,v.value=C.data.total_count>C.data.list.length;for(let j=0;j<C.data.list.length;j++){const E=C.data.list[j];k[E.id]=E}y=$e(()=>l.query,j=>{i.value.oj=j.oj||"",i.value.title=j.title||"",i.value.tag=j.tag||"",i.value.private=j.private==="1";const E=parseInt(j.page)||m.value.defaultCurrent,H=parseInt(j.page_size)||m.value.defaultPageSize;g=E,_=H,m.value={...m.value,current:g,pageSize:_},A({current:g,pageSize:_},!0)},{immediate:!0})}else v.value=!0}).catch(C=>{console.error(C),v.value=!0})}),De(()=>{y&&y()}),(C,j)=>{const E=Ee,H=he,Z=Ve,Q=G,ee=we,te=ft,O=ze,me=Ae,ue=vt,J=Ue,W=Ie;return D(),M(W,null,{default:a(()=>[t(Z,{span:9},{default:a(()=>[t(H,{style:{margin:"10px"}},{default:a(()=>[t(E,{data:d.value,columns:c.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:m.value,"table-layout":"auto",loading:P.value,onPageChange:L},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(Z,{span:3},{default:a(()=>[U("div",uo,[V.value?(D(),ae("div",io,[t(ee,null,{default:a(()=>[t(Q,{onClick:z},{default:a(()=>j[7]||(j[7]=[x("新建")])),_:1})]),_:1})])):le("",!0),t(H,{class:"sh-card"},{default:a(()=>[t(J,{model:i.value,onSubmit:w,onReset:$},{default:a(()=>[t(O,{label:"OJ"},{default:a(()=>[t(te,{modelValue:i.value.oj,"onUpdate:modelValue":j[0]||(j[0]=ne=>i.value.oj=ne),options:b,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(O,{label:"标题"},{default:a(()=>[t(me,{modelValue:i.value.title,"onUpdate:modelValue":j[1]||(j[1]=ne=>i.value.title=ne),placeholder:"请输入关键词"},null,8,["modelValue"])]),_:1}),t(O,{label:"标签"},{default:a(()=>[t(me,{modelValue:i.value.tag,"onUpdate:modelValue":j[2]||(j[2]=ne=>i.value.tag=ne),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),V.value?(D(),M(O,{key:0,label:"私有"},{default:a(()=>[t(ue,{modelValue:i.value.private,"onUpdate:modelValue":j[3]||(j[3]=ne=>i.value.private=ne)},null,8,["modelValue"])]),_:1})):le("",!0),t(O,null,{default:a(()=>[t(ee,null,{default:a(()=>[t(Q,{theme:"primary",type:"submit"},{default:a(()=>j[8]||(j[8]=[x("搜索")])),_:1}),t(Q,{theme:"danger",type:"reset"},{default:a(()=>j[9]||(j[9]=[x("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(H,{class:"sh-card"},{default:a(()=>[t(J,{model:r.value,onSubmit:S},{default:a(()=>[t(O,{label:"OJ"},{default:a(()=>[t(te,{modelValue:r.value.oj,"onUpdate:modelValue":j[4]||(j[4]=ne=>r.value.oj=ne),options:b,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(O,{label:"题目"},{default:a(()=>[t(me,{modelValue:r.value.problem,"onUpdate:modelValue":j[5]||(j[5]=ne=>r.value.problem=ne),placeholder:"请输入原始题号"},null,8,["modelValue"])]),_:1}),t(O,null,{default:a(()=>[t(Q,{theme:"primary",type:"submit",loading:s.value},{default:a(()=>j[10]||(j[10]=[x("前往")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),t(H,{class:"sh-card sh-background-black"},{default:a(()=>[(D(!0),ae(pe,null,Pe(h.value,ne=>(D(),M(Q,{class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:()=>T(ne)},{default:a(()=>[x(q(ne.name),1)]),_:2},1032,["onClick"]))),256)),v.value?(D(),M(Q,{key:0,class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:j[6]||(j[6]=()=>C.$router.push("/problem/tags"))},{default:a(()=>j[11]||(j[11]=[x(" ... ")])),_:1})):le("",!0)]),_:1})])]),_:1})]),_:1})}}}),po=ce(mo,[["__scopeId","data-v-dbe06f89"]]);function at(e){let l="";for(;e>0;)e--,l=String.fromCharCode(65+e%26)+l,e=Math.floor(e/26);return l}function Ht(e){const l={};if(l.id=e.id,l.ownerId=e.owner_id,l.ownerUsername=e.owner_username,l.ownerNickname=e.owner_nickname,l.title=e.title,l.startTime=new Date(e.start_time).toLocaleString(),l.endTime=new Date(e.end_time).toLocaleString(),l.createTime=new Date(e.create_time).toLocaleString(),l.updateTime=new Date(e.update_time).toLocaleString(),l.private=e.private,l.description=e.description,l.notification=e.notification,e.problems){l.problems=[],e.problems.sort((n,u)=>n.index-u.index);for(let n=0;n<e.problems.length;n++){const u=e.problems[n];let o={accept:0,attempt:0,author:"",id:"",private:!1,tags:[],title:""};o.index=u.index,o.id=at(u.index),o.title=u.title,u.accept?o.accept=u.accept:o.accept=0,u.attempt?o.attempt=u.attempt:o.attempt=0,l.problems.push(o)}}return l}function fo(e){return N({url:"/contest?id="+e,method:"get"})}function vo(e){return N({url:"/contest/edit?id="+e,method:"get"})}function _o(e){return N({url:"/contest/problem/list?id="+e,method:"get"})}function go(e){return e||(e=0),N({url:"/contest/image/token?id="+e,method:"get"})}function bo(e,l){return N({url:"/contest/problem?id="+e+"&problem_index="+l,method:"get"})}function ho(e,l,n,u){const o={};return e&&(o.title=e),l&&(o.username=l),n&&(o.page=String(n)),u&&(o.page_size=String(u)),N({url:`/contest/list?${new URLSearchParams(o).toString()}`,method:"get"})}function yo(e){return N({url:"/contest/rank?id="+e,method:"get"})}function wo(e){return N({url:"/contest/create",method:"post",data:e})}function ko(e){return N({url:"/contest/edit",method:"post",data:e})}function So(e,l){return N({url:"/contest/password",method:"post",data:{id:e,password:l}})}function Co(e){return N({url:"/contest/dolos",method:"post",data:{id:e}})}const Bt=async(e,l)=>{l&&await e.push({name:"user",params:{username:l}})},ta=e=>{const l=X.resolve({name:"problem-detail",params:{problemId:e}});window.open(l.href,"_blank")},Mt=async(e,l)=>{await X.push({name:"contest-problem-detail",params:{contestId:e,problemIndex:l}})},Io={class:"sh-button"},Po={style:{"margin-top":"16px"}},xo={__name:"SecretPanel",setup(e){const l=p(!1);return(n,u)=>{const o=G;return D(),ae("div",el(tl(n.$attrs)),[U("div",Io,[t(o,{onClick:u[0]||(u[0]=y=>l.value=!l.value)},{default:a(()=>[x(q(l.value?"收起":"展开"),1)]),_:1})]),Xa(U("div",Po,[Qa(n.$slots,"default",{},void 0)],512),[[Za,l.value]])],16)}}},aa=ce(xo,[["__scopeId","data-v-23f11aab"]]),Vo={key:1,style:{"text-align":"center"}},To={key:1,style:{"text-align":"center"}},Do={key:0,class:"dida-problems-container"},Lo={style:{margin:"12px"}},jo={key:1},$o={class:"dida-operation-container"},Uo={key:0,class:"dida-operation-container"},zo={class:"dida-code-submit-div"},Ao={class:"dida-code-editor-div"},Ro=de({__name:"ProblemDetail",setup(e){let l=Se();const{globalProperties:n}=_e();let u=null;const o=Ze(),y=Fe();let v=p(""),k="",f="",s=0,V=p(0);const c=p(!1),P=p(!1),g=p(!1),_=p(null);let m=null;const d=p(null),h=p(!1),b=p(!1),i={},r=p(""),R=p([]);R.value=Ot();const I=p([]),w=p(null),$=p(-1),S=p(-1),T=p(""),z=p("");let A=0;const L=Be(()=>y.hasAuth(je.ManageProblem)),C=Be(()=>y.hasAuth(je.ManageProblemDaily)),j=()=>{w.value&&clearInterval(w.value),w.value=setInterval(()=>{const K=$.value<=0,B=new Date(new Date().getTime()+A),ie=B.getHours()*60*60+B.getMinutes()*60+B.getSeconds(),oe=18*60*60;ie<oe?$.value=oe-ie:$.value=-1,S.value=24*60*60-ie,(!K&&$.value<=0||S.value<=0)&&ne()},1e3)},E=()=>{w.value&&(clearInterval(w.value),w.value=null)},H=K=>{K&&X.push({name:"problem-list",query:{...l.query,title:"",tag:K.name}})},Z=async()=>{if(!f){ge(n,"每日问题ID无效");return}await X.push({name:"manage-problem-daily",params:{dailyId:f}})},Q=async()=>{let K=k;if(!K)try{const B=await bo(s,V.value);B.code===0?K=B.data:F(n,B.code)}catch{ge(n,"获取题目ID失败，请稍后再试");return}await X.push({name:"manage-problem",params:{problemId:K}})},ee=()=>{k?X.push({name:"judge-list",query:{problem_id:k}}):X.push({name:"contest-judge",params:{contestId:s},query:{problem_id:at(V.value)}})},te=()=>{k?X.push({name:"discuss-list-problem",query:{problem_id:k}}):X.push({name:"contest-discuss",params:{contestId:s},query:{problem_id:at(V.value)}})},O=()=>{X.push({name:"problem-recommend",params:{problemId:k}})},me=async()=>{var ie,oe;const K=(ie=_.value)==null?void 0:ie.originOj,B=(oe=_.value)==null?void 0:oe.originId;if(!(!K||!B))try{h.value=!0;const Ce=await za(K,B);Ce.code===0?(await W(),ke(n,"更新成功")):F(n,Ce.code)}catch{ge(n,"更新失败，请稍后再试")}finally{h.value=!1}},ue=async()=>{const K=parseInt(r.value);if(!yt(K)){ge(n,"请选择所编写的语言");return}const B=m==null?void 0:m.getValue();if(!B){ge(n,"请输入所需提交的代码");return}if(!k&&(!s||!V.value)){ge(n,"问题ID无效");return}b.value=!0;try{const ie=await ln(k,s,V.value,K,B);if(ie.code!==0){F(n,ie.code);return}ke(n,"提交成功，正在跳转到详情页面");const oe=ie.data.id;s?await X.push({name:"contest-judge-detail",params:{contestId:s,judgeId:oe}}):await X.push({name:"judge-detail",params:{judgeId:oe}})}finally{b.value=!1}},J=K=>{if(!m)return;const B=m.getModel();B&&Qt.setModelLanguage(B,Gt(K))},W=async()=>{I.value=[];let K=await $a(k,s,V.value);if(K.code!==0){g.value=!1,F(n,K.code),await X.push({name:"problem"});return}K.data.tags&&K.data.tags.forEach(B=>{i[B.id]=B}),_.value=_t(K.data.problem,i),o.setTitle(_.value.title+" - "+o.getTitle),s&&(K=await _o(s),K.code===0?(K.data.problems.sort((B,ie)=>B-ie),I.value=K.data.problems):F(n,K.code)),v.value=_.value.description,await mt(()=>{!m&&d.value&&(m=Qt.create(d.value,{value:"",language:"cpp",minimap:{enabled:!0},colorDecorators:!0,readOnly:!1,theme:"vs-dark"})),g.value=!1})},ne=async()=>{E(),P.value=!1;const K=await _n(f);if(K.code!==0)return;P.value=!0;const B=K.data.problem_daily;k=B.problem_id,T.value=B.solution,z.value=B.code;const ie=new Date(K.data.time);A=ie.getTime()-new Date().getTime();const oe=new Date(ie.getTime()),Ce=oe.getFullYear(),Y=String(oe.getMonth()+1).padStart(2,"0"),se=String(oe.getDate()).padStart(2,"0"),ye=`${Ce}-${Y}-${se}`;if(f===ye){const be=ie.getHours()*60*60+ie.getMinutes()*60+ie.getSeconds(),xe=18*60*60;be<xe?$.value=xe-be:$.value=-1,S.value=24*60*60-be}($.value>=0||S.value>=0)&&j()};return fe(async()=>{u=$e(()=>l.params,async()=>{if(P.value=!1,Array.isArray(l.params.problemId)?k=l.params.problemId[0]:k=l.params.problemId,k||(Array.isArray(l.params.dailyId)?f=l.params.dailyId[0]:f=l.params.dailyId,g.value=!0,await ne(),g.value=!1),!k){if(Array.isArray(l.params.contestId)?s=Number(l.params.contestId[0]):s=Number(l.params.contestId),!s){ge(n,"题目不存在"),f?await X.push({name:"problem-daily-list"}):await X.push({name:"problem"});return}if(Array.isArray(l.params.problemIndex)?V.value=parseInt(l.params.problemIndex[0]):V.value=parseInt(l.params.problemIndex),!V.value){ge(n,"题目不存在"),await X.push({name:"problem"});return}}c.value=!!s,g.value=!0,await W()},{immediate:!0}),d.value&&new ResizeObserver(()=>{m&&m.layout()}).observe(d.value)}),De(()=>{u&&(u(),u=null),E()}),(K,B)=>{const ie=Re("md-preview"),oe=he,Ce=qt,Y=we,se=Ve,ye=G,be=We,xe=lt,Ge=Je,Le=Kt,Ye=ft,ot=Ie,Tt=Te;return D(),M(Tt,{loading:g.value},{default:a(()=>[t(ot,{class:"dida-main-content"},{default:a(()=>[t(se,{span:8},{default:a(()=>[t(oe,{style:{margin:"10px"}},{default:a(()=>[t(ie,{"model-value":ve(v),previewTheme:"cyanosis"},null,8,["model-value"])]),_:1}),P.value?(D(),M(oe,{key:0,style:{margin:"10px"},title:"题解"},{default:a(()=>[$.value<0?(D(),M(aa,{key:0},{default:a(()=>[t(ie,{"model-value":T.value,previewTheme:"cyanosis"},null,8,["model-value"])]),_:1})):(D(),ae("div",Vo,[U("div",null,[t(Y,null,{default:a(()=>[B[2]||(B[2]=U("p",null,"距离解锁百分比",-1)),t(Ce,{theme:"circle",color:{from:"#0052D9",to:"#00A870"},percentage:100-$.value/(18*60*60)*100,status:"active"},{label:a(()=>[x(q((100-$.value/(18*60*60)*100).toFixed(3))+"% ",1)]),default:a(()=>[B[1]||(B[1]=x(" > "))]),_:1},8,["percentage"])]),_:1})])]))]),_:1})):le("",!0),P.value?(D(),M(oe,{key:1,style:{margin:"10px"},title:"示例代码"},{default:a(()=>[S.value<0?(D(),M(aa,{key:0},{default:a(()=>[t(ie,{"model-value":z.value,previewTheme:"cyanosis"},null,8,["model-value"])]),_:1})):(D(),ae("div",To,[U("div",null,[t(Y,{style:{margin:"0 auto"}},{default:a(()=>[B[4]||(B[4]=U("p",null,"距离解锁百分比",-1)),t(Ce,{theme:"circle",color:{from:"#0052D9",to:"#00A870"},percentage:100-S.value/(24*60*60)*100,status:"active"},{label:a(()=>[x(q((100-S.value/(24*60*60)*100).toFixed(3))+"% ",1)]),default:a(()=>[B[3]||(B[3]=x(" > "))]),_:1},8,["percentage"])]),_:1})])]))]),_:1})):le("",!0)]),_:1}),t(se,{span:4},{default:a(()=>{var Yt;return[ve(s)?(D(),ae("div",Do,[t(Y,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(D(!0),ae(pe,null,Pe(I.value,(Me,re)=>(D(),M(ye,{key:re,theme:Me==ve(V)?"primary":"default",onClick:async()=>await ve(Mt)(ve(s),Me)},{default:a(()=>[x(q(ve(at)(Me)),1)]),_:2},1032,["theme","onClick"]))),128))]),_:1})])):le("",!0),U("div",Lo,[t(Ge,{layout:"vertical",bordered:!0},{default:a(()=>{var Me;return[t(be,{label:"ID"},{default:a(()=>{var re;return[x(q((re=_.value)==null?void 0:re.id),1)]}),_:1}),t(be,{label:"标题"},{default:a(()=>{var re;return[x(q((re=_.value)==null?void 0:re.title),1)]}),_:1}),t(be,{label:"时间限制"},{default:a(()=>{var re;return[x(q((re=_.value)==null?void 0:re.timeLimit),1)]}),_:1}),t(be,{label:"内存限制"},{default:a(()=>{var re;return[x(q((re=_.value)==null?void 0:re.memoryLimit),1)]}),_:1}),t(be,{label:"判题方式"},{default:a(()=>{var re;return[x(q((re=_.value)==null?void 0:re.judgeType),1)]}),_:1}),c.value?le("",!0):(D(),M(be,{key:0,label:"正确提交"},{default:a(()=>{var re;return[x(q((re=_.value)==null?void 0:re.accept),1)]}),_:1})),c.value?le("",!0):(D(),M(be,{key:1,label:"提交总数"},{default:a(()=>{var re;return[x(q((re=_.value)==null?void 0:re.attempt),1)]}),_:1})),t(be,{label:"创建时间"},{default:a(()=>{var re;return[x(q((re=_.value)==null?void 0:re.insertTime),1)]}),_:1}),t(be,{label:"更新时间"},{default:a(()=>{var re;return[x(q((re=_.value)==null?void 0:re.updateTime),1)]}),_:1}),t(be,{label:"上传用户"},{default:a(()=>{var re;return[x(q((re=_.value)==null?void 0:re.creatorNickname),1)]}),_:1}),c.value?le("",!0):(D(),M(be,{key:2,label:"题目来源"},{default:a(()=>{var re,Qe,ct;return[(re=_.value)!=null&&re.sourceUrl?(D(),M(xe,{key:0,href:(Qe=_.value)==null?void 0:Qe.sourceUrl,target:"_blank"},{default:a(()=>{var Xt;return[x(q((Xt=_.value)==null?void 0:Xt.source),1)]}),_:1},8,["href"])):(D(),ae("span",jo,q((ct=_.value)==null?void 0:ct.source),1))]}),_:1})),L.value?(D(),M(be,{key:3,label:"是否私有"},{default:a(()=>{var re;return[x(q((re=_.value)!=null&&re.private?"私有":"公开"),1)]}),_:1})):le("",!0),(Me=_.value)!=null&&Me.originUrl?(D(),M(be,{key:4,label:"原题链接"},{default:a(()=>{var re;return[t(xe,{href:(re=_.value)==null?void 0:re.originUrl,target:"_blank"},{default:a(()=>{var Qe,ct;return[x(q((Qe=_.value)==null?void 0:Qe.originOj)+" - "+q((ct=_.value)==null?void 0:ct.originId),1)]}),_:1},8,["href"])]}),_:1})):le("",!0),ve(k)?(D(),M(be,{key:5,label:"标签"},{default:a(()=>[t(Y,null,{default:a(()=>{var re;return[(D(!0),ae(pe,null,Pe((re=_.value)==null?void 0:re.tags,Qe=>(D(),M(ye,{key:Qe.id,variant:"dashed",onClick:()=>H(Qe)},{default:a(()=>[x(q(Qe.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})):le("",!0)]}),_:1}),U("div",$o,[t(Y,null,{default:a(()=>[t(ye,{onClick:ee},{default:a(()=>B[5]||(B[5]=[x("提交记录")])),_:1}),t(ye,{onClick:te},{default:a(()=>B[6]||(B[6]=[x("题目讨论")])),_:1}),ve(k)?(D(),M(ye,{key:0,onClick:O},{default:a(()=>B[7]||(B[7]=[x("题目推荐")])),_:1})):le("",!0)]),_:1})]),P.value&&C.value||L.value||(Yt=_.value)!=null&&Yt.originId?(D(),ae("div",Uo,[t(Y,null,{default:a(()=>{var Me;return[P.value&&C.value?(D(),M(ye,{key:0,onClick:Z},{default:a(()=>B[8]||(B[8]=[x("每日一题")])),_:1})):le("",!0),L.value?(D(),M(ye,{key:1,onClick:Q},{default:a(()=>B[9]||(B[9]=[x("编辑")])),_:1})):le("",!0),(Me=_.value)!=null&&Me.originId?(D(),M(ye,{key:2,onClick:me,loading:h.value},{default:a(()=>B[10]||(B[10]=[x("更新描述 ")])),_:1},8,["loading"])):le("",!0)]}),_:1})])):le("",!0),U("div",zo,[t(Y,null,{default:a(()=>[t(Ye,{modelValue:r.value,"onUpdate:modelValue":B[0]||(B[0]=Me=>r.value=Me),label:"语言：",placeholder:"请选择提交语言","auto-width":"",clearable:"",onChange:J},{default:a(()=>[(D(!0),ae(pe,null,Pe(R.value,Me=>(D(),M(Le,{key:Me.value,value:Me.value,label:Me.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),t(ye,{onClick:ue,loading:b.value},{default:a(()=>B[11]||(B[11]=[x("提交")])),_:1},8,["loading"])]),_:1}),U("div",Ao,[U("div",{ref_key:"codeEditRef",ref:d,class:"dida-code-editor"},null,512)])])])]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),jt=ce(Ro,[["__scopeId","data-v-bf97b778"]]),Eo={style:{margin:"10px"}},Mo={key:0,class:"dida-operation-container"};function qo(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const Ko=de({__name:"ProblemDailyList",setup(e){const l=Se(),n=Xe(),{globalProperties:u}=_e(),o=Fe();let y=!1,v=null,k={},f={};const s=Be(()=>o.hasAuth(je.ManageProblem)),V=p([{title:"日期",colKey:"id",cell:(S,T)=>t(G,{variant:"dashed",onClick:()=>h(T.row.id)},{default:()=>[T.row.id]})},{title:"ID",colKey:"problemId",cell:(S,T)=>{let z=b(T.row.problemId);return t(G,{variant:"dashed",theme:z,onClick:()=>h(T.row.id)},{default:()=>[T.row.problemId]})}},{title:"标题",colKey:"title",cell:(S,T)=>t(G,{variant:"text",onClick:()=>h(T.row.id)},{default:()=>[T.row.title]})},{title:"标签",colKey:"tags",cell:(S,T)=>{const z=T.row.tags;if(!z||z.length===0)return"";let A=[];for(let L=0;L<z.length;L++){const C=z[L];A.push(t(G,{key:L,theme:"default",variant:"outline",size:"small",onClick:()=>R(C)},{default:()=>[C.name]}))}return t(we,null,qo(A)?A:{default:()=>[A]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),c=p(!1);let P=1,g=50;const _=p({current:P,pageSize:g,defaultCurrent:P,defaultPageSize:g,total:0,pageSizeOptions:[50,100]}),m=p([]),d=p({date:[],problemId:""}),h=S=>{S&&n.push({name:"problem-daily-detail",params:{dailyId:S}})},b=S=>{if(!S||!f)return"default";const T=f[S];if(!T)return"default";switch(T){case Oe.Accept:return"success";case Oe.Attempt:return"warning";default:return"default"}},i=async()=>{let S="";d.value.date&&d.value.date.length>1&&(S=d.value.date[0]+"~"+d.value.date[1]),await n.push({query:{...l.query,date:S,problem_id:d.value.problemId,page:1,page_size:_.value.defaultPageSize}})},r=async()=>{d.value.date=[],d.value.problemId="",await n.push({query:{...l.query,date:"",problem_id:"",page:1,page_size:_.value.defaultPageSize}})},R=S=>{S&&n.push({name:"problem-list",query:{...l.query,title:"",tag:S.name,page:1,page_size:_.value.defaultPageSize}})},I=()=>{n.push({name:"manage-problem-daily-create"})},w=async(S,T)=>{c.value=!0;try{const{current:z,pageSize:A}=S;let L="";d.value.date[0]&&(L=d.value.date[0]);let C="";d.value.date[1]&&(C=d.value.date[1]);const j=await hn(L,C,d.value.problemId,z,A);if(m.value=[],j.code===0){const E=j.data.list;if(!E||E.length<=0){_.value={..._.value,total:0},f={},ke(u,"未找到记录");return}k={},j.data.tags&&j.data.tags.forEach(H=>{k[H.id]=H}),E.forEach(H=>{var Q;const Z=ja(H,k);(Q=m.value)==null||Q.push(Z)}),_.value={..._.value,total:j.data.total_count},f=j.data.attempt_status}else T&&F(u,j.code)}catch(z){console.error(z),F(u,Ne())}finally{c.value=!1}},$=async S=>{await n.push({query:{...l.query,page:S.current,page_size:S.pageSize}})};return fe(async()=>{y=!0,c.value=!0,v=$e(()=>l.query,S=>{if(!y)return;if(d.value.date=[],S.date){const A=S.date.split("~");A.length===2&&(d.value.date=[A[0],A[1]])}d.value.problemId=S.problem_id||"";const T=parseInt(S.page)||_.value.defaultCurrent,z=parseInt(S.page_size)||_.value.defaultPageSize;P=T,g=z,_.value={..._.value,current:P,pageSize:g},w({current:P,pageSize:g},!0)},{immediate:!0})}),De(()=>{y=!1,v&&v()}),(S,T)=>{const z=Ee,A=he,L=Ve,C=G,j=we,E=Ft,H=ze,Z=Ae,Q=Ue,ee=Ie;return D(),M(ee,null,{default:a(()=>[t(L,{span:9},{default:a(()=>[t(A,{style:{margin:"10px"}},{default:a(()=>[t(z,{data:m.value,columns:V.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:_.value,"table-layout":"auto",loading:c.value,onPageChange:$},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(L,{span:3},{default:a(()=>[U("div",Eo,[s.value?(D(),ae("div",Mo,[t(j,null,{default:a(()=>[t(C,{onClick:I},{default:a(()=>T[2]||(T[2]=[x("新建")])),_:1})]),_:1})])):le("",!0),t(A,{class:"sh-card"},{default:a(()=>[t(Q,{model:d.value,onSubmit:i,onReset:r},{default:a(()=>[t(H,{label:"日期","label-align":"top"},{default:a(()=>[t(E,{modelValue:d.value.date,"onUpdate:modelValue":T[0]||(T[0]=te=>d.value.date=te),"allow-input":"",clearable:"",format:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(H,{label:"问题","label-align":"top"},{default:a(()=>[t(Z,{modelValue:d.value.problemId,"onUpdate:modelValue":T[1]||(T[1]=te=>d.value.problemId=te),placeholder:"请输入问题ID",clearable:""},null,8,["modelValue"])]),_:1}),t(H,{"label-align":"top"},{default:a(()=>[t(j,null,{default:a(()=>[t(C,{theme:"primary",type:"submit"},{default:a(()=>T[3]||(T[3]=[x("搜索")])),_:1}),t(C,{theme:"danger",type:"reset"},{default:a(()=>T[4]||(T[4]=[x("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(A,{class:"sh-card",header:"每日一题","header-bordered":!0},{default:a(()=>T[5]||(T[5]=[U("p",null,"由管理员团队精选的题目，每日0点更新。",-1),U("p",null,"当日下午6点提供题解，次日提供AC代码。",-1)])),_:1})])]),_:1})]),_:1})}}}),Fo=ce(Ko,[["__scopeId","data-v-b97b04ec"]]),Oo={style:{margin:"10px"}},Go={style:{margin:"12px"}},No={class:"dida-edit-container"},Ho=de({__name:"ProblemDailyEdit",setup(e){let l=Se();const{globalProperties:n}=_e();let u=null;const o=p(""),y=p(!1),v=p(!1),k=p(null),f=p({date:"",problemId:"",solution:"",code:""}),s=()=>{X.push({name:"problem-daily-detail",params:{dailyId:o.value}})};async function V(d,h){v.value=!0,await it(d,h,n,()=>xn(o.value)),v.value=!1}const c=async()=>{v.value=!0;try{const d=f.value.date,h=await Sn(d,f.value.problemId,f.value.solution,f.value.code);if(v.value=!0,h.code!==0){F(n,h.code);return}await X.push({name:"manage-problem-daily",params:{dailyId:d}}),Ke(n,"创建成功")}finally{v.value=!1}},P=async()=>{v.value=!0;try{const d=await Cn(o.value,f.value.problemId,f.value.solution,f.value.code);if(v.value=!0,d.code!==0){F(n,d.code);return}k.value&&(d.data.update_time!=null&&(k.value.updateTime=new Date(d.data.update_time).toLocaleString()),d.data.updater_nickname!=null&&(k.value.updaterNickname=d.data.updater_nickname)),d.data.solution!=null&&(f.value.solution=d.data.solution),d.data.code!=null&&(f.value.code=d.data.code),Ke(n,"保存成功")}finally{v.value=!1}},g=d=>{f.value.solution=d,y.value=!1},_=d=>{f.value.code=d,y.value=!1},m=async()=>{const d=await gn(o.value);if(d.code!==0){F(n,d.code),console.error("problem get failed",d.code),await X.push({name:"problem"});return}const h=d.data;k.value=ja(h,{}),f.value.problemId=h.problem_id,g(h.solution),_(h.code)};return fe(async()=>{u=$e(()=>l.params,async()=>{Array.isArray(l.params.dailyId)?o.value=l.params.dailyId[0]:o.value=l.params.dailyId,o.value?(y.value=!0,f.value.date=o.value,await m()):(g("暂无题解"),_("暂无标程"))},{immediate:!0})}),De(()=>{u&&(u(),u=null)}),(d,h)=>{const b=Ct,i=yl,r=ze,R=Ae,I=Ue,w=he,$=Ve,S=G,T=we,z=We,A=Je,L=Ie,C=Re("md-editor-v3"),j=Te;return D(),M(j,{loading:y.value},{default:a(()=>[t(L,null,{default:a(()=>[t($,{span:8},{default:a(()=>[U("div",Oo,[t(b,{theme:"info"},{default:a(()=>h[4]||(h[4]=[x("可以提前配置将来日期的题目，对外仅展示到截止到当天的题目")])),_:1}),t(w,{class:"sh-form-card"},{default:a(()=>[t(I,{model:f.value},{default:a(()=>[t(r,{label:"日期"},{default:a(()=>[t(i,{modelValue:f.value.date,"onUpdate:modelValue":h[0]||(h[0]=E=>f.value.date=E),disabled:o.value&&!0},null,8,["modelValue","disabled"])]),_:1}),t(r,{label:"问题ID"},{default:a(()=>[t(R,{modelValue:f.value.problemId,"onUpdate:modelValue":h[1]||(h[1]=E=>f.value.problemId=E),placeholder:"问题标题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t($,{span:4},{default:a(()=>[U("div",Go,[U("div",No,[o.value?(D(),M(T,{key:0},{default:a(()=>[t(S,{onClick:P,theme:"danger",loading:v.value},{default:a(()=>h[5]||(h[5]=[x("保存")])),_:1},8,["loading"]),t(S,{onClick:s},{default:a(()=>h[6]||(h[6]=[x("查看")])),_:1})]),_:1})):(D(),M(T,{key:1},{default:a(()=>[t(S,{onClick:c,theme:"danger",loading:v.value},{default:a(()=>h[7]||(h[7]=[x("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(D(),M(A,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(z,{label:"创建时间"},{default:a(()=>{var E;return[x(q((E=k.value)==null?void 0:E.createTime),1)]}),_:1}),t(z,{label:"更新时间"},{default:a(()=>{var E;return[x(q((E=k.value)==null?void 0:E.updateTime),1)]}),_:1}),t(z,{label:"创建用户"},{default:a(()=>{var E;return[x(q((E=k.value)==null?void 0:E.creatorNickname),1)]}),_:1}),t(z,{label:"更新用户"},{default:a(()=>{var E;return[x(q((E=k.value)==null?void 0:E.updaterNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),U("div",null,[h[8]||(h[8]=U("p",{style:{"margin-left":"20px"}},"题解：",-1)),t(C,{id:"daily-solution-editor",modelValue:f.value.solution,"onUpdate:modelValue":h[2]||(h[2]=E=>f.value.solution=E),onSave:P,onOnUploadImg:V,previewTheme:"cyanosis"},null,8,["modelValue"]),t(j,{loading:v.value,attach:"#daily-solution-editor","z-index":1e5},null,8,["loading"])]),U("div",null,[h[9]||(h[9]=U("p",{style:{"margin-left":"20px"}},"标程：",-1)),t(C,{id:"daily-code-editor",modelValue:f.value.code,"onUpdate:modelValue":h[3]||(h[3]=E=>f.value.code=E),onSave:P,onOnUploadImg:V,previewTheme:"cyanosis"},null,8,["modelValue"]),t(j,{loading:v.value,attach:"#daily-code-editor","z-index":1e5},null,8,["loading"])])]),_:1},8,["loading"])}}}),la=ce(Ho,[["__scopeId","data-v-fe63fd0d"]]),Bo={style:{margin:"10px"}};function Jo(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const Wo=de({__name:"ProblemRecommend",setup(e){const l=Se(),n=Xe(),{globalProperties:u}=_e();let o=null,y="",v={},k={};const f=p([{title:"ID",colKey:"id",cell:(m,d)=>{let h=P(d.row.id);return t(G,{variant:"dashed",theme:h,onClick:()=>c(d.row.id)},{default:()=>[d.row.id]})}},{title:"标题",colKey:"title",cell:(m,d)=>t(G,{variant:"text",onClick:()=>c(d.row.id)},{default:()=>[d.row.title]})},{title:"标签",colKey:"tags",cell:(m,d)=>{const h=d.row.tags;if(!h||h.length===0)return"";let b=[];for(let i=0;i<h.length;i++){const r=h[i];b.push(t(G,{key:i,theme:"default",variant:"outline",size:"small",onClick:()=>g(r)},{default:()=>[r.name]}))}return t(we,null,Jo(b)?b:{default:()=>[b]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),s=p(!1),V=p(),c=m=>{m&&n.push({path:"/problem/"+m})},P=m=>{if(!m||!k)return"default";const d=k[m];if(!d)return"default";switch(d){case Oe.Accept:return"success";case Oe.Attempt:return"warning";default:return"default"}},g=m=>{m&&n.push({name:"problem-list",query:{tag:m.name}})},_=async m=>{s.value=!0;try{const d=await vn(y);if(V.value=[],d.code===0){const h=d.data.list;if(!h||h.length<=0){ke(u,"暂无推荐题目");return}v={},d.data.tags&&d.data.tags.forEach(b=>{v[b.id]=b}),h.forEach(b=>{var r;const i=_t(b,v);(r=V.value)==null||r.push(i)})}else m&&F(u,d.code)}catch(d){console.error(d),F(u,Ne())}finally{s.value=!1}};return fe(async()=>{s.value=!0,o=$e(()=>l.query,m=>{Array.isArray(l.params.problemId)?y=l.params.problemId[0]:y=l.params.problemId,_(!0)},{immediate:!0})}),De(()=>{o&&o()}),(m,d)=>{const h=Ee,b=he,i=Ve,r=Ie;return D(),M(r,null,{default:a(()=>[t(i,{span:9},{default:a(()=>[t(b,{style:{margin:"10px"}},{default:a(()=>[t(h,{data:V.value,columns:f.value,"row-key":"id","vertical-align":"top",hover:!0,"table-layout":"auto",loading:s.value},null,8,["data","columns","loading"])]),_:1})]),_:1}),t(i,{span:3},{default:a(()=>[U("div",Bo,[t(b,{class:"sh-card",header:"题目推荐","header-bordered":!0},{default:a(()=>d[0]||(d[0]=[x(" 根据本站其他用户的提交记录推荐类似题目"),U("br",null,null,-1),x("依据推荐算法来计算，与本用户相似度最高的用户做的题，大概率被自己感兴趣。 ")])),_:1})])]),_:1})]),_:1})}}}),Yo=ce(Wo,[["__scopeId","data-v-77972e8b"]]),Xo={style:{margin:"10px"}},Zo={key:1},Qo={style:{margin:"12px"}},es={class:"dida-edit-container"},ts={class:"dida-description-editor"},as=de({__name:"ProblemEdit",setup(e){let l=Se();const{globalProperties:n}=_e(),u=Ze(),o=p(""),y=p(!1),v=p(!1),k=p(!1),f=p(null),s=p({title:"",timeLimit:0,memoryLimit:0,source:"",private:!0,tags:[],description:""}),V=p([]),c=p([]),P=Be(()=>{const I=[],w=V.value;for(let $=0,S=w.length;$<S;$++)w[$].value&&I.push(w[$].value);return I}),g=(I,w)=>{const{trigger:$,index:S,item:T}=w;if($==="clear"&&(V.value=[]),["tag-remove","backspace"].includes($)&&V.value.splice(S,1),$==="enter"){for(let A=0;A<c.value.length;A++){const L=c.value[A];if(L.label===T){for(let C=0;C<V.value.length;C++)if(V.value[C].label===L.label)return;V.value.push(L);return}}const z={label:T,value:T};V.value.push(z),c.value=c.value.concat(z)}},_=(I,{current:w,type:$})=>{if(!w){V.value=$==="check"?c.value.slice(1):[];return}if($==="check"){const S=c.value.find(T=>T.value===w);if(!S)return;V.value.push(S)}else V.value=V.value.filter(S=>S.value!==w)},m=()=>{X.push({name:"problem-detail",params:{problemId:o.value}})},d=()=>{X.push({name:"manage-problem-judge",params:{problemId:o.value}})},h=async(I,w)=>{k.value=!0,await it(I,w,n,()=>Pn(o.value)),k.value=!1},b=async()=>{v.value=!0,s.value.tags=[];for(let I=0;I<V.value.length;I++){const w=V.value[I];w&&w.label&&s.value.tags.push(w.label)}try{const I=await wn(s.value.title,s.value.timeLimit,s.value.memoryLimit,s.value.source,s.value.private,s.value.tags,s.value.description);if(v.value=!0,I.code!==0){F(n,I.code);return}I.data!=null&&await X.push({name:"problem-detail",params:{problemId:I.data}}),Ke(n,"创建成功")}finally{v.value=!1}},i=async()=>{v.value=!0,s.value.tags=[];for(let I=0;I<V.value.length;I++){const w=V.value[I];w&&w.label&&s.value.tags.push(w.label)}try{const I=await kn(o.value,s.value.title,s.value.timeLimit,s.value.memoryLimit,s.value.source,s.value.private,s.value.tags,s.value.description);if(v.value=!0,I.code!==0){F(n,I.code);return}f.value&&I.data.update_time!=null&&(f.value.updateTime=new Date(I.data.update_time).toLocaleString()),I.data.description!=null&&(s.value.description=I.data.description),Ke(n,"保存成功")}finally{v.value=!1}},r=I=>{s.value.description=I,y.value=!1},R=async()=>{const I=await $a(o.value,void 0,void 0);if(I.code!==0){F(n,I.code),console.error("problem get failed",I.code),await X.push({name:"problem"});return}const w=I.data.problem;if(f.value=_t(w,{}),s.value.title=w.title,s.value.timeLimit=w.time_limit,s.value.memoryLimit=w.memory_limit,s.value.source=w.source,s.value.private=w.private,s.value.tags=[],V.value=[],I.data.tags)for(let S=0;S<I.data.tags.length;S++){const T=I.data.tags[S];T&&T.name&&(s.value.tags.push(T.name),V.value.push({label:T.name,value:T.id}))}u.setTitle(w.title+" - "+u.getTitle);let $=w.description;r($)};return fe(async()=>{Array.isArray(l.params.problemId)?o.value=l.params.problemId[0]:o.value=l.params.problemId,o.value?(y.value=!0,Ua(-1).then(async I=>{I.code===0?(I.data.list&&I.data.list.forEach(w=>{c.value.push({label:w.name,value:w.id})}),await R()):(F(n,I.code),console.error("problem tag get failed",I.code),await X.push({name:"problem"}))}).catch(async I=>{console.error(I),F(n,"获取数据异常"),await X.push({name:"problem"})})):(s.value.timeLimit=1e3,s.value.memoryLimit=65536,r(""))}),(I,w)=>{const $=Ae,S=ze,T=wa,z=vt,A=kl,L=wl,C=Ue,j=he,E=Ve,H=G,Z=we,Q=We,ee=Je,te=Ie,O=Re("md-editor-v3"),me=Te;return D(),M(me,{loading:y.value},{default:a(()=>[t(te,null,{default:a(()=>[t(E,{span:8},{default:a(()=>[U("div",Xo,[t(j,{class:"sh-card"},{default:a(()=>[t(C,{model:s.value},{default:a(()=>[t(S,{label:"标题"},{default:a(()=>[t($,{modelValue:s.value.title,"onUpdate:modelValue":w[0]||(w[0]=ue=>s.value.title=ue),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),t(S,{label:"时间限制"},{default:a(()=>[t(T,{modelValue:s.value.timeLimit,"onUpdate:modelValue":w[1]||(w[1]=ue=>s.value.timeLimit=ue),theme:"normal",min:0},{suffix:a(()=>w[6]||(w[6]=[U("span",null,"ms",-1)])),_:1},8,["modelValue"])]),_:1}),t(S,{label:"内存限制"},{default:a(()=>[t(T,{modelValue:s.value.memoryLimit,"onUpdate:modelValue":w[2]||(w[2]=ue=>s.value.memoryLimit=ue),theme:"normal",min:0},{suffix:a(()=>w[7]||(w[7]=[U("span",null,"KB",-1)])),_:1},8,["modelValue"])]),_:1}),t(S,{label:"来源"},{default:a(()=>[t($,{modelValue:s.value.source,"onUpdate:modelValue":w[3]||(w[3]=ue=>s.value.source=ue),placeholder:"请输入题目来源"},null,8,["modelValue"])]),_:1}),t(S,{label:"私有"},{default:a(()=>[t(z,{modelValue:s.value.private,"onUpdate:modelValue":w[4]||(w[4]=ue=>s.value.private=ue)},null,8,["modelValue"])]),_:1}),t(S,{label:"标签"},{default:a(()=>[t(L,{value:V.value,"allow-input":!0,placeholder:"请选择或输入","tag-input-props":{excessTagsDisplayType:"break-line"},"popup-props":{overlayInnerClassName:["narrow-scrollbar"],overlayInnerStyle:{maxHeight:"280px",overflowY:"auto",overscrollBehavior:"contain",padding:"6px"}},clearable:"",multiple:"",onTagChange:g},{panel:a(()=>[c.value.length?(D(),M(A,{key:0,value:P.value,options:c.value,onChange:_},null,8,["value","options"])):(D(),ae("div",Zo,"暂无数据"))]),suffixIcon:a(()=>[t(ve(al))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(E,{span:4},{default:a(()=>[U("div",Qo,[U("div",es,[o.value?(D(),M(Z,{key:0},{default:a(()=>[t(H,{onClick:i,theme:"danger",loading:v.value},{default:a(()=>w[8]||(w[8]=[x("保存")])),_:1},8,["loading"]),t(H,{onClick:d,theme:"warning"},{default:a(()=>w[9]||(w[9]=[x("判题数据")])),_:1}),t(H,{onClick:m},{default:a(()=>w[10]||(w[10]=[x("查看")])),_:1})]),_:1})):(D(),M(Z,{key:1},{default:a(()=>[t(H,{onClick:b,theme:"danger",loading:v.value},{default:a(()=>w[11]||(w[11]=[x("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(D(),M(ee,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(Q,{label:"创建时间"},{default:a(()=>{var ue;return[x(q((ue=f.value)==null?void 0:ue.insertTime),1)]}),_:1}),t(Q,{label:"更新时间"},{default:a(()=>{var ue;return[x(q((ue=f.value)==null?void 0:ue.updateTime),1)]}),_:1}),t(Q,{label:"判题方式"},{default:a(()=>{var ue;return[x(q((ue=f.value)==null?void 0:ue.judgeType),1)]}),_:1}),t(Q,{label:"上传用户"},{default:a(()=>{var ue;return[x(q((ue=f.value)==null?void 0:ue.creatorNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),U("div",ts,[w[12]||(w[12]=U("p",null,"题目描述",-1)),t(me,{loading:k.value||v.value},{default:a(()=>[t(O,{modelValue:s.value.description,"onUpdate:modelValue":w[5]||(w[5]=ue=>s.value.description=ue),onSave:i,onOnUploadImg:h,previewTheme:"cyanosis"},null,8,["modelValue"])]),_:1},8,["loading"])])]),_:1},8,["loading"])}}}),na=ce(as,[["__scopeId","data-v-e349d9e2"]]),ls={style:{margin:"10px"}},ns={style:{margin:"12px"}},os={class:"dida-edit-container"},ss=de({__name:"ProblemJudge",setup(e){let l=Se();const{globalProperties:n}=_e(),u=Ze(),o=p(""),y=p(!1),v=p(null);let k=null;const f=p(null),s=p(""),V=p(!1),c=p(!1),P=p([{title:"文件",colKey:"file"},{title:"大小",colKey:"size",width:150,cell:(T,z)=>{let A=z.row.size,L;return A>10*1024?A>1024*1024?L=(A/(1024*1024)).toFixed(3)+" MB":L=(A/1024).toFixed(3)+" KB":L=A+" B",L}},{title:"最后修改时间",colKey:"lastModified",width:180,cell:(T,z)=>new Date(z.row.lastModified).toLocaleString()},{title:"操作",colKey:"action",width:100,cell:(T,z)=>t(G,{onClick:()=>b(z.row.file)},{default:()=>[x("下载")]})}]),g=p([]),_=Be(()=>({border:"2px dashed #ccc",borderRadius:"6px",padding:"20px",textAlign:"center",cursor:"pointer",backgroundColor:V.value?"#f0f9ff":"#fff",transition:"background-color 0.2s ease"})),m=Be(()=>s.value?`已选择：${s.value}`:V.value?"松开文件以上传":"拖拽判题数据压缩包到这里，或点击选择文件"),d=()=>{X.push({name:"problem-detail",params:{problemId:o.value}})},h=()=>{X.push({name:"manage-problem",params:{problemId:o.value}})},b=async T=>{const z=await In(o.value,T);if(z.code!==0){F(n,z.code);return}const A=document.createElement("a");A.href=z.data,A.target="_blank",A.click(),URL.revokeObjectURL(A.href)},i=async()=>{if(!k){ge(n,"请选择压缩包");return}c.value=!0,Vn(o.value,k).then(async T=>{T.code==0?(f.value.value=null,k=null,s.value="",y.value=!0,Ke(n,"上传成功"),await S()):F(n,T.code)}).catch(T=>{console.log(T),n.$message.error({duration:3e3,content:"申请失败"})}).finally(()=>{c.value=!1})},r=()=>{var T;(T=f.value)==null||T.click()},R=T=>{const z=T.target.files[0];z&&(s.value=z.name,k=z)},I=T=>{V.value=!0},w=()=>{V.value=!1},$=T=>{T.preventDefault(),T.stopPropagation(),V.value=!1;const z=T.dataTransfer.files[0];if(z){s.value=z.name;const A=new DataTransfer;A.items.add(z),f.value.files=A.files,k=z}},S=async()=>{const T=await pn(o.value);if(T.code!==0){F(n,T.code),await X.push({name:"problem"});return}const z=T.data.problem;v.value=_t(z,{}),u.setTitle(z.title+" - "+u.getTitle),g.value=[],T.data.judges?T.data.judges.forEach(A=>{g.value.push({file:A.key,size:A.size,lastModified:A.last_modified})}):ge(n,"评测数据不存在"),y.value=!1};return fe(async()=>{if(Array.isArray(l.params.problemId)?o.value=l.params.problemId[0]:o.value=l.params.problemId,!o.value){ge(n,"题目不存在"),await X.push({name:"problem"});return}y.value=!0,await S()}),(T,z)=>{const A=Ee,L=Ve,C=G,j=we,E=We,H=Je,Z=Ie,Q=Te;return D(),M(Q,{loading:y.value},{default:a(()=>[t(Z,null,{default:a(()=>[t(L,{span:7},{default:a(()=>[U("div",ls,[U("div",{id:"drop-zone",style:ga(_.value),onClick:r,onDragenter:Dt(I,["prevent"]),onDragover:z[0]||(z[0]=Dt(()=>{},["prevent"])),onDragleave:Dt(w,["prevent"]),onDrop:$},[U("input",{ref_key:"fileInput",ref:f,type:"file",style:{display:"none"},onChange:R},null,544),x(" "+q(m.value),1)],36)]),t(A,{data:g.value,columns:P.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1}),t(L,{span:5},{default:a(()=>[U("div",ns,[U("div",os,[t(j,null,{default:a(()=>[t(C,{onClick:i,theme:"danger",loading:c.value},{default:a(()=>z[1]||(z[1]=[x("上传")])),_:1},8,["loading"]),t(C,{onClick:h,theme:"warning"},{default:a(()=>z[2]||(z[2]=[x("编辑")])),_:1}),t(C,{onClick:d},{default:a(()=>z[3]||(z[3]=[x("查看")])),_:1})]),_:1})]),t(H,{layout:"vertical",bordered:!0},{default:a(()=>[t(E,{label:"标题"},{default:a(()=>{var ee;return[x(q((ee=v.value)==null?void 0:ee.title),1)]}),_:1}),t(E,{label:"创建时间"},{default:a(()=>{var ee;return[x(q((ee=v.value)==null?void 0:ee.insertTime),1)]}),_:1}),t(E,{label:"更新时间"},{default:a(()=>{var ee;return[x(q((ee=v.value)==null?void 0:ee.updateTime),1)]}),_:1}),t(E,{label:"判题方式"},{default:a(()=>{var ee;return[x(q((ee=v.value)==null?void 0:ee.judgeType),1)]}),_:1}),t(E,{label:"评测数据"},{default:a(()=>{var ee;return[x(q((ee=v.value)==null?void 0:ee.judgeMd5),1)]}),_:1}),t(E,{label:"上传用户"},{default:a(()=>{var ee;return[x(q((ee=v.value)==null?void 0:ee.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),rs=ce(ss,[["__scopeId","data-v-bd1b4a95"]]);function Jt(e){const l={};return l.id=e.id,l.ownerId=e.owner_id,l.ownerUsername=e.owner_username,l.ownerNickname=e.owner_nickname,l.title=e.title,e.start_time?l.startTime=new Date(e.start_time).toLocaleString():l.startTime="无限制",e.end_time?l.endTime=new Date(e.end_time).toLocaleString():l.endTime="无限制",e.update_time?l.updateTime=new Date(e.update_time).toLocaleString():l.updateTime="",e.create_time?l.createTime=new Date(e.create_time).toLocaleString():l.createTime="",e.description?l.description=e.description:l.description="",l.problems=e.problems,l}function us(e){return N({url:"/collection?id="+e,method:"get"})}function is(e){return N({url:"/collection/edit?id="+e,method:"get"})}function ds(e,l){return N({url:"/collection/list?page="+e+"&page_size="+l,method:"get"})}function cs(e){return N({url:"/collection/rank?id="+e,method:"get"})}function ms(e){return N({url:"/collection/create",method:"post",data:e})}function ps(e){return N({url:"/collection/edit",method:"post",data:e})}function fs(e){return N({url:"/collection/join",method:"post",data:{id:e}})}function vs(e){return N({url:"/collection/quit",method:"post",data:{id:e}})}const _s={style:{margin:"10px"}},gs=de({__name:"CollectionList",setup(e){const l=Se(),n=Xe(),{globalProperties:u}=_e();let o=null;p(!1),p(!1);const y=p([{title:"ID",colKey:"id",width:"100",cell:(h,b)=>t(G,{variant:"text",onClick:()=>P(b.row.id)},{default:()=>[b.row.id]})},{title:"标题",colKey:"title",cell:(h,b)=>t(G,{variant:"text",onClick:()=>P(b.row.id)},{default:()=>[b.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),v=p(!1);let k=1,f=50;const s=p({current:k,pageSize:f,defaultCurrent:k,defaultPageSize:f,total:0,pageSizeOptions:[50,100]}),V=p(),c=p({title:"",username:""});p({title:"",description:"",open_time:[]});const P=h=>{h&&n.push({path:"/collection/"+h})},g=async()=>{await n.push({query:{...l.query,title:c.value.title,username:c.value.username,page:1,page_size:s.value.defaultPageSize}})},_=async(h,b)=>{var i;v.value=!0;try{const{current:r,pageSize:R}=h,I=await ds(r,R);if(V.value=[],I.code===0){const w=I.data.list;for(let $=0;$<w.length;$++){const S=w[$],T=Jt(S);(i=V.value)==null||i.push(T)}s.value={...s.value,total:I.data.total_count}}else b&&F(u,I.code)}catch(r){console.error(r),F(u,Ne())}finally{v.value=!1}},m=async h=>{await n.push({query:{...l.query,page:h.current,page_size:h.pageSize}})},d=async()=>{await n.push({name:"collection-create"})};return fe(async()=>{o=$e(()=>l.query,h=>{c.value.title=h.title||"",c.value.username=h.username||"";const b=parseInt(h.page)||s.value.defaultCurrent,i=parseInt(h.page_size)||s.value.defaultPageSize;k=b,f=i,s.value={...s.value,current:k,pageSize:f},_({current:k,pageSize:f},!0)},{immediate:!0})}),De(()=>{o&&o()}),(h,b)=>{const i=Ee,r=he,R=Ve,I=Ae,w=ze,$=G,S=Ue,T=we,z=Ie;return D(),M(z,null,{default:a(()=>[t(R,{span:9},{default:a(()=>[t(r,{style:{margin:"10px"}},{default:a(()=>[t(i,{data:V.value,columns:y.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:s.value,loading:v.value,onPageChange:m},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(R,{span:3},{default:a(()=>[U("div",_s,[t(r,{class:"sh-card"},{default:a(()=>[t(S,{model:c.value},{default:a(()=>[t(w,{label:"标题"},{default:a(()=>[t(I,{modelValue:c.value.title,"onUpdate:modelValue":b[0]||(b[0]=A=>c.value.title=A),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(w,{label:"负责人"},{default:a(()=>[t(I,{modelValue:c.value.username,"onUpdate:modelValue":b[1]||(b[1]=A=>c.value.username=A),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(w,null,{default:a(()=>[t($,{theme:"primary",onClick:g},{default:a(()=>b[2]||(b[2]=[x("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(r,{class:"sh-card"},{default:a(()=>[t(T,null,{default:a(()=>[t($,{onClick:d},{default:a(()=>b[3]||(b[3]=[x("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),bs=ce(gs,[["__scopeId","data-v-cffb6215"]]),hs={style:{margin:"20px"}},ys={class:"dida-operation-container"},ws={style:{margin:"12px"}},ks=de({__name:"CollectionDetail",setup(e){let l=Se();const{globalProperties:n}=_e(),u=Ze(),o=Fe();let y=0;const v=p(!1),k=p(null),f=p(!1),s=p(!1);let V={};const c=Be(()=>o.hasAuth(je.ManageCollection)||k.value&&o.getUserId==k.value.ownerId),P=b=>{if(!b||!V)return"default";const i=V[b];if(!i)return"default";switch(i){case Oe.Accept:return"success";case Oe.Attempt:return"warning";default:return"default"}},g=p([{title:"问题ID",colKey:"id",cell:(b,i)=>{const r=P(i.row.id);return t(G,{variant:"dashed",theme:r,onClick:()=>ta(i.row.id)},{default:()=>[i.row.id]})}},{title:"标题",colKey:"title",cell:(b,i)=>t(G,{variant:"text",onClick:()=>ta(i.row.id)},{default:()=>[i.row.title]})},{title:"正确",colKey:"accept",cell:(b,i)=>i.row.accept?i.row.accept:0},{title:"提交",colKey:"attempt",cell:(b,i)=>i.row.attempt?i.row.attempt:0}]),_=p([]),m=async()=>{if(!o.isLogin()){await X.push({name:"login"});return}s.value=!0;try{const b=await fs(y);if(b.code!==0){F(n,b.code);return}f.value=!0,Ke(n,"加入成功")}finally{s.value=!1}},d=async()=>{if(!o.isLogin()){await X.push({name:"login"});return}s.value=!0;try{const b=await vs(y);if(b.code!==0){F(n,b.code);return}f.value=!1,Ke(n,"退出成功")}finally{s.value=!1}},h=()=>{k.value&&X.push({name:"collection-edit",params:{collectionId:k.value.id}})};return fe(async()=>{if(Array.isArray(l.params.collectionId)?y=Number(l.params.collectionId[0]):y=Number(l.params.collectionId),!y){await X.push({name:"problem-collection-list"});return}f.value=!1,v.value=!0;const b=await us(y);if(b.code!==0){v.value=!1,F(n,b.code),await X.push({name:"problem-collection-list"});return}f.value=b.data.joined,V=b.data.attempt_status||{},k.value=Jt(b.data.collection),_.value=[],b.data.collection.problems&&b.data.collection.problems.forEach(i=>{const r=b.data.problems.find(R=>R.id===i);_.value.push(r)}),u.setTitle(k.value.title+" - "+u.getTitle),v.value=!1}),(b,i)=>{const r=Sa,R=ka,I=Ee,w=he,$=Ve,S=G,T=we,z=We,A=Je,L=Re("md-preview"),C=Ie,j=Te;return D(),M(j,{loading:v.value},{default:a(()=>[t(C,{class:"dida-main-content"},{default:a(()=>[t($,{span:6},{default:a(()=>[U("div",hs,[t(R,{"max-item-width":"300"},{default:a(()=>[t(r,{to:{name:"problem-collection-list"}},{default:a(()=>i[0]||(i[0]=[x("题目集合")])),_:1}),t(r,null,{default:a(()=>{var E;return[x(q((E=k.value)==null?void 0:E.title),1)]}),_:1})]),_:1})]),t(w,{style:{margin:"10px"}},{default:a(()=>[t(I,{data:_.value,columns:g.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),_:1})]),_:1}),t($,{span:6},{default:a(()=>{var E;return[U("div",ys,[t(T,null,{default:a(()=>[f.value?(D(),M(S,{key:0,onClick:d,loading:s.value},{default:a(()=>i[1]||(i[1]=[x("退出")])),_:1},8,["loading"])):(D(),M(S,{key:1,onClick:m,loading:s.value},{default:a(()=>i[2]||(i[2]=[x("加入")])),_:1},8,["loading"])),c.value?(D(),M(S,{key:2,onClick:h},{default:a(()=>i[3]||(i[3]=[x("编辑")])),_:1})):le("",!0)]),_:1})]),U("div",ws,[t(A,{layout:"vertical",bordered:!0},{default:a(()=>[t(z,{label:"创建者"},{default:a(()=>{var H;return[x(q((H=k.value)==null?void 0:H.ownerNickname),1)]}),_:1})]),_:1}),t(A,{layout:"vertical",bordered:!0},{default:a(()=>[t(z,{label:"开始时间"},{default:a(()=>{var H;return[x(q((H=k.value)==null?void 0:H.startTime),1)]}),_:1})]),_:1}),t(A,{layout:"vertical",bordered:!0},{default:a(()=>[t(z,{label:"结束时间"},{default:a(()=>{var H;return[x(q((H=k.value)==null?void 0:H.endTime),1)]}),_:1})]),_:1})]),(E=k.value)!=null&&E.description?(D(),M(w,{key:0,style:{margin:"10px"}},{default:a(()=>{var H;return[t(L,{"model-value":(H=k.value)==null?void 0:H.description},null,8,["model-value"])]}),_:1})):le("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),Ss=ce(ks,[["__scopeId","data-v-042bd4bb"]]),Cs=de({__name:"CollectionRank",setup(e){const l=Se(),n=Xe(),{globalProperties:u}=_e();let o=null,y=0,v=0;const k=p([{title:"Rank",colKey:"rank",align:"center"},{title:"序号",colKey:"index",align:"center"},{title:"Username",colKey:"username",cell:(P,g)=>t(G,{variant:"text",onClick:()=>n.push({name:"user",params:{username:g.row.username}})},{default:()=>[g.row.username]})},{title:"昵称",colKey:"nickname",cell:(P,g)=>t(G,{variant:"text",onClick:()=>n.push({name:"user",params:{username:g.row.username}})},{default:()=>[g.row.nickname]})},{title:"Count",colKey:"count",cell:(P,g)=>t(G,{variant:"text",onClick:()=>n.push({name:"judge-list",query:{username:g.row.username,status:He.Accept}})},{default:()=>[`${g.row.accept} / ${v}`]})},{title:"Progress",colKey:"progress",cell:(P,g)=>{let _=100;return v>0&&(_=Number((g.row.accept/v*100).toFixed(2))),t(qt,{percentage:_},null)}}]),f=p(!1),s=p([]),V=({col:P,rowIndex:g})=>{let _=1;for(let m=g+1;m<s.value.length&&s.value[m].rank===s.value[g].rank;m++)_++;if(P.colKey==="rank")return{rowspan:_}},c=async P=>{f.value=!0;try{const g=await cs(y);if(s.value=[],g.code===0){v=g.data.problem;const _=g.data.ranks,m=[];if(_){for(let b=0;b<_.length;b++){const i=_[b];let r={userId:i.author_id,username:i.author_username,nickname:i.author_nickname};r.accept=i.accept,m.push(r)}m.sort((b,i)=>b.accept!==i.accept?i.accept-b.accept:b.userId-i.userId);let d=0,h=-1;for(let b=0;b<m.length;b++)m[b].accept!==h&&(d=b+1,h=m[b].accept),m[b].index=b+1,m[b].rank=d}s.value=m}else P&&F(u,g.code)}catch(g){console.error(g),F(u,Ne())}finally{f.value=!1}};return fe(async()=>{o=$e(()=>l.query,async()=>{if(Array.isArray(l.params.collectionId)?y=Number(l.params.collectionId[0]):y=Number(l.params.collectionId),!y){await n.push({name:"problem-collection-list"});return}await c(!0)},{immediate:!0})}),De(()=>{o&&o()}),(P,g)=>{const _=Ee,m=he,d=Ie;return D(),M(d,null,{default:a(()=>[t(m,{style:{margin:"10px"}},{default:a(()=>[U("div",null,[t(_,{data:s.value,columns:k.value,"row-key":"index","rowspan-and-colspan":V,"vertical-align":"middle",bordered:!0,hover:!0,loading:f.value},null,8,["data","columns","loading"])])]),_:1})]),_:1})}}});var qe=(e=>(e[e.Valid=0]="Valid",e[e.Duplicate=1]="Duplicate",e[e.Invalid=2]="Invalid",e))(qe||{});const Is={class:"dida-form-border"},Ps={style:{"text-align":"right"}},xs=de({name:"ParseProblemList",__name:"ParseProblemList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:l}=_e(),n=p(!1),u=p(!1),o=p(""),y=ba(e,"modelValue");let v=[];$e(y,async P=>{JSON.stringify(P)!==JSON.stringify(v)&&(await s(P),v=y.value)},{deep:!0});const k=p([]),f=p([{title:"有效性",colKey:"validType",cell:(P,g)=>{switch(g.row.valid){case qe.Valid:return t(et,{theme:"success"},{default:()=>[x("有效")]});case qe.Duplicate:return t(et,{theme:"warning"},{default:()=>[x("重复")]});case qe.Invalid:return t(et,{theme:"danger"},{default:()=>[x("无效")]});default:return null}}},{title:"问题ID",colKey:"id"},{title:"标题",colKey:"title"}]),s=async P=>{const g=Array.from(new Set(P)),_=await Tn(g);if(_.code!==0){F(l,_.code),u.value=!1;return}const m=[],d=_.data.problems;let h=[];P.forEach(b=>{const i=d.find(r=>r.id===b);if(i){const r=m.find(R=>R.id===b);i.valid=r?qe.Duplicate:qe.Valid,m.push({id:b,title:i.title,valid:i.valid}),r||h.push(b)}else m.push({id:b,title:"-",valid:qe.Invalid})}),k.value=m,v=h,y.value=h},V=async()=>{u.value=!0;const P=Pa(o.value);await s(P),n.value=!1,u.value=!1},c=()=>{k.value?o.value=k.value.map(P=>P.id).join(`
`):o.value="",n.value=!0};return(P,g)=>{const _=G,m=Ee,d=It,h=nt;return D(),ae(pe,null,[U("div",Is,[U("div",Ps,[t(_,{onClick:c},{default:a(()=>g[2]||(g[2]=[x("编辑")])),_:1})]),t(m,{data:k.value,columns:f.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(h,{visible:n.value,"onUpdate:visible":g[1]||(g[1]=b=>n.value=b),onConfirm:V,header:"请输入问题ID","confirm-loading":u.value},{default:a(()=>[g[3]||(g[3]=U("div",{style:{"margin-bottom":"10px"}},[U("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(d,{modelValue:o.value,"onUpdate:modelValue":g[0]||(g[0]=b=>o.value=b),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Ea=ce(xs,[["__scopeId","data-v-b0352688"]]),Vs={class:"dida-form-border"},Ts={style:{"text-align":"right"}},Ds=de({name:"ParseUserList",__name:"ParseUserList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:l}=_e(),n=p(!1),u=p(!1),o=p(""),y=ba(e,"modelValue");let v=[];$e(y,async _=>{JSON.stringify(_)!==JSON.stringify(v)&&(v=_,await V(_))},{deep:!0});const k=p(),f=p([{title:"有效性",colKey:"validType",cell:(_,m)=>{switch(m.row.valid){case qe.Valid:return t(et,{theme:"success"},{default:()=>[x("有效")]});case qe.Duplicate:return t(et,{theme:"warning"},{default:()=>[x("重复")]});case qe.Invalid:return t(et,{theme:"danger"},{default:()=>[x("无效")]})}}},{title:"Username",colKey:"username"},{title:"昵称",colKey:"nickname"}]),s=(_,m)=>{if(_.code!==0){F(l,_.code),u.value=!1;return}const d=[],h=_.data.users;let b=[];m?m.forEach(i=>{let r=null;if(h&&(r=h.find(R=>R.username.toLowerCase()===i.toLowerCase())),r){const R=d.find(w=>w.username.toLowerCase()===i.toLowerCase()),I=R?qe.Duplicate:qe.Valid;d.push({id:r.id,username:r.username,nickname:r.nickname,valid:I}),R||b.push(r.id)}else d.push({id:-1,username:i,nickname:"-",valid:qe.Invalid})}):h&&h.forEach(i=>{const r=d.find(I=>I.id===i.id),R=r?qe.Duplicate:qe.Valid;d.push({id:i.id,username:i.username,nickname:i.nickname,valid:R}),r||b.push(i.id)}),k.value=d,v=b,y.value=b},V=async _=>{const m=Array.from(new Set(_)),d=await Kn(m);s(d)},c=async _=>{const m=Array.from(new Set(_)),d=await Fn(m);s(d,_)},P=async()=>{u.value=!0;const _=Pa(o.value);await c(_),n.value=!1,u.value=!1},g=()=>{k.value?o.value=k.value.map(_=>_.username).join(`
`):o.value="",n.value=!0};return(_,m)=>{const d=G,h=Ee,b=It,i=nt;return D(),ae(pe,null,[U("div",Vs,[U("div",Ts,[t(d,{onClick:g},{default:a(()=>m[2]||(m[2]=[x("编辑")])),_:1})]),t(h,{data:k.value,columns:f.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(i,{visible:n.value,"onUpdate:visible":m[1]||(m[1]=r=>n.value=r),onConfirm:P,header:"请输入用户Username","confirm-loading":u.value},{default:a(()=>[m[3]||(m[3]=U("div",{style:{"margin-bottom":"10px"}},[U("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(b,{modelValue:o.value,"onUpdate:modelValue":m[0]||(m[0]=r=>o.value=r),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Ma=ce(Ds,[["__scopeId","data-v-b0b99852"]]),Ls={style:{margin:"10px"}},js={style:{margin:"12px"}},$s={class:"dida-edit-container"},Us=de({__name:"CollectionEdit",setup(e){let l=Se();const{globalProperties:n}=_e(),u=Ze(),o=p(""),y=p(!1),v=p(!1),k=p(!1),f=p(null),s=p({title:"",openTime:[],private:!0,problems:[],members:[],description:""}),V=p(""),c=p(""),P=p(!1),g=async()=>{P.value=!0,k.value=!1,P.value=!1},_=async()=>{v.value=!0;try{const i={title:s.value.title,problems:s.value.problems,members:s.value.members,private:s.value.private,description:s.value.description};s.value.openTime[0]&&(i.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(i.end_time=new Date(s.value.openTime[1]));const r=await ms(i);if(r.code!==0){F(n,r.code);return}r.data!=null&&await X.push({name:"collection-detail",params:{collectionId:r.data}}),Ke(n,"创建成功")}finally{v.value=!1}},m=async()=>{v.value=!0;try{const i={id:Number(o.value),title:s.value.title,private:s.value.private,problems:s.value.problems,members:s.value.members,description:s.value.description};s.value.openTime[0]&&(i.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(i.end_time=new Date(s.value.openTime[1]));const r=await ps(i);if(r.code!==0){F(n,r.code);return}r.data!=null&&f.value&&(f.value.updateTime=new Date(r.data).toLocaleString()),Ke(n,"保存成功")}finally{v.value=!1}},d=i=>{s.value.description=i,y.value=!1};async function h(i,r){v.value=!0,ge(n,"本界面暂不支持上传图片"),v.value=!1}const b=async()=>{const i=await is(o.value);if(i.code!==0){F(n,i.code),console.error("collection get failed",i.code),await X.push({name:"problem-collection-list"});return}const r=i.data.collection;f.value=Jt(r),s.value.title=r.title,s.value.openTime=[],r.start_time?s.value.openTime.push(new Date(r.start_time)):s.value.openTime.push(""),r.end_time?s.value.openTime.push(new Date(r.end_time)):s.value.openTime.push(""),s.value.private=r.private,s.value.description=r.description,s.value.problems=r.problems,s.value.members=r.members,u.setTitle(r.title+" - "+u.getTitle);let R="";r.description&&(R=r.description),d(R)};return fe(async()=>{Array.isArray(l.params.collectionId)?o.value=l.params.collectionId[0]:o.value=l.params.collectionId,o.value?(y.value=!0,await b()):d("")}),(i,r)=>{const R=Ae,I=ze,w=Ft,$=vt,S=Ue,T=he,z=Ve,A=G,L=we,C=We,j=Je,E=Ie,H=Re("md-editor-v3"),Z=Te,Q=It,ee=nt;return D(),ae(pe,null,[t(Z,{loading:y.value},{default:a(()=>[t(E,null,{default:a(()=>[t(z,{span:8},{default:a(()=>[U("div",Ls,[t(T,{class:"sh-card"},{default:a(()=>[t(S,{model:s.value},{default:a(()=>[t(I,{label:"标题"},{default:a(()=>[t(R,{modelValue:s.value.title,"onUpdate:modelValue":r[0]||(r[0]=te=>s.value.title=te),placeholder:"题集标题"},null,8,["modelValue"])]),_:1}),t(I,{label:"开启时间"},{default:a(()=>[t(w,{modelValue:s.value.openTime,"onUpdate:modelValue":r[1]||(r[1]=te=>s.value.openTime=te),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(I,{label:"私有"},{default:a(()=>[t($,{modelValue:s.value.private,"onUpdate:modelValue":r[2]||(r[2]=te=>s.value.private=te)},null,8,["modelValue"])]),_:1}),t(I,{label:"成员"},{default:a(()=>[t(Ma,{modelValue:s.value.members,"onUpdate:modelValue":r[3]||(r[3]=te=>s.value.members=te)},null,8,["modelValue"])]),_:1}),t(I,{label:"问题"},{default:a(()=>[t(Ea,{modelValue:s.value.problems,"onUpdate:modelValue":r[4]||(r[4]=te=>s.value.problems=te)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(z,{span:4},{default:a(()=>[U("div",js,[U("div",$s,[o.value?(D(),M(L,{key:0},{default:a(()=>[t(A,{onClick:m,theme:"danger",loading:v.value},{default:a(()=>r[8]||(r[8]=[x("保存")])),_:1},8,["loading"])]),_:1})):(D(),M(L,{key:1},{default:a(()=>[t(A,{onClick:_,theme:"danger",loading:v.value},{default:a(()=>r[9]||(r[9]=[x("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(D(),M(j,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(C,{label:"创建时间"},{default:a(()=>{var te;return[x(q((te=f.value)==null?void 0:te.createTime),1)]}),_:1}),t(C,{label:"更新时间"},{default:a(()=>{var te;return[x(q((te=f.value)==null?void 0:te.updateTime),1)]}),_:1}),t(C,{label:"创建用户"},{default:a(()=>{var te;return[x(q((te=f.value)==null?void 0:te.ownerNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),t(H,{id:"collection-description-editor",modelValue:s.value.description,"onUpdate:modelValue":r[5]||(r[5]=te=>s.value.description=te),onSave:m,onOnUploadImg:h,previewTheme:"cyanosis",class:"dida-description-editor"},null,8,["modelValue"]),t(Z,{loading:v.value,attach:"#collection-description-editor","z-index":1e5},null,8,["loading"])]),_:1},8,["loading"]),t(ee,{visible:k.value,"onUpdate:visible":r[7]||(r[7]=te=>k.value=te),onConfirm:g,header:V.value,"confirm-loading":P.value},{default:a(()=>[r[10]||(r[10]=U("div",{style:{"margin-bottom":"10px"}},[U("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(Q,{modelValue:c.value,"onUpdate:modelValue":r[6]||(r[6]=te=>c.value=te),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),oa=ce(Us,[["__scopeId","data-v-79ccaf8c"]]);function sa(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const zs=de({__name:"JudgeJobList",setup(e){const l=Se(),n=Xe(),{globalProperties:u}=_e();let o=!1,y=null,v;const k=p(!1),f=p(null),s=p(!1);let V=-1;const c=p({problemId:"",username:"",language:void 0,status:void 0}),P=p([{title:"ID",colKey:"id",cell:(L,C)=>{let j=null;return wt(C.row.status)&&yt(C.row.language)&&(j=()=>{w(C.row.id)}),t(G,{variant:"text",onClick:j},{default:()=>[C.row.id]})}},{title:"问题",colKey:"problemId",cell:(L,C)=>{if(V){let j;return t(G,{variant:"text",onClick:()=>I(V,C.row.contestProblemIndex)},sa(j=at(C.row.contestProblemIndex))?j:{default:()=>[j]})}return t(G,{variant:"text",onClick:()=>R(C.row.problemId)},{default:()=>[C.row.problemId]})}},{title:"状态",colKey:"status",align:"center",cell:(L,C)=>{let j=null;wt(C.row.status)&&yt(C.row.language)&&(j=()=>{w(C.row.id)});const E=C.row.status,H=St(E);let Z=!wt(E);const Q=Ta(E);let ee=[];return ut(E)&&ee.push(t(Te,{text:C.row.state,size:"small",class:"dida-status-loading"},null)),ee.push(t("span",null,[H])),t(G,{theme:Q,variant:"outline",onClick:j,disabled:Z},sa(ee)?ee:{default:()=>[ee]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"code",cell:(L,C)=>{let j=!yt(C.row.language);return t(G,{theme:"default",onClick:()=>r(C.row),disabled:j},{default:()=>[kt(C.row.language)+" / "+C.row.codeLength]})}},{title:"作者",colKey:"author",width:200,cell:(L,C)=>t(G,{variant:"text",onClick:()=>$(C.row.authorUsername)},{default:()=>[C.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),g=p(!1);let _=1,m=50;const d=p({current:_,pageSize:m,defaultCurrent:_,defaultPageSize:m,total:0,pageSizeOptions:[50,100]}),h=p(),b=p([]);b.value=Ot();const i=p([]);i.value=Da();const r=async L=>{s.value=!0,k.value=!0;try{f.value=L;const C=await on(Number(f.value.id));if(C.code===0){const j=C.data,E=Gt(j.language);f.value.code=`\`\`\`${E}
${j.code}
\`\`\``}else F(u,C.code)}finally{s.value=!1}},R=L=>{L&&n.push({path:"/problem/"+L})},I=(L,C)=>{n.push({name:"contest-problem-detail",params:{contestId:L,problemIndex:C}})},w=L=>{L&&(V>0?n.push({name:"contest-judge-detail",params:{contestId:V,judgeId:L}}):n.push({name:"judge-detail",params:{judgeId:L}}))},$=L=>{L&&n.push({path:"/user/"+L})},S=async()=>{await n.push({query:{...l.query,page:1,page_size:m,problem_id:c.value.problemId,username:c.value.username,language:c.value.language,status:c.value.status}})},T=async()=>{c.value.problemId="",c.value.username="",c.value.language=void 0,c.value.status=void 0,await n.push({query:{...l.query,page:1,page_size:m,problem_id:"",username:"",language:void 0,status:void 0}})},z=async(L,C)=>{C&&(g.value=!0);let j=!1;try{const{current:E,pageSize:H}=L,Z=await sn(V,c.value.problemId,c.value.username,c.value.language,c.value.status,E,H);if(h.value=[],Z.code===0){if(!Z.data.has_auth){ke(u,"您目前没有权限查看评测记录"),V?await n.push({name:"contest-detail",params:{contestId:V}}):await n.push({name:"judge-list"});return}Z.data.list&&Z.data.list.length>0?(Z.data.list.forEach(ee=>{var O;const te=La(ee);(O=h.value)==null||O.push(te),ut(ee.status)&&(j=!0)}),d.value={...d.value,total:Z.data.total_count}):(ke(u,"未找到记录"),d.value={...d.value,total:0})}else C&&F(u,Z.code)}catch(E){console.error(E),C&&F(u,Ne())}finally{C&&(g.value=!1),j&&o&&(v=setTimeout(()=>{z({current:_,pageSize:m},!1)},5e3))}},A=async L=>{await n.push({query:{...l.query,page:L.current,page_size:L.pageSize}})};return fe(async()=>{o=!0,y=$e(()=>l.query,L=>{Array.isArray(l.params.contestId)?V=Number(l.params.contestId[0]):V=Number(l.params.contestId),c.value.problemId=L.problem_id||"",c.value.username=L.username||"",L.language!=null?c.value.language=Number(L.language):c.value.language=void 0,L.status!=null?c.value.status=Number(L.status):c.value.status=void 0;const C=parseInt(L.page)||d.value.defaultCurrent,j=parseInt(L.page_size)||d.value.defaultPageSize;_=C,m=j,d.value.pageSizeOptions.includes(m)||(m=d.value.defaultPageSize),d.value={...d.value,current:_,pageSize:m},z({current:_,pageSize:m},!0)},{immediate:!0})}),De(()=>{o=!1,y&&y(),clearTimeout(v)}),(L,C)=>{const j=Ae,E=ze,H=Kt,Z=ft,Q=G,ee=we,te=Ue,O=Ee,me=he,ue=lt,J=Re("md-preview"),W=Te,ne=nt;return D(),ae(pe,null,[t(me,{style:{margin:"10px"}},{default:a(()=>[t(te,{layout:"inline",onSubmit:S,onReset:T},{default:a(()=>[t(E,{label:"题号"},{default:a(()=>[t(j,{modelValue:c.value.problemId,"onUpdate:modelValue":C[0]||(C[0]=K=>c.value.problemId=K),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(E,{label:"用户"},{default:a(()=>[t(j,{modelValue:c.value.username,"onUpdate:modelValue":C[1]||(C[1]=K=>c.value.username=K),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(E,{label:"语言"},{default:a(()=>[t(Z,{modelValue:c.value.language,"onUpdate:modelValue":C[2]||(C[2]=K=>c.value.language=K),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:a(()=>[(D(!0),ae(pe,null,Pe(b.value,K=>(D(),M(H,{key:K.value,value:K.value,label:K.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(E,{label:"状态"},{default:a(()=>[t(Z,{modelValue:c.value.status,"onUpdate:modelValue":C[3]||(C[3]=K=>c.value.status=K),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:a(()=>[(D(!0),ae(pe,null,Pe(i.value,K=>(D(),M(H,{key:K.value,value:K.value,label:K.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(E,null,{default:a(()=>[t(ee,null,{default:a(()=>[t(Q,{theme:"primary",type:"submit"},{default:a(()=>C[7]||(C[7]=[x("搜索")])),_:1}),t(Q,{theme:"default",variant:"base",type:"reset"},{default:a(()=>C[8]||(C[8]=[x("重置")])),_:1})]),_:1})]),_:1})]),_:1}),t(O,{data:h.value,columns:P.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:d.value,loading:g.value,onPageChange:A,"table-layout":"auto"},null,8,["data","columns","pagination","loading"])]),_:1}),t(ne,{visible:k.value,"onUpdate:visible":C[5]||(C[5]=K=>k.value=K),width:"800px","cancel-btn":null,"close-btn":!1,onConfirm:C[6]||(C[6]=K=>k.value=!1)},{header:a(()=>[t(ue,{onClick:C[4]||(C[4]=()=>{var K;w((K=f.value)==null?void 0:K.id)})},{default:a(()=>{var K,B,ie;return[x(q(((K=f.value)==null?void 0:K.id)+" - "+ve(kt)((B=f.value)!=null&&B.language?(ie=f.value)==null?void 0:ie.language:ve(Vt).Unknown)),1)]}),_:1})]),default:a(()=>[t(W,{loading:s.value},{default:a(()=>{var K;return[t(J,{"model-value":(K=f.value)==null?void 0:K.code,"code-foldable":!1,style:{"min-height":"100px"}},null,8,["model-value"])]}),_:1},8,["loading"])]),_:1},8,["visible"])],64)}}}),ra=ce(zs,[["__scopeId","data-v-05589c5c"]]),As={class:"dida-code-container"},Rs={style:{margin:"20px"}},Es={key:2,class:"dida-edit-container"};function ua(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const Ms=de({__name:"JudgeJobDetail",setup(e){const l=Se(),n=Xe(),u=Fe(),{globalProperties:o}=_e();let y=!1,v,k=0,f=0;const s=p(""),V=p(null),c=p(""),P=p(0),g=p(null),_=p({from:"#5a96ff",to:"#00A870"}),m=p([{title:"ID",colKey:"id"},{title:"问题",colKey:"problemId",cell:(S,T)=>t(G,{variant:"text",onClick:()=>R(T.row.problemId)},{default:()=>[T.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(S,T)=>{const z=T.row.status,A=St(z),L=Ta(z);let C=[];return ut(z)&&C.push(t(Te,{text:T.row.state,size:"small",class:"dida-status-loading"},null)),C.push(t("span",null,[A])),t(G,{theme:L,variant:"outline"},ua(C)?C:{default:()=>[C]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"language",cell:(S,T)=>t("span",null,[kt(T.row.language)+" / "+T.row.codeLength])},{title:"作者",colKey:"author",width:200,cell:(S,T)=>t(G,{variant:"text",onClick:()=>I(T.row.authorUsername)},{default:()=>[T.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),d=p(!1),h=p(!1),b=p(),i=Be(()=>u.hasAuth(je.ManageJudge)),r=async()=>{if(!h.value){h.value=!0;try{const S=await mn(k);S.code===0?await $(!0):F(o,S.code)}catch(S){console.error(S),F(o,Ne())}finally{h.value=!1}}},R=S=>{S&&n.push({path:"/problem/"+S})},I=S=>{S&&n.push({path:"/user/"+S})},w=S=>{const T=S.status,z=St(T);let A;switch(T){case He.Init:case He.Rejudge:case He.Compiling:case He.Running:A="default";break;case He.Accept:A="success";break;case He.PE:A="warning";break;default:A="danger";break}return t(we,null,{default:()=>[t(G,{theme:"default",variant:"outline"},{default:()=>[S.taskId]}),t(G,{theme:A,variant:"outline"},ua(z)?z:{default:()=>[z]}),t("span",null,[x("分数："),S.score]),t("span",null,[x("用时："),S.time]),t("span",null,[x("内存："),S.memory])]})},$=async S=>{var z;S&&(d.value=!0);let T=!1;try{const A=await nn(k);if(b.value=[],A.code===0){const L=A.data,C=La(L);if((z=b.value)==null||z.push(C),s.value=C.judgerName,_.value.to="#00A870",ut(L.status)?(g.value="active",C.taskTotal>0?(P.value=Number((C.taskCurrent/C.taskTotal*100).toFixed(2)),C.taskCurrent>=C.taskTotal&&(P.value=99)):P.value=0):(P.value=100,L.status===He.Accept?g.value="success":L.status===He.PE?(_.value.to="#F57C20",g.value="warning"):(_.value.to="#F56C6C",g.value="error")),L.code){const j=Gt(L.language);c.value=`\`\`\`${j}
${L.code}
\`\`\``}V.value=C,ut(L.status)&&(T=!0)}else S&&F(o,A.code),f?await n.push({name:"contest-judge",params:{contestId:f}}):await n.push({name:"judge-list"})}catch(A){console.error(A),S&&F(o,Ne())}finally{S&&(d.value=!1),T&&y&&(v=setTimeout(()=>{$(!1)},5e3))}};return fe(async()=>{if(y=!0,Array.isArray(l.params.judgeId)?k=Number(l.params.judgeId[0]):k=Number(l.params.judgeId),Array.isArray(l.params.contestId)?f=Number(l.params.contestId[0]):f=Number(l.params.contestId),!k){await n.push({name:"judge"});return}await $(!0)}),De(()=>{y=!1,clearTimeout(v)}),(S,T)=>{var O,me,ue;const z=qt,A=Ee,L=he,C=Re("md-preview"),j=Ve,E=We,H=Je,Z=Ie,Q=Sl,ee=Cl,te=G;return D(),ae(pe,null,[t(z,{color:_.value,status:g.value,class:"dida-job-progress",percentage:P.value},null,8,["color","status","percentage"]),t(L,{style:{margin:"10px"}},{default:a(()=>[t(A,{data:b.value,columns:m.value,"row-key":"id","vertical-align":"top",hover:!0,loading:d.value},null,8,["data","columns","loading"])]),_:1}),t(Z,null,{default:a(()=>[t(j,{span:8},{default:a(()=>[U("div",As,[t(C,{"model-value":c.value,class:"dida-code-div"},null,8,["model-value"])])]),_:1}),t(j,{span:4},{default:a(()=>[U("div",Rs,[t(H,{layout:"vertical",bordered:!0},{default:a(()=>[t(E,{label:"判题机"},{default:a(()=>[x(q(s.value),1)]),_:1}),t(E,{label:"判题时间"},{default:a(()=>{var J;return[x(q((J=V.value)==null?void 0:J.judgeTime),1)]}),_:1})]),_:1}),t(L,{class:"dida-card-tips"},{default:a(()=>{var J;return[x(q(d.value?"数据正在加载，请等待":ve(ea)((J=V.value)==null?void 0:J.status)),1)]}),_:1})])]),_:1})]),_:1}),(O=V.value)!=null&&O.compileMessage?(D(),M(L,{key:0,class:"compile-message"},{default:a(()=>{var J;return[x(q((J=V.value)==null?void 0:J.compileMessage),1)]}),_:1})):le("",!0),(me=V.value)!=null&&me.task&&((ue=V.value)==null?void 0:ue.task.length)>0?(D(),M(ee,{key:1,class:"task-panel"},{default:a(()=>{var J;return[(D(!0),ae(pe,null,Pe((J=V.value)==null?void 0:J.task,(W,ne)=>(D(),M(Q,{key:W.taskId,header:()=>w(W)},{default:a(()=>[t(L,null,{default:a(()=>[x(q(ve(ea)(W.status)),1)]),_:2},1024),W.content?(D(),M(L,{key:0,class:"dida-card-tips"},{default:a(()=>[t(C,{"model-value":W.content},null,8,["model-value"])]),_:2},1024)):le("",!0),W.waHint?(D(),M(L,{key:1,class:"dida-card-tips"},{default:a(()=>[t(C,{"model-value":W.waHint},null,8,["model-value"])]),_:2},1024)):le("",!0)]),_:2},1032,["header"]))),128))]}),_:1})):le("",!0),i.value?(D(),ae("div",Es,[t(te,{onClick:r,loading:h.value},{default:a(()=>T[0]||(T[0]=[x("重新评测")])),_:1},8,["loading"])])):le("",!0)],64)}}}),ia=ce(Ms,[["__scopeId","data-v-de3651b0"]]),qs={style:{margin:"10px"}},Ks=de({__name:"ContestList",setup(e){const l=Se(),n=Xe(),{globalProperties:u}=_e();let o=null;const y=p([{title:"ID",colKey:"id",cell:(b,i)=>t(G,{variant:"text",onClick:()=>P(i.row.id)},{default:()=>[i.row.id]})},{title:"标题",colKey:"title",cell:(b,i)=>t(G,{variant:"text",onClick:()=>P(i.row.id)},{default:()=>[i.row.title]})},{title:"负责人",colKey:"ownerNickname",cell:(b,i)=>t(G,{variant:"text",onClick:()=>Bt(n,i.row.ownerUsername)},{default:()=>[i.row.ownerNickname]})},{title:"权限",colKey:"private",cell:(b,i)=>i.row.private?"私有":"公开"},{title:"开始时间",colKey:"startTime"},{title:"结束时间",colKey:"endTime"}]),v=p(!1);let k=1,f=50;const s=p({current:k,pageSize:f,defaultCurrent:k,defaultPageSize:f,total:0,pageSizeOptions:[50,100]}),V=p(),c=p({title:"",username:""}),P=b=>{b&&n.push({path:"/contest/"+b})},g=async()=>{await n.push({query:{...l.query,title:c.value.title,username:c.value.username,page:1,page_size:s.value.defaultPageSize}})},_=async()=>{c.value.title="",c.value.username="",await n.push({query:{...l.query,title:"",username:"",page:1,page_size:s.value.defaultPageSize}})},m=async(b,i)=>{var r;v.value=!0;try{const{current:R,pageSize:I}=b,w=await ho(c.value.title,c.value.username,R,I);if(V.value=[],w.code===0){const $=w.data.list;for(let S=0;S<$.length;S++){const T=$[S],z=Ht(T);(r=V.value)==null||r.push(z)}s.value={...s.value,total:w.data.total_count}}else i&&F(u,w.code)}catch(R){console.error(R),F(u,Ne())}finally{v.value=!1}},d=async b=>{await n.push({query:{...l.query,page:b.current,page_size:b.pageSize}})},h=()=>{n.push({name:"contest-create"})};return fe(async()=>{o=$e(()=>l.query,b=>{c.value.title=b.title||"",c.value.username=b.username||"";const i=parseInt(b.page)||s.value.defaultCurrent,r=parseInt(b.page_size)||s.value.defaultPageSize;k=i,f=r,s.value={...s.value,current:k,pageSize:f},m({current:k,pageSize:f},!0)},{immediate:!0})}),De(()=>{o&&o()}),(b,i)=>{const r=Ee,R=he,I=Ve,w=Ae,$=ze,S=G,T=we,z=Ue,A=Ie;return D(),M(A,null,{default:a(()=>[t(I,{span:9},{default:a(()=>[t(R,{style:{margin:"10px"}},{default:a(()=>[t(r,{data:V.value,columns:y.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:s.value,loading:v.value,"table-layout":"auto",onPageChange:d,style:{"white-space":"nowrap"}},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(I,{span:3},{default:a(()=>[U("div",qs,[t(R,{class:"sh-card"},{default:a(()=>[t(z,{model:c.value,onSubmit:g,onReset:_},{default:a(()=>[t($,{label:"标题"},{default:a(()=>[t(w,{modelValue:c.value.title,"onUpdate:modelValue":i[0]||(i[0]=L=>c.value.title=L),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t($,{label:"负责人"},{default:a(()=>[t(w,{modelValue:c.value.username,"onUpdate:modelValue":i[1]||(i[1]=L=>c.value.username=L),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t($,null,{default:a(()=>[t(T,null,{default:a(()=>[t(S,{theme:"primary",type:"submit"},{default:a(()=>i[2]||(i[2]=[x("提交")])),_:1}),t(S,{theme:"danger",type:"reset"},{default:a(()=>i[3]||(i[3]=[x("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(R,{class:"sh-card"},{default:a(()=>[t(T,null,{default:a(()=>[t(S,{onClick:h},{default:a(()=>i[4]||(i[4]=[x("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),da=ce(Ks,[["__scopeId","data-v-dcab2ec1"]]),Fs={style:{margin:"20px"}},Os={style:{margin:"10px"}},Gs={style:{"text-align":"center","align-content":"center",padding:"20px",height:"500px"}},Ns={style:{"text-align":"center",width:"100%"}},Hs={class:"dida-operation-container"},Bs={style:{margin:"12px"}},Js=de({__name:"ContestDetail",setup(e){let l=Se();const{globalProperties:n}=_e(),u=Ze(),o=Fe(),y=p(!1);let v=0;const k=p(!1),f=p(null),s=p(!1),V=p(!1),c=p(""),P=Be(()=>o.hasAuth(je.ManageContest)||f.value&&o.getUserId==f.value.ownerId),g=I=>{if(!I||!d)return"default";const w=d[I];if(!w)return"default";switch(w){case Oe.Accept:return"success";case Oe.Attempt:return"warning";default:return"default"}},_=p([{title:"问题ID",colKey:"index",cell:(I,w)=>{const $=g(w.row.index);return t(G,{variant:"dashed",theme:$,onClick:async()=>await Mt(v,w.row.index)},{default:()=>[w.row.id]})}},{title:"标题",colKey:"title",cell:(I,w)=>t(G,{variant:"text",onClick:async()=>await Mt(v,w.row.index)},{default:()=>[w.row.title]})},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),m=p([]);let d={},h=p(!1);const b=()=>{X.push({name:"contest-edit",params:{contestId:v}})},i=async()=>{y.value=!0;try{const I=await Co(v);if(I.code!==0){F(n,I.code);return}const w=I.data;ke(n,"查重报告已生成，请前往查看"),window.open(w,"_blank")}finally{y.value=!1}},r=async I=>{if(!o.isLogin()){await X.push({name:"login"});return}if(!c.value){ge(n,"请输入密码");return}h.value=!0;try{const w=await So(v,c.value);if(w.code!==0){F(n,w.code);return}ke(n,"申请访问成功"),await R()}catch(w){console.error("Error submitting contest password:",w),F(n,"提交密码失败，请稍后再试")}finally{h.value=!1}},R=async()=>{k.value=!0;const I=await fo(v);if(I.code!==0){k.value=!1,F(n,I.code),await X.push({name:"contest"});return}s.value=I.data.has_auth,V.value=I.data.need_password,f.value=Ht(I.data.contest),m.value=f.value.problems,d=I.data.attempt_status||{},u.setTitle(f.value.title+" - "+u.getTitle),k.value=!1};return fe(async()=>{if(Array.isArray(l.params.contestId)?v=Number(l.params.contestId[0]):v=Number(l.params.contestId),!v){await X.push({name:"contest"});return}await R()}),(I,w)=>{const $=Ct,S=Ee,T=he,z=Ae,A=ze,L=G,C=Ue,j=Ve,E=we,H=We,Z=Je,Q=Re("md-preview"),ee=Ie,te=Te;return D(),M(te,{loading:k.value},{default:a(()=>[t(ee,{class:"dida-main-content"},{default:a(()=>[t(j,{span:6},{default:a(()=>{var O,me,ue;return[U("div",Fs,[U("h1",null,q((O=f.value)==null?void 0:O.title),1),(me=f.value)!=null&&me.notification?(D(),M($,{key:0,theme:"info",message:(ue=f.value)==null?void 0:ue.notification},null,8,["message"])):le("",!0)]),U("div",Os,[s.value?(D(),M(T,{key:0},{default:a(()=>[t(S,{data:m.value,columns:_.value,"row-key":"id","table-layout":"auto","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1})):(D(),M(T,{key:1},{default:a(()=>[U("div",Gs,[t($,{theme:"warning",message:"您没有查看本比赛的权限"}),V.value?(D(),M(C,{key:0,style:{margin:"20px auto 0",width:"200px"},onSubmit:r,"label-width":"0"},{default:a(()=>[t(A,null,{default:a(()=>[t(z,{placeholder:"请输入密码",value:c.value,"onUpdate:value":w[0]||(w[0]=J=>c.value=J),style:{width:"300px"},type:"password",autocomplete:"new-password"},null,8,["value"])]),_:1}),t(A,null,{default:a(()=>[U("div",Ns,[t(L,{theme:"primary",type:"submit",loading:ve(h)},{default:a(()=>w[1]||(w[1]=[x("提交")])),_:1},8,["loading"])])]),_:1})]),_:1})):le("",!0)])]),_:1}))])]}),_:1}),t(j,{span:6},{default:a(()=>{var O;return[U("div",Hs,[t(E,null,{default:a(()=>[P.value?(D(),M(L,{key:0,onClick:i,loading:y.value},{default:a(()=>w[2]||(w[2]=[x("查重")])),_:1},8,["loading"])):le("",!0),P.value?(D(),M(L,{key:1,onClick:b},{default:a(()=>w[3]||(w[3]=[x("编辑")])),_:1})):le("",!0)]),_:1})]),U("div",Bs,[t(Z,{layout:"vertical",bordered:!0},{default:a(()=>[t(H,{label:"创建时间"},{default:a(()=>{var me;return[x(q((me=f.value)==null?void 0:me.createTime),1)]}),_:1})]),_:1}),t(Z,{layout:"vertical",bordered:!0},{default:a(()=>[t(H,{label:"更新时间"},{default:a(()=>{var me;return[x(q((me=f.value)==null?void 0:me.updateTime),1)]}),_:1})]),_:1}),t(Z,{layout:"vertical",bordered:!0},{default:a(()=>[t(H,{label:"开始时间"},{default:a(()=>{var me;return[x(q((me=f.value)==null?void 0:me.startTime),1)]}),_:1})]),_:1}),t(Z,{layout:"vertical",bordered:!0},{default:a(()=>[t(H,{label:"结束时间"},{default:a(()=>{var me;return[x(q((me=f.value)==null?void 0:me.endTime),1)]}),_:1})]),_:1})]),(O=f.value)!=null&&O.description?(D(),M(T,{key:0,style:{margin:"12px"}},{default:a(()=>{var me;return[t(Q,{"model-value":(me=f.value)==null?void 0:me.description,class:"dida-content-description"},null,8,["model-value"])]}),_:1})):le("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),Ws=ce(Js,[["__scopeId","data-v-af022b1b"]]);function qa(e){return e?Math.floor(e/1e9):0}function rt(e){if(e<=0)return"0秒";let l="";const n=Math.floor(e/3600);n>0&&(l+=`${n}小时`);const u=Math.floor(e%3600/60);return(u>0||n>0)&&(n>0&&u<10&&(l+="0"),l+=`${u}分钟`),e=e%60,(e>0||u>0||n>0)&&((n>0||u>0)&&e<10&&(l+="0"),l+=`${e.toFixed(0)}秒`),l}const Ys=pt("contest",{state:()=>({starMembers:{}}),actions:{clear(){this.$patch({starMembers:{}})},addStarMember(e,l){this.starMembers[e]||(this.starMembers[e]={}),this.starMembers[e][l]=!0},removeStarMember(e,l){this.starMembers[e]&&(delete this.starMembers[e][l],Object.keys(this.starMembers[e]).length===0&&delete this.starMembers[e])},isStarMember(e,l){var n;return!!((n=this.starMembers[e])!=null&&n[l])}},persist:!0}),Xs={style:{margin:"10px 10px 40px"}},Zs={style:{"text-align":"right","margin-bottom":"10px"}},Qs={class:"table-scroll-wrapper"};function ca(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const er=de({__name:"ContestRank",setup(e){const l=Se(),n=Xe(),u=Ys(),{globalProperties:o}=_e();let y=!1,v=null,k=0,f=null,s=null,V=0;const c=p(0),P=p(0),g=p(!1),_=p(!0),m=p(!0);let d=null,h=null,b=1,i=50;const r=p({current:b,pageSize:i,defaultCurrent:1,defaultPageSize:50,total:0,pageSizeOptions:[50,100,1e3]}),R=J=>u&&u.isStarMember(k,J),I=async J=>{r.value={...r.value,current:J.current,pageSize:J.pageSize},await n.push({query:{...l.query,page:J.current,page_size:J.pageSize}})},w=J=>{if(J==null)return"-";const W=Math.floor(J/3600).toString().padStart(2,"0"),ne=Math.floor(J%3600/60).toString().padStart(2,"0"),K=(J%60).toFixed(0).toString().padStart(2,"0");return`${W}:${ne}:${K}`},$=p({}),S=[{title:"Rank",colKey:"rank",align:"center",fixed:"left"},{title:"昵称",colKey:"nickname",fixed:"left",attrs:J=>{let W={};return R(J.row.userId)&&(W={backgroundColor:"rgba(255,165,30,0.5)"}),{style:W}},cell:(J,W)=>{const ne=ql(W.row.nickname,18);let K=null;return R(W.row.userId)?K=t(G,{shape:"circle",variant:"text",class:"rank-unstar-button",onClick:()=>{u.removeStarMember(k,W.row.userId),O()}},{default:()=>[t(ll,{slot:"icon"},null)]}):K=t(G,{shape:"circle",variant:"text",class:"rank-star-button",onClick:()=>{u.addStarMember(k,W.row.userId),O()}},{default:()=>[t(nl,{slot:"icon"},null)]}),t("div",{class:"rank-nickname-cell"},[t(we,null,{default:()=>[t(Pl,{content:W.row.nickname},{default:()=>[t(G,{variant:"text",onClick:()=>n.push({name:"user",params:{username:W.row.username}})},ca(ne)?ne:{default:()=>[ne]})]}),K]})])}},{title:"Solved",colKey:"solved",align:"center",fixed:"left",cell:(J,W)=>t(G,{variant:"text",onClick:()=>n.push({name:"contest-judge",params:{contestId:k},query:{username:W.row.username,status:He.Accept}})},{default:()=>[W.row.solved]})},{title:"Penalty",colKey:"penalty",align:"center",fixed:"left",cell:(J,W)=>w(W.row.penalty)}],T=p([]),z=p(!1);let A=[],L=[];const C=p([]);let j=[];const E=({col:J,rowIndex:W})=>{if(J.colKey==="rank"){let ne=r.value.current;r.value.current>Math.ceil(C.value.length/r.value.pageSize)&&(ne=Math.ceil(C.value.length/r.value.pageSize));let K=r.value.pageSize*(ne-1),B=1;for(let ie=W+1;K+ie<C.value.length&&C.value[K+ie].rank===C.value[K+W].rank;ie++)B++;return{rowspan:B}}},H=(J,{value:W})=>rt(W),Z=()=>{d&&clearInterval(d),d=setInterval(()=>{y&&ue(!1)},3e4),h&&clearInterval(h),h=setInterval(()=>{if(!y)return;c.value=(new Date().getTime()-f.getTime())/1e3;const J=Math.min(c.value,P.value);c.value=Math.min(c.value,J),O()},1e3)},Q=()=>{d&&(clearInterval(d),d=null),h&&(clearInterval(h),h=null)},ee=async J=>{m.value=J,J?(await ue(!1),Z()):Q()},te=()=>{O(),r.value={...r.value,current:1}},O=()=>{C.value=[];let J=[];for(let Y=0;Y<A.length;Y++){const se=A[Y];let ye={userId:se.author_id,username:se.author_username,nickname:se.author_nickname},be=0,xe=0;se.problems.forEach(Ge=>{let Le=-1,Ye=Ge.lock||0;if(Ge.ac){if(Le=(new Date(Ge.ac).getTime()-(f==null?void 0:f.getTime()))/1e3,Le>c.value)return;be++,xe+=Le,xe+=Ge.attempt*20*60}if(Ye>0&&V>0){const Tt=P.value-V;c.value<Tt&&(Ye=0)}const ot=Ge.index;ye[`problem_${ot}`]={acDuration:Le,attempt:Ge.attempt||0,lock:Ye}}),ye.solved=be,ye.penalty=xe,J.push(ye)}J.sort((Y,se)=>Y.solved!==se.solved?se.solved-Y.solved:Y.penalty!==se.penalty?Y.penalty-se.penalty:Y.userId-se.userId);const W=L;let ne=0,K=0,B=-1,ie=-1;for(let Y=0;Y<J.length;Y++)W&&W.includes(J[Y].userId)?J[Y].rank="*":(K++,(J[Y].solved!==B||J[Y].penalty!==ie)&&(ne=K,B=J[Y].solved,ie=J[Y].penalty),J[Y].rank=String(ne));g.value&&(J=J.filter(Y=>R(Y.userId)));const oe=document.querySelectorAll("tbody tr"),Ce={};j.forEach((Y,se)=>{const ye=oe[se];ye&&(Ce[Y.userId]=ye.getBoundingClientRect())}),r.value={...r.value,total:J.length},C.value=J;for(let Y=0;Y<C.value.length;Y++)C.value[Y].index=Y+1;if(j=[...C.value],_.value){const Y={},se=document.querySelectorAll("table tbody tr");C.value.forEach((ye,be)=>{const xe=se[be];xe&&(Y[ye.userId]=xe.getBoundingClientRect())}),requestAnimationFrame(()=>{const ye=document.querySelectorAll("table tbody tr");C.value.forEach((be,xe)=>{const Ge=ye[xe],Le=Ce[be.userId],Ye=Y[be.userId];if(Le&&Ye){const ot=Le.top-Ye.top;ot!==0&&(Ge.style.transition="none",Ge.style.transform=`translateY(${ot}px)`)}}),requestAnimationFrame(()=>{document.querySelectorAll("table tbody tr").forEach(xe=>{xe.style.transition="transform 300ms ease",xe.style.transform=""})})})}},me=J=>{ee(!1),c.value=J;const W=Math.min(P.value,(new Date().getTime()-(f==null?void 0:f.getTime()))/1e3);c.value=Math.min(c.value,W),O()},ue=async J=>{J&&(z.value=!0);try{const W=await yo(k);if(T.value=[...S],A=[],L=[],C.value=[],r.value={...r.value,total:0},W.code===0){if(!W.data.has_auth){ke(o,"您目前没有权限查看比赛排名"),await n.push({name:"contest-detail",params:{contestId:k}});return}W.data.problems.sort((B,ie)=>B-ie),W.data.problems.forEach((B,ie)=>{T.value.push({colKey:`problem_${B}`,align:"center",title:()=>{let oe;return t(G,{variant:"text",onClick:()=>n.push({name:"contest-problem-detail",params:{contestId:k,problemIndex:B}})},ca(oe=at(B))?oe:{default:()=>[oe]})},cell:(oe,Ce)=>{const Y=Ce.row[`problem_${B}`];if(!Y)return"";let se="";return Y.acDuration>=0&&(se=w(Y.acDuration)),Y.attempt>0&&(se&&(se+=" "),se+=`(-${Y.attempt})`),Y.lock>0&&(se&&(se+=" "),se+=`(+${Y.lock})`),t("span",null,[se])},attrs:oe=>{const Ce=oe.row[`problem_${B}`];return Ce?Ce.acDuration>=0?{style:{backgroundColor:"rgba(130,255,30,0.5)"}}:Ce.lock>0?{style:{backgroundColor:"rgb(255,180,50,0.5)"}}:Ce.attempt>0?{style:{backgroundColor:"rgba(255,120,120,0.5)"}}:{}:{}}})});const ne=W.data.contest;if(f=new Date(ne.start_time),s=new Date(ne.end_time),A=W.data.ranks,L=W.data.v_members||[],P.value=Math.floor((s.getTime()-f.getTime())/1e3),$.value={0:"0",[Math.floor(P.value/2)]:rt(Math.floor(P.value/2)),[P.value]:rt(P.value)},V=qa(ne.lock_rank_duration||0),W.data.is_locked&&V>0){const B=Math.max(0,P.value-V);$.value[B]=t("span",{style:"color: #0052d9"},[x("锁榜("),rt(B),x(")")])}c.value=Math.floor((new Date().getTime()-f.getTime())/1e3);const K=Math.min(c.value,P.value);c.value=Math.min(c.value,K),m.value=!0,Z(),O()}else J&&F(o,W.code)}catch(W){console.error(W),J&&F(o,Ne())}finally{J&&(z.value=!1)}};return fe(async()=>{y=!0,v=$e(()=>l.query,async J=>{if(Array.isArray(l.params.contestId)?k=Number(l.params.contestId[0]):k=Number(l.params.contestId),!k){await n.push({name:"contest"});return}const W=parseInt(J.page)||r.value.defaultCurrent,ne=parseInt(J.page_size)||r.value.defaultPageSize;b=W,i=ne,r.value={...r.value,current:b,pageSize:i},await ue(!0)},{immediate:!0})}),De(()=>{y=!1,v&&v(),Q()}),(J,W)=>{const ne=vt,K=we,B=Il,ie=Ee,oe=he,Ce=Ie;return D(),M(Ce,null,{default:a(()=>[t(oe,{style:{margin:"10px",width:"100%"}},{default:a(()=>[U("div",Xs,[U("div",Zs,[t(K,null,{default:a(()=>[t(ne,{size:"large",modelValue:g.value,"onUpdate:modelValue":W[0]||(W[0]=Y=>g.value=Y),onChange:te},{label:a(Y=>[x(q(Y.value?"仅展示收藏":"未过滤收藏"),1)]),_:1},8,["modelValue"]),t(ne,{size:"large",modelValue:_.value,"onUpdate:modelValue":W[1]||(W[1]=Y=>_.value=Y)},{label:a(Y=>[x(q(Y.value?"开启动画":"关闭动画"),1)]),_:1},8,["modelValue"]),t(ne,{size:"large",modelValue:m.value,"onUpdate:modelValue":W[2]||(W[2]=Y=>m.value=Y),onChange:ee},{label:a(Y=>[x(q(Y.value?"自动刷新":"关闭刷新"),1)]),_:1},8,["modelValue"])]),_:1})]),t(B,{modelValue:c.value,"onUpdate:modelValue":W[3]||(W[3]=Y=>c.value=Y),marks:$.value,max:P.value,label:H,"tooltip-props":{placement:"top"},"input-number-props":{theme:"column",autoWidth:!0,format:ve(rt),onChange:me},onChangeEnd:me},null,8,["modelValue","marks","max","input-number-props"])]),U("div",Qs,[t(ie,{data:C.value,columns:T.value,"row-key":"index","vertical-align":"middle",bordered:!0,hover:!0,"table-layout":"auto","rowspan-and-colspan":E,loading:z.value,class:"dida-contest-rank-table",pagination:r.value,onPageChange:I},null,8,["data","columns","loading","pagination"])])]),_:1})]),_:1})}}}),tr=ce(er,[["__scopeId","data-v-838e6c28"]]),ar={style:{margin:"10px"}},lr={style:{margin:"12px"}},nr={class:"dida-edit-container"},or={class:"dida-description-editor"},sr=de({__name:"ContestEdit",setup(e){let l=Se();const{globalProperties:n}=_e(),u=Ze(),o=p(0),y=p(!1),v=p(!1),k=p(!1),f=p(null),s=p({title:"",openTime:[],private:!0,password:"",problems:[],members:[],description:"",notification:"",lockRankDuration:0,alwaysLock:!0,submitAnytime:!1}),V=p(""),c=p(""),P=p(!1),g=async()=>{P.value=!0,k.value=!1,P.value=!1},_=async(i,r)=>{v.value=!0,await it(i,r,n,()=>go(o.value)),v.value=!1},m=async()=>{v.value=!0;try{const i={title:s.value.title,description:s.value.description,notification:s.value.notification,lock_rank_duration:s.value.lockRankDuration,always_lock:s.value.alwaysLock,problems:s.value.problems,members:s.value.members,private:s.value.private,password:s.value.password,submit_anytime:s.value.submitAnytime};s.value.openTime[0]&&(i.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(i.end_time=new Date(s.value.openTime[1]));const r=await wo(i);if(v.value=!0,r.code!==0){F(n,r.code);return}r.data!=null&&await X.push({name:"contest-detail",params:{contestId:r.data}}),Ke(n,"创建成功")}finally{v.value=!1}},d=async()=>{v.value=!0;try{const i={id:Number(o.value),title:s.value.title,notification:s.value.notification,lock_rank_duration:s.value.lockRankDuration,always_lock:s.value.alwaysLock,problems:s.value.problems,members:s.value.members,private:s.value.private,password:s.value.password,submit_anytime:s.value.submitAnytime,description:s.value.description};s.value.openTime[0]&&(i.start_time=new Date(s.value.openTime[0])),s.value.openTime[1]&&(i.end_time=new Date(s.value.openTime[1]));const r=await ko(i);if(v.value=!0,r.code!==0){F(n,r.code);return}f.value&&(r.data.description!=null&&(s.value.description=r.data.description),r.data.update_time!=null&&(f.value.updateTime=new Date(r.data.update_time).toLocaleString())),Ke(n,"保存成功")}finally{v.value=!1}},h=i=>{s.value.description=i,y.value=!1},b=async()=>{const i=await vo(o.value);if(i.code!==0){F(n,i.code),console.error("contest get failed",i.code),await X.push({name:"contest-list"});return}const r=i.data.contest;f.value=Ht(r),s.value.title=r.title,s.value.openTime=[],r.start_time?s.value.openTime.push(new Date(r.start_time)):s.value.openTime.push(""),r.end_time?s.value.openTime.push(new Date(r.end_time)):s.value.openTime.push(""),s.value.private=r.private,s.value.password=r.password||"",s.value.description=r.description||"",s.value.notification=r.notification||"",s.value.problems=i.data.problems,s.value.members=i.data.members,r.lock_rank_duration?s.value.lockRankDuration=qa(r.lock_rank_duration):s.value.lockRankDuration=0,s.value.alwaysLock=r.always_lock,s.value.submitAnytime=r.submit_anytime,u.setTitle(r.title+" - "+u.getTitle);let R="";r.description&&(R=r.description),h(R)};return fe(async()=>{Array.isArray(l.params.contestId)?o.value=Number(l.params.contestId[0]):o.value=Number(l.params.contestId),o.value?(y.value=!0,await b()):h("")}),(i,r)=>{const R=Ae,I=ze,w=Ft,$=vt,S=wa,T=Ue,z=he,A=Ve,L=G,C=we,j=We,E=Je,H=Ie,Z=Re("md-editor-v3"),Q=Te,ee=It,te=nt;return D(),ae(pe,null,[t(Q,{loading:y.value},{default:a(()=>[t(H,null,{default:a(()=>[t(A,{span:8},{default:a(()=>[U("div",ar,[t(z,{class:"sh-card"},{default:a(()=>[t(T,{model:s.value,"label-width":"150px"},{default:a(()=>[t(I,{label:"标题"},{default:a(()=>[t(R,{modelValue:s.value.title,"onUpdate:modelValue":r[0]||(r[0]=O=>s.value.title=O),placeholder:"比赛标题"},null,8,["modelValue"])]),_:1}),t(I,{label:"通知"},{default:a(()=>[t(R,{modelValue:s.value.notification,"onUpdate:modelValue":r[1]||(r[1]=O=>s.value.notification=O),placeholder:"会更为醒目地提醒"},null,8,["modelValue"])]),_:1}),t(I,{label:"开启时间"},{default:a(()=>[t(w,{modelValue:s.value.openTime,"onUpdate:modelValue":r[2]||(r[2]=O=>s.value.openTime=O),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(I,{label:"提交限制"},{default:a(()=>[t($,{modelValue:s.value.submitAnytime,"onUpdate:modelValue":r[3]||(r[3]=O=>s.value.submitAnytime=O)},{label:a(O=>[x(q(O.value?"结束仍能提交":"仅比赛期间提交"),1)]),_:1},8,["modelValue"])]),_:1}),t(I,{label:"锁榜时长"},{default:a(()=>[t(S,{modelValue:s.value.lockRankDuration,"onUpdate:modelValue":r[4]||(r[4]=O=>s.value.lockRankDuration=O),min:0,format:ve(rt),"auto-width":""},null,8,["modelValue","format"])]),_:1}),t(I,{label:"自动解锁"},{default:a(()=>[t($,{modelValue:s.value.alwaysLock,"onUpdate:modelValue":r[5]||(r[5]=O=>s.value.alwaysLock=O)},{label:a(O=>[x(q(O.value?"结束后仍锁榜":"结束后解锁"),1)]),_:1},8,["modelValue"])]),_:1}),t(I,{label:"私有"},{default:a(()=>[t($,{modelValue:s.value.private,"onUpdate:modelValue":r[6]||(r[6]=O=>s.value.private=O)},null,8,["modelValue"])]),_:1}),s.value.private?(D(),M(I,{key:0,label:"密码"},{default:a(()=>[t(R,{modelValue:s.value.password,"onUpdate:modelValue":r[7]||(r[7]=O=>s.value.password=O),type:"password",placeholder:"请输入访问密码，留空代表关闭密码访问"},null,8,["modelValue"])]),_:1})):le("",!0),s.value.private?(D(),M(I,{key:1,label:"成员"},{default:a(()=>[t(Ma,{modelValue:s.value.members,"onUpdate:modelValue":r[8]||(r[8]=O=>s.value.members=O)},null,8,["modelValue"])]),_:1})):le("",!0),t(I,{label:"问题"},{default:a(()=>[t(Ea,{modelValue:s.value.problems,"onUpdate:modelValue":r[9]||(r[9]=O=>s.value.problems=O)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(A,{span:4},{default:a(()=>[U("div",lr,[U("div",nr,[o.value?(D(),M(C,{key:0},{default:a(()=>[t(L,{onClick:d,theme:"danger",loading:v.value},{default:a(()=>r[13]||(r[13]=[x("保存")])),_:1},8,["loading"])]),_:1})):(D(),M(C,{key:1},{default:a(()=>[t(L,{onClick:m,theme:"danger",loading:v.value},{default:a(()=>r[14]||(r[14]=[x("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(D(),M(E,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(j,{label:"创建时间"},{default:a(()=>{var O;return[x(q((O=f.value)==null?void 0:O.createTime),1)]}),_:1}),t(j,{label:"更新时间"},{default:a(()=>{var O;return[x(q((O=f.value)==null?void 0:O.updateTime),1)]}),_:1}),t(j,{label:"创建用户"},{default:a(()=>{var O;return[x(q((O=f.value)==null?void 0:O.ownerNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),U("div",or,[r[15]||(r[15]=U("p",null,"公告",-1)),t(Z,{id:"contest-description-editor",modelValue:s.value.description,"onUpdate:modelValue":r[10]||(r[10]=O=>s.value.description=O),onSave:d,onOnUploadImg:_,previewTheme:"cyanosis"},null,8,["modelValue"]),t(Q,{loading:v.value,attach:"#contest-description-editor","z-index":1e5},null,8,["loading"])])]),_:1},8,["loading"]),t(te,{visible:k.value,"onUpdate:visible":r[12]||(r[12]=O=>k.value=O),onConfirm:g,header:V.value,"confirm-loading":P.value},{default:a(()=>[r[16]||(r[16]=U("div",{style:{"margin-bottom":"10px"}},[U("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(ee,{modelValue:c.value,"onUpdate:modelValue":r[11]||(r[11]=O=>c.value=O),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),ma=ce(sr,[["__scopeId","data-v-e76af3ed"]]);function Wt(e){const l={};return l.id=e.id,l.authorId=e.author_id,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.title=e.title,l.content=e.content,e.insert_time&&(l.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(l.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(l.updateTime=new Date(e.update_time).toLocaleString()),l.problemId=e.problem_id,l.problemTitle=e.problem_title,l.contestId=e.contest_id,l.contestTitle=e.contest_title,l.contestProblemIndex=e.contest_problem_index,l}function rr(e){const l={};return l.id=e.id,l.authorId=e.author_id,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.content="",e.content&&(l.content=e.content),e.insert_time&&(l.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(l.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(l.updateTime=new Date(e.update_time).toLocaleString()),l}function ur(e){return N({url:"/discuss?id="+e,method:"get"})}function ir(e){return N({url:"/discuss/edit?id="+e,method:"get"})}function dr(e,l,n,u,o,y,v){const k={};return e?k.only_problem="1":k.only_problem="0",l&&(k.contest_id=l),n&&(k.problem_id=n),u&&(k.title=u),o&&(k.username=o),y&&(k.page=y),v&&(k.page_size=v),N({url:`/discuss/list?${new URLSearchParams(k).toString()}`,method:"get"})}function cr(e){return e||(e=0),N({url:"/discuss/image/token?id="+e,method:"get"})}function mr(e,l){return e||(e=0),l||(l=0),N({url:"/discuss/comment/image/token?id="+e+"&comment_id="+l,method:"get"})}function pr(e,l,n){return N({url:"/discuss/comment/list?id="+e+"&page="+l+"&page_size="+n,method:"get"})}function fr(e){return N({url:"/discuss/create",method:"post",data:e})}function vr(e){return N({url:"/discuss/edit",method:"post",data:e})}function _r(e){return N({url:"/discuss/comment/create",method:"post",data:e})}function gr(e){return N({url:"/discuss/comment/edit",method:"post",data:e})}const br={style:{margin:"10px"}};function hr(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const yr=de({__name:"DiscussList",setup(e){const l=Se(),n=Xe(),{globalProperties:u}=_e();let o=!1,y=null,v=-1,k=p(!1);const f=p([]),s=[],V=[{title:"标题",colKey:"title",cell:($,S)=>t(G,{variant:"text",onClick:()=>i(S.row.id)},{default:()=>[S.row.title]})},{title:"创建人",colKey:"authorNickname",width:"200",cell:($,S)=>t(G,{variant:"text",onClick:async()=>await Bt(n,S.row.authorUsername)},{default:()=>[S.row.authorNickname]})},{title:"创建时间",colKey:"insertTime",width:"180"},{title:"更新时间",colKey:"updateTime",width:"180"}],c=p(!1);let P=1,g=50;const _=p({current:P,pageSize:g,defaultCurrent:P,defaultPageSize:g,total:0,pageSizeOptions:[50,100]}),m=p(),d=p({problemId:"",title:"",username:""}),h=$=>{$&&n.push({name:"problem-detail",params:{problemId:$}})},b=($,S)=>{n.push({name:"contest-problem-detail",params:{contestId:$,problemIndex:S}})},i=$=>{if($){if(v){n.push({name:"contest-discuss-detail",params:{contestId:v,discussId:$}});return}n.push({name:"discuss-detail",params:{discussId:$}})}},r=async()=>{await n.push({query:{...l.query,problem_id:d.value.problemId,title:d.value.title,username:d.value.username,page:1,page_size:_.value.defaultPageSize}})},R=async($,S)=>{var T;c.value=!0;try{const{current:z,pageSize:A}=$,L=await dr(k.value,v,d.value.problemId,d.value.title,d.value.username,z,A);if(m.value=[],L.code===0){if(!L.data.has_auth){ke(u,"您目前没有权限查看讨论列表"),v?await n.push({name:"contest-detail",params:{contestId:v}}):await n.push({name:"discuss-list"});return}if(L.data.list){const C=L.data.list;for(let j=0;j<C.length;j++){const E=C[j],H=await Wt(E);(T=m.value)==null||T.push(H)}}_.value={..._.value,total:L.data.total_count}}else S&&F(u,L.code)}catch(z){console.error(z),F(u,Ne())}finally{c.value=!1}},I=async $=>{await n.push({query:{...l.query,page:$.current,page_size:$.pageSize}})},w=async()=>{await n.push({name:"discuss-create"})};return fe(async()=>{o=!0,y=$e(()=>l.query,$=>{if(!o)return;k.value=l.name==="discuss-list-problem",Array.isArray(l.params.contestId)?v=Number(l.params.contestId[0]):v=Number(l.params.contestId),f.value=s,v?f.value=f.value.concat([{title:"问题ID",colKey:"contestProblemIndex",width:"100",cell:(z,A)=>{let L;return A.row.contestProblemIndex?t(G,{variant:"text",onClick:()=>b(v,A.row.contestProblemIndex)},hr(L=at(A.row.contestProblemIndex))?L:{default:()=>[L]}):""}}]):f.value=f.value.concat([{title:"问题ID",colKey:"problemId",width:"100",cell:(z,A)=>A.row.problemId?t(G,{variant:"text",onClick:()=>h(A.row.problemId)},{default:()=>[A.row.problemId]}):""}]),f.value=f.value.concat(V),d.value.problemId=$.problem_id||"",d.value.title=$.title||"",d.value.username=$.username||"";const S=parseInt($.page)||_.value.defaultCurrent,T=parseInt($.page_size)||_.value.defaultPageSize;P=S,g=T,_.value={..._.value,current:P,pageSize:g},R({current:P,pageSize:g},!0)},{immediate:!0})}),De(()=>{o=!1,y&&y()}),($,S)=>{const T=Ee,z=he,A=Ve,L=Ae,C=ze,j=G,E=Ue,H=we,Z=Ie;return D(),M(Z,null,{default:a(()=>[t(A,{span:9},{default:a(()=>[t(z,{style:{margin:"10px"}},{default:a(()=>[t(T,{data:m.value,columns:f.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:_.value,loading:c.value,"table-layout":"auto",onPageChange:I},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(A,{span:3},{default:a(()=>[U("div",br,[t(z,{class:"sh-card"},{default:a(()=>[t(E,{model:d.value},{default:a(()=>[t(C,{label:"问题ID"},{default:a(()=>[t(L,{modelValue:d.value.problemId,"onUpdate:modelValue":S[0]||(S[0]=Q=>d.value.problemId=Q),placeholder:"请输入完整问题ID"},null,8,["modelValue"])]),_:1}),t(C,{label:"标题"},{default:a(()=>[t(L,{modelValue:d.value.title,"onUpdate:modelValue":S[1]||(S[1]=Q=>d.value.title=Q),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(C,{label:"创建人"},{default:a(()=>[t(L,{modelValue:d.value.username,"onUpdate:modelValue":S[2]||(S[2]=Q=>d.value.username=Q),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(C,null,{default:a(()=>[t(j,{theme:"primary",onClick:r},{default:a(()=>S[3]||(S[3]=[x("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(z,{class:"sh-card"},{default:a(()=>[t(H,null,{default:a(()=>[t(j,{onClick:w},{default:a(()=>S[4]||(S[4]=[x("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),$t=ce(yr,[["__scopeId","data-v-52d475b4"]]),wr={key:0,style:{margin:"20px"}},kr={class:"dida-operation-container"},Sr={class:"dida-operation-container"},Cr={style:{margin:"10px"}},Ir={style:{margin:"10px"}},Pr={style:{margin:"10px"},class:"dida-operation-container"},xr={style:{margin:"12px"}},Vr={key:0,class:"dida-edit-container"},Tr=de({__name:"DiscussDetail",props:{discussId:{}},setup(e){const l=e;let n=Se();const{globalProperties:u}=_e();let o=!1,y=null;const v=Ze(),k=Fe();let f=p("");const s=p(0),V=p(!1),c=p(null),P=p(!1),g=p(!1),_=p(0),m=p("");let d=1,h=20;const b=p({current:1,pageSize:20,total:0,defaultPageSize:h,defaultCurrent:d,pageSizeOptions:[20,50]}),i=p([]),r=Be(()=>k.hasAuth(je.ManageDiscuss)),R=Be(()=>k.hasAuth(je.ManageDiscuss)||c.value&&k.getUserId==c.value.authorId),I=()=>{X.push({name:"discuss-edit",params:{discussId:s.value}})},w=()=>t("div",{class:"t-pagination__total"},[`共 ${b.value.total} 条回复`]),$=(C,j)=>{_.value=C,m.value=j;const E=document.getElementById("discuss-comment-editor");E&&E.scrollIntoView({behavior:"smooth"})},S=()=>{_.value=0,m.value="";const C=document.getElementById("discuss-comment-editor");C&&C.scrollIntoView({behavior:"smooth"})},T=async()=>{g.value=!0;try{let C;if(_.value){const j={id:_.value,discuss_id:s.value,content:m.value};if(C=await gr(j),C.code!==0){F(u,C.code);return}Ke(u,"编辑成功"),_.value=0,m.value="",d===1?await A({current:1,pageSize:h},!0):await X.push({query:{current:1}});const E=document.getElementById("comment-divider");E&&E.scrollIntoView({behavior:"smooth"})}else{const j={discuss_id:s.value,content:m.value};if(C=await _r(j),C.code!==0){F(u,C.code);return}Ke(u,"编辑成功"),_.value=0,m.value="",d===1?await A({current:1,pageSize:h},!0):await X.push({query:{current:1}});const E=document.getElementById("comment-divider");E&&E.scrollIntoView({behavior:"smooth"})}}finally{g.value=!1}},z=async(C,j)=>{g.value=!0,await it(C,j,u,()=>mr(s.value,_.value)),g.value=!1},A=async(C,j)=>{var E;P.value=!0;try{const{current:H,pageSize:Z}=C,Q=await pr(s.value,H,Z);if(i.value=[],Q.code===0){const ee=Q.data.list;if(ee)for(let te=0;te<ee.length;te++){const O=ee[te],me=rr(O);(E=i.value)==null||E.push(me)}b.value={...b.value,total:Q.data.total_count}}else j&&F(u,Q.code)}catch(H){console.error(H),F(u,Ne())}finally{P.value=!1}},L=async C=>{await X.push({query:{...n.query,page:C.current,page_size:C.pageSize}})};return fe(async()=>{if(o=!0,s.value=Number(l.discussId),s.value||(Array.isArray(n.params.discussId)?s.value=Number(n.params.discussId[0]):s.value=Number(n.params.discussId)),!s.value){ge(u,"讨论不存在"),await X.push({name:"discuss"});return}V.value=!0;const C=await ur(s.value);if(C.code!==0){V.value=!1,F(u,C.code),await X.push({name:"discuss"});return}c.value=Wt(C.data.discuss),v.setTitle(c.value.title+" - "+v.getTitle),f.value=c.value.content,V.value=!1,y=$e(()=>n.query,j=>{if(!o)return;const E=parseInt(j.page)||b.value.defaultCurrent,H=parseInt(j.page_size)||b.value.defaultPageSize;d=E,h=H,b.value={...b.value,current:d,pageSize:h},A({current:d,pageSize:h},!0)},{immediate:!0})}),De(()=>{o=!1,y&&y()}),(C,j)=>{const E=Sa,H=ka,Z=Re("md-preview"),Q=he,ee=xl,te=we,O=G,me=Vl,ue=et,J=Re("md-editor-v3"),W=Te,ne=Ve,K=We,B=Je,ie=Ie;return D(),M(W,{loading:V.value},{default:a(()=>[t(ie,{class:"dida-main-content"},{default:a(()=>[t(ne,{span:8},{default:a(()=>{var oe,Ce,Y;return[(oe=c.value)!=null&&oe.problemTitle||(Ce=c.value)!=null&&Ce.contestTitle?(D(),ae("div",wr,[t(H,{"max-item-width":"300"},{default:a(()=>{var se,ye,be,xe,Ge;return[(se=c.value)!=null&&se.contestTitle?(D(),ae(pe,{key:0},[t(E,{to:{name:"contest-detail",params:{contestId:(ye=c.value)==null?void 0:ye.contestId}}},{default:a(()=>{var Le;return[x(q((Le=c.value)==null?void 0:Le.contestTitle),1)]}),_:1},8,["to"]),(be=c.value)!=null&&be.contestProblemIndex?(D(),M(E,{key:0,to:{name:"contest-problem-detail",params:{problemIndex:(xe=c.value)==null?void 0:xe.contestProblemIndex}}},{default:a(()=>{var Le,Ye;return[x(q(ve(at)((Le=c.value)==null?void 0:Le.contestProblemIndex))+" - "+q((Ye=c.value)==null?void 0:Ye.problemTitle),1)]}),_:1},8,["to"])):le("",!0)],64)):(D(),ae(pe,{key:1},[t(E,{to:{name:"discuss-list-problem"}},{default:a(()=>j[4]||(j[4]=[x(" 题目讨论")])),_:1}),t(E,{to:{name:"problem-detail",params:{problemId:(Ge=c.value)==null?void 0:Ge.problemId}}},{default:a(()=>{var Le;return[x(q((Le=c.value)==null?void 0:Le.problemTitle),1)]}),_:1},8,["to"])],64))]}),_:1})])):le("",!0),t(Q,{style:{margin:"10px"},header:(Y=c.value)==null?void 0:Y.title,"header-bordered":!0},{default:a(()=>[t(Z,{"model-value":ve(f),previewTheme:"cyanosis"},null,8,["model-value"])]),_:1},8,["header"]),t(ee,{id:"comment-divider"}),(D(!0),ae(pe,null,Pe(i.value,(se,ye)=>(D(),M(Q,{key:ye,style:{margin:"10px"},"header-bordered":""},{header:a(()=>[U("div",kr,[t(te,null,{default:a(()=>[U("span",null,q(se.authorNickname),1),U("span",null,q(se.insertTime),1)]),_:2},1024)]),U("div",Sr,[t(te,null,{default:a(()=>[r.value||ve(k).getUserId===se.authorId?(D(),M(O,{key:0,onClick:()=>{$(se.id,se.content)}},{default:a(()=>j[5]||(j[5]=[x(" 编辑 ")])),_:2},1032,["onClick"])):le("",!0)]),_:2},1024)])]),default:a(()=>[t(Z,{"model-value":se.content,previewTheme:"cyanosis"},null,8,["model-value"])]),_:2},1024))),128)),U("div",Cr,[t(me,{modelValue:b.value.current,"onUpdate:modelValue":j[0]||(j[0]=se=>b.value.current=se),"page-size":b.value.pageSize,"onUpdate:pageSize":j[1]||(j[1]=se=>b.value.pageSize=se),total:b.value.total,"page-size-options":b.value.pageSizeOptions,"show-page-size":!1,"total-content":w,onChange:L},null,8,["modelValue","page-size","total","page-size-options"])]),t(ee),U("div",Ir,[U("div",Pr,[t(ue,{style:{margin:"10px"}},{default:a(()=>[x(q(_.value?"编辑回复":"发表回复"),1)]),_:1}),t(te,null,{default:a(()=>[t(O,{theme:"danger",onClick:S},{default:a(()=>j[6]||(j[6]=[x("清除")])),_:1}),t(O,{theme:"primary",onClick:T,loading:g.value},{default:a(()=>j[7]||(j[7]=[x("提交")])),_:1},8,["loading"])]),_:1})]),t(J,{id:"discuss-comment-editor",modelValue:m.value,"onUpdate:modelValue":j[2]||(j[2]=se=>m.value=se),previewTheme:"cyanosis",onSave:T,onOnUploadImg:z},null,8,["modelValue"]),t(W,{loading:g.value,attach:"#discuss-comment-editor","z-index":1e5},null,8,["loading"])])]}),_:1}),t(ne,{span:4},{default:a(()=>[U("div",xr,[R.value?(D(),ae("div",Vr,[t(O,{onClick:I},{default:a(()=>j[8]||(j[8]=[x("编辑")])),_:1})])):le("",!0),t(B,{layout:"vertical",bordered:!0},{default:a(()=>[t(K,{label:"创建时间"},{default:a(()=>{var oe;return[x(q((oe=c.value)==null?void 0:oe.insertTime),1)]}),_:1}),t(K,{label:"编辑时间"},{default:a(()=>{var oe;return[x(q((oe=c.value)==null?void 0:oe.modifyTime),1)]}),_:1}),t(K,{label:"更新时间"},{default:a(()=>{var oe;return[x(q((oe=c.value)==null?void 0:oe.updateTime),1)]}),_:1}),t(K,{label:"创建用户"},{default:a(()=>[t(O,{variant:"text",onClick:j[3]||(j[3]=async()=>{var oe;return await ve(Bt)(ve(X),(oe=c.value)==null?void 0:oe.authorUsername)})},{default:a(()=>{var oe;return[x(q((oe=c.value)==null?void 0:oe.authorNickname),1)]}),_:1})]),_:1}),t(K,{label:"标签"})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Ut=ce(Tr,[["__scopeId","data-v-acfa7b91"]]),Dr={style:{margin:"10px"}},Lr={style:{margin:"12px"}},jr={class:"dida-edit-container"},$r={class:"dida-description-editor"},Ur=de({__name:"DiscussEdit",setup(e){let l=Se();const{globalProperties:n}=_e();let u=null;const o=p(0),y=p(!1),v=p(!1),k=p(null),f=p({title:"",problemId:"",content:""}),s=()=>{X.push({name:"discuss-detail",params:{discussId:o.value}})};async function V(m,d){v.value=!0,await it(m,d,n,()=>cr(o.value)),v.value=!1}const c=async()=>{v.value=!0;try{const m={title:f.value.title,content:f.value.content,problem_id:f.value.problemId},d=await fr(m);if(v.value=!0,d.code!==0){F(n,d.code);return}const h=d.data;await X.push({name:"discuss-detail",params:{discussId:h}}),Ke(n,"创建成功")}finally{v.value=!1}},P=async()=>{v.value=!0;try{const m={id:o.value,title:f.value.title,content:f.value.content,problem_id:f.value.problemId},d=await vr(m);if(v.value=!0,d.code!==0){F(n,d.code);return}k.value&&d.data.modify_time!=null&&(k.value.modifyTime=new Date(d.data.modify_time).toLocaleString()),d.data.content!=null&&(f.value.content=d.data.content),Ke(n,"保存成功")}finally{v.value=!1}},g=async()=>{o.value?await P():await c()},_=async()=>{const m=await ir(o.value);if(m.code!==0){F(n,m.code),await X.push({name:"discuss"});return}const d=m.data.discuss;k.value=Wt(d),f.value.title=d.title,f.value.content=d.content,f.value.problemId=d.problem_id,y.value=!1};return fe(async()=>{u=$e(()=>l.params,async()=>{Array.isArray(l.params.discussId)?o.value=Number(l.params.discussId[0]):o.value=Number(l.params.discussId),o.value?(y.value=!0,await _()):(f.value.title="",f.value.problemId="",f.value.content="")},{immediate:!0})}),De(()=>{u&&(u(),u=null)}),(m,d)=>{const h=Ae,b=ze,i=Ue,r=he,R=Ve,I=G,w=we,$=We,S=Je,T=Ie,z=Re("md-editor-v3"),A=Te;return D(),M(A,{loading:y.value},{default:a(()=>[t(T,null,{default:a(()=>[t(R,{span:8},{default:a(()=>[U("div",Dr,[t(r,{class:"sh-form-card"},{default:a(()=>[t(i,{model:f.value},{default:a(()=>[t(b,{label:"标题"},{default:a(()=>[t(h,{modelValue:f.value.title,"onUpdate:modelValue":d[0]||(d[0]=L=>f.value.title=L),placeholder:"讨论标题"},null,8,["modelValue"])]),_:1}),t(b,{label:"关联题目"},{default:a(()=>[t(h,{modelValue:f.value.problemId,"onUpdate:modelValue":d[1]||(d[1]=L=>f.value.problemId=L),placeholder:"讨论题目"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(R,{span:4},{default:a(()=>[U("div",Lr,[U("div",jr,[o.value?(D(),M(w,{key:0},{default:a(()=>[t(I,{onClick:P,theme:"danger",loading:v.value},{default:a(()=>d[3]||(d[3]=[x("保存")])),_:1},8,["loading"]),t(I,{onClick:s},{default:a(()=>d[4]||(d[4]=[x("查看")])),_:1})]),_:1})):(D(),M(w,{key:1},{default:a(()=>[t(I,{onClick:c,theme:"danger",loading:v.value},{default:a(()=>d[5]||(d[5]=[x("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(D(),M(S,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t($,{label:"创建时间"},{default:a(()=>{var L;return[x(q((L=k.value)==null?void 0:L.insertTime),1)]}),_:1}),t($,{label:"更新时间"},{default:a(()=>{var L;return[x(q((L=k.value)==null?void 0:L.modifyTime),1)]}),_:1}),t($,{label:"创建用户"},{default:a(()=>{var L;return[x(q((L=k.value)==null?void 0:L.authorNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),U("div",$r,[t(z,{id:"discuss-editor",modelValue:f.value.content,"onUpdate:modelValue":d[2]||(d[2]=L=>f.value.content=L),onSave:g,onOnUploadImg:V,previewTheme:"cyanosis"},null,8,["modelValue"]),t(A,{loading:v.value,attach:"#discuss-editor","z-index":1e5},null,8,["loading"])])]),_:1},8,["loading"])}}}),pa=ce(Ur,[["__scopeId","data-v-164ac069"]]);function zr(e,l){return N({url:"/rank/ac/all?page="+e+"&page_size="+l,method:"get"})}function Ar(e,l){return N({url:"/rank/ac/problem?page="+e+"&page_size="+l,method:"get"})}function Rr(e,l){return N({url:"/rank/ac/problem/today?page="+e+"&page_size="+l,method:"get"})}function Er(e,l){return N({url:"/rank/ac/problem/day7?page="+e+"&page_size="+l,method:"get"})}function Mr(e,l){return N({url:"/rank/ac/problem/day30?page="+e+"&page_size="+l,method:"get"})}function qr(e,l){return N({url:"/rank/ac/problem/year?page="+e+"&page_size="+l,method:"get"})}const Kr={style:{margin:"10px"}};function zt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const Fr=de({__name:"RankUser",props:{type:{}},setup(e){const l=Se(),n=Xe(),{globalProperties:u}=_e();let o=null;const y=e,v=p(""),k=p(""),f={all:{header:"统计所有用户在本站的提交记录",content:"优先以AC记录数量排序，如果相同则提交所用次数较少的优先，如果仍相同，注册较早的用户靠前"},problem:{header:"统计所有用户在本站的提交记录",content:"以题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-today":{header:"统计所有用户今日在本站的提交记录",content:"以今日题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-day7":{header:"统计所有用户最近7日在本站的提交记录",content:"以7日题目记录数量排序（从7日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-day30":{header:"统计所有用户最近30日在本站的提交记录",content:"以30日题目记录数量排序（从30日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-year":{header:"统计所有用户最近1年在本站的提交记录",content:"以最近1年题目记录数量排序（从365日前的0点开始计算），如果相同，注册较早的用户靠前"}},s=p([]),V=[{title:"序号",colKey:"index"},{title:"用户名",colKey:"username",cell:(w,$)=>t(G,{variant:"dashed",onClick:()=>b($.row.username)},{default:()=>[$.row.username]})},{title:"昵称",colKey:"nickname"},{title:"Slogan",colKey:"slogan"}],c=[{title:"题目数量",colKey:"problem_count",cell:(w,$)=>{let S=0;return $.row.problem_count&&(S=$.row.problem_count),t(G,{variant:"dashed",onClick:()=>i($.row.username)},zt(S)?S:{default:()=>[S]})}}],P=[{title:"正确",colKey:"accept",cell:(w,$)=>{let S=0;return $.row.accept&&(S=$.row.accept),t(G,{variant:"dashed",onClick:()=>i($.row.username)},zt(S)?S:{default:()=>[S]})}},{title:"提交",colKey:"attempt",cell:(w,$)=>{let S=0;return $.row.attempt&&(S=$.row.attempt),t(G,{variant:"dashed",onClick:()=>r($.row.username)},zt(S)?S:{default:()=>[S]})}}],g=p(!1);let _=1,m=50;const d=p({current:_,pageSize:m,defaultCurrent:_,defaultPageSize:m,total:0,pageSizeOptions:[50]}),h=p(),b=w=>{n.push({name:"user",params:{username:w}})},i=w=>{n.push({name:"judge-list",query:{username:w,status:He.Accept}})},r=w=>{n.push({name:"judge-list",query:{username:w}})},R=async(w,$)=>{g.value=!0;try{h.value=[];const{current:S,pageSize:T}=w;let z=null;switch(y.type){case"problem":z=await Ar(S,T);break;case"problem-today":z=await Rr(S,T);break;case"problem-day7":z=await Er(S,T);break;case"problem-day30":z=await Mr(S,T);break;case"problem-year":z=await qr(S,T);break;default:z=await zr(S,T);break}if(z.code===0){const A=z.data.list;if(!A||A.length<=0){d.value={...d.value,total:0},ke(u,"未找到记录");return}h.value=[];const L=d.value.pageSize*(d.value.current-1);let C=1;A.forEach(j=>{var H;const E=j;E.index=L+C++,(H=h.value)==null||H.push(E)}),d.value={...d.value,total:z.data.total_count}}else $&&F(u,z.code)}catch(S){console.error(S),F(u,Ne())}finally{g.value=!1}},I=async w=>{await n.push({query:{...l.query,page:w.current,page_size:w.pageSize}})};return fe(async()=>{g.value=!0,o=$e(()=>l.query,w=>{switch(y.type&&f[y.type]?(v.value=f[y.type].header,k.value=f[y.type].content):(v.value=f.all.header,k.value=f.all.content),y.type){case"all":s.value=V.concat(P);break;default:s.value=V.concat(c);break}const $=parseInt(w.page)||d.value.defaultCurrent,S=parseInt(w.page_size)||d.value.defaultPageSize;_=$,m=S,d.value={...d.value,current:_,pageSize:m},R({current:_,pageSize:m},!0)},{immediate:!0})}),De(()=>{o&&o()}),(w,$)=>{const S=Ee,T=he,z=Ve,A=Ie;return D(),M(A,null,{default:a(()=>[t(z,{span:9},{default:a(()=>[t(T,{style:{margin:"10px"}},{default:a(()=>[t(S,{data:h.value,columns:s.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:d.value,loading:g.value,"table-layout":"auto",onPageChange:I},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(z,{span:3},{default:a(()=>[U("div",Kr,[t(T,{class:"sh-card",header:v.value,"header-bordered":!0},{default:a(()=>[x(q(k.value),1)]),_:1},8,["header"])])]),_:1})]),_:1})}}}),st=ce(Fr,[["__scopeId","data-v-13682529"]]),Or={style:{display:"flex","align-items":"center"}},Gr={style:{color:"#409eff","margin-right":"20px"}},Nr={class:"dida-login-footer"},Hr=de({__name:"UserForget",setup(e){const{globalProperties:l}=_e(),n=Fe(),u=p(!1),o=p(!1),y=p(!1),v=p("发送验证码");let k=null,f=-1;const s=p(!1),V=p(null),c=p(""),P=p({username:"",emailKey:"",password:"",confirmPassword:""}),_=p({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:R=>new Promise(I=>{const w=setTimeout(()=>{I(P.value.password===R),clearTimeout(w)})}),message:"两次密码不一致"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),m=()=>{ke(l,"重置成功")},d=async R=>{if(!y.value){u.value=!0,o.value=!0;try{const I=await Nn(R,P.value.username);I.code===0?(ke(l,"验证码发送成功"),c.value=I.data,o.value=!1,y.value=!0,k=new Date,v.value="60秒后重发",f=setInterval(()=>{const $=Math.floor((new Date().getTime()-(k==null?void 0:k.getTime()))/1e3);$>60?(v.value="发送验证码",y.value=!1,clearInterval(f)):v.value=`${60-$}秒后重发`},1e3)):F(l,I.code)}catch(I){console.error("Send email key error",I),ge(l,"发送验证码失败")}finally{u.value=!1}}},h=async()=>{var $;if(s.value=!0,y.value||o.value)return;await mt();const R=document.getElementById("cf-confirm-div");R&&R.remove();const I=document.createElement("div");I.id="cf-confirm-div",I.setAttribute("data-theme","light"),($=V.value)==null||$.appendChild(I);const w=window;w.turnstile.ready(function(){w.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(S){s.value=!1,await d(S)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},b=p(()=>t(G,{onClick:h,disabled:y.value,loading:o.value,style:"width:120px"},{default:()=>[v.value]})),i=async()=>{u.value=!0;try{const R=await Hn(P.value.username,P.value.password,P.value.emailKey);R.code===0?(ke(l,"密码修改成功"),l.$router.push({name:"login"})):F(l,R.code)}catch(R){console.error("Modify password error",R),ge(l,"修改密码失败")}finally{u.value=!1}},r=async({validateResult:R,firstError:I,e:w})=>{if(!u.value){if(w.preventDefault(),R!==!0){ge(l,I);return}c.value?await i():await h()}};return fe(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),De(()=>{}),(R,I)=>{const w=Ct,$=Ae,S=ze,T=ya,z=G,A=Ue,L=lt,C=he,j=nt;return D(),ae(pe,null,[t(C,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(w,{"max-line":1},{default:a(()=>I[6]||(I[6]=[U("span",null,"如果您未绑定邮箱或忘记用户名，可联系管理员寻求帮助",-1),U("span",null,"管理员邮箱：BoilTask@qq.com",-1)])),_:1}),t(w,{style:{"margin-top":"10px"}},{default:a(()=>I[7]||(I[7]=[U("p",null,"支持原acm.hpu.edu.cn、CodeOJ的用户直接登录",-1),U("p",null,"原DMOJ、hpuoj.com的用户，请先重置密码",-1),U("p",null,"可尝试学号/昵称等作为用户名登录，成功后有机会合并账户或修改用户名",-1)])),_:1}),t(A,{ref:"form",rules:_.value,data:P.value,colon:!0,onReset:m,onSubmit:r,class:"yj-login-form"},{default:a(()=>[t(S,{name:"username",label:"用户名"},{default:a(()=>[t($,{modelValue:P.value.username,"onUpdate:modelValue":I[0]||(I[0]=E=>P.value.username=E),clearable:"",placeholder:"请输入完整用户名"},null,8,["modelValue"])]),_:1}),c.value?(D(),ae(pe,{key:0},[t(S,{name:"email",label:"发送邮箱"},{default:a(()=>[t(T,{append:b.value},{default:a(()=>[U("div",Or,[U("span",Gr,q(c.value),1)])]),_:1},8,["append"])]),_:1}),t(S,{name:"emailKey",label:"验证码"},{default:a(()=>[t($,{modelValue:P.value.emailKey,"onUpdate:modelValue":I[1]||(I[1]=E=>P.value.emailKey=E),clearable:"",placeholder:"请输入收到的验证码"},null,8,["modelValue"])]),_:1}),t(S,{name:"password",label:"新密码"},{default:a(()=>[t($,{modelValue:P.value.password,"onUpdate:modelValue":I[2]||(I[2]=E=>P.value.password=E),type:"password",clearable:"",placeholder:"新密码"},null,8,["modelValue"])]),_:1}),t(S,{name:"confirmPassword",label:"确认密码"},{default:a(()=>[t($,{modelValue:P.value.confirmPassword,"onUpdate:modelValue":I[3]||(I[3]=E=>P.value.confirmPassword=E),type:"password",clearable:"",placeholder:"请重复输入密码"},null,8,["modelValue"])]),_:1})],64)):le("",!0),c.value?(D(),M(S,{key:1},{default:a(()=>[t(z,{theme:"primary",type:"submit",block:"",loading:u.value},{default:a(()=>I[8]||(I[8]=[x("修改密码")])),_:1},8,["loading"])]),_:1})):(D(),M(S,{key:2},{default:a(()=>[t(z,{theme:"primary",type:"submit",block:"",loading:u.value},{default:a(()=>I[9]||(I[9]=[x("重置密码")])),_:1},8,["loading"])]),_:1}))]),_:1},8,["rules","data"]),U("div",Nr,[t(L,{onClick:I[4]||(I[4]=()=>{ve(l).$router.push({name:"login"})})},{default:a(()=>I[10]||(I[10]=[x("返回登陆 ")])),_:1})])]),_:1}),t(j,{visible:s.value,"onUpdate:visible":I[5]||(I[5]=E=>s.value=E),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:a(()=>[U("div",{ref_key:"dialogContainer",ref:V,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),Br=ce(Hr,[["__scopeId","data-v-e960b193"]]),Jr={class:"judger-status-panel"},Wr={class:"judger-status-panel"};function Yr(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const Xr=de({__name:"SystemStatus",setup(e){const{globalProperties:l}=_e(),n=p([]),u=p([]),o=p(!1);let y;const v=s=>{let V="失效",c="danger";const P=new Date,g=new Date(s.updateTime);return P.getTime()-g.getTime()>3e4?(V="离线",c="default"):s.cpuUsage>90?(V="CPU过高",c="warning"):s.memPercent>90?(V="内存过高",c="warning"):(V="在线",c="success"),t(we,null,{default:()=>[t("span",null,[s.key,x(" - "),s.name]),t("span",null,[s.updateTime]),t(et,{theme:c,size:"small"},Yr(V)?V:{default:()=>[V]})]})},k=async()=>{const s={};for(let b=0;b<n.value.length;b++){const i=n.value[b];s[i.key]={...i}}const V={};for(let b=0;b<u.value.length;b++){const i=u.value[b];V[i.key]={...i}}const c=[],P=[],g=await Zl();if(g.code!==0){F(l,g.code);return}const _=g.data.web,m={key:"didaoj"};_.name?m.name=_.name:m.name="-",_.update_time?m.updateTime=new Date(_.update_time).toLocaleString():m.updateTime="-",_.cpu_usage?m.cpuUsage=Number(_.cpu_usage):m.cpuUsage=0,_.mem_usage?m.memUsage=_.mem_usage/(1024*1024*1024):m.memUsage=0,_.mem_total?m.memTotal=_.mem_total/(1024*1024*1024):m.memTotal=0,m.memTotal>0?m.memPercent=Math.round(m.memUsage/m.memTotal*1e4)/100:m.memPercent=0,m.avgMessage=_.avg_message;const d=s[m.key];d?(m.cpuUsageFrom=d.cpuUsage,m.memPercentFrom=d.memPercent,m.memUsageFrom=d.memUsage,m.memTotalFrom=d.memTotal):(m.cpuUsageFrom=0,m.memPercentFrom=0,m.memUsageFrom=0,m.memTotalFrom=0),c.push(m),n.value=c;const h=g.data.judger;for(let b=0;b<h.length;b++){const i=h[b],r={key:i.key,name:i.name};i.name?r.name=i.name:r.name="-",i.update_time?r.updateTime=new Date(i.update_time).toLocaleString():r.updateTime="-",i.cpu_usage?r.cpuUsage=Number(i.cpu_usage):r.cpuUsage=0,i.mem_usage?r.memUsage=i.mem_usage/(1024*1024*1024):r.memUsage=0,i.mem_total?r.memTotal=i.mem_total/(1024*1024*1024):r.memTotal=0,r.memTotal>0?r.memPercent=Math.round(r.memUsage/r.memTotal*1e4)/100:r.memPercent=0,r.avgMessage=i.avg_message,V[i.key]?(r.cpuUsageFrom=V[i.key].cpuUsage,r.memPercentFrom=V[i.key].memPercent,r.memUsageFrom=V[i.key].memUsage,r.memTotalFrom=V[i.key].memTotal):(r.cpuUsageFrom=0,r.memPercentFrom=0,r.memUsageFrom=0,r.memTotalFrom=0),P.push(r)}u.value=P},f=async()=>{await k(),o.value=!1};return fe(async()=>{u.value=[],n.value=[],o.value=!0,await f(),y=setInterval(()=>{f()},5e3)}),De(()=>{clearInterval(y)}),(s,V)=>{const c=Tl,P=we,g=he,_=Te;return D(),M(_,{loading:o.value},{default:a(()=>[t(g,{title:"接口状态",class:"judger-status"},{default:a(()=>[U("div",Jr,[(D(!0),ae(pe,null,Pe(n.value,m=>(D(),M(g,{key:m.key,header:()=>v(m),class:"judge-status-judger"},{footer:a(()=>[U("span",null," 负载信息："+q(m.avgMessage),1)]),default:a(()=>[t(P,{class:"judge-status-judger"},{default:a(()=>[t(c,{title:"CPU使用率",value:m.cpuUsage,animation:{valueFrom:m.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(c,{title:"内存使用率",value:m.memPercent,animation:{valueFrom:m.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(c,{title:"内存使用量",animation:{valueFrom:m.memUsageFrom,duration:2e3},"animation-start":!0,value:m.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(c,{title:"内存总量",value:m.memTotal,animation:{valueFrom:m.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1}),t(g,{title:"判题机状态",class:"judger-status"},{default:a(()=>[U("div",Wr,[(D(!0),ae(pe,null,Pe(u.value,m=>(D(),M(g,{key:m.key,header:()=>v(m),class:"judge-status-judger"},{footer:a(()=>[U("span",null," 负载信息："+q(m.avgMessage),1)]),default:a(()=>[t(P,{class:"judge-status-judger"},{default:a(()=>[t(c,{title:"CPU使用率",value:m.cpuUsage,animation:{valueFrom:m.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(c,{title:"内存使用率",value:m.memPercent,animation:{valueFrom:m.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(c,{title:"内存使用量",animation:{valueFrom:m.memUsageFrom,duration:2e3},"animation-start":!0,value:m.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(c,{title:"内存总量",value:m.memTotal,animation:{valueFrom:m.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1})]),_:1},8,["loading"])}}}),Zr=ce(Xr,[["__scopeId","data-v-d2b0a05b"]]),Qr=de({__name:"ManageJudge",setup(e){const{globalProperties:l}=_e(),n=p(!1),u=p(!1),o=p({problemId:"",language:void 0,status:void 0}),y=p(!1),v=p([]);v.value=Ot();const k=p([]);k.value=Da();const f=async()=>{n.value=!0;try{const c=await un();if(c.code!==0){F(l,c.code);return}ke(l,"重判成功"),await X.push({name:"judge-list"})}catch(c){console.error(c),F(l,"重判失败")}finally{n.value=!1}},s=async()=>{if(!o.value.problemId&&!o.value.language&&!o.value.status){F(l,"请输入问题Id");return}y.value=!0;try{const c=await dn(o.value.problemId,o.value.language,o.value.status);if(c.code!==0){F(l,c.code);return}ke(l,"重判成功"),await X.push({name:"judge-list",query:{problem_id:o.value.problemId,language:o.value.language}})}catch(c){console.error(c),F(l,"重判失败")}finally{y.value=!1}},V=async()=>{u.value=!0;try{const c=await cn();if(c.code!==0){F(l,c.code);return}ke(l,"重判成功"),await X.push({name:"judge-list"})}catch(c){console.error(c),F(l,"重判失败")}finally{u.value=!1}};return(c,P)=>{const g=G,_=he,m=Ae,d=ze,h=Kt,b=ft,i=we,r=Ue;return D(),ae(pe,null,[t(_,{class:"yj-manage-card",title:"重判最近提交"},{default:a(()=>[t(g,{onClick:f,loading:n.value},{default:a(()=>P[3]||(P[3]=[x("重判")])),_:1},8,["loading"])]),_:1}),t(_,{class:"yj-manage-card",title:"重判指定记录"},{default:a(()=>[t(r,{layout:"inline",onSubmit:s},{default:a(()=>[t(d,{label:"题号"},{default:a(()=>[t(m,{modelValue:o.value.problemId,"onUpdate:modelValue":P[0]||(P[0]=R=>o.value.problemId=R),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(d,{label:"语言"},{default:a(()=>[t(b,{modelValue:o.value.language,"onUpdate:modelValue":P[1]||(P[1]=R=>o.value.language=R),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:a(()=>[(D(!0),ae(pe,null,Pe(v.value,R=>(D(),M(h,{key:R.value,value:R.value,label:R.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"状态"},{default:a(()=>[t(b,{modelValue:o.value.status,"onUpdate:modelValue":P[2]||(P[2]=R=>o.value.status=R),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:a(()=>[(D(!0),ae(pe,null,Pe(k.value,R=>(D(),M(h,{key:R.value,value:R.value,label:R.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(d,null,{default:a(()=>[t(i,null,{default:a(()=>[t(g,{theme:"primary",type:"submit",loading:y.value},{default:a(()=>P[4]||(P[4]=[x("重判")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(_,{class:"yj-manage-card",title:"重判所有"},{default:a(()=>[t(g,{onClick:V,theme:"danger",loading:u.value},{default:a(()=>P[5]||(P[5]=[x("重判")])),_:1},8,["loading"])]),_:1})],64)}}}),eu=ce(Qr,[["__scopeId","data-v-6a706c72"]]),tu=de({__name:"ManageWeb",setup(e){const{globalProperties:l}=_e(),n=p({theme:"",content:""}),u=p({title:"",content:""}),o=p(!1),y=p(!1),v=p(!1);async function k(P,g){v.value=!0,await it(P,g,l,Ql),v.value=!1}const f=async()=>{y.value=!0;try{const P=await en(n.value.theme,n.value.content);if(P.code!==0){F(l,P.code);return}ke(l,"保存成功")}catch(P){console.error(P),F(l,"保存失败")}finally{y.value=!1}},s=async()=>{v.value=!0;try{const P=u.value.content,g=await tn(u.value.title,P);if(g.code!==0){F(l,g.code);return}u.value.content=g.data.content,ke(l,"保存成功")}catch(P){console.error(P),ge(l,"保存失败")}finally{v.value=!1}},V=async()=>{n.value=await xa()},c=async()=>{try{u.value=await Va()}catch{ge(l,"加载公告失败"),u.value={title:"",content:""}}};return fe(async()=>{o.value=!0;try{await V(),await c()}catch{ge(l,"加载数据失败")}o.value=!1}),(P,g)=>{const _=ft,m=ze,d=Ae,h=G,b=we,i=Ue,r=he,R=Re("md-editor-v3"),I=Te;return D(),M(I,{loading:o.value},{default:a(()=>[t(r,{class:"yj-manage-card",title:"站点通知"},{default:a(()=>[t(i,{onSubmit:f},{default:a(()=>[t(m,{label:"主题"},{default:a(()=>[t(_,{modelValue:n.value.theme,"onUpdate:modelValue":g[0]||(g[0]=w=>n.value.theme=w),options:[{label:"success",value:"success"},{label:"info",value:"info"},{label:"warning",value:"warning"},{label:"error",value:"error"}],placeholder:"请选择主题"},null,8,["modelValue"])]),_:1}),t(m,{label:"内容"},{default:a(()=>[t(d,{modelValue:n.value.content,"onUpdate:modelValue":g[1]||(g[1]=w=>n.value.content=w),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),t(m,null,{default:a(()=>[t(b,null,{default:a(()=>[t(h,{theme:"primary",type:"submit",loading:y.value},{default:a(()=>g[4]||(g[4]=[x("保存")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(r,{class:"yj-manage-card",title:"首页公告"},{actions:a(()=>[t(h,{theme:"primary",loading:v.value,onClick:s},{default:a(()=>g[5]||(g[5]=[x("保存")])),_:1},8,["loading"])]),default:a(()=>[t(i,{onSubmit:s},{default:a(()=>[t(m,{label:"标题"},{default:a(()=>[t(d,{modelValue:u.value.title,"onUpdate:modelValue":g[2]||(g[2]=w=>u.value.title=w),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1}),t(I,{loading:v.value},{default:a(()=>[t(R,{modelValue:u.value.content,"onUpdate:modelValue":g[3]||(g[3]=w=>u.value.content=w),onSave:s,onOnUploadImg:k,previewTheme:"cyanosis",class:"dida-description-editor"},null,8,["modelValue"])]),_:1},8,["loading"])]),_:1})]),_:1},8,["loading"])}}}),au=ce(tu,[["__scopeId","data-v-4d343ab4"]]),Ka=[{name:"problem-list",tab:"problem",sidebar:"problem-list",path:"",title:"问题列表",icon:"list",component:po},{name:"problem-detail",tab:"problem",sidebar:"problem-list",path:":problemId+",title:"问题详情",icon:"list",component:jt},{name:"problem-daily-list",tab:"problem",sidebar:"problem-daily-list",path:"daily",title:"每日一题",icon:"list",component:Fo},{name:"problem-daily-detail",tab:"problem",sidebar:"problem-daily-list",path:"daily/:dailyId+",title:"问题详情",icon:"list",component:jt},{name:"problem-recommend",tab:"problem",sidebar:"problem-recommend",path:"recommend/:problemId*",title:"问题推荐",icon:"cpu",needLogin:!0,component:Yo},{name:"problem-collection-list",tab:"problem",sidebar:"problem-collection-list",path:"collection",title:"题目集合",icon:"list",disableTabPath:!0,component:bs},{name:"collection-detail",tab:"collection-detail-tab",sidebar:"collection-detail",path:":collectionId+",title:"题集详情",icon:"cpu",component:Ss},{name:"collection-rank",tab:"collection-detail-tab",sidebar:"collection-rank",path:":collectionId+/rank",title:"题集排名",icon:"list",component:Cs},{name:"collection-edit",tab:"collection-detail-tab",sidebar:"collection-edit",disableSidebar:!0,needLogin:!0,path:":collectionId+/edit",title:"题集编辑",icon:"list",component:oa},{name:"collection-create",tab:"collection-detail-tab",sidebar:"collection-create",needLogin:!0,disableSidebar:!0,path:"create",title:"新建题集",icon:"list",component:oa},{name:"judge-list",tab:"judge",sidebar:"judge-list",path:"",title:"评测列表",icon:"list",component:ra},{name:"judge-detail",tab:"judge",sidebar:"judge-list",path:":judgeId+",title:"评测详情",icon:"cpu",component:ia},{name:"contest-list",tab:"contest",sidebar:"contest-list",path:"",title:"比赛列表",icon:"list",component:da},{name:"contest-recent",tab:"contest",sidebar:"contest-recent",path:"recent",title:"近期比赛",icon:"list",component:da},{name:"contest-create",tab:"contest",sidebar:"contest-create",disableSidebar:!0,needLogin:!0,path:"create",title:"新建比赛",icon:"list",component:ma},{name:"contest-edit",tab:"contest-detail-tab",sidebar:"contest-edit",disableSidebar:!0,needLogin:!0,path:":contestId+/edit",title:"比赛编辑",icon:"list",component:ma},{name:"contest-detail",tab:"contest-detail-tab",sidebar:"contest-detail",path:":contestId+",title:"比赛详情",icon:"cpu",component:Ws},{name:"contest-problem-detail",tab:"contest-detail-tab",sidebar:"contest-problem-detail",path:":contestId+/problem/:problemIndex+",title:"问题详情",icon:"cpu",disableSidebar:!0,component:jt},{name:"contest-judge",tab:"contest-detail-tab",sidebar:"contest-judge",path:":contestId+/judge",title:"评测列表",icon:"list",component:ra},{name:"contest-judge-detail",tab:"contest-detail-tab",sidebar:"contest-judge-detail",path:":contestId+/judge/:judgeId+",title:"评测详情",icon:"cpu",component:ia,disableSidebar:!0},{name:"contest-rank",tab:"contest-detail-tab",sidebar:"contest-rank",path:":contestId+/rank",title:"比赛排名",icon:"list",component:tr},{name:"contest-discuss",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss",title:"比赛讨论",icon:"list",component:$t},{name:"contest-discuss-detail",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss/:discussId+",title:"讨论详情",icon:"list",component:Ut},{name:"discuss-list",tab:"discuss",sidebar:"discuss-list",path:"",title:"讨论列表",icon:"list",component:$t},{name:"discuss-create",tab:"discuss",sidebar:"discuss-create",disableSidebar:!0,needLogin:!0,path:"create",title:"新建讨论",icon:"list",component:pa},{name:"discuss-edit",tab:"discuss-detail-tab",sidebar:"discuss-edit",disableSidebar:!0,needLogin:!0,path:":discussId+/edit",title:"编辑讨论",icon:"list",component:pa},{name:"discuss-list-problem",tab:"discuss",sidebar:"discuss-list-problem",path:"problem",title:"题目讨论",icon:"list",component:$t},{name:"discuss-detail",tab:"discuss",sidebar:"discuss-list",path:":discussId+",title:"讨论详情",icon:"list",component:Ut},{name:"rank-ac-all",tab:"rank",sidebar:"rank-ac-all",path:"ac",title:"AC排名",icon:"base-station",props:{type:"all"},component:st},{name:"rank-ac-problem",tab:"rank",sidebar:"rank-ac-problem",path:"ac/problem",title:"题量排名",icon:"base-station",props:{type:"problem"},component:st},{name:"rank-ac-problem-today",tab:"rank",sidebar:"rank-ac-problem-today",path:"ac/problem/today",title:"今日题量",icon:"base-station",props:{type:"problem-today"},component:st},{name:"rank-ac-problem-day7",tab:"rank",sidebar:"rank-ac-problem-day7",path:"ac/problem/day7",title:"7日题量",icon:"base-station",props:{type:"problem-day7"},component:st},{name:"rank-ac-problem-day30",tab:"rank",sidebar:"rank-ac-problem-day30",path:"ac/problem/day30",title:"30日题量",icon:"base-station",props:{type:"problem-day30"},component:st},{name:"rank-ac-problem-year",tab:"rank",sidebar:"rank-ac-problem-year",path:"ac/problem/year",title:"1年题量",icon:"base-station",props:{type:"problem-year"},component:st},{name:"system-status",tab:"system",sidebar:"system-status",path:"",title:"运行状态",icon:"base-station",component:Zr},{name:"system-about",tab:"system",sidebar:"system-about",path:"about",title:"关于",icon:"base-station",props:{discussId:"93"},component:Ut},{name:"manage-problem-create",tab:"manage",sidebar:"manage-problem-create",disableSidebar:!0,path:"problem",title:"新建问题",icon:"list",component:na,auths:[je.ManageProblem]},{name:"manage-problem",tab:"manage",sidebar:"manage-problem",disableSidebar:!0,path:"problem/:problemId+",title:"问题编辑",icon:"list",component:na,auths:[je.ManageProblem]},{name:"manage-problem-daily-create",tab:"manage",sidebar:"manage-problem-daily-create",disableSidebar:!0,path:"problem/daily",title:"新建每日一题",icon:"list",component:la,auths:[je.ManageProblemDaily]},{name:"manage-problem-daily",tab:"manage",sidebar:"manage-problem-daily",disableSidebar:!0,path:"problem/daily/:dailyId+",title:"编辑每日一题",icon:"list",component:la,auths:[je.ManageProblemDaily]},{name:"manage-problem-judge",tab:"manage",sidebar:"manage-problem-judge",disableSidebar:!0,path:"problem/:problemId+/judge",title:"评测数据",icon:"list",component:rs,auths:[je.ManageProblem]},{name:"manage-web",tab:"manage",path:"web",sidebar:"manage-web",title:"站点管理",icon:"list",auths:[je.ManageWeb],component:au},{name:"manage-judge",tab:"manage",path:"judge",sidebar:"manage-judge",title:"评测管理",icon:"list",auths:["i-manage-judge"],component:eu},{name:"login-forget",tab:"login",path:"forget",title:"忘记密码",component:Br}],fa=(e,l,n,u)=>{u.tab==n&&(u.disableSidebar&&l!=u.sidebar||u.sidebar==null||u.sidebar!=u.name||e.push({name:u.name,title:u.title,icon:u.icon,to:{name:u.name}}))},lu=(e,l)=>{const n=[];return Ka.forEach(u=>{if(Ra(u)){const o=[];u.children.forEach(y=>{fa(o,e,l,y)}),o.length>0&&n.push({title:u.title,children:o})}else fa(n,e,l,u)}),n},va=(e,l)=>{const n=no(l.tab),u={name:l.name,path:"/"+l.path,meta:{title:l.title+" - "+n.title,tab:l.tab,sidebar:l.sidebar,showSidebar:n.showSidebar,needLogin:n.needLogin||l.needLogin,tabAuths:n.auths,auths:l.auths},props:l.props,component:l.component};!n.disablePath&&!l.disableTabPath&&(u.path=n.path+u.path),e.push(u)},nu=e=>{Ka.forEach(l=>{Ra(l)?l.children.forEach(n=>{va(e,n)}):va(e,l)})},ou={class:"sh-main"},su=de({__name:"View403",setup(e){let l=Se();const n=p("");return fe(()=>{l.query.target?n.value=l.query.target:n.value=l.fullPath}),(u,o)=>{const y=G;return D(),ae("div",ou,[U("p",null,q(n.value),1),o[2]||(o[2]=U("p",null,"该页面无访问权限，请更换访问目标或重新登陆后再试",-1)),t(y,{theme:"primary",onClick:o[0]||(o[0]=()=>u.$router.push("/"))},{default:a(()=>o[1]||(o[1]=[x("返回首页")])),_:1})])}}}),Fa=ce(su,[["__scopeId","data-v-8f62f1f8"]]),gt=[];so(gt);nu(gt);gt.push({path:"/403",name:"403",component:Fa});gt.push({path:"/:pathMatch(.*)*",name:"404",component:Aa});const X=ol({history:sl("/"),routes:gt});X.beforeEach((e,l,n)=>{if(e.name==null||!X.hasRoute(e.name)){n({name:"home"});return}const u=e.matched[e.matched.length-1].meta;if(u.redirect){n({name:u.redirect});return}if(u.needLogin){const y=Fe();if(y.getToken==null||y.getToken==""){n({name:"login",query:{redirect_uri:e.fullPath}});return}}const o=u.tabAuths;if(o&&!Fe().hasAllAuths(o)){n({name:"403",query:{target:e.fullPath}});return}n()});X.afterEach((e,l)=>{if(e.name===l.name)return;const n=Pt(),u=Ze();let o=null;if(e.matched.length>0&&(o=e.matched[e.matched.length-1].meta),o!=null&&o.title&&u.setTitle(o==null?void 0:o.title),o!=null&&o.showSidebar){n.setSidebarShow(!0);const y=lu(o==null?void 0:o.sidebar,o==null?void 0:o.tab);n.setMenuList(y),n.setMenuActiveName(o==null?void 0:o.sidebar)}else n.setSidebarShow(!1);window.scrollTo(0,0)});const Oa=pt("login",{state:()=>({Loaded:!1}),getters:{isLoaded(){return this.Loaded}}}),ru=de({__name:"HeaderContent",setup(e){const l=Oa(),n=Fe(),{globalProperties:u}=_e(),o=p(l.isLoaded),y=p(!1),v=p(n.getUsername),k=p(n.getNickname),f=p(),s=()=>{f.value=oo(n)};l.$subscribe((P,g)=>{o.value=g.Loaded}),n.$subscribe((P,g)=>{v.value=g.username,k.value=g.nickname,y.value=g.token!="",s()});const V=()=>{u.$router.currentRoute.value.name!=="login"&&u.$router.push({name:"login",query:{redirect_uri:u.$router.currentRoute.value.fullPath}})},c=()=>{n.clear(),u.$message.success({duration:3e3,content:"注销成功"}),u.$router.push({path:"/login",query:{redirect_uri:u.$router.currentRoute.value.fullPath}})};return fe(()=>{s()}),(P,g)=>{const _=Re("router-link"),m=Ia,d=Ca,h=Dl,b=Ll;return D(),M(b,{modelValue:P.$route.meta.tab,"onUpdate:modelValue":g[0]||(g[0]=i=>P.$route.meta.tab=i),class:"sh-menu","expand-type":"popup"},{logo:a(()=>[t(_,{to:"/",class:"sh-logo"},{default:a(()=>g[1]||(g[1]=[x("DidaOJ")])),_:1})]),operations:a(()=>[o.value&&y.value?(D(),M(h,{key:0,title:k.value},{icon:a(()=>[t(m,{name:"user"})]),default:a(()=>[t(d,{value:"user",to:{path:"/user/"+v.value}},{default:a(()=>g[2]||(g[2]=[x("个人空间")])),_:1},8,["to"]),t(d,{value:"user_logout",onClick:c},{default:a(()=>g[3]||(g[3]=[x(" 注销")])),_:1})]),_:1},8,["title"])):o.value?(D(),M(d,{key:2,value:"login",onClick:V},{icon:a(()=>[t(m,{name:"login"})]),default:a(()=>[g[5]||(g[5]=x(" 登录 "))]),_:1})):(D(),M(d,{key:1,value:"login"},{icon:a(()=>[t(m,{name:"login"})]),default:a(()=>[g[4]||(g[4]=x(" ... "))]),_:1}))]),default:a(()=>[(D(!0),ae(pe,null,Pe(f.value,i=>(D(),M(d,{key:i.name,value:i.name,to:{name:i.name}},{icon:a(()=>[i.icon?(D(),M(m,{key:0,name:i.icon},null,8,["name"])):le("",!0)]),default:a(()=>[x(" "+q(i.title),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])}}}),uu=ce(ru,[["__scopeId","data-v-cdf693c2"]]),iu={id:"menu-container"},du=de({__name:"SidebarContent",setup(e){const l=Pt(),n=p(!1),u=p(null),o=p(l.menuActiveName),y=p(l.menuList),v=p([]),k=p(!1),f=()=>{o.value=l.menuActiveName;const V=JSON.stringify(y.value),c=JSON.stringify(l.menuList);V!==c&&(v.value.push([...l.menuList]),s())},s=async()=>{if(v.value.length>0&&!k.value){for(k.value=!0;v.value.length>1;)v.value.shift();const V=v.value.shift();n.value=V.length<=0,y.value=[],await mt(),u.value&&u.value.updateActiveName(),await new Promise(P=>setTimeout(P,300)),y.value=V,await mt(),u.value&&u.value.updateActiveName();const c=300;await new Promise(P=>setTimeout(P,c)),k.value=!1,await s()}};return l.$subscribe((V,c)=>{f()}),fe(()=>{f()}),(V,c)=>{const P=Ia,g=Ca,_=$l,m=jl,d=Te;return D(),ae(pe,null,[U("div",iu,[t(m,{modelValue:o.value,"onUpdate:modelValue":c[0]||(c[0]=h=>o.value=h),theme:"light",class:"sh-menu-container"},{default:a(()=>[t(rl,{name:"move-left"},{default:a(()=>[(D(!0),ae(pe,null,Pe(y.value,(h,b)=>(D(),ae(pe,{key:b},[ve(ro)(h)?(D(),M(_,{key:0,title:h.title},{default:a(()=>[(D(!0),ae(pe,null,Pe(h.children,(i,r)=>(D(),M(g,{key:i.name,value:i.name,to:i.to},Zt({default:a(()=>[x(" "+q(i.title),1)]),_:2},[i.icon?{name:"icon",fn:a(()=>[t(P,{name:i.icon,class:Et(i.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))),128))]),_:2},1032,["title"])):(D(),M(g,{key:h.name,value:h.name,to:h.to},Zt({default:a(()=>[x(" "+q(h.title),1)]),_:2},[h.icon?{name:"icon",fn:a(()=>[t(P,{name:h.icon,class:Et(h.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),t(d,{size:"small",loading:n.value,"show-overlay":!0,attach:"#menu-container",class:"sh-sidebar-loading",style:{"align-items":"flex-start","padding-top":"100px"}},null,8,["loading"])],64)}}}),cu=ce(du,[["__scopeId","data-v-96e2d89f"]]),mu={};function pu(e,l){return null}const fu=ce(mu,[["render",pu]]),vu={class:"footer"},_u={class:"footer-left"},gu={class:"foot-time"},bu={class:"footer-center"},hu={href:"https://beiancx.miit.gov.cn/",target:"_blank"},yu={class:"footer-right"},wu={class:"foot-text"},ku={href:"https://github.com/hpu-developer/DiDaOJ-web",target:"_blank"},Su={class:"foot-text"},Cu={href:"https://github.com/hpu-developer/DiDaOJ-go",target:"_blank"},Iu=de({__name:"FooterContent",setup(e){const l=p("");function n(){l.value=new Date().toLocaleString()}return fe(()=>{n(),setInterval(()=>{n()},1e3)}),(u,o)=>{const y=G;return D(),ae("div",vu,[U("div",_u,[U("p",gu,q(l.value),1)]),U("div",bu,[U("a",hu,[t(y,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>o[0]||(o[0]=[x("豫ICP备15024677号-4")])),_:1})])]),U("div",yu,[U("p",wu,[U("a",ku,[t(y,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>o[1]||(o[1]=[x("@didaoj-web")])),_:1})])]),U("p",Su,[U("a",Cu,[t(y,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>o[2]||(o[2]=[x("@didaoj-go")])),_:1})])])])])}}}),Pu=ce(Iu,[["__scopeId","data-v-44f2e4e7"]]),bt=20,At=100,Rt=50,xu=de({__name:"ForceHiddenSidebarButton",setup(e){let l=Pt();const n=p({x:window.innerWidth-At-bt,y:window.innerHeight-Rt-bt}),u=p(window.innerWidth),o=p(window.innerHeight);let y=!1,v={x:0,y:0};const k=h=>{y=!0;const b=h.clientX??h.touches[0].clientX,i=h.clientY??h.touches[0].clientY;v={x:b-n.value.x,y:i-n.value.y},document.addEventListener("mousemove",f),document.addEventListener("touchmove",f),document.addEventListener("mouseup",s),document.addEventListener("touchend",s)},f=h=>{if(!y)return;const b=h.clientX??h.touches[0].clientX,i=h.clientY??h.touches[0].clientY;let r=b-v.x,R=i-v.y;r=Math.max(0,Math.min(r,u.value-At)),R=Math.max(0,Math.min(R,o.value-Rt)),n.value={x:r,y:R}},s=()=>{y=!1,document.removeEventListener("mousemove",f),document.removeEventListener("touchmove",f),document.removeEventListener("mouseup",s),document.removeEventListener("touchend",s)},V=()=>{u.value=window.innerWidth,o.value=window.innerHeight,n.value={x:Math.min(n.value.x,u.value-At-bt),y:Math.min(n.value.y,o.value-Rt-bt)}};let c=p(l.forceHiddenSidebar),P=p(l.forceHiddenSidebar);const g=()=>{c.value=!c.value,l.setForceHiddenSidebar(c.value)},_=()=>{P.value||(P.value=!0,l.setForceHiddenSidebar(c.value))},m=()=>{P.value&&(P.value=!1,l.setForceHiddenSidebar(!1))},d=h=>{h>=800?m():_()};return d(u.value),$e(u,h=>{d(h)}),fe(()=>{window.addEventListener("resize",V)}),De(()=>{window.removeEventListener("resize",V)}),(h,b)=>{const i=G;return ve(P)?(D(),M(i,{key:0,class:"draggable-button",style:ga({top:`${n.value.y}px`,left:`${n.value.x}px`}),onMousedown:k,onTouchstart:k,variant:"dashed",theme:"primary",onClick:g},{default:a(()=>[x(q(ve(c)?"显示":"隐藏"),1)]),_:1},8,["style"])):le("",!0)}}}),Vu=ce(xu,[["__scopeId","data-v-1aee5506"]]),ht="DidaOJ",Tu=de({__name:"App",setup(e){const{globalProperties:l}=_e(),n=Oa(),u=Fe(),o=Ze(),y=Pt();n.$patch({Loaded:!1});const v=u.getToken,k=p(!1),f=p(!1);o.title&&o.title.length>0?document.title=o.title+" - "+ht:document.title=ht,o.$subscribe((g,_)=>{_.title&&_.title.length>0?document.title=_.title+" - "+ht:document.title=ht}),y.$subscribe((g,_)=>{k.value=_.showSidebar,f.value=k.value&&!_.forceHiddenSidebar});const s=Se(),V=Be(()=>{const g=s.meta.auths;return g?!u.hasAllAuths(g):!1});function c(){l.$message.warning({duration:3e3,content:"登陆状态失效"}),n.$patch({Loaded:!0}),u.clear()}const P=async()=>{const g=document.querySelectorAll("oj-problem");if(g.length===0)return;let _={};g.forEach(h=>{const b=h.getAttribute("id"),i=document.createElement("span");i.setAttribute("style","padding:5px"),h.replaceWith(i);const r=p("default");_[b]||(_[b]=[]),_[b].push(r);let R=b;b&&!b.includes("-")&&(R="DidaOJ-"+b),ha({render:()=>dl(G,{innerHTML:R,onClick:()=>{window.open(`/problem/${b}`,"_blank")},size:"small",variant:"outline",theme:r.value})}).mount(i)});const m=[];for(const h in _)m.push(h);const d=await yn(m);if(d.code===0)for(const h in _){const b=_[h];if(!b)continue;let i="primary";const r=d.data[h];if(r)switch(r){case Oe.Accept:i="success";break;case Oe.Attempt:i="warning";break}for(const R of b)R.value=i}};return fe(()=>{document.addEventListener("DOMContentLoaded",()=>{new MutationObserver(()=>{Kl(()=>{P()},1e3)()}).observe(document.body,{childList:!0,subtree:!0}),ul.autoSpacingPage()}),v?En().then(g=>{g.code==0?(u.loadResponse(g.data),n.$patch({Loaded:!0})):(F(l,g.code),n.$patch({Loaded:!0}),u.clear())}).catch(g=>{console.log(g),c()}):n.$patch({Loaded:!0})}),(g,_)=>{const m=Ul,d=Al,h=Re("RouterView"),b=Rl,i=zl,r=El;return D(),ae(pe,null,[t(i,{class:"sh-app-layout"},{default:a(()=>[t(m,{class:"sh-header"},{default:a(()=>[t(uu)]),_:1}),t(i,null,{default:a(()=>[t(il,{name:"slide"},{default:a(()=>[f.value?(D(),M(d,{key:0,class:"sh-sidebar"},{default:a(()=>[t(cu)]),_:1})):le("",!0)]),_:1}),t(i,{class:Et(["sh-main-layout",{expanded:!f.value}])},{default:a(()=>[t(fu),t(b,{class:"sh-main-content"},{default:a(()=>[V.value?(D(),M(Fa,{key:0})):(D(),M(h,{key:1}))]),_:1}),t(Pu)]),_:1},8,["class"])]),_:1})]),_:1}),k.value?(D(),M(Vu,{key:0})):le("",!0),t(r,{container:"body",offset:["24px","80px"],size:"small"})],64)}}}),Du=ce(Tu,[["__scopeId","data-v-66c2cfa5"]]);function Lu(e,l={}){const n=/\{\{%\s*(\w+)\s+([^%]+?)\s*%\}\}/g,u=l.renderers||{},o=e.renderer.rules.text??function(y,v){return y[v].content};e.renderer.rules.text=function(y,v,k,f,s){const c=y[v].content;return n.test(c)?c.replace(n,(g,_,m)=>{const d=u[_];if(typeof d=="function"){const h=m.trim().split(/\s+/);return d(h)}else return`<span class="shortcode-${_}">${_}: ${m.trim()}</span>`}):o(y,v,k,f,s)}}function ju(e,l){const n=/\{\{%\s*(\w+)\s*%\}\}([\s\S]*?)\{\{%\s*\/\1\s*%\}\}/g;e.core.ruler.push("shortcode_color",u=>{for(const o of u.tokens){if(o.type!=="inline")continue;let y=o.content,v=!1;y=y.replace(n,(k,f,s)=>{var c;const V=(c=l.renderers)==null?void 0:c[f];return V?(v=!0,V([],s.trim())):k}),v&&(o.type="html_inline",o.tag="",o.attrs=null,o.content=y,o.children=[])}})}Fl({markdownItConfig(e){e.use(Lt,"align-left",{render(l,n){return l[n].nesting===1?`<div class="sh-align-left">
`:`</div>
`}}),e.use(Lt,"align-center",{render(l,n){return l[n].nesting===1?`<div class="sh-align-center">
`:`</div>
`}}),e.use(Lt,"align-right",{render(l,n){return l[n].nesting===1?`<div class="sh-align-right">
`:`</div>
`}}),e.use(Lu,{renderers:{problem:([l])=>`<oj-problem id="${l}">${l}</oj-problem>`}}),e.use(ju,{renderers:{red:(l,n)=>`<span class="dida-font-red">${n}</span>`,green:(l,n)=>`<span class="dida-font-green">${n}</span>`,blue:(l,n)=>`<span class="dida-font-blue">${n}</span>`}})},markdownItPlugins(e){return[...e,{type:"linkAttr",plugin:pl,options:{matcher(l){return!l.startsWith("#")},attrs:{target:"_blank"}}}]}});const Ga=cl();Ga.use(ml);const dt=ha(Du);dt.use(Ga);dt.use(X);dt.use(Ml);dt.use(Ol);dt.use(Gl);dt.mount("#app");Nl().then(()=>{console.log("Text cache reinitialized")}).catch(e=>{console.error("Text cache reinitialization failed",e)});
