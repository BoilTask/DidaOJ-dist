import{bm as at,bn as zt,n as ae,r as f,o as oe,G as $t,bo as Z,bp as z,s as t,bq as n,br as E,F as te,bs as fe,bt as K,bu as M,ap as P,u as Ae,bv as se,bw as _e,aD as me,g as la,bx as oa,by as sa,bz as ra,J as Se,q as Te,bA as ua,bB as Re,c as De,y as Le,bC as Ne,bD as it,bE as ft,ac as ia,bF as Dt,bG as ca,bH as da,aM as ma,bI as ct,a0 as pa,bJ as fa,bK as _a,B as va,bL as ga}from"./node_modules-hIhvVsNv.js";import{L as we,C as ie,S as ve,a as ba,T as ha,b as be,A as _t,c as ya,d as wa,e as ka,f as Sa,g as Ge,R as ge,B as G,F as Ve,h as ze,I as $e,D as Be,i as Ut,j as qe,k as Me,l as Ca,m as je,n as nt,o as At,O as vt,P as Ia,p as Rt,q as Et,r as Pa,s as Ta,t as ja,u as xa,v as La,w as Va,x as za,M as qt,y as Mt,z as $a,H as Da,E as Ua,G as Aa,J as Ra,K as Ea,N as qa,Q as Ma,U as Ka,V as Fa}from"./tdesign-vue-next-7lmwW_kX.js";import{V as pe}from"./vditor-DArazWIS.js";import{e as kt}from"./monaco-editor-BHsDS0An.js";import{H as Ga,v as Oa}from"./highlight.js-D9zWiMxS.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const _ of u.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&r(_)}).observe(document,{childList:!0,subtree:!0});function l(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(o){if(o.ep)return;o.ep=!0;const u=l(o);fetch(o.href,u)}})();var xe=(e=>(e.Manage="i-manage",e.ManageJudge="i-manage-judge",e.ManageProblem="i-manage-problem",e))(xe||{});const Na={"r-admin":["i-manage","i-manage-judge","i-manage-problem"]};function Ha(e){if(e==null)return[];const a=[];for(const l of e){const r=Na[l];r!=null&&a.push(...r)}return[...new Set(a)]}function Ba(e,a){if(e==null||a==null)return!1;const l=Ha(e);for(const r of a)if(!l.includes(r))return!1;return!0}const ke=at("user",{state:()=>({token:"",userId:-1,username:"",nickname:"",roles:[]}),getters:{getToken(){return this.token},getUserId(){return this.userId},getUsername(){return this.username},getNickname(){return this.nickname}},actions:{clear(){this.$patch({token:"",userId:-1,username:"",nickname:"",roles:[]})},loadResponse(e){this.$patch({token:e.token,userId:e.user_id,username:e.username,nickname:e.nickname,roles:e.roles})},isLogin(){return this.token!=null&&this.token!=""},hasAuth(e){return this.hasAllAuths([e])},hasAllAuths(e){return e?Ba(this.roles,e):!0}},persist:!0}),Ee=at("webStyle",{state:()=>({title:""}),getters:{getTitle(){return this.title}},actions:{setTitle(e){this.title=e}}}),lt=at("sidebarStyle",{state:()=>({showSidebar:!1,forceHiddenSidebar:!1,menuActiveName:"",menuList:[]}),getters:{getMenuList(){return this.menuList}},actions:{setSidebarShow(e){this.showSidebar=e},setForceHiddenSidebar(e){this.forceHiddenSidebar=e},setMenuActiveName(e){this.menuActiveName=e},clearMenuList(){this.menuList=[]},setMenuList(e){this.menuList=e},addMenuList(e){this.menuList.push(e)}}}),Je=zt.create({timeout:6e4,withCredentials:!1,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});Je.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function Ja(){return Je({baseURL:"https://r2-oj.didapipa.com",url:"/system/notification.json?"+Date.now(),method:"get"})}function Wa(){return Je({baseURL:"https://r2-oj.didapipa.com",url:"/status/judger.json?"+Date.now(),method:"get"})}function Kt(e){return Je({baseURL:"https://r2-oj.didapipa.com",url:"/status/judger/"+e+".json?"+Date.now(),method:"get"})}function Xa(e){return Je({baseURL:"https://r2-oj.didapipa.com",url:"/status/web.json?"+Date.now(),method:"get"})}const Ya={class:"judger-status-panel"},Za={class:"judger-status-panel"};function Qa(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ae(e)}const en=ae({__name:"SystemStatus",setup(e){const a=f([]),l=f([]),r=f(!1),o=f(!1);let u;const _=k=>{let s="失效",d="danger";const h=new Date,y=new Date(k.updateTime);return h.getTime()-y.getTime()>3e4?(s="离线",d="default"):k.cpuUsage>90?(s="CPU过高",d="warning"):k.memPercent>90?(s="内存过高",d="warning"):(s="在线",d="success"),t(ve,null,{default:()=>[t("span",null,[k.key,P(" - "),k.name]),t("span",null,[k.updateTime]),t(ha,{theme:d,size:"small"},Qa(s)?s:{default:()=>[s]})]})},L=async()=>{const k=[{key:"didaoj",name:"DidaOj"}],s={};for(let h=0;h<a.value.length;h++){const y=a.value[h];s[y.key]=y}const d=[];for(let h=0;h<k.length;h++){const y=k[h],p={key:y.key},i=await Xa(y.key);i&&(i.name?p.name=i.name:p.name="-",i.update_time?p.updateTime=new Date(i.update_time).toLocaleString():p.updateTime="-",i.cpu_usage?p.cpuUsage=Number(i.cpu_usage):p.cpuUsage=0,i.mem_usage?p.memUsage=i.mem_usage/(1024*1024*1024):p.memUsage=0,i.mem_total?p.memTotal=i.mem_total/(1024*1024*1024):p.memTotal=0,p.memTotal>0?p.memPercent=Math.round(p.memUsage/p.memTotal*1e4)/100:p.memPercent=0,p.avgMessage=i.avg_message,s[y.key]?(p.cpuUsageFrom=s[y.key].cpuUsage,p.memPercentFrom=s[y.key].memPercent,p.memUsageFrom=s[y.key].memUsage,p.memTotalFrom=s[y.key].memTotal):(p.cpuUsageFrom=0,p.memPercentFrom=0,p.memUsageFrom=0,p.memTotalFrom=0),d.push(p))}a.value=d},S=async()=>{const k=await Wa(),s={};for(let h=0;h<l.value.length;h++){const y=l.value[h];s[y.key]=y}const d=[];for(let h=0;h<k.judgers.length;h++){const y=k.judgers[h],p={key:y.key,name:y.name},i=await Kt(y.key);i&&(i.name?p.name=i.name:p.name="-",i.update_time?p.updateTime=new Date(i.update_time).toLocaleString():p.updateTime="-",i.cpu_usage?p.cpuUsage=Number(i.cpu_usage):p.cpuUsage=0,i.mem_usage?p.memUsage=i.mem_usage/(1024*1024*1024):p.memUsage=0,i.mem_total?p.memTotal=i.mem_total/(1024*1024*1024):p.memTotal=0,p.memTotal>0?p.memPercent=Math.round(p.memUsage/p.memTotal*1e4)/100:p.memPercent=0,p.avgMessage=i.avg_message,s[y.key]?(p.cpuUsageFrom=s[y.key].cpuUsage,p.memPercentFrom=s[y.key].memPercent,p.memUsageFrom=s[y.key].memUsage,p.memTotalFrom=s[y.key].memTotal):(p.cpuUsageFrom=0,p.memPercentFrom=0,p.memUsageFrom=0,p.memTotalFrom=0),d.push(p))}l.value=d},v=async()=>{await L(),r.value=!1,await S(),o.value=!1};return oe(async()=>{l.value=[],a.value=[],o.value=!0,r.value=!0,await v(),u=setInterval(()=>{v()},5e3)}),$t(()=>{clearInterval(u)}),(k,s)=>{const d=ba,h=ve,y=ie,p=we;return z(),Z(te,null,[t(y,{title:"接口状态",class:"judger-status"},{default:n(()=>[t(p,{loading:r.value},{default:n(()=>[E("div",Ya,[(z(!0),Z(te,null,fe(a.value,i=>(z(),K(y,{key:i.key,header:()=>_(i),class:"judge-status-judger"},{footer:n(()=>[E("span",null," 负载信息："+M(i.avgMessage),1)]),default:n(()=>[t(h,{class:"judge-status-judger"},{default:n(()=>[t(d,{title:"CPU使用率",value:i.cpuUsage,animation:{valueFrom:i.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(d,{title:"内存使用率",value:i.memPercent,animation:{valueFrom:i.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(d,{title:"内存使用量",animation:{valueFrom:i.memUsageFrom,duration:2e3},"animation-start":!0,value:i.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(d,{title:"内存总量",value:i.memTotal,animation:{valueFrom:i.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1},8,["loading"])]),_:1}),t(y,{title:"判题机状态",class:"judger-status"},{default:n(()=>[t(p,{loading:o.value},{default:n(()=>[E("div",Za,[(z(!0),Z(te,null,fe(l.value,i=>(z(),K(y,{key:i.key,header:()=>_(i),class:"judge-status-judger"},{footer:n(()=>[E("span",null," 负载信息："+M(i.avgMessage),1)]),default:n(()=>[t(h,{class:"judge-status-judger"},{default:n(()=>[t(d,{title:"CPU使用率",value:i.cpuUsage,animation:{valueFrom:i.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(d,{title:"内存使用率",value:i.memPercent,animation:{valueFrom:i.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(d,{title:"内存使用量",animation:{valueFrom:i.memUsageFrom,duration:2e3},"animation-start":!0,value:i.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(d,{title:"内存总量",value:i.memTotal,animation:{valueFrom:i.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1},8,["loading"])]),_:1})],64)}}}),ne=(e,a)=>{const l=e.__vccOpts||e;for(const[r,o]of a)l[r]=o;return l},dt=ne(en,[["__scopeId","data-v-b8c98192"]]),tn={style:{"text-align":"right"}},an=ae({__name:"Hitokoto",setup(e){const a=f(!1),l=f(""),r=f(""),o=f(""),u=async()=>{a.value=!0;try{const L=await(await fetch("https://v1.hitokoto.cn")).json();r.value=L.hitokoto,o.value=L.creator,l.value="—— "+L.from}catch(_){r.value="一言获取失败了，但至少您还可以访问本站。",o.value="BoilTask",l.value="DidaOJ",console.error("Error fetching Hitokoto:",_)}finally{a.value=!1}};return oe(()=>{u()}),(_,L)=>{const S=ie,v=we;return z(),K(v,{loading:a.value},{default:n(()=>[t(S,{title:"一言 © Hitokoto"},{actions:n(()=>[P(" @"+M(o.value),1)]),default:n(()=>[E("div",null,[E("span",null,M(r.value),1),E("p",tn,M(l.value),1)])]),_:1})]),_:1},8,["loading"])}}}),nn={class:"sh-main"},ln={class:"dida-swiper-div"},on=ae({__name:"HomeView",setup(e){let a=-1;const l=f(null),r=async()=>{l.value=await Ja()};return oe(async()=>{await r(),a=setInterval(()=>{r()},3e4)}),$t(()=>{clearInterval(a)}),(o,u)=>{const _=_t,L=wa,S=ya,v=ie,k=be,s=Ge,d=Sa,h=ka,y=ge;return z(),K(y,null,{default:n(()=>[t(k,{span:8},{default:n(()=>[E("div",nn,[l.value?(z(),K(_,{key:0,style:{margin:"20px"},theme:l.value.theme},{default:n(()=>[P(M(l.value.content),1)]),_:1},8,["theme"])):se("",!0),E("div",ln,[t(S,{class:"dida-swiper"},{default:n(()=>[t(L,null,{default:n(()=>u[0]||(u[0]=[E("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1}),t(L,null,{default:n(()=>u[1]||(u[1]=[E("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1})]),_:1})]),t(v,{title:"正在完善，欢迎提供意见建议",style:{width:"500px",margin:"0 auto"}},{default:n(()=>u[2]||(u[2]=[E("p",null,[E("a",{href:"https://codeoj.cn/",target:"_blank"},"CodeOJ"),P("的迁移计划")],-1),E("p",null,"正在开发中",-1)])),_:1})])]),_:1}),t(k,{span:4},{default:n(()=>[t(an,{style:{margin:"10px"}}),t(dt),t(v,{style:{margin:"10px"},bordered:!0},{header:n(()=>u[3]||(u[3]=[E("b",null,"友情链接",-1)])),default:n(()=>[t(h,null,{default:n(()=>[t(d,null,{default:n(()=>[t(s,{href:"https://boiltask.com",target:"_blank"},{default:n(()=>u[4]||(u[4]=[P("BoilTask Blog")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),sn=ne(on,[["__scopeId","data-v-1e5edfb9"]]),rn={class:"sh-main"},un=ae({__name:"View404",setup(e){let a=_e(),l=f(a.fullPath);return(r,o)=>{const u=G;return z(),Z("div",rn,[E("p",null,M(me(l)),1),o[2]||(o[2]=E("p",null,"该页面无效或已被迁移，请重新选择访问目标",-1)),t(u,{theme:"primary",onClick:o[0]||(o[0]=()=>r.$router.push("/"))},{default:n(()=>o[1]||(o[1]=[P("返回首页")])),_:1})])}}}),Ft=ne(un,[["__scopeId","data-v-d4218944"]]);let mt=null;async function cn(){mt=await mn()}function dn(e,a="zh"){if(mt==null)return[!1,e.toString()];const l=mt[e.toString()];if(!l)return[!1,e.toString()];let r=l[a];return r||(a="zh",r=l[a]),r?[!0,r]:[!1,e.toString()]}async function mn(){return new Promise((e,a)=>{e({404:{zh:"接口未找到"},1e3:{zh:"系统错误，请重试或等待管理员修复"},1001:{zh:"系统异常，请重试或等待管理员修复"},1002:{zh:"未知错误"},1003:{zh:"操作过于频繁，请稍后重试"},10001:{zh:"权限异常，请重新登陆后再试"},10002:{zh:"参数不符合要求"},10003:{zh:"未找到目标数据"},100001:{zh:"用户名不存在或密码不匹配"},100002:{zh:"邮件发送失败，可能是邮箱无效或达到了每日注册上限，如有问题可联系管理员解决"},100003:{zh:"验证码错误或已过期，请重新获取"},100004:{zh:"注册用户失败，可能存在同名用户"},100005:{zh:"用户名不存在，或您未在本系统绑定邮箱，请联系管理员寻求帮助"},100006:{zh:"验证码错误或已过期，请重新获取"},100007:{zh:"已存在相同标题的题目"}})})}function ce(){const{appContext:e}=la();return{globalProperties:e.config.globalProperties}}function Pe(){return 1e3}function pt(e,a,l=3e3){e.$message.success({duration:l,content:a})}function ue(e,a,l=3e3){e.$message.info({duration:l,content:a})}function re(e,a,l=3e3){e.$message.error({duration:l,content:a})}function O(e,a,l=3e3){const[r,o]=dn(a),u=r?o:`系统错误，错误提示[${o}]`;e.$message.error({duration:l,content:u})}const pn="https://oj-api.didapipa.com/",ee=zt.create({baseURL:pn,timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});ee.interceptors.request.use(e=>{const l=ke().getToken;return l&&(e.headers["X-Token"]=l),e},e=>Promise.reject(e));ee.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function fn(e){const a={};return a.id=e.id,a.username=e.username,a.nickname=e.nickname,a.email=e.email,a.slogan=e.slogan,a.organization=e.organization,a.accept=e.accept,a.attempt=e.attempt,e.email&&(a.avatar=`https://www.gravatar.com/avatar/${oa(e.email.toLowerCase().trim())}?d=identicon&s=100`),a}function _n(e,a){return ee({url:"/user/login",method:"post",data:{username:e,password:a}})}function vn(){return ee({url:"/user/login/refresh",method:"post"})}function gn(e){const a={username:e};return ee({url:`/user/info?${new URLSearchParams(a).toString()}`,method:"get"})}function bn(e,a){return ee({url:"/user/register/email",method:"post",data:{token:e,email:a}})}function hn(e,a,l,r,o){return ee({url:"/user/register",method:"post",data:{username:e,password:a,email:l,key:r,nickname:o}})}function yn(e,a){return ee({url:"/user/forget",method:"post",data:{token:e,username:a}})}function wn(e,a,l){return ee({url:"/user/password/modify",method:"post",data:{username:e,password:a,key:l}})}const kn={class:"dida-login-footer"},Sn=ae({__name:"LoginView",setup(e){const{globalProperties:a}=ce(),l=ke(),r=f(!1),o=f({username:"",password:""}),u=()=>{ue(a,"重置成功")},_=({validateResult:L,firstError:S})=>{r.value||(r.value=!0,_n(o.value.username,o.value.password).then(v=>{if(v.code===0){l.loadResponse(v.data),ue(a,"登录成功");let k=a.$route.query.redirect_uri;k||(k="/user/"+v.data.username),a.$router.push({path:k})}else O(a,v.code)}).catch(v=>{console.error("Login error",v),re(a,"登录失败")}).finally(()=>{r.value=!1}))};return oe(()=>{if(l.isLogin()){a.$router.push({path:"/user"});return}}),(L,S)=>{const v=$e,k=ze,s=G,d=Ve,h=Ge,y=ie;return z(),K(y,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:n(()=>[t(d,{ref:"form",data:o.value,colon:!0,onReset:u,onSubmit:_,class:"yj-login-form","label-width":0},{default:n(()=>[t(k,{name:"username"},{default:n(()=>[t(v,{modelValue:o.value.username,"onUpdate:modelValue":S[0]||(S[0]=p=>o.value.username=p),clearable:"",placeholder:"请输入用户名"},{"prefix-icon":n(()=>[t(me(sa))]),_:1},8,["modelValue"])]),_:1}),t(k,{name:"password"},{default:n(()=>[t(v,{modelValue:o.value.password,"onUpdate:modelValue":S[1]||(S[1]=p=>o.value.password=p),type:"password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":n(()=>[t(me(ra))]),_:1},8,["modelValue"])]),_:1}),t(k,null,{default:n(()=>[t(s,{theme:"primary",type:"submit",block:"",loading:r.value},{default:n(()=>S[4]||(S[4]=[P("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),E("div",kn,[t(h,{onClick:S[2]||(S[2]=()=>{me(a).$router.push({name:"login-forget"})})},{default:n(()=>S[5]||(S[5]=[P("忘记密码")])),_:1}),t(h,{onClick:S[3]||(S[3]=()=>{me(a).$router.push({name:"register"})})},{default:n(()=>S[6]||(S[6]=[P("注册账户")])),_:1})])]),_:1})}}}),Cn=ne(Sn,[["__scopeId","data-v-be6a0deb"]]),In={class:"dida-login-footer"},Pn=ae({__name:"RegisterView",setup(e){const{globalProperties:a}=ce(),l=ke(),r=f(!1),o=f(!1),u=f(!1),_=f("发送验证码");let L=null,S=-1;const v=f(!1),k=f(null),s=f({username:"",password:"",confirmPassword:"",nickname:"",email:"",emailKey:""}),h=f({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:T=>new Promise(j=>{const g=setTimeout(()=>{j(s.value.password===T),clearTimeout(g)})}),message:"两次密码不一致"}],nickname:[{required:!0,message:"请填写昵称"},{min:1,message:"昵称至少1个字符"},{max:30,message:"昵称最多30个字符"}],email:[{required:!0,message:"请填写邮箱"},{pattern:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"邮箱格式不正确"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),y=f(()=>t(G,{onClick:p,disabled:u.value,loading:o.value,style:"width:120px"},{default:()=>[_.value]})),p=async()=>{var c;if(!s.value.email){re(a,"请输入邮箱");return}if(!s.value.email.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)){re(a,"邮箱格式不正确");return}if(u.value||o.value)return;v.value=!0,await Te();const T=document.getElementById("cf-confirm-div");T&&T.remove();const j=document.createElement("div");j.id="cf-confirm-div",j.setAttribute("data-theme","light"),(c=k.value)==null||c.appendChild(j);const g=window;g.turnstile.ready(function(){g.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(U){v.value=!1,await i(U)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},i=async T=>{if(!u.value){o.value=!0;try{const j=await bn(T,s.value.email);if(j.code!==0){O(a,j.code);return}ue(a,"发送验证码成功"),o.value=!1,u.value=!0,L=new Date,_.value="60秒后重发",S=setInterval(()=>{const c=Math.floor((new Date().getTime()-(L==null?void 0:L.getTime()))/1e3);c>60?(_.value="发送验证码",u.value=!1,clearInterval(S)):_.value=`${60-c}秒后重发`},1e3)}catch{re(a,"发送验证码失败")}finally{o.value=!1}}},x=()=>{ue(a,"重置成功")},D=({validateResult:T,firstError:j,e:g})=>{if(!r.value){if(g.preventDefault(),T!==!0){re(a,j);return}if(s.value.password!==s.value.confirmPassword){re(a,"两次密码不一致");return}r.value=!0,hn(s.value.username,s.value.password,s.value.email,s.value.emailKey,s.value.nickname).then(c=>{c.code===0?(ue(a,"注册成功，可使用账号信息登录"),a.$router.push({name:"login"})):O(a,c.code)}).catch(c=>{console.error("Login error",c),re(a,"登录失败")}).finally(()=>{r.value=!1})}};return oe(()=>{if(l.isLogin()){a.$router.push({path:"/user"});return}}),Se(()=>{clearInterval(S)}),(T,j)=>{const g=$e,c=ze,U=Ut,A=G,$=Ve,I=Ge,b=ie,R=Be;return z(),Z(te,null,[t(b,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:n(()=>[t($,{ref:"form",rules:h.value,data:s.value,colon:!0,onReset:x,onSubmit:D,class:"yj-login-form"},{default:n(()=>[t(c,{name:"username",label:"用户名"},{default:n(()=>[t(g,{modelValue:s.value.username,"onUpdate:modelValue":j[0]||(j[0]=C=>s.value.username=C),clearable:"",placeholder:"用于登录与查找"},null,8,["modelValue"])]),_:1}),t(c,{name:"password",label:"密码"},{default:n(()=>[t(g,{modelValue:s.value.password,"onUpdate:modelValue":j[1]||(j[1]=C=>s.value.password=C),type:"password",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(c,{name:"confirmPassword",label:"确认密码"},{default:n(()=>[t(g,{modelValue:s.value.confirmPassword,"onUpdate:modelValue":j[2]||(j[2]=C=>s.value.confirmPassword=C),type:"password",clearable:"",placeholder:"请确认密码"},null,8,["modelValue"])]),_:1}),t(c,{name:"nickname",label:"昵称"},{default:n(()=>[t(g,{modelValue:s.value.nickname,"onUpdate:modelValue":j[3]||(j[3]=C=>s.value.nickname=C),clearable:"",placeholder:"用于优先在网站各处展示"},null,8,["modelValue"])]),_:1}),t(c,{name:"email",label:"邮箱"},{default:n(()=>[t(g,{modelValue:s.value.email,"onUpdate:modelValue":j[4]||(j[4]=C=>s.value.email=C),clearable:"",placeholder:"请填写常用邮箱"},null,8,["modelValue"])]),_:1}),t(c,{name:"emailKey",label:"验证码"},{default:n(()=>[t(U,{append:y.value},{default:n(()=>[t(g,{modelValue:s.value.emailKey,"onUpdate:modelValue":j[5]||(j[5]=C=>s.value.emailKey=C),clearable:"",placeholder:"请输入验证码",style:{width:"140px"}},null,8,["modelValue"])]),_:1},8,["append"])]),_:1}),t(c,null,{default:n(()=>[t(A,{theme:"primary",type:"submit",block:"",loading:r.value},{default:n(()=>j[8]||(j[8]=[P("注册")])),_:1},8,["loading"])]),_:1})]),_:1},8,["rules","data"]),E("div",In,[t(I,{onClick:j[6]||(j[6]=()=>{me(a).$router.push({name:"login"})})},{default:n(()=>j[9]||(j[9]=[P("返回登陆 ")])),_:1})])]),_:1}),t(R,{visible:v.value,"onUpdate:visible":j[7]||(j[7]=C=>v.value=C),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:n(()=>[E("div",{ref_key:"dialogContainer",ref:k,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),Tn=ne(Pn,[["__scopeId","data-v-d25e7538"]]),jn={style:{margin:"12px"}},xn=ae({__name:"UserView",setup(e){let a=_e();const{globalProperties:l}=ce(),r=Ee();let o="";const u=f(!1),_=f(null),L=f([]),S=async v=>{u.value=!0;try{let k=await gn(v);if(k.code!==0){u.value=!1,O(l,k.code),await X.push({name:"home"});return}_.value=fn(k.data.user),L.value=k.data.problems_ac,r.setTitle(_.value.nickname+" - "+r.getTitle)}catch{re(l,"获取用户信息失败"),await X.push({name:"home"})}finally{u.value=!1}};return ua(async(v,k,s)=>{if(Array.isArray(v.params.username)?o=v.params.username[0]:o=v.params.username,!o){await X.push({name:"home"});return}await S(o),s()}),oe(async()=>{if(Array.isArray(a.params.username)?o=a.params.username[0]:o=a.params.username,!o){await X.push({name:"home"});return}await S(o)}),(v,k)=>{const s=G,d=ve,h=ie,y=be,p=Ca,i=Me,x=qe,D=ge,T=we;return z(),K(T,{loading:u.value},{default:n(()=>[t(D,{class:"dida-main-content"},{default:n(()=>[t(y,{span:8},{default:n(()=>[t(h,{style:{margin:"10px"},title:"AC题目"},{default:n(()=>[t(d,{style:{"flex-wrap":"wrap"}},{default:n(()=>[(z(!0),Z(te,null,fe(L.value,j=>(z(),K(s,{key:j,size:"small",onClick:()=>me(X).push({name:"problem-detail",params:{problemId:j}})},{default:n(()=>[P(M(j),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1}),t(y,{span:4},{default:n(()=>[E("div",jn,[t(x,{layout:"vertical",bordered:!0},{default:n(()=>[t(i,{label:"头像"},{default:n(()=>{var j;return[t(p,{shape:"round",size:"100px",image:(j=_.value)==null?void 0:j.avatar,"hide-on-load-failed":!1},null,8,["image"])]}),_:1}),t(i,{label:"昵称"},{default:n(()=>{var j;return[P(M((j=_.value)==null?void 0:j.nickname),1)]}),_:1}),t(i,{label:"Slogan"},{default:n(()=>{var j;return[P(M((j=_.value)==null?void 0:j.slogan),1)]}),_:1}),t(i,{label:"邮箱"},{default:n(()=>{var j;return[P(M((j=_.value)==null?void 0:j.email),1)]}),_:1}),t(i,{label:"组织"},{default:n(()=>{var j;return[P(M((j=_.value)==null?void 0:j.organization),1)]}),_:1}),t(i,{label:"通过数量"},{default:n(()=>{var j;return[P(M((j=_.value)==null?void 0:j.accept),1)]}),_:1}),t(i,{label:"提交数量"},{default:n(()=>{var j;return[P(M((j=_.value)==null?void 0:j.attempt),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Ln=ne(xn,[["__scopeId","data-v-cef20b99"]]),gt=[{name:"home",path:"/",title:"首页",showSidebar:!1,disableGenerateTab:!0,component:sn},{name:"problem",path:"/problem",title:"题目",icon:"calculation",showSidebar:!0,redirect:"problem-list"},{name:"judge",path:"/judge",title:"评测",icon:"code",showSidebar:!0,redirect:"judge-list"},{name:"contest",path:"/contest",title:"比赛",icon:"application",showSidebar:!0,redirect:"contest-list"},{name:"contest-detail-tab",title:"比赛",path:"/contest",showSidebar:!0,disableGenerateTab:!0,redirect:"contest-list"},{name:"discuss",title:"讨论",path:"/discuss",icon:"sonic",showSidebar:!0,redirect:"discuss-list"},{name:"rank",path:"/rank",title:"排名",icon:"chart-column",showSidebar:!0,redirect:"rank-ac-all"},{name:"tool",path:"/tool",title:"工具",icon:"tools",showSidebar:!0,redirect:"tool-paste"},{name:"system",path:"/system",title:"系统",icon:"dashboard",showSidebar:!0,redirect:"system-status"},{name:"manage",path:"/manage",title:"管理",icon:"command",showSidebar:!0,redirect:"manage-judge",auths:[xe.Manage]},{name:"login",path:"/login",title:"登陆",showSidebar:!1,disableGenerateTab:!0,component:Cn},{name:"register",path:"/register",title:"注册",showSidebar:!1,disableGenerateTab:!0,component:Tn},{name:"user",path:"/user/:username+",title:"用户",showSidebar:!1,needLogin:!0,disableGenerateTab:!0,component:Ln},{name:"404",path:"/404",title:"404",showSidebar:!1,disableGenerateTab:!0,component:Ft}],Vn=e=>gt.find(a=>a.name==e),zn=e=>{const a=[];return gt.forEach(l=>{!l.disableGenerateTab&&e.hasAllAuths(l.auths)&&a.push(l)}),a},$n=e=>{gt.forEach(a=>{const l={name:a.name,path:a.path,meta:{title:a.title,tab:a.name,showSidebar:a.showSidebar,needLogin:a.needLogin,redirect:a.redirect,tabAuths:a.auths},component:a.component};e.push(l)})};function Gt(e){return e.children!==void 0}function Dn(e){return e.children!==void 0}var bt=(e=>(e[e.Unknown=-1]="Unknown",e[e.C=0]="C",e[e.Cpp=1]="Cpp",e[e.Java=2]="Java",e[e.Python=3]="Python",e[e.Pascal=4]="Pascal",e[e.Golang=5]="Golang",e[e.Lua=6]="Lua",e[e.TypeScript=7]="TypeScript",e[e.Max=8]="Max",e))(bt||{});function ht(){const e=[-1,8];return Object.values(bt).filter(a=>typeof a=="number"&&!e.includes(a)).map(a=>({value:a,label:Ot(a)}))}function Un(e){return e>-1&&e<8}function Ot(e){switch(e){case 0:return"C";case 1:return"C++";case 2:return"Java";case 3:return"Python";case 4:return"Pascal";case 5:return"Golang";case 6:return"Lua";case 7:return"TypeScript";default:return"Unknown"}}function yt(e){switch(e){case 0:return"c";case 1:return"cpp";case 2:return"java";case 3:return"python";case 4:return"pascal";case 5:return"go";case 6:return"lua";case 7:return"typescript";default:return"text"}}var ye=(e=>(e[e.Init=0]="Init",e[e.Rejudge=1]="Rejudge",e[e.Submitting=2]="Submitting",e[e.Queuing=3]="Queuing",e[e.Compiling=4]="Compiling",e[e.Running=5]="Running",e[e.Accept=6]="Accept",e[e.PE=7]="PE",e[e.WA=8]="WA",e[e.TLE=9]="TLE",e[e.MLE=10]="MLE",e[e.OLE=11]="OLE",e[e.RE=12]="RE",e[e.CE=13]="CE",e[e.CLE=14]="CLE",e[e.JudgeFail=15]="JudgeFail",e[e.SubmitFail=16]="SubmitFail",e[e.Unknown=17]="Unknown",e[e.Max=18]="Max",e))(ye||{});const An=e=>{switch(e){case 0:return"普通评测";case 1:return"特殊评测";default:return"未知"}},tt=e=>{switch(e){case 0:return"等待处理";case 1:return"重新评测";case 2:return"提交中";case 3:return"队列中";case 4:return"编译中";case 5:return"运行中";case 6:return"通过";case 7:return"格式错误";case 8:return"答案错误";case 9:return"超时";case 10:return"内存超限";case 11:return"输出超限";case 12:return"运行错误";case 13:return"编译错误";case 14:return"编译超限";case 15:return"评测失败";case 16:return"提交失败";case 17:return"未知";default:return e}},Nt=e=>{switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return"default";case 6:return"success";case 7:return"warning";default:return"danger"}};function Ht(){const e=[17,18];return Object.values(ye).filter(a=>typeof a=="number"&&!e.includes(a)).map(a=>({value:a,label:tt(a)}))}function Ke(e){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return!0;default:return!1}}function Bt(e){var l;const a={};if(a.id=e.id,a.problemId=e.problem_id,a.contestProblemIndex=e.contest_problem_index,a.status=e.status,Ke(e.status)?a.score="-":a.score=e.score.toString(),e.time?a.time=Math.ceil(e.time/1e6)+"ms":a.time="-",e.memory?a.memory=(e.memory/1024/1024).toFixed(2)+"MB":a.memory="-",a.language=Ot(e.language),a.codeLength=e.code_length,e.approve_time?a.approveTime=new Date(e.approve_time).toLocaleString():a.approveTime="-",a.author=e.author,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.code=e.code,a.compileMessage=e.compile_message,a.taskCurrent=e.task_current,a.taskTotal=e.task_total,a.task=[],e.task)for(let r=0;r<((l=e.task)==null?void 0:l.length);r++){const o=e.task[r],u={};u.taskId=o.task_id,u.status=o.status,o.time?u.time=Math.ceil(o.time/1e6)+"ms":u.time="-",o.memory?u.memory=(o.memory/1024/1024).toFixed(2)+"MB":u.memory="-",u.score=o.score,u.content=o.content,u.waHint=o.wa_hint,!u.content&&!u.waHint&&(u.content="无提示信息"),a.task.push(u)}return e.judger&&(a.judger=e.judger),e.judge_time&&(a.judgeTime=new Date(e.judge_time).toLocaleString()),a}function Rn(e,a,l,r,o){return ee({url:"/judge/approve",method:"post",data:{problem_id:e,contest_id:a,problem_index:l,language:r,code:o}})}function En(e){return ee({url:"/judge?id="+e,method:"get"})}function qn(e){return ee({url:"/judge/code?id="+e,method:"get"})}function Mn(e,a,l,r,o,u,_){const L=new URLSearchParams({contest_id:String(e),problem_id:a,username:l,language:String(r),status:String(o),page:String(u),page_size:String(_)});return ee({url:`/judge/list?${L.toString()}`,method:"get"})}function Kn(){return ee({url:"/judge/rejudge/recently",method:"post"})}function Fn(e,a,l){const r={};return e!=null&&(r.problem_id=e),a!=null?r.language=a:r.language=bt.Unknown,l!=null?r.status=l:r.status=18,ee({url:"/judge/rejudge/search",method:"post",data:r})}function Gn(){return ee({url:"/judge/rejudge/all",method:"post",timeout:0})}function On(e){return ee({url:"/judge/rejudge",method:"post",data:{id:Number(e)}})}var He=(e=>(e[e.None=0]="None",e[e.Attempt=1]="Attempt",e[e.Accept=2]="Accept",e))(He||{});function We(e,a){const l={};if(l.id=e.id,l.author=e.author,l.title=e.title,l.tags=[],e.tags)for(const r of e.tags){const o=a[r];o&&l.tags.push(o)}if(l.private=e.private,l.accept=e.accept,l.attempt=e.attempt,e.description!=null&&(l.description=e.description),e.time_limit!=null&&e.time_limit>=0?l.timeLimit=e.time_limit.toString()+" ms":l.timeLimit="未知",e.memory_limit!=null&&e.memory_limit>=0?l.memoryLimit=(e.memory_limit/1024).toFixed(2)+" MB":l.memoryLimit="未知",e.judge_type!=null&&(l.judgeType=An(e.judge_type)),e.insert_time!=null&&(l.insertTime=new Date(e.insert_time).toLocaleString()),e.update_time!=null&&(l.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(l.creatorNickname=e.creator_nickname),e.source!=null){const r=/\[([^\]]+)\]\(([^)]+)\)/,o=e.source.match(r);o?(l.source=o[1],l.sourceUrl=o[2]):(l.source=e.source,l.sourceUrl="")}return e.judge_md5!=null&&(l.judgeMd5=e.judge_md5),e.origin_oj!=null&&(l.originOj=e.origin_oj),e.origin_id!=null&&(l.originId=e.origin_id),e.origin_url!=null&&(l.originUrl=e.origin_url),l}function Jt(e,a,l){const r={};return e?r.id=e:(r.contest_id=a,r.problem_index=l),ee({url:`/problem?${new URLSearchParams(r).toString()}`,method:"get"})}function Wt(e){return ee({url:"/problem/tag/list?max_count="+e,method:"get"})}function Nn(e){return ee({url:"/problem/judge?id="+e,method:"get"})}function Hn(e,a,l,r,o,u){const _={};return e&&(_.oj=e),a&&(_.title=a),l&&(_.tag=l),r!==void 0&&(_.private=r?"1":"0"),o&&(_.page=o),u&&(_.page_size=u),ee({url:`/problem/list?${new URLSearchParams(_).toString()}`,method:"get"})}function Bn(e){const a={};return e&&(a.problem_id=e),ee({url:`/problem/recommend?${new URLSearchParams(a).toString()}`,method:"get"})}function Xt(e,a){return ee({url:"/problem/crawl",method:"post",data:{oj:e,id:a}})}function Jn(e,a,l,r,o,u,_){return ee({url:"/problem/create",method:"post",data:{title:e,time_limit:a,memory_limit:l,source:r,private:o,tags:u,description:_}})}function Wn(e,a,l,r,o,u,_,L){return ee({url:"/problem/edit",method:"post",data:{id:e,title:a,time_limit:l,memory_limit:r,source:o,private:u,tags:_,description:L}})}function Xn(e,a){return ee({url:"/problem/judge/data/download?id="+e+"&key="+a,method:"get"})}function Yn(e,a){const l=new FormData;return l.append("id",e),l.append("zip",a),ee({url:"/problem/judge/data",method:"post",data:l,headers:{"Content-Type":"multipart/form-data"},timeout:1e3*60*5})}const Zn={style:{margin:"10px"}},Qn={key:0,class:"dida-operation-container"};function el(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ae(e)}const tl=ae({__name:"ProblemList",setup(e){const a=_e(),l=Re(),{globalProperties:r}=ce(),o=ke();let u=null;const _=f(!1),L={};let S={};const v=f(!1),k=De(()=>o.hasAuth(xe.ManageProblem)),s=f([{title:"ID",colKey:"id",cell:(C,m)=>{let w=c(m.row.id);return t(G,{variant:"dashed",theme:w,onClick:()=>g(m.row.id)},{default:()=>[m.row.id]})}},{title:"标题",colKey:"title",cell:(C,m)=>t(G,{variant:"text",onClick:()=>g(m.row.id)},{default:()=>[m.row.title]})},{title:"标签",colKey:"tags",cell:(C,m)=>{const w=m.row.tags;if(!w||w.length===0)return"";let V=[];for(let q=0;q<w.length;q++){const F=w[q];V.push(t(G,{key:q,theme:"default",variant:"outline",size:"small",onClick:()=>$(F)},{default:()=>[F.name]}))}return t(ve,null,el(V)?V:{default:()=>[V]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),d=f(!1);let h=1,y=50;const p=f({current:h,pageSize:y,defaultCurrent:h,defaultPageSize:y,total:0,pageSizeOptions:[50,100]}),i=f(),x=f(),D=[{label:"DidaOJ",value:"didaoj"},{label:"HDU",value:"hdu"},{label:"POJ",value:"poj"},{label:"NYOJ",value:"nyoj"}],T=f({oj:"",title:"",tag:"",private:!1}),j=f({oj:"",problem:""}),g=C=>{C&&l.push({path:"/problem/"+C})},c=C=>{if(!C||!S)return"default";const m=S[C];if(!m)return"default";switch(m){case He.Accept:return"success";case He.Attempt:return"warning";default:return"default"}},U=async()=>{await l.push({query:{...a.query,oj:T.value.oj,title:T.value.title,tag:T.value.tag,private:T.value.private?"1":"0",page:1,page_size:p.value.defaultPageSize}})},A=async()=>{try{v.value=!0;const C=await Xt(j.value.oj,j.value.problem);C.code===0?(ue(r,"搜索成功"),await l.push({name:"problem-detail",params:{problemId:C.data}})):O(r,C.code)}catch(C){console.error(C),O(r,Pe())}finally{v.value=!1}},$=C=>{C&&l.push({query:{...a.query,title:"",tag:C.name,page:1,page_size:p.value.defaultPageSize}})},I=()=>{l.push({name:"manage-problem-create"})},b=async(C,m)=>{d.value=!0;try{const{current:w,pageSize:V}=C,q=await Hn(T.value.oj,T.value.title,T.value.tag,T.value.private,w,V);if(i.value=[],q.code===0){const F=q.data.list;if(!F||F.length<=0){p.value={...p.value,total:0},S={},ue(r,"未找到记录");return}F.forEach(N=>{var le;const J=We(N,L);(le=i.value)==null||le.push(J)}),p.value={...p.value,total:q.data.total_count},S=q.data.problem_attempt_status}else m&&O(r,q.code)}catch(w){console.error(w),O(r,Pe())}finally{d.value=!1}},R=async C=>{await l.push({query:{...a.query,page:C.current,page_size:C.pageSize}})};return oe(async()=>{d.value=!0,x.value=[],Wt(-1).then(C=>{if(C.code===0){x.value=C.data.list,_.value=C.data.total_count>C.data.list.length;for(let m=0;m<C.data.list.length;m++){const w=C.data.list[m];L[w.id]=w}u=Le(()=>a.query,m=>{T.value.oj=m.oj||"",T.value.title=m.title||"",T.value.tag=m.tag||"",T.value.private=m.private==="1";const w=parseInt(m.page)||p.value.defaultCurrent,V=parseInt(m.page_size)||p.value.defaultPageSize;h=w,y=V,p.value={...p.value,current:h,pageSize:y},b({current:h,pageSize:y},!0)},{immediate:!0})}else _.value=!0}).catch(C=>{console.error(C),_.value=!0})}),Se(()=>{u&&u()}),(C,m)=>{const w=je,V=ie,q=be,F=G,N=ve,J=nt,le=ze,B=$e,Q=At,he=Ve,de=ge;return z(),K(de,null,{default:n(()=>[t(q,{span:9},{default:n(()=>[t(V,{style:{margin:"10px"}},{default:n(()=>[t(w,{data:i.value,columns:s.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:p.value,"table-layout":"auto",loading:d.value,onPageChange:R},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(q,{span:3},{default:n(()=>[E("div",Zn,[k.value?(z(),Z("div",Qn,[t(N,null,{default:n(()=>[t(F,{onClick:I},{default:n(()=>m[7]||(m[7]=[P("新建")])),_:1})]),_:1})])):se("",!0),t(V,{class:"sh-card"},{default:n(()=>[t(he,{model:T.value,onSubmit:U},{default:n(()=>[t(le,{label:"OJ"},{default:n(()=>[t(J,{modelValue:T.value.oj,"onUpdate:modelValue":m[0]||(m[0]=W=>T.value.oj=W),options:D,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(le,{label:"标题"},{default:n(()=>[t(B,{modelValue:T.value.title,"onUpdate:modelValue":m[1]||(m[1]=W=>T.value.title=W),placeholder:"请输入关键词"},null,8,["modelValue"])]),_:1}),t(le,{label:"标签"},{default:n(()=>[t(B,{modelValue:T.value.tag,"onUpdate:modelValue":m[2]||(m[2]=W=>T.value.tag=W),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),k.value?(z(),K(le,{key:0,label:"私有"},{default:n(()=>[t(Q,{modelValue:T.value.private,"onUpdate:modelValue":m[3]||(m[3]=W=>T.value.private=W)},null,8,["modelValue"])]),_:1})):se("",!0),t(le,null,{default:n(()=>[t(F,{theme:"primary",type:"submit"},{default:n(()=>m[8]||(m[8]=[P("搜索")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(V,{class:"sh-card"},{default:n(()=>[t(he,{model:j.value,onSubmit:A},{default:n(()=>[t(le,{label:"OJ"},{default:n(()=>[t(J,{modelValue:j.value.oj,"onUpdate:modelValue":m[4]||(m[4]=W=>j.value.oj=W),options:D,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(le,{label:"题目"},{default:n(()=>[t(B,{modelValue:j.value.problem,"onUpdate:modelValue":m[5]||(m[5]=W=>j.value.problem=W),placeholder:"请输入原始题号"},null,8,["modelValue"])]),_:1}),t(le,null,{default:n(()=>[t(F,{theme:"primary",type:"submit",loading:v.value},{default:n(()=>m[9]||(m[9]=[P("前往")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),t(V,{class:"sh-card sh-background-black"},{default:n(()=>[(z(!0),Z(te,null,fe(x.value,W=>(z(),K(F,{class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:()=>$(W)},{default:n(()=>[P(M(W.name),1)]),_:2},1032,["onClick"]))),256)),_.value?(z(),K(F,{key:0,class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:m[6]||(m[6]=()=>C.$router.push("/problem/tags"))},{default:n(()=>m[10]||(m[10]=[P(" ... ")])),_:1})):se("",!0)]),_:1})])]),_:1})]),_:1})}}}),al=ne(tl,[["__scopeId","data-v-bc7185f5"]]);function Fe(e){e.querySelectorAll("pre > code:not([data-copy-attached])").forEach(l=>{l.setAttribute("data-copy-attached","true");const r=l.parentElement,o=document.createElement("div");o.className="copy-wrapper";const u=document.createElement("button");u.className="copy-btn",u.innerText="复制",u.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(l.innerText),u.innerText="已复制",setTimeout(()=>u.innerText="复制",1500)}catch{u.innerText="失败"}}),r.replaceWith(o),o.appendChild(u),o.appendChild(r)})}function Ue(e){let a="";for(;e>0;)e--,a=String.fromCharCode(65+e%26)+a,e=Math.floor(e/26);return a}async function Yt(e){const a={};if(a.id=e.id,a.ownerId=e.owner_id,a.ownerUsername=e.owner_username,a.ownerNickname=e.owner_nickname,a.title=e.title,a.startTime=new Date(e.start_time).toLocaleString(),a.endTime=new Date(e.end_time).toLocaleString(),e.descriptions){a.descriptions=[];const l={math:{inlineDigit:!0,engine:"KaTeX"}};for(let r=0;r<e.descriptions.length;r++){const o=e.descriptions[r],u={};u.title=o.title,u.content=await pe.md2html(o.content,l),u.sort=o.sort,a.descriptions.push(u)}}if(a.notification=e.notification,e.problems){a.problems=[],e.problems.sort((l,r)=>l.index-r.index);for(let l=0;l<e.problems.length;l++){const r=e.problems[l];r.accept||(r.accept=0),r.attempt||(r.attempt=0),r.id=Ue(r.index),a.problems.push(r)}}return a}function nl(e){return ee({url:"/contest?id="+e,method:"get"})}function ll(e,a){return ee({url:"/contest/list?page="+e+"&page_size="+a,method:"get"})}function ol(e){return ee({url:"/contest/rank?id="+e,method:"get"})}function sl(e){return ee({url:"/contest/create",method:"post",data:e})}const rl=["innerHTML"],ul={style:{margin:"12px"}},il={key:1},cl={class:"dida-operation-container"},dl={class:"dida-operation-container"},ml={class:"dida-code-submit-div"},pl=ae({__name:"ProblemDetail",setup(e){let a=_e();const{globalProperties:l}=ce(),r=Ee(),o=ke();let u=f(""),_="",L=0,S=0;const v=f(null),k=f(!1),s=f(null);let d=null;const h=f(null),y=f(!1),p=f(!1),i={},x=f(""),D=f([]);D.value=ht();const T=De(()=>o.hasAuth(xe.ManageProblem)),j=C=>{C&&X.push({name:"problem-list",query:{...a.query,title:"",tag:C.name}})},g=()=>{X.push({name:"manage-problem",params:{problemId:_}})},c=()=>{_?X.push({name:"judge-list",query:{problem_id:_}}):X.push({name:"contest-judge",params:{contestId:L},query:{problem_id:Ue(S)}})},U=()=>{_?X.push({name:"discuss-list-problem",query:{problem_id:_}}):X.push({name:"contest-discuss",params:{contestId:L},query:{problem_id:Ue(S)}})},A=()=>{X.push({name:"problem-recommend",params:{problemId:_}})},$=async()=>{var w,V;const C=(w=s.value)==null?void 0:w.originOj,m=(V=s.value)==null?void 0:V.originId;if(!(!C||!m))try{y.value=!0;const q=await Xt(C,m);q.code===0?(await R(),ue(l,"更新成功")):O(l,q.code)}catch{re(l,"更新失败，请稍后再试")}finally{y.value=!1}},I=async()=>{if(!_){re(l,"问题ID无效");return}const C=parseInt(x.value);if(!Un(C)){re(l,"请选择所编写的语言");return}const m=d==null?void 0:d.getValue();if(!m){re(l,"请输入所需提交的代码");return}p.value=!0;try{const w=await Rn(_,L,S,C,m);if(w.code!==0){O(l,w.code);return}ue(l,"提交成功，正在跳转到详情页面");const V=w.data.id;await X.push({path:"/judge/"+V})}finally{p.value=!1}},b=C=>{if(!d)return;const m=d.getModel();m&&kt.setModelLanguage(m,yt(C))},R=async()=>{let C=await Jt(_,L,S);if(C.code!==0){k.value=!1,O(l,C.code),await X.push({name:"problem"});return}C.data.tags&&C.data.tags.forEach(V=>{i[V.id]=V}),s.value=We(C.data.problem,i),r.setTitle(s.value.title+" - "+r.getTitle);let m=s.value.description;const w={math:{inlineDigit:!0,engine:"KaTeX"}};u.value=await pe.md2html(m,w),await Te(()=>{v.value&&(pe.mathRender(v.value),pe.highlightRender({lineNumber:!0,enable:!0},v.value),Fe(v.value),!d&&h.value&&(d=kt.create(h.value,{value:"",language:"cpp",minimap:{enabled:!0},colorDecorators:!0,readOnly:!1,theme:"vs-dark"}))),k.value=!1})};return oe(async()=>{if(Array.isArray(a.params.problemId)?_=a.params.problemId[0]:_=a.params.problemId,!_){if(Array.isArray(a.params.contestId)?L=Number(a.params.contestId[0]):L=Number(a.params.contestId),!L){re(l,"题目不存在"),await X.push({name:"problem"});return}if(Array.isArray(a.params.problemIndex)?S=parseInt(a.params.problemIndex[0]):S=parseInt(a.params.problemIndex),!S){re(l,"题目不存在"),await X.push({name:"problem"});return}}k.value=!0,await R()}),(C,m)=>{const w=ie,V=be,q=Me,F=Ge,N=G,J=ve,le=qe,B=vt,Q=nt,he=ge,de=we;return z(),K(de,{loading:k.value},{default:n(()=>[t(he,{class:"dida-main-content"},{default:n(()=>[t(V,{span:8},{default:n(()=>[t(w,{style:{margin:"10px"}},{default:n(()=>[E("div",{innerHTML:me(u),ref_key:"markdownRef",ref:v},null,8,rl)]),_:1})]),_:1}),t(V,{span:4},{default:n(()=>[E("div",ul,[t(le,{layout:"vertical",bordered:!0},{default:n(()=>{var W;return[t(q,{label:"标题"},{default:n(()=>{var H;return[P(M((H=s.value)==null?void 0:H.title),1)]}),_:1}),t(q,{label:"时间限制"},{default:n(()=>{var H;return[P(M((H=s.value)==null?void 0:H.timeLimit),1)]}),_:1}),t(q,{label:"内存限制"},{default:n(()=>{var H;return[P(M((H=s.value)==null?void 0:H.memoryLimit),1)]}),_:1}),t(q,{label:"判题方式"},{default:n(()=>{var H;return[P(M((H=s.value)==null?void 0:H.judgeType),1)]}),_:1}),t(q,{label:"正确提交"},{default:n(()=>{var H;return[P(M((H=s.value)==null?void 0:H.accept),1)]}),_:1}),t(q,{label:"提交总数"},{default:n(()=>{var H;return[P(M((H=s.value)==null?void 0:H.attempt),1)]}),_:1}),t(q,{label:"创建时间"},{default:n(()=>{var H;return[P(M((H=s.value)==null?void 0:H.insertTime),1)]}),_:1}),t(q,{label:"更新时间"},{default:n(()=>{var H;return[P(M((H=s.value)==null?void 0:H.updateTime),1)]}),_:1}),t(q,{label:"上传用户"},{default:n(()=>{var H;return[P(M((H=s.value)==null?void 0:H.creatorNickname),1)]}),_:1}),t(q,{label:"题目来源"},{default:n(()=>{var H,Y,Ce;return[(H=s.value)!=null&&H.sourceUrl?(z(),K(F,{key:0,href:(Y=s.value)==null?void 0:Y.sourceUrl,target:"_blank"},{default:n(()=>{var Ie;return[P(M((Ie=s.value)==null?void 0:Ie.source),1)]}),_:1},8,["href"])):(z(),Z("span",il,M((Ce=s.value)==null?void 0:Ce.source),1))]}),_:1}),T.value?(z(),K(q,{key:0,label:"是否私有"},{default:n(()=>{var H;return[P(M((H=s.value)!=null&&H.private?"私有":"公开"),1)]}),_:1})):se("",!0),(W=s.value)!=null&&W.originUrl?(z(),K(q,{key:1,label:"原题链接"},{default:n(()=>{var H;return[t(F,{href:(H=s.value)==null?void 0:H.originUrl,target:"_blank"},{default:n(()=>{var Y,Ce;return[P(M((Y=s.value)==null?void 0:Y.originOj)+" - "+M((Ce=s.value)==null?void 0:Ce.originId),1)]}),_:1},8,["href"])]}),_:1})):se("",!0),me(_)?(z(),K(q,{key:2,label:"标签"},{default:n(()=>[t(J,null,{default:n(()=>{var H;return[(z(!0),Z(te,null,fe((H=s.value)==null?void 0:H.tags,Y=>(z(),K(N,{key:Y.id,variant:"dashed",onClick:()=>j(Y)},{default:n(()=>[P(M(Y.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})):se("",!0)]}),_:1}),E("div",cl,[t(J,null,{default:n(()=>[t(N,{onClick:c},{default:n(()=>m[1]||(m[1]=[P("提交记录")])),_:1}),t(N,{onClick:U},{default:n(()=>m[2]||(m[2]=[P("题目讨论")])),_:1}),me(_)?(z(),K(N,{key:0,onClick:A},{default:n(()=>m[3]||(m[3]=[P("题目推荐")])),_:1})):se("",!0)]),_:1})]),E("div",dl,[t(J,null,{default:n(()=>{var W;return[T.value?(z(),K(N,{key:0,onClick:g},{default:n(()=>m[4]||(m[4]=[P("编辑")])),_:1})):se("",!0),(W=s.value)!=null&&W.originId?(z(),K(N,{key:1,onClick:$,loading:y.value},{default:n(()=>m[5]||(m[5]=[P("更新描述 ")])),_:1},8,["loading"])):se("",!0)]}),_:1})]),E("div",ml,[t(J,null,{default:n(()=>[t(Q,{modelValue:x.value,"onUpdate:modelValue":m[0]||(m[0]=W=>x.value=W),label:"语言：",placeholder:"请选择提交语言","auto-width":"",clearable:"",onChange:b},{default:n(()=>[(z(!0),Z(te,null,fe(D.value,W=>(z(),K(B,{key:W.value,value:W.value,label:W.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),t(N,{onClick:I,loading:p.value},{default:n(()=>m[6]||(m[6]=[P("提交")])),_:1},8,["loading"])]),_:1}),E("div",{ref_key:"codeEditRef",ref:h,class:"dida-code-editor"},null,512)])])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),St=ne(pl,[["__scopeId","data-v-04bf9ebd"]]),fl={style:{margin:"10px"}};function _l(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ae(e)}const vl=ae({__name:"ProblemRecommend",setup(e){const a=_e(),l=Re(),{globalProperties:r}=ce();let o=null,u="",_={},L={};const S=f([{title:"ID",colKey:"id",cell:(p,i)=>{let x=d(i.row.id);return t(G,{variant:"dashed",theme:x,onClick:()=>s(i.row.id)},{default:()=>[i.row.id]})}},{title:"标题",colKey:"title",cell:(p,i)=>t(G,{variant:"text",onClick:()=>s(i.row.id)},{default:()=>[i.row.title]})},{title:"标签",colKey:"tags",cell:(p,i)=>{const x=i.row.tags;if(!x||x.length===0)return"";let D=[];for(let T=0;T<x.length;T++){const j=x[T];D.push(t(G,{key:T,theme:"default",variant:"outline",size:"small",onClick:()=>h(j)},{default:()=>[j.name]}))}return t(ve,null,_l(D)?D:{default:()=>[D]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),v=f(!1),k=f(),s=p=>{p&&l.push({path:"/problem/"+p})},d=p=>{if(!p||!L)return"default";const i=L[p];if(!i)return"default";switch(i){case He.Accept:return"success";case He.Attempt:return"warning";default:return"default"}},h=p=>{p&&l.push({name:"problem-list",query:{tag:p.name}})},y=async p=>{v.value=!0;try{const i=await Bn(u);if(k.value=[],i.code===0){const x=i.data.list;if(!x||x.length<=0){ue(r,"暂无推荐题目");return}_={},i.data.tags&&i.data.tags.forEach(D=>{_[D.id]=D}),x.forEach(D=>{var j;const T=We(D,_);(j=k.value)==null||j.push(T)})}else p&&O(r,i.code)}catch(i){console.error(i),O(r,Pe())}finally{v.value=!1}};return oe(async()=>{v.value=!0,o=Le(()=>a.query,p=>{Array.isArray(a.params.problemId)?u=a.params.problemId[0]:u=a.params.problemId,y(!0)},{immediate:!0})}),Se(()=>{o&&o()}),(p,i)=>{const x=je,D=ie,T=be,j=ge;return z(),K(j,null,{default:n(()=>[t(T,{span:9},{default:n(()=>[t(D,{style:{margin:"10px"}},{default:n(()=>[t(x,{data:k.value,columns:S.value,"row-key":"id","vertical-align":"top",hover:!0,"table-layout":"auto",loading:v.value},null,8,["data","columns","loading"])]),_:1})]),_:1}),t(T,{span:3},{default:n(()=>[E("div",fl,[t(D,{class:"sh-card",header:"题目推荐","header-bordered":!0},{default:n(()=>i[0]||(i[0]=[P(" 根据本站其他用户的提交记录推荐类似题目"),E("br",null,null,-1),P("依据推荐算法来计算，与本用户相似度最高的用户做的题，大概率被自己感兴趣。 ")])),_:1})])]),_:1})]),_:1})}}}),gl=ne(vl,[["__scopeId","data-v-77972e8b"]]),bl=["innerHTML"];function Ct(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ae(e)}const hl=ae({__name:"JudgeJobList",setup(e){const a=_e(),l=Re(),{globalProperties:r}=ce();let o=!1,u=null,_;const L=f(!1),S=f(null),v=f(null),k=f(!1);let s=-1;const d=f({problemId:"",username:"",language:void 0,status:void 0}),h=f([{title:"ID",colKey:"id",cell:(m,w)=>t(G,{variant:"text",onClick:()=>A(w.row.id)},{default:()=>[w.row.id]})},{title:"问题",colKey:"problemId",cell:(m,w)=>{if(s){let V;return t(G,{variant:"text",onClick:()=>U(s,w.row.contestProblemIndex)},Ct(V=Ue(w.row.contestProblemIndex))?V:{default:()=>[V]})}return t(G,{variant:"text",onClick:()=>c(w.row.problemId)},{default:()=>[w.row.problemId]})}},{title:"状态",colKey:"status",align:"center",cell:(m,w)=>{const V=w.row.status,q=tt(V),F=Nt(V);let N=[];return Ke(V)&&N.push(t(we,{text:w.row.state,size:"small",class:"dida-status-loading"},null)),N.push(t("span",null,[q])),t(G,{theme:F,variant:"outline",onClick:()=>A(w.row.id)},Ct(N)?N:{default:()=>[N]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"code",cell:(m,w)=>t(G,{theme:"default",onClick:()=>g(w.row)},{default:()=>[w.row.language+" / "+w.row.codeLength]})},{title:"作者",colKey:"author",width:200,cell:(m,w)=>t(G,{variant:"text",onClick:()=>$(w.row.authorUsername)},{default:()=>[w.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),y=f(!1);let p=1,i=50;const x=f({current:p,pageSize:i,defaultCurrent:p,defaultPageSize:i,total:0,pageSizeOptions:[50,100]}),D=f(),T=f([]);T.value=ht();const j=f([]);j.value=Ht();const g=async m=>{k.value=!0,L.value=!0;try{S.value=m;const w=await qn(Number(S.value.id));if(w.code===0){const V=w.data,F=`\`\`\`${yt(V.language)}
${V.code}
\`\`\``,N={};S.value.code=await pe.md2html(F,N),await Te(()=>{v.value&&(pe.highlightRender({lineNumber:!0,enable:!0},v.value),Fe(v.value))})}else O(r,w.code)}finally{k.value=!1}},c=m=>{m&&l.push({path:"/problem/"+m})},U=(m,w)=>{l.push({name:"contest-problem-detail",params:{contestId:m,problemIndex:w}})},A=m=>{m&&(s>0?l.push({name:"contest-judge-detail",params:{contestId:s,judgeId:m}}):l.push({name:"judge-detail",params:{judgeId:m}}))},$=m=>{m&&l.push({path:"/user/"+m})},I=async()=>{await l.push({query:{...a.query,page:1,page_size:i,problem_id:d.value.problemId,username:d.value.username,language:d.value.language,status:d.value.status}})},b=async()=>{d.value.problemId="",d.value.username="",d.value.language=void 0,d.value.status=void 0,await l.push({query:{...a.query,page:1,page_size:i,problem_id:"",username:"",language:void 0,status:void 0}})},R=async(m,w)=>{w&&(y.value=!0);let V=!1;try{const{current:q,pageSize:F}=m,N=await Mn(s,d.value.problemId,d.value.username,d.value.language,d.value.status,q,F);D.value=[],N.code===0?N.data.list&&N.data.list.length>0?(N.data.list.forEach(le=>{var Q;const B=Bt(le);(Q=D.value)==null||Q.push(B),Ke(le.status)&&(V=!0)}),x.value={...x.value,total:N.data.total_count}):(ue(r,"未找到记录"),x.value={...x.value,total:0}):w&&O(r,N.code)}catch(q){console.error(q),w&&O(r,Pe())}finally{w&&(y.value=!1),V&&o&&(_=setTimeout(()=>{R({current:p,pageSize:i},!1)},5e3))}},C=async m=>{await l.push({query:{...a.query,page:m.current,page_size:m.pageSize}})};return oe(async()=>{o=!0,u=Le(()=>a.query,m=>{Array.isArray(a.params.contestId)?s=Number(a.params.contestId[0]):s=Number(a.params.contestId),d.value.problemId=m.problem_id||"",d.value.username=m.username||"",m.language!=null?d.value.language=Number(m.language):d.value.language=void 0,m.status!=null?d.value.status=Number(m.status):d.value.status=void 0;const w=parseInt(m.page)||x.value.defaultCurrent,V=parseInt(m.page_size)||x.value.defaultPageSize;p=w,i=V,x.value.pageSizeOptions.includes(i)||(i=x.value.defaultPageSize),x.value={...x.value,current:p,pageSize:i},R({current:p,pageSize:i},!0)},{immediate:!0})}),Se(()=>{o=!1,u&&u(),clearTimeout(_)}),(m,w)=>{const V=$e,q=ze,F=vt,N=nt,J=G,le=ve,B=Ve,Q=je,he=ie,de=Ge,W=we,H=Be;return z(),Z(te,null,[t(he,{style:{margin:"10px"}},{default:n(()=>[t(B,{layout:"inline",onSubmit:I,onReset:b},{default:n(()=>[t(q,{label:"题号"},{default:n(()=>[t(V,{modelValue:d.value.problemId,"onUpdate:modelValue":w[0]||(w[0]=Y=>d.value.problemId=Y),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(q,{label:"用户"},{default:n(()=>[t(V,{modelValue:d.value.username,"onUpdate:modelValue":w[1]||(w[1]=Y=>d.value.username=Y),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(q,{label:"语言"},{default:n(()=>[t(N,{modelValue:d.value.language,"onUpdate:modelValue":w[2]||(w[2]=Y=>d.value.language=Y),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:n(()=>[(z(!0),Z(te,null,fe(T.value,Y=>(z(),K(F,{key:Y.value,value:Y.value,label:Y.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(q,{label:"状态"},{default:n(()=>[t(N,{modelValue:d.value.status,"onUpdate:modelValue":w[3]||(w[3]=Y=>d.value.status=Y),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:n(()=>[(z(!0),Z(te,null,fe(j.value,Y=>(z(),K(F,{key:Y.value,value:Y.value,label:Y.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(q,null,{default:n(()=>[t(le,null,{default:n(()=>[t(J,{theme:"primary",type:"submit"},{default:n(()=>w[7]||(w[7]=[P("搜索")])),_:1}),t(J,{theme:"default",variant:"base",type:"reset"},{default:n(()=>w[8]||(w[8]=[P("重置")])),_:1})]),_:1})]),_:1})]),_:1}),t(Q,{data:D.value,columns:h.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:x.value,loading:y.value,onPageChange:C,"table-layout":"auto"},null,8,["data","columns","pagination","loading"])]),_:1}),t(H,{visible:L.value,"onUpdate:visible":w[5]||(w[5]=Y=>L.value=Y),width:"800px","cancel-btn":null,"close-btn":!1,onConfirm:w[6]||(w[6]=Y=>L.value=!1)},{header:n(()=>[t(de,{onClick:w[4]||(w[4]=()=>{var Y;A((Y=S.value)==null?void 0:Y.id)})},{default:n(()=>{var Y,Ce;return[P(M(((Y=S.value)==null?void 0:Y.id)+" - "+((Ce=S.value)==null?void 0:Ce.language)),1)]}),_:1})]),default:n(()=>[t(W,{loading:k.value},{default:n(()=>{var Y;return[E("div",{innerHTML:(Y=S.value)==null?void 0:Y.code,ref_key:"markdownCodeRef",ref:v,style:{"min-height":"100px"}},null,8,bl)]}),_:1},8,["loading"])]),_:1},8,["visible"])],64)}}}),It=ne(hl,[["__scopeId","data-v-375cd905"]]),yl={class:"dida-code-container"},wl=["innerHTML"],kl={key:2,class:"dida-edit-container"};function Pt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ae(e)}const Sl=ae({__name:"JudgeJobDetail",setup(e){const a=_e(),l=Re(),r=ke(),{globalProperties:o}=ce();let u=!1,_,L=-1;const S=f(""),v=f(null),k=f(""),s=f(null),d=f(0),h=f(null),y=f({from:"#5a96ff",to:"#00A870"});let p=!1;const i=f([{title:"ID",colKey:"id"},{title:"问题",colKey:"problemId",cell:(b,R)=>t(G,{variant:"text",onClick:()=>c(R.row.problemId)},{default:()=>[R.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(b,R)=>{const C=R.row.status,m=tt(C),w=Nt(C);let V=[];return Ke(C)&&V.push(t(we,{text:R.row.state,size:"small",class:"dida-status-loading"},null)),V.push(t("span",null,[m])),t(G,{theme:w,variant:"outline"},Pt(V)?V:{default:()=>[V]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"language",cell:(b,R)=>t("span",null,[R.row.language+" / "+R.row.codeLength])},{title:"作者",colKey:"author",width:200,cell:(b,R)=>t(G,{variant:"text",onClick:()=>U(R.row.authorUsername)},{default:()=>[R.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),x=f(!1),D=f(!1),T=f(),j=De(()=>r.hasAuth(xe.ManageJudge)),g=async()=>{if(!D.value){D.value=!0;try{const b=await On(L);b.code===0?await $(!0):O(o,b.code)}catch(b){console.error(b),O(o,Pe())}finally{D.value=!1}}},c=b=>{b&&l.push({path:"/problem/"+b})},U=b=>{b&&l.push({path:"/user/"+b})},A=b=>{const R=b.status,C=tt(R);let m;switch(R){case ye.Init:case ye.Rejudge:case ye.Compiling:case ye.Running:m="default";break;case ye.Accept:m="success";break;case ye.PE:m="warning";break;default:m="danger";break}return t(ve,null,{default:()=>[t(G,{theme:"default",variant:"outline"},{default:()=>[b.taskId]}),t(G,{theme:m,variant:"outline"},Pt(C)?C:{default:()=>[C]}),t("span",null,[P("分数："),b.score]),t("span",null,[P("用时："),b.time]),t("span",null,[P("内存："),b.memory])]})},$=async b=>{var C;b&&(x.value=!0);let R=!1;try{const m=await En(L);if(T.value=[],m.code===0){const w=m.data,V=Bt(w);if((C=T.value)==null||C.push(V),w.judger){const F=await Kt(w.judger);S.value=F.name}else S.value="";y.value.to="#00A870",Ke(w.status)?(h.value="active",V.taskTotal>0?(d.value=V.taskCurrent/V.taskTotal*100,V.taskCurrent>=V.taskTotal&&(d.value=99)):d.value=0):(d.value=100,w.status===ye.Accept?h.value="success":w.status===ye.PE?(y.value.to="#F57C20",h.value="warning"):(y.value.to="#F56C6C",h.value="error"));const q={};if(w.code){const N=`\`\`\`${yt(w.language)}
${w.code}
\`\`\``;k.value=await pe.md2html(N,q),await Te(()=>{s.value&&(p||(p=!0,pe.highlightRender({lineNumber:!0,enable:!0},s.value)),Fe(s.value))})}v.value=V,Ke(w.status)&&(R=!0)}else b&&O(o,m.code)}catch(m){console.error(m),b&&O(o,Pe())}finally{b&&(x.value=!1),R&&u&&(_=setTimeout(()=>{$(!1)},5e3))}};function I(){s.value&&s.value.parentElement&&(s.value.style.maxWidth=s.value.parentElement.clientWidth+"px")}return oe(async()=>{if(u=!0,Array.isArray(a.params.judgeId)?L=Number(a.params.judgeId[0]):L=Number(a.params.judgeId),!L){await l.push({name:"judge"});return}await $(!0),I(),window.addEventListener("resize",I)}),Se(()=>{u=!1,window.removeEventListener("resize",I),clearTimeout(_)}),(b,R)=>{var Q,he,de;const C=Ia,m=je,w=ie,V=be,q=Me,F=qe,N=ge,J=Rt,le=Et,B=G;return z(),Z(te,null,[t(C,{color:y.value,status:h.value,class:"dida-job-progress",percentage:d.value},null,8,["color","status","percentage"]),t(w,{style:{margin:"10px"}},{default:n(()=>[t(m,{data:T.value,columns:i.value,"row-key":"id","vertical-align":"top",hover:!0,loading:x.value},null,8,["data","columns","loading"])]),_:1}),t(N,null,{default:n(()=>[t(V,{span:8},{default:n(()=>[E("div",yl,[E("div",{innerHTML:k.value,ref_key:"markdownCodeRef",ref:s,class:"dida-code-div"},null,8,wl)])]),_:1}),t(V,{span:4},{default:n(()=>[t(F,{layout:"vertical",bordered:!0,style:{margin:"10px"}},{default:n(()=>[t(q,{label:"判题机"},{default:n(()=>[P(M(S.value),1)]),_:1}),t(q,{label:"判题时间"},{default:n(()=>{var W;return[P(M((W=v.value)==null?void 0:W.judgeTime),1)]}),_:1})]),_:1})]),_:1})]),_:1}),(Q=v.value)!=null&&Q.compileMessage?(z(),K(w,{key:0,class:"compile-message"},{default:n(()=>{var W;return[P(M((W=v.value)==null?void 0:W.compileMessage),1)]}),_:1})):se("",!0),(he=v.value)!=null&&he.task&&((de=v.value)==null?void 0:de.task.length)>0?(z(),K(le,{key:1,class:"task-panel"},{default:n(()=>{var W;return[(z(!0),Z(te,null,fe((W=v.value)==null?void 0:W.task,(H,Y)=>(z(),K(J,{key:H.taskId,header:()=>A(H)},{default:n(()=>[P(M(H.content)+" "+M(H.waHint),1)]),_:2},1032,["header"]))),128))]}),_:1})):se("",!0),j.value?(z(),Z("div",kl,[t(B,{onClick:g,loading:D.value},{default:n(()=>R[0]||(R[0]=[P("重新评测")])),_:1},8,["loading"])])):se("",!0)],64)}}}),Tt=ne(Sl,[["__scopeId","data-v-574eda0b"]]),Cl={style:{margin:"10px"}},Il=ae({__name:"ContestList",setup(e){const a=_e(),l=Re(),{globalProperties:r}=ce();let o=null;const u=f(!1),_=f(!1),L=f([{title:"ID",colKey:"id",width:"100",cell:(g,c)=>t(G,{variant:"text",onClick:()=>p(c.row.id)},{default:()=>[c.row.id]})},{title:"标题",colKey:"title",cell:(g,c)=>t(G,{variant:"text",onClick:()=>p(c.row.id)},{default:()=>[c.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),S=f(!1);let v=1,k=50;const s=f({current:v,pageSize:k,defaultCurrent:v,defaultPageSize:k,total:0,pageSizeOptions:[50,100]}),d=f(),h=f({title:"",username:""}),y=f({title:"",description:"",open_time:[]}),p=g=>{g&&l.push({path:"/contest/"+g})},i=async()=>{await l.push({query:{...a.query,title:h.value.title,username:h.value.username,page:1,page_size:s.value.defaultPageSize}})},x=async(g,c)=>{var U;S.value=!0;try{const{current:A,pageSize:$}=g,I=await ll(A,$);if(d.value=[],I.code===0){const b=I.data.list;for(let R=0;R<b.length;R++){const C=b[R],m=await Yt(C);(U=d.value)==null||U.push(m)}s.value={...s.value,total:I.data.total_count}}else c&&O(r,I.code)}catch(A){console.error(A),O(r,Pe())}finally{S.value=!1}},D=async g=>{await l.push({query:{...a.query,page:g.current,page_size:g.pageSize}})},T=()=>{u.value=!0},j=async()=>{_.value=!0,console.log("contestCreateForm",y.value),sl(y.value).then(g=>{g.code===0?(ue(r,"创建比赛成功"),u.value=!1,l.push({path:"/contest/"+g.data.id})):O(r,g.code)}).finally(()=>{_.value=!1})};return oe(async()=>{o=Le(()=>a.query,g=>{h.value.title=g.title||"",h.value.username=g.username||"";const c=parseInt(g.page)||s.value.defaultCurrent,U=parseInt(g.page_size)||s.value.defaultPageSize;v=c,k=U,s.value={...s.value,current:v,pageSize:k},x({current:v,pageSize:k},!0)},{immediate:!0})}),Se(()=>{o&&o()}),(g,c)=>{const U=je,A=ie,$=be,I=$e,b=ze,R=G,C=Ve,m=ve,w=ge,V=Pa,q=Be;return z(),Z(te,null,[t(w,null,{default:n(()=>[t($,{span:9},{default:n(()=>[t(A,{style:{margin:"10px"}},{default:n(()=>[t(U,{data:d.value,columns:L.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:s.value,loading:S.value,onPageChange:D},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t($,{span:3},{default:n(()=>[E("div",Cl,[t(A,{class:"sh-card"},{default:n(()=>[t(C,{model:h.value},{default:n(()=>[t(b,{label:"标题"},{default:n(()=>[t(I,{modelValue:h.value.title,"onUpdate:modelValue":c[0]||(c[0]=F=>h.value.title=F),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(b,{label:"负责人"},{default:n(()=>[t(I,{modelValue:h.value.username,"onUpdate:modelValue":c[1]||(c[1]=F=>h.value.username=F),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(b,null,{default:n(()=>[t(R,{theme:"primary",onClick:i},{default:n(()=>c[6]||(c[6]=[P("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(A,{class:"sh-card"},{default:n(()=>[t(m,null,{default:n(()=>[t(R,{onClick:T},{default:n(()=>c[7]||(c[7]=[P("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),t(q,{visible:u.value,"onUpdate:visible":c[5]||(c[5]=F=>u.value=F),header:"创建比赛",onConfirm:j,"confirm-loading":_.value},{default:n(()=>[t(C,{"label-width":80,model:y.value,onSubmit:c[4]||(c[4]=Ne(()=>{},["prevent"]))},{default:n(()=>[t(b,{label:"标题"},{default:n(()=>[t(I,{modelValue:y.value.title,"onUpdate:modelValue":c[2]||(c[2]=F=>y.value.title=F),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),t(b,{label:"开启时间"},{default:n(()=>[t(V,{"enable-time-picker":"","allow-input":"",clearable:"",modelValue:y.value.open_time,"onUpdate:modelValue":c[3]||(c[3]=F=>y.value.open_time=F)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),jt=ne(Il,[["__scopeId","data-v-3e6ea683"]]),Pl={style:{margin:"20px"}},Tl=["innerHTML"],jl={style:{margin:"12px"}},xl=ae({__name:"ContestDetail",setup(e){let a=_e();const{globalProperties:l}=ce(),r=Ee();let o=0;const u=f(!1),_=f(null),L=f([{title:"问题ID",colKey:"id",cell:(k,s)=>t(G,{variant:"text",onClick:()=>v(o,s.row.index)},{default:()=>[s.row.id]})},{title:"标题",colKey:"title",cell:(k,s)=>t(G,{variant:"text",onClick:()=>v(o,s.row.index)},{default:()=>[s.row.title]})},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),S=f([]),v=(k,s)=>{X.push({name:"contest-problem-detail",params:{contestId:k,problemIndex:s}})};return oe(async()=>{if(Array.isArray(a.params.contestId)?o=Number(a.params.contestId[0]):o=Number(a.params.contestId),!o){await X.push({name:"contest"});return}u.value=!0;const k=await nl(o);if(k.code!==0){u.value=!1,O(l,k.code),await X.push({name:"contest"});return}_.value=await Yt(k.data),S.value=_.value.problems,r.setTitle(_.value.title+" - "+r.getTitle),await Te(()=>{const s=document.querySelectorAll(".dida-content-description");s&&s.length>0&&s.forEach(d=>{pe.mathRender(d),pe.highlightRender({lineNumber:!0,enable:!0},d),Fe(d)}),u.value=!1})}),(k,s)=>{const d=_t,h=G,y=ve,p=Rt,i=Et,x=je,D=ie,T=be,j=Me,g=qe,c=ge,U=we;return z(),K(U,{loading:u.value},{default:n(()=>[t(c,{class:"dida-main-content"},{default:n(()=>[t(T,{span:8},{default:n(()=>{var A,$,I;return[E("div",Pl,[E("h1",null,M((A=_.value)==null?void 0:A.title),1),($=_.value)!=null&&$.notification?(z(),K(d,{key:0,theme:"info",message:(I=_.value)==null?void 0:I.notification},null,8,["message"])):se("",!0)]),t(i,{"default-value":[0],"expand-icon":!1,borderless:!0},{default:n(()=>{var b;return[(z(!0),Z(te,null,fe((b=_.value)==null?void 0:b.descriptions,(R,C)=>(z(),K(p,{key:C,header:R.title},it({default:n(()=>[E("div",{innerHTML:R.content,class:"dida-content-description"},null,8,Tl)]),_:2},[C===0?{name:"headerRightContent",fn:n(()=>[t(y,{size:"small"},{default:n(()=>[t(h,{size:"small"},{default:n(()=>s[0]||(s[0]=[P("收起全部")])),_:1}),t(h,{size:"small"},{default:n(()=>s[1]||(s[1]=[P("展开全部")])),_:1})]),_:1})]),key:"0"}:void 0]),1032,["header"]))),128))]}),_:1}),t(D,{style:{margin:"10px"}},{default:n(()=>[t(x,{data:S.value,columns:L.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1})]}),_:1}),t(T,{span:4},{default:n(()=>[E("div",jl,[t(g,{layout:"vertical",bordered:!0},{default:n(()=>[t(j,{label:"开始时间"},{default:n(()=>{var A;return[P(M((A=_.value)==null?void 0:A.startTime),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Ll=ne(xl,[["__scopeId","data-v-0c96c05a"]]);function Vl(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ae(e)}const zl=ae({__name:"ContestRank",setup(e){const a=_e(),l=Re(),{globalProperties:r}=ce();let o=null,u=0;const _=h=>{if(h==null)return"-";const y=Math.floor(h/3600).toString().padStart(2,"0"),p=Math.floor(h%3600/60).toString().padStart(2,"0"),i=(h%60).toString().padStart(2,"0");return`${y}:${p}:${i}`},L=[{title:"Rank",colKey:"rank",align:"center",cell:(h,y)=>t(G,{variant:"text",onClick:()=>l.push({name:"contest-user-rank",params:{contestId:u,userId:y.row.user_id}})},{default:()=>[y.row.rank]})},{title:"昵称",colKey:"nickname",cell:(h,y)=>t(G,{variant:"text",onClick:()=>l.push({name:"user",params:{username:y.row.username}})},{default:()=>[y.row.nickname]})},{title:"Solved",colKey:"solved",align:"center",cell:(h,y)=>t(G,{variant:"text",onClick:()=>l.push({name:"contest-judge",params:{contestId:u},query:{username:y.row.username,status:ye.Accept}})},{default:()=>[y.row.solved]})},{title:"Penalty",colKey:"penalty",align:"center",cell:(h,y)=>_(y.row.penalty)}],S=f([]),v=f(!1),k=f(),s=()=>{document.body.clientWidth<1e3?S.value.forEach(y=>{y.width="auto"}):S.value.forEach(y=>{y.width="150px"})},d=async h=>{v.value=!0;try{const y=await ol(u);if(S.value=L,k.value=[],y.code===0){y.data.problems.sort((D,T)=>D-T),y.data.problems.forEach((D,T)=>{S.value.push({title:Ue(D),colKey:`problem_${D}`,align:"center",title:(j,{colIndex:g})=>{let c;return t(G,{variant:"text",onClick:()=>l.push({name:"contest-problem-detail",params:{contestId:u,problemIndex:D}})},Vl(c=Ue(D))?c:{default:()=>[c]})},cell:(j,g)=>{const c=g.row[`problem_${D}`];if(!c)return"";let U="";return c.acDuration>=0&&(U=_(c.acDuration)),c.attempt>0&&(U&&(U+=" "),U+=`(-${c.attempt})`),t("span",null,[U])},attrs:j=>{const g=j.row[`problem_${D}`];return g?g.acDuration>=0?{style:{backgroundColor:"rgba(130,255,30,0.5)"}}:{style:{backgroundColor:"rgba(255,120,120,0.5)"}}:{}}})});const p=new Date(y.data.start_time),i=y.data.ranks,x=[];for(let D=0;D<i.length;D++){const T=i[D];let j={username:T.author_username,nickname:T.author_nickname},g=0,c=0;T.problems.forEach((U,A)=>{let $=-1;U.ac&&(g++,$=(new Date(U.ac).getTime()-p.getTime())/1e3,c+=$,c+=U.attempt*20*60);const I=U.index;j[`problem_${I}`]={acDuration:$,attempt:U.attempt}}),j.solved=g,j.penalty=c,x.push(j)}x.sort((D,T)=>D.solved!==T.solved?T.solved-D.solved:D.penalty-T.penalty);for(let D=0;D<x.length;D++)x[D].rank=D+1;k.value=x}else h&&O(r,y.code)}catch(y){console.error(y),O(r,Pe())}finally{v.value=!1}};return oe(async()=>{o=Le(()=>a.query,async h=>{if(Array.isArray(a.params.contestId)?u=Number(a.params.contestId[0]):u=Number(a.params.contestId),!u){await l.push({name:"contest"});return}await d(!0),s(),window.addEventListener("resize",s)},{immediate:!0})}),Se(()=>{window.removeEventListener("resize",s),o&&o()}),(h,y)=>{const p=je,i=ie,x=ge;return z(),K(x,null,{default:n(()=>[t(i,{style:{margin:"10px"}},{default:n(()=>[E("div",null,[t(p,{data:k.value,columns:S.value,"row-key":"id","vertical-align":"top",hover:!0,"table-layout":"auto",loading:v.value},null,8,["data","columns","loading"])])]),_:1})]),_:1})}}});function Zt(e){const a={};return a.id=e.id,a.authorId=e.author_id,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.title=e.title,a.content=e.content,e.insert_time&&(a.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(a.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(a.updateTime=new Date(e.update_time).toLocaleString()),a.problemId=e.problem_id,a.problemTitle=e.problem_title,a.contestId=e.contest_id,a.contestTitle=e.contest_title,a.contestProblemIndex=e.contest_problem_index,a}async function $l(e){const a={};if(a.id=e.id,a.authorId=e.author_id,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.content="",e.content){const l={math:{inlineDigit:!0,engine:"KaTeX"}};a.content=await pe.md2html(e.content,l)}return e.insert_time&&(a.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(a.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(a.updateTime=new Date(e.update_time).toLocaleString()),a}function Dl(e){return ee({url:"/discuss?id="+e,method:"get"})}function Ul(e,a,l,r,o,u){const _={};return e&&(_.contest_id=e),a&&(_.problem_id=a),l&&(_.title=l),r&&(_.username=r),o&&(_.page=o),u&&(_.page_size=u),ee({url:`/discuss/list?${new URLSearchParams(_).toString()}`,method:"get"})}function Al(e,a,l){return ee({url:"/discuss/comment/list?id="+e+"&page="+a+"&page_size="+l,method:"get"})}function Rl(e){return ee({url:"/discuss/create",method:"post",data:e})}const Qt=async(e,a)=>{a&&await e.push({name:"user",params:{username:a}})},El={style:{margin:"10px"}};function ql(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ae(e)}const Ml=ae({__name:"DiscussList",setup(e){const a=_e(),l=Re(),{globalProperties:r}=ce();let o=null;const u=f(!1),_=f(!1);let L=-1;const S=f([]),v=[],k=[{title:"标题",colKey:"title",cell:(I,b)=>t(G,{variant:"text",onClick:()=>j(b.row.id)},{default:()=>[b.row.title]})},{title:"创建人",colKey:"authorNickname",width:"200",cell:(I,b)=>t(G,{variant:"text",onClick:async()=>await Qt(l,b.row.authorUsername)},{default:()=>[b.row.authorNickname]})},{title:"创建时间",colKey:"insertTime",width:"180"},{title:"更新时间",colKey:"updateTime",width:"180"}],s=f(!1);let d=1,h=50;const y=f({current:d,pageSize:h,defaultCurrent:d,defaultPageSize:h,total:0,pageSizeOptions:[50,100]}),p=f(),i=f({problemId:"",title:"",username:""}),x=f({title:"",content:""}),D=I=>{I&&l.push({name:"problem-detail",params:{problemId:I}})},T=(I,b)=>{l.push({name:"contest-problem-detail",params:{contestId:I,problemIndex:b}})},j=I=>{if(I){if(L){l.push({name:"contest-discuss-detail",params:{contestId:L,discussId:I}});return}l.push({name:"discuss-detail",params:{discussId:I}})}},g=async()=>{await l.push({query:{...a.query,problem_id:i.value.problemId,title:i.value.title,username:i.value.username,page:1,page_size:y.value.defaultPageSize}})},c=async(I,b)=>{var R;s.value=!0;try{const{current:C,pageSize:m}=I,w=await Ul(L,i.value.problemId,i.value.title,i.value.username,C,m);if(p.value=[],w.code===0){if(w.data.list){const V=w.data.list;for(let q=0;q<V.length;q++){const F=V[q],N=await Zt(F);(R=p.value)==null||R.push(N)}}y.value={...y.value,total:w.data.total_count}}else b&&O(r,w.code)}catch(C){console.error(C),O(r,Pe())}finally{s.value=!1}},U=async I=>{await l.push({query:{...a.query,page:I.current,page_size:I.pageSize}})},A=()=>{u.value=!0},$=async()=>{_.value=!0,console.log("discussCreateForm",x.value),Rl(x.value).then(I=>{I.code===0?(ue(r,"创建比赛成功"),u.value=!1,l.push({path:"/discuss/"+I.data.id})):O(r,I.code)}).finally(()=>{_.value=!1})};return oe(async()=>{o=Le(()=>a.query,I=>{Array.isArray(a.params.contestId)?L=Number(a.params.contestId[0]):L=Number(a.params.contestId),S.value=v,L?S.value=S.value.concat([{title:"问题ID",colKey:"contestProblemIndex",width:"100",cell:(C,m)=>{let w;return m.row.contestProblemIndex?t(G,{variant:"text",onClick:()=>T(L,m.row.contestProblemIndex)},ql(w=Ue(m.row.contestProblemIndex))?w:{default:()=>[w]}):""}}]):S.value=S.value.concat([{title:"问题ID",colKey:"problemId",width:"100",cell:(C,m)=>m.row.problemId?t(G,{variant:"text",onClick:()=>D(m.row.problemId)},{default:()=>[m.row.problemId]}):""}]),S.value=S.value.concat(k),i.value.problemId=I.problem_id||"",i.value.title=I.title||"",i.value.username=I.username||"";const b=parseInt(I.page)||y.value.defaultCurrent,R=parseInt(I.page_size)||y.value.defaultPageSize;d=b,h=R,y.value={...y.value,current:d,pageSize:h},c({current:d,pageSize:h},!0)},{immediate:!0})}),Se(()=>{o&&o()}),(I,b)=>{const R=je,C=ie,m=be,w=$e,V=ze,q=G,F=Ve,N=ve,J=ge,le=Be;return z(),Z(te,null,[t(J,null,{default:n(()=>[t(m,{span:9},{default:n(()=>[t(C,{style:{margin:"10px"}},{default:n(()=>[t(R,{data:p.value,columns:S.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:y.value,loading:s.value,"table-layout":"auto",onPageChange:U},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(m,{span:3},{default:n(()=>[E("div",El,[t(C,{class:"sh-card"},{default:n(()=>[t(F,{model:i.value},{default:n(()=>[t(V,{label:"问题ID"},{default:n(()=>[t(w,{modelValue:i.value.problemId,"onUpdate:modelValue":b[0]||(b[0]=B=>i.value.problemId=B),placeholder:"请输入完整问题ID"},null,8,["modelValue"])]),_:1}),t(V,{label:"标题"},{default:n(()=>[t(w,{modelValue:i.value.title,"onUpdate:modelValue":b[1]||(b[1]=B=>i.value.title=B),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(V,{label:"创建人"},{default:n(()=>[t(w,{modelValue:i.value.username,"onUpdate:modelValue":b[2]||(b[2]=B=>i.value.username=B),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(V,null,{default:n(()=>[t(q,{theme:"primary",onClick:g},{default:n(()=>b[6]||(b[6]=[P("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(C,{class:"sh-card"},{default:n(()=>[t(N,null,{default:n(()=>[t(q,{onClick:A},{default:n(()=>b[7]||(b[7]=[P("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),t(le,{visible:u.value,"onUpdate:visible":b[5]||(b[5]=B=>u.value=B),header:"创建讨论",onConfirm:$,"confirm-loading":_.value},{default:n(()=>[t(F,{"label-width":80,model:x.value,onSubmit:b[4]||(b[4]=Ne(()=>{},["prevent"]))},{default:n(()=>[t(V,{label:"标题"},{default:n(()=>[t(w,{modelValue:x.value.title,"onUpdate:modelValue":b[3]||(b[3]=B=>x.value.title=B),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Ze=ne(Ml,[["__scopeId","data-v-29a5b754"]]),Kl={key:0,style:{margin:"20px"}},Fl=["innerHTML"],Gl=["innerHTML"],Ol={style:{margin:"10px"}},Nl={style:{margin:"10px"}},Hl={style:{margin:"10px","text-align":"right"}},Bl={style:{margin:"12px"}},Jl={key:0,class:"dida-edit-container"},Wl=ae({__name:"DiscussDetail",props:{discussId:{}},setup(e){const a=e;let l=_e();const{globalProperties:r}=ce();let o=null;const u=Ee(),_=ke();let L=f("");const S=f(""),v=f(null),k=f(!1),s=f(null),d=f(!1);let h=1,y=20;const p=f({current:1,total:0,defaultPageSize:y,defaultCurrent:h,pageSizeOptions:[20,50]}),i=f([]),x={},D=De(()=>_.hasAuth(xe.ManageDiscuss)),T=$=>{$&&X.push({name:"discuss-list",query:{...l.query,title:"",tag:$.name}})},j=()=>{X.push({name:"manage-discuss",params:{discussId:S.value}})},g=()=>t("div",{class:"t-pagination__total"},[`共 ${p.value.total} 条回复`]),c=()=>{},U=async($,I)=>{var b;d.value=!0;try{const{current:R,pageSize:C}=$,m=await Al(S.value,R,C);if(i.value=[],m.code===0){const w=m.data.list;if(w)for(let V=0;V<w.length;V++){const q=w[V],F=await $l(q);(b=i.value)==null||b.push(F),await Te(()=>{const N=document.querySelectorAll(".dida-discuss-content");N&&N.length>0&&N.forEach(J=>{pe.mathRender(J),pe.highlightRender({lineNumber:!0,enable:!0},J),Fe(J)})})}p.value={...p.value,total:m.data.total_count}}else I&&O(r,m.code)}catch(R){console.error(R),O(r,Pe())}finally{d.value=!1}},A=async $=>{await X.push({query:{...l.query,page:$.current,page_size:$.pageSize}})};return oe(async()=>{if(S.value=a.discussId,S.value||(Array.isArray(l.params.discussId)?S.value=l.params.discussId[0]:S.value=l.params.discussId),!S.value){re(r,"讨论不存在"),await X.push({name:"discuss"});return}k.value=!0;const $=await Dl(S.value);if($.code!==0){k.value=!1,O(r,$.code),await X.push({name:"discuss"});return}$.data.tags&&$.data.tags.forEach(C=>{x[C.id]=C}),s.value=Zt($.data.discuss),u.setTitle(s.value.title+" - "+u.getTitle);let I=s.value.content;const b={math:{inlineDigit:!0,engine:"KaTeX"}};L.value=await pe.md2html(I,b),await Te(()=>{v.value&&(pe.mathRender(v.value),pe.highlightRender({lineNumber:!0,enable:!0},v.value),Fe(v.value)),k.value=!1}),o=Le(()=>l.query,C=>{const m=parseInt(C.page)||p.value.defaultCurrent,w=parseInt(C.page_size)||p.value.defaultPageSize;h=m,y=w,p.value={...p.value,current:h,pageSize:y},U({current:h,pageSize:y},!0)},{immediate:!0});const R={after:()=>{}};new pe("commentEditRef",R)}),Se(()=>{o&&o()}),($,I)=>{const b=ja,R=Ta,C=ie,m=ve,w=xa,V=G,q=be,F=Me,N=qe,J=ge,le=we;return z(),K(le,{loading:k.value},{default:n(()=>[t(J,{class:"dida-main-content"},{default:n(()=>[t(q,{span:8},{default:n(()=>{var B,Q,he;return[(B=s.value)!=null&&B.problemTitle||(Q=s.value)!=null&&Q.contestTitle?(z(),Z("div",Kl,[t(R,{"max-item-width":"300"},{default:n(()=>{var de,W,H,Y,Ce;return[(de=s.value)!=null&&de.contestTitle?(z(),Z(te,{key:0},[t(b,{to:{name:"contest-detail",params:{contestId:(W=s.value)==null?void 0:W.contestId}}},{default:n(()=>{var Ie;return[P(M((Ie=s.value)==null?void 0:Ie.contestTitle),1)]}),_:1},8,["to"]),(H=s.value)!=null&&H.contestProblemIndex?(z(),K(b,{key:0,to:{name:"contest-problem-detail",params:{problemIndex:(Y=s.value)==null?void 0:Y.contestProblemIndex}}},{default:n(()=>{var Ie,wt;return[P(M(me(Ue)((Ie=s.value)==null?void 0:Ie.contestProblemIndex))+" - "+M((wt=s.value)==null?void 0:wt.problemTitle),1)]}),_:1},8,["to"])):se("",!0)],64)):(z(),Z(te,{key:1},[t(b,{to:{name:"discuss-list-problem"}},{default:n(()=>I[3]||(I[3]=[P(" 问题讨论")])),_:1}),t(b,{to:{name:"problem-detail",params:{problemId:(Ce=s.value)==null?void 0:Ce.problemId}}},{default:n(()=>{var Ie;return[P(M((Ie=s.value)==null?void 0:Ie.problemTitle),1)]}),_:1},8,["to"])],64))]}),_:1})])):se("",!0),t(C,{style:{margin:"10px"},header:(he=s.value)==null?void 0:he.title,"header-bordered":!0},{default:n(()=>[E("div",{innerHTML:me(L),class:"dida-discuss-content"},null,8,Fl)]),_:1},8,["header"]),(z(!0),Z(te,null,fe(i.value,(de,W)=>(z(),K(C,{key:W,style:{margin:"10px"},"header-bordered":""},{header:n(()=>[t(m,null,{default:n(()=>[E("span",null,M(de.authorNickname),1),E("span",null,M(de.insertTime),1)]),_:2},1024)]),default:n(()=>[E("div",{innerHTML:de.content,class:"dida-discuss-content"},null,8,Gl)]),_:2},1024))),128)),E("div",Ol,[t(w,{modelValue:p.value.current,"onUpdate:modelValue":I[0]||(I[0]=de=>p.value.current=de),"page-size":p.value.pageSize,"onUpdate:pageSize":I[1]||(I[1]=de=>p.value.pageSize=de),total:p.value.total,"page-size-options":p.value.pageSizeOptions,"show-page-size":!1,"total-content":g,onChange:A},null,8,["modelValue","page-size","total","page-size-options"])]),E("div",Nl,[I[5]||(I[5]=E("div",{id:"commentEditRef",class:"dida-comment-editor"},null,-1)),E("div",Hl,[t(m,null,{default:n(()=>[t(V,{theme:"primary",onClick:c},{default:n(()=>I[4]||(I[4]=[P("提交")])),_:1})]),_:1})])])]}),_:1}),t(q,{span:4},{default:n(()=>[E("div",Bl,[D.value?(z(),Z("div",Jl,[t(V,{onClick:j},{default:n(()=>I[6]||(I[6]=[P("编辑")])),_:1})])):se("",!0),t(N,{layout:"vertical",bordered:!0},{default:n(()=>[t(F,{label:"创建时间"},{default:n(()=>{var B;return[P(M((B=s.value)==null?void 0:B.insertTime),1)]}),_:1}),t(F,{label:"编辑时间"},{default:n(()=>{var B;return[P(M((B=s.value)==null?void 0:B.modifyTime),1)]}),_:1}),t(F,{label:"更新时间"},{default:n(()=>{var B;return[P(M((B=s.value)==null?void 0:B.updateTime),1)]}),_:1}),t(F,{label:"创建用户"},{default:n(()=>[t(V,{variant:"text",onClick:I[2]||(I[2]=async()=>{var B;return await me(Qt)(me(X),(B=s.value)==null?void 0:B.authorUsername)})},{default:n(()=>{var B;return[P(M((B=s.value)==null?void 0:B.authorNickname),1)]}),_:1})]),_:1}),t(F,{label:"标签"},{default:n(()=>[t(m,null,{default:n(()=>{var B;return[(z(!0),Z(te,null,fe((B=s.value)==null?void 0:B.tags,Q=>(z(),K(V,{key:Q.id,variant:"dashed",onClick:()=>T(Q)},{default:n(()=>[P(M(Q.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),ot=ne(Wl,[["__scopeId","data-v-2c25e4fb"]]);function Xl(e,a){return ee({url:"/rank/ac/all?page="+e+"&page_size="+a,method:"get"})}function Yl(e,a){return ee({url:"/rank/ac/problem?page="+e+"&page_size="+a,method:"get"})}function Zl(e,a){return ee({url:"/rank/ac/problem/today?page="+e+"&page_size="+a,method:"get"})}function Ql(e,a){return ee({url:"/rank/ac/problem/day7?page="+e+"&page_size="+a,method:"get"})}function eo(e,a){return ee({url:"/rank/ac/problem/year?page="+e+"&page_size="+a,method:"get"})}const to={style:{margin:"10px"}};function st(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ae(e)}const ao=ae({__name:"RankUser",props:{type:{}},setup(e){const a=_e(),l=Re(),{globalProperties:r}=ce();let o=null;const u=e,_=f(""),L=f(""),S={all:{header:"统计所有用户在本站的提交记录",content:"优先以AC记录数量排序，如果相同则提交所用次数较少的优先，如果仍相同，注册较早的用户靠前"},problem:{header:"统计所有用户在本站的提交记录",content:"以题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-today":{header:"统计所有用户今日在本站的提交记录",content:"以今日题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-day7":{header:"统计所有用户最近7日在本站的提交记录",content:"以7日题目记录数量排序（从7日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-year":{header:"统计所有用户最近1年在本站的提交记录",content:"以最近1年题目记录数量排序（从365日前的0点开始计算），如果相同，注册较早的用户靠前"}},v=f([]),k=[{title:"序号",colKey:"index"},{title:"用户名",colKey:"username",cell:(U,A)=>t(G,{variant:"dashed",onClick:()=>D(A.row.username)},{default:()=>[A.row.username]})},{title:"昵称",colKey:"nickname"},{title:"Slogan",colKey:"slogan"}],s=[{title:"题目数量",colKey:"problem_count",cell:(U,A)=>{let $=0;return A.row.problem_count&&($=A.row.problem_count),t(G,{variant:"dashed",onClick:()=>T(A.row.username)},st($)?$:{default:()=>[$]})}}],d=[{title:"正确",colKey:"accept",cell:(U,A)=>{let $=0;return A.row.accept&&($=A.row.accept),t(G,{variant:"dashed",onClick:()=>T(A.row.username)},st($)?$:{default:()=>[$]})}},{title:"提交",colKey:"attempt",cell:(U,A)=>{let $=0;return A.row.attempt&&($=A.row.attempt),t(G,{variant:"dashed",onClick:()=>j(A.row.username)},st($)?$:{default:()=>[$]})}}],h=f(!1);let y=1,p=50;const i=f({current:y,pageSize:p,defaultCurrent:y,defaultPageSize:p,total:0,pageSizeOptions:[50]}),x=f(),D=U=>{l.push({name:"user",params:{username:U}})},T=U=>{l.push({name:"judge-list",query:{username:U,status:ye.Accept}})},j=U=>{l.push({name:"judge-list",query:{username:U}})},g=async(U,A)=>{h.value=!0;try{x.value=[];const{current:$,pageSize:I}=U;let b=null;switch(u.type){case"problem":b=await Yl($,I);break;case"problem-today":b=await Zl($,I);break;case"problem-day7":b=await Ql($,I);break;case"problem-year":b=await eo($,I);break;default:b=await Xl($,I);break}if(b.code===0){const R=b.data.list;if(!R||R.length<=0){i.value={...i.value,total:0},ue(r,"未找到记录");return}x.value=[];const C=i.value.pageSize*(i.value.current-1);let m=1;R.forEach(w=>{var q;const V=w;V.index=C+m++,(q=x.value)==null||q.push(V)}),i.value={...i.value,total:b.data.total_count}}else A&&O(r,b.code)}catch($){console.error($),O(r,Pe())}finally{h.value=!1}},c=async U=>{await l.push({query:{...a.query,page:U.current,page_size:U.pageSize}})};return oe(async()=>{h.value=!0,o=Le(()=>a.query,U=>{switch(u.type&&S[u.type]?(_.value=S[u.type].header,L.value=S[u.type].content):(_.value=S.all.header,L.value=S.all.content),u.type){case"all":v.value=k.concat(d);break;default:v.value=k.concat(s);break}const A=parseInt(U.page)||i.value.defaultCurrent,$=parseInt(U.page_size)||i.value.defaultPageSize;y=A,p=$,i.value={...i.value,current:y,pageSize:p},g({current:y,pageSize:p},!0)},{immediate:!0})}),Se(()=>{o&&o()}),(U,A)=>{const $=je,I=ie,b=be,R=ge;return z(),K(R,null,{default:n(()=>[t(b,{span:9},{default:n(()=>[t(I,{style:{margin:"10px"}},{default:n(()=>[t($,{data:x.value,columns:v.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:i.value,loading:h.value,"table-layout":"auto",onPageChange:c},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(b,{span:3},{default:n(()=>[E("div",to,[t(I,{class:"sh-card",header:_.value,"header-bordered":!0},{default:n(()=>[P(M(L.value),1)]),_:1},8,["header"])])]),_:1})]),_:1})}}}),Oe=ne(ao,[["__scopeId","data-v-ad6297d7"]]),no=ae({__name:"ManageJudge",setup(e){const{globalProperties:a}=ce(),l=f(!1),r=f(!1),o=f({problemId:"",language:void 0,status:void 0}),u=f(!1),_=f([]);_.value=ht();const L=f([]);L.value=Ht();const S=async()=>{l.value=!0;try{const s=await Kn();if(s.code!==0){O(a,s.code);return}ue(a,"重判成功"),await X.push({name:"judge-list"})}catch(s){console.error(s),O(a,"重判失败")}finally{l.value=!1}},v=async()=>{if(!o.value.problemId&&!o.value.language&&!o.value.status){O(a,"请输入问题Id");return}u.value=!0;try{const s=await Fn(o.value.problemId,o.value.language,o.value.status);if(s.code!==0){O(a,s.code);return}ue(a,"重判成功"),await X.push({name:"judge-list",query:{problem_id:o.value.problemId,language:o.value.language}})}catch(s){console.error(s),O(a,"重判失败")}finally{u.value=!1}},k=async()=>{r.value=!0;try{const s=await Gn();if(s.code!==0){O(a,s.code);return}ue(a,"重判成功"),await X.push({name:"judge-list"})}catch(s){console.error(s),O(a,"重判失败")}finally{r.value=!1}};return(s,d)=>{const h=G,y=ie,p=$e,i=ze,x=vt,D=nt,T=ve,j=Ve;return z(),Z(te,null,[t(y,{class:"yj-manage-card",title:"重判最近提交"},{default:n(()=>[t(h,{onClick:S,loading:l.value},{default:n(()=>d[4]||(d[4]=[P("重判")])),_:1},8,["loading"])]),_:1}),t(y,{class:"yj-manage-card",title:"重判问题"},{default:n(()=>[t(T,null,{default:n(()=>[t(j,{layout:"inline",onSubmit:v},{default:n(()=>[t(i,{label:"题号"},{default:n(()=>[t(p,{modelValue:o.value.problemId,"onUpdate:modelValue":d[0]||(d[0]=g=>o.value.problemId=g),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(i,{label:"语言"},{default:n(()=>[t(D,{modelValue:o.value.language,"onUpdate:modelValue":d[1]||(d[1]=g=>o.value.language=g),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:n(()=>[(z(!0),Z(te,null,fe(_.value,g=>(z(),K(x,{key:g.value,value:g.value,label:g.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"状态"},{default:n(()=>[t(D,{modelValue:o.value.status,"onUpdate:modelValue":d[2]||(d[2]=g=>o.value.status=g),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:n(()=>[(z(!0),Z(te,null,fe(L.value,g=>(z(),K(x,{key:g.value,value:g.value,label:g.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(i,null,{default:n(()=>[t(T,null,{default:n(()=>[t(h,{theme:"primary",type:"submit",loading:u.value},{default:n(()=>d[5]||(d[5]=[P("重判")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(y,{class:"yj-manage-card",title:"重判状态"},{default:n(()=>[t(T,null,{default:n(()=>[t(D,{modelValue:s.rejudgeStatus,"onUpdate:modelValue":d[3]||(d[3]=g=>s.rejudgeStatus=g),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:n(()=>[(z(!0),Z(te,null,fe(L.value,g=>(z(),K(x,{key:g.value,value:g.value,label:g.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),t(h,{onClick:s.handleRejudgeStatus,loading:s.rejudgeStatusLoading},{default:n(()=>d[6]||(d[6]=[P("重判")])),_:1},8,["onClick","loading"])]),_:1})]),_:1}),t(y,{class:"yj-manage-card",title:"重判所有"},{default:n(()=>[t(h,{onClick:k,theme:"danger",loading:r.value},{default:n(()=>d[7]||(d[7]=[P("重判")])),_:1},8,["loading"])]),_:1})],64)}}}),lo=ne(no,[["__scopeId","data-v-935e5ac6"]]),oo={style:{margin:"10px"}},so={key:1},ro={style:{margin:"12px"}},uo={class:"dida-edit-container"},io=ae({__name:"ProblemEdit",setup(e){let a=_e();const{globalProperties:l}=ce(),r=Ee(),o=f(""),u=f(!1);let _=null;const L=f(!1),S=f(null),v=f({title:"",timeLimit:0,memoryLimit:0,source:"",private:!0,tags:[]}),k=f([]),s=f([]),d=De(()=>{const g=[],c=k.value;for(let U=0,A=c.length;U<A;U++)c[U].value&&g.push(c[U].value);return g}),h=(g,c)=>{const{trigger:U,index:A,item:$}=c;if(U==="clear"&&(k.value=[]),["tag-remove","backspace"].includes(U)&&k.value.splice(A,1),U==="enter"){for(let b=0;b<s.value.length;b++){const R=s.value[b];if(R.label===$){for(let C=0;C<k.value.length;C++)if(k.value[C].label===R.label)return;k.value.push(R);return}}const I={label:$,value:$};k.value.push(I),s.value=s.value.concat(I)}},y=(g,{current:c,type:U})=>{if(!c){k.value=U==="check"?s.value.slice(1):[];return}if(U==="check"){const A=s.value.find($=>$.value===c);if(!A)return;k.value.push(A)}else k.value=k.value.filter(A=>A.value!==c)},p=()=>{X.push({name:"problem-detail",params:{problemId:o.value}})},i=()=>{X.push({name:"manage-problem-judge",params:{problemId:o.value}})},x=async()=>{if(_){L.value=!0,v.value.tags=[];for(let g=0;g<k.value.length;g++){const c=k.value[g];c&&c.label&&v.value.tags.push(c.label)}try{const g=await Jn(v.value.title,v.value.timeLimit,v.value.memoryLimit,v.value.source,v.value.private,v.value.tags,_.getValue());if(L.value=!0,g.code!==0){O(l,g.code);return}g.data!=null&&await X.push({name:"problem-detail",params:{problemId:g.data}}),pt(l,"创建成功")}finally{L.value=!1}}},D=async()=>{if(_){L.value=!0,v.value.tags=[];for(let g=0;g<k.value.length;g++){const c=k.value[g];c&&c.label&&v.value.tags.push(c.label)}try{const g=await Wn(o.value,v.value.title,v.value.timeLimit,v.value.memoryLimit,v.value.source,v.value.private,v.value.tags,_.getValue());if(L.value=!0,g.code!==0){O(l,g.code);return}g.data!=null&&(S.value.updateTime=new Date(g.data).toLocaleString()),pt(l,"保存成功")}finally{L.value=!1}}},T=g=>{const c={after:()=>{_==null||_.setValue(g),u.value=!1}};_=new pe("problemEditDiv",c)},j=async()=>{const g=await Jt(o.value,void 0,void 0);if(g.code!==0){O(l,g.code),console.error("problem get failed",g.code),await X.push({name:"problem"});return}const c=g.data.problem;if(S.value=We(c,{}),v.value.title=c.title,v.value.timeLimit=c.time_limit,v.value.memoryLimit=c.memory_limit,v.value.source=c.source,v.value.private=c.private,v.value.tags=[],k.value=[],g.data.tags)for(let A=0;A<g.data.tags.length;A++){const $=g.data.tags[A];$&&$.name&&(v.value.tags.push($.name),k.value.push({label:$.name,value:$.id}))}r.setTitle(c.title+" - "+r.getTitle);let U=c.description;T(U)};return oe(async()=>{Array.isArray(a.params.problemId)?o.value=a.params.problemId[0]:o.value=a.params.problemId,o.value?(u.value=!0,Wt(-1).then(async g=>{g.code===0?(g.data.list&&g.data.list.forEach(c=>{s.value.push({label:c.name,value:c.id})}),await j()):(O(l,g.code),console.error("problem tag get failed",g.code),await X.push({name:"problem"}))}).catch(async g=>{console.error(g),O(l,"获取数据异常"),await X.push({name:"problem"})})):(v.value.timeLimit=1e3,v.value.memoryLimit=65536,T(""))}),(g,c)=>{const U=$e,A=ze,$=La,I=At,b=za,R=Va,C=Ve,m=ie,w=be,V=G,q=ve,F=ft("space"),N=Me,J=qe,le=ge,B=we;return z(),K(B,{loading:u.value},{default:n(()=>[t(le,null,{default:n(()=>[t(w,{span:8},{default:n(()=>[E("div",oo,[t(m,{class:"sh-card"},{default:n(()=>[t(C,{model:v.value},{default:n(()=>[t(A,{label:"标题"},{default:n(()=>[t(U,{modelValue:v.value.title,"onUpdate:modelValue":c[0]||(c[0]=Q=>v.value.title=Q),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),t(A,{label:"时间限制"},{default:n(()=>[t($,{modelValue:v.value.timeLimit,"onUpdate:modelValue":c[1]||(c[1]=Q=>v.value.timeLimit=Q),theme:"normal",min:0},{suffix:n(()=>c[5]||(c[5]=[E("span",null,"ms",-1)])),_:1},8,["modelValue"])]),_:1}),t(A,{label:"内存限制"},{default:n(()=>[t($,{modelValue:v.value.memoryLimit,"onUpdate:modelValue":c[2]||(c[2]=Q=>v.value.memoryLimit=Q),theme:"normal",min:0},{suffix:n(()=>c[6]||(c[6]=[E("span",null,"KB",-1)])),_:1},8,["modelValue"])]),_:1}),t(A,{label:"来源"},{default:n(()=>[t(U,{modelValue:v.value.source,"onUpdate:modelValue":c[3]||(c[3]=Q=>v.value.source=Q),placeholder:"请输入题目来源"},null,8,["modelValue"])]),_:1}),t(A,{label:"私有"},{default:n(()=>[t(I,{modelValue:v.value.private,"onUpdate:modelValue":c[4]||(c[4]=Q=>v.value.private=Q)},null,8,["modelValue"])]),_:1}),t(A,{label:"标签"},{default:n(()=>[t(R,{value:k.value,"allow-input":!0,placeholder:"请选择或输入","tag-input-props":{excessTagsDisplayType:"break-line"},"popup-props":{overlayInnerClassName:["narrow-scrollbar"],overlayInnerStyle:{maxHeight:"280px",overflowY:"auto",overscrollBehavior:"contain",padding:"6px"}},clearable:"",multiple:"",onTagChange:h},{panel:n(()=>[s.value.length?(z(),K(b,{key:0,value:d.value,options:s.value,onChange:y},null,8,["value","options"])):(z(),Z("div",so,"暂无数据"))]),suffixIcon:n(()=>[t(me(ia))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(w,{span:4},{default:n(()=>[E("div",ro,[E("div",uo,[o.value?(z(),K(q,{key:0},{default:n(()=>[t(V,{onClick:D,theme:"danger",loading:L.value},{default:n(()=>c[7]||(c[7]=[P("保存")])),_:1},8,["loading"]),t(V,{onClick:i,theme:"warning"},{default:n(()=>c[8]||(c[8]=[P("判题数据")])),_:1}),t(V,{onClick:p},{default:n(()=>c[9]||(c[9]=[P("查看")])),_:1})]),_:1})):(z(),K(F,{key:1},{default:n(()=>[t(V,{onClick:x,theme:"danger",loading:L.value},{default:n(()=>c[10]||(c[10]=[P("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(z(),K(J,{key:0,layout:"vertical",bordered:!0},{default:n(()=>[t(N,{label:"创建时间"},{default:n(()=>{var Q;return[P(M((Q=S.value)==null?void 0:Q.insertTime),1)]}),_:1}),t(N,{label:"更新时间"},{default:n(()=>{var Q;return[P(M((Q=S.value)==null?void 0:Q.updateTime),1)]}),_:1}),t(N,{label:"判题方式"},{default:n(()=>{var Q;return[P(M((Q=S.value)==null?void 0:Q.judgeType),1)]}),_:1}),t(N,{label:"上传用户"},{default:n(()=>{var Q;return[P(M((Q=S.value)==null?void 0:Q.creatorNickname),1)]}),_:1})]),_:1})):se("",!0)])]),_:1})]),_:1}),c[11]||(c[11]=E("div",{id:"problemEditDiv",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"])}}}),xt=ne(io,[["__scopeId","data-v-f183ce95"]]),co={style:{margin:"10px"}},mo={style:{margin:"12px"}},po={class:"dida-edit-container"},fo=ae({__name:"ProblemJudge",setup(e){let a=_e();const{globalProperties:l}=ce(),r=Ee(),o=f(""),u=f(!1),_=f(null);let L=null;const S=f(null),v=f(""),k=f(!1),s=f(!1),d=f([{title:"文件",colKey:"file"},{title:"大小",colKey:"size",width:150,cell:(I,b)=>b.row.size.toFixed(0)+" B"},{title:"最后修改时间",colKey:"lastModified",width:180,cell:(I,b)=>new Date(b.row.lastModified).toLocaleString()},{title:"操作",colKey:"action",width:100,cell:(I,b)=>t(G,{onClick:()=>D(b.row.file)},{default:()=>[P("下载")]})}]),h=f([]),y=De(()=>({border:"2px dashed #ccc",borderRadius:"6px",padding:"20px",textAlign:"center",cursor:"pointer",backgroundColor:k.value?"#f0f9ff":"#fff",transition:"background-color 0.2s ease"})),p=De(()=>v.value?`已选择：${v.value}`:k.value?"松开文件以上传":"拖拽文件到这里，或点击选择文件"),i=()=>{X.push({name:"problem-detail",params:{problemId:o.value}})},x=()=>{X.push({name:"manage-problem",params:{problemId:o.value}})},D=async I=>{const b=await Xn(o.value,I);if(b.code!==0){O(l,b.code);return}const R=document.createElement("a");R.href=b.data,R.target="_blank",R.click(),URL.revokeObjectURL(R.href)},T=async()=>{if(!L){re(l,"请选择压缩包");return}s.value=!0,Yn(o.value,L).then(async I=>{I.code==0?(S.value.value=null,L=null,v.value="",u.value=!0,pt(l,"上传成功"),await $()):O(l,I.code)}).catch(I=>{console.log(I),l.$message.error({duration:3e3,content:"申请失败"})}).finally(()=>{s.value=!1})},j=()=>{var I;(I=S.value)==null||I.click()},g=I=>{const b=I.target.files[0];b&&(v.value=b.name,L=b)},c=I=>{k.value=!0},U=()=>{k.value=!1},A=I=>{I.preventDefault(),I.stopPropagation(),k.value=!1;const b=I.dataTransfer.files[0];if(b){v.value=b.name;const R=new DataTransfer;R.items.add(b),S.value.files=R.files,L=b}},$=async()=>{const I=await Nn(o.value);if(I.code!==0){O(l,I.code),await X.push({name:"problem"});return}const b=I.data.problem;_.value=We(b,{}),r.setTitle(b.title+" - "+r.getTitle),h.value=[],I.data.judges?I.data.judges.forEach(R=>{h.value.push({file:R.key,size:R.size,lastModified:R.last_modified})}):re(l,"评测数据不存在"),u.value=!1};return oe(async()=>{if(Array.isArray(a.params.problemId)?o.value=a.params.problemId[0]:o.value=a.params.problemId,!o.value){re(l,"题目不存在"),await X.push({name:"problem"});return}u.value=!0,await $()}),(I,b)=>{const R=je,C=be,m=G,w=ve,V=Me,q=qe,F=ge,N=we;return z(),K(N,{loading:u.value},{default:n(()=>[t(F,null,{default:n(()=>[t(C,{span:7},{default:n(()=>[E("div",co,[E("div",{id:"drop-zone",style:Dt(y.value),onClick:j,onDragenter:Ne(c,["prevent"]),onDragover:b[0]||(b[0]=Ne(()=>{},["prevent"])),onDragleave:Ne(U,["prevent"]),onDrop:A},[E("input",{ref_key:"fileInput",ref:S,type:"file",style:{display:"none"},onChange:g},null,544),P(" "+M(p.value),1)],36)]),t(R,{data:h.value,columns:d.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1}),t(C,{span:5},{default:n(()=>[E("div",mo,[E("div",po,[t(w,null,{default:n(()=>[t(m,{onClick:T,theme:"danger",loading:s.value},{default:n(()=>b[1]||(b[1]=[P("上传")])),_:1},8,["loading"]),t(m,{onClick:x,theme:"warning"},{default:n(()=>b[2]||(b[2]=[P("编辑")])),_:1}),t(m,{onClick:i},{default:n(()=>b[3]||(b[3]=[P("查看")])),_:1})]),_:1})]),t(q,{layout:"vertical",bordered:!0},{default:n(()=>[t(V,{label:"标题"},{default:n(()=>{var J;return[P(M((J=_.value)==null?void 0:J.title),1)]}),_:1}),t(V,{label:"创建时间"},{default:n(()=>{var J;return[P(M((J=_.value)==null?void 0:J.insertTime),1)]}),_:1}),t(V,{label:"更新时间"},{default:n(()=>{var J;return[P(M((J=_.value)==null?void 0:J.updateTime),1)]}),_:1}),t(V,{label:"判题方式"},{default:n(()=>{var J;return[P(M((J=_.value)==null?void 0:J.judgeType),1)]}),_:1}),t(V,{label:"评测数据"},{default:n(()=>{var J;return[P(M((J=_.value)==null?void 0:J.judgeMd5),1)]}),_:1}),t(V,{label:"上传用户"},{default:n(()=>{var J;return[P(M((J=_.value)==null?void 0:J.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),_o=ne(fo,[["__scopeId","data-v-3be5c9c9"]]),vo={style:{display:"flex","align-items":"center"}},go={style:{color:"#409eff","margin-right":"20px"}},bo={class:"dida-login-footer"},ho=ae({__name:"UserForget",setup(e){const{globalProperties:a}=ce(),l=ke(),r=f(!1),o=f(!1),u=f(!1),_=f("发送验证码");let L=null,S=-1;const v=f(!1),k=f(null),s=f(""),d=f({username:"",emailKey:"",password:"",confirmPassword:""}),y=f({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:g=>new Promise(c=>{const U=setTimeout(()=>{c(d.value.password===g),clearTimeout(U)})}),message:"两次密码不一致"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),p=()=>{ue(a,"重置成功")},i=async g=>{if(!u.value){r.value=!0,o.value=!0;try{const c=await yn(g,d.value.username);c.code===0?(ue(a,"验证码发送成功"),s.value=c.data,o.value=!1,u.value=!0,L=new Date,_.value="60秒后重发",S=setInterval(()=>{const A=Math.floor((new Date().getTime()-(L==null?void 0:L.getTime()))/1e3);A>60?(_.value="发送验证码",u.value=!1,clearInterval(S)):_.value=`${60-A}秒后重发`},1e3)):O(a,c.code)}catch(c){console.error("Send email key error",c),re(a,"发送验证码失败")}finally{r.value=!1}}},x=async()=>{var A;if(v.value=!0,u.value||o.value)return;await Te();const g=document.getElementById("cf-confirm-div");g&&g.remove();const c=document.createElement("div");c.id="cf-confirm-div",c.setAttribute("data-theme","light"),(A=k.value)==null||A.appendChild(c);const U=window;U.turnstile.ready(function(){U.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function($){v.value=!1,await i($)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},D=f(()=>t(G,{onClick:x,disabled:u.value,loading:o.value,style:"width:120px"},{default:()=>[_.value]})),T=async()=>{r.value=!0;try{const g=await wn(d.value.username,d.value.password,d.value.emailKey);g.code===0?(ue(a,"密码修改成功"),a.$router.push({name:"login"})):O(a,g.code)}catch(g){console.error("Modify password error",g),re(a,"修改密码失败")}finally{r.value=!1}},j=async({validateResult:g,firstError:c,e:U})=>{if(!r.value){if(U.preventDefault(),g!==!0){re(a,c);return}s.value?await T():await x()}};return oe(()=>{if(l.isLogin()){a.$router.push({path:"/user"});return}}),Se(()=>{}),(g,c)=>{const U=_t,A=$e,$=ze,I=Ut,b=G,R=Ve,C=Ge,m=ie,w=Be;return z(),Z(te,null,[t(m,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:n(()=>[t(U,{"max-line":1},{default:n(()=>c[6]||(c[6]=[E("span",null,"如果您未绑定邮箱或忘记用户名，可联系管理员寻求帮助",-1),E("span",null,"管理员邮箱：BoilTask@qq.com",-1)])),_:1}),t(R,{ref:"form",rules:y.value,data:d.value,colon:!0,onReset:p,onSubmit:j,class:"yj-login-form"},{default:n(()=>[t($,{name:"username",label:"用户名"},{default:n(()=>[t(A,{modelValue:d.value.username,"onUpdate:modelValue":c[0]||(c[0]=V=>d.value.username=V),clearable:"",placeholder:"请输入完整用户名"},null,8,["modelValue"])]),_:1}),s.value?(z(),Z(te,{key:0},[t($,{name:"email",label:"发送邮箱"},{default:n(()=>[t(I,{append:D.value},{default:n(()=>[E("div",vo,[E("span",go,M(s.value),1)])]),_:1},8,["append"])]),_:1}),t($,{name:"emailKey",label:"验证码"},{default:n(()=>[t(A,{modelValue:d.value.emailKey,"onUpdate:modelValue":c[1]||(c[1]=V=>d.value.emailKey=V),clearable:"",placeholder:"请输入收到的验证码"},null,8,["modelValue"])]),_:1}),t($,{name:"password",label:"新密码"},{default:n(()=>[t(A,{modelValue:d.value.password,"onUpdate:modelValue":c[2]||(c[2]=V=>d.value.password=V),type:"password",clearable:"",placeholder:"新密码"},null,8,["modelValue"])]),_:1}),t($,{name:"confirmPassword",label:"确认密码"},{default:n(()=>[t(A,{modelValue:d.value.confirmPassword,"onUpdate:modelValue":c[3]||(c[3]=V=>d.value.confirmPassword=V),type:"password",clearable:"",placeholder:"请重复输入密码"},null,8,["modelValue"])]),_:1})],64)):se("",!0),s.value?(z(),K($,{key:1},{default:n(()=>[t(b,{theme:"primary",type:"submit",block:"",loading:r.value},{default:n(()=>c[7]||(c[7]=[P("修改密码")])),_:1},8,["loading"])]),_:1})):(z(),K($,{key:2},{default:n(()=>[t(b,{theme:"primary",type:"submit",block:"",loading:r.value},{default:n(()=>c[8]||(c[8]=[P("重置密码")])),_:1},8,["loading"])]),_:1}))]),_:1},8,["rules","data"]),E("div",bo,[t(C,{onClick:c[4]||(c[4]=()=>{me(a).$router.push({name:"login"})})},{default:n(()=>c[9]||(c[9]=[P("返回登陆 ")])),_:1})])]),_:1}),t(w,{visible:v.value,"onUpdate:visible":c[5]||(c[5]=V=>v.value=V),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:n(()=>[E("div",{ref_key:"dialogContainer",ref:k,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),yo=ne(ho,[["__scopeId","data-v-d3cb1db8"]]),ea=[{name:"problem-list",tab:"problem",sidebar:"problem-list",path:"",title:"问题列表",icon:"list",component:al},{name:"problem-detail",tab:"problem",sidebar:"problem-list",path:":problemId+",title:"问题详情",icon:"list",component:St},{name:"problem-recommend",tab:"problem",sidebar:"problem-recommend",path:"recommend/:problemId*",title:"问题推荐",icon:"cpu",needLogin:!0,component:gl},{name:"judge-list",tab:"judge",sidebar:"judge-list",path:"",title:"评测列表",icon:"list",component:It},{name:"judge-detail",tab:"judge",sidebar:"judge-list",path:":judgeId+",title:"评测详情",icon:"cpu",component:Tt},{name:"contest-list",tab:"contest",sidebar:"contest-list",path:"",title:"比赛列表",icon:"list",component:jt},{name:"contest-recent",tab:"contest",sidebar:"contest-recent",path:"recent",title:"近期比赛",icon:"list",component:jt},{name:"contest-detail",tab:"contest-detail-tab",sidebar:"contest-detail",path:":contestId+",title:"比赛详情",icon:"cpu",component:Ll},{name:"contest-problem-detail",tab:"contest-detail-tab",sidebar:"contest-problem-detail",path:":contestId+/problem/:problemIndex+",title:"问题详情",icon:"cpu",disableSidebar:!0,component:St},{name:"contest-judge",tab:"contest-detail-tab",sidebar:"contest-judge",path:":contestId+/judge",title:"评测列表",icon:"list",component:It},{name:"contest-judge-detail",tab:"contest-detail-tab",sidebar:"contest-judge-detail",path:":contestId+/judge/:judgeId+",title:"评测详情",icon:"cpu",component:Tt,disableSidebar:!0},{name:"contest-rank",tab:"contest-detail-tab",sidebar:"contest-rank",path:":contestId+/rank",title:"比赛排名",icon:"list",component:zl},{name:"contest-discuss",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss",title:"比赛讨论",icon:"list",component:Ze},{name:"contest-discuss-detail",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss/:discussId+",title:"讨论详情",icon:"list",component:ot},{name:"discuss-list",tab:"discuss",sidebar:"discuss-list",path:"",title:"讨论列表",icon:"list",component:Ze},{name:"discuss-list-problem",tab:"discuss",sidebar:"discuss-list-problem",path:"problem",title:"问题讨论",icon:"list",component:Ze},{name:"discuss-list-judge",tab:"discuss",sidebar:"discuss-list-judge",path:"judge",title:"评测讨论",icon:"list",component:Ze},{name:"discuss-detail",tab:"discuss",sidebar:"discuss-list",path:":discussId+",title:"讨论详情",icon:"list",component:ot},{name:"rank-ac-all",tab:"rank",sidebar:"rank-ac-all",path:"ac",title:"AC排名",icon:"base-station",props:{type:"all"},component:Oe},{name:"rank-ac-problem",tab:"rank",sidebar:"rank-ac-problem",path:"ac/problem",title:"题量排名",icon:"base-station",props:{type:"problem"},component:Oe},{name:"rank-ac-problem-today",tab:"rank",sidebar:"rank-ac-problem-today",path:"ac/problem/today",title:"今日题量",icon:"base-station",props:{type:"problem-today"},component:Oe},{name:"rank-ac-problem-day7",tab:"rank",sidebar:"rank-ac-problem-day7",path:"ac/problem/day7",title:"7日题量",icon:"base-station",props:{type:"problem-day7"},component:Oe},{name:"rank-ac-problem-year",tab:"rank",sidebar:"rank-ac-problem-year",path:"ac/problem/year",title:"1年题量",icon:"base-station",props:{type:"problem-year"},component:Oe},{name:"tool-paste",tab:"tool",sidebar:"tool-paste",path:"paste",title:"码池",icon:"base-station",component:dt},{name:"system-status",tab:"system",sidebar:"system-status",path:"",title:"运行状态",icon:"base-station",component:dt},{name:"system-about",tab:"system",sidebar:"system-about",path:"about",title:"关于",icon:"base-station",props:{discussId:"52"},component:ot},{name:"manage-problem-create",tab:"manage",sidebar:"manage-problem-create",disableSidebar:!0,path:"problem",title:"新建问题",icon:"list",component:xt,auths:[xe.ManageProblem]},{name:"manage-problem",tab:"manage",sidebar:"manage-problem",disableSidebar:!0,path:"problem/:problemId+",title:"问题编辑",icon:"list",component:xt,auths:[xe.ManageProblem]},{name:"manage-problem-judge",tab:"manage",sidebar:"manage-problem-judge",disableSidebar:!0,path:"problem/:problemId+/judge",title:"评测数据",icon:"list",component:_o,auths:[xe.ManageProblem]},{name:"manage-judge",tab:"manage",path:"judge",sidebar:"manage-judge",title:"评测管理",icon:"list",auths:["i-manage-judge"],component:lo},{name:"login-forget",tab:"login",path:"forget",title:"忘记密码",component:yo}],Lt=(e,a,l,r)=>{r.tab==l&&(r.disableSidebar&&a!=r.sidebar||r.sidebar==null||r.sidebar!=r.name||e.push({name:r.name,title:r.title,icon:r.icon,to:{name:r.name}}))},wo=(e,a)=>{const l=[];return ea.forEach(r=>{if(Gt(r)){const o=[];r.children.forEach(u=>{Lt(o,e,a,u)}),o.length>0&&l.push({title:r.title,children:o})}else Lt(l,e,a,r)}),l},Vt=(e,a)=>{const l=Vn(a.tab),r={name:a.name,path:"/"+a.path,meta:{title:a.title+" - "+l.title,tab:a.tab,sidebar:a.sidebar,showSidebar:l.showSidebar,needLogin:l.needLogin||a.needLogin,tabAuths:l.auths,auths:a.auths},props:a.props,component:a.component};l.disablePath||(r.path=l.path+r.path),e.push(r)},ko=e=>{ea.forEach(a=>{Gt(a)?a.children.forEach(l=>{Vt(e,l)}):Vt(e,a)})},So={class:"sh-main"},Co=ae({__name:"View403",setup(e){let a=_e();const l=f("");return oe(()=>{a.query.target?l.value=a.query.target:l.value=a.fullPath}),(r,o)=>{const u=G;return z(),Z("div",So,[E("p",null,M(l.value),1),o[2]||(o[2]=E("p",null,"该页面无访问权限，请更换访问目标或重新登陆后再试",-1)),t(u,{theme:"primary",onClick:o[0]||(o[0]=()=>r.$router.push("/"))},{default:n(()=>o[1]||(o[1]=[P("返回首页")])),_:1})])}}}),ta=ne(Co,[["__scopeId","data-v-777362b3"]]),Xe=[];$n(Xe);ko(Xe);Xe.push({path:"/403",name:"403",component:ta});Xe.push({path:"/:pathMatch(.*)*",name:"404",component:Ft});const X=ca({history:da("/"),routes:Xe});X.beforeEach((e,a,l)=>{if(e.name==null||!X.hasRoute(e.name)){l({name:"home"});return}const r=e.matched[e.matched.length-1].meta;if(r.redirect){l({name:r.redirect});return}if(r.needLogin){const u=ke();if(u.getToken==null||u.getToken==""){l({name:"login",query:{redirect_uri:e.fullPath}});return}}const o=r.tabAuths;if(o&&!ke().hasAllAuths(o)){l({name:"403",query:{target:e.fullPath}});return}l()});X.afterEach((e,a)=>{if(e.name===a.name)return;const l=lt(),r=Ee();let o=null;if(e.matched.length>0&&(o=e.matched[e.matched.length-1].meta),o!=null&&o.title&&r.setTitle(o==null?void 0:o.title),o!=null&&o.showSidebar){l.setSidebarShow(!0);const u=wo(o==null?void 0:o.sidebar,o==null?void 0:o.tab);l.setMenuList(u),l.setMenuActiveName(o==null?void 0:o.sidebar)}else l.setSidebarShow(!1)});const aa=at("login",{state:()=>({Loaded:!1}),getters:{isLoaded(){return this.Loaded}}}),Io=ae({__name:"HeaderContent",setup(e){const a=aa(),l=ke(),{globalProperties:r}=ce(),o=f(a.isLoaded),u=f(!1),_=f(l.getUsername),L=f(l.getNickname),S=f(),v=()=>{S.value=zn(l)};a.$subscribe((d,h)=>{o.value=h.Loaded}),l.$subscribe((d,h)=>{_.value=h.username,L.value=h.nickname,u.value=h.token!="",v()});const k=()=>{r.$router.currentRoute.value.name!=="login"&&r.$router.push({name:"login",query:{redirect_uri:r.$router.currentRoute.value.fullPath}})},s=()=>{l.clear(),r.$message.success({duration:3e3,content:"注销成功"}),r.$router.push({path:"/login",query:{redirect_uri:r.$router.currentRoute.value.fullPath}})};return oe(()=>{v()}),(d,h)=>{const y=ft("router-link"),p=Mt,i=qt,x=$a,D=Da;return z(),K(D,{modelValue:d.$route.meta.tab,"onUpdate:modelValue":h[0]||(h[0]=T=>d.$route.meta.tab=T),class:"sh-menu","expand-type":"popup"},{logo:n(()=>[t(y,{to:"/",class:"sh-logo"},{default:n(()=>h[1]||(h[1]=[P("DidaOJ")])),_:1})]),operations:n(()=>[o.value&&u.value?(z(),K(x,{key:0,title:L.value},{icon:n(()=>[t(p,{name:"user"})]),default:n(()=>[t(i,{value:"user",to:{path:"/user/"+_.value}},{default:n(()=>h[2]||(h[2]=[P("个人空间")])),_:1},8,["to"]),t(i,{value:"user_logout",onClick:s},{default:n(()=>h[3]||(h[3]=[P(" 注销")])),_:1})]),_:1},8,["title"])):o.value?(z(),K(i,{key:2,value:"login",onClick:k},{icon:n(()=>[t(p,{name:"login"})]),default:n(()=>[h[5]||(h[5]=P(" 登录 "))]),_:1})):(z(),K(i,{key:1,value:"login"},{icon:n(()=>[t(p,{name:"login"})]),default:n(()=>[h[4]||(h[4]=P(" ... "))]),_:1}))]),default:n(()=>[(z(!0),Z(te,null,fe(S.value,T=>(z(),K(i,{key:T.name,value:T.name,to:{name:T.name}},{icon:n(()=>[T.icon?(z(),K(p,{key:0,name:T.icon},null,8,["name"])):se("",!0)]),default:n(()=>[P(" "+M(T.title),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])}}}),Po=ne(Io,[["__scopeId","data-v-c64d812f"]]),To={id:"menu-container"},jo=ae({__name:"SidebarContent",setup(e){const a=lt(),l=f(!1),r=f(null),o=f(a.menuActiveName),u=f(a.menuList),_=f([]),L=f(!1),S=()=>{o.value=a.menuActiveName;const k=JSON.stringify(u.value),s=JSON.stringify(a.menuList);k!==s&&(_.value.push([...a.menuList]),v())},v=async()=>{if(_.value.length>0&&!L.value){for(L.value=!0;_.value.length>1;)_.value.shift();const k=_.value.shift();l.value=k.length<=0,u.value=[],await Te(),r.value&&r.value.updateActiveName(),await new Promise(d=>setTimeout(d,300)),u.value=k,await Te(),r.value&&r.value.updateActiveName();const s=300;await new Promise(d=>setTimeout(d,s)),L.value=!1,await v()}};return a.$subscribe((k,s)=>{S()}),oe(()=>{S()}),(k,s)=>{const d=Mt,h=qt,y=Aa,p=Ua,i=we;return z(),Z(te,null,[E("div",To,[t(p,{modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=x=>o.value=x),theme:"light",class:"sh-menu-container"},{default:n(()=>[t(ma,{name:"move-left"},{default:n(()=>[(z(!0),Z(te,null,fe(u.value,(x,D)=>(z(),Z(te,{key:D},[me(Dn)(x)?(z(),K(y,{key:0,title:x.title},{default:n(()=>[(z(!0),Z(te,null,fe(x.children,(T,j)=>(z(),K(h,{key:T.name,value:T.name,to:T.to},it({default:n(()=>[P(" "+M(T.title),1)]),_:2},[T.icon?{name:"icon",fn:n(()=>[t(d,{name:T.icon,class:ct(T.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))),128))]),_:2},1032,["title"])):(z(),K(h,{key:x.name,value:x.name,to:x.to},it({default:n(()=>[P(" "+M(x.title),1)]),_:2},[x.icon?{name:"icon",fn:n(()=>[t(d,{name:x.icon,class:ct(x.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),t(i,{size:"small",loading:l.value,"show-overlay":!0,attach:"#menu-container",class:"sh-sidebar-loading",style:{"align-items":"flex-start","padding-top":"100px"}},null,8,["loading"])],64)}}}),xo=ne(jo,[["__scopeId","data-v-96e2d89f"]]),Lo={};function Vo(e,a){return null}const zo=ne(Lo,[["render",Vo]]),$o={class:"footer"},Do={class:"footer-left"},Uo={class:"foot-time"},Ao={class:"footer-center"},Ro={href:"https://beiancx.miit.gov.cn/",target:"_blank"},Eo={class:"footer-right"},qo={class:"foot-text"},Mo={href:"https://github.com/hpu-developer/DiDaOJ-web",target:"_blank"},Ko={class:"foot-text"},Fo={href:"https://github.com/hpu-developer/DiDaOJ-go",target:"_blank"},Go=ae({__name:"FooterContent",setup(e){const a=f("");function l(){a.value=new Date().toLocaleString()}return oe(()=>{l(),setInterval(()=>{l()},1e3)}),(r,o)=>{const u=G;return z(),Z("div",$o,[E("div",Do,[E("p",Uo,M(a.value),1)]),E("div",Ao,[E("a",Ro,[t(u,{theme:"default",variant:"outline",ghost:!0},{default:n(()=>o[0]||(o[0]=[P("豫ICP备15024677号-4")])),_:1})])]),E("div",Eo,[E("p",qo,[E("a",Mo,[t(u,{theme:"default",variant:"outline",ghost:!0},{default:n(()=>o[1]||(o[1]=[P("@didaoj-web")])),_:1})])]),E("p",Ko,[E("a",Fo,[t(u,{theme:"default",variant:"outline",ghost:!0},{default:n(()=>o[2]||(o[2]=[P("@didaoj-go")])),_:1})])])])])}}}),Oo=ne(Go,[["__scopeId","data-v-979fed79"]]),Qe=20,rt=100,ut=50,No=ae({__name:"ForceHiddenSidebarButton",setup(e){let a=lt();const l=f({x:window.innerWidth-rt-Qe,y:window.innerHeight-ut-Qe}),r=f(window.innerWidth),o=f(window.innerHeight);let u=!1,_={x:0,y:0};const L=x=>{u=!0;const D=x.clientX??x.touches[0].clientX,T=x.clientY??x.touches[0].clientY;_={x:D-l.value.x,y:T-l.value.y},document.addEventListener("mousemove",S),document.addEventListener("touchmove",S),document.addEventListener("mouseup",v),document.addEventListener("touchend",v)},S=x=>{if(!u)return;const D=x.clientX??x.touches[0].clientX,T=x.clientY??x.touches[0].clientY;let j=D-_.x,g=T-_.y;j=Math.max(0,Math.min(j,r.value-rt)),g=Math.max(0,Math.min(g,o.value-ut)),l.value={x:j,y:g}},v=()=>{u=!1,document.removeEventListener("mousemove",S),document.removeEventListener("touchmove",S),document.removeEventListener("mouseup",v),document.removeEventListener("touchend",v)},k=()=>{r.value=window.innerWidth,o.value=window.innerHeight,l.value={x:Math.min(l.value.x,r.value-rt-Qe),y:Math.min(l.value.y,o.value-ut-Qe)}};let s=f(a.forceHiddenSidebar),d=f(a.forceHiddenSidebar);const h=()=>{s.value=!s.value,a.setForceHiddenSidebar(s.value)},y=()=>{d.value||(d.value=!0,a.setForceHiddenSidebar(s.value))},p=()=>{d.value&&(d.value=!1,a.setForceHiddenSidebar(!1))},i=x=>{x>=800?p():y()};return i(r.value),Le(r,x=>{i(x)}),oe(()=>{window.addEventListener("resize",k)}),Se(()=>{window.removeEventListener("resize",k)}),(x,D)=>{const T=G;return me(d)?(z(),K(T,{key:0,class:"draggable-button",style:Dt({top:`${l.value.y}px`,left:`${l.value.x}px`}),onMousedown:L,onTouchstart:L,variant:"dashed",theme:"primary",onClick:h},{default:n(()=>[P(M(me(s)?"显示":"隐藏"),1)]),_:1},8,["style"])):se("",!0)}}}),Ho=ne(No,[["__scopeId","data-v-1aee5506"]]),et="DidaOJ",Bo=ae({__name:"App",setup(e){const{globalProperties:a}=ce(),l=aa(),r=ke(),o=Ee(),u=lt();l.$patch({Loaded:!1});const _=r.getToken,L=f(!1),S=f(!1);o.title&&o.title.length>0?document.title=o.title+" - "+et:document.title=et,o.$subscribe((d,h)=>{h.title&&h.title.length>0?document.title=h.title+" - "+et:document.title=et}),u.$subscribe((d,h)=>{L.value=h.showSidebar,S.value=L.value&&!h.forceHiddenSidebar});const v=_e(),k=De(()=>{const d=v.meta.auths;return d?!r.hasAllAuths(d):!1});function s(){a.$message.warning({duration:3e3,content:"登陆状态失效"}),l.$patch({Loaded:!0}),r.clear()}return oe(()=>{if(_==""){l.$patch({Loaded:!0});return}vn().then(d=>{d.code==0?(r.loadResponse(d.data),l.$patch({Loaded:!0})):(O(a,d.code),l.$patch({Loaded:!0}),r.clear())}).catch(d=>{console.log(d),s()})}),(d,h)=>{const y=Ra,p=qa,i=ft("RouterView"),x=Ma,D=Ea,T=Ka;return z(),Z(te,null,[t(D,null,{default:n(()=>[t(y,{class:"sh-header"},{default:n(()=>[t(Po)]),_:1}),t(D,null,{default:n(()=>[t(pa,{name:"slide"},{default:n(()=>[S.value?(z(),K(p,{key:0,class:"sh-sidebar"},{default:n(()=>[t(xo)]),_:1})):se("",!0)]),_:1}),t(D,{class:ct(["sh-main-layout",{expanded:!S.value}])},{default:n(()=>[t(zo),t(x,{class:"sh-main-content"},{default:n(()=>[k.value?(z(),K(ta,{key:0})):(z(),K(i,{key:1}))]),_:1}),t(Oo)]),_:1},8,["class"])]),_:1})]),_:1}),L.value?(z(),K(Ho,{key:0})):se("",!0),t(T,{container:"body",offset:["24px","80px"],size:"small"})],64)}}}),Jo=ne(Bo,[["__scopeId","data-v-9e122cb4"]]);Ga.registerLanguage("verilog",Oa);const na=fa();na.use(_a);const Ye=va(Jo);Ye.use(na);Ye.use(X);Ye.use(Fa);Ye.use(ga);Ye.mount("#app");cn().then(()=>{console.log("Text cache reinitialized")}).catch(e=>{console.error("Text cache reinitialization failed",e)});
