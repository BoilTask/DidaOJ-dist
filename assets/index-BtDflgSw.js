import{ct as mt,d as ie,a as i,o as me,cu as E,cv as j,cw as a,e as t,cx as z,cy as q,bE as V,cz as pa,aM as Na,cA as Fe,cB as ae,cC as te,F as ue,cD as Se,cE as Ga,cF as ke,bS as de,cG as Ha,cH as Ba,cI as Ja,b as Te,v as dt,cJ as Wa,cK as Be,j as Ge,w as je,a9 as Qe,bc as Ya,bd as Xa,cL as Za,cM as Qa,cN as el,br as tl,cO as yt,cP as fa,cQ as va,cj as al,cR as ll,cS as nl,cT as ol,cU as sl,bX as rl,cV as Xt,cW as Rt,cX as ul,bf as il,cY as cl,cZ as dl,aY as ml}from"./node_modules-DYwOVWGc.js";import{L as Ve,C as be,R as Ie,a as Pe,A as It,S as pl,b as fl,c as vl,d as _l,e as gl,f as nt,T as tt,B,F as Le,g as Ue,I as $e,D as lt,h as _a,i as we,j as Je,k as We,l as bl,m as ze,n as pt,o as ft,P as qt,O as Kt,p as Ft,q as hl,r as ga,s as yl,t as wl,u as ba,v as ha,w as Pt,x as kl,y as Cl,z as Sl,E as Il,G as Pl,H as xl,M as ya,J as wa,K as Vl,N as Tl,Q as Dl,U as jl,V as Ll,W as Ul,X as $l,Y as zl,Z as Al,_ as Rl}from"./tdesign-vue-next-DUfsj3pq.js";import{u as pe,S as _e,a as he,b as N,G as qe,H as xt,c as He,d as ka,e as Ml,M as Mt,E as Ca,R as El}from"./md-editor-v3-dg9E5yp7.js";import{e as Zt}from"./monaco-editor-ouHSYV7a.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))u(s);new MutationObserver(s=>{for(const w of s)if(w.type==="childList")for(const g of w.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&u(g)}).observe(document,{childList:!0,subtree:!0});function n(s){const w={};return s.integrity&&(w.integrity=s.integrity),s.referrerPolicy&&(w.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?w.credentials="include":s.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function u(s){if(s.ep)return;s.ep=!0;const w=n(s);fetch(s.href,w)}})();var De=(e=>(e.ManageWeb="i-manage-web",e.ManageJudge="i-manage-judge",e.ManageProblem="i-manage-problem",e.ManageProblemDaily="i-manage-problem-daily",e.ManageContest="i-manage-contest",e.ManageCollection="i-manage-collection",e))(De||{});const ql={"r-admin":["i-manage-web","i-manage-judge","i-manage-problem","i-manage-problem-daily","i-manage-contest","i-manage-collection"]};function Kl(e){if(e==null)return[];const l=[];for(const n of e){const u=ql[n];u!=null&&l.push(...u)}return[...new Set(l)]}function Fl(e,l){if(e==null||l==null)return!1;const n=Kl(e);for(const u of l)if(!n.includes(u))return!1;return!0}const Me=mt("user",{state:()=>({token:"",userId:-1,username:"",nickname:"",roles:[]}),getters:{getToken(){return this.token},getUserId(){return this.userId},getUsername(){return this.username},getNickname(){return this.nickname}},actions:{clear(){this.$patch({token:"",userId:-1,username:"",nickname:"",roles:[]})},loadResponse(e){this.$patch({token:e.token,userId:e.user_id,username:e.username,nickname:e.nickname,roles:e.roles})},isLogin(){return this.token!=null&&this.token!=""},hasAuth(e){return this.hasAllAuths([e])},hasAllAuths(e){return e?Fl(this.roles,e):!0}},persist:!0}),Ye=mt("webStyle",{state:()=>({title:""}),getters:{getTitle(){return this.title}},actions:{setTitle(e){this.title=e}}}),Vt=mt("sidebarStyle",{state:()=>({showSidebar:!1,forceHiddenSidebar:!1,menuActiveName:"",menuList:[]}),getters:{getMenuList(){return this.menuList}},actions:{setSidebarShow(e){this.showSidebar=e},setForceHiddenSidebar(e){this.forceHiddenSidebar=e},setMenuActiveName(e){this.menuActiveName=e},clearMenuList(){this.menuList=[]},setMenuList(e){this.menuList=e},addMenuList(e){this.menuList.push(e)}}}),Ol={style:{"text-align":"right"}},Nl=ie({__name:"Hitokoto",setup(e){const l=i(!1),n=i(""),u=i(""),s=i(""),w=async()=>{l.value=!0;try{const P=await(await fetch("https://v1.hitokoto.cn")).json();u.value=P.hitokoto,s.value=P.creator,n.value="—— "+P.from}catch(g){u.value="一言获取失败了，但至少您还可以访问本站。",s.value="BoilTask",n.value="DidaOJ",console.error("Error fetching Hitokoto:",g)}finally{l.value=!1}};return me(()=>{w()}),(g,P)=>{const f=be,o=Ve;return j(),E(o,{loading:l.value},{default:a(()=>[t(f,{title:"一言 © Hitokoto"},{actions:a(()=>[V(" @"+q(s.value),1)]),default:a(()=>[z("div",null,[z("span",null,q(u.value),1),z("p",Ol,q(n.value),1)])]),_:1})]),_:1},8,["loading"])}}}),Gl="https://oj-api.didapipa.com/",W=pa.create({baseURL:Gl,timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});W.interceptors.request.use(e=>{const n=Me().getToken;return n&&(e.headers["X-Token"]=n),e},e=>Promise.reject(e));W.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});const Tt=pa.create({timeout:6e4,withCredentials:!1,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});Tt.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function Sa(){return Tt({baseURL:"https://r2-oj.didapipa.com",url:"/system/notification.json?"+Date.now(),method:"get"})}function Ia(){return Tt({baseURL:"https://r2-oj.didapipa.com",url:"/system/announcement.json?"+Date.now(),method:"get"})}function Hl(){return W({url:"/system/status",method:"get"})}function Bl(){return W({url:"/system/image/token",method:"get"})}function Jl(e,l){return W({url:"/system/notification",method:"post",data:{theme:e,content:l}})}function Wl(e,l){return W({url:"/system/announcement",method:"post",data:{title:e,content:l}})}var Dt=(e=>(e[e.Unknown=-1]="Unknown",e[e.C=0]="C",e[e.Cpp=1]="Cpp",e[e.Java=2]="Java",e[e.Python=3]="Python",e[e.Pascal=4]="Pascal",e[e.Golang=5]="Golang",e[e.Lua=6]="Lua",e[e.TypeScript=7]="TypeScript",e[e.Max=8]="Max",e))(Dt||{});function Ot(){const e=[-1,8];return Object.values(Dt).filter(l=>typeof l=="number"&&!e.includes(l)).map(l=>({value:l,label:Ct(l)}))}function wt(e){return e>-1&&e<8}function Ct(e){switch(e){case 0:return"C";case 1:return"C++";case 2:return"Java";case 3:return"Python";case 4:return"Pascal";case 5:return"Golang";case 6:return"Lua";case 7:return"TypeScript";default:return"未知"}}function Nt(e){switch(e){case 0:return"c";case 1:return"cpp";case 2:return"java";case 3:return"python";case 4:return"pascal";case 5:return"go";case 6:return"lua";case 7:return"typescript";default:return"text"}}var Ke=(e=>(e[e.Init=0]="Init",e[e.Rejudge=1]="Rejudge",e[e.Submitting=2]="Submitting",e[e.Queuing=3]="Queuing",e[e.Compiling=4]="Compiling",e[e.Running=5]="Running",e[e.Accept=6]="Accept",e[e.PE=7]="PE",e[e.WA=8]="WA",e[e.TLE=9]="TLE",e[e.MLE=10]="MLE",e[e.OLE=11]="OLE",e[e.RE=12]="RE",e[e.CE=13]="CE",e[e.CLE=14]="CLE",e[e.JudgeFail=15]="JudgeFail",e[e.SubmitFail=16]="SubmitFail",e[e.Unknown=17]="Unknown",e[e.Max=18]="Max",e))(Ke||{});const Yl=e=>{switch(e){case 0:return"普通评测";case 1:return"特殊评测";default:return"未知"}},St=e=>{switch(e){case 0:return"等待处理";case 1:return"重新评测";case 2:return"提交中";case 3:return"队列中";case 4:return"编译中";case 5:return"运行中";case 6:return"通过";case 7:return"格式错误";case 8:return"答案错误";case 9:return"超时";case 10:return"内存超限";case 11:return"输出超限";case 12:return"运行错误";case 13:return"编译错误";case 14:return"编译超限";case 15:return"评测失败";case 16:return"提交失败";case 17:return"未知";default:return e}},Pa=e=>{switch(e){case 0:case 1:case 2:case 3:case 4:case 5:case 17:return"default";case 6:return"success";case 7:return"warning";default:return"danger"}};function xa(){const e=[17,18];return Object.values(Ke).filter(l=>typeof l=="number"&&!e.includes(l)).map(l=>({value:l,label:St(l)}))}function kt(e){return e>=0&&e<17}function ut(e){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return!0;default:return!1}}function Va(e){var n;const l={};if(l.id=e.id,l.problemId=e.problem_id,l.contestProblemIndex=e.contest_problem_index,l.status=e.status,ut(e.status)||!kt(e.status)?l.score="-":l.score=e.score.toString(),e.time?l.time=Math.ceil(e.time/1e6)+"ms":l.time="-",e.memory?l.memory=(e.memory/1024/1024).toFixed(2)+"MB":l.memory="-",l.language=e.language,l.codeLength=e.code_length,e.approve_time?l.approveTime=new Date(e.approve_time).toLocaleString():l.approveTime="-",l.author=e.author,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.code=e.code,l.compileMessage=e.compile_message,l.taskCurrent=e.task_current,l.taskTotal=e.task_total,l.task=[],e.task)for(let u=0;u<((n=e.task)==null?void 0:n.length);u++){const s=e.task[u],w={};w.taskId=s.task_id,w.status=s.status,s.time?w.time=Math.ceil(s.time/1e6)+"ms":w.time="-",s.memory?w.memory=(s.memory/1024/1024).toFixed(2)+"MB":w.memory="-",w.score=s.score,w.content=s.content,w.waHint=s.wa_hint,!w.content&&!w.waHint&&(w.content="无提示信息"),l.task.push(w)}return e.judger&&(l.judger=e.judger),e.judger_name?l.judgerName=e.judger_name:l.judgerName="-",e.judge_time&&(l.judgeTime=new Date(e.judge_time).toLocaleString()),l}function Xl(e,l,n,u,s){return W({url:"/judge/approve",method:"post",data:{problem_id:e,contest_id:l,problem_index:n,language:u,code:s}})}function Zl(e){return W({url:"/judge?id="+e,method:"get"})}function Ql(e){return W({url:"/judge/code?id="+e,method:"get"})}function en(e,l,n,u,s,w,g){let P={problem_id:l,username:n,language:String(u),status:String(s),page:String(w),page_size:String(g)};return e&&(P.contest_id=String(e)),W({url:`/judge/list?${new URLSearchParams(P).toString()}`,method:"get"})}function tn(){return W({url:"/judge/statics/recently",method:"get"})}function an(){return W({url:"/judge/rejudge/recently",method:"post"})}function ln(e,l,n){const u={};return e!=null&&(u.problem_id=e),l!=null?u.language=l:u.language=Dt.Unknown,n!=null?u.status=n:u.status=18,W({url:"/judge/rejudge/search",method:"post",data:u})}function nn(){return W({url:"/judge/rejudge/all",method:"post",timeout:0})}function on(e){return W({url:"/judge/rejudge",method:"post",data:{id:Number(e)}})}var Oe=(e=>(e[e.None=0]="None",e[e.Attempt=1]="Attempt",e[e.Accept=2]="Accept",e))(Oe||{});function vt(e,l){const n={};if(n.id=e.id,n.author=e.author,n.title=e.title,n.tags=[],e.tags)for(const u of e.tags){const s=l[u];s&&n.tags.push(s)}if(n.private=e.private,n.accept=e.accept,n.attempt=e.attempt,e.description!=null&&(n.description=e.description),e.time_limit!=null&&e.time_limit>=0?n.timeLimit=e.time_limit.toString()+" ms":n.timeLimit="未知",e.memory_limit!=null&&e.memory_limit>=0?n.memoryLimit=(e.memory_limit/1024).toFixed(2)+" MB":n.memoryLimit="未知",e.judge_type!=null&&(n.judgeType=Yl(e.judge_type)),e.insert_time!=null&&(n.insertTime=new Date(e.insert_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.source!=null){const u=/\[([^\]]+)\]\(([^)]+)\)/,s=e.source.match(u);s?(n.source=s[1],n.sourceUrl=s[2]):(n.source=e.source,n.sourceUrl="")}return e.judge_md5!=null&&(n.judgeMd5=e.judge_md5),e.origin_oj!=null&&(n.originOj=e.origin_oj),e.origin_id!=null&&(n.originId=e.origin_id),e.origin_url!=null&&(n.originUrl=e.origin_url),n}function Ta(e,l){const n={};if(n.id=e.id,n.problemId=e.problem_id,n.title=e.title,n.tags=[],e.tags)for(const u of e.tags){const s=l[u];s&&n.tags.push(s)}return e.accept?n.accept=e.accept:n.accept=0,e.attempt?n.attempt=e.attempt:n.attempt=0,n.solution=e.solution,n.code=e.code,e.create_time!=null&&(n.createTime=new Date(e.create_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.updater_nickname!=null&&(n.updaterNickname=e.updater_nickname),n}function Da(e,l,n){const u={};return e?u.id=e:(u.contest_id=l,u.problem_index=n),W({url:`/problem?${new URLSearchParams(u).toString()}`,method:"get"})}function ja(e){return W({url:"/problem/tag/list?max_count="+e,method:"get"})}function sn(e){return W({url:"/problem/judge?id="+e,method:"get"})}function rn(e,l,n,u,s,w){const g={};return e&&(g.oj=e),l&&(g.title=l),n&&(g.tag=n),u!==void 0&&(g.private=u?"1":"0"),s&&(g.page=s),w&&(g.page_size=w),W({url:`/problem/list?${new URLSearchParams(g).toString()}`,method:"get"})}function un(e){const l={};return e&&(l.problem_id=e),W({url:`/problem/recommend?${new URLSearchParams(l).toString()}`,method:"get"})}function cn(e){return W({url:"/problem/daily?id="+e,method:"get"})}function dn(e){return W({url:"/problem/daily/edit?id="+e,method:"get"})}function mn(){return W({url:"/problem/daily/recently",method:"get"})}function pn(e,l,n,u,s){const w={};return e&&(w.start_date=e),l&&(w.end_date=l),n&&(w.problem_id=n),u&&(w.page=u),s&&(w.page_size=s),W({url:`/problem/daily/list?${new URLSearchParams(w).toString()}`,method:"get"})}function La(e,l){return W({url:"/problem/crawl",method:"post",data:{oj:e,id:l}})}function fn(e,l,n,u,s,w,g){return W({url:"/problem/create",method:"post",data:{title:e,time_limit:l,memory_limit:n,source:u,private:s,tags:w,description:g}})}function vn(e,l,n,u,s,w,g,P){return W({url:"/problem/edit",method:"post",data:{id:e,title:l,time_limit:n,memory_limit:u,source:s,private:w,tags:g,description:P}})}function _n(e,l,n,u){return W({url:"/problem/daily/create",method:"post",data:{id:e,problem_id:l,solution:n,code:u}})}function gn(e,l,n,u){return W({url:"/problem/daily/edit",method:"post",data:{id:e,problem_id:l,solution:n,code:u}})}function bn(e,l){return W({url:"/problem/judge/data/download?id="+e+"&key="+l,method:"get"})}function hn(e){return e||(e=""),W({url:"/problem/image/token?id="+e,method:"get"})}function yn(e){return e||(e=""),W({url:"/problem/daily/image/token?id="+e,method:"get"})}function wn(e,l){const n=new FormData;return n.append("id",e),n.append("zip",l),W({url:"/problem/judge/data",method:"post",data:n,headers:{"Content-Type":"multipart/form-data"},timeout:1e3*60*5})}function kn(e){return W({url:"/problem/parse",method:"post",data:{problems:e}})}const Cn={class:"sh-main"},Sn={class:"dida-swiper-div"},In=ie({__name:"HomeView",setup(e){const{globalProperties:l}=pe();let n=-1;const u=i({theme:"info",content:""}),s=i({title:"",content:""}),w=i([]),g=i(!1),P=i(!1),f=i(!1),o=async()=>{u.value=await Sa()},T=async()=>{try{const y=await Ia();s.value.title=y.title,s.value.content=y.content}catch{_e(l,"加载公告失败"),s.value={title:"公告加载失败",content:"请刷新页面重新获取"}}},p=async()=>{const y=await tn();if(y.code!==0){_e(l,"加载OJ统计数据失败");return}let b=[];for(const _ of y.data){const v=new Date(_.date),r=`${v.getMonth()+1}-${v.getDate()}`;b.push({Date:r,Type:"Unaccept",Count:_.attempt-_.accept}),b.push({Date:r,Type:"Accept",Count:_.accept})}const c={type:"bar",data:[{id:"barData",values:b}],xField:"Date",yField:"Count",seriesField:"Type",stack:!0,legends:{visible:!0},bar:{state:{hover:{stroke:"#000",lineWidth:1}}},height:300};new Ga(c,{dom:"ojStaticsDiv"}).renderSync()},S=async()=>{w.value=[];const y=await mn();if(y.code!==0){_e(l,"加载每日问题数据失败");return}y.data.list&&y.data.list.length>0&&y.data.list.forEach(b=>{let c="default",m="未尝试";if(y.data.attempt_status){const v=y.data.attempt_status[b.problem_id];if(v)switch(v){case Oe.Accept:c="success",m="已解决";break;case Oe.Attempt:c="warning",m="待解决";break;default:c="default",m="未尝试"}}const _=`${b.title}`;w.value.push({id:b.id,title:_,problemId:b.problem_id,theme:c,tag:m})})};return me(async()=>{f.value=!0,g.value=!0,P.value=!0,(async()=>(await o(),n=setInterval(()=>{o()},3e4),await T(),f.value=!1))(),(async()=>(await p(),g.value=!1))(),(async()=>(await S(),P.value=!1))()}),Na(()=>{clearInterval(n)}),(y,b)=>{const c=It,m=fl,_=pl,v=Ve,r=Fe("md-preview"),d=be,U=Pe,x=nt,h=gl,A=tt,I=_l,k=vl,L=Ie;return j(),E(v,{loading:f.value},{default:a(()=>[t(L,null,{default:a(()=>[t(U,{span:8},{default:a(()=>{var $;return[z("div",Cn,[u.value?(j(),E(c,{key:0,class:"dida-notification-div",theme:u.value.theme},{default:a(()=>[V(q(u.value.content),1)]),_:1},8,["theme"])):ae("",!0),z("div",Sn,[t(_,{class:"dida-swiper"},{default:a(()=>[t(m,null,{default:a(()=>b[1]||(b[1]=[z("a",{href:"http://codeoj.cn",target:"_blank"},[z("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"})],-1)])),_:1}),t(m,null,{default:a(()=>b[2]||(b[2]=[z("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1})]),_:1})]),t(v,{loading:g.value},{default:a(()=>b[3]||(b[3]=[z("div",{id:"ojStaticsDiv",style:{"min-height":"200px"}},null,-1)])),_:1},8,["loading"]),t(d,{title:($=s.value)==null?void 0:$.title,style:{width:"calc(100% - 100px)",margin:"0 auto"}},{default:a(()=>{var D;return[t(r,{"model-value":(D=s.value)==null?void 0:D.content,previewTheme:"cyanosis"},null,8,["model-value"])]}),_:1},8,["title"])])]}),_:1}),t(U,{span:4},{default:a(()=>[t(d,{style:{margin:"10px"},bordered:!0},{default:a(()=>b[4]||(b[4]=[z("img",{src:"https://api.jysafe.cn/ip/",alt:"Welcome",style:{width:"100%"}},null,-1)])),_:1}),t(Nl,{style:{margin:"10px"}}),t(d,{style:{margin:"10px"},bordered:!0,title:"每日一题"},{actions:a(()=>[t(x,{onClick:b[0]||(b[0]=$=>y.$router.push({name:"problem-daily-list"}))},{default:a(()=>b[5]||(b[5]=[V("查看全部")])),_:1})]),default:a(()=>[t(v,{loading:P.value},{default:a(()=>[t(k,{split:!0,size:"small",style:{"min-height":"200px"}},{default:a(()=>[(j(!0),te(ue,null,Se(w.value,$=>(j(),E(I,{key:$.id},{default:a(()=>[t(h,{style:{width:"100px"}},{description:a(()=>[t(x,{onClick:D=>y.$router.push({name:"problem-daily-detail",params:{dailyId:$.id}})},{default:a(()=>[V(q($.problemId),1)]),_:2},1032,["onClick"])]),_:2},1024),t(h,{style:{width:"200px"}},{description:a(()=>[t(x,{onClick:D=>y.$router.push({name:"problem-daily-detail",params:{dailyId:$.id}})},{default:a(()=>[V(q($.title),1)]),_:2},1032,["onClick"])]),_:2},1024),t(h,{style:{width:"135px"},description:$.id},null,8,["description"]),t(h,null,{description:a(()=>[t(A,{theme:$.theme},{default:a(()=>[V(q($.tag),1)]),_:2},1032,["theme"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["loading"])]),_:1}),t(d,{style:{margin:"10px"},bordered:!0},{header:a(()=>b[6]||(b[6]=[z("b",null,"友情链接",-1)])),default:a(()=>[t(k,null,{default:a(()=>[t(I,null,{default:a(()=>[t(x,{href:"https://boiltask.com",target:"_blank"},{default:a(()=>b[7]||(b[7]=[V("BoilTask Blog")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])}}}),ce=(e,l)=>{const n=e.__vccOpts||e;for(const[u,s]of l)n[u]=s;return n},Pn=ce(In,[["__scopeId","data-v-ae369c75"]]),xn={class:"sh-main"},Vn=ie({__name:"View404",setup(e){let l=ke(),n=i(l.fullPath);return(u,s)=>{const w=B;return j(),te("div",xn,[z("p",null,q(de(n)),1),s[2]||(s[2]=z("p",null,"该页面无效或已被迁移，请重新选择访问目标",-1)),t(w,{theme:"primary",onClick:s[0]||(s[0]=()=>u.$router.push("/"))},{default:a(()=>s[1]||(s[1]=[V("返回首页")])),_:1})])}}}),Ua=ce(Vn,[["__scopeId","data-v-d4218944"]]);function Tn(e){const l={};return l.id=e.id,l.username=e.username,l.nickname=e.nickname,l.email=e.email,l.slogan=e.slogan,l.organization=e.organization,l.accept=e.accept,l.attempt=e.attempt,l.vjudgeId=e.vjudge_id,e.email&&(l.avatar=`https://www.gravatar.com/avatar/${Ha(e.email.toLowerCase().trim())}?d=identicon&s=100`),l}function Dn(e,l){return W({url:"/user/login",method:"post",data:{username:e,password:l}})}function jn(){return W({url:"/user/login/refresh",method:"post"})}function Ln(e){const l={username:e};return W({url:`/user/info?${new URLSearchParams(l).toString()}`,method:"get"})}function Un(e){const l="https://vjudge.net/user/solveDetail/"+encodeURIComponent(e);return Tt({url:l,method:"get"})}function $n(e){return W({url:"/user/account/infos",method:"post",data:{users:e}})}function zn(e){return W({url:"/user/parse",method:"post",data:{users:e}})}function An(e,l){return W({url:"/user/register/email",method:"post",data:{token:e,email:l}})}function Rn(e,l,n,u,s){return W({url:"/user/register",method:"post",data:{username:e,password:l,email:n,key:u,nickname:s}})}function Mn(e,l){return W({url:"/user/forget",method:"post",data:{token:e,username:l}})}function En(e,l,n){return W({url:"/user/password/modify",method:"post",data:{username:e,password:l,key:n}})}const qn={class:"dida-login-footer"},Kn=ie({__name:"LoginView",setup(e){const{globalProperties:l}=pe(),n=Me(),u=i(!1),s=i({username:"",password:""}),w=()=>{he(l,"重置成功")},g=({validateResult:P,firstError:f})=>{u.value||(u.value=!0,Dn(s.value.username,s.value.password).then(o=>{if(o.code===0){n.loadResponse(o.data),he(l,"登录成功");let T=l.$route.query.redirect_uri;T||(T="/user/"+o.data.username),l.$router.push({path:T})}else N(l,o.code)}).catch(o=>{console.error("Login error",o),_e(l,"登录失败")}).finally(()=>{u.value=!1}))};return me(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),(P,f)=>{const o=$e,T=Ue,p=B,S=Le,y=nt,b=be;return j(),E(b,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(S,{ref:"form",data:s.value,colon:!0,onReset:w,onSubmit:g,class:"yj-login-form","label-width":0},{default:a(()=>[t(T,{name:"username"},{default:a(()=>[t(o,{modelValue:s.value.username,"onUpdate:modelValue":f[0]||(f[0]=c=>s.value.username=c),clearable:"",autocomplete:"username",placeholder:"请输入用户名"},{"prefix-icon":a(()=>[t(de(Ba))]),_:1},8,["modelValue"])]),_:1}),t(T,{name:"password"},{default:a(()=>[t(o,{modelValue:s.value.password,"onUpdate:modelValue":f[1]||(f[1]=c=>s.value.password=c),type:"password",autocomplete:"current-password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":a(()=>[t(de(Ja))]),_:1},8,["modelValue"])]),_:1}),t(T,null,{default:a(()=>[t(p,{theme:"primary",type:"submit",block:"",loading:u.value},{default:a(()=>f[4]||(f[4]=[V("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),z("div",qn,[t(y,{onClick:f[2]||(f[2]=()=>{de(l).$router.push({name:"login-forget"})})},{default:a(()=>f[5]||(f[5]=[V("忘记密码 ")])),_:1}),t(y,{onClick:f[3]||(f[3]=()=>{de(l).$router.push({name:"register"})})},{default:a(()=>f[6]||(f[6]=[V("注册账户 ")])),_:1})])]),_:1})}}}),Fn=ce(Kn,[["__scopeId","data-v-0466c42d"]]),On={class:"dida-login-footer"},Nn=ie({__name:"RegisterView",setup(e){const{globalProperties:l}=pe(),n=Me(),u=i(!1),s=i(!1),w=i(!1),g=i("发送验证码");let P=null,f=-1;const o=i(!1),T=i(null),p=i({username:"",password:"",confirmPassword:"",nickname:"",email:"",emailKey:""}),y=i({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:r=>new Promise(d=>{const U=setTimeout(()=>{d(p.value.password===r),clearTimeout(U)})}),message:"两次密码不一致"}],nickname:[{required:!0,message:"请填写昵称"},{min:1,message:"昵称至少1个字符"},{max:30,message:"昵称最多30个字符"}],email:[{required:!0,message:"请填写邮箱"},{pattern:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"邮箱格式不正确"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),b=i(()=>t(B,{onClick:c,disabled:w.value,loading:s.value,style:"width:120px"},{default:()=>[g.value]})),c=async()=>{var x;if(!p.value.email){_e(l,"请输入邮箱");return}if(!p.value.email.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)){_e(l,"邮箱格式不正确");return}if(w.value||s.value)return;o.value=!0,await dt();const r=document.getElementById("cf-confirm-div");r&&r.remove();const d=document.createElement("div");d.id="cf-confirm-div",d.setAttribute("data-theme","light"),(x=T.value)==null||x.appendChild(d);const U=window;U.turnstile.ready(function(){U.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(h){o.value=!1,await m(h)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},m=async r=>{if(!w.value){s.value=!0;try{const d=await An(r,p.value.email);if(d.code!==0){N(l,d.code);return}he(l,"发送验证码成功"),s.value=!1,w.value=!0,P=new Date,g.value="60秒后重发",f=setInterval(()=>{const x=Math.floor((new Date().getTime()-(P==null?void 0:P.getTime()))/1e3);x>60?(g.value="发送验证码",w.value=!1,clearInterval(f)):g.value=`${60-x}秒后重发`},1e3)}catch{_e(l,"发送验证码失败")}finally{s.value=!1}}},_=()=>{he(l,"重置成功")},v=({validateResult:r,firstError:d,e:U})=>{if(!u.value){if(U.preventDefault(),r!==!0){_e(l,d);return}if(p.value.password!==p.value.confirmPassword){_e(l,"两次密码不一致");return}u.value=!0,Rn(p.value.username,p.value.password,p.value.email,p.value.emailKey,p.value.nickname).then(x=>{x.code===0?(he(l,"注册成功，可使用账号信息登录"),l.$router.push({name:"login"})):N(l,x.code)}).catch(x=>{console.error("Login error",x),_e(l,"登录失败")}).finally(()=>{u.value=!1})}};return me(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),Te(()=>{clearInterval(f)}),(r,d)=>{const U=$e,x=Ue,h=_a,A=B,I=Le,k=nt,L=be,$=lt;return j(),te(ue,null,[t(L,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(I,{ref:"form",rules:y.value,data:p.value,colon:!0,onReset:_,onSubmit:v,class:"yj-login-form"},{default:a(()=>[t(x,{name:"username",label:"用户名"},{default:a(()=>[t(U,{modelValue:p.value.username,"onUpdate:modelValue":d[0]||(d[0]=D=>p.value.username=D),clearable:"",placeholder:"用于登录与查找"},null,8,["modelValue"])]),_:1}),t(x,{name:"password",label:"密码"},{default:a(()=>[t(U,{modelValue:p.value.password,"onUpdate:modelValue":d[1]||(d[1]=D=>p.value.password=D),type:"password",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(x,{name:"confirmPassword",label:"确认密码"},{default:a(()=>[t(U,{modelValue:p.value.confirmPassword,"onUpdate:modelValue":d[2]||(d[2]=D=>p.value.confirmPassword=D),type:"password",clearable:"",placeholder:"请确认密码"},null,8,["modelValue"])]),_:1}),t(x,{name:"nickname",label:"昵称"},{default:a(()=>[t(U,{modelValue:p.value.nickname,"onUpdate:modelValue":d[3]||(d[3]=D=>p.value.nickname=D),clearable:"",placeholder:"用于优先在网站各处展示"},null,8,["modelValue"])]),_:1}),t(x,{name:"email",label:"邮箱"},{default:a(()=>[t(U,{modelValue:p.value.email,"onUpdate:modelValue":d[4]||(d[4]=D=>p.value.email=D),clearable:"",placeholder:"请填写常用邮箱"},null,8,["modelValue"])]),_:1}),t(x,{name:"emailKey",label:"验证码"},{default:a(()=>[t(h,{append:b.value},{default:a(()=>[t(U,{modelValue:p.value.emailKey,"onUpdate:modelValue":d[5]||(d[5]=D=>p.value.emailKey=D),clearable:"",placeholder:"请输入验证码",style:{width:"140px"}},null,8,["modelValue"])]),_:1},8,["append"])]),_:1}),t(x,null,{default:a(()=>[t(A,{theme:"primary",type:"submit",block:"",loading:u.value},{default:a(()=>d[8]||(d[8]=[V("注册")])),_:1},8,["loading"])]),_:1})]),_:1},8,["rules","data"]),z("div",On,[t(k,{onClick:d[6]||(d[6]=()=>{de(l).$router.push({name:"login"})})},{default:a(()=>d[9]||(d[9]=[V("返回登陆 ")])),_:1})])]),_:1}),t($,{visible:o.value,"onUpdate:visible":d[7]||(d[7]=D=>o.value=D),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:a(()=>[z("div",{ref_key:"dialogContainer",ref:T,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),Gn=ce(Nn,[["__scopeId","data-v-d25e7538"]]),Hn={key:0,style:{margin:"10px"}},Bn={key:1,style:{margin:"10px"}},Jn={style:{margin:"12px"}},Wn=ie({__name:"UserView",setup(e){let l=ke();const{globalProperties:n}=pe(),u=Ye();let s="";const w=i(!1),g=i(null),P=i([]),f=i([]),o=i([]),T=async p=>{w.value=!0;try{let S=await Ln(p);if(S.code!==0){w.value=!1,N(n,S.code),await X.push({name:"home"});return}if(g.value=Tn(S.data.user),P.value=S.data.problems_ac,u.setTitle(g.value.nickname+" - "+u.getTitle),g.value.vjudgeId){const y=await Un(g.value.vjudgeId);f.value=y.acRecords;for(const b in f.value)f.value[b].sort((c,m)=>c.length===m.length?c.localeCompare(m):c.length-m.length);o.value=y.failRecords;for(const b in o.value)o.value[b].sort((c,m)=>c.length===m.length?c.localeCompare(m):c.length-m.length)}}catch{_e(n,"获取用户信息失败"),await X.push({name:"home"})}finally{w.value=!1}};return Wa(async(p,S,y)=>{if(Array.isArray(p.params.username)?s=p.params.username[0]:s=p.params.username,!s){await X.push({name:"home"});return}await T(s),y()}),me(async()=>{if(Array.isArray(l.params.username)?s=l.params.username[0]:s=l.params.username,!s){await X.push({name:"home"});return}await T(s)}),(p,S)=>{const y=B,b=we,c=be,m=nt,_=We,v=Je,r=Pe,d=bl,U=Ie,x=Ve;return j(),E(x,{loading:w.value},{default:a(()=>[t(U,{class:"dida-main-content"},{default:a(()=>[t(r,{span:8},{default:a(()=>{var h;return[t(c,{style:{margin:"10px"},title:"AC题目"},{default:a(()=>[t(b,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(j(!0),te(ue,null,Se(P.value,A=>(j(),E(y,{key:A,size:"small",onClick:()=>de(X).push({name:"problem-detail",params:{problemId:A}})},{default:a(()=>[V(q(A),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),(h=g.value)!=null&&h.vjudgeId?(j(),E(c,{key:0,style:{margin:"10px"},title:"vjudge.net"},{actions:a(()=>{var A;return[t(m,{href:"https://vjudge.net/user/"+((A=g.value)==null?void 0:A.vjudgeId),target:"_blank"},{default:a(()=>{var I;return[V("@"+q((I=g.value)==null?void 0:I.vjudgeId),1)]}),_:1},8,["href"])]}),default:a(()=>[f.value&&Object.keys(f.value).length>0?(j(),te("div",Hn,[S[0]||(S[0]=z("div",{style:{margin:"5px"}},[z("span",null,"AC")],-1)),t(v,{layout:"vertical",bordered:!0},{default:a(()=>[(j(!0),te(ue,null,Se(f.value,(A,I)=>(j(),E(_,{key:I,label:I},{default:a(()=>[t(b,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(j(!0),te(ue,null,Se(A,k=>(j(),E(y,{key:k,size:"small",onClick:()=>de(X).push({name:"problem-detail",params:{problemId:I+"-"+k}})},{default:a(()=>[V(q(k),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):ae("",!0),o.value&&Object.keys(o.value).length>0?(j(),te("div",Bn,[S[1]||(S[1]=z("div",{style:{margin:"5px"}},[z("span",null,"Fail")],-1)),t(v,{layout:"vertical",bordered:!0},{default:a(()=>[(j(!0),te(ue,null,Se(o.value,(A,I)=>(j(),E(_,{key:I,label:I},{default:a(()=>[t(b,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(j(!0),te(ue,null,Se(A,k=>(j(),E(y,{key:k,size:"small",onClick:()=>de(X).push({name:"problem-detail",params:{problemId:I+"-"+k}})},{default:a(()=>[V(q(k),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):ae("",!0)]),_:1})):ae("",!0)]}),_:1}),t(r,{span:4},{default:a(()=>[z("div",Jn,[t(v,{layout:"vertical",bordered:!0},{default:a(()=>[t(_,{label:"头像"},{default:a(()=>{var h;return[t(d,{shape:"round",size:"100px",image:(h=g.value)==null?void 0:h.avatar,"hide-on-load-failed":!1},null,8,["image"])]}),_:1}),t(_,{label:"昵称"},{default:a(()=>{var h;return[V(q((h=g.value)==null?void 0:h.nickname),1)]}),_:1}),t(_,{label:"Slogan"},{default:a(()=>{var h;return[V(q((h=g.value)==null?void 0:h.slogan),1)]}),_:1}),t(_,{label:"邮箱"},{default:a(()=>{var h;return[V(q((h=g.value)==null?void 0:h.email),1)]}),_:1}),t(_,{label:"组织"},{default:a(()=>{var h;return[V(q((h=g.value)==null?void 0:h.organization),1)]}),_:1}),t(_,{label:"通过数量"},{default:a(()=>{var h;return[V(q((h=g.value)==null?void 0:h.accept),1)]}),_:1}),t(_,{label:"提交数量"},{default:a(()=>{var h;return[V(q((h=g.value)==null?void 0:h.attempt),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Yn=ce(Wn,[["__scopeId","data-v-6d730b5a"]]),Gt=[{name:"home",path:"/",title:"首页",showSidebar:!1,disableGenerateTab:!0,component:Pn},{name:"problem",path:"/problem",title:"题目",icon:"calculation",showSidebar:!0,redirect:"problem-list"},{name:"collection-detail-tab",title:"题集",path:"/collection",showSidebar:!0,disableGenerateTab:!0,redirect:"problem-collection-list"},{name:"judge",path:"/judge",title:"评测",icon:"code",showSidebar:!0,redirect:"judge-list"},{name:"contest",path:"/contest",title:"比赛",icon:"application",showSidebar:!0,redirect:"contest-list"},{name:"contest-detail-tab",title:"比赛",path:"/contest",showSidebar:!0,disableGenerateTab:!0,redirect:"contest-list"},{name:"discuss",title:"讨论",path:"/discuss",icon:"sonic",showSidebar:!0,redirect:"discuss-list"},{name:"rank",path:"/rank",title:"排名",icon:"chart-column",showSidebar:!0,redirect:"rank-ac-all"},{name:"system",path:"/system",title:"系统",icon:"dashboard",showSidebar:!0,redirect:"system-status"},{name:"manage",path:"/manage",title:"管理",icon:"command",showSidebar:!0,redirect:"manage-web",auths:[De.ManageWeb]},{name:"login",path:"/login",title:"登陆",showSidebar:!1,disableGenerateTab:!0,component:Fn},{name:"register",path:"/register",title:"注册",showSidebar:!1,disableGenerateTab:!0,component:Gn},{name:"user",path:"/user/:username+",title:"用户",showSidebar:!1,needLogin:!0,disableGenerateTab:!0,component:Yn},{name:"404",path:"/404",title:"404",showSidebar:!1,disableGenerateTab:!0,component:Ua}],Xn=e=>Gt.find(l=>l.name==e),Zn=e=>{const l=[];return Gt.forEach(n=>{!n.disableGenerateTab&&e.hasAllAuths(n.auths)&&l.push(n)}),l},Qn=e=>{Gt.forEach(l=>{const n={name:l.name,path:l.path,meta:{title:l.title,tab:l.name,showSidebar:l.showSidebar,needLogin:l.needLogin,redirect:l.redirect,tabAuths:l.auths},component:l.component};e.push(n)})};function $a(e){return e.children!==void 0}function eo(e){return e.children!==void 0}const to={style:{margin:"10px"}},ao={key:0,class:"dida-operation-container"};function lo(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const no=ie({__name:"ProblemList",setup(e){const l=ke(),n=Be(),{globalProperties:u}=pe(),s=Me();let w=null;const g=i(!1),P={};let f={};const o=i(!1),T=Ge(()=>s.hasAuth(De.ManageProblem)),p=i([{title:"ID",colKey:"id",cell:(D,C)=>{let M=x(C.row.id);return t(B,{variant:"dashed",theme:M,onClick:()=>U(C.row.id)},{default:()=>[C.row.id]})}},{title:"标题",colKey:"title",cell:(D,C)=>t(B,{variant:"text",onClick:()=>U(C.row.id)},{default:()=>[C.row.title]})},{title:"标签",colKey:"tags",cell:(D,C)=>{const M=C.row.tags;if(!M||M.length===0)return"";let R=[];for(let H=0;H<M.length;H++){const Y=M[H];R.push(t(B,{key:H,theme:"default",variant:"outline",size:"small",onClick:()=>I(Y)},{default:()=>[Y.name]}))}return t(we,null,lo(R)?R:{default:()=>[R]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),S=i(!1);let y=1,b=50;const c=i({current:y,pageSize:b,defaultCurrent:y,defaultPageSize:b,total:0,pageSizeOptions:[50,100]}),m=i(),_=i(),v=[{label:"DidaOJ",value:"didaoj"},{label:"HDU",value:"hdu"},{label:"POJ",value:"poj"},{label:"NYOJ",value:"nyoj"}],r=i({oj:"",title:"",tag:"",private:!1}),d=i({oj:"",problem:""}),U=D=>{D&&n.push({path:"/problem/"+D})},x=D=>{if(!D||!f)return"default";const C=f[D];if(!C)return"default";switch(C){case Oe.Accept:return"success";case Oe.Attempt:return"warning";default:return"default"}},h=async()=>{await n.push({query:{...l.query,oj:r.value.oj,title:r.value.title,tag:r.value.tag,private:r.value.private?"1":"0",page:1,page_size:c.value.defaultPageSize}})},A=async()=>{try{o.value=!0;const D=await La(d.value.oj,d.value.problem);D.code===0?(he(u,"搜索成功"),await n.push({name:"problem-detail",params:{problemId:D.data}})):N(u,D.code)}catch(D){console.error(D),N(u,qe())}finally{o.value=!1}},I=D=>{D&&n.push({query:{...l.query,title:"",tag:D.name,page:1,page_size:c.value.defaultPageSize}})},k=()=>{n.push({name:"manage-problem-create"})},L=async(D,C)=>{S.value=!0;try{const{current:M,pageSize:R}=D,H=await rn(r.value.oj,r.value.title,r.value.tag,r.value.private,M,R);if(m.value=[],H.code===0){const Y=H.data.list;if(!Y||Y.length<=0){c.value={...c.value,total:0},f={},he(u,"未找到记录");return}Y.forEach(se=>{var ee;const K=vt(se,P);(ee=m.value)==null||ee.push(K)}),c.value={...c.value,total:H.data.total_count},f=H.data.problem_attempt_status}else C&&N(u,H.code)}catch(M){console.error(M),N(u,qe())}finally{S.value=!1}},$=async D=>{await n.push({query:{...l.query,page:D.current,page_size:D.pageSize}})};return me(async()=>{S.value=!0,_.value=[],ja(-1).then(D=>{if(D.code===0){_.value=D.data.list,g.value=D.data.total_count>D.data.list.length;for(let C=0;C<D.data.list.length;C++){const M=D.data.list[C];P[M.id]=M}w=je(()=>l.query,C=>{r.value.oj=C.oj||"",r.value.title=C.title||"",r.value.tag=C.tag||"",r.value.private=C.private==="1";const M=parseInt(C.page)||c.value.defaultCurrent,R=parseInt(C.page_size)||c.value.defaultPageSize;y=M,b=R,c.value={...c.value,current:y,pageSize:b},L({current:y,pageSize:b},!0)},{immediate:!0})}else g.value=!0}).catch(D=>{console.error(D),g.value=!0})}),Te(()=>{w&&w()}),(D,C)=>{const M=ze,R=be,H=Pe,Y=B,se=we,K=pt,ee=Ue,Z=$e,re=ft,ne=Le,F=Ie;return j(),E(F,null,{default:a(()=>[t(H,{span:9},{default:a(()=>[t(R,{style:{margin:"10px"}},{default:a(()=>[t(M,{data:m.value,columns:p.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:c.value,"table-layout":"auto",loading:S.value,onPageChange:$},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(H,{span:3},{default:a(()=>[z("div",to,[T.value?(j(),te("div",ao,[t(se,null,{default:a(()=>[t(Y,{onClick:k},{default:a(()=>C[7]||(C[7]=[V("新建")])),_:1})]),_:1})])):ae("",!0),t(R,{class:"sh-card"},{default:a(()=>[t(ne,{model:r.value,onSubmit:h},{default:a(()=>[t(ee,{label:"OJ"},{default:a(()=>[t(K,{modelValue:r.value.oj,"onUpdate:modelValue":C[0]||(C[0]=G=>r.value.oj=G),options:v,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(ee,{label:"标题"},{default:a(()=>[t(Z,{modelValue:r.value.title,"onUpdate:modelValue":C[1]||(C[1]=G=>r.value.title=G),placeholder:"请输入关键词"},null,8,["modelValue"])]),_:1}),t(ee,{label:"标签"},{default:a(()=>[t(Z,{modelValue:r.value.tag,"onUpdate:modelValue":C[2]||(C[2]=G=>r.value.tag=G),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),T.value?(j(),E(ee,{key:0,label:"私有"},{default:a(()=>[t(re,{modelValue:r.value.private,"onUpdate:modelValue":C[3]||(C[3]=G=>r.value.private=G)},null,8,["modelValue"])]),_:1})):ae("",!0),t(ee,null,{default:a(()=>[t(Y,{theme:"primary",type:"submit"},{default:a(()=>C[8]||(C[8]=[V("搜索")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(R,{class:"sh-card"},{default:a(()=>[t(ne,{model:d.value,onSubmit:A},{default:a(()=>[t(ee,{label:"OJ"},{default:a(()=>[t(K,{modelValue:d.value.oj,"onUpdate:modelValue":C[4]||(C[4]=G=>d.value.oj=G),options:v,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(ee,{label:"题目"},{default:a(()=>[t(Z,{modelValue:d.value.problem,"onUpdate:modelValue":C[5]||(C[5]=G=>d.value.problem=G),placeholder:"请输入原始题号"},null,8,["modelValue"])]),_:1}),t(ee,null,{default:a(()=>[t(Y,{theme:"primary",type:"submit",loading:o.value},{default:a(()=>C[9]||(C[9]=[V("前往")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),t(R,{class:"sh-card sh-background-black"},{default:a(()=>[(j(!0),te(ue,null,Se(_.value,G=>(j(),E(Y,{class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:()=>I(G)},{default:a(()=>[V(q(G.name),1)]),_:2},1032,["onClick"]))),256)),g.value?(j(),E(Y,{key:0,class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:C[6]||(C[6]=()=>D.$router.push("/problem/tags"))},{default:a(()=>C[10]||(C[10]=[V(" ... ")])),_:1})):ae("",!0)]),_:1})])]),_:1})]),_:1})}}}),oo=ce(no,[["__scopeId","data-v-bc7185f5"]]);function at(e){let l="";for(;e>0;)e--,l=String.fromCharCode(65+e%26)+l,e=Math.floor(e/26);return l}function Ht(e){const l={};if(l.id=e.id,l.ownerId=e.owner_id,l.ownerUsername=e.owner_username,l.ownerNickname=e.owner_nickname,l.title=e.title,l.startTime=new Date(e.start_time).toLocaleString(),l.endTime=new Date(e.end_time).toLocaleString(),l.createTime=new Date(e.create_time).toLocaleString(),l.updateTime=new Date(e.update_time).toLocaleString(),l.private=e.private,l.description=e.description,l.notification=e.notification,e.problems){l.problems=[],e.problems.sort((n,u)=>n.index-u.index);for(let n=0;n<e.problems.length;n++){const u=e.problems[n];let s={accept:0,attempt:0,author:"",id:"",private:!1,tags:[],title:""};s.index=u.index,s.id=at(u.index),s.title=u.title,u.accept?s.accept=u.accept:s.accept=0,u.attempt?s.attempt=u.attempt:s.attempt=0,l.problems.push(s)}}return l}function so(e){return W({url:"/contest?id="+e,method:"get"})}function ro(e){return W({url:"/contest/edit?id="+e,method:"get"})}function uo(e){return W({url:"/contest/problem/list?id="+e,method:"get"})}function io(e,l){return W({url:"/contest/problem?id="+e+"&problem_index="+l,method:"get"})}function co(e,l){return W({url:"/contest/list?page="+e+"&page_size="+l,method:"get"})}function mo(e){return W({url:"/contest/rank?id="+e,method:"get"})}function po(e){return W({url:"/contest/create",method:"post",data:e})}function fo(e){return W({url:"/contest/edit",method:"post",data:e})}function vo(e,l){return W({url:"/contest/password",method:"post",data:{id:e,password:l}})}function _o(e){return W({url:"/contest/dolos",method:"post",data:{id:e}})}const Bt=async(e,l)=>{l&&await e.push({name:"user",params:{username:l}})},Qt=e=>{const l=X.resolve({name:"problem-detail",params:{problemId:e}});window.open(l.href,"_blank")},Et=async(e,l)=>{await X.push({name:"contest-problem-detail",params:{contestId:e,problemIndex:l}})},go={class:"sh-button"},bo={style:{"margin-top":"16px"}},ho={__name:"SecretPanel",setup(e){const l=i(!1);return(n,u)=>{const s=B;return j(),te("div",Qa(el(n.$attrs)),[z("div",go,[t(s,{onClick:u[0]||(u[0]=w=>l.value=!l.value)},{default:a(()=>[V(q(l.value?"收起":"展开"),1)]),_:1})]),Ya(z("div",bo,[Za(n.$slots,"default",{},void 0)],512),[[Xa,l.value]])],16)}}},ea=ce(ho,[["__scopeId","data-v-83e9f414"]]),yo={key:1,style:{"text-align":"center"}},wo={key:1,style:{"text-align":"center"}},ko={key:0,class:"dida-problems-container"},Co={style:{margin:"12px"}},So={key:1},Io={class:"dida-operation-container"},Po={key:0,class:"dida-operation-container"},xo={class:"dida-code-submit-div"},Vo={class:"dida-code-editor-div"},To=ie({__name:"ProblemDetail",setup(e){let l=ke();const{globalProperties:n}=pe();let u=null;const s=Ye(),w=Me();let g=i(""),P="",f="",o=0,T=i(0);const p=i(!1),S=i(!1);i(null),i(null),i(null);const y=i(!1),b=i(null);let c=null;const m=i(null),_=i(!1),v=i(!1),r={},d=i(""),U=i([]);U.value=Ot();const x=i([]),h=i(null),A=i(-1),I=i(-1),k=i(""),L=i("");let $=0;const D=Ge(()=>w.hasAuth(De.ManageProblem)),C=Ge(()=>w.hasAuth(De.ManageProblemDaily)),M=()=>{h.value&&clearInterval(h.value),h.value=setInterval(()=>{const O=A.value<=0,J=new Date(new Date().getTime()+$),le=J.getHours()*60*60+J.getMinutes()*60+J.getSeconds(),ge=18*60*60;le<ge?A.value=ge-le:A.value=-1,I.value=24*60*60-le,(!O&&A.value<=0||I.value<=0)&&ve()},1e3)},R=()=>{h.value&&(clearInterval(h.value),h.value=null)},H=O=>{O&&X.push({name:"problem-list",query:{...l.query,title:"",tag:O.name}})},Y=async()=>{if(!f){_e(n,"每日问题ID无效");return}await X.push({name:"manage-problem-daily",params:{dailyId:f}})},se=async()=>{let O=P;if(!O)try{const J=await io(o,T.value);J.code===0?O=J.data:N(n,J.code)}catch{_e(n,"获取题目ID失败，请稍后再试");return}await X.push({name:"manage-problem",params:{problemId:O}})},K=()=>{P?X.push({name:"judge-list",query:{problem_id:P}}):X.push({name:"contest-judge",params:{contestId:o},query:{problem_id:at(T.value)}})},ee=()=>{P?X.push({name:"discuss-list-problem",query:{problem_id:P}}):X.push({name:"contest-discuss",params:{contestId:o},query:{problem_id:at(T.value)}})},Z=()=>{X.push({name:"problem-recommend",params:{problemId:P}})},re=async()=>{var le,ge;const O=(le=b.value)==null?void 0:le.originOj,J=(ge=b.value)==null?void 0:ge.originId;if(!(!O||!J))try{_.value=!0;const Ce=await La(O,J);Ce.code===0?(await G(),he(n,"更新成功")):N(n,Ce.code)}catch{_e(n,"更新失败，请稍后再试")}finally{_.value=!1}},ne=async()=>{const O=parseInt(d.value);if(!wt(O)){_e(n,"请选择所编写的语言");return}const J=c==null?void 0:c.getValue();if(!J){_e(n,"请输入所需提交的代码");return}if(!P&&(!o||!T.value)){_e(n,"问题ID无效");return}v.value=!0;try{const le=await Xl(P,o,T.value,O,J);if(le.code!==0){N(n,le.code);return}he(n,"提交成功，正在跳转到详情页面");const ge=le.data.id;o?await X.push({name:"contest-judge-detail",params:{contestId:o,judgeId:ge}}):await X.push({name:"judge-detail",params:{judgeId:ge}})}finally{v.value=!1}},F=O=>{if(!c)return;const J=c.getModel();J&&Zt.setModelLanguage(J,Nt(O))},G=async()=>{x.value=[];let O=await Da(P,o,T.value);if(O.code!==0){y.value=!1,N(n,O.code),await X.push({name:"problem"});return}O.data.tags&&O.data.tags.forEach(J=>{r[J.id]=J}),b.value=vt(O.data.problem,r),s.setTitle(b.value.title+" - "+s.getTitle),o&&(O=await uo(o),O.code===0?(O.data.problems.sort((J,le)=>J-le),x.value=O.data.problems):N(n,O.code)),g.value=b.value.description,await dt(()=>{!c&&m.value&&(c=Zt.create(m.value,{value:"",language:"cpp",minimap:{enabled:!0},colorDecorators:!0,readOnly:!1,theme:"vs-dark"})),y.value=!1})},ve=async()=>{R(),S.value=!1;const O=await cn(f);if(O.code!==0)return;S.value=!0;const J=O.data.problem_daily;P=J.problem_id,k.value=J.solution,L.value=J.code;const le=new Date(O.data.time);$=le.getTime()-new Date().getTime();const ge=le.toISOString().split("T")[0];if(f===ge){const Ce=le.getHours()*60*60+le.getMinutes()*60+le.getSeconds(),Q=18*60*60;Ce<Q?A.value=Q-Ce:A.value=-1,I.value=24*60*60-Ce}(A.value>=0||I.value>=0)&&M()};return me(async()=>{u=je(()=>l.params,async()=>{if(S.value=!1,Array.isArray(l.params.problemId)?P=l.params.problemId[0]:P=l.params.problemId,P||(Array.isArray(l.params.dailyId)?f=l.params.dailyId[0]:f=l.params.dailyId,await ve()),!P){if(Array.isArray(l.params.contestId)?o=Number(l.params.contestId[0]):o=Number(l.params.contestId),!o){_e(n,"题目不存在"),f?await X.push({name:"problem-daily-list"}):await X.push({name:"problem"});return}if(Array.isArray(l.params.problemIndex)?T.value=parseInt(l.params.problemIndex[0]):T.value=parseInt(l.params.problemIndex),!T.value){_e(n,"题目不存在"),await X.push({name:"problem"});return}}p.value=!!o,y.value=!0,await G()},{immediate:!0}),m.value&&new ResizeObserver(()=>{c&&c.layout()}).observe(m.value)}),Te(()=>{u&&(u(),u=null),R()}),(O,J)=>{const le=Fe("md-preview"),ge=be,Ce=Fe("MdPreview"),Q=qt,fe=we,Ee=Pe,xe=B,ye=We,Ne=nt,Xe=Je,et=Kt,ot=pt,jt=Ie,Oa=Ve;return j(),E(Oa,{loading:y.value},{default:a(()=>[t(jt,{class:"dida-main-content"},{default:a(()=>[t(Ee,{span:8},{default:a(()=>[t(ge,{style:{margin:"10px"}},{default:a(()=>[t(le,{"model-value":de(g),previewTheme:"cyanosis"},null,8,["model-value"])]),_:1}),S.value?(j(),E(ge,{key:0,style:{margin:"10px"},title:"题解"},{default:a(()=>[A.value<0?(j(),E(ea,{key:0},{default:a(()=>[t(Ce,{modelValue:k.value},null,8,["modelValue"])]),_:1})):(j(),te("div",yo,[z("div",null,[t(fe,null,{default:a(()=>[J[2]||(J[2]=z("p",null,"距离解锁百分比",-1)),t(Q,{theme:"circle",color:{from:"#0052D9",to:"#00A870"},percentage:100-A.value/(18*60*60)*100,status:"active"},{label:a(()=>[V(q((100-A.value/(18*60*60)*100).toFixed(3))+"% ",1)]),default:a(()=>[J[1]||(J[1]=V(" > "))]),_:1},8,["percentage"])]),_:1})])]))]),_:1})):ae("",!0),S.value?(j(),E(ge,{key:1,style:{margin:"10px"},title:"示例代码"},{default:a(()=>[I.value<0?(j(),E(ea,{key:0},{default:a(()=>[t(Ce,{modelValue:L.value},null,8,["modelValue"])]),_:1})):(j(),te("div",wo,[z("div",null,[t(fe,{style:{margin:"0 auto"}},{default:a(()=>[J[4]||(J[4]=z("p",null,"距离解锁百分比",-1)),t(Q,{theme:"circle",color:{from:"#0052D9",to:"#00A870"},percentage:100-I.value/(24*60*60)*100,status:"active"},{label:a(()=>[V(q((100-I.value/(24*60*60)*100).toFixed(3))+"% ",1)]),default:a(()=>[J[3]||(J[3]=V(" > "))]),_:1},8,["percentage"])]),_:1})])]))]),_:1})):ae("",!0)]),_:1}),t(Ee,{span:4},{default:a(()=>{var Wt;return[de(o)?(j(),te("div",ko,[t(fe,{style:{"flex-wrap":"wrap"}},{default:a(()=>[(j(!0),te(ue,null,Se(x.value,(Ae,oe)=>(j(),E(xe,{key:oe,theme:Ae==de(T)?"primary":"default",onClick:async()=>await de(Et)(de(o),Ae)},{default:a(()=>[V(q(de(at)(Ae)),1)]),_:2},1032,["theme","onClick"]))),128))]),_:1})])):ae("",!0),z("div",Co,[t(Xe,{layout:"vertical",bordered:!0},{default:a(()=>{var Ae;return[t(ye,{label:"ID"},{default:a(()=>{var oe;return[V(q((oe=b.value)==null?void 0:oe.id),1)]}),_:1}),t(ye,{label:"标题"},{default:a(()=>{var oe;return[V(q((oe=b.value)==null?void 0:oe.title),1)]}),_:1}),t(ye,{label:"时间限制"},{default:a(()=>{var oe;return[V(q((oe=b.value)==null?void 0:oe.timeLimit),1)]}),_:1}),t(ye,{label:"内存限制"},{default:a(()=>{var oe;return[V(q((oe=b.value)==null?void 0:oe.memoryLimit),1)]}),_:1}),t(ye,{label:"判题方式"},{default:a(()=>{var oe;return[V(q((oe=b.value)==null?void 0:oe.judgeType),1)]}),_:1}),p.value?ae("",!0):(j(),E(ye,{key:0,label:"正确提交"},{default:a(()=>{var oe;return[V(q((oe=b.value)==null?void 0:oe.accept),1)]}),_:1})),p.value?ae("",!0):(j(),E(ye,{key:1,label:"提交总数"},{default:a(()=>{var oe;return[V(q((oe=b.value)==null?void 0:oe.attempt),1)]}),_:1})),t(ye,{label:"创建时间"},{default:a(()=>{var oe;return[V(q((oe=b.value)==null?void 0:oe.insertTime),1)]}),_:1}),t(ye,{label:"更新时间"},{default:a(()=>{var oe;return[V(q((oe=b.value)==null?void 0:oe.updateTime),1)]}),_:1}),t(ye,{label:"上传用户"},{default:a(()=>{var oe;return[V(q((oe=b.value)==null?void 0:oe.creatorNickname),1)]}),_:1}),p.value?ae("",!0):(j(),E(ye,{key:2,label:"题目来源"},{default:a(()=>{var oe,Ze,ct;return[(oe=b.value)!=null&&oe.sourceUrl?(j(),E(Ne,{key:0,href:(Ze=b.value)==null?void 0:Ze.sourceUrl,target:"_blank"},{default:a(()=>{var Yt;return[V(q((Yt=b.value)==null?void 0:Yt.source),1)]}),_:1},8,["href"])):(j(),te("span",So,q((ct=b.value)==null?void 0:ct.source),1))]}),_:1})),D.value?(j(),E(ye,{key:3,label:"是否私有"},{default:a(()=>{var oe;return[V(q((oe=b.value)!=null&&oe.private?"私有":"公开"),1)]}),_:1})):ae("",!0),(Ae=b.value)!=null&&Ae.originUrl?(j(),E(ye,{key:4,label:"原题链接"},{default:a(()=>{var oe;return[t(Ne,{href:(oe=b.value)==null?void 0:oe.originUrl,target:"_blank"},{default:a(()=>{var Ze,ct;return[V(q((Ze=b.value)==null?void 0:Ze.originOj)+" - "+q((ct=b.value)==null?void 0:ct.originId),1)]}),_:1},8,["href"])]}),_:1})):ae("",!0),de(P)?(j(),E(ye,{key:5,label:"标签"},{default:a(()=>[t(fe,null,{default:a(()=>{var oe;return[(j(!0),te(ue,null,Se((oe=b.value)==null?void 0:oe.tags,Ze=>(j(),E(xe,{key:Ze.id,variant:"dashed",onClick:()=>H(Ze)},{default:a(()=>[V(q(Ze.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})):ae("",!0)]}),_:1}),z("div",Io,[t(fe,null,{default:a(()=>[t(xe,{onClick:K},{default:a(()=>J[5]||(J[5]=[V("提交记录")])),_:1}),t(xe,{onClick:ee},{default:a(()=>J[6]||(J[6]=[V("题目讨论")])),_:1}),de(P)?(j(),E(xe,{key:0,onClick:Z},{default:a(()=>J[7]||(J[7]=[V("题目推荐")])),_:1})):ae("",!0)]),_:1})]),S.value&&C.value||D.value||(Wt=b.value)!=null&&Wt.originId?(j(),te("div",Po,[t(fe,null,{default:a(()=>{var Ae;return[S.value&&C.value?(j(),E(xe,{key:0,onClick:Y},{default:a(()=>J[8]||(J[8]=[V("每日一题")])),_:1})):ae("",!0),D.value?(j(),E(xe,{key:1,onClick:se},{default:a(()=>J[9]||(J[9]=[V("编辑")])),_:1})):ae("",!0),(Ae=b.value)!=null&&Ae.originId?(j(),E(xe,{key:2,onClick:re,loading:_.value},{default:a(()=>J[10]||(J[10]=[V("更新描述 ")])),_:1},8,["loading"])):ae("",!0)]}),_:1})])):ae("",!0),z("div",xo,[t(fe,null,{default:a(()=>[t(ot,{modelValue:d.value,"onUpdate:modelValue":J[0]||(J[0]=Ae=>d.value=Ae),label:"语言：",placeholder:"请选择提交语言","auto-width":"",clearable:"",onChange:F},{default:a(()=>[(j(!0),te(ue,null,Se(U.value,Ae=>(j(),E(et,{key:Ae.value,value:Ae.value,label:Ae.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),t(xe,{onClick:ne,loading:v.value},{default:a(()=>J[11]||(J[11]=[V("提交")])),_:1},8,["loading"])]),_:1}),z("div",Vo,[z("div",{ref_key:"codeEditRef",ref:m,class:"dida-code-editor"},null,512)])])])]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),Lt=ce(To,[["__scopeId","data-v-7d39f15a"]]),Do={style:{margin:"10px"}},jo={key:0,class:"dida-operation-container"};function Lo(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const Uo=ie({__name:"ProblemDailyList",setup(e){const l=ke(),n=Be(),{globalProperties:u}=pe(),s=Me();let w=!1,g=null,P={},f={};const o=Ge(()=>s.hasAuth(De.ManageProblem)),T=i([{title:"日期",colKey:"id",cell:(I,k)=>t(B,{variant:"dashed",onClick:()=>_(k.row.id)},{default:()=>[k.row.id]})},{title:"ID",colKey:"problemId",cell:(I,k)=>{let L=v(k.row.problemId);return t(B,{variant:"dashed",theme:L,onClick:()=>_(k.row.id)},{default:()=>[k.row.problemId]})}},{title:"标题",colKey:"title",cell:(I,k)=>t(B,{variant:"text",onClick:()=>_(k.row.id)},{default:()=>[k.row.title]})},{title:"标签",colKey:"tags",cell:(I,k)=>{const L=k.row.tags;if(!L||L.length===0)return"";let $=[];for(let D=0;D<L.length;D++){const C=L[D];$.push(t(B,{key:D,theme:"default",variant:"outline",size:"small",onClick:()=>U(C)},{default:()=>[C.name]}))}return t(we,null,Lo($)?$:{default:()=>[$]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),p=i(!1);let S=1,y=50;const b=i({current:S,pageSize:y,defaultCurrent:S,defaultPageSize:y,total:0,pageSizeOptions:[50,100]}),c=i([]),m=i({date:[],problemId:""}),_=I=>{I&&n.push({name:"problem-daily-detail",params:{dailyId:I}})},v=I=>{if(!I||!f)return"default";const k=f[I];if(!k)return"default";switch(k){case Oe.Accept:return"success";case Oe.Attempt:return"warning";default:return"default"}},r=async()=>{let I="";m.value.date&&m.value.date.length>1&&(I=m.value.date[0]+"~"+m.value.date[1]),await n.push({query:{...l.query,date:I,problem_id:m.value.problemId,page:1,page_size:b.value.defaultPageSize}})},d=async()=>{m.value.date=[],m.value.problemId="",await n.push({query:{...l.query,date:"",problem_id:"",page:1,page_size:b.value.defaultPageSize}})},U=I=>{I&&n.push({name:"problem-list",query:{...l.query,title:"",tag:I.name,page:1,page_size:b.value.defaultPageSize}})},x=()=>{n.push({name:"manage-problem-daily-create"})},h=async(I,k)=>{p.value=!0;try{const{current:L,pageSize:$}=I;let D="";m.value.date[0]&&(D=m.value.date[0]);let C="";m.value.date[1]&&(C=m.value.date[1]);const M=await pn(D,C,m.value.problemId,L,$);if(c.value=[],M.code===0){const R=M.data.list;if(!R||R.length<=0){b.value={...b.value,total:0},f={},he(u,"未找到记录");return}P={},M.data.tags&&M.data.tags.forEach(H=>{P[H.id]=H}),R.forEach(H=>{var se;const Y=Ta(H,P);(se=c.value)==null||se.push(Y)}),b.value={...b.value,total:M.data.total_count},f=M.data.attempt_status}else k&&N(u,M.code)}catch(L){console.error(L),N(u,qe())}finally{p.value=!1}},A=async I=>{await n.push({query:{...l.query,page:I.current,page_size:I.pageSize}})};return me(async()=>{w=!0,p.value=!0,g=je(()=>l.query,I=>{if(!w)return;if(m.value.date=[],I.date){const $=I.date.split("~");$.length===2&&(m.value.date=[$[0],$[1]])}m.value.problemId=I.problem_id||"";const k=parseInt(I.page)||b.value.defaultCurrent,L=parseInt(I.page_size)||b.value.defaultPageSize;S=k,y=L,b.value={...b.value,current:S,pageSize:y},h({current:S,pageSize:y},!0)},{immediate:!0})}),Te(()=>{w=!1,g&&g()}),(I,k)=>{const L=ze,$=be,D=Pe,C=B,M=we,R=Ft,H=Ue,Y=$e,se=Le,K=Ie;return j(),E(K,null,{default:a(()=>[t(D,{span:9},{default:a(()=>[t($,{style:{margin:"10px"}},{default:a(()=>[t(L,{data:c.value,columns:T.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:b.value,"table-layout":"auto",loading:p.value,onPageChange:A},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(D,{span:3},{default:a(()=>[z("div",Do,[o.value?(j(),te("div",jo,[t(M,null,{default:a(()=>[t(C,{onClick:x},{default:a(()=>k[2]||(k[2]=[V("新建")])),_:1})]),_:1})])):ae("",!0),t($,{class:"sh-card"},{default:a(()=>[t(se,{model:m.value,onSubmit:r,onReset:d},{default:a(()=>[t(H,{label:"日期","label-align":"top"},{default:a(()=>[t(R,{modelValue:m.value.date,"onUpdate:modelValue":k[0]||(k[0]=ee=>m.value.date=ee),"allow-input":"",clearable:"",format:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(H,{label:"问题","label-align":"top"},{default:a(()=>[t(Y,{modelValue:m.value.problemId,"onUpdate:modelValue":k[1]||(k[1]=ee=>m.value.problemId=ee),placeholder:"请输入问题ID",clearable:""},null,8,["modelValue"])]),_:1}),t(H,{"label-align":"top"},{default:a(()=>[t(M,null,{default:a(()=>[t(C,{theme:"primary",type:"submit"},{default:a(()=>k[3]||(k[3]=[V("搜索")])),_:1}),t(C,{theme:"danger",type:"reset"},{default:a(()=>k[4]||(k[4]=[V("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t($,{class:"sh-card",header:"每日一题","header-bordered":!0},{default:a(()=>k[5]||(k[5]=[z("p",null,"由管理员团队精选的题目，每日0点更新。",-1),z("p",null,"当日下午6点提供题解，次日提供AC代码。",-1)])),_:1})])]),_:1})]),_:1})}}}),$o=ce(Uo,[["__scopeId","data-v-5e0bb3cc"]]),zo={style:{margin:"10px"}},Ao={style:{margin:"12px"}},Ro={class:"dida-edit-container"},Mo=ie({__name:"ProblemDailyEdit",setup(e){let l=ke();const{globalProperties:n}=pe();let u=null;const s=i(""),w=i(!1),g=i(!1),P=i(null),f=i({date:"",problemId:"",solution:"",code:""}),o=()=>{X.push({name:"problem-daily-detail",params:{dailyId:s.value}})};async function T(m,_){g.value=!0,await xt(m,_,n,()=>yn(s.value)),g.value=!1}const p=async()=>{g.value=!0;try{const m=f.value.date,_=await _n(m,f.value.problemId,f.value.solution,f.value.code);if(g.value=!0,_.code!==0){N(n,_.code);return}await X.push({name:"manage-problem-daily",params:{dailyId:m}}),He(n,"创建成功")}finally{g.value=!1}},S=async()=>{g.value=!0;try{const m=await gn(s.value,f.value.problemId,f.value.solution,f.value.code);if(g.value=!0,m.code!==0){N(n,m.code);return}P.value&&(m.data.update_time!=null&&(P.value.updateTime=new Date(m.data.update_time).toLocaleString()),m.data.updater_nickname!=null&&(P.value.updaterNickname=m.data.updater_nickname)),m.data.solution!=null&&(f.value.solution=m.data.solution),m.data.code!=null&&(f.value.code=m.data.code),He(n,"保存成功")}finally{g.value=!1}},y=m=>{f.value.solution=m,w.value=!1},b=m=>{f.value.code=m,w.value=!1},c=async()=>{const m=await dn(s.value);if(m.code!==0){N(n,m.code),console.error("problem get failed",m.code),await X.push({name:"problem"});return}const _=m.data;P.value=Ta(_,{}),f.value.problemId=_.problem_id,y(_.solution),b(_.code)};return me(async()=>{u=je(()=>l.params,async()=>{Array.isArray(l.params.dailyId)?s.value=l.params.dailyId[0]:s.value=l.params.dailyId,s.value?(w.value=!0,f.value.date=s.value,await c()):(y("暂无题解"),b("暂无标程"))},{immediate:!0})}),Te(()=>{u&&(u(),u=null)}),(m,_)=>{const v=It,r=hl,d=Ue,U=$e,x=Le,h=be,A=Pe,I=B,k=we,L=We,$=Je,D=Ie,C=Fe("md-editor-v3"),M=Ve;return j(),E(M,{loading:w.value},{default:a(()=>[t(D,null,{default:a(()=>[t(A,{span:8},{default:a(()=>[z("div",zo,[t(v,{theme:"info"},{default:a(()=>_[4]||(_[4]=[V("可以提前配置将来日期的题目，对外仅展示到截止到当天的题目")])),_:1}),t(h,{class:"sh-form-card"},{default:a(()=>[t(x,{model:f.value},{default:a(()=>[t(d,{label:"日期"},{default:a(()=>[t(r,{modelValue:f.value.date,"onUpdate:modelValue":_[0]||(_[0]=R=>f.value.date=R),disabled:s.value&&!0},null,8,["modelValue","disabled"])]),_:1}),t(d,{label:"问题ID"},{default:a(()=>[t(U,{modelValue:f.value.problemId,"onUpdate:modelValue":_[1]||(_[1]=R=>f.value.problemId=R),placeholder:"问题标题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(A,{span:4},{default:a(()=>[z("div",Ao,[z("div",Ro,[s.value?(j(),E(k,{key:0},{default:a(()=>[t(I,{onClick:S,theme:"danger",loading:g.value},{default:a(()=>_[5]||(_[5]=[V("保存")])),_:1},8,["loading"]),t(I,{onClick:o},{default:a(()=>_[6]||(_[6]=[V("查看")])),_:1})]),_:1})):(j(),E(k,{key:1},{default:a(()=>[t(I,{onClick:p,theme:"danger",loading:g.value},{default:a(()=>_[7]||(_[7]=[V("创建")])),_:1},8,["loading"])]),_:1}))]),s.value?(j(),E($,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(L,{label:"创建时间"},{default:a(()=>{var R;return[V(q((R=P.value)==null?void 0:R.createTime),1)]}),_:1}),t(L,{label:"更新时间"},{default:a(()=>{var R;return[V(q((R=P.value)==null?void 0:R.updateTime),1)]}),_:1}),t(L,{label:"创建用户"},{default:a(()=>{var R;return[V(q((R=P.value)==null?void 0:R.creatorNickname),1)]}),_:1}),t(L,{label:"更新用户"},{default:a(()=>{var R;return[V(q((R=P.value)==null?void 0:R.updaterNickname),1)]}),_:1})]),_:1})):ae("",!0)])]),_:1})]),_:1}),z("div",null,[_[8]||(_[8]=z("p",{style:{"margin-left":"20px"}},"题解：",-1)),t(M,{loading:g.value},{default:a(()=>[t(C,{modelValue:f.value.solution,"onUpdate:modelValue":_[2]||(_[2]=R=>f.value.solution=R),onSave:S,onOnUploadImg:T,previewTheme:"cyanosis"},null,8,["modelValue"])]),_:1},8,["loading"])]),z("div",null,[_[9]||(_[9]=z("p",{style:{"margin-left":"20px"}},"标程：",-1)),t(M,{loading:g.value},{default:a(()=>[t(C,{modelValue:f.value.code,"onUpdate:modelValue":_[3]||(_[3]=R=>f.value.code=R),onSave:S,onOnUploadImg:T,previewTheme:"cyanosis"},null,8,["modelValue"])]),_:1},8,["loading"])])]),_:1},8,["loading"])}}}),ta=ce(Mo,[["__scopeId","data-v-067615b5"]]),Eo={style:{margin:"10px"}};function qo(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const Ko=ie({__name:"ProblemRecommend",setup(e){const l=ke(),n=Be(),{globalProperties:u}=pe();let s=null,w="",g={},P={};const f=i([{title:"ID",colKey:"id",cell:(c,m)=>{let _=S(m.row.id);return t(B,{variant:"dashed",theme:_,onClick:()=>p(m.row.id)},{default:()=>[m.row.id]})}},{title:"标题",colKey:"title",cell:(c,m)=>t(B,{variant:"text",onClick:()=>p(m.row.id)},{default:()=>[m.row.title]})},{title:"标签",colKey:"tags",cell:(c,m)=>{const _=m.row.tags;if(!_||_.length===0)return"";let v=[];for(let r=0;r<_.length;r++){const d=_[r];v.push(t(B,{key:r,theme:"default",variant:"outline",size:"small",onClick:()=>y(d)},{default:()=>[d.name]}))}return t(we,null,qo(v)?v:{default:()=>[v]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),o=i(!1),T=i(),p=c=>{c&&n.push({path:"/problem/"+c})},S=c=>{if(!c||!P)return"default";const m=P[c];if(!m)return"default";switch(m){case Oe.Accept:return"success";case Oe.Attempt:return"warning";default:return"default"}},y=c=>{c&&n.push({name:"problem-list",query:{tag:c.name}})},b=async c=>{o.value=!0;try{const m=await un(w);if(T.value=[],m.code===0){const _=m.data.list;if(!_||_.length<=0){he(u,"暂无推荐题目");return}g={},m.data.tags&&m.data.tags.forEach(v=>{g[v.id]=v}),_.forEach(v=>{var d;const r=vt(v,g);(d=T.value)==null||d.push(r)})}else c&&N(u,m.code)}catch(m){console.error(m),N(u,qe())}finally{o.value=!1}};return me(async()=>{o.value=!0,s=je(()=>l.query,c=>{Array.isArray(l.params.problemId)?w=l.params.problemId[0]:w=l.params.problemId,b(!0)},{immediate:!0})}),Te(()=>{s&&s()}),(c,m)=>{const _=ze,v=be,r=Pe,d=Ie;return j(),E(d,null,{default:a(()=>[t(r,{span:9},{default:a(()=>[t(v,{style:{margin:"10px"}},{default:a(()=>[t(_,{data:T.value,columns:f.value,"row-key":"id","vertical-align":"top",hover:!0,"table-layout":"auto",loading:o.value},null,8,["data","columns","loading"])]),_:1})]),_:1}),t(r,{span:3},{default:a(()=>[z("div",Eo,[t(v,{class:"sh-card",header:"题目推荐","header-bordered":!0},{default:a(()=>m[0]||(m[0]=[V(" 根据本站其他用户的提交记录推荐类似题目"),z("br",null,null,-1),V("依据推荐算法来计算，与本用户相似度最高的用户做的题，大概率被自己感兴趣。 ")])),_:1})])]),_:1})]),_:1})}}}),Fo=ce(Ko,[["__scopeId","data-v-77972e8b"]]),Oo={style:{margin:"10px"}},No={key:1},Go={style:{margin:"12px"}},Ho={class:"dida-edit-container"},Bo={class:"dida-description-editor"},Jo=ie({__name:"ProblemEdit",setup(e){let l=ke();const{globalProperties:n}=pe(),u=Ye(),s=i(""),w=i(!1),g=i(!1),P=i(!1),f=i(null),o=i({title:"",timeLimit:0,memoryLimit:0,source:"",private:!0,tags:[],description:""}),T=i([]),p=i([]),S=Ge(()=>{const x=[],h=T.value;for(let A=0,I=h.length;A<I;A++)h[A].value&&x.push(h[A].value);return x}),y=(x,h)=>{const{trigger:A,index:I,item:k}=h;if(A==="clear"&&(T.value=[]),["tag-remove","backspace"].includes(A)&&T.value.splice(I,1),A==="enter"){for(let $=0;$<p.value.length;$++){const D=p.value[$];if(D.label===k){for(let C=0;C<T.value.length;C++)if(T.value[C].label===D.label)return;T.value.push(D);return}}const L={label:k,value:k};T.value.push(L),p.value=p.value.concat(L)}},b=(x,{current:h,type:A})=>{if(!h){T.value=A==="check"?p.value.slice(1):[];return}if(A==="check"){const I=p.value.find(k=>k.value===h);if(!I)return;T.value.push(I)}else T.value=T.value.filter(I=>I.value!==h)},c=()=>{X.push({name:"problem-detail",params:{problemId:s.value}})},m=()=>{X.push({name:"manage-problem-judge",params:{problemId:s.value}})},_=async(x,h)=>{P.value=!0,await xt(x,h,n,()=>hn(s.value)),P.value=!1},v=async()=>{g.value=!0,o.value.tags=[];for(let x=0;x<T.value.length;x++){const h=T.value[x];h&&h.label&&o.value.tags.push(h.label)}try{const x=await fn(o.value.title,o.value.timeLimit,o.value.memoryLimit,o.value.source,o.value.private,o.value.tags,o.value.description);if(g.value=!0,x.code!==0){N(n,x.code);return}x.data!=null&&await X.push({name:"problem-detail",params:{problemId:x.data}}),He(n,"创建成功")}finally{g.value=!1}},r=async()=>{g.value=!0,o.value.tags=[];for(let x=0;x<T.value.length;x++){const h=T.value[x];h&&h.label&&o.value.tags.push(h.label)}try{const x=await vn(s.value,o.value.title,o.value.timeLimit,o.value.memoryLimit,o.value.source,o.value.private,o.value.tags,o.value.description);if(g.value=!0,x.code!==0){N(n,x.code);return}f.value&&x.data.update_time!=null&&(f.value.updateTime=new Date(x.data.update_time).toLocaleString()),x.data.description!=null&&(o.value.description=x.data.description),He(n,"保存成功")}finally{g.value=!1}},d=x=>{o.value.description=x,w.value=!1},U=async()=>{const x=await Da(s.value,void 0,void 0);if(x.code!==0){N(n,x.code),console.error("problem get failed",x.code),await X.push({name:"problem"});return}const h=x.data.problem;if(f.value=vt(h,{}),o.value.title=h.title,o.value.timeLimit=h.time_limit,o.value.memoryLimit=h.memory_limit,o.value.source=h.source,o.value.private=h.private,o.value.tags=[],T.value=[],x.data.tags)for(let I=0;I<x.data.tags.length;I++){const k=x.data.tags[I];k&&k.name&&(o.value.tags.push(k.name),T.value.push({label:k.name,value:k.id}))}u.setTitle(h.title+" - "+u.getTitle);let A=h.description;d(A)};return me(async()=>{Array.isArray(l.params.problemId)?s.value=l.params.problemId[0]:s.value=l.params.problemId,s.value?(w.value=!0,ja(-1).then(async x=>{x.code===0?(x.data.list&&x.data.list.forEach(h=>{p.value.push({label:h.name,value:h.id})}),await U()):(N(n,x.code),console.error("problem tag get failed",x.code),await X.push({name:"problem"}))}).catch(async x=>{console.error(x),N(n,"获取数据异常"),await X.push({name:"problem"})})):(o.value.timeLimit=1e3,o.value.memoryLimit=65536,d(""))}),(x,h)=>{const A=$e,I=Ue,k=ga,L=ft,$=wl,D=yl,C=Le,M=be,R=Pe,H=B,Y=we,se=We,K=Je,ee=Ie,Z=Fe("md-editor-v3"),re=Ve;return j(),E(re,{loading:w.value},{default:a(()=>[t(ee,null,{default:a(()=>[t(R,{span:8},{default:a(()=>[z("div",Oo,[t(M,{class:"sh-card"},{default:a(()=>[t(C,{model:o.value},{default:a(()=>[t(I,{label:"标题"},{default:a(()=>[t(A,{modelValue:o.value.title,"onUpdate:modelValue":h[0]||(h[0]=ne=>o.value.title=ne),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),t(I,{label:"时间限制"},{default:a(()=>[t(k,{modelValue:o.value.timeLimit,"onUpdate:modelValue":h[1]||(h[1]=ne=>o.value.timeLimit=ne),theme:"normal",min:0},{suffix:a(()=>h[6]||(h[6]=[z("span",null,"ms",-1)])),_:1},8,["modelValue"])]),_:1}),t(I,{label:"内存限制"},{default:a(()=>[t(k,{modelValue:o.value.memoryLimit,"onUpdate:modelValue":h[2]||(h[2]=ne=>o.value.memoryLimit=ne),theme:"normal",min:0},{suffix:a(()=>h[7]||(h[7]=[z("span",null,"KB",-1)])),_:1},8,["modelValue"])]),_:1}),t(I,{label:"来源"},{default:a(()=>[t(A,{modelValue:o.value.source,"onUpdate:modelValue":h[3]||(h[3]=ne=>o.value.source=ne),placeholder:"请输入题目来源"},null,8,["modelValue"])]),_:1}),t(I,{label:"私有"},{default:a(()=>[t(L,{modelValue:o.value.private,"onUpdate:modelValue":h[4]||(h[4]=ne=>o.value.private=ne)},null,8,["modelValue"])]),_:1}),t(I,{label:"标签"},{default:a(()=>[t(D,{value:T.value,"allow-input":!0,placeholder:"请选择或输入","tag-input-props":{excessTagsDisplayType:"break-line"},"popup-props":{overlayInnerClassName:["narrow-scrollbar"],overlayInnerStyle:{maxHeight:"280px",overflowY:"auto",overscrollBehavior:"contain",padding:"6px"}},clearable:"",multiple:"",onTagChange:y},{panel:a(()=>[p.value.length?(j(),E($,{key:0,value:S.value,options:p.value,onChange:b},null,8,["value","options"])):(j(),te("div",No,"暂无数据"))]),suffixIcon:a(()=>[t(de(tl))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(R,{span:4},{default:a(()=>[z("div",Go,[z("div",Ho,[s.value?(j(),E(Y,{key:0},{default:a(()=>[t(H,{onClick:r,theme:"danger",loading:g.value},{default:a(()=>h[8]||(h[8]=[V("保存")])),_:1},8,["loading"]),t(H,{onClick:m,theme:"warning"},{default:a(()=>h[9]||(h[9]=[V("判题数据")])),_:1}),t(H,{onClick:c},{default:a(()=>h[10]||(h[10]=[V("查看")])),_:1})]),_:1})):(j(),E(Y,{key:1},{default:a(()=>[t(H,{onClick:v,theme:"danger",loading:g.value},{default:a(()=>h[11]||(h[11]=[V("创建")])),_:1},8,["loading"])]),_:1}))]),s.value?(j(),E(K,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(se,{label:"创建时间"},{default:a(()=>{var ne;return[V(q((ne=f.value)==null?void 0:ne.insertTime),1)]}),_:1}),t(se,{label:"更新时间"},{default:a(()=>{var ne;return[V(q((ne=f.value)==null?void 0:ne.updateTime),1)]}),_:1}),t(se,{label:"判题方式"},{default:a(()=>{var ne;return[V(q((ne=f.value)==null?void 0:ne.judgeType),1)]}),_:1}),t(se,{label:"上传用户"},{default:a(()=>{var ne;return[V(q((ne=f.value)==null?void 0:ne.creatorNickname),1)]}),_:1})]),_:1})):ae("",!0)])]),_:1})]),_:1}),z("div",Bo,[h[12]||(h[12]=z("p",null,"题目描述",-1)),t(re,{loading:P.value||g.value},{default:a(()=>[t(Z,{modelValue:o.value.description,"onUpdate:modelValue":h[5]||(h[5]=ne=>o.value.description=ne),onSave:r,onOnUploadImg:_,previewTheme:"cyanosis"},null,8,["modelValue"])]),_:1},8,["loading"])])]),_:1},8,["loading"])}}}),aa=ce(Jo,[["__scopeId","data-v-e72878e1"]]),Wo={style:{margin:"10px"}},Yo={style:{margin:"12px"}},Xo={class:"dida-edit-container"},Zo=ie({__name:"ProblemJudge",setup(e){let l=ke();const{globalProperties:n}=pe(),u=Ye(),s=i(""),w=i(!1),g=i(null);let P=null;const f=i(null),o=i(""),T=i(!1),p=i(!1),S=i([{title:"文件",colKey:"file"},{title:"大小",colKey:"size",width:150,cell:(k,L)=>L.row.size.toFixed(0)+" B"},{title:"最后修改时间",colKey:"lastModified",width:180,cell:(k,L)=>new Date(L.row.lastModified).toLocaleString()},{title:"操作",colKey:"action",width:100,cell:(k,L)=>t(B,{onClick:()=>v(L.row.file)},{default:()=>[V("下载")]})}]),y=i([]),b=Ge(()=>({border:"2px dashed #ccc",borderRadius:"6px",padding:"20px",textAlign:"center",cursor:"pointer",backgroundColor:T.value?"#f0f9ff":"#fff",transition:"background-color 0.2s ease"})),c=Ge(()=>o.value?`已选择：${o.value}`:T.value?"松开文件以上传":"拖拽判题数据压缩包到这里，或点击选择文件"),m=()=>{X.push({name:"problem-detail",params:{problemId:s.value}})},_=()=>{X.push({name:"manage-problem",params:{problemId:s.value}})},v=async k=>{const L=await bn(s.value,k);if(L.code!==0){N(n,L.code);return}const $=document.createElement("a");$.href=L.data,$.target="_blank",$.click(),URL.revokeObjectURL($.href)},r=async()=>{if(!P){_e(n,"请选择压缩包");return}p.value=!0,wn(s.value,P).then(async k=>{k.code==0?(f.value.value=null,P=null,o.value="",w.value=!0,He(n,"上传成功"),await I()):N(n,k.code)}).catch(k=>{console.log(k),n.$message.error({duration:3e3,content:"申请失败"})}).finally(()=>{p.value=!1})},d=()=>{var k;(k=f.value)==null||k.click()},U=k=>{const L=k.target.files[0];L&&(o.value=L.name,P=L)},x=k=>{T.value=!0},h=()=>{T.value=!1},A=k=>{k.preventDefault(),k.stopPropagation(),T.value=!1;const L=k.dataTransfer.files[0];if(L){o.value=L.name;const $=new DataTransfer;$.items.add(L),f.value.files=$.files,P=L}},I=async()=>{const k=await sn(s.value);if(k.code!==0){N(n,k.code),await X.push({name:"problem"});return}const L=k.data.problem;g.value=vt(L,{}),u.setTitle(L.title+" - "+u.getTitle),y.value=[],k.data.judges?k.data.judges.forEach($=>{y.value.push({file:$.key,size:$.size,lastModified:$.last_modified})}):_e(n,"评测数据不存在"),w.value=!1};return me(async()=>{if(Array.isArray(l.params.problemId)?s.value=l.params.problemId[0]:s.value=l.params.problemId,!s.value){_e(n,"题目不存在"),await X.push({name:"problem"});return}w.value=!0,await I()}),(k,L)=>{const $=ze,D=Pe,C=B,M=we,R=We,H=Je,Y=Ie,se=Ve;return j(),E(se,{loading:w.value},{default:a(()=>[t(Y,null,{default:a(()=>[t(D,{span:7},{default:a(()=>[z("div",Wo,[z("div",{id:"drop-zone",style:fa(b.value),onClick:d,onDragenter:yt(x,["prevent"]),onDragover:L[0]||(L[0]=yt(()=>{},["prevent"])),onDragleave:yt(h,["prevent"]),onDrop:A},[z("input",{ref_key:"fileInput",ref:f,type:"file",style:{display:"none"},onChange:U},null,544),V(" "+q(c.value),1)],36)]),t($,{data:y.value,columns:S.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1}),t(D,{span:5},{default:a(()=>[z("div",Yo,[z("div",Xo,[t(M,null,{default:a(()=>[t(C,{onClick:r,theme:"danger",loading:p.value},{default:a(()=>L[1]||(L[1]=[V("上传")])),_:1},8,["loading"]),t(C,{onClick:_,theme:"warning"},{default:a(()=>L[2]||(L[2]=[V("编辑")])),_:1}),t(C,{onClick:m},{default:a(()=>L[3]||(L[3]=[V("查看")])),_:1})]),_:1})]),t(H,{layout:"vertical",bordered:!0},{default:a(()=>[t(R,{label:"标题"},{default:a(()=>{var K;return[V(q((K=g.value)==null?void 0:K.title),1)]}),_:1}),t(R,{label:"创建时间"},{default:a(()=>{var K;return[V(q((K=g.value)==null?void 0:K.insertTime),1)]}),_:1}),t(R,{label:"更新时间"},{default:a(()=>{var K;return[V(q((K=g.value)==null?void 0:K.updateTime),1)]}),_:1}),t(R,{label:"判题方式"},{default:a(()=>{var K;return[V(q((K=g.value)==null?void 0:K.judgeType),1)]}),_:1}),t(R,{label:"评测数据"},{default:a(()=>{var K;return[V(q((K=g.value)==null?void 0:K.judgeMd5),1)]}),_:1}),t(R,{label:"上传用户"},{default:a(()=>{var K;return[V(q((K=g.value)==null?void 0:K.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Qo=ce(Zo,[["__scopeId","data-v-12b13fb1"]]);function Jt(e){const l={};return l.id=e.id,l.ownerId=e.owner_id,l.ownerUsername=e.owner_username,l.ownerNickname=e.owner_nickname,l.title=e.title,e.start_time?l.startTime=new Date(e.start_time).toLocaleString():l.startTime="无限制",e.end_time?l.endTime=new Date(e.end_time).toLocaleString():l.endTime="无限制",e.update_time?l.updateTime=new Date(e.update_time).toLocaleString():l.updateTime="",e.create_time?l.createTime=new Date(e.create_time).toLocaleString():l.createTime="",e.description?l.description=e.description:l.description="",l.problems=e.problems,l}function es(e){return W({url:"/collection?id="+e,method:"get"})}function ts(e){return W({url:"/collection/edit?id="+e,method:"get"})}function as(e,l){return W({url:"/collection/list?page="+e+"&page_size="+l,method:"get"})}function ls(e){return W({url:"/collection/rank?id="+e,method:"get"})}function ns(e){return W({url:"/collection/create",method:"post",data:e})}function os(e){return W({url:"/collection/edit",method:"post",data:e})}function ss(e){return W({url:"/collection/join",method:"post",data:{id:e}})}function rs(e){return W({url:"/collection/quit",method:"post",data:{id:e}})}const us={style:{margin:"10px"}},is=ie({__name:"CollectionList",setup(e){const l=ke(),n=Be(),{globalProperties:u}=pe();let s=null;i(!1),i(!1);const w=i([{title:"ID",colKey:"id",width:"100",cell:(_,v)=>t(B,{variant:"text",onClick:()=>S(v.row.id)},{default:()=>[v.row.id]})},{title:"标题",colKey:"title",cell:(_,v)=>t(B,{variant:"text",onClick:()=>S(v.row.id)},{default:()=>[v.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),g=i(!1);let P=1,f=50;const o=i({current:P,pageSize:f,defaultCurrent:P,defaultPageSize:f,total:0,pageSizeOptions:[50,100]}),T=i(),p=i({title:"",username:""});i({title:"",description:"",open_time:[]});const S=_=>{_&&n.push({path:"/collection/"+_})},y=async()=>{await n.push({query:{...l.query,title:p.value.title,username:p.value.username,page:1,page_size:o.value.defaultPageSize}})},b=async(_,v)=>{var r;g.value=!0;try{const{current:d,pageSize:U}=_,x=await as(d,U);if(T.value=[],x.code===0){const h=x.data.list;for(let A=0;A<h.length;A++){const I=h[A],k=Jt(I);(r=T.value)==null||r.push(k)}o.value={...o.value,total:x.data.total_count}}else v&&N(u,x.code)}catch(d){console.error(d),N(u,qe())}finally{g.value=!1}},c=async _=>{await n.push({query:{...l.query,page:_.current,page_size:_.pageSize}})},m=async()=>{await n.push({name:"collection-create"})};return me(async()=>{s=je(()=>l.query,_=>{p.value.title=_.title||"",p.value.username=_.username||"";const v=parseInt(_.page)||o.value.defaultCurrent,r=parseInt(_.page_size)||o.value.defaultPageSize;P=v,f=r,o.value={...o.value,current:P,pageSize:f},b({current:P,pageSize:f},!0)},{immediate:!0})}),Te(()=>{s&&s()}),(_,v)=>{const r=ze,d=be,U=Pe,x=$e,h=Ue,A=B,I=Le,k=we,L=Ie;return j(),E(L,null,{default:a(()=>[t(U,{span:9},{default:a(()=>[t(d,{style:{margin:"10px"}},{default:a(()=>[t(r,{data:T.value,columns:w.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:o.value,loading:g.value,onPageChange:c},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(U,{span:3},{default:a(()=>[z("div",us,[t(d,{class:"sh-card"},{default:a(()=>[t(I,{model:p.value},{default:a(()=>[t(h,{label:"标题"},{default:a(()=>[t(x,{modelValue:p.value.title,"onUpdate:modelValue":v[0]||(v[0]=$=>p.value.title=$),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(h,{label:"负责人"},{default:a(()=>[t(x,{modelValue:p.value.username,"onUpdate:modelValue":v[1]||(v[1]=$=>p.value.username=$),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(h,null,{default:a(()=>[t(A,{theme:"primary",onClick:y},{default:a(()=>v[2]||(v[2]=[V("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(d,{class:"sh-card"},{default:a(()=>[t(k,null,{default:a(()=>[t(A,{onClick:m},{default:a(()=>v[3]||(v[3]=[V("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),cs=ce(is,[["__scopeId","data-v-3c9d295e"]]),ds={style:{margin:"20px"}},ms={class:"dida-operation-container"},ps={style:{margin:"12px"}},fs=ie({__name:"CollectionDetail",setup(e){let l=ke();const{globalProperties:n}=pe(),u=Ye(),s=Me();let w=0;const g=i(!1),P=i(null),f=i(!1),o=i(!1);let T={};const p=Ge(()=>s.hasAuth(De.ManageCollection)||P.value&&s.getUserId==P.value.ownerId),S=v=>{if(!v||!T)return"default";const r=T[v];if(!r)return"default";switch(r){case Oe.Accept:return"success";case Oe.Attempt:return"warning";default:return"default"}},y=i([{title:"问题ID",colKey:"id",cell:(v,r)=>{const d=S(r.row.id);return t(B,{variant:"dashed",theme:d,onClick:()=>Qt(r.row.id)},{default:()=>[r.row.id]})}},{title:"标题",colKey:"title",cell:(v,r)=>t(B,{variant:"text",onClick:()=>Qt(r.row.id)},{default:()=>[r.row.title]})},{title:"正确",colKey:"accept",cell:(v,r)=>r.row.accept?r.row.accept:0},{title:"提交",colKey:"attempt",cell:(v,r)=>r.row.attempt?r.row.attempt:0}]),b=i([]),c=async()=>{if(!s.isLogin()){await X.push({name:"login"});return}o.value=!0;try{const v=await ss(w);if(v.code!==0){N(n,v.code);return}f.value=!0,He(n,"加入成功")}finally{o.value=!1}},m=async()=>{if(!s.isLogin()){await X.push({name:"login"});return}o.value=!0;try{const v=await rs(w);if(v.code!==0){N(n,v.code);return}f.value=!1,He(n,"退出成功")}finally{o.value=!1}},_=()=>{P.value&&X.push({name:"collection-edit",params:{collectionId:P.value.id}})};return me(async()=>{if(Array.isArray(l.params.collectionId)?w=Number(l.params.collectionId[0]):w=Number(l.params.collectionId),!w){await X.push({name:"problem-collection-list"});return}f.value=!1,g.value=!0;const v=await es(w);if(v.code!==0){g.value=!1,N(n,v.code),await X.push({name:"problem-collection-list"});return}f.value=v.data.joined,T=v.data.attempt_status||{},P.value=Jt(v.data.collection),b.value=[],v.data.collection.problems&&v.data.collection.problems.forEach(r=>{const d=v.data.problems.find(U=>U.id===r);b.value.push(d)}),u.setTitle(P.value.title+" - "+u.getTitle),g.value=!1}),(v,r)=>{const d=ha,U=ba,x=ze,h=be,A=Pe,I=B,k=we,L=We,$=Je,D=Fe("md-preview"),C=Ie,M=Ve;return j(),E(M,{loading:g.value},{default:a(()=>[t(C,{class:"dida-main-content"},{default:a(()=>[t(A,{span:6},{default:a(()=>[z("div",ds,[t(U,{"max-item-width":"300"},{default:a(()=>[t(d,{to:{name:"problem-collection-list"}},{default:a(()=>r[0]||(r[0]=[V("题目集合")])),_:1}),t(d,null,{default:a(()=>{var R;return[V(q((R=P.value)==null?void 0:R.title),1)]}),_:1})]),_:1})]),t(h,{style:{margin:"10px"}},{default:a(()=>[t(x,{data:b.value,columns:y.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),_:1})]),_:1}),t(A,{span:6},{default:a(()=>{var R;return[z("div",ms,[t(k,null,{default:a(()=>[f.value?(j(),E(I,{key:0,onClick:m,loading:o.value},{default:a(()=>r[1]||(r[1]=[V("退出")])),_:1},8,["loading"])):(j(),E(I,{key:1,onClick:c,loading:o.value},{default:a(()=>r[2]||(r[2]=[V("加入")])),_:1},8,["loading"])),p.value?(j(),E(I,{key:2,onClick:_},{default:a(()=>r[3]||(r[3]=[V("编辑")])),_:1})):ae("",!0)]),_:1})]),z("div",ps,[t($,{layout:"vertical",bordered:!0},{default:a(()=>[t(L,{label:"创建者"},{default:a(()=>{var H;return[V(q((H=P.value)==null?void 0:H.ownerNickname),1)]}),_:1})]),_:1}),t($,{layout:"vertical",bordered:!0},{default:a(()=>[t(L,{label:"开始时间"},{default:a(()=>{var H;return[V(q((H=P.value)==null?void 0:H.startTime),1)]}),_:1})]),_:1}),t($,{layout:"vertical",bordered:!0},{default:a(()=>[t(L,{label:"结束时间"},{default:a(()=>{var H;return[V(q((H=P.value)==null?void 0:H.endTime),1)]}),_:1})]),_:1})]),(R=P.value)!=null&&R.description?(j(),E(h,{key:0,style:{margin:"10px"}},{default:a(()=>{var H;return[t(D,{"model-value":(H=P.value)==null?void 0:H.description},null,8,["model-value"])]}),_:1})):ae("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),vs=ce(fs,[["__scopeId","data-v-042bd4bb"]]),_s=ie({__name:"CollectionRank",setup(e){const l=ke(),n=Be(),{globalProperties:u}=pe();let s=null,w=0,g=0;const P=i([{title:"Rank",colKey:"rank",align:"center"},{title:"序号",colKey:"index",align:"center"},{title:"Username",colKey:"username",cell:(S,y)=>t(B,{variant:"text",onClick:()=>n.push({name:"user",params:{username:y.row.username}})},{default:()=>[y.row.username]})},{title:"昵称",colKey:"nickname",cell:(S,y)=>t(B,{variant:"text",onClick:()=>n.push({name:"user",params:{username:y.row.username}})},{default:()=>[y.row.nickname]})},{title:"Count",colKey:"count",cell:(S,y)=>t(B,{variant:"text",onClick:()=>n.push({name:"judge-list",query:{username:y.row.username,status:Ke.Accept}})},{default:()=>[`${y.row.accept} / ${g}`]})},{title:"Progress",colKey:"progress",cell:(S,y)=>{let b=100;return g>0&&(b=Number((y.row.accept/g*100).toFixed(2))),t(qt,{percentage:b},null)}}]),f=i(!1),o=i([]),T=({col:S,rowIndex:y})=>{let b=1;for(let c=y+1;c<o.value.length&&o.value[c].rank===o.value[y].rank;c++)b++;if(S.colKey==="rank")return{rowspan:b}},p=async S=>{f.value=!0;try{const y=await ls(w);if(o.value=[],y.code===0){g=y.data.problem;const b=y.data.ranks,c=[];if(b){for(let v=0;v<b.length;v++){const r=b[v];let d={userId:r.author_id,username:r.author_username,nickname:r.author_nickname};d.accept=r.accept,c.push(d)}c.sort((v,r)=>v.accept!==r.accept?r.accept-v.accept:v.userId-r.userId);let m=0,_=-1;for(let v=0;v<c.length;v++)c[v].accept!==_&&(m=v+1,_=c[v].accept),c[v].index=v+1,c[v].rank=m}o.value=c}else S&&N(u,y.code)}catch(y){console.error(y),N(u,qe())}finally{f.value=!1}};return me(async()=>{s=je(()=>l.query,async()=>{if(Array.isArray(l.params.collectionId)?w=Number(l.params.collectionId[0]):w=Number(l.params.collectionId),!w){await n.push({name:"problem-collection-list"});return}await p(!0)},{immediate:!0})}),Te(()=>{s&&s()}),(S,y)=>{const b=ze,c=be,m=Ie;return j(),E(m,null,{default:a(()=>[t(c,{style:{margin:"10px"}},{default:a(()=>[z("div",null,[t(b,{data:o.value,columns:P.value,"row-key":"index","rowspan-and-colspan":T,"vertical-align":"middle",bordered:!0,hover:!0,loading:f.value},null,8,["data","columns","loading"])])]),_:1})]),_:1})}}});var Re=(e=>(e[e.Valid=0]="Valid",e[e.Duplicate=1]="Duplicate",e[e.Invalid=2]="Invalid",e))(Re||{});const gs={class:"dida-form-border"},bs={style:{"text-align":"right"}},hs=ie({name:"ParseProblemList",__name:"ParseProblemList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:l}=pe(),n=i(!1),u=i(!1),s=i(""),w=va(e,"modelValue");let g=[];je(w,async S=>{JSON.stringify(S)!==JSON.stringify(g)&&(await o(S),g=w.value)},{deep:!0});const P=i([]),f=i([{title:"有效性",colKey:"validType",cell:(S,y)=>{switch(y.row.valid){case Re.Valid:return t(tt,{theme:"success"},{default:()=>[V("有效")]});case Re.Duplicate:return t(tt,{theme:"warning"},{default:()=>[V("重复")]});case Re.Invalid:return t(tt,{theme:"danger"},{default:()=>[V("无效")]});default:return null}}},{title:"问题ID",colKey:"id"},{title:"标题",colKey:"title"}]),o=async S=>{const y=Array.from(new Set(S)),b=await kn(y);if(b.code!==0){N(l,b.code),u.value=!1;return}const c=[],m=b.data.problems;let _=[];S.forEach(v=>{const r=m.find(d=>d.id===v);if(r){const d=c.find(U=>U.id===v);r.valid=d?Re.Duplicate:Re.Valid,c.push({id:v,title:r.title,valid:r.valid}),d||_.push(v)}else c.push({id:v,title:"-",valid:Re.Invalid})}),P.value=c,g=_,w.value=_},T=async()=>{u.value=!0;const S=ka(s.value);await o(S),n.value=!1,u.value=!1},p=()=>{P.value?s.value=P.value.map(S=>S.id).join(`
`):s.value="",n.value=!0};return(S,y)=>{const b=B,c=ze,m=Pt,_=lt;return j(),te(ue,null,[z("div",gs,[z("div",bs,[t(b,{onClick:p},{default:a(()=>y[2]||(y[2]=[V("编辑")])),_:1})]),t(c,{data:P.value,columns:f.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(_,{visible:n.value,"onUpdate:visible":y[1]||(y[1]=v=>n.value=v),onConfirm:T,header:"请输入问题ID","confirm-loading":u.value},{default:a(()=>[y[3]||(y[3]=z("div",{style:{"margin-bottom":"10px"}},[z("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(m,{modelValue:s.value,"onUpdate:modelValue":y[0]||(y[0]=v=>s.value=v),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),za=ce(hs,[["__scopeId","data-v-7f4ce589"]]),ys={class:"dida-form-border"},ws={style:{"text-align":"right"}},ks=ie({name:"ParseUserList",__name:"ParseUserList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:l}=pe(),n=i(!1),u=i(!1),s=i(""),w=va(e,"modelValue");let g=[];je(w,async b=>{JSON.stringify(b)!==JSON.stringify(g)&&(g=b,await T(b))},{deep:!0});const P=i(),f=i([{title:"有效性",colKey:"validType",cell:(b,c)=>{switch(c.row.valid){case Re.Valid:return t(tt,{theme:"success"},{default:()=>[V("有效")]});case Re.Duplicate:return t(tt,{theme:"warning"},{default:()=>[V("重复")]});case Re.Invalid:return t(tt,{theme:"danger"},{default:()=>[V("无效")]})}}},{title:"Username",colKey:"username"},{title:"昵称",colKey:"nickname"}]),o=(b,c)=>{if(b.code!==0){N(l,b.code),u.value=!1;return}const m=[],_=b.data.users;let v=[];c?c.forEach(r=>{let d=null;if(_&&(d=_.find(U=>U.username.toLowerCase()===r.toLowerCase())),d){const U=m.find(h=>h.username.toLowerCase()===r.toLowerCase()),x=U?Re.Duplicate:Re.Valid;m.push({id:d.id,username:d.username,nickname:d.nickname,valid:x}),U||v.push(d.id)}else m.push({id:-1,username:r,nickname:"-",valid:Re.Invalid})}):_&&_.forEach(r=>{const d=m.find(x=>x.id===r.id),U=d?Re.Duplicate:Re.Valid;m.push({id:r.id,username:r.username,nickname:r.nickname,valid:U}),d||v.push(r.id)}),P.value=m,g=v,w.value=v},T=async b=>{const c=Array.from(new Set(b)),m=await $n(c);o(m)},p=async b=>{const c=Array.from(new Set(b)),m=await zn(c);o(m,b)},S=async()=>{u.value=!0;const b=ka(s.value);await p(b),n.value=!1,u.value=!1},y=()=>{P.value?s.value=P.value.map(b=>b.username).join(`
`):s.value="",n.value=!0};return(b,c)=>{const m=B,_=ze,v=Pt,r=lt;return j(),te(ue,null,[z("div",ys,[z("div",ws,[t(m,{onClick:y},{default:a(()=>c[2]||(c[2]=[V("编辑")])),_:1})]),t(_,{data:P.value,columns:f.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(r,{visible:n.value,"onUpdate:visible":c[1]||(c[1]=d=>n.value=d),onConfirm:S,header:"请输入用户Username","confirm-loading":u.value},{default:a(()=>[c[3]||(c[3]=z("div",{style:{"margin-bottom":"10px"}},[z("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(v,{modelValue:s.value,"onUpdate:modelValue":c[0]||(c[0]=d=>s.value=d),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Aa=ce(ks,[["__scopeId","data-v-d2170a86"]]),Cs={style:{margin:"10px"}},Ss={style:{margin:"12px"}},Is={class:"dida-edit-container"},Ps=ie({__name:"CollectionEdit",setup(e){let l=ke();const{globalProperties:n}=pe(),u=Ye(),s=i(""),w=i(!1),g=i(!1),P=i(!1),f=i(null),o=i({title:"",openTime:[],private:!0,problems:[],members:[],description:""}),T=i(""),p=i(""),S=i(!1),y=async()=>{S.value=!0,P.value=!1,S.value=!1},b=async()=>{g.value=!0;try{const r={title:o.value.title,problems:o.value.problems,members:o.value.members,private:o.value.private,description:o.value.description};o.value.openTime[0]&&(r.start_time=new Date(o.value.openTime[0])),o.value.openTime[1]&&(r.end_time=new Date(o.value.openTime[1]));const d=await ns(r);if(d.code!==0){N(n,d.code);return}d.data!=null&&await X.push({name:"collection-detail",params:{collectionId:d.data}}),He(n,"创建成功")}finally{g.value=!1}},c=async()=>{g.value=!0;try{const r={id:Number(s.value),title:o.value.title,private:o.value.private,problems:o.value.problems,members:o.value.members,description:o.value.description};o.value.openTime[0]&&(r.start_time=new Date(o.value.openTime[0])),o.value.openTime[1]&&(r.end_time=new Date(o.value.openTime[1]));const d=await os(r);if(d.code!==0){N(n,d.code);return}d.data!=null&&f.value&&(f.value.updateTime=new Date(d.data).toLocaleString()),He(n,"保存成功")}finally{g.value=!1}},m=r=>{o.value.description=r,w.value=!1};async function _(r,d){g.value=!0,await xt(r,d,n,()=>null),g.value=!1}const v=async()=>{const r=await ts(s.value);if(r.code!==0){N(n,r.code),console.error("collection get failed",r.code),await X.push({name:"problem-collection-list"});return}const d=r.data.collection;f.value=Jt(d),o.value.title=d.title,o.value.openTime=[],d.start_time?o.value.openTime.push(new Date(d.start_time)):o.value.openTime.push(""),d.end_time?o.value.openTime.push(new Date(d.end_time)):o.value.openTime.push(""),o.value.private=d.private,o.value.description=d.description,o.value.problems=d.problems,o.value.members=d.members,u.setTitle(d.title+" - "+u.getTitle);let U="";d.description&&(U=d.description),m(U)};return me(async()=>{Array.isArray(l.params.collectionId)?s.value=l.params.collectionId[0]:s.value=l.params.collectionId,s.value?(w.value=!0,await v()):m("")}),(r,d)=>{const U=$e,x=Ue,h=Ft,A=ft,I=Le,k=be,L=Pe,$=B,D=we,C=We,M=Je,R=Ie,H=Fe("md-editor-v3"),Y=Ve,se=Pt,K=lt;return j(),te(ue,null,[t(Y,{loading:w.value},{default:a(()=>[t(R,null,{default:a(()=>[t(L,{span:8},{default:a(()=>[z("div",Cs,[t(k,{class:"sh-card"},{default:a(()=>[t(I,{model:o.value},{default:a(()=>[t(x,{label:"标题"},{default:a(()=>[t(U,{modelValue:o.value.title,"onUpdate:modelValue":d[0]||(d[0]=ee=>o.value.title=ee),placeholder:"题集标题"},null,8,["modelValue"])]),_:1}),t(x,{label:"开启时间"},{default:a(()=>[t(h,{modelValue:o.value.openTime,"onUpdate:modelValue":d[1]||(d[1]=ee=>o.value.openTime=ee),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(x,{label:"私有"},{default:a(()=>[t(A,{modelValue:o.value.private,"onUpdate:modelValue":d[2]||(d[2]=ee=>o.value.private=ee)},null,8,["modelValue"])]),_:1}),t(x,{label:"成员"},{default:a(()=>[t(Aa,{modelValue:o.value.members,"onUpdate:modelValue":d[3]||(d[3]=ee=>o.value.members=ee)},null,8,["modelValue"])]),_:1}),t(x,{label:"问题"},{default:a(()=>[t(za,{modelValue:o.value.problems,"onUpdate:modelValue":d[4]||(d[4]=ee=>o.value.problems=ee)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(L,{span:4},{default:a(()=>[z("div",Ss,[z("div",Is,[s.value?(j(),E(D,{key:0},{default:a(()=>[t($,{onClick:c,theme:"danger",loading:g.value},{default:a(()=>d[8]||(d[8]=[V("保存")])),_:1},8,["loading"])]),_:1})):(j(),E(D,{key:1},{default:a(()=>[t($,{onClick:b,theme:"danger",loading:g.value},{default:a(()=>d[9]||(d[9]=[V("创建")])),_:1},8,["loading"])]),_:1}))]),s.value?(j(),E(M,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(C,{label:"创建时间"},{default:a(()=>{var ee;return[V(q((ee=f.value)==null?void 0:ee.createTime),1)]}),_:1}),t(C,{label:"更新时间"},{default:a(()=>{var ee;return[V(q((ee=f.value)==null?void 0:ee.updateTime),1)]}),_:1}),t(C,{label:"创建用户"},{default:a(()=>{var ee;return[V(q((ee=f.value)==null?void 0:ee.ownerNickname),1)]}),_:1})]),_:1})):ae("",!0)])]),_:1})]),_:1}),t(H,{id:"collection-description-editor",modelValue:o.value.description,"onUpdate:modelValue":d[5]||(d[5]=ee=>o.value.description=ee),onSave:c,onOnUploadImg:_,previewTheme:"cyanosis",class:"dida-description-editor"},null,8,["modelValue"]),t(Y,{loading:g.value,attach:"#collection-description-editor","z-index":1e5},null,8,["loading"])]),_:1},8,["loading"]),t(K,{visible:P.value,"onUpdate:visible":d[7]||(d[7]=ee=>P.value=ee),onConfirm:y,header:T.value,"confirm-loading":S.value},{default:a(()=>[d[10]||(d[10]=z("div",{style:{"margin-bottom":"10px"}},[z("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(se,{modelValue:p.value,"onUpdate:modelValue":d[6]||(d[6]=ee=>p.value=ee),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),la=ce(Ps,[["__scopeId","data-v-f4c53b09"]]);function na(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const xs=ie({__name:"JudgeJobList",setup(e){const l=ke(),n=Be(),{globalProperties:u}=pe();let s=!1,w=null,g;const P=i(!1),f=i(null),o=i(!1);let T=-1;const p=i({problemId:"",username:"",language:void 0,status:void 0}),S=i([{title:"ID",colKey:"id",cell:(D,C)=>{let M=null;return kt(C.row.status)&&wt(C.row.language)&&(M=()=>{h(C.row.id)}),t(B,{variant:"text",onClick:M},{default:()=>[C.row.id]})}},{title:"问题",colKey:"problemId",cell:(D,C)=>{if(T){let M;return t(B,{variant:"text",onClick:()=>x(T,C.row.contestProblemIndex)},na(M=at(C.row.contestProblemIndex))?M:{default:()=>[M]})}return t(B,{variant:"text",onClick:()=>U(C.row.problemId)},{default:()=>[C.row.problemId]})}},{title:"状态",colKey:"status",align:"center",cell:(D,C)=>{let M=null;kt(C.row.status)&&wt(C.row.language)&&(M=()=>{h(C.row.id)});const R=C.row.status,H=St(R);let Y=!kt(R);const se=Pa(R);let K=[];return ut(R)&&K.push(t(Ve,{text:C.row.state,size:"small",class:"dida-status-loading"},null)),K.push(t("span",null,[H])),t(B,{theme:se,variant:"outline",onClick:M,disabled:Y},na(K)?K:{default:()=>[K]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"code",cell:(D,C)=>{let M=!wt(C.row.language);return t(B,{theme:"default",onClick:()=>d(C.row),disabled:M},{default:()=>[Ct(C.row.language)+" / "+C.row.codeLength]})}},{title:"作者",colKey:"author",width:200,cell:(D,C)=>t(B,{variant:"text",onClick:()=>A(C.row.authorUsername)},{default:()=>[C.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),y=i(!1);let b=1,c=50;const m=i({current:b,pageSize:c,defaultCurrent:b,defaultPageSize:c,total:0,pageSizeOptions:[50,100]}),_=i(),v=i([]);v.value=Ot();const r=i([]);r.value=xa();const d=async D=>{o.value=!0,P.value=!0;try{f.value=D;const C=await Ql(Number(f.value.id));if(C.code===0){const M=C.data,R=Nt(M.language);f.value.code=`\`\`\`${R}
${M.code}
\`\`\``}else N(u,C.code)}finally{o.value=!1}},U=D=>{D&&n.push({path:"/problem/"+D})},x=(D,C)=>{n.push({name:"contest-problem-detail",params:{contestId:D,problemIndex:C}})},h=D=>{D&&(T>0?n.push({name:"contest-judge-detail",params:{contestId:T,judgeId:D}}):n.push({name:"judge-detail",params:{judgeId:D}}))},A=D=>{D&&n.push({path:"/user/"+D})},I=async()=>{await n.push({query:{...l.query,page:1,page_size:c,problem_id:p.value.problemId,username:p.value.username,language:p.value.language,status:p.value.status}})},k=async()=>{p.value.problemId="",p.value.username="",p.value.language=void 0,p.value.status=void 0,await n.push({query:{...l.query,page:1,page_size:c,problem_id:"",username:"",language:void 0,status:void 0}})},L=async(D,C)=>{C&&(y.value=!0);let M=!1;try{const{current:R,pageSize:H}=D,Y=await en(T,p.value.problemId,p.value.username,p.value.language,p.value.status,R,H);if(_.value=[],Y.code===0){if(!Y.data.has_auth){he(u,"您目前没有权限查看评测记录"),T?await n.push({name:"contest-detail",params:{contestId:T}}):await n.push({name:"judge-list"});return}Y.data.list&&Y.data.list.length>0?(Y.data.list.forEach(K=>{var Z;const ee=Va(K);(Z=_.value)==null||Z.push(ee),ut(K.status)&&(M=!0)}),m.value={...m.value,total:Y.data.total_count}):(he(u,"未找到记录"),m.value={...m.value,total:0})}else C&&N(u,Y.code)}catch(R){console.error(R),C&&N(u,qe())}finally{C&&(y.value=!1),M&&s&&(g=setTimeout(()=>{L({current:b,pageSize:c},!1)},5e3))}},$=async D=>{await n.push({query:{...l.query,page:D.current,page_size:D.pageSize}})};return me(async()=>{s=!0,w=je(()=>l.query,D=>{Array.isArray(l.params.contestId)?T=Number(l.params.contestId[0]):T=Number(l.params.contestId),p.value.problemId=D.problem_id||"",p.value.username=D.username||"",D.language!=null?p.value.language=Number(D.language):p.value.language=void 0,D.status!=null?p.value.status=Number(D.status):p.value.status=void 0;const C=parseInt(D.page)||m.value.defaultCurrent,M=parseInt(D.page_size)||m.value.defaultPageSize;b=C,c=M,m.value.pageSizeOptions.includes(c)||(c=m.value.defaultPageSize),m.value={...m.value,current:b,pageSize:c},L({current:b,pageSize:c},!0)},{immediate:!0})}),Te(()=>{s=!1,w&&w(),clearTimeout(g)}),(D,C)=>{const M=$e,R=Ue,H=Kt,Y=pt,se=B,K=we,ee=Le,Z=ze,re=be,ne=nt,F=Fe("md-preview"),G=Ve,ve=lt;return j(),te(ue,null,[t(re,{style:{margin:"10px"}},{default:a(()=>[t(ee,{layout:"inline",onSubmit:I,onReset:k},{default:a(()=>[t(R,{label:"题号"},{default:a(()=>[t(M,{modelValue:p.value.problemId,"onUpdate:modelValue":C[0]||(C[0]=O=>p.value.problemId=O),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(R,{label:"用户"},{default:a(()=>[t(M,{modelValue:p.value.username,"onUpdate:modelValue":C[1]||(C[1]=O=>p.value.username=O),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(R,{label:"语言"},{default:a(()=>[t(Y,{modelValue:p.value.language,"onUpdate:modelValue":C[2]||(C[2]=O=>p.value.language=O),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:a(()=>[(j(!0),te(ue,null,Se(v.value,O=>(j(),E(H,{key:O.value,value:O.value,label:O.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(R,{label:"状态"},{default:a(()=>[t(Y,{modelValue:p.value.status,"onUpdate:modelValue":C[3]||(C[3]=O=>p.value.status=O),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:a(()=>[(j(!0),te(ue,null,Se(r.value,O=>(j(),E(H,{key:O.value,value:O.value,label:O.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(R,null,{default:a(()=>[t(K,null,{default:a(()=>[t(se,{theme:"primary",type:"submit"},{default:a(()=>C[7]||(C[7]=[V("搜索")])),_:1}),t(se,{theme:"default",variant:"base",type:"reset"},{default:a(()=>C[8]||(C[8]=[V("重置")])),_:1})]),_:1})]),_:1})]),_:1}),t(Z,{data:_.value,columns:S.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:m.value,loading:y.value,onPageChange:$,"table-layout":"auto"},null,8,["data","columns","pagination","loading"])]),_:1}),t(ve,{visible:P.value,"onUpdate:visible":C[5]||(C[5]=O=>P.value=O),width:"800px","cancel-btn":null,"close-btn":!1,onConfirm:C[6]||(C[6]=O=>P.value=!1)},{header:a(()=>[t(ne,{onClick:C[4]||(C[4]=()=>{var O;h((O=f.value)==null?void 0:O.id)})},{default:a(()=>{var O,J,le;return[V(q(((O=f.value)==null?void 0:O.id)+" - "+de(Ct)((J=f.value)!=null&&J.language?(le=f.value)==null?void 0:le.language:de(Dt).Unknown)),1)]}),_:1})]),default:a(()=>[t(G,{loading:o.value},{default:a(()=>{var O;return[t(F,{"model-value":(O=f.value)==null?void 0:O.code,"code-foldable":!1},null,8,["model-value"])]}),_:1},8,["loading"])]),_:1},8,["visible"])],64)}}}),oa=ce(xs,[["__scopeId","data-v-2b081e4c"]]),Vs={class:"dida-code-container"},Ts={key:2,class:"dida-edit-container"};function sa(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const Ds=ie({__name:"JudgeJobDetail",setup(e){const l=ke(),n=Be(),u=Me(),{globalProperties:s}=pe();let w=!1,g,P=0,f=0;const o=i(""),T=i(null),p=i(""),S=i(0),y=i(null),b=i({from:"#5a96ff",to:"#00A870"}),c=i([{title:"ID",colKey:"id"},{title:"问题",colKey:"problemId",cell:(I,k)=>t(B,{variant:"text",onClick:()=>U(k.row.problemId)},{default:()=>[k.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(I,k)=>{const L=k.row.status,$=St(L),D=Pa(L);let C=[];return ut(L)&&C.push(t(Ve,{text:k.row.state,size:"small",class:"dida-status-loading"},null)),C.push(t("span",null,[$])),t(B,{theme:D,variant:"outline"},sa(C)?C:{default:()=>[C]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"language",cell:(I,k)=>t("span",null,[Ct(k.row.language)+" / "+k.row.codeLength])},{title:"作者",colKey:"author",width:200,cell:(I,k)=>t(B,{variant:"text",onClick:()=>x(k.row.authorUsername)},{default:()=>[k.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),m=i(!1),_=i(!1),v=i(),r=Ge(()=>u.hasAuth(De.ManageJudge)),d=async()=>{if(!_.value){_.value=!0;try{const I=await on(P);I.code===0?await A(!0):N(s,I.code)}catch(I){console.error(I),N(s,qe())}finally{_.value=!1}}},U=I=>{I&&n.push({path:"/problem/"+I})},x=I=>{I&&n.push({path:"/user/"+I})},h=I=>{const k=I.status,L=St(k);let $;switch(k){case Ke.Init:case Ke.Rejudge:case Ke.Compiling:case Ke.Running:$="default";break;case Ke.Accept:$="success";break;case Ke.PE:$="warning";break;default:$="danger";break}return t(we,null,{default:()=>[t(B,{theme:"default",variant:"outline"},{default:()=>[I.taskId]}),t(B,{theme:$,variant:"outline"},sa(L)?L:{default:()=>[L]}),t("span",null,[V("分数："),I.score]),t("span",null,[V("用时："),I.time]),t("span",null,[V("内存："),I.memory])]})},A=async I=>{var L;I&&(m.value=!0);let k=!1;try{const $=await Zl(P);if(v.value=[],$.code===0){const D=$.data,C=Va(D);if((L=v.value)==null||L.push(C),o.value=C.judgerName,b.value.to="#00A870",ut(D.status)?(y.value="active",C.taskTotal>0?(S.value=Number((C.taskCurrent/C.taskTotal*100).toFixed(2)),C.taskCurrent>=C.taskTotal&&(S.value=99)):S.value=0):(S.value=100,D.status===Ke.Accept?y.value="success":D.status===Ke.PE?(b.value.to="#F57C20",y.value="warning"):(b.value.to="#F56C6C",y.value="error")),D.code){const M=Nt(D.language);p.value=`\`\`\`${M}
${D.code}
\`\`\``}T.value=C,ut(D.status)&&(k=!0)}else I&&N(s,$.code),f?await n.push({name:"contest-judge",params:{contestId:f}}):await n.push({name:"judge-list"})}catch($){console.error($),I&&N(s,qe())}finally{I&&(m.value=!1),k&&w&&(g=setTimeout(()=>{A(!1)},5e3))}};return me(async()=>{if(w=!0,Array.isArray(l.params.judgeId)?P=Number(l.params.judgeId[0]):P=Number(l.params.judgeId),Array.isArray(l.params.contestId)?f=Number(l.params.contestId[0]):f=Number(l.params.contestId),!P){await n.push({name:"judge"});return}await A(!0)}),Te(()=>{w=!1,clearTimeout(g)}),(I,k)=>{var Z,re,ne;const L=qt,$=ze,D=be,C=Fe("md-preview"),M=Pe,R=We,H=Je,Y=Ie,se=kl,K=Cl,ee=B;return j(),te(ue,null,[t(L,{color:b.value,status:y.value,class:"dida-job-progress",percentage:S.value},null,8,["color","status","percentage"]),t(D,{style:{margin:"10px"}},{default:a(()=>[t($,{data:v.value,columns:c.value,"row-key":"id","vertical-align":"top",hover:!0,loading:m.value},null,8,["data","columns","loading"])]),_:1}),t(Y,null,{default:a(()=>[t(M,{span:8},{default:a(()=>[z("div",Vs,[t(C,{"model-value":p.value,class:"dida-code-div"},null,8,["model-value"])])]),_:1}),t(M,{span:4},{default:a(()=>[t(H,{layout:"vertical",bordered:!0,style:{margin:"20px"}},{default:a(()=>[t(R,{label:"判题机"},{default:a(()=>[V(q(o.value),1)]),_:1}),t(R,{label:"判题时间"},{default:a(()=>{var F;return[V(q((F=T.value)==null?void 0:F.judgeTime),1)]}),_:1})]),_:1})]),_:1})]),_:1}),(Z=T.value)!=null&&Z.compileMessage?(j(),E(D,{key:0,class:"compile-message"},{default:a(()=>{var F;return[V(q((F=T.value)==null?void 0:F.compileMessage),1)]}),_:1})):ae("",!0),(re=T.value)!=null&&re.task&&((ne=T.value)==null?void 0:ne.task.length)>0?(j(),E(K,{key:1,class:"task-panel"},{default:a(()=>{var F;return[(j(!0),te(ue,null,Se((F=T.value)==null?void 0:F.task,(G,ve)=>(j(),E(se,{key:G.taskId,header:()=>h(G)},{default:a(()=>[V(q(G.content)+" "+q(G.waHint),1)]),_:2},1032,["header"]))),128))]}),_:1})):ae("",!0),r.value?(j(),te("div",Ts,[t(ee,{onClick:d,loading:_.value},{default:a(()=>k[0]||(k[0]=[V("重新评测")])),_:1},8,["loading"])])):ae("",!0)],64)}}}),ra=ce(Ds,[["__scopeId","data-v-d2032dd0"]]),js={style:{margin:"10px"}},Ls=ie({__name:"ContestList",setup(e){const l=ke(),n=Be(),{globalProperties:u}=pe();let s=null;const w=i([{title:"ID",colKey:"id",cell:(_,v)=>t(B,{variant:"text",onClick:()=>S(v.row.id)},{default:()=>[v.row.id]})},{title:"标题",colKey:"title",cell:(_,v)=>t(B,{variant:"text",onClick:()=>S(v.row.id)},{default:()=>[v.row.title]})},{title:"负责人",colKey:"ownerNickname",cell:(_,v)=>t(B,{variant:"text",onClick:()=>Bt(n,v.row.ownerUsername)},{default:()=>[v.row.ownerNickname]})},{title:"权限",colKey:"private",cell:(_,v)=>v.row.private?"私有":"公开"},{title:"开始时间",colKey:"startTime"},{title:"结束时间",colKey:"endTime"}]),g=i(!1);let P=1,f=50;const o=i({current:P,pageSize:f,defaultCurrent:P,defaultPageSize:f,total:0,pageSizeOptions:[50,100]}),T=i(),p=i({title:"",username:""}),S=_=>{_&&n.push({path:"/contest/"+_})},y=async()=>{await n.push({query:{...l.query,title:p.value.title,username:p.value.username,page:1,page_size:o.value.defaultPageSize}})},b=async(_,v)=>{var r;g.value=!0;try{const{current:d,pageSize:U}=_,x=await co(d,U);if(T.value=[],x.code===0){const h=x.data.list;for(let A=0;A<h.length;A++){const I=h[A],k=Ht(I);(r=T.value)==null||r.push(k)}o.value={...o.value,total:x.data.total_count}}else v&&N(u,x.code)}catch(d){console.error(d),N(u,qe())}finally{g.value=!1}},c=async _=>{await n.push({query:{...l.query,page:_.current,page_size:_.pageSize}})},m=()=>{n.push({name:"contest-create"})};return me(async()=>{s=je(()=>l.query,_=>{p.value.title=_.title||"",p.value.username=_.username||"";const v=parseInt(_.page)||o.value.defaultCurrent,r=parseInt(_.page_size)||o.value.defaultPageSize;P=v,f=r,o.value={...o.value,current:P,pageSize:f},b({current:P,pageSize:f},!0)},{immediate:!0})}),Te(()=>{s&&s()}),(_,v)=>{const r=ze,d=be,U=Pe,x=$e,h=Ue,A=B,I=Le,k=we,L=Ie;return j(),E(L,null,{default:a(()=>[t(U,{span:9},{default:a(()=>[t(d,{style:{margin:"10px"}},{default:a(()=>[t(r,{data:T.value,columns:w.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:o.value,loading:g.value,"table-layout":"auto",onPageChange:c,style:{"white-space":"nowrap"}},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(U,{span:3},{default:a(()=>[z("div",js,[t(d,{class:"sh-card"},{default:a(()=>[t(I,{model:p.value},{default:a(()=>[t(h,{label:"标题"},{default:a(()=>[t(x,{modelValue:p.value.title,"onUpdate:modelValue":v[0]||(v[0]=$=>p.value.title=$),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(h,{label:"负责人"},{default:a(()=>[t(x,{modelValue:p.value.username,"onUpdate:modelValue":v[1]||(v[1]=$=>p.value.username=$),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(h,null,{default:a(()=>[t(A,{theme:"primary",onClick:y},{default:a(()=>v[2]||(v[2]=[V("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(d,{class:"sh-card"},{default:a(()=>[t(k,null,{default:a(()=>[t(A,{onClick:m},{default:a(()=>v[3]||(v[3]=[V("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),ua=ce(Ls,[["__scopeId","data-v-ce6320bd"]]),Us={style:{margin:"20px"}},$s={style:{margin:"10px"}},zs={style:{"text-align":"center","align-content":"center",padding:"20px",height:"500px"}},As={style:{"text-align":"center",width:"100%"}},Rs={class:"dida-operation-container"},Ms={style:{margin:"12px"}},Es=ie({__name:"ContestDetail",setup(e){let l=ke();const{globalProperties:n}=pe(),u=Ye(),s=Me(),w=i(!1);let g=0;const P=i(!1),f=i(null),o=i(!1),T=i(!1),p=i(""),S=Ge(()=>s.hasAuth(De.ManageContest)||f.value&&s.getUserId==f.value.ownerId),y=x=>{if(!x||!m)return"default";const h=m[x];if(!h)return"default";switch(h){case Oe.Accept:return"success";case Oe.Attempt:return"warning";default:return"default"}},b=i([{title:"问题ID",colKey:"index",cell:(x,h)=>{const A=y(h.row.index);return t(B,{variant:"dashed",theme:A,onClick:async()=>await Et(g,h.row.index)},{default:()=>[h.row.id]})}},{title:"标题",colKey:"title",cell:(x,h)=>t(B,{variant:"text",onClick:async()=>await Et(g,h.row.index)},{default:()=>[h.row.title]})},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),c=i([]);let m={},_=i(!1);const v=()=>{X.push({name:"contest-edit",params:{contestId:g}})},r=async()=>{w.value=!0;try{const x=await _o(g);if(x.code!==0){N(n,x.code);return}const h=x.data;he(n,"查重报告已生成，请前往查看"),window.open(h,"_blank")}finally{w.value=!1}},d=async x=>{if(!s.isLogin()){await X.push({name:"login"});return}if(!p.value){_e(n,"请输入密码");return}_.value=!0;try{const h=await vo(g,p.value);if(h.code!==0){N(n,h.code);return}he(n,"申请访问成功"),await U()}catch(h){console.error("Error submitting contest password:",h),N(n,"提交密码失败，请稍后再试")}finally{_.value=!1}},U=async()=>{P.value=!0;const x=await so(g);if(x.code!==0){P.value=!1,N(n,x.code),await X.push({name:"contest"});return}o.value=x.data.has_auth,T.value=x.data.need_password,f.value=Ht(x.data.contest),c.value=f.value.problems,m=x.data.attempt_status||{},u.setTitle(f.value.title+" - "+u.getTitle),P.value=!1};return me(async()=>{if(Array.isArray(l.params.contestId)?g=Number(l.params.contestId[0]):g=Number(l.params.contestId),!g){await X.push({name:"contest"});return}await U()}),(x,h)=>{const A=It,I=ze,k=be,L=$e,$=Ue,D=B,C=Le,M=Pe,R=we,H=We,Y=Je,se=Fe("md-preview"),K=Ie,ee=Ve;return j(),E(ee,{loading:P.value},{default:a(()=>[t(K,{class:"dida-main-content"},{default:a(()=>[t(M,{span:6},{default:a(()=>{var Z,re,ne;return[z("div",Us,[z("h1",null,q((Z=f.value)==null?void 0:Z.title),1),(re=f.value)!=null&&re.notification?(j(),E(A,{key:0,theme:"info",message:(ne=f.value)==null?void 0:ne.notification},null,8,["message"])):ae("",!0)]),z("div",$s,[o.value?(j(),E(k,{key:0},{default:a(()=>[t(I,{data:c.value,columns:b.value,"row-key":"id","table-layout":"auto","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1})):(j(),E(k,{key:1},{default:a(()=>[z("div",zs,[t(A,{theme:"warning",message:"您没有查看本比赛的权限"}),T.value?(j(),E(C,{key:0,style:{margin:"20px auto 0",width:"200px"},onSubmit:d,"label-width":"0"},{default:a(()=>[t($,null,{default:a(()=>[t(L,{placeholder:"请输入密码",value:p.value,"onUpdate:value":h[0]||(h[0]=F=>p.value=F),style:{width:"300px"},type:"password",autocomplete:"new-password"},null,8,["value"])]),_:1}),t($,null,{default:a(()=>[z("div",As,[t(D,{theme:"primary",type:"submit",loading:de(_)},{default:a(()=>h[1]||(h[1]=[V("提交")])),_:1},8,["loading"])])]),_:1})]),_:1})):ae("",!0)])]),_:1}))])]}),_:1}),t(M,{span:6},{default:a(()=>{var Z;return[z("div",Rs,[t(R,null,{default:a(()=>[S.value?(j(),E(D,{key:0,onClick:r,loading:w.value},{default:a(()=>h[2]||(h[2]=[V("查重")])),_:1},8,["loading"])):ae("",!0),S.value?(j(),E(D,{key:1,onClick:v},{default:a(()=>h[3]||(h[3]=[V("编辑")])),_:1})):ae("",!0)]),_:1})]),z("div",Ms,[t(Y,{layout:"vertical",bordered:!0},{default:a(()=>[t(H,{label:"创建时间"},{default:a(()=>{var re;return[V(q((re=f.value)==null?void 0:re.createTime),1)]}),_:1})]),_:1}),t(Y,{layout:"vertical",bordered:!0},{default:a(()=>[t(H,{label:"更新时间"},{default:a(()=>{var re;return[V(q((re=f.value)==null?void 0:re.updateTime),1)]}),_:1})]),_:1}),t(Y,{layout:"vertical",bordered:!0},{default:a(()=>[t(H,{label:"开始时间"},{default:a(()=>{var re;return[V(q((re=f.value)==null?void 0:re.startTime),1)]}),_:1})]),_:1}),t(Y,{layout:"vertical",bordered:!0},{default:a(()=>[t(H,{label:"结束时间"},{default:a(()=>{var re;return[V(q((re=f.value)==null?void 0:re.endTime),1)]}),_:1})]),_:1})]),(Z=f.value)!=null&&Z.description?(j(),E(k,{key:0,style:{margin:"12px"}},{default:a(()=>{var re;return[t(se,{"model-value":(re=f.value)==null?void 0:re.description,class:"dida-content-description"},null,8,["model-value"])]}),_:1})):ae("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),qs=ce(Es,[["__scopeId","data-v-af022b1b"]]);function Ra(e){return e?Math.floor(e/1e9):0}function rt(e){if(e<=0)return"0秒";let l="";const n=Math.floor(e/3600);n>0&&(l+=`${n}小时`);const u=Math.floor(e%3600/60);return(u>0||n>0)&&(n>0&&u<10&&(l+="0"),l+=`${u}分钟`),e=e%60,(e>0||u>0||n>0)&&((n>0||u>0)&&e<10&&(l+="0"),l+=`${e.toFixed(0)}秒`),l}const Ks=mt("contest",{state:()=>({starMembers:{}}),actions:{clear(){this.$patch({starMembers:{}})},addStarMember(e,l){this.starMembers[e]||(this.starMembers[e]={}),this.starMembers[e][l]=!0},removeStarMember(e,l){this.starMembers[e]&&(delete this.starMembers[e][l],Object.keys(this.starMembers[e]).length===0&&delete this.starMembers[e])},isStarMember(e,l){var n;return!!((n=this.starMembers[e])!=null&&n[l])}},persist:!0}),Fs={style:{margin:"10px 10px 40px"}},Os={style:{"text-align":"right","margin-bottom":"10px"}},Ns={class:"table-scroll-wrapper"};function ia(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const Gs=ie({__name:"ContestRank",setup(e){const l=ke(),n=Be(),u=Ks(),{globalProperties:s}=pe();let w=!1,g=null,P=0,f=null,o=null,T=0;const p=i(0),S=i(0),y=i(!1),b=i(!0),c=i(!0);let m=null,_=null,v=1,r=50;const d=i({current:v,pageSize:r,defaultCurrent:1,defaultPageSize:50,total:0,pageSizeOptions:[50,100,1e3]}),U=F=>u&&u.isStarMember(P,F),x=async F=>{d.value={...d.value,current:F.current,pageSize:F.pageSize},await n.push({query:{...l.query,page:F.current,page_size:F.pageSize}})},h=F=>{if(F==null)return"-";const G=Math.floor(F/3600).toString().padStart(2,"0"),ve=Math.floor(F%3600/60).toString().padStart(2,"0"),O=(F%60).toFixed(0).toString().padStart(2,"0");return`${G}:${ve}:${O}`},A=i({}),I=[{title:"Rank",colKey:"rank",align:"center",fixed:"left"},{title:"昵称",colKey:"nickname",fixed:"left",attrs:F=>{let G={};return U(F.row.userId)&&(G={backgroundColor:"rgba(255,165,30,0.5)"}),{style:G}},cell:(F,G)=>{const ve=Ml(G.row.nickname,18);let O=null;return U(G.row.userId)?O=t(B,{shape:"circle",variant:"text",class:"rank-unstar-button",onClick:()=>{u.removeStarMember(P,G.row.userId),Z()}},{default:()=>[t(al,{slot:"icon"},null)]}):O=t(B,{shape:"circle",variant:"text",class:"rank-star-button",onClick:()=>{u.addStarMember(P,G.row.userId),Z()}},{default:()=>[t(ll,{slot:"icon"},null)]}),t("div",{class:"rank-nickname-cell"},[t(we,null,{default:()=>[t(Il,{content:G.row.nickname},{default:()=>[t(B,{variant:"text",onClick:()=>n.push({name:"user",params:{username:G.row.username}})},ia(ve)?ve:{default:()=>[ve]})]}),O]})])}},{title:"Solved",colKey:"solved",align:"center",fixed:"left",cell:(F,G)=>t(B,{variant:"text",onClick:()=>n.push({name:"contest-judge",params:{contestId:P},query:{username:G.row.username,status:Ke.Accept}})},{default:()=>[G.row.solved]})},{title:"Penalty",colKey:"penalty",align:"center",fixed:"left",cell:(F,G)=>h(G.row.penalty)}],k=i([]),L=i(!1);let $=[],D=[];const C=i([]);let M=[];const R=({col:F,rowIndex:G})=>{if(F.colKey==="rank"){let ve=d.value.current;d.value.current>Math.ceil(C.value.length/d.value.pageSize)&&(ve=Math.ceil(C.value.length/d.value.pageSize));let O=d.value.pageSize*(ve-1),J=1;for(let le=G+1;O+le<C.value.length&&C.value[O+le].rank===C.value[O+G].rank;le++)J++;return{rowspan:J}}},H=(F,{value:G})=>rt(G),Y=()=>{m&&clearInterval(m),m=setInterval(()=>{w&&ne(!1)},3e4),_&&clearInterval(_),_=setInterval(()=>{if(!w)return;p.value=(new Date().getTime()-f.getTime())/1e3;const F=Math.min(p.value,S.value);p.value=Math.min(p.value,F),Z()},1e3)},se=()=>{m&&(clearInterval(m),m=null),_&&(clearInterval(_),_=null)},K=async F=>{c.value=F,F?(await ne(!1),Y()):se()},ee=()=>{Z(),d.value={...d.value,current:1}},Z=()=>{C.value=[];let F=[];for(let Q=0;Q<$.length;Q++){const fe=$[Q];let Ee={userId:fe.author_id,username:fe.author_username,nickname:fe.author_nickname},xe=0,ye=0;fe.problems.forEach(Ne=>{let Xe=-1,et=Ne.lock||0;if(Ne.ac){if(Xe=(new Date(Ne.ac).getTime()-(f==null?void 0:f.getTime()))/1e3,Xe>p.value)return;xe++,ye+=Xe,ye+=Ne.attempt*20*60}if(et>0&&T>0){const jt=S.value-T;p.value<jt&&(et=0)}const ot=Ne.index;Ee[`problem_${ot}`]={acDuration:Xe,attempt:Ne.attempt||0,lock:et}}),Ee.solved=xe,Ee.penalty=ye,F.push(Ee)}F.sort((Q,fe)=>Q.solved!==fe.solved?fe.solved-Q.solved:Q.penalty!==fe.penalty?Q.penalty-fe.penalty:Q.userId-fe.userId);const G=D;let ve=0,O=0,J=-1,le=-1;for(let Q=0;Q<F.length;Q++)G&&G.includes(F[Q].userId)?F[Q].rank="*":(O++,(F[Q].solved!==J||F[Q].penalty!==le)&&(ve=O,J=F[Q].solved,le=F[Q].penalty),F[Q].rank=String(ve));y.value&&(F=F.filter(Q=>U(Q.userId)));const ge=document.querySelectorAll("tbody tr"),Ce={};M.forEach((Q,fe)=>{const Ee=ge[fe];Ee&&(Ce[Q.userId]=Ee.getBoundingClientRect())}),d.value={...d.value,total:F.length},C.value=F;for(let Q=0;Q<C.value.length;Q++)C.value[Q].index=Q+1;if(M=[...C.value],b.value){const Q={},fe=document.querySelectorAll("table tbody tr");C.value.forEach((Ee,xe)=>{const ye=fe[xe];ye&&(Q[Ee.userId]=ye.getBoundingClientRect())}),requestAnimationFrame(()=>{const Ee=document.querySelectorAll("table tbody tr");C.value.forEach((xe,ye)=>{const Ne=Ee[ye],Xe=Ce[xe.userId],et=Q[xe.userId];if(Xe&&et){const ot=Xe.top-et.top;ot!==0&&(Ne.style.transition="none",Ne.style.transform=`translateY(${ot}px)`)}}),requestAnimationFrame(()=>{document.querySelectorAll("table tbody tr").forEach(ye=>{ye.style.transition="transform 300ms ease",ye.style.transform=""})})})}},re=F=>{K(!1),p.value=F;const G=Math.min(S.value,(new Date().getTime()-(f==null?void 0:f.getTime()))/1e3);p.value=Math.min(p.value,G),Z()},ne=async F=>{F&&(L.value=!0);try{const G=await mo(P);if(k.value=[...I],$=[],D=[],C.value=[],d.value={...d.value,total:0},G.code===0){if(!G.data.has_auth){he(s,"您目前没有权限查看比赛排名"),await n.push({name:"contest-detail",params:{contestId:P}});return}G.data.problems.sort((J,le)=>J-le),G.data.problems.forEach((J,le)=>{k.value.push({colKey:`problem_${J}`,align:"center",title:()=>{let ge;return t(B,{variant:"text",onClick:()=>n.push({name:"contest-problem-detail",params:{contestId:P,problemIndex:J}})},ia(ge=at(J))?ge:{default:()=>[ge]})},cell:(ge,Ce)=>{const Q=Ce.row[`problem_${J}`];if(!Q)return"";let fe="";return Q.acDuration>=0&&(fe=h(Q.acDuration)),Q.attempt>0&&(fe&&(fe+=" "),fe+=`(-${Q.attempt})`),Q.lock>0&&(fe&&(fe+=" "),fe+=`(+${Q.lock})`),t("span",null,[fe])},attrs:ge=>{const Ce=ge.row[`problem_${J}`];return Ce?Ce.acDuration>=0?{style:{backgroundColor:"rgba(130,255,30,0.5)"}}:Ce.lock>0?{style:{backgroundColor:"rgb(255,180,50,0.5)"}}:Ce.attempt>0?{style:{backgroundColor:"rgba(255,120,120,0.5)"}}:{}:{}}})});const ve=G.data.contest;if(f=new Date(ve.start_time),o=new Date(ve.end_time),$=G.data.ranks,D=G.data.v_members||[],S.value=Math.floor((o.getTime()-f.getTime())/1e3),A.value={0:"0",[Math.floor(S.value/2)]:rt(Math.floor(S.value/2)),[S.value]:rt(S.value)},T=Ra(ve.lock_rank_duration||0),G.data.is_locked&&T>0){const J=Math.max(0,S.value-T);A.value[J]=t("span",{style:"color: #0052d9"},[V("锁榜("),rt(J),V(")")])}p.value=Math.floor((new Date().getTime()-f.getTime())/1e3);const O=Math.min(p.value,S.value);p.value=Math.min(p.value,O),c.value=!0,Y(),Z()}else F&&N(s,G.code)}catch(G){console.error(G),F&&N(s,qe())}finally{F&&(L.value=!1)}};return me(async()=>{w=!0,g=je(()=>l.query,async F=>{if(Array.isArray(l.params.contestId)?P=Number(l.params.contestId[0]):P=Number(l.params.contestId),!P){await n.push({name:"contest"});return}const G=parseInt(F.page)||d.value.defaultCurrent,ve=parseInt(F.page_size)||d.value.defaultPageSize;v=G,r=ve,d.value={...d.value,current:v,pageSize:r},await ne(!0)},{immediate:!0})}),Te(()=>{w=!1,g&&g(),se()}),(F,G)=>{const ve=ft,O=we,J=Sl,le=ze,ge=be,Ce=Ie;return j(),E(Ce,null,{default:a(()=>[t(ge,{style:{margin:"10px",width:"100%"}},{default:a(()=>[z("div",Fs,[z("div",Os,[t(O,null,{default:a(()=>[t(ve,{size:"large",modelValue:y.value,"onUpdate:modelValue":G[0]||(G[0]=Q=>y.value=Q),onChange:ee},{label:a(Q=>[V(q(Q.value?"仅展示收藏":"未过滤收藏"),1)]),_:1},8,["modelValue"]),t(ve,{size:"large",modelValue:b.value,"onUpdate:modelValue":G[1]||(G[1]=Q=>b.value=Q)},{label:a(Q=>[V(q(Q.value?"开启动画":"关闭动画"),1)]),_:1},8,["modelValue"]),t(ve,{size:"large",modelValue:c.value,"onUpdate:modelValue":G[2]||(G[2]=Q=>c.value=Q),onChange:K},{label:a(Q=>[V(q(Q.value?"自动刷新":"关闭刷新"),1)]),_:1},8,["modelValue"])]),_:1})]),t(J,{modelValue:p.value,"onUpdate:modelValue":G[3]||(G[3]=Q=>p.value=Q),marks:A.value,max:S.value,label:H,"tooltip-props":{placement:"top"},"input-number-props":{theme:"column",autoWidth:!0,format:de(rt),onChange:re},onChangeEnd:re},null,8,["modelValue","marks","max","input-number-props"])]),z("div",Ns,[t(le,{data:C.value,columns:k.value,"row-key":"index","vertical-align":"middle",bordered:!0,hover:!0,"table-layout":"auto","rowspan-and-colspan":R,loading:L.value,class:"dida-contest-rank-table",pagination:d.value,onPageChange:x},null,8,["data","columns","loading","pagination"])])]),_:1})]),_:1})}}}),Hs=ce(Gs,[["__scopeId","data-v-838e6c28"]]),Bs={style:{margin:"10px"}},Js={style:{margin:"12px"}},Ws={class:"dida-edit-container"},Ys=ie({__name:"ContestEdit",setup(e){let l=ke();const{globalProperties:n}=pe(),u=Ye(),s=i(0),w=i(!1),g=i(!1),P=i(!1),f=i(null),o=i({title:"",openTime:[],private:!0,password:"",problems:[],members:[],description:"",notification:"",lockRankDuration:0,alwaysLock:!0,submitAnytime:!1}),T=i(""),p=i(""),S=i(!1),y=async()=>{S.value=!0,P.value=!1,S.value=!1},b=async()=>{g.value=!0;try{const v={title:o.value.title,description:o.value.description,notification:o.value.notification,lock_rank_duration:o.value.lockRankDuration,always_lock:o.value.alwaysLock,problems:o.value.problems,members:o.value.members,private:o.value.private,password:o.value.password,submit_anytime:o.value.submitAnytime};o.value.openTime[0]&&(v.start_time=new Date(o.value.openTime[0])),o.value.openTime[1]&&(v.end_time=new Date(o.value.openTime[1]));const r=await po(v);if(g.value=!0,r.code!==0){N(n,r.code);return}r.data!=null&&await X.push({name:"contest-detail",params:{contestId:r.data}}),He(n,"创建成功")}finally{g.value=!1}},c=async()=>{g.value=!0;try{const v={id:Number(s.value),title:o.value.title,notification:o.value.notification,lock_rank_duration:o.value.lockRankDuration,always_lock:o.value.alwaysLock,problems:o.value.problems,members:o.value.members,private:o.value.private,password:o.value.password,submit_anytime:o.value.submitAnytime,description:o.value.description};o.value.openTime[0]&&(v.start_time=new Date(o.value.openTime[0])),o.value.openTime[1]&&(v.end_time=new Date(o.value.openTime[1]));const r=await fo(v);if(g.value=!0,r.code!==0){N(n,r.code);return}r.data!=null&&f.value&&(f.value.updateTime=new Date(r.data).toLocaleString()),He(n,"保存成功")}finally{g.value=!1}},m=v=>{o.value.description=v,w.value=!1},_=async()=>{const v=await ro(s.value);if(v.code!==0){N(n,v.code),console.error("contest get failed",v.code),await X.push({name:"contest-list"});return}const r=v.data.contest;f.value=Ht(r),o.value.title=r.title,o.value.openTime=[],r.start_time?o.value.openTime.push(new Date(r.start_time)):o.value.openTime.push(""),r.end_time?o.value.openTime.push(new Date(r.end_time)):o.value.openTime.push(""),o.value.private=r.private,o.value.password=r.password||"",o.value.description=r.description||"",o.value.notification=r.notification||"",o.value.problems=v.data.problems,o.value.members=v.data.members,r.lock_rank_duration?o.value.lockRankDuration=Ra(r.lock_rank_duration):o.value.lockRankDuration=0,o.value.alwaysLock=r.always_lock,o.value.submitAnytime=r.submit_anytime,u.setTitle(r.title+" - "+u.getTitle);let d="";r.description&&(d=r.description),m(d)};return me(async()=>{Array.isArray(l.params.contestId)?s.value=Number(l.params.contestId[0]):s.value=Number(l.params.contestId),s.value?(w.value=!0,await _()):m("")}),(v,r)=>{const d=$e,U=Ue,x=Ft,h=ft,A=ga,I=Le,k=be,L=Pe,$=B,D=we,C=We,M=Je,R=Ie,H=Ve,Y=Pt,se=lt;return j(),te(ue,null,[t(H,{loading:w.value},{default:a(()=>[t(R,null,{default:a(()=>[t(L,{span:8},{default:a(()=>[z("div",Bs,[t(k,{class:"sh-card"},{default:a(()=>[t(I,{model:o.value,"label-width":"150px"},{default:a(()=>[t(U,{label:"标题"},{default:a(()=>[t(d,{modelValue:o.value.title,"onUpdate:modelValue":r[0]||(r[0]=K=>o.value.title=K),placeholder:"比赛标题"},null,8,["modelValue"])]),_:1}),t(U,{label:"通知"},{default:a(()=>[t(d,{modelValue:o.value.notification,"onUpdate:modelValue":r[1]||(r[1]=K=>o.value.notification=K),placeholder:"会更为醒目地提醒"},null,8,["modelValue"])]),_:1}),t(U,{label:"开启时间"},{default:a(()=>[t(x,{modelValue:o.value.openTime,"onUpdate:modelValue":r[2]||(r[2]=K=>o.value.openTime=K),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(U,{label:"提交限制"},{default:a(()=>[t(h,{modelValue:o.value.submitAnytime,"onUpdate:modelValue":r[3]||(r[3]=K=>o.value.submitAnytime=K)},{label:a(K=>[V(q(K.value?"结束仍能提交":"仅比赛期间提交"),1)]),_:1},8,["modelValue"])]),_:1}),t(U,{label:"锁榜时长"},{default:a(()=>[t(A,{modelValue:o.value.lockRankDuration,"onUpdate:modelValue":r[4]||(r[4]=K=>o.value.lockRankDuration=K),min:0,format:de(rt),"auto-width":""},null,8,["modelValue","format"])]),_:1}),t(U,{label:"自动解锁"},{default:a(()=>[t(h,{modelValue:o.value.alwaysLock,"onUpdate:modelValue":r[5]||(r[5]=K=>o.value.alwaysLock=K)},{label:a(K=>[V(q(K.value?"结束后仍锁榜":"结束后解锁"),1)]),_:1},8,["modelValue"])]),_:1}),t(U,{label:"私有"},{default:a(()=>[t(h,{modelValue:o.value.private,"onUpdate:modelValue":r[6]||(r[6]=K=>o.value.private=K)},null,8,["modelValue"])]),_:1}),o.value.private?(j(),E(U,{key:0,label:"密码"},{default:a(()=>[t(d,{modelValue:o.value.password,"onUpdate:modelValue":r[7]||(r[7]=K=>o.value.password=K),type:"password",placeholder:"请输入访问密码，留空代表关闭密码访问"},null,8,["modelValue"])]),_:1})):ae("",!0),o.value.private?(j(),E(U,{key:1,label:"成员"},{default:a(()=>[t(Aa,{modelValue:o.value.members,"onUpdate:modelValue":r[8]||(r[8]=K=>o.value.members=K)},null,8,["modelValue"])]),_:1})):ae("",!0),t(U,{label:"问题"},{default:a(()=>[t(za,{modelValue:o.value.problems,"onUpdate:modelValue":r[9]||(r[9]=K=>o.value.problems=K)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(L,{span:4},{default:a(()=>[z("div",Js,[z("div",Ws,[s.value?(j(),E(D,{key:0},{default:a(()=>[t($,{onClick:c,theme:"danger",loading:g.value},{default:a(()=>r[12]||(r[12]=[V("保存")])),_:1},8,["loading"])]),_:1})):(j(),E(D,{key:1},{default:a(()=>[t($,{onClick:b,theme:"danger",loading:g.value},{default:a(()=>r[13]||(r[13]=[V("创建")])),_:1},8,["loading"])]),_:1}))]),s.value?(j(),E(M,{key:0,layout:"vertical",bordered:!0},{default:a(()=>[t(C,{label:"创建时间"},{default:a(()=>{var K;return[V(q((K=f.value)==null?void 0:K.createTime),1)]}),_:1}),t(C,{label:"更新时间"},{default:a(()=>{var K;return[V(q((K=f.value)==null?void 0:K.updateTime),1)]}),_:1}),t(C,{label:"创建用户"},{default:a(()=>{var K;return[V(q((K=f.value)==null?void 0:K.ownerNickname),1)]}),_:1})]),_:1})):ae("",!0)])]),_:1})]),_:1}),r[14]||(r[14]=z("div",{id:"contestEditDiv",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"]),t(se,{visible:P.value,"onUpdate:visible":r[11]||(r[11]=K=>P.value=K),onConfirm:y,header:T.value,"confirm-loading":S.value},{default:a(()=>[r[15]||(r[15]=z("div",{style:{"margin-bottom":"10px"}},[z("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(Y,{modelValue:p.value,"onUpdate:modelValue":r[10]||(r[10]=K=>p.value=K),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),ca=ce(Ys,[["__scopeId","data-v-669da56e"]]);function Ma(e){const l={};return l.id=e.id,l.authorId=e.author_id,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.title=e.title,l.content=e.content,e.insert_time&&(l.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(l.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(l.updateTime=new Date(e.update_time).toLocaleString()),l.problemId=e.problem_id,l.problemTitle=e.problem_title,l.contestId=e.contest_id,l.contestTitle=e.contest_title,l.contestProblemIndex=e.contest_problem_index,l}function Xs(e){const l={};return l.id=e.id,l.authorId=e.author_id,l.authorUsername=e.author_username,l.authorNickname=e.author_nickname,l.content="",e.content&&(l.content=e.content),e.insert_time&&(l.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(l.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(l.updateTime=new Date(e.update_time).toLocaleString()),l}function Zs(e){return W({url:"/discuss?id="+e,method:"get"})}function Qs(e,l,n,u,s,w){const g={};return e&&(g.contest_id=e),l&&(g.problem_id=l),n&&(g.title=n),u&&(g.username=u),s&&(g.page=s),w&&(g.page_size=w),W({url:`/discuss/list?${new URLSearchParams(g).toString()}`,method:"get"})}function er(e,l,n){return W({url:"/discuss/comment/list?id="+e+"&page="+l+"&page_size="+n,method:"get"})}function tr(e){return W({url:"/discuss/create",method:"post",data:e})}const ar={style:{margin:"10px"}};function lr(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const nr=ie({__name:"DiscussList",setup(e){const l=ke(),n=Be(),{globalProperties:u}=pe();let s=null;const w=i(!1),g=i(!1);let P=-1;const f=i([]),o=[],T=[{title:"标题",colKey:"title",cell:(k,L)=>t(B,{variant:"text",onClick:()=>d(L.row.id)},{default:()=>[L.row.title]})},{title:"创建人",colKey:"authorNickname",width:"200",cell:(k,L)=>t(B,{variant:"text",onClick:async()=>await Bt(n,L.row.authorUsername)},{default:()=>[L.row.authorNickname]})},{title:"创建时间",colKey:"insertTime",width:"180"},{title:"更新时间",colKey:"updateTime",width:"180"}],p=i(!1);let S=1,y=50;const b=i({current:S,pageSize:y,defaultCurrent:S,defaultPageSize:y,total:0,pageSizeOptions:[50,100]}),c=i(),m=i({problemId:"",title:"",username:""}),_=i({title:"",content:""}),v=k=>{k&&n.push({name:"problem-detail",params:{problemId:k}})},r=(k,L)=>{n.push({name:"contest-problem-detail",params:{contestId:k,problemIndex:L}})},d=k=>{if(k){if(P){n.push({name:"contest-discuss-detail",params:{contestId:P,discussId:k}});return}n.push({name:"discuss-detail",params:{discussId:k}})}},U=async()=>{await n.push({query:{...l.query,problem_id:m.value.problemId,title:m.value.title,username:m.value.username,page:1,page_size:b.value.defaultPageSize}})},x=async(k,L)=>{var $;p.value=!0;try{const{current:D,pageSize:C}=k,M=await Qs(P,m.value.problemId,m.value.title,m.value.username,D,C);if(c.value=[],M.code===0){if(!M.data.has_auth){he(u,"您目前没有权限查看讨论列表"),P?await n.push({name:"contest-detail",params:{contestId:P}}):await n.push({name:"discuss-list"});return}if(M.data.list){const R=M.data.list;for(let H=0;H<R.length;H++){const Y=R[H],se=await Ma(Y);($=c.value)==null||$.push(se)}}b.value={...b.value,total:M.data.total_count}}else L&&N(u,M.code)}catch(D){console.error(D),N(u,qe())}finally{p.value=!1}},h=async k=>{await n.push({query:{...l.query,page:k.current,page_size:k.pageSize}})},A=()=>{w.value=!0},I=async()=>{g.value=!0,console.log("discussCreateForm",_.value),tr(_.value).then(k=>{k.code===0?(he(u,"创建比赛成功"),w.value=!1,n.push({path:"/discuss/"+k.data.id})):N(u,k.code)}).finally(()=>{g.value=!1})};return me(async()=>{s=je(()=>l.query,k=>{Array.isArray(l.params.contestId)?P=Number(l.params.contestId[0]):P=Number(l.params.contestId),f.value=o,P?f.value=f.value.concat([{title:"问题ID",colKey:"contestProblemIndex",width:"100",cell:(D,C)=>{let M;return C.row.contestProblemIndex?t(B,{variant:"text",onClick:()=>r(P,C.row.contestProblemIndex)},lr(M=at(C.row.contestProblemIndex))?M:{default:()=>[M]}):""}}]):f.value=f.value.concat([{title:"问题ID",colKey:"problemId",width:"100",cell:(D,C)=>C.row.problemId?t(B,{variant:"text",onClick:()=>v(C.row.problemId)},{default:()=>[C.row.problemId]}):""}]),f.value=f.value.concat(T),m.value.problemId=k.problem_id||"",m.value.title=k.title||"",m.value.username=k.username||"";const L=parseInt(k.page)||b.value.defaultCurrent,$=parseInt(k.page_size)||b.value.defaultPageSize;S=L,y=$,b.value={...b.value,current:S,pageSize:y},x({current:S,pageSize:y},!0)},{immediate:!0})}),Te(()=>{s&&s()}),(k,L)=>{const $=ze,D=be,C=Pe,M=$e,R=Ue,H=B,Y=Le,se=we,K=Ie,ee=lt;return j(),te(ue,null,[t(K,null,{default:a(()=>[t(C,{span:9},{default:a(()=>[t(D,{style:{margin:"10px"}},{default:a(()=>[t($,{data:c.value,columns:f.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:b.value,loading:p.value,"table-layout":"auto",onPageChange:h},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(C,{span:3},{default:a(()=>[z("div",ar,[t(D,{class:"sh-card"},{default:a(()=>[t(Y,{model:m.value},{default:a(()=>[t(R,{label:"问题ID"},{default:a(()=>[t(M,{modelValue:m.value.problemId,"onUpdate:modelValue":L[0]||(L[0]=Z=>m.value.problemId=Z),placeholder:"请输入完整问题ID"},null,8,["modelValue"])]),_:1}),t(R,{label:"标题"},{default:a(()=>[t(M,{modelValue:m.value.title,"onUpdate:modelValue":L[1]||(L[1]=Z=>m.value.title=Z),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(R,{label:"创建人"},{default:a(()=>[t(M,{modelValue:m.value.username,"onUpdate:modelValue":L[2]||(L[2]=Z=>m.value.username=Z),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(R,null,{default:a(()=>[t(H,{theme:"primary",onClick:U},{default:a(()=>L[6]||(L[6]=[V("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(D,{class:"sh-card"},{default:a(()=>[t(se,null,{default:a(()=>[t(H,{onClick:A},{default:a(()=>L[7]||(L[7]=[V("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),t(ee,{visible:w.value,"onUpdate:visible":L[5]||(L[5]=Z=>w.value=Z),header:"创建讨论",onConfirm:I,"confirm-loading":g.value},{default:a(()=>[t(Y,{"label-width":80,model:_.value,onSubmit:L[4]||(L[4]=yt(()=>{},["prevent"]))},{default:a(()=>[t(R,{label:"标题"},{default:a(()=>[t(M,{modelValue:_.value.title,"onUpdate:modelValue":L[3]||(L[3]=Z=>_.value.title=Z),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),gt=ce(nr,[["__scopeId","data-v-a2987da9"]]),or={key:0,style:{margin:"20px"}},sr={style:{margin:"10px"}},rr={style:{margin:"10px"}},ur={style:{margin:"10px","text-align":"right"}},ir={style:{margin:"12px"}},cr={key:0,class:"dida-edit-container"},dr=ie({__name:"DiscussDetail",props:{discussId:{}},setup(e){const l=e;let n=ke();const{globalProperties:u}=pe();let s=null;const w=Ye(),g=Me();let P=i("");const f=i(""),o=i(!1),T=i(null);let p=i("");const S=i(!1);let y=1,b=20;const c=i({current:1,pageSize:20,total:0,defaultPageSize:b,defaultCurrent:y,pageSizeOptions:[20,50]}),m=i([]),_={},v=Ge(()=>g.hasAuth(De.ManageDiscuss)),r=I=>{I&&X.push({name:"discuss-list",query:{...n.query,title:"",tag:I.name}})},d=()=>{X.push({name:"manage-discuss",params:{discussId:f.value}})},U=()=>t("div",{class:"t-pagination__total"},[`共 ${c.value.total} 条回复`]),x=()=>{},h=async(I,k)=>{var L;S.value=!0;try{const{current:$,pageSize:D}=I,C=await er(f.value,$,D);if(m.value=[],C.code===0){const M=C.data.list;if(M)for(let R=0;R<M.length;R++){const H=M[R],Y=Xs(H);(L=m.value)==null||L.push(Y)}c.value={...c.value,total:C.data.total_count}}else k&&N(u,C.code)}catch($){console.error($),N(u,qe())}finally{S.value=!1}},A=async I=>{await X.push({query:{...n.query,page:I.current,page_size:I.pageSize}})};return me(async()=>{if(f.value=l.discussId,f.value||(Array.isArray(n.params.discussId)?f.value=n.params.discussId[0]:f.value=n.params.discussId),!f.value){_e(u,"讨论不存在"),await X.push({name:"discuss"});return}o.value=!0;const I=await Zs(f.value);if(I.code!==0){o.value=!1,N(u,I.code),await X.push({name:"discuss"});return}I.data.tags&&I.data.tags.forEach(k=>{_[k.id]=k}),T.value=Ma(I.data.discuss),w.setTitle(T.value.title+" - "+w.getTitle),P.value=T.value.content,o.value=!1,s=je(()=>n.query,k=>{const L=parseInt(k.page)||c.value.defaultCurrent,$=parseInt(k.page_size)||c.value.defaultPageSize;y=L,b=$,c.value={...c.value,current:y,pageSize:b},h({current:y,pageSize:b},!0)},{immediate:!0})}),Te(()=>{s&&s()}),(I,k)=>{const L=ha,$=ba,D=be,C=we,M=Pl,R=B,H=Pe,Y=We,se=Je,K=Ie,ee=Ve;return j(),E(ee,{loading:o.value},{default:a(()=>[t(K,{class:"dida-main-content"},{default:a(()=>[t(H,{span:8},{default:a(()=>{var Z,re,ne;return[(Z=T.value)!=null&&Z.problemTitle||(re=T.value)!=null&&re.contestTitle?(j(),te("div",or,[t($,{"max-item-width":"300"},{default:a(()=>{var F,G,ve,O,J;return[(F=T.value)!=null&&F.contestTitle?(j(),te(ue,{key:0},[t(L,{to:{name:"contest-detail",params:{contestId:(G=T.value)==null?void 0:G.contestId}}},{default:a(()=>{var le;return[V(q((le=T.value)==null?void 0:le.contestTitle),1)]}),_:1},8,["to"]),(ve=T.value)!=null&&ve.contestProblemIndex?(j(),E(L,{key:0,to:{name:"contest-problem-detail",params:{problemIndex:(O=T.value)==null?void 0:O.contestProblemIndex}}},{default:a(()=>{var le,ge;return[V(q(de(at)((le=T.value)==null?void 0:le.contestProblemIndex))+" - "+q((ge=T.value)==null?void 0:ge.problemTitle),1)]}),_:1},8,["to"])):ae("",!0)],64)):(j(),te(ue,{key:1},[t(L,{to:{name:"discuss-list-problem"}},{default:a(()=>k[4]||(k[4]=[V(" 问题讨论")])),_:1}),t(L,{to:{name:"problem-detail",params:{problemId:(J=T.value)==null?void 0:J.problemId}}},{default:a(()=>{var le;return[V(q((le=T.value)==null?void 0:le.problemTitle),1)]}),_:1},8,["to"])],64))]}),_:1})])):ae("",!0),t(D,{style:{margin:"10px"},header:(ne=T.value)==null?void 0:ne.title,"header-bordered":!0},{default:a(()=>[t(de(Mt),{modelValue:de(P),class:"dida-discuss-content"},null,8,["modelValue"])]),_:1},8,["header"]),(j(!0),te(ue,null,Se(m.value,(F,G)=>(j(),E(D,{key:G,style:{margin:"10px"},"header-bordered":""},{header:a(()=>[t(C,null,{default:a(()=>[z("span",null,q(F.authorNickname),1),z("span",null,q(F.insertTime),1)]),_:2},1024)]),default:a(()=>[t(de(Mt),{modelValue:F.content,class:"dida-discuss-content"},null,8,["modelValue"])]),_:2},1024))),128)),z("div",sr,[t(M,{modelValue:c.value.current,"onUpdate:modelValue":k[0]||(k[0]=F=>c.value.current=F),"page-size":c.value.pageSize,"onUpdate:pageSize":k[1]||(k[1]=F=>c.value.pageSize=F),total:c.value.total,"page-size-options":c.value.pageSizeOptions,"show-page-size":!1,"total-content":U,onChange:A},null,8,["modelValue","page-size","total","page-size-options"])]),z("div",rr,[t(de(Ca),{modelValue:de(p),"onUpdate:modelValue":k[2]||(k[2]=F=>nl(p)?p.value=F:p=F),class:"dida-comment-editor"},null,8,["modelValue"]),z("div",ur,[t(C,null,{default:a(()=>[t(R,{theme:"primary",onClick:x},{default:a(()=>k[5]||(k[5]=[V("提交")])),_:1})]),_:1})])])]}),_:1}),t(H,{span:4},{default:a(()=>[z("div",ir,[v.value?(j(),te("div",cr,[t(R,{onClick:d},{default:a(()=>k[6]||(k[6]=[V("编辑")])),_:1})])):ae("",!0),t(se,{layout:"vertical",bordered:!0},{default:a(()=>[t(Y,{label:"创建时间"},{default:a(()=>{var Z;return[V(q((Z=T.value)==null?void 0:Z.insertTime),1)]}),_:1}),t(Y,{label:"编辑时间"},{default:a(()=>{var Z;return[V(q((Z=T.value)==null?void 0:Z.modifyTime),1)]}),_:1}),t(Y,{label:"更新时间"},{default:a(()=>{var Z;return[V(q((Z=T.value)==null?void 0:Z.updateTime),1)]}),_:1}),t(Y,{label:"创建用户"},{default:a(()=>[t(R,{variant:"text",onClick:k[3]||(k[3]=async()=>{var Z;return await de(Bt)(de(X),(Z=T.value)==null?void 0:Z.authorUsername)})},{default:a(()=>{var Z;return[V(q((Z=T.value)==null?void 0:Z.authorNickname),1)]}),_:1})]),_:1}),t(Y,{label:"标签"},{default:a(()=>[t(C,null,{default:a(()=>{var Z;return[(j(!0),te(ue,null,Se((Z=T.value)==null?void 0:Z.tags,re=>(j(),E(R,{key:re.id,variant:"dashed",onClick:()=>r(re)},{default:a(()=>[V(q(re.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Ut=ce(dr,[["__scopeId","data-v-d691f7ea"]]);function mr(e,l){return W({url:"/rank/ac/all?page="+e+"&page_size="+l,method:"get"})}function pr(e,l){return W({url:"/rank/ac/problem?page="+e+"&page_size="+l,method:"get"})}function fr(e,l){return W({url:"/rank/ac/problem/today?page="+e+"&page_size="+l,method:"get"})}function vr(e,l){return W({url:"/rank/ac/problem/day7?page="+e+"&page_size="+l,method:"get"})}function _r(e,l){return W({url:"/rank/ac/problem/day30?page="+e+"&page_size="+l,method:"get"})}function gr(e,l){return W({url:"/rank/ac/problem/year?page="+e+"&page_size="+l,method:"get"})}const br={style:{margin:"10px"}};function $t(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const hr=ie({__name:"RankUser",props:{type:{}},setup(e){const l=ke(),n=Be(),{globalProperties:u}=pe();let s=null;const w=e,g=i(""),P=i(""),f={all:{header:"统计所有用户在本站的提交记录",content:"优先以AC记录数量排序，如果相同则提交所用次数较少的优先，如果仍相同，注册较早的用户靠前"},problem:{header:"统计所有用户在本站的提交记录",content:"以题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-today":{header:"统计所有用户今日在本站的提交记录",content:"以今日题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-day7":{header:"统计所有用户最近7日在本站的提交记录",content:"以7日题目记录数量排序（从7日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-day30":{header:"统计所有用户最近30日在本站的提交记录",content:"以30日题目记录数量排序（从30日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-year":{header:"统计所有用户最近1年在本站的提交记录",content:"以最近1年题目记录数量排序（从365日前的0点开始计算），如果相同，注册较早的用户靠前"}},o=i([]),T=[{title:"序号",colKey:"index"},{title:"用户名",colKey:"username",cell:(h,A)=>t(B,{variant:"dashed",onClick:()=>v(A.row.username)},{default:()=>[A.row.username]})},{title:"昵称",colKey:"nickname"},{title:"Slogan",colKey:"slogan"}],p=[{title:"题目数量",colKey:"problem_count",cell:(h,A)=>{let I=0;return A.row.problem_count&&(I=A.row.problem_count),t(B,{variant:"dashed",onClick:()=>r(A.row.username)},$t(I)?I:{default:()=>[I]})}}],S=[{title:"正确",colKey:"accept",cell:(h,A)=>{let I=0;return A.row.accept&&(I=A.row.accept),t(B,{variant:"dashed",onClick:()=>r(A.row.username)},$t(I)?I:{default:()=>[I]})}},{title:"提交",colKey:"attempt",cell:(h,A)=>{let I=0;return A.row.attempt&&(I=A.row.attempt),t(B,{variant:"dashed",onClick:()=>d(A.row.username)},$t(I)?I:{default:()=>[I]})}}],y=i(!1);let b=1,c=50;const m=i({current:b,pageSize:c,defaultCurrent:b,defaultPageSize:c,total:0,pageSizeOptions:[50]}),_=i(),v=h=>{n.push({name:"user",params:{username:h}})},r=h=>{n.push({name:"judge-list",query:{username:h,status:Ke.Accept}})},d=h=>{n.push({name:"judge-list",query:{username:h}})},U=async(h,A)=>{y.value=!0;try{_.value=[];const{current:I,pageSize:k}=h;let L=null;switch(w.type){case"problem":L=await pr(I,k);break;case"problem-today":L=await fr(I,k);break;case"problem-day7":L=await vr(I,k);break;case"problem-day30":L=await _r(I,k);break;case"problem-year":L=await gr(I,k);break;default:L=await mr(I,k);break}if(L.code===0){const $=L.data.list;if(!$||$.length<=0){m.value={...m.value,total:0},he(u,"未找到记录");return}_.value=[];const D=m.value.pageSize*(m.value.current-1);let C=1;$.forEach(M=>{var H;const R=M;R.index=D+C++,(H=_.value)==null||H.push(R)}),m.value={...m.value,total:L.data.total_count}}else A&&N(u,L.code)}catch(I){console.error(I),N(u,qe())}finally{y.value=!1}},x=async h=>{await n.push({query:{...l.query,page:h.current,page_size:h.pageSize}})};return me(async()=>{y.value=!0,s=je(()=>l.query,h=>{switch(w.type&&f[w.type]?(g.value=f[w.type].header,P.value=f[w.type].content):(g.value=f.all.header,P.value=f.all.content),w.type){case"all":o.value=T.concat(S);break;default:o.value=T.concat(p);break}const A=parseInt(h.page)||m.value.defaultCurrent,I=parseInt(h.page_size)||m.value.defaultPageSize;b=A,c=I,m.value={...m.value,current:b,pageSize:c},U({current:b,pageSize:c},!0)},{immediate:!0})}),Te(()=>{s&&s()}),(h,A)=>{const I=ze,k=be,L=Pe,$=Ie;return j(),E($,null,{default:a(()=>[t(L,{span:9},{default:a(()=>[t(k,{style:{margin:"10px"}},{default:a(()=>[t(I,{data:_.value,columns:o.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:m.value,loading:y.value,"table-layout":"auto",onPageChange:x},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(L,{span:3},{default:a(()=>[z("div",br,[t(k,{class:"sh-card",header:g.value,"header-bordered":!0},{default:a(()=>[V(q(P.value),1)]),_:1},8,["header"])])]),_:1})]),_:1})}}}),st=ce(hr,[["__scopeId","data-v-13682529"]]),yr={style:{display:"flex","align-items":"center"}},wr={style:{color:"#409eff","margin-right":"20px"}},kr={class:"dida-login-footer"},Cr=ie({__name:"UserForget",setup(e){const{globalProperties:l}=pe(),n=Me(),u=i(!1),s=i(!1),w=i(!1),g=i("发送验证码");let P=null,f=-1;const o=i(!1),T=i(null),p=i(""),S=i({username:"",emailKey:"",password:"",confirmPassword:""}),b=i({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:U=>new Promise(x=>{const h=setTimeout(()=>{x(S.value.password===U),clearTimeout(h)})}),message:"两次密码不一致"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),c=()=>{he(l,"重置成功")},m=async U=>{if(!w.value){u.value=!0,s.value=!0;try{const x=await Mn(U,S.value.username);x.code===0?(he(l,"验证码发送成功"),p.value=x.data,s.value=!1,w.value=!0,P=new Date,g.value="60秒后重发",f=setInterval(()=>{const A=Math.floor((new Date().getTime()-(P==null?void 0:P.getTime()))/1e3);A>60?(g.value="发送验证码",w.value=!1,clearInterval(f)):g.value=`${60-A}秒后重发`},1e3)):N(l,x.code)}catch(x){console.error("Send email key error",x),_e(l,"发送验证码失败")}finally{u.value=!1}}},_=async()=>{var A;if(o.value=!0,w.value||s.value)return;await dt();const U=document.getElementById("cf-confirm-div");U&&U.remove();const x=document.createElement("div");x.id="cf-confirm-div",x.setAttribute("data-theme","light"),(A=T.value)==null||A.appendChild(x);const h=window;h.turnstile.ready(function(){h.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(I){o.value=!1,await m(I)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},v=i(()=>t(B,{onClick:_,disabled:w.value,loading:s.value,style:"width:120px"},{default:()=>[g.value]})),r=async()=>{u.value=!0;try{const U=await En(S.value.username,S.value.password,S.value.emailKey);U.code===0?(he(l,"密码修改成功"),l.$router.push({name:"login"})):N(l,U.code)}catch(U){console.error("Modify password error",U),_e(l,"修改密码失败")}finally{u.value=!1}},d=async({validateResult:U,firstError:x,e:h})=>{if(!u.value){if(h.preventDefault(),U!==!0){_e(l,x);return}p.value?await r():await _()}};return me(()=>{if(n.isLogin()){l.$router.push({path:"/user"});return}}),Te(()=>{}),(U,x)=>{const h=It,A=$e,I=Ue,k=_a,L=B,$=Le,D=nt,C=be,M=lt;return j(),te(ue,null,[t(C,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:a(()=>[t(h,{"max-line":1},{default:a(()=>x[6]||(x[6]=[z("span",null,"如果您未绑定邮箱或忘记用户名，可联系管理员寻求帮助",-1),z("span",null,"管理员邮箱：BoilTask@qq.com",-1)])),_:1}),t($,{ref:"form",rules:b.value,data:S.value,colon:!0,onReset:c,onSubmit:d,class:"yj-login-form"},{default:a(()=>[t(I,{name:"username",label:"用户名"},{default:a(()=>[t(A,{modelValue:S.value.username,"onUpdate:modelValue":x[0]||(x[0]=R=>S.value.username=R),clearable:"",placeholder:"请输入完整用户名"},null,8,["modelValue"])]),_:1}),p.value?(j(),te(ue,{key:0},[t(I,{name:"email",label:"发送邮箱"},{default:a(()=>[t(k,{append:v.value},{default:a(()=>[z("div",yr,[z("span",wr,q(p.value),1)])]),_:1},8,["append"])]),_:1}),t(I,{name:"emailKey",label:"验证码"},{default:a(()=>[t(A,{modelValue:S.value.emailKey,"onUpdate:modelValue":x[1]||(x[1]=R=>S.value.emailKey=R),clearable:"",placeholder:"请输入收到的验证码"},null,8,["modelValue"])]),_:1}),t(I,{name:"password",label:"新密码"},{default:a(()=>[t(A,{modelValue:S.value.password,"onUpdate:modelValue":x[2]||(x[2]=R=>S.value.password=R),type:"password",clearable:"",placeholder:"新密码"},null,8,["modelValue"])]),_:1}),t(I,{name:"confirmPassword",label:"确认密码"},{default:a(()=>[t(A,{modelValue:S.value.confirmPassword,"onUpdate:modelValue":x[3]||(x[3]=R=>S.value.confirmPassword=R),type:"password",clearable:"",placeholder:"请重复输入密码"},null,8,["modelValue"])]),_:1})],64)):ae("",!0),p.value?(j(),E(I,{key:1},{default:a(()=>[t(L,{theme:"primary",type:"submit",block:"",loading:u.value},{default:a(()=>x[7]||(x[7]=[V("修改密码")])),_:1},8,["loading"])]),_:1})):(j(),E(I,{key:2},{default:a(()=>[t(L,{theme:"primary",type:"submit",block:"",loading:u.value},{default:a(()=>x[8]||(x[8]=[V("重置密码")])),_:1},8,["loading"])]),_:1}))]),_:1},8,["rules","data"]),z("div",kr,[t(D,{onClick:x[4]||(x[4]=()=>{de(l).$router.push({name:"login"})})},{default:a(()=>x[9]||(x[9]=[V("返回登陆 ")])),_:1})])]),_:1}),t(M,{visible:o.value,"onUpdate:visible":x[5]||(x[5]=R=>o.value=R),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:a(()=>[z("div",{ref_key:"dialogContainer",ref:T,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),Sr=ce(Cr,[["__scopeId","data-v-d3cb1db8"]]),Ir={class:"judger-status-panel"},Pr={class:"judger-status-panel"};function xr(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}const Vr=ie({__name:"SystemStatus",setup(e){const{globalProperties:l}=pe(),n=i([]),u=i([]),s=i(!1);let w;const g=o=>{let T="失效",p="danger";const S=new Date,y=new Date(o.updateTime);return S.getTime()-y.getTime()>3e4?(T="离线",p="default"):o.cpuUsage>90?(T="CPU过高",p="warning"):o.memPercent>90?(T="内存过高",p="warning"):(T="在线",p="success"),t(we,null,{default:()=>[t("span",null,[o.key,V(" - "),o.name]),t("span",null,[o.updateTime]),t(tt,{theme:p,size:"small"},xr(T)?T:{default:()=>[T]})]})},P=async()=>{const o={};for(let v=0;v<n.value.length;v++){const r=n.value[v];o[r.key]={...r}}const T={};for(let v=0;v<u.value.length;v++){const r=u.value[v];T[r.key]={...r}}const p=[],S=[],y=await Hl();if(y.code!==0){N(l,y.code);return}const b=y.data.web,c={key:"didaoj"};b.name?c.name=b.name:c.name="-",b.update_time?c.updateTime=new Date(b.update_time).toLocaleString():c.updateTime="-",b.cpu_usage?c.cpuUsage=Number(b.cpu_usage):c.cpuUsage=0,b.mem_usage?c.memUsage=b.mem_usage/(1024*1024*1024):c.memUsage=0,b.mem_total?c.memTotal=b.mem_total/(1024*1024*1024):c.memTotal=0,c.memTotal>0?c.memPercent=Math.round(c.memUsage/c.memTotal*1e4)/100:c.memPercent=0,c.avgMessage=b.avg_message;const m=o[c.key];m?(c.cpuUsageFrom=m.cpuUsage,c.memPercentFrom=m.memPercent,c.memUsageFrom=m.memUsage,c.memTotalFrom=m.memTotal):(c.cpuUsageFrom=0,c.memPercentFrom=0,c.memUsageFrom=0,c.memTotalFrom=0),p.push(c),n.value=p;const _=y.data.judger;for(let v=0;v<_.length;v++){const r=_[v],d={key:r.key,name:r.name};r.name?d.name=r.name:d.name="-",r.update_time?d.updateTime=new Date(r.update_time).toLocaleString():d.updateTime="-",r.cpu_usage?d.cpuUsage=Number(r.cpu_usage):d.cpuUsage=0,r.mem_usage?d.memUsage=r.mem_usage/(1024*1024*1024):d.memUsage=0,r.mem_total?d.memTotal=r.mem_total/(1024*1024*1024):d.memTotal=0,d.memTotal>0?d.memPercent=Math.round(d.memUsage/d.memTotal*1e4)/100:d.memPercent=0,d.avgMessage=r.avg_message,T[r.key]?(d.cpuUsageFrom=T[r.key].cpuUsage,d.memPercentFrom=T[r.key].memPercent,d.memUsageFrom=T[r.key].memUsage,d.memTotalFrom=T[r.key].memTotal):(d.cpuUsageFrom=0,d.memPercentFrom=0,d.memUsageFrom=0,d.memTotalFrom=0),S.push(d)}u.value=S},f=async()=>{await P(),s.value=!1};return me(async()=>{u.value=[],n.value=[],s.value=!0,await f(),w=setInterval(()=>{f()},5e3)}),Te(()=>{clearInterval(w)}),(o,T)=>{const p=xl,S=we,y=be,b=Ve;return j(),E(b,{loading:s.value},{default:a(()=>[t(y,{title:"接口状态",class:"judger-status"},{default:a(()=>[z("div",Ir,[(j(!0),te(ue,null,Se(n.value,c=>(j(),E(y,{key:c.key,header:()=>g(c),class:"judge-status-judger"},{footer:a(()=>[z("span",null," 负载信息："+q(c.avgMessage),1)]),default:a(()=>[t(S,{class:"judge-status-judger"},{default:a(()=>[t(p,{title:"CPU使用率",value:c.cpuUsage,animation:{valueFrom:c.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(p,{title:"内存使用率",value:c.memPercent,animation:{valueFrom:c.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(p,{title:"内存使用量",animation:{valueFrom:c.memUsageFrom,duration:2e3},"animation-start":!0,value:c.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(p,{title:"内存总量",value:c.memTotal,animation:{valueFrom:c.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1}),t(y,{title:"判题机状态",class:"judger-status"},{default:a(()=>[z("div",Pr,[(j(!0),te(ue,null,Se(u.value,c=>(j(),E(y,{key:c.key,header:()=>g(c),class:"judge-status-judger"},{footer:a(()=>[z("span",null," 负载信息："+q(c.avgMessage),1)]),default:a(()=>[t(S,{class:"judge-status-judger"},{default:a(()=>[t(p,{title:"CPU使用率",value:c.cpuUsage,animation:{valueFrom:c.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(p,{title:"内存使用率",value:c.memPercent,animation:{valueFrom:c.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(p,{title:"内存使用量",animation:{valueFrom:c.memUsageFrom,duration:2e3},"animation-start":!0,value:c.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(p,{title:"内存总量",value:c.memTotal,animation:{valueFrom:c.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1})]),_:1},8,["loading"])}}}),Tr=ce(Vr,[["__scopeId","data-v-d2b0a05b"]]),Dr=ie({__name:"ManageJudge",setup(e){const{globalProperties:l}=pe(),n=i(!1),u=i(!1),s=i({problemId:"",language:void 0,status:void 0}),w=i(!1),g=i([]);g.value=Ot();const P=i([]);P.value=xa();const f=async()=>{n.value=!0;try{const p=await an();if(p.code!==0){N(l,p.code);return}he(l,"重判成功"),await X.push({name:"judge-list"})}catch(p){console.error(p),N(l,"重判失败")}finally{n.value=!1}},o=async()=>{if(!s.value.problemId&&!s.value.language&&!s.value.status){N(l,"请输入问题Id");return}w.value=!0;try{const p=await ln(s.value.problemId,s.value.language,s.value.status);if(p.code!==0){N(l,p.code);return}he(l,"重判成功"),await X.push({name:"judge-list",query:{problem_id:s.value.problemId,language:s.value.language}})}catch(p){console.error(p),N(l,"重判失败")}finally{w.value=!1}},T=async()=>{u.value=!0;try{const p=await nn();if(p.code!==0){N(l,p.code);return}he(l,"重判成功"),await X.push({name:"judge-list"})}catch(p){console.error(p),N(l,"重判失败")}finally{u.value=!1}};return(p,S)=>{const y=B,b=be,c=$e,m=Ue,_=Kt,v=pt,r=we,d=Le;return j(),te(ue,null,[t(b,{class:"yj-manage-card",title:"重判最近提交"},{default:a(()=>[t(y,{onClick:f,loading:n.value},{default:a(()=>S[3]||(S[3]=[V("重判")])),_:1},8,["loading"])]),_:1}),t(b,{class:"yj-manage-card",title:"重判指定记录"},{default:a(()=>[t(d,{layout:"inline",onSubmit:o},{default:a(()=>[t(m,{label:"题号"},{default:a(()=>[t(c,{modelValue:s.value.problemId,"onUpdate:modelValue":S[0]||(S[0]=U=>s.value.problemId=U),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(m,{label:"语言"},{default:a(()=>[t(v,{modelValue:s.value.language,"onUpdate:modelValue":S[1]||(S[1]=U=>s.value.language=U),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:a(()=>[(j(!0),te(ue,null,Se(g.value,U=>(j(),E(_,{key:U.value,value:U.value,label:U.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"状态"},{default:a(()=>[t(v,{modelValue:s.value.status,"onUpdate:modelValue":S[2]||(S[2]=U=>s.value.status=U),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:a(()=>[(j(!0),te(ue,null,Se(P.value,U=>(j(),E(_,{key:U.value,value:U.value,label:U.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,null,{default:a(()=>[t(r,null,{default:a(()=>[t(y,{theme:"primary",type:"submit",loading:w.value},{default:a(()=>S[4]||(S[4]=[V("重判")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(b,{class:"yj-manage-card",title:"重判所有"},{default:a(()=>[t(y,{onClick:T,theme:"danger",loading:u.value},{default:a(()=>S[5]||(S[5]=[V("重判")])),_:1},8,["loading"])]),_:1})],64)}}}),jr=ce(Dr,[["__scopeId","data-v-6d48cbf2"]]),Lr=ie({__name:"ManageWeb",setup(e){const{globalProperties:l}=pe(),n=i({theme:"",content:""}),u=i({title:"",content:""}),s=i(!1),w=i(!1),g=i(!1);async function P(S,y){g.value=!0,await xt(S,y,l,Bl),g.value=!1}const f=async()=>{w.value=!0;try{const S=await Jl(n.value.theme,n.value.content);if(S.code!==0){N(l,S.code);return}he(l,"保存成功")}catch(S){console.error(S),N(l,"保存失败")}finally{w.value=!1}},o=async()=>{g.value=!0;try{const S=u.value.content,y=await Wl(u.value.title,S);if(y.code!==0){N(l,y.code);return}u.value.content=y.data.content,he(l,"保存成功")}catch(S){console.error(S),_e(l,"保存失败")}finally{g.value=!1}},T=async()=>{n.value=await Sa()},p=async()=>{try{u.value=await Ia()}catch{_e(l,"加载公告失败"),u.value={title:"",content:""}}};return me(async()=>{s.value=!0;try{await T(),await p()}catch{_e(l,"加载数据失败")}s.value=!1}),(S,y)=>{const b=pt,c=Ue,m=$e,_=B,v=we,r=Le,d=be,U=Fe("md-editor-v3"),x=Ve;return j(),E(x,{loading:s.value},{default:a(()=>[t(d,{class:"yj-manage-card",title:"站点通知"},{default:a(()=>[t(r,{onSubmit:f},{default:a(()=>[t(c,{label:"主题"},{default:a(()=>[t(b,{modelValue:n.value.theme,"onUpdate:modelValue":y[0]||(y[0]=h=>n.value.theme=h),options:[{label:"success",value:"success"},{label:"info",value:"info"},{label:"warning",value:"warning"},{label:"error",value:"error"}],placeholder:"请选择主题"},null,8,["modelValue"])]),_:1}),t(c,{label:"内容"},{default:a(()=>[t(m,{modelValue:n.value.content,"onUpdate:modelValue":y[1]||(y[1]=h=>n.value.content=h),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),t(c,null,{default:a(()=>[t(v,null,{default:a(()=>[t(_,{theme:"primary",type:"submit",loading:w.value},{default:a(()=>y[4]||(y[4]=[V("保存")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(d,{class:"yj-manage-card",title:"首页公告"},{actions:a(()=>[t(_,{theme:"primary",loading:g.value,onClick:o},{default:a(()=>y[5]||(y[5]=[V("保存")])),_:1},8,["loading"])]),default:a(()=>[t(r,{onSubmit:o},{default:a(()=>[t(c,{label:"标题"},{default:a(()=>[t(m,{modelValue:u.value.title,"onUpdate:modelValue":y[2]||(y[2]=h=>u.value.title=h),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1}),t(x,{loading:g.value},{default:a(()=>[t(U,{modelValue:u.value.content,"onUpdate:modelValue":y[3]||(y[3]=h=>u.value.content=h),onSave:o,onOnUploadImg:P,previewTheme:"cyanosis",class:"dida-description-editor"},null,8,["modelValue"])]),_:1},8,["loading"])]),_:1})]),_:1},8,["loading"])}}}),Ur=ce(Lr,[["__scopeId","data-v-8c162eb5"]]),Ea=[{name:"problem-list",tab:"problem",sidebar:"problem-list",path:"",title:"问题列表",icon:"list",component:oo},{name:"problem-detail",tab:"problem",sidebar:"problem-list",path:":problemId+",title:"问题详情",icon:"list",component:Lt},{name:"problem-daily-list",tab:"problem",sidebar:"problem-daily-list",path:"daily",title:"每日一题",icon:"list",component:$o},{name:"problem-daily-detail",tab:"problem",sidebar:"problem-daily-list",path:"daily/:dailyId+",title:"问题详情",icon:"list",component:Lt},{name:"problem-recommend",tab:"problem",sidebar:"problem-recommend",path:"recommend/:problemId*",title:"问题推荐",icon:"cpu",needLogin:!0,component:Fo},{name:"problem-collection-list",tab:"problem",sidebar:"problem-collection-list",path:"collection",title:"题目集合",icon:"list",disableTabPath:!0,component:cs},{name:"collection-detail",tab:"collection-detail-tab",sidebar:"collection-detail",path:":collectionId+",title:"题集详情",icon:"cpu",component:vs},{name:"collection-rank",tab:"collection-detail-tab",sidebar:"collection-rank",path:":collectionId+/rank",title:"题集排名",icon:"list",component:_s},{name:"collection-edit",tab:"collection-detail-tab",sidebar:"collection-edit",disableSidebar:!0,needLogin:!0,path:":collectionId+/edit",title:"题集编辑",icon:"list",component:la},{name:"collection-create",tab:"collection-detail-tab",sidebar:"collection-create",needLogin:!0,disableSidebar:!0,path:"create",title:"新建题集",icon:"list",component:la},{name:"judge-list",tab:"judge",sidebar:"judge-list",path:"",title:"评测列表",icon:"list",component:oa},{name:"judge-detail",tab:"judge",sidebar:"judge-list",path:":judgeId+",title:"评测详情",icon:"cpu",component:ra},{name:"contest-list",tab:"contest",sidebar:"contest-list",path:"",title:"比赛列表",icon:"list",component:ua},{name:"contest-recent",tab:"contest",sidebar:"contest-recent",path:"recent",title:"近期比赛",icon:"list",component:ua},{name:"contest-create",tab:"contest",sidebar:"contest-create",disableSidebar:!0,needLogin:!0,path:"create",title:"新建比赛",icon:"list",component:ca},{name:"contest-edit",tab:"contest-detail-tab",sidebar:"contest-edit",disableSidebar:!0,needLogin:!0,path:":contestId+/edit",title:"比赛编辑",icon:"list",component:ca},{name:"contest-detail",tab:"contest-detail-tab",sidebar:"contest-detail",path:":contestId+",title:"比赛详情",icon:"cpu",component:qs},{name:"contest-problem-detail",tab:"contest-detail-tab",sidebar:"contest-problem-detail",path:":contestId+/problem/:problemIndex+",title:"问题详情",icon:"cpu",disableSidebar:!0,component:Lt},{name:"contest-judge",tab:"contest-detail-tab",sidebar:"contest-judge",path:":contestId+/judge",title:"评测列表",icon:"list",component:oa},{name:"contest-judge-detail",tab:"contest-detail-tab",sidebar:"contest-judge-detail",path:":contestId+/judge/:judgeId+",title:"评测详情",icon:"cpu",component:ra,disableSidebar:!0},{name:"contest-rank",tab:"contest-detail-tab",sidebar:"contest-rank",path:":contestId+/rank",title:"比赛排名",icon:"list",component:Hs},{name:"contest-discuss",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss",title:"比赛讨论",icon:"list",component:gt},{name:"contest-discuss-detail",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss/:discussId+",title:"讨论详情",icon:"list",component:Ut},{name:"discuss-list",tab:"discuss",sidebar:"discuss-list",path:"",title:"讨论列表",icon:"list",component:gt},{name:"discuss-list-problem",tab:"discuss",sidebar:"discuss-list-problem",path:"problem",title:"问题讨论",icon:"list",component:gt},{name:"discuss-list-judge",tab:"discuss",sidebar:"discuss-list-judge",path:"judge",title:"评测讨论",icon:"list",component:gt},{name:"discuss-detail",tab:"discuss",sidebar:"discuss-list",path:":discussId+",title:"讨论详情",icon:"list",component:Ut},{name:"rank-ac-all",tab:"rank",sidebar:"rank-ac-all",path:"ac",title:"AC排名",icon:"base-station",props:{type:"all"},component:st},{name:"rank-ac-problem",tab:"rank",sidebar:"rank-ac-problem",path:"ac/problem",title:"题量排名",icon:"base-station",props:{type:"problem"},component:st},{name:"rank-ac-problem-today",tab:"rank",sidebar:"rank-ac-problem-today",path:"ac/problem/today",title:"今日题量",icon:"base-station",props:{type:"problem-today"},component:st},{name:"rank-ac-problem-day7",tab:"rank",sidebar:"rank-ac-problem-day7",path:"ac/problem/day7",title:"7日题量",icon:"base-station",props:{type:"problem-day7"},component:st},{name:"rank-ac-problem-day30",tab:"rank",sidebar:"rank-ac-problem-day30",path:"ac/problem/day30",title:"30日题量",icon:"base-station",props:{type:"problem-day30"},component:st},{name:"rank-ac-problem-year",tab:"rank",sidebar:"rank-ac-problem-year",path:"ac/problem/year",title:"1年题量",icon:"base-station",props:{type:"problem-year"},component:st},{name:"system-status",tab:"system",sidebar:"system-status",path:"",title:"运行状态",icon:"base-station",component:Tr},{name:"system-about",tab:"system",sidebar:"system-about",path:"about",title:"关于",icon:"base-station",props:{discussId:"52"},component:Ut},{name:"manage-problem-create",tab:"manage",sidebar:"manage-problem-create",disableSidebar:!0,path:"problem",title:"新建问题",icon:"list",component:aa,auths:[De.ManageProblem]},{name:"manage-problem",tab:"manage",sidebar:"manage-problem",disableSidebar:!0,path:"problem/:problemId+",title:"问题编辑",icon:"list",component:aa,auths:[De.ManageProblem]},{name:"manage-problem-daily-create",tab:"manage",sidebar:"manage-problem-daily-create",disableSidebar:!0,path:"problem/daily",title:"新建每日一题",icon:"list",component:ta,auths:[De.ManageProblemDaily]},{name:"manage-problem-daily",tab:"manage",sidebar:"manage-problem-daily",disableSidebar:!0,path:"problem/daily/:dailyId+",title:"编辑每日一题",icon:"list",component:ta,auths:[De.ManageProblemDaily]},{name:"manage-problem-judge",tab:"manage",sidebar:"manage-problem-judge",disableSidebar:!0,path:"problem/:problemId+/judge",title:"评测数据",icon:"list",component:Qo,auths:[De.ManageProblem]},{name:"manage-web",tab:"manage",path:"web",sidebar:"manage-web",title:"站点管理",icon:"list",auths:[De.ManageWeb],component:Ur},{name:"manage-judge",tab:"manage",path:"judge",sidebar:"manage-judge",title:"评测管理",icon:"list",auths:["i-manage-judge"],component:jr},{name:"login-forget",tab:"login",path:"forget",title:"忘记密码",component:Sr}],da=(e,l,n,u)=>{u.tab==n&&(u.disableSidebar&&l!=u.sidebar||u.sidebar==null||u.sidebar!=u.name||e.push({name:u.name,title:u.title,icon:u.icon,to:{name:u.name}}))},$r=(e,l)=>{const n=[];return Ea.forEach(u=>{if($a(u)){const s=[];u.children.forEach(w=>{da(s,e,l,w)}),s.length>0&&n.push({title:u.title,children:s})}else da(n,e,l,u)}),n},ma=(e,l)=>{const n=Xn(l.tab),u={name:l.name,path:"/"+l.path,meta:{title:l.title+" - "+n.title,tab:l.tab,sidebar:l.sidebar,showSidebar:n.showSidebar,needLogin:n.needLogin||l.needLogin,tabAuths:n.auths,auths:l.auths},props:l.props,component:l.component};!n.disablePath&&!l.disableTabPath&&(u.path=n.path+u.path),e.push(u)},zr=e=>{Ea.forEach(l=>{$a(l)?l.children.forEach(n=>{ma(e,n)}):ma(e,l)})},Ar={class:"sh-main"},Rr=ie({__name:"View403",setup(e){let l=ke();const n=i("");return me(()=>{l.query.target?n.value=l.query.target:n.value=l.fullPath}),(u,s)=>{const w=B;return j(),te("div",Ar,[z("p",null,q(n.value),1),s[2]||(s[2]=z("p",null,"该页面无访问权限，请更换访问目标或重新登陆后再试",-1)),t(w,{theme:"primary",onClick:s[0]||(s[0]=()=>u.$router.push("/"))},{default:a(()=>s[1]||(s[1]=[V("返回首页")])),_:1})])}}}),qa=ce(Rr,[["__scopeId","data-v-777362b3"]]),_t=[];Qn(_t);zr(_t);_t.push({path:"/403",name:"403",component:qa});_t.push({path:"/:pathMatch(.*)*",name:"404",component:Ua});const X=ol({history:sl("/"),routes:_t});X.beforeEach((e,l,n)=>{if(e.name==null||!X.hasRoute(e.name)){n({name:"home"});return}const u=e.matched[e.matched.length-1].meta;if(u.redirect){n({name:u.redirect});return}if(u.needLogin){const w=Me();if(w.getToken==null||w.getToken==""){n({name:"login",query:{redirect_uri:e.fullPath}});return}}const s=u.tabAuths;if(s&&!Me().hasAllAuths(s)){n({name:"403",query:{target:e.fullPath}});return}n()});X.afterEach((e,l)=>{if(e.name===l.name)return;const n=Vt(),u=Ye();let s=null;if(e.matched.length>0&&(s=e.matched[e.matched.length-1].meta),s!=null&&s.title&&u.setTitle(s==null?void 0:s.title),s!=null&&s.showSidebar){n.setSidebarShow(!0);const w=$r(s==null?void 0:s.sidebar,s==null?void 0:s.tab);n.setMenuList(w),n.setMenuActiveName(s==null?void 0:s.sidebar)}else n.setSidebarShow(!1);window.scrollTo(0,0)});const Ka=mt("login",{state:()=>({Loaded:!1}),getters:{isLoaded(){return this.Loaded}}}),Mr=ie({__name:"HeaderContent",setup(e){const l=Ka(),n=Me(),{globalProperties:u}=pe(),s=i(l.isLoaded),w=i(!1),g=i(n.getUsername),P=i(n.getNickname),f=i(),o=()=>{f.value=Zn(n)};l.$subscribe((S,y)=>{s.value=y.Loaded}),n.$subscribe((S,y)=>{g.value=y.username,P.value=y.nickname,w.value=y.token!="",o()});const T=()=>{u.$router.currentRoute.value.name!=="login"&&u.$router.push({name:"login",query:{redirect_uri:u.$router.currentRoute.value.fullPath}})},p=()=>{n.clear(),u.$message.success({duration:3e3,content:"注销成功"}),u.$router.push({path:"/login",query:{redirect_uri:u.$router.currentRoute.value.fullPath}})};return me(()=>{o()}),(S,y)=>{const b=Fe("router-link"),c=wa,m=ya,_=Vl,v=Tl;return j(),E(v,{modelValue:S.$route.meta.tab,"onUpdate:modelValue":y[0]||(y[0]=r=>S.$route.meta.tab=r),class:"sh-menu","expand-type":"popup"},{logo:a(()=>[t(b,{to:"/",class:"sh-logo"},{default:a(()=>y[1]||(y[1]=[V("DidaOJ")])),_:1})]),operations:a(()=>[s.value&&w.value?(j(),E(_,{key:0,title:P.value},{icon:a(()=>[t(c,{name:"user"})]),default:a(()=>[t(m,{value:"user",to:{path:"/user/"+g.value}},{default:a(()=>y[2]||(y[2]=[V("个人空间")])),_:1},8,["to"]),t(m,{value:"user_logout",onClick:p},{default:a(()=>y[3]||(y[3]=[V(" 注销")])),_:1})]),_:1},8,["title"])):s.value?(j(),E(m,{key:2,value:"login",onClick:T},{icon:a(()=>[t(c,{name:"login"})]),default:a(()=>[y[5]||(y[5]=V(" 登录 "))]),_:1})):(j(),E(m,{key:1,value:"login"},{icon:a(()=>[t(c,{name:"login"})]),default:a(()=>[y[4]||(y[4]=V(" ... "))]),_:1}))]),default:a(()=>[(j(!0),te(ue,null,Se(f.value,r=>(j(),E(m,{key:r.name,value:r.name,to:{name:r.name}},{icon:a(()=>[r.icon?(j(),E(c,{key:0,name:r.icon},null,8,["name"])):ae("",!0)]),default:a(()=>[V(" "+q(r.title),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])}}}),Er=ce(Mr,[["__scopeId","data-v-95e7494b"]]),qr={id:"menu-container"},Kr=ie({__name:"SidebarContent",setup(e){const l=Vt(),n=i(!1),u=i(null),s=i(l.menuActiveName),w=i(l.menuList),g=i([]),P=i(!1),f=()=>{s.value=l.menuActiveName;const T=JSON.stringify(w.value),p=JSON.stringify(l.menuList);T!==p&&(g.value.push([...l.menuList]),o())},o=async()=>{if(g.value.length>0&&!P.value){for(P.value=!0;g.value.length>1;)g.value.shift();const T=g.value.shift();n.value=T.length<=0,w.value=[],await dt(),u.value&&u.value.updateActiveName(),await new Promise(S=>setTimeout(S,300)),w.value=T,await dt(),u.value&&u.value.updateActiveName();const p=300;await new Promise(S=>setTimeout(S,p)),P.value=!1,await o()}};return l.$subscribe((T,p)=>{f()}),me(()=>{f()}),(T,p)=>{const S=wa,y=ya,b=jl,c=Dl,m=Ve;return j(),te(ue,null,[z("div",qr,[t(c,{modelValue:s.value,"onUpdate:modelValue":p[0]||(p[0]=_=>s.value=_),theme:"light",class:"sh-menu-container"},{default:a(()=>[t(rl,{name:"move-left"},{default:a(()=>[(j(!0),te(ue,null,Se(w.value,(_,v)=>(j(),te(ue,{key:v},[de(eo)(_)?(j(),E(b,{key:0,title:_.title},{default:a(()=>[(j(!0),te(ue,null,Se(_.children,(r,d)=>(j(),E(y,{key:r.name,value:r.name,to:r.to},Xt({default:a(()=>[V(" "+q(r.title),1)]),_:2},[r.icon?{name:"icon",fn:a(()=>[t(S,{name:r.icon,class:Rt(r.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))),128))]),_:2},1032,["title"])):(j(),E(y,{key:_.name,value:_.name,to:_.to},Xt({default:a(()=>[V(" "+q(_.title),1)]),_:2},[_.icon?{name:"icon",fn:a(()=>[t(S,{name:_.icon,class:Rt(_.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),t(m,{size:"small",loading:n.value,"show-overlay":!0,attach:"#menu-container",class:"sh-sidebar-loading",style:{"align-items":"flex-start","padding-top":"100px"}},null,8,["loading"])],64)}}}),Fr=ce(Kr,[["__scopeId","data-v-96e2d89f"]]),Or={};function Nr(e,l){return null}const Gr=ce(Or,[["render",Nr]]),Hr={class:"footer"},Br={class:"footer-left"},Jr={class:"foot-time"},Wr={class:"footer-center"},Yr={href:"https://beiancx.miit.gov.cn/",target:"_blank"},Xr={class:"footer-right"},Zr={class:"foot-text"},Qr={href:"https://github.com/hpu-developer/DiDaOJ-web",target:"_blank"},eu={class:"foot-text"},tu={href:"https://github.com/hpu-developer/DiDaOJ-go",target:"_blank"},au=ie({__name:"FooterContent",setup(e){const l=i("");function n(){l.value=new Date().toLocaleString()}return me(()=>{n(),setInterval(()=>{n()},1e3)}),(u,s)=>{const w=B;return j(),te("div",Hr,[z("div",Br,[z("p",Jr,q(l.value),1)]),z("div",Wr,[z("a",Yr,[t(w,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>s[0]||(s[0]=[V("豫ICP备15024677号-4")])),_:1})])]),z("div",Xr,[z("p",Zr,[z("a",Qr,[t(w,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>s[1]||(s[1]=[V("@didaoj-web")])),_:1})])]),z("p",eu,[z("a",tu,[t(w,{theme:"default",variant:"outline",ghost:!0},{default:a(()=>s[2]||(s[2]=[V("@didaoj-go")])),_:1})])])])])}}}),lu=ce(au,[["__scopeId","data-v-44f2e4e7"]]),bt=20,zt=100,At=50,nu=ie({__name:"ForceHiddenSidebarButton",setup(e){let l=Vt();const n=i({x:window.innerWidth-zt-bt,y:window.innerHeight-At-bt}),u=i(window.innerWidth),s=i(window.innerHeight);let w=!1,g={x:0,y:0};const P=_=>{w=!0;const v=_.clientX??_.touches[0].clientX,r=_.clientY??_.touches[0].clientY;g={x:v-n.value.x,y:r-n.value.y},document.addEventListener("mousemove",f),document.addEventListener("touchmove",f),document.addEventListener("mouseup",o),document.addEventListener("touchend",o)},f=_=>{if(!w)return;const v=_.clientX??_.touches[0].clientX,r=_.clientY??_.touches[0].clientY;let d=v-g.x,U=r-g.y;d=Math.max(0,Math.min(d,u.value-zt)),U=Math.max(0,Math.min(U,s.value-At)),n.value={x:d,y:U}},o=()=>{w=!1,document.removeEventListener("mousemove",f),document.removeEventListener("touchmove",f),document.removeEventListener("mouseup",o),document.removeEventListener("touchend",o)},T=()=>{u.value=window.innerWidth,s.value=window.innerHeight,n.value={x:Math.min(n.value.x,u.value-zt-bt),y:Math.min(n.value.y,s.value-At-bt)}};let p=i(l.forceHiddenSidebar),S=i(l.forceHiddenSidebar);const y=()=>{p.value=!p.value,l.setForceHiddenSidebar(p.value)},b=()=>{S.value||(S.value=!0,l.setForceHiddenSidebar(p.value))},c=()=>{S.value&&(S.value=!1,l.setForceHiddenSidebar(!1))},m=_=>{_>=800?c():b()};return m(u.value),je(u,_=>{m(_)}),me(()=>{window.addEventListener("resize",T)}),Te(()=>{window.removeEventListener("resize",T)}),(_,v)=>{const r=B;return de(S)?(j(),E(r,{key:0,class:"draggable-button",style:fa({top:`${n.value.y}px`,left:`${n.value.x}px`}),onMousedown:P,onTouchstart:P,variant:"dashed",theme:"primary",onClick:y},{default:a(()=>[V(q(de(p)?"显示":"隐藏"),1)]),_:1},8,["style"])):ae("",!0)}}}),ou=ce(nu,[["__scopeId","data-v-1aee5506"]]),ht="DidaOJ",su=ie({__name:"App",setup(e){const{globalProperties:l}=pe(),n=Ka(),u=Me(),s=Ye(),w=Vt();n.$patch({Loaded:!1});const g=u.getToken,P=i(!1),f=i(!1);s.title&&s.title.length>0?document.title=s.title+" - "+ht:document.title=ht,s.$subscribe((S,y)=>{y.title&&y.title.length>0?document.title=y.title+" - "+ht:document.title=ht}),w.$subscribe((S,y)=>{P.value=y.showSidebar,f.value=P.value&&!y.forceHiddenSidebar});const o=ke(),T=Ge(()=>{const S=o.meta.auths;return S?!u.hasAllAuths(S):!1});function p(){l.$message.warning({duration:3e3,content:"登陆状态失效"}),n.$patch({Loaded:!0}),u.clear()}return me(()=>{document.addEventListener("DOMContentLoaded",()=>{ul.autoSpacingPage()}),g?jn().then(S=>{S.code==0?(u.loadResponse(S.data),n.$patch({Loaded:!0})):(N(l,S.code),n.$patch({Loaded:!0}),u.clear())}).catch(S=>{console.log(S),p()}):n.$patch({Loaded:!0})}),(S,y)=>{const b=Ll,c=$l,m=Fe("RouterView"),_=zl,v=Ul,r=Al;return j(),te(ue,null,[t(v,{class:"sh-app-layout"},{default:a(()=>[t(b,{class:"sh-header"},{default:a(()=>[t(Er)]),_:1}),t(v,null,{default:a(()=>[t(il,{name:"slide"},{default:a(()=>[f.value?(j(),E(c,{key:0,class:"sh-sidebar"},{default:a(()=>[t(Fr)]),_:1})):ae("",!0)]),_:1}),t(v,{class:Rt(["sh-main-layout",{expanded:!f.value}])},{default:a(()=>[t(Gr),t(_,{class:"sh-main-content"},{default:a(()=>[T.value?(j(),E(qa,{key:0})):(j(),E(m,{key:1}))]),_:1}),t(lu)]),_:1},8,["class"])]),_:1})]),_:1}),P.value?(j(),E(ou,{key:0})):ae("",!0),t(r,{container:"body",offset:["24px","80px"],size:"small"})],64)}}}),ru=ce(su,[["__scopeId","data-v-62ffc342"]]),Fa=cl();Fa.use(dl);const it=ml(ru);it.use(Fa);it.use(X);it.use(Rl);it.use(Ca);it.use(Mt);it.mount("#app");El().then(()=>{console.log("Text cache reinitialized")}).catch(e=>{console.error("Text cache reinitialization failed",e)});
