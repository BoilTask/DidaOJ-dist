import{bm as Je,bn as vt,bo as K,s as a,bp as n,bq as P,br as A,ap as w,n as ae,r as v,bs as pe,bt as F,aD as ne,g as Ot,o as oe,bu as M,bv as ht,bw as Ke,bx as bt,F as Q,by as ce,bz as ie,aM as Kt,bA as tt,bB as at,q as we,y as De,J as Te,bC as yt,c as Se,a0 as Bt,bD as Fe,u as Me,bE as Ee,G as Jt,ac as Xt,bF as Wt,bG as Yt,bH as Zt,bI as Qt,B as ea,bJ as ta}from"./node_modules-CwWekrCs.js";import{C as de,B as G,F as Pe,a as Le,I as ke,L as lt,M as wt,b as kt,S as aa,H as na,c as oa,d as la,e as ve,f as sa,g as ra,A as ua,h as ia,i as ca,j as he,T as xe,R as be,k as me,D as ze,l as Re,m as St,O as Ct,n as st,P as da,o as It,p as Tt,q as Pt,r as ma,s as pa,t as fa,u as _a,v as ga,w as va,x as ha,y as ba,z as ya,E as wa}from"./tdesign-vue-next-ux4DzG2k.js";import{V as le}from"./vditor-DArazWIS.js";import{e as dt}from"./monaco-editor-DCUKHC_e.js";import{H as ka,v as Sa}from"./highlight.js-D9zWiMxS.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const p of l)if(p.type==="childList")for(const h of p.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function o(l){const p={};return l.integrity&&(p.integrity=l.integrity),l.referrerPolicy&&(p.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?p.credentials="include":l.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function r(l){if(l.ep)return;l.ep=!0;const p=o(l);fetch(l.href,p)}})();var Ce=(e=>(e.Manage="i-manage",e.ManageJudge="i-manage-judge",e.ManageProblem="i-manage-problem",e))(Ce||{});const Ca={"r-admin":["i-manage","i-manage-judge","i-manage-problem"]};function Ia(e){if(e==null)return[];const t=[];for(const o of e){const r=Ca[o];r!=null&&t.push(...r)}return[...new Set(t)]}function Ta(e,t){if(e==null||t==null)return!1;const o=Ia(e);for(const r of t)if(!o.includes(r))return!1;return!0}const ge=Je("user",{state:()=>({token:"",userId:-1,username:"",nickname:"",roles:[]}),getters:{getToken(){return this.token},getUserId(){return this.userId},getUsername(){return this.username},getNickname(){return this.nickname}},actions:{clear(){this.$patch({token:"",userId:-1,username:"",nickname:"",roles:[]})},loadResponse(e){this.$patch({token:e.token,userId:e.user_id,username:e.username,nickname:e.nickname,roles:e.roles})},isLogin(){return this.token!=null&&this.token!=""},hasAuth(e){return this.hasAllAuths([e])},hasAllAuths(e){return e?Ta(this.roles,e):!0}},persist:!0}),Pa="https://oj-api.didapipa.com/",Y=vt.create({baseURL:Pa,timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});Y.interceptors.request.use(e=>{const o=ge().getToken;return o&&(e.headers["X-Token"]=o),e},e=>Promise.reject(e));Y.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function Lt(e,t){return Y({url:"/user/login",method:"post",data:{username:e,password:t}})}function La(){return Y({url:"/user/login/refresh",method:"post"})}const xt=Je("login",{state:()=>({Loaded:!1}),getters:{isLoaded(){return this.Loaded}}}),je=Je("webStyle",{state:()=>({title:""}),getters:{getTitle(){return this.title}},actions:{setTitle(e){this.title=e}}}),Xe=Je("sidebarStyle",{state:()=>({showSidebar:!1,forceHiddenSidebar:!1,menuActiveName:"",menuList:[]}),getters:{getMenuList(){return this.menuList}},actions:{setSidebarShow(e){this.showSidebar=e},setForceHiddenSidebar(e){this.forceHiddenSidebar=e},setMenuActiveName(e){this.menuActiveName=e},clearMenuList(){this.menuList=[]},setMenuList(e){this.menuList=e},addMenuList(e){this.menuList.push(e)}}}),ee=(e,t)=>{const o=e.__vccOpts||e;for(const[r,l]of t)o[r]=l;return o},xa={},ja={class:"sh-main"};function Va(e,t){const o=de;return P(),K("div",ja,[a(o,{title:"正在完善，欢迎提供意见建议"},{default:n(()=>t[0]||(t[0]=[A("p",null,[A("a",{href:"https://codeoj.cn/",target:"_blank"},"CodeOJ"),w("的迁移计划")],-1),A("p",null,"正在开发中",-1)])),_:1})])}const $a=ee(xa,[["render",Va],["__scopeId","data-v-e316edac"]]),Da={class:"sh-main"},za=ae({__name:"View404",setup(e){let t=pe(),o=v(t.fullPath);return(r,l)=>{const p=G;return P(),K("div",Da,[A("p",null,F(ne(o)),1),l[2]||(l[2]=A("p",null,"该页面无效或已被迁移，请重新选择访问目标",-1)),a(p,{theme:"primary",onClick:l[0]||(l[0]=()=>r.$router.push("/"))},{default:n(()=>l[1]||(l[1]=[w("返回首页")])),_:1})])}}}),jt=ee(za,[["__scopeId","data-v-d4218944"]]);let nt=null;async function Ra(){nt=await Aa()}function Ua(e,t="zh"){if(nt==null)return[!1,e.toString()];const o=nt[e.toString()];if(!o)return[!1,e.toString()];let r=o[t];return r||(t="zh",r=o[t]),r?[!0,r]:[!1,e.toString()]}async function Aa(){return new Promise((e,t)=>{e({404:{zh:"接口未找到"},1e3:{zh:"系统错误"},10001:{zh:"权限异常，请重新登陆后再试"},10002:{zh:"参数不符合要求"},10003:{zh:"未找到目标数据"},100001:{zh:"用户名不存在或密码不匹配"}})})}function ue(){const{appContext:e}=Ot();return{globalProperties:e.config.globalProperties}}function Ie(){return 1e3}function Vt(e,t,o=3e3){e.$message.success({duration:o,content:t})}function _e(e,t,o=3e3){e.$message.info({duration:o,content:t})}function fe(e,t,o=3e3){e.$message.error({duration:o,content:t})}function N(e,t,o=3e3){const[r,l]=Ua(t),p=r?l:`系统错误，错误提示[${l}]`;e.$message.error({duration:o,content:p})}const Ea={class:"dida-login-footer"},Fa=ae({__name:"LoginView",setup(e){const{globalProperties:t}=ue(),o=ge(),r=v(!1),l=v({account:"",password:""}),p=()=>{_e(t,"重置成功")},h=({validateResult:C,firstError:d})=>{r.value||Lt(l.value.account,l.value.password).then(m=>{if(m.code===0){o.loadResponse(m.data),_e(t,"登录成功");let u=t.$route.query.redirect_uri;u||(u="/user/"+m.data.username),t.$router.push({path:u})}else N(t,m.code)}).catch(m=>{console.error("Login error",m),fe(t,"登录失败")})};return oe(()=>{if(o.isLogin()){t.$router.push({path:"/user"});return}}),(C,d)=>{const m=ke,u=Le,f=G,g=Pe,s=lt,b=de;return P(),M(b,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:n(()=>[a(g,{ref:"form",data:l.value,colon:!0,onReset:p,onSubmit:h,class:"yj-login-form","label-width":0},{default:n(()=>[a(u,{name:"account"},{default:n(()=>[a(m,{modelValue:l.value.account,"onUpdate:modelValue":d[0]||(d[0]=L=>l.value.account=L),clearable:"",placeholder:"请输入账户名"},{"prefix-icon":n(()=>[a(ne(ht))]),_:1},8,["modelValue"])]),_:1}),a(u,{name:"password"},{default:n(()=>[a(m,{modelValue:l.value.password,"onUpdate:modelValue":d[1]||(d[1]=L=>l.value.password=L),type:"password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":n(()=>[a(ne(Ke))]),_:1},8,["modelValue"])]),_:1}),a(u,null,{default:n(()=>[a(f,{theme:"primary",type:"submit",block:"",loading:r.value},{default:n(()=>d[4]||(d[4]=[w("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),A("div",Ea,[a(s,{onClick:d[2]||(d[2]=()=>{ne(t).$router.push({name:"login-forget"})})},{default:n(()=>d[5]||(d[5]=[w("忘记密码")])),_:1}),a(s,{onClick:d[3]||(d[3]=()=>{ne(t).$router.push({name:"register"})})},{default:n(()=>d[6]||(d[6]=[w("注册账户")])),_:1})])]),_:1})}}}),Ma=ee(Fa,[["__scopeId","data-v-9450941b"]]),qa={};function Ga(e,t){return" TODO "}const Na=ee(qa,[["render",Ga]]),Ha={class:"dida-login-footer"},Oa=ae({__name:"RegisterView",setup(e){const{globalProperties:t}=ue(),o=ge(),r=v(!1),l=v({account:"",password:"",confirmPassword:"",email:""}),p=()=>{_e(t,"重置成功")},h=({validateResult:C,firstError:d})=>{r.value||Lt(l.value.account,l.value.password).then(m=>{if(m.code===0){o.loadResponse(m.data),_e(t,"登录成功");let u=t.$route.query.redirect_uri;u||(u="/user/"+m.data.username),t.$router.push({path:u})}else N(t,m.code)}).catch(m=>{console.error("Login error",m),fe(t,"登录失败")})};return oe(()=>{if(o.isLogin()){t.$router.push({path:"/user"});return}}),(C,d)=>{const m=ke,u=Le,f=G,g=Pe,s=lt,b=de;return P(),M(b,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:n(()=>[a(g,{ref:"form",data:l.value,colon:!0,onReset:p,onSubmit:h,class:"yj-login-form","label-width":0},{default:n(()=>[a(u,{name:"account"},{default:n(()=>[a(m,{modelValue:l.value.account,"onUpdate:modelValue":d[0]||(d[0]=L=>l.value.account=L),clearable:"",placeholder:"请输入账户名"},{"prefix-icon":n(()=>[a(ne(ht))]),_:1},8,["modelValue"])]),_:1}),a(u,{name:"password"},{default:n(()=>[a(m,{modelValue:l.value.password,"onUpdate:modelValue":d[1]||(d[1]=L=>l.value.password=L),type:"password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":n(()=>[a(ne(Ke))]),_:1},8,["modelValue"])]),_:1}),a(u,{name:"confirm-password"},{default:n(()=>[a(m,{modelValue:l.value.confirmPassword,"onUpdate:modelValue":d[2]||(d[2]=L=>l.value.confirmPassword=L),type:"password",clearable:"",placeholder:"请确认密码"},{"prefix-icon":n(()=>[a(ne(Ke))]),_:1},8,["modelValue"])]),_:1}),a(u,{name:"email"},{default:n(()=>[a(m,{modelValue:l.value.email,"onUpdate:modelValue":d[3]||(d[3]=L=>l.value.email=L),type:"password",clearable:"",placeholder:"邮箱"},{"prefix-icon":n(()=>[a(ne(Ke))]),_:1},8,["modelValue"])]),_:1}),a(u,null,{default:n(()=>[a(f,{theme:"primary",type:"submit",block:"",loading:r.value},{default:n(()=>d[5]||(d[5]=[w("注册")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),A("div",Ha,[a(s,{onClick:d[4]||(d[4]=()=>{ne(t).$router.push({name:"login"})})},{default:n(()=>d[6]||(d[6]=[w("返回登陆")])),_:1})])]),_:1})}}}),Ka=ee(Oa,[["__scopeId","data-v-e840b450"]]),rt=[{name:"home",path:"/",title:"首页",showSidebar:!1,disableGenerateTab:!0,component:$a},{name:"problem",path:"/problem",title:"题目",icon:"calculation",showSidebar:!0,redirect:"problem-list"},{name:"judge",path:"/judge",title:"评测",icon:"code",showSidebar:!0,redirect:"judge-list"},{name:"contest",path:"/contest",title:"比赛",icon:"application",showSidebar:!0,redirect:"contest-list"},{name:"contest-detail-tab",title:"比赛",path:"/contest",showSidebar:!0,disableGenerateTab:!0,redirect:"contest-list"},{name:"discuss",title:"讨论",path:"/discuss",icon:"sonic",showSidebar:!0,redirect:"discuss-list"},{name:"system",path:"/system",title:"系统",icon:"dashboard",showSidebar:!0,redirect:"system-status"},{name:"manage",path:"/manage",title:"管理",icon:"command",showSidebar:!0,redirect:"manage-judge",auths:[Ce.Manage]},{name:"login",path:"/login",title:"登陆",showSidebar:!1,disableGenerateTab:!0,component:Ma},{name:"register",path:"/register",title:"注册",showSidebar:!1,disableGenerateTab:!0,component:Ka},{name:"user",path:"/user/:username+",title:"用户",showSidebar:!1,needLogin:!0,disableGenerateTab:!0,component:Na},{name:"404",path:"/404",title:"404",showSidebar:!1,disableGenerateTab:!0,component:jt}],Ba=e=>rt.find(t=>t.name==e),Ja=e=>{const t=[];return rt.forEach(o=>{!o.disableGenerateTab&&e.hasAllAuths(o.auths)&&t.push(o)}),t},Xa=e=>{rt.forEach(t=>{const o={name:t.name,path:t.path,meta:{title:t.title,tab:t.name,showSidebar:t.showSidebar,needLogin:t.needLogin,redirect:t.redirect,tabAuths:t.auths},component:t.component};e.push(o)})},Wa=ae({__name:"HeaderContent",setup(e){const t=xt(),o=ge(),{globalProperties:r}=ue(),l=v(t.isLoaded),p=v(!1),h=v(o.getUsername),C=v(o.getNickname),d=v(),m=()=>{d.value=Ja(o)};t.$subscribe((g,s)=>{l.value=s.Loaded}),o.$subscribe((g,s)=>{h.value=s.username,C.value=s.nickname,p.value=s.token!="",m()});const u=()=>{r.$router.currentRoute.value.name!=="login"&&r.$router.push({name:"login",query:{redirect_uri:r.$router.currentRoute.value.fullPath}})},f=()=>{o.clear(),r.$message.success({duration:3e3,content:"注销成功"}),r.$router.push({path:"/login",query:{redirect_uri:r.$router.currentRoute.value.fullPath}})};return oe(()=>{m()}),(g,s)=>{const b=bt("router-link"),L=kt,E=wt,D=aa,O=na;return P(),M(O,{modelValue:g.$route.meta.tab,"onUpdate:modelValue":s[0]||(s[0]=T=>g.$route.meta.tab=T),class:"sh-menu","expand-type":"popup"},{logo:n(()=>[a(b,{to:"/",class:"sh-logo"},{default:n(()=>s[1]||(s[1]=[w("DidaOJ")])),_:1})]),operations:n(()=>[l.value&&p.value?(P(),M(D,{key:0,title:C.value},{icon:n(()=>[a(L,{name:"user"})]),default:n(()=>[a(E,{value:"user",to:{path:"/user/"+h.value}},{default:n(()=>s[2]||(s[2]=[w("个人空间")])),_:1},8,["to"]),a(E,{value:"user_logout",onClick:f},{default:n(()=>s[3]||(s[3]=[w(" 注销")])),_:1})]),_:1},8,["title"])):l.value?(P(),M(E,{key:2,value:"login",onClick:u},{icon:n(()=>[a(L,{name:"login"})]),default:n(()=>[s[5]||(s[5]=w(" 登录 "))]),_:1})):(P(),M(E,{key:1,value:"login"},{icon:n(()=>[a(L,{name:"login"})]),default:n(()=>[s[4]||(s[4]=w(" ... "))]),_:1}))]),default:n(()=>[(P(!0),K(Q,null,ce(d.value,T=>(P(),M(E,{key:T.name,value:T.name,to:{name:T.name}},{icon:n(()=>[T.icon?(P(),M(L,{key:0,name:T.icon},null,8,["name"])):ie("",!0)]),default:n(()=>[w(" "+F(T.title),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])}}}),Ya=ee(Wa,[["__scopeId","data-v-a4891d9b"]]);function $t(e){return e.children!==void 0}function Za(e){return e.children!==void 0}const Qa={id:"menu-container"},en=ae({__name:"SidebarContent",setup(e){const t=Xe(),o=v(!1),r=v(null),l=v(t.menuActiveName),p=v(t.menuList),h=v([]),C=v(!1),d=()=>{l.value=t.menuActiveName;const u=JSON.stringify(p.value),f=JSON.stringify(t.menuList);u!==f&&(h.value.push([...t.menuList]),m())},m=async()=>{if(h.value.length>0&&!C.value){for(C.value=!0;h.value.length>1;)h.value.shift();const u=h.value.shift();o.value=u.length<=0,p.value=[],await we(),r.value&&r.value.updateActiveName(),await new Promise(g=>setTimeout(g,300)),p.value=u,await we(),r.value&&r.value.updateActiveName();const f=300;await new Promise(g=>setTimeout(g,f)),C.value=!1,await m()}};return t.$subscribe((u,f)=>{d()}),oe(()=>{d()}),(u,f)=>{const g=kt,s=wt,b=la,L=oa,E=ve;return P(),K(Q,null,[A("div",Qa,[a(L,{modelValue:l.value,"onUpdate:modelValue":f[0]||(f[0]=D=>l.value=D),theme:"light",class:"sh-menu-container"},{default:n(()=>[a(Kt,{name:"move-left"},{default:n(()=>[(P(!0),K(Q,null,ce(p.value,(D,O)=>(P(),K(Q,{key:O},[ne(Za)(D)?(P(),M(b,{key:0,title:D.title},{default:n(()=>[(P(!0),K(Q,null,ce(D.children,(T,x)=>(P(),M(s,{key:T.name,value:T.name,to:T.to},tt({default:n(()=>[w(" "+F(T.title),1)]),_:2},[T.icon?{name:"icon",fn:n(()=>[a(g,{name:T.icon,class:at(T.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))),128))]),_:2},1032,["title"])):(P(),M(s,{key:D.name,value:D.name,to:D.to},tt({default:n(()=>[w(" "+F(D.title),1)]),_:2},[D.icon?{name:"icon",fn:n(()=>[a(g,{name:D.icon,class:at(D.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),a(E,{size:"small",loading:o.value,"show-overlay":!0,attach:"#menu-container",class:"sh-sidebar-loading",style:{"align-items":"flex-start","padding-top":"100px"}},null,8,["loading"])],64)}}}),tn=ee(en,[["__scopeId","data-v-96e2d89f"]]),an={};function nn(e,t){return null}const on=ee(an,[["render",nn]]),ln={class:"footer"},sn={class:"footer-left"},rn={class:"foot-time"},un={class:"footer-center"},cn={href:"https://boiltask.com",target:"_blank"},dn={class:"footer-right"},mn={class:"foot-text"},pn={href:"https://github.com/hpu-user/DiDaOJ-web",target:"_blank"},fn=ae({__name:"FooterContent",setup(e){const t=v("");function o(){t.value=new Date().toLocaleString()}return oe(()=>{o(),setInterval(()=>{o()},1e3)}),(r,l)=>{const p=G;return P(),K("div",ln,[A("div",sn,[A("p",rn,F(t.value),1)]),A("div",un,[A("a",cn,[a(p,{theme:"default",variant:"outline",ghost:!0},{default:n(()=>l[0]||(l[0]=[w("@BoilTask")])),_:1})])]),A("div",dn,[A("p",mn,[A("a",pn,[a(p,{theme:"default",variant:"outline",ghost:!0},{default:n(()=>l[1]||(l[1]=[w("@didaoj-web")])),_:1})])])])])}}}),_n=ee(fn,[["__scopeId","data-v-400ac98b"]]),Ne=20,Qe=100,et=50,gn=ae({__name:"ForceHiddenSidebarButton",setup(e){let t=Xe();const o=v({x:window.innerWidth-Qe-Ne,y:window.innerHeight-et-Ne}),r=v(window.innerWidth),l=v(window.innerHeight);let p=!1,h={x:0,y:0};const C=D=>{p=!0;const O=D.clientX??D.touches[0].clientX,T=D.clientY??D.touches[0].clientY;h={x:O-o.value.x,y:T-o.value.y},document.addEventListener("mousemove",d),document.addEventListener("touchmove",d),document.addEventListener("mouseup",m),document.addEventListener("touchend",m)},d=D=>{if(!p)return;const O=D.clientX??D.touches[0].clientX,T=D.clientY??D.touches[0].clientY;let x=O-h.x,z=T-h.y;x=Math.max(0,Math.min(x,r.value-Qe)),z=Math.max(0,Math.min(z,l.value-et)),o.value={x,y:z}},m=()=>{p=!1,document.removeEventListener("mousemove",d),document.removeEventListener("touchmove",d),document.removeEventListener("mouseup",m),document.removeEventListener("touchend",m)},u=()=>{r.value=window.innerWidth,l.value=window.innerHeight,o.value={x:Math.min(o.value.x,r.value-Qe-Ne),y:Math.min(o.value.y,l.value-et-Ne)}};let f=v(t.forceHiddenSidebar),g=v(t.forceHiddenSidebar);const s=()=>{f.value=!f.value,t.setForceHiddenSidebar(f.value)},b=()=>{g.value||(g.value=!0,t.setForceHiddenSidebar(f.value))},L=()=>{g.value&&(g.value=!1,t.setForceHiddenSidebar(!1))},E=D=>{D>=800?L():b()};return E(r.value),De(r,D=>{E(D)}),oe(()=>{window.addEventListener("resize",u)}),Te(()=>{window.removeEventListener("resize",u)}),(D,O)=>{const T=G;return ne(g)?(P(),M(T,{key:0,class:"draggable-button",style:yt({top:`${o.value.y}px`,left:`${o.value.x}px`}),onMousedown:C,onTouchstart:C,variant:"dashed",theme:"primary",onClick:s},{default:n(()=>[w(F(ne(f)?"显示":"隐藏"),1)]),_:1},8,["style"])):ie("",!0)}}}),vn=ee(gn,[["__scopeId","data-v-1aee5506"]]),hn={class:"sh-main"},bn=ae({__name:"View403",setup(e){let t=pe();const o=v("");return oe(()=>{t.query.target?o.value=t.query.target:o.value=t.fullPath}),(r,l)=>{const p=G;return P(),K("div",hn,[A("p",null,F(o.value),1),l[2]||(l[2]=A("p",null,"该页面无访问权限，请更换访问目标或重新登陆后再试",-1)),a(p,{theme:"primary",onClick:l[0]||(l[0]=()=>r.$router.push("/"))},{default:n(()=>l[1]||(l[1]=[w("返回首页")])),_:1})])}}}),Dt=ee(bn,[["__scopeId","data-v-8f62f1f8"]]),He="DidaOJ",yn=ae({__name:"App",setup(e){const{globalProperties:t}=ue(),o=xt(),r=ge(),l=je(),p=Xe();o.$patch({Loaded:!1});const h=r.getToken,C=v(!1),d=v(!1);l.title&&l.title.length>0?document.title=l.title+" - "+He:document.title=He,l.$subscribe((g,s)=>{s.title&&s.title.length>0?document.title=s.title+" - "+He:document.title=He}),p.$subscribe((g,s)=>{C.value=s.showSidebar,d.value=C.value&&!s.forceHiddenSidebar});const m=pe(),u=Se(()=>{const g=m.meta.auths;return g?!r.hasAllAuths(g):!1});function f(){t.$message.warning({duration:3e3,content:"登陆状态失效"}),o.$patch({Loaded:!0}),r.clear()}return oe(()=>{if(h==""){o.$patch({Loaded:!0});return}La().then(g=>{g.code==0?(r.loadResponse(g.data),o.$patch({Loaded:!0})):(N(t,g.code),o.$patch({Loaded:!0}),r.clear())}).catch(g=>{console.log(g),f()})}),(g,s)=>{const b=sa,L=ua,E=bt("RouterView"),D=ia,O=ra,T=ca;return P(),K(Q,null,[a(O,null,{default:n(()=>[a(b,{class:"sh-header"},{default:n(()=>[a(Ya)]),_:1}),a(O,null,{default:n(()=>[a(Bt,{name:"slide"},{default:n(()=>[d.value?(P(),M(L,{key:0,class:"sh-sidebar"},{default:n(()=>[a(tn)]),_:1})):ie("",!0)]),_:1}),a(O,{class:at(["sh-main-layout",{expanded:!d.value}])},{default:n(()=>[a(on),a(D,{class:"sh-main-content"},{default:n(()=>[u.value?(P(),M(Dt,{key:0})):(P(),M(E,{key:1}))]),_:1}),a(_n)]),_:1},8,["class"])]),_:1})]),_:1}),C.value?(P(),M(vn,{key:0})):ie("",!0),a(T,{container:"body",offset:["24px","80px"],size:"small"})],64)}}}),wn=ee(yn,[["__scopeId","data-v-851fc4f3"]]);var zt=(e=>(e[e.Unknown=-1]="Unknown",e[e.C=0]="C",e[e.Cpp=1]="Cpp",e[e.Java=2]="Java",e[e.Python=3]="Python",e[e.Pascal=4]="Pascal",e[e.Golang=5]="Golang",e[e.Max=6]="Max",e))(zt||{});function Rt(){const e=[-1,4,5,6];return Object.values(zt).filter(t=>typeof t=="number"&&!e.includes(t)).map(t=>({value:t,label:Ut(t)}))}function kn(e){return e>-1&&e<6}function Ut(e){switch(e){case 0:return"C";case 1:return"C++";case 2:return"Java";case 3:return"Python";case 4:return"Pascal";case 5:return"Golang";default:return"Unknown"}}function ut(e){switch(e){case 0:return"c";case 1:return"cpp";case 2:return"java";case 3:return"python";case 4:return"pascal";case 5:return"golang";default:return"text"}}var te=(e=>(e[e.Init=0]="Init",e[e.Rejudge=1]="Rejudge",e[e.Submitting=2]="Submitting",e[e.Queuing=3]="Queuing",e[e.Compiling=4]="Compiling",e[e.Running=5]="Running",e[e.Accept=6]="Accept",e[e.PE=7]="PE",e[e.WA=8]="WA",e[e.TLE=9]="TLE",e[e.MLE=10]="MLE",e[e.OLE=11]="OLE",e[e.RE=12]="RE",e[e.CE=13]="CE",e[e.CLE=14]="CLE",e[e.JudgeFail=15]="JudgeFail",e[e.SubmitFail=16]="SubmitFail",e[e.Unknown=17]="Unknown",e))(te||{});const Sn=e=>{switch(e){case 0:return"普通评测";case 1:return"特殊评测";default:return"未知"}},Be=e=>{switch(e){case 0:return"等待处理";case 1:return"重新评测";case 2:return"提交中";case 3:return"队列中";case 4:return"编译中";case 5:return"运行中";case 6:return"通过";case 7:return"格式错误";case 8:return"答案错误";case 9:return"超时";case 10:return"内存超限";case 11:return"输出超限";case 12:return"运行错误";case 13:return"编译错误";case 14:return"编译超限";case 15:return"评测失败";case 16:return"提交失败";case 17:return"未知";default:return e}};function Cn(){const e=[17];return Object.values(te).filter(t=>typeof t=="number"&&!e.includes(t)).map(t=>({value:t,label:Be(t)}))}function Ve(e){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return!0;default:return!1}}function At(e){var o;const t={};if(t.id=e.id,t.problemId=e.problem_id,t.status=e.status,Ve(e.status)?t.score="-":t.score=e.score.toString(),e.time?t.time=Math.ceil(e.time/1e6)+"ms":t.time="-",e.memory?t.memory=(e.memory/1024/1024).toFixed(2)+"MB":t.memory="-",t.language=Ut(e.language),t.codeLength=e.code_length,e.approve_time?t.approveTime=new Date(e.approve_time).toLocaleString():t.approveTime="-",t.author=e.author,t.authorUsername=e.author_username,t.authorNickname=e.author_nickname,t.code=e.code,t.compileMessage=e.compile_message,t.taskCurrent=e.task_current,t.taskTotal=e.task_total,t.task=[],e.task)for(let r=0;r<((o=e.task)==null?void 0:o.length);r++){const l=e.task[r],p={};p.taskId=l.task_id,p.status=l.status,l.time?p.time=Math.ceil(l.time/1e6)+"ms":p.time="-",l.memory?p.memory=(l.memory/1024/1024).toFixed(2)+"MB":p.memory="-",p.score=l.score,p.content=l.content,p.waHint=l.wa_hint,!p.content&&!p.waHint&&(p.content="无提示信息"),t.task.push(p)}return e.judger&&(t.judger=e.judger),e.judge_time&&(t.judgeTime=new Date(e.judge_time).toLocaleString()),t}function In(e,t,o,r,l){return Y({url:"/judge/approve",method:"post",data:{problem_id:e,contest_id:t,problem_index:o,language:r,code:l}})}function Tn(e){return Y({url:"/judge?id="+e,method:"get"})}function Pn(e){return Y({url:"/judge/code?id="+e,method:"get"})}function Ln(e,t,o,r,l,p){const h=new URLSearchParams({problem_id:e,username:t,language:String(o),status:String(r),page:String(l),page_size:String(p)});return Y({url:`/judge/list?${h.toString()}`,method:"get"})}function xn(){return Y({url:"/judge/rejudge/recently",method:"post"})}function jn(e){return Y({url:"/judge/rejudge/problem",method:"post",data:{id:e}})}function Vn(){return Y({url:"/judge/rejudge/all",method:"post",timeout:0})}function $n(e){return Y({url:"/judge/rejudge",method:"post",data:{id:Number(e)}})}var ot=(e=>(e[e.None=0]="None",e[e.Attempt=1]="Attempt",e[e.Accept=2]="Accept",e))(ot||{});function We(e,t){const o={};if(o.id=e.id,o.author=e.author,o.title=e.title,o.tags=[],e.tags)for(const r of e.tags){const l=t[r];l&&o.tags.push(l)}return o.accept=e.accept,o.attempt=e.attempt,e.description!=null&&(o.description=e.description),e.time_limit!=null&&(o.timeLimit=e.time_limit.toString()+" ms"),e.memory_limit!=null&&(o.memoryLimit=(e.memory_limit/1024).toFixed(2)+" MB"),e.judge_type!=null&&(o.judgeType=Sn(e.judge_type)),e.insert_time!=null&&(o.insertTime=new Date(e.insert_time).toLocaleString()),e.update_time!=null&&(o.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(o.creatorNickname=e.creator_nickname),e.source!=null&&(o.source=e.source),e.judge_md5!=null&&(o.judgeMd5=e.judge_md5),o}function Et(e,t,o){const r={};return e?r.id=e:(r.contest_id=t,r.problem_index=o),Y({url:`/problem?${new URLSearchParams(r).toString()}`,method:"get"})}function Ft(e){return Y({url:"/problem/tag/list?max_count="+e,method:"get"})}function Dn(e){return Y({url:"/problem/judge?id="+e,method:"get"})}function zn(e,t,o,r){return Y({url:"/problem/list?title="+e+"&tag="+t+"&page="+o+"&page_size="+r,method:"get"})}function Rn(e,t,o,r,l,p,h){return Y({url:"/problem/edit",method:"post",data:{id:e,title:t,time_limit:o,memory_limit:r,source:l,tags:p,description:h}})}function Un(e,t){return Y({url:"/problem/judge/data/download?id="+e+"&key="+t,method:"get"})}function An(e,t){const o=new FormData;return o.append("id",e),o.append("zip",t),Y({url:"/problem/judge/data",method:"post",data:o,headers:{"Content-Type":"multipart/form-data"},timeout:1e3*60*5})}const En={style:{margin:"10px"}};function Fn(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Me(e)}const Mn=ae({__name:"ProblemList",setup(e){const t=pe(),o=Fe(),{globalProperties:r}=ue();let l=null;const p=v(!1),h={};let C={};const d=v([{title:"ID",colKey:"id",cell:(k,V)=>{let j=D(V.row.id);return a(G,{variant:"dashed",theme:j,onClick:()=>E(V.row.id)},{default:()=>[V.row.id]})}},{title:"标题",colKey:"title",cell:(k,V)=>a(G,{variant:"text",onClick:()=>E(V.row.id)},{default:()=>[V.row.title]})},{title:"标签",colKey:"tags",cell:(k,V)=>{const j=V.row.tags;if(!j||j.length===0)return"";let y=[];for(let c=0;c<j.length;c++){const i=j[c];y.push(a(G,{key:c,theme:"default",variant:"outline"},{default:()=>[i.name]}))}return a(me,null,Fn(y)?y:{default:()=>[y]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),m=v(!1);let u=1,f=50;const g=v({current:u,pageSize:f,defaultCurrent:u,defaultPageSize:f,total:0,pageSizeOptions:[50,100]}),s=v(),b=v(),L=v({title:"",tag:""}),E=k=>{k&&o.push({path:"/problem/"+k})},D=k=>{if(!k||!C)return"default";const V=C[k];if(!V)return"default";switch(V){case ot.Accept:return"success";case ot.Attempt:return"warning";default:return"default"}},O=async()=>{await o.push({query:{...t.query,title:L.value.title,tag:L.value.tag,page:1,page_size:g.value.defaultPageSize}})},T=k=>{k&&o.push({query:{...t.query,title:"",tag:k.name,page:1,page_size:g.value.defaultPageSize}})},x=async(k,V)=>{m.value=!0;try{const{current:j,pageSize:y}=k,c=await zn(L.value.title,L.value.tag,j,y);if(s.value=[],c.code===0){const i=c.data.list;if(!i||i.length<=0){g.value={...g.value,total:0},C=null,_e(r,"未找到记录");return}i.forEach(_=>{var I;const S=We(_,h);(I=s.value)==null||I.push(S)}),g.value={...g.value,total:c.data.total_count},C=c.data.problem_attempt_status}else V&&N(r,c.code)}catch(j){console.error(j),N(r,Ie())}finally{m.value=!1}},z=async k=>{await o.push({query:{...t.query,page:k.current,page_size:k.pageSize}})};return oe(async()=>{m.value=!0,b.value=[],Ft(-1).then(k=>{if(k.code===0){b.value=k.data.list,p.value=k.data.total_count>k.data.list.length;for(let V=0;V<k.data.list.length;V++){const j=k.data.list[V];h[j.id]=j}l=De(()=>t.query,V=>{L.value.title=V.title||"",L.value.tag=V.tag||"";const j=parseInt(V.page)||g.value.defaultCurrent,y=parseInt(V.page_size)||g.value.defaultPageSize;u=j,f=y,g.value={...g.value,current:u,pageSize:f},x({current:u,pageSize:f},!0)},{immediate:!0})}else p.value=!0}).catch(k=>{console.error(k),p.value=!0})}),Te(()=>{l&&l()}),(k,V)=>{const j=xe,y=de,c=he,i=ke,_=Le,S=G,I=Pe,U=be;return P(),M(U,null,{default:n(()=>[a(c,{span:9},{default:n(()=>[a(y,{style:{margin:"10px"}},{default:n(()=>[a(j,{data:s.value,columns:d.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:g.value,loading:m.value,onPageChange:z},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),a(c,{span:3},{default:n(()=>[A("div",En,[a(y,{class:"sh-card"},{default:n(()=>[a(I,{model:L.value},{default:n(()=>[a(_,{label:"标题"},{default:n(()=>[a(i,{modelValue:L.value.title,"onUpdate:modelValue":V[0]||(V[0]=R=>L.value.title=R),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),a(_,{label:"标签"},{default:n(()=>[a(i,{modelValue:L.value.tag,"onUpdate:modelValue":V[1]||(V[1]=R=>L.value.tag=R),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),a(_,null,{default:n(()=>[a(S,{theme:"primary",onClick:O},{default:n(()=>V[3]||(V[3]=[w("搜索")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(y,{class:"sh-card sh-background-black"},{default:n(()=>[(P(!0),K(Q,null,ce(b.value,R=>(P(),M(S,{class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:()=>T(R)},{default:n(()=>[w(F(R.name),1)]),_:2},1032,["onClick"]))),256)),p.value?(P(),M(S,{key:0,class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:V[2]||(V[2]=()=>k.$router.push("/problem/tags"))},{default:n(()=>V[4]||(V[4]=[w(" ... ")])),_:1})):ie("",!0)]),_:1})])]),_:1})]),_:1})}}}),qn=ee(Mn,[["__scopeId","data-v-0d640f14"]]);function $e(e){e.querySelectorAll("pre > code:not([data-copy-attached])").forEach(o=>{o.setAttribute("data-copy-attached","true");const r=o.parentElement,l=document.createElement("div");l.className="copy-wrapper";const p=document.createElement("button");p.className="copy-btn",p.innerText="复制",p.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(o.innerText),p.innerText="已复制",setTimeout(()=>p.innerText="复制",1500)}catch{p.innerText="失败"}}),r.replaceWith(l),l.appendChild(p),l.appendChild(r)})}function Ye(e){let t="";for(;e>0;)e--,t=String.fromCharCode(65+e%26)+t,e=Math.floor(e/26);return t}async function Mt(e){const t={};if(t.id=e.id,t.ownerId=e.owner_id,t.ownerUsername=e.owner_username,t.ownerNickname=e.owner_nickname,t.title=e.title,t.startTime=new Date(e.start_time).toLocaleString(),t.endTime=new Date(e.end_time).toLocaleString(),e.descriptions){t.descriptions=[];const o={math:{inlineDigit:!0,engine:"KaTeX"}};for(let r=0;r<e.descriptions.length;r++){const l=e.descriptions[r],p={};p.title=l.title,p.content=await le.md2html(l.content,o),p.sort=l.sort,t.descriptions.push(p)}}if(t.notification=e.notification,e.problems){t.problems=[],e.problems.sort((o,r)=>o.index-r.index);for(let o=0;o<e.problems.length;o++){const r=e.problems[o];r.accept||(r.accept=0),r.attempt||(r.attempt=0),r.id=Ye(r.index),t.problems.push(r)}}return t}function Gn(e){return Y({url:"/contest?id="+e,method:"get"})}function Nn(e,t){return Y({url:"/contest/list?page="+e+"&page_size="+t,method:"get"})}function Hn(e){return Y({url:"/contest/create",method:"post",data:e})}const On=["innerHTML"],Kn={style:{margin:"12px"}},Bn={key:0,class:"dida-edit-container"},Jn={class:"dida-operation-container"},Xn={class:"dida-code-submit-div"},Wn=ae({__name:"ProblemDetail",setup(e){let t=pe();const{globalProperties:o}=ue(),r=je(),l=ge();let p=v(""),h="",C=0,d=0;const m=v(null),u=v(!1),f=v(null);let g=null;const s=v(null),b={},L=v(""),E=v([]);E.value=Rt();const D=Se(()=>l.hasAuth(Ce.ManageProblem)),O=y=>{y&&H.push({name:"problem-list",query:{...t.query,title:"",tag:y.name}})},T=()=>{H.push({name:"manage-problem",params:{problemId:h}})},x=()=>{h?H.push({name:"judge-list",query:{problem_id:h}}):H.push({name:"contest-judge-list",params:{contestId:C,problemIndex:d}})},z=()=>{h?H.push({name:"discuss-list-problem",query:{problem_id:h}}):H.push({name:"contest-discuss",params:{contestId:C},query:{problem_id:Ye(d)}})},k=()=>{H.push({name:"problem-recommend",params:{problemId:h}})},V=async()=>{if(!h){fe(o,"问题ID无效");return}const y=parseInt(L.value);if(!kn(y)){fe(o,"请选择所编写的语言");return}const c=g==null?void 0:g.getValue();if(!c){fe(o,"请输入所需提交的代码");return}const i=await In(h,C,d,y,c);if(i.code!==0){N(o,i.code);return}_e(o,"提交成功，正在跳转到详情页面");const _=i.data.id;await H.push({path:"/judge/"+_})},j=y=>{g&&dt.setModelLanguage(g.getModel(),ut(y))};return oe(async()=>{if(Array.isArray(t.params.problemId)?h=t.params.problemId[0]:h=t.params.problemId,!h){if(Array.isArray(t.params.contestId)?C=t.params.contestId[0]:C=t.params.contestId,!C){fe(o,"题目不存在"),await H.push({name:"problem"});return}if(Array.isArray(t.params.problemIndex)?d=parseInt(t.params.problemIndex[0]):d=parseInt(t.params.problemIndex),!d){fe(o,"题目不存在"),await H.push({name:"problem"});return}}u.value=!0;let y=await Et(h,C,d);if(y.code!==0){u.value=!1,N(o,y.code),await H.push({name:"problem"});return}y.data.tags&&y.data.tags.forEach(_=>{b[_.id]=_}),f.value=We(y.data.problem,b),r.setTitle(f.value.title+" - "+r.getTitle);let c=f.value.description;const i={math:{inlineDigit:!0,engine:"KaTeX"}};p.value=await le.md2html(c,i),await we(()=>{m.value&&(le.mathRender(m.value),le.highlightRender({lineNumber:!0,enable:!0},m.value),$e(m.value),s.value&&(g=dt.create(s.value,{value:"",language:"cpp",minimap:{enabled:!0},colorDecorators:!0,readOnly:!1,theme:"vs-dark"}))),u.value=!1})}),(y,c)=>{const i=de,_=he,S=G,I=Re,U=me,R=ze,X=Ct,B=St,q=be,W=ve;return P(),M(W,{loading:u.value},{default:n(()=>[a(q,{class:"dida-main-content"},{default:n(()=>[a(_,{span:8},{default:n(()=>[a(i,{style:{margin:"10px"}},{default:n(()=>[A("div",{innerHTML:ne(p),ref_key:"markdownRef",ref:m},null,8,On)]),_:1})]),_:1}),a(_,{span:4},{default:n(()=>[A("div",Kn,[D.value?(P(),K("div",Bn,[a(S,{onClick:T},{default:n(()=>c[1]||(c[1]=[w("编辑")])),_:1})])):ie("",!0),a(R,{layout:"vertical",bordered:!0},{default:n(()=>[a(I,{label:"标题"},{default:n(()=>{var $;return[w(F(($=f.value)==null?void 0:$.title),1)]}),_:1}),a(I,{label:"时间限制"},{default:n(()=>{var $;return[w(F(($=f.value)==null?void 0:$.timeLimit),1)]}),_:1}),a(I,{label:"内存限制"},{default:n(()=>{var $;return[w(F(($=f.value)==null?void 0:$.memoryLimit),1)]}),_:1}),a(I,{label:"判题方式"},{default:n(()=>{var $;return[w(F(($=f.value)==null?void 0:$.judgeType),1)]}),_:1}),a(I,{label:"正确提交"},{default:n(()=>{var $;return[w(F(($=f.value)==null?void 0:$.accept),1)]}),_:1}),a(I,{label:"提交总数"},{default:n(()=>{var $;return[w(F(($=f.value)==null?void 0:$.attempt),1)]}),_:1}),a(I,{label:"创建时间"},{default:n(()=>{var $;return[w(F(($=f.value)==null?void 0:$.insertTime),1)]}),_:1}),a(I,{label:"更新时间"},{default:n(()=>{var $;return[w(F(($=f.value)==null?void 0:$.updateTime),1)]}),_:1}),a(I,{label:"上传用户"},{default:n(()=>{var $;return[w(F(($=f.value)==null?void 0:$.creatorNickname),1)]}),_:1}),a(I,{label:"题目来源"},{default:n(()=>{var $;return[w(F(($=f.value)==null?void 0:$.source),1)]}),_:1}),ne(h)?(P(),M(I,{key:0,label:"标签"},{default:n(()=>[a(U,null,{default:n(()=>{var $;return[(P(!0),K(Q,null,ce(($=f.value)==null?void 0:$.tags,se=>(P(),M(S,{key:se.id,variant:"dashed",onClick:()=>O(se)},{default:n(()=>[w(F(se.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})):ie("",!0)]),_:1}),A("div",Jn,[a(U,null,{default:n(()=>[a(S,{onClick:x},{default:n(()=>c[2]||(c[2]=[w("提交记录")])),_:1}),a(S,{onClick:z},{default:n(()=>c[3]||(c[3]=[w("题目讨论")])),_:1}),ne(h)?(P(),M(S,{key:0,onClick:k},{default:n(()=>c[4]||(c[4]=[w("题目推荐")])),_:1})):ie("",!0)]),_:1})]),A("div",Xn,[a(U,null,{default:n(()=>[a(B,{modelValue:L.value,"onUpdate:modelValue":c[0]||(c[0]=$=>L.value=$),label:"语言：",placeholder:"请选择提交语言","auto-width":"",clearable:"",onChange:j},{default:n(()=>[(P(!0),K(Q,null,ce(E.value,$=>(P(),M(X,{key:$.value,value:$.value,label:$.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),a(S,{onClick:V},{default:n(()=>c[5]||(c[5]=[w("提交")])),_:1})]),_:1}),A("div",{ref_key:"codeEditRef",ref:s,class:"dida-code-editor"},null,512)])])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),mt=ee(Wn,[["__scopeId","data-v-2307df15"]]),Yn={};function Zn(e,t){return" TODO "}const Qn=ee(Yn,[["render",Zn]]),eo=["innerHTML"];function to(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Me(e)}const ao=ae({__name:"JudgeJobList",setup(e){const t=pe(),o=Fe(),{globalProperties:r}=ue();let l=!1,p=null;const h=v(!1),C=v(null),d=v(null),m=v(!1),u=v({problemId:"",username:"",language:void 0,status:void 0}),f=v([{title:"ID",colKey:"id",cell:(i,_)=>a(G,{variant:"text",onClick:()=>z(_.row.id)},{default:()=>[_.row.id]})},{title:"问题",colKey:"problemId",cell:(i,_)=>a(G,{variant:"text",onClick:()=>x(_.row.problemId)},{default:()=>[_.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(i,_)=>{const S=_.row.status,I=Be(S);let U;switch(S){case te.Init:case te.Rejudge:case te.Compiling:case te.Running:U="default";break;case te.Accept:U="success";break;case te.PE:U="warning";break;default:U="danger";break}let R=[];return Ve(S)&&R.push(a(ve,{text:_.row.state,size:"small",class:"dida-status-loading"},null)),R.push(a("span",null,[I])),a(G,{theme:U,variant:"outline",onClick:()=>z(_.row.id)},to(R)?R:{default:()=>[R]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"code",cell:(i,_)=>a(G,{theme:"default",onClick:()=>T(_.row)},{default:()=>[_.row.language+" / "+_.row.codeLength]})},{title:"作者",colKey:"author",width:200,cell:(i,_)=>a(G,{variant:"text",onClick:()=>k(_.row.authorUsername)},{default:()=>[_.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),g=v(!1);let s=1,b=50;const L=v({current:s,pageSize:b,defaultCurrent:s,defaultPageSize:b,total:0,pageSizeOptions:[50,100]}),E=v(),D=v([]);D.value=Rt();const O=v([]);O.value=Cn();const T=async i=>{m.value=!0,h.value=!0;try{C.value=i;const _=await Pn(C.value.id);if(_.code===0){const S=_.data,U=`\`\`\`${ut(S.language)}
${S.code}
\`\`\``,R={};C.value.code=await le.md2html(U,R),await we(()=>{d.value&&(le.highlightRender({lineNumber:!0,enable:!0},d.value),$e(d.value))})}else N(r,_.code)}finally{m.value=!1}},x=i=>{i&&o.push({path:"/problem/"+i})},z=i=>{i&&o.push({name:"judge-detail",params:{judgeId:i}})},k=i=>{i&&o.push({path:"/user/"+i})},V=async()=>{await o.push({query:{...t.query,page:1,page_size:b,problem_id:u.value.problemId,username:u.value.username,language:u.value.language,status:u.value.status}})},j=async()=>{u.value.problemId="",u.value.username="",u.value.language=void 0,u.value.status=void 0,await o.push({query:{...t.query,page:1,page_size:b,problem_id:"",username:"",language:void 0,status:void 0}})},y=async(i,_)=>{_&&(g.value=!0);let S=!1;try{const{current:I,pageSize:U}=i,R=await Ln(u.value.problemId,u.value.username,u.value.language,u.value.status,I,U);E.value=[],R.code===0?R.data.list&&R.data.list.length>0?(R.data.list.forEach(B=>{var W;const q=At(B);(W=E.value)==null||W.push(q),Ve(B.status)&&(S=!0)}),L.value={...L.value,total:R.data.total_count}):(_e(r,"未找到记录"),L.value={...L.value,total:0}):_&&N(r,R.code)}catch(I){console.error(I),_&&N(r,Ie())}finally{_&&(g.value=!1),S&&l&&setTimeout(()=>{y({current:s,pageSize:b},!1)},5e3)}},c=async i=>{await o.push({query:{...t.query,page:i.current,page_size:i.pageSize}})};return oe(async()=>{l=!0,p=De(()=>t.query,i=>{u.value.problemId=i.problem_id||"",u.value.username=i.username||"",i.language!=null?u.value.language=Number(i.language):u.value.language=void 0,i.status!=null?u.value.status=Number(i.status):u.value.status=void 0;const _=parseInt(i.page)||L.value.defaultCurrent,S=parseInt(i.page_size)||L.value.defaultPageSize;s=_,b=S,L.value.pageSizeOptions.includes(b)||(b=L.value.defaultPageSize),L.value={...L.value,current:s,pageSize:b},y({current:s,pageSize:b},!0)},{immediate:!0})}),Te(()=>{l=!1,p&&p()}),(i,_)=>{const S=ke,I=Le,U=Ct,R=St,X=G,B=me,q=Pe,W=xe,$=de,se=lt,Z=ve,re=st;return P(),K(Q,null,[a($,{style:{margin:"10px"}},{default:n(()=>[a(q,{layout:"inline",onSubmit:V,onReset:j},{default:n(()=>[a(I,{label:"题号"},{default:n(()=>[a(S,{modelValue:u.value.problemId,"onUpdate:modelValue":_[0]||(_[0]=J=>u.value.problemId=J),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),a(I,{label:"用户"},{default:n(()=>[a(S,{modelValue:u.value.username,"onUpdate:modelValue":_[1]||(_[1]=J=>u.value.username=J),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),a(I,{label:"语言"},{default:n(()=>[a(R,{modelValue:u.value.language,"onUpdate:modelValue":_[2]||(_[2]=J=>u.value.language=J),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:n(()=>[(P(!0),K(Q,null,ce(D.value,J=>(P(),M(U,{key:J.value,value:J.value,label:J.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(I,{label:"状态"},{default:n(()=>[a(R,{modelValue:u.value.status,"onUpdate:modelValue":_[3]||(_[3]=J=>u.value.status=J),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:n(()=>[(P(!0),K(Q,null,ce(O.value,J=>(P(),M(U,{key:J.value,value:J.value,label:J.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(I,null,{default:n(()=>[a(B,null,{default:n(()=>[a(X,{theme:"primary",type:"submit"},{default:n(()=>_[7]||(_[7]=[w("搜索")])),_:1}),a(X,{theme:"default",variant:"base",type:"reset"},{default:n(()=>_[8]||(_[8]=[w("重置")])),_:1})]),_:1})]),_:1})]),_:1}),a(W,{data:E.value,columns:f.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:L.value,loading:g.value,onPageChange:c,"table-layout":"auto"},null,8,["data","columns","pagination","loading"])]),_:1}),a(re,{visible:h.value,"onUpdate:visible":_[5]||(_[5]=J=>h.value=J),width:"800px","cancel-btn":null,"close-btn":!1,onConfirm:_[6]||(_[6]=J=>h.value=!1)},{header:n(()=>[a(se,{onClick:_[4]||(_[4]=()=>{var J;z((J=C.value)==null?void 0:J.id)})},{default:n(()=>{var J,Ue;return[w(F(((J=C.value)==null?void 0:J.id)+" - "+((Ue=C.value)==null?void 0:Ue.language)),1)]}),_:1})]),default:n(()=>[a(Z,{loading:m.value},{default:n(()=>{var J;return[A("div",{innerHTML:(J=C.value)==null?void 0:J.code,ref_key:"markdownCodeRef",ref:d,style:{"min-height":"100px"}},null,8,eo)]}),_:1},8,["loading"])]),_:1},8,["visible"])],64)}}}),no=ee(ao,[["__scopeId","data-v-90a4dfd1"]]),Ze=vt.create({timeout:6e4,withCredentials:!1,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});Ze.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function oo(){return Ze({baseURL:"https://r2-oj.didapipa.com",url:"/status/judger.json?"+Date.now(),method:"get"})}function qt(e){return Ze({baseURL:"https://r2-oj.didapipa.com",url:"/status/judger/"+e+".json?"+Date.now(),method:"get"})}function lo(e){return Ze({baseURL:"https://r2-oj.didapipa.com",url:"/status/web.json?"+Date.now(),method:"get"})}const so=["innerHTML"],ro={key:2,class:"dida-edit-container"};function pt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Me(e)}const uo=ae({__name:"JudgeJobDetail",setup(e){const t=pe(),o=Fe(),r=ge(),{globalProperties:l}=ue();let p=!1,h=-1;const C=v(""),d=v(null),m=v(""),u=v(null),f=v(0),g=v(null),s=v({from:"#5a96ff",to:"#00A870"});let b=!1;const L=v([{title:"ID",colKey:"id"},{title:"问题",colKey:"problemId",cell:(y,c)=>a(G,{variant:"text",onClick:()=>z(c.row.problemId)},{default:()=>[c.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(y,c)=>{const i=c.row.status,_=Be(i);let S;switch(i){case te.Init:case te.Rejudge:case te.Compiling:case te.Running:S="default";break;case te.Accept:S="success";break;case te.PE:S="warning";break;default:S="danger";break}let I=[];return Ve(i)&&I.push(a(ve,{text:c.row.state,size:"small",class:"dida-status-loading"},null)),I.push(a("span",null,[_])),a(G,{theme:S,variant:"outline"},pt(I)?I:{default:()=>[I]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"language",cell:(y,c)=>a("span",null,[c.row.language+" / "+c.row.codeLength])},{title:"作者",colKey:"author",width:200,cell:(y,c)=>a(G,{variant:"text",onClick:()=>k(c.row.authorUsername)},{default:()=>[c.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),E=v(!1),D=v(!1),O=v(),T=Se(()=>r.hasAuth(Ce.ManageJudge)),x=async()=>{if(!D.value){D.value=!0;try{const y=await $n(h);y.code===0?await j(!0):N(l,y.code)}catch(y){console.error(y),N(l,Ie())}finally{D.value=!1}}},z=y=>{y&&o.push({path:"/problem/"+y})},k=y=>{y&&o.push({path:"/user/"+y})},V=y=>{const c=y.status,i=Be(c);let _;switch(c){case te.Init:case te.Rejudge:case te.Compiling:case te.Running:_="default";break;case te.Accept:_="success";break;case te.PE:_="warning";break;default:_="danger";break}return a(me,null,{default:()=>[a(G,{theme:"default",variant:"outline"},{default:()=>[y.taskId]}),a(G,{theme:_,variant:"outline"},pt(i)?i:{default:()=>[i]}),a("span",null,[w("分数："),y.score]),a("span",null,[w("用时："),y.time]),a("span",null,[w("内存："),y.memory])]})},j=async y=>{var i;y&&(E.value=!0);let c=!1;try{const _=await Tn(h);if(O.value=[],_.code===0){const S=_.data,I=At(S);if((i=O.value)==null||i.push(I),S.judger){const R=await qt(S.judger);C.value=R.name}else C.value="";s.value.to="#00A870",Ve(S.status)?(g.value="active",I.taskTotal>0?(f.value=I.taskCurrent/I.taskTotal*100,I.taskCurrent>=I.taskTotal&&(f.value=99)):f.value=0):(f.value=100,S.status===te.Accept?g.value="success":S.status===te.PE?(s.value.to="#F57C20",g.value="warning"):(s.value.to="#F56C6C",g.value="error"));const U={};if(S.code){const X=`\`\`\`${ut(S.language)}
${S.code}
\`\`\``;m.value=await le.md2html(X,U),await we(()=>{u.value&&(b||(b=!0,le.highlightRender({lineNumber:!0,enable:!0},u.value)),$e(u.value))})}d.value=I,Ve(S.status)&&(c=!0)}else y&&N(l,_.code)}catch(_){console.error(_),y&&N(l,Ie())}finally{y&&(E.value=!1),c&&p&&setTimeout(()=>{j(!1)},5e3)}};return oe(async()=>{if(p=!0,Array.isArray(t.params.judgeId)?h=t.params.judgeId[0]:h=t.params.judgeId,!h){await o.push({name:"judge"});return}await j(!0)}),Te(()=>{p=!1}),(y,c)=>{var $,se;const i=da,_=xe,S=de,I=he,U=Re,R=ze,X=be,B=It,q=Tt,W=G;return P(),K(Q,null,[a(i,{color:s.value,status:g.value,class:"dida-job-progress",percentage:f.value},null,8,["color","status","percentage"]),a(S,{style:{margin:"10px"}},{default:n(()=>[a(_,{data:O.value,columns:L.value,"row-key":"id","vertical-align":"top",hover:!0,loading:E.value},null,8,["data","columns","loading"])]),_:1}),a(X,null,{default:n(()=>[a(I,{span:8},{default:n(()=>[A("div",{innerHTML:m.value,ref_key:"markdownCodeRef",ref:u},null,8,so)]),_:1}),a(I,{span:4},{default:n(()=>[a(R,{layout:"vertical",bordered:!0,style:{margin:"10px"}},{default:n(()=>[a(U,{label:"判题机"},{default:n(()=>[w(F(C.value),1)]),_:1}),a(U,{label:"判题时间"},{default:n(()=>{var Z;return[w(F((Z=d.value)==null?void 0:Z.judgeTime),1)]}),_:1})]),_:1})]),_:1})]),_:1}),($=d.value)!=null&&$.compileMessage?(P(),M(S,{key:0,class:"compile-message"},{default:n(()=>{var Z;return[w(F((Z=d.value)==null?void 0:Z.compileMessage),1)]}),_:1})):ie("",!0),((se=d.value)==null?void 0:se.task.length)>0?(P(),M(q,{key:1,class:"task-panel"},{default:n(()=>{var Z;return[(P(!0),K(Q,null,ce((Z=d.value)==null?void 0:Z.task,(re,J)=>(P(),M(B,{key:re.taskId,header:()=>V(re)},{default:n(()=>[w(F(re.content)+" "+F(re.waHint),1)]),_:2},1032,["header"]))),128))]}),_:1})):ie("",!0),T.value?(P(),K("div",ro,[a(W,{onClick:x,loading:D.value},{default:n(()=>c[0]||(c[0]=[w("重新评测")])),_:1},8,["loading"])])):ie("",!0)],64)}}}),io=ee(uo,[["__scopeId","data-v-f13a425c"]]),co={style:{margin:"10px"}},mo=ae({__name:"ContestList",setup(e){const t=pe(),o=Fe(),{globalProperties:r}=ue();let l=null;const p=v(!1),h=v(!1),C=v([{title:"ID",colKey:"id",width:"100",cell:(z,k)=>a(G,{variant:"text",onClick:()=>L(k.row.id)},{default:()=>[k.row.id]})},{title:"标题",colKey:"title",cell:(z,k)=>a(G,{variant:"text",onClick:()=>L(k.row.id)},{default:()=>[k.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),d=v(!1);let m=1,u=50;const f=v({current:m,pageSize:u,defaultCurrent:m,defaultPageSize:u,total:0,pageSizeOptions:[50,100]}),g=v(),s=v({title:"",username:""}),b=v({title:"",description:"",open_time:[]}),L=z=>{z&&o.push({path:"/contest/"+z})},E=async()=>{await o.push({query:{...t.query,title:s.value.title,username:s.value.username,page:1,page_size:f.value.defaultPageSize}})},D=async(z,k)=>{var V;d.value=!0;try{const{current:j,pageSize:y}=z,c=await Nn(j,y);if(g.value=[],c.code===0){const i=c.data.list;for(let _=0;_<i.length;_++){const S=i[_],I=await Mt(S);(V=g.value)==null||V.push(I)}f.value={...f.value,total:c.data.total_count}}else k&&N(r,c.code)}catch(j){console.error(j),N(r,Ie())}finally{d.value=!1}},O=async z=>{await o.push({query:{...t.query,page:z.current,page_size:z.pageSize}})},T=()=>{p.value=!0},x=async()=>{h.value=!0,console.log("contestCreateForm",b.value),Hn(b.value).then(z=>{z.code===0?(_e(r,"创建比赛成功"),p.value=!1,o.push({path:"/contest/"+z.data.id})):N(r,z.code)}).finally(()=>{h.value=!1})};return oe(async()=>{l=De(()=>t.query,z=>{s.value.title=z.title||"",s.value.username=z.username||"";const k=parseInt(z.page)||f.value.defaultCurrent,V=parseInt(z.page_size)||f.value.defaultPageSize;m=k,u=V,f.value={...f.value,current:m,pageSize:u},D({current:m,pageSize:u},!0)},{immediate:!0})}),Te(()=>{l&&l()}),(z,k)=>{const V=xe,j=de,y=he,c=ke,i=Le,_=G,S=Pe,I=me,U=be,R=Pt,X=st;return P(),K(Q,null,[a(U,null,{default:n(()=>[a(y,{span:9},{default:n(()=>[a(j,{style:{margin:"10px"}},{default:n(()=>[a(V,{data:g.value,columns:C.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:f.value,loading:d.value,onPageChange:O},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),a(y,{span:3},{default:n(()=>[A("div",co,[a(j,{class:"sh-card"},{default:n(()=>[a(S,{model:s.value},{default:n(()=>[a(i,{label:"标题"},{default:n(()=>[a(c,{modelValue:s.value.title,"onUpdate:modelValue":k[0]||(k[0]=B=>s.value.title=B),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),a(i,{label:"负责人"},{default:n(()=>[a(c,{modelValue:s.value.username,"onUpdate:modelValue":k[1]||(k[1]=B=>s.value.username=B),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),a(i,null,{default:n(()=>[a(_,{theme:"primary",onClick:E},{default:n(()=>k[6]||(k[6]=[w("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(j,{class:"sh-card"},{default:n(()=>[a(I,null,{default:n(()=>[a(_,{onClick:T},{default:n(()=>k[7]||(k[7]=[w("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),a(X,{visible:p.value,"onUpdate:visible":k[5]||(k[5]=B=>p.value=B),header:"创建比赛",onConfirm:x,"confirm-loading":h.value},{default:n(()=>[a(S,{"label-width":80,model:b.value,onSubmit:k[4]||(k[4]=Ee(()=>{},["prevent"]))},{default:n(()=>[a(i,{label:"标题"},{default:n(()=>[a(c,{modelValue:b.value.title,"onUpdate:modelValue":k[2]||(k[2]=B=>b.value.title=B),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),a(i,{label:"开启时间"},{default:n(()=>[a(R,{"enable-time-picker":"","allow-input":"",clearable:"",modelValue:b.value.open_time,"onUpdate:modelValue":k[3]||(k[3]=B=>b.value.open_time=B)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Ae=ee(mo,[["__scopeId","data-v-3e6ea683"]]),po={style:{margin:"20px"}},fo=["innerHTML"],_o={style:{margin:"12px"}},go=ae({__name:"ContestDetail",setup(e){let t=pe();const{globalProperties:o}=ue(),r=je();let l=0;const p=v(!1),h=v(null),C=v([{title:"问题ID",colKey:"id",cell:(u,f)=>a(G,{variant:"text",onClick:()=>m(l,f.row.index)},{default:()=>[f.row.id]})},{title:"标题",colKey:"title",cell:(u,f)=>a(G,{variant:"text",onClick:()=>m(l,f.row.index)},{default:()=>[f.row.title]})},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),d=v([]),m=(u,f)=>{H.push({name:"contest-problem-detail",params:{contestId:u,problemIndex:f}})};return oe(async()=>{if(Array.isArray(t.params.contestId)?l=t.params.contestId[0]:l=t.params.contestId,!l){await H.push({name:"contest"});return}p.value=!0;const u=await Gn(l);if(u.code!==0){p.value=!1,N(o,u.code),await H.push({name:"contest"});return}h.value=await Mt(u.data),d.value=h.value.problems,r.setTitle(h.value.title+" - "+r.getTitle),await we(()=>{const f=document.querySelectorAll(".dida-content-description");f&&f.length>0&&f.forEach(g=>{le.mathRender(g),le.highlightRender({lineNumber:!0,enable:!0},g),$e(g)}),p.value=!1})}),(u,f)=>{const g=ma,s=G,b=me,L=It,E=Tt,D=xe,O=de,T=he,x=Re,z=ze,k=be,V=ve;return P(),M(V,{loading:p.value},{default:n(()=>[a(k,{class:"dida-main-content"},{default:n(()=>[a(T,{span:8},{default:n(()=>{var j,y,c;return[A("div",po,[A("h1",null,F((j=h.value)==null?void 0:j.title),1),(y=h.value)!=null&&y.notification?(P(),M(g,{key:0,theme:"info",message:(c=h.value)==null?void 0:c.notification},null,8,["message"])):ie("",!0)]),a(E,{"default-value":[0],"expand-icon":!1,borderless:!0},{default:n(()=>{var i;return[(P(!0),K(Q,null,ce((i=h.value)==null?void 0:i.descriptions,(_,S)=>(P(),M(L,{key:S,header:_.title},tt({default:n(()=>[A("div",{innerHTML:_.content,class:"dida-content-description"},null,8,fo)]),_:2},[S===0?{name:"headerRightContent",fn:n(()=>[a(b,{size:"small"},{default:n(()=>[a(s,{size:"small"},{default:n(()=>f[0]||(f[0]=[w("收起全部")])),_:1}),a(s,{size:"small"},{default:n(()=>f[1]||(f[1]=[w("展开全部")])),_:1})]),_:1})]),key:"0"}:void 0]),1032,["header"]))),128))]}),_:1}),a(O,{style:{margin:"10px"}},{default:n(()=>[a(D,{data:d.value,columns:C.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1})]}),_:1}),a(T,{span:4},{default:n(()=>[A("div",_o,[a(z,{layout:"vertical",bordered:!0},{default:n(()=>[a(x,{label:"开始时间"},{default:n(()=>{var j;return[w(F((j=h.value)==null?void 0:j.startTime),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),vo=ee(go,[["__scopeId","data-v-5e212303"]]);function Gt(e){const t={};return t.id=e.id,t.authorId=e.author_id,t.authorUsername=e.author_username,t.authorNickname=e.author_nickname,t.title=e.title,t.content=e.content,e.insert_time&&(t.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(t.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(t.updateTime=new Date(e.update_time).toLocaleString()),t.problemId=e.problem_id,t.problemTitle=e.problem_title,t.contestId=e.contest_id,t.contestTitle=e.contest_title,t.contestProblemIndex=e.contest_problem_index,t}async function ho(e){const t={};if(t.id=e.id,t.authorId=e.author_id,t.authorUsername=e.author_username,t.authorNickname=e.author_nickname,t.content="",e.content){const o={math:{inlineDigit:!0,engine:"KaTeX"}};t.content=await le.md2html(e.content,o)}return e.insert_time&&(t.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(t.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(t.updateTime=new Date(e.update_time).toLocaleString()),t}function bo(e){return Y({url:"/discuss?id="+e,method:"get"})}function yo(e,t,o,r,l,p){const h={};return e&&(h.contest_id=e),t&&(h.problem_id=t),o&&(h.title=o),r&&(h.username=r),l&&(h.page=l),p&&(h.page_size=p),Y({url:`/discuss/list?${new URLSearchParams(h).toString()}`,method:"get"})}function wo(e,t,o){return Y({url:"/discuss/comment/list?id="+e+"&page="+t+"&page_size="+o,method:"get"})}function ko(e){return Y({url:"/discuss/create",method:"post",data:e})}const So={style:{margin:"10px"}};function Co(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Me(e)}const Io=ae({__name:"DiscussList",setup(e){const t=pe(),o=Fe(),{globalProperties:r}=ue();let l=null;const p=v(!1),h=v(!1);let C=0;const d=v([]),m=[{title:"ID",colKey:"id",width:"100",cell:(c,i)=>a(G,{variant:"text",onClick:()=>x(i.row.id)},{default:()=>[i.row.id]})}],u=[{title:"标题",colKey:"title",cell:(c,i)=>a(G,{variant:"text",onClick:()=>x(i.row.id)},{default:()=>[i.row.title]})},{title:"创建人",colKey:"authorNickname",width:"200"},{title:"创建时间",colKey:"insertTime",width:"180"},{title:"更新时间",colKey:"updateTime",width:"180"}],f=v(!1);let g=1,s=50;const b=v({current:g,pageSize:s,defaultCurrent:g,defaultPageSize:s,total:0,pageSizeOptions:[50,100]}),L=v(),E=v({problemId:"",title:"",username:""}),D=v({title:"",description:"",open_time:[]}),O=c=>{c&&o.push({name:"problem-detail",params:{problemId:c}})},T=(c,i)=>{o.push({name:"contest-problem-detail",params:{contestId:c,problemIndex:i}})},x=c=>{if(c){if(C){o.push({name:"contest-discuss-detail",params:{contestId:C,discussId:c}});return}o.push({name:"discuss-detail",params:{discussId:c}})}},z=async()=>{await o.push({query:{...t.query,problem_id:E.value.problemId,title:E.value.title,username:E.value.username,page:1,page_size:b.value.defaultPageSize}})},k=async(c,i)=>{var _;f.value=!0;try{const{current:S,pageSize:I}=c,U=await yo(C,E.value.problemId,E.value.title,E.value.username,S,I);if(L.value=[],U.code===0){if(U.data.list){const R=U.data.list;for(let X=0;X<R.length;X++){const B=R[X],q=await Gt(B);(_=L.value)==null||_.push(q)}}b.value={...b.value,total:U.data.total_count}}else i&&N(r,U.code)}catch(S){console.error(S),N(r,Ie())}finally{f.value=!1}},V=async c=>{await o.push({query:{...t.query,page:c.current,page_size:c.pageSize}})},j=()=>{p.value=!0},y=async()=>{h.value=!0,console.log("discussCreateForm",D.value),ko(D.value).then(c=>{c.code===0?(_e(r,"创建比赛成功"),p.value=!1,o.push({path:"/discuss/"+c.data.id})):N(r,c.code)}).finally(()=>{h.value=!1})};return oe(async()=>{l=De(()=>t.query,c=>{Array.isArray(t.params.contestId)?C=t.params.contestId[0]:C=t.params.contestId,d.value=m,C?d.value=d.value.concat([{title:"问题ID",colKey:"contestProblemIndex",width:"100",cell:(S,I)=>{let U;return a(G,{variant:"text",onClick:()=>T(C,I.row.contestProblemIndex)},Co(U=Ye(I.row.contestProblemIndex))?U:{default:()=>[U]})}}]):d.value=d.value.concat([{title:"问题ID",colKey:"problemId",width:"100",cell:(S,I)=>a(G,{variant:"text",onClick:()=>O(I.row.problemId)},{default:()=>[I.row.problemId]})}]),d.value=d.value.concat(u),E.value.problemId=c.problem_id||"",E.value.title=c.title||"",E.value.username=c.username||"";const i=parseInt(c.page)||b.value.defaultCurrent,_=parseInt(c.page_size)||b.value.defaultPageSize;g=i,s=_,b.value={...b.value,current:g,pageSize:s},k({current:g,pageSize:s},!0)},{immediate:!0})}),Te(()=>{l&&l()}),(c,i)=>{const _=xe,S=de,I=he,U=ke,R=Le,X=G,B=Pe,q=me,W=be,$=Pt,se=st;return P(),K(Q,null,[a(W,null,{default:n(()=>[a(I,{span:9},{default:n(()=>[a(S,{style:{margin:"10px"}},{default:n(()=>[a(_,{data:L.value,columns:d.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:b.value,loading:f.value,"table-layout":"auto",onPageChange:V},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),a(I,{span:3},{default:n(()=>[A("div",So,[a(S,{class:"sh-card"},{default:n(()=>[a(B,{model:E.value},{default:n(()=>[a(R,{label:"问题ID"},{default:n(()=>[a(U,{modelValue:E.value.problemId,"onUpdate:modelValue":i[0]||(i[0]=Z=>E.value.problemId=Z),placeholder:"请输入完整问题ID"},null,8,["modelValue"])]),_:1}),a(R,{label:"标题"},{default:n(()=>[a(U,{modelValue:E.value.title,"onUpdate:modelValue":i[1]||(i[1]=Z=>E.value.title=Z),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),a(R,{label:"创建人"},{default:n(()=>[a(U,{modelValue:E.value.username,"onUpdate:modelValue":i[2]||(i[2]=Z=>E.value.username=Z),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),a(R,null,{default:n(()=>[a(X,{theme:"primary",onClick:z},{default:n(()=>i[7]||(i[7]=[w("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(S,{class:"sh-card"},{default:n(()=>[a(q,null,{default:n(()=>[a(X,{onClick:j},{default:n(()=>i[8]||(i[8]=[w("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),a(se,{visible:p.value,"onUpdate:visible":i[6]||(i[6]=Z=>p.value=Z),header:"创建比赛",onConfirm:y,"confirm-loading":h.value},{default:n(()=>[a(B,{"label-width":80,model:D.value,onSubmit:i[5]||(i[5]=Ee(()=>{},["prevent"]))},{default:n(()=>[a(R,{label:"标题"},{default:n(()=>[a(U,{modelValue:D.value.title,"onUpdate:modelValue":i[3]||(i[3]=Z=>D.value.title=Z),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),a(R,{label:"开启时间"},{default:n(()=>[a($,{"enable-time-picker":"","allow-input":"",clearable:"",modelValue:D.value.open_time,"onUpdate:modelValue":i[4]||(i[4]=Z=>D.value.open_time=Z)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Oe=ee(Io,[["__scopeId","data-v-97dda3a0"]]),To={key:0,style:{margin:"20px"}},Po=["innerHTML"],Lo=["innerHTML"],xo={style:{margin:"10px"}},jo={style:{margin:"10px"}},Vo={style:{margin:"10px","text-align":"right"}},$o={style:{margin:"12px"}},Do={key:0,class:"dida-edit-container"},zo=ae({__name:"DiscussDetail",setup(e){let t=pe();const{globalProperties:o}=ue();let r=null;const l=je(),p=ge();let h=v("");const C=v(""),d=v(null),m=v(!1),u=v(null),f=v(!1);let g=1,s=20;const b=v({current:1,total:0,defaultPageSize:s,defaultCurrent:g,pageSizeOptions:[20,50]}),L=v([]),E={},D=Se(()=>p.hasAuth(Ce.ManageDiscuss)),O=j=>{j&&H.push({name:"discuss-list",query:{...t.query,title:"",tag:j.name}})},T=()=>{H.push({name:"manage-discuss",params:{discussId:C.value}})},x=()=>a("div",{class:"t-pagination__total"},[`共 ${b.value.total} 条回复`]),z=()=>{},k=async(j,y)=>{var c;f.value=!0;try{const{current:i,pageSize:_}=j,S=await wo(C.value,i,_);if(L.value=[],S.code===0){const I=S.data.list;if(I)for(let U=0;U<I.length;U++){const R=I[U],X=await ho(R);(c=L.value)==null||c.push(X),await we(()=>{const B=document.querySelectorAll(".dida-discuss-content");B&&B.length>0&&B.forEach(q=>{le.mathRender(q),le.highlightRender({lineNumber:!0,enable:!0},q),$e(q)})})}b.value={...b.value,total:S.data.total_count}}else y&&N(o,S.code)}catch(i){console.error(i),N(o,Ie())}finally{f.value=!1}},V=async j=>{await H.push({query:{...t.query,page:j.current,page_size:j.pageSize}})};return oe(async()=>{if(Array.isArray(t.params.discussId)?C.value=t.params.discussId[0]:C.value=t.params.discussId,!C.value){fe(o,"题目不存在"),await H.push({name:"discuss"});return}m.value=!0;const j=await bo(C.value);if(j.code!==0){m.value=!1,N(o,j.code),await H.push({name:"discuss"});return}j.data.tags&&j.data.tags.forEach(_=>{E[_.id]=_}),u.value=Gt(j.data.discuss),l.setTitle(u.value.title+" - "+l.getTitle);let y=u.value.content;const c={math:{inlineDigit:!0,engine:"KaTeX"}};h.value=await le.md2html(y,c),await we(()=>{d.value&&(le.mathRender(d.value),le.highlightRender({lineNumber:!0,enable:!0},d.value),$e(d.value)),m.value=!1}),r=De(()=>t.query,_=>{const S=parseInt(_.page)||b.value.defaultCurrent,I=parseInt(_.page_size)||b.value.defaultPageSize;g=S,s=I,b.value={...b.value,current:g,pageSize:s},k({current:g,pageSize:s},!0)},{immediate:!0});const i={after:()=>{}};new le("commentEditRef",i)}),Te(()=>{r&&r()}),(j,y)=>{const c=fa,i=pa,_=de,S=me,I=_a,U=G,R=he,X=Re,B=ze,q=be,W=ve;return P(),M(W,{loading:m.value},{default:n(()=>[a(q,{class:"dida-main-content"},{default:n(()=>[a(R,{span:8},{default:n(()=>{var $,se,Z;return[($=u.value)!=null&&$.problemTitle||(se=u.value)!=null&&se.contestTitle?(P(),K("div",To,[a(i,{"max-item-width":"300"},{default:n(()=>{var re,J,Ue,it;return[(re=u.value)!=null&&re.contestTitle?(P(),K(Q,{key:0},[a(c,{to:{name:"contest-detail",params:{contestId:(J=u.value)==null?void 0:J.contestId}}},{default:n(()=>{var ye;return[w(F((ye=u.value)==null?void 0:ye.contestTitle),1)]}),_:1},8,["to"]),a(c,{to:{name:"contest-problem-detail",params:{problemId:(Ue=u.value)==null?void 0:Ue.contestProblemIndex}}},{default:n(()=>{var ye,ct;return[w(F(ne(Ye)((ye=u.value)==null?void 0:ye.contestProblemIndex))+" - "+F((ct=u.value)==null?void 0:ct.problemTitle),1)]}),_:1},8,["to"])],64)):(P(),K(Q,{key:1},[a(c,{to:{name:"discuss-list-problem"}},{default:n(()=>y[2]||(y[2]=[w(" 问题讨论")])),_:1}),a(c,{to:{name:"problem-detail",params:{problemId:(it=u.value)==null?void 0:it.problemId}}},{default:n(()=>{var ye;return[w(F((ye=u.value)==null?void 0:ye.problemTitle),1)]}),_:1},8,["to"])],64))]}),_:1})])):ie("",!0),a(_,{style:{margin:"10px"},header:(Z=u.value)==null?void 0:Z.title,"header-bordered":!0},{default:n(()=>[A("div",{innerHTML:ne(h),class:"dida-discuss-content"},null,8,Po)]),_:1},8,["header"]),(P(!0),K(Q,null,ce(L.value,(re,J)=>(P(),M(_,{key:J,style:{margin:"10px"},"header-bordered":""},{header:n(()=>[a(S,null,{default:n(()=>[A("span",null,F(re.authorNickname),1),A("span",null,F(re.insertTime),1)]),_:2},1024)]),default:n(()=>[A("div",{innerHTML:re.content,class:"dida-discuss-content"},null,8,Lo)]),_:2},1024))),128)),A("div",xo,[a(I,{modelValue:b.value.current,"onUpdate:modelValue":y[0]||(y[0]=re=>b.value.current=re),"page-size":b.value.pageSize,"onUpdate:pageSize":y[1]||(y[1]=re=>b.value.pageSize=re),total:b.value.total,"page-size-options":b.value.pageSizeOptions,"show-page-size":!1,"total-content":x,onChange:V},null,8,["modelValue","page-size","total","page-size-options"])]),A("div",jo,[y[4]||(y[4]=A("div",{id:"commentEditRef",class:"dida-comment-editor"},null,-1)),A("div",Vo,[a(S,null,{default:n(()=>[a(U,{theme:"primary",onClick:z},{default:n(()=>y[3]||(y[3]=[w("提交")])),_:1})]),_:1})])])]}),_:1}),a(R,{span:4},{default:n(()=>[A("div",$o,[D.value?(P(),K("div",Do,[a(U,{onClick:T},{default:n(()=>y[5]||(y[5]=[w("编辑")])),_:1})])):ie("",!0),a(B,{layout:"vertical",bordered:!0},{default:n(()=>[a(X,{label:"创建时间"},{default:n(()=>{var $;return[w(F(($=u.value)==null?void 0:$.insertTime),1)]}),_:1}),a(X,{label:"编辑时间"},{default:n(()=>{var $;return[w(F(($=u.value)==null?void 0:$.modifyTime),1)]}),_:1}),a(X,{label:"更新时间"},{default:n(()=>{var $;return[w(F(($=u.value)==null?void 0:$.updateTime),1)]}),_:1}),a(X,{label:"创建用户"},{default:n(()=>{var $;return[w(F(($=u.value)==null?void 0:$.authorNickname),1)]}),_:1}),a(X,{label:"标签"},{default:n(()=>[a(S,null,{default:n(()=>{var $;return[(P(!0),K(Q,null,ce(($=u.value)==null?void 0:$.tags,se=>(P(),M(U,{key:se.id,variant:"dashed",onClick:()=>O(se)},{default:n(()=>[w(F(se.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),ft=ee(zo,[["__scopeId","data-v-17657340"]]),Ro={class:"judger-status-panel"},Uo={class:"judger-status-panel"};function Ao(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Me(e)}const Eo=ae({__name:"SystemStatus",setup(e){const t=v([]),o=v([]);let r;const l=d=>{let m="失效",u="danger";const f=new Date,g=new Date(d.updateTime);return f.getTime()-g.getTime()>3e4?(m="离线",u="default"):d.cpuUsage>90?(m="CPU过高",u="warning"):d.memPercent>90?(m="内存过高",u="warning"):(m="在线",u="success"),a(me,null,{default:()=>[a("span",null,[d.key,w(" - "),d.name]),a("span",null,[d.updateTime]),a(va,{theme:u,size:"small"},Ao(m)?m:{default:()=>[m]})]})},p=async()=>{const d=[{key:"didaoj",name:"DidaOj"}],m={};for(let f=0;f<t.value.length;f++){const g=t.value[f];m[g.key]=g}const u=[];for(let f=0;f<d.length;f++){const g=d[f],s={key:g.key},b=await lo(g.key);b&&(b.name?s.name=b.name:s.name="-",b.update_time?s.updateTime=new Date(b.update_time).toLocaleString():s.updateTime="-",b.cpu_usage?s.cpuUsage=Number(b.cpu_usage):s.cpuUsage=0,b.mem_usage?s.memUsage=b.mem_usage/(1024*1024*1024):s.memUsage=0,b.mem_total?s.memTotal=b.mem_total/(1024*1024*1024):s.memTotal=0,s.memTotal>0?s.memPercent=Math.round(s.memUsage/s.memTotal*1e4)/100:s.memPercent=0,s.avgMessage=b.avg_message,m[g.key]?(s.cpuUsageFrom=m[g.key].cpuUsage,s.memPercentFrom=m[g.key].memPercent,s.memUsageFrom=m[g.key].memUsage,s.memTotalFrom=m[g.key].memTotal):(s.cpuUsageFrom=0,s.memPercentFrom=0,s.memUsageFrom=0,s.memTotalFrom=0),u.push(s))}t.value=u},h=async()=>{const d=await oo(),m={};for(let f=0;f<o.value.length;f++){const g=o.value[f];m[g.key]=g}const u=[];for(let f=0;f<d.judgers.length;f++){const g=d.judgers[f],s={key:g.key,name:g.name},b=await qt(g.key);b&&(b.name?s.name=b.name:s.name="-",b.update_time?s.updateTime=new Date(b.update_time).toLocaleString():s.updateTime="-",b.cpu_usage?s.cpuUsage=Number(b.cpu_usage):s.cpuUsage=0,b.mem_usage?s.memUsage=b.mem_usage/(1024*1024*1024):s.memUsage=0,b.mem_total?s.memTotal=b.mem_total/(1024*1024*1024):s.memTotal=0,s.memTotal>0?s.memPercent=Math.round(s.memUsage/s.memTotal*1e4)/100:s.memPercent=0,s.avgMessage=b.avg_message,m[g.key]?(s.cpuUsageFrom=m[g.key].cpuUsage,s.memPercentFrom=m[g.key].memPercent,s.memUsageFrom=m[g.key].memUsage,s.memTotalFrom=m[g.key].memTotal):(s.cpuUsageFrom=0,s.memPercentFrom=0,s.memUsageFrom=0,s.memTotalFrom=0),u.push(s))}o.value=u},C=async()=>{await p(),await h()};return oe(async()=>{o.value=[],await C(),r=setInterval(()=>{C()},5e3)}),Jt(()=>{clearInterval(r)}),(d,m)=>{const u=ga,f=me,g=de;return P(),K(Q,null,[a(g,{title:"接口状态",class:"judger-status"},{default:n(()=>[A("div",Ro,[(P(!0),K(Q,null,ce(t.value,s=>(P(),M(g,{key:s.key,header:()=>l(s),class:"judge-status-judger"},{footer:n(()=>[A("span",null," 负载信息："+F(s.avgMessage),1)]),default:n(()=>[a(f,{class:"judge-status-judger"},{default:n(()=>[a(u,{title:"CPU使用率",value:s.cpuUsage,animation:{valueFrom:s.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),a(u,{title:"内存使用率",value:s.memPercent,animation:{valueFrom:s.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),a(u,{title:"内存使用量",animation:{valueFrom:s.memUsageFrom,duration:2e3},"animation-start":!0,value:s.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),a(u,{title:"内存总量",value:s.memTotal,animation:{valueFrom:s.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1}),a(g,{title:"判题机状态",class:"judger-status"},{default:n(()=>[A("div",Uo,[(P(!0),K(Q,null,ce(o.value,s=>(P(),M(g,{key:s.key,header:()=>l(s),class:"judge-status-judger"},{footer:n(()=>[A("span",null," 负载信息："+F(s.avgMessage),1)]),default:n(()=>[a(f,{class:"judge-status-judger"},{default:n(()=>[a(u,{title:"CPU使用率",value:s.cpuUsage,animation:{valueFrom:s.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),a(u,{title:"内存使用率",value:s.memPercent,animation:{valueFrom:s.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),a(u,{title:"内存使用量",animation:{valueFrom:s.memUsageFrom,duration:2e3},"animation-start":!0,value:s.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),a(u,{title:"内存总量",value:s.memTotal,animation:{valueFrom:s.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1})],64)}}}),Fo=ee(Eo,[["__scopeId","data-v-51120bcc"]]),Mo=ae({__name:"ManageJudge",setup(e){const{globalProperties:t}=ue(),o=v(""),r=v(!1),l=v(!1),p=async()=>{try{const d=await xn();if(d.code!==0){N(t,d.code);return}_e(t,"重判成功"),await H.push({name:"judge-list"})}catch(d){console.error(d),N(t,"重判失败")}},h=async()=>{if(o.value===""){N(t,"请输入问题Id");return}r.value=!0;try{const d=await jn(o.value);if(d.code!==0){N(t,d.code);return}_e(t,"重判成功"),await H.push({name:"judge-list",query:{problem_id:o.value}})}catch(d){console.error(d),N(t,"重判失败")}finally{r.value=!1}},C=async()=>{l.value=!0;try{const d=await Vn();if(d.code!==0){N(t,d.code);return}_e(t,"重判成功"),await H.push({name:"judge-list"})}catch(d){console.error(d),N(t,"重判失败")}finally{l.value=!1}};return(d,m)=>{const u=G,f=de,g=ke,s=me;return P(),K(Q,null,[a(f,{class:"yj-manage-card",title:"重判最近提交"},{default:n(()=>[a(u,{onClick:p},{default:n(()=>m[1]||(m[1]=[w("重判")])),_:1})]),_:1}),a(f,{class:"yj-manage-card",title:"重判问题"},{default:n(()=>[a(s,null,{default:n(()=>[a(g,{modelValue:o.value,"onUpdate:modelValue":m[0]||(m[0]=b=>o.value=b),placeholder:"输入问题Id"},null,8,["modelValue"]),a(u,{onClick:h,loading:r.value},{default:n(()=>m[2]||(m[2]=[w("重判")])),_:1},8,["loading"])]),_:1})]),_:1}),a(f,{class:"yj-manage-card",title:"重判所有"},{default:n(()=>[a(u,{onClick:C,theme:"danger",loading:l.value},{default:n(()=>m[3]||(m[3]=[w("重判")])),_:1},8,["loading"])]),_:1})],64)}}}),qo=ee(Mo,[["__scopeId","data-v-60a14d44"]]),Go={style:{margin:"10px"}},No={key:1},Ho={style:{margin:"12px"}},Oo={class:"dida-edit-container"},Ko=ae({__name:"ProblemEdit",setup(e){let t=pe();const{globalProperties:o}=ue(),r=je(),l=v(""),p=v(!1);let h=null;const C=v(!1),d=v(null),m=v({title:"",timeLimit:0,memoryLimit:0,source:"",tags:[]}),u=v([]),f=v([]),g=Se(()=>{const T=[],x=u.value;for(let z=0,k=x.length;z<k;z++)x[z].value&&T.push(x[z].value);return T}),s=(T,x)=>{const{trigger:z,index:k,item:V}=x;if(z==="clear"&&(u.value=[]),["tag-remove","backspace"].includes(z)&&u.value.splice(k,1),z==="enter"){for(let y=0;y<f.value.length;y++){const c=f.value[y];if(c.label===V){for(let i=0;i<u.value.length;i++)if(u.value[i].label===c.label)return;u.value.push(c);return}}const j={label:V,value:V};u.value.push(j),f.value=f.value.concat(j)}},b=(T,{current:x,type:z})=>{if(!x){u.value=z==="check"?f.value.slice(1):[];return}if(z==="check"){const k=f.value.find(V=>V.value===x);if(!k)return;u.value.push(k)}else u.value=u.value.filter(k=>k.value!==x)},L=()=>{H.push({name:"problem-detail",params:{problemId:l.value}})},E=()=>{H.push({name:"manage-problem-judge",params:{problemId:l.value}})},D=async()=>{if(h){C.value=!0,m.value.tags=[];for(let T=0;T<u.value.length;T++){const x=u.value[T];x&&x.label&&m.value.tags.push(x.label)}try{const T=await Rn(l.value,m.value.title,m.value.timeLimit,m.value.memoryLimit,m.value.source,m.value.tags,h.getValue());if(C.value=!0,T.code!==0){N(o,T.code);return}T.data!=null&&(d.value.updateTime=new Date(T.data).toLocaleString()),Vt(o,"保存成功")}finally{C.value=!1}}},O=async()=>{const T=await Et(l.value);if(T.code!==0){N(o,T.code),console.error("problem get failed",T.code),await H.push({name:"problem"});return}const x=T.data.problem;if(d.value=We(x,{}),m.value.title=x.title,m.value.timeLimit=x.time_limit,m.value.memoryLimit=x.memory_limit,m.value.source=x.source,m.value.tags=[],u.value=[],T.data.tags)for(let V=0;V<T.data.tags.length;V++){const j=T.data.tags[V];j&&j.name&&(m.value.tags.push(j.name),u.value.push({label:j.name,value:j.id}))}r.setTitle(x.title+" - "+r.getTitle);let z=x.description;const k={after:()=>{h==null||h.setValue(z)}};h=new le("codeEditRef",k),p.value=!1};return oe(async()=>{if(Array.isArray(t.params.problemId)?l.value=t.params.problemId[0]:l.value=t.params.problemId,!l.value){fe(o,"题目不存在"),await H.push({name:"problem"});return}p.value=!0,Ft(-1).then(async T=>{T.code===0?(T.data.list&&T.data.list.forEach(x=>{f.value.push({label:x.name,value:x.id})}),await O()):(N(o,T.code),console.error("problem tag get failed",T.code),await H.push({name:"problem"}))}).catch(async T=>{console.error(T),N(o,"获取数据异常"),await H.push({name:"problem"})})}),(T,x)=>{const z=ke,k=Le,V=ha,j=ya,y=ba,c=Pe,i=de,_=he,S=G,I=me,U=Re,R=ze,X=be,B=ve;return P(),M(B,{loading:p.value},{default:n(()=>[a(X,null,{default:n(()=>[a(_,{span:8},{default:n(()=>[A("div",Go,[a(i,{class:"sh-card"},{default:n(()=>[a(c,{model:m.value},{default:n(()=>[a(k,{label:"标题"},{default:n(()=>[a(z,{modelValue:m.value.title,"onUpdate:modelValue":x[0]||(x[0]=q=>m.value.title=q),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),a(k,{label:"时间限制"},{default:n(()=>[a(V,{modelValue:m.value.timeLimit,"onUpdate:modelValue":x[1]||(x[1]=q=>m.value.timeLimit=q),theme:"normal",min:0},{suffix:n(()=>x[4]||(x[4]=[A("span",null,"ms",-1)])),_:1},8,["modelValue"])]),_:1}),a(k,{label:"内存限制"},{default:n(()=>[a(V,{modelValue:m.value.memoryLimit,"onUpdate:modelValue":x[2]||(x[2]=q=>m.value.memoryLimit=q),theme:"normal",min:0},{suffix:n(()=>x[5]||(x[5]=[A("span",null,"KB",-1)])),_:1},8,["modelValue"])]),_:1}),a(k,{label:"来源"},{default:n(()=>[a(z,{modelValue:m.value.source,"onUpdate:modelValue":x[3]||(x[3]=q=>m.value.source=q),placeholder:"请输入题目来源"},null,8,["modelValue"])]),_:1}),a(k,{label:"标签"},{default:n(()=>[a(y,{value:u.value,"allow-input":!0,placeholder:"请选择或输入","tag-input-props":{excessTagsDisplayType:"break-line"},"popup-props":{overlayInnerClassName:["narrow-scrollbar"],overlayInnerStyle:{maxHeight:"280px",overflowY:"auto",overscrollBehavior:"contain",padding:"6px"}},clearable:"",multiple:"",onTagChange:s},{panel:n(()=>[f.value.length?(P(),M(j,{key:0,value:g.value,options:f.value,onChange:b},null,8,["value","options"])):(P(),K("div",No,"暂无数据"))]),suffixIcon:n(()=>[a(ne(Xt))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),a(_,{span:4},{default:n(()=>[A("div",Ho,[A("div",Oo,[a(I,null,{default:n(()=>[a(S,{onClick:D,theme:"danger",loading:C.value},{default:n(()=>x[6]||(x[6]=[w("保存")])),_:1},8,["loading"]),a(S,{onClick:E,theme:"warning"},{default:n(()=>x[7]||(x[7]=[w("判题数据")])),_:1}),a(S,{onClick:L},{default:n(()=>x[8]||(x[8]=[w("查看")])),_:1})]),_:1})]),a(R,{layout:"vertical",bordered:!0},{default:n(()=>[a(U,{label:"创建时间"},{default:n(()=>{var q;return[w(F((q=d.value)==null?void 0:q.insertTime),1)]}),_:1}),a(U,{label:"更新时间"},{default:n(()=>{var q;return[w(F((q=d.value)==null?void 0:q.updateTime),1)]}),_:1}),a(U,{label:"判题方式"},{default:n(()=>{var q;return[w(F((q=d.value)==null?void 0:q.judgeType),1)]}),_:1}),a(U,{label:"上传用户"},{default:n(()=>{var q;return[w(F((q=d.value)==null?void 0:q.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1}),x[9]||(x[9]=A("div",{id:"codeEditRef",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"])}}}),Bo=ee(Ko,[["__scopeId","data-v-b8d494d1"]]),Jo={style:{margin:"10px"}},Xo={style:{margin:"12px"}},Wo={class:"dida-edit-container"},Yo=ae({__name:"ProblemJudge",setup(e){let t=pe();const{globalProperties:o}=ue(),r=je(),l=v(""),p=v(!1),h=v(null);let C=null;const d=v(null),m=v(""),u=v(!1),f=v(!1),g=v([{title:"文件",colKey:"file"},{title:"大小",colKey:"size",width:150,cell:(c,i)=>i.row.size.toFixed(0)+" B"},{title:"最后修改时间",colKey:"lastModified",width:180,cell:(c,i)=>new Date(i.row.lastModified).toLocaleString()},{title:"操作",colKey:"action",width:100,cell:(c,i)=>a(G,{onClick:()=>O(i.row.file)},{default:()=>[w("下载")]})}]),s=v([]),b=Se(()=>({border:"2px dashed #ccc",borderRadius:"6px",padding:"20px",textAlign:"center",cursor:"pointer",backgroundColor:u.value?"#f0f9ff":"#fff",transition:"background-color 0.2s ease"})),L=Se(()=>m.value?`已选择：${m.value}`:u.value?"松开文件以上传":"拖拽文件到这里，或点击选择文件"),E=()=>{H.push({name:"problem-detail",params:{problemId:l.value}})},D=()=>{H.push({name:"manage-problem",params:{problemId:l.value}})},O=async c=>{const i=await Un(l.value,c);if(i.code!==0){N(o,i.code);return}const _=document.createElement("a");_.href=i.data,_.target="_blank",_.click(),URL.revokeObjectURL(_.href)},T=async()=>{if(!C){fe(o,"请选择压缩包");return}f.value=!0,An(l.value,C).then(async c=>{c.code==0?(d.value.value=null,C=null,m.value="",p.value=!0,Vt(o,"上传成功"),await y()):N(o,c.code)}).catch(c=>{console.log(c),o.$message.error({duration:3e3,content:"申请失败"})}).finally(()=>{f.value=!1})},x=()=>{var c;(c=d.value)==null||c.click()},z=c=>{const i=c.target.files[0];i&&(m.value=i.name,C=i)},k=c=>{u.value=!0},V=()=>{u.value=!1},j=c=>{c.preventDefault(),c.stopPropagation(),u.value=!1;const i=c.dataTransfer.files[0];if(i){m.value=i.name;const _=new DataTransfer;_.items.add(i),d.value.files=_.files,C=i}},y=async()=>{const c=await Dn(l.value);if(c.code!==0){N(o,c.code),await H.push({name:"problem"});return}const i=c.data.problem;h.value=We(i,{}),r.setTitle(i.title+" - "+r.getTitle),s.value=[],c.data.judges?c.data.judges.forEach(_=>{s.value.push({file:_.key,size:_.size,lastModified:_.last_modified})}):fe(o,"评测数据不存在"),p.value=!1};return oe(async()=>{if(Array.isArray(t.params.problemId)?l.value=t.params.problemId[0]:l.value=t.params.problemId,!l.value){fe(o,"题目不存在"),await H.push({name:"problem"});return}p.value=!0,await y()}),(c,i)=>{const _=xe,S=he,I=G,U=me,R=Re,X=ze,B=be,q=ve;return P(),M(q,{loading:p.value},{default:n(()=>[a(B,null,{default:n(()=>[a(S,{span:7},{default:n(()=>[A("div",Jo,[A("div",{id:"drop-zone",style:yt(b.value),onClick:x,onDragenter:Ee(k,["prevent"]),onDragover:i[0]||(i[0]=Ee(()=>{},["prevent"])),onDragleave:Ee(V,["prevent"]),onDrop:j},[A("input",{ref_key:"fileInput",ref:d,type:"file",style:{display:"none"},onChange:z},null,544),w(" "+F(L.value),1)],36)]),a(_,{data:s.value,columns:g.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1}),a(S,{span:5},{default:n(()=>[A("div",Xo,[A("div",Wo,[a(U,null,{default:n(()=>[a(I,{onClick:T,theme:"danger",loading:f.value},{default:n(()=>i[1]||(i[1]=[w("上传")])),_:1},8,["loading"]),a(I,{onClick:D,theme:"warning"},{default:n(()=>i[2]||(i[2]=[w("编辑")])),_:1}),a(I,{onClick:E},{default:n(()=>i[3]||(i[3]=[w("查看")])),_:1})]),_:1})]),a(X,{layout:"vertical",bordered:!0},{default:n(()=>[a(R,{label:"标题"},{default:n(()=>{var W;return[w(F((W=h.value)==null?void 0:W.title),1)]}),_:1}),a(R,{label:"创建时间"},{default:n(()=>{var W;return[w(F((W=h.value)==null?void 0:W.insertTime),1)]}),_:1}),a(R,{label:"更新时间"},{default:n(()=>{var W;return[w(F((W=h.value)==null?void 0:W.updateTime),1)]}),_:1}),a(R,{label:"判题方式"},{default:n(()=>{var W;return[w(F((W=h.value)==null?void 0:W.judgeType),1)]}),_:1}),a(R,{label:"评测数据"},{default:n(()=>{var W;return[w(F((W=h.value)==null?void 0:W.judgeMd5),1)]}),_:1}),a(R,{label:"上传用户"},{default:n(()=>{var W;return[w(F((W=h.value)==null?void 0:W.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Zo=ee(Yo,[["__scopeId","data-v-17986e38"]]),Nt=[{name:"problem-list",tab:"problem",sidebar:"problem-list",path:"",title:"问题列表",icon:"list",component:qn},{name:"problem-detail",tab:"problem",sidebar:"problem-list",path:":problemId+",title:"问题详情",icon:"list",component:mt},{name:"problem-recommend",tab:"problem",sidebar:"problem-recommend",path:"recommend/:problemId*",title:"问题推荐",icon:"cpu",component:Qn},{name:"judge-list",tab:"judge",sidebar:"judge-list",path:"",title:"评测列表",icon:"list",component:no},{name:"judge-detail",tab:"judge",sidebar:"judge-list",path:":judgeId+",title:"评测详情",icon:"cpu",component:io},{name:"contest-list",tab:"contest",sidebar:"contest-list",path:"",title:"比赛列表",icon:"list",component:Ae},{name:"contest-recent",tab:"contest",sidebar:"contest-recent",path:"recent",title:"近期比赛",icon:"list",component:Ae},{name:"contest-detail",tab:"contest-detail-tab",sidebar:"contest-detail",path:":contestId+",title:"比赛详情",icon:"cpu",component:vo},{name:"contest-problem-detail",tab:"contest-detail-tab",sidebar:"contest-problem-detail",path:":contestId+/problem/:problemIndex+",title:"问题详情",icon:"cpu",component:mt},{name:"contest-judge",tab:"contest-detail-tab",sidebar:"contest-judge",path:":contestId+/judge",title:"评测列表",icon:"list",component:Ae},{name:"contest-rank",tab:"contest-detail-tab",sidebar:"contest-rank",path:":contestId+/rank",title:"比赛排名",icon:"list",component:Ae},{name:"contest-statistics",tab:"contest-detail-tab",sidebar:"contest-statistics",path:":contestId+/statistics",title:"结果统计",icon:"list",component:Ae},{name:"contest-discuss",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss",title:"比赛讨论",icon:"list",component:Oe},{name:"contest-discuss-detail",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss/:discussId+",title:"讨论详情",icon:"list",component:ft},{name:"discuss-list",tab:"discuss",sidebar:"discuss-list",path:"",title:"讨论列表",icon:"list",component:Oe},{name:"discuss-list-problem",tab:"discuss",sidebar:"discuss-list-problem",path:"problem",title:"问题讨论",icon:"list",component:Oe},{name:"discuss-list-judge",tab:"discuss",sidebar:"discuss-list-judge",path:"judge",title:"评测讨论",icon:"list",component:Oe},{name:"discuss-detail",tab:"discuss",sidebar:"discuss-list",path:":discussId+",title:"讨论详情",icon:"list",component:ft},{name:"system-status",tab:"system",sidebar:"system-status",path:"",title:"系统状态",icon:"base-station",component:Fo},{name:"manage-problem",tab:"manage",sidebar:"manage-problem",disableSidebar:!0,path:"problem/:problemId+",title:"问题编辑",icon:"list",component:Bo,auths:[Ce.ManageProblem]},{name:"manage-problem-judge",tab:"manage",sidebar:"manage-problem-judge",disableSidebar:!0,path:"problem/:problemId+/judge",title:"评测数据",icon:"list",component:Zo,auths:[Ce.ManageProblem]},{name:"manage-judge",tab:"manage",path:"judge",sidebar:"manage-judge",title:"评测管理",icon:"list",auths:["i-manage-judge"],component:qo}],_t=(e,t,o,r)=>{r.tab==o&&(r.disableSidebar&&t!=r.sidebar||r.sidebar==null||r.sidebar!=r.name||e.push({name:r.name,title:r.title,icon:r.icon,to:{name:r.name}}))},Qo=(e,t)=>{const o=[];return Nt.forEach(r=>{if($t(r)){const l=[];r.children.forEach(p=>{_t(l,e,t,p)}),l.length>0&&o.push({title:r.title,children:l})}else _t(o,e,t,r)}),o},gt=(e,t)=>{const o=Ba(t.tab),r={name:t.name,path:"/"+t.path,meta:{title:t.title+" - "+o.title,tab:t.tab,sidebar:t.sidebar,showSidebar:o.showSidebar,needLogin:o.needLogin||t.needLogin,tabAuths:o.auths,auths:t.auths},component:t.component};o.disablePath||(r.path=o.path+r.path),e.push(r)},el=e=>{Nt.forEach(t=>{$t(t)?t.children.forEach(o=>{gt(e,o)}):gt(e,t)})},qe=[];Xa(qe);el(qe);qe.push({path:"/403",name:"403",component:Dt});qe.push({path:"/:pathMatch(.*)*",name:"404",component:jt});const H=Wt({history:Yt("/"),routes:qe});H.beforeEach((e,t,o)=>{if(e.name==null||!H.hasRoute(e.name)){o({name:"home"});return}const r=e.matched[e.matched.length-1].meta;if(r.redirect){o({name:r.redirect});return}if(r.needLogin){const p=ge();if(p.getToken==null||p.getToken==""){o({name:"login",query:{redirect_uri:e.fullPath}});return}}const l=r.tabAuths;if(l&&!ge().hasAllAuths(l)){o({name:"403",query:{target:e.fullPath}});return}o()});H.afterEach((e,t)=>{if(e.name===t.name)return;const o=Xe(),r=je();let l=null;if(e.matched.length>0&&(l=e.matched[e.matched.length-1].meta),l!=null&&l.title&&r.setTitle(l==null?void 0:l.title),l!=null&&l.showSidebar){o.setSidebarShow(!0);const p=Qo(l==null?void 0:l.sidebar,l==null?void 0:l.tab);o.setMenuList(p),o.setMenuActiveName(l==null?void 0:l.sidebar)}else o.setSidebarShow(!1)});ka.registerLanguage("verilog",Sa);const Ht=Zt();Ht.use(Qt);const Ge=ea(wn);Ge.use(Ht);Ge.use(H);Ge.use(wa);Ge.use(ta);Ge.mount("#app");Ra().then(()=>{console.log("Text cache reinitialized")}).catch(e=>{console.error("Text cache reinitialization failed",e)});
