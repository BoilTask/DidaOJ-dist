import{bl as dt,L as se,r as m,q as ue,bm as K,bn as L,bo as l,v as t,bp as M,bq as F,au as I,br as ra,j as Ea,u as qa,bs as ne,bt as ee,F as oe,bu as Ce,bv as Ka,bw as we,aI as de,bx as Fa,by as Na,bz as Oa,t as Ve,H as Ne,bA as Ga,bB as Be,n as He,w as ze,a as tt,ah as Ha,bC as ht,bD as ia,bE as ua,bb as Ba,bF as Ja,bG as Wa,bH as Xa,bI as ca,aN as Ya,bJ as Ht,bK as jt,bL as Za,a5 as Qa,bM as el,bN as tl,N as al,bO as ll}from"./node_modules-QmRcFnYL.js";import{L as xe,C as _e,R as Se,a as Te,A as Ut,S as nl,b as ol,c as sl,d as rl,e as il,f as ot,T as at,B,F as $e,g as Ue,I as Re,D as nt,h as da,i as he,j as Ye,k as Ze,l as ul,m as De,n as ut,o as mt,P as At,O as Rt,p as ma,q as cl,r as dl,s as pa,t as fa,u as St,v as va,w as ml,x as pl,y as fl,z as vl,E as _l,G as gl,M as _a,H as ga,J as bl,K as hl,N as yl,Q as wl,U as kl,V as Cl,W as Sl,X as Il,Y as Pl,Z as Tl}from"./tdesign-vue-next-DX345cBt.js";import{V as me}from"./vditor-DArazWIS.js";import{e as Bt}from"./monaco-editor-BHsDS0An.js";import{H as xl,v as Vl}from"./highlight.js-D9zWiMxS.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const f of o)if(f.type==="childList")for(const b of f.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&r(b)}).observe(document,{childList:!0,subtree:!0});function n(o){const f={};return o.integrity&&(f.integrity=o.integrity),o.referrerPolicy&&(f.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?f.credentials="include":o.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function r(o){if(o.ep)return;o.ep=!0;const f=n(o);fetch(o.href,f)}})();var Ke=(e=>(e.ManageWeb="i-manage-web",e.ManageJudge="i-manage-judge",e.ManageProblem="i-manage-problem",e.ManageContest="i-manage-contest",e.ManageCollection="i-manage-collection",e))(Ke||{});const Dl={"r-admin":["i-manage-web","i-manage-judge","i-manage-problem","i-manage-contest","i-manage-collection"]};function Ll(e){if(e==null)return[];const a=[];for(const n of e){const r=Dl[n];r!=null&&a.push(...r)}return[...new Set(a)]}function jl(e,a){if(e==null||a==null)return!1;const n=Ll(e);for(const r of a)if(!n.includes(r))return!1;return!0}const je=dt("user",{state:()=>({token:"",userId:-1,username:"",nickname:"",roles:[]}),getters:{getToken(){return this.token},getUserId(){return this.userId},getUsername(){return this.username},getNickname(){return this.nickname}},actions:{clear(){this.$patch({token:"",userId:-1,username:"",nickname:"",roles:[]})},loadResponse(e){this.$patch({token:e.token,userId:e.user_id,username:e.username,nickname:e.nickname,roles:e.roles})},isLogin(){return this.token!=null&&this.token!=""},hasAuth(e){return this.hasAllAuths([e])},hasAllAuths(e){return e?jl(this.roles,e):!0}},persist:!0}),Je=dt("webStyle",{state:()=>({title:""}),getters:{getTitle(){return this.title}},actions:{setTitle(e){this.title=e}}}),It=dt("sidebarStyle",{state:()=>({showSidebar:!1,forceHiddenSidebar:!1,menuActiveName:"",menuList:[]}),getters:{getMenuList(){return this.menuList}},actions:{setSidebarShow(e){this.showSidebar=e},setForceHiddenSidebar(e){this.forceHiddenSidebar=e},setMenuActiveName(e){this.menuActiveName=e},clearMenuList(){this.menuList=[]},setMenuList(e){this.menuList=e},addMenuList(e){this.menuList.push(e)}}}),zl={style:{"text-align":"right"}},$l=se({__name:"Hitokoto",setup(e){const a=m(!1),n=m(""),r=m(""),o=m(""),f=async()=>{a.value=!0;try{const w=await(await fetch("https://v1.hitokoto.cn")).json();r.value=w.hitokoto,o.value=w.creator,n.value="—— "+w.from}catch(b){r.value="一言获取失败了，但至少您还可以访问本站。",o.value="BoilTask",n.value="DidaOJ",console.error("Error fetching Hitokoto:",b)}finally{a.value=!1}};return ue(()=>{f()}),(b,w)=>{const C=_e,g=xe;return L(),K(g,{loading:a.value},{default:l(()=>[t(C,{title:"一言 © Hitokoto"},{actions:l(()=>[I(" @"+F(o.value),1)]),default:l(()=>[M("div",null,[M("span",null,F(r.value),1),M("p",zl,F(n.value),1)])]),_:1})]),_:1},8,["loading"])}}}),Ul="https://oj-api.didapipa.com/",W=ra.create({baseURL:Ul,timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});W.interceptors.request.use(e=>{const n=je().getToken;return n&&(e.headers["X-Token"]=n),e},e=>Promise.reject(e));W.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});const Pt=ra.create({timeout:6e4,withCredentials:!1,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});Pt.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function ba(){return Pt({baseURL:"https://r2-oj.didapipa.com",url:"/system/notification.json?"+Date.now(),method:"get"})}function ha(){return Pt({baseURL:"https://r2-oj.didapipa.com",url:"/system/announcement.json?"+Date.now(),method:"get"})}function Al(){return W({url:"/system/status",method:"get"})}function Rl(){return W({url:"/system/image/token",method:"get"})}function Ml(e,a){return W({url:"/system/notification",method:"post",data:{theme:e,content:a}})}function El(e,a){return W({url:"/system/announcement",method:"post",data:{title:e,content:a}})}let zt=null;async function ql(){zt=await Fl()}function Kl(e,a="zh"){if(zt==null)return[!1,e.toString()];const n=zt[e.toString()];if(!n)return[!1,e.toString()];let r=n[a];return r||(a="zh",r=n[a]),r?[!0,r]:[!1,e.toString()]}async function Fl(){return new Promise(e=>{e({404:{zh:"接口未找到"},1e3:{zh:"系统错误，请重试或等待管理员修复"},1001:{zh:"系统异常，请重试或等待管理员修复"},1002:{zh:"未知错误"},1003:{zh:"操作过于频繁，请稍后重试"},10001:{zh:"权限异常，请重新登陆后再试"},10002:{zh:"参数不符合要求"},10003:{zh:"未找到目标数据"},10004:{zh:"操作需要登录，请登录后重试"},100001:{zh:"用户名不存在或密码不匹配"},100002:{zh:"邮件发送失败，可能是邮箱无效或达到了每日注册上限，如有问题可联系管理员解决"},100003:{zh:"验证码错误或已过期，请重新获取"},100004:{zh:"注册用户失败，可能存在同名用户"},100005:{zh:"用户名不存在，或您未在本系统绑定邮箱，请联系管理员寻求帮助"},100006:{zh:"验证码错误或已过期，请重新获取"},100007:{zh:"已存在相同标题的题目"},100008:{zh:"已存在相同标题的比赛"},100009:{zh:"已存在相同标题的题集"},100010:{zh:"未发现有效题目"},100011:{zh:"题目数量超过限制，无法添加"},100012:{zh:"比赛开始时间无法设置为早于当前时间"},100013:{zh:"当前无法提交题目"},100014:{zh:"申请访问失败，密码错误"}})})}function ce(){const{appContext:e}=Ea();return{globalProperties:e.config.globalProperties}}function Ae(){return 1e3}function et(e,a,n=3e3){return e.$message.success({duration:n,content:a})}function ve(e,a,n=3e3){return e.$message.info({duration:n,content:a})}function fe(e,a,n=3e3){return e.$message.error({duration:n,content:a})}function G(e,a,n=3e3){const[r,o]=Kl(a),f=r?o:`系统错误，错误提示[${o}]`;return e.$message.error({duration:n,content:f})}function ya(e,a){e.$message&&e.$message.close(a)}function Nl(e,a){return e.length<=a?e:e.slice(0,a)+"..."}function wa(e){return e.trim().split(/\s+/).flatMap(r=>r.split(",")).filter(r=>r.trim()!=="")}var Mt=(e=>(e[e.Unknown=-1]="Unknown",e[e.C=0]="C",e[e.Cpp=1]="Cpp",e[e.Java=2]="Java",e[e.Python=3]="Python",e[e.Pascal=4]="Pascal",e[e.Golang=5]="Golang",e[e.Lua=6]="Lua",e[e.TypeScript=7]="TypeScript",e[e.Max=8]="Max",e))(Mt||{});function Et(){const e=[-1,8];return Object.values(Mt).filter(a=>typeof a=="number"&&!e.includes(a)).map(a=>({value:a,label:kt(a)}))}function yt(e){return e>-1&&e<8}function kt(e){switch(e){case 0:return"C";case 1:return"C++";case 2:return"Java";case 3:return"Python";case 4:return"Pascal";case 5:return"Golang";case 6:return"Lua";case 7:return"TypeScript";default:return"未知"}}function qt(e){switch(e){case 0:return"c";case 1:return"cpp";case 2:return"java";case 3:return"python";case 4:return"pascal";case 5:return"go";case 6:return"lua";case 7:return"typescript";default:return"text"}}var qe=(e=>(e[e.Init=0]="Init",e[e.Rejudge=1]="Rejudge",e[e.Submitting=2]="Submitting",e[e.Queuing=3]="Queuing",e[e.Compiling=4]="Compiling",e[e.Running=5]="Running",e[e.Accept=6]="Accept",e[e.PE=7]="PE",e[e.WA=8]="WA",e[e.TLE=9]="TLE",e[e.MLE=10]="MLE",e[e.OLE=11]="OLE",e[e.RE=12]="RE",e[e.CE=13]="CE",e[e.CLE=14]="CLE",e[e.JudgeFail=15]="JudgeFail",e[e.SubmitFail=16]="SubmitFail",e[e.Unknown=17]="Unknown",e[e.Max=18]="Max",e))(qe||{});const Ol=e=>{switch(e){case 0:return"普通评测";case 1:return"特殊评测";default:return"未知"}},Ct=e=>{switch(e){case 0:return"等待处理";case 1:return"重新评测";case 2:return"提交中";case 3:return"队列中";case 4:return"编译中";case 5:return"运行中";case 6:return"通过";case 7:return"格式错误";case 8:return"答案错误";case 9:return"超时";case 10:return"内存超限";case 11:return"输出超限";case 12:return"运行错误";case 13:return"编译错误";case 14:return"编译超限";case 15:return"评测失败";case 16:return"提交失败";case 17:return"未知";default:return e}},ka=e=>{switch(e){case 0:case 1:case 2:case 3:case 4:case 5:case 17:return"default";case 6:return"success";case 7:return"warning";default:return"danger"}};function Ca(){const e=[17,18];return Object.values(qe).filter(a=>typeof a=="number"&&!e.includes(a)).map(a=>({value:a,label:Ct(a)}))}function wt(e){return e>=0&&e<17}function it(e){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return!0;default:return!1}}function Sa(e){var n;const a={};if(a.id=e.id,a.problemId=e.problem_id,a.contestProblemIndex=e.contest_problem_index,a.status=e.status,it(e.status)||!wt(e.status)?a.score="-":a.score=e.score.toString(),e.time?a.time=Math.ceil(e.time/1e6)+"ms":a.time="-",e.memory?a.memory=(e.memory/1024/1024).toFixed(2)+"MB":a.memory="-",a.language=e.language,a.codeLength=e.code_length,e.approve_time?a.approveTime=new Date(e.approve_time).toLocaleString():a.approveTime="-",a.author=e.author,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.code=e.code,a.compileMessage=e.compile_message,a.taskCurrent=e.task_current,a.taskTotal=e.task_total,a.task=[],e.task)for(let r=0;r<((n=e.task)==null?void 0:n.length);r++){const o=e.task[r],f={};f.taskId=o.task_id,f.status=o.status,o.time?f.time=Math.ceil(o.time/1e6)+"ms":f.time="-",o.memory?f.memory=(o.memory/1024/1024).toFixed(2)+"MB":f.memory="-",f.score=o.score,f.content=o.content,f.waHint=o.wa_hint,!f.content&&!f.waHint&&(f.content="无提示信息"),a.task.push(f)}return e.judger&&(a.judger=e.judger),e.judger_name?a.judgerName=e.judger_name:a.judgerName="-",e.judge_time&&(a.judgeTime=new Date(e.judge_time).toLocaleString()),a}function Gl(e,a,n,r,o){return W({url:"/judge/approve",method:"post",data:{problem_id:e,contest_id:a,problem_index:n,language:r,code:o}})}function Hl(e){return W({url:"/judge?id="+e,method:"get"})}function Bl(e){return W({url:"/judge/code?id="+e,method:"get"})}function Jl(e,a,n,r,o,f,b){let w={problem_id:a,username:n,language:String(r),status:String(o),page:String(f),page_size:String(b)};return e&&(w.contest_id=String(e)),W({url:`/judge/list?${new URLSearchParams(w).toString()}`,method:"get"})}function Wl(){return W({url:"/judge/statics/recently",method:"get"})}function Xl(){return W({url:"/judge/rejudge/recently",method:"post"})}function Yl(e,a,n){const r={};return e!=null&&(r.problem_id=e),a!=null?r.language=a:r.language=Mt.Unknown,n!=null?r.status=n:r.status=18,W({url:"/judge/rejudge/search",method:"post",data:r})}function Zl(){return W({url:"/judge/rejudge/all",method:"post",timeout:0})}function Ql(e){return W({url:"/judge/rejudge",method:"post",data:{id:Number(e)}})}var Fe=(e=>(e[e.None=0]="None",e[e.Attempt=1]="Attempt",e[e.Accept=2]="Accept",e))(Fe||{});function pt(e,a){const n={};if(n.id=e.id,n.author=e.author,n.title=e.title,n.tags=[],e.tags)for(const r of e.tags){const o=a[r];o&&n.tags.push(o)}if(n.private=e.private,n.accept=e.accept,n.attempt=e.attempt,e.description!=null&&(n.description=e.description),e.time_limit!=null&&e.time_limit>=0?n.timeLimit=e.time_limit.toString()+" ms":n.timeLimit="未知",e.memory_limit!=null&&e.memory_limit>=0?n.memoryLimit=(e.memory_limit/1024).toFixed(2)+" MB":n.memoryLimit="未知",e.judge_type!=null&&(n.judgeType=Ol(e.judge_type)),e.insert_time!=null&&(n.insertTime=new Date(e.insert_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.source!=null){const r=/\[([^\]]+)\]\(([^)]+)\)/,o=e.source.match(r);o?(n.source=o[1],n.sourceUrl=o[2]):(n.source=e.source,n.sourceUrl="")}return e.judge_md5!=null&&(n.judgeMd5=e.judge_md5),e.origin_oj!=null&&(n.originOj=e.origin_oj),e.origin_id!=null&&(n.originId=e.origin_id),e.origin_url!=null&&(n.originUrl=e.origin_url),n}function en(e,a){const n={};if(n.id=e.id,n.problemId=e.problem_id,n.title=e.title,n.tags=[],e.tags)for(const r of e.tags){const o=a[r];o&&n.tags.push(o)}return e.accept?n.accept=e.accept:n.accept=0,e.attempt?n.attempt=e.attempt:n.attempt=0,n.solution=e.solution,n.code=e.code,n}function Ia(e,a,n){const r={};return e?r.id=e:(r.contest_id=a,r.problem_index=n),W({url:`/problem?${new URLSearchParams(r).toString()}`,method:"get"})}function Pa(e){return W({url:"/problem/tag/list?max_count="+e,method:"get"})}function tn(e){return W({url:"/problem/judge?id="+e,method:"get"})}function an(e,a,n,r,o,f){const b={};return e&&(b.oj=e),a&&(b.title=a),n&&(b.tag=n),r!==void 0&&(b.private=r?"1":"0"),o&&(b.page=o),f&&(b.page_size=f),W({url:`/problem/list?${new URLSearchParams(b).toString()}`,method:"get"})}function ln(e){const a={};return e&&(a.problem_id=e),W({url:`/problem/recommend?${new URLSearchParams(a).toString()}`,method:"get"})}function nn(e){return W({url:"/problem/daily?id="+e,method:"get"})}function on(){return W({url:"/problem/daily/recently",method:"get"})}function sn(e,a,n,r){const o={};return n&&(o.page=n),r&&(o.page_size=r),W({url:`/problem/daily/list?${new URLSearchParams(o).toString()}`,method:"get"})}function Ta(e,a){return W({url:"/problem/crawl",method:"post",data:{oj:e,id:a}})}function rn(e,a,n,r,o,f,b){return W({url:"/problem/create",method:"post",data:{title:e,time_limit:a,memory_limit:n,source:r,private:o,tags:f,description:b}})}function un(e,a,n,r,o,f,b,w){return W({url:"/problem/edit",method:"post",data:{id:e,title:a,time_limit:n,memory_limit:r,source:o,private:f,tags:b,description:w}})}function cn(e,a){return W({url:"/problem/judge/data/download?id="+e+"&key="+a,method:"get"})}function dn(e){return W({url:"/problem/image/token?id="+e,method:"get"})}function mn(e,a){const n=new FormData;return n.append("id",e),n.append("zip",a),W({url:"/problem/judge/data",method:"post",data:n,headers:{"Content-Type":"multipart/form-data"},timeout:1e3*60*5})}function pn(e){return W({url:"/problem/parse",method:"post",data:{problems:e}})}const fn={class:"sh-main"},vn={class:"dida-swiper-div"},_n=["innerHTML"],gn=se({__name:"HomeView",setup(e){const{globalProperties:a}=ce();let n=-1;const r=m({theme:"info",content:""}),o=m({title:"",content:""}),f=m([]),b=m(!1),w=async()=>{r.value=await ba()},C=async()=>{try{const d=await ha(),u={math:{inlineDigit:!0,engine:"KaTeX"}};o.value.title=d.title,o.value.content=await me.md2html(d.content,u)}catch{fe(a,"加载公告失败"),o.value={title:"公告加载失败",content:"请刷新页面重新获取"}}},g=async()=>{const d=await Wl();if(d.code!==0){fe(a,"加载OJ统计数据失败");return}let u=[];for(const p of d.data){const k=new Date(p.date),_=`${k.getMonth()+1}-${k.getDate()}`;u.push({Date:_,Type:"Unaccept",Count:p.attempt-p.accept}),u.push({Date:_,Type:"Accept",Count:p.accept})}const v={type:"bar",data:[{id:"barData",values:u}],xField:"Date",yField:"Count",seriesField:"Type",stack:!0,legends:{visible:!0},bar:{state:{hover:{stroke:"#000",lineWidth:1}}},height:300};new Ka(v,{dom:"ojStaticsDiv"}).renderSync()},i=async()=>{f.value=[];const d=await on();if(d.code!==0){fe(a,"加载每日问题数据失败");return}d.data.list&&d.data.list.length>0&&d.data.list.forEach(u=>{let v="default",P="未尝试";if(d.data.attempt_status){const k=d.data.attempt_status[u.problem_id];if(k)switch(k){case Fe.Accept:v="success",P="已解决";break;case Fe.Attempt:v="warning",P="待解决";break;default:v="default",P="未尝试"}}const p=`${u.title}`;f.value.push({id:u.id,title:p,problemId:u.problem_id,theme:v,tag:P})})};return ue(async()=>{b.value=!0,await w(),n=setInterval(()=>{w()},3e4),await C(),await g(),await i(),b.value=!1}),qa(()=>{clearInterval(n)}),(d,u)=>{const v=Ut,P=ol,p=nl,k=_e,_=Te,h=ot,c=il,s=at,T=rl,y=sl,D=Se,z=xe;return L(),K(z,{loading:b.value},{default:l(()=>[t(D,null,{default:l(()=>[t(_,{span:8},{default:l(()=>{var x;return[M("div",fn,[r.value?(L(),K(v,{key:0,class:"dida-notification-div",theme:r.value.theme},{default:l(()=>[I(F(r.value.content),1)]),_:1},8,["theme"])):ne("",!0),M("div",vn,[t(p,{class:"dida-swiper"},{default:l(()=>[t(P,null,{default:l(()=>u[1]||(u[1]=[M("a",{href:"http://codeoj.cn",target:"_blank"},[M("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"})],-1)])),_:1}),t(P,null,{default:l(()=>u[2]||(u[2]=[M("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1})]),_:1})]),u[3]||(u[3]=M("div",{id:"ojStaticsDiv"},null,-1)),t(k,{title:(x=o.value)==null?void 0:x.title,style:{width:"calc(100% - 100px)",margin:"0 auto"}},{default:l(()=>{var V;return[M("div",{innerHTML:(V=o.value)==null?void 0:V.content},null,8,_n)]}),_:1},8,["title"])])]}),_:1}),t(_,{span:4},{default:l(()=>[t(k,{style:{margin:"10px"},bordered:!0},{default:l(()=>u[4]||(u[4]=[M("img",{src:"https://api.jysafe.cn/ip/",alt:"Welcome",style:{width:"100%"}},null,-1)])),_:1}),t($l,{style:{margin:"10px"}}),t(k,{style:{margin:"10px"},bordered:!0,title:"每日一题"},{actions:l(()=>[t(h,{onClick:u[0]||(u[0]=x=>d.$router.push({name:"problem-daily-list"}))},{default:l(()=>u[5]||(u[5]=[I("查看全部")])),_:1})]),default:l(()=>[t(y,{split:!0,size:"small"},{default:l(()=>[(L(!0),ee(oe,null,Ce(f.value,x=>(L(),K(T,{key:x.id},{default:l(()=>[t(c,{style:{width:"100px"}},{description:l(()=>[t(h,{onClick:V=>d.$router.push({name:"problem-daily-detail",params:{dailyId:x.id}})},{default:l(()=>[I(F(x.problemId),1)]),_:2},1032,["onClick"])]),_:2},1024),t(c,{style:{width:"200px"}},{description:l(()=>[t(h,{onClick:V=>d.$router.push({name:"problem-daily-detail",params:{dailyId:x.id}})},{default:l(()=>[I(F(x.title),1)]),_:2},1032,["onClick"])]),_:2},1024),t(c,{style:{width:"135px"},description:x.id},null,8,["description"]),t(c,null,{description:l(()=>[t(s,{theme:x.theme},{default:l(()=>[I(F(x.tag),1)]),_:2},1032,["theme"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),t(k,{style:{margin:"10px"},bordered:!0},{header:l(()=>u[6]||(u[6]=[M("b",null,"友情链接",-1)])),default:l(()=>[t(y,null,{default:l(()=>[t(T,null,{default:l(()=>[t(h,{href:"https://boiltask.com",target:"_blank"},{default:l(()=>u[7]||(u[7]=[I("BoilTask Blog")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])}}}),re=(e,a)=>{const n=e.__vccOpts||e;for(const[r,o]of a)n[r]=o;return n},bn=re(gn,[["__scopeId","data-v-91bd14b1"]]),hn={class:"sh-main"},yn=se({__name:"View404",setup(e){let a=we(),n=m(a.fullPath);return(r,o)=>{const f=B;return L(),ee("div",hn,[M("p",null,F(de(n)),1),o[2]||(o[2]=M("p",null,"该页面无效或已被迁移，请重新选择访问目标",-1)),t(f,{theme:"primary",onClick:o[0]||(o[0]=()=>r.$router.push("/"))},{default:l(()=>o[1]||(o[1]=[I("返回首页")])),_:1})])}}}),xa=re(yn,[["__scopeId","data-v-d4218944"]]);function wn(e){const a={};return a.id=e.id,a.username=e.username,a.nickname=e.nickname,a.email=e.email,a.slogan=e.slogan,a.organization=e.organization,a.accept=e.accept,a.attempt=e.attempt,a.vjudgeId=e.vjudge_id,e.email&&(a.avatar=`https://www.gravatar.com/avatar/${Fa(e.email.toLowerCase().trim())}?d=identicon&s=100`),a}function kn(e,a){return W({url:"/user/login",method:"post",data:{username:e,password:a}})}function Cn(){return W({url:"/user/login/refresh",method:"post"})}function Sn(e){const a={username:e};return W({url:`/user/info?${new URLSearchParams(a).toString()}`,method:"get"})}function In(e){const a="https://vjudge.net/user/solveDetail/"+encodeURIComponent(e);return Pt({url:a,method:"get"})}function Pn(e){return W({url:"/user/account/infos",method:"post",data:{users:e}})}function Tn(e){return W({url:"/user/parse",method:"post",data:{users:e}})}function xn(e,a){return W({url:"/user/register/email",method:"post",data:{token:e,email:a}})}function Vn(e,a,n,r,o){return W({url:"/user/register",method:"post",data:{username:e,password:a,email:n,key:r,nickname:o}})}function Dn(e,a){return W({url:"/user/forget",method:"post",data:{token:e,username:a}})}function Ln(e,a,n){return W({url:"/user/password/modify",method:"post",data:{username:e,password:a,key:n}})}const jn={class:"dida-login-footer"},zn=se({__name:"LoginView",setup(e){const{globalProperties:a}=ce(),n=je(),r=m(!1),o=m({username:"",password:""}),f=()=>{ve(a,"重置成功")},b=({validateResult:w,firstError:C})=>{r.value||(r.value=!0,kn(o.value.username,o.value.password).then(g=>{if(g.code===0){n.loadResponse(g.data),ve(a,"登录成功");let i=a.$route.query.redirect_uri;i||(i="/user/"+g.data.username),a.$router.push({path:i})}else G(a,g.code)}).catch(g=>{console.error("Login error",g),fe(a,"登录失败")}).finally(()=>{r.value=!1}))};return ue(()=>{if(n.isLogin()){a.$router.push({path:"/user"});return}}),(w,C)=>{const g=Re,i=Ue,d=B,u=$e,v=ot,P=_e;return L(),K(P,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:l(()=>[t(u,{ref:"form",data:o.value,colon:!0,onReset:f,onSubmit:b,class:"yj-login-form","label-width":0},{default:l(()=>[t(i,{name:"username"},{default:l(()=>[t(g,{modelValue:o.value.username,"onUpdate:modelValue":C[0]||(C[0]=p=>o.value.username=p),clearable:"",autocomplete:"username",placeholder:"请输入用户名"},{"prefix-icon":l(()=>[t(de(Na))]),_:1},8,["modelValue"])]),_:1}),t(i,{name:"password"},{default:l(()=>[t(g,{modelValue:o.value.password,"onUpdate:modelValue":C[1]||(C[1]=p=>o.value.password=p),type:"password",autocomplete:"current-password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":l(()=>[t(de(Oa))]),_:1},8,["modelValue"])]),_:1}),t(i,null,{default:l(()=>[t(d,{theme:"primary",type:"submit",block:"",loading:r.value},{default:l(()=>C[4]||(C[4]=[I("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),M("div",jn,[t(v,{onClick:C[2]||(C[2]=()=>{de(a).$router.push({name:"login-forget"})})},{default:l(()=>C[5]||(C[5]=[I("忘记密码 ")])),_:1}),t(v,{onClick:C[3]||(C[3]=()=>{de(a).$router.push({name:"register"})})},{default:l(()=>C[6]||(C[6]=[I("注册账户 ")])),_:1})])]),_:1})}}}),$n=re(zn,[["__scopeId","data-v-0466c42d"]]),Un={class:"dida-login-footer"},An=se({__name:"RegisterView",setup(e){const{globalProperties:a}=ce(),n=je(),r=m(!1),o=m(!1),f=m(!1),b=m("发送验证码");let w=null,C=-1;const g=m(!1),i=m(null),d=m({username:"",password:"",confirmPassword:"",nickname:"",email:"",emailKey:""}),v=m({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:c=>new Promise(s=>{const T=setTimeout(()=>{s(d.value.password===c),clearTimeout(T)})}),message:"两次密码不一致"}],nickname:[{required:!0,message:"请填写昵称"},{min:1,message:"昵称至少1个字符"},{max:30,message:"昵称最多30个字符"}],email:[{required:!0,message:"请填写邮箱"},{pattern:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"邮箱格式不正确"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),P=m(()=>t(B,{onClick:p,disabled:f.value,loading:o.value,style:"width:120px"},{default:()=>[b.value]})),p=async()=>{var y;if(!d.value.email){fe(a,"请输入邮箱");return}if(!d.value.email.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)){fe(a,"邮箱格式不正确");return}if(f.value||o.value)return;g.value=!0,await Ne();const c=document.getElementById("cf-confirm-div");c&&c.remove();const s=document.createElement("div");s.id="cf-confirm-div",s.setAttribute("data-theme","light"),(y=i.value)==null||y.appendChild(s);const T=window;T.turnstile.ready(function(){T.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(D){g.value=!1,await k(D)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},k=async c=>{if(!f.value){o.value=!0;try{const s=await xn(c,d.value.email);if(s.code!==0){G(a,s.code);return}ve(a,"发送验证码成功"),o.value=!1,f.value=!0,w=new Date,b.value="60秒后重发",C=setInterval(()=>{const y=Math.floor((new Date().getTime()-(w==null?void 0:w.getTime()))/1e3);y>60?(b.value="发送验证码",f.value=!1,clearInterval(C)):b.value=`${60-y}秒后重发`},1e3)}catch{fe(a,"发送验证码失败")}finally{o.value=!1}}},_=()=>{ve(a,"重置成功")},h=({validateResult:c,firstError:s,e:T})=>{if(!r.value){if(T.preventDefault(),c!==!0){fe(a,s);return}if(d.value.password!==d.value.confirmPassword){fe(a,"两次密码不一致");return}r.value=!0,Vn(d.value.username,d.value.password,d.value.email,d.value.emailKey,d.value.nickname).then(y=>{y.code===0?(ve(a,"注册成功，可使用账号信息登录"),a.$router.push({name:"login"})):G(a,y.code)}).catch(y=>{console.error("Login error",y),fe(a,"登录失败")}).finally(()=>{r.value=!1})}};return ue(()=>{if(n.isLogin()){a.$router.push({path:"/user"});return}}),Ve(()=>{clearInterval(C)}),(c,s)=>{const T=Re,y=Ue,D=da,z=B,x=$e,V=ot,$=_e,A=nt;return L(),ee(oe,null,[t($,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:l(()=>[t(x,{ref:"form",rules:v.value,data:d.value,colon:!0,onReset:_,onSubmit:h,class:"yj-login-form"},{default:l(()=>[t(y,{name:"username",label:"用户名"},{default:l(()=>[t(T,{modelValue:d.value.username,"onUpdate:modelValue":s[0]||(s[0]=U=>d.value.username=U),clearable:"",placeholder:"用于登录与查找"},null,8,["modelValue"])]),_:1}),t(y,{name:"password",label:"密码"},{default:l(()=>[t(T,{modelValue:d.value.password,"onUpdate:modelValue":s[1]||(s[1]=U=>d.value.password=U),type:"password",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(y,{name:"confirmPassword",label:"确认密码"},{default:l(()=>[t(T,{modelValue:d.value.confirmPassword,"onUpdate:modelValue":s[2]||(s[2]=U=>d.value.confirmPassword=U),type:"password",clearable:"",placeholder:"请确认密码"},null,8,["modelValue"])]),_:1}),t(y,{name:"nickname",label:"昵称"},{default:l(()=>[t(T,{modelValue:d.value.nickname,"onUpdate:modelValue":s[3]||(s[3]=U=>d.value.nickname=U),clearable:"",placeholder:"用于优先在网站各处展示"},null,8,["modelValue"])]),_:1}),t(y,{name:"email",label:"邮箱"},{default:l(()=>[t(T,{modelValue:d.value.email,"onUpdate:modelValue":s[4]||(s[4]=U=>d.value.email=U),clearable:"",placeholder:"请填写常用邮箱"},null,8,["modelValue"])]),_:1}),t(y,{name:"emailKey",label:"验证码"},{default:l(()=>[t(D,{append:P.value},{default:l(()=>[t(T,{modelValue:d.value.emailKey,"onUpdate:modelValue":s[5]||(s[5]=U=>d.value.emailKey=U),clearable:"",placeholder:"请输入验证码",style:{width:"140px"}},null,8,["modelValue"])]),_:1},8,["append"])]),_:1}),t(y,null,{default:l(()=>[t(z,{theme:"primary",type:"submit",block:"",loading:r.value},{default:l(()=>s[8]||(s[8]=[I("注册")])),_:1},8,["loading"])]),_:1})]),_:1},8,["rules","data"]),M("div",Un,[t(V,{onClick:s[6]||(s[6]=()=>{de(a).$router.push({name:"login"})})},{default:l(()=>s[9]||(s[9]=[I("返回登陆 ")])),_:1})])]),_:1}),t(A,{visible:g.value,"onUpdate:visible":s[7]||(s[7]=U=>g.value=U),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:l(()=>[M("div",{ref_key:"dialogContainer",ref:i,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),Rn=re(An,[["__scopeId","data-v-d25e7538"]]),Mn={key:0,style:{margin:"10px"}},En={key:1,style:{margin:"10px"}},qn={style:{margin:"12px"}},Kn=se({__name:"UserView",setup(e){let a=we();const{globalProperties:n}=ce(),r=Je();let o="";const f=m(!1),b=m(null),w=m([]),C=m([]),g=m([]),i=async d=>{f.value=!0;try{let u=await Sn(d);if(u.code!==0){f.value=!1,G(n,u.code),await Z.push({name:"home"});return}if(b.value=wn(u.data.user),w.value=u.data.problems_ac,r.setTitle(b.value.nickname+" - "+r.getTitle),b.value.vjudgeId){const v=await In(b.value.vjudgeId);C.value=v.acRecords;for(const P in C.value)C.value[P].sort((p,k)=>p.length===k.length?p.localeCompare(k):p.length-k.length);g.value=v.failRecords;for(const P in g.value)g.value[P].sort((p,k)=>p.length===k.length?p.localeCompare(k):p.length-k.length)}}catch{fe(n,"获取用户信息失败"),await Z.push({name:"home"})}finally{f.value=!1}};return Ga(async(d,u,v)=>{if(Array.isArray(d.params.username)?o=d.params.username[0]:o=d.params.username,!o){await Z.push({name:"home"});return}await i(o),v()}),ue(async()=>{if(Array.isArray(a.params.username)?o=a.params.username[0]:o=a.params.username,!o){await Z.push({name:"home"});return}await i(o)}),(d,u)=>{const v=B,P=he,p=_e,k=ot,_=Ze,h=Ye,c=Te,s=ul,T=Se,y=xe;return L(),K(y,{loading:f.value},{default:l(()=>[t(T,{class:"dida-main-content"},{default:l(()=>[t(c,{span:8},{default:l(()=>{var D;return[t(p,{style:{margin:"10px"},title:"AC题目"},{default:l(()=>[t(P,{style:{"flex-wrap":"wrap"}},{default:l(()=>[(L(!0),ee(oe,null,Ce(w.value,z=>(L(),K(v,{key:z,size:"small",onClick:()=>de(Z).push({name:"problem-detail",params:{problemId:z}})},{default:l(()=>[I(F(z),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),(D=b.value)!=null&&D.vjudgeId?(L(),K(p,{key:0,style:{margin:"10px"},title:"vjudge.net"},{actions:l(()=>{var z;return[t(k,{href:"https://vjudge.net/user/"+((z=b.value)==null?void 0:z.vjudgeId),target:"_blank"},{default:l(()=>{var x;return[I("@"+F((x=b.value)==null?void 0:x.vjudgeId),1)]}),_:1},8,["href"])]}),default:l(()=>[C.value&&Object.keys(C.value).length>0?(L(),ee("div",Mn,[u[0]||(u[0]=M("div",{style:{margin:"5px"}},[M("span",null,"AC")],-1)),t(h,{layout:"vertical",bordered:!0},{default:l(()=>[(L(!0),ee(oe,null,Ce(C.value,(z,x)=>(L(),K(_,{key:x,label:x},{default:l(()=>[t(P,{style:{"flex-wrap":"wrap"}},{default:l(()=>[(L(!0),ee(oe,null,Ce(z,V=>(L(),K(v,{key:V,size:"small",onClick:()=>de(Z).push({name:"problem-detail",params:{problemId:x+"-"+V}})},{default:l(()=>[I(F(V),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):ne("",!0),g.value&&Object.keys(g.value).length>0?(L(),ee("div",En,[u[1]||(u[1]=M("div",{style:{margin:"5px"}},[M("span",null,"Fail")],-1)),t(h,{layout:"vertical",bordered:!0},{default:l(()=>[(L(!0),ee(oe,null,Ce(g.value,(z,x)=>(L(),K(_,{key:x,label:x},{default:l(()=>[t(P,{style:{"flex-wrap":"wrap"}},{default:l(()=>[(L(!0),ee(oe,null,Ce(z,V=>(L(),K(v,{key:V,size:"small",onClick:()=>de(Z).push({name:"problem-detail",params:{problemId:x+"-"+V}})},{default:l(()=>[I(F(V),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):ne("",!0)]),_:1})):ne("",!0)]}),_:1}),t(c,{span:4},{default:l(()=>[M("div",qn,[t(h,{layout:"vertical",bordered:!0},{default:l(()=>[t(_,{label:"头像"},{default:l(()=>{var D;return[t(s,{shape:"round",size:"100px",image:(D=b.value)==null?void 0:D.avatar,"hide-on-load-failed":!1},null,8,["image"])]}),_:1}),t(_,{label:"昵称"},{default:l(()=>{var D;return[I(F((D=b.value)==null?void 0:D.nickname),1)]}),_:1}),t(_,{label:"Slogan"},{default:l(()=>{var D;return[I(F((D=b.value)==null?void 0:D.slogan),1)]}),_:1}),t(_,{label:"邮箱"},{default:l(()=>{var D;return[I(F((D=b.value)==null?void 0:D.email),1)]}),_:1}),t(_,{label:"组织"},{default:l(()=>{var D;return[I(F((D=b.value)==null?void 0:D.organization),1)]}),_:1}),t(_,{label:"通过数量"},{default:l(()=>{var D;return[I(F((D=b.value)==null?void 0:D.accept),1)]}),_:1}),t(_,{label:"提交数量"},{default:l(()=>{var D;return[I(F((D=b.value)==null?void 0:D.attempt),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Fn=re(Kn,[["__scopeId","data-v-6d730b5a"]]),Kt=[{name:"home",path:"/",title:"首页",showSidebar:!1,disableGenerateTab:!0,component:bn},{name:"problem",path:"/problem",title:"题目",icon:"calculation",showSidebar:!0,redirect:"problem-list"},{name:"collection-detail-tab",title:"题集",path:"/collection",showSidebar:!0,disableGenerateTab:!0,redirect:"problem-collection-list"},{name:"judge",path:"/judge",title:"评测",icon:"code",showSidebar:!0,redirect:"judge-list"},{name:"contest",path:"/contest",title:"比赛",icon:"application",showSidebar:!0,redirect:"contest-list"},{name:"contest-detail-tab",title:"比赛",path:"/contest",showSidebar:!0,disableGenerateTab:!0,redirect:"contest-list"},{name:"discuss",title:"讨论",path:"/discuss",icon:"sonic",showSidebar:!0,redirect:"discuss-list"},{name:"rank",path:"/rank",title:"排名",icon:"chart-column",showSidebar:!0,redirect:"rank-ac-all"},{name:"system",path:"/system",title:"系统",icon:"dashboard",showSidebar:!0,redirect:"system-status"},{name:"manage",path:"/manage",title:"管理",icon:"command",showSidebar:!0,redirect:"manage-web",auths:[Ke.ManageWeb]},{name:"login",path:"/login",title:"登陆",showSidebar:!1,disableGenerateTab:!0,component:$n},{name:"register",path:"/register",title:"注册",showSidebar:!1,disableGenerateTab:!0,component:Rn},{name:"user",path:"/user/:username+",title:"用户",showSidebar:!1,needLogin:!0,disableGenerateTab:!0,component:Fn},{name:"404",path:"/404",title:"404",showSidebar:!1,disableGenerateTab:!0,component:xa}],Nn=e=>Kt.find(a=>a.name==e),On=e=>{const a=[];return Kt.forEach(n=>{!n.disableGenerateTab&&e.hasAllAuths(n.auths)&&a.push(n)}),a},Gn=e=>{Kt.forEach(a=>{const n={name:a.name,path:a.path,meta:{title:a.title,tab:a.name,showSidebar:a.showSidebar,needLogin:a.needLogin,redirect:a.redirect,tabAuths:a.auths},component:a.component};e.push(n)})};function Va(e){return e.children!==void 0}function Hn(e){return e.children!==void 0}const Bn={style:{margin:"10px"}},Jn={key:0,class:"dida-operation-container"};function Wn(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const Xn=se({__name:"ProblemList",setup(e){const a=we(),n=Be(),{globalProperties:r}=ce(),o=je();let f=null;const b=m(!1),w={};let C={};const g=m(!1),i=He(()=>o.hasAuth(Ke.ManageProblem)),d=m([{title:"ID",colKey:"id",cell:(U,S)=>{let j=y(S.row.id);return t(B,{variant:"dashed",theme:j,onClick:()=>T(S.row.id)},{default:()=>[S.row.id]})}},{title:"标题",colKey:"title",cell:(U,S)=>t(B,{variant:"text",onClick:()=>T(S.row.id)},{default:()=>[S.row.title]})},{title:"标签",colKey:"tags",cell:(U,S)=>{const j=S.row.tags;if(!j||j.length===0)return"";let R=[];for(let O=0;O<j.length;O++){const X=j[O];R.push(t(B,{key:O,theme:"default",variant:"outline",size:"small",onClick:()=>x(X)},{default:()=>[X.name]}))}return t(he,null,Wn(R)?R:{default:()=>[R]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),u=m(!1);let v=1,P=50;const p=m({current:v,pageSize:P,defaultCurrent:v,defaultPageSize:P,total:0,pageSizeOptions:[50,100]}),k=m(),_=m(),h=[{label:"DidaOJ",value:"didaoj"},{label:"HDU",value:"hdu"},{label:"POJ",value:"poj"},{label:"NYOJ",value:"nyoj"}],c=m({oj:"",title:"",tag:"",private:!1}),s=m({oj:"",problem:""}),T=U=>{U&&n.push({path:"/problem/"+U})},y=U=>{if(!U||!C)return"default";const S=C[U];if(!S)return"default";switch(S){case Fe.Accept:return"success";case Fe.Attempt:return"warning";default:return"default"}},D=async()=>{await n.push({query:{...a.query,oj:c.value.oj,title:c.value.title,tag:c.value.tag,private:c.value.private?"1":"0",page:1,page_size:p.value.defaultPageSize}})},z=async()=>{try{g.value=!0;const U=await Ta(s.value.oj,s.value.problem);U.code===0?(ve(r,"搜索成功"),await n.push({name:"problem-detail",params:{problemId:U.data}})):G(r,U.code)}catch(U){console.error(U),G(r,Ae())}finally{g.value=!1}},x=U=>{U&&n.push({query:{...a.query,title:"",tag:U.name,page:1,page_size:p.value.defaultPageSize}})},V=()=>{n.push({name:"manage-problem-create"})},$=async(U,S)=>{u.value=!0;try{const{current:j,pageSize:R}=U,O=await an(c.value.oj,c.value.title,c.value.tag,c.value.private,j,R);if(k.value=[],O.code===0){const X=O.data.list;if(!X||X.length<=0){p.value={...p.value,total:0},C={},ve(r,"未找到记录");return}X.forEach(te=>{var H;const J=pt(te,w);(H=k.value)==null||H.push(J)}),p.value={...p.value,total:O.data.total_count},C=O.data.problem_attempt_status}else S&&G(r,O.code)}catch(j){console.error(j),G(r,Ae())}finally{u.value=!1}},A=async U=>{await n.push({query:{...a.query,page:U.current,page_size:U.pageSize}})};return ue(async()=>{u.value=!0,_.value=[],Pa(-1).then(U=>{if(U.code===0){_.value=U.data.list,b.value=U.data.total_count>U.data.list.length;for(let S=0;S<U.data.list.length;S++){const j=U.data.list[S];w[j.id]=j}f=ze(()=>a.query,S=>{c.value.oj=S.oj||"",c.value.title=S.title||"",c.value.tag=S.tag||"",c.value.private=S.private==="1";const j=parseInt(S.page)||p.value.defaultCurrent,R=parseInt(S.page_size)||p.value.defaultPageSize;v=j,P=R,p.value={...p.value,current:v,pageSize:P},$({current:v,pageSize:P},!0)},{immediate:!0})}else b.value=!0}).catch(U=>{console.error(U),b.value=!0})}),Ve(()=>{f&&f()}),(U,S)=>{const j=De,R=_e,O=Te,X=B,te=he,J=ut,H=Ue,N=Re,ye=mt,Pe=$e,q=Se;return L(),K(q,null,{default:l(()=>[t(O,{span:9},{default:l(()=>[t(R,{style:{margin:"10px"}},{default:l(()=>[t(j,{data:k.value,columns:d.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:p.value,"table-layout":"auto",loading:u.value,onPageChange:A},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(O,{span:3},{default:l(()=>[M("div",Bn,[i.value?(L(),ee("div",Jn,[t(te,null,{default:l(()=>[t(X,{onClick:V},{default:l(()=>S[7]||(S[7]=[I("新建")])),_:1})]),_:1})])):ne("",!0),t(R,{class:"sh-card"},{default:l(()=>[t(Pe,{model:c.value,onSubmit:D},{default:l(()=>[t(H,{label:"OJ"},{default:l(()=>[t(J,{modelValue:c.value.oj,"onUpdate:modelValue":S[0]||(S[0]=E=>c.value.oj=E),options:h,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(H,{label:"标题"},{default:l(()=>[t(N,{modelValue:c.value.title,"onUpdate:modelValue":S[1]||(S[1]=E=>c.value.title=E),placeholder:"请输入关键词"},null,8,["modelValue"])]),_:1}),t(H,{label:"标签"},{default:l(()=>[t(N,{modelValue:c.value.tag,"onUpdate:modelValue":S[2]||(S[2]=E=>c.value.tag=E),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),i.value?(L(),K(H,{key:0,label:"私有"},{default:l(()=>[t(ye,{modelValue:c.value.private,"onUpdate:modelValue":S[3]||(S[3]=E=>c.value.private=E)},null,8,["modelValue"])]),_:1})):ne("",!0),t(H,null,{default:l(()=>[t(X,{theme:"primary",type:"submit"},{default:l(()=>S[8]||(S[8]=[I("搜索")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(R,{class:"sh-card"},{default:l(()=>[t(Pe,{model:s.value,onSubmit:z},{default:l(()=>[t(H,{label:"OJ"},{default:l(()=>[t(J,{modelValue:s.value.oj,"onUpdate:modelValue":S[4]||(S[4]=E=>s.value.oj=E),options:h,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(H,{label:"题目"},{default:l(()=>[t(N,{modelValue:s.value.problem,"onUpdate:modelValue":S[5]||(S[5]=E=>s.value.problem=E),placeholder:"请输入原始题号"},null,8,["modelValue"])]),_:1}),t(H,null,{default:l(()=>[t(X,{theme:"primary",type:"submit",loading:g.value},{default:l(()=>S[9]||(S[9]=[I("前往")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),t(R,{class:"sh-card sh-background-black"},{default:l(()=>[(L(!0),ee(oe,null,Ce(_.value,E=>(L(),K(X,{class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:()=>x(E)},{default:l(()=>[I(F(E.name),1)]),_:2},1032,["onClick"]))),256)),b.value?(L(),K(X,{key:0,class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:S[6]||(S[6]=()=>U.$router.push("/problem/tags"))},{default:l(()=>S[10]||(S[10]=[I(" ... ")])),_:1})):ne("",!0)]),_:1})])]),_:1})]),_:1})}}}),Yn=re(Xn,[["__scopeId","data-v-bc7185f5"]]);function Qe(e){e.querySelectorAll("pre > code:not([data-copy-attached])").forEach(n=>{n.setAttribute("data-copy-attached","true");const r=n.parentElement,o=document.createElement("div");o.className="copy-wrapper";const f=document.createElement("button");f.className="copy-btn",f.innerText="复制",f.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(n.innerText),f.innerText="已复制",setTimeout(()=>f.innerText="复制",1500)}catch{f.innerText="失败"}}),r.replaceWith(o),o.appendChild(f),o.appendChild(r)})}function lt(e){let a="";for(;e>0;)e--,a=String.fromCharCode(65+e%26)+a,e=Math.floor(e/26);return a}async function Ft(e){const a={};a.id=e.id,a.ownerId=e.owner_id,a.ownerUsername=e.owner_username,a.ownerNickname=e.owner_nickname,a.title=e.title,a.startTime=new Date(e.start_time).toLocaleString(),a.endTime=new Date(e.end_time).toLocaleString(),a.createTime=new Date(e.create_time).toLocaleString(),a.updateTime=new Date(e.update_time).toLocaleString(),a.private=e.private;const n={math:{inlineDigit:!0,engine:"KaTeX"}};if(a.description=await me.md2html(e.description,n),a.notification=e.notification,e.problems){a.problems=[],e.problems.sort((r,o)=>r.index-o.index);for(let r=0;r<e.problems.length;r++){const o=e.problems[r];let f={accept:0,attempt:0,author:"",id:"",private:!1,tags:[],title:""};f.index=o.index,f.id=lt(o.index),f.title=o.title,o.accept?f.accept=o.accept:f.accept=0,o.attempt?f.attempt=o.attempt:f.attempt=0,a.problems.push(f)}}return a}function Zn(e){return W({url:"/contest?id="+e,method:"get"})}function Qn(e){return W({url:"/contest/edit?id="+e,method:"get"})}function eo(e){return W({url:"/contest/problem/list?id="+e,method:"get"})}function to(e,a){return W({url:"/contest/problem?id="+e+"&problem_index="+a,method:"get"})}function ao(e,a){return W({url:"/contest/list?page="+e+"&page_size="+a,method:"get"})}function lo(e){return W({url:"/contest/rank?id="+e,method:"get"})}function no(e){return W({url:"/contest/create",method:"post",data:e})}function oo(e){return W({url:"/contest/edit",method:"post",data:e})}function so(e,a){return W({url:"/contest/password",method:"post",data:{id:e,password:a}})}function ro(e){return W({url:"/contest/dolos",method:"post",data:{id:e}})}const Nt=async(e,a)=>{a&&await e.push({name:"user",params:{username:a}})},Jt=e=>{const a=Z.resolve({name:"problem-detail",params:{problemId:e}});window.open(a.href,"_blank")},$t=async(e,a)=>{await Z.push({name:"contest-problem-detail",params:{contestId:e,problemIndex:a}})};function Da(e,a){return fetch(e,{method:"PUT",headers:{"Content-Type":a.type},body:a})}async function io(e,a,n,r){var f;if(!e)return G(n,"编辑器已失效，请刷新后重试"),null;const o=ve(n,"图片正在上传，请稍候...",0);console.log("正在上传图片",a),e.disabled();try{for(const b of a){console.log(b);const C=`[正在上传 ⏳ ${((f=crypto.randomUUID)==null?void 0:f.call(crypto))||Math.random().toString(36).substring(2)}]`;let g=C.replace("⏳",'<span class="sh-anim-loop" style="display: inline-block; font-size: 16px;">⏳</span>');e.insertValue(`
${g}
`,!1);const i=await r();if(i.code!==0){G(n,i.code);let P=e.getValue();P=P.replace(C,"图片上传失败"),e.setValue(P);continue}const d=i.data.upload_url;await Da(d,b);const u="![图片]("+i.data.preview_url+")";let v=e.getValue();v=v.replace(C,u),e.setValue(v)}}finally{e.enable(),ya(n,o)}return null}function Wt(e){const a={math:{inlineDigit:!0,engine:"KaTeX"}};return me.md2html(e,a)}const uo=["innerHTML"],co=["innerHTML"],mo={key:1},po=["innerHTML"],fo=["innerHTML"],vo={key:1},_o={key:0,class:"dida-problems-container"},go={style:{margin:"12px"}},bo={key:1},ho={class:"dida-operation-container"},yo={key:0,class:"dida-operation-container"},wo={class:"dida-code-submit-div"},ko={class:"dida-code-editor-div"},Co=se({__name:"ProblemDetail",setup(e){let a=we();const{globalProperties:n}=ce();let r=null;const o=Je(),f=je();let b=m(""),w="",C="",g=0,i=m(0);const d=m(!1),u=m(!1),v=m(null),P=m(null),p=m(null),k=m(!1),_=m(null);let h=null;const c=m(null),s=m(!1),T=m(!1),y={},D=m(""),z=m([]);z.value=Et();const x=m([]),V=m(-1),$=m(-1),A=m(""),U=m(""),S=He(()=>f.hasAuth(Ke.ManageProblem)),j=q=>{q&&Z.push({name:"problem-list",query:{...a.query,title:"",tag:q.name}})},R=async()=>{let q=w;if(!q)try{const E=await to(g,i.value);E.code===0?q=E.data:G(n,E.code)}catch{fe(n,"获取题目ID失败，请稍后再试");return}await Z.push({name:"manage-problem",params:{problemId:q}})},O=()=>{w?Z.push({name:"judge-list",query:{problem_id:w}}):Z.push({name:"contest-judge",params:{contestId:g},query:{problem_id:lt(i.value)}})},X=()=>{w?Z.push({name:"discuss-list-problem",query:{problem_id:w}}):Z.push({name:"contest-discuss",params:{contestId:g},query:{problem_id:lt(i.value)}})},te=()=>{Z.push({name:"problem-recommend",params:{problemId:w}})},J=async()=>{var ae,Y;const q=(ae=_.value)==null?void 0:ae.originOj,E=(Y=_.value)==null?void 0:Y.originId;if(!(!q||!E))try{s.value=!0;const ie=await Ta(q,E);ie.code===0?(await ye(),ve(n,"更新成功")):G(n,ie.code)}catch{fe(n,"更新失败，请稍后再试")}finally{s.value=!1}},H=async()=>{const q=parseInt(D.value);if(!yt(q)){fe(n,"请选择所编写的语言");return}const E=h==null?void 0:h.getValue();if(!E){fe(n,"请输入所需提交的代码");return}if(!w&&(!g||!i.value)){fe(n,"问题ID无效");return}T.value=!0;try{const ae=await Gl(w,g,i.value,q,E);if(ae.code!==0){G(n,ae.code);return}ve(n,"提交成功，正在跳转到详情页面");const Y=ae.data.id;g?await Z.push({name:"contest-judge-detail",params:{contestId:g,judgeId:Y}}):await Z.push({name:"judge-detail",params:{judgeId:Y}})}finally{T.value=!1}},N=q=>{if(!h)return;const E=h.getModel();E&&Bt.setModelLanguage(E,qt(q))},ye=async()=>{x.value=[];let q=await Ia(w,g,i.value);if(q.code!==0){k.value=!1,G(n,q.code),await Z.push({name:"problem"});return}q.data.tags&&q.data.tags.forEach(Y=>{y[Y.id]=Y}),_.value=pt(q.data.problem,y),o.setTitle(_.value.title+" - "+o.getTitle);let E=_.value.description;g&&(q=await eo(g),q.code===0?(q.data.problems.sort((Y,ie)=>Y-ie),x.value=q.data.problems):G(n,q.code));const ae={math:{inlineDigit:!0,engine:"KaTeX"}};b.value=await me.md2html(E,ae),await Ne(()=>{v.value&&(me.mathRender(v.value),me.highlightRender({lineNumber:!0,enable:!0},v.value),Qe(v.value),!h&&c.value&&(h=Bt.create(c.value,{value:"",language:"cpp",minimap:{enabled:!0},colorDecorators:!0,readOnly:!1,theme:"vs-dark"}))),k.value=!1})},Pe=async()=>{u.value=!1;const q=await nn(C);if(q.code!==0)return;u.value=!0,w=q.data.problem_id,A.value=await Wt(q.data.solution),U.value=await Wt(q.data.code),await Ne(()=>{P.value&&(me.mathRender(P.value),me.highlightRender({lineNumber:!0,enable:!0},P.value),Qe(P.value)),p.value&&(me.mathRender(p.value),me.highlightRender({lineNumber:!0,enable:!0},p.value),Qe(p.value))});const E=new Date().toISOString().split("T")[0];C===E||(V.value=-1,$.value=-1)};return ue(async()=>{r=ze(()=>a.params,async()=>{if(u.value=!1,Array.isArray(a.params.problemId)?w=a.params.problemId[0]:w=a.params.problemId,w||(Array.isArray(a.params.dailyId)?C=a.params.dailyId[0]:C=a.params.dailyId,await Pe()),!w){if(Array.isArray(a.params.contestId)?g=Number(a.params.contestId[0]):g=Number(a.params.contestId),!g){fe(n,"题目不存在"),C?await Z.push({name:"problem-daily-list"}):await Z.push({name:"problem"});return}if(Array.isArray(a.params.problemIndex)?i.value=parseInt(a.params.problemIndex[0]):i.value=parseInt(a.params.problemIndex),!i.value){fe(n,"题目不存在"),await Z.push({name:"problem"});return}}d.value=!!g,k.value=!0,await ye()},{immediate:!0}),c.value&&new ResizeObserver(()=>{h&&h.layout()}).observe(c.value)}),Ve(()=>{r&&(r(),r=null)}),(q,E)=>{const ae=_e,Y=At,ie=Te,pe=B,Ie=he,ge=Ze,Q=ot,be=Ye,Me=Rt,We=ut,Ee=Se,Oe=xe;return L(),K(Oe,{loading:k.value},{default:l(()=>[t(Ee,{class:"dida-main-content"},{default:l(()=>[t(ie,{span:8},{default:l(()=>[t(ae,{style:{margin:"10px"}},{default:l(()=>[M("div",{innerHTML:de(b),ref_key:"descriptionMarkdownRef",ref:v},null,8,uo)]),_:1}),u.value?(L(),K(ae,{key:0,style:{margin:"10px"},title:"题解"},{default:l(()=>[V.value<0?(L(),ee("div",{key:0,ref_key:"dailyCodeMarkdownRef",ref:p,innerHTML:U.value},null,8,co)):(L(),ee("div",mo,[E[1]||(E[1]=I(" 距离解锁百分比 ")),t(Y,{theme:"line",color:{from:"#0052D9",to:"#00A870"},percentage:60,status:"active"}),M("div",{ref_key:"dailySolutionMarkdownRef",ref:P,innerHTML:A.value},null,8,po)]))]),_:1})):ne("",!0),u.value?(L(),K(ae,{key:1,style:{margin:"10px"},title:"示例代码"},{default:l(()=>[$.value<0?(L(),ee("div",{key:0,ref_key:"dailyCodeMarkdownRef",ref:p,innerHTML:U.value},null,8,fo)):(L(),ee("div",vo,[E[2]||(E[2]=I(" 距离解锁百分比 ")),t(Y,{theme:"line",color:{from:"#0052D9",to:"#00A870"},percentage:60,status:"active"})]))]),_:1})):ne("",!0)]),_:1}),t(ie,{span:4},{default:l(()=>{var Xe;return[de(g)?(L(),ee("div",_o,[t(Ie,{style:{"flex-wrap":"wrap"}},{default:l(()=>[(L(!0),ee(oe,null,Ce(x.value,(ke,le)=>(L(),K(pe,{key:le,theme:ke==de(i)?"primary":"default",onClick:async()=>await de($t)(de(g),ke)},{default:l(()=>[I(F(de(lt)(ke)),1)]),_:2},1032,["theme","onClick"]))),128))]),_:1})])):ne("",!0),M("div",go,[t(be,{layout:"vertical",bordered:!0},{default:l(()=>{var ke;return[t(ge,{label:"ID"},{default:l(()=>{var le;return[I(F((le=_.value)==null?void 0:le.id),1)]}),_:1}),t(ge,{label:"标题"},{default:l(()=>{var le;return[I(F((le=_.value)==null?void 0:le.title),1)]}),_:1}),t(ge,{label:"时间限制"},{default:l(()=>{var le;return[I(F((le=_.value)==null?void 0:le.timeLimit),1)]}),_:1}),t(ge,{label:"内存限制"},{default:l(()=>{var le;return[I(F((le=_.value)==null?void 0:le.memoryLimit),1)]}),_:1}),t(ge,{label:"判题方式"},{default:l(()=>{var le;return[I(F((le=_.value)==null?void 0:le.judgeType),1)]}),_:1}),d.value?ne("",!0):(L(),K(ge,{key:0,label:"正确提交"},{default:l(()=>{var le;return[I(F((le=_.value)==null?void 0:le.accept),1)]}),_:1})),d.value?ne("",!0):(L(),K(ge,{key:1,label:"提交总数"},{default:l(()=>{var le;return[I(F((le=_.value)==null?void 0:le.attempt),1)]}),_:1})),t(ge,{label:"创建时间"},{default:l(()=>{var le;return[I(F((le=_.value)==null?void 0:le.insertTime),1)]}),_:1}),t(ge,{label:"更新时间"},{default:l(()=>{var le;return[I(F((le=_.value)==null?void 0:le.updateTime),1)]}),_:1}),t(ge,{label:"上传用户"},{default:l(()=>{var le;return[I(F((le=_.value)==null?void 0:le.creatorNickname),1)]}),_:1}),d.value?ne("",!0):(L(),K(ge,{key:2,label:"题目来源"},{default:l(()=>{var le,Ge,ct;return[(le=_.value)!=null&&le.sourceUrl?(L(),K(Q,{key:0,href:(Ge=_.value)==null?void 0:Ge.sourceUrl,target:"_blank"},{default:l(()=>{var Gt;return[I(F((Gt=_.value)==null?void 0:Gt.source),1)]}),_:1},8,["href"])):(L(),ee("span",bo,F((ct=_.value)==null?void 0:ct.source),1))]}),_:1})),S.value?(L(),K(ge,{key:3,label:"是否私有"},{default:l(()=>{var le;return[I(F((le=_.value)!=null&&le.private?"私有":"公开"),1)]}),_:1})):ne("",!0),(ke=_.value)!=null&&ke.originUrl?(L(),K(ge,{key:4,label:"原题链接"},{default:l(()=>{var le;return[t(Q,{href:(le=_.value)==null?void 0:le.originUrl,target:"_blank"},{default:l(()=>{var Ge,ct;return[I(F((Ge=_.value)==null?void 0:Ge.originOj)+" - "+F((ct=_.value)==null?void 0:ct.originId),1)]}),_:1},8,["href"])]}),_:1})):ne("",!0),de(w)?(L(),K(ge,{key:5,label:"标签"},{default:l(()=>[t(Ie,null,{default:l(()=>{var le;return[(L(!0),ee(oe,null,Ce((le=_.value)==null?void 0:le.tags,Ge=>(L(),K(pe,{key:Ge.id,variant:"dashed",onClick:()=>j(Ge)},{default:l(()=>[I(F(Ge.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})):ne("",!0)]}),_:1}),M("div",ho,[t(Ie,null,{default:l(()=>[t(pe,{onClick:O},{default:l(()=>E[3]||(E[3]=[I("提交记录")])),_:1}),t(pe,{onClick:X},{default:l(()=>E[4]||(E[4]=[I("题目讨论")])),_:1}),de(w)?(L(),K(pe,{key:0,onClick:te},{default:l(()=>E[5]||(E[5]=[I("题目推荐")])),_:1})):ne("",!0)]),_:1})]),S.value||(Xe=_.value)!=null&&Xe.originId?(L(),ee("div",yo,[t(Ie,null,{default:l(()=>{var ke;return[S.value?(L(),K(pe,{key:0,onClick:R},{default:l(()=>E[6]||(E[6]=[I("编辑")])),_:1})):ne("",!0),(ke=_.value)!=null&&ke.originId?(L(),K(pe,{key:1,onClick:J,loading:s.value},{default:l(()=>E[7]||(E[7]=[I("更新描述 ")])),_:1},8,["loading"])):ne("",!0)]}),_:1})])):ne("",!0),M("div",wo,[t(Ie,null,{default:l(()=>[t(We,{modelValue:D.value,"onUpdate:modelValue":E[0]||(E[0]=ke=>D.value=ke),label:"语言：",placeholder:"请选择提交语言","auto-width":"",clearable:"",onChange:N},{default:l(()=>[(L(!0),ee(oe,null,Ce(z.value,ke=>(L(),K(Me,{key:ke.value,value:ke.value,label:ke.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),t(pe,{onClick:H,loading:T.value},{default:l(()=>E[8]||(E[8]=[I("提交")])),_:1},8,["loading"])]),_:1}),M("div",ko,[M("div",{ref_key:"codeEditRef",ref:c,class:"dida-code-editor"},null,512)])])])]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),Tt=re(Co,[["__scopeId","data-v-0a1cf561"]]),So={style:{margin:"10px"}},Io={key:0,class:"dida-operation-container"};function Po(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const To=se({__name:"ProblemDailyList",setup(e){const a=we(),n=Be(),{globalProperties:r}=ce(),o=je();let f=null,b={},w={};m(!1);const C=He(()=>o.hasAuth(Ke.ManageProblem)),g=m([{title:"日期",colKey:"id",cell:(z,x)=>(h(x.row.problemId),t(B,{variant:"dashed",onClick:()=>_(x.row.id)},{default:()=>[x.row.id]}))},{title:"ID",colKey:"problemId",cell:(z,x)=>{let V=h(x.row.problemId);return t(B,{variant:"dashed",theme:V,onClick:()=>_(x.row.id)},{default:()=>[x.row.problemId]})}},{title:"标题",colKey:"title",cell:(z,x)=>t(B,{variant:"text",onClick:()=>_(x.row.id)},{default:()=>[x.row.title]})},{title:"标签",colKey:"tags",cell:(z,x)=>{const V=x.row.tags;if(!V||V.length===0)return"";let $=[];for(let A=0;A<V.length;A++){const U=V[A];$.push(t(B,{key:A,theme:"default",variant:"outline",size:"small",onClick:()=>s(U)},{default:()=>[U.name]}))}return t(he,null,Po($)?$:{default:()=>[$]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),i=m(!1);let d=1,u=50;const v=m({current:d,pageSize:u,defaultCurrent:d,defaultPageSize:u,total:0,pageSizeOptions:[50,100]}),P=m(),p=[{label:"DidaOJ",value:"didaoj"},{label:"HDU",value:"hdu"},{label:"POJ",value:"poj"},{label:"NYOJ",value:"nyoj"}],k=m({oj:"",title:"",tag:"",private:!1});m({oj:"",problem:""});const _=z=>{z&&n.push({name:"problem-daily-detail",params:{dailyId:z}})},h=z=>{if(!z||!w)return"default";const x=w[z];if(!x)return"default";switch(x){case Fe.Accept:return"success";case Fe.Attempt:return"warning";default:return"default"}},c=async()=>{await n.push({query:{...a.query,oj:k.value.oj,title:k.value.title,tag:k.value.tag,private:k.value.private?"1":"0",page:1,page_size:v.value.defaultPageSize}})},s=z=>{z&&n.push({name:"problem-list",query:{...a.query,title:"",tag:z.name,page:1,page_size:v.value.defaultPageSize}})},T=()=>{n.push({name:"manage-problem-create"})},y=async(z,x)=>{i.value=!0;try{const{current:V,pageSize:$}=z,A=await sn(null,null,V,$);if(P.value=[],A.code===0){const U=A.data.list;if(!U||U.length<=0){v.value={...v.value,total:0},w={},ve(r,"未找到记录");return}b={},A.data.tags&&A.data.tags.forEach(S=>{b[S.id]=S}),U.forEach(S=>{var R;const j=en(S,b);(R=P.value)==null||R.push(j)}),v.value={...v.value,total:A.data.total_count},w=A.data.attempt_status}else x&&G(r,A.code)}catch(V){console.error(V),G(r,Ae())}finally{i.value=!1}},D=async z=>{await n.push({query:{...a.query,page:z.current,page_size:z.pageSize}})};return ue(async()=>{i.value=!0,f=ze(()=>a.query,z=>{k.value.oj=z.oj||"",k.value.title=z.title||"",k.value.tag=z.tag||"",k.value.private=z.private==="1";const x=parseInt(z.page)||v.value.defaultCurrent,V=parseInt(z.page_size)||v.value.defaultPageSize;d=x,u=V,v.value={...v.value,current:d,pageSize:u},y({current:d,pageSize:u},!0)},{immediate:!0})}),Ve(()=>{f&&f()}),(z,x)=>{const V=De,$=_e,A=Te,U=B,S=he,j=ut,R=Ue,O=$e,X=Se;return L(),K(X,null,{default:l(()=>[t(A,{span:9},{default:l(()=>[t($,{style:{margin:"10px"}},{default:l(()=>[t(V,{data:P.value,columns:g.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:v.value,"table-layout":"auto",loading:i.value,onPageChange:D},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(A,{span:3},{default:l(()=>[M("div",So,[C.value?(L(),ee("div",Io,[t(S,null,{default:l(()=>[t(U,{onClick:T},{default:l(()=>x[1]||(x[1]=[I("新建")])),_:1})]),_:1})])):ne("",!0),t($,{class:"sh-card"},{default:l(()=>[t(O,{model:k.value,onSubmit:c},{default:l(()=>[t(R,{label:"时间"},{default:l(()=>[t(j,{modelValue:k.value.oj,"onUpdate:modelValue":x[0]||(x[0]=te=>k.value.oj=te),options:p,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(R,null,{default:l(()=>[t(U,{theme:"primary",type:"submit"},{default:l(()=>x[2]||(x[2]=[I("搜索")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t($,{class:"sh-card",header:"每日一题","header-bordered":!0},{default:l(()=>x[3]||(x[3]=[M("p",null,"由管理员团队精选的题目，每日0点更新。",-1),M("p",null,"当日下午6点提供题解，次日提供AC代码。",-1)])),_:1})])]),_:1})]),_:1})}}}),xo=re(To,[["__scopeId","data-v-28eedd2f"]]),Vo={style:{margin:"10px"}};function Do(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const Lo=se({__name:"ProblemRecommend",setup(e){const a=we(),n=Be(),{globalProperties:r}=ce();let o=null,f="",b={},w={};const C=m([{title:"ID",colKey:"id",cell:(p,k)=>{let _=u(k.row.id);return t(B,{variant:"dashed",theme:_,onClick:()=>d(k.row.id)},{default:()=>[k.row.id]})}},{title:"标题",colKey:"title",cell:(p,k)=>t(B,{variant:"text",onClick:()=>d(k.row.id)},{default:()=>[k.row.title]})},{title:"标签",colKey:"tags",cell:(p,k)=>{const _=k.row.tags;if(!_||_.length===0)return"";let h=[];for(let c=0;c<_.length;c++){const s=_[c];h.push(t(B,{key:c,theme:"default",variant:"outline",size:"small",onClick:()=>v(s)},{default:()=>[s.name]}))}return t(he,null,Do(h)?h:{default:()=>[h]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),g=m(!1),i=m(),d=p=>{p&&n.push({path:"/problem/"+p})},u=p=>{if(!p||!w)return"default";const k=w[p];if(!k)return"default";switch(k){case Fe.Accept:return"success";case Fe.Attempt:return"warning";default:return"default"}},v=p=>{p&&n.push({name:"problem-list",query:{tag:p.name}})},P=async p=>{g.value=!0;try{const k=await ln(f);if(i.value=[],k.code===0){const _=k.data.list;if(!_||_.length<=0){ve(r,"暂无推荐题目");return}b={},k.data.tags&&k.data.tags.forEach(h=>{b[h.id]=h}),_.forEach(h=>{var s;const c=pt(h,b);(s=i.value)==null||s.push(c)})}else p&&G(r,k.code)}catch(k){console.error(k),G(r,Ae())}finally{g.value=!1}};return ue(async()=>{g.value=!0,o=ze(()=>a.query,p=>{Array.isArray(a.params.problemId)?f=a.params.problemId[0]:f=a.params.problemId,P(!0)},{immediate:!0})}),Ve(()=>{o&&o()}),(p,k)=>{const _=De,h=_e,c=Te,s=Se;return L(),K(s,null,{default:l(()=>[t(c,{span:9},{default:l(()=>[t(h,{style:{margin:"10px"}},{default:l(()=>[t(_,{data:i.value,columns:C.value,"row-key":"id","vertical-align":"top",hover:!0,"table-layout":"auto",loading:g.value},null,8,["data","columns","loading"])]),_:1})]),_:1}),t(c,{span:3},{default:l(()=>[M("div",Vo,[t(h,{class:"sh-card",header:"题目推荐","header-bordered":!0},{default:l(()=>k[0]||(k[0]=[I(" 根据本站其他用户的提交记录推荐类似题目"),M("br",null,null,-1),I("依据推荐算法来计算，与本用户相似度最高的用户做的题，大概率被自己感兴趣。 ")])),_:1})])]),_:1})]),_:1})}}}),jo=re(Lo,[["__scopeId","data-v-77972e8b"]]),zo={style:{margin:"10px"}},$o={key:1},Uo={style:{margin:"12px"}},Ao={class:"dida-edit-container"},Ro=se({__name:"ProblemEdit",setup(e){let a=we();const{globalProperties:n}=ce(),r=Je(),o=m(""),f=m(!1);let b=null;const w=m(!1),C=m(null),g=m({title:"",timeLimit:0,memoryLimit:0,source:"",private:!0,tags:[]}),i=m([]),d=m([]),u=He(()=>{const T=[],y=i.value;for(let D=0,z=y.length;D<z;D++)y[D].value&&T.push(y[D].value);return T}),v=(T,y)=>{const{trigger:D,index:z,item:x}=y;if(D==="clear"&&(i.value=[]),["tag-remove","backspace"].includes(D)&&i.value.splice(z,1),D==="enter"){for(let $=0;$<d.value.length;$++){const A=d.value[$];if(A.label===x){for(let U=0;U<i.value.length;U++)if(i.value[U].label===A.label)return;i.value.push(A);return}}const V={label:x,value:x};i.value.push(V),d.value=d.value.concat(V)}},P=(T,{current:y,type:D})=>{if(!y){i.value=D==="check"?d.value.slice(1):[];return}if(D==="check"){const z=d.value.find(x=>x.value===y);if(!z)return;i.value.push(z)}else i.value=i.value.filter(z=>z.value!==y)},p=()=>{Z.push({name:"problem-detail",params:{problemId:o.value}})},k=()=>{Z.push({name:"manage-problem-judge",params:{problemId:o.value}})},_=async()=>{if(b){w.value=!0,g.value.tags=[];for(let T=0;T<i.value.length;T++){const y=i.value[T];y&&y.label&&g.value.tags.push(y.label)}try{const T=await rn(g.value.title,g.value.timeLimit,g.value.memoryLimit,g.value.source,g.value.private,g.value.tags,b.getValue());if(w.value=!0,T.code!==0){G(n,T.code);return}T.data!=null&&await Z.push({name:"problem-detail",params:{problemId:T.data}}),et(n,"创建成功")}finally{w.value=!1}}},h=async()=>{if(b){w.value=!0,g.value.tags=[];for(let T=0;T<i.value.length;T++){const y=i.value[T];y&&y.label&&g.value.tags.push(y.label)}try{const T=await un(o.value,g.value.title,g.value.timeLimit,g.value.memoryLimit,g.value.source,g.value.private,g.value.tags,b.getValue());if(w.value=!0,T.code!==0){G(n,T.code);return}T.data.update_time!=null&&(C.value.updateTime=new Date(T.data.update_time).toLocaleString()),T.data.description!=null&&(b==null||b.setValue(T.data.description)),et(n,"保存成功")}finally{w.value=!1}}},c=T=>{const y={after:()=>{b==null||b.setValue(T),f.value=!1},upload:{accept:"image/*,.mp3, .wav, .rar",token:"test",url:"/api/upload/editor",linkToImgUrl:"/api/upload/fetch",filename(D){return D.replace(/[^(a-zA-Z0-9\u4e00-\u9fa5\.)]/g,"").replace(/[\?\\/:|<>\*\[\]\(\)\$%\{\}@~]/g,"").replace("/\\s/g","")},async handler(D){var x;if(!b)return G(n,"编辑器已失效，请刷新后重试"),null;const z=ve(n,"图片正在上传，请稍候...",0);console.log("正在上传图片",D),b.disabled();for(const V of D){console.log(V);const A=`[正在上传 ⏳ ${((x=crypto.randomUUID)==null?void 0:x.call(crypto))||Math.random().toString(36).substring(2)}]`;let U=A.replace("⏳",'<span class="sh-anim-loop" style="display: inline-block; font-size: 16px;">⏳</span>');b.insertValue(`
${U}
`,!1);const S=await dn(o.value);if(S.code!==0){G(n,S.code);let X=b.getValue();X=X.replace(A,"图片上传失败"),b.setValue(X);continue}const j=S.data.upload_url;await Da(j,V);const R="![图片]("+S.data.preview_url+")";let O=b.getValue();O=O.replace(A,R),b.setValue(O)}return b.enable(),ya(n,z),null}},preview:{math:{inlineDigit:!0,engine:"KaTeX"}}};b=new me("problemEditDiv",y)},s=async()=>{const T=await Ia(o.value,void 0,void 0);if(T.code!==0){G(n,T.code),console.error("problem get failed",T.code),await Z.push({name:"problem"});return}const y=T.data.problem;if(C.value=pt(y,{}),g.value.title=y.title,g.value.timeLimit=y.time_limit,g.value.memoryLimit=y.memory_limit,g.value.source=y.source,g.value.private=y.private,g.value.tags=[],i.value=[],T.data.tags)for(let z=0;z<T.data.tags.length;z++){const x=T.data.tags[z];x&&x.name&&(g.value.tags.push(x.name),i.value.push({label:x.name,value:x.id}))}r.setTitle(y.title+" - "+r.getTitle);let D=y.description;c(D)};return ue(async()=>{Array.isArray(a.params.problemId)?o.value=a.params.problemId[0]:o.value=a.params.problemId,o.value?(f.value=!0,Pa(-1).then(async T=>{T.code===0?(T.data.list&&T.data.list.forEach(y=>{d.value.push({label:y.name,value:y.id})}),await s()):(G(n,T.code),console.error("problem tag get failed",T.code),await Z.push({name:"problem"}))}).catch(async T=>{console.error(T),G(n,"获取数据异常"),await Z.push({name:"problem"})})):(g.value.timeLimit=1e3,g.value.memoryLimit=65536,c(""))}),(T,y)=>{const D=Re,z=Ue,x=ma,V=mt,$=dl,A=cl,U=$e,S=_e,j=Te,R=B,O=he,X=Ze,te=Ye,J=Se,H=xe;return L(),K(H,{loading:f.value},{default:l(()=>[t(J,null,{default:l(()=>[t(j,{span:8},{default:l(()=>[M("div",zo,[t(S,{class:"sh-card"},{default:l(()=>[t(U,{model:g.value},{default:l(()=>[t(z,{label:"标题"},{default:l(()=>[t(D,{modelValue:g.value.title,"onUpdate:modelValue":y[0]||(y[0]=N=>g.value.title=N),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),t(z,{label:"时间限制"},{default:l(()=>[t(x,{modelValue:g.value.timeLimit,"onUpdate:modelValue":y[1]||(y[1]=N=>g.value.timeLimit=N),theme:"normal",min:0},{suffix:l(()=>y[5]||(y[5]=[M("span",null,"ms",-1)])),_:1},8,["modelValue"])]),_:1}),t(z,{label:"内存限制"},{default:l(()=>[t(x,{modelValue:g.value.memoryLimit,"onUpdate:modelValue":y[2]||(y[2]=N=>g.value.memoryLimit=N),theme:"normal",min:0},{suffix:l(()=>y[6]||(y[6]=[M("span",null,"KB",-1)])),_:1},8,["modelValue"])]),_:1}),t(z,{label:"来源"},{default:l(()=>[t(D,{modelValue:g.value.source,"onUpdate:modelValue":y[3]||(y[3]=N=>g.value.source=N),placeholder:"请输入题目来源"},null,8,["modelValue"])]),_:1}),t(z,{label:"私有"},{default:l(()=>[t(V,{modelValue:g.value.private,"onUpdate:modelValue":y[4]||(y[4]=N=>g.value.private=N)},null,8,["modelValue"])]),_:1}),t(z,{label:"标签"},{default:l(()=>[t(A,{value:i.value,"allow-input":!0,placeholder:"请选择或输入","tag-input-props":{excessTagsDisplayType:"break-line"},"popup-props":{overlayInnerClassName:["narrow-scrollbar"],overlayInnerStyle:{maxHeight:"280px",overflowY:"auto",overscrollBehavior:"contain",padding:"6px"}},clearable:"",multiple:"",onTagChange:v},{panel:l(()=>[d.value.length?(L(),K($,{key:0,value:u.value,options:d.value,onChange:P},null,8,["value","options"])):(L(),ee("div",$o,"暂无数据"))]),suffixIcon:l(()=>[t(de(Ha))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(j,{span:4},{default:l(()=>[M("div",Uo,[M("div",Ao,[o.value?(L(),K(O,{key:0},{default:l(()=>[t(R,{onClick:h,theme:"danger",loading:w.value},{default:l(()=>y[7]||(y[7]=[I("保存")])),_:1},8,["loading"]),t(R,{onClick:k,theme:"warning"},{default:l(()=>y[8]||(y[8]=[I("判题数据")])),_:1}),t(R,{onClick:p},{default:l(()=>y[9]||(y[9]=[I("查看")])),_:1})]),_:1})):(L(),K(O,{key:1},{default:l(()=>[t(R,{onClick:_,theme:"danger",loading:w.value},{default:l(()=>y[10]||(y[10]=[I("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(L(),K(te,{key:0,layout:"vertical",bordered:!0},{default:l(()=>[t(X,{label:"创建时间"},{default:l(()=>{var N;return[I(F((N=C.value)==null?void 0:N.insertTime),1)]}),_:1}),t(X,{label:"更新时间"},{default:l(()=>{var N;return[I(F((N=C.value)==null?void 0:N.updateTime),1)]}),_:1}),t(X,{label:"判题方式"},{default:l(()=>{var N;return[I(F((N=C.value)==null?void 0:N.judgeType),1)]}),_:1}),t(X,{label:"上传用户"},{default:l(()=>{var N;return[I(F((N=C.value)==null?void 0:N.creatorNickname),1)]}),_:1})]),_:1})):ne("",!0)])]),_:1})]),_:1}),y[11]||(y[11]=M("div",{id:"problemEditDiv",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"])}}}),Xt=re(Ro,[["__scopeId","data-v-92753818"]]),Mo={style:{margin:"10px"}},Eo={style:{margin:"12px"}},qo={class:"dida-edit-container"},Ko=se({__name:"ProblemJudge",setup(e){let a=we();const{globalProperties:n}=ce(),r=Je(),o=m(""),f=m(!1),b=m(null);let w=null;const C=m(null),g=m(""),i=m(!1),d=m(!1),u=m([{title:"文件",colKey:"file"},{title:"大小",colKey:"size",width:150,cell:(V,$)=>$.row.size.toFixed(0)+" B"},{title:"最后修改时间",colKey:"lastModified",width:180,cell:(V,$)=>new Date($.row.lastModified).toLocaleString()},{title:"操作",colKey:"action",width:100,cell:(V,$)=>t(B,{onClick:()=>h($.row.file)},{default:()=>[I("下载")]})}]),v=m([]),P=He(()=>({border:"2px dashed #ccc",borderRadius:"6px",padding:"20px",textAlign:"center",cursor:"pointer",backgroundColor:i.value?"#f0f9ff":"#fff",transition:"background-color 0.2s ease"})),p=He(()=>g.value?`已选择：${g.value}`:i.value?"松开文件以上传":"拖拽判题数据压缩包到这里，或点击选择文件"),k=()=>{Z.push({name:"problem-detail",params:{problemId:o.value}})},_=()=>{Z.push({name:"manage-problem",params:{problemId:o.value}})},h=async V=>{const $=await cn(o.value,V);if($.code!==0){G(n,$.code);return}const A=document.createElement("a");A.href=$.data,A.target="_blank",A.click(),URL.revokeObjectURL(A.href)},c=async()=>{if(!w){fe(n,"请选择压缩包");return}d.value=!0,mn(o.value,w).then(async V=>{V.code==0?(C.value.value=null,w=null,g.value="",f.value=!0,et(n,"上传成功"),await x()):G(n,V.code)}).catch(V=>{console.log(V),n.$message.error({duration:3e3,content:"申请失败"})}).finally(()=>{d.value=!1})},s=()=>{var V;(V=C.value)==null||V.click()},T=V=>{const $=V.target.files[0];$&&(g.value=$.name,w=$)},y=V=>{i.value=!0},D=()=>{i.value=!1},z=V=>{V.preventDefault(),V.stopPropagation(),i.value=!1;const $=V.dataTransfer.files[0];if($){g.value=$.name;const A=new DataTransfer;A.items.add($),C.value.files=A.files,w=$}},x=async()=>{const V=await tn(o.value);if(V.code!==0){G(n,V.code),await Z.push({name:"problem"});return}const $=V.data.problem;b.value=pt($,{}),r.setTitle($.title+" - "+r.getTitle),v.value=[],V.data.judges?V.data.judges.forEach(A=>{v.value.push({file:A.key,size:A.size,lastModified:A.last_modified})}):fe(n,"评测数据不存在"),f.value=!1};return ue(async()=>{if(Array.isArray(a.params.problemId)?o.value=a.params.problemId[0]:o.value=a.params.problemId,!o.value){fe(n,"题目不存在"),await Z.push({name:"problem"});return}f.value=!0,await x()}),(V,$)=>{const A=De,U=Te,S=B,j=he,R=Ze,O=Ye,X=Se,te=xe;return L(),K(te,{loading:f.value},{default:l(()=>[t(X,null,{default:l(()=>[t(U,{span:7},{default:l(()=>[M("div",Mo,[M("div",{id:"drop-zone",style:ia(P.value),onClick:s,onDragenter:ht(y,["prevent"]),onDragover:$[0]||($[0]=ht(()=>{},["prevent"])),onDragleave:ht(D,["prevent"]),onDrop:z},[M("input",{ref_key:"fileInput",ref:C,type:"file",style:{display:"none"},onChange:T},null,544),I(" "+F(p.value),1)],36)]),t(A,{data:v.value,columns:u.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1}),t(U,{span:5},{default:l(()=>[M("div",Eo,[M("div",qo,[t(j,null,{default:l(()=>[t(S,{onClick:c,theme:"danger",loading:d.value},{default:l(()=>$[1]||($[1]=[I("上传")])),_:1},8,["loading"]),t(S,{onClick:_,theme:"warning"},{default:l(()=>$[2]||($[2]=[I("编辑")])),_:1}),t(S,{onClick:k},{default:l(()=>$[3]||($[3]=[I("查看")])),_:1})]),_:1})]),t(O,{layout:"vertical",bordered:!0},{default:l(()=>[t(R,{label:"标题"},{default:l(()=>{var J;return[I(F((J=b.value)==null?void 0:J.title),1)]}),_:1}),t(R,{label:"创建时间"},{default:l(()=>{var J;return[I(F((J=b.value)==null?void 0:J.insertTime),1)]}),_:1}),t(R,{label:"更新时间"},{default:l(()=>{var J;return[I(F((J=b.value)==null?void 0:J.updateTime),1)]}),_:1}),t(R,{label:"判题方式"},{default:l(()=>{var J;return[I(F((J=b.value)==null?void 0:J.judgeType),1)]}),_:1}),t(R,{label:"评测数据"},{default:l(()=>{var J;return[I(F((J=b.value)==null?void 0:J.judgeMd5),1)]}),_:1}),t(R,{label:"上传用户"},{default:l(()=>{var J;return[I(F((J=b.value)==null?void 0:J.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Fo=re(Ko,[["__scopeId","data-v-12b13fb1"]]);async function Ot(e){const a={};if(a.id=e.id,a.ownerId=e.owner_id,a.ownerUsername=e.owner_username,a.ownerNickname=e.owner_nickname,a.title=e.title,e.start_time?a.startTime=new Date(e.start_time).toLocaleString():a.startTime="无限制",e.end_time?a.endTime=new Date(e.end_time).toLocaleString():a.endTime="无限制",e.update_time?a.updateTime=new Date(e.update_time).toLocaleString():a.updateTime="",e.create_time?a.createTime=new Date(e.create_time).toLocaleString():a.createTime="",e.description){const n={math:{inlineDigit:!0,engine:"KaTeX"}};a.description=await me.md2html(e.description,n)}else a.description="";return a.problems=e.problems,a}function No(e){return W({url:"/collection?id="+e,method:"get"})}function Oo(e){return W({url:"/collection/edit?id="+e,method:"get"})}function Go(e,a){return W({url:"/collection/list?page="+e+"&page_size="+a,method:"get"})}function Ho(e){return W({url:"/collection/rank?id="+e,method:"get"})}function Bo(e){return W({url:"/collection/create",method:"post",data:e})}function Jo(e){return W({url:"/collection/edit",method:"post",data:e})}function Wo(e){return W({url:"/collection/join",method:"post",data:{id:e}})}function Xo(e){return W({url:"/collection/quit",method:"post",data:{id:e}})}const Yo={style:{margin:"10px"}},Zo=se({__name:"CollectionList",setup(e){const a=we(),n=Be(),{globalProperties:r}=ce();let o=null;m(!1),m(!1);const f=m([{title:"ID",colKey:"id",width:"100",cell:(_,h)=>t(B,{variant:"text",onClick:()=>u(h.row.id)},{default:()=>[h.row.id]})},{title:"标题",colKey:"title",cell:(_,h)=>t(B,{variant:"text",onClick:()=>u(h.row.id)},{default:()=>[h.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),b=m(!1);let w=1,C=50;const g=m({current:w,pageSize:C,defaultCurrent:w,defaultPageSize:C,total:0,pageSizeOptions:[50,100]}),i=m(),d=m({title:"",username:""});m({title:"",description:"",open_time:[]});const u=_=>{_&&n.push({path:"/collection/"+_})},v=async()=>{await n.push({query:{...a.query,title:d.value.title,username:d.value.username,page:1,page_size:g.value.defaultPageSize}})},P=async(_,h)=>{var c;b.value=!0;try{const{current:s,pageSize:T}=_,y=await Go(s,T);if(i.value=[],y.code===0){const D=y.data.list;for(let z=0;z<D.length;z++){const x=D[z],V=await Ot(x);(c=i.value)==null||c.push(V)}g.value={...g.value,total:y.data.total_count}}else h&&G(r,y.code)}catch(s){console.error(s),G(r,Ae())}finally{b.value=!1}},p=async _=>{await n.push({query:{...a.query,page:_.current,page_size:_.pageSize}})},k=async()=>{await n.push({name:"collection-create"})};return ue(async()=>{o=ze(()=>a.query,_=>{d.value.title=_.title||"",d.value.username=_.username||"";const h=parseInt(_.page)||g.value.defaultCurrent,c=parseInt(_.page_size)||g.value.defaultPageSize;w=h,C=c,g.value={...g.value,current:w,pageSize:C},P({current:w,pageSize:C},!0)},{immediate:!0})}),Ve(()=>{o&&o()}),(_,h)=>{const c=De,s=_e,T=Te,y=Re,D=Ue,z=B,x=$e,V=he,$=Se;return L(),K($,null,{default:l(()=>[t(T,{span:9},{default:l(()=>[t(s,{style:{margin:"10px"}},{default:l(()=>[t(c,{data:i.value,columns:f.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:g.value,loading:b.value,onPageChange:p},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(T,{span:3},{default:l(()=>[M("div",Yo,[t(s,{class:"sh-card"},{default:l(()=>[t(x,{model:d.value},{default:l(()=>[t(D,{label:"标题"},{default:l(()=>[t(y,{modelValue:d.value.title,"onUpdate:modelValue":h[0]||(h[0]=A=>d.value.title=A),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(D,{label:"负责人"},{default:l(()=>[t(y,{modelValue:d.value.username,"onUpdate:modelValue":h[1]||(h[1]=A=>d.value.username=A),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(D,null,{default:l(()=>[t(z,{theme:"primary",onClick:v},{default:l(()=>h[2]||(h[2]=[I("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(s,{class:"sh-card"},{default:l(()=>[t(V,null,{default:l(()=>[t(z,{onClick:k},{default:l(()=>h[3]||(h[3]=[I("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),Qo=re(Zo,[["__scopeId","data-v-36c7c0e5"]]),es={style:{margin:"20px"}},ts={class:"dida-operation-container"},as={style:{margin:"12px"}},ls=["innerHTML"],ns=se({__name:"CollectionDetail",setup(e){let a=we();const{globalProperties:n}=ce(),r=Je(),o=je();let f=0;const b=m(!1),w=m(null),C=m(!1),g=m(!1);let i={};const d=He(()=>o.hasAuth(Ke.ManageCollection)||w.value&&o.getUserId==w.value.ownerId),u=h=>{if(!h||!i)return"default";const c=i[h];if(!c)return"default";switch(c){case Fe.Accept:return"success";case Fe.Attempt:return"warning";default:return"default"}},v=m([{title:"问题ID",colKey:"id",cell:(h,c)=>{const s=u(c.row.id);return t(B,{variant:"dashed",theme:s,onClick:()=>Jt(c.row.id)},{default:()=>[c.row.id]})}},{title:"标题",colKey:"title",cell:(h,c)=>t(B,{variant:"text",onClick:()=>Jt(c.row.id)},{default:()=>[c.row.title]})},{title:"正确",colKey:"accept",cell:(h,c)=>c.row.accept?c.row.accept:0},{title:"提交",colKey:"attempt",cell:(h,c)=>c.row.attempt?c.row.attempt:0}]),P=m([]),p=async()=>{if(!o.isLogin()){await Z.push({name:"login"});return}g.value=!0;try{const h=await Wo(f);if(h.code!==0){G(n,h.code);return}C.value=!0,et(n,"加入成功")}finally{g.value=!1}},k=async()=>{if(!o.isLogin()){await Z.push({name:"login"});return}g.value=!0;try{const h=await Xo(f);if(h.code!==0){G(n,h.code);return}C.value=!1,et(n,"退出成功")}finally{g.value=!1}},_=()=>{w.value&&Z.push({name:"collection-edit",params:{collectionId:w.value.id}})};return ue(async()=>{if(Array.isArray(a.params.collectionId)?f=Number(a.params.collectionId[0]):f=Number(a.params.collectionId),!f){await Z.push({name:"problem-collection-list"});return}C.value=!1,b.value=!0;const h=await No(f);if(h.code!==0){b.value=!1,G(n,h.code),await Z.push({name:"problem-collection-list"});return}C.value=h.data.joined,i=h.data.attempt_status||{},w.value=await Ot(h.data.collection),P.value=[],h.data.collection.problems&&h.data.collection.problems.forEach(c=>{const s=h.data.problems.find(T=>T.id===c);P.value.push(s)}),r.setTitle(w.value.title+" - "+r.getTitle),await Ne(()=>{const c=document.querySelectorAll(".dida-content-description");c&&c.length>0&&c.forEach(s=>{me.mathRender(s),me.highlightRender({lineNumber:!0,enable:!0},s),Qe(s)}),b.value=!1})}),(h,c)=>{const s=fa,T=pa,y=De,D=_e,z=Te,x=B,V=he,$=Ze,A=Ye,U=Se,S=xe;return L(),K(S,{loading:b.value},{default:l(()=>[t(U,{class:"dida-main-content"},{default:l(()=>[t(z,{span:6},{default:l(()=>[M("div",es,[t(T,{"max-item-width":"300"},{default:l(()=>[t(s,{to:{name:"problem-collection-list"}},{default:l(()=>c[0]||(c[0]=[I("题目集合")])),_:1}),t(s,null,{default:l(()=>{var j;return[I(F((j=w.value)==null?void 0:j.title),1)]}),_:1})]),_:1})]),t(D,{style:{margin:"10px"}},{default:l(()=>[t(y,{data:P.value,columns:v.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),_:1})]),_:1}),t(z,{span:6},{default:l(()=>{var j;return[M("div",ts,[t(V,null,{default:l(()=>[C.value?(L(),K(x,{key:0,onClick:k,loading:g.value},{default:l(()=>c[1]||(c[1]=[I("退出")])),_:1},8,["loading"])):(L(),K(x,{key:1,onClick:p,loading:g.value},{default:l(()=>c[2]||(c[2]=[I("加入")])),_:1},8,["loading"])),d.value?(L(),K(x,{key:2,onClick:_},{default:l(()=>c[3]||(c[3]=[I("编辑")])),_:1})):ne("",!0)]),_:1})]),M("div",as,[t(A,{layout:"vertical",bordered:!0},{default:l(()=>[t($,{label:"创建者"},{default:l(()=>{var R;return[I(F((R=w.value)==null?void 0:R.ownerNickname),1)]}),_:1})]),_:1}),t(A,{layout:"vertical",bordered:!0},{default:l(()=>[t($,{label:"开始时间"},{default:l(()=>{var R;return[I(F((R=w.value)==null?void 0:R.startTime),1)]}),_:1})]),_:1}),t(A,{layout:"vertical",bordered:!0},{default:l(()=>[t($,{label:"结束时间"},{default:l(()=>{var R;return[I(F((R=w.value)==null?void 0:R.endTime),1)]}),_:1})]),_:1})]),(j=w.value)!=null&&j.description?(L(),K(D,{key:0,style:{margin:"10px"}},{default:l(()=>{var R;return[M("div",{innerHTML:(R=w.value)==null?void 0:R.description,class:"dida-content-description"},null,8,ls)]}),_:1})):ne("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),os=re(ns,[["__scopeId","data-v-3f4490c0"]]),ss=se({__name:"CollectionRank",setup(e){const a=we(),n=Be(),{globalProperties:r}=ce();let o=null,f=0,b=0;const w=m([{title:"Rank",colKey:"rank",align:"center"},{title:"序号",colKey:"index",align:"center"},{title:"Username",colKey:"username",cell:(u,v)=>t(B,{variant:"text",onClick:()=>n.push({name:"user",params:{username:v.row.username}})},{default:()=>[v.row.username]})},{title:"昵称",colKey:"nickname",cell:(u,v)=>t(B,{variant:"text",onClick:()=>n.push({name:"user",params:{username:v.row.username}})},{default:()=>[v.row.nickname]})},{title:"Count",colKey:"count",cell:(u,v)=>t(B,{variant:"text",onClick:()=>n.push({name:"judge-list",query:{username:v.row.username,status:qe.Accept}})},{default:()=>[`${v.row.accept} / ${b}`]})},{title:"Progress",colKey:"progress",cell:(u,v)=>{let P=100;return b>0&&(P=Number((v.row.accept/b*100).toFixed(2))),t(At,{percentage:P},null)}}]),C=m(!1),g=m([]),i=({col:u,rowIndex:v})=>{let P=1;for(let p=v+1;p<g.value.length&&g.value[p].rank===g.value[v].rank;p++)P++;if(u.colKey==="rank")return{rowspan:P}},d=async u=>{C.value=!0;try{const v=await Ho(f);if(g.value=[],v.code===0){b=v.data.problem;const P=v.data.ranks,p=[];if(P){for(let h=0;h<P.length;h++){const c=P[h];let s={userId:c.author_id,username:c.author_username,nickname:c.author_nickname};s.accept=c.accept,p.push(s)}p.sort((h,c)=>h.accept!==c.accept?c.accept-h.accept:h.userId-c.userId);let k=0,_=-1;for(let h=0;h<p.length;h++)p[h].accept!==_&&(k=h+1,_=p[h].accept),p[h].index=h+1,p[h].rank=k}g.value=p}else u&&G(r,v.code)}catch(v){console.error(v),G(r,Ae())}finally{C.value=!1}};return ue(async()=>{o=ze(()=>a.query,async()=>{if(Array.isArray(a.params.collectionId)?f=Number(a.params.collectionId[0]):f=Number(a.params.collectionId),!f){await n.push({name:"problem-collection-list"});return}await d(!0)},{immediate:!0})}),Ve(()=>{o&&o()}),(u,v)=>{const P=De,p=_e,k=Se;return L(),K(k,null,{default:l(()=>[t(p,{style:{margin:"10px"}},{default:l(()=>[M("div",null,[t(P,{data:g.value,columns:w.value,"row-key":"index","rowspan-and-colspan":i,"vertical-align":"middle",bordered:!0,hover:!0,loading:C.value},null,8,["data","columns","loading"])])]),_:1})]),_:1})}}});var Le=(e=>(e[e.Valid=0]="Valid",e[e.Duplicate=1]="Duplicate",e[e.Invalid=2]="Invalid",e))(Le||{});const rs={class:"dida-form-border"},is={style:{"text-align":"right"}},us=se({name:"ParseProblemList",__name:"ParseProblemList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:a}=ce(),n=m(!1),r=m(!1),o=m(""),f=ua(e,"modelValue");let b=[];ze(f,async u=>{JSON.stringify(u)!==JSON.stringify(b)&&(await g(u),b=f.value)},{deep:!0});const w=m([]),C=m([{title:"有效性",colKey:"validType",cell:(u,v)=>{switch(v.row.valid){case Le.Valid:return t(at,{theme:"success"},{default:()=>[I("有效")]});case Le.Duplicate:return t(at,{theme:"warning"},{default:()=>[I("重复")]});case Le.Invalid:return t(at,{theme:"danger"},{default:()=>[I("无效")]});default:return null}}},{title:"问题ID",colKey:"id"},{title:"标题",colKey:"title"}]),g=async u=>{const v=Array.from(new Set(u)),P=await pn(v);if(P.code!==0){G(a,P.code),r.value=!1;return}const p=[],k=P.data.problems;let _=[];u.forEach(h=>{const c=k.find(s=>s.id===h);if(c){const s=p.find(T=>T.id===h);c.valid=s?Le.Duplicate:Le.Valid,p.push({id:h,title:c.title,valid:c.valid}),s||_.push(h)}else p.push({id:h,title:"-",valid:Le.Invalid})}),w.value=p,b=_,f.value=_},i=async()=>{r.value=!0;const u=wa(o.value);await g(u),n.value=!1,r.value=!1},d=()=>{w.value?o.value=w.value.map(u=>u.id).join(`
`):o.value="",n.value=!0};return(u,v)=>{const P=B,p=De,k=St,_=nt;return L(),ee(oe,null,[M("div",rs,[M("div",is,[t(P,{onClick:d},{default:l(()=>v[2]||(v[2]=[I("编辑")])),_:1})]),t(p,{data:w.value,columns:C.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(_,{visible:n.value,"onUpdate:visible":v[1]||(v[1]=h=>n.value=h),onConfirm:i,header:"请输入问题ID","confirm-loading":r.value},{default:l(()=>[v[3]||(v[3]=M("div",{style:{"margin-bottom":"10px"}},[M("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(k,{modelValue:o.value,"onUpdate:modelValue":v[0]||(v[0]=h=>o.value=h),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),La=re(us,[["__scopeId","data-v-7f4ce589"]]),cs={class:"dida-form-border"},ds={style:{"text-align":"right"}},ms=se({name:"ParseUserList",__name:"ParseUserList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:a}=ce(),n=m(!1),r=m(!1),o=m(""),f=ua(e,"modelValue");let b=[];ze(f,async P=>{JSON.stringify(P)!==JSON.stringify(b)&&(b=P,await i(P))},{deep:!0});const w=m(),C=m([{title:"有效性",colKey:"validType",cell:(P,p)=>{switch(p.row.valid){case Le.Valid:return t(at,{theme:"success"},{default:()=>[I("有效")]});case Le.Duplicate:return t(at,{theme:"warning"},{default:()=>[I("重复")]});case Le.Invalid:return t(at,{theme:"danger"},{default:()=>[I("无效")]})}}},{title:"Username",colKey:"username"},{title:"昵称",colKey:"nickname"}]),g=(P,p)=>{if(P.code!==0){G(a,P.code),r.value=!1;return}const k=[],_=P.data.users;let h=[];p?p.forEach(c=>{let s=null;if(_&&(s=_.find(T=>T.username.toLowerCase()===c.toLowerCase())),s){const T=k.find(D=>D.username.toLowerCase()===c.toLowerCase()),y=T?Le.Duplicate:Le.Valid;k.push({id:s.id,username:s.username,nickname:s.nickname,valid:y}),T||h.push(s.id)}else k.push({id:-1,username:c,nickname:"-",valid:Le.Invalid})}):_&&_.forEach(c=>{const s=k.find(y=>y.id===c.id),T=s?Le.Duplicate:Le.Valid;k.push({id:c.id,username:c.username,nickname:c.nickname,valid:T}),s||h.push(c.id)}),w.value=k,b=h,f.value=h},i=async P=>{const p=Array.from(new Set(P)),k=await Pn(p);g(k)},d=async P=>{const p=Array.from(new Set(P)),k=await Tn(p);g(k,P)},u=async()=>{r.value=!0;const P=wa(o.value);await d(P),n.value=!1,r.value=!1},v=()=>{w.value?o.value=w.value.map(P=>P.username).join(`
`):o.value="",n.value=!0};return(P,p)=>{const k=B,_=De,h=St,c=nt;return L(),ee(oe,null,[M("div",cs,[M("div",ds,[t(k,{onClick:v},{default:l(()=>p[2]||(p[2]=[I("编辑")])),_:1})]),t(_,{data:w.value,columns:C.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(c,{visible:n.value,"onUpdate:visible":p[1]||(p[1]=s=>n.value=s),onConfirm:u,header:"请输入用户Username","confirm-loading":r.value},{default:l(()=>[p[3]||(p[3]=M("div",{style:{"margin-bottom":"10px"}},[M("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(h,{modelValue:o.value,"onUpdate:modelValue":p[0]||(p[0]=s=>o.value=s),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),ja=re(ms,[["__scopeId","data-v-d2170a86"]]),ps={style:{margin:"10px"}},fs={style:{margin:"12px"}},vs={class:"dida-edit-container"},_s=se({__name:"CollectionEdit",setup(e){let a=we();const{globalProperties:n}=ce(),r=Je(),o=m(""),f=m(!1);let b=null;const w=m(!1),C=m(!1),g=m(null),i=m({title:"",openTime:[],private:!0,problems:[],members:[],description:""}),d=m(""),u=m(""),v=m(!1),P=async()=>{v.value=!0,C.value=!1,v.value=!1},p=async()=>{if(b){w.value=!0;try{const c={title:i.value.title,description:b.getValue(),problems:i.value.problems,members:i.value.members,private:i.value.private};i.value.openTime[0]&&(c.start_time=new Date(i.value.openTime[0])),i.value.openTime[1]&&(c.end_time=new Date(i.value.openTime[1]));const s=await Bo(c);if(w.value=!0,s.code!==0){G(n,s.code);return}s.data!=null&&await Z.push({name:"collection-detail",params:{collectionId:s.data}}),et(n,"创建成功")}finally{w.value=!1}}},k=async()=>{if(b){w.value=!0;try{const c={id:Number(o.value),title:i.value.title,private:i.value.private,problems:i.value.problems,members:i.value.members,description:b.getValue()};i.value.openTime[0]&&(c.start_time=new Date(i.value.openTime[0])),i.value.openTime[1]&&(c.end_time=new Date(i.value.openTime[1]));const s=await Jo(c);if(w.value=!0,s.code!==0){G(n,s.code);return}s.data!=null&&g.value&&(g.value.updateTime=new Date(s.data).toLocaleString()),et(n,"保存成功")}finally{w.value=!1}}},_=c=>{const s={after:()=>{b==null||b.setValue(c),f.value=!1},preview:{math:{inlineDigit:!0,engine:"KaTeX"}}};b=new me("collectionEditDiv",s)},h=async()=>{const c=await Oo(o.value);if(c.code!==0){G(n,c.code),console.error("collection get failed",c.code),await Z.push({name:"problem-collection-list"});return}const s=c.data.collection;g.value=await Ot(s),i.value.title=s.title,i.value.openTime=[],s.start_time?i.value.openTime.push(new Date(s.start_time)):i.value.openTime.push(""),s.end_time?i.value.openTime.push(new Date(s.end_time)):i.value.openTime.push(""),i.value.private=s.private,i.value.description=s.description,i.value.problems=s.problems,i.value.members=s.members,r.setTitle(s.title+" - "+r.getTitle);let T="";s.description&&(T=s.description),_(T)};return ue(async()=>{Array.isArray(a.params.collectionId)?o.value=a.params.collectionId[0]:o.value=a.params.collectionId,o.value?(f.value=!0,await h()):_("")}),(c,s)=>{const T=Re,y=Ue,D=va,z=mt,x=$e,V=_e,$=Te,A=B,U=he,S=Ze,j=Ye,R=Se,O=xe,X=St,te=nt;return L(),ee(oe,null,[t(O,{loading:f.value},{default:l(()=>[t(R,null,{default:l(()=>[t($,{span:8},{default:l(()=>[M("div",ps,[t(V,{class:"sh-card"},{default:l(()=>[t(x,{model:i.value},{default:l(()=>[t(y,{label:"标题"},{default:l(()=>[t(T,{modelValue:i.value.title,"onUpdate:modelValue":s[0]||(s[0]=J=>i.value.title=J),placeholder:"题集标题"},null,8,["modelValue"])]),_:1}),t(y,{label:"开启时间"},{default:l(()=>[t(D,{modelValue:i.value.openTime,"onUpdate:modelValue":s[1]||(s[1]=J=>i.value.openTime=J),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(y,{label:"私有"},{default:l(()=>[t(z,{modelValue:i.value.private,"onUpdate:modelValue":s[2]||(s[2]=J=>i.value.private=J)},null,8,["modelValue"])]),_:1}),t(y,{label:"成员"},{default:l(()=>[t(ja,{modelValue:i.value.members,"onUpdate:modelValue":s[3]||(s[3]=J=>i.value.members=J)},null,8,["modelValue"])]),_:1}),t(y,{label:"问题"},{default:l(()=>[t(La,{modelValue:i.value.problems,"onUpdate:modelValue":s[4]||(s[4]=J=>i.value.problems=J)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t($,{span:4},{default:l(()=>[M("div",fs,[M("div",vs,[o.value?(L(),K(U,{key:0},{default:l(()=>[t(A,{onClick:k,theme:"danger",loading:w.value},{default:l(()=>s[7]||(s[7]=[I("保存")])),_:1},8,["loading"])]),_:1})):(L(),K(U,{key:1},{default:l(()=>[t(A,{onClick:p,theme:"danger",loading:w.value},{default:l(()=>s[8]||(s[8]=[I("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(L(),K(j,{key:0,layout:"vertical",bordered:!0},{default:l(()=>[t(S,{label:"创建时间"},{default:l(()=>{var J;return[I(F((J=g.value)==null?void 0:J.createTime),1)]}),_:1}),t(S,{label:"更新时间"},{default:l(()=>{var J;return[I(F((J=g.value)==null?void 0:J.updateTime),1)]}),_:1}),t(S,{label:"创建用户"},{default:l(()=>{var J;return[I(F((J=g.value)==null?void 0:J.ownerNickname),1)]}),_:1})]),_:1})):ne("",!0)])]),_:1})]),_:1}),s[9]||(s[9]=M("div",{id:"collectionEditDiv",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"]),t(te,{visible:C.value,"onUpdate:visible":s[6]||(s[6]=J=>C.value=J),onConfirm:P,header:d.value,"confirm-loading":v.value},{default:l(()=>[s[10]||(s[10]=M("div",{style:{"margin-bottom":"10px"}},[M("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(X,{modelValue:u.value,"onUpdate:modelValue":s[5]||(s[5]=J=>u.value=J),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),Yt=re(_s,[["__scopeId","data-v-dbc568cf"]]),gs=["innerHTML"];function Zt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const bs=se({__name:"JudgeJobList",setup(e){const a=we(),n=Be(),{globalProperties:r}=ce();let o=!1,f=null,b;const w=m(!1),C=m(null),g=m(null),i=m(!1);let d=-1;const u=m({problemId:"",username:"",language:void 0,status:void 0}),v=m([{title:"ID",colKey:"id",cell:(S,j)=>{let R=null;return wt(j.row.status)&&yt(j.row.language)&&(R=()=>{z(j.row.id)}),t(B,{variant:"text",onClick:R},{default:()=>[j.row.id]})}},{title:"问题",colKey:"problemId",cell:(S,j)=>{if(d){let R;return t(B,{variant:"text",onClick:()=>D(d,j.row.contestProblemIndex)},Zt(R=lt(j.row.contestProblemIndex))?R:{default:()=>[R]})}return t(B,{variant:"text",onClick:()=>y(j.row.problemId)},{default:()=>[j.row.problemId]})}},{title:"状态",colKey:"status",align:"center",cell:(S,j)=>{let R=null;wt(j.row.status)&&yt(j.row.language)&&(R=()=>{z(j.row.id)});const O=j.row.status,X=Ct(O);let te=!wt(O);const J=ka(O);let H=[];return it(O)&&H.push(t(xe,{text:j.row.state,size:"small",class:"dida-status-loading"},null)),H.push(t("span",null,[X])),t(B,{theme:J,variant:"outline",onClick:R,disabled:te},Zt(H)?H:{default:()=>[H]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"code",cell:(S,j)=>{let R=!yt(j.row.language);return t(B,{theme:"default",onClick:()=>T(j.row),disabled:R},{default:()=>[kt(j.row.language)+" / "+j.row.codeLength]})}},{title:"作者",colKey:"author",width:200,cell:(S,j)=>t(B,{variant:"text",onClick:()=>x(j.row.authorUsername)},{default:()=>[j.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),P=m(!1);let p=1,k=50;const _=m({current:p,pageSize:k,defaultCurrent:p,defaultPageSize:k,total:0,pageSizeOptions:[50,100]}),h=m(),c=m([]);c.value=Et();const s=m([]);s.value=Ca();const T=async S=>{i.value=!0,w.value=!0;try{C.value=S;const j=await Bl(Number(C.value.id));if(j.code===0){const R=j.data,X=`\`\`\`${qt(R.language)}
${R.code}
\`\`\``,te={};C.value.code=await me.md2html(X,te),await Ne(()=>{g.value&&(me.highlightRender({lineNumber:!0,enable:!0},g.value),Qe(g.value))})}else G(r,j.code)}finally{i.value=!1}},y=S=>{S&&n.push({path:"/problem/"+S})},D=(S,j)=>{n.push({name:"contest-problem-detail",params:{contestId:S,problemIndex:j}})},z=S=>{S&&(d>0?n.push({name:"contest-judge-detail",params:{contestId:d,judgeId:S}}):n.push({name:"judge-detail",params:{judgeId:S}}))},x=S=>{S&&n.push({path:"/user/"+S})},V=async()=>{await n.push({query:{...a.query,page:1,page_size:k,problem_id:u.value.problemId,username:u.value.username,language:u.value.language,status:u.value.status}})},$=async()=>{u.value.problemId="",u.value.username="",u.value.language=void 0,u.value.status=void 0,await n.push({query:{...a.query,page:1,page_size:k,problem_id:"",username:"",language:void 0,status:void 0}})},A=async(S,j)=>{j&&(P.value=!0);let R=!1;try{const{current:O,pageSize:X}=S,te=await Jl(d,u.value.problemId,u.value.username,u.value.language,u.value.status,O,X);if(h.value=[],te.code===0){if(!te.data.has_auth){ve(r,"您目前没有权限查看评测记录"),d?await n.push({name:"contest-detail",params:{contestId:d}}):await n.push({name:"judge-list"});return}te.data.list&&te.data.list.length>0?(te.data.list.forEach(H=>{var ye;const N=Sa(H);(ye=h.value)==null||ye.push(N),it(H.status)&&(R=!0)}),_.value={..._.value,total:te.data.total_count}):(ve(r,"未找到记录"),_.value={..._.value,total:0})}else j&&G(r,te.code)}catch(O){console.error(O),j&&G(r,Ae())}finally{j&&(P.value=!1),R&&o&&(b=setTimeout(()=>{A({current:p,pageSize:k},!1)},5e3))}},U=async S=>{await n.push({query:{...a.query,page:S.current,page_size:S.pageSize}})};return ue(async()=>{o=!0,f=ze(()=>a.query,S=>{Array.isArray(a.params.contestId)?d=Number(a.params.contestId[0]):d=Number(a.params.contestId),u.value.problemId=S.problem_id||"",u.value.username=S.username||"",S.language!=null?u.value.language=Number(S.language):u.value.language=void 0,S.status!=null?u.value.status=Number(S.status):u.value.status=void 0;const j=parseInt(S.page)||_.value.defaultCurrent,R=parseInt(S.page_size)||_.value.defaultPageSize;p=j,k=R,_.value.pageSizeOptions.includes(k)||(k=_.value.defaultPageSize),_.value={..._.value,current:p,pageSize:k},A({current:p,pageSize:k},!0)},{immediate:!0})}),Ve(()=>{o=!1,f&&f(),clearTimeout(b)}),(S,j)=>{const R=Re,O=Ue,X=Rt,te=ut,J=B,H=he,N=$e,ye=De,Pe=_e,q=ot,E=xe,ae=nt;return L(),ee(oe,null,[t(Pe,{style:{margin:"10px"}},{default:l(()=>[t(N,{layout:"inline",onSubmit:V,onReset:$},{default:l(()=>[t(O,{label:"题号"},{default:l(()=>[t(R,{modelValue:u.value.problemId,"onUpdate:modelValue":j[0]||(j[0]=Y=>u.value.problemId=Y),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(O,{label:"用户"},{default:l(()=>[t(R,{modelValue:u.value.username,"onUpdate:modelValue":j[1]||(j[1]=Y=>u.value.username=Y),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(O,{label:"语言"},{default:l(()=>[t(te,{modelValue:u.value.language,"onUpdate:modelValue":j[2]||(j[2]=Y=>u.value.language=Y),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:l(()=>[(L(!0),ee(oe,null,Ce(c.value,Y=>(L(),K(X,{key:Y.value,value:Y.value,label:Y.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(O,{label:"状态"},{default:l(()=>[t(te,{modelValue:u.value.status,"onUpdate:modelValue":j[3]||(j[3]=Y=>u.value.status=Y),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:l(()=>[(L(!0),ee(oe,null,Ce(s.value,Y=>(L(),K(X,{key:Y.value,value:Y.value,label:Y.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(O,null,{default:l(()=>[t(H,null,{default:l(()=>[t(J,{theme:"primary",type:"submit"},{default:l(()=>j[7]||(j[7]=[I("搜索")])),_:1}),t(J,{theme:"default",variant:"base",type:"reset"},{default:l(()=>j[8]||(j[8]=[I("重置")])),_:1})]),_:1})]),_:1})]),_:1}),t(ye,{data:h.value,columns:v.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:_.value,loading:P.value,onPageChange:U,"table-layout":"auto"},null,8,["data","columns","pagination","loading"])]),_:1}),t(ae,{visible:w.value,"onUpdate:visible":j[5]||(j[5]=Y=>w.value=Y),width:"800px","cancel-btn":null,"close-btn":!1,onConfirm:j[6]||(j[6]=Y=>w.value=!1)},{header:l(()=>[t(q,{onClick:j[4]||(j[4]=()=>{var Y;z((Y=C.value)==null?void 0:Y.id)})},{default:l(()=>{var Y,ie;return[I(F(((Y=C.value)==null?void 0:Y.id)+" - "+de(kt)((ie=C.value)==null?void 0:ie.language)),1)]}),_:1})]),default:l(()=>[t(E,{loading:i.value},{default:l(()=>{var Y;return[M("div",{innerHTML:(Y=C.value)==null?void 0:Y.code,ref_key:"markdownCodeRef",ref:g,style:{"min-height":"100px"}},null,8,gs)]}),_:1},8,["loading"])]),_:1},8,["visible"])],64)}}}),Qt=re(bs,[["__scopeId","data-v-8ecb6b14"]]),hs={class:"dida-code-container"},ys=["innerHTML"],ws={key:2,class:"dida-edit-container"};function ea(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const ks=se({__name:"JudgeJobDetail",setup(e){const a=we(),n=Be(),r=je(),{globalProperties:o}=ce();let f=!1,b,w=0,C=0;const g=m(""),i=m(null),d=m(""),u=m(null),v=m(0),P=m(null),p=m({from:"#5a96ff",to:"#00A870"});let k=!1;const _=m([{title:"ID",colKey:"id"},{title:"问题",colKey:"problemId",cell:(A,U)=>t(B,{variant:"text",onClick:()=>D(U.row.problemId)},{default:()=>[U.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(A,U)=>{const S=U.row.status,j=Ct(S),R=ka(S);let O=[];return it(S)&&O.push(t(xe,{text:U.row.state,size:"small",class:"dida-status-loading"},null)),O.push(t("span",null,[j])),t(B,{theme:R,variant:"outline"},ea(O)?O:{default:()=>[O]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"language",cell:(A,U)=>t("span",null,[kt(U.row.language)+" / "+U.row.codeLength])},{title:"作者",colKey:"author",width:200,cell:(A,U)=>t(B,{variant:"text",onClick:()=>z(U.row.authorUsername)},{default:()=>[U.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),h=m(!1),c=m(!1),s=m(),T=He(()=>r.hasAuth(Ke.ManageJudge)),y=async()=>{if(!c.value){c.value=!0;try{const A=await Ql(w);A.code===0?await V(!0):G(o,A.code)}catch(A){console.error(A),G(o,Ae())}finally{c.value=!1}}},D=A=>{A&&n.push({path:"/problem/"+A})},z=A=>{A&&n.push({path:"/user/"+A})},x=A=>{const U=A.status,S=Ct(U);let j;switch(U){case qe.Init:case qe.Rejudge:case qe.Compiling:case qe.Running:j="default";break;case qe.Accept:j="success";break;case qe.PE:j="warning";break;default:j="danger";break}return t(he,null,{default:()=>[t(B,{theme:"default",variant:"outline"},{default:()=>[A.taskId]}),t(B,{theme:j,variant:"outline"},ea(S)?S:{default:()=>[S]}),t("span",null,[I("分数："),A.score]),t("span",null,[I("用时："),A.time]),t("span",null,[I("内存："),A.memory])]})},V=async A=>{var S;A&&(h.value=!0);let U=!1;try{const j=await Hl(w);if(s.value=[],j.code===0){const R=j.data,O=Sa(R);(S=s.value)==null||S.push(O),g.value=O.judgerName,p.value.to="#00A870",it(R.status)?(P.value="active",O.taskTotal>0?(v.value=O.taskCurrent/O.taskTotal*100,O.taskCurrent>=O.taskTotal&&(v.value=99)):v.value=0):(v.value=100,R.status===qe.Accept?P.value="success":R.status===qe.PE?(p.value.to="#F57C20",P.value="warning"):(p.value.to="#F56C6C",P.value="error"));const X={};if(R.code){const J=`\`\`\`${qt(R.language)}
${R.code}
\`\`\``;d.value=await me.md2html(J,X),await Ne(()=>{u.value&&(k||(k=!0,me.highlightRender({lineNumber:!0,enable:!0},u.value)),Qe(u.value))})}i.value=O,it(R.status)&&(U=!0)}else A&&G(o,j.code),C?await n.push({name:"contest-judge",params:{contestId:C}}):await n.push({name:"judge-list"})}catch(j){console.error(j),A&&G(o,Ae())}finally{A&&(h.value=!1),U&&f&&(b=setTimeout(()=>{V(!1)},5e3))}};function $(){u.value&&u.value.parentElement&&(u.value.style.maxWidth=u.value.parentElement.clientWidth+"px")}return ue(async()=>{if(f=!0,Array.isArray(a.params.judgeId)?w=Number(a.params.judgeId[0]):w=Number(a.params.judgeId),Array.isArray(a.params.contestId)?C=Number(a.params.contestId[0]):C=Number(a.params.contestId),!w){await n.push({name:"judge"});return}await V(!0),$(),window.addEventListener("resize",$)}),Ve(()=>{f=!1,window.removeEventListener("resize",$),clearTimeout(b)}),(A,U)=>{var Pe,q,E;const S=At,j=De,R=_e,O=Te,X=Ze,te=Ye,J=Se,H=ml,N=pl,ye=B;return L(),ee(oe,null,[t(S,{color:p.value,status:P.value,class:"dida-job-progress",percentage:v.value},null,8,["color","status","percentage"]),t(R,{style:{margin:"10px"}},{default:l(()=>[t(j,{data:s.value,columns:_.value,"row-key":"id","vertical-align":"top",hover:!0,loading:h.value},null,8,["data","columns","loading"])]),_:1}),t(J,null,{default:l(()=>[t(O,{span:8},{default:l(()=>[M("div",hs,[M("div",{innerHTML:d.value,ref_key:"markdownCodeRef",ref:u,class:"dida-code-div"},null,8,ys)])]),_:1}),t(O,{span:4},{default:l(()=>[t(te,{layout:"vertical",bordered:!0,style:{margin:"10px"}},{default:l(()=>[t(X,{label:"判题机"},{default:l(()=>[I(F(g.value),1)]),_:1}),t(X,{label:"判题时间"},{default:l(()=>{var ae;return[I(F((ae=i.value)==null?void 0:ae.judgeTime),1)]}),_:1})]),_:1})]),_:1})]),_:1}),(Pe=i.value)!=null&&Pe.compileMessage?(L(),K(R,{key:0,class:"compile-message"},{default:l(()=>{var ae;return[I(F((ae=i.value)==null?void 0:ae.compileMessage),1)]}),_:1})):ne("",!0),(q=i.value)!=null&&q.task&&((E=i.value)==null?void 0:E.task.length)>0?(L(),K(N,{key:1,class:"task-panel"},{default:l(()=>{var ae;return[(L(!0),ee(oe,null,Ce((ae=i.value)==null?void 0:ae.task,(Y,ie)=>(L(),K(H,{key:Y.taskId,header:()=>x(Y)},{default:l(()=>[I(F(Y.content)+" "+F(Y.waHint),1)]),_:2},1032,["header"]))),128))]}),_:1})):ne("",!0),T.value?(L(),ee("div",ws,[t(ye,{onClick:y,loading:c.value},{default:l(()=>U[0]||(U[0]=[I("重新评测")])),_:1},8,["loading"])])):ne("",!0)],64)}}}),ta=re(ks,[["__scopeId","data-v-e5da76e3"]]),Cs={style:{margin:"10px"}},Ss=se({__name:"ContestList",setup(e){const a=we(),n=Be(),{globalProperties:r}=ce();let o=null;const f=m([{title:"ID",colKey:"id",cell:(_,h)=>t(B,{variant:"text",onClick:()=>u(h.row.id)},{default:()=>[h.row.id]})},{title:"标题",colKey:"title",cell:(_,h)=>t(B,{variant:"text",onClick:()=>u(h.row.id)},{default:()=>[h.row.title]})},{title:"负责人",colKey:"ownerNickname",cell:(_,h)=>t(B,{variant:"text",onClick:()=>Nt(n,h.row.ownerUsername)},{default:()=>[h.row.ownerNickname]})},{title:"权限",colKey:"private",cell:(_,h)=>h.row.private?"私有":"公开"},{title:"开始时间",colKey:"startTime"},{title:"结束时间",colKey:"endTime"}]),b=m(!1);let w=1,C=50;const g=m({current:w,pageSize:C,defaultCurrent:w,defaultPageSize:C,total:0,pageSizeOptions:[50,100]}),i=m(),d=m({title:"",username:""}),u=_=>{_&&n.push({path:"/contest/"+_})},v=async()=>{await n.push({query:{...a.query,title:d.value.title,username:d.value.username,page:1,page_size:g.value.defaultPageSize}})},P=async(_,h)=>{var c;b.value=!0;try{const{current:s,pageSize:T}=_,y=await ao(s,T);if(i.value=[],y.code===0){const D=y.data.list;for(let z=0;z<D.length;z++){const x=D[z],V=await Ft(x);(c=i.value)==null||c.push(V)}g.value={...g.value,total:y.data.total_count}}else h&&G(r,y.code)}catch(s){console.error(s),G(r,Ae())}finally{b.value=!1}},p=async _=>{await n.push({query:{...a.query,page:_.current,page_size:_.pageSize}})},k=()=>{n.push({name:"contest-create"})};return ue(async()=>{o=ze(()=>a.query,_=>{d.value.title=_.title||"",d.value.username=_.username||"";const h=parseInt(_.page)||g.value.defaultCurrent,c=parseInt(_.page_size)||g.value.defaultPageSize;w=h,C=c,g.value={...g.value,current:w,pageSize:C},P({current:w,pageSize:C},!0)},{immediate:!0})}),Ve(()=>{o&&o()}),(_,h)=>{const c=De,s=_e,T=Te,y=Re,D=Ue,z=B,x=$e,V=he,$=Se;return L(),K($,null,{default:l(()=>[t(T,{span:9},{default:l(()=>[t(s,{style:{margin:"10px"}},{default:l(()=>[t(c,{data:i.value,columns:f.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:g.value,loading:b.value,"table-layout":"auto",onPageChange:p,style:{"white-space":"nowrap"}},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(T,{span:3},{default:l(()=>[M("div",Cs,[t(s,{class:"sh-card"},{default:l(()=>[t(x,{model:d.value},{default:l(()=>[t(D,{label:"标题"},{default:l(()=>[t(y,{modelValue:d.value.title,"onUpdate:modelValue":h[0]||(h[0]=A=>d.value.title=A),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(D,{label:"负责人"},{default:l(()=>[t(y,{modelValue:d.value.username,"onUpdate:modelValue":h[1]||(h[1]=A=>d.value.username=A),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(D,null,{default:l(()=>[t(z,{theme:"primary",onClick:v},{default:l(()=>h[2]||(h[2]=[I("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(s,{class:"sh-card"},{default:l(()=>[t(V,null,{default:l(()=>[t(z,{onClick:k},{default:l(()=>h[3]||(h[3]=[I("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),aa=re(Ss,[["__scopeId","data-v-c929776f"]]),Is={style:{margin:"20px"}},Ps={style:{margin:"10px"}},Ts={style:{"text-align":"center","align-content":"center",padding:"20px",height:"500px"}},xs={style:{"text-align":"center",width:"100%"}},Vs={class:"dida-operation-container"},Ds={style:{margin:"12px"}},Ls=["innerHTML"],js=se({__name:"ContestDetail",setup(e){let a=we();const{globalProperties:n}=ce(),r=Je(),o=je(),f=m(!1);let b=0;const w=m(!1),C=m(null),g=m(!1),i=m(!1),d=m(""),u=He(()=>o.hasAuth(Ke.ManageContest)||C.value&&o.getUserId==C.value.ownerId),v=y=>{if(!y||!k)return"default";const D=k[y];if(!D)return"default";switch(D){case Fe.Accept:return"success";case Fe.Attempt:return"warning";default:return"default"}},P=m([{title:"问题ID",colKey:"index",cell:(y,D)=>{const z=v(D.row.index);return t(B,{variant:"dashed",theme:z,onClick:async()=>await $t(b,D.row.index)},{default:()=>[D.row.id]})}},{title:"标题",colKey:"title",cell:(y,D)=>t(B,{variant:"text",onClick:async()=>await $t(b,D.row.index)},{default:()=>[D.row.title]})},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),p=m([]);let k={},_=m(!1);const h=()=>{Z.push({name:"contest-edit",params:{contestId:b}})},c=async()=>{f.value=!0;try{const y=await ro(b);if(y.code!==0){G(n,y.code);return}const D=y.data;ve(n,"查重报告已生成，请前往查看"),window.open(D,"_blank")}finally{f.value=!1}},s=async y=>{if(!o.isLogin()){await Z.push({name:"login"});return}if(!d.value){fe(n,"请输入密码");return}_.value=!0;try{const D=await so(b,d.value);if(D.code!==0){G(n,D.code);return}ve(n,"申请访问成功"),await T()}catch(D){console.error("Error submitting contest password:",D),G(n,"提交密码失败，请稍后再试")}finally{_.value=!1}},T=async()=>{w.value=!0;const y=await Zn(b);if(y.code!==0){w.value=!1,G(n,y.code),await Z.push({name:"contest"});return}g.value=y.data.has_auth,i.value=y.data.need_password,C.value=await Ft(y.data.contest),p.value=C.value.problems,k=y.data.attempt_status||{},r.setTitle(C.value.title+" - "+r.getTitle),await Ne(()=>{const D=document.querySelectorAll(".dida-content-description");D&&D.length>0&&D.forEach(z=>{me.mathRender(z),me.highlightRender({lineNumber:!0,enable:!0},z),Qe(z)}),w.value=!1})};return ue(async()=>{if(Array.isArray(a.params.contestId)?b=Number(a.params.contestId[0]):b=Number(a.params.contestId),!b){await Z.push({name:"contest"});return}await T()}),(y,D)=>{const z=Ut,x=De,V=_e,$=Re,A=Ue,U=B,S=$e,j=Te,R=he,O=Ze,X=Ye,te=Se,J=xe;return L(),K(J,{loading:w.value},{default:l(()=>[t(te,{class:"dida-main-content"},{default:l(()=>[t(j,{span:6},{default:l(()=>{var H,N,ye;return[M("div",Is,[M("h1",null,F((H=C.value)==null?void 0:H.title),1),(N=C.value)!=null&&N.notification?(L(),K(z,{key:0,theme:"info",message:(ye=C.value)==null?void 0:ye.notification},null,8,["message"])):ne("",!0)]),M("div",Ps,[g.value?(L(),K(V,{key:0},{default:l(()=>[t(x,{data:p.value,columns:P.value,"row-key":"id","table-layout":"auto","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1})):(L(),K(V,{key:1},{default:l(()=>[M("div",Ts,[t(z,{theme:"warning",message:"您没有查看本比赛的权限"}),i.value?(L(),K(S,{key:0,style:{margin:"20px auto 0",width:"200px"},onSubmit:s,"label-width":"0"},{default:l(()=>[t(A,null,{default:l(()=>[t($,{placeholder:"请输入密码",value:d.value,"onUpdate:value":D[0]||(D[0]=Pe=>d.value=Pe),style:{width:"300px"},type:"password",autocomplete:"new-password"},null,8,["value"])]),_:1}),t(A,null,{default:l(()=>[M("div",xs,[t(U,{theme:"primary",type:"submit",loading:de(_)},{default:l(()=>D[1]||(D[1]=[I("提交")])),_:1},8,["loading"])])]),_:1})]),_:1})):ne("",!0)])]),_:1}))])]}),_:1}),t(j,{span:6},{default:l(()=>{var H;return[M("div",Vs,[t(R,null,{default:l(()=>[u.value?(L(),K(U,{key:0,onClick:c,loading:f.value},{default:l(()=>D[2]||(D[2]=[I("查重")])),_:1},8,["loading"])):ne("",!0),u.value?(L(),K(U,{key:1,onClick:h},{default:l(()=>D[3]||(D[3]=[I("编辑")])),_:1})):ne("",!0)]),_:1})]),M("div",Ds,[t(X,{layout:"vertical",bordered:!0},{default:l(()=>[t(O,{label:"创建时间"},{default:l(()=>{var N;return[I(F((N=C.value)==null?void 0:N.createTime),1)]}),_:1})]),_:1}),t(X,{layout:"vertical",bordered:!0},{default:l(()=>[t(O,{label:"更新时间"},{default:l(()=>{var N;return[I(F((N=C.value)==null?void 0:N.updateTime),1)]}),_:1})]),_:1}),t(X,{layout:"vertical",bordered:!0},{default:l(()=>[t(O,{label:"开始时间"},{default:l(()=>{var N;return[I(F((N=C.value)==null?void 0:N.startTime),1)]}),_:1})]),_:1}),t(X,{layout:"vertical",bordered:!0},{default:l(()=>[t(O,{label:"结束时间"},{default:l(()=>{var N;return[I(F((N=C.value)==null?void 0:N.endTime),1)]}),_:1})]),_:1})]),(H=C.value)!=null&&H.description?(L(),K(V,{key:0,style:{margin:"12px"}},{default:l(()=>{var N;return[M("div",{innerHTML:(N=C.value)==null?void 0:N.description,class:"dida-content-description"},null,8,Ls)]}),_:1})):ne("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),zs=re(js,[["__scopeId","data-v-75131de1"]]);function za(e){return e?Math.floor(e/1e9):0}function rt(e){if(e<=0)return"0秒";let a="";const n=Math.floor(e/3600);n>0&&(a+=`${n}小时`);const r=Math.floor(e%3600/60);return(r>0||n>0)&&(n>0&&r<10&&(a+="0"),a+=`${r}分钟`),e=e%60,(e>0||r>0||n>0)&&((n>0||r>0)&&e<10&&(a+="0"),a+=`${e.toFixed(0)}秒`),a}const $s=dt("contest",{state:()=>({starMembers:{}}),actions:{clear(){this.$patch({starMembers:{}})},addStarMember(e,a){this.starMembers[e]||(this.starMembers[e]={}),this.starMembers[e][a]=!0},removeStarMember(e,a){this.starMembers[e]&&(delete this.starMembers[e][a],Object.keys(this.starMembers[e]).length===0&&delete this.starMembers[e])},isStarMember(e,a){var n;return!!((n=this.starMembers[e])!=null&&n[a])}},persist:!0}),Us={style:{margin:"10px 10px 40px"}},As={style:{"text-align":"right","margin-bottom":"10px"}},Rs={class:"table-scroll-wrapper"};function la(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const Ms=se({__name:"ContestRank",setup(e){const a=we(),n=Be(),r=$s(),{globalProperties:o}=ce();let f=!1,b=null,w=0,C=null,g=null,i=0;const d=m(0),u=m(0),v=m(!1),P=m(!0),p=m(!0);let k=null,_=null,h=1,c=50;const s=m({current:h,pageSize:c,defaultCurrent:1,defaultPageSize:50,total:0,pageSizeOptions:[50,100,1e3]}),T=q=>r&&r.isStarMember(w,q),y=async q=>{s.value={...s.value,current:q.current,pageSize:q.pageSize},await n.push({query:{...a.query,page:q.current,page_size:q.pageSize}})},D=q=>{if(q==null)return"-";const E=Math.floor(q/3600).toString().padStart(2,"0"),ae=Math.floor(q%3600/60).toString().padStart(2,"0"),Y=(q%60).toFixed(0).toString().padStart(2,"0");return`${E}:${ae}:${Y}`},z=m({}),x=[{title:"Rank",colKey:"rank",align:"center",fixed:"left"},{title:"昵称",colKey:"nickname",fixed:"left",attrs:q=>{let E={};return T(q.row.userId)&&(E={backgroundColor:"rgba(255,165,30,0.5)"}),{style:E}},cell:(q,E)=>{const ae=Nl(E.row.nickname,18);let Y=null;return T(E.row.userId)?Y=t(B,{shape:"circle",variant:"text",class:"rank-unstar-button",onClick:()=>{r.removeStarMember(w,E.row.userId),N()}},{default:()=>[t(Ba,{slot:"icon"},null)]}):Y=t(B,{shape:"circle",variant:"text",class:"rank-star-button",onClick:()=>{r.addStarMember(w,E.row.userId),N()}},{default:()=>[t(Ja,{slot:"icon"},null)]}),t("div",{class:"rank-nickname-cell"},[t(he,null,{default:()=>[t(vl,{content:E.row.nickname},{default:()=>[t(B,{variant:"text",onClick:()=>n.push({name:"user",params:{username:E.row.username}})},la(ae)?ae:{default:()=>[ae]})]}),Y]})])}},{title:"Solved",colKey:"solved",align:"center",fixed:"left",cell:(q,E)=>t(B,{variant:"text",onClick:()=>n.push({name:"contest-judge",params:{contestId:w},query:{username:E.row.username,status:qe.Accept}})},{default:()=>[E.row.solved]})},{title:"Penalty",colKey:"penalty",align:"center",fixed:"left",cell:(q,E)=>D(E.row.penalty)}],V=m([]),$=m(!1);let A=[],U=[];const S=m([]);let j=[];const R=({col:q,rowIndex:E})=>{if(q.colKey==="rank"){let ae=s.value.current;s.value.current>Math.ceil(S.value.length/s.value.pageSize)&&(ae=Math.ceil(S.value.length/s.value.pageSize));let Y=s.value.pageSize*(ae-1),ie=1;for(let pe=E+1;Y+pe<S.value.length&&S.value[Y+pe].rank===S.value[Y+E].rank;pe++)ie++;return{rowspan:ie}}},O=(q,{value:E})=>rt(E),X=()=>{k&&clearInterval(k),k=setInterval(()=>{f&&Pe(!1)},3e4),_&&clearInterval(_),_=setInterval(()=>{if(!f)return;d.value=(new Date().getTime()-C.getTime())/1e3;const q=Math.min(d.value,u.value);d.value=Math.min(d.value,q),N()},1e3)},te=()=>{k&&(clearInterval(k),k=null),_&&(clearInterval(_),_=null)},J=async q=>{p.value=q,q?(await Pe(!1),X()):te()},H=()=>{N(),s.value={...s.value,current:1}},N=()=>{S.value=[];let q=[];for(let Q=0;Q<A.length;Q++){const be=A[Q];let Me={userId:be.author_id,username:be.author_username,nickname:be.author_nickname},We=0,Ee=0;be.problems.forEach(Oe=>{let Xe=-1,ke=Oe.lock||0;if(Oe.ac){if(Xe=(new Date(Oe.ac).getTime()-(C==null?void 0:C.getTime()))/1e3,Xe>d.value)return;We++,Ee+=Xe,Ee+=Oe.attempt*20*60}if(ke>0&&i>0){const Ge=u.value-i;d.value<Ge&&(ke=0)}const le=Oe.index;Me[`problem_${le}`]={acDuration:Xe,attempt:Oe.attempt||0,lock:ke}}),Me.solved=We,Me.penalty=Ee,q.push(Me)}q.sort((Q,be)=>Q.solved!==be.solved?be.solved-Q.solved:Q.penalty!==be.penalty?Q.penalty-be.penalty:Q.userId-be.userId);const E=U;let ae=0,Y=0,ie=-1,pe=-1;for(let Q=0;Q<q.length;Q++)E&&E.includes(q[Q].userId)?q[Q].rank="*":(Y++,(q[Q].solved!==ie||q[Q].penalty!==pe)&&(ae=Y,ie=q[Q].solved,pe=q[Q].penalty),q[Q].rank=String(ae));v.value&&(q=q.filter(Q=>T(Q.userId)));const Ie=document.querySelectorAll("tbody tr"),ge={};j.forEach((Q,be)=>{const Me=Ie[be];Me&&(ge[Q.userId]=Me.getBoundingClientRect())}),s.value={...s.value,total:q.length},S.value=q;for(let Q=0;Q<S.value.length;Q++)S.value[Q].index=Q+1;if(j=[...S.value],P.value){const Q={},be=document.querySelectorAll("table tbody tr");S.value.forEach((Me,We)=>{const Ee=be[We];Ee&&(Q[Me.userId]=Ee.getBoundingClientRect())}),requestAnimationFrame(()=>{const Me=document.querySelectorAll("table tbody tr");S.value.forEach((We,Ee)=>{const Oe=Me[Ee],Xe=ge[We.userId],ke=Q[We.userId];if(Xe&&ke){const le=Xe.top-ke.top;le!==0&&(Oe.style.transition="none",Oe.style.transform=`translateY(${le}px)`)}}),requestAnimationFrame(()=>{document.querySelectorAll("table tbody tr").forEach(Ee=>{Ee.style.transition="transform 300ms ease",Ee.style.transform=""})})})}},ye=q=>{J(!1),d.value=q;const E=Math.min(u.value,(new Date().getTime()-(C==null?void 0:C.getTime()))/1e3);d.value=Math.min(d.value,E),N()},Pe=async q=>{q&&($.value=!0);try{const E=await lo(w);if(V.value=[...x],A=[],U=[],S.value=[],s.value={...s.value,total:0},E.code===0){if(!E.data.has_auth){ve(o,"您目前没有权限查看比赛排名"),await n.push({name:"contest-detail",params:{contestId:w}});return}E.data.problems.sort((ie,pe)=>ie-pe),E.data.problems.forEach((ie,pe)=>{V.value.push({colKey:`problem_${ie}`,align:"center",title:()=>{let Ie;return t(B,{variant:"text",onClick:()=>n.push({name:"contest-problem-detail",params:{contestId:w,problemIndex:ie}})},la(Ie=lt(ie))?Ie:{default:()=>[Ie]})},cell:(Ie,ge)=>{const Q=ge.row[`problem_${ie}`];if(!Q)return"";let be="";return Q.acDuration>=0&&(be=D(Q.acDuration)),Q.attempt>0&&(be&&(be+=" "),be+=`(-${Q.attempt})`),Q.lock>0&&(be&&(be+=" "),be+=`(+${Q.lock})`),t("span",null,[be])},attrs:Ie=>{const ge=Ie.row[`problem_${ie}`];return ge?ge.acDuration>=0?{style:{backgroundColor:"rgba(130,255,30,0.5)"}}:ge.lock>0?{style:{backgroundColor:"rgb(255,180,50,0.5)"}}:ge.attempt>0?{style:{backgroundColor:"rgba(255,120,120,0.5)"}}:{}:{}}})});const ae=E.data.contest;if(C=new Date(ae.start_time),g=new Date(ae.end_time),A=E.data.ranks,U=E.data.v_members||[],u.value=Math.floor((g.getTime()-C.getTime())/1e3),z.value={0:"0",[Math.floor(u.value/2)]:rt(Math.floor(u.value/2)),[u.value]:rt(u.value)},i=za(ae.lock_rank_duration||0),E.data.is_locked&&i>0){const ie=Math.max(0,u.value-i);z.value[ie]=t("span",{style:"color: #0052d9"},[I("锁榜("),rt(ie),I(")")])}d.value=Math.floor((new Date().getTime()-C.getTime())/1e3);const Y=Math.min(d.value,u.value);d.value=Math.min(d.value,Y),p.value=!0,X(),N()}else q&&G(o,E.code)}catch(E){console.error(E),q&&G(o,Ae())}finally{q&&($.value=!1)}};return ue(async()=>{f=!0,b=ze(()=>a.query,async q=>{if(Array.isArray(a.params.contestId)?w=Number(a.params.contestId[0]):w=Number(a.params.contestId),!w){await n.push({name:"contest"});return}const E=parseInt(q.page)||s.value.defaultCurrent,ae=parseInt(q.page_size)||s.value.defaultPageSize;h=E,c=ae,s.value={...s.value,current:h,pageSize:c},await Pe(!0)},{immediate:!0})}),Ve(()=>{f=!1,b&&b(),te()}),(q,E)=>{const ae=mt,Y=he,ie=fl,pe=De,Ie=_e,ge=Se;return L(),K(ge,null,{default:l(()=>[t(Ie,{style:{margin:"10px",width:"100%"}},{default:l(()=>[M("div",Us,[M("div",As,[t(Y,null,{default:l(()=>[t(ae,{size:"large",modelValue:v.value,"onUpdate:modelValue":E[0]||(E[0]=Q=>v.value=Q),onChange:H},{label:l(Q=>[I(F(Q.value?"仅展示收藏":"未过滤收藏"),1)]),_:1},8,["modelValue"]),t(ae,{size:"large",modelValue:P.value,"onUpdate:modelValue":E[1]||(E[1]=Q=>P.value=Q)},{label:l(Q=>[I(F(Q.value?"开启动画":"关闭动画"),1)]),_:1},8,["modelValue"]),t(ae,{size:"large",modelValue:p.value,"onUpdate:modelValue":E[2]||(E[2]=Q=>p.value=Q),onChange:J},{label:l(Q=>[I(F(Q.value?"自动刷新":"关闭刷新"),1)]),_:1},8,["modelValue"])]),_:1})]),t(ie,{modelValue:d.value,"onUpdate:modelValue":E[3]||(E[3]=Q=>d.value=Q),marks:z.value,max:u.value,label:O,"tooltip-props":{placement:"top"},"input-number-props":{theme:"column",autoWidth:!0,format:de(rt),onChange:ye},onChangeEnd:ye},null,8,["modelValue","marks","max","input-number-props"])]),M("div",Rs,[t(pe,{data:S.value,columns:V.value,"row-key":"index","vertical-align":"middle",bordered:!0,hover:!0,"table-layout":"auto","rowspan-and-colspan":R,loading:$.value,class:"dida-contest-rank-table",pagination:s.value,onPageChange:y},null,8,["data","columns","loading","pagination"])])]),_:1})]),_:1})}}}),Es=re(Ms,[["__scopeId","data-v-838e6c28"]]),qs={style:{margin:"10px"}},Ks={style:{margin:"12px"}},Fs={class:"dida-edit-container"},Ns=se({__name:"ContestEdit",setup(e){let a=we();const{globalProperties:n}=ce(),r=Je(),o=m(""),f=m(!1);let b=null;const w=m(!1),C=m(!1),g=m(null),i=m({title:"",openTime:[],private:!0,password:"",problems:[],members:[],description:"",notification:"",lockRankDuration:0,alwaysLock:!0,submitAnytime:!1}),d=m(""),u=m(""),v=m(!1),P=async()=>{v.value=!0,C.value=!1,v.value=!1},p=async()=>{if(b){w.value=!0;try{const c={title:i.value.title,description:b.getValue(),notification:i.value.notification,lock_rank_duration:i.value.lockRankDuration,always_lock:i.value.alwaysLock,problems:i.value.problems,members:i.value.members,private:i.value.private,password:i.value.password,submit_anytime:i.value.submitAnytime};i.value.openTime[0]&&(c.start_time=new Date(i.value.openTime[0])),i.value.openTime[1]&&(c.end_time=new Date(i.value.openTime[1]));const s=await no(c);if(w.value=!0,s.code!==0){G(n,s.code);return}s.data!=null&&await Z.push({name:"contest-detail",params:{contestId:s.data}}),et(n,"创建成功")}finally{w.value=!1}}},k=async()=>{if(b){w.value=!0;try{const c={id:Number(o.value),title:i.value.title,description:b.getValue(),notification:i.value.notification,lock_rank_duration:i.value.lockRankDuration,always_lock:i.value.alwaysLock,problems:i.value.problems,members:i.value.members,private:i.value.private,password:i.value.password,submit_anytime:i.value.submitAnytime};i.value.openTime[0]&&(c.start_time=new Date(i.value.openTime[0])),i.value.openTime[1]&&(c.end_time=new Date(i.value.openTime[1]));const s=await oo(c);if(w.value=!0,s.code!==0){G(n,s.code);return}s.data!=null&&g.value&&(g.value.updateTime=new Date(s.data).toLocaleString()),et(n,"保存成功")}finally{w.value=!1}}},_=c=>{const s={after:()=>{b==null||b.setValue(c),f.value=!1},preview:{math:{inlineDigit:!0,engine:"KaTeX"}}};b=new me("contestEditDiv",s)},h=async()=>{const c=await Qn(o.value);if(c.code!==0){G(n,c.code),console.error("contest get failed",c.code),await Z.push({name:"contest-list"});return}const s=c.data.contest;g.value=await Ft(s),i.value.title=s.title,i.value.openTime=[],s.start_time?i.value.openTime.push(new Date(s.start_time)):i.value.openTime.push(""),s.end_time?i.value.openTime.push(new Date(s.end_time)):i.value.openTime.push(""),i.value.private=s.private,i.value.password=s.password||"",i.value.description=s.description||"",i.value.notification=s.notification||"",i.value.problems=c.data.problems,i.value.members=c.data.members,s.lock_rank_duration?i.value.lockRankDuration=za(s.lock_rank_duration):i.value.lockRankDuration=0,i.value.alwaysLock=s.always_lock,i.value.submitAnytime=s.submit_anytime,r.setTitle(s.title+" - "+r.getTitle);let T="";s.description&&(T=s.description),_(T)};return ue(async()=>{Array.isArray(a.params.contestId)?o.value=a.params.contestId[0]:o.value=a.params.contestId,o.value?(f.value=!0,await h()):_("")}),(c,s)=>{const T=Re,y=Ue,D=va,z=mt,x=ma,V=$e,$=_e,A=Te,U=B,S=he,j=Ze,R=Ye,O=Se,X=xe,te=St,J=nt;return L(),ee(oe,null,[t(X,{loading:f.value},{default:l(()=>[t(O,null,{default:l(()=>[t(A,{span:8},{default:l(()=>[M("div",qs,[t($,{class:"sh-card"},{default:l(()=>[t(V,{model:i.value,"label-width":"150px"},{default:l(()=>[t(y,{label:"标题"},{default:l(()=>[t(T,{modelValue:i.value.title,"onUpdate:modelValue":s[0]||(s[0]=H=>i.value.title=H),placeholder:"比赛标题"},null,8,["modelValue"])]),_:1}),t(y,{label:"通知"},{default:l(()=>[t(T,{modelValue:i.value.notification,"onUpdate:modelValue":s[1]||(s[1]=H=>i.value.notification=H),placeholder:"会更为醒目地提醒"},null,8,["modelValue"])]),_:1}),t(y,{label:"开启时间"},{default:l(()=>[t(D,{modelValue:i.value.openTime,"onUpdate:modelValue":s[2]||(s[2]=H=>i.value.openTime=H),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(y,{label:"提交限制"},{default:l(()=>[t(z,{modelValue:i.value.submitAnytime,"onUpdate:modelValue":s[3]||(s[3]=H=>i.value.submitAnytime=H)},{label:l(H=>[I(F(H.value?"结束仍能提交":"仅比赛期间提交"),1)]),_:1},8,["modelValue"])]),_:1}),t(y,{label:"锁榜时长"},{default:l(()=>[t(x,{modelValue:i.value.lockRankDuration,"onUpdate:modelValue":s[4]||(s[4]=H=>i.value.lockRankDuration=H),min:0,format:de(rt),"auto-width":""},null,8,["modelValue","format"])]),_:1}),t(y,{label:"自动解锁"},{default:l(()=>[t(z,{modelValue:i.value.alwaysLock,"onUpdate:modelValue":s[5]||(s[5]=H=>i.value.alwaysLock=H)},{label:l(H=>[I(F(H.value?"结束后仍锁榜":"结束后解锁"),1)]),_:1},8,["modelValue"])]),_:1}),t(y,{label:"私有"},{default:l(()=>[t(z,{modelValue:i.value.private,"onUpdate:modelValue":s[6]||(s[6]=H=>i.value.private=H)},null,8,["modelValue"])]),_:1}),i.value.private?(L(),K(y,{key:0,label:"密码"},{default:l(()=>[t(T,{modelValue:i.value.password,"onUpdate:modelValue":s[7]||(s[7]=H=>i.value.password=H),type:"password",placeholder:"请输入访问密码，留空代表关闭密码访问"},null,8,["modelValue"])]),_:1})):ne("",!0),i.value.private?(L(),K(y,{key:1,label:"成员"},{default:l(()=>[t(ja,{modelValue:i.value.members,"onUpdate:modelValue":s[8]||(s[8]=H=>i.value.members=H)},null,8,["modelValue"])]),_:1})):ne("",!0),t(y,{label:"问题"},{default:l(()=>[t(La,{modelValue:i.value.problems,"onUpdate:modelValue":s[9]||(s[9]=H=>i.value.problems=H)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(A,{span:4},{default:l(()=>[M("div",Ks,[M("div",Fs,[o.value?(L(),K(S,{key:0},{default:l(()=>[t(U,{onClick:k,theme:"danger",loading:w.value},{default:l(()=>s[12]||(s[12]=[I("保存")])),_:1},8,["loading"])]),_:1})):(L(),K(S,{key:1},{default:l(()=>[t(U,{onClick:p,theme:"danger",loading:w.value},{default:l(()=>s[13]||(s[13]=[I("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(L(),K(R,{key:0,layout:"vertical",bordered:!0},{default:l(()=>[t(j,{label:"创建时间"},{default:l(()=>{var H;return[I(F((H=g.value)==null?void 0:H.createTime),1)]}),_:1}),t(j,{label:"更新时间"},{default:l(()=>{var H;return[I(F((H=g.value)==null?void 0:H.updateTime),1)]}),_:1}),t(j,{label:"创建用户"},{default:l(()=>{var H;return[I(F((H=g.value)==null?void 0:H.ownerNickname),1)]}),_:1})]),_:1})):ne("",!0)])]),_:1})]),_:1}),s[14]||(s[14]=M("div",{id:"contestEditDiv",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"]),t(J,{visible:C.value,"onUpdate:visible":s[11]||(s[11]=H=>C.value=H),onConfirm:P,header:d.value,"confirm-loading":v.value},{default:l(()=>[s[15]||(s[15]=M("div",{style:{"margin-bottom":"10px"}},[M("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(te,{modelValue:u.value,"onUpdate:modelValue":s[10]||(s[10]=H=>u.value=H),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),na=re(Ns,[["__scopeId","data-v-77e745ac"]]);function $a(e){const a={};return a.id=e.id,a.authorId=e.author_id,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.title=e.title,a.content=e.content,e.insert_time&&(a.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(a.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(a.updateTime=new Date(e.update_time).toLocaleString()),a.problemId=e.problem_id,a.problemTitle=e.problem_title,a.contestId=e.contest_id,a.contestTitle=e.contest_title,a.contestProblemIndex=e.contest_problem_index,a}async function Os(e){const a={};if(a.id=e.id,a.authorId=e.author_id,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.content="",e.content){const n={math:{inlineDigit:!0,engine:"KaTeX"}};a.content=await me.md2html(e.content,n)}return e.insert_time&&(a.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(a.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(a.updateTime=new Date(e.update_time).toLocaleString()),a}function Gs(e){return W({url:"/discuss?id="+e,method:"get"})}function Hs(e,a,n,r,o,f){const b={};return e&&(b.contest_id=e),a&&(b.problem_id=a),n&&(b.title=n),r&&(b.username=r),o&&(b.page=o),f&&(b.page_size=f),W({url:`/discuss/list?${new URLSearchParams(b).toString()}`,method:"get"})}function Bs(e,a,n){return W({url:"/discuss/comment/list?id="+e+"&page="+a+"&page_size="+n,method:"get"})}function Js(e){return W({url:"/discuss/create",method:"post",data:e})}const Ws={style:{margin:"10px"}};function Xs(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const Ys=se({__name:"DiscussList",setup(e){const a=we(),n=Be(),{globalProperties:r}=ce();let o=null;const f=m(!1),b=m(!1);let w=-1;const C=m([]),g=[],i=[{title:"标题",colKey:"title",cell:(V,$)=>t(B,{variant:"text",onClick:()=>s($.row.id)},{default:()=>[$.row.title]})},{title:"创建人",colKey:"authorNickname",width:"200",cell:(V,$)=>t(B,{variant:"text",onClick:async()=>await Nt(n,$.row.authorUsername)},{default:()=>[$.row.authorNickname]})},{title:"创建时间",colKey:"insertTime",width:"180"},{title:"更新时间",colKey:"updateTime",width:"180"}],d=m(!1);let u=1,v=50;const P=m({current:u,pageSize:v,defaultCurrent:u,defaultPageSize:v,total:0,pageSizeOptions:[50,100]}),p=m(),k=m({problemId:"",title:"",username:""}),_=m({title:"",content:""}),h=V=>{V&&n.push({name:"problem-detail",params:{problemId:V}})},c=(V,$)=>{n.push({name:"contest-problem-detail",params:{contestId:V,problemIndex:$}})},s=V=>{if(V){if(w){n.push({name:"contest-discuss-detail",params:{contestId:w,discussId:V}});return}n.push({name:"discuss-detail",params:{discussId:V}})}},T=async()=>{await n.push({query:{...a.query,problem_id:k.value.problemId,title:k.value.title,username:k.value.username,page:1,page_size:P.value.defaultPageSize}})},y=async(V,$)=>{var A;d.value=!0;try{const{current:U,pageSize:S}=V,j=await Hs(w,k.value.problemId,k.value.title,k.value.username,U,S);if(p.value=[],j.code===0){if(!j.data.has_auth){ve(r,"您目前没有权限查看讨论列表"),w?await n.push({name:"contest-detail",params:{contestId:w}}):await n.push({name:"discuss-list"});return}if(j.data.list){const R=j.data.list;for(let O=0;O<R.length;O++){const X=R[O],te=await $a(X);(A=p.value)==null||A.push(te)}}P.value={...P.value,total:j.data.total_count}}else $&&G(r,j.code)}catch(U){console.error(U),G(r,Ae())}finally{d.value=!1}},D=async V=>{await n.push({query:{...a.query,page:V.current,page_size:V.pageSize}})},z=()=>{f.value=!0},x=async()=>{b.value=!0,console.log("discussCreateForm",_.value),Js(_.value).then(V=>{V.code===0?(ve(r,"创建比赛成功"),f.value=!1,n.push({path:"/discuss/"+V.data.id})):G(r,V.code)}).finally(()=>{b.value=!1})};return ue(async()=>{o=ze(()=>a.query,V=>{Array.isArray(a.params.contestId)?w=Number(a.params.contestId[0]):w=Number(a.params.contestId),C.value=g,w?C.value=C.value.concat([{title:"问题ID",colKey:"contestProblemIndex",width:"100",cell:(U,S)=>{let j;return S.row.contestProblemIndex?t(B,{variant:"text",onClick:()=>c(w,S.row.contestProblemIndex)},Xs(j=lt(S.row.contestProblemIndex))?j:{default:()=>[j]}):""}}]):C.value=C.value.concat([{title:"问题ID",colKey:"problemId",width:"100",cell:(U,S)=>S.row.problemId?t(B,{variant:"text",onClick:()=>h(S.row.problemId)},{default:()=>[S.row.problemId]}):""}]),C.value=C.value.concat(i),k.value.problemId=V.problem_id||"",k.value.title=V.title||"",k.value.username=V.username||"";const $=parseInt(V.page)||P.value.defaultCurrent,A=parseInt(V.page_size)||P.value.defaultPageSize;u=$,v=A,P.value={...P.value,current:u,pageSize:v},y({current:u,pageSize:v},!0)},{immediate:!0})}),Ve(()=>{o&&o()}),(V,$)=>{const A=De,U=_e,S=Te,j=Re,R=Ue,O=B,X=$e,te=he,J=Se,H=nt;return L(),ee(oe,null,[t(J,null,{default:l(()=>[t(S,{span:9},{default:l(()=>[t(U,{style:{margin:"10px"}},{default:l(()=>[t(A,{data:p.value,columns:C.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:P.value,loading:d.value,"table-layout":"auto",onPageChange:D},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(S,{span:3},{default:l(()=>[M("div",Ws,[t(U,{class:"sh-card"},{default:l(()=>[t(X,{model:k.value},{default:l(()=>[t(R,{label:"问题ID"},{default:l(()=>[t(j,{modelValue:k.value.problemId,"onUpdate:modelValue":$[0]||($[0]=N=>k.value.problemId=N),placeholder:"请输入完整问题ID"},null,8,["modelValue"])]),_:1}),t(R,{label:"标题"},{default:l(()=>[t(j,{modelValue:k.value.title,"onUpdate:modelValue":$[1]||($[1]=N=>k.value.title=N),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(R,{label:"创建人"},{default:l(()=>[t(j,{modelValue:k.value.username,"onUpdate:modelValue":$[2]||($[2]=N=>k.value.username=N),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(R,null,{default:l(()=>[t(O,{theme:"primary",onClick:T},{default:l(()=>$[6]||($[6]=[I("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(U,{class:"sh-card"},{default:l(()=>[t(te,null,{default:l(()=>[t(O,{onClick:z},{default:l(()=>$[7]||($[7]=[I("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),t(H,{visible:f.value,"onUpdate:visible":$[5]||($[5]=N=>f.value=N),header:"创建讨论",onConfirm:x,"confirm-loading":b.value},{default:l(()=>[t(X,{"label-width":80,model:_.value,onSubmit:$[4]||($[4]=ht(()=>{},["prevent"]))},{default:l(()=>[t(R,{label:"标题"},{default:l(()=>[t(j,{modelValue:_.value.title,"onUpdate:modelValue":$[3]||($[3]=N=>_.value.title=N),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),_t=re(Ys,[["__scopeId","data-v-a2987da9"]]),Zs={key:0,style:{margin:"20px"}},Qs=["innerHTML"],er=["innerHTML"],tr={style:{margin:"10px"}},ar={style:{margin:"10px"}},lr={style:{margin:"10px","text-align":"right"}},nr={style:{margin:"12px"}},or={key:0,class:"dida-edit-container"},sr=se({__name:"DiscussDetail",props:{discussId:{}},setup(e){const a=e;let n=we();const{globalProperties:r}=ce();let o=null;const f=Je(),b=je();let w=m("");const C=m(""),g=m(null),i=m(!1),d=m(null),u=m(!1);let v=1,P=20;const p=m({current:1,total:0,defaultPageSize:P,defaultCurrent:v,pageSizeOptions:[20,50]}),k=m([]),_={},h=He(()=>b.hasAuth(Ke.ManageDiscuss)),c=x=>{x&&Z.push({name:"discuss-list",query:{...n.query,title:"",tag:x.name}})},s=()=>{Z.push({name:"manage-discuss",params:{discussId:C.value}})},T=()=>t("div",{class:"t-pagination__total"},[`共 ${p.value.total} 条回复`]),y=()=>{},D=async(x,V)=>{var $;u.value=!0;try{const{current:A,pageSize:U}=x,S=await Bs(C.value,A,U);if(k.value=[],S.code===0){const j=S.data.list;if(j)for(let R=0;R<j.length;R++){const O=j[R],X=await Os(O);($=k.value)==null||$.push(X),await Ne(()=>{const te=document.querySelectorAll(".dida-discuss-content");te&&te.length>0&&te.forEach(J=>{me.mathRender(J),me.highlightRender({lineNumber:!0,enable:!0},J),Qe(J)})})}p.value={...p.value,total:S.data.total_count}}else V&&G(r,S.code)}catch(A){console.error(A),G(r,Ae())}finally{u.value=!1}},z=async x=>{await Z.push({query:{...n.query,page:x.current,page_size:x.pageSize}})};return ue(async()=>{if(C.value=a.discussId,C.value||(Array.isArray(n.params.discussId)?C.value=n.params.discussId[0]:C.value=n.params.discussId),!C.value){fe(r,"讨论不存在"),await Z.push({name:"discuss"});return}i.value=!0;const x=await Gs(C.value);if(x.code!==0){i.value=!1,G(r,x.code),await Z.push({name:"discuss"});return}x.data.tags&&x.data.tags.forEach(U=>{_[U.id]=U}),d.value=$a(x.data.discuss),f.setTitle(d.value.title+" - "+f.getTitle);let V=d.value.content;const $={math:{inlineDigit:!0,engine:"KaTeX"}};w.value=await me.md2html(V,$),await Ne(()=>{g.value&&(me.mathRender(g.value),me.highlightRender({lineNumber:!0,enable:!0},g.value),Qe(g.value)),i.value=!1}),o=ze(()=>n.query,U=>{const S=parseInt(U.page)||p.value.defaultCurrent,j=parseInt(U.page_size)||p.value.defaultPageSize;v=S,P=j,p.value={...p.value,current:v,pageSize:P},D({current:v,pageSize:P},!0)},{immediate:!0});const A={after:()=>{},preview:{math:{inlineDigit:!0,engine:"KaTeX"}}};new me("commentEditRef",A)}),Ve(()=>{o&&o()}),(x,V)=>{const $=fa,A=pa,U=_e,S=he,j=_l,R=B,O=Te,X=Ze,te=Ye,J=Se,H=xe;return L(),K(H,{loading:i.value},{default:l(()=>[t(J,{class:"dida-main-content"},{default:l(()=>[t(O,{span:8},{default:l(()=>{var N,ye,Pe;return[(N=d.value)!=null&&N.problemTitle||(ye=d.value)!=null&&ye.contestTitle?(L(),ee("div",Zs,[t(A,{"max-item-width":"300"},{default:l(()=>{var q,E,ae,Y,ie;return[(q=d.value)!=null&&q.contestTitle?(L(),ee(oe,{key:0},[t($,{to:{name:"contest-detail",params:{contestId:(E=d.value)==null?void 0:E.contestId}}},{default:l(()=>{var pe;return[I(F((pe=d.value)==null?void 0:pe.contestTitle),1)]}),_:1},8,["to"]),(ae=d.value)!=null&&ae.contestProblemIndex?(L(),K($,{key:0,to:{name:"contest-problem-detail",params:{problemIndex:(Y=d.value)==null?void 0:Y.contestProblemIndex}}},{default:l(()=>{var pe,Ie;return[I(F(de(lt)((pe=d.value)==null?void 0:pe.contestProblemIndex))+" - "+F((Ie=d.value)==null?void 0:Ie.problemTitle),1)]}),_:1},8,["to"])):ne("",!0)],64)):(L(),ee(oe,{key:1},[t($,{to:{name:"discuss-list-problem"}},{default:l(()=>V[3]||(V[3]=[I(" 问题讨论")])),_:1}),t($,{to:{name:"problem-detail",params:{problemId:(ie=d.value)==null?void 0:ie.problemId}}},{default:l(()=>{var pe;return[I(F((pe=d.value)==null?void 0:pe.problemTitle),1)]}),_:1},8,["to"])],64))]}),_:1})])):ne("",!0),t(U,{style:{margin:"10px"},header:(Pe=d.value)==null?void 0:Pe.title,"header-bordered":!0},{default:l(()=>[M("div",{innerHTML:de(w),class:"dida-discuss-content"},null,8,Qs)]),_:1},8,["header"]),(L(!0),ee(oe,null,Ce(k.value,(q,E)=>(L(),K(U,{key:E,style:{margin:"10px"},"header-bordered":""},{header:l(()=>[t(S,null,{default:l(()=>[M("span",null,F(q.authorNickname),1),M("span",null,F(q.insertTime),1)]),_:2},1024)]),default:l(()=>[M("div",{innerHTML:q.content,class:"dida-discuss-content"},null,8,er)]),_:2},1024))),128)),M("div",tr,[t(j,{modelValue:p.value.current,"onUpdate:modelValue":V[0]||(V[0]=q=>p.value.current=q),"page-size":p.value.pageSize,"onUpdate:pageSize":V[1]||(V[1]=q=>p.value.pageSize=q),total:p.value.total,"page-size-options":p.value.pageSizeOptions,"show-page-size":!1,"total-content":T,onChange:z},null,8,["modelValue","page-size","total","page-size-options"])]),M("div",ar,[V[5]||(V[5]=M("div",{id:"commentEditRef",class:"dida-comment-editor"},null,-1)),M("div",lr,[t(S,null,{default:l(()=>[t(R,{theme:"primary",onClick:y},{default:l(()=>V[4]||(V[4]=[I("提交")])),_:1})]),_:1})])])]}),_:1}),t(O,{span:4},{default:l(()=>[M("div",nr,[h.value?(L(),ee("div",or,[t(R,{onClick:s},{default:l(()=>V[6]||(V[6]=[I("编辑")])),_:1})])):ne("",!0),t(te,{layout:"vertical",bordered:!0},{default:l(()=>[t(X,{label:"创建时间"},{default:l(()=>{var N;return[I(F((N=d.value)==null?void 0:N.insertTime),1)]}),_:1}),t(X,{label:"编辑时间"},{default:l(()=>{var N;return[I(F((N=d.value)==null?void 0:N.modifyTime),1)]}),_:1}),t(X,{label:"更新时间"},{default:l(()=>{var N;return[I(F((N=d.value)==null?void 0:N.updateTime),1)]}),_:1}),t(X,{label:"创建用户"},{default:l(()=>[t(R,{variant:"text",onClick:V[2]||(V[2]=async()=>{var N;return await de(Nt)(de(Z),(N=d.value)==null?void 0:N.authorUsername)})},{default:l(()=>{var N;return[I(F((N=d.value)==null?void 0:N.authorNickname),1)]}),_:1})]),_:1}),t(X,{label:"标签"},{default:l(()=>[t(S,null,{default:l(()=>{var N;return[(L(!0),ee(oe,null,Ce((N=d.value)==null?void 0:N.tags,ye=>(L(),K(R,{key:ye.id,variant:"dashed",onClick:()=>c(ye)},{default:l(()=>[I(F(ye.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),xt=re(sr,[["__scopeId","data-v-20308f3c"]]);function rr(e,a){return W({url:"/rank/ac/all?page="+e+"&page_size="+a,method:"get"})}function ir(e,a){return W({url:"/rank/ac/problem?page="+e+"&page_size="+a,method:"get"})}function ur(e,a){return W({url:"/rank/ac/problem/today?page="+e+"&page_size="+a,method:"get"})}function cr(e,a){return W({url:"/rank/ac/problem/day7?page="+e+"&page_size="+a,method:"get"})}function dr(e,a){return W({url:"/rank/ac/problem/day30?page="+e+"&page_size="+a,method:"get"})}function mr(e,a){return W({url:"/rank/ac/problem/year?page="+e+"&page_size="+a,method:"get"})}const pr={style:{margin:"10px"}};function Vt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const fr=se({__name:"RankUser",props:{type:{}},setup(e){const a=we(),n=Be(),{globalProperties:r}=ce();let o=null;const f=e,b=m(""),w=m(""),C={all:{header:"统计所有用户在本站的提交记录",content:"优先以AC记录数量排序，如果相同则提交所用次数较少的优先，如果仍相同，注册较早的用户靠前"},problem:{header:"统计所有用户在本站的提交记录",content:"以题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-today":{header:"统计所有用户今日在本站的提交记录",content:"以今日题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-day7":{header:"统计所有用户最近7日在本站的提交记录",content:"以7日题目记录数量排序（从7日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-day30":{header:"统计所有用户最近30日在本站的提交记录",content:"以30日题目记录数量排序（从30日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-year":{header:"统计所有用户最近1年在本站的提交记录",content:"以最近1年题目记录数量排序（从365日前的0点开始计算），如果相同，注册较早的用户靠前"}},g=m([]),i=[{title:"序号",colKey:"index"},{title:"用户名",colKey:"username",cell:(D,z)=>t(B,{variant:"dashed",onClick:()=>h(z.row.username)},{default:()=>[z.row.username]})},{title:"昵称",colKey:"nickname"},{title:"Slogan",colKey:"slogan"}],d=[{title:"题目数量",colKey:"problem_count",cell:(D,z)=>{let x=0;return z.row.problem_count&&(x=z.row.problem_count),t(B,{variant:"dashed",onClick:()=>c(z.row.username)},Vt(x)?x:{default:()=>[x]})}}],u=[{title:"正确",colKey:"accept",cell:(D,z)=>{let x=0;return z.row.accept&&(x=z.row.accept),t(B,{variant:"dashed",onClick:()=>c(z.row.username)},Vt(x)?x:{default:()=>[x]})}},{title:"提交",colKey:"attempt",cell:(D,z)=>{let x=0;return z.row.attempt&&(x=z.row.attempt),t(B,{variant:"dashed",onClick:()=>s(z.row.username)},Vt(x)?x:{default:()=>[x]})}}],v=m(!1);let P=1,p=50;const k=m({current:P,pageSize:p,defaultCurrent:P,defaultPageSize:p,total:0,pageSizeOptions:[50]}),_=m(),h=D=>{n.push({name:"user",params:{username:D}})},c=D=>{n.push({name:"judge-list",query:{username:D,status:qe.Accept}})},s=D=>{n.push({name:"judge-list",query:{username:D}})},T=async(D,z)=>{v.value=!0;try{_.value=[];const{current:x,pageSize:V}=D;let $=null;switch(f.type){case"problem":$=await ir(x,V);break;case"problem-today":$=await ur(x,V);break;case"problem-day7":$=await cr(x,V);break;case"problem-day30":$=await dr(x,V);break;case"problem-year":$=await mr(x,V);break;default:$=await rr(x,V);break}if($.code===0){const A=$.data.list;if(!A||A.length<=0){k.value={...k.value,total:0},ve(r,"未找到记录");return}_.value=[];const U=k.value.pageSize*(k.value.current-1);let S=1;A.forEach(j=>{var O;const R=j;R.index=U+S++,(O=_.value)==null||O.push(R)}),k.value={...k.value,total:$.data.total_count}}else z&&G(r,$.code)}catch(x){console.error(x),G(r,Ae())}finally{v.value=!1}},y=async D=>{await n.push({query:{...a.query,page:D.current,page_size:D.pageSize}})};return ue(async()=>{v.value=!0,o=ze(()=>a.query,D=>{switch(f.type&&C[f.type]?(b.value=C[f.type].header,w.value=C[f.type].content):(b.value=C.all.header,w.value=C.all.content),f.type){case"all":g.value=i.concat(u);break;default:g.value=i.concat(d);break}const z=parseInt(D.page)||k.value.defaultCurrent,x=parseInt(D.page_size)||k.value.defaultPageSize;P=z,p=x,k.value={...k.value,current:P,pageSize:p},T({current:P,pageSize:p},!0)},{immediate:!0})}),Ve(()=>{o&&o()}),(D,z)=>{const x=De,V=_e,$=Te,A=Se;return L(),K(A,null,{default:l(()=>[t($,{span:9},{default:l(()=>[t(V,{style:{margin:"10px"}},{default:l(()=>[t(x,{data:_.value,columns:g.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:k.value,loading:v.value,"table-layout":"auto",onPageChange:y},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t($,{span:3},{default:l(()=>[M("div",pr,[t(V,{class:"sh-card",header:b.value,"header-bordered":!0},{default:l(()=>[I(F(w.value),1)]),_:1},8,["header"])])]),_:1})]),_:1})}}}),st=re(fr,[["__scopeId","data-v-13682529"]]),vr={style:{display:"flex","align-items":"center"}},_r={style:{color:"#409eff","margin-right":"20px"}},gr={class:"dida-login-footer"},br=se({__name:"UserForget",setup(e){const{globalProperties:a}=ce(),n=je(),r=m(!1),o=m(!1),f=m(!1),b=m("发送验证码");let w=null,C=-1;const g=m(!1),i=m(null),d=m(""),u=m({username:"",emailKey:"",password:"",confirmPassword:""}),P=m({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:T=>new Promise(y=>{const D=setTimeout(()=>{y(u.value.password===T),clearTimeout(D)})}),message:"两次密码不一致"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),p=()=>{ve(a,"重置成功")},k=async T=>{if(!f.value){r.value=!0,o.value=!0;try{const y=await Dn(T,u.value.username);y.code===0?(ve(a,"验证码发送成功"),d.value=y.data,o.value=!1,f.value=!0,w=new Date,b.value="60秒后重发",C=setInterval(()=>{const z=Math.floor((new Date().getTime()-(w==null?void 0:w.getTime()))/1e3);z>60?(b.value="发送验证码",f.value=!1,clearInterval(C)):b.value=`${60-z}秒后重发`},1e3)):G(a,y.code)}catch(y){console.error("Send email key error",y),fe(a,"发送验证码失败")}finally{r.value=!1}}},_=async()=>{var z;if(g.value=!0,f.value||o.value)return;await Ne();const T=document.getElementById("cf-confirm-div");T&&T.remove();const y=document.createElement("div");y.id="cf-confirm-div",y.setAttribute("data-theme","light"),(z=i.value)==null||z.appendChild(y);const D=window;D.turnstile.ready(function(){D.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(x){g.value=!1,await k(x)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},h=m(()=>t(B,{onClick:_,disabled:f.value,loading:o.value,style:"width:120px"},{default:()=>[b.value]})),c=async()=>{r.value=!0;try{const T=await Ln(u.value.username,u.value.password,u.value.emailKey);T.code===0?(ve(a,"密码修改成功"),a.$router.push({name:"login"})):G(a,T.code)}catch(T){console.error("Modify password error",T),fe(a,"修改密码失败")}finally{r.value=!1}},s=async({validateResult:T,firstError:y,e:D})=>{if(!r.value){if(D.preventDefault(),T!==!0){fe(a,y);return}d.value?await c():await _()}};return ue(()=>{if(n.isLogin()){a.$router.push({path:"/user"});return}}),Ve(()=>{}),(T,y)=>{const D=Ut,z=Re,x=Ue,V=da,$=B,A=$e,U=ot,S=_e,j=nt;return L(),ee(oe,null,[t(S,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:l(()=>[t(D,{"max-line":1},{default:l(()=>y[6]||(y[6]=[M("span",null,"如果您未绑定邮箱或忘记用户名，可联系管理员寻求帮助",-1),M("span",null,"管理员邮箱：BoilTask@qq.com",-1)])),_:1}),t(A,{ref:"form",rules:P.value,data:u.value,colon:!0,onReset:p,onSubmit:s,class:"yj-login-form"},{default:l(()=>[t(x,{name:"username",label:"用户名"},{default:l(()=>[t(z,{modelValue:u.value.username,"onUpdate:modelValue":y[0]||(y[0]=R=>u.value.username=R),clearable:"",placeholder:"请输入完整用户名"},null,8,["modelValue"])]),_:1}),d.value?(L(),ee(oe,{key:0},[t(x,{name:"email",label:"发送邮箱"},{default:l(()=>[t(V,{append:h.value},{default:l(()=>[M("div",vr,[M("span",_r,F(d.value),1)])]),_:1},8,["append"])]),_:1}),t(x,{name:"emailKey",label:"验证码"},{default:l(()=>[t(z,{modelValue:u.value.emailKey,"onUpdate:modelValue":y[1]||(y[1]=R=>u.value.emailKey=R),clearable:"",placeholder:"请输入收到的验证码"},null,8,["modelValue"])]),_:1}),t(x,{name:"password",label:"新密码"},{default:l(()=>[t(z,{modelValue:u.value.password,"onUpdate:modelValue":y[2]||(y[2]=R=>u.value.password=R),type:"password",clearable:"",placeholder:"新密码"},null,8,["modelValue"])]),_:1}),t(x,{name:"confirmPassword",label:"确认密码"},{default:l(()=>[t(z,{modelValue:u.value.confirmPassword,"onUpdate:modelValue":y[3]||(y[3]=R=>u.value.confirmPassword=R),type:"password",clearable:"",placeholder:"请重复输入密码"},null,8,["modelValue"])]),_:1})],64)):ne("",!0),d.value?(L(),K(x,{key:1},{default:l(()=>[t($,{theme:"primary",type:"submit",block:"",loading:r.value},{default:l(()=>y[7]||(y[7]=[I("修改密码")])),_:1},8,["loading"])]),_:1})):(L(),K(x,{key:2},{default:l(()=>[t($,{theme:"primary",type:"submit",block:"",loading:r.value},{default:l(()=>y[8]||(y[8]=[I("重置密码")])),_:1},8,["loading"])]),_:1}))]),_:1},8,["rules","data"]),M("div",gr,[t(U,{onClick:y[4]||(y[4]=()=>{de(a).$router.push({name:"login"})})},{default:l(()=>y[9]||(y[9]=[I("返回登陆 ")])),_:1})])]),_:1}),t(j,{visible:g.value,"onUpdate:visible":y[5]||(y[5]=R=>g.value=R),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:l(()=>[M("div",{ref_key:"dialogContainer",ref:i,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),hr=re(br,[["__scopeId","data-v-d3cb1db8"]]),yr={class:"judger-status-panel"},wr={class:"judger-status-panel"};function kr(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const Cr=se({__name:"SystemStatus",setup(e){const{globalProperties:a}=ce(),n=m([]),r=m([]),o=m(!1);let f;const b=g=>{let i="失效",d="danger";const u=new Date,v=new Date(g.updateTime);return u.getTime()-v.getTime()>3e4?(i="离线",d="default"):g.cpuUsage>90?(i="CPU过高",d="warning"):g.memPercent>90?(i="内存过高",d="warning"):(i="在线",d="success"),t(he,null,{default:()=>[t("span",null,[g.key,I(" - "),g.name]),t("span",null,[g.updateTime]),t(at,{theme:d,size:"small"},kr(i)?i:{default:()=>[i]})]})},w=async()=>{const g={};for(let h=0;h<n.value.length;h++){const c=n.value[h];g[c.key]={...c}}const i={};for(let h=0;h<r.value.length;h++){const c=r.value[h];i[c.key]={...c}}const d=[],u=[],v=await Al();if(v.code!==0){G(a,v.code);return}const P=v.data.web,p={key:"didaoj"};P.name?p.name=P.name:p.name="-",P.update_time?p.updateTime=new Date(P.update_time).toLocaleString():p.updateTime="-",P.cpu_usage?p.cpuUsage=Number(P.cpu_usage):p.cpuUsage=0,P.mem_usage?p.memUsage=P.mem_usage/(1024*1024*1024):p.memUsage=0,P.mem_total?p.memTotal=P.mem_total/(1024*1024*1024):p.memTotal=0,p.memTotal>0?p.memPercent=Math.round(p.memUsage/p.memTotal*1e4)/100:p.memPercent=0,p.avgMessage=P.avg_message;const k=g[p.key];k?(p.cpuUsageFrom=k.cpuUsage,p.memPercentFrom=k.memPercent,p.memUsageFrom=k.memUsage,p.memTotalFrom=k.memTotal):(p.cpuUsageFrom=0,p.memPercentFrom=0,p.memUsageFrom=0,p.memTotalFrom=0),d.push(p),n.value=d;const _=v.data.judger;for(let h=0;h<_.length;h++){const c=_[h],s={key:c.key,name:c.name};c.name?s.name=c.name:s.name="-",c.update_time?s.updateTime=new Date(c.update_time).toLocaleString():s.updateTime="-",c.cpu_usage?s.cpuUsage=Number(c.cpu_usage):s.cpuUsage=0,c.mem_usage?s.memUsage=c.mem_usage/(1024*1024*1024):s.memUsage=0,c.mem_total?s.memTotal=c.mem_total/(1024*1024*1024):s.memTotal=0,s.memTotal>0?s.memPercent=Math.round(s.memUsage/s.memTotal*1e4)/100:s.memPercent=0,s.avgMessage=c.avg_message,i[c.key]?(s.cpuUsageFrom=i[c.key].cpuUsage,s.memPercentFrom=i[c.key].memPercent,s.memUsageFrom=i[c.key].memUsage,s.memTotalFrom=i[c.key].memTotal):(s.cpuUsageFrom=0,s.memPercentFrom=0,s.memUsageFrom=0,s.memTotalFrom=0),u.push(s)}r.value=u},C=async()=>{await w(),o.value=!1};return ue(async()=>{r.value=[],n.value=[],o.value=!0,await C(),f=setInterval(()=>{C()},5e3)}),Ve(()=>{clearInterval(f)}),(g,i)=>{const d=gl,u=he,v=_e,P=xe;return L(),K(P,{loading:o.value},{default:l(()=>[t(v,{title:"接口状态",class:"judger-status"},{default:l(()=>[M("div",yr,[(L(!0),ee(oe,null,Ce(n.value,p=>(L(),K(v,{key:p.key,header:()=>b(p),class:"judge-status-judger"},{footer:l(()=>[M("span",null," 负载信息："+F(p.avgMessage),1)]),default:l(()=>[t(u,{class:"judge-status-judger"},{default:l(()=>[t(d,{title:"CPU使用率",value:p.cpuUsage,animation:{valueFrom:p.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(d,{title:"内存使用率",value:p.memPercent,animation:{valueFrom:p.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(d,{title:"内存使用量",animation:{valueFrom:p.memUsageFrom,duration:2e3},"animation-start":!0,value:p.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(d,{title:"内存总量",value:p.memTotal,animation:{valueFrom:p.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1}),t(v,{title:"判题机状态",class:"judger-status"},{default:l(()=>[M("div",wr,[(L(!0),ee(oe,null,Ce(r.value,p=>(L(),K(v,{key:p.key,header:()=>b(p),class:"judge-status-judger"},{footer:l(()=>[M("span",null," 负载信息："+F(p.avgMessage),1)]),default:l(()=>[t(u,{class:"judge-status-judger"},{default:l(()=>[t(d,{title:"CPU使用率",value:p.cpuUsage,animation:{valueFrom:p.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(d,{title:"内存使用率",value:p.memPercent,animation:{valueFrom:p.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(d,{title:"内存使用量",animation:{valueFrom:p.memUsageFrom,duration:2e3},"animation-start":!0,value:p.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(d,{title:"内存总量",value:p.memTotal,animation:{valueFrom:p.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1})]),_:1},8,["loading"])}}}),Sr=re(Cr,[["__scopeId","data-v-d2b0a05b"]]),Ir=se({__name:"ManageJudge",setup(e){const{globalProperties:a}=ce(),n=m(!1),r=m(!1),o=m({problemId:"",language:void 0,status:void 0}),f=m(!1),b=m([]);b.value=Et();const w=m([]);w.value=Ca();const C=async()=>{n.value=!0;try{const d=await Xl();if(d.code!==0){G(a,d.code);return}ve(a,"重判成功"),await Z.push({name:"judge-list"})}catch(d){console.error(d),G(a,"重判失败")}finally{n.value=!1}},g=async()=>{if(!o.value.problemId&&!o.value.language&&!o.value.status){G(a,"请输入问题Id");return}f.value=!0;try{const d=await Yl(o.value.problemId,o.value.language,o.value.status);if(d.code!==0){G(a,d.code);return}ve(a,"重判成功"),await Z.push({name:"judge-list",query:{problem_id:o.value.problemId,language:o.value.language}})}catch(d){console.error(d),G(a,"重判失败")}finally{f.value=!1}},i=async()=>{r.value=!0;try{const d=await Zl();if(d.code!==0){G(a,d.code);return}ve(a,"重判成功"),await Z.push({name:"judge-list"})}catch(d){console.error(d),G(a,"重判失败")}finally{r.value=!1}};return(d,u)=>{const v=B,P=_e,p=Re,k=Ue,_=Rt,h=ut,c=he,s=$e;return L(),ee(oe,null,[t(P,{class:"yj-manage-card",title:"重判最近提交"},{default:l(()=>[t(v,{onClick:C,loading:n.value},{default:l(()=>u[3]||(u[3]=[I("重判")])),_:1},8,["loading"])]),_:1}),t(P,{class:"yj-manage-card",title:"重判指定记录"},{default:l(()=>[t(s,{layout:"inline",onSubmit:g},{default:l(()=>[t(k,{label:"题号"},{default:l(()=>[t(p,{modelValue:o.value.problemId,"onUpdate:modelValue":u[0]||(u[0]=T=>o.value.problemId=T),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(k,{label:"语言"},{default:l(()=>[t(h,{modelValue:o.value.language,"onUpdate:modelValue":u[1]||(u[1]=T=>o.value.language=T),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:l(()=>[(L(!0),ee(oe,null,Ce(b.value,T=>(L(),K(_,{key:T.value,value:T.value,label:T.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(k,{label:"状态"},{default:l(()=>[t(h,{modelValue:o.value.status,"onUpdate:modelValue":u[2]||(u[2]=T=>o.value.status=T),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:l(()=>[(L(!0),ee(oe,null,Ce(w.value,T=>(L(),K(_,{key:T.value,value:T.value,label:T.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(k,null,{default:l(()=>[t(c,null,{default:l(()=>[t(v,{theme:"primary",type:"submit",loading:f.value},{default:l(()=>u[4]||(u[4]=[I("重判")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(P,{class:"yj-manage-card",title:"重判所有"},{default:l(()=>[t(v,{onClick:i,theme:"danger",loading:r.value},{default:l(()=>u[5]||(u[5]=[I("重判")])),_:1},8,["loading"])]),_:1})],64)}}}),Pr=re(Ir,[["__scopeId","data-v-6d48cbf2"]]),Tr=se({__name:"ManageWeb",setup(e){const{globalProperties:a}=ce(),n=m({theme:"",content:""}),r=m({title:"",content:""}),o=m(!1),f=m(!1),b=m(!1);let w=null;const C=async()=>{f.value=!0;try{const u=await Ml(n.value.theme,n.value.content);if(u.code!==0){G(a,u.code);return}ve(a,"保存成功")}catch(u){console.error(u),G(a,"保存失败")}finally{f.value=!1}},g=async()=>{b.value=!0;try{if(!w){G(a,"编辑器未初始化");return}const u=w.getValue(),v=await El(r.value.title,u);if(v.code!==0){G(a,v.code);return}w.setValue(v.data.content),ve(a,"保存成功")}catch(u){console.error(u),fe(a,"保存失败")}finally{b.value=!1}},i=async()=>{n.value=await ba()},d=async()=>{try{r.value=await ha()}catch{fe(a,"加载公告失败"),r.value={title:"",content:""}}const u={after:()=>{w==null||w.setValue(r.value.content)},upload:{accept:"image/*,.mp3, .wav, .rar",filename(v){return v.replace(/[^(a-zA-Z0-9\u4e00-\u9fa5\.)]/g,"").replace(/[\?\\/:|<>\*\[\]\(\)\$%\{\}@~]/g,"").replace("/\\s/g","")},async handler(v){return io(w,v,a,Rl)}},preview:{math:{inlineDigit:!0,engine:"KaTeX"}}};w=new me("problemEditDiv",u)};return ue(async()=>{o.value=!0;try{await i(),await d()}catch{fe(a,"加载数据失败")}o.value=!1}),(u,v)=>{const P=ut,p=Ue,k=Re,_=B,h=he,c=$e,s=_e,T=xe;return L(),K(T,{loading:o.value},{default:l(()=>[t(s,{class:"yj-manage-card",title:"站点通知"},{default:l(()=>[t(c,{onSubmit:C},{default:l(()=>[t(p,{label:"主题"},{default:l(()=>[t(P,{modelValue:n.value.theme,"onUpdate:modelValue":v[0]||(v[0]=y=>n.value.theme=y),options:[{label:"success",value:"success"},{label:"info",value:"info"},{label:"warning",value:"warning"},{label:"error",value:"error"}],placeholder:"请选择主题"},null,8,["modelValue"])]),_:1}),t(p,{label:"内容"},{default:l(()=>[t(k,{modelValue:n.value.content,"onUpdate:modelValue":v[1]||(v[1]=y=>n.value.content=y),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),t(p,null,{default:l(()=>[t(h,null,{default:l(()=>[t(_,{theme:"primary",type:"submit",loading:f.value},{default:l(()=>v[3]||(v[3]=[I("保存")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(s,{class:"yj-manage-card",title:"首页公告"},{actions:l(()=>[t(_,{theme:"primary",loading:b.value,onClick:g},{default:l(()=>v[4]||(v[4]=[I("保存")])),_:1},8,["loading"])]),default:l(()=>[t(c,{onSubmit:g},{default:l(()=>[t(p,{label:"标题"},{default:l(()=>[t(k,{modelValue:r.value.title,"onUpdate:modelValue":v[2]||(v[2]=y=>r.value.title=y),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1}),v[5]||(v[5]=M("div",{id:"problemEditDiv",class:"dida-description-editor"},null,-1))]),_:1})]),_:1},8,["loading"])}}}),xr=re(Tr,[["__scopeId","data-v-c0322fca"]]),Ua=[{name:"problem-list",tab:"problem",sidebar:"problem-list",path:"",title:"问题列表",icon:"list",component:Yn},{name:"problem-detail",tab:"problem",sidebar:"problem-list",path:":problemId+",title:"问题详情",icon:"list",component:Tt},{name:"problem-daily-list",tab:"problem",sidebar:"problem-daily-list",path:"daily",title:"每日一题",icon:"list",component:xo},{name:"problem-daily-detail",tab:"problem",sidebar:"problem-daily-list",path:"daily/:dailyId+",title:"问题详情",icon:"list",component:Tt},{name:"problem-recommend",tab:"problem",sidebar:"problem-recommend",path:"recommend/:problemId*",title:"问题推荐",icon:"cpu",needLogin:!0,component:jo},{name:"problem-collection-list",tab:"problem",sidebar:"problem-collection-list",path:"collection",title:"题目集合",icon:"list",disableTabPath:!0,component:Qo},{name:"collection-detail",tab:"collection-detail-tab",sidebar:"collection-detail",path:":collectionId+",title:"题集详情",icon:"cpu",component:os},{name:"collection-rank",tab:"collection-detail-tab",sidebar:"collection-rank",path:":collectionId+/rank",title:"题集排名",icon:"list",component:ss},{name:"collection-edit",tab:"collection-detail-tab",sidebar:"collection-edit",disableSidebar:!0,needLogin:!0,path:":collectionId+/edit",title:"题集编辑",icon:"list",component:Yt},{name:"collection-create",tab:"collection-detail-tab",sidebar:"collection-create",needLogin:!0,disableSidebar:!0,path:"create",title:"新建题集",icon:"list",component:Yt},{name:"judge-list",tab:"judge",sidebar:"judge-list",path:"",title:"评测列表",icon:"list",component:Qt},{name:"judge-detail",tab:"judge",sidebar:"judge-list",path:":judgeId+",title:"评测详情",icon:"cpu",component:ta},{name:"contest-list",tab:"contest",sidebar:"contest-list",path:"",title:"比赛列表",icon:"list",component:aa},{name:"contest-recent",tab:"contest",sidebar:"contest-recent",path:"recent",title:"近期比赛",icon:"list",component:aa},{name:"contest-create",tab:"contest",sidebar:"contest-create",disableSidebar:!0,needLogin:!0,path:"create",title:"新建比赛",icon:"list",component:na},{name:"contest-edit",tab:"contest-detail-tab",sidebar:"contest-edit",disableSidebar:!0,needLogin:!0,path:":contestId+/edit",title:"比赛编辑",icon:"list",component:na},{name:"contest-detail",tab:"contest-detail-tab",sidebar:"contest-detail",path:":contestId+",title:"比赛详情",icon:"cpu",component:zs},{name:"contest-problem-detail",tab:"contest-detail-tab",sidebar:"contest-problem-detail",path:":contestId+/problem/:problemIndex+",title:"问题详情",icon:"cpu",disableSidebar:!0,component:Tt},{name:"contest-judge",tab:"contest-detail-tab",sidebar:"contest-judge",path:":contestId+/judge",title:"评测列表",icon:"list",component:Qt},{name:"contest-judge-detail",tab:"contest-detail-tab",sidebar:"contest-judge-detail",path:":contestId+/judge/:judgeId+",title:"评测详情",icon:"cpu",component:ta,disableSidebar:!0},{name:"contest-rank",tab:"contest-detail-tab",sidebar:"contest-rank",path:":contestId+/rank",title:"比赛排名",icon:"list",component:Es},{name:"contest-discuss",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss",title:"比赛讨论",icon:"list",component:_t},{name:"contest-discuss-detail",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss/:discussId+",title:"讨论详情",icon:"list",component:xt},{name:"discuss-list",tab:"discuss",sidebar:"discuss-list",path:"",title:"讨论列表",icon:"list",component:_t},{name:"discuss-list-problem",tab:"discuss",sidebar:"discuss-list-problem",path:"problem",title:"问题讨论",icon:"list",component:_t},{name:"discuss-list-judge",tab:"discuss",sidebar:"discuss-list-judge",path:"judge",title:"评测讨论",icon:"list",component:_t},{name:"discuss-detail",tab:"discuss",sidebar:"discuss-list",path:":discussId+",title:"讨论详情",icon:"list",component:xt},{name:"rank-ac-all",tab:"rank",sidebar:"rank-ac-all",path:"ac",title:"AC排名",icon:"base-station",props:{type:"all"},component:st},{name:"rank-ac-problem",tab:"rank",sidebar:"rank-ac-problem",path:"ac/problem",title:"题量排名",icon:"base-station",props:{type:"problem"},component:st},{name:"rank-ac-problem-today",tab:"rank",sidebar:"rank-ac-problem-today",path:"ac/problem/today",title:"今日题量",icon:"base-station",props:{type:"problem-today"},component:st},{name:"rank-ac-problem-day7",tab:"rank",sidebar:"rank-ac-problem-day7",path:"ac/problem/day7",title:"7日题量",icon:"base-station",props:{type:"problem-day7"},component:st},{name:"rank-ac-problem-day30",tab:"rank",sidebar:"rank-ac-problem-day30",path:"ac/problem/day30",title:"30日题量",icon:"base-station",props:{type:"problem-day30"},component:st},{name:"rank-ac-problem-year",tab:"rank",sidebar:"rank-ac-problem-year",path:"ac/problem/year",title:"1年题量",icon:"base-station",props:{type:"problem-year"},component:st},{name:"system-status",tab:"system",sidebar:"system-status",path:"",title:"运行状态",icon:"base-station",component:Sr},{name:"system-about",tab:"system",sidebar:"system-about",path:"about",title:"关于",icon:"base-station",props:{discussId:"52"},component:xt},{name:"manage-problem-create",tab:"manage",sidebar:"manage-problem-create",disableSidebar:!0,path:"problem",title:"新建问题",icon:"list",component:Xt,auths:[Ke.ManageProblem]},{name:"manage-problem",tab:"manage",sidebar:"manage-problem",disableSidebar:!0,path:"problem/:problemId+",title:"问题编辑",icon:"list",component:Xt,auths:[Ke.ManageProblem]},{name:"manage-problem-judge",tab:"manage",sidebar:"manage-problem-judge",disableSidebar:!0,path:"problem/:problemId+/judge",title:"评测数据",icon:"list",component:Fo,auths:[Ke.ManageProblem]},{name:"manage-web",tab:"manage",path:"web",sidebar:"manage-web",title:"站点管理",icon:"list",auths:[Ke.ManageWeb],component:xr},{name:"manage-judge",tab:"manage",path:"judge",sidebar:"manage-judge",title:"评测管理",icon:"list",auths:["i-manage-judge"],component:Pr},{name:"login-forget",tab:"login",path:"forget",title:"忘记密码",component:hr}],oa=(e,a,n,r)=>{r.tab==n&&(r.disableSidebar&&a!=r.sidebar||r.sidebar==null||r.sidebar!=r.name||e.push({name:r.name,title:r.title,icon:r.icon,to:{name:r.name}}))},Vr=(e,a)=>{const n=[];return Ua.forEach(r=>{if(Va(r)){const o=[];r.children.forEach(f=>{oa(o,e,a,f)}),o.length>0&&n.push({title:r.title,children:o})}else oa(n,e,a,r)}),n},sa=(e,a)=>{const n=Nn(a.tab),r={name:a.name,path:"/"+a.path,meta:{title:a.title+" - "+n.title,tab:a.tab,sidebar:a.sidebar,showSidebar:n.showSidebar,needLogin:n.needLogin||a.needLogin,tabAuths:n.auths,auths:a.auths},props:a.props,component:a.component};!n.disablePath&&!a.disableTabPath&&(r.path=n.path+r.path),e.push(r)},Dr=e=>{Ua.forEach(a=>{Va(a)?a.children.forEach(n=>{sa(e,n)}):sa(e,a)})},Lr={class:"sh-main"},jr=se({__name:"View403",setup(e){let a=we();const n=m("");return ue(()=>{a.query.target?n.value=a.query.target:n.value=a.fullPath}),(r,o)=>{const f=B;return L(),ee("div",Lr,[M("p",null,F(n.value),1),o[2]||(o[2]=M("p",null,"该页面无访问权限，请更换访问目标或重新登陆后再试",-1)),t(f,{theme:"primary",onClick:o[0]||(o[0]=()=>r.$router.push("/"))},{default:l(()=>o[1]||(o[1]=[I("返回首页")])),_:1})])}}}),Aa=re(jr,[["__scopeId","data-v-777362b3"]]),ft=[];Gn(ft);Dr(ft);ft.push({path:"/403",name:"403",component:Aa});ft.push({path:"/:pathMatch(.*)*",name:"404",component:xa});const Z=Wa({history:Xa("/"),routes:ft});Z.beforeEach((e,a,n)=>{if(e.name==null||!Z.hasRoute(e.name)){n({name:"home"});return}const r=e.matched[e.matched.length-1].meta;if(r.redirect){n({name:r.redirect});return}if(r.needLogin){const f=je();if(f.getToken==null||f.getToken==""){n({name:"login",query:{redirect_uri:e.fullPath}});return}}const o=r.tabAuths;if(o&&!je().hasAllAuths(o)){n({name:"403",query:{target:e.fullPath}});return}n()});Z.afterEach((e,a)=>{if(e.name===a.name)return;const n=It(),r=Je();let o=null;if(e.matched.length>0&&(o=e.matched[e.matched.length-1].meta),o!=null&&o.title&&r.setTitle(o==null?void 0:o.title),o!=null&&o.showSidebar){n.setSidebarShow(!0);const f=Vr(o==null?void 0:o.sidebar,o==null?void 0:o.tab);n.setMenuList(f),n.setMenuActiveName(o==null?void 0:o.sidebar)}else n.setSidebarShow(!1);window.scrollTo(0,0)});const Ra=dt("login",{state:()=>({Loaded:!1}),getters:{isLoaded(){return this.Loaded}}}),zr=se({__name:"HeaderContent",setup(e){const a=Ra(),n=je(),{globalProperties:r}=ce(),o=m(a.isLoaded),f=m(!1),b=m(n.getUsername),w=m(n.getNickname),C=m(),g=()=>{C.value=On(n)};a.$subscribe((u,v)=>{o.value=v.Loaded}),n.$subscribe((u,v)=>{b.value=v.username,w.value=v.nickname,f.value=v.token!="",g()});const i=()=>{r.$router.currentRoute.value.name!=="login"&&r.$router.push({name:"login",query:{redirect_uri:r.$router.currentRoute.value.fullPath}})},d=()=>{n.clear(),r.$message.success({duration:3e3,content:"注销成功"}),r.$router.push({path:"/login",query:{redirect_uri:r.$router.currentRoute.value.fullPath}})};return ue(()=>{g()}),(u,v)=>{const P=ca("router-link"),p=ga,k=_a,_=bl,h=hl;return L(),K(h,{modelValue:u.$route.meta.tab,"onUpdate:modelValue":v[0]||(v[0]=c=>u.$route.meta.tab=c),class:"sh-menu","expand-type":"popup"},{logo:l(()=>[t(P,{to:"/",class:"sh-logo"},{default:l(()=>v[1]||(v[1]=[I("DidaOJ")])),_:1})]),operations:l(()=>[o.value&&f.value?(L(),K(_,{key:0,title:w.value},{icon:l(()=>[t(p,{name:"user"})]),default:l(()=>[t(k,{value:"user",to:{path:"/user/"+b.value}},{default:l(()=>v[2]||(v[2]=[I("个人空间")])),_:1},8,["to"]),t(k,{value:"user_logout",onClick:d},{default:l(()=>v[3]||(v[3]=[I(" 注销")])),_:1})]),_:1},8,["title"])):o.value?(L(),K(k,{key:2,value:"login",onClick:i},{icon:l(()=>[t(p,{name:"login"})]),default:l(()=>[v[5]||(v[5]=I(" 登录 "))]),_:1})):(L(),K(k,{key:1,value:"login"},{icon:l(()=>[t(p,{name:"login"})]),default:l(()=>[v[4]||(v[4]=I(" ... "))]),_:1}))]),default:l(()=>[(L(!0),ee(oe,null,Ce(C.value,c=>(L(),K(k,{key:c.name,value:c.name,to:{name:c.name}},{icon:l(()=>[c.icon?(L(),K(p,{key:0,name:c.icon},null,8,["name"])):ne("",!0)]),default:l(()=>[I(" "+F(c.title),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])}}}),$r=re(zr,[["__scopeId","data-v-95e7494b"]]),Ur={id:"menu-container"},Ar=se({__name:"SidebarContent",setup(e){const a=It(),n=m(!1),r=m(null),o=m(a.menuActiveName),f=m(a.menuList),b=m([]),w=m(!1),C=()=>{o.value=a.menuActiveName;const i=JSON.stringify(f.value),d=JSON.stringify(a.menuList);i!==d&&(b.value.push([...a.menuList]),g())},g=async()=>{if(b.value.length>0&&!w.value){for(w.value=!0;b.value.length>1;)b.value.shift();const i=b.value.shift();n.value=i.length<=0,f.value=[],await Ne(),r.value&&r.value.updateActiveName(),await new Promise(u=>setTimeout(u,300)),f.value=i,await Ne(),r.value&&r.value.updateActiveName();const d=300;await new Promise(u=>setTimeout(u,d)),w.value=!1,await g()}};return a.$subscribe((i,d)=>{C()}),ue(()=>{C()}),(i,d)=>{const u=ga,v=_a,P=wl,p=yl,k=xe;return L(),ee(oe,null,[M("div",Ur,[t(p,{modelValue:o.value,"onUpdate:modelValue":d[0]||(d[0]=_=>o.value=_),theme:"light",class:"sh-menu-container"},{default:l(()=>[t(Ya,{name:"move-left"},{default:l(()=>[(L(!0),ee(oe,null,Ce(f.value,(_,h)=>(L(),ee(oe,{key:h},[de(Hn)(_)?(L(),K(P,{key:0,title:_.title},{default:l(()=>[(L(!0),ee(oe,null,Ce(_.children,(c,s)=>(L(),K(v,{key:c.name,value:c.name,to:c.to},Ht({default:l(()=>[I(" "+F(c.title),1)]),_:2},[c.icon?{name:"icon",fn:l(()=>[t(u,{name:c.icon,class:jt(c.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))),128))]),_:2},1032,["title"])):(L(),K(v,{key:_.name,value:_.name,to:_.to},Ht({default:l(()=>[I(" "+F(_.title),1)]),_:2},[_.icon?{name:"icon",fn:l(()=>[t(u,{name:_.icon,class:jt(_.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),t(k,{size:"small",loading:n.value,"show-overlay":!0,attach:"#menu-container",class:"sh-sidebar-loading",style:{"align-items":"flex-start","padding-top":"100px"}},null,8,["loading"])],64)}}}),Rr=re(Ar,[["__scopeId","data-v-96e2d89f"]]),Mr={};function Er(e,a){return null}const qr=re(Mr,[["render",Er]]),Kr={class:"footer"},Fr={class:"footer-left"},Nr={class:"foot-time"},Or={class:"footer-center"},Gr={href:"https://beiancx.miit.gov.cn/",target:"_blank"},Hr={class:"footer-right"},Br={class:"foot-text"},Jr={href:"https://github.com/hpu-developer/DiDaOJ-web",target:"_blank"},Wr={class:"foot-text"},Xr={href:"https://github.com/hpu-developer/DiDaOJ-go",target:"_blank"},Yr=se({__name:"FooterContent",setup(e){const a=m("");function n(){a.value=new Date().toLocaleString()}return ue(()=>{n(),setInterval(()=>{n()},1e3)}),(r,o)=>{const f=B;return L(),ee("div",Kr,[M("div",Fr,[M("p",Nr,F(a.value),1)]),M("div",Or,[M("a",Gr,[t(f,{theme:"default",variant:"outline",ghost:!0},{default:l(()=>o[0]||(o[0]=[I("豫ICP备15024677号-4")])),_:1})])]),M("div",Hr,[M("p",Br,[M("a",Jr,[t(f,{theme:"default",variant:"outline",ghost:!0},{default:l(()=>o[1]||(o[1]=[I("@didaoj-web")])),_:1})])]),M("p",Wr,[M("a",Xr,[t(f,{theme:"default",variant:"outline",ghost:!0},{default:l(()=>o[2]||(o[2]=[I("@didaoj-go")])),_:1})])])])])}}}),Zr=re(Yr,[["__scopeId","data-v-44f2e4e7"]]),gt=20,Dt=100,Lt=50,Qr=se({__name:"ForceHiddenSidebarButton",setup(e){let a=It();const n=m({x:window.innerWidth-Dt-gt,y:window.innerHeight-Lt-gt}),r=m(window.innerWidth),o=m(window.innerHeight);let f=!1,b={x:0,y:0};const w=_=>{f=!0;const h=_.clientX??_.touches[0].clientX,c=_.clientY??_.touches[0].clientY;b={x:h-n.value.x,y:c-n.value.y},document.addEventListener("mousemove",C),document.addEventListener("touchmove",C),document.addEventListener("mouseup",g),document.addEventListener("touchend",g)},C=_=>{if(!f)return;const h=_.clientX??_.touches[0].clientX,c=_.clientY??_.touches[0].clientY;let s=h-b.x,T=c-b.y;s=Math.max(0,Math.min(s,r.value-Dt)),T=Math.max(0,Math.min(T,o.value-Lt)),n.value={x:s,y:T}},g=()=>{f=!1,document.removeEventListener("mousemove",C),document.removeEventListener("touchmove",C),document.removeEventListener("mouseup",g),document.removeEventListener("touchend",g)},i=()=>{r.value=window.innerWidth,o.value=window.innerHeight,n.value={x:Math.min(n.value.x,r.value-Dt-gt),y:Math.min(n.value.y,o.value-Lt-gt)}};let d=m(a.forceHiddenSidebar),u=m(a.forceHiddenSidebar);const v=()=>{d.value=!d.value,a.setForceHiddenSidebar(d.value)},P=()=>{u.value||(u.value=!0,a.setForceHiddenSidebar(d.value))},p=()=>{u.value&&(u.value=!1,a.setForceHiddenSidebar(!1))},k=_=>{_>=800?p():P()};return k(r.value),ze(r,_=>{k(_)}),ue(()=>{window.addEventListener("resize",i)}),Ve(()=>{window.removeEventListener("resize",i)}),(_,h)=>{const c=B;return de(u)?(L(),K(c,{key:0,class:"draggable-button",style:ia({top:`${n.value.y}px`,left:`${n.value.x}px`}),onMousedown:w,onTouchstart:w,variant:"dashed",theme:"primary",onClick:v},{default:l(()=>[I(F(de(d)?"显示":"隐藏"),1)]),_:1},8,["style"])):ne("",!0)}}}),ei=re(Qr,[["__scopeId","data-v-1aee5506"]]),bt="DidaOJ",ti=se({__name:"App",setup(e){const{globalProperties:a}=ce(),n=Ra(),r=je(),o=Je(),f=It();n.$patch({Loaded:!1});const b=r.getToken,w=m(!1),C=m(!1);o.title&&o.title.length>0?document.title=o.title+" - "+bt:document.title=bt,o.$subscribe((u,v)=>{v.title&&v.title.length>0?document.title=v.title+" - "+bt:document.title=bt}),f.$subscribe((u,v)=>{w.value=v.showSidebar,C.value=w.value&&!v.forceHiddenSidebar});const g=we(),i=He(()=>{const u=g.meta.auths;return u?!r.hasAllAuths(u):!1});function d(){a.$message.warning({duration:3e3,content:"登陆状态失效"}),n.$patch({Loaded:!0}),r.clear()}return ue(()=>{document.addEventListener("DOMContentLoaded",()=>{Za.autoSpacingPage()}),b?Cn().then(u=>{u.code==0?(r.loadResponse(u.data),n.$patch({Loaded:!0})):(G(a,u.code),n.$patch({Loaded:!0}),r.clear())}).catch(u=>{console.log(u),d()}):n.$patch({Loaded:!0})}),(u,v)=>{const P=kl,p=Sl,k=ca("RouterView"),_=Il,h=Cl,c=Pl;return L(),ee(oe,null,[t(h,{class:"sh-app-layout"},{default:l(()=>[t(P,{class:"sh-header"},{default:l(()=>[t($r)]),_:1}),t(h,null,{default:l(()=>[t(Qa,{name:"slide"},{default:l(()=>[C.value?(L(),K(p,{key:0,class:"sh-sidebar"},{default:l(()=>[t(Rr)]),_:1})):ne("",!0)]),_:1}),t(h,{class:jt(["sh-main-layout",{expanded:!C.value}])},{default:l(()=>[t(qr),t(_,{class:"sh-main-content"},{default:l(()=>[i.value?(L(),K(Aa,{key:0})):(L(),K(k,{key:1}))]),_:1}),t(Zr)]),_:1},8,["class"])]),_:1})]),_:1}),w.value?(L(),K(ei,{key:0})):ne("",!0),t(c,{container:"body",offset:["24px","80px"],size:"small"})],64)}}}),ai=re(ti,[["__scopeId","data-v-62ffc342"]]);xl.registerLanguage("verilog",Vl);const Ma=el();Ma.use(tl);const vt=al(ai);vt.use(Ma);vt.use(Z);vt.use(Tl);vt.use(ll);vt.mount("#app");ql().then(()=>{console.log("Text cache reinitialized")}).catch(e=>{console.error("Text cache reinitialization failed",e)});
