import{bl as rt,L as re,r as m,q as ie,bm as K,bn as L,bo as l,v as t,bp as A,bq as F,au as P,br as aa,t as ja,bs as le,bt as he,bu as ae,aI as ce,j as za,bv as $a,bw as Ua,bx as Aa,u as Pe,F as oe,H as qe,by as Ra,bz as ke,bA as Ne,n as Fe,w as De,a as Ye,bB as la,bb as Ma,bC as Ea,bD as _t,ah as qa,bE as na,bF as Ka,bG as Fa,bH as oa,aN as Na,bI as Kt,bJ as xt,bK as Oa,a5 as Ga,bL as Ha,bM as Ba,N as Ja,bN as Wa}from"./node_modules-C_8Y6cDl.js";import{L as xe,C as fe,a as Se,A as Dt,S as Xa,b as Ya,c as Za,d as Qa,e as at,R as Ce,B as W,F as $e,f as Ue,I as Ae,D as Ze,g as sa,h as be,i as Oe,j as Ge,k as el,T as Ve,l as wt,m as ut,O as jt,n as ra,o as ua,P as ia,p as kt,q as et,r as ca,s as tl,t as al,u as ll,v as nl,w as da,x as ol,y as sl,z as rl,E as ul,M as ma,G as pa,H as il,J as cl,K as dl,N as ml,Q as pl,U as fl,V as vl,W as _l,X as gl,Y as bl}from"./tdesign-vue-next-5WAlh-0Y.js";import{V as ge}from"./vditor-DArazWIS.js";import{e as Ft}from"./monaco-editor-BHsDS0An.js";import{H as hl,v as yl}from"./highlight.js-D9zWiMxS.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const g of c.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&r(g)}).observe(document,{childList:!0,subtree:!0});function n(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(s){if(s.ep)return;s.ep=!0;const c=n(s);fetch(s.href,c)}})();var Ee=(e=>(e.Manage="i-manage",e.ManageJudge="i-manage-judge",e.ManageProblem="i-manage-problem",e.ManageContest="i-manage-contest",e.ManageCollection="i-manage-collection",e))(Ee||{});const wl={"r-admin":["i-manage","i-manage-judge","i-manage-problem","i-manage-contest","i-manage-collection"]};function kl(e){if(e==null)return[];const a=[];for(const n of e){const r=wl[n];r!=null&&a.push(...r)}return[...new Set(a)]}function Cl(e,a){if(e==null||a==null)return!1;const n=kl(e);for(const r of a)if(!n.includes(r))return!1;return!0}const Le=rt("user",{state:()=>({token:"",userId:-1,username:"",nickname:"",roles:[]}),getters:{getToken(){return this.token},getUserId(){return this.userId},getUsername(){return this.username},getNickname(){return this.nickname}},actions:{clear(){this.$patch({token:"",userId:-1,username:"",nickname:"",roles:[]})},loadResponse(e){this.$patch({token:e.token,userId:e.user_id,username:e.username,nickname:e.nickname,roles:e.roles})},isLogin(){return this.token!=null&&this.token!=""},hasAuth(e){return this.hasAllAuths([e])},hasAllAuths(e){return e?Cl(this.roles,e):!0}},persist:!0}),Ke=rt("webStyle",{state:()=>({title:""}),getters:{getTitle(){return this.title}},actions:{setTitle(e){this.title=e}}}),Ct=rt("sidebarStyle",{state:()=>({showSidebar:!1,forceHiddenSidebar:!1,menuActiveName:"",menuList:[]}),getters:{getMenuList(){return this.menuList}},actions:{setSidebarShow(e){this.showSidebar=e},setForceHiddenSidebar(e){this.forceHiddenSidebar=e},setMenuActiveName(e){this.menuActiveName=e},clearMenuList(){this.menuList=[]},setMenuList(e){this.menuList=e},addMenuList(e){this.menuList.push(e)}}}),Sl={style:{"text-align":"right"}},Il=re({__name:"Hitokoto",setup(e){const a=m(!1),n=m(""),r=m(""),s=m(""),c=async()=>{a.value=!0;try{const _=await(await fetch("https://v1.hitokoto.cn")).json();r.value=_.hitokoto,s.value=_.creator,n.value="—— "+_.from}catch(g){r.value="一言获取失败了，但至少您还可以访问本站。",s.value="BoilTask",n.value="DidaOJ",console.error("Error fetching Hitokoto:",g)}finally{a.value=!1}};return ie(()=>{c()}),(g,_)=>{const k=fe,f=xe;return L(),K(f,{loading:a.value},{default:l(()=>[t(k,{title:"一言 © Hitokoto"},{actions:l(()=>[P(" @"+F(s.value),1)]),default:l(()=>[A("div",null,[A("span",null,F(r.value),1),A("p",Sl,F(n.value),1)])]),_:1})]),_:1},8,["loading"])}}}),Pl="https://oj-api.didapipa.com/",Z=aa.create({baseURL:Pl,timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});Z.interceptors.request.use(e=>{const n=Le().getToken;return n&&(e.headers["X-Token"]=n),e},e=>Promise.reject(e));Z.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});const zt=aa.create({timeout:6e4,withCredentials:!1,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});zt.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function Tl(){return zt({baseURL:"https://r2-oj.didapipa.com",url:"/system/notification.json?"+Date.now(),method:"get"})}function xl(){return Z({url:"/system/status",method:"get"})}const Vl={class:"sh-main"},Ll={class:"dida-swiper-div"},Dl=re({__name:"HomeView",setup(e){let a=-1;const n=m(null),r=async()=>{n.value=await Tl()};return ie(async()=>{await r(),a=setInterval(()=>{r()},3e4)}),ja(()=>{clearInterval(a)}),(s,c)=>{const g=Dt,_=Ya,k=Xa,f=fe,u=Se,p=at,v=Qa,b=Za,T=Ce;return L(),K(T,null,{default:l(()=>[t(u,{span:8},{default:l(()=>[A("div",Vl,[n.value?(L(),K(g,{key:0,style:{margin:"20px"},theme:n.value.theme},{default:l(()=>[P(F(n.value.content),1)]),_:1},8,["theme"])):le("",!0),A("div",Ll,[t(k,{class:"dida-swiper"},{default:l(()=>[t(_,null,{default:l(()=>c[0]||(c[0]=[A("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1}),t(_,null,{default:l(()=>c[1]||(c[1]=[A("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1})]),_:1})]),t(f,{title:"正在完善，欢迎提供意见建议",style:{width:"500px",margin:"0 auto"}},{default:l(()=>c[2]||(c[2]=[A("p",null,[A("a",{href:"https://codeoj.cn/",target:"_blank"},"CodeOJ"),P("的迁移计划")],-1),A("p",null,"正在开发中",-1)])),_:1})])]),_:1}),t(u,{span:4},{default:l(()=>[t(f,{style:{margin:"10px"},bordered:!0},{default:l(()=>c[3]||(c[3]=[A("img",{src:"https://api.jysafe.cn/ip/",alt:"Welcome",style:{width:"100%"}},null,-1)])),_:1}),t(Il,{style:{margin:"10px"}}),t(f,{style:{margin:"10px"},bordered:!0},{header:l(()=>c[4]||(c[4]=[A("b",null,"友情链接",-1)])),default:l(()=>[t(b,null,{default:l(()=>[t(v,null,{default:l(()=>[t(p,{href:"https://boiltask.com",target:"_blank"},{default:l(()=>c[5]||(c[5]=[P("BoilTask Blog")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),ue=(e,a)=>{const n=e.__vccOpts||e;for(const[r,s]of a)n[r]=s;return n},jl=ue(Dl,[["__scopeId","data-v-c12b58d1"]]),zl={class:"sh-main"},$l=re({__name:"View404",setup(e){let a=he(),n=m(a.fullPath);return(r,s)=>{const c=W;return L(),ae("div",zl,[A("p",null,F(ce(n)),1),s[2]||(s[2]=A("p",null,"该页面无效或已被迁移，请重新选择访问目标",-1)),t(c,{theme:"primary",onClick:s[0]||(s[0]=()=>r.$router.push("/"))},{default:l(()=>s[1]||(s[1]=[P("返回首页")])),_:1})])}}}),fa=ue($l,[["__scopeId","data-v-d4218944"]]);let Vt=null;async function Ul(){Vt=await Rl()}function Al(e,a="zh"){if(Vt==null)return[!1,e.toString()];const n=Vt[e.toString()];if(!n)return[!1,e.toString()];let r=n[a];return r||(a="zh",r=n[a]),r?[!0,r]:[!1,e.toString()]}async function Rl(){return new Promise(e=>{e({404:{zh:"接口未找到"},1e3:{zh:"系统错误，请重试或等待管理员修复"},1001:{zh:"系统异常，请重试或等待管理员修复"},1002:{zh:"未知错误"},1003:{zh:"操作过于频繁，请稍后重试"},10001:{zh:"权限异常，请重新登陆后再试"},10002:{zh:"参数不符合要求"},10003:{zh:"未找到目标数据"},10004:{zh:"操作需要登录，请登录后重试"},100001:{zh:"用户名不存在或密码不匹配"},100002:{zh:"邮件发送失败，可能是邮箱无效或达到了每日注册上限，如有问题可联系管理员解决"},100003:{zh:"验证码错误或已过期，请重新获取"},100004:{zh:"注册用户失败，可能存在同名用户"},100005:{zh:"用户名不存在，或您未在本系统绑定邮箱，请联系管理员寻求帮助"},100006:{zh:"验证码错误或已过期，请重新获取"},100007:{zh:"已存在相同标题的题目"},100008:{zh:"已存在相同标题的比赛"},100009:{zh:"已存在相同标题的题集"},100010:{zh:"未发现有效题目"},100011:{zh:"题目数量超过限制，无法添加"},100012:{zh:"比赛开始时间无法设置为早于当前时间"},100013:{zh:"当前无法提交题目"},100014:{zh:"申请访问失败，密码错误"}})})}function me(){const{appContext:e}=za();return{globalProperties:e.config.globalProperties}}function ze(){return 1e3}function Be(e,a,n=3e3){return e.$message.success({duration:n,content:a})}function ve(e,a,n=3e3){return e.$message.info({duration:n,content:a})}function _e(e,a,n=3e3){return e.$message.error({duration:n,content:a})}function H(e,a,n=3e3){const[r,s]=Al(a),c=r?s:`系统错误，错误提示[${s}]`;return e.$message.error({duration:n,content:c})}function Ml(e,a){e.$message&&e.$message.close(a)}function El(e,a){return e.length<=a?e:e.slice(0,a)+"..."}function va(e){return e.trim().split(/\s+/).flatMap(r=>r.split(",")).filter(r=>r.trim()!=="")}function ql(e){const a={};return a.id=e.id,a.username=e.username,a.nickname=e.nickname,a.email=e.email,a.slogan=e.slogan,a.organization=e.organization,a.accept=e.accept,a.attempt=e.attempt,a.vjudgeId=e.vjudge_id,e.email&&(a.avatar=`https://www.gravatar.com/avatar/${$a(e.email.toLowerCase().trim())}?d=identicon&s=100`),a}function Kl(e,a){return Z({url:"/user/login",method:"post",data:{username:e,password:a}})}function Fl(){return Z({url:"/user/login/refresh",method:"post"})}function Nl(e){const a={username:e};return Z({url:`/user/info?${new URLSearchParams(a).toString()}`,method:"get"})}function Ol(e){const a="https://vjudge.net/user/solveDetail/"+encodeURIComponent(e);return zt({url:a,method:"get"})}function Gl(e){return Z({url:"/user/account/infos",method:"post",data:{users:e}})}function Hl(e){return Z({url:"/user/parse",method:"post",data:{users:e}})}function Bl(e,a){return Z({url:"/user/register/email",method:"post",data:{token:e,email:a}})}function Jl(e,a,n,r,s){return Z({url:"/user/register",method:"post",data:{username:e,password:a,email:n,key:r,nickname:s}})}function Wl(e,a){return Z({url:"/user/forget",method:"post",data:{token:e,username:a}})}function Xl(e,a,n){return Z({url:"/user/password/modify",method:"post",data:{username:e,password:a,key:n}})}const Yl={class:"dida-login-footer"},Zl=re({__name:"LoginView",setup(e){const{globalProperties:a}=me(),n=Le(),r=m(!1),s=m({username:"",password:""}),c=()=>{ve(a,"重置成功")},g=({validateResult:_,firstError:k})=>{r.value||(r.value=!0,Kl(s.value.username,s.value.password).then(f=>{if(f.code===0){n.loadResponse(f.data),ve(a,"登录成功");let u=a.$route.query.redirect_uri;u||(u="/user/"+f.data.username),a.$router.push({path:u})}else H(a,f.code)}).catch(f=>{console.error("Login error",f),_e(a,"登录失败")}).finally(()=>{r.value=!1}))};return ie(()=>{if(n.isLogin()){a.$router.push({path:"/user"});return}}),(_,k)=>{const f=Ae,u=Ue,p=W,v=$e,b=at,T=fe;return L(),K(T,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:l(()=>[t(v,{ref:"form",data:s.value,colon:!0,onReset:c,onSubmit:g,class:"yj-login-form","label-width":0},{default:l(()=>[t(u,{name:"username"},{default:l(()=>[t(f,{modelValue:s.value.username,"onUpdate:modelValue":k[0]||(k[0]=d=>s.value.username=d),clearable:"",autocomplete:"username",placeholder:"请输入用户名"},{"prefix-icon":l(()=>[t(ce(Ua))]),_:1},8,["modelValue"])]),_:1}),t(u,{name:"password"},{default:l(()=>[t(f,{modelValue:s.value.password,"onUpdate:modelValue":k[1]||(k[1]=d=>s.value.password=d),type:"password",autocomplete:"current-password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":l(()=>[t(ce(Aa))]),_:1},8,["modelValue"])]),_:1}),t(u,null,{default:l(()=>[t(p,{theme:"primary",type:"submit",block:"",loading:r.value},{default:l(()=>k[4]||(k[4]=[P("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),A("div",Yl,[t(b,{onClick:k[2]||(k[2]=()=>{ce(a).$router.push({name:"login-forget"})})},{default:l(()=>k[5]||(k[5]=[P("忘记密码 ")])),_:1}),t(b,{onClick:k[3]||(k[3]=()=>{ce(a).$router.push({name:"register"})})},{default:l(()=>k[6]||(k[6]=[P("注册账户 ")])),_:1})])]),_:1})}}}),Ql=ue(Zl,[["__scopeId","data-v-0466c42d"]]),en={class:"dida-login-footer"},tn=re({__name:"RegisterView",setup(e){const{globalProperties:a}=me(),n=Le(),r=m(!1),s=m(!1),c=m(!1),g=m("发送验证码");let _=null,k=-1;const f=m(!1),u=m(null),p=m({username:"",password:"",confirmPassword:"",nickname:"",email:"",emailKey:""}),b=m({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:i=>new Promise(o=>{const w=setTimeout(()=>{o(p.value.password===i),clearTimeout(w)})}),message:"两次密码不一致"}],nickname:[{required:!0,message:"请填写昵称"},{min:1,message:"昵称至少1个字符"},{max:30,message:"昵称最多30个字符"}],email:[{required:!0,message:"请填写邮箱"},{pattern:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"邮箱格式不正确"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),T=m(()=>t(W,{onClick:d,disabled:c.value,loading:s.value,style:"width:120px"},{default:()=>[g.value]})),d=async()=>{var y;if(!p.value.email){_e(a,"请输入邮箱");return}if(!p.value.email.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)){_e(a,"邮箱格式不正确");return}if(c.value||s.value)return;f.value=!0,await qe();const i=document.getElementById("cf-confirm-div");i&&i.remove();const o=document.createElement("div");o.id="cf-confirm-div",o.setAttribute("data-theme","light"),(y=u.value)==null||y.appendChild(o);const w=window;w.turnstile.ready(function(){w.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function($){f.value=!1,await S($)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},S=async i=>{if(!c.value){s.value=!0;try{const o=await Bl(i,p.value.email);if(o.code!==0){H(a,o.code);return}ve(a,"发送验证码成功"),s.value=!1,c.value=!0,_=new Date,g.value="60秒后重发",k=setInterval(()=>{const y=Math.floor((new Date().getTime()-(_==null?void 0:_.getTime()))/1e3);y>60?(g.value="发送验证码",c.value=!1,clearInterval(k)):g.value=`${60-y}秒后重发`},1e3)}catch{_e(a,"发送验证码失败")}finally{s.value=!1}}},C=()=>{ve(a,"重置成功")},h=({validateResult:i,firstError:o,e:w})=>{if(!r.value){if(w.preventDefault(),i!==!0){_e(a,o);return}if(p.value.password!==p.value.confirmPassword){_e(a,"两次密码不一致");return}r.value=!0,Jl(p.value.username,p.value.password,p.value.email,p.value.emailKey,p.value.nickname).then(y=>{y.code===0?(ve(a,"注册成功，可使用账号信息登录"),a.$router.push({name:"login"})):H(a,y.code)}).catch(y=>{console.error("Login error",y),_e(a,"登录失败")}).finally(()=>{r.value=!1})}};return ie(()=>{if(n.isLogin()){a.$router.push({path:"/user"});return}}),Pe(()=>{clearInterval(k)}),(i,o)=>{const w=Ae,y=Ue,$=sa,R=W,U=$e,D=at,j=fe,E=Ze;return L(),ae(oe,null,[t(j,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:l(()=>[t(U,{ref:"form",rules:b.value,data:p.value,colon:!0,onReset:C,onSubmit:h,class:"yj-login-form"},{default:l(()=>[t(y,{name:"username",label:"用户名"},{default:l(()=>[t(w,{modelValue:p.value.username,"onUpdate:modelValue":o[0]||(o[0]=z=>p.value.username=z),clearable:"",placeholder:"用于登录与查找"},null,8,["modelValue"])]),_:1}),t(y,{name:"password",label:"密码"},{default:l(()=>[t(w,{modelValue:p.value.password,"onUpdate:modelValue":o[1]||(o[1]=z=>p.value.password=z),type:"password",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(y,{name:"confirmPassword",label:"确认密码"},{default:l(()=>[t(w,{modelValue:p.value.confirmPassword,"onUpdate:modelValue":o[2]||(o[2]=z=>p.value.confirmPassword=z),type:"password",clearable:"",placeholder:"请确认密码"},null,8,["modelValue"])]),_:1}),t(y,{name:"nickname",label:"昵称"},{default:l(()=>[t(w,{modelValue:p.value.nickname,"onUpdate:modelValue":o[3]||(o[3]=z=>p.value.nickname=z),clearable:"",placeholder:"用于优先在网站各处展示"},null,8,["modelValue"])]),_:1}),t(y,{name:"email",label:"邮箱"},{default:l(()=>[t(w,{modelValue:p.value.email,"onUpdate:modelValue":o[4]||(o[4]=z=>p.value.email=z),clearable:"",placeholder:"请填写常用邮箱"},null,8,["modelValue"])]),_:1}),t(y,{name:"emailKey",label:"验证码"},{default:l(()=>[t($,{append:T.value},{default:l(()=>[t(w,{modelValue:p.value.emailKey,"onUpdate:modelValue":o[5]||(o[5]=z=>p.value.emailKey=z),clearable:"",placeholder:"请输入验证码",style:{width:"140px"}},null,8,["modelValue"])]),_:1},8,["append"])]),_:1}),t(y,null,{default:l(()=>[t(R,{theme:"primary",type:"submit",block:"",loading:r.value},{default:l(()=>o[8]||(o[8]=[P("注册")])),_:1},8,["loading"])]),_:1})]),_:1},8,["rules","data"]),A("div",en,[t(D,{onClick:o[6]||(o[6]=()=>{ce(a).$router.push({name:"login"})})},{default:l(()=>o[9]||(o[9]=[P("返回登陆 ")])),_:1})])]),_:1}),t(E,{visible:f.value,"onUpdate:visible":o[7]||(o[7]=z=>f.value=z),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:l(()=>[A("div",{ref_key:"dialogContainer",ref:u,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),an=ue(tn,[["__scopeId","data-v-d25e7538"]]),ln={key:0,style:{margin:"10px"}},nn={key:1,style:{margin:"10px"}},on={style:{margin:"12px"}},sn=re({__name:"UserView",setup(e){let a=he();const{globalProperties:n}=me(),r=Ke();let s="";const c=m(!1),g=m(null),_=m([]),k=m([]),f=m([]),u=async p=>{c.value=!0;try{let v=await Nl(p);if(v.code!==0){c.value=!1,H(n,v.code),await Q.push({name:"home"});return}if(g.value=ql(v.data.user),_.value=v.data.problems_ac,r.setTitle(g.value.nickname+" - "+r.getTitle),g.value.vjudgeId){const b=await Ol(g.value.vjudgeId);k.value=b.acRecords;for(const T in k.value)k.value[T].sort((d,S)=>d.length===S.length?d.localeCompare(S):d.length-S.length);f.value=b.failRecords;for(const T in f.value)f.value[T].sort((d,S)=>d.length===S.length?d.localeCompare(S):d.length-S.length)}}catch{_e(n,"获取用户信息失败"),await Q.push({name:"home"})}finally{c.value=!1}};return Ra(async(p,v,b)=>{if(Array.isArray(p.params.username)?s=p.params.username[0]:s=p.params.username,!s){await Q.push({name:"home"});return}await u(s),b()}),ie(async()=>{if(Array.isArray(a.params.username)?s=a.params.username[0]:s=a.params.username,!s){await Q.push({name:"home"});return}await u(s)}),(p,v)=>{const b=W,T=be,d=fe,S=at,C=Ge,h=Oe,i=Se,o=el,w=Ce,y=xe;return L(),K(y,{loading:c.value},{default:l(()=>[t(w,{class:"dida-main-content"},{default:l(()=>[t(i,{span:8},{default:l(()=>{var $;return[t(d,{style:{margin:"10px"},title:"AC题目"},{default:l(()=>[t(T,{style:{"flex-wrap":"wrap"}},{default:l(()=>[(L(!0),ae(oe,null,ke(_.value,R=>(L(),K(b,{key:R,size:"small",onClick:()=>ce(Q).push({name:"problem-detail",params:{problemId:R}})},{default:l(()=>[P(F(R),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),($=g.value)!=null&&$.vjudgeId?(L(),K(d,{key:0,style:{margin:"10px"},title:"vjudge.net"},{actions:l(()=>{var R;return[t(S,{href:"https://vjudge.net/user/"+((R=g.value)==null?void 0:R.vjudgeId),target:"_blank"},{default:l(()=>{var U;return[P("@"+F((U=g.value)==null?void 0:U.vjudgeId),1)]}),_:1},8,["href"])]}),default:l(()=>[k.value&&Object.keys(k.value).length>0?(L(),ae("div",ln,[v[0]||(v[0]=A("div",{style:{margin:"5px"}},[A("span",null,"AC")],-1)),t(h,{layout:"vertical",bordered:!0},{default:l(()=>[(L(!0),ae(oe,null,ke(k.value,(R,U)=>(L(),K(C,{key:U,label:U},{default:l(()=>[t(T,{style:{"flex-wrap":"wrap"}},{default:l(()=>[(L(!0),ae(oe,null,ke(R,D=>(L(),K(b,{key:D,size:"small",onClick:()=>ce(Q).push({name:"problem-detail",params:{problemId:U+"-"+D}})},{default:l(()=>[P(F(D),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):le("",!0),f.value&&Object.keys(f.value).length>0?(L(),ae("div",nn,[v[1]||(v[1]=A("div",{style:{margin:"5px"}},[A("span",null,"Fail")],-1)),t(h,{layout:"vertical",bordered:!0},{default:l(()=>[(L(!0),ae(oe,null,ke(f.value,(R,U)=>(L(),K(C,{key:U,label:U},{default:l(()=>[t(T,{style:{"flex-wrap":"wrap"}},{default:l(()=>[(L(!0),ae(oe,null,ke(R,D=>(L(),K(b,{key:D,size:"small",onClick:()=>ce(Q).push({name:"problem-detail",params:{problemId:U+"-"+D}})},{default:l(()=>[P(F(D),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):le("",!0)]),_:1})):le("",!0)]}),_:1}),t(i,{span:4},{default:l(()=>[A("div",on,[t(h,{layout:"vertical",bordered:!0},{default:l(()=>[t(C,{label:"头像"},{default:l(()=>{var $;return[t(o,{shape:"round",size:"100px",image:($=g.value)==null?void 0:$.avatar,"hide-on-load-failed":!1},null,8,["image"])]}),_:1}),t(C,{label:"昵称"},{default:l(()=>{var $;return[P(F(($=g.value)==null?void 0:$.nickname),1)]}),_:1}),t(C,{label:"Slogan"},{default:l(()=>{var $;return[P(F(($=g.value)==null?void 0:$.slogan),1)]}),_:1}),t(C,{label:"邮箱"},{default:l(()=>{var $;return[P(F(($=g.value)==null?void 0:$.email),1)]}),_:1}),t(C,{label:"组织"},{default:l(()=>{var $;return[P(F(($=g.value)==null?void 0:$.organization),1)]}),_:1}),t(C,{label:"通过数量"},{default:l(()=>{var $;return[P(F(($=g.value)==null?void 0:$.accept),1)]}),_:1}),t(C,{label:"提交数量"},{default:l(()=>{var $;return[P(F(($=g.value)==null?void 0:$.attempt),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),rn=ue(sn,[["__scopeId","data-v-6d730b5a"]]),$t=[{name:"home",path:"/",title:"首页",showSidebar:!1,disableGenerateTab:!0,component:jl},{name:"problem",path:"/problem",title:"题目",icon:"calculation",showSidebar:!0,redirect:"problem-list"},{name:"collection-detail-tab",title:"题集",path:"/collection",showSidebar:!0,disableGenerateTab:!0,redirect:"problem-collection-list"},{name:"judge",path:"/judge",title:"评测",icon:"code",showSidebar:!0,redirect:"judge-list"},{name:"contest",path:"/contest",title:"比赛",icon:"application",showSidebar:!0,redirect:"contest-list"},{name:"contest-detail-tab",title:"比赛",path:"/contest",showSidebar:!0,disableGenerateTab:!0,redirect:"contest-list"},{name:"discuss",title:"讨论",path:"/discuss",icon:"sonic",showSidebar:!0,redirect:"discuss-list"},{name:"rank",path:"/rank",title:"排名",icon:"chart-column",showSidebar:!0,redirect:"rank-ac-all"},{name:"system",path:"/system",title:"系统",icon:"dashboard",showSidebar:!0,redirect:"system-status"},{name:"manage",path:"/manage",title:"管理",icon:"command",showSidebar:!0,redirect:"manage-judge",auths:[Ee.Manage]},{name:"login",path:"/login",title:"登陆",showSidebar:!1,disableGenerateTab:!0,component:Ql},{name:"register",path:"/register",title:"注册",showSidebar:!1,disableGenerateTab:!0,component:an},{name:"user",path:"/user/:username+",title:"用户",showSidebar:!1,needLogin:!0,disableGenerateTab:!0,component:rn},{name:"404",path:"/404",title:"404",showSidebar:!1,disableGenerateTab:!0,component:fa}],un=e=>$t.find(a=>a.name==e),cn=e=>{const a=[];return $t.forEach(n=>{!n.disableGenerateTab&&e.hasAllAuths(n.auths)&&a.push(n)}),a},dn=e=>{$t.forEach(a=>{const n={name:a.name,path:a.path,meta:{title:a.title,tab:a.name,showSidebar:a.showSidebar,needLogin:a.needLogin,redirect:a.redirect,tabAuths:a.auths},component:a.component};e.push(n)})};function _a(e){return e.children!==void 0}function mn(e){return e.children!==void 0}var Ut=(e=>(e[e.Unknown=-1]="Unknown",e[e.C=0]="C",e[e.Cpp=1]="Cpp",e[e.Java=2]="Java",e[e.Python=3]="Python",e[e.Pascal=4]="Pascal",e[e.Golang=5]="Golang",e[e.Lua=6]="Lua",e[e.TypeScript=7]="TypeScript",e[e.Max=8]="Max",e))(Ut||{});function At(){const e=[-1,8];return Object.values(Ut).filter(a=>typeof a=="number"&&!e.includes(a)).map(a=>({value:a,label:ht(a)}))}function gt(e){return e>-1&&e<8}function ht(e){switch(e){case 0:return"C";case 1:return"C++";case 2:return"Java";case 3:return"Python";case 4:return"Pascal";case 5:return"Golang";case 6:return"Lua";case 7:return"TypeScript";default:return"未知"}}function Rt(e){switch(e){case 0:return"c";case 1:return"cpp";case 2:return"java";case 3:return"python";case 4:return"pascal";case 5:return"go";case 6:return"lua";case 7:return"typescript";default:return"text"}}var je=(e=>(e[e.Init=0]="Init",e[e.Rejudge=1]="Rejudge",e[e.Submitting=2]="Submitting",e[e.Queuing=3]="Queuing",e[e.Compiling=4]="Compiling",e[e.Running=5]="Running",e[e.Accept=6]="Accept",e[e.PE=7]="PE",e[e.WA=8]="WA",e[e.TLE=9]="TLE",e[e.MLE=10]="MLE",e[e.OLE=11]="OLE",e[e.RE=12]="RE",e[e.CE=13]="CE",e[e.CLE=14]="CLE",e[e.JudgeFail=15]="JudgeFail",e[e.SubmitFail=16]="SubmitFail",e[e.Unknown=17]="Unknown",e[e.Max=18]="Max",e))(je||{});const pn=e=>{switch(e){case 0:return"普通评测";case 1:return"特殊评测";default:return"未知"}},yt=e=>{switch(e){case 0:return"等待处理";case 1:return"重新评测";case 2:return"提交中";case 3:return"队列中";case 4:return"编译中";case 5:return"运行中";case 6:return"通过";case 7:return"格式错误";case 8:return"答案错误";case 9:return"超时";case 10:return"内存超限";case 11:return"输出超限";case 12:return"运行错误";case 13:return"编译错误";case 14:return"编译超限";case 15:return"评测失败";case 16:return"提交失败";case 17:return"未知";default:return e}},ga=e=>{switch(e){case 0:case 1:case 2:case 3:case 4:case 5:case 17:return"default";case 6:return"success";case 7:return"warning";default:return"danger"}};function ba(){const e=[17,18];return Object.values(je).filter(a=>typeof a=="number"&&!e.includes(a)).map(a=>({value:a,label:yt(a)}))}function bt(e){return e>=0&&e<17}function ot(e){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return!0;default:return!1}}function ha(e){var n;const a={};if(a.id=e.id,a.problemId=e.problem_id,a.contestProblemIndex=e.contest_problem_index,a.status=e.status,ot(e.status)||!bt(e.status)?a.score="-":a.score=e.score.toString(),e.time?a.time=Math.ceil(e.time/1e6)+"ms":a.time="-",e.memory?a.memory=(e.memory/1024/1024).toFixed(2)+"MB":a.memory="-",a.language=e.language,a.codeLength=e.code_length,e.approve_time?a.approveTime=new Date(e.approve_time).toLocaleString():a.approveTime="-",a.author=e.author,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.code=e.code,a.compileMessage=e.compile_message,a.taskCurrent=e.task_current,a.taskTotal=e.task_total,a.task=[],e.task)for(let r=0;r<((n=e.task)==null?void 0:n.length);r++){const s=e.task[r],c={};c.taskId=s.task_id,c.status=s.status,s.time?c.time=Math.ceil(s.time/1e6)+"ms":c.time="-",s.memory?c.memory=(s.memory/1024/1024).toFixed(2)+"MB":c.memory="-",c.score=s.score,c.content=s.content,c.waHint=s.wa_hint,!c.content&&!c.waHint&&(c.content="无提示信息"),a.task.push(c)}return e.judger&&(a.judger=e.judger),e.judger_name?a.judgerName=e.judger_name:a.judgerName="-",e.judge_time&&(a.judgeTime=new Date(e.judge_time).toLocaleString()),a}function fn(e,a,n,r,s){return Z({url:"/judge/approve",method:"post",data:{problem_id:e,contest_id:a,problem_index:n,language:r,code:s}})}function vn(e){return Z({url:"/judge?id="+e,method:"get"})}function _n(e){return Z({url:"/judge/code?id="+e,method:"get"})}function gn(e,a,n,r,s,c,g){let _={problem_id:a,username:n,language:String(r),status:String(s),page:String(c),page_size:String(g)};return e&&(_.contest_id=String(e)),Z({url:`/judge/list?${new URLSearchParams(_).toString()}`,method:"get"})}function bn(){return Z({url:"/judge/rejudge/recently",method:"post"})}function hn(e,a,n){const r={};return e!=null&&(r.problem_id=e),a!=null?r.language=a:r.language=Ut.Unknown,n!=null?r.status=n:r.status=18,Z({url:"/judge/rejudge/search",method:"post",data:r})}function yn(){return Z({url:"/judge/rejudge/all",method:"post",timeout:0})}function wn(e){return Z({url:"/judge/rejudge",method:"post",data:{id:Number(e)}})}var Je=(e=>(e[e.None=0]="None",e[e.Attempt=1]="Attempt",e[e.Accept=2]="Accept",e))(Je||{});function it(e,a){const n={};if(n.id=e.id,n.author=e.author,n.title=e.title,n.tags=[],e.tags)for(const r of e.tags){const s=a[r];s&&n.tags.push(s)}if(n.private=e.private,n.accept=e.accept,n.attempt=e.attempt,e.description!=null&&(n.description=e.description),e.time_limit!=null&&e.time_limit>=0?n.timeLimit=e.time_limit.toString()+" ms":n.timeLimit="未知",e.memory_limit!=null&&e.memory_limit>=0?n.memoryLimit=(e.memory_limit/1024).toFixed(2)+" MB":n.memoryLimit="未知",e.judge_type!=null&&(n.judgeType=pn(e.judge_type)),e.insert_time!=null&&(n.insertTime=new Date(e.insert_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.source!=null){const r=/\[([^\]]+)\]\(([^)]+)\)/,s=e.source.match(r);s?(n.source=s[1],n.sourceUrl=s[2]):(n.source=e.source,n.sourceUrl="")}return e.judge_md5!=null&&(n.judgeMd5=e.judge_md5),e.origin_oj!=null&&(n.originOj=e.origin_oj),e.origin_id!=null&&(n.originId=e.origin_id),e.origin_url!=null&&(n.originUrl=e.origin_url),n}function ya(e,a,n){const r={};return e?r.id=e:(r.contest_id=a,r.problem_index=n),Z({url:`/problem?${new URLSearchParams(r).toString()}`,method:"get"})}function wa(e){return Z({url:"/problem/tag/list?max_count="+e,method:"get"})}function kn(e){return Z({url:"/problem/judge?id="+e,method:"get"})}function Cn(e,a,n,r,s,c){const g={};return e&&(g.oj=e),a&&(g.title=a),n&&(g.tag=n),r!==void 0&&(g.private=r?"1":"0"),s&&(g.page=s),c&&(g.page_size=c),Z({url:`/problem/list?${new URLSearchParams(g).toString()}`,method:"get"})}function Sn(e){const a={};return e&&(a.problem_id=e),Z({url:`/problem/recommend?${new URLSearchParams(a).toString()}`,method:"get"})}function ka(e,a){return Z({url:"/problem/crawl",method:"post",data:{oj:e,id:a}})}function In(e,a,n,r,s,c,g){return Z({url:"/problem/create",method:"post",data:{title:e,time_limit:a,memory_limit:n,source:r,private:s,tags:c,description:g}})}function Pn(e,a,n,r,s,c,g,_){return Z({url:"/problem/edit",method:"post",data:{id:e,title:a,time_limit:n,memory_limit:r,source:s,private:c,tags:g,description:_}})}function Tn(e,a){return Z({url:"/problem/judge/data/download?id="+e+"&key="+a,method:"get"})}function xn(e){return Z({url:"/problem/image/token?id="+e,method:"get"})}function Vn(e,a){return fetch(e,{method:"PUT",headers:{"Content-Type":a.type},body:a})}function Ln(e,a){const n=new FormData;return n.append("id",e),n.append("zip",a),Z({url:"/problem/judge/data",method:"post",data:n,headers:{"Content-Type":"multipart/form-data"},timeout:1e3*60*5})}function Dn(e){return Z({url:"/problem/parse",method:"post",data:{problems:e}})}const jn={style:{margin:"10px"}},zn={key:0,class:"dida-operation-container"};function $n(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ye(e)}const Un=re({__name:"ProblemList",setup(e){const a=he(),n=Ne(),{globalProperties:r}=me(),s=Le();let c=null;const g=m(!1),_={};let k={};const f=m(!1),u=Fe(()=>s.hasAuth(Ee.ManageProblem)),p=m([{title:"ID",colKey:"id",cell:(z,I)=>{let x=y(I.row.id);return t(W,{variant:"dashed",theme:x,onClick:()=>w(I.row.id)},{default:()=>[I.row.id]})}},{title:"标题",colKey:"title",cell:(z,I)=>t(W,{variant:"text",onClick:()=>w(I.row.id)},{default:()=>[I.row.title]})},{title:"标签",colKey:"tags",cell:(z,I)=>{const x=I.row.tags;if(!x||x.length===0)return"";let V=[];for(let M=0;M<x.length;M++){const J=x[M];V.push(t(W,{key:M,theme:"default",variant:"outline",size:"small",onClick:()=>U(J)},{default:()=>[J.name]}))}return t(be,null,$n(V)?V:{default:()=>[V]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),v=m(!1);let b=1,T=50;const d=m({current:b,pageSize:T,defaultCurrent:b,defaultPageSize:T,total:0,pageSizeOptions:[50,100]}),S=m(),C=m(),h=[{label:"DidaOJ",value:"didaoj"},{label:"HDU",value:"hdu"},{label:"POJ",value:"poj"},{label:"NYOJ",value:"nyoj"}],i=m({oj:"",title:"",tag:"",private:!1}),o=m({oj:"",problem:""}),w=z=>{z&&n.push({path:"/problem/"+z})},y=z=>{if(!z||!k)return"default";const I=k[z];if(!I)return"default";switch(I){case Je.Accept:return"success";case Je.Attempt:return"warning";default:return"default"}},$=async()=>{await n.push({query:{...a.query,oj:i.value.oj,title:i.value.title,tag:i.value.tag,private:i.value.private?"1":"0",page:1,page_size:d.value.defaultPageSize}})},R=async()=>{try{f.value=!0;const z=await ka(o.value.oj,o.value.problem);z.code===0?(ve(r,"搜索成功"),await n.push({name:"problem-detail",params:{problemId:z.data}})):H(r,z.code)}catch(z){console.error(z),H(r,ze())}finally{f.value=!1}},U=z=>{z&&n.push({query:{...a.query,title:"",tag:z.name,page:1,page_size:d.value.defaultPageSize}})},D=()=>{n.push({name:"manage-problem-create"})},j=async(z,I)=>{v.value=!0;try{const{current:x,pageSize:V}=z,M=await Cn(i.value.oj,i.value.title,i.value.tag,i.value.private,x,V);if(S.value=[],M.code===0){const J=M.data.list;if(!J||J.length<=0){d.value={...d.value,total:0},k={},ve(r,"未找到记录");return}J.forEach(X=>{var O;const q=it(X,_);(O=S.value)==null||O.push(q)}),d.value={...d.value,total:M.data.total_count},k=M.data.problem_attempt_status}else I&&H(r,M.code)}catch(x){console.error(x),H(r,ze())}finally{v.value=!1}},E=async z=>{await n.push({query:{...a.query,page:z.current,page_size:z.pageSize}})};return ie(async()=>{v.value=!0,C.value=[],wa(-1).then(z=>{if(z.code===0){C.value=z.data.list,g.value=z.data.total_count>z.data.list.length;for(let I=0;I<z.data.list.length;I++){const x=z.data.list[I];_[x.id]=x}c=De(()=>a.query,I=>{i.value.oj=I.oj||"",i.value.title=I.title||"",i.value.tag=I.tag||"",i.value.private=I.private==="1";const x=parseInt(I.page)||d.value.defaultCurrent,V=parseInt(I.page_size)||d.value.defaultPageSize;b=x,T=V,d.value={...d.value,current:b,pageSize:T},j({current:b,pageSize:T},!0)},{immediate:!0})}else g.value=!0}).catch(z=>{console.error(z),g.value=!0})}),Pe(()=>{c&&c()}),(z,I)=>{const x=Ve,V=fe,M=Se,J=W,X=be,q=wt,O=Ue,N=Ae,ye=ut,Ie=$e,B=Ce;return L(),K(B,null,{default:l(()=>[t(M,{span:9},{default:l(()=>[t(V,{style:{margin:"10px"}},{default:l(()=>[t(x,{data:S.value,columns:p.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:d.value,"table-layout":"auto",loading:v.value,onPageChange:E},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(M,{span:3},{default:l(()=>[A("div",jn,[u.value?(L(),ae("div",zn,[t(X,null,{default:l(()=>[t(J,{onClick:D},{default:l(()=>I[7]||(I[7]=[P("新建")])),_:1})]),_:1})])):le("",!0),t(V,{class:"sh-card"},{default:l(()=>[t(Ie,{model:i.value,onSubmit:$},{default:l(()=>[t(O,{label:"OJ"},{default:l(()=>[t(q,{modelValue:i.value.oj,"onUpdate:modelValue":I[0]||(I[0]=G=>i.value.oj=G),options:h,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(O,{label:"标题"},{default:l(()=>[t(N,{modelValue:i.value.title,"onUpdate:modelValue":I[1]||(I[1]=G=>i.value.title=G),placeholder:"请输入关键词"},null,8,["modelValue"])]),_:1}),t(O,{label:"标签"},{default:l(()=>[t(N,{modelValue:i.value.tag,"onUpdate:modelValue":I[2]||(I[2]=G=>i.value.tag=G),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),u.value?(L(),K(O,{key:0,label:"私有"},{default:l(()=>[t(ye,{modelValue:i.value.private,"onUpdate:modelValue":I[3]||(I[3]=G=>i.value.private=G)},null,8,["modelValue"])]),_:1})):le("",!0),t(O,null,{default:l(()=>[t(J,{theme:"primary",type:"submit"},{default:l(()=>I[8]||(I[8]=[P("搜索")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(V,{class:"sh-card"},{default:l(()=>[t(Ie,{model:o.value,onSubmit:R},{default:l(()=>[t(O,{label:"OJ"},{default:l(()=>[t(q,{modelValue:o.value.oj,"onUpdate:modelValue":I[4]||(I[4]=G=>o.value.oj=G),options:h,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(O,{label:"题目"},{default:l(()=>[t(N,{modelValue:o.value.problem,"onUpdate:modelValue":I[5]||(I[5]=G=>o.value.problem=G),placeholder:"请输入原始题号"},null,8,["modelValue"])]),_:1}),t(O,null,{default:l(()=>[t(J,{theme:"primary",type:"submit",loading:f.value},{default:l(()=>I[9]||(I[9]=[P("前往")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),t(V,{class:"sh-card sh-background-black"},{default:l(()=>[(L(!0),ae(oe,null,ke(C.value,G=>(L(),K(J,{class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:()=>U(G)},{default:l(()=>[P(F(G.name),1)]),_:2},1032,["onClick"]))),256)),g.value?(L(),K(J,{key:0,class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:I[6]||(I[6]=()=>z.$router.push("/problem/tags"))},{default:l(()=>I[10]||(I[10]=[P(" ... ")])),_:1})):le("",!0)]),_:1})])]),_:1})]),_:1})}}}),An=ue(Un,[["__scopeId","data-v-bc7185f5"]]);function tt(e){e.querySelectorAll("pre > code:not([data-copy-attached])").forEach(n=>{n.setAttribute("data-copy-attached","true");const r=n.parentElement,s=document.createElement("div");s.className="copy-wrapper";const c=document.createElement("button");c.className="copy-btn",c.innerText="复制",c.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(n.innerText),c.innerText="已复制",setTimeout(()=>c.innerText="复制",1500)}catch{c.innerText="失败"}}),r.replaceWith(s),s.appendChild(c),s.appendChild(r)})}function Xe(e){let a="";for(;e>0;)e--,a=String.fromCharCode(65+e%26)+a,e=Math.floor(e/26);return a}async function Mt(e){const a={};a.id=e.id,a.ownerId=e.owner_id,a.ownerUsername=e.owner_username,a.ownerNickname=e.owner_nickname,a.title=e.title,a.startTime=new Date(e.start_time).toLocaleString(),a.endTime=new Date(e.end_time).toLocaleString(),a.createTime=new Date(e.create_time).toLocaleString(),a.updateTime=new Date(e.update_time).toLocaleString(),a.private=e.private;const n={math:{inlineDigit:!0,engine:"KaTeX"}};if(a.description=await ge.md2html(e.description,n),a.notification=e.notification,e.problems){a.problems=[],e.problems.sort((r,s)=>r.index-s.index);for(let r=0;r<e.problems.length;r++){const s=e.problems[r];let c={accept:0,attempt:0,author:"",id:"",private:!1,tags:[],title:""};c.index=s.index,c.id=Xe(s.index),c.title=s.title,s.accept?c.accept=s.accept:c.accept=0,s.attempt?c.attempt=s.attempt:c.attempt=0,a.problems.push(c)}}return a}function Rn(e){return Z({url:"/contest?id="+e,method:"get"})}function Mn(e){return Z({url:"/contest/edit?id="+e,method:"get"})}function En(e){return Z({url:"/contest/problem/list?id="+e,method:"get"})}function qn(e,a){return Z({url:"/contest/problem?id="+e+"&problem_index="+a,method:"get"})}function Kn(e,a){return Z({url:"/contest/list?page="+e+"&page_size="+a,method:"get"})}function Fn(e){return Z({url:"/contest/rank?id="+e,method:"get"})}function Nn(e){return Z({url:"/contest/create",method:"post",data:e})}function On(e){return Z({url:"/contest/edit",method:"post",data:e})}function Gn(e,a){return Z({url:"/contest/password",method:"post",data:{id:e,password:a}})}const Et=async(e,a)=>{a&&await e.push({name:"user",params:{username:a}})},Nt=e=>{const a=Q.resolve({name:"problem-detail",params:{problemId:e}});window.open(a.href,"_blank")},Lt=async(e,a)=>{await Q.push({name:"contest-problem-detail",params:{contestId:e,problemIndex:a}})},Hn=["innerHTML"],Bn={key:0,class:"dida-problems-container"},Jn={style:{margin:"12px"}},Wn={key:1},Xn={class:"dida-operation-container"},Yn={key:0,class:"dida-operation-container"},Zn={class:"dida-code-submit-div"},Qn=re({__name:"ProblemDetail",setup(e){let a=he();const{globalProperties:n}=me();let r=null;const s=Ke(),c=Le();let g=m(""),_="",k=0,f=m(0);const u=m(!1),p=m(null),v=m(!1),b=m(null);let T=null;const d=m(null),S=m(!1),C=m(!1),h={},i=m(""),o=m([]);o.value=At();const w=m([]),y=Fe(()=>c.hasAuth(Ee.ManageProblem)),$=V=>{V&&Q.push({name:"problem-list",query:{...a.query,title:"",tag:V.name}})},R=async()=>{let V=_;if(!V)try{const M=await qn(k,f.value);M.code===0?V=M.data:H(n,M.code)}catch{_e(n,"获取题目ID失败，请稍后再试");return}await Q.push({name:"manage-problem",params:{problemId:V}})},U=()=>{_?Q.push({name:"judge-list",query:{problem_id:_}}):Q.push({name:"contest-judge",params:{contestId:k},query:{problem_id:Xe(f.value)}})},D=()=>{_?Q.push({name:"discuss-list-problem",query:{problem_id:_}}):Q.push({name:"contest-discuss",params:{contestId:k},query:{problem_id:Xe(f.value)}})},j=()=>{Q.push({name:"problem-recommend",params:{problemId:_}})},E=async()=>{var J,X;const V=(J=b.value)==null?void 0:J.originOj,M=(X=b.value)==null?void 0:X.originId;if(!(!V||!M))try{S.value=!0;const q=await ka(V,M);q.code===0?(await x(),ve(n,"更新成功")):H(n,q.code)}catch{_e(n,"更新失败，请稍后再试")}finally{S.value=!1}},z=async()=>{const V=parseInt(i.value);if(!gt(V)){_e(n,"请选择所编写的语言");return}const M=T==null?void 0:T.getValue();if(!M){_e(n,"请输入所需提交的代码");return}if(!_&&(!k||!f.value)){_e(n,"问题ID无效");return}C.value=!0;try{const J=await fn(_,k,f.value,V,M);if(J.code!==0){H(n,J.code);return}ve(n,"提交成功，正在跳转到详情页面");const X=J.data.id;k?await Q.push({name:"contest-judge-detail",params:{contestId:k,judgeId:X}}):await Q.push({name:"judge-detail",params:{judgeId:X}})}finally{C.value=!1}},I=V=>{if(!T)return;const M=T.getModel();M&&Ft.setModelLanguage(M,Rt(V))},x=async()=>{w.value=[];let V=await ya(_,k,f.value);if(V.code!==0){v.value=!1,H(n,V.code),await Q.push({name:"problem"});return}V.data.tags&&V.data.tags.forEach(X=>{h[X.id]=X}),b.value=it(V.data.problem,h),s.setTitle(b.value.title+" - "+s.getTitle);let M=b.value.description;k&&(V=await En(k),V.code===0?(V.data.problems.sort((X,q)=>X-q),w.value=V.data.problems):H(n,V.code));const J={math:{inlineDigit:!0,engine:"KaTeX"}};g.value=await ge.md2html(M,J),await qe(()=>{p.value&&(ge.mathRender(p.value),ge.highlightRender({lineNumber:!0,enable:!0},p.value),tt(p.value),!T&&d.value&&(T=Ft.create(d.value,{value:"",language:"cpp",minimap:{enabled:!0},colorDecorators:!0,readOnly:!1,theme:"vs-dark"}))),v.value=!1})};return ie(async()=>{r=De(()=>a.params,async()=>{if(Array.isArray(a.params.problemId)?_=a.params.problemId[0]:_=a.params.problemId,!_){if(Array.isArray(a.params.contestId)?k=Number(a.params.contestId[0]):k=Number(a.params.contestId),!k){_e(n,"题目不存在"),await Q.push({name:"problem"});return}if(Array.isArray(a.params.problemIndex)?f.value=parseInt(a.params.problemIndex[0]):f.value=parseInt(a.params.problemIndex),!f.value){_e(n,"题目不存在"),await Q.push({name:"problem"});return}}u.value=!!k,v.value=!0,await x()},{immediate:!0})}),Pe(()=>{r&&(r(),r=null)}),(V,M)=>{const J=fe,X=Se,q=W,O=be,N=Ge,ye=at,Ie=Oe,B=jt,G=wt,ne=Ce,ee=xe;return L(),K(ee,{loading:v.value},{default:l(()=>[t(ne,{class:"dida-main-content"},{default:l(()=>[t(X,{span:8},{default:l(()=>[t(J,{style:{margin:"10px"}},{default:l(()=>[A("div",{innerHTML:ce(g),ref_key:"markdownRef",ref:p},null,8,Hn)]),_:1})]),_:1}),t(X,{span:4},{default:l(()=>{var de;return[ce(k)?(L(),ae("div",Bn,[t(O,{style:{"flex-wrap":"wrap"}},{default:l(()=>[(L(!0),ae(oe,null,ke(w.value,(se,te)=>(L(),K(q,{key:te,theme:se==ce(f)?"primary":"default",onClick:async()=>await ce(Lt)(ce(k),se)},{default:l(()=>[P(F(ce(Xe)(se)),1)]),_:2},1032,["theme","onClick"]))),128))]),_:1})])):le("",!0),A("div",Jn,[t(Ie,{layout:"vertical",bordered:!0},{default:l(()=>{var se;return[t(N,{label:"标题"},{default:l(()=>{var te;return[P(F((te=b.value)==null?void 0:te.title),1)]}),_:1}),t(N,{label:"时间限制"},{default:l(()=>{var te;return[P(F((te=b.value)==null?void 0:te.timeLimit),1)]}),_:1}),t(N,{label:"内存限制"},{default:l(()=>{var te;return[P(F((te=b.value)==null?void 0:te.memoryLimit),1)]}),_:1}),t(N,{label:"判题方式"},{default:l(()=>{var te;return[P(F((te=b.value)==null?void 0:te.judgeType),1)]}),_:1}),u.value?le("",!0):(L(),K(N,{key:0,label:"正确提交"},{default:l(()=>{var te;return[P(F((te=b.value)==null?void 0:te.accept),1)]}),_:1})),u.value?le("",!0):(L(),K(N,{key:1,label:"提交总数"},{default:l(()=>{var te;return[P(F((te=b.value)==null?void 0:te.attempt),1)]}),_:1})),t(N,{label:"创建时间"},{default:l(()=>{var te;return[P(F((te=b.value)==null?void 0:te.insertTime),1)]}),_:1}),t(N,{label:"更新时间"},{default:l(()=>{var te;return[P(F((te=b.value)==null?void 0:te.updateTime),1)]}),_:1}),t(N,{label:"上传用户"},{default:l(()=>{var te;return[P(F((te=b.value)==null?void 0:te.creatorNickname),1)]}),_:1}),u.value?le("",!0):(L(),K(N,{key:2,label:"题目来源"},{default:l(()=>{var te,we,Y;return[(te=b.value)!=null&&te.sourceUrl?(L(),K(ye,{key:0,href:(we=b.value)==null?void 0:we.sourceUrl,target:"_blank"},{default:l(()=>{var pe;return[P(F((pe=b.value)==null?void 0:pe.source),1)]}),_:1},8,["href"])):(L(),ae("span",Wn,F((Y=b.value)==null?void 0:Y.source),1))]}),_:1})),y.value?(L(),K(N,{key:3,label:"是否私有"},{default:l(()=>{var te;return[P(F((te=b.value)!=null&&te.private?"私有":"公开"),1)]}),_:1})):le("",!0),(se=b.value)!=null&&se.originUrl?(L(),K(N,{key:4,label:"原题链接"},{default:l(()=>{var te;return[t(ye,{href:(te=b.value)==null?void 0:te.originUrl,target:"_blank"},{default:l(()=>{var we,Y;return[P(F((we=b.value)==null?void 0:we.originOj)+" - "+F((Y=b.value)==null?void 0:Y.originId),1)]}),_:1},8,["href"])]}),_:1})):le("",!0),ce(_)?(L(),K(N,{key:5,label:"标签"},{default:l(()=>[t(O,null,{default:l(()=>{var te;return[(L(!0),ae(oe,null,ke((te=b.value)==null?void 0:te.tags,we=>(L(),K(q,{key:we.id,variant:"dashed",onClick:()=>$(we)},{default:l(()=>[P(F(we.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})):le("",!0)]}),_:1}),A("div",Xn,[t(O,null,{default:l(()=>[t(q,{onClick:U},{default:l(()=>M[1]||(M[1]=[P("提交记录")])),_:1}),t(q,{onClick:D},{default:l(()=>M[2]||(M[2]=[P("题目讨论")])),_:1}),ce(_)?(L(),K(q,{key:0,onClick:j},{default:l(()=>M[3]||(M[3]=[P("题目推荐")])),_:1})):le("",!0)]),_:1})]),y.value||(de=b.value)!=null&&de.originId?(L(),ae("div",Yn,[t(O,null,{default:l(()=>{var se;return[y.value?(L(),K(q,{key:0,onClick:R},{default:l(()=>M[4]||(M[4]=[P("编辑")])),_:1})):le("",!0),(se=b.value)!=null&&se.originId?(L(),K(q,{key:1,onClick:E,loading:S.value},{default:l(()=>M[5]||(M[5]=[P("更新描述 ")])),_:1},8,["loading"])):le("",!0)]}),_:1})])):le("",!0),A("div",Zn,[t(O,null,{default:l(()=>[t(G,{modelValue:i.value,"onUpdate:modelValue":M[0]||(M[0]=se=>i.value=se),label:"语言：",placeholder:"请选择提交语言","auto-width":"",clearable:"",onChange:I},{default:l(()=>[(L(!0),ae(oe,null,ke(o.value,se=>(L(),K(B,{key:se.value,value:se.value,label:se.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),t(q,{onClick:z,loading:C.value},{default:l(()=>M[6]||(M[6]=[P("提交")])),_:1},8,["loading"])]),_:1}),A("div",{ref_key:"codeEditRef",ref:d,class:"dida-code-editor"},null,512)])])]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),Ot=ue(Qn,[["__scopeId","data-v-f1bba400"]]),eo={style:{margin:"10px"}};function to(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ye(e)}const ao=re({__name:"ProblemRecommend",setup(e){const a=he(),n=Ne(),{globalProperties:r}=me();let s=null,c="",g={},_={};const k=m([{title:"ID",colKey:"id",cell:(d,S)=>{let C=v(S.row.id);return t(W,{variant:"dashed",theme:C,onClick:()=>p(S.row.id)},{default:()=>[S.row.id]})}},{title:"标题",colKey:"title",cell:(d,S)=>t(W,{variant:"text",onClick:()=>p(S.row.id)},{default:()=>[S.row.title]})},{title:"标签",colKey:"tags",cell:(d,S)=>{const C=S.row.tags;if(!C||C.length===0)return"";let h=[];for(let i=0;i<C.length;i++){const o=C[i];h.push(t(W,{key:i,theme:"default",variant:"outline",size:"small",onClick:()=>b(o)},{default:()=>[o.name]}))}return t(be,null,to(h)?h:{default:()=>[h]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),f=m(!1),u=m(),p=d=>{d&&n.push({path:"/problem/"+d})},v=d=>{if(!d||!_)return"default";const S=_[d];if(!S)return"default";switch(S){case Je.Accept:return"success";case Je.Attempt:return"warning";default:return"default"}},b=d=>{d&&n.push({name:"problem-list",query:{tag:d.name}})},T=async d=>{f.value=!0;try{const S=await Sn(c);if(u.value=[],S.code===0){const C=S.data.list;if(!C||C.length<=0){ve(r,"暂无推荐题目");return}g={},S.data.tags&&S.data.tags.forEach(h=>{g[h.id]=h}),C.forEach(h=>{var o;const i=it(h,g);(o=u.value)==null||o.push(i)})}else d&&H(r,S.code)}catch(S){console.error(S),H(r,ze())}finally{f.value=!1}};return ie(async()=>{f.value=!0,s=De(()=>a.query,d=>{Array.isArray(a.params.problemId)?c=a.params.problemId[0]:c=a.params.problemId,T(!0)},{immediate:!0})}),Pe(()=>{s&&s()}),(d,S)=>{const C=Ve,h=fe,i=Se,o=Ce;return L(),K(o,null,{default:l(()=>[t(i,{span:9},{default:l(()=>[t(h,{style:{margin:"10px"}},{default:l(()=>[t(C,{data:u.value,columns:k.value,"row-key":"id","vertical-align":"top",hover:!0,"table-layout":"auto",loading:f.value},null,8,["data","columns","loading"])]),_:1})]),_:1}),t(i,{span:3},{default:l(()=>[A("div",eo,[t(h,{class:"sh-card",header:"题目推荐","header-bordered":!0},{default:l(()=>S[0]||(S[0]=[P(" 根据本站其他用户的提交记录推荐类似题目"),A("br",null,null,-1),P("依据推荐算法来计算，与本用户相似度最高的用户做的题，大概率被自己感兴趣。 ")])),_:1})])]),_:1})]),_:1})}}}),lo=ue(ao,[["__scopeId","data-v-77972e8b"]]);async function qt(e){const a={};if(a.id=e.id,a.ownerId=e.owner_id,a.ownerUsername=e.owner_username,a.ownerNickname=e.owner_nickname,a.title=e.title,e.start_time?a.startTime=new Date(e.start_time).toLocaleString():a.startTime="无限制",e.end_time?a.endTime=new Date(e.end_time).toLocaleString():a.endTime="无限制",e.update_time?a.updateTime=new Date(e.update_time).toLocaleString():a.updateTime="",e.create_time?a.createTime=new Date(e.create_time).toLocaleString():a.createTime="",e.description){const n={math:{inlineDigit:!0,engine:"KaTeX"}};a.description=await ge.md2html(e.description,n)}else a.description="";return a.problems=e.problems,a}function no(e){return Z({url:"/collection?id="+e,method:"get"})}function oo(e){return Z({url:"/collection/edit?id="+e,method:"get"})}function so(e,a){return Z({url:"/collection/list?page="+e+"&page_size="+a,method:"get"})}function ro(e){return Z({url:"/collection/rank?id="+e,method:"get"})}function uo(e){return Z({url:"/collection/create",method:"post",data:e})}function io(e){return Z({url:"/collection/edit",method:"post",data:e})}function co(e){return Z({url:"/collection/join",method:"post",data:{id:e}})}function mo(e){return Z({url:"/collection/quit",method:"post",data:{id:e}})}const po={style:{margin:"10px"}},fo=re({__name:"CollectionList",setup(e){const a=he(),n=Ne(),{globalProperties:r}=me();let s=null;m(!1),m(!1);const c=m([{title:"ID",colKey:"id",width:"100",cell:(C,h)=>t(W,{variant:"text",onClick:()=>v(h.row.id)},{default:()=>[h.row.id]})},{title:"标题",colKey:"title",cell:(C,h)=>t(W,{variant:"text",onClick:()=>v(h.row.id)},{default:()=>[h.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),g=m(!1);let _=1,k=50;const f=m({current:_,pageSize:k,defaultCurrent:_,defaultPageSize:k,total:0,pageSizeOptions:[50,100]}),u=m(),p=m({title:"",username:""});m({title:"",description:"",open_time:[]});const v=C=>{C&&n.push({path:"/collection/"+C})},b=async()=>{await n.push({query:{...a.query,title:p.value.title,username:p.value.username,page:1,page_size:f.value.defaultPageSize}})},T=async(C,h)=>{var i;g.value=!0;try{const{current:o,pageSize:w}=C,y=await so(o,w);if(u.value=[],y.code===0){const $=y.data.list;for(let R=0;R<$.length;R++){const U=$[R],D=await qt(U);(i=u.value)==null||i.push(D)}f.value={...f.value,total:y.data.total_count}}else h&&H(r,y.code)}catch(o){console.error(o),H(r,ze())}finally{g.value=!1}},d=async C=>{await n.push({query:{...a.query,page:C.current,page_size:C.pageSize}})},S=async()=>{await n.push({name:"collection-create"})};return ie(async()=>{s=De(()=>a.query,C=>{p.value.title=C.title||"",p.value.username=C.username||"";const h=parseInt(C.page)||f.value.defaultCurrent,i=parseInt(C.page_size)||f.value.defaultPageSize;_=h,k=i,f.value={...f.value,current:_,pageSize:k},T({current:_,pageSize:k},!0)},{immediate:!0})}),Pe(()=>{s&&s()}),(C,h)=>{const i=Ve,o=fe,w=Se,y=Ae,$=Ue,R=W,U=$e,D=be,j=Ce;return L(),K(j,null,{default:l(()=>[t(w,{span:9},{default:l(()=>[t(o,{style:{margin:"10px"}},{default:l(()=>[t(i,{data:u.value,columns:c.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:f.value,loading:g.value,onPageChange:d},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(w,{span:3},{default:l(()=>[A("div",po,[t(o,{class:"sh-card"},{default:l(()=>[t(U,{model:p.value},{default:l(()=>[t($,{label:"标题"},{default:l(()=>[t(y,{modelValue:p.value.title,"onUpdate:modelValue":h[0]||(h[0]=E=>p.value.title=E),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t($,{label:"负责人"},{default:l(()=>[t(y,{modelValue:p.value.username,"onUpdate:modelValue":h[1]||(h[1]=E=>p.value.username=E),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t($,null,{default:l(()=>[t(R,{theme:"primary",onClick:b},{default:l(()=>h[2]||(h[2]=[P("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(o,{class:"sh-card"},{default:l(()=>[t(D,null,{default:l(()=>[t(R,{onClick:S},{default:l(()=>h[3]||(h[3]=[P("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),vo=ue(fo,[["__scopeId","data-v-36c7c0e5"]]),_o={style:{margin:"20px"}},go={class:"dida-operation-container"},bo={style:{margin:"12px"}},ho=["innerHTML"],yo=re({__name:"CollectionDetail",setup(e){let a=he();const{globalProperties:n}=me(),r=Ke(),s=Le();let c=0;const g=m(!1),_=m(null),k=m(!1),f=m(!1);let u={};const p=Fe(()=>s.hasAuth(Ee.ManageCollection)||_.value&&s.getUserId==_.value.ownerId),v=h=>{if(!h||!u)return"default";const i=u[h];if(!i)return"default";switch(i){case Je.Accept:return"success";case Je.Attempt:return"warning";default:return"default"}},b=m([{title:"问题ID",colKey:"id",cell:(h,i)=>{const o=v(i.row.id);return t(W,{variant:"dashed",theme:o,onClick:()=>Nt(i.row.id)},{default:()=>[i.row.id]})}},{title:"标题",colKey:"title",cell:(h,i)=>t(W,{variant:"text",onClick:()=>Nt(i.row.id)},{default:()=>[i.row.title]})},{title:"正确",colKey:"accept",cell:(h,i)=>i.row.accept?i.row.accept:0},{title:"提交",colKey:"attempt",cell:(h,i)=>i.row.attempt?i.row.attempt:0}]),T=m([]),d=async()=>{if(!s.isLogin()){await Q.push({name:"login"});return}f.value=!0;try{const h=await co(c);if(h.code!==0){H(n,h.code);return}k.value=!0,Be(n,"加入成功")}finally{f.value=!1}},S=async()=>{if(!s.isLogin()){await Q.push({name:"login"});return}f.value=!0;try{const h=await mo(c);if(h.code!==0){H(n,h.code);return}k.value=!1,Be(n,"退出成功")}finally{f.value=!1}},C=()=>{_.value&&Q.push({name:"collection-edit",params:{collectionId:_.value.id}})};return ie(async()=>{if(Array.isArray(a.params.collectionId)?c=Number(a.params.collectionId[0]):c=Number(a.params.collectionId),!c){await Q.push({name:"problem-collection-list"});return}k.value=!1,g.value=!0;const h=await no(c);if(h.code!==0){g.value=!1,H(n,h.code),await Q.push({name:"problem-collection-list"});return}k.value=h.data.joined,u=h.data.attempt_status||{},_.value=await qt(h.data.collection),T.value=[],h.data.collection.problems&&h.data.collection.problems.forEach(i=>{const o=h.data.problems.find(w=>w.id===i);T.value.push(o)}),r.setTitle(_.value.title+" - "+r.getTitle),await qe(()=>{const i=document.querySelectorAll(".dida-content-description");i&&i.length>0&&i.forEach(o=>{ge.mathRender(o),ge.highlightRender({lineNumber:!0,enable:!0},o),tt(o)}),g.value=!1})}),(h,i)=>{const o=ua,w=ra,y=Ve,$=fe,R=Se,U=W,D=be,j=Ge,E=Oe,z=Ce,I=xe;return L(),K(I,{loading:g.value},{default:l(()=>[t(z,{class:"dida-main-content"},{default:l(()=>[t(R,{span:6},{default:l(()=>[A("div",_o,[t(w,{"max-item-width":"300"},{default:l(()=>[t(o,{to:{name:"problem-collection-list"}},{default:l(()=>i[0]||(i[0]=[P("题目集合")])),_:1}),t(o,null,{default:l(()=>{var x;return[P(F((x=_.value)==null?void 0:x.title),1)]}),_:1})]),_:1})]),t($,{style:{margin:"10px"}},{default:l(()=>[t(y,{data:T.value,columns:b.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),_:1})]),_:1}),t(R,{span:6},{default:l(()=>{var x;return[A("div",go,[t(D,null,{default:l(()=>[k.value?(L(),K(U,{key:0,onClick:S,loading:f.value},{default:l(()=>i[1]||(i[1]=[P("退出")])),_:1},8,["loading"])):(L(),K(U,{key:1,onClick:d,loading:f.value},{default:l(()=>i[2]||(i[2]=[P("加入")])),_:1},8,["loading"])),p.value?(L(),K(U,{key:2,onClick:C},{default:l(()=>i[3]||(i[3]=[P("编辑")])),_:1})):le("",!0)]),_:1})]),A("div",bo,[t(E,{layout:"vertical",bordered:!0},{default:l(()=>[t(j,{label:"创建者"},{default:l(()=>{var V;return[P(F((V=_.value)==null?void 0:V.ownerNickname),1)]}),_:1})]),_:1}),t(E,{layout:"vertical",bordered:!0},{default:l(()=>[t(j,{label:"开始时间"},{default:l(()=>{var V;return[P(F((V=_.value)==null?void 0:V.startTime),1)]}),_:1})]),_:1}),t(E,{layout:"vertical",bordered:!0},{default:l(()=>[t(j,{label:"结束时间"},{default:l(()=>{var V;return[P(F((V=_.value)==null?void 0:V.endTime),1)]}),_:1})]),_:1})]),(x=_.value)!=null&&x.description?(L(),K($,{key:0,style:{margin:"10px"}},{default:l(()=>{var V;return[A("div",{innerHTML:(V=_.value)==null?void 0:V.description,class:"dida-content-description"},null,8,ho)]}),_:1})):le("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),wo=ue(yo,[["__scopeId","data-v-3f4490c0"]]),ko=re({__name:"CollectionRank",setup(e){const a=he(),n=Ne(),{globalProperties:r}=me();let s=null,c=0,g=0;const _=m([{title:"Rank",colKey:"rank",align:"center"},{title:"序号",colKey:"index",align:"center"},{title:"Username",colKey:"username",cell:(v,b)=>t(W,{variant:"text",onClick:()=>n.push({name:"user",params:{username:b.row.username}})},{default:()=>[b.row.username]})},{title:"昵称",colKey:"nickname",cell:(v,b)=>t(W,{variant:"text",onClick:()=>n.push({name:"user",params:{username:b.row.username}})},{default:()=>[b.row.nickname]})},{title:"Count",colKey:"count",cell:(v,b)=>t(W,{variant:"text",onClick:()=>n.push({name:"judge-list",query:{username:b.row.username,status:je.Accept}})},{default:()=>[`${b.row.accept} / ${g}`]})},{title:"Progress",colKey:"progress",cell:(v,b)=>{let T=100;return g>0&&(T=Number((b.row.accept/g*100).toFixed(2))),t(ia,{percentage:T},null)}}]),k=m(!1),f=m([]),u=({col:v,rowIndex:b})=>{let T=1;for(let d=b+1;d<f.value.length&&f.value[d].rank===f.value[b].rank;d++)T++;if(v.colKey==="rank")return{rowspan:T}},p=async v=>{k.value=!0;try{const b=await ro(c);if(f.value=[],b.code===0){g=b.data.problem;const T=b.data.ranks,d=[];if(T){for(let h=0;h<T.length;h++){const i=T[h];let o={userId:i.author_id,username:i.author_username,nickname:i.author_nickname};o.accept=i.accept,d.push(o)}d.sort((h,i)=>h.accept!==i.accept?i.accept-h.accept:h.userId-i.userId);let S=0,C=-1;for(let h=0;h<d.length;h++)d[h].accept!==C&&(S=h+1,C=d[h].accept),d[h].index=h+1,d[h].rank=S}f.value=d}else v&&H(r,b.code)}catch(b){console.error(b),H(r,ze())}finally{k.value=!1}};return ie(async()=>{s=De(()=>a.query,async()=>{if(Array.isArray(a.params.collectionId)?c=Number(a.params.collectionId[0]):c=Number(a.params.collectionId),!c){await n.push({name:"problem-collection-list"});return}await p(!0)},{immediate:!0})}),Pe(()=>{s&&s()}),(v,b)=>{const T=Ve,d=fe,S=Ce;return L(),K(S,null,{default:l(()=>[t(d,{style:{margin:"10px"}},{default:l(()=>[A("div",null,[t(T,{data:f.value,columns:_.value,"row-key":"index","rowspan-and-colspan":u,"vertical-align":"middle",bordered:!0,hover:!0,loading:k.value},null,8,["data","columns","loading"])])]),_:1})]),_:1})}}});var Te=(e=>(e[e.Valid=0]="Valid",e[e.Duplicate=1]="Duplicate",e[e.Invalid=2]="Invalid",e))(Te||{});const Co={class:"dida-form-border"},So={style:{"text-align":"right"}},Io=re({name:"ParseProblemList",__name:"ParseProblemList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:a}=me(),n=m(!1),r=m(!1),s=m(""),c=la(e,"modelValue");let g=[];De(c,async v=>{JSON.stringify(v)!==JSON.stringify(g)&&(await f(v),g=c.value)},{deep:!0});const _=m([]),k=m([{title:"有效性",colKey:"validType",cell:(v,b)=>{switch(b.row.valid){case Te.Valid:return t(et,{theme:"success"},{default:()=>[P("有效")]});case Te.Duplicate:return t(et,{theme:"warning"},{default:()=>[P("重复")]});case Te.Invalid:return t(et,{theme:"danger"},{default:()=>[P("无效")]});default:return null}}},{title:"问题ID",colKey:"id"},{title:"标题",colKey:"title"}]),f=async v=>{const b=Array.from(new Set(v)),T=await Dn(b);if(T.code!==0){H(a,T.code),r.value=!1;return}const d=[],S=T.data.problems;let C=[];v.forEach(h=>{const i=S.find(o=>o.id===h);if(i){const o=d.find(w=>w.id===h);i.valid=o?Te.Duplicate:Te.Valid,d.push({id:h,title:i.title,valid:i.valid}),o||C.push(h)}else d.push({id:h,title:"-",valid:Te.Invalid})}),_.value=d,g=C,c.value=C},u=async()=>{r.value=!0;const v=va(s.value);await f(v),n.value=!1,r.value=!1},p=()=>{_.value?s.value=_.value.map(v=>v.id).join(`
`):s.value="",n.value=!0};return(v,b)=>{const T=W,d=Ve,S=kt,C=Ze;return L(),ae(oe,null,[A("div",Co,[A("div",So,[t(T,{onClick:p},{default:l(()=>b[2]||(b[2]=[P("编辑")])),_:1})]),t(d,{data:_.value,columns:k.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(C,{visible:n.value,"onUpdate:visible":b[1]||(b[1]=h=>n.value=h),onConfirm:u,header:"请输入问题ID","confirm-loading":r.value},{default:l(()=>[b[3]||(b[3]=A("div",{style:{"margin-bottom":"10px"}},[A("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(S,{modelValue:s.value,"onUpdate:modelValue":b[0]||(b[0]=h=>s.value=h),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Ca=ue(Io,[["__scopeId","data-v-7f4ce589"]]),Po={class:"dida-form-border"},To={style:{"text-align":"right"}},xo=re({name:"ParseUserList",__name:"ParseUserList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:a}=me(),n=m(!1),r=m(!1),s=m(""),c=la(e,"modelValue");let g=[];De(c,async T=>{JSON.stringify(T)!==JSON.stringify(g)&&(g=T,await u(T))},{deep:!0});const _=m(),k=m([{title:"有效性",colKey:"validType",cell:(T,d)=>{switch(d.row.valid){case Te.Valid:return t(et,{theme:"success"},{default:()=>[P("有效")]});case Te.Duplicate:return t(et,{theme:"warning"},{default:()=>[P("重复")]});case Te.Invalid:return t(et,{theme:"danger"},{default:()=>[P("无效")]})}}},{title:"Username",colKey:"username"},{title:"昵称",colKey:"nickname"}]),f=(T,d)=>{if(T.code!==0){H(a,T.code),r.value=!1;return}const S=[],C=T.data.users;let h=[];d?d.forEach(i=>{let o=null;if(C&&(o=C.find(w=>w.username.toLowerCase()===i.toLowerCase())),o){const w=S.find($=>$.username.toLowerCase()===i.toLowerCase()),y=w?Te.Duplicate:Te.Valid;S.push({id:o.id,username:o.username,nickname:o.nickname,valid:y}),w||h.push(o.id)}else S.push({id:-1,username:i,nickname:"-",valid:Te.Invalid})}):C&&C.forEach(i=>{const o=S.find(y=>y.id===i.id),w=o?Te.Duplicate:Te.Valid;S.push({id:i.id,username:i.username,nickname:i.nickname,valid:w}),o||h.push(i.id)}),_.value=S,g=h,c.value=h},u=async T=>{const d=Array.from(new Set(T)),S=await Gl(d);f(S)},p=async T=>{const d=Array.from(new Set(T)),S=await Hl(d);f(S,T)},v=async()=>{r.value=!0;const T=va(s.value);await p(T),n.value=!1,r.value=!1},b=()=>{_.value?s.value=_.value.map(T=>T.username).join(`
`):s.value="",n.value=!0};return(T,d)=>{const S=W,C=Ve,h=kt,i=Ze;return L(),ae(oe,null,[A("div",Po,[A("div",To,[t(S,{onClick:b},{default:l(()=>d[2]||(d[2]=[P("编辑")])),_:1})]),t(C,{data:_.value,columns:k.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(i,{visible:n.value,"onUpdate:visible":d[1]||(d[1]=o=>n.value=o),onConfirm:v,header:"请输入用户Username","confirm-loading":r.value},{default:l(()=>[d[3]||(d[3]=A("div",{style:{"margin-bottom":"10px"}},[A("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(h,{modelValue:s.value,"onUpdate:modelValue":d[0]||(d[0]=o=>s.value=o),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Sa=ue(xo,[["__scopeId","data-v-d2170a86"]]),Vo={style:{margin:"10px"}},Lo={style:{margin:"12px"}},Do={class:"dida-edit-container"},jo=re({__name:"CollectionEdit",setup(e){let a=he();const{globalProperties:n}=me(),r=Ke(),s=m(""),c=m(!1);let g=null;const _=m(!1),k=m(!1),f=m(null),u=m({title:"",openTime:[],private:!0,problems:[],members:[],description:""}),p=m(""),v=m(""),b=m(!1),T=async()=>{b.value=!0,k.value=!1,b.value=!1},d=async()=>{if(g){_.value=!0;try{const i={title:u.value.title,description:g.getValue(),problems:u.value.problems,members:u.value.members,private:u.value.private};u.value.openTime[0]&&(i.start_time=new Date(u.value.openTime[0])),u.value.openTime[1]&&(i.end_time=new Date(u.value.openTime[1]));const o=await uo(i);if(_.value=!0,o.code!==0){H(n,o.code);return}o.data!=null&&await Q.push({name:"collection-detail",params:{collectionId:o.data}}),Be(n,"创建成功")}finally{_.value=!1}}},S=async()=>{if(g){_.value=!0;try{const i={id:Number(s.value),title:u.value.title,private:u.value.private,problems:u.value.problems,members:u.value.members,description:g.getValue()};u.value.openTime[0]&&(i.start_time=new Date(u.value.openTime[0])),u.value.openTime[1]&&(i.end_time=new Date(u.value.openTime[1]));const o=await io(i);if(_.value=!0,o.code!==0){H(n,o.code);return}o.data!=null&&f.value&&(f.value.updateTime=new Date(o.data).toLocaleString()),Be(n,"保存成功")}finally{_.value=!1}}},C=i=>{const o={after:()=>{g==null||g.setValue(i),c.value=!1},preview:{math:{inlineDigit:!0,engine:"KaTeX"}}};g=new ge("collectionEditDiv",o)},h=async()=>{const i=await oo(s.value);if(i.code!==0){H(n,i.code),console.error("collection get failed",i.code),await Q.push({name:"problem-collection-list"});return}const o=i.data.collection;f.value=await qt(o),u.value.title=o.title,u.value.openTime=[],o.start_time?u.value.openTime.push(new Date(o.start_time)):u.value.openTime.push(""),o.end_time?u.value.openTime.push(new Date(o.end_time)):u.value.openTime.push(""),u.value.private=o.private,u.value.description=o.description,u.value.problems=o.problems,u.value.members=o.members,r.setTitle(o.title+" - "+r.getTitle);let w="";o.description&&(w=o.description),C(w)};return ie(async()=>{Array.isArray(a.params.collectionId)?s.value=a.params.collectionId[0]:s.value=a.params.collectionId,s.value?(c.value=!0,await h()):C("")}),(i,o)=>{const w=Ae,y=Ue,$=ca,R=ut,U=$e,D=fe,j=Se,E=W,z=be,I=Ge,x=Oe,V=Ce,M=xe,J=kt,X=Ze;return L(),ae(oe,null,[t(M,{loading:c.value},{default:l(()=>[t(V,null,{default:l(()=>[t(j,{span:8},{default:l(()=>[A("div",Vo,[t(D,{class:"sh-card"},{default:l(()=>[t(U,{model:u.value},{default:l(()=>[t(y,{label:"标题"},{default:l(()=>[t(w,{modelValue:u.value.title,"onUpdate:modelValue":o[0]||(o[0]=q=>u.value.title=q),placeholder:"题集标题"},null,8,["modelValue"])]),_:1}),t(y,{label:"开启时间"},{default:l(()=>[t($,{modelValue:u.value.openTime,"onUpdate:modelValue":o[1]||(o[1]=q=>u.value.openTime=q),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(y,{label:"私有"},{default:l(()=>[t(R,{modelValue:u.value.private,"onUpdate:modelValue":o[2]||(o[2]=q=>u.value.private=q)},null,8,["modelValue"])]),_:1}),t(y,{label:"成员"},{default:l(()=>[t(Sa,{modelValue:u.value.members,"onUpdate:modelValue":o[3]||(o[3]=q=>u.value.members=q)},null,8,["modelValue"])]),_:1}),t(y,{label:"问题"},{default:l(()=>[t(Ca,{modelValue:u.value.problems,"onUpdate:modelValue":o[4]||(o[4]=q=>u.value.problems=q)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(j,{span:4},{default:l(()=>[A("div",Lo,[A("div",Do,[s.value?(L(),K(z,{key:0},{default:l(()=>[t(E,{onClick:S,theme:"danger",loading:_.value},{default:l(()=>o[7]||(o[7]=[P("保存")])),_:1},8,["loading"])]),_:1})):(L(),K(z,{key:1},{default:l(()=>[t(E,{onClick:d,theme:"danger",loading:_.value},{default:l(()=>o[8]||(o[8]=[P("创建")])),_:1},8,["loading"])]),_:1}))]),s.value?(L(),K(x,{key:0,layout:"vertical",bordered:!0},{default:l(()=>[t(I,{label:"创建时间"},{default:l(()=>{var q;return[P(F((q=f.value)==null?void 0:q.createTime),1)]}),_:1}),t(I,{label:"更新时间"},{default:l(()=>{var q;return[P(F((q=f.value)==null?void 0:q.updateTime),1)]}),_:1}),t(I,{label:"创建用户"},{default:l(()=>{var q;return[P(F((q=f.value)==null?void 0:q.ownerNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),o[9]||(o[9]=A("div",{id:"collectionEditDiv",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"]),t(X,{visible:k.value,"onUpdate:visible":o[6]||(o[6]=q=>k.value=q),onConfirm:T,header:p.value,"confirm-loading":b.value},{default:l(()=>[o[10]||(o[10]=A("div",{style:{"margin-bottom":"10px"}},[A("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(J,{modelValue:v.value,"onUpdate:modelValue":o[5]||(o[5]=q=>v.value=q),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),Gt=ue(jo,[["__scopeId","data-v-dbc568cf"]]),zo=["innerHTML"];function Ht(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ye(e)}const $o=re({__name:"JudgeJobList",setup(e){const a=he(),n=Ne(),{globalProperties:r}=me();let s=!1,c=null,g;const _=m(!1),k=m(null),f=m(null),u=m(!1);let p=-1;const v=m({problemId:"",username:"",language:void 0,status:void 0}),b=m([{title:"ID",colKey:"id",cell:(I,x)=>{let V=null;return bt(x.row.status)&&gt(x.row.language)&&(V=()=>{R(x.row.id)}),t(W,{variant:"text",onClick:V},{default:()=>[x.row.id]})}},{title:"问题",colKey:"problemId",cell:(I,x)=>{if(p){let V;return t(W,{variant:"text",onClick:()=>$(p,x.row.contestProblemIndex)},Ht(V=Xe(x.row.contestProblemIndex))?V:{default:()=>[V]})}return t(W,{variant:"text",onClick:()=>y(x.row.problemId)},{default:()=>[x.row.problemId]})}},{title:"状态",colKey:"status",align:"center",cell:(I,x)=>{let V=null;bt(x.row.status)&&gt(x.row.language)&&(V=()=>{R(x.row.id)});const M=x.row.status,J=yt(M);let X=!bt(M);const q=ga(M);let O=[];return ot(M)&&O.push(t(xe,{text:x.row.state,size:"small",class:"dida-status-loading"},null)),O.push(t("span",null,[J])),t(W,{theme:q,variant:"outline",onClick:V,disabled:X},Ht(O)?O:{default:()=>[O]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"code",cell:(I,x)=>{let V=!gt(x.row.language);return t(W,{theme:"default",onClick:()=>w(x.row),disabled:V},{default:()=>[ht(x.row.language)+" / "+x.row.codeLength]})}},{title:"作者",colKey:"author",width:200,cell:(I,x)=>t(W,{variant:"text",onClick:()=>U(x.row.authorUsername)},{default:()=>[x.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),T=m(!1);let d=1,S=50;const C=m({current:d,pageSize:S,defaultCurrent:d,defaultPageSize:S,total:0,pageSizeOptions:[50,100]}),h=m(),i=m([]);i.value=At();const o=m([]);o.value=ba();const w=async I=>{u.value=!0,_.value=!0;try{k.value=I;const x=await _n(Number(k.value.id));if(x.code===0){const V=x.data,J=`\`\`\`${Rt(V.language)}
${V.code}
\`\`\``,X={};k.value.code=await ge.md2html(J,X),await qe(()=>{f.value&&(ge.highlightRender({lineNumber:!0,enable:!0},f.value),tt(f.value))})}else H(r,x.code)}finally{u.value=!1}},y=I=>{I&&n.push({path:"/problem/"+I})},$=(I,x)=>{n.push({name:"contest-problem-detail",params:{contestId:I,problemIndex:x}})},R=I=>{I&&(p>0?n.push({name:"contest-judge-detail",params:{contestId:p,judgeId:I}}):n.push({name:"judge-detail",params:{judgeId:I}}))},U=I=>{I&&n.push({path:"/user/"+I})},D=async()=>{await n.push({query:{...a.query,page:1,page_size:S,problem_id:v.value.problemId,username:v.value.username,language:v.value.language,status:v.value.status}})},j=async()=>{v.value.problemId="",v.value.username="",v.value.language=void 0,v.value.status=void 0,await n.push({query:{...a.query,page:1,page_size:S,problem_id:"",username:"",language:void 0,status:void 0}})},E=async(I,x)=>{x&&(T.value=!0);let V=!1;try{const{current:M,pageSize:J}=I,X=await gn(p,v.value.problemId,v.value.username,v.value.language,v.value.status,M,J);if(h.value=[],X.code===0){if(!X.data.has_auth){ve(r,"您目前没有权限查看评测记录"),p?await n.push({name:"contest-detail",params:{contestId:p}}):await n.push({name:"judge-list"});return}X.data.list&&X.data.list.length>0?(X.data.list.forEach(O=>{var ye;const N=ha(O);(ye=h.value)==null||ye.push(N),ot(O.status)&&(V=!0)}),C.value={...C.value,total:X.data.total_count}):(ve(r,"未找到记录"),C.value={...C.value,total:0})}else x&&H(r,X.code)}catch(M){console.error(M),x&&H(r,ze())}finally{x&&(T.value=!1),V&&s&&(g=setTimeout(()=>{E({current:d,pageSize:S},!1)},5e3))}},z=async I=>{await n.push({query:{...a.query,page:I.current,page_size:I.pageSize}})};return ie(async()=>{s=!0,c=De(()=>a.query,I=>{Array.isArray(a.params.contestId)?p=Number(a.params.contestId[0]):p=Number(a.params.contestId),v.value.problemId=I.problem_id||"",v.value.username=I.username||"",I.language!=null?v.value.language=Number(I.language):v.value.language=void 0,I.status!=null?v.value.status=Number(I.status):v.value.status=void 0;const x=parseInt(I.page)||C.value.defaultCurrent,V=parseInt(I.page_size)||C.value.defaultPageSize;d=x,S=V,C.value.pageSizeOptions.includes(S)||(S=C.value.defaultPageSize),C.value={...C.value,current:d,pageSize:S},E({current:d,pageSize:S},!0)},{immediate:!0})}),Pe(()=>{s=!1,c&&c(),clearTimeout(g)}),(I,x)=>{const V=Ae,M=Ue,J=jt,X=wt,q=W,O=be,N=$e,ye=Ve,Ie=fe,B=at,G=xe,ne=Ze;return L(),ae(oe,null,[t(Ie,{style:{margin:"10px"}},{default:l(()=>[t(N,{layout:"inline",onSubmit:D,onReset:j},{default:l(()=>[t(M,{label:"题号"},{default:l(()=>[t(V,{modelValue:v.value.problemId,"onUpdate:modelValue":x[0]||(x[0]=ee=>v.value.problemId=ee),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(M,{label:"用户"},{default:l(()=>[t(V,{modelValue:v.value.username,"onUpdate:modelValue":x[1]||(x[1]=ee=>v.value.username=ee),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(M,{label:"语言"},{default:l(()=>[t(X,{modelValue:v.value.language,"onUpdate:modelValue":x[2]||(x[2]=ee=>v.value.language=ee),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:l(()=>[(L(!0),ae(oe,null,ke(i.value,ee=>(L(),K(J,{key:ee.value,value:ee.value,label:ee.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(M,{label:"状态"},{default:l(()=>[t(X,{modelValue:v.value.status,"onUpdate:modelValue":x[3]||(x[3]=ee=>v.value.status=ee),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:l(()=>[(L(!0),ae(oe,null,ke(o.value,ee=>(L(),K(J,{key:ee.value,value:ee.value,label:ee.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(M,null,{default:l(()=>[t(O,null,{default:l(()=>[t(q,{theme:"primary",type:"submit"},{default:l(()=>x[7]||(x[7]=[P("搜索")])),_:1}),t(q,{theme:"default",variant:"base",type:"reset"},{default:l(()=>x[8]||(x[8]=[P("重置")])),_:1})]),_:1})]),_:1})]),_:1}),t(ye,{data:h.value,columns:b.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:C.value,loading:T.value,onPageChange:z,"table-layout":"auto"},null,8,["data","columns","pagination","loading"])]),_:1}),t(ne,{visible:_.value,"onUpdate:visible":x[5]||(x[5]=ee=>_.value=ee),width:"800px","cancel-btn":null,"close-btn":!1,onConfirm:x[6]||(x[6]=ee=>_.value=!1)},{header:l(()=>[t(B,{onClick:x[4]||(x[4]=()=>{var ee;R((ee=k.value)==null?void 0:ee.id)})},{default:l(()=>{var ee,de;return[P(F(((ee=k.value)==null?void 0:ee.id)+" - "+ce(ht)((de=k.value)==null?void 0:de.language)),1)]}),_:1})]),default:l(()=>[t(G,{loading:u.value},{default:l(()=>{var ee;return[A("div",{innerHTML:(ee=k.value)==null?void 0:ee.code,ref_key:"markdownCodeRef",ref:f,style:{"min-height":"100px"}},null,8,zo)]}),_:1},8,["loading"])]),_:1},8,["visible"])],64)}}}),Bt=ue($o,[["__scopeId","data-v-8ecb6b14"]]),Uo={class:"dida-code-container"},Ao=["innerHTML"],Ro={key:2,class:"dida-edit-container"};function Jt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ye(e)}const Mo=re({__name:"JudgeJobDetail",setup(e){const a=he(),n=Ne(),r=Le(),{globalProperties:s}=me();let c=!1,g,_=0,k=0;const f=m(""),u=m(null),p=m(""),v=m(null),b=m(0),T=m(null),d=m({from:"#5a96ff",to:"#00A870"});let S=!1;const C=m([{title:"ID",colKey:"id"},{title:"问题",colKey:"problemId",cell:(E,z)=>t(W,{variant:"text",onClick:()=>$(z.row.problemId)},{default:()=>[z.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(E,z)=>{const I=z.row.status,x=yt(I),V=ga(I);let M=[];return ot(I)&&M.push(t(xe,{text:z.row.state,size:"small",class:"dida-status-loading"},null)),M.push(t("span",null,[x])),t(W,{theme:V,variant:"outline"},Jt(M)?M:{default:()=>[M]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"language",cell:(E,z)=>t("span",null,[ht(z.row.language)+" / "+z.row.codeLength])},{title:"作者",colKey:"author",width:200,cell:(E,z)=>t(W,{variant:"text",onClick:()=>R(z.row.authorUsername)},{default:()=>[z.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),h=m(!1),i=m(!1),o=m(),w=Fe(()=>r.hasAuth(Ee.ManageJudge)),y=async()=>{if(!i.value){i.value=!0;try{const E=await wn(_);E.code===0?await D(!0):H(s,E.code)}catch(E){console.error(E),H(s,ze())}finally{i.value=!1}}},$=E=>{E&&n.push({path:"/problem/"+E})},R=E=>{E&&n.push({path:"/user/"+E})},U=E=>{const z=E.status,I=yt(z);let x;switch(z){case je.Init:case je.Rejudge:case je.Compiling:case je.Running:x="default";break;case je.Accept:x="success";break;case je.PE:x="warning";break;default:x="danger";break}return t(be,null,{default:()=>[t(W,{theme:"default",variant:"outline"},{default:()=>[E.taskId]}),t(W,{theme:x,variant:"outline"},Jt(I)?I:{default:()=>[I]}),t("span",null,[P("分数："),E.score]),t("span",null,[P("用时："),E.time]),t("span",null,[P("内存："),E.memory])]})},D=async E=>{var I;E&&(h.value=!0);let z=!1;try{const x=await vn(_);if(o.value=[],x.code===0){const V=x.data,M=ha(V);(I=o.value)==null||I.push(M),f.value=M.judgerName,d.value.to="#00A870",ot(V.status)?(T.value="active",M.taskTotal>0?(b.value=M.taskCurrent/M.taskTotal*100,M.taskCurrent>=M.taskTotal&&(b.value=99)):b.value=0):(b.value=100,V.status===je.Accept?T.value="success":V.status===je.PE?(d.value.to="#F57C20",T.value="warning"):(d.value.to="#F56C6C",T.value="error"));const J={};if(V.code){const q=`\`\`\`${Rt(V.language)}
${V.code}
\`\`\``;p.value=await ge.md2html(q,J),await qe(()=>{v.value&&(S||(S=!0,ge.highlightRender({lineNumber:!0,enable:!0},v.value)),tt(v.value))})}u.value=M,ot(V.status)&&(z=!0)}else E&&H(s,x.code),k?await n.push({name:"contest-judge",params:{contestId:k}}):await n.push({name:"judge-list"})}catch(x){console.error(x),E&&H(s,ze())}finally{E&&(h.value=!1),z&&c&&(g=setTimeout(()=>{D(!1)},5e3))}};function j(){v.value&&v.value.parentElement&&(v.value.style.maxWidth=v.value.parentElement.clientWidth+"px")}return ie(async()=>{if(c=!0,Array.isArray(a.params.judgeId)?_=Number(a.params.judgeId[0]):_=Number(a.params.judgeId),Array.isArray(a.params.contestId)?k=Number(a.params.contestId[0]):k=Number(a.params.contestId),!_){await n.push({name:"judge"});return}await D(!0),j(),window.addEventListener("resize",j)}),Pe(()=>{c=!1,window.removeEventListener("resize",j),clearTimeout(g)}),(E,z)=>{var Ie,B,G;const I=ia,x=Ve,V=fe,M=Se,J=Ge,X=Oe,q=Ce,O=tl,N=al,ye=W;return L(),ae(oe,null,[t(I,{color:d.value,status:T.value,class:"dida-job-progress",percentage:b.value},null,8,["color","status","percentage"]),t(V,{style:{margin:"10px"}},{default:l(()=>[t(x,{data:o.value,columns:C.value,"row-key":"id","vertical-align":"top",hover:!0,loading:h.value},null,8,["data","columns","loading"])]),_:1}),t(q,null,{default:l(()=>[t(M,{span:8},{default:l(()=>[A("div",Uo,[A("div",{innerHTML:p.value,ref_key:"markdownCodeRef",ref:v,class:"dida-code-div"},null,8,Ao)])]),_:1}),t(M,{span:4},{default:l(()=>[t(X,{layout:"vertical",bordered:!0,style:{margin:"10px"}},{default:l(()=>[t(J,{label:"判题机"},{default:l(()=>[P(F(f.value),1)]),_:1}),t(J,{label:"判题时间"},{default:l(()=>{var ne;return[P(F((ne=u.value)==null?void 0:ne.judgeTime),1)]}),_:1})]),_:1})]),_:1})]),_:1}),(Ie=u.value)!=null&&Ie.compileMessage?(L(),K(V,{key:0,class:"compile-message"},{default:l(()=>{var ne;return[P(F((ne=u.value)==null?void 0:ne.compileMessage),1)]}),_:1})):le("",!0),(B=u.value)!=null&&B.task&&((G=u.value)==null?void 0:G.task.length)>0?(L(),K(N,{key:1,class:"task-panel"},{default:l(()=>{var ne;return[(L(!0),ae(oe,null,ke((ne=u.value)==null?void 0:ne.task,(ee,de)=>(L(),K(O,{key:ee.taskId,header:()=>U(ee)},{default:l(()=>[P(F(ee.content)+" "+F(ee.waHint),1)]),_:2},1032,["header"]))),128))]}),_:1})):le("",!0),w.value?(L(),ae("div",Ro,[t(ye,{onClick:y,loading:i.value},{default:l(()=>z[0]||(z[0]=[P("重新评测")])),_:1},8,["loading"])])):le("",!0)],64)}}}),Wt=ue(Mo,[["__scopeId","data-v-e5da76e3"]]),Eo={style:{margin:"10px"}},qo=re({__name:"ContestList",setup(e){const a=he(),n=Ne(),{globalProperties:r}=me();let s=null;const c=m([{title:"ID",colKey:"id",cell:(C,h)=>t(W,{variant:"text",onClick:()=>v(h.row.id)},{default:()=>[h.row.id]})},{title:"标题",colKey:"title",cell:(C,h)=>t(W,{variant:"text",onClick:()=>v(h.row.id)},{default:()=>[h.row.title]})},{title:"负责人",colKey:"ownerNickname",cell:(C,h)=>t(W,{variant:"text",onClick:()=>Et(n,h.row.ownerUsername)},{default:()=>[h.row.ownerNickname]})},{title:"权限",colKey:"private",cell:(C,h)=>h.row.private?"私有":"公开"},{title:"开始时间",colKey:"startTime"},{title:"结束时间",colKey:"endTime"}]),g=m(!1);let _=1,k=50;const f=m({current:_,pageSize:k,defaultCurrent:_,defaultPageSize:k,total:0,pageSizeOptions:[50,100]}),u=m(),p=m({title:"",username:""}),v=C=>{C&&n.push({path:"/contest/"+C})},b=async()=>{await n.push({query:{...a.query,title:p.value.title,username:p.value.username,page:1,page_size:f.value.defaultPageSize}})},T=async(C,h)=>{var i;g.value=!0;try{const{current:o,pageSize:w}=C,y=await Kn(o,w);if(u.value=[],y.code===0){const $=y.data.list;for(let R=0;R<$.length;R++){const U=$[R],D=await Mt(U);(i=u.value)==null||i.push(D)}f.value={...f.value,total:y.data.total_count}}else h&&H(r,y.code)}catch(o){console.error(o),H(r,ze())}finally{g.value=!1}},d=async C=>{await n.push({query:{...a.query,page:C.current,page_size:C.pageSize}})},S=()=>{n.push({name:"contest-create"})};return ie(async()=>{s=De(()=>a.query,C=>{p.value.title=C.title||"",p.value.username=C.username||"";const h=parseInt(C.page)||f.value.defaultCurrent,i=parseInt(C.page_size)||f.value.defaultPageSize;_=h,k=i,f.value={...f.value,current:_,pageSize:k},T({current:_,pageSize:k},!0)},{immediate:!0})}),Pe(()=>{s&&s()}),(C,h)=>{const i=Ve,o=fe,w=Se,y=Ae,$=Ue,R=W,U=$e,D=be,j=Ce;return L(),K(j,null,{default:l(()=>[t(w,{span:9},{default:l(()=>[t(o,{style:{margin:"10px"}},{default:l(()=>[t(i,{data:u.value,columns:c.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:f.value,loading:g.value,"table-layout":"auto",onPageChange:d},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(w,{span:3},{default:l(()=>[A("div",Eo,[t(o,{class:"sh-card"},{default:l(()=>[t(U,{model:p.value},{default:l(()=>[t($,{label:"标题"},{default:l(()=>[t(y,{modelValue:p.value.title,"onUpdate:modelValue":h[0]||(h[0]=E=>p.value.title=E),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t($,{label:"负责人"},{default:l(()=>[t(y,{modelValue:p.value.username,"onUpdate:modelValue":h[1]||(h[1]=E=>p.value.username=E),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t($,null,{default:l(()=>[t(R,{theme:"primary",onClick:b},{default:l(()=>h[2]||(h[2]=[P("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(o,{class:"sh-card"},{default:l(()=>[t(D,null,{default:l(()=>[t(R,{onClick:S},{default:l(()=>h[3]||(h[3]=[P("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),Xt=ue(qo,[["__scopeId","data-v-98239b6b"]]),Ko={style:{margin:"20px"}},Fo={style:{margin:"10px"}},No={style:{"text-align":"center","align-content":"center",padding:"20px",height:"500px"}},Oo={style:{"text-align":"center",width:"100%"}},Go={class:"dida-operation-container"},Ho={style:{margin:"12px"}},Bo=["innerHTML"],Jo=re({__name:"ContestDetail",setup(e){let a=he();const{globalProperties:n}=me(),r=Ke(),s=Le();let c=0;const g=m(!1),_=m(null),k=m(!1),f=m(!1),u=m(""),p=Fe(()=>s.hasAuth(Ee.ManageContest)||_.value&&s.getUserId==_.value.ownerId),v=o=>{if(!o||!d)return"default";const w=d[o];if(!w)return"default";switch(w){case Je.Accept:return"success";case Je.Attempt:return"warning";default:return"default"}},b=m([{title:"问题ID",colKey:"index",cell:(o,w)=>{const y=v(w.row.index);return t(W,{variant:"dashed",theme:y,onClick:async()=>await Lt(c,w.row.index)},{default:()=>[w.row.id]})}},{title:"标题",colKey:"title",cell:(o,w)=>t(W,{variant:"text",onClick:async()=>await Lt(c,w.row.index)},{default:()=>[w.row.title]})},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),T=m([]);let d={},S=m(!1);const C=()=>{Q.push({name:"contest-edit",params:{contestId:c}})},h=async o=>{if(!s.isLogin()){await Q.push({name:"login"});return}if(!u.value){_e(n,"请输入密码");return}S.value=!0;try{const w=await Gn(c,u.value);if(w.code!==0){H(n,w.code);return}ve(n,"申请访问成功"),await i()}catch(w){console.error("Error submitting contest password:",w),H(n,"提交密码失败，请稍后再试")}finally{S.value=!1}},i=async()=>{g.value=!0;const o=await Rn(c);if(o.code!==0){g.value=!1,H(n,o.code),await Q.push({name:"contest"});return}k.value=o.data.has_auth,f.value=o.data.need_password,_.value=await Mt(o.data.contest),T.value=_.value.problems,d=o.data.attempt_status||{},r.setTitle(_.value.title+" - "+r.getTitle),await qe(()=>{const w=document.querySelectorAll(".dida-content-description");w&&w.length>0&&w.forEach(y=>{ge.mathRender(y),ge.highlightRender({lineNumber:!0,enable:!0},y),tt(y)}),g.value=!1})};return ie(async()=>{if(Array.isArray(a.params.contestId)?c=Number(a.params.contestId[0]):c=Number(a.params.contestId),!c){await Q.push({name:"contest"});return}await i()}),(o,w)=>{const y=Dt,$=Ve,R=fe,U=Ae,D=Ue,j=W,E=$e,z=Se,I=be,x=Ge,V=Oe,M=Ce,J=xe;return L(),K(J,{loading:g.value},{default:l(()=>[t(M,{class:"dida-main-content"},{default:l(()=>[t(z,{span:6},{default:l(()=>{var X,q,O;return[A("div",Ko,[A("h1",null,F((X=_.value)==null?void 0:X.title),1),(q=_.value)!=null&&q.notification?(L(),K(y,{key:0,theme:"info",message:(O=_.value)==null?void 0:O.notification},null,8,["message"])):le("",!0)]),A("div",Fo,[k.value?(L(),K(R,{key:0},{default:l(()=>[t($,{data:T.value,columns:b.value,"row-key":"id","table-layout":"auto","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1})):(L(),K(R,{key:1},{default:l(()=>[A("div",No,[t(y,{theme:"warning",message:"您没有查看本比赛的权限"}),f.value?(L(),K(E,{key:0,style:{margin:"20px auto 0",width:"200px"},onSubmit:h,"label-width":"0"},{default:l(()=>[t(D,null,{default:l(()=>[t(U,{placeholder:"请输入密码",value:u.value,"onUpdate:value":w[0]||(w[0]=N=>u.value=N),style:{width:"300px"},type:"password",autocomplete:"new-password"},null,8,["value"])]),_:1}),t(D,null,{default:l(()=>[A("div",Oo,[t(j,{theme:"primary",type:"submit",loading:ce(S)},{default:l(()=>w[1]||(w[1]=[P("提交")])),_:1},8,["loading"])])]),_:1})]),_:1})):le("",!0)])]),_:1}))])]}),_:1}),t(z,{span:6},{default:l(()=>{var X;return[A("div",Go,[t(I,null,{default:l(()=>[p.value?(L(),K(j,{key:0,onClick:C},{default:l(()=>w[2]||(w[2]=[P("编辑")])),_:1})):le("",!0)]),_:1})]),A("div",Ho,[t(V,{layout:"vertical",bordered:!0},{default:l(()=>[t(x,{label:"开始时间"},{default:l(()=>{var q;return[P(F((q=_.value)==null?void 0:q.startTime),1)]}),_:1})]),_:1}),t(V,{layout:"vertical",bordered:!0},{default:l(()=>[t(x,{label:"结束时间"},{default:l(()=>{var q;return[P(F((q=_.value)==null?void 0:q.endTime),1)]}),_:1})]),_:1})]),(X=_.value)!=null&&X.description?(L(),K(R,{key:0,style:{margin:"12px"}},{default:l(()=>{var q;return[A("div",{innerHTML:(q=_.value)==null?void 0:q.description,class:"dida-content-description"},null,8,Bo)]}),_:1})):le("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),Wo=ue(Jo,[["__scopeId","data-v-598a2cb7"]]);function Ia(e){return e?Math.floor(e/1e9):0}function nt(e){if(e<=0)return"0秒";let a="";const n=Math.floor(e/3600);n>0&&(a+=`${n}小时`);const r=Math.floor(e%3600/60);return(r>0||n>0)&&(n>0&&r<10&&(a+="0"),a+=`${r}分钟`),e=e%60,(e>0||r>0||n>0)&&((n>0||r>0)&&e<10&&(a+="0"),a+=`${e.toFixed(0)}秒`),a}const Xo=rt("contest",{state:()=>({starMembers:{}}),actions:{clear(){this.$patch({starMembers:{}})},addStarMember(e,a){this.starMembers[e]||(this.starMembers[e]={}),this.starMembers[e][a]=!0},removeStarMember(e,a){this.starMembers[e]&&(delete this.starMembers[e][a],Object.keys(this.starMembers[e]).length===0&&delete this.starMembers[e])},isStarMember(e,a){var n;return!!((n=this.starMembers[e])!=null&&n[a])}},persist:!0}),Yo={style:{margin:"10px 10px 40px"}},Zo={style:{"text-align":"right","margin-bottom":"10px"}},Qo={class:"table-scroll-wrapper"};function Yt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ye(e)}const es=re({__name:"ContestRank",setup(e){const a=he(),n=Ne(),r=Xo(),{globalProperties:s}=me();let c=!1,g=null,_=0,k=null,f=null,u=0;const p=m(0),v=m(0),b=m(!1),T=m(!0),d=m(!0);let S=null,C=null,h=1,i=50;const o=m({current:h,pageSize:i,defaultCurrent:1,defaultPageSize:50,total:0,pageSizeOptions:[50,100,1e3]}),w=B=>r&&r.isStarMember(_,B),y=async B=>{o.value={...o.value,current:B.current,pageSize:B.pageSize},await n.push({query:{...a.query,page:B.current,page_size:B.pageSize}})},$=B=>{if(B==null)return"-";const G=Math.floor(B/3600).toString().padStart(2,"0"),ne=Math.floor(B%3600/60).toString().padStart(2,"0"),ee=(B%60).toFixed(0).toString().padStart(2,"0");return`${G}:${ne}:${ee}`},R=m({}),U=[{title:"Rank",colKey:"rank",align:"center",fixed:"left"},{title:"昵称",colKey:"nickname",fixed:"left",attrs:B=>{let G={};return w(B.row.userId)&&(G={backgroundColor:"rgba(255,165,30,0.5)"}),{style:G}},cell:(B,G)=>{const ne=El(G.row.nickname,18);let ee=null;return w(G.row.userId)?ee=t(W,{shape:"circle",variant:"text",class:"rank-unstar-button",onClick:()=>{r.removeStarMember(_,G.row.userId),N()}},{default:()=>[t(Ma,{slot:"icon"},null)]}):ee=t(W,{shape:"circle",variant:"text",class:"rank-star-button",onClick:()=>{r.addStarMember(_,G.row.userId),N()}},{default:()=>[t(Ea,{slot:"icon"},null)]}),t("div",{class:"rank-nickname-cell"},[t(be,null,{default:()=>[t(nl,{content:G.row.nickname},{default:()=>[t(W,{variant:"text",onClick:()=>n.push({name:"user",params:{username:G.row.username}})},Yt(ne)?ne:{default:()=>[ne]})]}),ee]})])}},{title:"Solved",colKey:"solved",align:"center",fixed:"left",cell:(B,G)=>t(W,{variant:"text",onClick:()=>n.push({name:"contest-judge",params:{contestId:_},query:{username:G.row.username,status:je.Accept}})},{default:()=>[G.row.solved]})},{title:"Penalty",colKey:"penalty",align:"center",fixed:"left",cell:(B,G)=>$(G.row.penalty)}],D=m([]),j=m(!1);let E=[],z=[];const I=m([]);let x=[];const V=({col:B,rowIndex:G})=>{if(B.colKey==="rank"){let ne=o.value.current;o.value.current>Math.ceil(I.value.length/o.value.pageSize)&&(ne=Math.ceil(I.value.length/o.value.pageSize));let ee=o.value.pageSize*(ne-1),de=1;for(let se=G+1;ee+se<I.value.length&&I.value[ee+se].rank===I.value[ee+G].rank;se++)de++;return{rowspan:de}}},M=(B,{value:G})=>nt(G),J=()=>{S&&clearInterval(S),S=setInterval(()=>{c&&Ie(!1)},3e4),C&&clearInterval(C),C=setInterval(()=>{if(!c)return;p.value=(new Date().getTime()-k.getTime())/1e3;const B=Math.min(p.value,v.value);p.value=Math.min(p.value,B),N()},1e3)},X=()=>{S&&(clearInterval(S),S=null),C&&(clearInterval(C),C=null)},q=async B=>{d.value=B,B?(await Ie(!1),J()):X()},O=()=>{N(),o.value={...o.value,current:1}},N=()=>{I.value=[];let B=[];for(let Y=0;Y<E.length;Y++){const pe=E[Y];let Re={userId:pe.author_id,username:pe.author_username,nickname:pe.author_nickname},We=0,Me=0;pe.problems.forEach(He=>{let Qe=-1,lt=He.lock||0;if(He.ac){if(Qe=(new Date(He.ac).getTime()-(k==null?void 0:k.getTime()))/1e3,Qe>p.value)return;We++,Me+=Qe,Me+=He.attempt*20*60}if(lt>0&&u>0){const Da=v.value-u;p.value<Da&&(lt=0)}const mt=He.index;Re[`problem_${mt}`]={acDuration:Qe,attempt:He.attempt||0,lock:lt}}),Re.solved=We,Re.penalty=Me,B.push(Re)}B.sort((Y,pe)=>Y.solved!==pe.solved?pe.solved-Y.solved:Y.penalty!==pe.penalty?Y.penalty-pe.penalty:Y.userId-pe.userId);const G=z;let ne=0,ee=0,de=-1,se=-1;for(let Y=0;Y<B.length;Y++)G&&G.includes(B[Y].userId)?B[Y].rank="*":(ee++,(B[Y].solved!==de||B[Y].penalty!==se)&&(ne=ee,de=B[Y].solved,se=B[Y].penalty),B[Y].rank=String(ne));b.value&&(B=B.filter(Y=>w(Y.userId)));const te=document.querySelectorAll("tbody tr"),we={};x.forEach((Y,pe)=>{const Re=te[pe];Re&&(we[Y.userId]=Re.getBoundingClientRect())}),o.value={...o.value,total:B.length},I.value=B;for(let Y=0;Y<I.value.length;Y++)I.value[Y].index=Y+1;if(x=[...I.value],T.value){const Y={},pe=document.querySelectorAll("table tbody tr");I.value.forEach((Re,We)=>{const Me=pe[We];Me&&(Y[Re.userId]=Me.getBoundingClientRect())}),requestAnimationFrame(()=>{const Re=document.querySelectorAll("table tbody tr");I.value.forEach((We,Me)=>{const He=Re[Me],Qe=we[We.userId],lt=Y[We.userId];if(Qe&&lt){const mt=Qe.top-lt.top;mt!==0&&(He.style.transition="none",He.style.transform=`translateY(${mt}px)`)}}),requestAnimationFrame(()=>{document.querySelectorAll("table tbody tr").forEach(Me=>{Me.style.transition="transform 300ms ease",Me.style.transform=""})})})}},ye=B=>{q(!1),p.value=B;const G=Math.min(v.value,(new Date().getTime()-(k==null?void 0:k.getTime()))/1e3);p.value=Math.min(p.value,G),N()},Ie=async B=>{B&&(j.value=!0);try{const G=await Fn(_);if(D.value=[...U],E=[],z=[],I.value=[],o.value={...o.value,total:0},G.code===0){if(!G.data.has_auth){ve(s,"您目前没有权限查看比赛排名"),await n.push({name:"contest-detail",params:{contestId:_}});return}G.data.problems.sort((de,se)=>de-se),G.data.problems.forEach((de,se)=>{D.value.push({colKey:`problem_${de}`,align:"center",title:()=>{let te;return t(W,{variant:"text",onClick:()=>n.push({name:"contest-problem-detail",params:{contestId:_,problemIndex:de}})},Yt(te=Xe(de))?te:{default:()=>[te]})},cell:(te,we)=>{const Y=we.row[`problem_${de}`];if(!Y)return"";let pe="";return Y.acDuration>=0&&(pe=$(Y.acDuration)),Y.attempt>0&&(pe&&(pe+=" "),pe+=`(-${Y.attempt})`),Y.lock>0&&(pe&&(pe+=" "),pe+=`(+${Y.lock})`),t("span",null,[pe])},attrs:te=>{const we=te.row[`problem_${de}`];return we?we.acDuration>=0?{style:{backgroundColor:"rgba(130,255,30,0.5)"}}:we.lock>0?{style:{backgroundColor:"rgb(255,180,50,0.5)"}}:we.attempt>0?{style:{backgroundColor:"rgba(255,120,120,0.5)"}}:{}:{}}})});const ne=G.data.contest;if(k=new Date(ne.start_time),f=new Date(ne.end_time),E=G.data.ranks,z=G.data.v_members||[],v.value=Math.floor((f.getTime()-k.getTime())/1e3),R.value={0:"0",[Math.floor(v.value/2)]:nt(Math.floor(v.value/2)),[v.value]:nt(v.value)},u=Ia(ne.lock_rank_duration||0),G.data.is_locked&&u>0){const de=Math.max(0,v.value-u);R.value[de]=t("span",{style:"color: #0052d9"},[P("锁榜("),nt(de),P(")")])}p.value=Math.floor((new Date().getTime()-k.getTime())/1e3);const ee=Math.min(p.value,v.value);p.value=Math.min(p.value,ee),d.value=!0,J(),N()}else B&&H(s,G.code)}catch(G){console.error(G),B&&H(s,ze())}finally{B&&(j.value=!1)}};return ie(async()=>{c=!0,g=De(()=>a.query,async B=>{if(Array.isArray(a.params.contestId)?_=Number(a.params.contestId[0]):_=Number(a.params.contestId),!_){await n.push({name:"contest"});return}const G=parseInt(B.page)||o.value.defaultCurrent,ne=parseInt(B.page_size)||o.value.defaultPageSize;h=G,i=ne,o.value={...o.value,current:h,pageSize:i},await Ie(!0)},{immediate:!0})}),Pe(()=>{c=!1,g&&g(),X()}),(B,G)=>{const ne=ut,ee=be,de=ll,se=Ve,te=fe,we=Ce;return L(),K(we,null,{default:l(()=>[t(te,{style:{margin:"10px",width:"100%"}},{default:l(()=>[A("div",Yo,[A("div",Zo,[t(ee,null,{default:l(()=>[t(ne,{size:"large",modelValue:b.value,"onUpdate:modelValue":G[0]||(G[0]=Y=>b.value=Y),onChange:O},{label:l(Y=>[P(F(Y.value?"仅展示收藏":"未过滤收藏"),1)]),_:1},8,["modelValue"]),t(ne,{size:"large",modelValue:T.value,"onUpdate:modelValue":G[1]||(G[1]=Y=>T.value=Y)},{label:l(Y=>[P(F(Y.value?"开启动画":"关闭动画"),1)]),_:1},8,["modelValue"]),t(ne,{size:"large",modelValue:d.value,"onUpdate:modelValue":G[2]||(G[2]=Y=>d.value=Y),onChange:q},{label:l(Y=>[P(F(Y.value?"自动刷新":"关闭刷新"),1)]),_:1},8,["modelValue"])]),_:1})]),t(de,{modelValue:p.value,"onUpdate:modelValue":G[3]||(G[3]=Y=>p.value=Y),marks:R.value,max:v.value,label:M,"tooltip-props":{placement:"top"},"input-number-props":{theme:"column",autoWidth:!0,format:ce(nt),onChange:ye},onChangeEnd:ye},null,8,["modelValue","marks","max","input-number-props"])]),A("div",Qo,[t(se,{data:I.value,columns:D.value,"row-key":"index","vertical-align":"middle",bordered:!0,hover:!0,"table-layout":"auto","rowspan-and-colspan":V,loading:j.value,class:"dida-contest-rank-table",pagination:o.value,onPageChange:y},null,8,["data","columns","loading","pagination"])])]),_:1})]),_:1})}}}),ts=ue(es,[["__scopeId","data-v-838e6c28"]]),as={style:{margin:"10px"}},ls={style:{margin:"12px"}},ns={class:"dida-edit-container"},os=re({__name:"ContestEdit",setup(e){let a=he();const{globalProperties:n}=me(),r=Ke(),s=m(""),c=m(!1);let g=null;const _=m(!1),k=m(!1),f=m(null),u=m({title:"",openTime:[],private:!0,password:"",problems:[],members:[],description:"",notification:"",lockRankDuration:0,alwaysLock:!0,submitAnytime:!1}),p=m(""),v=m(""),b=m(!1),T=async()=>{b.value=!0,k.value=!1,b.value=!1},d=async()=>{if(g){_.value=!0;try{const i={title:u.value.title,description:g.getValue(),notification:u.value.notification,lock_rank_duration:u.value.lockRankDuration,always_lock:u.value.alwaysLock,problems:u.value.problems,members:u.value.members,private:u.value.private,password:u.value.password,submit_anytime:u.value.submitAnytime};u.value.openTime[0]&&(i.start_time=new Date(u.value.openTime[0])),u.value.openTime[1]&&(i.end_time=new Date(u.value.openTime[1]));const o=await Nn(i);if(_.value=!0,o.code!==0){H(n,o.code);return}o.data!=null&&await Q.push({name:"contest-detail",params:{contestId:o.data}}),Be(n,"创建成功")}finally{_.value=!1}}},S=async()=>{if(g){_.value=!0;try{const i={id:Number(s.value),title:u.value.title,description:g.getValue(),notification:u.value.notification,lock_rank_duration:u.value.lockRankDuration,always_lock:u.value.alwaysLock,problems:u.value.problems,members:u.value.members,private:u.value.private,password:u.value.password,submit_anytime:u.value.submitAnytime};u.value.openTime[0]&&(i.start_time=new Date(u.value.openTime[0])),u.value.openTime[1]&&(i.end_time=new Date(u.value.openTime[1]));const o=await On(i);if(_.value=!0,o.code!==0){H(n,o.code);return}o.data!=null&&f.value&&(f.value.updateTime=new Date(o.data).toLocaleString()),Be(n,"保存成功")}finally{_.value=!1}}},C=i=>{const o={after:()=>{g==null||g.setValue(i),c.value=!1},preview:{math:{inlineDigit:!0,engine:"KaTeX"}}};g=new ge("contestEditDiv",o)},h=async()=>{const i=await Mn(s.value);if(i.code!==0){H(n,i.code),console.error("contest get failed",i.code),await Q.push({name:"contest-list"});return}const o=i.data.contest;f.value=await Mt(o),u.value.title=o.title,u.value.openTime=[],o.start_time?u.value.openTime.push(new Date(o.start_time)):u.value.openTime.push(""),o.end_time?u.value.openTime.push(new Date(o.end_time)):u.value.openTime.push(""),u.value.private=o.private,u.value.password=o.password||"",u.value.description=o.description||"",u.value.notification=o.notification||"",u.value.problems=i.data.problems,u.value.members=i.data.members,o.lock_rank_duration?u.value.lockRankDuration=Ia(o.lock_rank_duration):u.value.lockRankDuration=0,u.value.alwaysLock=o.always_lock,u.value.submitAnytime=o.submit_anytime,r.setTitle(o.title+" - "+r.getTitle);let w="";o.description&&(w=o.description),C(w)};return ie(async()=>{Array.isArray(a.params.contestId)?s.value=a.params.contestId[0]:s.value=a.params.contestId,s.value?(c.value=!0,await h()):C("")}),(i,o)=>{const w=Ae,y=Ue,$=ca,R=ut,U=da,D=$e,j=fe,E=Se,z=W,I=be,x=Ge,V=Oe,M=Ce,J=xe,X=kt,q=Ze;return L(),ae(oe,null,[t(J,{loading:c.value},{default:l(()=>[t(M,null,{default:l(()=>[t(E,{span:8},{default:l(()=>[A("div",as,[t(j,{class:"sh-card"},{default:l(()=>[t(D,{model:u.value,"label-width":"150px"},{default:l(()=>[t(y,{label:"标题"},{default:l(()=>[t(w,{modelValue:u.value.title,"onUpdate:modelValue":o[0]||(o[0]=O=>u.value.title=O),placeholder:"比赛标题"},null,8,["modelValue"])]),_:1}),t(y,{label:"通知"},{default:l(()=>[t(w,{modelValue:u.value.notification,"onUpdate:modelValue":o[1]||(o[1]=O=>u.value.notification=O),placeholder:"会更为醒目地提醒"},null,8,["modelValue"])]),_:1}),t(y,{label:"开启时间"},{default:l(()=>[t($,{modelValue:u.value.openTime,"onUpdate:modelValue":o[2]||(o[2]=O=>u.value.openTime=O),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(y,{label:"提交限制"},{default:l(()=>[t(R,{modelValue:u.value.submitAnytime,"onUpdate:modelValue":o[3]||(o[3]=O=>u.value.submitAnytime=O)},{label:l(O=>[P(F(O.value?"结束仍能提交":"仅比赛期间提交"),1)]),_:1},8,["modelValue"])]),_:1}),t(y,{label:"锁榜时长"},{default:l(()=>[t(U,{modelValue:u.value.lockRankDuration,"onUpdate:modelValue":o[4]||(o[4]=O=>u.value.lockRankDuration=O),min:0,format:ce(nt),"auto-width":""},null,8,["modelValue","format"])]),_:1}),t(y,{label:"自动解锁"},{default:l(()=>[t(R,{modelValue:u.value.alwaysLock,"onUpdate:modelValue":o[5]||(o[5]=O=>u.value.alwaysLock=O)},{label:l(O=>[P(F(O.value?"结束后仍锁榜":"结束后解锁"),1)]),_:1},8,["modelValue"])]),_:1}),t(y,{label:"私有"},{default:l(()=>[t(R,{modelValue:u.value.private,"onUpdate:modelValue":o[6]||(o[6]=O=>u.value.private=O)},null,8,["modelValue"])]),_:1}),u.value.private?(L(),K(y,{key:0,label:"密码"},{default:l(()=>[t(w,{modelValue:u.value.password,"onUpdate:modelValue":o[7]||(o[7]=O=>u.value.password=O),type:"password",placeholder:"请输入访问密码，留空代表关闭密码访问"},null,8,["modelValue"])]),_:1})):le("",!0),u.value.private?(L(),K(y,{key:1,label:"成员"},{default:l(()=>[t(Sa,{modelValue:u.value.members,"onUpdate:modelValue":o[8]||(o[8]=O=>u.value.members=O)},null,8,["modelValue"])]),_:1})):le("",!0),t(y,{label:"问题"},{default:l(()=>[t(Ca,{modelValue:u.value.problems,"onUpdate:modelValue":o[9]||(o[9]=O=>u.value.problems=O)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(E,{span:4},{default:l(()=>[A("div",ls,[A("div",ns,[s.value?(L(),K(I,{key:0},{default:l(()=>[t(z,{onClick:S,theme:"danger",loading:_.value},{default:l(()=>o[12]||(o[12]=[P("保存")])),_:1},8,["loading"])]),_:1})):(L(),K(I,{key:1},{default:l(()=>[t(z,{onClick:d,theme:"danger",loading:_.value},{default:l(()=>o[13]||(o[13]=[P("创建")])),_:1},8,["loading"])]),_:1}))]),s.value?(L(),K(V,{key:0,layout:"vertical",bordered:!0},{default:l(()=>[t(x,{label:"创建时间"},{default:l(()=>{var O;return[P(F((O=f.value)==null?void 0:O.createTime),1)]}),_:1}),t(x,{label:"更新时间"},{default:l(()=>{var O;return[P(F((O=f.value)==null?void 0:O.updateTime),1)]}),_:1}),t(x,{label:"创建用户"},{default:l(()=>{var O;return[P(F((O=f.value)==null?void 0:O.ownerNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),o[14]||(o[14]=A("div",{id:"contestEditDiv",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"]),t(q,{visible:k.value,"onUpdate:visible":o[11]||(o[11]=O=>k.value=O),onConfirm:T,header:p.value,"confirm-loading":b.value},{default:l(()=>[o[15]||(o[15]=A("div",{style:{"margin-bottom":"10px"}},[A("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(X,{modelValue:v.value,"onUpdate:modelValue":o[10]||(o[10]=O=>v.value=O),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),Zt=ue(os,[["__scopeId","data-v-77e745ac"]]);function Pa(e){const a={};return a.id=e.id,a.authorId=e.author_id,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.title=e.title,a.content=e.content,e.insert_time&&(a.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(a.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(a.updateTime=new Date(e.update_time).toLocaleString()),a.problemId=e.problem_id,a.problemTitle=e.problem_title,a.contestId=e.contest_id,a.contestTitle=e.contest_title,a.contestProblemIndex=e.contest_problem_index,a}async function ss(e){const a={};if(a.id=e.id,a.authorId=e.author_id,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.content="",e.content){const n={math:{inlineDigit:!0,engine:"KaTeX"}};a.content=await ge.md2html(e.content,n)}return e.insert_time&&(a.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(a.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(a.updateTime=new Date(e.update_time).toLocaleString()),a}function rs(e){return Z({url:"/discuss?id="+e,method:"get"})}function us(e,a,n,r,s,c){const g={};return e&&(g.contest_id=e),a&&(g.problem_id=a),n&&(g.title=n),r&&(g.username=r),s&&(g.page=s),c&&(g.page_size=c),Z({url:`/discuss/list?${new URLSearchParams(g).toString()}`,method:"get"})}function is(e,a,n){return Z({url:"/discuss/comment/list?id="+e+"&page="+a+"&page_size="+n,method:"get"})}function cs(e){return Z({url:"/discuss/create",method:"post",data:e})}const ds={style:{margin:"10px"}};function ms(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ye(e)}const ps=re({__name:"DiscussList",setup(e){const a=he(),n=Ne(),{globalProperties:r}=me();let s=null;const c=m(!1),g=m(!1);let _=-1;const k=m([]),f=[],u=[{title:"标题",colKey:"title",cell:(D,j)=>t(W,{variant:"text",onClick:()=>o(j.row.id)},{default:()=>[j.row.title]})},{title:"创建人",colKey:"authorNickname",width:"200",cell:(D,j)=>t(W,{variant:"text",onClick:async()=>await Et(n,j.row.authorUsername)},{default:()=>[j.row.authorNickname]})},{title:"创建时间",colKey:"insertTime",width:"180"},{title:"更新时间",colKey:"updateTime",width:"180"}],p=m(!1);let v=1,b=50;const T=m({current:v,pageSize:b,defaultCurrent:v,defaultPageSize:b,total:0,pageSizeOptions:[50,100]}),d=m(),S=m({problemId:"",title:"",username:""}),C=m({title:"",content:""}),h=D=>{D&&n.push({name:"problem-detail",params:{problemId:D}})},i=(D,j)=>{n.push({name:"contest-problem-detail",params:{contestId:D,problemIndex:j}})},o=D=>{if(D){if(_){n.push({name:"contest-discuss-detail",params:{contestId:_,discussId:D}});return}n.push({name:"discuss-detail",params:{discussId:D}})}},w=async()=>{await n.push({query:{...a.query,problem_id:S.value.problemId,title:S.value.title,username:S.value.username,page:1,page_size:T.value.defaultPageSize}})},y=async(D,j)=>{var E;p.value=!0;try{const{current:z,pageSize:I}=D,x=await us(_,S.value.problemId,S.value.title,S.value.username,z,I);if(d.value=[],x.code===0){if(!x.data.has_auth){ve(r,"您目前没有权限查看讨论列表"),_?await n.push({name:"contest-detail",params:{contestId:_}}):await n.push({name:"discuss-list"});return}if(x.data.list){const V=x.data.list;for(let M=0;M<V.length;M++){const J=V[M],X=await Pa(J);(E=d.value)==null||E.push(X)}}T.value={...T.value,total:x.data.total_count}}else j&&H(r,x.code)}catch(z){console.error(z),H(r,ze())}finally{p.value=!1}},$=async D=>{await n.push({query:{...a.query,page:D.current,page_size:D.pageSize}})},R=()=>{c.value=!0},U=async()=>{g.value=!0,console.log("discussCreateForm",C.value),cs(C.value).then(D=>{D.code===0?(ve(r,"创建比赛成功"),c.value=!1,n.push({path:"/discuss/"+D.data.id})):H(r,D.code)}).finally(()=>{g.value=!1})};return ie(async()=>{s=De(()=>a.query,D=>{Array.isArray(a.params.contestId)?_=Number(a.params.contestId[0]):_=Number(a.params.contestId),k.value=f,_?k.value=k.value.concat([{title:"问题ID",colKey:"contestProblemIndex",width:"100",cell:(z,I)=>{let x;return I.row.contestProblemIndex?t(W,{variant:"text",onClick:()=>i(_,I.row.contestProblemIndex)},ms(x=Xe(I.row.contestProblemIndex))?x:{default:()=>[x]}):""}}]):k.value=k.value.concat([{title:"问题ID",colKey:"problemId",width:"100",cell:(z,I)=>I.row.problemId?t(W,{variant:"text",onClick:()=>h(I.row.problemId)},{default:()=>[I.row.problemId]}):""}]),k.value=k.value.concat(u),S.value.problemId=D.problem_id||"",S.value.title=D.title||"",S.value.username=D.username||"";const j=parseInt(D.page)||T.value.defaultCurrent,E=parseInt(D.page_size)||T.value.defaultPageSize;v=j,b=E,T.value={...T.value,current:v,pageSize:b},y({current:v,pageSize:b},!0)},{immediate:!0})}),Pe(()=>{s&&s()}),(D,j)=>{const E=Ve,z=fe,I=Se,x=Ae,V=Ue,M=W,J=$e,X=be,q=Ce,O=Ze;return L(),ae(oe,null,[t(q,null,{default:l(()=>[t(I,{span:9},{default:l(()=>[t(z,{style:{margin:"10px"}},{default:l(()=>[t(E,{data:d.value,columns:k.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:T.value,loading:p.value,"table-layout":"auto",onPageChange:$},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(I,{span:3},{default:l(()=>[A("div",ds,[t(z,{class:"sh-card"},{default:l(()=>[t(J,{model:S.value},{default:l(()=>[t(V,{label:"问题ID"},{default:l(()=>[t(x,{modelValue:S.value.problemId,"onUpdate:modelValue":j[0]||(j[0]=N=>S.value.problemId=N),placeholder:"请输入完整问题ID"},null,8,["modelValue"])]),_:1}),t(V,{label:"标题"},{default:l(()=>[t(x,{modelValue:S.value.title,"onUpdate:modelValue":j[1]||(j[1]=N=>S.value.title=N),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(V,{label:"创建人"},{default:l(()=>[t(x,{modelValue:S.value.username,"onUpdate:modelValue":j[2]||(j[2]=N=>S.value.username=N),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(V,null,{default:l(()=>[t(M,{theme:"primary",onClick:w},{default:l(()=>j[6]||(j[6]=[P("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(z,{class:"sh-card"},{default:l(()=>[t(X,null,{default:l(()=>[t(M,{onClick:R},{default:l(()=>j[7]||(j[7]=[P("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),t(O,{visible:c.value,"onUpdate:visible":j[5]||(j[5]=N=>c.value=N),header:"创建讨论",onConfirm:U,"confirm-loading":g.value},{default:l(()=>[t(J,{"label-width":80,model:C.value,onSubmit:j[4]||(j[4]=_t(()=>{},["prevent"]))},{default:l(()=>[t(V,{label:"标题"},{default:l(()=>[t(x,{modelValue:C.value.title,"onUpdate:modelValue":j[3]||(j[3]=N=>C.value.title=N),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),pt=ue(ps,[["__scopeId","data-v-a2987da9"]]),fs={key:0,style:{margin:"20px"}},vs=["innerHTML"],_s=["innerHTML"],gs={style:{margin:"10px"}},bs={style:{margin:"10px"}},hs={style:{margin:"10px","text-align":"right"}},ys={style:{margin:"12px"}},ws={key:0,class:"dida-edit-container"},ks=re({__name:"DiscussDetail",props:{discussId:{}},setup(e){const a=e;let n=he();const{globalProperties:r}=me();let s=null;const c=Ke(),g=Le();let _=m("");const k=m(""),f=m(null),u=m(!1),p=m(null),v=m(!1);let b=1,T=20;const d=m({current:1,total:0,defaultPageSize:T,defaultCurrent:b,pageSizeOptions:[20,50]}),S=m([]),C={},h=Fe(()=>g.hasAuth(Ee.ManageDiscuss)),i=U=>{U&&Q.push({name:"discuss-list",query:{...n.query,title:"",tag:U.name}})},o=()=>{Q.push({name:"manage-discuss",params:{discussId:k.value}})},w=()=>t("div",{class:"t-pagination__total"},[`共 ${d.value.total} 条回复`]),y=()=>{},$=async(U,D)=>{var j;v.value=!0;try{const{current:E,pageSize:z}=U,I=await is(k.value,E,z);if(S.value=[],I.code===0){const x=I.data.list;if(x)for(let V=0;V<x.length;V++){const M=x[V],J=await ss(M);(j=S.value)==null||j.push(J),await qe(()=>{const X=document.querySelectorAll(".dida-discuss-content");X&&X.length>0&&X.forEach(q=>{ge.mathRender(q),ge.highlightRender({lineNumber:!0,enable:!0},q),tt(q)})})}d.value={...d.value,total:I.data.total_count}}else D&&H(r,I.code)}catch(E){console.error(E),H(r,ze())}finally{v.value=!1}},R=async U=>{await Q.push({query:{...n.query,page:U.current,page_size:U.pageSize}})};return ie(async()=>{if(k.value=a.discussId,k.value||(Array.isArray(n.params.discussId)?k.value=n.params.discussId[0]:k.value=n.params.discussId),!k.value){_e(r,"讨论不存在"),await Q.push({name:"discuss"});return}u.value=!0;const U=await rs(k.value);if(U.code!==0){u.value=!1,H(r,U.code),await Q.push({name:"discuss"});return}U.data.tags&&U.data.tags.forEach(z=>{C[z.id]=z}),p.value=Pa(U.data.discuss),c.setTitle(p.value.title+" - "+c.getTitle);let D=p.value.content;const j={math:{inlineDigit:!0,engine:"KaTeX"}};_.value=await ge.md2html(D,j),await qe(()=>{f.value&&(ge.mathRender(f.value),ge.highlightRender({lineNumber:!0,enable:!0},f.value),tt(f.value)),u.value=!1}),s=De(()=>n.query,z=>{const I=parseInt(z.page)||d.value.defaultCurrent,x=parseInt(z.page_size)||d.value.defaultPageSize;b=I,T=x,d.value={...d.value,current:b,pageSize:T},$({current:b,pageSize:T},!0)},{immediate:!0});const E={after:()=>{},preview:{math:{inlineDigit:!0,engine:"KaTeX"}}};new ge("commentEditRef",E)}),Pe(()=>{s&&s()}),(U,D)=>{const j=ua,E=ra,z=fe,I=be,x=ol,V=W,M=Se,J=Ge,X=Oe,q=Ce,O=xe;return L(),K(O,{loading:u.value},{default:l(()=>[t(q,{class:"dida-main-content"},{default:l(()=>[t(M,{span:8},{default:l(()=>{var N,ye,Ie;return[(N=p.value)!=null&&N.problemTitle||(ye=p.value)!=null&&ye.contestTitle?(L(),ae("div",fs,[t(E,{"max-item-width":"300"},{default:l(()=>{var B,G,ne,ee,de;return[(B=p.value)!=null&&B.contestTitle?(L(),ae(oe,{key:0},[t(j,{to:{name:"contest-detail",params:{contestId:(G=p.value)==null?void 0:G.contestId}}},{default:l(()=>{var se;return[P(F((se=p.value)==null?void 0:se.contestTitle),1)]}),_:1},8,["to"]),(ne=p.value)!=null&&ne.contestProblemIndex?(L(),K(j,{key:0,to:{name:"contest-problem-detail",params:{problemIndex:(ee=p.value)==null?void 0:ee.contestProblemIndex}}},{default:l(()=>{var se,te;return[P(F(ce(Xe)((se=p.value)==null?void 0:se.contestProblemIndex))+" - "+F((te=p.value)==null?void 0:te.problemTitle),1)]}),_:1},8,["to"])):le("",!0)],64)):(L(),ae(oe,{key:1},[t(j,{to:{name:"discuss-list-problem"}},{default:l(()=>D[3]||(D[3]=[P(" 问题讨论")])),_:1}),t(j,{to:{name:"problem-detail",params:{problemId:(de=p.value)==null?void 0:de.problemId}}},{default:l(()=>{var se;return[P(F((se=p.value)==null?void 0:se.problemTitle),1)]}),_:1},8,["to"])],64))]}),_:1})])):le("",!0),t(z,{style:{margin:"10px"},header:(Ie=p.value)==null?void 0:Ie.title,"header-bordered":!0},{default:l(()=>[A("div",{innerHTML:ce(_),class:"dida-discuss-content"},null,8,vs)]),_:1},8,["header"]),(L(!0),ae(oe,null,ke(S.value,(B,G)=>(L(),K(z,{key:G,style:{margin:"10px"},"header-bordered":""},{header:l(()=>[t(I,null,{default:l(()=>[A("span",null,F(B.authorNickname),1),A("span",null,F(B.insertTime),1)]),_:2},1024)]),default:l(()=>[A("div",{innerHTML:B.content,class:"dida-discuss-content"},null,8,_s)]),_:2},1024))),128)),A("div",gs,[t(x,{modelValue:d.value.current,"onUpdate:modelValue":D[0]||(D[0]=B=>d.value.current=B),"page-size":d.value.pageSize,"onUpdate:pageSize":D[1]||(D[1]=B=>d.value.pageSize=B),total:d.value.total,"page-size-options":d.value.pageSizeOptions,"show-page-size":!1,"total-content":w,onChange:R},null,8,["modelValue","page-size","total","page-size-options"])]),A("div",bs,[D[5]||(D[5]=A("div",{id:"commentEditRef",class:"dida-comment-editor"},null,-1)),A("div",hs,[t(I,null,{default:l(()=>[t(V,{theme:"primary",onClick:y},{default:l(()=>D[4]||(D[4]=[P("提交")])),_:1})]),_:1})])])]}),_:1}),t(M,{span:4},{default:l(()=>[A("div",ys,[h.value?(L(),ae("div",ws,[t(V,{onClick:o},{default:l(()=>D[6]||(D[6]=[P("编辑")])),_:1})])):le("",!0),t(X,{layout:"vertical",bordered:!0},{default:l(()=>[t(J,{label:"创建时间"},{default:l(()=>{var N;return[P(F((N=p.value)==null?void 0:N.insertTime),1)]}),_:1}),t(J,{label:"编辑时间"},{default:l(()=>{var N;return[P(F((N=p.value)==null?void 0:N.modifyTime),1)]}),_:1}),t(J,{label:"更新时间"},{default:l(()=>{var N;return[P(F((N=p.value)==null?void 0:N.updateTime),1)]}),_:1}),t(J,{label:"创建用户"},{default:l(()=>[t(V,{variant:"text",onClick:D[2]||(D[2]=async()=>{var N;return await ce(Et)(ce(Q),(N=p.value)==null?void 0:N.authorUsername)})},{default:l(()=>{var N;return[P(F((N=p.value)==null?void 0:N.authorNickname),1)]}),_:1})]),_:1}),t(J,{label:"标签"},{default:l(()=>[t(I,null,{default:l(()=>{var N;return[(L(!0),ae(oe,null,ke((N=p.value)==null?void 0:N.tags,ye=>(L(),K(V,{key:ye.id,variant:"dashed",onClick:()=>i(ye)},{default:l(()=>[P(F(ye.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),St=ue(ks,[["__scopeId","data-v-20308f3c"]]);function Cs(e,a){return Z({url:"/rank/ac/all?page="+e+"&page_size="+a,method:"get"})}function Ss(e,a){return Z({url:"/rank/ac/problem?page="+e+"&page_size="+a,method:"get"})}function Is(e,a){return Z({url:"/rank/ac/problem/today?page="+e+"&page_size="+a,method:"get"})}function Ps(e,a){return Z({url:"/rank/ac/problem/day7?page="+e+"&page_size="+a,method:"get"})}function Ts(e,a){return Z({url:"/rank/ac/problem/year?page="+e+"&page_size="+a,method:"get"})}const xs={style:{margin:"10px"}};function It(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ye(e)}const Vs=re({__name:"RankUser",props:{type:{}},setup(e){const a=he(),n=Ne(),{globalProperties:r}=me();let s=null;const c=e,g=m(""),_=m(""),k={all:{header:"统计所有用户在本站的提交记录",content:"优先以AC记录数量排序，如果相同则提交所用次数较少的优先，如果仍相同，注册较早的用户靠前"},problem:{header:"统计所有用户在本站的提交记录",content:"以题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-today":{header:"统计所有用户今日在本站的提交记录",content:"以今日题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-day7":{header:"统计所有用户最近7日在本站的提交记录",content:"以7日题目记录数量排序（从7日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-year":{header:"统计所有用户最近1年在本站的提交记录",content:"以最近1年题目记录数量排序（从365日前的0点开始计算），如果相同，注册较早的用户靠前"}},f=m([]),u=[{title:"序号",colKey:"index"},{title:"用户名",colKey:"username",cell:($,R)=>t(W,{variant:"dashed",onClick:()=>h(R.row.username)},{default:()=>[R.row.username]})},{title:"昵称",colKey:"nickname"},{title:"Slogan",colKey:"slogan"}],p=[{title:"题目数量",colKey:"problem_count",cell:($,R)=>{let U=0;return R.row.problem_count&&(U=R.row.problem_count),t(W,{variant:"dashed",onClick:()=>i(R.row.username)},It(U)?U:{default:()=>[U]})}}],v=[{title:"正确",colKey:"accept",cell:($,R)=>{let U=0;return R.row.accept&&(U=R.row.accept),t(W,{variant:"dashed",onClick:()=>i(R.row.username)},It(U)?U:{default:()=>[U]})}},{title:"提交",colKey:"attempt",cell:($,R)=>{let U=0;return R.row.attempt&&(U=R.row.attempt),t(W,{variant:"dashed",onClick:()=>o(R.row.username)},It(U)?U:{default:()=>[U]})}}],b=m(!1);let T=1,d=50;const S=m({current:T,pageSize:d,defaultCurrent:T,defaultPageSize:d,total:0,pageSizeOptions:[50]}),C=m(),h=$=>{n.push({name:"user",params:{username:$}})},i=$=>{n.push({name:"judge-list",query:{username:$,status:je.Accept}})},o=$=>{n.push({name:"judge-list",query:{username:$}})},w=async($,R)=>{b.value=!0;try{C.value=[];const{current:U,pageSize:D}=$;let j=null;switch(c.type){case"problem":j=await Ss(U,D);break;case"problem-today":j=await Is(U,D);break;case"problem-day7":j=await Ps(U,D);break;case"problem-year":j=await Ts(U,D);break;default:j=await Cs(U,D);break}if(j.code===0){const E=j.data.list;if(!E||E.length<=0){S.value={...S.value,total:0},ve(r,"未找到记录");return}C.value=[];const z=S.value.pageSize*(S.value.current-1);let I=1;E.forEach(x=>{var M;const V=x;V.index=z+I++,(M=C.value)==null||M.push(V)}),S.value={...S.value,total:j.data.total_count}}else R&&H(r,j.code)}catch(U){console.error(U),H(r,ze())}finally{b.value=!1}},y=async $=>{await n.push({query:{...a.query,page:$.current,page_size:$.pageSize}})};return ie(async()=>{b.value=!0,s=De(()=>a.query,$=>{switch(c.type&&k[c.type]?(g.value=k[c.type].header,_.value=k[c.type].content):(g.value=k.all.header,_.value=k.all.content),c.type){case"all":f.value=u.concat(v);break;default:f.value=u.concat(p);break}const R=parseInt($.page)||S.value.defaultCurrent,U=parseInt($.page_size)||S.value.defaultPageSize;T=R,d=U,S.value={...S.value,current:T,pageSize:d},w({current:T,pageSize:d},!0)},{immediate:!0})}),Pe(()=>{s&&s()}),($,R)=>{const U=Ve,D=fe,j=Se,E=Ce;return L(),K(E,null,{default:l(()=>[t(j,{span:9},{default:l(()=>[t(D,{style:{margin:"10px"}},{default:l(()=>[t(U,{data:C.value,columns:f.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:S.value,loading:b.value,"table-layout":"auto",onPageChange:y},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(j,{span:3},{default:l(()=>[A("div",xs,[t(D,{class:"sh-card",header:g.value,"header-bordered":!0},{default:l(()=>[P(F(_.value),1)]),_:1},8,["header"])])]),_:1})]),_:1})}}}),st=ue(Vs,[["__scopeId","data-v-ad6297d7"]]),Ls={class:"judger-status-panel"},Ds={class:"judger-status-panel"};function js(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ye(e)}const zs=re({__name:"SystemStatus",setup(e){const{globalProperties:a}=me(),n=m([]),r=m([]),s=m(!1);let c;const g=f=>{let u="失效",p="danger";const v=new Date,b=new Date(f.updateTime);return v.getTime()-b.getTime()>3e4?(u="离线",p="default"):f.cpuUsage>90?(u="CPU过高",p="warning"):f.memPercent>90?(u="内存过高",p="warning"):(u="在线",p="success"),t(be,null,{default:()=>[t("span",null,[f.key,P(" - "),f.name]),t("span",null,[f.updateTime]),t(et,{theme:p,size:"small"},js(u)?u:{default:()=>[u]})]})},_=async()=>{const f={};for(let h=0;h<n.value.length;h++){const i=n.value[h];f[i.key]={...i}}const u={};for(let h=0;h<r.value.length;h++){const i=r.value[h];u[i.key]={...i}}const p=[],v=[],b=await xl();if(b.code!==0){H(a,b.code);return}const T=b.data.web,d={key:"didaoj"};T.name?d.name=T.name:d.name="-",T.update_time?d.updateTime=new Date(T.update_time).toLocaleString():d.updateTime="-",T.cpu_usage?d.cpuUsage=Number(T.cpu_usage):d.cpuUsage=0,T.mem_usage?d.memUsage=T.mem_usage/(1024*1024*1024):d.memUsage=0,T.mem_total?d.memTotal=T.mem_total/(1024*1024*1024):d.memTotal=0,d.memTotal>0?d.memPercent=Math.round(d.memUsage/d.memTotal*1e4)/100:d.memPercent=0,d.avgMessage=T.avg_message;const S=f[d.key];S?(d.cpuUsageFrom=S.cpuUsage,d.memPercentFrom=S.memPercent,d.memUsageFrom=S.memUsage,d.memTotalFrom=S.memTotal):(d.cpuUsageFrom=0,d.memPercentFrom=0,d.memUsageFrom=0,d.memTotalFrom=0),p.push(d),n.value=p;const C=b.data.judger;for(let h=0;h<C.length;h++){const i=C[h],o={key:i.key,name:i.name};i.name?o.name=i.name:o.name="-",i.update_time?o.updateTime=new Date(i.update_time).toLocaleString():o.updateTime="-",i.cpu_usage?o.cpuUsage=Number(i.cpu_usage):o.cpuUsage=0,i.mem_usage?o.memUsage=i.mem_usage/(1024*1024*1024):o.memUsage=0,i.mem_total?o.memTotal=i.mem_total/(1024*1024*1024):o.memTotal=0,o.memTotal>0?o.memPercent=Math.round(o.memUsage/o.memTotal*1e4)/100:o.memPercent=0,o.avgMessage=i.avg_message,u[i.key]?(o.cpuUsageFrom=u[i.key].cpuUsage,o.memPercentFrom=u[i.key].memPercent,o.memUsageFrom=u[i.key].memUsage,o.memTotalFrom=u[i.key].memTotal):(o.cpuUsageFrom=0,o.memPercentFrom=0,o.memUsageFrom=0,o.memTotalFrom=0),v.push(o)}r.value=v},k=async()=>{await _(),s.value=!1};return ie(async()=>{r.value=[],n.value=[],s.value=!0,await k(),c=setInterval(()=>{k()},5e3)}),Pe(()=>{clearInterval(c)}),(f,u)=>{const p=sl,v=be,b=fe,T=xe;return L(),K(T,{loading:s.value},{default:l(()=>[t(b,{title:"接口状态",class:"judger-status"},{default:l(()=>[A("div",Ls,[(L(!0),ae(oe,null,ke(n.value,d=>(L(),K(b,{key:d.key,header:()=>g(d),class:"judge-status-judger"},{footer:l(()=>[A("span",null," 负载信息："+F(d.avgMessage),1)]),default:l(()=>[t(v,{class:"judge-status-judger"},{default:l(()=>[t(p,{title:"CPU使用率",value:d.cpuUsage,animation:{valueFrom:d.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(p,{title:"内存使用率",value:d.memPercent,animation:{valueFrom:d.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(p,{title:"内存使用量",animation:{valueFrom:d.memUsageFrom,duration:2e3},"animation-start":!0,value:d.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(p,{title:"内存总量",value:d.memTotal,animation:{valueFrom:d.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1}),t(b,{title:"判题机状态",class:"judger-status"},{default:l(()=>[A("div",Ds,[(L(!0),ae(oe,null,ke(r.value,d=>(L(),K(b,{key:d.key,header:()=>g(d),class:"judge-status-judger"},{footer:l(()=>[A("span",null," 负载信息："+F(d.avgMessage),1)]),default:l(()=>[t(v,{class:"judge-status-judger"},{default:l(()=>[t(p,{title:"CPU使用率",value:d.cpuUsage,animation:{valueFrom:d.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(p,{title:"内存使用率",value:d.memPercent,animation:{valueFrom:d.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(p,{title:"内存使用量",animation:{valueFrom:d.memUsageFrom,duration:2e3},"animation-start":!0,value:d.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(p,{title:"内存总量",value:d.memTotal,animation:{valueFrom:d.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1})]),_:1},8,["loading"])}}}),$s=ue(zs,[["__scopeId","data-v-d2b0a05b"]]),Us=re({__name:"ManageJudge",setup(e){const{globalProperties:a}=me(),n=m(!1),r=m(!1),s=m({problemId:"",language:void 0,status:void 0}),c=m(!1),g=m([]);g.value=At();const _=m([]);_.value=ba();const k=async()=>{n.value=!0;try{const p=await bn();if(p.code!==0){H(a,p.code);return}ve(a,"重判成功"),await Q.push({name:"judge-list"})}catch(p){console.error(p),H(a,"重判失败")}finally{n.value=!1}},f=async()=>{if(!s.value.problemId&&!s.value.language&&!s.value.status){H(a,"请输入问题Id");return}c.value=!0;try{const p=await hn(s.value.problemId,s.value.language,s.value.status);if(p.code!==0){H(a,p.code);return}ve(a,"重判成功"),await Q.push({name:"judge-list",query:{problem_id:s.value.problemId,language:s.value.language}})}catch(p){console.error(p),H(a,"重判失败")}finally{c.value=!1}},u=async()=>{r.value=!0;try{const p=await yn();if(p.code!==0){H(a,p.code);return}ve(a,"重判成功"),await Q.push({name:"judge-list"})}catch(p){console.error(p),H(a,"重判失败")}finally{r.value=!1}};return(p,v)=>{const b=W,T=fe,d=Ae,S=Ue,C=jt,h=wt,i=be,o=$e;return L(),ae(oe,null,[t(T,{class:"yj-manage-card",title:"重判最近提交"},{default:l(()=>[t(b,{onClick:k,loading:n.value},{default:l(()=>v[3]||(v[3]=[P("重判")])),_:1},8,["loading"])]),_:1}),t(T,{class:"yj-manage-card",title:"重判指定记录"},{default:l(()=>[t(o,{layout:"inline",onSubmit:f},{default:l(()=>[t(S,{label:"题号"},{default:l(()=>[t(d,{modelValue:s.value.problemId,"onUpdate:modelValue":v[0]||(v[0]=w=>s.value.problemId=w),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(S,{label:"语言"},{default:l(()=>[t(h,{modelValue:s.value.language,"onUpdate:modelValue":v[1]||(v[1]=w=>s.value.language=w),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:l(()=>[(L(!0),ae(oe,null,ke(g.value,w=>(L(),K(C,{key:w.value,value:w.value,label:w.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(S,{label:"状态"},{default:l(()=>[t(h,{modelValue:s.value.status,"onUpdate:modelValue":v[2]||(v[2]=w=>s.value.status=w),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:l(()=>[(L(!0),ae(oe,null,ke(_.value,w=>(L(),K(C,{key:w.value,value:w.value,label:w.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(S,null,{default:l(()=>[t(i,null,{default:l(()=>[t(b,{theme:"primary",type:"submit",loading:c.value},{default:l(()=>v[4]||(v[4]=[P("重判")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(T,{class:"yj-manage-card",title:"重判所有"},{default:l(()=>[t(b,{onClick:u,theme:"danger",loading:r.value},{default:l(()=>v[5]||(v[5]=[P("重判")])),_:1},8,["loading"])]),_:1})],64)}}}),As=ue(Us,[["__scopeId","data-v-6d48cbf2"]]),Rs={style:{margin:"10px"}},Ms={key:1},Es={style:{margin:"12px"}},qs={class:"dida-edit-container"},Ks=re({__name:"ProblemEdit",setup(e){let a=he();const{globalProperties:n}=me(),r=Ke(),s=m(""),c=m(!1);let g=null;const _=m(!1),k=m(null),f=m({title:"",timeLimit:0,memoryLimit:0,source:"",private:!0,tags:[]}),u=m([]),p=m([]),v=Fe(()=>{const w=[],y=u.value;for(let $=0,R=y.length;$<R;$++)y[$].value&&w.push(y[$].value);return w}),b=(w,y)=>{const{trigger:$,index:R,item:U}=y;if($==="clear"&&(u.value=[]),["tag-remove","backspace"].includes($)&&u.value.splice(R,1),$==="enter"){for(let j=0;j<p.value.length;j++){const E=p.value[j];if(E.label===U){for(let z=0;z<u.value.length;z++)if(u.value[z].label===E.label)return;u.value.push(E);return}}const D={label:U,value:U};u.value.push(D),p.value=p.value.concat(D)}},T=(w,{current:y,type:$})=>{if(!y){u.value=$==="check"?p.value.slice(1):[];return}if($==="check"){const R=p.value.find(U=>U.value===y);if(!R)return;u.value.push(R)}else u.value=u.value.filter(R=>R.value!==y)},d=()=>{Q.push({name:"problem-detail",params:{problemId:s.value}})},S=()=>{Q.push({name:"manage-problem-judge",params:{problemId:s.value}})},C=async()=>{if(g){_.value=!0,f.value.tags=[];for(let w=0;w<u.value.length;w++){const y=u.value[w];y&&y.label&&f.value.tags.push(y.label)}try{const w=await In(f.value.title,f.value.timeLimit,f.value.memoryLimit,f.value.source,f.value.private,f.value.tags,g.getValue());if(_.value=!0,w.code!==0){H(n,w.code);return}w.data!=null&&await Q.push({name:"problem-detail",params:{problemId:w.data}}),Be(n,"创建成功")}finally{_.value=!1}}},h=async()=>{if(g){_.value=!0,f.value.tags=[];for(let w=0;w<u.value.length;w++){const y=u.value[w];y&&y.label&&f.value.tags.push(y.label)}try{const w=await Pn(s.value,f.value.title,f.value.timeLimit,f.value.memoryLimit,f.value.source,f.value.private,f.value.tags,g.getValue());if(_.value=!0,w.code!==0){H(n,w.code);return}w.data.update_time!=null&&(k.value.updateTime=new Date(w.data.update_time).toLocaleString()),w.data.description!=null&&(g==null||g.setValue(w.data.description)),Be(n,"保存成功")}finally{_.value=!1}}},i=w=>{const y={after:()=>{g==null||g.setValue(w),c.value=!1},upload:{accept:"image/*,.mp3, .wav, .rar",token:"test",url:"/api/upload/editor",linkToImgUrl:"/api/upload/fetch",filename($){return $.replace(/[^(a-zA-Z0-9\u4e00-\u9fa5\.)]/g,"").replace(/[\?\\/:|<>\*\[\]\(\)\$%\{\}@~]/g,"").replace("/\\s/g","")},async handler($){var U;if(!g)return H(n,"编辑器已失效，请刷新后重试"),null;const R=ve(n,"图片正在上传，请稍候...",0);console.log("正在上传图片",$),g.disabled();for(const D of $){console.log(D);const E=`[正在上传 ⏳ ${((U=crypto.randomUUID)==null?void 0:U.call(crypto))||Math.random().toString(36).substring(2)}]`;let z=E.replace("⏳",'<span class="sh-anim-loop" style="display: inline-block; font-size: 16px;">⏳</span>');g.insertValue(`
${z}
`,!1);const I=await xn(s.value);if(I.code!==0){H(n,I.code);let J=g.getValue();J=J.replace(E,"图片上传失败"),g.setValue(J);continue}const x=I.data.upload_url;await Vn(x,D);const V="![图片]("+I.data.preview_url+")";let M=g.getValue();M=M.replace(E,V),g.setValue(M)}return g.enable(),Ml(n,R),null}},preview:{math:{inlineDigit:!0,engine:"KaTeX"}}};g=new ge("problemEditDiv",y)},o=async()=>{const w=await ya(s.value,void 0,void 0);if(w.code!==0){H(n,w.code),console.error("problem get failed",w.code),await Q.push({name:"problem"});return}const y=w.data.problem;if(k.value=it(y,{}),f.value.title=y.title,f.value.timeLimit=y.time_limit,f.value.memoryLimit=y.memory_limit,f.value.source=y.source,f.value.private=y.private,f.value.tags=[],u.value=[],w.data.tags)for(let R=0;R<w.data.tags.length;R++){const U=w.data.tags[R];U&&U.name&&(f.value.tags.push(U.name),u.value.push({label:U.name,value:U.id}))}r.setTitle(y.title+" - "+r.getTitle);let $=y.description;i($)};return ie(async()=>{Array.isArray(a.params.problemId)?s.value=a.params.problemId[0]:s.value=a.params.problemId,s.value?(c.value=!0,wa(-1).then(async w=>{w.code===0?(w.data.list&&w.data.list.forEach(y=>{p.value.push({label:y.name,value:y.id})}),await o()):(H(n,w.code),console.error("problem tag get failed",w.code),await Q.push({name:"problem"}))}).catch(async w=>{console.error(w),H(n,"获取数据异常"),await Q.push({name:"problem"})})):(f.value.timeLimit=1e3,f.value.memoryLimit=65536,i(""))}),(w,y)=>{const $=Ae,R=Ue,U=da,D=ut,j=ul,E=rl,z=$e,I=fe,x=Se,V=W,M=be,J=Ge,X=Oe,q=Ce,O=xe;return L(),K(O,{loading:c.value},{default:l(()=>[t(q,null,{default:l(()=>[t(x,{span:8},{default:l(()=>[A("div",Rs,[t(I,{class:"sh-card"},{default:l(()=>[t(z,{model:f.value},{default:l(()=>[t(R,{label:"标题"},{default:l(()=>[t($,{modelValue:f.value.title,"onUpdate:modelValue":y[0]||(y[0]=N=>f.value.title=N),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),t(R,{label:"时间限制"},{default:l(()=>[t(U,{modelValue:f.value.timeLimit,"onUpdate:modelValue":y[1]||(y[1]=N=>f.value.timeLimit=N),theme:"normal",min:0},{suffix:l(()=>y[5]||(y[5]=[A("span",null,"ms",-1)])),_:1},8,["modelValue"])]),_:1}),t(R,{label:"内存限制"},{default:l(()=>[t(U,{modelValue:f.value.memoryLimit,"onUpdate:modelValue":y[2]||(y[2]=N=>f.value.memoryLimit=N),theme:"normal",min:0},{suffix:l(()=>y[6]||(y[6]=[A("span",null,"KB",-1)])),_:1},8,["modelValue"])]),_:1}),t(R,{label:"来源"},{default:l(()=>[t($,{modelValue:f.value.source,"onUpdate:modelValue":y[3]||(y[3]=N=>f.value.source=N),placeholder:"请输入题目来源"},null,8,["modelValue"])]),_:1}),t(R,{label:"私有"},{default:l(()=>[t(D,{modelValue:f.value.private,"onUpdate:modelValue":y[4]||(y[4]=N=>f.value.private=N)},null,8,["modelValue"])]),_:1}),t(R,{label:"标签"},{default:l(()=>[t(E,{value:u.value,"allow-input":!0,placeholder:"请选择或输入","tag-input-props":{excessTagsDisplayType:"break-line"},"popup-props":{overlayInnerClassName:["narrow-scrollbar"],overlayInnerStyle:{maxHeight:"280px",overflowY:"auto",overscrollBehavior:"contain",padding:"6px"}},clearable:"",multiple:"",onTagChange:b},{panel:l(()=>[p.value.length?(L(),K(j,{key:0,value:v.value,options:p.value,onChange:T},null,8,["value","options"])):(L(),ae("div",Ms,"暂无数据"))]),suffixIcon:l(()=>[t(ce(qa))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(x,{span:4},{default:l(()=>[A("div",Es,[A("div",qs,[s.value?(L(),K(M,{key:0},{default:l(()=>[t(V,{onClick:h,theme:"danger",loading:_.value},{default:l(()=>y[7]||(y[7]=[P("保存")])),_:1},8,["loading"]),t(V,{onClick:S,theme:"warning"},{default:l(()=>y[8]||(y[8]=[P("判题数据")])),_:1}),t(V,{onClick:d},{default:l(()=>y[9]||(y[9]=[P("查看")])),_:1})]),_:1})):(L(),K(M,{key:1},{default:l(()=>[t(V,{onClick:C,theme:"danger",loading:_.value},{default:l(()=>y[10]||(y[10]=[P("创建")])),_:1},8,["loading"])]),_:1}))]),s.value?(L(),K(X,{key:0,layout:"vertical",bordered:!0},{default:l(()=>[t(J,{label:"创建时间"},{default:l(()=>{var N;return[P(F((N=k.value)==null?void 0:N.insertTime),1)]}),_:1}),t(J,{label:"更新时间"},{default:l(()=>{var N;return[P(F((N=k.value)==null?void 0:N.updateTime),1)]}),_:1}),t(J,{label:"判题方式"},{default:l(()=>{var N;return[P(F((N=k.value)==null?void 0:N.judgeType),1)]}),_:1}),t(J,{label:"上传用户"},{default:l(()=>{var N;return[P(F((N=k.value)==null?void 0:N.creatorNickname),1)]}),_:1})]),_:1})):le("",!0)])]),_:1})]),_:1}),y[11]||(y[11]=A("div",{id:"problemEditDiv",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"])}}}),Qt=ue(Ks,[["__scopeId","data-v-a543c906"]]),Fs={style:{margin:"10px"}},Ns={style:{margin:"12px"}},Os={class:"dida-edit-container"},Gs=re({__name:"ProblemJudge",setup(e){let a=he();const{globalProperties:n}=me(),r=Ke(),s=m(""),c=m(!1),g=m(null);let _=null;const k=m(null),f=m(""),u=m(!1),p=m(!1),v=m([{title:"文件",colKey:"file"},{title:"大小",colKey:"size",width:150,cell:(D,j)=>j.row.size.toFixed(0)+" B"},{title:"最后修改时间",colKey:"lastModified",width:180,cell:(D,j)=>new Date(j.row.lastModified).toLocaleString()},{title:"操作",colKey:"action",width:100,cell:(D,j)=>t(W,{onClick:()=>h(j.row.file)},{default:()=>[P("下载")]})}]),b=m([]),T=Fe(()=>({border:"2px dashed #ccc",borderRadius:"6px",padding:"20px",textAlign:"center",cursor:"pointer",backgroundColor:u.value?"#f0f9ff":"#fff",transition:"background-color 0.2s ease"})),d=Fe(()=>f.value?`已选择：${f.value}`:u.value?"松开文件以上传":"拖拽判题数据压缩包到这里，或点击选择文件"),S=()=>{Q.push({name:"problem-detail",params:{problemId:s.value}})},C=()=>{Q.push({name:"manage-problem",params:{problemId:s.value}})},h=async D=>{const j=await Tn(s.value,D);if(j.code!==0){H(n,j.code);return}const E=document.createElement("a");E.href=j.data,E.target="_blank",E.click(),URL.revokeObjectURL(E.href)},i=async()=>{if(!_){_e(n,"请选择压缩包");return}p.value=!0,Ln(s.value,_).then(async D=>{D.code==0?(k.value.value=null,_=null,f.value="",c.value=!0,Be(n,"上传成功"),await U()):H(n,D.code)}).catch(D=>{console.log(D),n.$message.error({duration:3e3,content:"申请失败"})}).finally(()=>{p.value=!1})},o=()=>{var D;(D=k.value)==null||D.click()},w=D=>{const j=D.target.files[0];j&&(f.value=j.name,_=j)},y=D=>{u.value=!0},$=()=>{u.value=!1},R=D=>{D.preventDefault(),D.stopPropagation(),u.value=!1;const j=D.dataTransfer.files[0];if(j){f.value=j.name;const E=new DataTransfer;E.items.add(j),k.value.files=E.files,_=j}},U=async()=>{const D=await kn(s.value);if(D.code!==0){H(n,D.code),await Q.push({name:"problem"});return}const j=D.data.problem;g.value=it(j,{}),r.setTitle(j.title+" - "+r.getTitle),b.value=[],D.data.judges?D.data.judges.forEach(E=>{b.value.push({file:E.key,size:E.size,lastModified:E.last_modified})}):_e(n,"评测数据不存在"),c.value=!1};return ie(async()=>{if(Array.isArray(a.params.problemId)?s.value=a.params.problemId[0]:s.value=a.params.problemId,!s.value){_e(n,"题目不存在"),await Q.push({name:"problem"});return}c.value=!0,await U()}),(D,j)=>{const E=Ve,z=Se,I=W,x=be,V=Ge,M=Oe,J=Ce,X=xe;return L(),K(X,{loading:c.value},{default:l(()=>[t(J,null,{default:l(()=>[t(z,{span:7},{default:l(()=>[A("div",Fs,[A("div",{id:"drop-zone",style:na(T.value),onClick:o,onDragenter:_t(y,["prevent"]),onDragover:j[0]||(j[0]=_t(()=>{},["prevent"])),onDragleave:_t($,["prevent"]),onDrop:R},[A("input",{ref_key:"fileInput",ref:k,type:"file",style:{display:"none"},onChange:w},null,544),P(" "+F(d.value),1)],36)]),t(E,{data:b.value,columns:v.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1}),t(z,{span:5},{default:l(()=>[A("div",Ns,[A("div",Os,[t(x,null,{default:l(()=>[t(I,{onClick:i,theme:"danger",loading:p.value},{default:l(()=>j[1]||(j[1]=[P("上传")])),_:1},8,["loading"]),t(I,{onClick:C,theme:"warning"},{default:l(()=>j[2]||(j[2]=[P("编辑")])),_:1}),t(I,{onClick:S},{default:l(()=>j[3]||(j[3]=[P("查看")])),_:1})]),_:1})]),t(M,{layout:"vertical",bordered:!0},{default:l(()=>[t(V,{label:"标题"},{default:l(()=>{var q;return[P(F((q=g.value)==null?void 0:q.title),1)]}),_:1}),t(V,{label:"创建时间"},{default:l(()=>{var q;return[P(F((q=g.value)==null?void 0:q.insertTime),1)]}),_:1}),t(V,{label:"更新时间"},{default:l(()=>{var q;return[P(F((q=g.value)==null?void 0:q.updateTime),1)]}),_:1}),t(V,{label:"判题方式"},{default:l(()=>{var q;return[P(F((q=g.value)==null?void 0:q.judgeType),1)]}),_:1}),t(V,{label:"评测数据"},{default:l(()=>{var q;return[P(F((q=g.value)==null?void 0:q.judgeMd5),1)]}),_:1}),t(V,{label:"上传用户"},{default:l(()=>{var q;return[P(F((q=g.value)==null?void 0:q.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Hs=ue(Gs,[["__scopeId","data-v-12b13fb1"]]),Bs={style:{display:"flex","align-items":"center"}},Js={style:{color:"#409eff","margin-right":"20px"}},Ws={class:"dida-login-footer"},Xs=re({__name:"UserForget",setup(e){const{globalProperties:a}=me(),n=Le(),r=m(!1),s=m(!1),c=m(!1),g=m("发送验证码");let _=null,k=-1;const f=m(!1),u=m(null),p=m(""),v=m({username:"",emailKey:"",password:"",confirmPassword:""}),T=m({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:w=>new Promise(y=>{const $=setTimeout(()=>{y(v.value.password===w),clearTimeout($)})}),message:"两次密码不一致"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),d=()=>{ve(a,"重置成功")},S=async w=>{if(!c.value){r.value=!0,s.value=!0;try{const y=await Wl(w,v.value.username);y.code===0?(ve(a,"验证码发送成功"),p.value=y.data,s.value=!1,c.value=!0,_=new Date,g.value="60秒后重发",k=setInterval(()=>{const R=Math.floor((new Date().getTime()-(_==null?void 0:_.getTime()))/1e3);R>60?(g.value="发送验证码",c.value=!1,clearInterval(k)):g.value=`${60-R}秒后重发`},1e3)):H(a,y.code)}catch(y){console.error("Send email key error",y),_e(a,"发送验证码失败")}finally{r.value=!1}}},C=async()=>{var R;if(f.value=!0,c.value||s.value)return;await qe();const w=document.getElementById("cf-confirm-div");w&&w.remove();const y=document.createElement("div");y.id="cf-confirm-div",y.setAttribute("data-theme","light"),(R=u.value)==null||R.appendChild(y);const $=window;$.turnstile.ready(function(){$.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(U){f.value=!1,await S(U)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},h=m(()=>t(W,{onClick:C,disabled:c.value,loading:s.value,style:"width:120px"},{default:()=>[g.value]})),i=async()=>{r.value=!0;try{const w=await Xl(v.value.username,v.value.password,v.value.emailKey);w.code===0?(ve(a,"密码修改成功"),a.$router.push({name:"login"})):H(a,w.code)}catch(w){console.error("Modify password error",w),_e(a,"修改密码失败")}finally{r.value=!1}},o=async({validateResult:w,firstError:y,e:$})=>{if(!r.value){if($.preventDefault(),w!==!0){_e(a,y);return}p.value?await i():await C()}};return ie(()=>{if(n.isLogin()){a.$router.push({path:"/user"});return}}),Pe(()=>{}),(w,y)=>{const $=Dt,R=Ae,U=Ue,D=sa,j=W,E=$e,z=at,I=fe,x=Ze;return L(),ae(oe,null,[t(I,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:l(()=>[t($,{"max-line":1},{default:l(()=>y[6]||(y[6]=[A("span",null,"如果您未绑定邮箱或忘记用户名，可联系管理员寻求帮助",-1),A("span",null,"管理员邮箱：BoilTask@qq.com",-1)])),_:1}),t(E,{ref:"form",rules:T.value,data:v.value,colon:!0,onReset:d,onSubmit:o,class:"yj-login-form"},{default:l(()=>[t(U,{name:"username",label:"用户名"},{default:l(()=>[t(R,{modelValue:v.value.username,"onUpdate:modelValue":y[0]||(y[0]=V=>v.value.username=V),clearable:"",placeholder:"请输入完整用户名"},null,8,["modelValue"])]),_:1}),p.value?(L(),ae(oe,{key:0},[t(U,{name:"email",label:"发送邮箱"},{default:l(()=>[t(D,{append:h.value},{default:l(()=>[A("div",Bs,[A("span",Js,F(p.value),1)])]),_:1},8,["append"])]),_:1}),t(U,{name:"emailKey",label:"验证码"},{default:l(()=>[t(R,{modelValue:v.value.emailKey,"onUpdate:modelValue":y[1]||(y[1]=V=>v.value.emailKey=V),clearable:"",placeholder:"请输入收到的验证码"},null,8,["modelValue"])]),_:1}),t(U,{name:"password",label:"新密码"},{default:l(()=>[t(R,{modelValue:v.value.password,"onUpdate:modelValue":y[2]||(y[2]=V=>v.value.password=V),type:"password",clearable:"",placeholder:"新密码"},null,8,["modelValue"])]),_:1}),t(U,{name:"confirmPassword",label:"确认密码"},{default:l(()=>[t(R,{modelValue:v.value.confirmPassword,"onUpdate:modelValue":y[3]||(y[3]=V=>v.value.confirmPassword=V),type:"password",clearable:"",placeholder:"请重复输入密码"},null,8,["modelValue"])]),_:1})],64)):le("",!0),p.value?(L(),K(U,{key:1},{default:l(()=>[t(j,{theme:"primary",type:"submit",block:"",loading:r.value},{default:l(()=>y[7]||(y[7]=[P("修改密码")])),_:1},8,["loading"])]),_:1})):(L(),K(U,{key:2},{default:l(()=>[t(j,{theme:"primary",type:"submit",block:"",loading:r.value},{default:l(()=>y[8]||(y[8]=[P("重置密码")])),_:1},8,["loading"])]),_:1}))]),_:1},8,["rules","data"]),A("div",Ws,[t(z,{onClick:y[4]||(y[4]=()=>{ce(a).$router.push({name:"login"})})},{default:l(()=>y[9]||(y[9]=[P("返回登陆 ")])),_:1})])]),_:1}),t(x,{visible:f.value,"onUpdate:visible":y[5]||(y[5]=V=>f.value=V),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:l(()=>[A("div",{ref_key:"dialogContainer",ref:u,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),Ys=ue(Xs,[["__scopeId","data-v-d3cb1db8"]]),Ta=[{name:"problem-list",tab:"problem",sidebar:"problem-list",path:"",title:"问题列表",icon:"list",component:An},{name:"problem-detail",tab:"problem",sidebar:"problem-list",path:":problemId+",title:"问题详情",icon:"list",component:Ot},{name:"problem-recommend",tab:"problem",sidebar:"problem-recommend",path:"recommend/:problemId*",title:"问题推荐",icon:"cpu",needLogin:!0,component:lo},{name:"problem-collection-list",tab:"problem",sidebar:"problem-collection-list",path:"collection",title:"题目集合",icon:"list",disableTabPath:!0,component:vo},{name:"collection-detail",tab:"collection-detail-tab",sidebar:"collection-detail",path:":collectionId+",title:"题集详情",icon:"cpu",component:wo},{name:"collection-rank",tab:"collection-detail-tab",sidebar:"collection-rank",path:":collectionId+/rank",title:"题集排名",icon:"list",component:ko},{name:"collection-edit",tab:"collection-detail-tab",sidebar:"collection-edit",disableSidebar:!0,needLogin:!0,path:":collectionId+/edit",title:"题集编辑",icon:"list",component:Gt},{name:"collection-create",tab:"collection-detail-tab",sidebar:"collection-create",needLogin:!0,disableSidebar:!0,path:"create",title:"新建题集",icon:"list",component:Gt},{name:"judge-list",tab:"judge",sidebar:"judge-list",path:"",title:"评测列表",icon:"list",component:Bt},{name:"judge-detail",tab:"judge",sidebar:"judge-list",path:":judgeId+",title:"评测详情",icon:"cpu",component:Wt},{name:"contest-list",tab:"contest",sidebar:"contest-list",path:"",title:"比赛列表",icon:"list",component:Xt},{name:"contest-recent",tab:"contest",sidebar:"contest-recent",path:"recent",title:"近期比赛",icon:"list",component:Xt},{name:"contest-create",tab:"contest",sidebar:"contest-create",disableSidebar:!0,needLogin:!0,path:"create",title:"新建比赛",icon:"list",component:Zt},{name:"contest-edit",tab:"contest-detail-tab",sidebar:"contest-edit",disableSidebar:!0,needLogin:!0,path:":contestId+/edit",title:"比赛编辑",icon:"list",component:Zt},{name:"contest-detail",tab:"contest-detail-tab",sidebar:"contest-detail",path:":contestId+",title:"比赛详情",icon:"cpu",component:Wo},{name:"contest-problem-detail",tab:"contest-detail-tab",sidebar:"contest-problem-detail",path:":contestId+/problem/:problemIndex+",title:"问题详情",icon:"cpu",disableSidebar:!0,component:Ot},{name:"contest-judge",tab:"contest-detail-tab",sidebar:"contest-judge",path:":contestId+/judge",title:"评测列表",icon:"list",component:Bt},{name:"contest-judge-detail",tab:"contest-detail-tab",sidebar:"contest-judge-detail",path:":contestId+/judge/:judgeId+",title:"评测详情",icon:"cpu",component:Wt,disableSidebar:!0},{name:"contest-rank",tab:"contest-detail-tab",sidebar:"contest-rank",path:":contestId+/rank",title:"比赛排名",icon:"list",component:ts},{name:"contest-discuss",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss",title:"比赛讨论",icon:"list",component:pt},{name:"contest-discuss-detail",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss/:discussId+",title:"讨论详情",icon:"list",component:St},{name:"discuss-list",tab:"discuss",sidebar:"discuss-list",path:"",title:"讨论列表",icon:"list",component:pt},{name:"discuss-list-problem",tab:"discuss",sidebar:"discuss-list-problem",path:"problem",title:"问题讨论",icon:"list",component:pt},{name:"discuss-list-judge",tab:"discuss",sidebar:"discuss-list-judge",path:"judge",title:"评测讨论",icon:"list",component:pt},{name:"discuss-detail",tab:"discuss",sidebar:"discuss-list",path:":discussId+",title:"讨论详情",icon:"list",component:St},{name:"rank-ac-all",tab:"rank",sidebar:"rank-ac-all",path:"ac",title:"AC排名",icon:"base-station",props:{type:"all"},component:st},{name:"rank-ac-problem",tab:"rank",sidebar:"rank-ac-problem",path:"ac/problem",title:"题量排名",icon:"base-station",props:{type:"problem"},component:st},{name:"rank-ac-problem-today",tab:"rank",sidebar:"rank-ac-problem-today",path:"ac/problem/today",title:"今日题量",icon:"base-station",props:{type:"problem-today"},component:st},{name:"rank-ac-problem-day7",tab:"rank",sidebar:"rank-ac-problem-day7",path:"ac/problem/day7",title:"7日题量",icon:"base-station",props:{type:"problem-day7"},component:st},{name:"rank-ac-problem-year",tab:"rank",sidebar:"rank-ac-problem-year",path:"ac/problem/year",title:"1年题量",icon:"base-station",props:{type:"problem-year"},component:st},{name:"system-status",tab:"system",sidebar:"system-status",path:"",title:"运行状态",icon:"base-station",component:$s},{name:"system-about",tab:"system",sidebar:"system-about",path:"about",title:"关于",icon:"base-station",props:{discussId:"52"},component:St},{name:"manage-problem-create",tab:"manage",sidebar:"manage-problem-create",disableSidebar:!0,path:"problem",title:"新建问题",icon:"list",component:Qt,auths:[Ee.ManageProblem]},{name:"manage-problem",tab:"manage",sidebar:"manage-problem",disableSidebar:!0,path:"problem/:problemId+",title:"问题编辑",icon:"list",component:Qt,auths:[Ee.ManageProblem]},{name:"manage-problem-judge",tab:"manage",sidebar:"manage-problem-judge",disableSidebar:!0,path:"problem/:problemId+/judge",title:"评测数据",icon:"list",component:Hs,auths:[Ee.ManageProblem]},{name:"manage-judge",tab:"manage",path:"judge",sidebar:"manage-judge",title:"评测管理",icon:"list",auths:["i-manage-judge"],component:As},{name:"login-forget",tab:"login",path:"forget",title:"忘记密码",component:Ys}],ea=(e,a,n,r)=>{r.tab==n&&(r.disableSidebar&&a!=r.sidebar||r.sidebar==null||r.sidebar!=r.name||e.push({name:r.name,title:r.title,icon:r.icon,to:{name:r.name}}))},Zs=(e,a)=>{const n=[];return Ta.forEach(r=>{if(_a(r)){const s=[];r.children.forEach(c=>{ea(s,e,a,c)}),s.length>0&&n.push({title:r.title,children:s})}else ea(n,e,a,r)}),n},ta=(e,a)=>{const n=un(a.tab),r={name:a.name,path:"/"+a.path,meta:{title:a.title+" - "+n.title,tab:a.tab,sidebar:a.sidebar,showSidebar:n.showSidebar,needLogin:n.needLogin||a.needLogin,tabAuths:n.auths,auths:a.auths},props:a.props,component:a.component};!n.disablePath&&!a.disableTabPath&&(r.path=n.path+r.path),e.push(r)},Qs=e=>{Ta.forEach(a=>{_a(a)?a.children.forEach(n=>{ta(e,n)}):ta(e,a)})},er={class:"sh-main"},tr=re({__name:"View403",setup(e){let a=he();const n=m("");return ie(()=>{a.query.target?n.value=a.query.target:n.value=a.fullPath}),(r,s)=>{const c=W;return L(),ae("div",er,[A("p",null,F(n.value),1),s[2]||(s[2]=A("p",null,"该页面无访问权限，请更换访问目标或重新登陆后再试",-1)),t(c,{theme:"primary",onClick:s[0]||(s[0]=()=>r.$router.push("/"))},{default:l(()=>s[1]||(s[1]=[P("返回首页")])),_:1})])}}}),xa=ue(tr,[["__scopeId","data-v-777362b3"]]),ct=[];dn(ct);Qs(ct);ct.push({path:"/403",name:"403",component:xa});ct.push({path:"/:pathMatch(.*)*",name:"404",component:fa});const Q=Ka({history:Fa("/"),routes:ct});Q.beforeEach((e,a,n)=>{if(e.name==null||!Q.hasRoute(e.name)){n({name:"home"});return}const r=e.matched[e.matched.length-1].meta;if(r.redirect){n({name:r.redirect});return}if(r.needLogin){const c=Le();if(c.getToken==null||c.getToken==""){n({name:"login",query:{redirect_uri:e.fullPath}});return}}const s=r.tabAuths;if(s&&!Le().hasAllAuths(s)){n({name:"403",query:{target:e.fullPath}});return}n()});Q.afterEach((e,a)=>{if(e.name===a.name)return;const n=Ct(),r=Ke();let s=null;if(e.matched.length>0&&(s=e.matched[e.matched.length-1].meta),s!=null&&s.title&&r.setTitle(s==null?void 0:s.title),s!=null&&s.showSidebar){n.setSidebarShow(!0);const c=Zs(s==null?void 0:s.sidebar,s==null?void 0:s.tab);n.setMenuList(c),n.setMenuActiveName(s==null?void 0:s.sidebar)}else n.setSidebarShow(!1)});const Va=rt("login",{state:()=>({Loaded:!1}),getters:{isLoaded(){return this.Loaded}}}),ar=re({__name:"HeaderContent",setup(e){const a=Va(),n=Le(),{globalProperties:r}=me(),s=m(a.isLoaded),c=m(!1),g=m(n.getUsername),_=m(n.getNickname),k=m(),f=()=>{k.value=cn(n)};a.$subscribe((v,b)=>{s.value=b.Loaded}),n.$subscribe((v,b)=>{g.value=b.username,_.value=b.nickname,c.value=b.token!="",f()});const u=()=>{r.$router.currentRoute.value.name!=="login"&&r.$router.push({name:"login",query:{redirect_uri:r.$router.currentRoute.value.fullPath}})},p=()=>{n.clear(),r.$message.success({duration:3e3,content:"注销成功"}),r.$router.push({path:"/login",query:{redirect_uri:r.$router.currentRoute.value.fullPath}})};return ie(()=>{f()}),(v,b)=>{const T=oa("router-link"),d=pa,S=ma,C=il,h=cl;return L(),K(h,{modelValue:v.$route.meta.tab,"onUpdate:modelValue":b[0]||(b[0]=i=>v.$route.meta.tab=i),class:"sh-menu","expand-type":"popup"},{logo:l(()=>[t(T,{to:"/",class:"sh-logo"},{default:l(()=>b[1]||(b[1]=[P("DidaOJ")])),_:1})]),operations:l(()=>[s.value&&c.value?(L(),K(C,{key:0,title:_.value},{icon:l(()=>[t(d,{name:"user"})]),default:l(()=>[t(S,{value:"user",to:{path:"/user/"+g.value}},{default:l(()=>b[2]||(b[2]=[P("个人空间")])),_:1},8,["to"]),t(S,{value:"user_logout",onClick:p},{default:l(()=>b[3]||(b[3]=[P(" 注销")])),_:1})]),_:1},8,["title"])):s.value?(L(),K(S,{key:2,value:"login",onClick:u},{icon:l(()=>[t(d,{name:"login"})]),default:l(()=>[b[5]||(b[5]=P(" 登录 "))]),_:1})):(L(),K(S,{key:1,value:"login"},{icon:l(()=>[t(d,{name:"login"})]),default:l(()=>[b[4]||(b[4]=P(" ... "))]),_:1}))]),default:l(()=>[(L(!0),ae(oe,null,ke(k.value,i=>(L(),K(S,{key:i.name,value:i.name,to:{name:i.name}},{icon:l(()=>[i.icon?(L(),K(d,{key:0,name:i.icon},null,8,["name"])):le("",!0)]),default:l(()=>[P(" "+F(i.title),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])}}}),lr=ue(ar,[["__scopeId","data-v-c64d812f"]]),nr={id:"menu-container"},or=re({__name:"SidebarContent",setup(e){const a=Ct(),n=m(!1),r=m(null),s=m(a.menuActiveName),c=m(a.menuList),g=m([]),_=m(!1),k=()=>{s.value=a.menuActiveName;const u=JSON.stringify(c.value),p=JSON.stringify(a.menuList);u!==p&&(g.value.push([...a.menuList]),f())},f=async()=>{if(g.value.length>0&&!_.value){for(_.value=!0;g.value.length>1;)g.value.shift();const u=g.value.shift();n.value=u.length<=0,c.value=[],await qe(),r.value&&r.value.updateActiveName(),await new Promise(v=>setTimeout(v,300)),c.value=u,await qe(),r.value&&r.value.updateActiveName();const p=300;await new Promise(v=>setTimeout(v,p)),_.value=!1,await f()}};return a.$subscribe((u,p)=>{k()}),ie(()=>{k()}),(u,p)=>{const v=pa,b=ma,T=ml,d=dl,S=xe;return L(),ae(oe,null,[A("div",nr,[t(d,{modelValue:s.value,"onUpdate:modelValue":p[0]||(p[0]=C=>s.value=C),theme:"light",class:"sh-menu-container"},{default:l(()=>[t(Na,{name:"move-left"},{default:l(()=>[(L(!0),ae(oe,null,ke(c.value,(C,h)=>(L(),ae(oe,{key:h},[ce(mn)(C)?(L(),K(T,{key:0,title:C.title},{default:l(()=>[(L(!0),ae(oe,null,ke(C.children,(i,o)=>(L(),K(b,{key:i.name,value:i.name,to:i.to},Kt({default:l(()=>[P(" "+F(i.title),1)]),_:2},[i.icon?{name:"icon",fn:l(()=>[t(v,{name:i.icon,class:xt(i.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))),128))]),_:2},1032,["title"])):(L(),K(b,{key:C.name,value:C.name,to:C.to},Kt({default:l(()=>[P(" "+F(C.title),1)]),_:2},[C.icon?{name:"icon",fn:l(()=>[t(v,{name:C.icon,class:xt(C.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),t(S,{size:"small",loading:n.value,"show-overlay":!0,attach:"#menu-container",class:"sh-sidebar-loading",style:{"align-items":"flex-start","padding-top":"100px"}},null,8,["loading"])],64)}}}),sr=ue(or,[["__scopeId","data-v-96e2d89f"]]),rr={};function ur(e,a){return null}const ir=ue(rr,[["render",ur]]),cr={class:"footer"},dr={class:"footer-left"},mr={class:"foot-time"},pr={class:"footer-center"},fr={href:"https://beiancx.miit.gov.cn/",target:"_blank"},vr={class:"footer-right"},_r={class:"foot-text"},gr={href:"https://github.com/hpu-developer/DiDaOJ-web",target:"_blank"},br={class:"foot-text"},hr={href:"https://github.com/hpu-developer/DiDaOJ-go",target:"_blank"},yr=re({__name:"FooterContent",setup(e){const a=m("");function n(){a.value=new Date().toLocaleString()}return ie(()=>{n(),setInterval(()=>{n()},1e3)}),(r,s)=>{const c=W;return L(),ae("div",cr,[A("div",dr,[A("p",mr,F(a.value),1)]),A("div",pr,[A("a",fr,[t(c,{theme:"default",variant:"outline",ghost:!0},{default:l(()=>s[0]||(s[0]=[P("豫ICP备15024677号-4")])),_:1})])]),A("div",vr,[A("p",_r,[A("a",gr,[t(c,{theme:"default",variant:"outline",ghost:!0},{default:l(()=>s[1]||(s[1]=[P("@didaoj-web")])),_:1})])]),A("p",br,[A("a",hr,[t(c,{theme:"default",variant:"outline",ghost:!0},{default:l(()=>s[2]||(s[2]=[P("@didaoj-go")])),_:1})])])])])}}}),wr=ue(yr,[["__scopeId","data-v-979fed79"]]),ft=20,Pt=100,Tt=50,kr=re({__name:"ForceHiddenSidebarButton",setup(e){let a=Ct();const n=m({x:window.innerWidth-Pt-ft,y:window.innerHeight-Tt-ft}),r=m(window.innerWidth),s=m(window.innerHeight);let c=!1,g={x:0,y:0};const _=C=>{c=!0;const h=C.clientX??C.touches[0].clientX,i=C.clientY??C.touches[0].clientY;g={x:h-n.value.x,y:i-n.value.y},document.addEventListener("mousemove",k),document.addEventListener("touchmove",k),document.addEventListener("mouseup",f),document.addEventListener("touchend",f)},k=C=>{if(!c)return;const h=C.clientX??C.touches[0].clientX,i=C.clientY??C.touches[0].clientY;let o=h-g.x,w=i-g.y;o=Math.max(0,Math.min(o,r.value-Pt)),w=Math.max(0,Math.min(w,s.value-Tt)),n.value={x:o,y:w}},f=()=>{c=!1,document.removeEventListener("mousemove",k),document.removeEventListener("touchmove",k),document.removeEventListener("mouseup",f),document.removeEventListener("touchend",f)},u=()=>{r.value=window.innerWidth,s.value=window.innerHeight,n.value={x:Math.min(n.value.x,r.value-Pt-ft),y:Math.min(n.value.y,s.value-Tt-ft)}};let p=m(a.forceHiddenSidebar),v=m(a.forceHiddenSidebar);const b=()=>{p.value=!p.value,a.setForceHiddenSidebar(p.value)},T=()=>{v.value||(v.value=!0,a.setForceHiddenSidebar(p.value))},d=()=>{v.value&&(v.value=!1,a.setForceHiddenSidebar(!1))},S=C=>{C>=800?d():T()};return S(r.value),De(r,C=>{S(C)}),ie(()=>{window.addEventListener("resize",u)}),Pe(()=>{window.removeEventListener("resize",u)}),(C,h)=>{const i=W;return ce(v)?(L(),K(i,{key:0,class:"draggable-button",style:na({top:`${n.value.y}px`,left:`${n.value.x}px`}),onMousedown:_,onTouchstart:_,variant:"dashed",theme:"primary",onClick:b},{default:l(()=>[P(F(ce(p)?"显示":"隐藏"),1)]),_:1},8,["style"])):le("",!0)}}}),Cr=ue(kr,[["__scopeId","data-v-1aee5506"]]),vt="DidaOJ",Sr=re({__name:"App",setup(e){const{globalProperties:a}=me(),n=Va(),r=Le(),s=Ke(),c=Ct();n.$patch({Loaded:!1});const g=r.getToken,_=m(!1),k=m(!1);s.title&&s.title.length>0?document.title=s.title+" - "+vt:document.title=vt,s.$subscribe((v,b)=>{b.title&&b.title.length>0?document.title=b.title+" - "+vt:document.title=vt}),c.$subscribe((v,b)=>{_.value=b.showSidebar,k.value=_.value&&!b.forceHiddenSidebar});const f=he(),u=Fe(()=>{const v=f.meta.auths;return v?!r.hasAllAuths(v):!1});function p(){a.$message.warning({duration:3e3,content:"登陆状态失效"}),n.$patch({Loaded:!0}),r.clear()}return ie(()=>{document.addEventListener("DOMContentLoaded",()=>{Oa.autoSpacingPage()}),g?Fl().then(v=>{v.code==0?(r.loadResponse(v.data),n.$patch({Loaded:!0})):(H(a,v.code),n.$patch({Loaded:!0}),r.clear())}).catch(v=>{console.log(v),p()}):n.$patch({Loaded:!0})}),(v,b)=>{const T=pl,d=vl,S=oa("RouterView"),C=_l,h=fl,i=gl;return L(),ae(oe,null,[t(h,null,{default:l(()=>[t(T,{class:"sh-header"},{default:l(()=>[t(lr)]),_:1}),t(h,null,{default:l(()=>[t(Ga,{name:"slide"},{default:l(()=>[k.value?(L(),K(d,{key:0,class:"sh-sidebar"},{default:l(()=>[t(sr)]),_:1})):le("",!0)]),_:1}),t(h,{class:xt(["sh-main-layout",{expanded:!k.value}])},{default:l(()=>[t(ir),t(C,{class:"sh-main-content"},{default:l(()=>[u.value?(L(),K(xa,{key:0})):(L(),K(S,{key:1}))]),_:1}),t(wr)]),_:1},8,["class"])]),_:1})]),_:1}),_.value?(L(),K(Cr,{key:0})):le("",!0),t(i,{container:"body",offset:["24px","80px"],size:"small"})],64)}}}),Ir=ue(Sr,[["__scopeId","data-v-2169b8cd"]]);hl.registerLanguage("verilog",yl);const La=Ha();La.use(Ba);const dt=Ja(Ir);dt.use(La);dt.use(Q);dt.use(bl);dt.use(Wa);dt.mount("#app");Ul().then(()=>{console.log("Text cache reinitialized")}).catch(e=>{console.error("Text cache reinitialization failed",e)});
