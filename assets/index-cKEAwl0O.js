import{bm as nt,bn as Ut,n as ae,r as f,o as le,G as At,bo as Y,bp as D,s as t,bq as l,br as A,F as te,bs as ge,bt as F,bu as q,ap as x,u as qe,bv as oe,bw as de,aD as fe,g as ia,bx as ca,by as da,bz as ma,J as Ce,q as xe,bA as pa,bB as ze,c as Ae,y as Le,bC as Ge,bD as mt,ac as fa,bE as Rt,bF as _a,bG as va,bH as Et,aM as ga,bI as pt,a0 as ba,bJ as ha,bK as ya,B as wa,bL as ka}from"./node_modules-x_y3cvPb.js";import{L as ke,C as se,S as _e,a as Ca,T as Sa,b as be,A as ot,c as Ia,d as Pa,e as Ta,f as xa,g as Oe,R as ve,B as O,F as je,h as Ve,I as De,D as Fe,i as Kt,j as Re,k as Ee,l as La,m as Se,n as st,o as qt,O as vt,p as gt,P as Mt,q as ja,r as Ft,s as Gt,t as Va,u as Da,v as $a,w as za,x as Ua,y as Aa,z as Ra,M as Nt,E as Ot,G as Ea,H as Ka,J as qa,K as Ma,N as Fa,Q as Ga,U as Na,V as Oa,W as Ha,X as Ba}from"./tdesign-vue-next-tWl6HQ7l.js";import{V as ue}from"./vditor-DArazWIS.js";import{e as Ct}from"./monaco-editor-BHsDS0An.js";import{H as Wa,v as Ja}from"./highlight.js-D9zWiMxS.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const _ of c.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&s(_)}).observe(document,{childList:!0,subtree:!0});function n(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(o){if(o.ep)return;o.ep=!0;const c=n(o);fetch(o.href,c)}})();var $e=(e=>(e.Manage="i-manage",e.ManageJudge="i-manage-judge",e.ManageProblem="i-manage-problem",e.ManageContest="i-manage-contest",e.ManageCollection="i-manage-collection",e))($e||{});const Xa={"r-admin":["i-manage","i-manage-judge","i-manage-problem","i-manage-contest","i-manage-collection"]};function Ya(e){if(e==null)return[];const a=[];for(const n of e){const s=Xa[n];s!=null&&a.push(...s)}return[...new Set(a)]}function Za(e,a){if(e==null||a==null)return!1;const n=Ya(e);for(const s of a)if(!n.includes(s))return!1;return!0}const Pe=nt("user",{state:()=>({token:"",userId:-1,username:"",nickname:"",roles:[]}),getters:{getToken(){return this.token},getUserId(){return this.userId},getUsername(){return this.username},getNickname(){return this.nickname}},actions:{clear(){this.$patch({token:"",userId:-1,username:"",nickname:"",roles:[]})},loadResponse(e){this.$patch({token:e.token,userId:e.user_id,username:e.username,nickname:e.nickname,roles:e.roles})},isLogin(){return this.token!=null&&this.token!=""},hasAuth(e){return this.hasAllAuths([e])},hasAllAuths(e){return e?Za(this.roles,e):!0}},persist:!0}),Ue=nt("webStyle",{state:()=>({title:""}),getters:{getTitle(){return this.title}},actions:{setTitle(e){this.title=e}}}),rt=nt("sidebarStyle",{state:()=>({showSidebar:!1,forceHiddenSidebar:!1,menuActiveName:"",menuList:[]}),getters:{getMenuList(){return this.menuList}},actions:{setSidebarShow(e){this.showSidebar=e},setForceHiddenSidebar(e){this.forceHiddenSidebar=e},setMenuActiveName(e){this.menuActiveName=e},clearMenuList(){this.menuList=[]},setMenuList(e){this.menuList=e},addMenuList(e){this.menuList.push(e)}}}),Xe=Ut.create({timeout:6e4,withCredentials:!1,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});Xe.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function Qa(){return Xe({baseURL:"https://r2-oj.didapipa.com",url:"/system/notification.json?"+Date.now(),method:"get"})}function el(){return Xe({baseURL:"https://r2-oj.didapipa.com",url:"/status/judger.json?"+Date.now(),method:"get"})}function Ht(e){return Xe({baseURL:"https://r2-oj.didapipa.com",url:"/status/judger/"+e+".json?"+Date.now(),method:"get"})}function tl(e){return Xe({baseURL:"https://r2-oj.didapipa.com",url:"/status/web.json?"+Date.now(),method:"get"})}const al={class:"judger-status-panel"},ll={class:"judger-status-panel"};function nl(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!qe(e)}const ol=ae({__name:"SystemStatus",setup(e){const a=f([]),n=f([]),s=f(!1),o=f(!1);let c;const _=v=>{let r="失效",u="danger";const h=new Date,k=new Date(v.updateTime);return h.getTime()-k.getTime()>3e4?(r="离线",u="default"):v.cpuUsage>90?(r="CPU过高",u="warning"):v.memPercent>90?(r="内存过高",u="warning"):(r="在线",u="success"),t(_e,null,{default:()=>[t("span",null,[v.key,x(" - "),v.name]),t("span",null,[v.updateTime]),t(Sa,{theme:u,size:"small"},nl(r)?r:{default:()=>[r]})]})},I=async()=>{const v=[{key:"didaoj",name:"DidaOj"}],r={};for(let h=0;h<a.value.length;h++){const k=a.value[h];r[k.key]=k}const u=[];for(let h=0;h<v.length;h++){const k=v[h],p={key:k.key},i=await tl(k.key);i&&(i.name?p.name=i.name:p.name="-",i.update_time?p.updateTime=new Date(i.update_time).toLocaleString():p.updateTime="-",i.cpu_usage?p.cpuUsage=Number(i.cpu_usage):p.cpuUsage=0,i.mem_usage?p.memUsage=i.mem_usage/(1024*1024*1024):p.memUsage=0,i.mem_total?p.memTotal=i.mem_total/(1024*1024*1024):p.memTotal=0,p.memTotal>0?p.memPercent=Math.round(p.memUsage/p.memTotal*1e4)/100:p.memPercent=0,p.avgMessage=i.avg_message,r[k.key]?(p.cpuUsageFrom=r[k.key].cpuUsage,p.memPercentFrom=r[k.key].memPercent,p.memUsageFrom=r[k.key].memUsage,p.memTotalFrom=r[k.key].memTotal):(p.cpuUsageFrom=0,p.memPercentFrom=0,p.memUsageFrom=0,p.memTotalFrom=0),u.push(p))}a.value=u},S=async()=>{const v=await el(),r={};for(let h=0;h<n.value.length;h++){const k=n.value[h];r[k.key]=k}const u=[];for(let h=0;h<v.judgers.length;h++){const k=v.judgers[h],p={key:k.key,name:k.name},i=await Ht(k.key);i&&(i.name?p.name=i.name:p.name="-",i.update_time?p.updateTime=new Date(i.update_time).toLocaleString():p.updateTime="-",i.cpu_usage?p.cpuUsage=Number(i.cpu_usage):p.cpuUsage=0,i.mem_usage?p.memUsage=i.mem_usage/(1024*1024*1024):p.memUsage=0,i.mem_total?p.memTotal=i.mem_total/(1024*1024*1024):p.memTotal=0,p.memTotal>0?p.memPercent=Math.round(p.memUsage/p.memTotal*1e4)/100:p.memPercent=0,p.avgMessage=i.avg_message,r[k.key]?(p.cpuUsageFrom=r[k.key].cpuUsage,p.memPercentFrom=r[k.key].memPercent,p.memUsageFrom=r[k.key].memUsage,p.memTotalFrom=r[k.key].memTotal):(p.cpuUsageFrom=0,p.memPercentFrom=0,p.memUsageFrom=0,p.memTotalFrom=0),u.push(p))}n.value=u},y=async()=>{await I(),s.value=!1,await S(),o.value=!1};return le(async()=>{n.value=[],a.value=[],o.value=!0,s.value=!0,await y(),c=setInterval(()=>{y()},5e3)}),At(()=>{clearInterval(c)}),(v,r)=>{const u=Ca,h=_e,k=se,p=ke;return D(),Y(te,null,[t(k,{title:"接口状态",class:"judger-status"},{default:l(()=>[t(p,{loading:s.value},{default:l(()=>[A("div",al,[(D(!0),Y(te,null,ge(a.value,i=>(D(),F(k,{key:i.key,header:()=>_(i),class:"judge-status-judger"},{footer:l(()=>[A("span",null," 负载信息："+q(i.avgMessage),1)]),default:l(()=>[t(h,{class:"judge-status-judger"},{default:l(()=>[t(u,{title:"CPU使用率",value:i.cpuUsage,animation:{valueFrom:i.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(u,{title:"内存使用率",value:i.memPercent,animation:{valueFrom:i.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(u,{title:"内存使用量",animation:{valueFrom:i.memUsageFrom,duration:2e3},"animation-start":!0,value:i.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(u,{title:"内存总量",value:i.memTotal,animation:{valueFrom:i.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1},8,["loading"])]),_:1}),t(k,{title:"判题机状态",class:"judger-status"},{default:l(()=>[t(p,{loading:o.value},{default:l(()=>[A("div",ll,[(D(!0),Y(te,null,ge(n.value,i=>(D(),F(k,{key:i.key,header:()=>_(i),class:"judge-status-judger"},{footer:l(()=>[A("span",null," 负载信息："+q(i.avgMessage),1)]),default:l(()=>[t(h,{class:"judge-status-judger"},{default:l(()=>[t(u,{title:"CPU使用率",value:i.cpuUsage,animation:{valueFrom:i.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(u,{title:"内存使用率",value:i.memPercent,animation:{valueFrom:i.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(u,{title:"内存使用量",animation:{valueFrom:i.memUsageFrom,duration:2e3},"animation-start":!0,value:i.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(u,{title:"内存总量",value:i.memTotal,animation:{valueFrom:i.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1},8,["loading"])]),_:1})],64)}}}),ne=(e,a)=>{const n=e.__vccOpts||e;for(const[s,o]of a)n[s]=o;return n},ft=ne(ol,[["__scopeId","data-v-1fb43cc1"]]),sl={style:{"text-align":"right"}},rl=ae({__name:"Hitokoto",setup(e){const a=f(!1),n=f(""),s=f(""),o=f(""),c=async()=>{a.value=!0;try{const I=await(await fetch("https://v1.hitokoto.cn")).json();s.value=I.hitokoto,o.value=I.creator,n.value="—— "+I.from}catch(_){s.value="一言获取失败了，但至少您还可以访问本站。",o.value="BoilTask",n.value="DidaOJ",console.error("Error fetching Hitokoto:",_)}finally{a.value=!1}};return le(()=>{c()}),(_,I)=>{const S=se,y=ke;return D(),F(y,{loading:a.value},{default:l(()=>[t(S,{title:"一言 © Hitokoto"},{actions:l(()=>[x(" @"+q(o.value),1)]),default:l(()=>[A("div",null,[A("span",null,q(s.value),1),A("p",sl,q(n.value),1)])]),_:1})]),_:1},8,["loading"])}}}),ul={class:"sh-main"},il={class:"dida-swiper-div"},cl=ae({__name:"HomeView",setup(e){let a=-1;const n=f(null),s=async()=>{n.value=await Qa()};return le(async()=>{await s(),a=setInterval(()=>{s()},3e4)}),At(()=>{clearInterval(a)}),(o,c)=>{const _=ot,I=Pa,S=Ia,y=se,v=be,r=Oe,u=xa,h=Ta,k=ve;return D(),F(k,null,{default:l(()=>[t(v,{span:8},{default:l(()=>[A("div",ul,[n.value?(D(),F(_,{key:0,style:{margin:"20px"},theme:n.value.theme},{default:l(()=>[x(q(n.value.content),1)]),_:1},8,["theme"])):oe("",!0),A("div",il,[t(S,{class:"dida-swiper"},{default:l(()=>[t(I,null,{default:l(()=>c[0]||(c[0]=[A("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1}),t(I,null,{default:l(()=>c[1]||(c[1]=[A("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1})]),_:1})]),t(y,{title:"正在完善，欢迎提供意见建议",style:{width:"500px",margin:"0 auto"}},{default:l(()=>c[2]||(c[2]=[A("p",null,[A("a",{href:"https://codeoj.cn/",target:"_blank"},"CodeOJ"),x("的迁移计划")],-1),A("p",null,"正在开发中",-1)])),_:1})])]),_:1}),t(v,{span:4},{default:l(()=>[t(rl,{style:{margin:"10px"}}),t(ft),t(y,{style:{margin:"10px"},bordered:!0},{header:l(()=>c[3]||(c[3]=[A("b",null,"友情链接",-1)])),default:l(()=>[t(h,null,{default:l(()=>[t(u,null,{default:l(()=>[t(r,{href:"https://boiltask.com",target:"_blank"},{default:l(()=>c[4]||(c[4]=[x("BoilTask Blog")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),dl=ne(cl,[["__scopeId","data-v-aba0b66b"]]),ml={class:"sh-main"},pl=ae({__name:"View404",setup(e){let a=de(),n=f(a.fullPath);return(s,o)=>{const c=O;return D(),Y("div",ml,[A("p",null,q(fe(n)),1),o[2]||(o[2]=A("p",null,"该页面无效或已被迁移，请重新选择访问目标",-1)),t(c,{theme:"primary",onClick:o[0]||(o[0]=()=>s.$router.push("/"))},{default:l(()=>o[1]||(o[1]=[x("返回首页")])),_:1})])}}}),Bt=ne(pl,[["__scopeId","data-v-d4218944"]]);let _t=null;async function fl(){_t=await vl()}function _l(e,a="zh"){if(_t==null)return[!1,e.toString()];const n=_t[e.toString()];if(!n)return[!1,e.toString()];let s=n[a];return s||(a="zh",s=n[a]),s?[!0,s]:[!1,e.toString()]}async function vl(){return new Promise((e,a)=>{e({404:{zh:"接口未找到"},1e3:{zh:"系统错误，请重试或等待管理员修复"},1001:{zh:"系统异常，请重试或等待管理员修复"},1002:{zh:"未知错误"},1003:{zh:"操作过于频繁，请稍后重试"},10001:{zh:"权限异常，请重新登陆后再试"},10002:{zh:"参数不符合要求"},10003:{zh:"未找到目标数据"},100001:{zh:"用户名不存在或密码不匹配"},100002:{zh:"邮件发送失败，可能是邮箱无效或达到了每日注册上限，如有问题可联系管理员解决"},100003:{zh:"验证码错误或已过期，请重新获取"},100004:{zh:"注册用户失败，可能存在同名用户"},100005:{zh:"用户名不存在，或您未在本系统绑定邮箱，请联系管理员寻求帮助"},100006:{zh:"验证码错误或已过期，请重新获取"},100007:{zh:"已存在相同标题的题目"}})})}function re(){const{appContext:e}=ia();return{globalProperties:e.config.globalProperties}}function Te(){return 1e3}function We(e,a,n=3e3){e.$message.success({duration:n,content:a})}function pe(e,a,n=3e3){e.$message.info({duration:n,content:a})}function ce(e,a,n=3e3){e.$message.error({duration:n,content:a})}function H(e,a,n=3e3){const[s,o]=_l(a),c=s?o:`系统错误，错误提示[${o}]`;e.$message.error({duration:n,content:c})}function gl(e,a){return e.length<=a?e:e.slice(0,a)+"..."}function St(e){e=new Date(e);const a=S=>S.toString().padStart(2,"0"),n=e.getFullYear(),s=a(e.getMonth()+1),o=a(e.getDate()),c=a(e.getHours()),_=a(e.getMinutes()),I=a(e.getSeconds());return`${n}-${s}-${o} ${c}:${_}:${I}`}const bl="https://oj-api.didapipa.com/",J=Ut.create({baseURL:bl,timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});J.interceptors.request.use(e=>{const n=Pe().getToken;return n&&(e.headers["X-Token"]=n),e},e=>Promise.reject(e));J.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function hl(e){const a={};return a.id=e.id,a.username=e.username,a.nickname=e.nickname,a.email=e.email,a.slogan=e.slogan,a.organization=e.organization,a.accept=e.accept,a.attempt=e.attempt,e.email&&(a.avatar=`https://www.gravatar.com/avatar/${ca(e.email.toLowerCase().trim())}?d=identicon&s=100`),a}function yl(e,a){return J({url:"/user/login",method:"post",data:{username:e,password:a}})}function wl(){return J({url:"/user/login/refresh",method:"post"})}function kl(e){const a={username:e};return J({url:`/user/info?${new URLSearchParams(a).toString()}`,method:"get"})}function Cl(e){return J({url:"/user/parse",method:"post",data:{users:e}})}function Sl(e,a){return J({url:"/user/register/email",method:"post",data:{token:e,email:a}})}function Il(e,a,n,s,o){return J({url:"/user/register",method:"post",data:{username:e,password:a,email:n,key:s,nickname:o}})}function Pl(e,a){return J({url:"/user/forget",method:"post",data:{token:e,username:a}})}function Tl(e,a,n){return J({url:"/user/password/modify",method:"post",data:{username:e,password:a,key:n}})}const xl={class:"dida-login-footer"},Ll=ae({__name:"LoginView",setup(e){const{globalProperties:a}=re(),n=Pe(),s=f(!1),o=f({username:"",password:""}),c=()=>{pe(a,"重置成功")},_=({validateResult:I,firstError:S})=>{s.value||(s.value=!0,yl(o.value.username,o.value.password).then(y=>{if(y.code===0){n.loadResponse(y.data),pe(a,"登录成功");let v=a.$route.query.redirect_uri;v||(v="/user/"+y.data.username),a.$router.push({path:v})}else H(a,y.code)}).catch(y=>{console.error("Login error",y),ce(a,"登录失败")}).finally(()=>{s.value=!1}))};return le(()=>{if(n.isLogin()){a.$router.push({path:"/user"});return}}),(I,S)=>{const y=De,v=Ve,r=O,u=je,h=Oe,k=se;return D(),F(k,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:l(()=>[t(u,{ref:"form",data:o.value,colon:!0,onReset:c,onSubmit:_,class:"yj-login-form","label-width":0},{default:l(()=>[t(v,{name:"username"},{default:l(()=>[t(y,{modelValue:o.value.username,"onUpdate:modelValue":S[0]||(S[0]=p=>o.value.username=p),clearable:"",placeholder:"请输入用户名"},{"prefix-icon":l(()=>[t(fe(da))]),_:1},8,["modelValue"])]),_:1}),t(v,{name:"password"},{default:l(()=>[t(y,{modelValue:o.value.password,"onUpdate:modelValue":S[1]||(S[1]=p=>o.value.password=p),type:"password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":l(()=>[t(fe(ma))]),_:1},8,["modelValue"])]),_:1}),t(v,null,{default:l(()=>[t(r,{theme:"primary",type:"submit",block:"",loading:s.value},{default:l(()=>S[4]||(S[4]=[x("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),A("div",xl,[t(h,{onClick:S[2]||(S[2]=()=>{fe(a).$router.push({name:"login-forget"})})},{default:l(()=>S[5]||(S[5]=[x("忘记密码")])),_:1}),t(h,{onClick:S[3]||(S[3]=()=>{fe(a).$router.push({name:"register"})})},{default:l(()=>S[6]||(S[6]=[x("注册账户")])),_:1})])]),_:1})}}}),jl=ne(Ll,[["__scopeId","data-v-be6a0deb"]]),Vl={class:"dida-login-footer"},Dl=ae({__name:"RegisterView",setup(e){const{globalProperties:a}=re(),n=Pe(),s=f(!1),o=f(!1),c=f(!1),_=f("发送验证码");let I=null,S=-1;const y=f(!1),v=f(null),r=f({username:"",password:"",confirmPassword:"",nickname:"",email:"",emailKey:""}),h=f({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:V=>new Promise(j=>{const g=setTimeout(()=>{j(r.value.password===V),clearTimeout(g)})}),message:"两次密码不一致"}],nickname:[{required:!0,message:"请填写昵称"},{min:1,message:"昵称至少1个字符"},{max:30,message:"昵称最多30个字符"}],email:[{required:!0,message:"请填写邮箱"},{pattern:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"邮箱格式不正确"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),k=f(()=>t(O,{onClick:p,disabled:c.value,loading:o.value,style:"width:120px"},{default:()=>[_.value]})),p=async()=>{var m;if(!r.value.email){ce(a,"请输入邮箱");return}if(!r.value.email.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)){ce(a,"邮箱格式不正确");return}if(c.value||o.value)return;y.value=!0,await xe();const V=document.getElementById("cf-confirm-div");V&&V.remove();const j=document.createElement("div");j.id="cf-confirm-div",j.setAttribute("data-theme","light"),(m=v.value)==null||m.appendChild(j);const g=window;g.turnstile.ready(function(){g.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(R){y.value=!1,await i(R)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},i=async V=>{if(!c.value){o.value=!0;try{const j=await Sl(V,r.value.email);if(j.code!==0){H(a,j.code);return}pe(a,"发送验证码成功"),o.value=!1,c.value=!0,I=new Date,_.value="60秒后重发",S=setInterval(()=>{const m=Math.floor((new Date().getTime()-(I==null?void 0:I.getTime()))/1e3);m>60?(_.value="发送验证码",c.value=!1,clearInterval(S)):_.value=`${60-m}秒后重发`},1e3)}catch{ce(a,"发送验证码失败")}finally{o.value=!1}}},P=()=>{pe(a,"重置成功")},K=({validateResult:V,firstError:j,e:g})=>{if(!s.value){if(g.preventDefault(),V!==!0){ce(a,j);return}if(r.value.password!==r.value.confirmPassword){ce(a,"两次密码不一致");return}s.value=!0,Il(r.value.username,r.value.password,r.value.email,r.value.emailKey,r.value.nickname).then(m=>{m.code===0?(pe(a,"注册成功，可使用账号信息登录"),a.$router.push({name:"login"})):H(a,m.code)}).catch(m=>{console.error("Login error",m),ce(a,"登录失败")}).finally(()=>{s.value=!1})}};return le(()=>{if(n.isLogin()){a.$router.push({path:"/user"});return}}),Ce(()=>{clearInterval(S)}),(V,j)=>{const g=De,m=Ve,R=Kt,z=O,T=je,b=Oe,d=se,U=Fe;return D(),Y(te,null,[t(d,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:l(()=>[t(T,{ref:"form",rules:h.value,data:r.value,colon:!0,onReset:P,onSubmit:K,class:"yj-login-form"},{default:l(()=>[t(m,{name:"username",label:"用户名"},{default:l(()=>[t(g,{modelValue:r.value.username,"onUpdate:modelValue":j[0]||(j[0]=L=>r.value.username=L),clearable:"",placeholder:"用于登录与查找"},null,8,["modelValue"])]),_:1}),t(m,{name:"password",label:"密码"},{default:l(()=>[t(g,{modelValue:r.value.password,"onUpdate:modelValue":j[1]||(j[1]=L=>r.value.password=L),type:"password",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(m,{name:"confirmPassword",label:"确认密码"},{default:l(()=>[t(g,{modelValue:r.value.confirmPassword,"onUpdate:modelValue":j[2]||(j[2]=L=>r.value.confirmPassword=L),type:"password",clearable:"",placeholder:"请确认密码"},null,8,["modelValue"])]),_:1}),t(m,{name:"nickname",label:"昵称"},{default:l(()=>[t(g,{modelValue:r.value.nickname,"onUpdate:modelValue":j[3]||(j[3]=L=>r.value.nickname=L),clearable:"",placeholder:"用于优先在网站各处展示"},null,8,["modelValue"])]),_:1}),t(m,{name:"email",label:"邮箱"},{default:l(()=>[t(g,{modelValue:r.value.email,"onUpdate:modelValue":j[4]||(j[4]=L=>r.value.email=L),clearable:"",placeholder:"请填写常用邮箱"},null,8,["modelValue"])]),_:1}),t(m,{name:"emailKey",label:"验证码"},{default:l(()=>[t(R,{append:k.value},{default:l(()=>[t(g,{modelValue:r.value.emailKey,"onUpdate:modelValue":j[5]||(j[5]=L=>r.value.emailKey=L),clearable:"",placeholder:"请输入验证码",style:{width:"140px"}},null,8,["modelValue"])]),_:1},8,["append"])]),_:1}),t(m,null,{default:l(()=>[t(z,{theme:"primary",type:"submit",block:"",loading:s.value},{default:l(()=>j[8]||(j[8]=[x("注册")])),_:1},8,["loading"])]),_:1})]),_:1},8,["rules","data"]),A("div",Vl,[t(b,{onClick:j[6]||(j[6]=()=>{fe(a).$router.push({name:"login"})})},{default:l(()=>j[9]||(j[9]=[x("返回登陆 ")])),_:1})])]),_:1}),t(U,{visible:y.value,"onUpdate:visible":j[7]||(j[7]=L=>y.value=L),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:l(()=>[A("div",{ref_key:"dialogContainer",ref:v,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),$l=ne(Dl,[["__scopeId","data-v-9b5f4fc7"]]),zl={style:{margin:"12px"}},Ul=ae({__name:"UserView",setup(e){let a=de();const{globalProperties:n}=re(),s=Ue();let o="";const c=f(!1),_=f(null),I=f([]),S=async y=>{c.value=!0;try{let v=await kl(y);if(v.code!==0){c.value=!1,H(n,v.code),await W.push({name:"home"});return}_.value=hl(v.data.user),I.value=v.data.problems_ac,s.setTitle(_.value.nickname+" - "+s.getTitle)}catch{ce(n,"获取用户信息失败"),await W.push({name:"home"})}finally{c.value=!1}};return pa(async(y,v,r)=>{if(Array.isArray(y.params.username)?o=y.params.username[0]:o=y.params.username,!o){await W.push({name:"home"});return}await S(o),r()}),le(async()=>{if(Array.isArray(a.params.username)?o=a.params.username[0]:o=a.params.username,!o){await W.push({name:"home"});return}await S(o)}),(y,v)=>{const r=O,u=_e,h=se,k=be,p=La,i=Ee,P=Re,K=ve,V=ke;return D(),F(V,{loading:c.value},{default:l(()=>[t(K,{class:"dida-main-content"},{default:l(()=>[t(k,{span:8},{default:l(()=>[t(h,{style:{margin:"10px"},title:"AC题目"},{default:l(()=>[t(u,{style:{"flex-wrap":"wrap"}},{default:l(()=>[(D(!0),Y(te,null,ge(I.value,j=>(D(),F(r,{key:j,size:"small",onClick:()=>fe(W).push({name:"problem-detail",params:{problemId:j}})},{default:l(()=>[x(q(j),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1}),t(k,{span:4},{default:l(()=>[A("div",zl,[t(P,{layout:"vertical",bordered:!0},{default:l(()=>[t(i,{label:"头像"},{default:l(()=>{var j;return[t(p,{shape:"round",size:"100px",image:(j=_.value)==null?void 0:j.avatar,"hide-on-load-failed":!1},null,8,["image"])]}),_:1}),t(i,{label:"昵称"},{default:l(()=>{var j;return[x(q((j=_.value)==null?void 0:j.nickname),1)]}),_:1}),t(i,{label:"Slogan"},{default:l(()=>{var j;return[x(q((j=_.value)==null?void 0:j.slogan),1)]}),_:1}),t(i,{label:"邮箱"},{default:l(()=>{var j;return[x(q((j=_.value)==null?void 0:j.email),1)]}),_:1}),t(i,{label:"组织"},{default:l(()=>{var j;return[x(q((j=_.value)==null?void 0:j.organization),1)]}),_:1}),t(i,{label:"通过数量"},{default:l(()=>{var j;return[x(q((j=_.value)==null?void 0:j.accept),1)]}),_:1}),t(i,{label:"提交数量"},{default:l(()=>{var j;return[x(q((j=_.value)==null?void 0:j.attempt),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Al=ne(Ul,[["__scopeId","data-v-7d1db43a"]]),bt=[{name:"home",path:"/",title:"首页",showSidebar:!1,disableGenerateTab:!0,component:dl},{name:"problem",path:"/problem",title:"题目",icon:"calculation",showSidebar:!0,redirect:"problem-list"},{name:"collection-detail-tab",title:"题集",path:"/collection",showSidebar:!0,disableGenerateTab:!0,redirect:"collection-list"},{name:"judge",path:"/judge",title:"评测",icon:"code",showSidebar:!0,redirect:"judge-list"},{name:"contest",path:"/contest",title:"比赛",icon:"application",showSidebar:!0,redirect:"contest-list"},{name:"contest-detail-tab",title:"比赛",path:"/contest",showSidebar:!0,disableGenerateTab:!0,redirect:"contest-list"},{name:"discuss",title:"讨论",path:"/discuss",icon:"sonic",showSidebar:!0,redirect:"discuss-list"},{name:"rank",path:"/rank",title:"排名",icon:"chart-column",showSidebar:!0,redirect:"rank-ac-all"},{name:"tool",path:"/tool",title:"工具",icon:"tools",showSidebar:!0,redirect:"tool-paste"},{name:"system",path:"/system",title:"系统",icon:"dashboard",showSidebar:!0,redirect:"system-status"},{name:"manage",path:"/manage",title:"管理",icon:"command",showSidebar:!0,redirect:"manage-judge",auths:[$e.Manage]},{name:"login",path:"/login",title:"登陆",showSidebar:!1,disableGenerateTab:!0,component:jl},{name:"register",path:"/register",title:"注册",showSidebar:!1,disableGenerateTab:!0,component:$l},{name:"user",path:"/user/:username+",title:"用户",showSidebar:!1,needLogin:!0,disableGenerateTab:!0,component:Al},{name:"404",path:"/404",title:"404",showSidebar:!1,disableGenerateTab:!0,component:Bt}],Rl=e=>bt.find(a=>a.name==e),El=e=>{const a=[];return bt.forEach(n=>{!n.disableGenerateTab&&e.hasAllAuths(n.auths)&&a.push(n)}),a},Kl=e=>{bt.forEach(a=>{const n={name:a.name,path:a.path,meta:{title:a.title,tab:a.name,showSidebar:a.showSidebar,needLogin:a.needLogin,redirect:a.redirect,tabAuths:a.auths},component:a.component};e.push(n)})};function Wt(e){return e.children!==void 0}function ql(e){return e.children!==void 0}var ht=(e=>(e[e.Unknown=-1]="Unknown",e[e.C=0]="C",e[e.Cpp=1]="Cpp",e[e.Java=2]="Java",e[e.Python=3]="Python",e[e.Pascal=4]="Pascal",e[e.Golang=5]="Golang",e[e.Lua=6]="Lua",e[e.TypeScript=7]="TypeScript",e[e.Max=8]="Max",e))(ht||{});function yt(){const e=[-1,8];return Object.values(ht).filter(a=>typeof a=="number"&&!e.includes(a)).map(a=>({value:a,label:Jt(a)}))}function Ml(e){return e>-1&&e<8}function Jt(e){switch(e){case 0:return"C";case 1:return"C++";case 2:return"Java";case 3:return"Python";case 4:return"Pascal";case 5:return"Golang";case 6:return"Lua";case 7:return"TypeScript";default:return"Unknown"}}function wt(e){switch(e){case 0:return"c";case 1:return"cpp";case 2:return"java";case 3:return"python";case 4:return"pascal";case 5:return"go";case 6:return"lua";case 7:return"typescript";default:return"text"}}var Ie=(e=>(e[e.Init=0]="Init",e[e.Rejudge=1]="Rejudge",e[e.Submitting=2]="Submitting",e[e.Queuing=3]="Queuing",e[e.Compiling=4]="Compiling",e[e.Running=5]="Running",e[e.Accept=6]="Accept",e[e.PE=7]="PE",e[e.WA=8]="WA",e[e.TLE=9]="TLE",e[e.MLE=10]="MLE",e[e.OLE=11]="OLE",e[e.RE=12]="RE",e[e.CE=13]="CE",e[e.CLE=14]="CLE",e[e.JudgeFail=15]="JudgeFail",e[e.SubmitFail=16]="SubmitFail",e[e.Unknown=17]="Unknown",e[e.Max=18]="Max",e))(Ie||{});const Fl=e=>{switch(e){case 0:return"普通评测";case 1:return"特殊评测";default:return"未知"}},lt=e=>{switch(e){case 0:return"等待处理";case 1:return"重新评测";case 2:return"提交中";case 3:return"队列中";case 4:return"编译中";case 5:return"运行中";case 6:return"通过";case 7:return"格式错误";case 8:return"答案错误";case 9:return"超时";case 10:return"内存超限";case 11:return"输出超限";case 12:return"运行错误";case 13:return"编译错误";case 14:return"编译超限";case 15:return"评测失败";case 16:return"提交失败";case 17:return"未知";default:return e}},Xt=e=>{switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return"default";case 6:return"success";case 7:return"warning";default:return"danger"}};function Yt(){const e=[17,18];return Object.values(Ie).filter(a=>typeof a=="number"&&!e.includes(a)).map(a=>({value:a,label:lt(a)}))}function Ne(e){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return!0;default:return!1}}function Zt(e){var n;const a={};if(a.id=e.id,a.problemId=e.problem_id,a.contestProblemIndex=e.contest_problem_index,a.status=e.status,Ne(e.status)?a.score="-":a.score=e.score.toString(),e.time?a.time=Math.ceil(e.time/1e6)+"ms":a.time="-",e.memory?a.memory=(e.memory/1024/1024).toFixed(2)+"MB":a.memory="-",a.language=Jt(e.language),a.codeLength=e.code_length,e.approve_time?a.approveTime=new Date(e.approve_time).toLocaleString():a.approveTime="-",a.author=e.author,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.code=e.code,a.compileMessage=e.compile_message,a.taskCurrent=e.task_current,a.taskTotal=e.task_total,a.task=[],e.task)for(let s=0;s<((n=e.task)==null?void 0:n.length);s++){const o=e.task[s],c={};c.taskId=o.task_id,c.status=o.status,o.time?c.time=Math.ceil(o.time/1e6)+"ms":c.time="-",o.memory?c.memory=(o.memory/1024/1024).toFixed(2)+"MB":c.memory="-",c.score=o.score,c.content=o.content,c.waHint=o.wa_hint,!c.content&&!c.waHint&&(c.content="无提示信息"),a.task.push(c)}return e.judger&&(a.judger=e.judger),e.judge_time&&(a.judgeTime=new Date(e.judge_time).toLocaleString()),a}function Gl(e,a,n,s,o){return J({url:"/judge/approve",method:"post",data:{problem_id:e,contest_id:a,problem_index:n,language:s,code:o}})}function Nl(e){return J({url:"/judge?id="+e,method:"get"})}function Ol(e){return J({url:"/judge/code?id="+e,method:"get"})}function Hl(e,a,n,s,o,c,_){const I=new URLSearchParams({contest_id:String(e),problem_id:a,username:n,language:String(s),status:String(o),page:String(c),page_size:String(_)});return J({url:`/judge/list?${I.toString()}`,method:"get"})}function Bl(){return J({url:"/judge/rejudge/recently",method:"post"})}function Wl(e,a,n){const s={};return e!=null&&(s.problem_id=e),a!=null?s.language=a:s.language=ht.Unknown,n!=null?s.status=n:s.status=18,J({url:"/judge/rejudge/search",method:"post",data:s})}function Jl(){return J({url:"/judge/rejudge/all",method:"post",timeout:0})}function Xl(e){return J({url:"/judge/rejudge",method:"post",data:{id:Number(e)}})}var Je=(e=>(e[e.None=0]="None",e[e.Attempt=1]="Attempt",e[e.Accept=2]="Accept",e))(Je||{});function Ye(e,a){const n={};if(n.id=e.id,n.author=e.author,n.title=e.title,n.tags=[],e.tags)for(const s of e.tags){const o=a[s];o&&n.tags.push(o)}if(n.private=e.private,n.accept=e.accept,n.attempt=e.attempt,e.description!=null&&(n.description=e.description),e.time_limit!=null&&e.time_limit>=0?n.timeLimit=e.time_limit.toString()+" ms":n.timeLimit="未知",e.memory_limit!=null&&e.memory_limit>=0?n.memoryLimit=(e.memory_limit/1024).toFixed(2)+" MB":n.memoryLimit="未知",e.judge_type!=null&&(n.judgeType=Fl(e.judge_type)),e.insert_time!=null&&(n.insertTime=new Date(e.insert_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.source!=null){const s=/\[([^\]]+)\]\(([^)]+)\)/,o=e.source.match(s);o?(n.source=o[1],n.sourceUrl=o[2]):(n.source=e.source,n.sourceUrl="")}return e.judge_md5!=null&&(n.judgeMd5=e.judge_md5),e.origin_oj!=null&&(n.originOj=e.origin_oj),e.origin_id!=null&&(n.originId=e.origin_id),e.origin_url!=null&&(n.originUrl=e.origin_url),n}function Qt(e,a,n){const s={};return e?s.id=e:(s.contest_id=a,s.problem_index=n),J({url:`/problem?${new URLSearchParams(s).toString()}`,method:"get"})}function ea(e){return J({url:"/problem/tag/list?max_count="+e,method:"get"})}function Yl(e){return J({url:"/problem/judge?id="+e,method:"get"})}function Zl(e,a,n,s,o,c){const _={};return e&&(_.oj=e),a&&(_.title=a),n&&(_.tag=n),s!==void 0&&(_.private=s?"1":"0"),o&&(_.page=o),c&&(_.page_size=c),J({url:`/problem/list?${new URLSearchParams(_).toString()}`,method:"get"})}function Ql(e){const a={};return e&&(a.problem_id=e),J({url:`/problem/recommend?${new URLSearchParams(a).toString()}`,method:"get"})}function ta(e,a){return J({url:"/problem/crawl",method:"post",data:{oj:e,id:a}})}function en(e,a,n,s,o,c,_){return J({url:"/problem/create",method:"post",data:{title:e,time_limit:a,memory_limit:n,source:s,private:o,tags:c,description:_}})}function tn(e,a,n,s,o,c,_,I){return J({url:"/problem/edit",method:"post",data:{id:e,title:a,time_limit:n,memory_limit:s,source:o,private:c,tags:_,description:I}})}function an(e,a){return J({url:"/problem/judge/data/download?id="+e+"&key="+a,method:"get"})}function ln(e,a){const n=new FormData;return n.append("id",e),n.append("zip",a),J({url:"/problem/judge/data",method:"post",data:n,headers:{"Content-Type":"multipart/form-data"},timeout:1e3*60*5})}function nn(e){return J({url:"/problem/parse",method:"post",data:{problems:e}})}const on={style:{margin:"10px"}},sn={key:0,class:"dida-operation-container"};function rn(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!qe(e)}const un=ae({__name:"ProblemList",setup(e){const a=de(),n=ze(),{globalProperties:s}=re(),o=Pe();let c=null;const _=f(!1),I={};let S={};const y=f(!1),v=Ae(()=>o.hasAuth($e.ManageProblem)),r=f([{title:"ID",colKey:"id",cell:(L,w)=>{let C=m(w.row.id);return t(O,{variant:"dashed",theme:C,onClick:()=>g(w.row.id)},{default:()=>[w.row.id]})}},{title:"标题",colKey:"title",cell:(L,w)=>t(O,{variant:"text",onClick:()=>g(w.row.id)},{default:()=>[w.row.title]})},{title:"标签",colKey:"tags",cell:(L,w)=>{const C=w.row.tags;if(!C||C.length===0)return"";let $=[];for(let G=0;G<C.length;G++){const E=C[G];$.push(t(O,{key:G,theme:"default",variant:"outline",size:"small",onClick:()=>T(E)},{default:()=>[E.name]}))}return t(_e,null,rn($)?$:{default:()=>[$]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),u=f(!1);let h=1,k=50;const p=f({current:h,pageSize:k,defaultCurrent:h,defaultPageSize:k,total:0,pageSizeOptions:[50,100]}),i=f(),P=f(),K=[{label:"DidaOJ",value:"didaoj"},{label:"HDU",value:"hdu"},{label:"POJ",value:"poj"},{label:"NYOJ",value:"nyoj"}],V=f({oj:"",title:"",tag:"",private:!1}),j=f({oj:"",problem:""}),g=L=>{L&&n.push({path:"/problem/"+L})},m=L=>{if(!L||!S)return"default";const w=S[L];if(!w)return"default";switch(w){case Je.Accept:return"success";case Je.Attempt:return"warning";default:return"default"}},R=async()=>{await n.push({query:{...a.query,oj:V.value.oj,title:V.value.title,tag:V.value.tag,private:V.value.private?"1":"0",page:1,page_size:p.value.defaultPageSize}})},z=async()=>{try{y.value=!0;const L=await ta(j.value.oj,j.value.problem);L.code===0?(pe(s,"搜索成功"),await n.push({name:"problem-detail",params:{problemId:L.data}})):H(s,L.code)}catch(L){console.error(L),H(s,Te())}finally{y.value=!1}},T=L=>{L&&n.push({query:{...a.query,title:"",tag:L.name,page:1,page_size:p.value.defaultPageSize}})},b=()=>{n.push({name:"manage-problem-create"})},d=async(L,w)=>{u.value=!0;try{const{current:C,pageSize:$}=L,G=await Zl(V.value.oj,V.value.title,V.value.tag,V.value.private,C,$);if(i.value=[],G.code===0){const E=G.data.list;if(!E||E.length<=0){p.value={...p.value,total:0},S={},pe(s,"未找到记录");return}E.forEach(X=>{var ee;const B=Ye(X,I);(ee=i.value)==null||ee.push(B)}),p.value={...p.value,total:G.data.total_count},S=G.data.problem_attempt_status}else w&&H(s,G.code)}catch(C){console.error(C),H(s,Te())}finally{u.value=!1}},U=async L=>{await n.push({query:{...a.query,page:L.current,page_size:L.pageSize}})};return le(async()=>{u.value=!0,P.value=[],ea(-1).then(L=>{if(L.code===0){P.value=L.data.list,_.value=L.data.total_count>L.data.list.length;for(let w=0;w<L.data.list.length;w++){const C=L.data.list[w];I[C.id]=C}c=Le(()=>a.query,w=>{V.value.oj=w.oj||"",V.value.title=w.title||"",V.value.tag=w.tag||"",V.value.private=w.private==="1";const C=parseInt(w.page)||p.value.defaultCurrent,$=parseInt(w.page_size)||p.value.defaultPageSize;h=C,k=$,p.value={...p.value,current:h,pageSize:k},d({current:h,pageSize:k},!0)},{immediate:!0})}else _.value=!0}).catch(L=>{console.error(L),_.value=!0})}),Ce(()=>{c&&c()}),(L,w)=>{const C=Se,$=se,G=be,E=O,X=_e,B=st,ee=Ve,N=De,me=qt,ye=je,ie=ve;return D(),F(ie,null,{default:l(()=>[t(G,{span:9},{default:l(()=>[t($,{style:{margin:"10px"}},{default:l(()=>[t(C,{data:i.value,columns:r.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:p.value,"table-layout":"auto",loading:u.value,onPageChange:U},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(G,{span:3},{default:l(()=>[A("div",on,[v.value?(D(),Y("div",sn,[t(X,null,{default:l(()=>[t(E,{onClick:b},{default:l(()=>w[7]||(w[7]=[x("新建")])),_:1})]),_:1})])):oe("",!0),t($,{class:"sh-card"},{default:l(()=>[t(ye,{model:V.value,onSubmit:R},{default:l(()=>[t(ee,{label:"OJ"},{default:l(()=>[t(B,{modelValue:V.value.oj,"onUpdate:modelValue":w[0]||(w[0]=Q=>V.value.oj=Q),options:K,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(ee,{label:"标题"},{default:l(()=>[t(N,{modelValue:V.value.title,"onUpdate:modelValue":w[1]||(w[1]=Q=>V.value.title=Q),placeholder:"请输入关键词"},null,8,["modelValue"])]),_:1}),t(ee,{label:"标签"},{default:l(()=>[t(N,{modelValue:V.value.tag,"onUpdate:modelValue":w[2]||(w[2]=Q=>V.value.tag=Q),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),v.value?(D(),F(ee,{key:0,label:"私有"},{default:l(()=>[t(me,{modelValue:V.value.private,"onUpdate:modelValue":w[3]||(w[3]=Q=>V.value.private=Q)},null,8,["modelValue"])]),_:1})):oe("",!0),t(ee,null,{default:l(()=>[t(E,{theme:"primary",type:"submit"},{default:l(()=>w[8]||(w[8]=[x("搜索")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t($,{class:"sh-card"},{default:l(()=>[t(ye,{model:j.value,onSubmit:z},{default:l(()=>[t(ee,{label:"OJ"},{default:l(()=>[t(B,{modelValue:j.value.oj,"onUpdate:modelValue":w[4]||(w[4]=Q=>j.value.oj=Q),options:K,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(ee,{label:"题目"},{default:l(()=>[t(N,{modelValue:j.value.problem,"onUpdate:modelValue":w[5]||(w[5]=Q=>j.value.problem=Q),placeholder:"请输入原始题号"},null,8,["modelValue"])]),_:1}),t(ee,null,{default:l(()=>[t(E,{theme:"primary",type:"submit",loading:y.value},{default:l(()=>w[9]||(w[9]=[x("前往")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),t($,{class:"sh-card sh-background-black"},{default:l(()=>[(D(!0),Y(te,null,ge(P.value,Q=>(D(),F(E,{class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:()=>T(Q)},{default:l(()=>[x(q(Q.name),1)]),_:2},1032,["onClick"]))),256)),_.value?(D(),F(E,{key:0,class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:w[6]||(w[6]=()=>L.$router.push("/problem/tags"))},{default:l(()=>w[10]||(w[10]=[x(" ... ")])),_:1})):oe("",!0)]),_:1})])]),_:1})]),_:1})}}}),cn=ne(un,[["__scopeId","data-v-bc7185f5"]]);function Me(e){e.querySelectorAll("pre > code:not([data-copy-attached])").forEach(n=>{n.setAttribute("data-copy-attached","true");const s=n.parentElement,o=document.createElement("div");o.className="copy-wrapper";const c=document.createElement("button");c.className="copy-btn",c.innerText="复制",c.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(n.innerText),c.innerText="已复制",setTimeout(()=>c.innerText="复制",1500)}catch{c.innerText="失败"}}),s.replaceWith(o),o.appendChild(c),o.appendChild(s)})}function Ke(e){let a="";for(;e>0;)e--,a=String.fromCharCode(65+e%26)+a,e=Math.floor(e/26);return a}async function aa(e){const a={};if(a.id=e.id,a.ownerId=e.owner_id,a.ownerUsername=e.owner_username,a.ownerNickname=e.owner_nickname,a.title=e.title,a.startTime=new Date(e.start_time).toLocaleString(),a.endTime=new Date(e.end_time).toLocaleString(),e.descriptions){a.descriptions=[];const n={math:{inlineDigit:!0,engine:"KaTeX"}};for(let s=0;s<e.descriptions.length;s++){const o=e.descriptions[s],c={};c.title=o.title,c.content=await ue.md2html(o.content,n),c.sort=o.sort,a.descriptions.push(c)}}if(a.notification=e.notification,e.problems){a.problems=[],e.problems.sort((n,s)=>n.index-s.index);for(let n=0;n<e.problems.length;n++){const s=e.problems[n];s.accept||(s.accept=0),s.attempt||(s.attempt=0),s.id=Ke(s.index),a.problems.push(s)}}return a}function dn(e){return J({url:"/contest?id="+e,method:"get"})}function mn(e,a){return J({url:"/contest/list?page="+e+"&page_size="+a,method:"get"})}function pn(e){return J({url:"/contest/rank?id="+e,method:"get"})}function fn(e){return J({url:"/contest/create",method:"post",data:e})}const _n=["innerHTML"],vn={style:{margin:"12px"}},gn={key:1},bn={class:"dida-operation-container"},hn={class:"dida-operation-container"},yn={class:"dida-code-submit-div"},wn=ae({__name:"ProblemDetail",setup(e){let a=de();const{globalProperties:n}=re(),s=Ue(),o=Pe();let c=f(""),_="",I=0,S=0;const y=f(!1),v=f(null),r=f(!1),u=f(null);let h=null;const k=f(null),p=f(!1),i=f(!1),P={},K=f(""),V=f([]);V.value=yt();const j=Ae(()=>o.hasAuth($e.ManageProblem)),g=w=>{w&&W.push({name:"problem-list",query:{...a.query,title:"",tag:w.name}})},m=()=>{W.push({name:"manage-problem",params:{problemId:_}})},R=()=>{_?W.push({name:"judge-list",query:{problem_id:_}}):W.push({name:"contest-judge",params:{contestId:I},query:{problem_id:Ke(S)}})},z=()=>{_?W.push({name:"discuss-list-problem",query:{problem_id:_}}):W.push({name:"contest-discuss",params:{contestId:I},query:{problem_id:Ke(S)}})},T=()=>{W.push({name:"problem-recommend",params:{problemId:_}})},b=async()=>{var $,G;const w=($=u.value)==null?void 0:$.originOj,C=(G=u.value)==null?void 0:G.originId;if(!(!w||!C))try{p.value=!0;const E=await ta(w,C);E.code===0?(await L(),pe(n,"更新成功")):H(n,E.code)}catch{ce(n,"更新失败，请稍后再试")}finally{p.value=!1}},d=async()=>{if(!_){ce(n,"问题ID无效");return}const w=parseInt(K.value);if(!Ml(w)){ce(n,"请选择所编写的语言");return}const C=h==null?void 0:h.getValue();if(!C){ce(n,"请输入所需提交的代码");return}i.value=!0;try{const $=await Gl(_,I,S,w,C);if($.code!==0){H(n,$.code);return}pe(n,"提交成功，正在跳转到详情页面");const G=$.data.id;await W.push({path:"/judge/"+G})}finally{i.value=!1}},U=w=>{if(!h)return;const C=h.getModel();C&&Ct.setModelLanguage(C,wt(w))},L=async()=>{let w=await Qt(_,I,S);if(w.code!==0){r.value=!1,H(n,w.code),await W.push({name:"problem"});return}w.data.tags&&w.data.tags.forEach(G=>{P[G.id]=G}),u.value=Ye(w.data.problem,P),s.setTitle(u.value.title+" - "+s.getTitle);let C=u.value.description;const $={math:{inlineDigit:!0,engine:"KaTeX"}};c.value=await ue.md2html(C,$),await xe(()=>{v.value&&(ue.mathRender(v.value),ue.highlightRender({lineNumber:!0,enable:!0},v.value),Me(v.value),!h&&k.value&&(h=Ct.create(k.value,{value:"",language:"cpp",minimap:{enabled:!0},colorDecorators:!0,readOnly:!1,theme:"vs-dark"}))),r.value=!1})};return le(async()=>{if(Array.isArray(a.params.problemId)?_=a.params.problemId[0]:_=a.params.problemId,!_){if(Array.isArray(a.params.contestId)?I=Number(a.params.contestId[0]):I=Number(a.params.contestId),!I){ce(n,"题目不存在"),await W.push({name:"problem"});return}if(Array.isArray(a.params.problemIndex)?S=parseInt(a.params.problemIndex[0]):S=parseInt(a.params.problemIndex),!S){ce(n,"题目不存在"),await W.push({name:"problem"});return}}y.value=!!I,r.value=!0,await L()}),(w,C)=>{const $=se,G=be,E=Ee,X=Oe,B=O,ee=_e,N=Re,me=vt,ye=st,ie=ve,Q=ke;return D(),F(Q,{loading:r.value},{default:l(()=>[t(ie,{class:"dida-main-content"},{default:l(()=>[t(G,{span:8},{default:l(()=>[t($,{style:{margin:"10px"}},{default:l(()=>[A("div",{innerHTML:fe(c),ref_key:"markdownRef",ref:v},null,8,_n)]),_:1})]),_:1}),t(G,{span:4},{default:l(()=>[A("div",vn,[t(N,{layout:"vertical",bordered:!0},{default:l(()=>{var Z;return[t(E,{label:"标题"},{default:l(()=>{var M;return[x(q((M=u.value)==null?void 0:M.title),1)]}),_:1}),t(E,{label:"时间限制"},{default:l(()=>{var M;return[x(q((M=u.value)==null?void 0:M.timeLimit),1)]}),_:1}),t(E,{label:"内存限制"},{default:l(()=>{var M;return[x(q((M=u.value)==null?void 0:M.memoryLimit),1)]}),_:1}),t(E,{label:"判题方式"},{default:l(()=>{var M;return[x(q((M=u.value)==null?void 0:M.judgeType),1)]}),_:1}),t(E,{label:"正确提交"},{default:l(()=>{var M;return[x(q((M=u.value)==null?void 0:M.accept),1)]}),_:1}),t(E,{label:"提交总数"},{default:l(()=>{var M;return[x(q((M=u.value)==null?void 0:M.attempt),1)]}),_:1}),t(E,{label:"创建时间"},{default:l(()=>{var M;return[x(q((M=u.value)==null?void 0:M.insertTime),1)]}),_:1}),t(E,{label:"更新时间"},{default:l(()=>{var M;return[x(q((M=u.value)==null?void 0:M.updateTime),1)]}),_:1}),t(E,{label:"上传用户"},{default:l(()=>{var M;return[x(q((M=u.value)==null?void 0:M.creatorNickname),1)]}),_:1}),y.value?oe("",!0):(D(),F(E,{key:0,label:"题目来源"},{default:l(()=>{var M,he,we;return[(M=u.value)!=null&&M.sourceUrl?(D(),F(X,{key:0,href:(he=u.value)==null?void 0:he.sourceUrl,target:"_blank"},{default:l(()=>{var He;return[x(q((He=u.value)==null?void 0:He.source),1)]}),_:1},8,["href"])):(D(),Y("span",gn,q((we=u.value)==null?void 0:we.source),1))]}),_:1})),j.value?(D(),F(E,{key:1,label:"是否私有"},{default:l(()=>{var M;return[x(q((M=u.value)!=null&&M.private?"私有":"公开"),1)]}),_:1})):oe("",!0),(Z=u.value)!=null&&Z.originUrl?(D(),F(E,{key:2,label:"原题链接"},{default:l(()=>{var M;return[t(X,{href:(M=u.value)==null?void 0:M.originUrl,target:"_blank"},{default:l(()=>{var he,we;return[x(q((he=u.value)==null?void 0:he.originOj)+" - "+q((we=u.value)==null?void 0:we.originId),1)]}),_:1},8,["href"])]}),_:1})):oe("",!0),fe(_)?(D(),F(E,{key:3,label:"标签"},{default:l(()=>[t(ee,null,{default:l(()=>{var M;return[(D(!0),Y(te,null,ge((M=u.value)==null?void 0:M.tags,he=>(D(),F(B,{key:he.id,variant:"dashed",onClick:()=>g(he)},{default:l(()=>[x(q(he.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})):oe("",!0)]}),_:1}),A("div",bn,[t(ee,null,{default:l(()=>[t(B,{onClick:R},{default:l(()=>C[1]||(C[1]=[x("提交记录")])),_:1}),t(B,{onClick:z},{default:l(()=>C[2]||(C[2]=[x("题目讨论")])),_:1}),fe(_)?(D(),F(B,{key:0,onClick:T},{default:l(()=>C[3]||(C[3]=[x("题目推荐")])),_:1})):oe("",!0)]),_:1})]),A("div",hn,[t(ee,null,{default:l(()=>{var Z;return[j.value?(D(),F(B,{key:0,onClick:m},{default:l(()=>C[4]||(C[4]=[x("编辑")])),_:1})):oe("",!0),(Z=u.value)!=null&&Z.originId?(D(),F(B,{key:1,onClick:b,loading:p.value},{default:l(()=>C[5]||(C[5]=[x("更新描述 ")])),_:1},8,["loading"])):oe("",!0)]}),_:1})]),A("div",yn,[t(ee,null,{default:l(()=>[t(ye,{modelValue:K.value,"onUpdate:modelValue":C[0]||(C[0]=Z=>K.value=Z),label:"语言：",placeholder:"请选择提交语言","auto-width":"",clearable:"",onChange:U},{default:l(()=>[(D(!0),Y(te,null,ge(V.value,Z=>(D(),F(me,{key:Z.value,value:Z.value,label:Z.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),t(B,{onClick:d,loading:i.value},{default:l(()=>C[6]||(C[6]=[x("提交")])),_:1},8,["loading"])]),_:1}),A("div",{ref_key:"codeEditRef",ref:k,class:"dida-code-editor"},null,512)])])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),It=ne(wn,[["__scopeId","data-v-e5bb36b6"]]),kn={style:{margin:"10px"}};function Cn(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!qe(e)}const Sn=ae({__name:"ProblemRecommend",setup(e){const a=de(),n=ze(),{globalProperties:s}=re();let o=null,c="",_={},I={};const S=f([{title:"ID",colKey:"id",cell:(p,i)=>{let P=u(i.row.id);return t(O,{variant:"dashed",theme:P,onClick:()=>r(i.row.id)},{default:()=>[i.row.id]})}},{title:"标题",colKey:"title",cell:(p,i)=>t(O,{variant:"text",onClick:()=>r(i.row.id)},{default:()=>[i.row.title]})},{title:"标签",colKey:"tags",cell:(p,i)=>{const P=i.row.tags;if(!P||P.length===0)return"";let K=[];for(let V=0;V<P.length;V++){const j=P[V];K.push(t(O,{key:V,theme:"default",variant:"outline",size:"small",onClick:()=>h(j)},{default:()=>[j.name]}))}return t(_e,null,Cn(K)?K:{default:()=>[K]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),y=f(!1),v=f(),r=p=>{p&&n.push({path:"/problem/"+p})},u=p=>{if(!p||!I)return"default";const i=I[p];if(!i)return"default";switch(i){case Je.Accept:return"success";case Je.Attempt:return"warning";default:return"default"}},h=p=>{p&&n.push({name:"problem-list",query:{tag:p.name}})},k=async p=>{y.value=!0;try{const i=await Ql(c);if(v.value=[],i.code===0){const P=i.data.list;if(!P||P.length<=0){pe(s,"暂无推荐题目");return}_={},i.data.tags&&i.data.tags.forEach(K=>{_[K.id]=K}),P.forEach(K=>{var j;const V=Ye(K,_);(j=v.value)==null||j.push(V)})}else p&&H(s,i.code)}catch(i){console.error(i),H(s,Te())}finally{y.value=!1}};return le(async()=>{y.value=!0,o=Le(()=>a.query,p=>{Array.isArray(a.params.problemId)?c=a.params.problemId[0]:c=a.params.problemId,k(!0)},{immediate:!0})}),Ce(()=>{o&&o()}),(p,i)=>{const P=Se,K=se,V=be,j=ve;return D(),F(j,null,{default:l(()=>[t(V,{span:9},{default:l(()=>[t(K,{style:{margin:"10px"}},{default:l(()=>[t(P,{data:v.value,columns:S.value,"row-key":"id","vertical-align":"top",hover:!0,"table-layout":"auto",loading:y.value},null,8,["data","columns","loading"])]),_:1})]),_:1}),t(V,{span:3},{default:l(()=>[A("div",kn,[t(K,{class:"sh-card",header:"题目推荐","header-bordered":!0},{default:l(()=>i[0]||(i[0]=[x(" 根据本站其他用户的提交记录推荐类似题目"),A("br",null,null,-1),x("依据推荐算法来计算，与本用户相似度最高的用户做的题，大概率被自己感兴趣。 ")])),_:1})])]),_:1})]),_:1})}}}),In=ne(Sn,[["__scopeId","data-v-77972e8b"]]);async function kt(e){const a={};if(a.id=e.id,a.ownerId=e.owner_id,a.ownerUsername=e.owner_username,a.ownerNickname=e.owner_nickname,a.title=e.title,e.start_time?a.startTime=new Date(e.start_time).toLocaleString():a.startTime="无限制",e.end_time?a.endTime=new Date(e.end_time).toLocaleString():a.endTime="无限制",e.update_time?a.updateTime=new Date(e.update_time).toLocaleString():a.updateTime="",e.create_time?a.createTime=new Date(e.create_time).toLocaleString():a.createTime="",e.description){const n={math:{inlineDigit:!0,engine:"KaTeX"}};a.description=await ue.md2html(e.description,n)}else a.description="";return a.problems=e.problems,a}function Pn(e){return J({url:"/collection?id="+e,method:"get"})}function Tn(e){return J({url:"/collection/edit?id="+e,method:"get"})}function xn(e,a){return J({url:"/collection/list?page="+e+"&page_size="+a,method:"get"})}function Ln(e){return J({url:"/collection/rank?id="+e,method:"get"})}function jn(e){return J({url:"/collection/create",method:"post",data:e})}function Vn(e){return J({url:"/collection/edit",method:"post",data:e})}const Dn={style:{margin:"10px"}},$n=ae({__name:"CollectionList",setup(e){const a=de(),n=ze(),{globalProperties:s}=re();let o=null;const c=f(!1),_=f(!1),I=f([{title:"ID",colKey:"id",width:"100",cell:(g,m)=>t(O,{variant:"text",onClick:()=>p(m.row.id)},{default:()=>[m.row.id]})},{title:"标题",colKey:"title",cell:(g,m)=>t(O,{variant:"text",onClick:()=>p(m.row.id)},{default:()=>[m.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),S=f(!1);let y=1,v=50;const r=f({current:y,pageSize:v,defaultCurrent:y,defaultPageSize:v,total:0,pageSizeOptions:[50,100]}),u=f(),h=f({title:"",username:""}),k=f({title:"",description:"",open_time:[]}),p=g=>{g&&n.push({path:"/collection/"+g})},i=async()=>{await n.push({query:{...a.query,title:h.value.title,username:h.value.username,page:1,page_size:r.value.defaultPageSize}})},P=async(g,m)=>{var R;S.value=!0;try{const{current:z,pageSize:T}=g,b=await xn(z,T);if(u.value=[],b.code===0){const d=b.data.list;for(let U=0;U<d.length;U++){const L=d[U],w=await kt(L);(R=u.value)==null||R.push(w)}r.value={...r.value,total:b.data.total_count}}else m&&H(s,b.code)}catch(z){console.error(z),H(s,Te())}finally{S.value=!1}},K=async g=>{await n.push({query:{...a.query,page:g.current,page_size:g.pageSize}})},V=()=>{c.value=!0},j=async()=>{_.value=!0,console.log("collectionCreateForm",k.value)};return le(async()=>{o=Le(()=>a.query,g=>{h.value.title=g.title||"",h.value.username=g.username||"";const m=parseInt(g.page)||r.value.defaultCurrent,R=parseInt(g.page_size)||r.value.defaultPageSize;y=m,v=R,r.value={...r.value,current:y,pageSize:v},P({current:y,pageSize:v},!0)},{immediate:!0})}),Ce(()=>{o&&o()}),(g,m)=>{const R=Se,z=se,T=be,b=De,d=Ve,U=O,L=je,w=_e,C=ve,$=gt,G=Fe;return D(),Y(te,null,[t(C,null,{default:l(()=>[t(T,{span:9},{default:l(()=>[t(z,{style:{margin:"10px"}},{default:l(()=>[t(R,{data:u.value,columns:I.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:r.value,loading:S.value,onPageChange:K},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(T,{span:3},{default:l(()=>[A("div",Dn,[t(z,{class:"sh-card"},{default:l(()=>[t(L,{model:h.value},{default:l(()=>[t(d,{label:"标题"},{default:l(()=>[t(b,{modelValue:h.value.title,"onUpdate:modelValue":m[0]||(m[0]=E=>h.value.title=E),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(d,{label:"负责人"},{default:l(()=>[t(b,{modelValue:h.value.username,"onUpdate:modelValue":m[1]||(m[1]=E=>h.value.username=E),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(d,null,{default:l(()=>[t(U,{theme:"primary",onClick:i},{default:l(()=>m[6]||(m[6]=[x("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(z,{class:"sh-card"},{default:l(()=>[t(w,null,{default:l(()=>[t(U,{onClick:V},{default:l(()=>m[7]||(m[7]=[x("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),t(G,{visible:c.value,"onUpdate:visible":m[5]||(m[5]=E=>c.value=E),header:"创建比赛",onConfirm:j,"confirm-loading":_.value},{default:l(()=>[t(L,{"label-width":80,model:k.value,onSubmit:m[4]||(m[4]=Ge(()=>{},["prevent"]))},{default:l(()=>[t(d,{label:"标题"},{default:l(()=>[t(b,{modelValue:k.value.title,"onUpdate:modelValue":m[2]||(m[2]=E=>k.value.title=E),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),t(d,{label:"开启时间"},{default:l(()=>[t($,{"enable-time-picker":"","allow-input":"",clearable:"",modelValue:k.value.open_time,"onUpdate:modelValue":m[3]||(m[3]=E=>k.value.open_time=E)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),zn=ne($n,[["__scopeId","data-v-270b7335"]]),Un={style:{margin:"20px"}},An={class:"dida-operation-container"},Rn={style:{margin:"12px"}},En=["innerHTML"],Kn=ae({__name:"CollectionDetail",setup(e){let a=de();const{globalProperties:n}=re(),s=Ue(),o=Pe();let c=0;const _=f(!1),I=f(null),S=Ae(()=>o.hasAuth($e.ManageCollection)||I.value&&o.getUserId==I.value.ownerId),y=f([{title:"问题ID",colKey:"id",cell:(h,k)=>t(O,{variant:"text",onClick:()=>r(k.row.id)},{default:()=>[k.row.id]})},{title:"标题",colKey:"title",cell:(h,k)=>t(O,{variant:"text",onClick:()=>r(k.row.id)},{default:()=>[k.row.title]})},{title:"正确",colKey:"accept",cell:(h,k)=>k.row.accept?k.row.accept:0},{title:"提交",colKey:"attempt",cell:(h,k)=>k.row.attempt?k.row.attempt:0}]),v=f([]),r=h=>{W.push({name:"problem-detail",params:{problemId:h}})},u=()=>{I.value&&W.push({name:"collection-edit",params:{collectionId:I.value.id}})};return le(async()=>{if(Array.isArray(a.params.collectionId)?c=Number(a.params.collectionId[0]):c=Number(a.params.collectionId),!c){await W.push({name:"collection"});return}_.value=!0;const h=await Pn(c);if(h.code!==0){_.value=!1,H(n,h.code),await W.push({name:"collection"});return}I.value=await kt(h.data.collection),v.value=h.data.problems,v.value.sort((k,p)=>k.id.length==p.id.length?k.id.localeCompare(p.id):k.id.length-p.id.length),s.setTitle(I.value.title+" - "+s.getTitle),await xe(()=>{const k=document.querySelectorAll(".dida-content-description");k&&k.length>0&&k.forEach(p=>{ue.mathRender(p),ue.highlightRender({lineNumber:!0,enable:!0},p),Me(p)}),_.value=!1})}),(h,k)=>{const p=ot,i=Se,P=se,K=be,V=O,j=_e,g=Ee,m=Re,R=ve,z=ke;return D(),F(z,{loading:_.value},{default:l(()=>[t(R,{class:"dida-main-content"},{default:l(()=>[t(K,{span:6},{default:l(()=>{var T,b,d;return[A("div",Un,[A("h1",null,q((T=I.value)==null?void 0:T.title),1),(b=I.value)!=null&&b.notification?(D(),F(p,{key:0,theme:"info",message:(d=I.value)==null?void 0:d.notification},null,8,["message"])):oe("",!0)]),t(P,{style:{margin:"10px"}},{default:l(()=>[t(i,{data:v.value,columns:y.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1})]}),_:1}),t(K,{span:6},{default:l(()=>[A("div",An,[t(j,null,{default:l(()=>[S.value?(D(),F(V,{key:0,onClick:u},{default:l(()=>k[0]||(k[0]=[x("编辑")])),_:1})):oe("",!0)]),_:1})]),A("div",Rn,[t(m,{layout:"vertical",bordered:!0},{default:l(()=>[t(g,{label:"开始时间"},{default:l(()=>{var T;return[x(q((T=I.value)==null?void 0:T.startTime),1)]}),_:1})]),_:1}),t(m,{layout:"vertical",bordered:!0},{default:l(()=>[t(g,{label:"结束时间"},{default:l(()=>{var T;return[x(q((T=I.value)==null?void 0:T.endTime),1)]}),_:1})]),_:1})]),t(P,{style:{margin:"10px"}},{default:l(()=>{var T;return[A("div",{innerHTML:(T=I.value)==null?void 0:T.description,class:"dida-content-description"},null,8,En)]}),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])}}}),qn=ne(Kn,[["__scopeId","data-v-3065db32"]]),Mn=ae({__name:"CollectionRank",setup(e){const a=de(),n=ze(),{globalProperties:s}=re();let o=null,c=0,_=0;const I=f([{title:"Rank",colKey:"rank",align:"center",cell:(r,u)=>t(O,{variant:"text",onClick:()=>n.push({name:"collection-user-rank",params:{collectionId:c,userId:u.row.user_id}})},{default:()=>[u.row.rank]})},{title:"昵称",colKey:"nickname",cell:(r,u)=>t(O,{variant:"text",onClick:()=>n.push({name:"user",params:{username:u.row.username}})},{default:()=>[u.row.nickname]})},{title:"Accept",colKey:"accept",align:"center",cell:(r,u)=>t(O,{variant:"text",onClick:()=>n.push({name:"judge-list",query:{username:u.row.username,status:Ie.Accept}})},{default:()=>[u.row.accept]})},{title:"Percent",colKey:"percent",cell:(r,u)=>_===0?"0%":`${(u.row.accept/_*100).toFixed(2)}%`},{title:"Count",colKey:"count",cell:(r,u)=>`${u.row.accept} / ${_}`},{title:"Progress",colKey:"progress",cell:(r,u)=>{let h=100;return _>0&&(h=(u.row.accept/_*100).toFixed(2)),t(Mt,{percentage:h},null)}}]),S=f(!1),y=f(),v=async r=>{S.value=!0;try{const u=await Ln(c);if(y.value=[],u.code===0){_=u.data.problem;const h=u.data.ranks,k=[];for(let p=0;p<h.length;p++){const i=h[p];let P={userId:i.author_id,username:i.author_username,nickname:i.author_nickname};P.accept=i.accept,k.push(P)}k.sort((p,i)=>p.accept!==i.accept?i.accept-p.accept:p.userId-i.userId);for(let p=0;p<k.length;p++)k[p].rank=p+1;y.value=k}else r&&H(s,u.code)}catch(u){console.error(u),H(s,Te())}finally{S.value=!1}};return le(async()=>{o=Le(()=>a.query,async r=>{if(Array.isArray(a.params.collectionId)?c=Number(a.params.collectionId[0]):c=Number(a.params.collectionId),!c){await n.push({name:"collection"});return}await v(!0)},{immediate:!0})}),Ce(()=>{o&&o()}),(r,u)=>{const h=Se,k=se,p=ve;return D(),F(p,null,{default:l(()=>[t(k,{style:{margin:"10px"}},{default:l(()=>[A("div",null,[t(h,{data:y.value,columns:I.value,"row-key":"id","vertical-align":"top",hover:!0,loading:S.value},null,8,["data","columns","loading"])])]),_:1})]),_:1})}}}),Fn={style:{margin:"10px"}},Gn={class:"dida-form-border"},Nn={style:{"text-align":"right"}},On={class:"dida-form-border"},Hn={style:{"text-align":"right"}},Bn={style:{margin:"12px"}},Wn={class:"dida-edit-container"},Jn=ae({__name:"CollectionEdit",setup(e){let a=de();const{globalProperties:n}=re(),s=Ue(),o=f(""),c=f(!1);let _=null;const I=f(!1),S=f(!1),y=f(null),v=f({title:"",openTime:[],private:!0,problems:[],users:[]}),r=f([{title:"问题ID",colKey:"id"},{title:"标题",colKey:"title"}]),u=f([{title:"Username",colKey:"username"},{title:"昵称",colKey:"nickname"}]),h=f([]),k=f([]),p=f(""),i=f("");let P=null;const K=f(!1),V=async()=>{S.value=!0,p.value="请输入问题ID",i.value="",h.value.forEach(b=>{i.value+=`${b.id}
`}),P=async()=>{const b=await nn(i.value);if(b.code!==0){H(n,b.code);return}h.value=b.data.problems,v.value.problems=[],h.value.forEach(d=>{v.value.problems.push(d.id)})}},j=async()=>{S.value=!0,p.value="请输入username",i.value="",k.value.forEach(b=>{i.value+=`${b.username}
`}),P=async()=>{const b=await Cl(i.value);if(b.code!==0){H(n,b.code);return}k.value=b.data.users,v.value.users=[],k.value.forEach(d=>{v.value.users.push(d.id)})}},g=async()=>{K.value=!0,P&&await P(),S.value=!1,K.value=!1},m=async()=>{if(_){I.value=!0,v.value.tags=[];for(let b=0;b<collectionTags.value.length;b++){const d=collectionTags.value[b];d&&d.label&&v.value.tags.push(d.label)}try{const b=await jn(v.value.title,v.value.timeLimit,v.value.memoryLimit,v.value.source,v.value.private,v.value.tags,_.getValue());if(I.value=!0,b.code!==0){H(n,b.code);return}b.data!=null&&await W.push({name:"collection-detail",params:{collectionId:b.data}}),We(n,"创建成功")}finally{I.value=!1}}},R=async()=>{if(_){I.value=!0;try{const b={id:Number(o.value),title:v.value.title,private:v.value.private,problems:v.value.problems,users:v.value.users,description:_.getValue()};v.value.openTime[0]&&(b.start_time=St(v.value.openTime[0])),v.value.openTime[1]&&(b.end_time=St(v.value.openTime[1]));const d=await Vn(b);if(I.value=!0,d.code!==0){H(n,d.code);return}d.data!=null&&(y.value.updateTime=new Date(d.data).toLocaleString()),We(n,"保存成功")}finally{I.value=!1}}},z=b=>{const d={after:()=>{_==null||_.setValue(b),c.value=!1}};_=new ue("collectionEditDiv",d)},T=async()=>{const b=await Tn(o.value);if(b.code!==0){H(n,b.code),console.error("collection get failed",b.code),await W.push({name:"collection"});return}const d=b.data.collection;y.value=await kt(d),h.value=b.data.problems,k.value=b.data.users,v.value.title=d.title,v.value.openTime=[],y.value.startTime?v.value.openTime.push(new Date(y.value.startTime)):v.value.openTime.push(void 0),y.value.endTime?v.value.openTime.push(new Date(y.value.endTime)):v.value.openTime.push(void 0),v.value.private=d.private,v.value.description=d.description,v.value.problems=[],h.value.forEach(L=>{v.value.problems.push(L.id)}),v.value.users=[],k.value.forEach(L=>{v.value.users.push(L.id)}),s.setTitle(d.title+" - "+s.getTitle);let U="";d.description&&(U=d.description),z(U)};return le(async()=>{Array.isArray(a.params.collectionId)?o.value=a.params.collectionId[0]:o.value=a.params.collectionId,o.value?(c.value=!0,await T()):z("")}),(b,d)=>{const U=De,L=Ve,w=gt,C=O,$=Se,G=je,E=se,X=be,B=_e,ee=Ee,N=Re,me=ve,ye=ke,ie=ja,Q=Fe;return D(),Y(te,null,[t(ye,{loading:c.value},{default:l(()=>[t(me,null,{default:l(()=>[t(X,{span:8},{default:l(()=>[A("div",Fn,[t(E,{class:"sh-card"},{default:l(()=>[t(G,{model:v.value},{default:l(()=>[t(L,{label:"标题"},{default:l(()=>[t(U,{modelValue:v.value.title,"onUpdate:modelValue":d[0]||(d[0]=Z=>v.value.title=Z),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),t(L,{label:"开启时间"},{default:l(()=>[t(w,{modelValue:v.value.openTime,"onUpdate:modelValue":d[1]||(d[1]=Z=>v.value.openTime=Z),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(L,{label:"问题"},{default:l(()=>[A("div",Gn,[A("div",Nn,[t(C,{onClick:V},{default:l(()=>d[4]||(d[4]=[x("编辑")])),_:1})]),t($,{data:h.value,columns:r.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])])]),_:1}),t(L,{label:"成员"},{default:l(()=>[A("div",On,[A("div",Hn,[t(C,{onClick:j},{default:l(()=>d[5]||(d[5]=[x("编辑")])),_:1})]),t($,{data:k.value,columns:u.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(X,{span:4},{default:l(()=>[A("div",Bn,[A("div",Wn,[o.value?(D(),F(B,{key:0},{default:l(()=>[t(C,{onClick:R,theme:"danger",loading:I.value},{default:l(()=>d[6]||(d[6]=[x("保存")])),_:1},8,["loading"])]),_:1})):(D(),F(B,{key:1},{default:l(()=>[t(C,{onClick:m,theme:"danger",loading:I.value},{default:l(()=>d[7]||(d[7]=[x("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(D(),F(N,{key:0,layout:"vertical",bordered:!0},{default:l(()=>[t(ee,{label:"创建时间"},{default:l(()=>{var Z;return[x(q((Z=y.value)==null?void 0:Z.insertTime),1)]}),_:1}),t(ee,{label:"更新时间"},{default:l(()=>{var Z;return[x(q((Z=y.value)==null?void 0:Z.updateTime),1)]}),_:1}),t(ee,{label:"创建用户"},{default:l(()=>{var Z;return[x(q((Z=y.value)==null?void 0:Z.authorNickname),1)]}),_:1})]),_:1})):oe("",!0)])]),_:1})]),_:1}),d[8]||(d[8]=A("div",{id:"collectionEditDiv",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"]),t(Q,{visible:S.value,"onUpdate:visible":d[3]||(d[3]=Z=>S.value=Z),onConfirm:g,header:p.value,"confirm-loading":K.value},{default:l(()=>[d[9]||(d[9]=A("div",{style:{"margin-bottom":"10px"}},[A("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(ie,{modelValue:i.value,"onUpdate:modelValue":d[2]||(d[2]=Z=>i.value=Z),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),Xn=ne(Jn,[["__scopeId","data-v-efd08edb"]]),Yn=["innerHTML"];function Pt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!qe(e)}const Zn=ae({__name:"JudgeJobList",setup(e){const a=de(),n=ze(),{globalProperties:s}=re();let o=!1,c=null,_;const I=f(!1),S=f(null),y=f(null),v=f(!1);let r=-1;const u=f({problemId:"",username:"",language:void 0,status:void 0}),h=f([{title:"ID",colKey:"id",cell:(w,C)=>t(O,{variant:"text",onClick:()=>z(C.row.id)},{default:()=>[C.row.id]})},{title:"问题",colKey:"problemId",cell:(w,C)=>{if(r){let $;return t(O,{variant:"text",onClick:()=>R(r,C.row.contestProblemIndex)},Pt($=Ke(C.row.contestProblemIndex))?$:{default:()=>[$]})}return t(O,{variant:"text",onClick:()=>m(C.row.problemId)},{default:()=>[C.row.problemId]})}},{title:"状态",colKey:"status",align:"center",cell:(w,C)=>{const $=C.row.status,G=lt($),E=Xt($);let X=[];return Ne($)&&X.push(t(ke,{text:C.row.state,size:"small",class:"dida-status-loading"},null)),X.push(t("span",null,[G])),t(O,{theme:E,variant:"outline",onClick:()=>z(C.row.id)},Pt(X)?X:{default:()=>[X]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"code",cell:(w,C)=>t(O,{theme:"default",onClick:()=>g(C.row)},{default:()=>[C.row.language+" / "+C.row.codeLength]})},{title:"作者",colKey:"author",width:200,cell:(w,C)=>t(O,{variant:"text",onClick:()=>T(C.row.authorUsername)},{default:()=>[C.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),k=f(!1);let p=1,i=50;const P=f({current:p,pageSize:i,defaultCurrent:p,defaultPageSize:i,total:0,pageSizeOptions:[50,100]}),K=f(),V=f([]);V.value=yt();const j=f([]);j.value=Yt();const g=async w=>{v.value=!0,I.value=!0;try{S.value=w;const C=await Ol(Number(S.value.id));if(C.code===0){const $=C.data,E=`\`\`\`${wt($.language)}
${$.code}
\`\`\``,X={};S.value.code=await ue.md2html(E,X),await xe(()=>{y.value&&(ue.highlightRender({lineNumber:!0,enable:!0},y.value),Me(y.value))})}else H(s,C.code)}finally{v.value=!1}},m=w=>{w&&n.push({path:"/problem/"+w})},R=(w,C)=>{n.push({name:"contest-problem-detail",params:{contestId:w,problemIndex:C}})},z=w=>{w&&(r>0?n.push({name:"contest-judge-detail",params:{contestId:r,judgeId:w}}):n.push({name:"judge-detail",params:{judgeId:w}}))},T=w=>{w&&n.push({path:"/user/"+w})},b=async()=>{await n.push({query:{...a.query,page:1,page_size:i,problem_id:u.value.problemId,username:u.value.username,language:u.value.language,status:u.value.status}})},d=async()=>{u.value.problemId="",u.value.username="",u.value.language=void 0,u.value.status=void 0,await n.push({query:{...a.query,page:1,page_size:i,problem_id:"",username:"",language:void 0,status:void 0}})},U=async(w,C)=>{C&&(k.value=!0);let $=!1;try{const{current:G,pageSize:E}=w,X=await Hl(r,u.value.problemId,u.value.username,u.value.language,u.value.status,G,E);K.value=[],X.code===0?X.data.list&&X.data.list.length>0?(X.data.list.forEach(ee=>{var me;const N=Zt(ee);(me=K.value)==null||me.push(N),Ne(ee.status)&&($=!0)}),P.value={...P.value,total:X.data.total_count}):(pe(s,"未找到记录"),P.value={...P.value,total:0}):C&&H(s,X.code)}catch(G){console.error(G),C&&H(s,Te())}finally{C&&(k.value=!1),$&&o&&(_=setTimeout(()=>{U({current:p,pageSize:i},!1)},5e3))}},L=async w=>{await n.push({query:{...a.query,page:w.current,page_size:w.pageSize}})};return le(async()=>{o=!0,c=Le(()=>a.query,w=>{Array.isArray(a.params.contestId)?r=Number(a.params.contestId[0]):r=Number(a.params.contestId),u.value.problemId=w.problem_id||"",u.value.username=w.username||"",w.language!=null?u.value.language=Number(w.language):u.value.language=void 0,w.status!=null?u.value.status=Number(w.status):u.value.status=void 0;const C=parseInt(w.page)||P.value.defaultCurrent,$=parseInt(w.page_size)||P.value.defaultPageSize;p=C,i=$,P.value.pageSizeOptions.includes(i)||(i=P.value.defaultPageSize),P.value={...P.value,current:p,pageSize:i},U({current:p,pageSize:i},!0)},{immediate:!0})}),Ce(()=>{o=!1,c&&c(),clearTimeout(_)}),(w,C)=>{const $=De,G=Ve,E=vt,X=st,B=O,ee=_e,N=je,me=Se,ye=se,ie=Oe,Q=ke,Z=Fe;return D(),Y(te,null,[t(ye,{style:{margin:"10px"}},{default:l(()=>[t(N,{layout:"inline",onSubmit:b,onReset:d},{default:l(()=>[t(G,{label:"题号"},{default:l(()=>[t($,{modelValue:u.value.problemId,"onUpdate:modelValue":C[0]||(C[0]=M=>u.value.problemId=M),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(G,{label:"用户"},{default:l(()=>[t($,{modelValue:u.value.username,"onUpdate:modelValue":C[1]||(C[1]=M=>u.value.username=M),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(G,{label:"语言"},{default:l(()=>[t(X,{modelValue:u.value.language,"onUpdate:modelValue":C[2]||(C[2]=M=>u.value.language=M),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:l(()=>[(D(!0),Y(te,null,ge(V.value,M=>(D(),F(E,{key:M.value,value:M.value,label:M.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(G,{label:"状态"},{default:l(()=>[t(X,{modelValue:u.value.status,"onUpdate:modelValue":C[3]||(C[3]=M=>u.value.status=M),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:l(()=>[(D(!0),Y(te,null,ge(j.value,M=>(D(),F(E,{key:M.value,value:M.value,label:M.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(G,null,{default:l(()=>[t(ee,null,{default:l(()=>[t(B,{theme:"primary",type:"submit"},{default:l(()=>C[7]||(C[7]=[x("搜索")])),_:1}),t(B,{theme:"default",variant:"base",type:"reset"},{default:l(()=>C[8]||(C[8]=[x("重置")])),_:1})]),_:1})]),_:1})]),_:1}),t(me,{data:K.value,columns:h.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:P.value,loading:k.value,onPageChange:L,"table-layout":"auto"},null,8,["data","columns","pagination","loading"])]),_:1}),t(Z,{visible:I.value,"onUpdate:visible":C[5]||(C[5]=M=>I.value=M),width:"800px","cancel-btn":null,"close-btn":!1,onConfirm:C[6]||(C[6]=M=>I.value=!1)},{header:l(()=>[t(ie,{onClick:C[4]||(C[4]=()=>{var M;z((M=S.value)==null?void 0:M.id)})},{default:l(()=>{var M,he;return[x(q(((M=S.value)==null?void 0:M.id)+" - "+((he=S.value)==null?void 0:he.language)),1)]}),_:1})]),default:l(()=>[t(Q,{loading:v.value},{default:l(()=>{var M;return[A("div",{innerHTML:(M=S.value)==null?void 0:M.code,ref_key:"markdownCodeRef",ref:y,style:{"min-height":"100px"}},null,8,Yn)]}),_:1},8,["loading"])]),_:1},8,["visible"])],64)}}}),Tt=ne(Zn,[["__scopeId","data-v-375cd905"]]),Qn={class:"dida-code-container"},eo=["innerHTML"],to={key:2,class:"dida-edit-container"};function xt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!qe(e)}const ao=ae({__name:"JudgeJobDetail",setup(e){const a=de(),n=ze(),s=Pe(),{globalProperties:o}=re();let c=!1,_,I=-1;const S=f(""),y=f(null),v=f(""),r=f(null),u=f(0),h=f(null),k=f({from:"#5a96ff",to:"#00A870"});let p=!1;const i=f([{title:"ID",colKey:"id"},{title:"问题",colKey:"problemId",cell:(d,U)=>t(O,{variant:"text",onClick:()=>m(U.row.problemId)},{default:()=>[U.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(d,U)=>{const L=U.row.status,w=lt(L),C=Xt(L);let $=[];return Ne(L)&&$.push(t(ke,{text:U.row.state,size:"small",class:"dida-status-loading"},null)),$.push(t("span",null,[w])),t(O,{theme:C,variant:"outline"},xt($)?$:{default:()=>[$]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"language",cell:(d,U)=>t("span",null,[U.row.language+" / "+U.row.codeLength])},{title:"作者",colKey:"author",width:200,cell:(d,U)=>t(O,{variant:"text",onClick:()=>R(U.row.authorUsername)},{default:()=>[U.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),P=f(!1),K=f(!1),V=f(),j=Ae(()=>s.hasAuth($e.ManageJudge)),g=async()=>{if(!K.value){K.value=!0;try{const d=await Xl(I);d.code===0?await T(!0):H(o,d.code)}catch(d){console.error(d),H(o,Te())}finally{K.value=!1}}},m=d=>{d&&n.push({path:"/problem/"+d})},R=d=>{d&&n.push({path:"/user/"+d})},z=d=>{const U=d.status,L=lt(U);let w;switch(U){case Ie.Init:case Ie.Rejudge:case Ie.Compiling:case Ie.Running:w="default";break;case Ie.Accept:w="success";break;case Ie.PE:w="warning";break;default:w="danger";break}return t(_e,null,{default:()=>[t(O,{theme:"default",variant:"outline"},{default:()=>[d.taskId]}),t(O,{theme:w,variant:"outline"},xt(L)?L:{default:()=>[L]}),t("span",null,[x("分数："),d.score]),t("span",null,[x("用时："),d.time]),t("span",null,[x("内存："),d.memory])]})},T=async d=>{var L;d&&(P.value=!0);let U=!1;try{const w=await Nl(I);if(V.value=[],w.code===0){const C=w.data,$=Zt(C);if((L=V.value)==null||L.push($),C.judger){const E=await Ht(C.judger);S.value=E.name}else S.value="";k.value.to="#00A870",Ne(C.status)?(h.value="active",$.taskTotal>0?(u.value=$.taskCurrent/$.taskTotal*100,$.taskCurrent>=$.taskTotal&&(u.value=99)):u.value=0):(u.value=100,C.status===Ie.Accept?h.value="success":C.status===Ie.PE?(k.value.to="#F57C20",h.value="warning"):(k.value.to="#F56C6C",h.value="error"));const G={};if(C.code){const X=`\`\`\`${wt(C.language)}
${C.code}
\`\`\``;v.value=await ue.md2html(X,G),await xe(()=>{r.value&&(p||(p=!0,ue.highlightRender({lineNumber:!0,enable:!0},r.value)),Me(r.value))})}y.value=$,Ne(C.status)&&(U=!0)}else d&&H(o,w.code)}catch(w){console.error(w),d&&H(o,Te())}finally{d&&(P.value=!1),U&&c&&(_=setTimeout(()=>{T(!1)},5e3))}};function b(){r.value&&r.value.parentElement&&(r.value.style.maxWidth=r.value.parentElement.clientWidth+"px")}return le(async()=>{if(c=!0,Array.isArray(a.params.judgeId)?I=Number(a.params.judgeId[0]):I=Number(a.params.judgeId),!I){await n.push({name:"judge"});return}await T(!0),b(),window.addEventListener("resize",b)}),Ce(()=>{c=!1,window.removeEventListener("resize",b),clearTimeout(_)}),(d,U)=>{var me,ye,ie;const L=Mt,w=Se,C=se,$=be,G=Ee,E=Re,X=ve,B=Ft,ee=Gt,N=O;return D(),Y(te,null,[t(L,{color:k.value,status:h.value,class:"dida-job-progress",percentage:u.value},null,8,["color","status","percentage"]),t(C,{style:{margin:"10px"}},{default:l(()=>[t(w,{data:V.value,columns:i.value,"row-key":"id","vertical-align":"top",hover:!0,loading:P.value},null,8,["data","columns","loading"])]),_:1}),t(X,null,{default:l(()=>[t($,{span:8},{default:l(()=>[A("div",Qn,[A("div",{innerHTML:v.value,ref_key:"markdownCodeRef",ref:r,class:"dida-code-div"},null,8,eo)])]),_:1}),t($,{span:4},{default:l(()=>[t(E,{layout:"vertical",bordered:!0,style:{margin:"10px"}},{default:l(()=>[t(G,{label:"判题机"},{default:l(()=>[x(q(S.value),1)]),_:1}),t(G,{label:"判题时间"},{default:l(()=>{var Q;return[x(q((Q=y.value)==null?void 0:Q.judgeTime),1)]}),_:1})]),_:1})]),_:1})]),_:1}),(me=y.value)!=null&&me.compileMessage?(D(),F(C,{key:0,class:"compile-message"},{default:l(()=>{var Q;return[x(q((Q=y.value)==null?void 0:Q.compileMessage),1)]}),_:1})):oe("",!0),(ye=y.value)!=null&&ye.task&&((ie=y.value)==null?void 0:ie.task.length)>0?(D(),F(ee,{key:1,class:"task-panel"},{default:l(()=>{var Q;return[(D(!0),Y(te,null,ge((Q=y.value)==null?void 0:Q.task,(Z,M)=>(D(),F(B,{key:Z.taskId,header:()=>z(Z)},{default:l(()=>[x(q(Z.content)+" "+q(Z.waHint),1)]),_:2},1032,["header"]))),128))]}),_:1})):oe("",!0),j.value?(D(),Y("div",to,[t(N,{onClick:g,loading:K.value},{default:l(()=>U[0]||(U[0]=[x("重新评测")])),_:1},8,["loading"])])):oe("",!0)],64)}}}),Lt=ne(ao,[["__scopeId","data-v-574eda0b"]]),lo={style:{margin:"10px"}},no=ae({__name:"ContestList",setup(e){const a=de(),n=ze(),{globalProperties:s}=re();let o=null;const c=f(!1),_=f(!1),I=f([{title:"ID",colKey:"id",width:"100",cell:(g,m)=>t(O,{variant:"text",onClick:()=>p(m.row.id)},{default:()=>[m.row.id]})},{title:"标题",colKey:"title",cell:(g,m)=>t(O,{variant:"text",onClick:()=>p(m.row.id)},{default:()=>[m.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),S=f(!1);let y=1,v=50;const r=f({current:y,pageSize:v,defaultCurrent:y,defaultPageSize:v,total:0,pageSizeOptions:[50,100]}),u=f(),h=f({title:"",username:""}),k=f({title:"",description:"",open_time:[]}),p=g=>{g&&n.push({path:"/contest/"+g})},i=async()=>{await n.push({query:{...a.query,title:h.value.title,username:h.value.username,page:1,page_size:r.value.defaultPageSize}})},P=async(g,m)=>{var R;S.value=!0;try{const{current:z,pageSize:T}=g,b=await mn(z,T);if(u.value=[],b.code===0){const d=b.data.list;for(let U=0;U<d.length;U++){const L=d[U],w=await aa(L);(R=u.value)==null||R.push(w)}r.value={...r.value,total:b.data.total_count}}else m&&H(s,b.code)}catch(z){console.error(z),H(s,Te())}finally{S.value=!1}},K=async g=>{await n.push({query:{...a.query,page:g.current,page_size:g.pageSize}})},V=()=>{c.value=!0},j=async()=>{_.value=!0,console.log("contestCreateForm",k.value),fn(k.value).then(g=>{g.code===0?(pe(s,"创建比赛成功"),c.value=!1,n.push({path:"/contest/"+g.data.id})):H(s,g.code)}).finally(()=>{_.value=!1})};return le(async()=>{o=Le(()=>a.query,g=>{h.value.title=g.title||"",h.value.username=g.username||"";const m=parseInt(g.page)||r.value.defaultCurrent,R=parseInt(g.page_size)||r.value.defaultPageSize;y=m,v=R,r.value={...r.value,current:y,pageSize:v},P({current:y,pageSize:v},!0)},{immediate:!0})}),Ce(()=>{o&&o()}),(g,m)=>{const R=Se,z=se,T=be,b=De,d=Ve,U=O,L=je,w=_e,C=ve,$=gt,G=Fe;return D(),Y(te,null,[t(C,null,{default:l(()=>[t(T,{span:9},{default:l(()=>[t(z,{style:{margin:"10px"}},{default:l(()=>[t(R,{data:u.value,columns:I.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:r.value,loading:S.value,onPageChange:K},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(T,{span:3},{default:l(()=>[A("div",lo,[t(z,{class:"sh-card"},{default:l(()=>[t(L,{model:h.value},{default:l(()=>[t(d,{label:"标题"},{default:l(()=>[t(b,{modelValue:h.value.title,"onUpdate:modelValue":m[0]||(m[0]=E=>h.value.title=E),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(d,{label:"负责人"},{default:l(()=>[t(b,{modelValue:h.value.username,"onUpdate:modelValue":m[1]||(m[1]=E=>h.value.username=E),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(d,null,{default:l(()=>[t(U,{theme:"primary",onClick:i},{default:l(()=>m[6]||(m[6]=[x("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(z,{class:"sh-card"},{default:l(()=>[t(w,null,{default:l(()=>[t(U,{onClick:V},{default:l(()=>m[7]||(m[7]=[x("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),t(G,{visible:c.value,"onUpdate:visible":m[5]||(m[5]=E=>c.value=E),header:"创建比赛",onConfirm:j,"confirm-loading":_.value},{default:l(()=>[t(L,{"label-width":80,model:k.value,onSubmit:m[4]||(m[4]=Ge(()=>{},["prevent"]))},{default:l(()=>[t(d,{label:"标题"},{default:l(()=>[t(b,{modelValue:k.value.title,"onUpdate:modelValue":m[2]||(m[2]=E=>k.value.title=E),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),t(d,{label:"开启时间"},{default:l(()=>[t($,{"enable-time-picker":"","allow-input":"",clearable:"",modelValue:k.value.open_time,"onUpdate:modelValue":m[3]||(m[3]=E=>k.value.open_time=E)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),jt=ne(no,[["__scopeId","data-v-3e6ea683"]]),oo={style:{margin:"20px"}},so={style:{margin:"12px"}},ro=["innerHTML"],uo=ae({__name:"ContestDetail",setup(e){let a=de();const{globalProperties:n}=re(),s=Ue();let o=0;const c=f(!1),_=f(null),I=f([{title:"问题ID",colKey:"id",cell:(v,r)=>t(O,{variant:"text",onClick:()=>y(o,r.row.index)},{default:()=>[r.row.id]})},{title:"标题",colKey:"title",cell:(v,r)=>t(O,{variant:"text",onClick:()=>y(o,r.row.index)},{default:()=>[r.row.title]})},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),S=f([]),y=(v,r)=>{W.push({name:"contest-problem-detail",params:{contestId:v,problemIndex:r}})};return le(async()=>{if(Array.isArray(a.params.contestId)?o=Number(a.params.contestId[0]):o=Number(a.params.contestId),!o){await W.push({name:"contest"});return}c.value=!0;const v=await dn(o);if(v.code!==0){c.value=!1,H(n,v.code),await W.push({name:"contest"});return}_.value=await aa(v.data),S.value=_.value.problems,s.setTitle(_.value.title+" - "+s.getTitle),await xe(()=>{const r=document.querySelectorAll(".dida-content-description");r&&r.length>0&&r.forEach(u=>{ue.mathRender(u),ue.highlightRender({lineNumber:!0,enable:!0},u),Me(u)}),c.value=!1})}),(v,r)=>{const u=ot,h=Se,k=se,p=be,i=Ee,P=Re,K=O,V=_e,j=Ft,g=Gt,m=ve,R=ke;return D(),F(R,{loading:c.value},{default:l(()=>{var z,T,b;return[A("div",oo,[A("h1",null,q((z=_.value)==null?void 0:z.title),1),(T=_.value)!=null&&T.notification?(D(),F(u,{key:0,theme:"info",message:(b=_.value)==null?void 0:b.notification},null,8,["message"])):oe("",!0)]),t(m,{class:"dida-main-content"},{default:l(()=>[t(p,{span:6},{default:l(()=>[t(k,{style:{margin:"10px"}},{default:l(()=>[t(h,{data:S.value,columns:I.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1})]),_:1}),t(p,{span:6},{default:l(()=>[A("div",so,[t(P,{layout:"vertical",bordered:!0},{default:l(()=>[t(i,{label:"开始时间"},{default:l(()=>{var d;return[x(q((d=_.value)==null?void 0:d.startTime),1)]}),_:1})]),_:1}),t(P,{layout:"vertical",bordered:!0},{default:l(()=>[t(i,{label:"结束时间"},{default:l(()=>{var d;return[x(q((d=_.value)==null?void 0:d.endTime),1)]}),_:1})]),_:1})]),t(g,{"default-value":[0],"expand-icon":!1,borderless:!0},{default:l(()=>{var d;return[(D(!0),Y(te,null,ge((d=_.value)==null?void 0:d.descriptions,(U,L)=>(D(),F(j,{key:L,header:U.title},mt({default:l(()=>[A("div",{innerHTML:U.content,class:"dida-content-description"},null,8,ro)]),_:2},[L===0?{name:"headerRightContent",fn:l(()=>[t(V,{size:"small"},{default:l(()=>[t(K,{size:"small"},{default:l(()=>r[0]||(r[0]=[x("收起全部")])),_:1}),t(K,{size:"small"},{default:l(()=>r[1]||(r[1]=[x("展开全部")])),_:1})]),_:1})]),key:"0"}:void 0]),1032,["header"]))),128))]}),_:1})]),_:1})]),_:1})]}),_:1},8,["loading"])}}}),io=ne(uo,[["__scopeId","data-v-fd97176d"]]);function Vt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!qe(e)}const co=ae({__name:"ContestRank",setup(e){const a=de(),n=ze(),{globalProperties:s}=re();let o=null,c=0;const _=f(null),I=f(null);let S=null;const y=i=>{if(i==null)return"-";const P=Math.floor(i/3600).toString().padStart(2,"0"),K=Math.floor(i%3600/60).toString().padStart(2,"0"),V=(i%60).toString().padStart(2,"0");return`${P}:${K}:${V}`},v=[{title:"Rank",colKey:"rank",align:"center",fixed:"left",cell:(i,P)=>t(O,{variant:"text",onClick:()=>n.push({name:"contest-user-rank",params:{contestId:c,userId:P.row.user_id}})},{default:()=>[P.row.rank]})},{title:"昵称",colKey:"nickname",fixed:"left",cell:(i,P)=>{const K=gl(P.row.nickname,18);return t(Va,{content:P.row.nickname},{default:()=>[t(O,{variant:"text",onClick:()=>n.push({name:"user",params:{username:P.row.username}})},Vt(K)?K:{default:()=>[K]})]})}},{title:"Solved",colKey:"solved",align:"center",fixed:"left",cell:(i,P)=>t(O,{variant:"text",onClick:()=>n.push({name:"contest-judge",params:{contestId:c},query:{username:P.row.username,status:Ie.Accept}})},{default:()=>[P.row.solved]})},{title:"Penalty",colKey:"penalty",align:"center",fixed:"left",cell:(i,P)=>y(P.row.penalty)}],r=f([]),u=f(!1),h=f(),k=async i=>{u.value=!0;try{const P=await pn(c);if(r.value=v,h.value=[],P.code===0){P.data.problems.sort((g,m)=>g-m),P.data.problems.forEach((g,m)=>{r.value.push({title:Ke(g),colKey:`problem_${g}`,align:"center",title:(R,{colIndex:z})=>{let T;return t(O,{variant:"text",onClick:()=>n.push({name:"contest-problem-detail",params:{contestId:c,problemIndex:g}})},Vt(T=Ke(g))?T:{default:()=>[T]})},cell:(R,z)=>{const T=z.row[`problem_${g}`];if(!T)return"";let b="";return T.acDuration>=0&&(b=y(T.acDuration)),T.attempt>0&&(b&&(b+=" "),b+=`(-${T.attempt})`),t("span",null,[b])},attrs:R=>{const z=R.row[`problem_${g}`];return z?z.acDuration>=0?{style:{backgroundColor:"rgba(130,255,30,0.5)"}}:{style:{backgroundColor:"rgba(255,120,120,0.5)"}}:{}}})});const K=new Date(P.data.start_time),V=P.data.ranks,j=[];for(let g=0;g<V.length;g++){const m=V[g];let R={username:m.author_username,nickname:m.author_nickname},z=0,T=0;m.problems.forEach((b,d)=>{let U=-1;b.ac&&(z++,U=(new Date(b.ac).getTime()-K.getTime())/1e3,T+=U,T+=b.attempt*20*60);const L=b.index;R[`problem_${L}`]={acDuration:U,attempt:b.attempt}}),R.solved=z,R.penalty=T,j.push(R)}j.sort((g,m)=>g.solved!==m.solved?m.solved-g.solved:g.penalty-m.penalty);for(let g=0;g<j.length;g++)j[g].rank=g+1;h.value=j}else i&&H(s,P.code)}catch(P){console.error(P),H(s,Te())}finally{u.value=!1}};function p(){if(I.value){const i=I.value.parentElement.clientWidth;console.log("Parent width:",i),I.value.style.width=i+"px"}}return le(async()=>{o=Le(()=>a.query,async i=>{if(Array.isArray(a.params.contestId)?c=Number(a.params.contestId[0]):c=Number(a.params.contestId),!c){await n.push({name:"contest"});return}await k(!0),p(),S=new ResizeObserver(p),_.value&&S.observe(_.value)},{immediate:!0})}),Ce(()=>{o&&o(),S&&_.value&&S.unobserve(_.value)}),(i,P)=>{const K=Se,V=se,j=ve;return D(),F(j,null,{default:l(()=>[t(V,{style:{margin:"10px",width:"100%"}},{default:l(()=>[A("div",{ref_key:"scrollWrapper",ref:_},[A("div",{ref_key:"tableWrapper",ref:I,style:{width:"0"}},[t(K,{data:h.value,columns:r.value,"row-key":"id","vertical-align":"top",hover:!0,"table-layout":"auto",loading:u.value},null,8,["data","columns","loading"])],512)],512)]),_:1})]),_:1})}}});function la(e){const a={};return a.id=e.id,a.authorId=e.author_id,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.title=e.title,a.content=e.content,e.insert_time&&(a.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(a.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(a.updateTime=new Date(e.update_time).toLocaleString()),a.problemId=e.problem_id,a.problemTitle=e.problem_title,a.contestId=e.contest_id,a.contestTitle=e.contest_title,a.contestProblemIndex=e.contest_problem_index,a}async function mo(e){const a={};if(a.id=e.id,a.authorId=e.author_id,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.content="",e.content){const n={math:{inlineDigit:!0,engine:"KaTeX"}};a.content=await ue.md2html(e.content,n)}return e.insert_time&&(a.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(a.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(a.updateTime=new Date(e.update_time).toLocaleString()),a}function po(e){return J({url:"/discuss?id="+e,method:"get"})}function fo(e,a,n,s,o,c){const _={};return e&&(_.contest_id=e),a&&(_.problem_id=a),n&&(_.title=n),s&&(_.username=s),o&&(_.page=o),c&&(_.page_size=c),J({url:`/discuss/list?${new URLSearchParams(_).toString()}`,method:"get"})}function _o(e,a,n){return J({url:"/discuss/comment/list?id="+e+"&page="+a+"&page_size="+n,method:"get"})}function vo(e){return J({url:"/discuss/create",method:"post",data:e})}const na=async(e,a)=>{a&&await e.push({name:"user",params:{username:a}})},go={style:{margin:"10px"}};function bo(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!qe(e)}const ho=ae({__name:"DiscussList",setup(e){const a=de(),n=ze(),{globalProperties:s}=re();let o=null;const c=f(!1),_=f(!1);let I=-1;const S=f([]),y=[],v=[{title:"标题",colKey:"title",cell:(b,d)=>t(O,{variant:"text",onClick:()=>j(d.row.id)},{default:()=>[d.row.title]})},{title:"创建人",colKey:"authorNickname",width:"200",cell:(b,d)=>t(O,{variant:"text",onClick:async()=>await na(n,d.row.authorUsername)},{default:()=>[d.row.authorNickname]})},{title:"创建时间",colKey:"insertTime",width:"180"},{title:"更新时间",colKey:"updateTime",width:"180"}],r=f(!1);let u=1,h=50;const k=f({current:u,pageSize:h,defaultCurrent:u,defaultPageSize:h,total:0,pageSizeOptions:[50,100]}),p=f(),i=f({problemId:"",title:"",username:""}),P=f({title:"",content:""}),K=b=>{b&&n.push({name:"problem-detail",params:{problemId:b}})},V=(b,d)=>{n.push({name:"contest-problem-detail",params:{contestId:b,problemIndex:d}})},j=b=>{if(b){if(I){n.push({name:"contest-discuss-detail",params:{contestId:I,discussId:b}});return}n.push({name:"discuss-detail",params:{discussId:b}})}},g=async()=>{await n.push({query:{...a.query,problem_id:i.value.problemId,title:i.value.title,username:i.value.username,page:1,page_size:k.value.defaultPageSize}})},m=async(b,d)=>{var U;r.value=!0;try{const{current:L,pageSize:w}=b,C=await fo(I,i.value.problemId,i.value.title,i.value.username,L,w);if(p.value=[],C.code===0){if(C.data.list){const $=C.data.list;for(let G=0;G<$.length;G++){const E=$[G],X=await la(E);(U=p.value)==null||U.push(X)}}k.value={...k.value,total:C.data.total_count}}else d&&H(s,C.code)}catch(L){console.error(L),H(s,Te())}finally{r.value=!1}},R=async b=>{await n.push({query:{...a.query,page:b.current,page_size:b.pageSize}})},z=()=>{c.value=!0},T=async()=>{_.value=!0,console.log("discussCreateForm",P.value),vo(P.value).then(b=>{b.code===0?(pe(s,"创建比赛成功"),c.value=!1,n.push({path:"/discuss/"+b.data.id})):H(s,b.code)}).finally(()=>{_.value=!1})};return le(async()=>{o=Le(()=>a.query,b=>{Array.isArray(a.params.contestId)?I=Number(a.params.contestId[0]):I=Number(a.params.contestId),S.value=y,I?S.value=S.value.concat([{title:"问题ID",colKey:"contestProblemIndex",width:"100",cell:(L,w)=>{let C;return w.row.contestProblemIndex?t(O,{variant:"text",onClick:()=>V(I,w.row.contestProblemIndex)},bo(C=Ke(w.row.contestProblemIndex))?C:{default:()=>[C]}):""}}]):S.value=S.value.concat([{title:"问题ID",colKey:"problemId",width:"100",cell:(L,w)=>w.row.problemId?t(O,{variant:"text",onClick:()=>K(w.row.problemId)},{default:()=>[w.row.problemId]}):""}]),S.value=S.value.concat(v),i.value.problemId=b.problem_id||"",i.value.title=b.title||"",i.value.username=b.username||"";const d=parseInt(b.page)||k.value.defaultCurrent,U=parseInt(b.page_size)||k.value.defaultPageSize;u=d,h=U,k.value={...k.value,current:u,pageSize:h},m({current:u,pageSize:h},!0)},{immediate:!0})}),Ce(()=>{o&&o()}),(b,d)=>{const U=Se,L=se,w=be,C=De,$=Ve,G=O,E=je,X=_e,B=ve,ee=Fe;return D(),Y(te,null,[t(B,null,{default:l(()=>[t(w,{span:9},{default:l(()=>[t(L,{style:{margin:"10px"}},{default:l(()=>[t(U,{data:p.value,columns:S.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:k.value,loading:r.value,"table-layout":"auto",onPageChange:R},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(w,{span:3},{default:l(()=>[A("div",go,[t(L,{class:"sh-card"},{default:l(()=>[t(E,{model:i.value},{default:l(()=>[t($,{label:"问题ID"},{default:l(()=>[t(C,{modelValue:i.value.problemId,"onUpdate:modelValue":d[0]||(d[0]=N=>i.value.problemId=N),placeholder:"请输入完整问题ID"},null,8,["modelValue"])]),_:1}),t($,{label:"标题"},{default:l(()=>[t(C,{modelValue:i.value.title,"onUpdate:modelValue":d[1]||(d[1]=N=>i.value.title=N),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t($,{label:"创建人"},{default:l(()=>[t(C,{modelValue:i.value.username,"onUpdate:modelValue":d[2]||(d[2]=N=>i.value.username=N),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t($,null,{default:l(()=>[t(G,{theme:"primary",onClick:g},{default:l(()=>d[6]||(d[6]=[x("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(L,{class:"sh-card"},{default:l(()=>[t(X,null,{default:l(()=>[t(G,{onClick:z},{default:l(()=>d[7]||(d[7]=[x("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),t(ee,{visible:c.value,"onUpdate:visible":d[5]||(d[5]=N=>c.value=N),header:"创建讨论",onConfirm:T,"confirm-loading":_.value},{default:l(()=>[t(E,{"label-width":80,model:P.value,onSubmit:d[4]||(d[4]=Ge(()=>{},["prevent"]))},{default:l(()=>[t($,{label:"标题"},{default:l(()=>[t(C,{modelValue:P.value.title,"onUpdate:modelValue":d[3]||(d[3]=N=>P.value.title=N),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),et=ne(ho,[["__scopeId","data-v-428fc50f"]]),yo={key:0,style:{margin:"20px"}},wo=["innerHTML"],ko=["innerHTML"],Co={style:{margin:"10px"}},So={style:{margin:"10px"}},Io={style:{margin:"10px","text-align":"right"}},Po={style:{margin:"12px"}},To={key:0,class:"dida-edit-container"},xo=ae({__name:"DiscussDetail",props:{discussId:{}},setup(e){const a=e;let n=de();const{globalProperties:s}=re();let o=null;const c=Ue(),_=Pe();let I=f("");const S=f(""),y=f(null),v=f(!1),r=f(null),u=f(!1);let h=1,k=20;const p=f({current:1,total:0,defaultPageSize:k,defaultCurrent:h,pageSizeOptions:[20,50]}),i=f([]),P={},K=Ae(()=>_.hasAuth($e.ManageDiscuss)),V=T=>{T&&W.push({name:"discuss-list",query:{...n.query,title:"",tag:T.name}})},j=()=>{W.push({name:"manage-discuss",params:{discussId:S.value}})},g=()=>t("div",{class:"t-pagination__total"},[`共 ${p.value.total} 条回复`]),m=()=>{},R=async(T,b)=>{var d;u.value=!0;try{const{current:U,pageSize:L}=T,w=await _o(S.value,U,L);if(i.value=[],w.code===0){const C=w.data.list;if(C)for(let $=0;$<C.length;$++){const G=C[$],E=await mo(G);(d=i.value)==null||d.push(E),await xe(()=>{const X=document.querySelectorAll(".dida-discuss-content");X&&X.length>0&&X.forEach(B=>{ue.mathRender(B),ue.highlightRender({lineNumber:!0,enable:!0},B),Me(B)})})}p.value={...p.value,total:w.data.total_count}}else b&&H(s,w.code)}catch(U){console.error(U),H(s,Te())}finally{u.value=!1}},z=async T=>{await W.push({query:{...n.query,page:T.current,page_size:T.pageSize}})};return le(async()=>{if(S.value=a.discussId,S.value||(Array.isArray(n.params.discussId)?S.value=n.params.discussId[0]:S.value=n.params.discussId),!S.value){ce(s,"讨论不存在"),await W.push({name:"discuss"});return}v.value=!0;const T=await po(S.value);if(T.code!==0){v.value=!1,H(s,T.code),await W.push({name:"discuss"});return}T.data.tags&&T.data.tags.forEach(L=>{P[L.id]=L}),r.value=la(T.data.discuss),c.setTitle(r.value.title+" - "+c.getTitle);let b=r.value.content;const d={math:{inlineDigit:!0,engine:"KaTeX"}};I.value=await ue.md2html(b,d),await xe(()=>{y.value&&(ue.mathRender(y.value),ue.highlightRender({lineNumber:!0,enable:!0},y.value),Me(y.value)),v.value=!1}),o=Le(()=>n.query,L=>{const w=parseInt(L.page)||p.value.defaultCurrent,C=parseInt(L.page_size)||p.value.defaultPageSize;h=w,k=C,p.value={...p.value,current:h,pageSize:k},R({current:h,pageSize:k},!0)},{immediate:!0});const U={after:()=>{}};new ue("commentEditRef",U)}),Ce(()=>{o&&o()}),(T,b)=>{const d=$a,U=Da,L=se,w=_e,C=za,$=O,G=be,E=Ee,X=Re,B=ve,ee=ke;return D(),F(ee,{loading:v.value},{default:l(()=>[t(B,{class:"dida-main-content"},{default:l(()=>[t(G,{span:8},{default:l(()=>{var N,me,ye;return[(N=r.value)!=null&&N.problemTitle||(me=r.value)!=null&&me.contestTitle?(D(),Y("div",yo,[t(U,{"max-item-width":"300"},{default:l(()=>{var ie,Q,Z,M,he;return[(ie=r.value)!=null&&ie.contestTitle?(D(),Y(te,{key:0},[t(d,{to:{name:"contest-detail",params:{contestId:(Q=r.value)==null?void 0:Q.contestId}}},{default:l(()=>{var we;return[x(q((we=r.value)==null?void 0:we.contestTitle),1)]}),_:1},8,["to"]),(Z=r.value)!=null&&Z.contestProblemIndex?(D(),F(d,{key:0,to:{name:"contest-problem-detail",params:{problemIndex:(M=r.value)==null?void 0:M.contestProblemIndex}}},{default:l(()=>{var we,He;return[x(q(fe(Ke)((we=r.value)==null?void 0:we.contestProblemIndex))+" - "+q((He=r.value)==null?void 0:He.problemTitle),1)]}),_:1},8,["to"])):oe("",!0)],64)):(D(),Y(te,{key:1},[t(d,{to:{name:"discuss-list-problem"}},{default:l(()=>b[3]||(b[3]=[x(" 问题讨论")])),_:1}),t(d,{to:{name:"problem-detail",params:{problemId:(he=r.value)==null?void 0:he.problemId}}},{default:l(()=>{var we;return[x(q((we=r.value)==null?void 0:we.problemTitle),1)]}),_:1},8,["to"])],64))]}),_:1})])):oe("",!0),t(L,{style:{margin:"10px"},header:(ye=r.value)==null?void 0:ye.title,"header-bordered":!0},{default:l(()=>[A("div",{innerHTML:fe(I),class:"dida-discuss-content"},null,8,wo)]),_:1},8,["header"]),(D(!0),Y(te,null,ge(i.value,(ie,Q)=>(D(),F(L,{key:Q,style:{margin:"10px"},"header-bordered":""},{header:l(()=>[t(w,null,{default:l(()=>[A("span",null,q(ie.authorNickname),1),A("span",null,q(ie.insertTime),1)]),_:2},1024)]),default:l(()=>[A("div",{innerHTML:ie.content,class:"dida-discuss-content"},null,8,ko)]),_:2},1024))),128)),A("div",Co,[t(C,{modelValue:p.value.current,"onUpdate:modelValue":b[0]||(b[0]=ie=>p.value.current=ie),"page-size":p.value.pageSize,"onUpdate:pageSize":b[1]||(b[1]=ie=>p.value.pageSize=ie),total:p.value.total,"page-size-options":p.value.pageSizeOptions,"show-page-size":!1,"total-content":g,onChange:z},null,8,["modelValue","page-size","total","page-size-options"])]),A("div",So,[b[5]||(b[5]=A("div",{id:"commentEditRef",class:"dida-comment-editor"},null,-1)),A("div",Io,[t(w,null,{default:l(()=>[t($,{theme:"primary",onClick:m},{default:l(()=>b[4]||(b[4]=[x("提交")])),_:1})]),_:1})])])]}),_:1}),t(G,{span:4},{default:l(()=>[A("div",Po,[K.value?(D(),Y("div",To,[t($,{onClick:j},{default:l(()=>b[6]||(b[6]=[x("编辑")])),_:1})])):oe("",!0),t(X,{layout:"vertical",bordered:!0},{default:l(()=>[t(E,{label:"创建时间"},{default:l(()=>{var N;return[x(q((N=r.value)==null?void 0:N.insertTime),1)]}),_:1}),t(E,{label:"编辑时间"},{default:l(()=>{var N;return[x(q((N=r.value)==null?void 0:N.modifyTime),1)]}),_:1}),t(E,{label:"更新时间"},{default:l(()=>{var N;return[x(q((N=r.value)==null?void 0:N.updateTime),1)]}),_:1}),t(E,{label:"创建用户"},{default:l(()=>[t($,{variant:"text",onClick:b[2]||(b[2]=async()=>{var N;return await fe(na)(fe(W),(N=r.value)==null?void 0:N.authorUsername)})},{default:l(()=>{var N;return[x(q((N=r.value)==null?void 0:N.authorNickname),1)]}),_:1})]),_:1}),t(E,{label:"标签"},{default:l(()=>[t(w,null,{default:l(()=>{var N;return[(D(!0),Y(te,null,ge((N=r.value)==null?void 0:N.tags,me=>(D(),F($,{key:me.id,variant:"dashed",onClick:()=>V(me)},{default:l(()=>[x(q(me.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),ut=ne(xo,[["__scopeId","data-v-03948cc8"]]);function Lo(e,a){return J({url:"/rank/ac/all?page="+e+"&page_size="+a,method:"get"})}function jo(e,a){return J({url:"/rank/ac/problem?page="+e+"&page_size="+a,method:"get"})}function Vo(e,a){return J({url:"/rank/ac/problem/today?page="+e+"&page_size="+a,method:"get"})}function Do(e,a){return J({url:"/rank/ac/problem/day7?page="+e+"&page_size="+a,method:"get"})}function $o(e,a){return J({url:"/rank/ac/problem/year?page="+e+"&page_size="+a,method:"get"})}const zo={style:{margin:"10px"}};function it(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!qe(e)}const Uo=ae({__name:"RankUser",props:{type:{}},setup(e){const a=de(),n=ze(),{globalProperties:s}=re();let o=null;const c=e,_=f(""),I=f(""),S={all:{header:"统计所有用户在本站的提交记录",content:"优先以AC记录数量排序，如果相同则提交所用次数较少的优先，如果仍相同，注册较早的用户靠前"},problem:{header:"统计所有用户在本站的提交记录",content:"以题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-today":{header:"统计所有用户今日在本站的提交记录",content:"以今日题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-day7":{header:"统计所有用户最近7日在本站的提交记录",content:"以7日题目记录数量排序（从7日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-year":{header:"统计所有用户最近1年在本站的提交记录",content:"以最近1年题目记录数量排序（从365日前的0点开始计算），如果相同，注册较早的用户靠前"}},y=f([]),v=[{title:"序号",colKey:"index"},{title:"用户名",colKey:"username",cell:(R,z)=>t(O,{variant:"dashed",onClick:()=>K(z.row.username)},{default:()=>[z.row.username]})},{title:"昵称",colKey:"nickname"},{title:"Slogan",colKey:"slogan"}],r=[{title:"题目数量",colKey:"problem_count",cell:(R,z)=>{let T=0;return z.row.problem_count&&(T=z.row.problem_count),t(O,{variant:"dashed",onClick:()=>V(z.row.username)},it(T)?T:{default:()=>[T]})}}],u=[{title:"正确",colKey:"accept",cell:(R,z)=>{let T=0;return z.row.accept&&(T=z.row.accept),t(O,{variant:"dashed",onClick:()=>V(z.row.username)},it(T)?T:{default:()=>[T]})}},{title:"提交",colKey:"attempt",cell:(R,z)=>{let T=0;return z.row.attempt&&(T=z.row.attempt),t(O,{variant:"dashed",onClick:()=>j(z.row.username)},it(T)?T:{default:()=>[T]})}}],h=f(!1);let k=1,p=50;const i=f({current:k,pageSize:p,defaultCurrent:k,defaultPageSize:p,total:0,pageSizeOptions:[50]}),P=f(),K=R=>{n.push({name:"user",params:{username:R}})},V=R=>{n.push({name:"judge-list",query:{username:R,status:Ie.Accept}})},j=R=>{n.push({name:"judge-list",query:{username:R}})},g=async(R,z)=>{h.value=!0;try{P.value=[];const{current:T,pageSize:b}=R;let d=null;switch(c.type){case"problem":d=await jo(T,b);break;case"problem-today":d=await Vo(T,b);break;case"problem-day7":d=await Do(T,b);break;case"problem-year":d=await $o(T,b);break;default:d=await Lo(T,b);break}if(d.code===0){const U=d.data.list;if(!U||U.length<=0){i.value={...i.value,total:0},pe(s,"未找到记录");return}P.value=[];const L=i.value.pageSize*(i.value.current-1);let w=1;U.forEach(C=>{var G;const $=C;$.index=L+w++,(G=P.value)==null||G.push($)}),i.value={...i.value,total:d.data.total_count}}else z&&H(s,d.code)}catch(T){console.error(T),H(s,Te())}finally{h.value=!1}},m=async R=>{await n.push({query:{...a.query,page:R.current,page_size:R.pageSize}})};return le(async()=>{h.value=!0,o=Le(()=>a.query,R=>{switch(c.type&&S[c.type]?(_.value=S[c.type].header,I.value=S[c.type].content):(_.value=S.all.header,I.value=S.all.content),c.type){case"all":y.value=v.concat(u);break;default:y.value=v.concat(r);break}const z=parseInt(R.page)||i.value.defaultCurrent,T=parseInt(R.page_size)||i.value.defaultPageSize;k=z,p=T,i.value={...i.value,current:k,pageSize:p},g({current:k,pageSize:p},!0)},{immediate:!0})}),Ce(()=>{o&&o()}),(R,z)=>{const T=Se,b=se,d=be,U=ve;return D(),F(U,null,{default:l(()=>[t(d,{span:9},{default:l(()=>[t(b,{style:{margin:"10px"}},{default:l(()=>[t(T,{data:P.value,columns:y.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:i.value,loading:h.value,"table-layout":"auto",onPageChange:m},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(d,{span:3},{default:l(()=>[A("div",zo,[t(b,{class:"sh-card",header:_.value,"header-bordered":!0},{default:l(()=>[x(q(I.value),1)]),_:1},8,["header"])])]),_:1})]),_:1})}}}),Be=ne(Uo,[["__scopeId","data-v-9bbfd60b"]]),Ao=ae({__name:"ManageJudge",setup(e){const{globalProperties:a}=re(),n=f(!1),s=f(!1),o=f({problemId:"",language:void 0,status:void 0}),c=f(!1),_=f([]);_.value=yt();const I=f([]);I.value=Yt();const S=async()=>{n.value=!0;try{const r=await Bl();if(r.code!==0){H(a,r.code);return}pe(a,"重判成功"),await W.push({name:"judge-list"})}catch(r){console.error(r),H(a,"重判失败")}finally{n.value=!1}},y=async()=>{if(!o.value.problemId&&!o.value.language&&!o.value.status){H(a,"请输入问题Id");return}c.value=!0;try{const r=await Wl(o.value.problemId,o.value.language,o.value.status);if(r.code!==0){H(a,r.code);return}pe(a,"重判成功"),await W.push({name:"judge-list",query:{problem_id:o.value.problemId,language:o.value.language}})}catch(r){console.error(r),H(a,"重判失败")}finally{c.value=!1}},v=async()=>{s.value=!0;try{const r=await Jl();if(r.code!==0){H(a,r.code);return}pe(a,"重判成功"),await W.push({name:"judge-list"})}catch(r){console.error(r),H(a,"重判失败")}finally{s.value=!1}};return(r,u)=>{const h=O,k=se,p=De,i=Ve,P=vt,K=st,V=_e,j=je;return D(),Y(te,null,[t(k,{class:"yj-manage-card",title:"重判最近提交"},{default:l(()=>[t(h,{onClick:S,loading:n.value},{default:l(()=>u[3]||(u[3]=[x("重判")])),_:1},8,["loading"])]),_:1}),t(k,{class:"yj-manage-card",title:"重判指定记录"},{default:l(()=>[t(j,{layout:"inline",onSubmit:y},{default:l(()=>[t(i,{label:"题号"},{default:l(()=>[t(p,{modelValue:o.value.problemId,"onUpdate:modelValue":u[0]||(u[0]=g=>o.value.problemId=g),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(i,{label:"语言"},{default:l(()=>[t(K,{modelValue:o.value.language,"onUpdate:modelValue":u[1]||(u[1]=g=>o.value.language=g),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:l(()=>[(D(!0),Y(te,null,ge(_.value,g=>(D(),F(P,{key:g.value,value:g.value,label:g.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"状态"},{default:l(()=>[t(K,{modelValue:o.value.status,"onUpdate:modelValue":u[2]||(u[2]=g=>o.value.status=g),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:l(()=>[(D(!0),Y(te,null,ge(I.value,g=>(D(),F(P,{key:g.value,value:g.value,label:g.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(i,null,{default:l(()=>[t(V,null,{default:l(()=>[t(h,{theme:"primary",type:"submit",loading:c.value},{default:l(()=>u[4]||(u[4]=[x("重判")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(k,{class:"yj-manage-card",title:"重判所有"},{default:l(()=>[t(h,{onClick:v,theme:"danger",loading:s.value},{default:l(()=>u[5]||(u[5]=[x("重判")])),_:1},8,["loading"])]),_:1})],64)}}}),Ro=ne(Ao,[["__scopeId","data-v-6a706c72"]]),Eo={style:{margin:"10px"}},Ko={key:1},qo={style:{margin:"12px"}},Mo={class:"dida-edit-container"},Fo=ae({__name:"ProblemEdit",setup(e){let a=de();const{globalProperties:n}=re(),s=Ue(),o=f(""),c=f(!1);let _=null;const I=f(!1),S=f(null),y=f({title:"",timeLimit:0,memoryLimit:0,source:"",private:!0,tags:[]}),v=f([]),r=f([]),u=Ae(()=>{const g=[],m=v.value;for(let R=0,z=m.length;R<z;R++)m[R].value&&g.push(m[R].value);return g}),h=(g,m)=>{const{trigger:R,index:z,item:T}=m;if(R==="clear"&&(v.value=[]),["tag-remove","backspace"].includes(R)&&v.value.splice(z,1),R==="enter"){for(let d=0;d<r.value.length;d++){const U=r.value[d];if(U.label===T){for(let L=0;L<v.value.length;L++)if(v.value[L].label===U.label)return;v.value.push(U);return}}const b={label:T,value:T};v.value.push(b),r.value=r.value.concat(b)}},k=(g,{current:m,type:R})=>{if(!m){v.value=R==="check"?r.value.slice(1):[];return}if(R==="check"){const z=r.value.find(T=>T.value===m);if(!z)return;v.value.push(z)}else v.value=v.value.filter(z=>z.value!==m)},p=()=>{W.push({name:"problem-detail",params:{problemId:o.value}})},i=()=>{W.push({name:"manage-problem-judge",params:{problemId:o.value}})},P=async()=>{if(_){I.value=!0,y.value.tags=[];for(let g=0;g<v.value.length;g++){const m=v.value[g];m&&m.label&&y.value.tags.push(m.label)}try{const g=await en(y.value.title,y.value.timeLimit,y.value.memoryLimit,y.value.source,y.value.private,y.value.tags,_.getValue());if(I.value=!0,g.code!==0){H(n,g.code);return}g.data!=null&&await W.push({name:"problem-detail",params:{problemId:g.data}}),We(n,"创建成功")}finally{I.value=!1}}},K=async()=>{if(_){I.value=!0,y.value.tags=[];for(let g=0;g<v.value.length;g++){const m=v.value[g];m&&m.label&&y.value.tags.push(m.label)}try{const g=await tn(o.value,y.value.title,y.value.timeLimit,y.value.memoryLimit,y.value.source,y.value.private,y.value.tags,_.getValue());if(I.value=!0,g.code!==0){H(n,g.code);return}g.data!=null&&(S.value.updateTime=new Date(g.data).toLocaleString()),We(n,"保存成功")}finally{I.value=!1}}},V=g=>{const m={after:()=>{_==null||_.setValue(g),c.value=!1}};_=new ue("problemEditDiv",m)},j=async()=>{const g=await Qt(o.value,void 0,void 0);if(g.code!==0){H(n,g.code),console.error("problem get failed",g.code),await W.push({name:"problem"});return}const m=g.data.problem;if(S.value=Ye(m,{}),y.value.title=m.title,y.value.timeLimit=m.time_limit,y.value.memoryLimit=m.memory_limit,y.value.source=m.source,y.value.private=m.private,y.value.tags=[],v.value=[],g.data.tags)for(let z=0;z<g.data.tags.length;z++){const T=g.data.tags[z];T&&T.name&&(y.value.tags.push(T.name),v.value.push({label:T.name,value:T.id}))}s.setTitle(m.title+" - "+s.getTitle);let R=m.description;V(R)};return le(async()=>{Array.isArray(a.params.problemId)?o.value=a.params.problemId[0]:o.value=a.params.problemId,o.value?(c.value=!0,ea(-1).then(async g=>{g.code===0?(g.data.list&&g.data.list.forEach(m=>{r.value.push({label:m.name,value:m.id})}),await j()):(H(n,g.code),console.error("problem tag get failed",g.code),await W.push({name:"problem"}))}).catch(async g=>{console.error(g),H(n,"获取数据异常"),await W.push({name:"problem"})})):(y.value.timeLimit=1e3,y.value.memoryLimit=65536,V(""))}),(g,m)=>{const R=De,z=Ve,T=Ua,b=qt,d=Ra,U=Aa,L=je,w=se,C=be,$=O,G=_e,E=Ee,X=Re,B=ve,ee=ke;return D(),F(ee,{loading:c.value},{default:l(()=>[t(B,null,{default:l(()=>[t(C,{span:8},{default:l(()=>[A("div",Eo,[t(w,{class:"sh-card"},{default:l(()=>[t(L,{model:y.value},{default:l(()=>[t(z,{label:"标题"},{default:l(()=>[t(R,{modelValue:y.value.title,"onUpdate:modelValue":m[0]||(m[0]=N=>y.value.title=N),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),t(z,{label:"时间限制"},{default:l(()=>[t(T,{modelValue:y.value.timeLimit,"onUpdate:modelValue":m[1]||(m[1]=N=>y.value.timeLimit=N),theme:"normal",min:0},{suffix:l(()=>m[5]||(m[5]=[A("span",null,"ms",-1)])),_:1},8,["modelValue"])]),_:1}),t(z,{label:"内存限制"},{default:l(()=>[t(T,{modelValue:y.value.memoryLimit,"onUpdate:modelValue":m[2]||(m[2]=N=>y.value.memoryLimit=N),theme:"normal",min:0},{suffix:l(()=>m[6]||(m[6]=[A("span",null,"KB",-1)])),_:1},8,["modelValue"])]),_:1}),t(z,{label:"来源"},{default:l(()=>[t(R,{modelValue:y.value.source,"onUpdate:modelValue":m[3]||(m[3]=N=>y.value.source=N),placeholder:"请输入题目来源"},null,8,["modelValue"])]),_:1}),t(z,{label:"私有"},{default:l(()=>[t(b,{modelValue:y.value.private,"onUpdate:modelValue":m[4]||(m[4]=N=>y.value.private=N)},null,8,["modelValue"])]),_:1}),t(z,{label:"标签"},{default:l(()=>[t(U,{value:v.value,"allow-input":!0,placeholder:"请选择或输入","tag-input-props":{excessTagsDisplayType:"break-line"},"popup-props":{overlayInnerClassName:["narrow-scrollbar"],overlayInnerStyle:{maxHeight:"280px",overflowY:"auto",overscrollBehavior:"contain",padding:"6px"}},clearable:"",multiple:"",onTagChange:h},{panel:l(()=>[r.value.length?(D(),F(d,{key:0,value:u.value,options:r.value,onChange:k},null,8,["value","options"])):(D(),Y("div",Ko,"暂无数据"))]),suffixIcon:l(()=>[t(fe(fa))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(C,{span:4},{default:l(()=>[A("div",qo,[A("div",Mo,[o.value?(D(),F(G,{key:0},{default:l(()=>[t($,{onClick:K,theme:"danger",loading:I.value},{default:l(()=>m[7]||(m[7]=[x("保存")])),_:1},8,["loading"]),t($,{onClick:i,theme:"warning"},{default:l(()=>m[8]||(m[8]=[x("判题数据")])),_:1}),t($,{onClick:p},{default:l(()=>m[9]||(m[9]=[x("查看")])),_:1})]),_:1})):(D(),F(G,{key:1},{default:l(()=>[t($,{onClick:P,theme:"danger",loading:I.value},{default:l(()=>m[10]||(m[10]=[x("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(D(),F(X,{key:0,layout:"vertical",bordered:!0},{default:l(()=>[t(E,{label:"创建时间"},{default:l(()=>{var N;return[x(q((N=S.value)==null?void 0:N.insertTime),1)]}),_:1}),t(E,{label:"更新时间"},{default:l(()=>{var N;return[x(q((N=S.value)==null?void 0:N.updateTime),1)]}),_:1}),t(E,{label:"判题方式"},{default:l(()=>{var N;return[x(q((N=S.value)==null?void 0:N.judgeType),1)]}),_:1}),t(E,{label:"上传用户"},{default:l(()=>{var N;return[x(q((N=S.value)==null?void 0:N.creatorNickname),1)]}),_:1})]),_:1})):oe("",!0)])]),_:1})]),_:1}),m[11]||(m[11]=A("div",{id:"problemEditDiv",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"])}}}),Dt=ne(Fo,[["__scopeId","data-v-583e6955"]]),Go={style:{margin:"10px"}},No={style:{margin:"12px"}},Oo={class:"dida-edit-container"},Ho=ae({__name:"ProblemJudge",setup(e){let a=de();const{globalProperties:n}=re(),s=Ue(),o=f(""),c=f(!1),_=f(null);let I=null;const S=f(null),y=f(""),v=f(!1),r=f(!1),u=f([{title:"文件",colKey:"file"},{title:"大小",colKey:"size",width:150,cell:(b,d)=>d.row.size.toFixed(0)+" B"},{title:"最后修改时间",colKey:"lastModified",width:180,cell:(b,d)=>new Date(d.row.lastModified).toLocaleString()},{title:"操作",colKey:"action",width:100,cell:(b,d)=>t(O,{onClick:()=>K(d.row.file)},{default:()=>[x("下载")]})}]),h=f([]),k=Ae(()=>({border:"2px dashed #ccc",borderRadius:"6px",padding:"20px",textAlign:"center",cursor:"pointer",backgroundColor:v.value?"#f0f9ff":"#fff",transition:"background-color 0.2s ease"})),p=Ae(()=>y.value?`已选择：${y.value}`:v.value?"松开文件以上传":"拖拽文件到这里，或点击选择文件"),i=()=>{W.push({name:"problem-detail",params:{problemId:o.value}})},P=()=>{W.push({name:"manage-problem",params:{problemId:o.value}})},K=async b=>{const d=await an(o.value,b);if(d.code!==0){H(n,d.code);return}const U=document.createElement("a");U.href=d.data,U.target="_blank",U.click(),URL.revokeObjectURL(U.href)},V=async()=>{if(!I){ce(n,"请选择压缩包");return}r.value=!0,ln(o.value,I).then(async b=>{b.code==0?(S.value.value=null,I=null,y.value="",c.value=!0,We(n,"上传成功"),await T()):H(n,b.code)}).catch(b=>{console.log(b),n.$message.error({duration:3e3,content:"申请失败"})}).finally(()=>{r.value=!1})},j=()=>{var b;(b=S.value)==null||b.click()},g=b=>{const d=b.target.files[0];d&&(y.value=d.name,I=d)},m=b=>{v.value=!0},R=()=>{v.value=!1},z=b=>{b.preventDefault(),b.stopPropagation(),v.value=!1;const d=b.dataTransfer.files[0];if(d){y.value=d.name;const U=new DataTransfer;U.items.add(d),S.value.files=U.files,I=d}},T=async()=>{const b=await Yl(o.value);if(b.code!==0){H(n,b.code),await W.push({name:"problem"});return}const d=b.data.problem;_.value=Ye(d,{}),s.setTitle(d.title+" - "+s.getTitle),h.value=[],b.data.judges?b.data.judges.forEach(U=>{h.value.push({file:U.key,size:U.size,lastModified:U.last_modified})}):ce(n,"评测数据不存在"),c.value=!1};return le(async()=>{if(Array.isArray(a.params.problemId)?o.value=a.params.problemId[0]:o.value=a.params.problemId,!o.value){ce(n,"题目不存在"),await W.push({name:"problem"});return}c.value=!0,await T()}),(b,d)=>{const U=Se,L=be,w=O,C=_e,$=Ee,G=Re,E=ve,X=ke;return D(),F(X,{loading:c.value},{default:l(()=>[t(E,null,{default:l(()=>[t(L,{span:7},{default:l(()=>[A("div",Go,[A("div",{id:"drop-zone",style:Rt(k.value),onClick:j,onDragenter:Ge(m,["prevent"]),onDragover:d[0]||(d[0]=Ge(()=>{},["prevent"])),onDragleave:Ge(R,["prevent"]),onDrop:z},[A("input",{ref_key:"fileInput",ref:S,type:"file",style:{display:"none"},onChange:g},null,544),x(" "+q(p.value),1)],36)]),t(U,{data:h.value,columns:u.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1}),t(L,{span:5},{default:l(()=>[A("div",No,[A("div",Oo,[t(C,null,{default:l(()=>[t(w,{onClick:V,theme:"danger",loading:r.value},{default:l(()=>d[1]||(d[1]=[x("上传")])),_:1},8,["loading"]),t(w,{onClick:P,theme:"warning"},{default:l(()=>d[2]||(d[2]=[x("编辑")])),_:1}),t(w,{onClick:i},{default:l(()=>d[3]||(d[3]=[x("查看")])),_:1})]),_:1})]),t(G,{layout:"vertical",bordered:!0},{default:l(()=>[t($,{label:"标题"},{default:l(()=>{var B;return[x(q((B=_.value)==null?void 0:B.title),1)]}),_:1}),t($,{label:"创建时间"},{default:l(()=>{var B;return[x(q((B=_.value)==null?void 0:B.insertTime),1)]}),_:1}),t($,{label:"更新时间"},{default:l(()=>{var B;return[x(q((B=_.value)==null?void 0:B.updateTime),1)]}),_:1}),t($,{label:"判题方式"},{default:l(()=>{var B;return[x(q((B=_.value)==null?void 0:B.judgeType),1)]}),_:1}),t($,{label:"评测数据"},{default:l(()=>{var B;return[x(q((B=_.value)==null?void 0:B.judgeMd5),1)]}),_:1}),t($,{label:"上传用户"},{default:l(()=>{var B;return[x(q((B=_.value)==null?void 0:B.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Bo=ne(Ho,[["__scopeId","data-v-17986e38"]]),Wo={style:{display:"flex","align-items":"center"}},Jo={style:{color:"#409eff","margin-right":"20px"}},Xo={class:"dida-login-footer"},Yo=ae({__name:"UserForget",setup(e){const{globalProperties:a}=re(),n=Pe(),s=f(!1),o=f(!1),c=f(!1),_=f("发送验证码");let I=null,S=-1;const y=f(!1),v=f(null),r=f(""),u=f({username:"",emailKey:"",password:"",confirmPassword:""}),k=f({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:g=>new Promise(m=>{const R=setTimeout(()=>{m(u.value.password===g),clearTimeout(R)})}),message:"两次密码不一致"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),p=()=>{pe(a,"重置成功")},i=async g=>{if(!c.value){s.value=!0,o.value=!0;try{const m=await Pl(g,u.value.username);m.code===0?(pe(a,"验证码发送成功"),r.value=m.data,o.value=!1,c.value=!0,I=new Date,_.value="60秒后重发",S=setInterval(()=>{const z=Math.floor((new Date().getTime()-(I==null?void 0:I.getTime()))/1e3);z>60?(_.value="发送验证码",c.value=!1,clearInterval(S)):_.value=`${60-z}秒后重发`},1e3)):H(a,m.code)}catch(m){console.error("Send email key error",m),ce(a,"发送验证码失败")}finally{s.value=!1}}},P=async()=>{var z;if(y.value=!0,c.value||o.value)return;await xe();const g=document.getElementById("cf-confirm-div");g&&g.remove();const m=document.createElement("div");m.id="cf-confirm-div",m.setAttribute("data-theme","light"),(z=v.value)==null||z.appendChild(m);const R=window;R.turnstile.ready(function(){R.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(T){y.value=!1,await i(T)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},K=f(()=>t(O,{onClick:P,disabled:c.value,loading:o.value,style:"width:120px"},{default:()=>[_.value]})),V=async()=>{s.value=!0;try{const g=await Tl(u.value.username,u.value.password,u.value.emailKey);g.code===0?(pe(a,"密码修改成功"),a.$router.push({name:"login"})):H(a,g.code)}catch(g){console.error("Modify password error",g),ce(a,"修改密码失败")}finally{s.value=!1}},j=async({validateResult:g,firstError:m,e:R})=>{if(!s.value){if(R.preventDefault(),g!==!0){ce(a,m);return}r.value?await V():await P()}};return le(()=>{if(n.isLogin()){a.$router.push({path:"/user"});return}}),Ce(()=>{}),(g,m)=>{const R=ot,z=De,T=Ve,b=Kt,d=O,U=je,L=Oe,w=se,C=Fe;return D(),Y(te,null,[t(w,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:l(()=>[t(R,{"max-line":1},{default:l(()=>m[6]||(m[6]=[A("span",null,"如果您未绑定邮箱或忘记用户名，可联系管理员寻求帮助",-1),A("span",null,"管理员邮箱：BoilTask@qq.com",-1)])),_:1}),t(U,{ref:"form",rules:k.value,data:u.value,colon:!0,onReset:p,onSubmit:j,class:"yj-login-form"},{default:l(()=>[t(T,{name:"username",label:"用户名"},{default:l(()=>[t(z,{modelValue:u.value.username,"onUpdate:modelValue":m[0]||(m[0]=$=>u.value.username=$),clearable:"",placeholder:"请输入完整用户名"},null,8,["modelValue"])]),_:1}),r.value?(D(),Y(te,{key:0},[t(T,{name:"email",label:"发送邮箱"},{default:l(()=>[t(b,{append:K.value},{default:l(()=>[A("div",Wo,[A("span",Jo,q(r.value),1)])]),_:1},8,["append"])]),_:1}),t(T,{name:"emailKey",label:"验证码"},{default:l(()=>[t(z,{modelValue:u.value.emailKey,"onUpdate:modelValue":m[1]||(m[1]=$=>u.value.emailKey=$),clearable:"",placeholder:"请输入收到的验证码"},null,8,["modelValue"])]),_:1}),t(T,{name:"password",label:"新密码"},{default:l(()=>[t(z,{modelValue:u.value.password,"onUpdate:modelValue":m[2]||(m[2]=$=>u.value.password=$),type:"password",clearable:"",placeholder:"新密码"},null,8,["modelValue"])]),_:1}),t(T,{name:"confirmPassword",label:"确认密码"},{default:l(()=>[t(z,{modelValue:u.value.confirmPassword,"onUpdate:modelValue":m[3]||(m[3]=$=>u.value.confirmPassword=$),type:"password",clearable:"",placeholder:"请重复输入密码"},null,8,["modelValue"])]),_:1})],64)):oe("",!0),r.value?(D(),F(T,{key:1},{default:l(()=>[t(d,{theme:"primary",type:"submit",block:"",loading:s.value},{default:l(()=>m[7]||(m[7]=[x("修改密码")])),_:1},8,["loading"])]),_:1})):(D(),F(T,{key:2},{default:l(()=>[t(d,{theme:"primary",type:"submit",block:"",loading:s.value},{default:l(()=>m[8]||(m[8]=[x("重置密码")])),_:1},8,["loading"])]),_:1}))]),_:1},8,["rules","data"]),A("div",Xo,[t(L,{onClick:m[4]||(m[4]=()=>{fe(a).$router.push({name:"login"})})},{default:l(()=>m[9]||(m[9]=[x("返回登陆 ")])),_:1})])]),_:1}),t(C,{visible:y.value,"onUpdate:visible":m[5]||(m[5]=$=>y.value=$),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:l(()=>[A("div",{ref_key:"dialogContainer",ref:v,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),Zo=ne(Yo,[["__scopeId","data-v-c3586c6f"]]),oa=[{name:"problem-list",tab:"problem",sidebar:"problem-list",path:"",title:"问题列表",icon:"list",component:cn},{name:"problem-detail",tab:"problem",sidebar:"problem-list",path:":problemId+",title:"问题详情",icon:"list",component:It},{name:"problem-recommend",tab:"problem",sidebar:"problem-recommend",path:"recommend/:problemId*",title:"问题推荐",icon:"cpu",needLogin:!0,component:In},{name:"problem-collection",tab:"problem",sidebar:"problem-collection",path:"collection",title:"题目集合",icon:"list",disableTabPath:!0,component:zn},{name:"collection-detail",tab:"collection-detail-tab",sidebar:"collection-detail",path:":collectionId+",title:"题集详情",icon:"cpu",component:qn},{name:"collection-rank",tab:"collection-detail-tab",sidebar:"collection-rank",path:":collectionId+/rank",title:"题集排名",icon:"list",component:Mn},{name:"collection-edit",tab:"collection-detail-tab",sidebar:"collection-edit",disableSidebar:!0,path:":collectionId+/edit",title:"题集编辑",icon:"list",component:Xn},{name:"judge-list",tab:"judge",sidebar:"judge-list",path:"",title:"评测列表",icon:"list",component:Tt},{name:"judge-detail",tab:"judge",sidebar:"judge-list",path:":judgeId+",title:"评测详情",icon:"cpu",component:Lt},{name:"contest-list",tab:"contest",sidebar:"contest-list",path:"",title:"比赛列表",icon:"list",component:jt},{name:"contest-recent",tab:"contest",sidebar:"contest-recent",path:"recent",title:"近期比赛",icon:"list",component:jt},{name:"contest-detail",tab:"contest-detail-tab",sidebar:"contest-detail",path:":contestId+",title:"比赛详情",icon:"cpu",component:io},{name:"contest-problem-detail",tab:"contest-detail-tab",sidebar:"contest-problem-detail",path:":contestId+/problem/:problemIndex+",title:"问题详情",icon:"cpu",disableSidebar:!0,component:It},{name:"contest-judge",tab:"contest-detail-tab",sidebar:"contest-judge",path:":contestId+/judge",title:"评测列表",icon:"list",component:Tt},{name:"contest-judge-detail",tab:"contest-detail-tab",sidebar:"contest-judge-detail",path:":contestId+/judge/:judgeId+",title:"评测详情",icon:"cpu",component:Lt,disableSidebar:!0},{name:"contest-rank",tab:"contest-detail-tab",sidebar:"contest-rank",path:":contestId+/rank",title:"比赛排名",icon:"list",component:co},{name:"contest-discuss",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss",title:"比赛讨论",icon:"list",component:et},{name:"contest-discuss-detail",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss/:discussId+",title:"讨论详情",icon:"list",component:ut},{name:"discuss-list",tab:"discuss",sidebar:"discuss-list",path:"",title:"讨论列表",icon:"list",component:et},{name:"discuss-list-problem",tab:"discuss",sidebar:"discuss-list-problem",path:"problem",title:"问题讨论",icon:"list",component:et},{name:"discuss-list-judge",tab:"discuss",sidebar:"discuss-list-judge",path:"judge",title:"评测讨论",icon:"list",component:et},{name:"discuss-detail",tab:"discuss",sidebar:"discuss-list",path:":discussId+",title:"讨论详情",icon:"list",component:ut},{name:"rank-ac-all",tab:"rank",sidebar:"rank-ac-all",path:"ac",title:"AC排名",icon:"base-station",props:{type:"all"},component:Be},{name:"rank-ac-problem",tab:"rank",sidebar:"rank-ac-problem",path:"ac/problem",title:"题量排名",icon:"base-station",props:{type:"problem"},component:Be},{name:"rank-ac-problem-today",tab:"rank",sidebar:"rank-ac-problem-today",path:"ac/problem/today",title:"今日题量",icon:"base-station",props:{type:"problem-today"},component:Be},{name:"rank-ac-problem-day7",tab:"rank",sidebar:"rank-ac-problem-day7",path:"ac/problem/day7",title:"7日题量",icon:"base-station",props:{type:"problem-day7"},component:Be},{name:"rank-ac-problem-year",tab:"rank",sidebar:"rank-ac-problem-year",path:"ac/problem/year",title:"1年题量",icon:"base-station",props:{type:"problem-year"},component:Be},{name:"tool-paste",tab:"tool",sidebar:"tool-paste",path:"paste",title:"码池",icon:"base-station",component:ft},{name:"system-status",tab:"system",sidebar:"system-status",path:"",title:"运行状态",icon:"base-station",component:ft},{name:"system-about",tab:"system",sidebar:"system-about",path:"about",title:"关于",icon:"base-station",props:{discussId:"52"},component:ut},{name:"manage-problem-create",tab:"manage",sidebar:"manage-problem-create",disableSidebar:!0,path:"problem",title:"新建问题",icon:"list",component:Dt,auths:[$e.ManageProblem]},{name:"manage-problem",tab:"manage",sidebar:"manage-problem",disableSidebar:!0,path:"problem/:problemId+",title:"问题编辑",icon:"list",component:Dt,auths:[$e.ManageProblem]},{name:"manage-problem-judge",tab:"manage",sidebar:"manage-problem-judge",disableSidebar:!0,path:"problem/:problemId+/judge",title:"评测数据",icon:"list",component:Bo,auths:[$e.ManageProblem]},{name:"manage-judge",tab:"manage",path:"judge",sidebar:"manage-judge",title:"评测管理",icon:"list",auths:["i-manage-judge"],component:Ro},{name:"login-forget",tab:"login",path:"forget",title:"忘记密码",component:Zo}],$t=(e,a,n,s)=>{s.tab==n&&(s.disableSidebar&&a!=s.sidebar||s.sidebar==null||s.sidebar!=s.name||e.push({name:s.name,title:s.title,icon:s.icon,to:{name:s.name}}))},Qo=(e,a)=>{const n=[];return oa.forEach(s=>{if(Wt(s)){const o=[];s.children.forEach(c=>{$t(o,e,a,c)}),o.length>0&&n.push({title:s.title,children:o})}else $t(n,e,a,s)}),n},zt=(e,a)=>{const n=Rl(a.tab),s={name:a.name,path:"/"+a.path,meta:{title:a.title+" - "+n.title,tab:a.tab,sidebar:a.sidebar,showSidebar:n.showSidebar,needLogin:n.needLogin||a.needLogin,tabAuths:n.auths,auths:a.auths},props:a.props,component:a.component};!n.disablePath&&!a.disableTabPath&&(s.path=n.path+s.path),e.push(s)},es=e=>{oa.forEach(a=>{Wt(a)?a.children.forEach(n=>{zt(e,n)}):zt(e,a)})},ts={class:"sh-main"},as=ae({__name:"View403",setup(e){let a=de();const n=f("");return le(()=>{a.query.target?n.value=a.query.target:n.value=a.fullPath}),(s,o)=>{const c=O;return D(),Y("div",ts,[A("p",null,q(n.value),1),o[2]||(o[2]=A("p",null,"该页面无访问权限，请更换访问目标或重新登陆后再试",-1)),t(c,{theme:"primary",onClick:o[0]||(o[0]=()=>s.$router.push("/"))},{default:l(()=>o[1]||(o[1]=[x("返回首页")])),_:1})])}}}),sa=ne(as,[["__scopeId","data-v-8f62f1f8"]]),Ze=[];Kl(Ze);es(Ze);Ze.push({path:"/403",name:"403",component:sa});Ze.push({path:"/:pathMatch(.*)*",name:"404",component:Bt});const W=_a({history:va("/"),routes:Ze});W.beforeEach((e,a,n)=>{if(e.name==null||!W.hasRoute(e.name)){n({name:"home"});return}const s=e.matched[e.matched.length-1].meta;if(s.redirect){n({name:s.redirect});return}if(s.needLogin){const c=Pe();if(c.getToken==null||c.getToken==""){n({name:"login",query:{redirect_uri:e.fullPath}});return}}const o=s.tabAuths;if(o&&!Pe().hasAllAuths(o)){n({name:"403",query:{target:e.fullPath}});return}n()});W.afterEach((e,a)=>{if(e.name===a.name)return;const n=rt(),s=Ue();let o=null;if(e.matched.length>0&&(o=e.matched[e.matched.length-1].meta),o!=null&&o.title&&s.setTitle(o==null?void 0:o.title),o!=null&&o.showSidebar){n.setSidebarShow(!0);const c=Qo(o==null?void 0:o.sidebar,o==null?void 0:o.tab);n.setMenuList(c),n.setMenuActiveName(o==null?void 0:o.sidebar)}else n.setSidebarShow(!1)});const ra=nt("login",{state:()=>({Loaded:!1}),getters:{isLoaded(){return this.Loaded}}}),ls=ae({__name:"HeaderContent",setup(e){const a=ra(),n=Pe(),{globalProperties:s}=re(),o=f(a.isLoaded),c=f(!1),_=f(n.getUsername),I=f(n.getNickname),S=f(),y=()=>{S.value=El(n)};a.$subscribe((u,h)=>{o.value=h.Loaded}),n.$subscribe((u,h)=>{_.value=h.username,I.value=h.nickname,c.value=h.token!="",y()});const v=()=>{s.$router.currentRoute.value.name!=="login"&&s.$router.push({name:"login",query:{redirect_uri:s.$router.currentRoute.value.fullPath}})},r=()=>{n.clear(),s.$message.success({duration:3e3,content:"注销成功"}),s.$router.push({path:"/login",query:{redirect_uri:s.$router.currentRoute.value.fullPath}})};return le(()=>{y()}),(u,h)=>{const k=Et("router-link"),p=Ot,i=Nt,P=Ea,K=Ka;return D(),F(K,{modelValue:u.$route.meta.tab,"onUpdate:modelValue":h[0]||(h[0]=V=>u.$route.meta.tab=V),class:"sh-menu","expand-type":"popup"},{logo:l(()=>[t(k,{to:"/",class:"sh-logo"},{default:l(()=>h[1]||(h[1]=[x("DidaOJ")])),_:1})]),operations:l(()=>[o.value&&c.value?(D(),F(P,{key:0,title:I.value},{icon:l(()=>[t(p,{name:"user"})]),default:l(()=>[t(i,{value:"user",to:{path:"/user/"+_.value}},{default:l(()=>h[2]||(h[2]=[x("个人空间")])),_:1},8,["to"]),t(i,{value:"user_logout",onClick:r},{default:l(()=>h[3]||(h[3]=[x(" 注销")])),_:1})]),_:1},8,["title"])):o.value?(D(),F(i,{key:2,value:"login",onClick:v},{icon:l(()=>[t(p,{name:"login"})]),default:l(()=>[h[5]||(h[5]=x(" 登录 "))]),_:1})):(D(),F(i,{key:1,value:"login"},{icon:l(()=>[t(p,{name:"login"})]),default:l(()=>[h[4]||(h[4]=x(" ... "))]),_:1}))]),default:l(()=>[(D(!0),Y(te,null,ge(S.value,V=>(D(),F(i,{key:V.name,value:V.name,to:{name:V.name}},{icon:l(()=>[V.icon?(D(),F(p,{key:0,name:V.icon},null,8,["name"])):oe("",!0)]),default:l(()=>[x(" "+q(V.title),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])}}}),ns=ne(ls,[["__scopeId","data-v-c64d812f"]]),os={id:"menu-container"},ss=ae({__name:"SidebarContent",setup(e){const a=rt(),n=f(!1),s=f(null),o=f(a.menuActiveName),c=f(a.menuList),_=f([]),I=f(!1),S=()=>{o.value=a.menuActiveName;const v=JSON.stringify(c.value),r=JSON.stringify(a.menuList);v!==r&&(_.value.push([...a.menuList]),y())},y=async()=>{if(_.value.length>0&&!I.value){for(I.value=!0;_.value.length>1;)_.value.shift();const v=_.value.shift();n.value=v.length<=0,c.value=[],await xe(),s.value&&s.value.updateActiveName(),await new Promise(u=>setTimeout(u,300)),c.value=v,await xe(),s.value&&s.value.updateActiveName();const r=300;await new Promise(u=>setTimeout(u,r)),I.value=!1,await y()}};return a.$subscribe((v,r)=>{S()}),le(()=>{S()}),(v,r)=>{const u=Ot,h=Nt,k=Ma,p=qa,i=ke;return D(),Y(te,null,[A("div",os,[t(p,{modelValue:o.value,"onUpdate:modelValue":r[0]||(r[0]=P=>o.value=P),theme:"light",class:"sh-menu-container"},{default:l(()=>[t(ga,{name:"move-left"},{default:l(()=>[(D(!0),Y(te,null,ge(c.value,(P,K)=>(D(),Y(te,{key:K},[fe(ql)(P)?(D(),F(k,{key:0,title:P.title},{default:l(()=>[(D(!0),Y(te,null,ge(P.children,(V,j)=>(D(),F(h,{key:V.name,value:V.name,to:V.to},mt({default:l(()=>[x(" "+q(V.title),1)]),_:2},[V.icon?{name:"icon",fn:l(()=>[t(u,{name:V.icon,class:pt(V.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))),128))]),_:2},1032,["title"])):(D(),F(h,{key:P.name,value:P.name,to:P.to},mt({default:l(()=>[x(" "+q(P.title),1)]),_:2},[P.icon?{name:"icon",fn:l(()=>[t(u,{name:P.icon,class:pt(P.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),t(i,{size:"small",loading:n.value,"show-overlay":!0,attach:"#menu-container",class:"sh-sidebar-loading",style:{"align-items":"flex-start","padding-top":"100px"}},null,8,["loading"])],64)}}}),rs=ne(ss,[["__scopeId","data-v-96e2d89f"]]),us={};function is(e,a){return null}const cs=ne(us,[["render",is]]),ds={class:"footer"},ms={class:"footer-left"},ps={class:"foot-time"},fs={class:"footer-center"},_s={href:"https://beiancx.miit.gov.cn/",target:"_blank"},vs={class:"footer-right"},gs={class:"foot-text"},bs={href:"https://github.com/hpu-developer/DiDaOJ-web",target:"_blank"},hs={class:"foot-text"},ys={href:"https://github.com/hpu-developer/DiDaOJ-go",target:"_blank"},ws=ae({__name:"FooterContent",setup(e){const a=f("");function n(){a.value=new Date().toLocaleString()}return le(()=>{n(),setInterval(()=>{n()},1e3)}),(s,o)=>{const c=O;return D(),Y("div",ds,[A("div",ms,[A("p",ps,q(a.value),1)]),A("div",fs,[A("a",_s,[t(c,{theme:"default",variant:"outline",ghost:!0},{default:l(()=>o[0]||(o[0]=[x("豫ICP备15024677号-4")])),_:1})])]),A("div",vs,[A("p",gs,[A("a",bs,[t(c,{theme:"default",variant:"outline",ghost:!0},{default:l(()=>o[1]||(o[1]=[x("@didaoj-web")])),_:1})])]),A("p",hs,[A("a",ys,[t(c,{theme:"default",variant:"outline",ghost:!0},{default:l(()=>o[2]||(o[2]=[x("@didaoj-go")])),_:1})])])])])}}}),ks=ne(ws,[["__scopeId","data-v-979fed79"]]),tt=20,ct=100,dt=50,Cs=ae({__name:"ForceHiddenSidebarButton",setup(e){let a=rt();const n=f({x:window.innerWidth-ct-tt,y:window.innerHeight-dt-tt}),s=f(window.innerWidth),o=f(window.innerHeight);let c=!1,_={x:0,y:0};const I=P=>{c=!0;const K=P.clientX??P.touches[0].clientX,V=P.clientY??P.touches[0].clientY;_={x:K-n.value.x,y:V-n.value.y},document.addEventListener("mousemove",S),document.addEventListener("touchmove",S),document.addEventListener("mouseup",y),document.addEventListener("touchend",y)},S=P=>{if(!c)return;const K=P.clientX??P.touches[0].clientX,V=P.clientY??P.touches[0].clientY;let j=K-_.x,g=V-_.y;j=Math.max(0,Math.min(j,s.value-ct)),g=Math.max(0,Math.min(g,o.value-dt)),n.value={x:j,y:g}},y=()=>{c=!1,document.removeEventListener("mousemove",S),document.removeEventListener("touchmove",S),document.removeEventListener("mouseup",y),document.removeEventListener("touchend",y)},v=()=>{s.value=window.innerWidth,o.value=window.innerHeight,n.value={x:Math.min(n.value.x,s.value-ct-tt),y:Math.min(n.value.y,o.value-dt-tt)}};let r=f(a.forceHiddenSidebar),u=f(a.forceHiddenSidebar);const h=()=>{r.value=!r.value,a.setForceHiddenSidebar(r.value)},k=()=>{u.value||(u.value=!0,a.setForceHiddenSidebar(r.value))},p=()=>{u.value&&(u.value=!1,a.setForceHiddenSidebar(!1))},i=P=>{P>=800?p():k()};return i(s.value),Le(s,P=>{i(P)}),le(()=>{window.addEventListener("resize",v)}),Ce(()=>{window.removeEventListener("resize",v)}),(P,K)=>{const V=O;return fe(u)?(D(),F(V,{key:0,class:"draggable-button",style:Rt({top:`${n.value.y}px`,left:`${n.value.x}px`}),onMousedown:I,onTouchstart:I,variant:"dashed",theme:"primary",onClick:h},{default:l(()=>[x(q(fe(r)?"显示":"隐藏"),1)]),_:1},8,["style"])):oe("",!0)}}}),Ss=ne(Cs,[["__scopeId","data-v-1aee5506"]]),at="DidaOJ",Is=ae({__name:"App",setup(e){const{globalProperties:a}=re(),n=ra(),s=Pe(),o=Ue(),c=rt();n.$patch({Loaded:!1});const _=s.getToken,I=f(!1),S=f(!1);o.title&&o.title.length>0?document.title=o.title+" - "+at:document.title=at,o.$subscribe((u,h)=>{h.title&&h.title.length>0?document.title=h.title+" - "+at:document.title=at}),c.$subscribe((u,h)=>{I.value=h.showSidebar,S.value=I.value&&!h.forceHiddenSidebar});const y=de(),v=Ae(()=>{const u=y.meta.auths;return u?!s.hasAllAuths(u):!1});function r(){a.$message.warning({duration:3e3,content:"登陆状态失效"}),n.$patch({Loaded:!0}),s.clear()}return le(()=>{if(_==""){n.$patch({Loaded:!0});return}wl().then(u=>{u.code==0?(s.loadResponse(u.data),n.$patch({Loaded:!0})):(H(a,u.code),n.$patch({Loaded:!0}),s.clear())}).catch(u=>{console.log(u),r()})}),(u,h)=>{const k=Fa,p=Na,i=Et("RouterView"),P=Oa,K=Ga,V=Ha;return D(),Y(te,null,[t(K,null,{default:l(()=>[t(k,{class:"sh-header"},{default:l(()=>[t(ns)]),_:1}),t(K,null,{default:l(()=>[t(ba,{name:"slide"},{default:l(()=>[S.value?(D(),F(p,{key:0,class:"sh-sidebar"},{default:l(()=>[t(rs)]),_:1})):oe("",!0)]),_:1}),t(K,{class:pt(["sh-main-layout",{expanded:!S.value}])},{default:l(()=>[t(cs),t(P,{class:"sh-main-content"},{default:l(()=>[v.value?(D(),F(sa,{key:0})):(D(),F(i,{key:1}))]),_:1}),t(ks)]),_:1},8,["class"])]),_:1})]),_:1}),I.value?(D(),F(Ss,{key:0})):oe("",!0),t(V,{container:"body",offset:["24px","80px"],size:"small"})],64)}}}),Ps=ne(Is,[["__scopeId","data-v-9e122cb4"]]);Wa.registerLanguage("verilog",Ja);const ua=ha();ua.use(ya);const Qe=wa(Ps);Qe.use(ua);Qe.use(W);Qe.use(Ba);Qe.use(ka);Qe.mount("#app");fl().then(()=>{console.log("Text cache reinitialized")}).catch(e=>{console.error("Text cache reinitialization failed",e)});
