import{bm as Ye,bn as kt,n as te,r as m,o as ae,G as St,bo as J,bp as V,s as a,bq as n,br as D,F as Z,bs as de,bt as q,bu as E,ap as P,u as Ue,bv as ie,bw as me,aD as ue,g as Yt,bx as Zt,by as Qt,bz as ea,J as we,q as ye,bA as ta,bB as Ee,y as Ve,c as je,bC as Fe,bD as lt,ac as aa,bE as Ct,bF as na,bG as oa,bH as Pt,aM as la,bI as st,a0 as sa,bJ as ra,bK as ua,B as ia,bL as ca}from"./node_modules-x_y3cvPb.js";import{L as _e,C as se,S as pe,a as da,T as ma,b as ge,A as ct,c as pa,d as fa,e as _a,f as ga,g as Ke,R as ve,B as F,F as Ie,h as Te,I as ke,D as Ge,i as It,j as $e,k as De,l as va,m as xe,n as Tt,O as xt,P as ba,o as Lt,p as jt,q as zt,r as ha,s as ya,t as wa,u as ka,v as Sa,w as Ca,M as Vt,x as $t,y as Pa,H as Ia,z as Ta,E as xa,G as La,J as ja,K as za,N as Va,Q as $a,U as Da}from"./tdesign-vue-next-UxLz_uvk.js";import{V as le}from"./vditor-DArazWIS.js";import{e as vt}from"./monaco-editor-DCUKHC_e.js";import{H as Ra,v as Aa}from"./highlight.js-D9zWiMxS.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const _ of i.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&s(_)}).observe(document,{childList:!0,subtree:!0});function o(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerPolicy&&(i.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?i.credentials="include":l.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(l){if(l.ep)return;l.ep=!0;const i=o(l);fetch(l.href,i)}})();var ze=(e=>(e.Manage="i-manage",e.ManageJudge="i-manage-judge",e.ManageProblem="i-manage-problem",e))(ze||{});const Ua={"r-admin":["i-manage","i-manage-judge","i-manage-problem"]};function Ea(e){if(e==null)return[];const t=[];for(const o of e){const s=Ua[o];s!=null&&t.push(...s)}return[...new Set(t)]}function qa(e,t){if(e==null||t==null)return!1;const o=Ea(e);for(const s of t)if(!o.includes(s))return!1;return!0}const he=Ye("user",{state:()=>({token:"",userId:-1,username:"",nickname:"",roles:[]}),getters:{getToken(){return this.token},getUserId(){return this.userId},getUsername(){return this.username},getNickname(){return this.nickname}},actions:{clear(){this.$patch({token:"",userId:-1,username:"",nickname:"",roles:[]})},loadResponse(e){this.$patch({token:e.token,userId:e.user_id,username:e.username,nickname:e.nickname,roles:e.roles})},isLogin(){return this.token!=null&&this.token!=""},hasAuth(e){return this.hasAllAuths([e])},hasAllAuths(e){return e?qa(this.roles,e):!0}},persist:!0}),Le=Ye("webStyle",{state:()=>({title:""}),getters:{getTitle(){return this.title}},actions:{setTitle(e){this.title=e}}}),Ze=Ye("sidebarStyle",{state:()=>({showSidebar:!1,forceHiddenSidebar:!1,menuActiveName:"",menuList:[]}),getters:{getMenuList(){return this.menuList}},actions:{setSidebarShow(e){this.showSidebar=e},setForceHiddenSidebar(e){this.forceHiddenSidebar=e},setMenuActiveName(e){this.menuActiveName=e},clearMenuList(){this.menuList=[]},setMenuList(e){this.menuList=e},addMenuList(e){this.menuList.push(e)}}}),He=kt.create({timeout:6e4,withCredentials:!1,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});He.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function Ma(){return He({baseURL:"https://r2-oj.didapipa.com",url:"/system/notification.json?"+Date.now(),method:"get"})}function Fa(){return He({baseURL:"https://r2-oj.didapipa.com",url:"/status/judger.json?"+Date.now(),method:"get"})}function Dt(e){return He({baseURL:"https://r2-oj.didapipa.com",url:"/status/judger/"+e+".json?"+Date.now(),method:"get"})}function Ka(e){return He({baseURL:"https://r2-oj.didapipa.com",url:"/status/web.json?"+Date.now(),method:"get"})}const Ga={class:"judger-status-panel"},Ha={class:"judger-status-panel"};function Oa(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ue(e)}const Na=te({__name:"SystemStatus",setup(e){const t=m([]),o=m([]),s=m(!1),l=m(!1);let i;const _=d=>{let r="失效",v="danger";const w=new Date,C=new Date(d.updateTime);return w.getTime()-C.getTime()>3e4?(r="离线",v="default"):d.cpuUsage>90?(r="CPU过高",v="warning"):d.memPercent>90?(r="内存过高",v="warning"):(r="在线",v="success"),a(pe,null,{default:()=>[a("span",null,[d.key,P(" - "),d.name]),a("span",null,[d.updateTime]),a(ma,{theme:v,size:"small"},Oa(r)?r:{default:()=>[r]})]})},x=async()=>{const d=[{key:"didaoj",name:"DidaOj"}],r={};for(let w=0;w<t.value.length;w++){const C=t.value[w];r[C.key]=C}const v=[];for(let w=0;w<d.length;w++){const C=d[w],f={key:C.key},h=await Ka(C.key);h&&(h.name?f.name=h.name:f.name="-",h.update_time?f.updateTime=new Date(h.update_time).toLocaleString():f.updateTime="-",h.cpu_usage?f.cpuUsage=Number(h.cpu_usage):f.cpuUsage=0,h.mem_usage?f.memUsage=h.mem_usage/(1024*1024*1024):f.memUsage=0,h.mem_total?f.memTotal=h.mem_total/(1024*1024*1024):f.memTotal=0,f.memTotal>0?f.memPercent=Math.round(f.memUsage/f.memTotal*1e4)/100:f.memPercent=0,f.avgMessage=h.avg_message,r[C.key]?(f.cpuUsageFrom=r[C.key].cpuUsage,f.memPercentFrom=r[C.key].memPercent,f.memUsageFrom=r[C.key].memUsage,f.memTotalFrom=r[C.key].memTotal):(f.cpuUsageFrom=0,f.memPercentFrom=0,f.memUsageFrom=0,f.memTotalFrom=0),v.push(f))}t.value=v},k=async()=>{const d=await Fa(),r={};for(let w=0;w<o.value.length;w++){const C=o.value[w];r[C.key]=C}const v=[];for(let w=0;w<d.judgers.length;w++){const C=d.judgers[w],f={key:C.key,name:C.name},h=await Dt(C.key);h&&(h.name?f.name=h.name:f.name="-",h.update_time?f.updateTime=new Date(h.update_time).toLocaleString():f.updateTime="-",h.cpu_usage?f.cpuUsage=Number(h.cpu_usage):f.cpuUsage=0,h.mem_usage?f.memUsage=h.mem_usage/(1024*1024*1024):f.memUsage=0,h.mem_total?f.memTotal=h.mem_total/(1024*1024*1024):f.memTotal=0,f.memTotal>0?f.memPercent=Math.round(f.memUsage/f.memTotal*1e4)/100:f.memPercent=0,f.avgMessage=h.avg_message,r[C.key]?(f.cpuUsageFrom=r[C.key].cpuUsage,f.memPercentFrom=r[C.key].memPercent,f.memUsageFrom=r[C.key].memUsage,f.memTotalFrom=r[C.key].memTotal):(f.cpuUsageFrom=0,f.memPercentFrom=0,f.memUsageFrom=0,f.memTotalFrom=0),v.push(f))}o.value=v},g=async()=>{await x(),s.value=!1,await k(),l.value=!1};return ae(async()=>{o.value=[],t.value=[],l.value=!0,s.value=!0,await g(),i=setInterval(()=>{g()},5e3)}),St(()=>{clearInterval(i)}),(d,r)=>{const v=da,w=pe,C=se,f=_e;return V(),J(Z,null,[a(C,{title:"接口状态",class:"judger-status"},{default:n(()=>[a(f,{loading:s.value},{default:n(()=>[D("div",Ga,[(V(!0),J(Z,null,de(t.value,h=>(V(),q(C,{key:h.key,header:()=>_(h),class:"judge-status-judger"},{footer:n(()=>[D("span",null," 负载信息："+E(h.avgMessage),1)]),default:n(()=>[a(w,{class:"judge-status-judger"},{default:n(()=>[a(v,{title:"CPU使用率",value:h.cpuUsage,animation:{valueFrom:h.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),a(v,{title:"内存使用率",value:h.memPercent,animation:{valueFrom:h.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),a(v,{title:"内存使用量",animation:{valueFrom:h.memUsageFrom,duration:2e3},"animation-start":!0,value:h.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),a(v,{title:"内存总量",value:h.memTotal,animation:{valueFrom:h.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1},8,["loading"])]),_:1}),a(C,{title:"判题机状态",class:"judger-status"},{default:n(()=>[a(f,{loading:l.value},{default:n(()=>[D("div",Ha,[(V(!0),J(Z,null,de(o.value,h=>(V(),q(C,{key:h.key,header:()=>_(h),class:"judge-status-judger"},{footer:n(()=>[D("span",null," 负载信息："+E(h.avgMessage),1)]),default:n(()=>[a(w,{class:"judge-status-judger"},{default:n(()=>[a(v,{title:"CPU使用率",value:h.cpuUsage,animation:{valueFrom:h.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),a(v,{title:"内存使用率",value:h.memPercent,animation:{valueFrom:h.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),a(v,{title:"内存使用量",animation:{valueFrom:h.memUsageFrom,duration:2e3},"animation-start":!0,value:h.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),a(v,{title:"内存总量",value:h.memTotal,animation:{valueFrom:h.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1},8,["loading"])]),_:1})],64)}}}),ee=(e,t)=>{const o=e.__vccOpts||e;for(const[s,l]of t)o[s]=l;return o},rt=ee(Na,[["__scopeId","data-v-1fb43cc1"]]),Ba={style:{"text-align":"right"}},Ja=te({__name:"Hitokoto",setup(e){const t=m(!1),o=m(""),s=m(""),l=m(""),i=async()=>{t.value=!0;try{const x=await(await fetch("https://v1.hitokoto.cn")).json();s.value=x.hitokoto,l.value=x.creator,o.value="—— "+x.from}catch(_){s.value="一言获取失败了，但至少您还可以访问本站。",l.value="BoilTask",o.value="DidaOJ",console.error("Error fetching Hitokoto:",_)}finally{t.value=!1}};return ae(()=>{i()}),(_,x)=>{const k=se,g=_e;return V(),q(g,{loading:t.value},{default:n(()=>[a(k,{title:"一言 © Hitokoto"},{actions:n(()=>[P(" @"+E(l.value),1)]),default:n(()=>[D("div",null,[D("span",null,E(s.value),1),D("p",Ba,E(o.value),1)])]),_:1})]),_:1},8,["loading"])}}}),Wa={class:"sh-main"},Xa={class:"dida-swiper-div"},Ya=te({__name:"HomeView",setup(e){let t=-1;const o=m(null),s=async()=>{o.value=await Ma()};return ae(async()=>{await s(),t=setInterval(()=>{s()},3e4)}),St(()=>{clearInterval(t)}),(l,i)=>{const _=ct,x=fa,k=pa,g=se,d=ge,r=Ke,v=ga,w=_a,C=ve;return V(),q(C,null,{default:n(()=>[a(d,{span:8},{default:n(()=>[D("div",Wa,[o.value?(V(),q(_,{key:0,style:{margin:"20px"},theme:o.value.theme},{default:n(()=>[P(E(o.value.content),1)]),_:1},8,["theme"])):ie("",!0),D("div",Xa,[a(k,{class:"dida-swiper"},{default:n(()=>[a(x,null,{default:n(()=>i[0]||(i[0]=[D("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1}),a(x,null,{default:n(()=>i[1]||(i[1]=[D("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1})]),_:1})]),a(g,{title:"正在完善，欢迎提供意见建议",style:{width:"500px",margin:"0 auto"}},{default:n(()=>i[2]||(i[2]=[D("p",null,[D("a",{href:"https://codeoj.cn/",target:"_blank"},"CodeOJ"),P("的迁移计划")],-1),D("p",null,"正在开发中",-1)])),_:1})])]),_:1}),a(d,{span:4},{default:n(()=>[a(Ja,{style:{margin:"10px"}}),a(rt),a(g,{style:{margin:"10px"},bordered:!0},{header:n(()=>i[3]||(i[3]=[D("b",null,"友情链接",-1)])),default:n(()=>[a(w,null,{default:n(()=>[a(v,null,{default:n(()=>[a(r,{href:"https://boiltask.com",target:"_blank"},{default:n(()=>i[4]||(i[4]=[P("BoilTask Blog")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),Za=ee(Ya,[["__scopeId","data-v-aba0b66b"]]),Qa={class:"sh-main"},en=te({__name:"View404",setup(e){let t=me(),o=m(t.fullPath);return(s,l)=>{const i=F;return V(),J("div",Qa,[D("p",null,E(ue(o)),1),l[2]||(l[2]=D("p",null,"该页面无效或已被迁移，请重新选择访问目标",-1)),a(i,{theme:"primary",onClick:l[0]||(l[0]=()=>s.$router.push("/"))},{default:n(()=>l[1]||(l[1]=[P("返回首页")])),_:1})])}}}),Rt=ee(en,[["__scopeId","data-v-d4218944"]]);let ut=null;async function tn(){ut=await nn()}function an(e,t="zh"){if(ut==null)return[!1,e.toString()];const o=ut[e.toString()];if(!o)return[!1,e.toString()];let s=o[t];return s||(t="zh",s=o[t]),s?[!0,s]:[!1,e.toString()]}async function nn(){return new Promise((e,t)=>{e({404:{zh:"接口未找到"},1e3:{zh:"系统错误，请重试或等待管理员修复"},1001:{zh:"系统异常，请重试或等待管理员修复"},1002:{zh:"未知错误"},1003:{zh:"操作过于频繁，请稍后重试"},10001:{zh:"权限异常，请重新登陆后再试"},10002:{zh:"参数不符合要求"},10003:{zh:"未找到目标数据"},100001:{zh:"用户名不存在或密码不匹配"},100002:{zh:"邮件发送失败，可能是邮箱无效或达到了每日注册上限，如有问题可联系管理员解决"},100003:{zh:"验证码错误或已过期，请重新获取"},100004:{zh:"注册用户失败，可能存在同名用户"},100005:{zh:"用户名不存在，或您未在本系统绑定邮箱，请联系管理员寻求帮助"},100006:{zh:"验证码错误或已过期，请重新获取"}})})}function re(){const{appContext:e}=Yt();return{globalProperties:e.config.globalProperties}}function Pe(){return 1e3}function At(e,t,o=3e3){e.$message.success({duration:o,content:t})}function ce(e,t,o=3e3){e.$message.info({duration:o,content:t})}function oe(e,t,o=3e3){e.$message.error({duration:o,content:t})}function K(e,t,o=3e3){const[s,l]=an(t),i=s?l:`系统错误，错误提示[${l}]`;e.$message.error({duration:o,content:i})}const on="https://oj-api.didapipa.com/",W=kt.create({baseURL:on,timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});W.interceptors.request.use(e=>{const o=he().getToken;return o&&(e.headers["X-Token"]=o),e},e=>Promise.reject(e));W.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function ln(e){const t={};return t.id=e.id,t.username=e.username,t.nickname=e.nickname,t.email=e.email,t.slogan=e.slogan,t.organization=e.organization,t.accept=e.accept,t.attempt=e.attempt,e.email&&(t.avatar=`https://www.gravatar.com/avatar/${Zt(e.email.toLowerCase().trim())}?d=identicon&s=100`),t}function sn(e,t){return W({url:"/user/login",method:"post",data:{username:e,password:t}})}function rn(){return W({url:"/user/login/refresh",method:"post"})}function un(e){const t={username:e};return W({url:`/user/info?${new URLSearchParams(t).toString()}`,method:"get"})}function cn(e,t){return W({url:"/user/register/email",method:"post",data:{token:e,email:t}})}function dn(e,t,o,s,l){return W({url:"/user/register",method:"post",data:{username:e,password:t,email:o,key:s,nickname:l}})}function mn(e,t){return W({url:"/user/forget",method:"post",data:{token:e,username:t}})}function pn(e,t,o){return W({url:"/user/password/modify",method:"post",data:{username:e,password:t,key:o}})}const fn={class:"dida-login-footer"},_n=te({__name:"LoginView",setup(e){const{globalProperties:t}=re(),o=he(),s=m(!1),l=m({username:"",password:""}),i=()=>{ce(t,"重置成功")},_=({validateResult:x,firstError:k})=>{s.value||(s.value=!0,sn(l.value.username,l.value.password).then(g=>{if(g.code===0){o.loadResponse(g.data),ce(t,"登录成功");let d=t.$route.query.redirect_uri;d||(d="/user/"+g.data.username),t.$router.push({path:d})}else K(t,g.code)}).catch(g=>{console.error("Login error",g),oe(t,"登录失败")}).finally(()=>{s.value=!1}))};return ae(()=>{if(o.isLogin()){t.$router.push({path:"/user"});return}}),(x,k)=>{const g=ke,d=Te,r=F,v=Ie,w=Ke,C=se;return V(),q(C,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:n(()=>[a(v,{ref:"form",data:l.value,colon:!0,onReset:i,onSubmit:_,class:"yj-login-form","label-width":0},{default:n(()=>[a(d,{name:"username"},{default:n(()=>[a(g,{modelValue:l.value.username,"onUpdate:modelValue":k[0]||(k[0]=f=>l.value.username=f),clearable:"",placeholder:"请输入用户名"},{"prefix-icon":n(()=>[a(ue(Qt))]),_:1},8,["modelValue"])]),_:1}),a(d,{name:"password"},{default:n(()=>[a(g,{modelValue:l.value.password,"onUpdate:modelValue":k[1]||(k[1]=f=>l.value.password=f),type:"password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":n(()=>[a(ue(ea))]),_:1},8,["modelValue"])]),_:1}),a(d,null,{default:n(()=>[a(r,{theme:"primary",type:"submit",block:"",loading:s.value},{default:n(()=>k[4]||(k[4]=[P("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),D("div",fn,[a(w,{onClick:k[2]||(k[2]=()=>{ue(t).$router.push({name:"login-forget"})})},{default:n(()=>k[5]||(k[5]=[P("忘记密码")])),_:1}),a(w,{onClick:k[3]||(k[3]=()=>{ue(t).$router.push({name:"register"})})},{default:n(()=>k[6]||(k[6]=[P("注册账户")])),_:1})])]),_:1})}}}),gn=ee(_n,[["__scopeId","data-v-be6a0deb"]]),vn={class:"dida-login-footer"},bn=te({__name:"RegisterView",setup(e){const{globalProperties:t}=re(),o=he(),s=m(!1),l=m(!1),i=m(!1),_=m("发送验证码");let x=null,k=-1;const g=m(!1),d=m(null),r=m({username:"",password:"",confirmPassword:"",nickname:"",email:"",emailKey:""}),w=m({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:L=>new Promise(b=>{const j=setTimeout(()=>{b(r.value.password===L),clearTimeout(j)})}),message:"两次密码不一致"}],nickname:[{required:!0,message:"请填写昵称"},{min:1,message:"昵称至少1个字符"},{max:30,message:"昵称最多30个字符"}],email:[{required:!0,message:"请填写邮箱"},{pattern:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"邮箱格式不正确"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),C=m(()=>a(F,{onClick:f,disabled:i.value,loading:l.value,style:"width:120px"},{default:()=>[_.value]})),f=async()=>{var p;if(!r.value.email){oe(t,"请输入邮箱");return}if(!r.value.email.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)){oe(t,"邮箱格式不正确");return}if(i.value||l.value)return;g.value=!0,await ye();const L=document.getElementById("cf-confirm-div");L&&L.remove();const b=document.createElement("div");b.id="cf-confirm-div",b.setAttribute("data-theme","light"),(p=d.value)==null||p.appendChild(b);const j=window;j.turnstile.ready(function(){j.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(I){g.value=!1,await h(I)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},h=async L=>{if(!i.value){l.value=!0;try{const b=await cn(L,r.value.email);if(b.code!==0){K(t,b.code);return}ce(t,"发送验证码成功"),l.value=!1,i.value=!0,x=new Date,_.value="60秒后重发",k=setInterval(()=>{const p=Math.floor((new Date().getTime()-(x==null?void 0:x.getTime()))/1e3);p>60?(_.value="发送验证码",i.value=!1,clearInterval(k)):_.value=`${60-p}秒后重发`},1e3)}catch{oe(t,"发送验证码失败")}finally{l.value=!1}}},R=()=>{ce(t,"重置成功")},G=({validateResult:L,firstError:b,e:j})=>{if(!s.value){if(j.preventDefault(),L!==!0){oe(t,b);return}if(r.value.password!==r.value.confirmPassword){oe(t,"两次密码不一致");return}s.value=!0,dn(r.value.username,r.value.password,r.value.email,r.value.emailKey,r.value.nickname).then(p=>{p.code===0?(ce(t,"注册成功，可使用账号信息登录"),t.$router.push({name:"login"})):K(t,p.code)}).catch(p=>{console.error("Login error",p),oe(t,"登录失败")}).finally(()=>{s.value=!1})}};return ae(()=>{if(o.isLogin()){t.$router.push({path:"/user"});return}}),we(()=>{clearInterval(k)}),(L,b)=>{const j=ke,p=Te,I=It,z=F,S=Ie,c=Ke,u=se,y=Ge;return V(),J(Z,null,[a(u,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:n(()=>[a(S,{ref:"form",rules:w.value,data:r.value,colon:!0,onReset:R,onSubmit:G,class:"yj-login-form"},{default:n(()=>[a(p,{name:"username",label:"用户名"},{default:n(()=>[a(j,{modelValue:r.value.username,"onUpdate:modelValue":b[0]||(b[0]=T=>r.value.username=T),clearable:"",placeholder:"用于登录与查找"},null,8,["modelValue"])]),_:1}),a(p,{name:"password",label:"密码"},{default:n(()=>[a(j,{modelValue:r.value.password,"onUpdate:modelValue":b[1]||(b[1]=T=>r.value.password=T),type:"password",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),a(p,{name:"confirmPassword",label:"确认密码"},{default:n(()=>[a(j,{modelValue:r.value.confirmPassword,"onUpdate:modelValue":b[2]||(b[2]=T=>r.value.confirmPassword=T),type:"password",clearable:"",placeholder:"请确认密码"},null,8,["modelValue"])]),_:1}),a(p,{name:"nickname",label:"昵称"},{default:n(()=>[a(j,{modelValue:r.value.nickname,"onUpdate:modelValue":b[3]||(b[3]=T=>r.value.nickname=T),clearable:"",placeholder:"用于优先在网站各处展示"},null,8,["modelValue"])]),_:1}),a(p,{name:"email",label:"邮箱"},{default:n(()=>[a(j,{modelValue:r.value.email,"onUpdate:modelValue":b[4]||(b[4]=T=>r.value.email=T),clearable:"",placeholder:"请填写常用邮箱"},null,8,["modelValue"])]),_:1}),a(p,{name:"emailKey",label:"验证码"},{default:n(()=>[a(I,{append:C.value},{default:n(()=>[a(j,{modelValue:r.value.emailKey,"onUpdate:modelValue":b[5]||(b[5]=T=>r.value.emailKey=T),clearable:"",placeholder:"请输入验证码",style:{width:"140px"}},null,8,["modelValue"])]),_:1},8,["append"])]),_:1}),a(p,null,{default:n(()=>[a(z,{theme:"primary",type:"submit",block:"",loading:s.value},{default:n(()=>b[8]||(b[8]=[P("注册")])),_:1},8,["loading"])]),_:1})]),_:1},8,["rules","data"]),D("div",vn,[a(c,{onClick:b[6]||(b[6]=()=>{ue(t).$router.push({name:"login"})})},{default:n(()=>b[9]||(b[9]=[P("返回登陆 ")])),_:1})])]),_:1}),a(y,{visible:g.value,"onUpdate:visible":b[7]||(b[7]=T=>g.value=T),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:n(()=>[D("div",{ref_key:"dialogContainer",ref:d,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),hn=ee(bn,[["__scopeId","data-v-9b5f4fc7"]]),yn={style:{margin:"12px"}},wn=te({__name:"UserView",setup(e){let t=me();const{globalProperties:o}=re(),s=Le();let l="";const i=m(!1),_=m(null),x=m([]),k=async g=>{i.value=!0;try{let d=await un(g);if(d.code!==0){i.value=!1,K(o,d.code),await O.push({name:"home"});return}_.value=ln(d.data.user),x.value=d.data.problems_ac,s.setTitle(_.value.nickname+" - "+s.getTitle)}catch{oe(o,"获取用户信息失败"),await O.push({name:"home"})}finally{i.value=!1}};return ta(async(g,d,r)=>{if(Array.isArray(g.params.username)?l=g.params.username[0]:l=g.params.username,!l){await O.push({name:"home"});return}await k(l),r()}),ae(async()=>{if(Array.isArray(t.params.username)?l=t.params.username[0]:l=t.params.username,!l){await O.push({name:"home"});return}await k(l)}),(g,d)=>{const r=F,v=pe,w=se,C=ge,f=va,h=De,R=$e,G=ve,L=_e;return V(),q(L,{loading:i.value},{default:n(()=>[a(G,{class:"dida-main-content"},{default:n(()=>[a(C,{span:8},{default:n(()=>[a(w,{style:{margin:"10px"},title:"AC题目"},{default:n(()=>[a(v,{style:{"flex-wrap":"wrap"}},{default:n(()=>[(V(!0),J(Z,null,de(x.value,b=>(V(),q(r,{key:b,size:"small",onClick:()=>ue(O).push({name:"problem-detail",params:{problemId:b}})},{default:n(()=>[P(E(b),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1}),a(C,{span:4},{default:n(()=>[D("div",yn,[a(R,{layout:"vertical",bordered:!0},{default:n(()=>[a(h,{label:"头像"},{default:n(()=>{var b;return[a(f,{shape:"round",size:"100px",image:(b=_.value)==null?void 0:b.avatar,"hide-on-load-failed":!1},null,8,["image"])]}),_:1}),a(h,{label:"昵称"},{default:n(()=>{var b;return[P(E((b=_.value)==null?void 0:b.nickname),1)]}),_:1}),a(h,{label:"Slogan"},{default:n(()=>{var b;return[P(E((b=_.value)==null?void 0:b.slogan),1)]}),_:1}),a(h,{label:"邮箱"},{default:n(()=>{var b;return[P(E((b=_.value)==null?void 0:b.email),1)]}),_:1}),a(h,{label:"组织"},{default:n(()=>{var b;return[P(E((b=_.value)==null?void 0:b.organization),1)]}),_:1}),a(h,{label:"通过数量"},{default:n(()=>{var b;return[P(E((b=_.value)==null?void 0:b.accept),1)]}),_:1}),a(h,{label:"提交数量"},{default:n(()=>{var b;return[P(E((b=_.value)==null?void 0:b.attempt),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),kn=ee(wn,[["__scopeId","data-v-7d1db43a"]]),dt=[{name:"home",path:"/",title:"首页",showSidebar:!1,disableGenerateTab:!0,component:Za},{name:"problem",path:"/problem",title:"题目",icon:"calculation",showSidebar:!0,redirect:"problem-list"},{name:"judge",path:"/judge",title:"评测",icon:"code",showSidebar:!0,redirect:"judge-list"},{name:"contest",path:"/contest",title:"比赛",icon:"application",showSidebar:!0,redirect:"contest-list"},{name:"contest-detail-tab",title:"比赛",path:"/contest",showSidebar:!0,disableGenerateTab:!0,redirect:"contest-list"},{name:"discuss",title:"讨论",path:"/discuss",icon:"sonic",showSidebar:!0,redirect:"discuss-list"},{name:"rank",path:"/rank",title:"排名",icon:"chart-column",showSidebar:!0,redirect:"rank-ac-all"},{name:"tool",path:"/tool",title:"工具",icon:"tools",showSidebar:!0,redirect:"tool-paste"},{name:"system",path:"/system",title:"系统",icon:"dashboard",showSidebar:!0,redirect:"system-status"},{name:"manage",path:"/manage",title:"管理",icon:"command",showSidebar:!0,redirect:"manage-judge",auths:[ze.Manage]},{name:"login",path:"/login",title:"登陆",showSidebar:!1,disableGenerateTab:!0,component:gn},{name:"register",path:"/register",title:"注册",showSidebar:!1,disableGenerateTab:!0,component:hn},{name:"user",path:"/user/:username+",title:"用户",showSidebar:!1,needLogin:!0,disableGenerateTab:!0,component:kn},{name:"404",path:"/404",title:"404",showSidebar:!1,disableGenerateTab:!0,component:Rt}],Sn=e=>dt.find(t=>t.name==e),Cn=e=>{const t=[];return dt.forEach(o=>{!o.disableGenerateTab&&e.hasAllAuths(o.auths)&&t.push(o)}),t},Pn=e=>{dt.forEach(t=>{const o={name:t.name,path:t.path,meta:{title:t.title,tab:t.name,showSidebar:t.showSidebar,needLogin:t.needLogin,redirect:t.redirect,tabAuths:t.auths},component:t.component};e.push(o)})};function Ut(e){return e.children!==void 0}function In(e){return e.children!==void 0}var Et=(e=>(e[e.Unknown=-1]="Unknown",e[e.C=0]="C",e[e.Cpp=1]="Cpp",e[e.Java=2]="Java",e[e.Python=3]="Python",e[e.Pascal=4]="Pascal",e[e.Golang=5]="Golang",e[e.Max=6]="Max",e))(Et||{});function qt(){const e=[-1,5,6];return Object.values(Et).filter(t=>typeof t=="number"&&!e.includes(t)).map(t=>({value:t,label:Mt(t)}))}function Tn(e){return e>-1&&e<6}function Mt(e){switch(e){case 0:return"C";case 1:return"C++";case 2:return"Java";case 3:return"Python";case 4:return"Pascal";case 5:return"Golang";default:return"Unknown"}}function mt(e){switch(e){case 0:return"c";case 1:return"cpp";case 2:return"java";case 3:return"python";case 4:return"pascal";case 5:return"golang";default:return"text"}}var be=(e=>(e[e.Init=0]="Init",e[e.Rejudge=1]="Rejudge",e[e.Submitting=2]="Submitting",e[e.Queuing=3]="Queuing",e[e.Compiling=4]="Compiling",e[e.Running=5]="Running",e[e.Accept=6]="Accept",e[e.PE=7]="PE",e[e.WA=8]="WA",e[e.TLE=9]="TLE",e[e.MLE=10]="MLE",e[e.OLE=11]="OLE",e[e.RE=12]="RE",e[e.CE=13]="CE",e[e.CLE=14]="CLE",e[e.JudgeFail=15]="JudgeFail",e[e.SubmitFail=16]="SubmitFail",e[e.Unknown=17]="Unknown",e))(be||{});const xn=e=>{switch(e){case 0:return"普通评测";case 1:return"特殊评测";default:return"未知"}},Xe=e=>{switch(e){case 0:return"等待处理";case 1:return"重新评测";case 2:return"提交中";case 3:return"队列中";case 4:return"编译中";case 5:return"运行中";case 6:return"通过";case 7:return"格式错误";case 8:return"答案错误";case 9:return"超时";case 10:return"内存超限";case 11:return"输出超限";case 12:return"运行错误";case 13:return"编译错误";case 14:return"编译超限";case 15:return"评测失败";case 16:return"提交失败";case 17:return"未知";default:return e}},Ft=e=>{switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return"default";case 6:return"success";case 7:return"warning";default:return"danger"}};function Ln(){const e=[17];return Object.values(be).filter(t=>typeof t=="number"&&!e.includes(t)).map(t=>({value:t,label:Xe(t)}))}function Re(e){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return!0;default:return!1}}function Kt(e){var o;const t={};if(t.id=e.id,t.problemId=e.problem_id,t.status=e.status,Re(e.status)?t.score="-":t.score=e.score.toString(),e.time?t.time=Math.ceil(e.time/1e6)+"ms":t.time="-",e.memory?t.memory=(e.memory/1024/1024).toFixed(2)+"MB":t.memory="-",t.language=Mt(e.language),t.codeLength=e.code_length,e.approve_time?t.approveTime=new Date(e.approve_time).toLocaleString():t.approveTime="-",t.author=e.author,t.authorUsername=e.author_username,t.authorNickname=e.author_nickname,t.code=e.code,t.compileMessage=e.compile_message,t.taskCurrent=e.task_current,t.taskTotal=e.task_total,t.task=[],e.task)for(let s=0;s<((o=e.task)==null?void 0:o.length);s++){const l=e.task[s],i={};i.taskId=l.task_id,i.status=l.status,l.time?i.time=Math.ceil(l.time/1e6)+"ms":i.time="-",l.memory?i.memory=(l.memory/1024/1024).toFixed(2)+"MB":i.memory="-",i.score=l.score,i.content=l.content,i.waHint=l.wa_hint,!i.content&&!i.waHint&&(i.content="无提示信息"),t.task.push(i)}return e.judger&&(t.judger=e.judger),e.judge_time&&(t.judgeTime=new Date(e.judge_time).toLocaleString()),t}function jn(e,t,o,s,l){return W({url:"/judge/approve",method:"post",data:{problem_id:e,contest_id:t,problem_index:o,language:s,code:l}})}function zn(e){return W({url:"/judge?id="+e,method:"get"})}function Vn(e){return W({url:"/judge/code?id="+e,method:"get"})}function $n(e,t,o,s,l,i){const _=new URLSearchParams({problem_id:e,username:t,language:String(o),status:String(s),page:String(l),page_size:String(i)});return W({url:`/judge/list?${_.toString()}`,method:"get"})}function Dn(){return W({url:"/judge/rejudge/recently",method:"post"})}function Rn(e){return W({url:"/judge/rejudge/problem",method:"post",data:{id:e}})}function An(){return W({url:"/judge/rejudge/all",method:"post",timeout:0})}function Un(e){return W({url:"/judge/rejudge",method:"post",data:{id:Number(e)}})}var it=(e=>(e[e.None=0]="None",e[e.Attempt=1]="Attempt",e[e.Accept=2]="Accept",e))(it||{});function Qe(e,t){const o={};if(o.id=e.id,o.author=e.author,o.title=e.title,o.tags=[],e.tags)for(const s of e.tags){const l=t[s];l&&o.tags.push(l)}return o.accept=e.accept,o.attempt=e.attempt,e.description!=null&&(o.description=e.description),e.time_limit!=null&&(o.timeLimit=e.time_limit.toString()+" ms"),e.memory_limit!=null&&(o.memoryLimit=(e.memory_limit/1024).toFixed(2)+" MB"),e.judge_type!=null&&(o.judgeType=xn(e.judge_type)),e.insert_time!=null&&(o.insertTime=new Date(e.insert_time).toLocaleString()),e.update_time!=null&&(o.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(o.creatorNickname=e.creator_nickname),e.source!=null&&(o.source=e.source),e.judge_md5!=null&&(o.judgeMd5=e.judge_md5),o}function Gt(e,t,o){const s={};return e?s.id=e:(s.contest_id=t,s.problem_index=o),W({url:`/problem?${new URLSearchParams(s).toString()}`,method:"get"})}function Ht(e){return W({url:"/problem/tag/list?max_count="+e,method:"get"})}function En(e){return W({url:"/problem/judge?id="+e,method:"get"})}function qn(e,t,o,s){const l={};return e&&(l.title=e),t&&(l.tag=t),o&&(l.page=o),s&&(l.page_size=s),W({url:`/problem/list?${new URLSearchParams(l).toString()}`,method:"get"})}function Mn(e,t,o,s,l,i,_){return W({url:"/problem/edit",method:"post",data:{id:e,title:t,time_limit:o,memory_limit:s,source:l,tags:i,description:_}})}function Fn(e,t){return W({url:"/problem/judge/data/download?id="+e+"&key="+t,method:"get"})}function Kn(e,t){const o=new FormData;return o.append("id",e),o.append("zip",t),W({url:"/problem/judge/data",method:"post",data:o,headers:{"Content-Type":"multipart/form-data"},timeout:1e3*60*5})}const Gn={style:{margin:"10px"}};function Hn(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ue(e)}const On=te({__name:"ProblemList",setup(e){const t=me(),o=Ee(),{globalProperties:s}=re();let l=null;const i=m(!1),_={};let x={};const k=m([{title:"ID",colKey:"id",cell:(p,I)=>{let z=R(I.row.id);return a(F,{variant:"dashed",theme:z,onClick:()=>h(I.row.id)},{default:()=>[I.row.id]})}},{title:"标题",colKey:"title",cell:(p,I)=>a(F,{variant:"text",onClick:()=>h(I.row.id)},{default:()=>[I.row.title]})},{title:"标签",colKey:"tags",cell:(p,I)=>{const z=I.row.tags;if(!z||z.length===0)return"";let S=[];for(let c=0;c<z.length;c++){const u=z[c];S.push(a(F,{key:c,theme:"default",variant:"outline",size:"small",onClick:()=>L(u)},{default:()=>[u.name]}))}return a(pe,null,Hn(S)?S:{default:()=>[S]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),g=m(!1);let d=1,r=50;const v=m({current:d,pageSize:r,defaultCurrent:d,defaultPageSize:r,total:0,pageSizeOptions:[50,100]}),w=m(),C=m(),f=m({title:"",tag:""}),h=p=>{p&&o.push({path:"/problem/"+p})},R=p=>{if(!p||!x)return"default";const I=x[p];if(!I)return"default";switch(I){case it.Accept:return"success";case it.Attempt:return"warning";default:return"default"}},G=async()=>{await o.push({query:{...t.query,title:f.value.title,tag:f.value.tag,page:1,page_size:v.value.defaultPageSize}})},L=p=>{p&&o.push({query:{...t.query,title:"",tag:p.name,page:1,page_size:v.value.defaultPageSize}})},b=async(p,I)=>{g.value=!0;try{const{current:z,pageSize:S}=p,c=await qn(f.value.title,f.value.tag,z,S);if(w.value=[],c.code===0){const u=c.data.list;if(!u||u.length<=0){v.value={...v.value,total:0},x=null,ce(s,"未找到记录");return}u.forEach(y=>{var $;const T=Qe(y,_);($=w.value)==null||$.push(T)}),v.value={...v.value,total:c.data.total_count},x=c.data.problem_attempt_status}else I&&K(s,c.code)}catch(z){console.error(z),K(s,Pe())}finally{g.value=!1}},j=async p=>{await o.push({query:{...t.query,page:p.current,page_size:p.pageSize}})};return ae(async()=>{g.value=!0,C.value=[],Ht(-1).then(p=>{if(p.code===0){C.value=p.data.list,i.value=p.data.total_count>p.data.list.length;for(let I=0;I<p.data.list.length;I++){const z=p.data.list[I];_[z.id]=z}l=Ve(()=>t.query,I=>{f.value.title=I.title||"",f.value.tag=I.tag||"";const z=parseInt(I.page)||v.value.defaultCurrent,S=parseInt(I.page_size)||v.value.defaultPageSize;d=z,r=S,v.value={...v.value,current:d,pageSize:r},b({current:d,pageSize:r},!0)},{immediate:!0})}else i.value=!0}).catch(p=>{console.error(p),i.value=!0})}),we(()=>{l&&l()}),(p,I)=>{const z=xe,S=se,c=ge,u=ke,y=Te,T=F,$=Ie,U=ve;return V(),q(U,null,{default:n(()=>[a(c,{span:9},{default:n(()=>[a(S,{style:{margin:"10px"}},{default:n(()=>[a(z,{data:w.value,columns:k.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:v.value,loading:g.value,onPageChange:j},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),a(c,{span:3},{default:n(()=>[D("div",Gn,[a(S,{class:"sh-card"},{default:n(()=>[a($,{model:f.value,onSubmit:G},{default:n(()=>[a(y,{label:"标题"},{default:n(()=>[a(u,{modelValue:f.value.title,"onUpdate:modelValue":I[0]||(I[0]=A=>f.value.title=A),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),a(y,{label:"标签"},{default:n(()=>[a(u,{modelValue:f.value.tag,"onUpdate:modelValue":I[1]||(I[1]=A=>f.value.tag=A),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),a(y,null,{default:n(()=>[a(T,{theme:"primary",type:"submit"},{default:n(()=>I[3]||(I[3]=[P("搜索")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(S,{class:"sh-card sh-background-black"},{default:n(()=>[(V(!0),J(Z,null,de(C.value,A=>(V(),q(T,{class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:()=>L(A)},{default:n(()=>[P(E(A.name),1)]),_:2},1032,["onClick"]))),256)),i.value?(V(),q(T,{key:0,class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:I[2]||(I[2]=()=>p.$router.push("/problem/tags"))},{default:n(()=>I[4]||(I[4]=[P(" ... ")])),_:1})):ie("",!0)]),_:1})])]),_:1})]),_:1})}}}),Nn=ee(On,[["__scopeId","data-v-e3a0978e"]]);function Ae(e){e.querySelectorAll("pre > code:not([data-copy-attached])").forEach(o=>{o.setAttribute("data-copy-attached","true");const s=o.parentElement,l=document.createElement("div");l.className="copy-wrapper";const i=document.createElement("button");i.className="copy-btn",i.innerText="复制",i.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(o.innerText),i.innerText="已复制",setTimeout(()=>i.innerText="复制",1500)}catch{i.innerText="失败"}}),s.replaceWith(l),l.appendChild(i),l.appendChild(s)})}function et(e){let t="";for(;e>0;)e--,t=String.fromCharCode(65+e%26)+t,e=Math.floor(e/26);return t}async function Ot(e){const t={};if(t.id=e.id,t.ownerId=e.owner_id,t.ownerUsername=e.owner_username,t.ownerNickname=e.owner_nickname,t.title=e.title,t.startTime=new Date(e.start_time).toLocaleString(),t.endTime=new Date(e.end_time).toLocaleString(),e.descriptions){t.descriptions=[];const o={math:{inlineDigit:!0,engine:"KaTeX"}};for(let s=0;s<e.descriptions.length;s++){const l=e.descriptions[s],i={};i.title=l.title,i.content=await le.md2html(l.content,o),i.sort=l.sort,t.descriptions.push(i)}}if(t.notification=e.notification,e.problems){t.problems=[],e.problems.sort((o,s)=>o.index-s.index);for(let o=0;o<e.problems.length;o++){const s=e.problems[o];s.accept||(s.accept=0),s.attempt||(s.attempt=0),s.id=et(s.index),t.problems.push(s)}}return t}function Bn(e){return W({url:"/contest?id="+e,method:"get"})}function Jn(e,t){return W({url:"/contest/list?page="+e+"&page_size="+t,method:"get"})}function Wn(e){return W({url:"/contest/create",method:"post",data:e})}const Xn=["innerHTML"],Yn={style:{margin:"12px"}},Zn={key:0,class:"dida-edit-container"},Qn={class:"dida-operation-container"},eo={class:"dida-code-submit-div"},to=te({__name:"ProblemDetail",setup(e){let t=me();const{globalProperties:o}=re(),s=Le(),l=he();let i=m(""),_="",x=0,k=0;const g=m(null),d=m(!1),r=m(null);let v=null;const w=m(null),C={},f=m(""),h=m([]);h.value=qt();const R=je(()=>l.hasAuth(ze.ManageProblem)),G=S=>{S&&O.push({name:"problem-list",query:{...t.query,title:"",tag:S.name}})},L=()=>{O.push({name:"manage-problem",params:{problemId:_}})},b=()=>{_?O.push({name:"judge-list",query:{problem_id:_}}):O.push({name:"contest-judge-list",params:{contestId:x,problemIndex:k}})},j=()=>{_?O.push({name:"discuss-list-problem",query:{problem_id:_}}):O.push({name:"contest-discuss",params:{contestId:x},query:{problem_id:et(k)}})},p=()=>{O.push({name:"problem-recommend",params:{problemId:_}})},I=async()=>{if(!_){oe(o,"问题ID无效");return}const S=parseInt(f.value);if(!Tn(S)){oe(o,"请选择所编写的语言");return}const c=v==null?void 0:v.getValue();if(!c){oe(o,"请输入所需提交的代码");return}const u=await jn(_,x,k,S,c);if(u.code!==0){K(o,u.code);return}ce(o,"提交成功，正在跳转到详情页面");const y=u.data.id;await O.push({path:"/judge/"+y})},z=S=>{v&&vt.setModelLanguage(v.getModel(),mt(S))};return ae(async()=>{if(Array.isArray(t.params.problemId)?_=t.params.problemId[0]:_=t.params.problemId,!_){if(Array.isArray(t.params.contestId)?x=t.params.contestId[0]:x=t.params.contestId,!x){oe(o,"题目不存在"),await O.push({name:"problem"});return}if(Array.isArray(t.params.problemIndex)?k=parseInt(t.params.problemIndex[0]):k=parseInt(t.params.problemIndex),!k){oe(o,"题目不存在"),await O.push({name:"problem"});return}}d.value=!0;let S=await Gt(_,x,k);if(S.code!==0){d.value=!1,K(o,S.code),await O.push({name:"problem"});return}S.data.tags&&S.data.tags.forEach(y=>{C[y.id]=y}),r.value=Qe(S.data.problem,C),s.setTitle(r.value.title+" - "+s.getTitle);let c=r.value.description;const u={math:{inlineDigit:!0,engine:"KaTeX"}};i.value=await le.md2html(c,u),await ye(()=>{g.value&&(le.mathRender(g.value),le.highlightRender({lineNumber:!0,enable:!0},g.value),Ae(g.value),w.value&&(v=vt.create(w.value,{value:"",language:"cpp",minimap:{enabled:!0},colorDecorators:!0,readOnly:!1,theme:"vs-dark"}))),d.value=!1})}),(S,c)=>{const u=se,y=ge,T=F,$=De,U=pe,A=$e,Y=xt,B=Tt,N=ve,X=_e;return V(),q(X,{loading:d.value},{default:n(()=>[a(N,{class:"dida-main-content"},{default:n(()=>[a(y,{span:8},{default:n(()=>[a(u,{style:{margin:"10px"}},{default:n(()=>[D("div",{innerHTML:ue(i),ref_key:"markdownRef",ref:g},null,8,Xn)]),_:1})]),_:1}),a(y,{span:4},{default:n(()=>[D("div",Yn,[R.value?(V(),J("div",Zn,[a(T,{onClick:L},{default:n(()=>c[1]||(c[1]=[P("编辑")])),_:1})])):ie("",!0),a(A,{layout:"vertical",bordered:!0},{default:n(()=>[a($,{label:"标题"},{default:n(()=>{var M;return[P(E((M=r.value)==null?void 0:M.title),1)]}),_:1}),a($,{label:"时间限制"},{default:n(()=>{var M;return[P(E((M=r.value)==null?void 0:M.timeLimit),1)]}),_:1}),a($,{label:"内存限制"},{default:n(()=>{var M;return[P(E((M=r.value)==null?void 0:M.memoryLimit),1)]}),_:1}),a($,{label:"判题方式"},{default:n(()=>{var M;return[P(E((M=r.value)==null?void 0:M.judgeType),1)]}),_:1}),a($,{label:"正确提交"},{default:n(()=>{var M;return[P(E((M=r.value)==null?void 0:M.accept),1)]}),_:1}),a($,{label:"提交总数"},{default:n(()=>{var M;return[P(E((M=r.value)==null?void 0:M.attempt),1)]}),_:1}),a($,{label:"创建时间"},{default:n(()=>{var M;return[P(E((M=r.value)==null?void 0:M.insertTime),1)]}),_:1}),a($,{label:"更新时间"},{default:n(()=>{var M;return[P(E((M=r.value)==null?void 0:M.updateTime),1)]}),_:1}),a($,{label:"上传用户"},{default:n(()=>{var M;return[P(E((M=r.value)==null?void 0:M.creatorNickname),1)]}),_:1}),a($,{label:"题目来源"},{default:n(()=>{var M;return[P(E((M=r.value)==null?void 0:M.source),1)]}),_:1}),ue(_)?(V(),q($,{key:0,label:"标签"},{default:n(()=>[a(U,null,{default:n(()=>{var M;return[(V(!0),J(Z,null,de((M=r.value)==null?void 0:M.tags,Q=>(V(),q(T,{key:Q.id,variant:"dashed",onClick:()=>G(Q)},{default:n(()=>[P(E(Q.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})):ie("",!0)]),_:1}),D("div",Qn,[a(U,null,{default:n(()=>[a(T,{onClick:b},{default:n(()=>c[2]||(c[2]=[P("提交记录")])),_:1}),a(T,{onClick:j},{default:n(()=>c[3]||(c[3]=[P("题目讨论")])),_:1}),ue(_)?(V(),q(T,{key:0,onClick:p},{default:n(()=>c[4]||(c[4]=[P("题目推荐")])),_:1})):ie("",!0)]),_:1})]),D("div",eo,[a(U,null,{default:n(()=>[a(B,{modelValue:f.value,"onUpdate:modelValue":c[0]||(c[0]=M=>f.value=M),label:"语言：",placeholder:"请选择提交语言","auto-width":"",clearable:"",onChange:z},{default:n(()=>[(V(!0),J(Z,null,de(h.value,M=>(V(),q(Y,{key:M.value,value:M.value,label:M.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),a(T,{onClick:I},{default:n(()=>c[5]||(c[5]=[P("提交")])),_:1})]),_:1}),D("div",{ref_key:"codeEditRef",ref:w,class:"dida-code-editor"},null,512)])])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),bt=ee(to,[["__scopeId","data-v-2307df15"]]),ao={};function no(e,t){return" TODO "}const oo=ee(ao,[["render",no]]),lo=["innerHTML"];function so(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ue(e)}const ro=te({__name:"JudgeJobList",setup(e){const t=me(),o=Ee(),{globalProperties:s}=re();let l=!1,i=null;const _=m(!1),x=m(null),k=m(null),g=m(!1),d=m({problemId:"",username:"",language:void 0,status:void 0}),r=m([{title:"ID",colKey:"id",cell:(u,y)=>a(F,{variant:"text",onClick:()=>j(y.row.id)},{default:()=>[y.row.id]})},{title:"问题",colKey:"problemId",cell:(u,y)=>a(F,{variant:"text",onClick:()=>b(y.row.problemId)},{default:()=>[y.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(u,y)=>{const T=y.row.status,$=Xe(T),U=Ft(T);let A=[];return Re(T)&&A.push(a(_e,{text:y.row.state,size:"small",class:"dida-status-loading"},null)),A.push(a("span",null,[$])),a(F,{theme:U,variant:"outline",onClick:()=>j(y.row.id)},so(A)?A:{default:()=>[A]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"code",cell:(u,y)=>a(F,{theme:"default",onClick:()=>L(y.row)},{default:()=>[y.row.language+" / "+y.row.codeLength]})},{title:"作者",colKey:"author",width:200,cell:(u,y)=>a(F,{variant:"text",onClick:()=>p(y.row.authorUsername)},{default:()=>[y.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),v=m(!1);let w=1,C=50;const f=m({current:w,pageSize:C,defaultCurrent:w,defaultPageSize:C,total:0,pageSizeOptions:[50,100]}),h=m(),R=m([]);R.value=qt();const G=m([]);G.value=Ln();const L=async u=>{g.value=!0,_.value=!0;try{x.value=u;const y=await Vn(x.value.id);if(y.code===0){const T=y.data,U=`\`\`\`${mt(T.language)}
${T.code}
\`\`\``,A={};x.value.code=await le.md2html(U,A),await ye(()=>{k.value&&(le.highlightRender({lineNumber:!0,enable:!0},k.value),Ae(k.value))})}else K(s,y.code)}finally{g.value=!1}},b=u=>{u&&o.push({path:"/problem/"+u})},j=u=>{u&&o.push({name:"judge-detail",params:{judgeId:u}})},p=u=>{u&&o.push({path:"/user/"+u})},I=async()=>{await o.push({query:{...t.query,page:1,page_size:C,problem_id:d.value.problemId,username:d.value.username,language:d.value.language,status:d.value.status}})},z=async()=>{d.value.problemId="",d.value.username="",d.value.language=void 0,d.value.status=void 0,await o.push({query:{...t.query,page:1,page_size:C,problem_id:"",username:"",language:void 0,status:void 0}})},S=async(u,y)=>{y&&(v.value=!0);let T=!1;try{const{current:$,pageSize:U}=u,A=await $n(d.value.problemId,d.value.username,d.value.language,d.value.status,$,U);h.value=[],A.code===0?A.data.list&&A.data.list.length>0?(A.data.list.forEach(B=>{var X;const N=Kt(B);(X=h.value)==null||X.push(N),Re(B.status)&&(T=!0)}),f.value={...f.value,total:A.data.total_count}):(ce(s,"未找到记录"),f.value={...f.value,total:0}):y&&K(s,A.code)}catch($){console.error($),y&&K(s,Pe())}finally{y&&(v.value=!1),T&&l&&setTimeout(()=>{S({current:w,pageSize:C},!1)},5e3)}},c=async u=>{await o.push({query:{...t.query,page:u.current,page_size:u.pageSize}})};return ae(async()=>{l=!0,i=Ve(()=>t.query,u=>{d.value.problemId=u.problem_id||"",d.value.username=u.username||"",u.language!=null?d.value.language=Number(u.language):d.value.language=void 0,u.status!=null?d.value.status=Number(u.status):d.value.status=void 0;const y=parseInt(u.page)||f.value.defaultCurrent,T=parseInt(u.page_size)||f.value.defaultPageSize;w=y,C=T,f.value.pageSizeOptions.includes(C)||(C=f.value.defaultPageSize),f.value={...f.value,current:w,pageSize:C},S({current:w,pageSize:C},!0)},{immediate:!0})}),we(()=>{l=!1,i&&i()}),(u,y)=>{const T=ke,$=Te,U=xt,A=Tt,Y=F,B=pe,N=Ie,X=xe,M=se,Q=Ke,ne=_e,fe=Ge;return V(),J(Z,null,[a(M,{style:{margin:"10px"}},{default:n(()=>[a(N,{layout:"inline",onSubmit:I,onReset:z},{default:n(()=>[a($,{label:"题号"},{default:n(()=>[a(T,{modelValue:d.value.problemId,"onUpdate:modelValue":y[0]||(y[0]=H=>d.value.problemId=H),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),a($,{label:"用户"},{default:n(()=>[a(T,{modelValue:d.value.username,"onUpdate:modelValue":y[1]||(y[1]=H=>d.value.username=H),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),a($,{label:"语言"},{default:n(()=>[a(A,{modelValue:d.value.language,"onUpdate:modelValue":y[2]||(y[2]=H=>d.value.language=H),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:n(()=>[(V(!0),J(Z,null,de(R.value,H=>(V(),q(U,{key:H.value,value:H.value,label:H.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a($,{label:"状态"},{default:n(()=>[a(A,{modelValue:d.value.status,"onUpdate:modelValue":y[3]||(y[3]=H=>d.value.status=H),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:n(()=>[(V(!0),J(Z,null,de(G.value,H=>(V(),q(U,{key:H.value,value:H.value,label:H.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a($,null,{default:n(()=>[a(B,null,{default:n(()=>[a(Y,{theme:"primary",type:"submit"},{default:n(()=>y[7]||(y[7]=[P("搜索")])),_:1}),a(Y,{theme:"default",variant:"base",type:"reset"},{default:n(()=>y[8]||(y[8]=[P("重置")])),_:1})]),_:1})]),_:1})]),_:1}),a(X,{data:h.value,columns:r.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:f.value,loading:v.value,onPageChange:c,"table-layout":"auto"},null,8,["data","columns","pagination","loading"])]),_:1}),a(fe,{visible:_.value,"onUpdate:visible":y[5]||(y[5]=H=>_.value=H),width:"800px","cancel-btn":null,"close-btn":!1,onConfirm:y[6]||(y[6]=H=>_.value=!1)},{header:n(()=>[a(Q,{onClick:y[4]||(y[4]=()=>{var H;j((H=x.value)==null?void 0:H.id)})},{default:n(()=>{var H,Se;return[P(E(((H=x.value)==null?void 0:H.id)+" - "+((Se=x.value)==null?void 0:Se.language)),1)]}),_:1})]),default:n(()=>[a(ne,{loading:g.value},{default:n(()=>{var H;return[D("div",{innerHTML:(H=x.value)==null?void 0:H.code,ref_key:"markdownCodeRef",ref:k,style:{"min-height":"100px"}},null,8,lo)]}),_:1},8,["loading"])]),_:1},8,["visible"])],64)}}}),uo=ee(ro,[["__scopeId","data-v-c8e34db0"]]),io={class:"dida-code-container"},co=["innerHTML"],mo={key:2,class:"dida-edit-container"};function ht(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ue(e)}const po=te({__name:"JudgeJobDetail",setup(e){const t=me(),o=Ee(),s=he(),{globalProperties:l}=re();let i=!1,_=-1;const x=m(""),k=m(null),g=m(""),d=m(null),r=m(0),v=m(null),w=m({from:"#5a96ff",to:"#00A870"});let C=!1;const f=m([{title:"ID",colKey:"id"},{title:"问题",colKey:"problemId",cell:(c,u)=>a(F,{variant:"text",onClick:()=>j(u.row.problemId)},{default:()=>[u.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(c,u)=>{const y=u.row.status,T=Xe(y),$=Ft(y);let U=[];return Re(y)&&U.push(a(_e,{text:u.row.state,size:"small",class:"dida-status-loading"},null)),U.push(a("span",null,[T])),a(F,{theme:$,variant:"outline"},ht(U)?U:{default:()=>[U]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"language",cell:(c,u)=>a("span",null,[u.row.language+" / "+u.row.codeLength])},{title:"作者",colKey:"author",width:200,cell:(c,u)=>a(F,{variant:"text",onClick:()=>p(u.row.authorUsername)},{default:()=>[u.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),h=m(!1),R=m(!1),G=m(),L=je(()=>s.hasAuth(ze.ManageJudge)),b=async()=>{if(!R.value){R.value=!0;try{const c=await Un(_);c.code===0?await z(!0):K(l,c.code)}catch(c){console.error(c),K(l,Pe())}finally{R.value=!1}}},j=c=>{c&&o.push({path:"/problem/"+c})},p=c=>{c&&o.push({path:"/user/"+c})},I=c=>{const u=c.status,y=Xe(u);let T;switch(u){case be.Init:case be.Rejudge:case be.Compiling:case be.Running:T="default";break;case be.Accept:T="success";break;case be.PE:T="warning";break;default:T="danger";break}return a(pe,null,{default:()=>[a(F,{theme:"default",variant:"outline"},{default:()=>[c.taskId]}),a(F,{theme:T,variant:"outline"},ht(y)?y:{default:()=>[y]}),a("span",null,[P("分数："),c.score]),a("span",null,[P("用时："),c.time]),a("span",null,[P("内存："),c.memory])]})},z=async c=>{var y;c&&(h.value=!0);let u=!1;try{const T=await zn(_);if(G.value=[],T.code===0){const $=T.data,U=Kt($);if((y=G.value)==null||y.push(U),$.judger){const Y=await Dt($.judger);x.value=Y.name}else x.value="";w.value.to="#00A870",Re($.status)?(v.value="active",U.taskTotal>0?(r.value=U.taskCurrent/U.taskTotal*100,U.taskCurrent>=U.taskTotal&&(r.value=99)):r.value=0):(r.value=100,$.status===be.Accept?v.value="success":$.status===be.PE?(w.value.to="#F57C20",v.value="warning"):(w.value.to="#F56C6C",v.value="error"));const A={};if($.code){const B=`\`\`\`${mt($.language)}
${$.code}
\`\`\``;g.value=await le.md2html(B,A),await ye(()=>{d.value&&(C||(C=!0,le.highlightRender({lineNumber:!0,enable:!0},d.value)),Ae(d.value))})}k.value=U,Re($.status)&&(u=!0)}else c&&K(l,T.code)}catch(T){console.error(T),c&&K(l,Pe())}finally{c&&(h.value=!1),u&&i&&setTimeout(()=>{z(!1)},5e3)}};function S(){d.value&&d.value.parentElement&&(d.value.style.maxWidth=d.value.parentElement.clientWidth+"px")}return ae(async()=>{if(i=!0,Array.isArray(t.params.judgeId)?_=t.params.judgeId[0]:_=t.params.judgeId,!_){await o.push({name:"judge"});return}await z(!0),S(),window.addEventListener("resize",S)}),we(()=>{i=!1,window.removeEventListener("resize",S)}),(c,u)=>{var Q,ne;const y=ba,T=xe,$=se,U=ge,A=De,Y=$e,B=ve,N=Lt,X=jt,M=F;return V(),J(Z,null,[a(y,{color:w.value,status:v.value,class:"dida-job-progress",percentage:r.value},null,8,["color","status","percentage"]),a($,{style:{margin:"10px"}},{default:n(()=>[a(T,{data:G.value,columns:f.value,"row-key":"id","vertical-align":"top",hover:!0,loading:h.value},null,8,["data","columns","loading"])]),_:1}),a(B,null,{default:n(()=>[a(U,{span:8},{default:n(()=>[D("div",io,[D("div",{innerHTML:g.value,ref_key:"markdownCodeRef",ref:d,class:"dida-code-div"},null,8,co)])]),_:1}),a(U,{span:4},{default:n(()=>[a(Y,{layout:"vertical",bordered:!0,style:{margin:"10px"}},{default:n(()=>[a(A,{label:"判题机"},{default:n(()=>[P(E(x.value),1)]),_:1}),a(A,{label:"判题时间"},{default:n(()=>{var fe;return[P(E((fe=k.value)==null?void 0:fe.judgeTime),1)]}),_:1})]),_:1})]),_:1})]),_:1}),(Q=k.value)!=null&&Q.compileMessage?(V(),q($,{key:0,class:"compile-message"},{default:n(()=>{var fe;return[P(E((fe=k.value)==null?void 0:fe.compileMessage),1)]}),_:1})):ie("",!0),((ne=k.value)==null?void 0:ne.task.length)>0?(V(),q(X,{key:1,class:"task-panel"},{default:n(()=>{var fe;return[(V(!0),J(Z,null,de((fe=k.value)==null?void 0:fe.task,(H,Se)=>(V(),q(N,{key:H.taskId,header:()=>I(H)},{default:n(()=>[P(E(H.content)+" "+E(H.waHint),1)]),_:2},1032,["header"]))),128))]}),_:1})):ie("",!0),L.value?(V(),J("div",mo,[a(M,{onClick:b,loading:R.value},{default:n(()=>u[0]||(u[0]=[P("重新评测")])),_:1},8,["loading"])])):ie("",!0)],64)}}}),fo=ee(po,[["__scopeId","data-v-77553aaf"]]),_o={style:{margin:"10px"}},go=te({__name:"ContestList",setup(e){const t=me(),o=Ee(),{globalProperties:s}=re();let l=null;const i=m(!1),_=m(!1),x=m([{title:"ID",colKey:"id",width:"100",cell:(j,p)=>a(F,{variant:"text",onClick:()=>f(p.row.id)},{default:()=>[p.row.id]})},{title:"标题",colKey:"title",cell:(j,p)=>a(F,{variant:"text",onClick:()=>f(p.row.id)},{default:()=>[p.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),k=m(!1);let g=1,d=50;const r=m({current:g,pageSize:d,defaultCurrent:g,defaultPageSize:d,total:0,pageSizeOptions:[50,100]}),v=m(),w=m({title:"",username:""}),C=m({title:"",description:"",open_time:[]}),f=j=>{j&&o.push({path:"/contest/"+j})},h=async()=>{await o.push({query:{...t.query,title:w.value.title,username:w.value.username,page:1,page_size:r.value.defaultPageSize}})},R=async(j,p)=>{var I;k.value=!0;try{const{current:z,pageSize:S}=j,c=await Jn(z,S);if(v.value=[],c.code===0){const u=c.data.list;for(let y=0;y<u.length;y++){const T=u[y],$=await Ot(T);(I=v.value)==null||I.push($)}r.value={...r.value,total:c.data.total_count}}else p&&K(s,c.code)}catch(z){console.error(z),K(s,Pe())}finally{k.value=!1}},G=async j=>{await o.push({query:{...t.query,page:j.current,page_size:j.pageSize}})},L=()=>{i.value=!0},b=async()=>{_.value=!0,console.log("contestCreateForm",C.value),Wn(C.value).then(j=>{j.code===0?(ce(s,"创建比赛成功"),i.value=!1,o.push({path:"/contest/"+j.data.id})):K(s,j.code)}).finally(()=>{_.value=!1})};return ae(async()=>{l=Ve(()=>t.query,j=>{w.value.title=j.title||"",w.value.username=j.username||"";const p=parseInt(j.page)||r.value.defaultCurrent,I=parseInt(j.page_size)||r.value.defaultPageSize;g=p,d=I,r.value={...r.value,current:g,pageSize:d},R({current:g,pageSize:d},!0)},{immediate:!0})}),we(()=>{l&&l()}),(j,p)=>{const I=xe,z=se,S=ge,c=ke,u=Te,y=F,T=Ie,$=pe,U=ve,A=zt,Y=Ge;return V(),J(Z,null,[a(U,null,{default:n(()=>[a(S,{span:9},{default:n(()=>[a(z,{style:{margin:"10px"}},{default:n(()=>[a(I,{data:v.value,columns:x.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:r.value,loading:k.value,onPageChange:G},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),a(S,{span:3},{default:n(()=>[D("div",_o,[a(z,{class:"sh-card"},{default:n(()=>[a(T,{model:w.value},{default:n(()=>[a(u,{label:"标题"},{default:n(()=>[a(c,{modelValue:w.value.title,"onUpdate:modelValue":p[0]||(p[0]=B=>w.value.title=B),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),a(u,{label:"负责人"},{default:n(()=>[a(c,{modelValue:w.value.username,"onUpdate:modelValue":p[1]||(p[1]=B=>w.value.username=B),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),a(u,null,{default:n(()=>[a(y,{theme:"primary",onClick:h},{default:n(()=>p[6]||(p[6]=[P("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(z,{class:"sh-card"},{default:n(()=>[a($,null,{default:n(()=>[a(y,{onClick:L},{default:n(()=>p[7]||(p[7]=[P("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),a(Y,{visible:i.value,"onUpdate:visible":p[5]||(p[5]=B=>i.value=B),header:"创建比赛",onConfirm:b,"confirm-loading":_.value},{default:n(()=>[a(T,{"label-width":80,model:C.value,onSubmit:p[4]||(p[4]=Fe(()=>{},["prevent"]))},{default:n(()=>[a(u,{label:"标题"},{default:n(()=>[a(c,{modelValue:C.value.title,"onUpdate:modelValue":p[2]||(p[2]=B=>C.value.title=B),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),a(u,{label:"开启时间"},{default:n(()=>[a(A,{"enable-time-picker":"","allow-input":"",clearable:"",modelValue:C.value.open_time,"onUpdate:modelValue":p[3]||(p[3]=B=>C.value.open_time=B)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),qe=ee(go,[["__scopeId","data-v-3e6ea683"]]),vo={style:{margin:"20px"}},bo=["innerHTML"],ho={style:{margin:"12px"}},yo=te({__name:"ContestDetail",setup(e){let t=me();const{globalProperties:o}=re(),s=Le();let l=0;const i=m(!1),_=m(null),x=m([{title:"问题ID",colKey:"id",cell:(d,r)=>a(F,{variant:"text",onClick:()=>g(l,r.row.index)},{default:()=>[r.row.id]})},{title:"标题",colKey:"title",cell:(d,r)=>a(F,{variant:"text",onClick:()=>g(l,r.row.index)},{default:()=>[r.row.title]})},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),k=m([]),g=(d,r)=>{O.push({name:"contest-problem-detail",params:{contestId:d,problemIndex:r}})};return ae(async()=>{if(Array.isArray(t.params.contestId)?l=t.params.contestId[0]:l=t.params.contestId,!l){await O.push({name:"contest"});return}i.value=!0;const d=await Bn(l);if(d.code!==0){i.value=!1,K(o,d.code),await O.push({name:"contest"});return}_.value=await Ot(d.data),k.value=_.value.problems,s.setTitle(_.value.title+" - "+s.getTitle),await ye(()=>{const r=document.querySelectorAll(".dida-content-description");r&&r.length>0&&r.forEach(v=>{le.mathRender(v),le.highlightRender({lineNumber:!0,enable:!0},v),Ae(v)}),i.value=!1})}),(d,r)=>{const v=ct,w=F,C=pe,f=Lt,h=jt,R=xe,G=se,L=ge,b=De,j=$e,p=ve,I=_e;return V(),q(I,{loading:i.value},{default:n(()=>[a(p,{class:"dida-main-content"},{default:n(()=>[a(L,{span:8},{default:n(()=>{var z,S,c;return[D("div",vo,[D("h1",null,E((z=_.value)==null?void 0:z.title),1),(S=_.value)!=null&&S.notification?(V(),q(v,{key:0,theme:"info",message:(c=_.value)==null?void 0:c.notification},null,8,["message"])):ie("",!0)]),a(h,{"default-value":[0],"expand-icon":!1,borderless:!0},{default:n(()=>{var u;return[(V(!0),J(Z,null,de((u=_.value)==null?void 0:u.descriptions,(y,T)=>(V(),q(f,{key:T,header:y.title},lt({default:n(()=>[D("div",{innerHTML:y.content,class:"dida-content-description"},null,8,bo)]),_:2},[T===0?{name:"headerRightContent",fn:n(()=>[a(C,{size:"small"},{default:n(()=>[a(w,{size:"small"},{default:n(()=>r[0]||(r[0]=[P("收起全部")])),_:1}),a(w,{size:"small"},{default:n(()=>r[1]||(r[1]=[P("展开全部")])),_:1})]),_:1})]),key:"0"}:void 0]),1032,["header"]))),128))]}),_:1}),a(G,{style:{margin:"10px"}},{default:n(()=>[a(R,{data:k.value,columns:x.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1})]}),_:1}),a(L,{span:4},{default:n(()=>[D("div",ho,[a(j,{layout:"vertical",bordered:!0},{default:n(()=>[a(b,{label:"开始时间"},{default:n(()=>{var z;return[P(E((z=_.value)==null?void 0:z.startTime),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),wo=ee(yo,[["__scopeId","data-v-5e212303"]]);function Nt(e){const t={};return t.id=e.id,t.authorId=e.author_id,t.authorUsername=e.author_username,t.authorNickname=e.author_nickname,t.title=e.title,t.content=e.content,e.insert_time&&(t.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(t.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(t.updateTime=new Date(e.update_time).toLocaleString()),t.problemId=e.problem_id,t.problemTitle=e.problem_title,t.contestId=e.contest_id,t.contestTitle=e.contest_title,t.contestProblemIndex=e.contest_problem_index,t}async function ko(e){const t={};if(t.id=e.id,t.authorId=e.author_id,t.authorUsername=e.author_username,t.authorNickname=e.author_nickname,t.content="",e.content){const o={math:{inlineDigit:!0,engine:"KaTeX"}};t.content=await le.md2html(e.content,o)}return e.insert_time&&(t.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(t.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(t.updateTime=new Date(e.update_time).toLocaleString()),t}function So(e){return W({url:"/discuss?id="+e,method:"get"})}function Co(e,t,o,s,l,i){const _={};return e&&(_.contest_id=e),t&&(_.problem_id=t),o&&(_.title=o),s&&(_.username=s),l&&(_.page=l),i&&(_.page_size=i),W({url:`/discuss/list?${new URLSearchParams(_).toString()}`,method:"get"})}function Po(e,t,o){return W({url:"/discuss/comment/list?id="+e+"&page="+t+"&page_size="+o,method:"get"})}function Io(e){return W({url:"/discuss/create",method:"post",data:e})}const To={style:{margin:"10px"}};function xo(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ue(e)}const Lo=te({__name:"DiscussList",setup(e){const t=me(),o=Ee(),{globalProperties:s}=re();let l=null;const i=m(!1),_=m(!1);let x=0;const k=m([]),g=[],d=[{title:"标题",colKey:"title",cell:(c,u)=>a(F,{variant:"text",onClick:()=>b(u.row.id)},{default:()=>[u.row.title]})},{title:"创建人",colKey:"authorNickname",width:"200"},{title:"创建时间",colKey:"insertTime",width:"180"},{title:"更新时间",colKey:"updateTime",width:"180"}],r=m(!1);let v=1,w=50;const C=m({current:v,pageSize:w,defaultCurrent:v,defaultPageSize:w,total:0,pageSizeOptions:[50,100]}),f=m(),h=m({problemId:"",title:"",username:""}),R=m({title:"",description:"",open_time:[]}),G=c=>{c&&o.push({name:"problem-detail",params:{problemId:c}})},L=(c,u)=>{o.push({name:"contest-problem-detail",params:{contestId:c,problemIndex:u}})},b=c=>{if(c){if(x){o.push({name:"contest-discuss-detail",params:{contestId:x,discussId:c}});return}o.push({name:"discuss-detail",params:{discussId:c}})}},j=async()=>{await o.push({query:{...t.query,problem_id:h.value.problemId,title:h.value.title,username:h.value.username,page:1,page_size:C.value.defaultPageSize}})},p=async(c,u)=>{var y;r.value=!0;try{const{current:T,pageSize:$}=c,U=await Co(x,h.value.problemId,h.value.title,h.value.username,T,$);if(f.value=[],U.code===0){if(U.data.list){const A=U.data.list;for(let Y=0;Y<A.length;Y++){const B=A[Y],N=await Nt(B);(y=f.value)==null||y.push(N)}}C.value={...C.value,total:U.data.total_count}}else u&&K(s,U.code)}catch(T){console.error(T),K(s,Pe())}finally{r.value=!1}},I=async c=>{await o.push({query:{...t.query,page:c.current,page_size:c.pageSize}})},z=()=>{i.value=!0},S=async()=>{_.value=!0,console.log("discussCreateForm",R.value),Io(R.value).then(c=>{c.code===0?(ce(s,"创建比赛成功"),i.value=!1,o.push({path:"/discuss/"+c.data.id})):K(s,c.code)}).finally(()=>{_.value=!1})};return ae(async()=>{l=Ve(()=>t.query,c=>{Array.isArray(t.params.contestId)?x=t.params.contestId[0]:x=t.params.contestId,k.value=g,x?k.value=k.value.concat([{title:"问题ID",colKey:"contestProblemIndex",width:"100",cell:(T,$)=>{let U;return $.row.contestProblemIndex?a(F,{variant:"text",onClick:()=>L(x,$.row.contestProblemIndex)},xo(U=et($.row.contestProblemIndex))?U:{default:()=>[U]}):""}}]):k.value=k.value.concat([{title:"问题ID",colKey:"problemId",width:"100",cell:(T,$)=>$.row.problemId?a(F,{variant:"text",onClick:()=>G($.row.problemId)},{default:()=>[$.row.problemId]}):""}]),k.value=k.value.concat(d),h.value.problemId=c.problem_id||"",h.value.title=c.title||"",h.value.username=c.username||"";const u=parseInt(c.page)||C.value.defaultCurrent,y=parseInt(c.page_size)||C.value.defaultPageSize;v=u,w=y,C.value={...C.value,current:v,pageSize:w},p({current:v,pageSize:w},!0)},{immediate:!0})}),we(()=>{l&&l()}),(c,u)=>{const y=xe,T=se,$=ge,U=ke,A=Te,Y=F,B=Ie,N=pe,X=ve,M=zt,Q=Ge;return V(),J(Z,null,[a(X,null,{default:n(()=>[a($,{span:9},{default:n(()=>[a(T,{style:{margin:"10px"}},{default:n(()=>[a(y,{data:f.value,columns:k.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:C.value,loading:r.value,"table-layout":"auto",onPageChange:I},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),a($,{span:3},{default:n(()=>[D("div",To,[a(T,{class:"sh-card"},{default:n(()=>[a(B,{model:h.value},{default:n(()=>[a(A,{label:"问题ID"},{default:n(()=>[a(U,{modelValue:h.value.problemId,"onUpdate:modelValue":u[0]||(u[0]=ne=>h.value.problemId=ne),placeholder:"请输入完整问题ID"},null,8,["modelValue"])]),_:1}),a(A,{label:"标题"},{default:n(()=>[a(U,{modelValue:h.value.title,"onUpdate:modelValue":u[1]||(u[1]=ne=>h.value.title=ne),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),a(A,{label:"创建人"},{default:n(()=>[a(U,{modelValue:h.value.username,"onUpdate:modelValue":u[2]||(u[2]=ne=>h.value.username=ne),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),a(A,null,{default:n(()=>[a(Y,{theme:"primary",onClick:j},{default:n(()=>u[7]||(u[7]=[P("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(T,{class:"sh-card"},{default:n(()=>[a(N,null,{default:n(()=>[a(Y,{onClick:z},{default:n(()=>u[8]||(u[8]=[P("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),a(Q,{visible:i.value,"onUpdate:visible":u[6]||(u[6]=ne=>i.value=ne),header:"创建比赛",onConfirm:S,"confirm-loading":_.value},{default:n(()=>[a(B,{"label-width":80,model:R.value,onSubmit:u[5]||(u[5]=Fe(()=>{},["prevent"]))},{default:n(()=>[a(A,{label:"标题"},{default:n(()=>[a(U,{modelValue:R.value.title,"onUpdate:modelValue":u[3]||(u[3]=ne=>R.value.title=ne),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),a(A,{label:"开启时间"},{default:n(()=>[a(M,{"enable-time-picker":"","allow-input":"",clearable:"",modelValue:R.value.open_time,"onUpdate:modelValue":u[4]||(u[4]=ne=>R.value.open_time=ne)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Be=ee(Lo,[["__scopeId","data-v-0f07040d"]]),jo={key:0,style:{margin:"20px"}},zo=["innerHTML"],Vo=["innerHTML"],$o={style:{margin:"10px"}},Do={style:{margin:"10px"}},Ro={style:{margin:"10px","text-align":"right"}},Ao={style:{margin:"12px"}},Uo={key:0,class:"dida-edit-container"},Eo=te({__name:"DiscussDetail",props:{discussId:{}},setup(e){const t=e;let o=me();const{globalProperties:s}=re();let l=null;const i=Le(),_=he();let x=m("");const k=m(""),g=m(null),d=m(!1),r=m(null),v=m(!1);let w=1,C=20;const f=m({current:1,total:0,defaultPageSize:C,defaultCurrent:w,pageSizeOptions:[20,50]}),h=m([]),R={},G=je(()=>_.hasAuth(ze.ManageDiscuss)),L=S=>{S&&O.push({name:"discuss-list",query:{...o.query,title:"",tag:S.name}})},b=()=>{O.push({name:"manage-discuss",params:{discussId:k.value}})},j=()=>a("div",{class:"t-pagination__total"},[`共 ${f.value.total} 条回复`]),p=()=>{},I=async(S,c)=>{var u;v.value=!0;try{const{current:y,pageSize:T}=S,$=await Po(k.value,y,T);if(h.value=[],$.code===0){const U=$.data.list;if(U)for(let A=0;A<U.length;A++){const Y=U[A],B=await ko(Y);(u=h.value)==null||u.push(B),await ye(()=>{const N=document.querySelectorAll(".dida-discuss-content");N&&N.length>0&&N.forEach(X=>{le.mathRender(X),le.highlightRender({lineNumber:!0,enable:!0},X),Ae(X)})})}f.value={...f.value,total:$.data.total_count}}else c&&K(s,$.code)}catch(y){console.error(y),K(s,Pe())}finally{v.value=!1}},z=async S=>{await O.push({query:{...o.query,page:S.current,page_size:S.pageSize}})};return ae(async()=>{if(k.value=t.discussId,k.value||(Array.isArray(o.params.discussId)?k.value=o.params.discussId[0]:k.value=o.params.discussId),!k.value){oe(s,"讨论不存在"),await O.push({name:"discuss"});return}d.value=!0;const S=await So(k.value);if(S.code!==0){d.value=!1,K(s,S.code),await O.push({name:"discuss"});return}S.data.tags&&S.data.tags.forEach(T=>{R[T.id]=T}),r.value=Nt(S.data.discuss),i.setTitle(r.value.title+" - "+i.getTitle);let c=r.value.content;const u={math:{inlineDigit:!0,engine:"KaTeX"}};x.value=await le.md2html(c,u),await ye(()=>{g.value&&(le.mathRender(g.value),le.highlightRender({lineNumber:!0,enable:!0},g.value),Ae(g.value)),d.value=!1}),l=Ve(()=>o.query,T=>{const $=parseInt(T.page)||f.value.defaultCurrent,U=parseInt(T.page_size)||f.value.defaultPageSize;w=$,C=U,f.value={...f.value,current:w,pageSize:C},I({current:w,pageSize:C},!0)},{immediate:!0});const y={after:()=>{}};new le("commentEditRef",y)}),we(()=>{l&&l()}),(S,c)=>{const u=ya,y=ha,T=se,$=pe,U=wa,A=F,Y=ge,B=De,N=$e,X=ve,M=_e;return V(),q(M,{loading:d.value},{default:n(()=>[a(X,{class:"dida-main-content"},{default:n(()=>[a(Y,{span:8},{default:n(()=>{var Q,ne,fe;return[(Q=r.value)!=null&&Q.problemTitle||(ne=r.value)!=null&&ne.contestTitle?(V(),J("div",jo,[a(y,{"max-item-width":"300"},{default:n(()=>{var H,Se,pt,ft,_t;return[(H=r.value)!=null&&H.contestTitle?(V(),J(Z,{key:0},[a(u,{to:{name:"contest-detail",params:{contestId:(Se=r.value)==null?void 0:Se.contestId}}},{default:n(()=>{var Ce;return[P(E((Ce=r.value)==null?void 0:Ce.contestTitle),1)]}),_:1},8,["to"]),(pt=r.value)!=null&&pt.contestProblemIndex?(V(),q(u,{key:0,to:{name:"contest-problem-detail",params:{problemIndex:(ft=r.value)==null?void 0:ft.contestProblemIndex}}},{default:n(()=>{var Ce,gt;return[P(E(ue(et)((Ce=r.value)==null?void 0:Ce.contestProblemIndex))+" - "+E((gt=r.value)==null?void 0:gt.problemTitle),1)]}),_:1},8,["to"])):ie("",!0)],64)):(V(),J(Z,{key:1},[a(u,{to:{name:"discuss-list-problem"}},{default:n(()=>c[2]||(c[2]=[P(" 问题讨论")])),_:1}),a(u,{to:{name:"problem-detail",params:{problemId:(_t=r.value)==null?void 0:_t.problemId}}},{default:n(()=>{var Ce;return[P(E((Ce=r.value)==null?void 0:Ce.problemTitle),1)]}),_:1},8,["to"])],64))]}),_:1})])):ie("",!0),a(T,{style:{margin:"10px"},header:(fe=r.value)==null?void 0:fe.title,"header-bordered":!0},{default:n(()=>[D("div",{innerHTML:ue(x),class:"dida-discuss-content"},null,8,zo)]),_:1},8,["header"]),(V(!0),J(Z,null,de(h.value,(H,Se)=>(V(),q(T,{key:Se,style:{margin:"10px"},"header-bordered":""},{header:n(()=>[a($,null,{default:n(()=>[D("span",null,E(H.authorNickname),1),D("span",null,E(H.insertTime),1)]),_:2},1024)]),default:n(()=>[D("div",{innerHTML:H.content,class:"dida-discuss-content"},null,8,Vo)]),_:2},1024))),128)),D("div",$o,[a(U,{modelValue:f.value.current,"onUpdate:modelValue":c[0]||(c[0]=H=>f.value.current=H),"page-size":f.value.pageSize,"onUpdate:pageSize":c[1]||(c[1]=H=>f.value.pageSize=H),total:f.value.total,"page-size-options":f.value.pageSizeOptions,"show-page-size":!1,"total-content":j,onChange:z},null,8,["modelValue","page-size","total","page-size-options"])]),D("div",Do,[c[4]||(c[4]=D("div",{id:"commentEditRef",class:"dida-comment-editor"},null,-1)),D("div",Ro,[a($,null,{default:n(()=>[a(A,{theme:"primary",onClick:p},{default:n(()=>c[3]||(c[3]=[P("提交")])),_:1})]),_:1})])])]}),_:1}),a(Y,{span:4},{default:n(()=>[D("div",Ao,[G.value?(V(),J("div",Uo,[a(A,{onClick:b},{default:n(()=>c[5]||(c[5]=[P("编辑")])),_:1})])):ie("",!0),a(N,{layout:"vertical",bordered:!0},{default:n(()=>[a(B,{label:"创建时间"},{default:n(()=>{var Q;return[P(E((Q=r.value)==null?void 0:Q.insertTime),1)]}),_:1}),a(B,{label:"编辑时间"},{default:n(()=>{var Q;return[P(E((Q=r.value)==null?void 0:Q.modifyTime),1)]}),_:1}),a(B,{label:"更新时间"},{default:n(()=>{var Q;return[P(E((Q=r.value)==null?void 0:Q.updateTime),1)]}),_:1}),a(B,{label:"创建用户"},{default:n(()=>{var Q;return[P(E((Q=r.value)==null?void 0:Q.authorNickname),1)]}),_:1}),a(B,{label:"标签"},{default:n(()=>[a($,null,{default:n(()=>{var Q;return[(V(!0),J(Z,null,de((Q=r.value)==null?void 0:Q.tags,ne=>(V(),q(A,{key:ne.id,variant:"dashed",onClick:()=>L(ne)},{default:n(()=>[P(E(ne.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),tt=ee(Eo,[["__scopeId","data-v-376050e6"]]);function qo(e,t){return W({url:"/rank/ac/all?page="+e+"&page_size="+t,method:"get"})}function Mo(e,t){return W({url:"/rank/ac/problem?page="+e+"&page_size="+t,method:"get"})}function Fo(e,t){return W({url:"/rank/ac/problem/today?page="+e+"&page_size="+t,method:"get"})}function Ko(e,t){return W({url:"/rank/ac/problem/day7?page="+e+"&page_size="+t,method:"get"})}function Go(e,t){return W({url:"/rank/ac/problem/year?page="+e+"&page_size="+t,method:"get"})}const Ho={style:{margin:"10px"}};function at(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ue(e)}const Oo=te({__name:"RankUser",props:{type:{}},setup(e){const t=me(),o=Ee(),{globalProperties:s}=re();let l=null;const i=e,_=m(""),x=m(""),k={all:{header:"统计所有用户在本站的提交记录",content:"优先以AC记录数量排序，如果相同则提交所用次数较少的优先，如果仍相同，注册较早的用户靠前"},problem:{header:"统计所有用户在本站的提交记录",content:"以题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-today":{header:"统计所有用户今日在本站的提交记录",content:"以今日题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-day7":{header:"统计所有用户最近7日在本站的提交记录",content:"以7日题目记录数量排序（从7日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-year":{header:"统计所有用户最近1年在本站的提交记录",content:"以最近1年题目记录数量排序（从365日前的0点开始计算），如果相同，注册较早的用户靠前"}},g=m([]),d=[{title:"序号",colKey:"index"},{title:"用户名",colKey:"username",cell:(I,z)=>a(F,{variant:"dashed",onClick:()=>G(z.row.username)},{default:()=>[z.row.username]})},{title:"昵称",colKey:"nickname"},{title:"Slogan",colKey:"slogan"}],r=[{title:"题目数量",colKey:"problem_count",cell:(I,z)=>{let S=0;return z.row.problem_count&&(S=z.row.problem_count),a(F,{variant:"dashed",onClick:()=>L(z.row.username)},at(S)?S:{default:()=>[S]})}}],v=[{title:"正确",colKey:"accept",cell:(I,z)=>{let S=0;return z.row.accept&&(S=z.row.accept),a(F,{variant:"dashed",onClick:()=>L(z.row.username)},at(S)?S:{default:()=>[S]})}},{title:"提交",colKey:"attempt",cell:(I,z)=>{let S=0;return z.row.attempt&&(S=z.row.attempt),a(F,{variant:"dashed",onClick:()=>b(z.row.username)},at(S)?S:{default:()=>[S]})}}],w=m(!1);let C=1,f=50;const h=m({current:C,pageSize:f,defaultCurrent:C,defaultPageSize:f,total:0,pageSizeOptions:[50]}),R=m(),G=I=>{o.push({name:"user",params:{username:I}})},L=I=>{o.push({name:"judge-list",query:{username:I,status:be.Accept}})},b=I=>{o.push({name:"judge-list",query:{username:I}})},j=async(I,z)=>{w.value=!0;try{R.value=[];const{current:S,pageSize:c}=I;let u=null;switch(i.type){case"problem":u=await Mo(S,c);break;case"problem-today":u=await Fo(S,c);break;case"problem-day7":u=await Ko(S,c);break;case"problem-year":u=await Go(S,c);break;default:u=await qo(S,c);break}if(u.code===0){const y=u.data.list;if(!y||y.length<=0){h.value={...h.value,total:0},ce(s,"未找到记录");return}R.value=[];const T=h.value.pageSize*(h.value.current-1);let $=1;y.forEach(U=>{var Y;const A=U;A.index=T+$++,(Y=R.value)==null||Y.push(A)}),h.value={...h.value,total:u.data.total_count}}else z&&K(s,u.code)}catch(S){console.error(S),K(s,Pe())}finally{w.value=!1}},p=async I=>{await o.push({query:{...t.query,page:I.current,page_size:I.pageSize}})};return ae(async()=>{w.value=!0,l=Ve(()=>t.query,I=>{switch(i.type&&k[i.type]?(_.value=k[i.type].header,x.value=k[i.type].content):(_.value=k.all.header,x.value=k.all.content),i.type){case"all":g.value=d.concat(v);break;default:g.value=d.concat(r);break}const z=parseInt(I.page)||h.value.defaultCurrent,S=parseInt(I.page_size)||h.value.defaultPageSize;C=z,f=S,h.value={...h.value,current:C,pageSize:f},j({current:C,pageSize:f},!0)},{immediate:!0})}),we(()=>{l&&l()}),(I,z)=>{const S=xe,c=se,u=ge,y=ve;return V(),q(y,null,{default:n(()=>[a(u,{span:9},{default:n(()=>[a(c,{style:{margin:"10px"}},{default:n(()=>[a(S,{data:R.value,columns:g.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:h.value,loading:w.value,"table-layout":"auto",onPageChange:p},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),a(u,{span:3},{default:n(()=>[D("div",Ho,[a(c,{class:"sh-card",header:_.value,"header-bordered":!0},{default:n(()=>[P(E(x.value),1)]),_:1},8,["header"])])]),_:1})]),_:1})}}}),Me=ee(Oo,[["__scopeId","data-v-9bbfd60b"]]),No=te({__name:"ManageJudge",setup(e){const{globalProperties:t}=re(),o=m(""),s=m(!1),l=m(!1),i=m(!1),_=async()=>{s.value=!0;try{const g=await Dn();if(g.code!==0){K(t,g.code);return}ce(t,"重判成功"),await O.push({name:"judge-list"})}catch(g){console.error(g),K(t,"重判失败")}finally{s.value=!1}},x=async()=>{if(o.value===""){K(t,"请输入问题Id");return}l.value=!0;try{const g=await Rn(o.value);if(g.code!==0){K(t,g.code);return}ce(t,"重判成功"),await O.push({name:"judge-list",query:{problem_id:o.value}})}catch(g){console.error(g),K(t,"重判失败")}finally{l.value=!1}},k=async()=>{i.value=!0;try{const g=await An();if(g.code!==0){K(t,g.code);return}ce(t,"重判成功"),await O.push({name:"judge-list"})}catch(g){console.error(g),K(t,"重判失败")}finally{i.value=!1}};return(g,d)=>{const r=F,v=se,w=ke,C=pe;return V(),J(Z,null,[a(v,{class:"yj-manage-card",title:"重判最近提交"},{default:n(()=>[a(r,{onClick:_,loading:s.value},{default:n(()=>d[1]||(d[1]=[P("重判")])),_:1},8,["loading"])]),_:1}),a(v,{class:"yj-manage-card",title:"重判问题"},{default:n(()=>[a(C,null,{default:n(()=>[a(w,{modelValue:o.value,"onUpdate:modelValue":d[0]||(d[0]=f=>o.value=f),placeholder:"输入问题Id"},null,8,["modelValue"]),a(r,{onClick:x,loading:l.value},{default:n(()=>d[2]||(d[2]=[P("重判")])),_:1},8,["loading"])]),_:1})]),_:1}),a(v,{class:"yj-manage-card",title:"重判所有"},{default:n(()=>[a(r,{onClick:k,theme:"danger",loading:i.value},{default:n(()=>d[3]||(d[3]=[P("重判")])),_:1},8,["loading"])]),_:1})],64)}}}),Bo=ee(No,[["__scopeId","data-v-e1e4c968"]]),Jo={style:{margin:"10px"}},Wo={key:1},Xo={style:{margin:"12px"}},Yo={class:"dida-edit-container"},Zo=te({__name:"ProblemEdit",setup(e){let t=me();const{globalProperties:o}=re(),s=Le(),l=m(""),i=m(!1);let _=null;const x=m(!1),k=m(null),g=m({title:"",timeLimit:0,memoryLimit:0,source:"",tags:[]}),d=m([]),r=m([]),v=je(()=>{const L=[],b=d.value;for(let j=0,p=b.length;j<p;j++)b[j].value&&L.push(b[j].value);return L}),w=(L,b)=>{const{trigger:j,index:p,item:I}=b;if(j==="clear"&&(d.value=[]),["tag-remove","backspace"].includes(j)&&d.value.splice(p,1),j==="enter"){for(let S=0;S<r.value.length;S++){const c=r.value[S];if(c.label===I){for(let u=0;u<d.value.length;u++)if(d.value[u].label===c.label)return;d.value.push(c);return}}const z={label:I,value:I};d.value.push(z),r.value=r.value.concat(z)}},C=(L,{current:b,type:j})=>{if(!b){d.value=j==="check"?r.value.slice(1):[];return}if(j==="check"){const p=r.value.find(I=>I.value===b);if(!p)return;d.value.push(p)}else d.value=d.value.filter(p=>p.value!==b)},f=()=>{O.push({name:"problem-detail",params:{problemId:l.value}})},h=()=>{O.push({name:"manage-problem-judge",params:{problemId:l.value}})},R=async()=>{if(_){x.value=!0,g.value.tags=[];for(let L=0;L<d.value.length;L++){const b=d.value[L];b&&b.label&&g.value.tags.push(b.label)}try{const L=await Mn(l.value,g.value.title,g.value.timeLimit,g.value.memoryLimit,g.value.source,g.value.tags,_.getValue());if(x.value=!0,L.code!==0){K(o,L.code);return}L.data!=null&&(k.value.updateTime=new Date(L.data).toLocaleString()),At(o,"保存成功")}finally{x.value=!1}}},G=async()=>{const L=await Gt(l.value);if(L.code!==0){K(o,L.code),console.error("problem get failed",L.code),await O.push({name:"problem"});return}const b=L.data.problem;if(k.value=Qe(b,{}),g.value.title=b.title,g.value.timeLimit=b.time_limit,g.value.memoryLimit=b.memory_limit,g.value.source=b.source,g.value.tags=[],d.value=[],L.data.tags)for(let I=0;I<L.data.tags.length;I++){const z=L.data.tags[I];z&&z.name&&(g.value.tags.push(z.name),d.value.push({label:z.name,value:z.id}))}s.setTitle(b.title+" - "+s.getTitle);let j=b.description;const p={after:()=>{_==null||_.setValue(j)}};_=new le("codeEditRef",p),i.value=!1};return ae(async()=>{if(Array.isArray(t.params.problemId)?l.value=t.params.problemId[0]:l.value=t.params.problemId,!l.value){oe(o,"题目不存在"),await O.push({name:"problem"});return}i.value=!0,Ht(-1).then(async L=>{L.code===0?(L.data.list&&L.data.list.forEach(b=>{r.value.push({label:b.name,value:b.id})}),await G()):(K(o,L.code),console.error("problem tag get failed",L.code),await O.push({name:"problem"}))}).catch(async L=>{console.error(L),K(o,"获取数据异常"),await O.push({name:"problem"})})}),(L,b)=>{const j=ke,p=Te,I=ka,z=Ca,S=Sa,c=Ie,u=se,y=ge,T=F,$=pe,U=De,A=$e,Y=ve,B=_e;return V(),q(B,{loading:i.value},{default:n(()=>[a(Y,null,{default:n(()=>[a(y,{span:8},{default:n(()=>[D("div",Jo,[a(u,{class:"sh-card"},{default:n(()=>[a(c,{model:g.value},{default:n(()=>[a(p,{label:"标题"},{default:n(()=>[a(j,{modelValue:g.value.title,"onUpdate:modelValue":b[0]||(b[0]=N=>g.value.title=N),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),a(p,{label:"时间限制"},{default:n(()=>[a(I,{modelValue:g.value.timeLimit,"onUpdate:modelValue":b[1]||(b[1]=N=>g.value.timeLimit=N),theme:"normal",min:0},{suffix:n(()=>b[4]||(b[4]=[D("span",null,"ms",-1)])),_:1},8,["modelValue"])]),_:1}),a(p,{label:"内存限制"},{default:n(()=>[a(I,{modelValue:g.value.memoryLimit,"onUpdate:modelValue":b[2]||(b[2]=N=>g.value.memoryLimit=N),theme:"normal",min:0},{suffix:n(()=>b[5]||(b[5]=[D("span",null,"KB",-1)])),_:1},8,["modelValue"])]),_:1}),a(p,{label:"来源"},{default:n(()=>[a(j,{modelValue:g.value.source,"onUpdate:modelValue":b[3]||(b[3]=N=>g.value.source=N),placeholder:"请输入题目来源"},null,8,["modelValue"])]),_:1}),a(p,{label:"标签"},{default:n(()=>[a(S,{value:d.value,"allow-input":!0,placeholder:"请选择或输入","tag-input-props":{excessTagsDisplayType:"break-line"},"popup-props":{overlayInnerClassName:["narrow-scrollbar"],overlayInnerStyle:{maxHeight:"280px",overflowY:"auto",overscrollBehavior:"contain",padding:"6px"}},clearable:"",multiple:"",onTagChange:w},{panel:n(()=>[r.value.length?(V(),q(z,{key:0,value:v.value,options:r.value,onChange:C},null,8,["value","options"])):(V(),J("div",Wo,"暂无数据"))]),suffixIcon:n(()=>[a(ue(aa))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),a(y,{span:4},{default:n(()=>[D("div",Xo,[D("div",Yo,[a($,null,{default:n(()=>[a(T,{onClick:R,theme:"danger",loading:x.value},{default:n(()=>b[6]||(b[6]=[P("保存")])),_:1},8,["loading"]),a(T,{onClick:h,theme:"warning"},{default:n(()=>b[7]||(b[7]=[P("判题数据")])),_:1}),a(T,{onClick:f},{default:n(()=>b[8]||(b[8]=[P("查看")])),_:1})]),_:1})]),a(A,{layout:"vertical",bordered:!0},{default:n(()=>[a(U,{label:"创建时间"},{default:n(()=>{var N;return[P(E((N=k.value)==null?void 0:N.insertTime),1)]}),_:1}),a(U,{label:"更新时间"},{default:n(()=>{var N;return[P(E((N=k.value)==null?void 0:N.updateTime),1)]}),_:1}),a(U,{label:"判题方式"},{default:n(()=>{var N;return[P(E((N=k.value)==null?void 0:N.judgeType),1)]}),_:1}),a(U,{label:"上传用户"},{default:n(()=>{var N;return[P(E((N=k.value)==null?void 0:N.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1}),b[9]||(b[9]=D("div",{id:"codeEditRef",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"])}}}),Qo=ee(Zo,[["__scopeId","data-v-b8d494d1"]]),el={style:{margin:"10px"}},tl={style:{margin:"12px"}},al={class:"dida-edit-container"},nl=te({__name:"ProblemJudge",setup(e){let t=me();const{globalProperties:o}=re(),s=Le(),l=m(""),i=m(!1),_=m(null);let x=null;const k=m(null),g=m(""),d=m(!1),r=m(!1),v=m([{title:"文件",colKey:"file"},{title:"大小",colKey:"size",width:150,cell:(c,u)=>u.row.size.toFixed(0)+" B"},{title:"最后修改时间",colKey:"lastModified",width:180,cell:(c,u)=>new Date(u.row.lastModified).toLocaleString()},{title:"操作",colKey:"action",width:100,cell:(c,u)=>a(F,{onClick:()=>G(u.row.file)},{default:()=>[P("下载")]})}]),w=m([]),C=je(()=>({border:"2px dashed #ccc",borderRadius:"6px",padding:"20px",textAlign:"center",cursor:"pointer",backgroundColor:d.value?"#f0f9ff":"#fff",transition:"background-color 0.2s ease"})),f=je(()=>g.value?`已选择：${g.value}`:d.value?"松开文件以上传":"拖拽文件到这里，或点击选择文件"),h=()=>{O.push({name:"problem-detail",params:{problemId:l.value}})},R=()=>{O.push({name:"manage-problem",params:{problemId:l.value}})},G=async c=>{const u=await Fn(l.value,c);if(u.code!==0){K(o,u.code);return}const y=document.createElement("a");y.href=u.data,y.target="_blank",y.click(),URL.revokeObjectURL(y.href)},L=async()=>{if(!x){oe(o,"请选择压缩包");return}r.value=!0,Kn(l.value,x).then(async c=>{c.code==0?(k.value.value=null,x=null,g.value="",i.value=!0,At(o,"上传成功"),await S()):K(o,c.code)}).catch(c=>{console.log(c),o.$message.error({duration:3e3,content:"申请失败"})}).finally(()=>{r.value=!1})},b=()=>{var c;(c=k.value)==null||c.click()},j=c=>{const u=c.target.files[0];u&&(g.value=u.name,x=u)},p=c=>{d.value=!0},I=()=>{d.value=!1},z=c=>{c.preventDefault(),c.stopPropagation(),d.value=!1;const u=c.dataTransfer.files[0];if(u){g.value=u.name;const y=new DataTransfer;y.items.add(u),k.value.files=y.files,x=u}},S=async()=>{const c=await En(l.value);if(c.code!==0){K(o,c.code),await O.push({name:"problem"});return}const u=c.data.problem;_.value=Qe(u,{}),s.setTitle(u.title+" - "+s.getTitle),w.value=[],c.data.judges?c.data.judges.forEach(y=>{w.value.push({file:y.key,size:y.size,lastModified:y.last_modified})}):oe(o,"评测数据不存在"),i.value=!1};return ae(async()=>{if(Array.isArray(t.params.problemId)?l.value=t.params.problemId[0]:l.value=t.params.problemId,!l.value){oe(o,"题目不存在"),await O.push({name:"problem"});return}i.value=!0,await S()}),(c,u)=>{const y=xe,T=ge,$=F,U=pe,A=De,Y=$e,B=ve,N=_e;return V(),q(N,{loading:i.value},{default:n(()=>[a(B,null,{default:n(()=>[a(T,{span:7},{default:n(()=>[D("div",el,[D("div",{id:"drop-zone",style:Ct(C.value),onClick:b,onDragenter:Fe(p,["prevent"]),onDragover:u[0]||(u[0]=Fe(()=>{},["prevent"])),onDragleave:Fe(I,["prevent"]),onDrop:z},[D("input",{ref_key:"fileInput",ref:k,type:"file",style:{display:"none"},onChange:j},null,544),P(" "+E(f.value),1)],36)]),a(y,{data:w.value,columns:v.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1}),a(T,{span:5},{default:n(()=>[D("div",tl,[D("div",al,[a(U,null,{default:n(()=>[a($,{onClick:L,theme:"danger",loading:r.value},{default:n(()=>u[1]||(u[1]=[P("上传")])),_:1},8,["loading"]),a($,{onClick:R,theme:"warning"},{default:n(()=>u[2]||(u[2]=[P("编辑")])),_:1}),a($,{onClick:h},{default:n(()=>u[3]||(u[3]=[P("查看")])),_:1})]),_:1})]),a(Y,{layout:"vertical",bordered:!0},{default:n(()=>[a(A,{label:"标题"},{default:n(()=>{var X;return[P(E((X=_.value)==null?void 0:X.title),1)]}),_:1}),a(A,{label:"创建时间"},{default:n(()=>{var X;return[P(E((X=_.value)==null?void 0:X.insertTime),1)]}),_:1}),a(A,{label:"更新时间"},{default:n(()=>{var X;return[P(E((X=_.value)==null?void 0:X.updateTime),1)]}),_:1}),a(A,{label:"判题方式"},{default:n(()=>{var X;return[P(E((X=_.value)==null?void 0:X.judgeType),1)]}),_:1}),a(A,{label:"评测数据"},{default:n(()=>{var X;return[P(E((X=_.value)==null?void 0:X.judgeMd5),1)]}),_:1}),a(A,{label:"上传用户"},{default:n(()=>{var X;return[P(E((X=_.value)==null?void 0:X.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),ol=ee(nl,[["__scopeId","data-v-17986e38"]]),ll={style:{display:"flex","align-items":"center"}},sl={style:{color:"#409eff","margin-right":"20px"}},rl={class:"dida-login-footer"},ul=te({__name:"UserForget",setup(e){const{globalProperties:t}=re(),o=he(),s=m(!1),l=m(!1),i=m(!1),_=m("发送验证码");let x=null,k=-1;const g=m(!1),d=m(null),r=m(""),v=m({username:"",emailKey:"",password:"",confirmPassword:""}),C=m({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:j=>new Promise(p=>{const I=setTimeout(()=>{p(v.value.password===j),clearTimeout(I)})}),message:"两次密码不一致"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),f=()=>{ce(t,"重置成功")},h=async j=>{if(!i.value){s.value=!0,l.value=!0;try{const p=await mn(j,v.value.username);p.code===0?(ce(t,"验证码发送成功"),r.value=p.data,l.value=!1,i.value=!0,x=new Date,_.value="60秒后重发",k=setInterval(()=>{const z=Math.floor((new Date().getTime()-(x==null?void 0:x.getTime()))/1e3);z>60?(_.value="发送验证码",i.value=!1,clearInterval(k)):_.value=`${60-z}秒后重发`},1e3)):K(t,p.code)}catch(p){console.error("Send email key error",p),oe(t,"发送验证码失败")}finally{s.value=!1}}},R=async()=>{var z;if(g.value=!0,i.value||l.value)return;await ye();const j=document.getElementById("cf-confirm-div");j&&j.remove();const p=document.createElement("div");p.id="cf-confirm-div",p.setAttribute("data-theme","light"),(z=d.value)==null||z.appendChild(p);const I=window;I.turnstile.ready(function(){I.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(S){g.value=!1,await h(S)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},G=m(()=>a(F,{onClick:R,disabled:i.value,loading:l.value,style:"width:120px"},{default:()=>[_.value]})),L=async()=>{s.value=!0;try{const j=await pn(v.value.username,v.value.password,v.value.emailKey);j.code===0?(ce(t,"密码修改成功"),t.$router.push({name:"login"})):K(t,j.code)}catch(j){console.error("Modify password error",j),oe(t,"修改密码失败")}finally{s.value=!1}},b=async({validateResult:j,firstError:p,e:I})=>{if(!s.value){if(I.preventDefault(),j!==!0){oe(t,p);return}r.value?await L():await R()}};return ae(()=>{if(o.isLogin()){t.$router.push({path:"/user"});return}}),we(()=>{}),(j,p)=>{const I=ct,z=ke,S=Te,c=It,u=F,y=Ie,T=Ke,$=se,U=Ge;return V(),J(Z,null,[a($,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:n(()=>[a(I,{"max-line":1},{default:n(()=>p[6]||(p[6]=[D("span",null,"如果您未绑定邮箱或忘记用户名，可联系管理员寻求帮助",-1),D("span",null,"管理员邮箱：BoilTask@qq.com",-1)])),_:1}),a(y,{ref:"form",rules:C.value,data:v.value,colon:!0,onReset:f,onSubmit:b,class:"yj-login-form"},{default:n(()=>[a(S,{name:"username",label:"用户名"},{default:n(()=>[a(z,{modelValue:v.value.username,"onUpdate:modelValue":p[0]||(p[0]=A=>v.value.username=A),clearable:"",placeholder:"请输入完整用户名"},null,8,["modelValue"])]),_:1}),r.value?(V(),J(Z,{key:0},[a(S,{name:"email",label:"发送邮箱"},{default:n(()=>[a(c,{append:G.value},{default:n(()=>[D("div",ll,[D("span",sl,E(r.value),1)])]),_:1},8,["append"])]),_:1}),a(S,{name:"emailKey",label:"验证码"},{default:n(()=>[a(z,{modelValue:v.value.emailKey,"onUpdate:modelValue":p[1]||(p[1]=A=>v.value.emailKey=A),clearable:"",placeholder:"请输入收到的验证码"},null,8,["modelValue"])]),_:1}),a(S,{name:"password",label:"新密码"},{default:n(()=>[a(z,{modelValue:v.value.password,"onUpdate:modelValue":p[2]||(p[2]=A=>v.value.password=A),type:"password",clearable:"",placeholder:"新密码"},null,8,["modelValue"])]),_:1}),a(S,{name:"confirmPassword",label:"确认密码"},{default:n(()=>[a(z,{modelValue:v.value.confirmPassword,"onUpdate:modelValue":p[3]||(p[3]=A=>v.value.confirmPassword=A),type:"password",clearable:"",placeholder:"请重复输入密码"},null,8,["modelValue"])]),_:1})],64)):ie("",!0),r.value?(V(),q(S,{key:1},{default:n(()=>[a(u,{theme:"primary",type:"submit",block:"",loading:s.value},{default:n(()=>p[7]||(p[7]=[P("修改密码")])),_:1},8,["loading"])]),_:1})):(V(),q(S,{key:2},{default:n(()=>[a(u,{theme:"primary",type:"submit",block:"",loading:s.value},{default:n(()=>p[8]||(p[8]=[P("重置密码")])),_:1},8,["loading"])]),_:1}))]),_:1},8,["rules","data"]),D("div",rl,[a(T,{onClick:p[4]||(p[4]=()=>{ue(t).$router.push({name:"login"})})},{default:n(()=>p[9]||(p[9]=[P("返回登陆 ")])),_:1})])]),_:1}),a(U,{visible:g.value,"onUpdate:visible":p[5]||(p[5]=A=>g.value=A),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:n(()=>[D("div",{ref_key:"dialogContainer",ref:d,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),il=ee(ul,[["__scopeId","data-v-c3586c6f"]]),Bt=[{name:"problem-list",tab:"problem",sidebar:"problem-list",path:"",title:"问题列表",icon:"list",component:Nn},{name:"problem-detail",tab:"problem",sidebar:"problem-list",path:":problemId+",title:"问题详情",icon:"list",component:bt},{name:"problem-recommend",tab:"problem",sidebar:"problem-recommend",path:"recommend/:problemId*",title:"问题推荐",icon:"cpu",component:oo},{name:"judge-list",tab:"judge",sidebar:"judge-list",path:"",title:"评测列表",icon:"list",component:uo},{name:"judge-detail",tab:"judge",sidebar:"judge-list",path:":judgeId+",title:"评测详情",icon:"cpu",component:fo},{name:"contest-list",tab:"contest",sidebar:"contest-list",path:"",title:"比赛列表",icon:"list",component:qe},{name:"contest-recent",tab:"contest",sidebar:"contest-recent",path:"recent",title:"近期比赛",icon:"list",component:qe},{name:"contest-detail",tab:"contest-detail-tab",sidebar:"contest-detail",path:":contestId+",title:"比赛详情",icon:"cpu",component:wo},{name:"contest-problem-detail",tab:"contest-detail-tab",sidebar:"contest-problem-detail",path:":contestId+/problem/:problemIndex+",title:"问题详情",icon:"cpu",component:bt},{name:"contest-judge",tab:"contest-detail-tab",sidebar:"contest-judge",path:":contestId+/judge",title:"评测列表",icon:"list",component:qe},{name:"contest-rank",tab:"contest-detail-tab",sidebar:"contest-rank",path:":contestId+/rank",title:"比赛排名",icon:"list",component:qe},{name:"contest-statistics",tab:"contest-detail-tab",sidebar:"contest-statistics",path:":contestId+/statistics",title:"结果统计",icon:"list",component:qe},{name:"contest-discuss",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss",title:"比赛讨论",icon:"list",component:Be},{name:"contest-discuss-detail",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss/:discussId+",title:"讨论详情",icon:"list",component:tt},{name:"discuss-list",tab:"discuss",sidebar:"discuss-list",path:"",title:"讨论列表",icon:"list",component:Be},{name:"discuss-list-problem",tab:"discuss",sidebar:"discuss-list-problem",path:"problem",title:"问题讨论",icon:"list",component:Be},{name:"discuss-list-judge",tab:"discuss",sidebar:"discuss-list-judge",path:"judge",title:"评测讨论",icon:"list",component:Be},{name:"discuss-detail",tab:"discuss",sidebar:"discuss-list",path:":discussId+",title:"讨论详情",icon:"list",component:tt},{name:"rank-ac-all",tab:"rank",sidebar:"rank-ac-all",path:"ac",title:"AC排名",icon:"base-station",props:{type:"all"},component:Me},{name:"rank-ac-problem",tab:"rank",sidebar:"rank-ac-problem",path:"ac/problem",title:"题量排名",icon:"base-station",props:{type:"problem"},component:Me},{name:"rank-ac-problem-today",tab:"rank",sidebar:"rank-ac-problem-today",path:"ac/problem/today",title:"今日题量",icon:"base-station",props:{type:"problem-today"},component:Me},{name:"rank-ac-problem-day7",tab:"rank",sidebar:"rank-ac-problem-day7",path:"ac/problem/day7",title:"7日题量",icon:"base-station",props:{type:"problem-day7"},component:Me},{name:"rank-ac-problem-year",tab:"rank",sidebar:"rank-ac-problem-year",path:"ac/problem/year",title:"1年题量",icon:"base-station",props:{type:"problem-year"},component:Me},{name:"tool-paste",tab:"tool",sidebar:"tool-paste",path:"paste",title:"码池",icon:"base-station",component:rt},{name:"system-status",tab:"system",sidebar:"system-status",path:"",title:"运行状态",icon:"base-station",component:rt},{name:"system-about",tab:"system",sidebar:"system-about",path:"about",title:"关于",icon:"base-station",props:{discussId:"52"},component:tt},{name:"manage-problem",tab:"manage",sidebar:"manage-problem",disableSidebar:!0,path:"problem/:problemId+",title:"问题编辑",icon:"list",component:Qo,auths:[ze.ManageProblem]},{name:"manage-problem-judge",tab:"manage",sidebar:"manage-problem-judge",disableSidebar:!0,path:"problem/:problemId+/judge",title:"评测数据",icon:"list",component:ol,auths:[ze.ManageProblem]},{name:"manage-judge",tab:"manage",path:"judge",sidebar:"manage-judge",title:"评测管理",icon:"list",auths:["i-manage-judge"],component:Bo},{name:"login-forget",tab:"login",path:"forget",title:"忘记密码",component:il}],yt=(e,t,o,s)=>{s.tab==o&&(s.disableSidebar&&t!=s.sidebar||s.sidebar==null||s.sidebar!=s.name||e.push({name:s.name,title:s.title,icon:s.icon,to:{name:s.name}}))},cl=(e,t)=>{const o=[];return Bt.forEach(s=>{if(Ut(s)){const l=[];s.children.forEach(i=>{yt(l,e,t,i)}),l.length>0&&o.push({title:s.title,children:l})}else yt(o,e,t,s)}),o},wt=(e,t)=>{const o=Sn(t.tab),s={name:t.name,path:"/"+t.path,meta:{title:t.title+" - "+o.title,tab:t.tab,sidebar:t.sidebar,showSidebar:o.showSidebar,needLogin:o.needLogin||t.needLogin,tabAuths:o.auths,auths:t.auths},props:t.props,component:t.component};o.disablePath||(s.path=o.path+s.path),e.push(s)},dl=e=>{Bt.forEach(t=>{Ut(t)?t.children.forEach(o=>{wt(e,o)}):wt(e,t)})},ml={class:"sh-main"},pl=te({__name:"View403",setup(e){let t=me();const o=m("");return ae(()=>{t.query.target?o.value=t.query.target:o.value=t.fullPath}),(s,l)=>{const i=F;return V(),J("div",ml,[D("p",null,E(o.value),1),l[2]||(l[2]=D("p",null,"该页面无访问权限，请更换访问目标或重新登陆后再试",-1)),a(i,{theme:"primary",onClick:l[0]||(l[0]=()=>s.$router.push("/"))},{default:n(()=>l[1]||(l[1]=[P("返回首页")])),_:1})])}}}),Jt=ee(pl,[["__scopeId","data-v-8f62f1f8"]]),Oe=[];Pn(Oe);dl(Oe);Oe.push({path:"/403",name:"403",component:Jt});Oe.push({path:"/:pathMatch(.*)*",name:"404",component:Rt});const O=na({history:oa("/"),routes:Oe});O.beforeEach((e,t,o)=>{if(e.name==null||!O.hasRoute(e.name)){o({name:"home"});return}const s=e.matched[e.matched.length-1].meta;if(s.redirect){o({name:s.redirect});return}if(s.needLogin){const i=he();if(i.getToken==null||i.getToken==""){o({name:"login",query:{redirect_uri:e.fullPath}});return}}const l=s.tabAuths;if(l&&!he().hasAllAuths(l)){o({name:"403",query:{target:e.fullPath}});return}o()});O.afterEach((e,t)=>{if(e.name===t.name)return;const o=Ze(),s=Le();let l=null;if(e.matched.length>0&&(l=e.matched[e.matched.length-1].meta),l!=null&&l.title&&s.setTitle(l==null?void 0:l.title),l!=null&&l.showSidebar){o.setSidebarShow(!0);const i=cl(l==null?void 0:l.sidebar,l==null?void 0:l.tab);o.setMenuList(i),o.setMenuActiveName(l==null?void 0:l.sidebar)}else o.setSidebarShow(!1)});const Wt=Ye("login",{state:()=>({Loaded:!1}),getters:{isLoaded(){return this.Loaded}}}),fl=te({__name:"HeaderContent",setup(e){const t=Wt(),o=he(),{globalProperties:s}=re(),l=m(t.isLoaded),i=m(!1),_=m(o.getUsername),x=m(o.getNickname),k=m(),g=()=>{k.value=Cn(o)};t.$subscribe((v,w)=>{l.value=w.Loaded}),o.$subscribe((v,w)=>{_.value=w.username,x.value=w.nickname,i.value=w.token!="",g()});const d=()=>{s.$router.currentRoute.value.name!=="login"&&s.$router.push({name:"login",query:{redirect_uri:s.$router.currentRoute.value.fullPath}})},r=()=>{o.clear(),s.$message.success({duration:3e3,content:"注销成功"}),s.$router.push({path:"/login",query:{redirect_uri:s.$router.currentRoute.value.fullPath}})};return ae(()=>{g()}),(v,w)=>{const C=Pt("router-link"),f=$t,h=Vt,R=Pa,G=Ia;return V(),q(G,{modelValue:v.$route.meta.tab,"onUpdate:modelValue":w[0]||(w[0]=L=>v.$route.meta.tab=L),class:"sh-menu","expand-type":"popup"},{logo:n(()=>[a(C,{to:"/",class:"sh-logo"},{default:n(()=>w[1]||(w[1]=[P("DidaOJ")])),_:1})]),operations:n(()=>[l.value&&i.value?(V(),q(R,{key:0,title:x.value},{icon:n(()=>[a(f,{name:"user"})]),default:n(()=>[a(h,{value:"user",to:{path:"/user/"+_.value}},{default:n(()=>w[2]||(w[2]=[P("个人空间")])),_:1},8,["to"]),a(h,{value:"user_logout",onClick:r},{default:n(()=>w[3]||(w[3]=[P(" 注销")])),_:1})]),_:1},8,["title"])):l.value?(V(),q(h,{key:2,value:"login",onClick:d},{icon:n(()=>[a(f,{name:"login"})]),default:n(()=>[w[5]||(w[5]=P(" 登录 "))]),_:1})):(V(),q(h,{key:1,value:"login"},{icon:n(()=>[a(f,{name:"login"})]),default:n(()=>[w[4]||(w[4]=P(" ... "))]),_:1}))]),default:n(()=>[(V(!0),J(Z,null,de(k.value,L=>(V(),q(h,{key:L.name,value:L.name,to:{name:L.name}},{icon:n(()=>[L.icon?(V(),q(f,{key:0,name:L.icon},null,8,["name"])):ie("",!0)]),default:n(()=>[P(" "+E(L.title),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])}}}),_l=ee(fl,[["__scopeId","data-v-c64d812f"]]),gl={id:"menu-container"},vl=te({__name:"SidebarContent",setup(e){const t=Ze(),o=m(!1),s=m(null),l=m(t.menuActiveName),i=m(t.menuList),_=m([]),x=m(!1),k=()=>{l.value=t.menuActiveName;const d=JSON.stringify(i.value),r=JSON.stringify(t.menuList);d!==r&&(_.value.push([...t.menuList]),g())},g=async()=>{if(_.value.length>0&&!x.value){for(x.value=!0;_.value.length>1;)_.value.shift();const d=_.value.shift();o.value=d.length<=0,i.value=[],await ye(),s.value&&s.value.updateActiveName(),await new Promise(v=>setTimeout(v,300)),i.value=d,await ye(),s.value&&s.value.updateActiveName();const r=300;await new Promise(v=>setTimeout(v,r)),x.value=!1,await g()}};return t.$subscribe((d,r)=>{k()}),ae(()=>{k()}),(d,r)=>{const v=$t,w=Vt,C=xa,f=Ta,h=_e;return V(),J(Z,null,[D("div",gl,[a(f,{modelValue:l.value,"onUpdate:modelValue":r[0]||(r[0]=R=>l.value=R),theme:"light",class:"sh-menu-container"},{default:n(()=>[a(la,{name:"move-left"},{default:n(()=>[(V(!0),J(Z,null,de(i.value,(R,G)=>(V(),J(Z,{key:G},[ue(In)(R)?(V(),q(C,{key:0,title:R.title},{default:n(()=>[(V(!0),J(Z,null,de(R.children,(L,b)=>(V(),q(w,{key:L.name,value:L.name,to:L.to},lt({default:n(()=>[P(" "+E(L.title),1)]),_:2},[L.icon?{name:"icon",fn:n(()=>[a(v,{name:L.icon,class:st(L.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))),128))]),_:2},1032,["title"])):(V(),q(w,{key:R.name,value:R.name,to:R.to},lt({default:n(()=>[P(" "+E(R.title),1)]),_:2},[R.icon?{name:"icon",fn:n(()=>[a(v,{name:R.icon,class:st(R.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),a(h,{size:"small",loading:o.value,"show-overlay":!0,attach:"#menu-container",class:"sh-sidebar-loading",style:{"align-items":"flex-start","padding-top":"100px"}},null,8,["loading"])],64)}}}),bl=ee(vl,[["__scopeId","data-v-96e2d89f"]]),hl={};function yl(e,t){return null}const wl=ee(hl,[["render",yl]]),kl={class:"footer"},Sl={class:"footer-left"},Cl={class:"foot-time"},Pl={class:"footer-center"},Il={href:"https://beiancx.miit.gov.cn/",target:"_blank"},Tl={class:"footer-right"},xl={class:"foot-text"},Ll={href:"https://github.com/hpu-developer/DiDaOJ-web",target:"_blank"},jl={class:"foot-text"},zl={href:"https://github.com/hpu-developer/DiDaOJ-go",target:"_blank"},Vl=te({__name:"FooterContent",setup(e){const t=m("");function o(){t.value=new Date().toLocaleString()}return ae(()=>{o(),setInterval(()=>{o()},1e3)}),(s,l)=>{const i=F;return V(),J("div",kl,[D("div",Sl,[D("p",Cl,E(t.value),1)]),D("div",Pl,[D("a",Il,[a(i,{theme:"default",variant:"outline",ghost:!0},{default:n(()=>l[0]||(l[0]=[P("豫ICP备15024677号-4")])),_:1})])]),D("div",Tl,[D("p",xl,[D("a",Ll,[a(i,{theme:"default",variant:"outline",ghost:!0},{default:n(()=>l[1]||(l[1]=[P("@didaoj-web")])),_:1})])]),D("p",jl,[D("a",zl,[a(i,{theme:"default",variant:"outline",ghost:!0},{default:n(()=>l[2]||(l[2]=[P("@didaoj-go")])),_:1})])])])])}}}),$l=ee(Vl,[["__scopeId","data-v-979fed79"]]),Je=20,nt=100,ot=50,Dl=te({__name:"ForceHiddenSidebarButton",setup(e){let t=Ze();const o=m({x:window.innerWidth-nt-Je,y:window.innerHeight-ot-Je}),s=m(window.innerWidth),l=m(window.innerHeight);let i=!1,_={x:0,y:0};const x=R=>{i=!0;const G=R.clientX??R.touches[0].clientX,L=R.clientY??R.touches[0].clientY;_={x:G-o.value.x,y:L-o.value.y},document.addEventListener("mousemove",k),document.addEventListener("touchmove",k),document.addEventListener("mouseup",g),document.addEventListener("touchend",g)},k=R=>{if(!i)return;const G=R.clientX??R.touches[0].clientX,L=R.clientY??R.touches[0].clientY;let b=G-_.x,j=L-_.y;b=Math.max(0,Math.min(b,s.value-nt)),j=Math.max(0,Math.min(j,l.value-ot)),o.value={x:b,y:j}},g=()=>{i=!1,document.removeEventListener("mousemove",k),document.removeEventListener("touchmove",k),document.removeEventListener("mouseup",g),document.removeEventListener("touchend",g)},d=()=>{s.value=window.innerWidth,l.value=window.innerHeight,o.value={x:Math.min(o.value.x,s.value-nt-Je),y:Math.min(o.value.y,l.value-ot-Je)}};let r=m(t.forceHiddenSidebar),v=m(t.forceHiddenSidebar);const w=()=>{r.value=!r.value,t.setForceHiddenSidebar(r.value)},C=()=>{v.value||(v.value=!0,t.setForceHiddenSidebar(r.value))},f=()=>{v.value&&(v.value=!1,t.setForceHiddenSidebar(!1))},h=R=>{R>=800?f():C()};return h(s.value),Ve(s,R=>{h(R)}),ae(()=>{window.addEventListener("resize",d)}),we(()=>{window.removeEventListener("resize",d)}),(R,G)=>{const L=F;return ue(v)?(V(),q(L,{key:0,class:"draggable-button",style:Ct({top:`${o.value.y}px`,left:`${o.value.x}px`}),onMousedown:x,onTouchstart:x,variant:"dashed",theme:"primary",onClick:w},{default:n(()=>[P(E(ue(r)?"显示":"隐藏"),1)]),_:1},8,["style"])):ie("",!0)}}}),Rl=ee(Dl,[["__scopeId","data-v-1aee5506"]]),We="DidaOJ",Al=te({__name:"App",setup(e){const{globalProperties:t}=re(),o=Wt(),s=he(),l=Le(),i=Ze();o.$patch({Loaded:!1});const _=s.getToken,x=m(!1),k=m(!1);l.title&&l.title.length>0?document.title=l.title+" - "+We:document.title=We,l.$subscribe((v,w)=>{w.title&&w.title.length>0?document.title=w.title+" - "+We:document.title=We}),i.$subscribe((v,w)=>{x.value=w.showSidebar,k.value=x.value&&!w.forceHiddenSidebar});const g=me(),d=je(()=>{const v=g.meta.auths;return v?!s.hasAllAuths(v):!1});function r(){t.$message.warning({duration:3e3,content:"登陆状态失效"}),o.$patch({Loaded:!0}),s.clear()}return ae(()=>{if(_==""){o.$patch({Loaded:!0});return}rn().then(v=>{v.code==0?(s.loadResponse(v.data),o.$patch({Loaded:!0})):(K(t,v.code),o.$patch({Loaded:!0}),s.clear())}).catch(v=>{console.log(v),r()})}),(v,w)=>{const C=La,f=za,h=Pt("RouterView"),R=Va,G=ja,L=$a;return V(),J(Z,null,[a(G,null,{default:n(()=>[a(C,{class:"sh-header"},{default:n(()=>[a(_l)]),_:1}),a(G,null,{default:n(()=>[a(sa,{name:"slide"},{default:n(()=>[k.value?(V(),q(f,{key:0,class:"sh-sidebar"},{default:n(()=>[a(bl)]),_:1})):ie("",!0)]),_:1}),a(G,{class:st(["sh-main-layout",{expanded:!k.value}])},{default:n(()=>[a(wl),a(R,{class:"sh-main-content"},{default:n(()=>[d.value?(V(),q(Jt,{key:0})):(V(),q(h,{key:1}))]),_:1}),a($l)]),_:1},8,["class"])]),_:1})]),_:1}),x.value?(V(),q(Rl,{key:0})):ie("",!0),a(L,{container:"body",offset:["24px","80px"],size:"small"})],64)}}}),Ul=ee(Al,[["__scopeId","data-v-9e122cb4"]]);Ra.registerLanguage("verilog",Aa);const Xt=ra();Xt.use(ua);const Ne=ia(Ul);Ne.use(Xt);Ne.use(O);Ne.use(Da);Ne.use(ca);Ne.mount("#app");tn().then(()=>{console.log("Text cache reinitialized")}).catch(e=>{console.error("Text cache reinitialization failed",e)});
