import{bm as We,bn as vt,n as ae,r as g,o as ne,G as ht,bo as J,bp as L,s as t,bq as n,br as z,F as Q,bs as ce,bt as M,bu as F,ap as S,u as Fe,bv as ue,bw as pe,aD as oe,g as Jt,bx as bt,by as Be,bz as yt,aM as Wt,bA as at,bB as nt,q as we,y as $e,J as Te,bC as wt,c as Se,$ as Xt,bD as Me,bE as Ee,ac as Yt,bF as Zt,bG as Qt,bH as ea,bI as ta,B as aa,bJ as na}from"./node_modules-zO3nKDJE.js";import{L as ge,C as de,S as me,a as oa,T as la,b as he,A as kt,c as sa,d as ra,e as ua,f as ia,g as Xe,R as be,B as G,F as Pe,h as Le,I as ke,M as St,i as Ct,j as ca,H as da,k as ma,l as pa,m as fa,n as _a,o as ga,p as va,q as ha,r as je,D as ze,s as Re,t as It,O as Tt,u as st,P as ba,v as Pt,w as Lt,x as jt,y as ya,z as wa,E as ka,G as Sa,J as Ca,K as Ia,N as Ta}from"./tdesign-vue-next-78bwmitM.js";import{V as le}from"./vditor-DArazWIS.js";import{e as dt}from"./monaco-editor-DCUKHC_e.js";import{H as Pa,v as La}from"./highlight.js-D9zWiMxS.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const b of i.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&s(b)}).observe(document,{childList:!0,subtree:!0});function o(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerPolicy&&(i.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?i.credentials="include":l.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(l){if(l.ep)return;l.ep=!0;const i=o(l);fetch(l.href,i)}})();var Ce=(e=>(e.Manage="i-manage",e.ManageJudge="i-manage-judge",e.ManageProblem="i-manage-problem",e))(Ce||{});const ja={"r-admin":["i-manage","i-manage-judge","i-manage-problem"]};function xa(e){if(e==null)return[];const a=[];for(const o of e){const s=ja[o];s!=null&&a.push(...s)}return[...new Set(a)]}function Va(e,a){if(e==null||a==null)return!1;const o=xa(e);for(const s of a)if(!o.includes(s))return!1;return!0}const ve=We("user",{state:()=>({token:"",userId:-1,username:"",nickname:"",roles:[]}),getters:{getToken(){return this.token},getUserId(){return this.userId},getUsername(){return this.username},getNickname(){return this.nickname}},actions:{clear(){this.$patch({token:"",userId:-1,username:"",nickname:"",roles:[]})},loadResponse(e){this.$patch({token:e.token,userId:e.user_id,username:e.username,nickname:e.nickname,roles:e.roles})},isLogin(){return this.token!=null&&this.token!=""},hasAuth(e){return this.hasAllAuths([e])},hasAllAuths(e){return e?Va(this.roles,e):!0}},persist:!0}),Da="https://oj-api.didapipa.com/",Y=vt.create({baseURL:Da,timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});Y.interceptors.request.use(e=>{const o=ve().getToken;return o&&(e.headers["X-Token"]=o),e},e=>Promise.reject(e));Y.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function xt(e,a){return Y({url:"/user/login",method:"post",data:{username:e,password:a}})}function $a(){return Y({url:"/user/login/refresh",method:"post"})}const Vt=We("login",{state:()=>({Loaded:!1}),getters:{isLoaded(){return this.Loaded}}}),xe=We("webStyle",{state:()=>({title:""}),getters:{getTitle(){return this.title}},actions:{setTitle(e){this.title=e}}}),Ye=We("sidebarStyle",{state:()=>({showSidebar:!1,forceHiddenSidebar:!1,menuActiveName:"",menuList:[]}),getters:{getMenuList(){return this.menuList}},actions:{setSidebarShow(e){this.showSidebar=e},setForceHiddenSidebar(e){this.forceHiddenSidebar=e},setMenuActiveName(e){this.menuActiveName=e},clearMenuList(){this.menuList=[]},setMenuList(e){this.menuList=e},addMenuList(e){this.menuList.push(e)}}}),qe=vt.create({timeout:6e4,withCredentials:!1,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});qe.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function za(){return qe({baseURL:"https://r2-oj.didapipa.com",url:"/system/notification.json?"+Date.now(),method:"get"})}function Ra(){return qe({baseURL:"https://r2-oj.didapipa.com",url:"/status/judger.json?"+Date.now(),method:"get"})}function Dt(e){return qe({baseURL:"https://r2-oj.didapipa.com",url:"/status/judger/"+e+".json?"+Date.now(),method:"get"})}function Ua(e){return qe({baseURL:"https://r2-oj.didapipa.com",url:"/status/web.json?"+Date.now(),method:"get"})}const Aa={class:"judger-status-panel"},Ea={class:"judger-status-panel"};function Fa(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Fe(e)}const Ma=ae({__name:"SystemStatus",setup(e){const a=g([]),o=g([]),s=g(!1),l=g(!1);let i;const b=r=>{let d="失效",_="danger";const v=new Date,y=new Date(r.updateTime);return v.getTime()-y.getTime()>3e4?(d="离线",_="default"):r.cpuUsage>90?(d="CPU过高",_="warning"):r.memPercent>90?(d="内存过高",_="warning"):(d="在线",_="success"),t(me,null,{default:()=>[t("span",null,[r.key,S(" - "),r.name]),t("span",null,[r.updateTime]),t(la,{theme:_,size:"small"},Fa(d)?d:{default:()=>[d]})]})},T=async()=>{const r=[{key:"didaoj",name:"DidaOj"}],d={};for(let v=0;v<a.value.length;v++){const y=a.value[v];d[y.key]=y}const _=[];for(let v=0;v<r.length;v++){const y=r[v],m={key:y.key},w=await Ua(y.key);w&&(w.name?m.name=w.name:m.name="-",w.update_time?m.updateTime=new Date(w.update_time).toLocaleString():m.updateTime="-",w.cpu_usage?m.cpuUsage=Number(w.cpu_usage):m.cpuUsage=0,w.mem_usage?m.memUsage=w.mem_usage/(1024*1024*1024):m.memUsage=0,w.mem_total?m.memTotal=w.mem_total/(1024*1024*1024):m.memTotal=0,m.memTotal>0?m.memPercent=Math.round(m.memUsage/m.memTotal*1e4)/100:m.memPercent=0,m.avgMessage=w.avg_message,d[y.key]?(m.cpuUsageFrom=d[y.key].cpuUsage,m.memPercentFrom=d[y.key].memPercent,m.memUsageFrom=d[y.key].memUsage,m.memTotalFrom=d[y.key].memTotal):(m.cpuUsageFrom=0,m.memPercentFrom=0,m.memUsageFrom=0,m.memTotalFrom=0),_.push(m))}a.value=_},h=async()=>{const r=await Ra(),d={};for(let v=0;v<o.value.length;v++){const y=o.value[v];d[y.key]=y}const _=[];for(let v=0;v<r.judgers.length;v++){const y=r.judgers[v],m={key:y.key,name:y.name},w=await Dt(y.key);w&&(w.name?m.name=w.name:m.name="-",w.update_time?m.updateTime=new Date(w.update_time).toLocaleString():m.updateTime="-",w.cpu_usage?m.cpuUsage=Number(w.cpu_usage):m.cpuUsage=0,w.mem_usage?m.memUsage=w.mem_usage/(1024*1024*1024):m.memUsage=0,w.mem_total?m.memTotal=w.mem_total/(1024*1024*1024):m.memTotal=0,m.memTotal>0?m.memPercent=Math.round(m.memUsage/m.memTotal*1e4)/100:m.memPercent=0,m.avgMessage=w.avg_message,d[y.key]?(m.cpuUsageFrom=d[y.key].cpuUsage,m.memPercentFrom=d[y.key].memPercent,m.memUsageFrom=d[y.key].memUsage,m.memTotalFrom=d[y.key].memTotal):(m.cpuUsageFrom=0,m.memPercentFrom=0,m.memUsageFrom=0,m.memTotalFrom=0),_.push(m))}o.value=_},f=async()=>{await T(),s.value=!1,await h(),l.value=!1};return ne(async()=>{o.value=[],a.value=[],l.value=!0,s.value=!0,await f(),i=setInterval(()=>{f()},5e3)}),ht(()=>{clearInterval(i)}),(r,d)=>{const _=oa,v=me,y=de,m=ge;return L(),J(Q,null,[t(y,{title:"接口状态",class:"judger-status"},{default:n(()=>[t(m,{loading:s.value},{default:n(()=>[z("div",Aa,[(L(!0),J(Q,null,ce(a.value,w=>(L(),M(y,{key:w.key,header:()=>b(w),class:"judge-status-judger"},{footer:n(()=>[z("span",null," 负载信息："+F(w.avgMessage),1)]),default:n(()=>[t(v,{class:"judge-status-judger"},{default:n(()=>[t(_,{title:"CPU使用率",value:w.cpuUsage,animation:{valueFrom:w.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(_,{title:"内存使用率",value:w.memPercent,animation:{valueFrom:w.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(_,{title:"内存使用量",animation:{valueFrom:w.memUsageFrom,duration:2e3},"animation-start":!0,value:w.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(_,{title:"内存总量",value:w.memTotal,animation:{valueFrom:w.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1},8,["loading"])]),_:1}),t(y,{title:"判题机状态",class:"judger-status"},{default:n(()=>[t(m,{loading:l.value},{default:n(()=>[z("div",Ea,[(L(!0),J(Q,null,ce(o.value,w=>(L(),M(y,{key:w.key,header:()=>b(w),class:"judge-status-judger"},{footer:n(()=>[z("span",null," 负载信息："+F(w.avgMessage),1)]),default:n(()=>[t(v,{class:"judge-status-judger"},{default:n(()=>[t(_,{title:"CPU使用率",value:w.cpuUsage,animation:{valueFrom:w.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(_,{title:"内存使用率",value:w.memPercent,animation:{valueFrom:w.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(_,{title:"内存使用量",animation:{valueFrom:w.memUsageFrom,duration:2e3},"animation-start":!0,value:w.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(_,{title:"内存总量",value:w.memTotal,animation:{valueFrom:w.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1},8,["loading"])]),_:1})],64)}}}),ee=(e,a)=>{const o=e.__vccOpts||e;for(const[s,l]of a)o[s]=l;return o},$t=ee(Ma,[["__scopeId","data-v-1fb43cc1"]]),qa={class:"sh-main"},Ga={class:"dida-swiper-div"},Na=ae({__name:"HomeView",setup(e){let a=null;const o=g(null),s=async()=>{o.value=await za()};return ne(async()=>{await s(),a=setInterval(()=>{s()},3e4)}),ht(()=>{clearInterval(a)}),(l,i)=>{const b=kt,T=ra,h=sa,f=de,r=he,d=Xe,_=ia,v=ua,y=be;return L(),M(y,null,{default:n(()=>[t(r,{span:8},{default:n(()=>[z("div",qa,[o.value?(L(),M(b,{key:0,style:{margin:"20px"},theme:o.value.theme},{default:n(()=>[S(F(o.value.content),1)]),_:1},8,["theme"])):ue("",!0),z("div",Ga,[t(h,{class:"dida-swiper"},{default:n(()=>[t(T,null,{default:n(()=>i[0]||(i[0]=[z("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1}),t(T,null,{default:n(()=>i[1]||(i[1]=[z("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1})]),_:1})]),t(f,{title:"正在完善，欢迎提供意见建议",style:{width:"500px",margin:"0 auto"}},{default:n(()=>i[2]||(i[2]=[z("p",null,[z("a",{href:"https://codeoj.cn/",target:"_blank"},"CodeOJ"),S("的迁移计划")],-1),z("p",null,"正在开发中",-1)])),_:1})])]),_:1}),t(r,{span:4},{default:n(()=>[t($t),t(f,{style:{margin:"10px"},bordered:!0},{header:n(()=>i[3]||(i[3]=[z("b",null,"友情链接",-1)])),default:n(()=>[t(v,null,{default:n(()=>[t(_,null,{default:n(()=>[t(d,{href:"https://boiltask.com",target:"_blank"},{default:n(()=>i[4]||(i[4]=[S("BoilTask Blog")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),Ha=ee(Na,[["__scopeId","data-v-e23a1f85"]]),Oa={class:"sh-main"},Ka=ae({__name:"View404",setup(e){let a=pe(),o=g(a.fullPath);return(s,l)=>{const i=G;return L(),J("div",Oa,[z("p",null,F(oe(o)),1),l[2]||(l[2]=z("p",null,"该页面无效或已被迁移，请重新选择访问目标",-1)),t(i,{theme:"primary",onClick:l[0]||(l[0]=()=>s.$router.push("/"))},{default:n(()=>l[1]||(l[1]=[S("返回首页")])),_:1})])}}}),zt=ee(Ka,[["__scopeId","data-v-d4218944"]]);let ot=null;async function Ba(){ot=await Wa()}function Ja(e,a="zh"){if(ot==null)return[!1,e.toString()];const o=ot[e.toString()];if(!o)return[!1,e.toString()];let s=o[a];return s||(a="zh",s=o[a]),s?[!0,s]:[!1,e.toString()]}async function Wa(){return new Promise((e,a)=>{e({404:{zh:"接口未找到"},1e3:{zh:"系统错误"},10001:{zh:"权限异常，请重新登陆后再试"},10002:{zh:"参数不符合要求"},10003:{zh:"未找到目标数据"},100001:{zh:"用户名不存在或密码不匹配"}})})}function ie(){const{appContext:e}=Jt();return{globalProperties:e.config.globalProperties}}function Ie(){return 1e3}function Rt(e,a,o=3e3){e.$message.success({duration:o,content:a})}function _e(e,a,o=3e3){e.$message.info({duration:o,content:a})}function fe(e,a,o=3e3){e.$message.error({duration:o,content:a})}function N(e,a,o=3e3){const[s,l]=Ja(a),i=s?l:`系统错误，错误提示[${l}]`;e.$message.error({duration:o,content:i})}const Xa={class:"dida-login-footer"},Ya=ae({__name:"LoginView",setup(e){const{globalProperties:a}=ie(),o=ve(),s=g(!1),l=g({account:"",password:""}),i=()=>{_e(a,"重置成功")},b=({validateResult:T,firstError:h})=>{s.value||xt(l.value.account,l.value.password).then(f=>{if(f.code===0){o.loadResponse(f.data),_e(a,"登录成功");let r=a.$route.query.redirect_uri;r||(r="/user/"+f.data.username),a.$router.push({path:r})}else N(a,f.code)}).catch(f=>{console.error("Login error",f),fe(a,"登录失败")})};return ne(()=>{if(o.isLogin()){a.$router.push({path:"/user"});return}}),(T,h)=>{const f=ke,r=Le,d=G,_=Pe,v=Xe,y=de;return L(),M(y,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:n(()=>[t(_,{ref:"form",data:l.value,colon:!0,onReset:i,onSubmit:b,class:"yj-login-form","label-width":0},{default:n(()=>[t(r,{name:"account"},{default:n(()=>[t(f,{modelValue:l.value.account,"onUpdate:modelValue":h[0]||(h[0]=m=>l.value.account=m),clearable:"",placeholder:"请输入账户名"},{"prefix-icon":n(()=>[t(oe(bt))]),_:1},8,["modelValue"])]),_:1}),t(r,{name:"password"},{default:n(()=>[t(f,{modelValue:l.value.password,"onUpdate:modelValue":h[1]||(h[1]=m=>l.value.password=m),type:"password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":n(()=>[t(oe(Be))]),_:1},8,["modelValue"])]),_:1}),t(r,null,{default:n(()=>[t(d,{theme:"primary",type:"submit",block:"",loading:s.value},{default:n(()=>h[4]||(h[4]=[S("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),z("div",Xa,[t(v,{onClick:h[2]||(h[2]=()=>{oe(a).$router.push({name:"login-forget"})})},{default:n(()=>h[5]||(h[5]=[S("忘记密码")])),_:1}),t(v,{onClick:h[3]||(h[3]=()=>{oe(a).$router.push({name:"register"})})},{default:n(()=>h[6]||(h[6]=[S("注册账户")])),_:1})])]),_:1})}}}),Za=ee(Ya,[["__scopeId","data-v-9450941b"]]),Qa={};function en(e,a){return" TODO "}const tn=ee(Qa,[["render",en]]),an={class:"dida-login-footer"},nn=ae({__name:"RegisterView",setup(e){const{globalProperties:a}=ie(),o=ve(),s=g(!1),l=g({account:"",password:"",confirmPassword:"",email:""}),i=()=>{_e(a,"重置成功")},b=({validateResult:T,firstError:h})=>{s.value||xt(l.value.account,l.value.password).then(f=>{if(f.code===0){o.loadResponse(f.data),_e(a,"登录成功");let r=a.$route.query.redirect_uri;r||(r="/user/"+f.data.username),a.$router.push({path:r})}else N(a,f.code)}).catch(f=>{console.error("Login error",f),fe(a,"登录失败")})};return ne(()=>{if(o.isLogin()){a.$router.push({path:"/user"});return}}),(T,h)=>{const f=ke,r=Le,d=G,_=Pe,v=Xe,y=de;return L(),M(y,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:n(()=>[t(_,{ref:"form",data:l.value,colon:!0,onReset:i,onSubmit:b,class:"yj-login-form","label-width":0},{default:n(()=>[t(r,{name:"account"},{default:n(()=>[t(f,{modelValue:l.value.account,"onUpdate:modelValue":h[0]||(h[0]=m=>l.value.account=m),clearable:"",placeholder:"请输入账户名"},{"prefix-icon":n(()=>[t(oe(bt))]),_:1},8,["modelValue"])]),_:1}),t(r,{name:"password"},{default:n(()=>[t(f,{modelValue:l.value.password,"onUpdate:modelValue":h[1]||(h[1]=m=>l.value.password=m),type:"password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":n(()=>[t(oe(Be))]),_:1},8,["modelValue"])]),_:1}),t(r,{name:"confirm-password"},{default:n(()=>[t(f,{modelValue:l.value.confirmPassword,"onUpdate:modelValue":h[2]||(h[2]=m=>l.value.confirmPassword=m),type:"password",clearable:"",placeholder:"请确认密码"},{"prefix-icon":n(()=>[t(oe(Be))]),_:1},8,["modelValue"])]),_:1}),t(r,{name:"email"},{default:n(()=>[t(f,{modelValue:l.value.email,"onUpdate:modelValue":h[3]||(h[3]=m=>l.value.email=m),type:"password",clearable:"",placeholder:"邮箱"},{"prefix-icon":n(()=>[t(oe(Be))]),_:1},8,["modelValue"])]),_:1}),t(r,null,{default:n(()=>[t(d,{theme:"primary",type:"submit",block:"",loading:s.value},{default:n(()=>h[5]||(h[5]=[S("注册")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),z("div",an,[t(v,{onClick:h[4]||(h[4]=()=>{oe(a).$router.push({name:"login"})})},{default:n(()=>h[6]||(h[6]=[S("返回登陆")])),_:1})])]),_:1})}}}),on=ee(nn,[["__scopeId","data-v-e840b450"]]),rt=[{name:"home",path:"/",title:"首页",showSidebar:!1,disableGenerateTab:!0,component:Ha},{name:"problem",path:"/problem",title:"题目",icon:"calculation",showSidebar:!0,redirect:"problem-list"},{name:"judge",path:"/judge",title:"评测",icon:"code",showSidebar:!0,redirect:"judge-list"},{name:"contest",path:"/contest",title:"比赛",icon:"application",showSidebar:!0,redirect:"contest-list"},{name:"contest-detail-tab",title:"比赛",path:"/contest",showSidebar:!0,disableGenerateTab:!0,redirect:"contest-list"},{name:"discuss",title:"讨论",path:"/discuss",icon:"sonic",showSidebar:!0,redirect:"discuss-list"},{name:"system",path:"/system",title:"系统",icon:"dashboard",showSidebar:!0,redirect:"system-status"},{name:"manage",path:"/manage",title:"管理",icon:"command",showSidebar:!0,redirect:"manage-judge",auths:[Ce.Manage]},{name:"login",path:"/login",title:"登陆",showSidebar:!1,disableGenerateTab:!0,component:Za},{name:"register",path:"/register",title:"注册",showSidebar:!1,disableGenerateTab:!0,component:on},{name:"user",path:"/user/:username+",title:"用户",showSidebar:!1,needLogin:!0,disableGenerateTab:!0,component:tn},{name:"404",path:"/404",title:"404",showSidebar:!1,disableGenerateTab:!0,component:zt}],ln=e=>rt.find(a=>a.name==e),sn=e=>{const a=[];return rt.forEach(o=>{!o.disableGenerateTab&&e.hasAllAuths(o.auths)&&a.push(o)}),a},rn=e=>{rt.forEach(a=>{const o={name:a.name,path:a.path,meta:{title:a.title,tab:a.name,showSidebar:a.showSidebar,needLogin:a.needLogin,redirect:a.redirect,tabAuths:a.auths},component:a.component};e.push(o)})},un=ae({__name:"HeaderContent",setup(e){const a=Vt(),o=ve(),{globalProperties:s}=ie(),l=g(a.isLoaded),i=g(!1),b=g(o.getUsername),T=g(o.getNickname),h=g(),f=()=>{h.value=sn(o)};a.$subscribe((_,v)=>{l.value=v.Loaded}),o.$subscribe((_,v)=>{b.value=v.username,T.value=v.nickname,i.value=v.token!="",f()});const r=()=>{s.$router.currentRoute.value.name!=="login"&&s.$router.push({name:"login",query:{redirect_uri:s.$router.currentRoute.value.fullPath}})},d=()=>{o.clear(),s.$message.success({duration:3e3,content:"注销成功"}),s.$router.push({path:"/login",query:{redirect_uri:s.$router.currentRoute.value.fullPath}})};return ne(()=>{f()}),(_,v)=>{const y=yt("router-link"),m=Ct,w=St,R=ca,O=da;return L(),M(O,{modelValue:_.$route.meta.tab,"onUpdate:modelValue":v[0]||(v[0]=j=>_.$route.meta.tab=j),class:"sh-menu","expand-type":"popup"},{logo:n(()=>[t(y,{to:"/",class:"sh-logo"},{default:n(()=>v[1]||(v[1]=[S("DidaOJ")])),_:1})]),operations:n(()=>[l.value&&i.value?(L(),M(R,{key:0,title:T.value},{icon:n(()=>[t(m,{name:"user"})]),default:n(()=>[t(w,{value:"user",to:{path:"/user/"+b.value}},{default:n(()=>v[2]||(v[2]=[S("个人空间")])),_:1},8,["to"]),t(w,{value:"user_logout",onClick:d},{default:n(()=>v[3]||(v[3]=[S(" 注销")])),_:1})]),_:1},8,["title"])):l.value?(L(),M(w,{key:2,value:"login",onClick:r},{icon:n(()=>[t(m,{name:"login"})]),default:n(()=>[v[5]||(v[5]=S(" 登录 "))]),_:1})):(L(),M(w,{key:1,value:"login"},{icon:n(()=>[t(m,{name:"login"})]),default:n(()=>[v[4]||(v[4]=S(" ... "))]),_:1}))]),default:n(()=>[(L(!0),J(Q,null,ce(h.value,j=>(L(),M(w,{key:j.name,value:j.name,to:{name:j.name}},{icon:n(()=>[j.icon?(L(),M(m,{key:0,name:j.icon},null,8,["name"])):ue("",!0)]),default:n(()=>[S(" "+F(j.title),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])}}}),cn=ee(un,[["__scopeId","data-v-c64d812f"]]);function Ut(e){return e.children!==void 0}function dn(e){return e.children!==void 0}const mn={id:"menu-container"},pn=ae({__name:"SidebarContent",setup(e){const a=Ye(),o=g(!1),s=g(null),l=g(a.menuActiveName),i=g(a.menuList),b=g([]),T=g(!1),h=()=>{l.value=a.menuActiveName;const r=JSON.stringify(i.value),d=JSON.stringify(a.menuList);r!==d&&(b.value.push([...a.menuList]),f())},f=async()=>{if(b.value.length>0&&!T.value){for(T.value=!0;b.value.length>1;)b.value.shift();const r=b.value.shift();o.value=r.length<=0,i.value=[],await we(),s.value&&s.value.updateActiveName(),await new Promise(_=>setTimeout(_,300)),i.value=r,await we(),s.value&&s.value.updateActiveName();const d=300;await new Promise(_=>setTimeout(_,d)),T.value=!1,await f()}};return a.$subscribe((r,d)=>{h()}),ne(()=>{h()}),(r,d)=>{const _=Ct,v=St,y=pa,m=ma,w=ge;return L(),J(Q,null,[z("div",mn,[t(m,{modelValue:l.value,"onUpdate:modelValue":d[0]||(d[0]=R=>l.value=R),theme:"light",class:"sh-menu-container"},{default:n(()=>[t(Wt,{name:"move-left"},{default:n(()=>[(L(!0),J(Q,null,ce(i.value,(R,O)=>(L(),J(Q,{key:O},[oe(dn)(R)?(L(),M(y,{key:0,title:R.title},{default:n(()=>[(L(!0),J(Q,null,ce(R.children,(j,x)=>(L(),M(v,{key:j.name,value:j.name,to:j.to},at({default:n(()=>[S(" "+F(j.title),1)]),_:2},[j.icon?{name:"icon",fn:n(()=>[t(_,{name:j.icon,class:nt(j.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))),128))]),_:2},1032,["title"])):(L(),M(v,{key:R.name,value:R.name,to:R.to},at({default:n(()=>[S(" "+F(R.title),1)]),_:2},[R.icon?{name:"icon",fn:n(()=>[t(_,{name:R.icon,class:nt(R.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),t(w,{size:"small",loading:o.value,"show-overlay":!0,attach:"#menu-container",class:"sh-sidebar-loading",style:{"align-items":"flex-start","padding-top":"100px"}},null,8,["loading"])],64)}}}),fn=ee(pn,[["__scopeId","data-v-96e2d89f"]]),_n={};function gn(e,a){return null}const vn=ee(_n,[["render",gn]]),hn={class:"footer"},bn={class:"footer-left"},yn={class:"foot-time"},wn={class:"footer-center"},kn={href:"https://beiancx.miit.gov.cn/",target:"_blank"},Sn={class:"footer-right"},Cn={class:"foot-text"},In={href:"https://github.com/hpu-developer/DiDaOJ-web",target:"_blank"},Tn={class:"foot-text"},Pn={href:"https://github.com/hpu-developer/DiDaOJ-go",target:"_blank"},Ln=ae({__name:"FooterContent",setup(e){const a=g("");function o(){a.value=new Date().toLocaleString()}return ne(()=>{o(),setInterval(()=>{o()},1e3)}),(s,l)=>{const i=G;return L(),J("div",hn,[z("div",bn,[z("p",yn,F(a.value),1)]),z("div",wn,[z("a",kn,[t(i,{theme:"default",variant:"outline",ghost:!0},{default:n(()=>l[0]||(l[0]=[S("豫ICP备15024677号-4")])),_:1})])]),z("div",Sn,[z("p",Cn,[z("a",In,[t(i,{theme:"default",variant:"outline",ghost:!0},{default:n(()=>l[1]||(l[1]=[S("@didaoj-web")])),_:1})])]),z("p",Tn,[z("a",Pn,[t(i,{theme:"default",variant:"outline",ghost:!0},{default:n(()=>l[2]||(l[2]=[S("@didaoj-go")])),_:1})])])])])}}}),jn=ee(Ln,[["__scopeId","data-v-979fed79"]]),He=20,et=100,tt=50,xn=ae({__name:"ForceHiddenSidebarButton",setup(e){let a=Ye();const o=g({x:window.innerWidth-et-He,y:window.innerHeight-tt-He}),s=g(window.innerWidth),l=g(window.innerHeight);let i=!1,b={x:0,y:0};const T=R=>{i=!0;const O=R.clientX??R.touches[0].clientX,j=R.clientY??R.touches[0].clientY;b={x:O-o.value.x,y:j-o.value.y},document.addEventListener("mousemove",h),document.addEventListener("touchmove",h),document.addEventListener("mouseup",f),document.addEventListener("touchend",f)},h=R=>{if(!i)return;const O=R.clientX??R.touches[0].clientX,j=R.clientY??R.touches[0].clientY;let x=O-b.x,U=j-b.y;x=Math.max(0,Math.min(x,s.value-et)),U=Math.max(0,Math.min(U,l.value-tt)),o.value={x,y:U}},f=()=>{i=!1,document.removeEventListener("mousemove",h),document.removeEventListener("touchmove",h),document.removeEventListener("mouseup",f),document.removeEventListener("touchend",f)},r=()=>{s.value=window.innerWidth,l.value=window.innerHeight,o.value={x:Math.min(o.value.x,s.value-et-He),y:Math.min(o.value.y,l.value-tt-He)}};let d=g(a.forceHiddenSidebar),_=g(a.forceHiddenSidebar);const v=()=>{d.value=!d.value,a.setForceHiddenSidebar(d.value)},y=()=>{_.value||(_.value=!0,a.setForceHiddenSidebar(d.value))},m=()=>{_.value&&(_.value=!1,a.setForceHiddenSidebar(!1))},w=R=>{R>=800?m():y()};return w(s.value),$e(s,R=>{w(R)}),ne(()=>{window.addEventListener("resize",r)}),Te(()=>{window.removeEventListener("resize",r)}),(R,O)=>{const j=G;return oe(_)?(L(),M(j,{key:0,class:"draggable-button",style:wt({top:`${o.value.y}px`,left:`${o.value.x}px`}),onMousedown:T,onTouchstart:T,variant:"dashed",theme:"primary",onClick:v},{default:n(()=>[S(F(oe(d)?"显示":"隐藏"),1)]),_:1},8,["style"])):ue("",!0)}}}),Vn=ee(xn,[["__scopeId","data-v-1aee5506"]]),Dn={class:"sh-main"},$n=ae({__name:"View403",setup(e){let a=pe();const o=g("");return ne(()=>{a.query.target?o.value=a.query.target:o.value=a.fullPath}),(s,l)=>{const i=G;return L(),J("div",Dn,[z("p",null,F(o.value),1),l[2]||(l[2]=z("p",null,"该页面无访问权限，请更换访问目标或重新登陆后再试",-1)),t(i,{theme:"primary",onClick:l[0]||(l[0]=()=>s.$router.push("/"))},{default:n(()=>l[1]||(l[1]=[S("返回首页")])),_:1})])}}}),At=ee($n,[["__scopeId","data-v-8f62f1f8"]]),Oe="DidaOJ",zn=ae({__name:"App",setup(e){const{globalProperties:a}=ie(),o=Vt(),s=ve(),l=xe(),i=Ye();o.$patch({Loaded:!1});const b=s.getToken,T=g(!1),h=g(!1);l.title&&l.title.length>0?document.title=l.title+" - "+Oe:document.title=Oe,l.$subscribe((_,v)=>{v.title&&v.title.length>0?document.title=v.title+" - "+Oe:document.title=Oe}),i.$subscribe((_,v)=>{T.value=v.showSidebar,h.value=T.value&&!v.forceHiddenSidebar});const f=pe(),r=Se(()=>{const _=f.meta.auths;return _?!s.hasAllAuths(_):!1});function d(){a.$message.warning({duration:3e3,content:"登陆状态失效"}),o.$patch({Loaded:!0}),s.clear()}return ne(()=>{if(b==""){o.$patch({Loaded:!0});return}$a().then(_=>{_.code==0?(s.loadResponse(_.data),o.$patch({Loaded:!0})):(N(a,_.code),o.$patch({Loaded:!0}),s.clear())}).catch(_=>{console.log(_),d()})}),(_,v)=>{const y=fa,m=ga,w=yt("RouterView"),R=va,O=_a,j=ha;return L(),J(Q,null,[t(O,null,{default:n(()=>[t(y,{class:"sh-header"},{default:n(()=>[t(cn)]),_:1}),t(O,null,{default:n(()=>[t(Xt,{name:"slide"},{default:n(()=>[h.value?(L(),M(m,{key:0,class:"sh-sidebar"},{default:n(()=>[t(fn)]),_:1})):ue("",!0)]),_:1}),t(O,{class:nt(["sh-main-layout",{expanded:!h.value}])},{default:n(()=>[t(vn),t(R,{class:"sh-main-content"},{default:n(()=>[r.value?(L(),M(At,{key:0})):(L(),M(w,{key:1}))]),_:1}),t(jn)]),_:1},8,["class"])]),_:1})]),_:1}),T.value?(L(),M(Vn,{key:0})):ue("",!0),t(j,{container:"body",offset:["24px","80px"],size:"small"})],64)}}}),Rn=ee(zn,[["__scopeId","data-v-9e122cb4"]]);var Et=(e=>(e[e.Unknown=-1]="Unknown",e[e.C=0]="C",e[e.Cpp=1]="Cpp",e[e.Java=2]="Java",e[e.Python=3]="Python",e[e.Pascal=4]="Pascal",e[e.Golang=5]="Golang",e[e.Max=6]="Max",e))(Et||{});function Ft(){const e=[-1,4,5,6];return Object.values(Et).filter(a=>typeof a=="number"&&!e.includes(a)).map(a=>({value:a,label:Mt(a)}))}function Un(e){return e>-1&&e<6}function Mt(e){switch(e){case 0:return"C";case 1:return"C++";case 2:return"Java";case 3:return"Python";case 4:return"Pascal";case 5:return"Golang";default:return"Unknown"}}function ut(e){switch(e){case 0:return"c";case 1:return"cpp";case 2:return"java";case 3:return"python";case 4:return"pascal";case 5:return"golang";default:return"text"}}var te=(e=>(e[e.Init=0]="Init",e[e.Rejudge=1]="Rejudge",e[e.Submitting=2]="Submitting",e[e.Queuing=3]="Queuing",e[e.Compiling=4]="Compiling",e[e.Running=5]="Running",e[e.Accept=6]="Accept",e[e.PE=7]="PE",e[e.WA=8]="WA",e[e.TLE=9]="TLE",e[e.MLE=10]="MLE",e[e.OLE=11]="OLE",e[e.RE=12]="RE",e[e.CE=13]="CE",e[e.CLE=14]="CLE",e[e.JudgeFail=15]="JudgeFail",e[e.SubmitFail=16]="SubmitFail",e[e.Unknown=17]="Unknown",e))(te||{});const An=e=>{switch(e){case 0:return"普通评测";case 1:return"特殊评测";default:return"未知"}},Je=e=>{switch(e){case 0:return"等待处理";case 1:return"重新评测";case 2:return"提交中";case 3:return"队列中";case 4:return"编译中";case 5:return"运行中";case 6:return"通过";case 7:return"格式错误";case 8:return"答案错误";case 9:return"超时";case 10:return"内存超限";case 11:return"输出超限";case 12:return"运行错误";case 13:return"编译错误";case 14:return"编译超限";case 15:return"评测失败";case 16:return"提交失败";case 17:return"未知";default:return e}};function En(){const e=[17];return Object.values(te).filter(a=>typeof a=="number"&&!e.includes(a)).map(a=>({value:a,label:Je(a)}))}function Ve(e){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return!0;default:return!1}}function qt(e){var o;const a={};if(a.id=e.id,a.problemId=e.problem_id,a.status=e.status,Ve(e.status)?a.score="-":a.score=e.score.toString(),e.time?a.time=Math.ceil(e.time/1e6)+"ms":a.time="-",e.memory?a.memory=(e.memory/1024/1024).toFixed(2)+"MB":a.memory="-",a.language=Mt(e.language),a.codeLength=e.code_length,e.approve_time?a.approveTime=new Date(e.approve_time).toLocaleString():a.approveTime="-",a.author=e.author,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.code=e.code,a.compileMessage=e.compile_message,a.taskCurrent=e.task_current,a.taskTotal=e.task_total,a.task=[],e.task)for(let s=0;s<((o=e.task)==null?void 0:o.length);s++){const l=e.task[s],i={};i.taskId=l.task_id,i.status=l.status,l.time?i.time=Math.ceil(l.time/1e6)+"ms":i.time="-",l.memory?i.memory=(l.memory/1024/1024).toFixed(2)+"MB":i.memory="-",i.score=l.score,i.content=l.content,i.waHint=l.wa_hint,!i.content&&!i.waHint&&(i.content="无提示信息"),a.task.push(i)}return e.judger&&(a.judger=e.judger),e.judge_time&&(a.judgeTime=new Date(e.judge_time).toLocaleString()),a}function Fn(e,a,o,s,l){return Y({url:"/judge/approve",method:"post",data:{problem_id:e,contest_id:a,problem_index:o,language:s,code:l}})}function Mn(e){return Y({url:"/judge?id="+e,method:"get"})}function qn(e){return Y({url:"/judge/code?id="+e,method:"get"})}function Gn(e,a,o,s,l,i){const b=new URLSearchParams({problem_id:e,username:a,language:String(o),status:String(s),page:String(l),page_size:String(i)});return Y({url:`/judge/list?${b.toString()}`,method:"get"})}function Nn(){return Y({url:"/judge/rejudge/recently",method:"post"})}function Hn(e){return Y({url:"/judge/rejudge/problem",method:"post",data:{id:e}})}function On(){return Y({url:"/judge/rejudge/all",method:"post",timeout:0})}function Kn(e){return Y({url:"/judge/rejudge",method:"post",data:{id:Number(e)}})}var lt=(e=>(e[e.None=0]="None",e[e.Attempt=1]="Attempt",e[e.Accept=2]="Accept",e))(lt||{});function Ze(e,a){const o={};if(o.id=e.id,o.author=e.author,o.title=e.title,o.tags=[],e.tags)for(const s of e.tags){const l=a[s];l&&o.tags.push(l)}return o.accept=e.accept,o.attempt=e.attempt,e.description!=null&&(o.description=e.description),e.time_limit!=null&&(o.timeLimit=e.time_limit.toString()+" ms"),e.memory_limit!=null&&(o.memoryLimit=(e.memory_limit/1024).toFixed(2)+" MB"),e.judge_type!=null&&(o.judgeType=An(e.judge_type)),e.insert_time!=null&&(o.insertTime=new Date(e.insert_time).toLocaleString()),e.update_time!=null&&(o.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(o.creatorNickname=e.creator_nickname),e.source!=null&&(o.source=e.source),e.judge_md5!=null&&(o.judgeMd5=e.judge_md5),o}function Gt(e,a,o){const s={};return e?s.id=e:(s.contest_id=a,s.problem_index=o),Y({url:`/problem?${new URLSearchParams(s).toString()}`,method:"get"})}function Nt(e){return Y({url:"/problem/tag/list?max_count="+e,method:"get"})}function Bn(e){return Y({url:"/problem/judge?id="+e,method:"get"})}function Jn(e,a,o,s){return Y({url:"/problem/list?title="+e+"&tag="+a+"&page="+o+"&page_size="+s,method:"get"})}function Wn(e,a,o,s,l,i,b){return Y({url:"/problem/edit",method:"post",data:{id:e,title:a,time_limit:o,memory_limit:s,source:l,tags:i,description:b}})}function Xn(e,a){return Y({url:"/problem/judge/data/download?id="+e+"&key="+a,method:"get"})}function Yn(e,a){const o=new FormData;return o.append("id",e),o.append("zip",a),Y({url:"/problem/judge/data",method:"post",data:o,headers:{"Content-Type":"multipart/form-data"},timeout:1e3*60*5})}const Zn={style:{margin:"10px"}};function Qn(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Fe(e)}const eo=ae({__name:"ProblemList",setup(e){const a=pe(),o=Me(),{globalProperties:s}=ie();let l=null;const i=g(!1),b={};let T={};const h=g([{title:"ID",colKey:"id",cell:(C,D)=>{let V=R(D.row.id);return t(G,{variant:"dashed",theme:V,onClick:()=>w(D.row.id)},{default:()=>[D.row.id]})}},{title:"标题",colKey:"title",cell:(C,D)=>t(G,{variant:"text",onClick:()=>w(D.row.id)},{default:()=>[D.row.title]})},{title:"标签",colKey:"tags",cell:(C,D)=>{const V=D.row.tags;if(!V||V.length===0)return"";let k=[];for(let c=0;c<V.length;c++){const u=V[c];k.push(t(G,{key:c,theme:"default",variant:"outline"},{default:()=>[u.name]}))}return t(me,null,Qn(k)?k:{default:()=>[k]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),f=g(!1);let r=1,d=50;const _=g({current:r,pageSize:d,defaultCurrent:r,defaultPageSize:d,total:0,pageSizeOptions:[50,100]}),v=g(),y=g(),m=g({title:"",tag:""}),w=C=>{C&&o.push({path:"/problem/"+C})},R=C=>{if(!C||!T)return"default";const D=T[C];if(!D)return"default";switch(D){case lt.Accept:return"success";case lt.Attempt:return"warning";default:return"default"}},O=async()=>{await o.push({query:{...a.query,title:m.value.title,tag:m.value.tag,page:1,page_size:_.value.defaultPageSize}})},j=C=>{C&&o.push({query:{...a.query,title:"",tag:C.name,page:1,page_size:_.value.defaultPageSize}})},x=async(C,D)=>{f.value=!0;try{const{current:V,pageSize:k}=C,c=await Jn(m.value.title,m.value.tag,V,k);if(v.value=[],c.code===0){const u=c.data.list;if(!u||u.length<=0){_.value={..._.value,total:0},T=null,_e(s,"未找到记录");return}u.forEach(p=>{var P;const I=Ze(p,b);(P=v.value)==null||P.push(I)}),_.value={..._.value,total:c.data.total_count},T=c.data.problem_attempt_status}else D&&N(s,c.code)}catch(V){console.error(V),N(s,Ie())}finally{f.value=!1}},U=async C=>{await o.push({query:{...a.query,page:C.current,page_size:C.pageSize}})};return ne(async()=>{f.value=!0,y.value=[],Nt(-1).then(C=>{if(C.code===0){y.value=C.data.list,i.value=C.data.total_count>C.data.list.length;for(let D=0;D<C.data.list.length;D++){const V=C.data.list[D];b[V.id]=V}l=$e(()=>a.query,D=>{m.value.title=D.title||"",m.value.tag=D.tag||"";const V=parseInt(D.page)||_.value.defaultCurrent,k=parseInt(D.page_size)||_.value.defaultPageSize;r=V,d=k,_.value={..._.value,current:r,pageSize:d},x({current:r,pageSize:d},!0)},{immediate:!0})}else i.value=!0}).catch(C=>{console.error(C),i.value=!0})}),Te(()=>{l&&l()}),(C,D)=>{const V=je,k=de,c=he,u=ke,p=Le,I=G,P=Pe,E=be;return L(),M(E,null,{default:n(()=>[t(c,{span:9},{default:n(()=>[t(k,{style:{margin:"10px"}},{default:n(()=>[t(V,{data:v.value,columns:h.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:_.value,loading:f.value,onPageChange:U},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(c,{span:3},{default:n(()=>[z("div",Zn,[t(k,{class:"sh-card"},{default:n(()=>[t(P,{model:m.value},{default:n(()=>[t(p,{label:"标题"},{default:n(()=>[t(u,{modelValue:m.value.title,"onUpdate:modelValue":D[0]||(D[0]=A=>m.value.title=A),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(p,{label:"标签"},{default:n(()=>[t(u,{modelValue:m.value.tag,"onUpdate:modelValue":D[1]||(D[1]=A=>m.value.tag=A),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(p,null,{default:n(()=>[t(I,{theme:"primary",onClick:O},{default:n(()=>D[3]||(D[3]=[S("搜索")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(k,{class:"sh-card sh-background-black"},{default:n(()=>[(L(!0),J(Q,null,ce(y.value,A=>(L(),M(I,{class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:()=>j(A)},{default:n(()=>[S(F(A.name),1)]),_:2},1032,["onClick"]))),256)),i.value?(L(),M(I,{key:0,class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:D[2]||(D[2]=()=>C.$router.push("/problem/tags"))},{default:n(()=>D[4]||(D[4]=[S(" ... ")])),_:1})):ue("",!0)]),_:1})])]),_:1})]),_:1})}}}),to=ee(eo,[["__scopeId","data-v-0d640f14"]]);function De(e){e.querySelectorAll("pre > code:not([data-copy-attached])").forEach(o=>{o.setAttribute("data-copy-attached","true");const s=o.parentElement,l=document.createElement("div");l.className="copy-wrapper";const i=document.createElement("button");i.className="copy-btn",i.innerText="复制",i.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(o.innerText),i.innerText="已复制",setTimeout(()=>i.innerText="复制",1500)}catch{i.innerText="失败"}}),s.replaceWith(l),l.appendChild(i),l.appendChild(s)})}function Qe(e){let a="";for(;e>0;)e--,a=String.fromCharCode(65+e%26)+a,e=Math.floor(e/26);return a}async function Ht(e){const a={};if(a.id=e.id,a.ownerId=e.owner_id,a.ownerUsername=e.owner_username,a.ownerNickname=e.owner_nickname,a.title=e.title,a.startTime=new Date(e.start_time).toLocaleString(),a.endTime=new Date(e.end_time).toLocaleString(),e.descriptions){a.descriptions=[];const o={math:{inlineDigit:!0,engine:"KaTeX"}};for(let s=0;s<e.descriptions.length;s++){const l=e.descriptions[s],i={};i.title=l.title,i.content=await le.md2html(l.content,o),i.sort=l.sort,a.descriptions.push(i)}}if(a.notification=e.notification,e.problems){a.problems=[],e.problems.sort((o,s)=>o.index-s.index);for(let o=0;o<e.problems.length;o++){const s=e.problems[o];s.accept||(s.accept=0),s.attempt||(s.attempt=0),s.id=Qe(s.index),a.problems.push(s)}}return a}function ao(e){return Y({url:"/contest?id="+e,method:"get"})}function no(e,a){return Y({url:"/contest/list?page="+e+"&page_size="+a,method:"get"})}function oo(e){return Y({url:"/contest/create",method:"post",data:e})}const lo=["innerHTML"],so={style:{margin:"12px"}},ro={key:0,class:"dida-edit-container"},uo={class:"dida-operation-container"},io={class:"dida-code-submit-div"},co=ae({__name:"ProblemDetail",setup(e){let a=pe();const{globalProperties:o}=ie(),s=xe(),l=ve();let i=g(""),b="",T=0,h=0;const f=g(null),r=g(!1),d=g(null);let _=null;const v=g(null),y={},m=g(""),w=g([]);w.value=Ft();const R=Se(()=>l.hasAuth(Ce.ManageProblem)),O=k=>{k&&H.push({name:"problem-list",query:{...a.query,title:"",tag:k.name}})},j=()=>{H.push({name:"manage-problem",params:{problemId:b}})},x=()=>{b?H.push({name:"judge-list",query:{problem_id:b}}):H.push({name:"contest-judge-list",params:{contestId:T,problemIndex:h}})},U=()=>{b?H.push({name:"discuss-list-problem",query:{problem_id:b}}):H.push({name:"contest-discuss",params:{contestId:T},query:{problem_id:Qe(h)}})},C=()=>{H.push({name:"problem-recommend",params:{problemId:b}})},D=async()=>{if(!b){fe(o,"问题ID无效");return}const k=parseInt(m.value);if(!Un(k)){fe(o,"请选择所编写的语言");return}const c=_==null?void 0:_.getValue();if(!c){fe(o,"请输入所需提交的代码");return}const u=await Fn(b,T,h,k,c);if(u.code!==0){N(o,u.code);return}_e(o,"提交成功，正在跳转到详情页面");const p=u.data.id;await H.push({path:"/judge/"+p})},V=k=>{_&&dt.setModelLanguage(_.getModel(),ut(k))};return ne(async()=>{if(Array.isArray(a.params.problemId)?b=a.params.problemId[0]:b=a.params.problemId,!b){if(Array.isArray(a.params.contestId)?T=a.params.contestId[0]:T=a.params.contestId,!T){fe(o,"题目不存在"),await H.push({name:"problem"});return}if(Array.isArray(a.params.problemIndex)?h=parseInt(a.params.problemIndex[0]):h=parseInt(a.params.problemIndex),!h){fe(o,"题目不存在"),await H.push({name:"problem"});return}}r.value=!0;let k=await Gt(b,T,h);if(k.code!==0){r.value=!1,N(o,k.code),await H.push({name:"problem"});return}k.data.tags&&k.data.tags.forEach(p=>{y[p.id]=p}),d.value=Ze(k.data.problem,y),s.setTitle(d.value.title+" - "+s.getTitle);let c=d.value.description;const u={math:{inlineDigit:!0,engine:"KaTeX"}};i.value=await le.md2html(c,u),await we(()=>{f.value&&(le.mathRender(f.value),le.highlightRender({lineNumber:!0,enable:!0},f.value),De(f.value),v.value&&(_=dt.create(v.value,{value:"",language:"cpp",minimap:{enabled:!0},colorDecorators:!0,readOnly:!1,theme:"vs-dark"}))),r.value=!1})}),(k,c)=>{const u=de,p=he,I=G,P=Re,E=me,A=ze,W=Tt,K=It,q=be,X=ge;return L(),M(X,{loading:r.value},{default:n(()=>[t(q,{class:"dida-main-content"},{default:n(()=>[t(p,{span:8},{default:n(()=>[t(u,{style:{margin:"10px"}},{default:n(()=>[z("div",{innerHTML:oe(i),ref_key:"markdownRef",ref:f},null,8,lo)]),_:1})]),_:1}),t(p,{span:4},{default:n(()=>[z("div",so,[R.value?(L(),J("div",ro,[t(I,{onClick:j},{default:n(()=>c[1]||(c[1]=[S("编辑")])),_:1})])):ue("",!0),t(A,{layout:"vertical",bordered:!0},{default:n(()=>[t(P,{label:"标题"},{default:n(()=>{var $;return[S(F(($=d.value)==null?void 0:$.title),1)]}),_:1}),t(P,{label:"时间限制"},{default:n(()=>{var $;return[S(F(($=d.value)==null?void 0:$.timeLimit),1)]}),_:1}),t(P,{label:"内存限制"},{default:n(()=>{var $;return[S(F(($=d.value)==null?void 0:$.memoryLimit),1)]}),_:1}),t(P,{label:"判题方式"},{default:n(()=>{var $;return[S(F(($=d.value)==null?void 0:$.judgeType),1)]}),_:1}),t(P,{label:"正确提交"},{default:n(()=>{var $;return[S(F(($=d.value)==null?void 0:$.accept),1)]}),_:1}),t(P,{label:"提交总数"},{default:n(()=>{var $;return[S(F(($=d.value)==null?void 0:$.attempt),1)]}),_:1}),t(P,{label:"创建时间"},{default:n(()=>{var $;return[S(F(($=d.value)==null?void 0:$.insertTime),1)]}),_:1}),t(P,{label:"更新时间"},{default:n(()=>{var $;return[S(F(($=d.value)==null?void 0:$.updateTime),1)]}),_:1}),t(P,{label:"上传用户"},{default:n(()=>{var $;return[S(F(($=d.value)==null?void 0:$.creatorNickname),1)]}),_:1}),t(P,{label:"题目来源"},{default:n(()=>{var $;return[S(F(($=d.value)==null?void 0:$.source),1)]}),_:1}),oe(b)?(L(),M(P,{key:0,label:"标签"},{default:n(()=>[t(E,null,{default:n(()=>{var $;return[(L(!0),J(Q,null,ce(($=d.value)==null?void 0:$.tags,se=>(L(),M(I,{key:se.id,variant:"dashed",onClick:()=>O(se)},{default:n(()=>[S(F(se.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})):ue("",!0)]),_:1}),z("div",uo,[t(E,null,{default:n(()=>[t(I,{onClick:x},{default:n(()=>c[2]||(c[2]=[S("提交记录")])),_:1}),t(I,{onClick:U},{default:n(()=>c[3]||(c[3]=[S("题目讨论")])),_:1}),oe(b)?(L(),M(I,{key:0,onClick:C},{default:n(()=>c[4]||(c[4]=[S("题目推荐")])),_:1})):ue("",!0)]),_:1})]),z("div",io,[t(E,null,{default:n(()=>[t(K,{modelValue:m.value,"onUpdate:modelValue":c[0]||(c[0]=$=>m.value=$),label:"语言：",placeholder:"请选择提交语言","auto-width":"",clearable:"",onChange:V},{default:n(()=>[(L(!0),J(Q,null,ce(w.value,$=>(L(),M(W,{key:$.value,value:$.value,label:$.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),t(I,{onClick:D},{default:n(()=>c[5]||(c[5]=[S("提交")])),_:1})]),_:1}),z("div",{ref_key:"codeEditRef",ref:v,class:"dida-code-editor"},null,512)])])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),mt=ee(co,[["__scopeId","data-v-2307df15"]]),mo={};function po(e,a){return" TODO "}const fo=ee(mo,[["render",po]]),_o=["innerHTML"];function go(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Fe(e)}const vo=ae({__name:"JudgeJobList",setup(e){const a=pe(),o=Me(),{globalProperties:s}=ie();let l=!1,i=null;const b=g(!1),T=g(null),h=g(null),f=g(!1),r=g({problemId:"",username:"",language:void 0,status:void 0}),d=g([{title:"ID",colKey:"id",cell:(u,p)=>t(G,{variant:"text",onClick:()=>U(p.row.id)},{default:()=>[p.row.id]})},{title:"问题",colKey:"problemId",cell:(u,p)=>t(G,{variant:"text",onClick:()=>x(p.row.problemId)},{default:()=>[p.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(u,p)=>{const I=p.row.status,P=Je(I);let E;switch(I){case te.Init:case te.Rejudge:case te.Compiling:case te.Running:E="default";break;case te.Accept:E="success";break;case te.PE:E="warning";break;default:E="danger";break}let A=[];return Ve(I)&&A.push(t(ge,{text:p.row.state,size:"small",class:"dida-status-loading"},null)),A.push(t("span",null,[P])),t(G,{theme:E,variant:"outline",onClick:()=>U(p.row.id)},go(A)?A:{default:()=>[A]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"code",cell:(u,p)=>t(G,{theme:"default",onClick:()=>j(p.row)},{default:()=>[p.row.language+" / "+p.row.codeLength]})},{title:"作者",colKey:"author",width:200,cell:(u,p)=>t(G,{variant:"text",onClick:()=>C(p.row.authorUsername)},{default:()=>[p.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),_=g(!1);let v=1,y=50;const m=g({current:v,pageSize:y,defaultCurrent:v,defaultPageSize:y,total:0,pageSizeOptions:[50,100]}),w=g(),R=g([]);R.value=Ft();const O=g([]);O.value=En();const j=async u=>{f.value=!0,b.value=!0;try{T.value=u;const p=await qn(T.value.id);if(p.code===0){const I=p.data,E=`\`\`\`${ut(I.language)}
${I.code}
\`\`\``,A={};T.value.code=await le.md2html(E,A),await we(()=>{h.value&&(le.highlightRender({lineNumber:!0,enable:!0},h.value),De(h.value))})}else N(s,p.code)}finally{f.value=!1}},x=u=>{u&&o.push({path:"/problem/"+u})},U=u=>{u&&o.push({name:"judge-detail",params:{judgeId:u}})},C=u=>{u&&o.push({path:"/user/"+u})},D=async()=>{await o.push({query:{...a.query,page:1,page_size:y,problem_id:r.value.problemId,username:r.value.username,language:r.value.language,status:r.value.status}})},V=async()=>{r.value.problemId="",r.value.username="",r.value.language=void 0,r.value.status=void 0,await o.push({query:{...a.query,page:1,page_size:y,problem_id:"",username:"",language:void 0,status:void 0}})},k=async(u,p)=>{p&&(_.value=!0);let I=!1;try{const{current:P,pageSize:E}=u,A=await Gn(r.value.problemId,r.value.username,r.value.language,r.value.status,P,E);w.value=[],A.code===0?A.data.list&&A.data.list.length>0?(A.data.list.forEach(K=>{var X;const q=qt(K);(X=w.value)==null||X.push(q),Ve(K.status)&&(I=!0)}),m.value={...m.value,total:A.data.total_count}):(_e(s,"未找到记录"),m.value={...m.value,total:0}):p&&N(s,A.code)}catch(P){console.error(P),p&&N(s,Ie())}finally{p&&(_.value=!1),I&&l&&setTimeout(()=>{k({current:v,pageSize:y},!1)},5e3)}},c=async u=>{await o.push({query:{...a.query,page:u.current,page_size:u.pageSize}})};return ne(async()=>{l=!0,i=$e(()=>a.query,u=>{r.value.problemId=u.problem_id||"",r.value.username=u.username||"",u.language!=null?r.value.language=Number(u.language):r.value.language=void 0,u.status!=null?r.value.status=Number(u.status):r.value.status=void 0;const p=parseInt(u.page)||m.value.defaultCurrent,I=parseInt(u.page_size)||m.value.defaultPageSize;v=p,y=I,m.value.pageSizeOptions.includes(y)||(y=m.value.defaultPageSize),m.value={...m.value,current:v,pageSize:y},k({current:v,pageSize:y},!0)},{immediate:!0})}),Te(()=>{l=!1,i&&i()}),(u,p)=>{const I=ke,P=Le,E=Tt,A=It,W=G,K=me,q=Pe,X=je,$=de,se=Xe,Z=ge,re=st;return L(),J(Q,null,[t($,{style:{margin:"10px"}},{default:n(()=>[t(q,{layout:"inline",onSubmit:D,onReset:V},{default:n(()=>[t(P,{label:"题号"},{default:n(()=>[t(I,{modelValue:r.value.problemId,"onUpdate:modelValue":p[0]||(p[0]=B=>r.value.problemId=B),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(P,{label:"用户"},{default:n(()=>[t(I,{modelValue:r.value.username,"onUpdate:modelValue":p[1]||(p[1]=B=>r.value.username=B),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(P,{label:"语言"},{default:n(()=>[t(A,{modelValue:r.value.language,"onUpdate:modelValue":p[2]||(p[2]=B=>r.value.language=B),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:n(()=>[(L(!0),J(Q,null,ce(R.value,B=>(L(),M(E,{key:B.value,value:B.value,label:B.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(P,{label:"状态"},{default:n(()=>[t(A,{modelValue:r.value.status,"onUpdate:modelValue":p[3]||(p[3]=B=>r.value.status=B),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:n(()=>[(L(!0),J(Q,null,ce(O.value,B=>(L(),M(E,{key:B.value,value:B.value,label:B.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(P,null,{default:n(()=>[t(K,null,{default:n(()=>[t(W,{theme:"primary",type:"submit"},{default:n(()=>p[7]||(p[7]=[S("搜索")])),_:1}),t(W,{theme:"default",variant:"base",type:"reset"},{default:n(()=>p[8]||(p[8]=[S("重置")])),_:1})]),_:1})]),_:1})]),_:1}),t(X,{data:w.value,columns:d.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:m.value,loading:_.value,onPageChange:c,"table-layout":"auto"},null,8,["data","columns","pagination","loading"])]),_:1}),t(re,{visible:b.value,"onUpdate:visible":p[5]||(p[5]=B=>b.value=B),width:"800px","cancel-btn":null,"close-btn":!1,onConfirm:p[6]||(p[6]=B=>b.value=!1)},{header:n(()=>[t(se,{onClick:p[4]||(p[4]=()=>{var B;U((B=T.value)==null?void 0:B.id)})},{default:n(()=>{var B,Ue;return[S(F(((B=T.value)==null?void 0:B.id)+" - "+((Ue=T.value)==null?void 0:Ue.language)),1)]}),_:1})]),default:n(()=>[t(Z,{loading:f.value},{default:n(()=>{var B;return[z("div",{innerHTML:(B=T.value)==null?void 0:B.code,ref_key:"markdownCodeRef",ref:h,style:{"min-height":"100px"}},null,8,_o)]}),_:1},8,["loading"])]),_:1},8,["visible"])],64)}}}),ho=ee(vo,[["__scopeId","data-v-90a4dfd1"]]),bo=["innerHTML"],yo={key:2,class:"dida-edit-container"};function pt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Fe(e)}const wo=ae({__name:"JudgeJobDetail",setup(e){const a=pe(),o=Me(),s=ve(),{globalProperties:l}=ie();let i=!1,b=-1;const T=g(""),h=g(null),f=g(""),r=g(null),d=g(0),_=g(null),v=g({from:"#5a96ff",to:"#00A870"});let y=!1;const m=g([{title:"ID",colKey:"id"},{title:"问题",colKey:"problemId",cell:(k,c)=>t(G,{variant:"text",onClick:()=>U(c.row.problemId)},{default:()=>[c.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(k,c)=>{const u=c.row.status,p=Je(u);let I;switch(u){case te.Init:case te.Rejudge:case te.Compiling:case te.Running:I="default";break;case te.Accept:I="success";break;case te.PE:I="warning";break;default:I="danger";break}let P=[];return Ve(u)&&P.push(t(ge,{text:c.row.state,size:"small",class:"dida-status-loading"},null)),P.push(t("span",null,[p])),t(G,{theme:I,variant:"outline"},pt(P)?P:{default:()=>[P]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"language",cell:(k,c)=>t("span",null,[c.row.language+" / "+c.row.codeLength])},{title:"作者",colKey:"author",width:200,cell:(k,c)=>t(G,{variant:"text",onClick:()=>C(c.row.authorUsername)},{default:()=>[c.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),w=g(!1),R=g(!1),O=g(),j=Se(()=>s.hasAuth(Ce.ManageJudge)),x=async()=>{if(!R.value){R.value=!0;try{const k=await Kn(b);k.code===0?await V(!0):N(l,k.code)}catch(k){console.error(k),N(l,Ie())}finally{R.value=!1}}},U=k=>{k&&o.push({path:"/problem/"+k})},C=k=>{k&&o.push({path:"/user/"+k})},D=k=>{const c=k.status,u=Je(c);let p;switch(c){case te.Init:case te.Rejudge:case te.Compiling:case te.Running:p="default";break;case te.Accept:p="success";break;case te.PE:p="warning";break;default:p="danger";break}return t(me,null,{default:()=>[t(G,{theme:"default",variant:"outline"},{default:()=>[k.taskId]}),t(G,{theme:p,variant:"outline"},pt(u)?u:{default:()=>[u]}),t("span",null,[S("分数："),k.score]),t("span",null,[S("用时："),k.time]),t("span",null,[S("内存："),k.memory])]})},V=async k=>{var u;k&&(w.value=!0);let c=!1;try{const p=await Mn(b);if(O.value=[],p.code===0){const I=p.data,P=qt(I);if((u=O.value)==null||u.push(P),I.judger){const A=await Dt(I.judger);T.value=A.name}else T.value="";v.value.to="#00A870",Ve(I.status)?(_.value="active",P.taskTotal>0?(d.value=P.taskCurrent/P.taskTotal*100,P.taskCurrent>=P.taskTotal&&(d.value=99)):d.value=0):(d.value=100,I.status===te.Accept?_.value="success":I.status===te.PE?(v.value.to="#F57C20",_.value="warning"):(v.value.to="#F56C6C",_.value="error"));const E={};if(I.code){const W=`\`\`\`${ut(I.language)}
${I.code}
\`\`\``;f.value=await le.md2html(W,E),await we(()=>{r.value&&(y||(y=!0,le.highlightRender({lineNumber:!0,enable:!0},r.value)),De(r.value))})}h.value=P,Ve(I.status)&&(c=!0)}else k&&N(l,p.code)}catch(p){console.error(p),k&&N(l,Ie())}finally{k&&(w.value=!1),c&&i&&setTimeout(()=>{V(!1)},5e3)}};return ne(async()=>{if(i=!0,Array.isArray(a.params.judgeId)?b=a.params.judgeId[0]:b=a.params.judgeId,!b){await o.push({name:"judge"});return}await V(!0)}),Te(()=>{i=!1}),(k,c)=>{var $,se;const u=ba,p=je,I=de,P=he,E=Re,A=ze,W=be,K=Pt,q=Lt,X=G;return L(),J(Q,null,[t(u,{color:v.value,status:_.value,class:"dida-job-progress",percentage:d.value},null,8,["color","status","percentage"]),t(I,{style:{margin:"10px"}},{default:n(()=>[t(p,{data:O.value,columns:m.value,"row-key":"id","vertical-align":"top",hover:!0,loading:w.value},null,8,["data","columns","loading"])]),_:1}),t(W,null,{default:n(()=>[t(P,{span:8},{default:n(()=>[z("div",{innerHTML:f.value,ref_key:"markdownCodeRef",ref:r},null,8,bo)]),_:1}),t(P,{span:4},{default:n(()=>[t(A,{layout:"vertical",bordered:!0,style:{margin:"10px"}},{default:n(()=>[t(E,{label:"判题机"},{default:n(()=>[S(F(T.value),1)]),_:1}),t(E,{label:"判题时间"},{default:n(()=>{var Z;return[S(F((Z=h.value)==null?void 0:Z.judgeTime),1)]}),_:1})]),_:1})]),_:1})]),_:1}),($=h.value)!=null&&$.compileMessage?(L(),M(I,{key:0,class:"compile-message"},{default:n(()=>{var Z;return[S(F((Z=h.value)==null?void 0:Z.compileMessage),1)]}),_:1})):ue("",!0),((se=h.value)==null?void 0:se.task.length)>0?(L(),M(q,{key:1,class:"task-panel"},{default:n(()=>{var Z;return[(L(!0),J(Q,null,ce((Z=h.value)==null?void 0:Z.task,(re,B)=>(L(),M(K,{key:re.taskId,header:()=>D(re)},{default:n(()=>[S(F(re.content)+" "+F(re.waHint),1)]),_:2},1032,["header"]))),128))]}),_:1})):ue("",!0),j.value?(L(),J("div",yo,[t(X,{onClick:x,loading:R.value},{default:n(()=>c[0]||(c[0]=[S("重新评测")])),_:1},8,["loading"])])):ue("",!0)],64)}}}),ko=ee(wo,[["__scopeId","data-v-f13a425c"]]),So={style:{margin:"10px"}},Co=ae({__name:"ContestList",setup(e){const a=pe(),o=Me(),{globalProperties:s}=ie();let l=null;const i=g(!1),b=g(!1),T=g([{title:"ID",colKey:"id",width:"100",cell:(U,C)=>t(G,{variant:"text",onClick:()=>m(C.row.id)},{default:()=>[C.row.id]})},{title:"标题",colKey:"title",cell:(U,C)=>t(G,{variant:"text",onClick:()=>m(C.row.id)},{default:()=>[C.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),h=g(!1);let f=1,r=50;const d=g({current:f,pageSize:r,defaultCurrent:f,defaultPageSize:r,total:0,pageSizeOptions:[50,100]}),_=g(),v=g({title:"",username:""}),y=g({title:"",description:"",open_time:[]}),m=U=>{U&&o.push({path:"/contest/"+U})},w=async()=>{await o.push({query:{...a.query,title:v.value.title,username:v.value.username,page:1,page_size:d.value.defaultPageSize}})},R=async(U,C)=>{var D;h.value=!0;try{const{current:V,pageSize:k}=U,c=await no(V,k);if(_.value=[],c.code===0){const u=c.data.list;for(let p=0;p<u.length;p++){const I=u[p],P=await Ht(I);(D=_.value)==null||D.push(P)}d.value={...d.value,total:c.data.total_count}}else C&&N(s,c.code)}catch(V){console.error(V),N(s,Ie())}finally{h.value=!1}},O=async U=>{await o.push({query:{...a.query,page:U.current,page_size:U.pageSize}})},j=()=>{i.value=!0},x=async()=>{b.value=!0,console.log("contestCreateForm",y.value),oo(y.value).then(U=>{U.code===0?(_e(s,"创建比赛成功"),i.value=!1,o.push({path:"/contest/"+U.data.id})):N(s,U.code)}).finally(()=>{b.value=!1})};return ne(async()=>{l=$e(()=>a.query,U=>{v.value.title=U.title||"",v.value.username=U.username||"";const C=parseInt(U.page)||d.value.defaultCurrent,D=parseInt(U.page_size)||d.value.defaultPageSize;f=C,r=D,d.value={...d.value,current:f,pageSize:r},R({current:f,pageSize:r},!0)},{immediate:!0})}),Te(()=>{l&&l()}),(U,C)=>{const D=je,V=de,k=he,c=ke,u=Le,p=G,I=Pe,P=me,E=be,A=jt,W=st;return L(),J(Q,null,[t(E,null,{default:n(()=>[t(k,{span:9},{default:n(()=>[t(V,{style:{margin:"10px"}},{default:n(()=>[t(D,{data:_.value,columns:T.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:d.value,loading:h.value,onPageChange:O},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(k,{span:3},{default:n(()=>[z("div",So,[t(V,{class:"sh-card"},{default:n(()=>[t(I,{model:v.value},{default:n(()=>[t(u,{label:"标题"},{default:n(()=>[t(c,{modelValue:v.value.title,"onUpdate:modelValue":C[0]||(C[0]=K=>v.value.title=K),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(u,{label:"负责人"},{default:n(()=>[t(c,{modelValue:v.value.username,"onUpdate:modelValue":C[1]||(C[1]=K=>v.value.username=K),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(u,null,{default:n(()=>[t(p,{theme:"primary",onClick:w},{default:n(()=>C[6]||(C[6]=[S("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(V,{class:"sh-card"},{default:n(()=>[t(P,null,{default:n(()=>[t(p,{onClick:j},{default:n(()=>C[7]||(C[7]=[S("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),t(W,{visible:i.value,"onUpdate:visible":C[5]||(C[5]=K=>i.value=K),header:"创建比赛",onConfirm:x,"confirm-loading":b.value},{default:n(()=>[t(I,{"label-width":80,model:y.value,onSubmit:C[4]||(C[4]=Ee(()=>{},["prevent"]))},{default:n(()=>[t(u,{label:"标题"},{default:n(()=>[t(c,{modelValue:y.value.title,"onUpdate:modelValue":C[2]||(C[2]=K=>y.value.title=K),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),t(u,{label:"开启时间"},{default:n(()=>[t(A,{"enable-time-picker":"","allow-input":"",clearable:"",modelValue:y.value.open_time,"onUpdate:modelValue":C[3]||(C[3]=K=>y.value.open_time=K)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Ae=ee(Co,[["__scopeId","data-v-3e6ea683"]]),Io={style:{margin:"20px"}},To=["innerHTML"],Po={style:{margin:"12px"}},Lo=ae({__name:"ContestDetail",setup(e){let a=pe();const{globalProperties:o}=ie(),s=xe();let l=0;const i=g(!1),b=g(null),T=g([{title:"问题ID",colKey:"id",cell:(r,d)=>t(G,{variant:"text",onClick:()=>f(l,d.row.index)},{default:()=>[d.row.id]})},{title:"标题",colKey:"title",cell:(r,d)=>t(G,{variant:"text",onClick:()=>f(l,d.row.index)},{default:()=>[d.row.title]})},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),h=g([]),f=(r,d)=>{H.push({name:"contest-problem-detail",params:{contestId:r,problemIndex:d}})};return ne(async()=>{if(Array.isArray(a.params.contestId)?l=a.params.contestId[0]:l=a.params.contestId,!l){await H.push({name:"contest"});return}i.value=!0;const r=await ao(l);if(r.code!==0){i.value=!1,N(o,r.code),await H.push({name:"contest"});return}b.value=await Ht(r.data),h.value=b.value.problems,s.setTitle(b.value.title+" - "+s.getTitle),await we(()=>{const d=document.querySelectorAll(".dida-content-description");d&&d.length>0&&d.forEach(_=>{le.mathRender(_),le.highlightRender({lineNumber:!0,enable:!0},_),De(_)}),i.value=!1})}),(r,d)=>{const _=kt,v=G,y=me,m=Pt,w=Lt,R=je,O=de,j=he,x=Re,U=ze,C=be,D=ge;return L(),M(D,{loading:i.value},{default:n(()=>[t(C,{class:"dida-main-content"},{default:n(()=>[t(j,{span:8},{default:n(()=>{var V,k,c;return[z("div",Io,[z("h1",null,F((V=b.value)==null?void 0:V.title),1),(k=b.value)!=null&&k.notification?(L(),M(_,{key:0,theme:"info",message:(c=b.value)==null?void 0:c.notification},null,8,["message"])):ue("",!0)]),t(w,{"default-value":[0],"expand-icon":!1,borderless:!0},{default:n(()=>{var u;return[(L(!0),J(Q,null,ce((u=b.value)==null?void 0:u.descriptions,(p,I)=>(L(),M(m,{key:I,header:p.title},at({default:n(()=>[z("div",{innerHTML:p.content,class:"dida-content-description"},null,8,To)]),_:2},[I===0?{name:"headerRightContent",fn:n(()=>[t(y,{size:"small"},{default:n(()=>[t(v,{size:"small"},{default:n(()=>d[0]||(d[0]=[S("收起全部")])),_:1}),t(v,{size:"small"},{default:n(()=>d[1]||(d[1]=[S("展开全部")])),_:1})]),_:1})]),key:"0"}:void 0]),1032,["header"]))),128))]}),_:1}),t(O,{style:{margin:"10px"}},{default:n(()=>[t(R,{data:h.value,columns:T.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1})]}),_:1}),t(j,{span:4},{default:n(()=>[z("div",Po,[t(U,{layout:"vertical",bordered:!0},{default:n(()=>[t(x,{label:"开始时间"},{default:n(()=>{var V;return[S(F((V=b.value)==null?void 0:V.startTime),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),jo=ee(Lo,[["__scopeId","data-v-5e212303"]]);function Ot(e){const a={};return a.id=e.id,a.authorId=e.author_id,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.title=e.title,a.content=e.content,e.insert_time&&(a.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(a.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(a.updateTime=new Date(e.update_time).toLocaleString()),a.problemId=e.problem_id,a.problemTitle=e.problem_title,a.contestId=e.contest_id,a.contestTitle=e.contest_title,a.contestProblemIndex=e.contest_problem_index,a}async function xo(e){const a={};if(a.id=e.id,a.authorId=e.author_id,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.content="",e.content){const o={math:{inlineDigit:!0,engine:"KaTeX"}};a.content=await le.md2html(e.content,o)}return e.insert_time&&(a.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(a.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(a.updateTime=new Date(e.update_time).toLocaleString()),a}function Vo(e){return Y({url:"/discuss?id="+e,method:"get"})}function Do(e,a,o,s,l,i){const b={};return e&&(b.contest_id=e),a&&(b.problem_id=a),o&&(b.title=o),s&&(b.username=s),l&&(b.page=l),i&&(b.page_size=i),Y({url:`/discuss/list?${new URLSearchParams(b).toString()}`,method:"get"})}function $o(e,a,o){return Y({url:"/discuss/comment/list?id="+e+"&page="+a+"&page_size="+o,method:"get"})}function zo(e){return Y({url:"/discuss/create",method:"post",data:e})}const Ro={style:{margin:"10px"}};function Uo(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Fe(e)}const Ao=ae({__name:"DiscussList",setup(e){const a=pe(),o=Me(),{globalProperties:s}=ie();let l=null;const i=g(!1),b=g(!1);let T=0;const h=g([]),f=[{title:"ID",colKey:"id",width:"100",cell:(c,u)=>t(G,{variant:"text",onClick:()=>x(u.row.id)},{default:()=>[u.row.id]})}],r=[{title:"标题",colKey:"title",cell:(c,u)=>t(G,{variant:"text",onClick:()=>x(u.row.id)},{default:()=>[u.row.title]})},{title:"创建人",colKey:"authorNickname",width:"200"},{title:"创建时间",colKey:"insertTime",width:"180"},{title:"更新时间",colKey:"updateTime",width:"180"}],d=g(!1);let _=1,v=50;const y=g({current:_,pageSize:v,defaultCurrent:_,defaultPageSize:v,total:0,pageSizeOptions:[50,100]}),m=g(),w=g({problemId:"",title:"",username:""}),R=g({title:"",description:"",open_time:[]}),O=c=>{c&&o.push({name:"problem-detail",params:{problemId:c}})},j=(c,u)=>{o.push({name:"contest-problem-detail",params:{contestId:c,problemIndex:u}})},x=c=>{if(c){if(T){o.push({name:"contest-discuss-detail",params:{contestId:T,discussId:c}});return}o.push({name:"discuss-detail",params:{discussId:c}})}},U=async()=>{await o.push({query:{...a.query,problem_id:w.value.problemId,title:w.value.title,username:w.value.username,page:1,page_size:y.value.defaultPageSize}})},C=async(c,u)=>{var p;d.value=!0;try{const{current:I,pageSize:P}=c,E=await Do(T,w.value.problemId,w.value.title,w.value.username,I,P);if(m.value=[],E.code===0){if(E.data.list){const A=E.data.list;for(let W=0;W<A.length;W++){const K=A[W],q=await Ot(K);(p=m.value)==null||p.push(q)}}y.value={...y.value,total:E.data.total_count}}else u&&N(s,E.code)}catch(I){console.error(I),N(s,Ie())}finally{d.value=!1}},D=async c=>{await o.push({query:{...a.query,page:c.current,page_size:c.pageSize}})},V=()=>{i.value=!0},k=async()=>{b.value=!0,console.log("discussCreateForm",R.value),zo(R.value).then(c=>{c.code===0?(_e(s,"创建比赛成功"),i.value=!1,o.push({path:"/discuss/"+c.data.id})):N(s,c.code)}).finally(()=>{b.value=!1})};return ne(async()=>{l=$e(()=>a.query,c=>{Array.isArray(a.params.contestId)?T=a.params.contestId[0]:T=a.params.contestId,h.value=f,T?h.value=h.value.concat([{title:"问题ID",colKey:"contestProblemIndex",width:"100",cell:(I,P)=>{let E;return t(G,{variant:"text",onClick:()=>j(T,P.row.contestProblemIndex)},Uo(E=Qe(P.row.contestProblemIndex))?E:{default:()=>[E]})}}]):h.value=h.value.concat([{title:"问题ID",colKey:"problemId",width:"100",cell:(I,P)=>t(G,{variant:"text",onClick:()=>O(P.row.problemId)},{default:()=>[P.row.problemId]})}]),h.value=h.value.concat(r),w.value.problemId=c.problem_id||"",w.value.title=c.title||"",w.value.username=c.username||"";const u=parseInt(c.page)||y.value.defaultCurrent,p=parseInt(c.page_size)||y.value.defaultPageSize;_=u,v=p,y.value={...y.value,current:_,pageSize:v},C({current:_,pageSize:v},!0)},{immediate:!0})}),Te(()=>{l&&l()}),(c,u)=>{const p=je,I=de,P=he,E=ke,A=Le,W=G,K=Pe,q=me,X=be,$=jt,se=st;return L(),J(Q,null,[t(X,null,{default:n(()=>[t(P,{span:9},{default:n(()=>[t(I,{style:{margin:"10px"}},{default:n(()=>[t(p,{data:m.value,columns:h.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:y.value,loading:d.value,"table-layout":"auto",onPageChange:D},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(P,{span:3},{default:n(()=>[z("div",Ro,[t(I,{class:"sh-card"},{default:n(()=>[t(K,{model:w.value},{default:n(()=>[t(A,{label:"问题ID"},{default:n(()=>[t(E,{modelValue:w.value.problemId,"onUpdate:modelValue":u[0]||(u[0]=Z=>w.value.problemId=Z),placeholder:"请输入完整问题ID"},null,8,["modelValue"])]),_:1}),t(A,{label:"标题"},{default:n(()=>[t(E,{modelValue:w.value.title,"onUpdate:modelValue":u[1]||(u[1]=Z=>w.value.title=Z),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(A,{label:"创建人"},{default:n(()=>[t(E,{modelValue:w.value.username,"onUpdate:modelValue":u[2]||(u[2]=Z=>w.value.username=Z),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(A,null,{default:n(()=>[t(W,{theme:"primary",onClick:U},{default:n(()=>u[7]||(u[7]=[S("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(I,{class:"sh-card"},{default:n(()=>[t(q,null,{default:n(()=>[t(W,{onClick:V},{default:n(()=>u[8]||(u[8]=[S("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),t(se,{visible:i.value,"onUpdate:visible":u[6]||(u[6]=Z=>i.value=Z),header:"创建比赛",onConfirm:k,"confirm-loading":b.value},{default:n(()=>[t(K,{"label-width":80,model:R.value,onSubmit:u[5]||(u[5]=Ee(()=>{},["prevent"]))},{default:n(()=>[t(A,{label:"标题"},{default:n(()=>[t(E,{modelValue:R.value.title,"onUpdate:modelValue":u[3]||(u[3]=Z=>R.value.title=Z),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),t(A,{label:"开启时间"},{default:n(()=>[t($,{"enable-time-picker":"","allow-input":"",clearable:"",modelValue:R.value.open_time,"onUpdate:modelValue":u[4]||(u[4]=Z=>R.value.open_time=Z)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Ke=ee(Ao,[["__scopeId","data-v-97dda3a0"]]),Eo={key:0,style:{margin:"20px"}},Fo=["innerHTML"],Mo=["innerHTML"],qo={style:{margin:"10px"}},Go={style:{margin:"10px"}},No={style:{margin:"10px","text-align":"right"}},Ho={style:{margin:"12px"}},Oo={key:0,class:"dida-edit-container"},Ko=ae({__name:"DiscussDetail",setup(e){let a=pe();const{globalProperties:o}=ie();let s=null;const l=xe(),i=ve();let b=g("");const T=g(""),h=g(null),f=g(!1),r=g(null),d=g(!1);let _=1,v=20;const y=g({current:1,total:0,defaultPageSize:v,defaultCurrent:_,pageSizeOptions:[20,50]}),m=g([]),w={},R=Se(()=>i.hasAuth(Ce.ManageDiscuss)),O=V=>{V&&H.push({name:"discuss-list",query:{...a.query,title:"",tag:V.name}})},j=()=>{H.push({name:"manage-discuss",params:{discussId:T.value}})},x=()=>t("div",{class:"t-pagination__total"},[`共 ${y.value.total} 条回复`]),U=()=>{},C=async(V,k)=>{var c;d.value=!0;try{const{current:u,pageSize:p}=V,I=await $o(T.value,u,p);if(m.value=[],I.code===0){const P=I.data.list;if(P)for(let E=0;E<P.length;E++){const A=P[E],W=await xo(A);(c=m.value)==null||c.push(W),await we(()=>{const K=document.querySelectorAll(".dida-discuss-content");K&&K.length>0&&K.forEach(q=>{le.mathRender(q),le.highlightRender({lineNumber:!0,enable:!0},q),De(q)})})}y.value={...y.value,total:I.data.total_count}}else k&&N(o,I.code)}catch(u){console.error(u),N(o,Ie())}finally{d.value=!1}},D=async V=>{await H.push({query:{...a.query,page:V.current,page_size:V.pageSize}})};return ne(async()=>{if(Array.isArray(a.params.discussId)?T.value=a.params.discussId[0]:T.value=a.params.discussId,!T.value){fe(o,"题目不存在"),await H.push({name:"discuss"});return}f.value=!0;const V=await Vo(T.value);if(V.code!==0){f.value=!1,N(o,V.code),await H.push({name:"discuss"});return}V.data.tags&&V.data.tags.forEach(p=>{w[p.id]=p}),r.value=Ot(V.data.discuss),l.setTitle(r.value.title+" - "+l.getTitle);let k=r.value.content;const c={math:{inlineDigit:!0,engine:"KaTeX"}};b.value=await le.md2html(k,c),await we(()=>{h.value&&(le.mathRender(h.value),le.highlightRender({lineNumber:!0,enable:!0},h.value),De(h.value)),f.value=!1}),s=$e(()=>a.query,p=>{const I=parseInt(p.page)||y.value.defaultCurrent,P=parseInt(p.page_size)||y.value.defaultPageSize;_=I,v=P,y.value={...y.value,current:_,pageSize:v},C({current:_,pageSize:v},!0)},{immediate:!0});const u={after:()=>{}};new le("commentEditRef",u)}),Te(()=>{s&&s()}),(V,k)=>{const c=wa,u=ya,p=de,I=me,P=ka,E=G,A=he,W=Re,K=ze,q=be,X=ge;return L(),M(X,{loading:f.value},{default:n(()=>[t(q,{class:"dida-main-content"},{default:n(()=>[t(A,{span:8},{default:n(()=>{var $,se,Z;return[($=r.value)!=null&&$.problemTitle||(se=r.value)!=null&&se.contestTitle?(L(),J("div",Eo,[t(u,{"max-item-width":"300"},{default:n(()=>{var re,B,Ue,it;return[(re=r.value)!=null&&re.contestTitle?(L(),J(Q,{key:0},[t(c,{to:{name:"contest-detail",params:{contestId:(B=r.value)==null?void 0:B.contestId}}},{default:n(()=>{var ye;return[S(F((ye=r.value)==null?void 0:ye.contestTitle),1)]}),_:1},8,["to"]),t(c,{to:{name:"contest-problem-detail",params:{problemId:(Ue=r.value)==null?void 0:Ue.contestProblemIndex}}},{default:n(()=>{var ye,ct;return[S(F(oe(Qe)((ye=r.value)==null?void 0:ye.contestProblemIndex))+" - "+F((ct=r.value)==null?void 0:ct.problemTitle),1)]}),_:1},8,["to"])],64)):(L(),J(Q,{key:1},[t(c,{to:{name:"discuss-list-problem"}},{default:n(()=>k[2]||(k[2]=[S(" 问题讨论")])),_:1}),t(c,{to:{name:"problem-detail",params:{problemId:(it=r.value)==null?void 0:it.problemId}}},{default:n(()=>{var ye;return[S(F((ye=r.value)==null?void 0:ye.problemTitle),1)]}),_:1},8,["to"])],64))]}),_:1})])):ue("",!0),t(p,{style:{margin:"10px"},header:(Z=r.value)==null?void 0:Z.title,"header-bordered":!0},{default:n(()=>[z("div",{innerHTML:oe(b),class:"dida-discuss-content"},null,8,Fo)]),_:1},8,["header"]),(L(!0),J(Q,null,ce(m.value,(re,B)=>(L(),M(p,{key:B,style:{margin:"10px"},"header-bordered":""},{header:n(()=>[t(I,null,{default:n(()=>[z("span",null,F(re.authorNickname),1),z("span",null,F(re.insertTime),1)]),_:2},1024)]),default:n(()=>[z("div",{innerHTML:re.content,class:"dida-discuss-content"},null,8,Mo)]),_:2},1024))),128)),z("div",qo,[t(P,{modelValue:y.value.current,"onUpdate:modelValue":k[0]||(k[0]=re=>y.value.current=re),"page-size":y.value.pageSize,"onUpdate:pageSize":k[1]||(k[1]=re=>y.value.pageSize=re),total:y.value.total,"page-size-options":y.value.pageSizeOptions,"show-page-size":!1,"total-content":x,onChange:D},null,8,["modelValue","page-size","total","page-size-options"])]),z("div",Go,[k[4]||(k[4]=z("div",{id:"commentEditRef",class:"dida-comment-editor"},null,-1)),z("div",No,[t(I,null,{default:n(()=>[t(E,{theme:"primary",onClick:U},{default:n(()=>k[3]||(k[3]=[S("提交")])),_:1})]),_:1})])])]}),_:1}),t(A,{span:4},{default:n(()=>[z("div",Ho,[R.value?(L(),J("div",Oo,[t(E,{onClick:j},{default:n(()=>k[5]||(k[5]=[S("编辑")])),_:1})])):ue("",!0),t(K,{layout:"vertical",bordered:!0},{default:n(()=>[t(W,{label:"创建时间"},{default:n(()=>{var $;return[S(F(($=r.value)==null?void 0:$.insertTime),1)]}),_:1}),t(W,{label:"编辑时间"},{default:n(()=>{var $;return[S(F(($=r.value)==null?void 0:$.modifyTime),1)]}),_:1}),t(W,{label:"更新时间"},{default:n(()=>{var $;return[S(F(($=r.value)==null?void 0:$.updateTime),1)]}),_:1}),t(W,{label:"创建用户"},{default:n(()=>{var $;return[S(F(($=r.value)==null?void 0:$.authorNickname),1)]}),_:1}),t(W,{label:"标签"},{default:n(()=>[t(I,null,{default:n(()=>{var $;return[(L(!0),J(Q,null,ce(($=r.value)==null?void 0:$.tags,se=>(L(),M(E,{key:se.id,variant:"dashed",onClick:()=>O(se)},{default:n(()=>[S(F(se.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),ft=ee(Ko,[["__scopeId","data-v-17657340"]]),Bo=ae({__name:"ManageJudge",setup(e){const{globalProperties:a}=ie(),o=g(""),s=g(!1),l=g(!1),i=g(!1),b=async()=>{s.value=!0;try{const f=await Nn();if(f.code!==0){N(a,f.code);return}_e(a,"重判成功"),await H.push({name:"judge-list"})}catch(f){console.error(f),N(a,"重判失败")}finally{s.value=!1}},T=async()=>{if(o.value===""){N(a,"请输入问题Id");return}l.value=!0;try{const f=await Hn(o.value);if(f.code!==0){N(a,f.code);return}_e(a,"重判成功"),await H.push({name:"judge-list",query:{problem_id:o.value}})}catch(f){console.error(f),N(a,"重判失败")}finally{l.value=!1}},h=async()=>{i.value=!0;try{const f=await On();if(f.code!==0){N(a,f.code);return}_e(a,"重判成功"),await H.push({name:"judge-list"})}catch(f){console.error(f),N(a,"重判失败")}finally{i.value=!1}};return(f,r)=>{const d=G,_=de,v=ke,y=me;return L(),J(Q,null,[t(_,{class:"yj-manage-card",title:"重判最近提交"},{default:n(()=>[t(d,{onClick:b,loading:s.value},{default:n(()=>r[1]||(r[1]=[S("重判")])),_:1},8,["loading"])]),_:1}),t(_,{class:"yj-manage-card",title:"重判问题"},{default:n(()=>[t(y,null,{default:n(()=>[t(v,{modelValue:o.value,"onUpdate:modelValue":r[0]||(r[0]=m=>o.value=m),placeholder:"输入问题Id"},null,8,["modelValue"]),t(d,{onClick:T,loading:l.value},{default:n(()=>r[2]||(r[2]=[S("重判")])),_:1},8,["loading"])]),_:1})]),_:1}),t(_,{class:"yj-manage-card",title:"重判所有"},{default:n(()=>[t(d,{onClick:h,theme:"danger",loading:i.value},{default:n(()=>r[3]||(r[3]=[S("重判")])),_:1},8,["loading"])]),_:1})],64)}}}),Jo=ee(Bo,[["__scopeId","data-v-e1e4c968"]]),Wo={style:{margin:"10px"}},Xo={key:1},Yo={style:{margin:"12px"}},Zo={class:"dida-edit-container"},Qo=ae({__name:"ProblemEdit",setup(e){let a=pe();const{globalProperties:o}=ie(),s=xe(),l=g(""),i=g(!1);let b=null;const T=g(!1),h=g(null),f=g({title:"",timeLimit:0,memoryLimit:0,source:"",tags:[]}),r=g([]),d=g([]),_=Se(()=>{const j=[],x=r.value;for(let U=0,C=x.length;U<C;U++)x[U].value&&j.push(x[U].value);return j}),v=(j,x)=>{const{trigger:U,index:C,item:D}=x;if(U==="clear"&&(r.value=[]),["tag-remove","backspace"].includes(U)&&r.value.splice(C,1),U==="enter"){for(let k=0;k<d.value.length;k++){const c=d.value[k];if(c.label===D){for(let u=0;u<r.value.length;u++)if(r.value[u].label===c.label)return;r.value.push(c);return}}const V={label:D,value:D};r.value.push(V),d.value=d.value.concat(V)}},y=(j,{current:x,type:U})=>{if(!x){r.value=U==="check"?d.value.slice(1):[];return}if(U==="check"){const C=d.value.find(D=>D.value===x);if(!C)return;r.value.push(C)}else r.value=r.value.filter(C=>C.value!==x)},m=()=>{H.push({name:"problem-detail",params:{problemId:l.value}})},w=()=>{H.push({name:"manage-problem-judge",params:{problemId:l.value}})},R=async()=>{if(b){T.value=!0,f.value.tags=[];for(let j=0;j<r.value.length;j++){const x=r.value[j];x&&x.label&&f.value.tags.push(x.label)}try{const j=await Wn(l.value,f.value.title,f.value.timeLimit,f.value.memoryLimit,f.value.source,f.value.tags,b.getValue());if(T.value=!0,j.code!==0){N(o,j.code);return}j.data!=null&&(h.value.updateTime=new Date(j.data).toLocaleString()),Rt(o,"保存成功")}finally{T.value=!1}}},O=async()=>{const j=await Gt(l.value);if(j.code!==0){N(o,j.code),console.error("problem get failed",j.code),await H.push({name:"problem"});return}const x=j.data.problem;if(h.value=Ze(x,{}),f.value.title=x.title,f.value.timeLimit=x.time_limit,f.value.memoryLimit=x.memory_limit,f.value.source=x.source,f.value.tags=[],r.value=[],j.data.tags)for(let D=0;D<j.data.tags.length;D++){const V=j.data.tags[D];V&&V.name&&(f.value.tags.push(V.name),r.value.push({label:V.name,value:V.id}))}s.setTitle(x.title+" - "+s.getTitle);let U=x.description;const C={after:()=>{b==null||b.setValue(U)}};b=new le("codeEditRef",C),i.value=!1};return ne(async()=>{if(Array.isArray(a.params.problemId)?l.value=a.params.problemId[0]:l.value=a.params.problemId,!l.value){fe(o,"题目不存在"),await H.push({name:"problem"});return}i.value=!0,Nt(-1).then(async j=>{j.code===0?(j.data.list&&j.data.list.forEach(x=>{d.value.push({label:x.name,value:x.id})}),await O()):(N(o,j.code),console.error("problem tag get failed",j.code),await H.push({name:"problem"}))}).catch(async j=>{console.error(j),N(o,"获取数据异常"),await H.push({name:"problem"})})}),(j,x)=>{const U=ke,C=Le,D=Sa,V=Ia,k=Ca,c=Pe,u=de,p=he,I=G,P=me,E=Re,A=ze,W=be,K=ge;return L(),M(K,{loading:i.value},{default:n(()=>[t(W,null,{default:n(()=>[t(p,{span:8},{default:n(()=>[z("div",Wo,[t(u,{class:"sh-card"},{default:n(()=>[t(c,{model:f.value},{default:n(()=>[t(C,{label:"标题"},{default:n(()=>[t(U,{modelValue:f.value.title,"onUpdate:modelValue":x[0]||(x[0]=q=>f.value.title=q),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),t(C,{label:"时间限制"},{default:n(()=>[t(D,{modelValue:f.value.timeLimit,"onUpdate:modelValue":x[1]||(x[1]=q=>f.value.timeLimit=q),theme:"normal",min:0},{suffix:n(()=>x[4]||(x[4]=[z("span",null,"ms",-1)])),_:1},8,["modelValue"])]),_:1}),t(C,{label:"内存限制"},{default:n(()=>[t(D,{modelValue:f.value.memoryLimit,"onUpdate:modelValue":x[2]||(x[2]=q=>f.value.memoryLimit=q),theme:"normal",min:0},{suffix:n(()=>x[5]||(x[5]=[z("span",null,"KB",-1)])),_:1},8,["modelValue"])]),_:1}),t(C,{label:"来源"},{default:n(()=>[t(U,{modelValue:f.value.source,"onUpdate:modelValue":x[3]||(x[3]=q=>f.value.source=q),placeholder:"请输入题目来源"},null,8,["modelValue"])]),_:1}),t(C,{label:"标签"},{default:n(()=>[t(k,{value:r.value,"allow-input":!0,placeholder:"请选择或输入","tag-input-props":{excessTagsDisplayType:"break-line"},"popup-props":{overlayInnerClassName:["narrow-scrollbar"],overlayInnerStyle:{maxHeight:"280px",overflowY:"auto",overscrollBehavior:"contain",padding:"6px"}},clearable:"",multiple:"",onTagChange:v},{panel:n(()=>[d.value.length?(L(),M(V,{key:0,value:_.value,options:d.value,onChange:y},null,8,["value","options"])):(L(),J("div",Xo,"暂无数据"))]),suffixIcon:n(()=>[t(oe(Yt))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(p,{span:4},{default:n(()=>[z("div",Yo,[z("div",Zo,[t(P,null,{default:n(()=>[t(I,{onClick:R,theme:"danger",loading:T.value},{default:n(()=>x[6]||(x[6]=[S("保存")])),_:1},8,["loading"]),t(I,{onClick:w,theme:"warning"},{default:n(()=>x[7]||(x[7]=[S("判题数据")])),_:1}),t(I,{onClick:m},{default:n(()=>x[8]||(x[8]=[S("查看")])),_:1})]),_:1})]),t(A,{layout:"vertical",bordered:!0},{default:n(()=>[t(E,{label:"创建时间"},{default:n(()=>{var q;return[S(F((q=h.value)==null?void 0:q.insertTime),1)]}),_:1}),t(E,{label:"更新时间"},{default:n(()=>{var q;return[S(F((q=h.value)==null?void 0:q.updateTime),1)]}),_:1}),t(E,{label:"判题方式"},{default:n(()=>{var q;return[S(F((q=h.value)==null?void 0:q.judgeType),1)]}),_:1}),t(E,{label:"上传用户"},{default:n(()=>{var q;return[S(F((q=h.value)==null?void 0:q.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1}),x[9]||(x[9]=z("div",{id:"codeEditRef",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"])}}}),el=ee(Qo,[["__scopeId","data-v-b8d494d1"]]),tl={style:{margin:"10px"}},al={style:{margin:"12px"}},nl={class:"dida-edit-container"},ol=ae({__name:"ProblemJudge",setup(e){let a=pe();const{globalProperties:o}=ie(),s=xe(),l=g(""),i=g(!1),b=g(null);let T=null;const h=g(null),f=g(""),r=g(!1),d=g(!1),_=g([{title:"文件",colKey:"file"},{title:"大小",colKey:"size",width:150,cell:(c,u)=>u.row.size.toFixed(0)+" B"},{title:"最后修改时间",colKey:"lastModified",width:180,cell:(c,u)=>new Date(u.row.lastModified).toLocaleString()},{title:"操作",colKey:"action",width:100,cell:(c,u)=>t(G,{onClick:()=>O(u.row.file)},{default:()=>[S("下载")]})}]),v=g([]),y=Se(()=>({border:"2px dashed #ccc",borderRadius:"6px",padding:"20px",textAlign:"center",cursor:"pointer",backgroundColor:r.value?"#f0f9ff":"#fff",transition:"background-color 0.2s ease"})),m=Se(()=>f.value?`已选择：${f.value}`:r.value?"松开文件以上传":"拖拽文件到这里，或点击选择文件"),w=()=>{H.push({name:"problem-detail",params:{problemId:l.value}})},R=()=>{H.push({name:"manage-problem",params:{problemId:l.value}})},O=async c=>{const u=await Xn(l.value,c);if(u.code!==0){N(o,u.code);return}const p=document.createElement("a");p.href=u.data,p.target="_blank",p.click(),URL.revokeObjectURL(p.href)},j=async()=>{if(!T){fe(o,"请选择压缩包");return}d.value=!0,Yn(l.value,T).then(async c=>{c.code==0?(h.value.value=null,T=null,f.value="",i.value=!0,Rt(o,"上传成功"),await k()):N(o,c.code)}).catch(c=>{console.log(c),o.$message.error({duration:3e3,content:"申请失败"})}).finally(()=>{d.value=!1})},x=()=>{var c;(c=h.value)==null||c.click()},U=c=>{const u=c.target.files[0];u&&(f.value=u.name,T=u)},C=c=>{r.value=!0},D=()=>{r.value=!1},V=c=>{c.preventDefault(),c.stopPropagation(),r.value=!1;const u=c.dataTransfer.files[0];if(u){f.value=u.name;const p=new DataTransfer;p.items.add(u),h.value.files=p.files,T=u}},k=async()=>{const c=await Bn(l.value);if(c.code!==0){N(o,c.code),await H.push({name:"problem"});return}const u=c.data.problem;b.value=Ze(u,{}),s.setTitle(u.title+" - "+s.getTitle),v.value=[],c.data.judges?c.data.judges.forEach(p=>{v.value.push({file:p.key,size:p.size,lastModified:p.last_modified})}):fe(o,"评测数据不存在"),i.value=!1};return ne(async()=>{if(Array.isArray(a.params.problemId)?l.value=a.params.problemId[0]:l.value=a.params.problemId,!l.value){fe(o,"题目不存在"),await H.push({name:"problem"});return}i.value=!0,await k()}),(c,u)=>{const p=je,I=he,P=G,E=me,A=Re,W=ze,K=be,q=ge;return L(),M(q,{loading:i.value},{default:n(()=>[t(K,null,{default:n(()=>[t(I,{span:7},{default:n(()=>[z("div",tl,[z("div",{id:"drop-zone",style:wt(y.value),onClick:x,onDragenter:Ee(C,["prevent"]),onDragover:u[0]||(u[0]=Ee(()=>{},["prevent"])),onDragleave:Ee(D,["prevent"]),onDrop:V},[z("input",{ref_key:"fileInput",ref:h,type:"file",style:{display:"none"},onChange:U},null,544),S(" "+F(m.value),1)],36)]),t(p,{data:v.value,columns:_.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1}),t(I,{span:5},{default:n(()=>[z("div",al,[z("div",nl,[t(E,null,{default:n(()=>[t(P,{onClick:j,theme:"danger",loading:d.value},{default:n(()=>u[1]||(u[1]=[S("上传")])),_:1},8,["loading"]),t(P,{onClick:R,theme:"warning"},{default:n(()=>u[2]||(u[2]=[S("编辑")])),_:1}),t(P,{onClick:w},{default:n(()=>u[3]||(u[3]=[S("查看")])),_:1})]),_:1})]),t(W,{layout:"vertical",bordered:!0},{default:n(()=>[t(A,{label:"标题"},{default:n(()=>{var X;return[S(F((X=b.value)==null?void 0:X.title),1)]}),_:1}),t(A,{label:"创建时间"},{default:n(()=>{var X;return[S(F((X=b.value)==null?void 0:X.insertTime),1)]}),_:1}),t(A,{label:"更新时间"},{default:n(()=>{var X;return[S(F((X=b.value)==null?void 0:X.updateTime),1)]}),_:1}),t(A,{label:"判题方式"},{default:n(()=>{var X;return[S(F((X=b.value)==null?void 0:X.judgeType),1)]}),_:1}),t(A,{label:"评测数据"},{default:n(()=>{var X;return[S(F((X=b.value)==null?void 0:X.judgeMd5),1)]}),_:1}),t(A,{label:"上传用户"},{default:n(()=>{var X;return[S(F((X=b.value)==null?void 0:X.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),ll=ee(ol,[["__scopeId","data-v-17986e38"]]),Kt=[{name:"problem-list",tab:"problem",sidebar:"problem-list",path:"",title:"问题列表",icon:"list",component:to},{name:"problem-detail",tab:"problem",sidebar:"problem-list",path:":problemId+",title:"问题详情",icon:"list",component:mt},{name:"problem-recommend",tab:"problem",sidebar:"problem-recommend",path:"recommend/:problemId*",title:"问题推荐",icon:"cpu",component:fo},{name:"judge-list",tab:"judge",sidebar:"judge-list",path:"",title:"评测列表",icon:"list",component:ho},{name:"judge-detail",tab:"judge",sidebar:"judge-list",path:":judgeId+",title:"评测详情",icon:"cpu",component:ko},{name:"contest-list",tab:"contest",sidebar:"contest-list",path:"",title:"比赛列表",icon:"list",component:Ae},{name:"contest-recent",tab:"contest",sidebar:"contest-recent",path:"recent",title:"近期比赛",icon:"list",component:Ae},{name:"contest-detail",tab:"contest-detail-tab",sidebar:"contest-detail",path:":contestId+",title:"比赛详情",icon:"cpu",component:jo},{name:"contest-problem-detail",tab:"contest-detail-tab",sidebar:"contest-problem-detail",path:":contestId+/problem/:problemIndex+",title:"问题详情",icon:"cpu",component:mt},{name:"contest-judge",tab:"contest-detail-tab",sidebar:"contest-judge",path:":contestId+/judge",title:"评测列表",icon:"list",component:Ae},{name:"contest-rank",tab:"contest-detail-tab",sidebar:"contest-rank",path:":contestId+/rank",title:"比赛排名",icon:"list",component:Ae},{name:"contest-statistics",tab:"contest-detail-tab",sidebar:"contest-statistics",path:":contestId+/statistics",title:"结果统计",icon:"list",component:Ae},{name:"contest-discuss",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss",title:"比赛讨论",icon:"list",component:Ke},{name:"contest-discuss-detail",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss/:discussId+",title:"讨论详情",icon:"list",component:ft},{name:"discuss-list",tab:"discuss",sidebar:"discuss-list",path:"",title:"讨论列表",icon:"list",component:Ke},{name:"discuss-list-problem",tab:"discuss",sidebar:"discuss-list-problem",path:"problem",title:"问题讨论",icon:"list",component:Ke},{name:"discuss-list-judge",tab:"discuss",sidebar:"discuss-list-judge",path:"judge",title:"评测讨论",icon:"list",component:Ke},{name:"discuss-detail",tab:"discuss",sidebar:"discuss-list",path:":discussId+",title:"讨论详情",icon:"list",component:ft},{name:"system-status",tab:"system",sidebar:"system-status",path:"",title:"系统状态",icon:"base-station",component:$t},{name:"manage-problem",tab:"manage",sidebar:"manage-problem",disableSidebar:!0,path:"problem/:problemId+",title:"问题编辑",icon:"list",component:el,auths:[Ce.ManageProblem]},{name:"manage-problem-judge",tab:"manage",sidebar:"manage-problem-judge",disableSidebar:!0,path:"problem/:problemId+/judge",title:"评测数据",icon:"list",component:ll,auths:[Ce.ManageProblem]},{name:"manage-judge",tab:"manage",path:"judge",sidebar:"manage-judge",title:"评测管理",icon:"list",auths:["i-manage-judge"],component:Jo}],_t=(e,a,o,s)=>{s.tab==o&&(s.disableSidebar&&a!=s.sidebar||s.sidebar==null||s.sidebar!=s.name||e.push({name:s.name,title:s.title,icon:s.icon,to:{name:s.name}}))},sl=(e,a)=>{const o=[];return Kt.forEach(s=>{if(Ut(s)){const l=[];s.children.forEach(i=>{_t(l,e,a,i)}),l.length>0&&o.push({title:s.title,children:l})}else _t(o,e,a,s)}),o},gt=(e,a)=>{const o=ln(a.tab),s={name:a.name,path:"/"+a.path,meta:{title:a.title+" - "+o.title,tab:a.tab,sidebar:a.sidebar,showSidebar:o.showSidebar,needLogin:o.needLogin||a.needLogin,tabAuths:o.auths,auths:a.auths},component:a.component};o.disablePath||(s.path=o.path+s.path),e.push(s)},rl=e=>{Kt.forEach(a=>{Ut(a)?a.children.forEach(o=>{gt(e,o)}):gt(e,a)})},Ge=[];rn(Ge);rl(Ge);Ge.push({path:"/403",name:"403",component:At});Ge.push({path:"/:pathMatch(.*)*",name:"404",component:zt});const H=Zt({history:Qt("/"),routes:Ge});H.beforeEach((e,a,o)=>{if(e.name==null||!H.hasRoute(e.name)){o({name:"home"});return}const s=e.matched[e.matched.length-1].meta;if(s.redirect){o({name:s.redirect});return}if(s.needLogin){const i=ve();if(i.getToken==null||i.getToken==""){o({name:"login",query:{redirect_uri:e.fullPath}});return}}const l=s.tabAuths;if(l&&!ve().hasAllAuths(l)){o({name:"403",query:{target:e.fullPath}});return}o()});H.afterEach((e,a)=>{if(e.name===a.name)return;const o=Ye(),s=xe();let l=null;if(e.matched.length>0&&(l=e.matched[e.matched.length-1].meta),l!=null&&l.title&&s.setTitle(l==null?void 0:l.title),l!=null&&l.showSidebar){o.setSidebarShow(!0);const i=sl(l==null?void 0:l.sidebar,l==null?void 0:l.tab);o.setMenuList(i),o.setMenuActiveName(l==null?void 0:l.sidebar)}else o.setSidebarShow(!1)});Pa.registerLanguage("verilog",La);const Bt=ea();Bt.use(ta);const Ne=aa(Rn);Ne.use(Bt);Ne.use(H);Ne.use(Ta);Ne.use(na);Ne.mount("#app");Ba().then(()=>{console.log("Text cache reinitialized")}).catch(e=>{console.error("Text cache reinitialization failed",e)});
