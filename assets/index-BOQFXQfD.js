import{bl as pt,bm as Jt,L as ne,r as c,q as re,t as Yt,bn as Q,bo as L,v as t,bp as l,bq as R,F as le,br as he,bs as G,bt as N,au as I,a as Ge,bu as ae,bv as ge,aI as ie,j as Pa,bw as Ta,bx as xa,by as Va,u as Pe,H as Ae,bz as La,bA as Ke,n as Me,w as Ve,bB as Wt,bC as ut,ah as Da,bD as Xt,bE as ja,bF as $a,bG as Zt,aN as Ua,bH as Ut,bI as wt,a5 as za,bJ as Aa,bK as Ra,N as Ea,bL as Ma}from"./node_modules-BxvVsS-w.js";import{L as Ie,C as pe,S as ye,a as Ka,T as He,b as ke,A as It,c as qa,d as Fa,e as Na,f as Ga,g as We,R as we,B as J,F as je,h as $e,I as Ue,D as Oe,i as Qt,j as qe,k as Fe,l as Oa,m as Te,n as ft,o as tt,O as Pt,p as ea,q as ta,P as aa,r as _t,s as la,t as Ha,u as Ba,v as Ja,w as Ya,x as na,y as Wa,z as Xa,E as Za,M as oa,G as sa,H as Qa,J as el,K as tl,N as al,Q as ll,U as nl,V as ol,W as sl,X as rl,Y as il}from"./tdesign-vue-next-BnQxirLu.js";import{V as _e}from"./vditor-DArazWIS.js";import{e as zt}from"./monaco-editor-BHsDS0An.js";import{H as ul,v as cl}from"./highlight.js-D9zWiMxS.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const d of o)if(d.type==="childList")for(const y of d.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&r(y)}).observe(document,{childList:!0,subtree:!0});function n(o){const d={};return o.integrity&&(d.integrity=o.integrity),o.referrerPolicy&&(d.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?d.credentials="include":o.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function r(o){if(o.ep)return;o.ep=!0;const d=n(o);fetch(o.href,d)}})();var ze=(e=>(e.Manage="i-manage",e.ManageJudge="i-manage-judge",e.ManageProblem="i-manage-problem",e.ManageContest="i-manage-contest",e.ManageCollection="i-manage-collection",e))(ze||{});const dl={"r-admin":["i-manage","i-manage-judge","i-manage-problem","i-manage-contest","i-manage-collection"]};function ml(e){if(e==null)return[];const a=[];for(const n of e){const r=dl[n];r!=null&&a.push(...r)}return[...new Set(a)]}function pl(e,a){if(e==null||a==null)return!1;const n=ml(e);for(const r of a)if(!n.includes(r))return!1;return!0}const xe=pt("user",{state:()=>({token:"",userId:-1,username:"",nickname:"",roles:[]}),getters:{getToken(){return this.token},getUserId(){return this.userId},getUsername(){return this.username},getNickname(){return this.nickname}},actions:{clear(){this.$patch({token:"",userId:-1,username:"",nickname:"",roles:[]})},loadResponse(e){this.$patch({token:e.token,userId:e.user_id,username:e.username,nickname:e.nickname,roles:e.roles})},isLogin(){return this.token!=null&&this.token!=""},hasAuth(e){return this.hasAllAuths([e])},hasAllAuths(e){return e?pl(this.roles,e):!0}},persist:!0}),Re=pt("webStyle",{state:()=>({title:""}),getters:{getTitle(){return this.title}},actions:{setTitle(e){this.title=e}}}),vt=pt("sidebarStyle",{state:()=>({showSidebar:!1,forceHiddenSidebar:!1,menuActiveName:"",menuList:[]}),getters:{getMenuList(){return this.menuList}},actions:{setSidebarShow(e){this.showSidebar=e},setForceHiddenSidebar(e){this.forceHiddenSidebar=e},setMenuActiveName(e){this.menuActiveName=e},clearMenuList(){this.menuList=[]},setMenuList(e){this.menuList=e},addMenuList(e){this.menuList.push(e)}}}),Qe=Jt.create({timeout:6e4,withCredentials:!1,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});Qe.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function fl(){return Qe({baseURL:"https://r2-oj.didapipa.com",url:"/system/notification.json?"+Date.now(),method:"get"})}function _l(){return Qe({baseURL:"https://r2-oj.didapipa.com",url:"/status/judger.json?"+Date.now(),method:"get"})}function ra(e){return Qe({baseURL:"https://r2-oj.didapipa.com",url:"/status/judger/"+e+".json?"+Date.now(),method:"get"})}function vl(e){return Qe({baseURL:"https://r2-oj.didapipa.com",url:"/status/web.json?"+Date.now(),method:"get"})}const gl={class:"judger-status-panel"},bl={class:"judger-status-panel"};function hl(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ge(e)}const yl=ne({__name:"SystemStatus",setup(e){const a=c([]),n=c([]),r=c(!1),o=c(!1);let d;const y=i=>{let m="失效",_="danger";const p=new Date,b=new Date(i.updateTime);return p.getTime()-b.getTime()>3e4?(m="离线",_="default"):i.cpuUsage>90?(m="CPU过高",_="warning"):i.memPercent>90?(m="内存过高",_="warning"):(m="在线",_="success"),t(ye,null,{default:()=>[t("span",null,[i.key,I(" - "),i.name]),t("span",null,[i.updateTime]),t(He,{theme:_,size:"small"},hl(m)?m:{default:()=>[m]})]})},g=async()=>{const i=[{key:"didaoj",name:"DidaOj"}],m={};for(let p=0;p<a.value.length;p++){const b=a.value[p];m[b.key]=b}const _=[];for(let p=0;p<i.length;p++){const b=i[p],u={key:b.key},f=await vl(b.key);f&&(f.name?u.name=f.name:u.name="-",f.update_time?u.updateTime=new Date(f.update_time).toLocaleString():u.updateTime="-",f.cpu_usage?u.cpuUsage=Number(f.cpu_usage):u.cpuUsage=0,f.mem_usage?u.memUsage=f.mem_usage/(1024*1024*1024):u.memUsage=0,f.mem_total?u.memTotal=f.mem_total/(1024*1024*1024):u.memTotal=0,u.memTotal>0?u.memPercent=Math.round(u.memUsage/u.memTotal*1e4)/100:u.memPercent=0,u.avgMessage=f.avg_message,m[b.key]?(u.cpuUsageFrom=m[b.key].cpuUsage,u.memPercentFrom=m[b.key].memPercent,u.memUsageFrom=m[b.key].memUsage,u.memTotalFrom=m[b.key].memTotal):(u.cpuUsageFrom=0,u.memPercentFrom=0,u.memUsageFrom=0,u.memTotalFrom=0),_.push(u))}a.value=_},S=async()=>{const i=await _l(),m={};for(let p=0;p<n.value.length;p++){const b=n.value[p];m[b.key]=b}const _=[];for(let p=0;p<i.judgers.length;p++){const b=i.judgers[p],u={key:b.key,name:b.name},f=await ra(b.key);f&&(f.name?u.name=f.name:u.name="-",f.update_time?u.updateTime=new Date(f.update_time).toLocaleString():u.updateTime="-",f.cpu_usage?u.cpuUsage=Number(f.cpu_usage):u.cpuUsage=0,f.mem_usage?u.memUsage=f.mem_usage/(1024*1024*1024):u.memUsage=0,f.mem_total?u.memTotal=f.mem_total/(1024*1024*1024):u.memTotal=0,u.memTotal>0?u.memPercent=Math.round(u.memUsage/u.memTotal*1e4)/100:u.memPercent=0,u.avgMessage=f.avg_message,m[b.key]?(u.cpuUsageFrom=m[b.key].cpuUsage,u.memPercentFrom=m[b.key].memPercent,u.memUsageFrom=m[b.key].memUsage,u.memTotalFrom=m[b.key].memTotal):(u.cpuUsageFrom=0,u.memPercentFrom=0,u.memUsageFrom=0,u.memTotalFrom=0),_.push(u))}n.value=_},v=async()=>{await g(),r.value=!1,await S(),o.value=!1};return re(async()=>{n.value=[],a.value=[],o.value=!0,r.value=!0,await v(),d=setInterval(()=>{v()},5e3)}),Yt(()=>{clearInterval(d)}),(i,m)=>{const _=Ka,p=ye,b=pe,u=Ie;return L(),Q(le,null,[t(b,{title:"接口状态",class:"judger-status"},{default:l(()=>[t(u,{loading:r.value},{default:l(()=>[R("div",gl,[(L(!0),Q(le,null,he(a.value,f=>(L(),G(b,{key:f.key,header:()=>y(f),class:"judge-status-judger"},{footer:l(()=>[R("span",null," 负载信息："+N(f.avgMessage),1)]),default:l(()=>[t(p,{class:"judge-status-judger"},{default:l(()=>[t(_,{title:"CPU使用率",value:f.cpuUsage,animation:{valueFrom:f.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(_,{title:"内存使用率",value:f.memPercent,animation:{valueFrom:f.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(_,{title:"内存使用量",animation:{valueFrom:f.memUsageFrom,duration:2e3},"animation-start":!0,value:f.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(_,{title:"内存总量",value:f.memTotal,animation:{valueFrom:f.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1},8,["loading"])]),_:1}),t(b,{title:"判题机状态",class:"judger-status"},{default:l(()=>[t(u,{loading:o.value},{default:l(()=>[R("div",bl,[(L(!0),Q(le,null,he(n.value,f=>(L(),G(b,{key:f.key,header:()=>y(f),class:"judge-status-judger"},{footer:l(()=>[R("span",null," 负载信息："+N(f.avgMessage),1)]),default:l(()=>[t(p,{class:"judge-status-judger"},{default:l(()=>[t(_,{title:"CPU使用率",value:f.cpuUsage,animation:{valueFrom:f.cpuUsageFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(_,{title:"内存使用率",value:f.memPercent,animation:{valueFrom:f.memPercentFrom,duration:2e3},"animation-start":!0,unit:"%",decimalPlaces:2},null,8,["value","animation"]),t(_,{title:"内存使用量",animation:{valueFrom:f.memUsageFrom,duration:2e3},"animation-start":!0,value:f.memUsage,unit:"GB",decimalPlaces:2},null,8,["animation","value"]),t(_,{title:"内存总量",value:f.memTotal,animation:{valueFrom:f.memTotalFrom,duration:2e3},"animation-start":!0,unit:"GB",decimalPlaces:2},null,8,["value","animation"])]),_:2},1024)]),_:2},1032,["header"]))),128))])]),_:1},8,["loading"])]),_:1})],64)}}}),se=(e,a)=>{const n=e.__vccOpts||e;for(const[r,o]of a)n[r]=o;return n},kt=se(yl,[["__scopeId","data-v-1fb43cc1"]]),wl={style:{"text-align":"right"}},kl=ne({__name:"Hitokoto",setup(e){const a=c(!1),n=c(""),r=c(""),o=c(""),d=async()=>{a.value=!0;try{const g=await(await fetch("https://v1.hitokoto.cn")).json();r.value=g.hitokoto,o.value=g.creator,n.value="—— "+g.from}catch(y){r.value="一言获取失败了，但至少您还可以访问本站。",o.value="BoilTask",n.value="DidaOJ",console.error("Error fetching Hitokoto:",y)}finally{a.value=!1}};return re(()=>{d()}),(y,g)=>{const S=pe,v=Ie;return L(),G(v,{loading:a.value},{default:l(()=>[t(S,{title:"一言 © Hitokoto"},{actions:l(()=>[I(" @"+N(o.value),1)]),default:l(()=>[R("div",null,[R("span",null,N(r.value),1),R("p",wl,N(n.value),1)])]),_:1})]),_:1},8,["loading"])}}}),Cl={class:"sh-main"},Sl={class:"dida-swiper-div"},Il=ne({__name:"HomeView",setup(e){let a=-1;const n=c(null),r=async()=>{n.value=await fl()};return re(async()=>{await r(),a=setInterval(()=>{r()},3e4)}),Yt(()=>{clearInterval(a)}),(o,d)=>{const y=It,g=Fa,S=qa,v=pe,i=ke,m=We,_=Ga,p=Na,b=we;return L(),G(b,null,{default:l(()=>[t(i,{span:8},{default:l(()=>[R("div",Cl,[n.value?(L(),G(y,{key:0,style:{margin:"20px"},theme:n.value.theme},{default:l(()=>[I(N(n.value.content),1)]),_:1},8,["theme"])):ae("",!0),R("div",Sl,[t(S,{class:"dida-swiper"},{default:l(()=>[t(g,null,{default:l(()=>d[0]||(d[0]=[R("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1}),t(g,null,{default:l(()=>d[1]||(d[1]=[R("img",{src:"https://cdn.codeoj.cn/image/banner.jpg",class:"swiper-img"},null,-1)])),_:1})]),_:1})]),t(v,{title:"正在完善，欢迎提供意见建议",style:{width:"500px",margin:"0 auto"}},{default:l(()=>d[2]||(d[2]=[R("p",null,[R("a",{href:"https://codeoj.cn/",target:"_blank"},"CodeOJ"),I("的迁移计划")],-1),R("p",null,"正在开发中",-1)])),_:1})])]),_:1}),t(i,{span:4},{default:l(()=>[t(kl,{style:{margin:"10px"}}),t(kt),t(v,{style:{margin:"10px"},bordered:!0},{header:l(()=>d[3]||(d[3]=[R("b",null,"友情链接",-1)])),default:l(()=>[t(p,null,{default:l(()=>[t(_,null,{default:l(()=>[t(m,{href:"https://boiltask.com",target:"_blank"},{default:l(()=>d[4]||(d[4]=[I("BoilTask Blog")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),Pl=se(Il,[["__scopeId","data-v-aba0b66b"]]),Tl={class:"sh-main"},xl=ne({__name:"View404",setup(e){let a=ge(),n=c(a.fullPath);return(r,o)=>{const d=J;return L(),Q("div",Tl,[R("p",null,N(ie(n)),1),o[2]||(o[2]=R("p",null,"该页面无效或已被迁移，请重新选择访问目标",-1)),t(d,{theme:"primary",onClick:o[0]||(o[0]=()=>r.$router.push("/"))},{default:l(()=>o[1]||(o[1]=[I("返回首页")])),_:1})])}}}),ia=se(xl,[["__scopeId","data-v-d4218944"]]);let Ct=null;async function Vl(){Ct=await Dl()}function Ll(e,a="zh"){if(Ct==null)return[!1,e.toString()];const n=Ct[e.toString()];if(!n)return[!1,e.toString()];let r=n[a];return r||(a="zh",r=n[a]),r?[!0,r]:[!1,e.toString()]}async function Dl(){return new Promise(e=>{e({404:{zh:"接口未找到"},1e3:{zh:"系统错误，请重试或等待管理员修复"},1001:{zh:"系统异常，请重试或等待管理员修复"},1002:{zh:"未知错误"},1003:{zh:"操作过于频繁，请稍后重试"},10001:{zh:"权限异常，请重新登陆后再试"},10002:{zh:"参数不符合要求"},10003:{zh:"未找到目标数据"},10004:{zh:"操作需要登录，请登录后重试"},100001:{zh:"用户名不存在或密码不匹配"},100002:{zh:"邮件发送失败，可能是邮箱无效或达到了每日注册上限，如有问题可联系管理员解决"},100003:{zh:"验证码错误或已过期，请重新获取"},100004:{zh:"注册用户失败，可能存在同名用户"},100005:{zh:"用户名不存在，或您未在本系统绑定邮箱，请联系管理员寻求帮助"},100006:{zh:"验证码错误或已过期，请重新获取"},100007:{zh:"已存在相同标题的题目"},100008:{zh:"已存在相同标题的比赛"},100009:{zh:"已存在相同标题的题集"},100010:{zh:"未发现有效题目"},100011:{zh:"题目数量超过限制，无法添加"},100012:{zh:"比赛开始时间无法设置为早于当前时间"},100013:{zh:"当前无法提交题目"},100014:{zh:"申请访问失败，密码错误"}})})}function de(){const{appContext:e}=Pa();return{globalProperties:e.config.globalProperties}}function De(){return 1e3}function Be(e,a,n=3e3){e.$message.success({duration:n,content:a})}function ve(e,a,n=3e3){e.$message.info({duration:n,content:a})}function fe(e,a,n=3e3){e.$message.error({duration:n,content:a})}function B(e,a,n=3e3){const[r,o]=Ll(a),d=r?o:`系统错误，错误提示[${o}]`;e.$message.error({duration:n,content:d})}function jl(e,a){return e.length<=a?e:e.slice(0,a)+"..."}function ua(e){return e.trim().split(/\s+/).flatMap(r=>r.split(",")).filter(r=>r.trim()!=="")}const $l="https://oj-api.didapipa.com/",X=Jt.create({baseURL:$l,timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});X.interceptors.request.use(e=>{const n=xe().getToken;return n&&(e.headers["X-Token"]=n),e},e=>Promise.reject(e));X.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function Ul(e){const a={};return a.id=e.id,a.username=e.username,a.nickname=e.nickname,a.email=e.email,a.slogan=e.slogan,a.organization=e.organization,a.accept=e.accept,a.attempt=e.attempt,a.vjudgeId=e.vjudge_id,e.email&&(a.avatar=`https://www.gravatar.com/avatar/${Ta(e.email.toLowerCase().trim())}?d=identicon&s=100`),a}function zl(e,a){return X({url:"/user/login",method:"post",data:{username:e,password:a}})}function Al(){return X({url:"/user/login/refresh",method:"post"})}function Rl(e){const a={username:e};return X({url:`/user/info?${new URLSearchParams(a).toString()}`,method:"get"})}function El(e){const a="https://vjudge.net/user/solveDetail/"+encodeURIComponent(e);return Qe({url:a,method:"get"})}function Ml(e){return X({url:"/user/account/infos",method:"post",data:{users:e}})}function Kl(e){return X({url:"/user/parse",method:"post",data:{users:e}})}function ql(e,a){return X({url:"/user/register/email",method:"post",data:{token:e,email:a}})}function Fl(e,a,n,r,o){return X({url:"/user/register",method:"post",data:{username:e,password:a,email:n,key:r,nickname:o}})}function Nl(e,a){return X({url:"/user/forget",method:"post",data:{token:e,username:a}})}function Gl(e,a,n){return X({url:"/user/password/modify",method:"post",data:{username:e,password:a,key:n}})}const Ol={class:"dida-login-footer"},Hl=ne({__name:"LoginView",setup(e){const{globalProperties:a}=de(),n=xe(),r=c(!1),o=c({username:"",password:""}),d=()=>{ve(a,"重置成功")},y=({validateResult:g,firstError:S})=>{r.value||(r.value=!0,zl(o.value.username,o.value.password).then(v=>{if(v.code===0){n.loadResponse(v.data),ve(a,"登录成功");let i=a.$route.query.redirect_uri;i||(i="/user/"+v.data.username),a.$router.push({path:i})}else B(a,v.code)}).catch(v=>{console.error("Login error",v),fe(a,"登录失败")}).finally(()=>{r.value=!1}))};return re(()=>{if(n.isLogin()){a.$router.push({path:"/user"});return}}),(g,S)=>{const v=Ue,i=$e,m=J,_=je,p=We,b=pe;return L(),G(b,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:l(()=>[t(_,{ref:"form",data:o.value,colon:!0,onReset:d,onSubmit:y,class:"yj-login-form","label-width":0},{default:l(()=>[t(i,{name:"username"},{default:l(()=>[t(v,{modelValue:o.value.username,"onUpdate:modelValue":S[0]||(S[0]=u=>o.value.username=u),clearable:"",autocomplete:"username",placeholder:"请输入用户名"},{"prefix-icon":l(()=>[t(ie(xa))]),_:1},8,["modelValue"])]),_:1}),t(i,{name:"password"},{default:l(()=>[t(v,{modelValue:o.value.password,"onUpdate:modelValue":S[1]||(S[1]=u=>o.value.password=u),type:"password",autocomplete:"current-password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":l(()=>[t(ie(Va))]),_:1},8,["modelValue"])]),_:1}),t(i,null,{default:l(()=>[t(m,{theme:"primary",type:"submit",block:"",loading:r.value},{default:l(()=>S[4]||(S[4]=[I("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),R("div",Ol,[t(p,{onClick:S[2]||(S[2]=()=>{ie(a).$router.push({name:"login-forget"})})},{default:l(()=>S[5]||(S[5]=[I("忘记密码 ")])),_:1}),t(p,{onClick:S[3]||(S[3]=()=>{ie(a).$router.push({name:"register"})})},{default:l(()=>S[6]||(S[6]=[I("注册账户 ")])),_:1})])]),_:1})}}}),Bl=se(Hl,[["__scopeId","data-v-524b77f9"]]),Jl={class:"dida-login-footer"},Yl=ne({__name:"RegisterView",setup(e){const{globalProperties:a}=de(),n=xe(),r=c(!1),o=c(!1),d=c(!1),y=c("发送验证码");let g=null,S=-1;const v=c(!1),i=c(null),m=c({username:"",password:"",confirmPassword:"",nickname:"",email:"",emailKey:""}),p=c({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:w=>new Promise(s=>{const k=setTimeout(()=>{s(m.value.password===w),clearTimeout(k)})}),message:"两次密码不一致"}],nickname:[{required:!0,message:"请填写昵称"},{min:1,message:"昵称至少1个字符"},{max:30,message:"昵称最多30个字符"}],email:[{required:!0,message:"请填写邮箱"},{pattern:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"邮箱格式不正确"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),b=c(()=>t(J,{onClick:u,disabled:d.value,loading:o.value,style:"width:120px"},{default:()=>[y.value]})),u=async()=>{var h;if(!m.value.email){fe(a,"请输入邮箱");return}if(!m.value.email.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)){fe(a,"邮箱格式不正确");return}if(d.value||o.value)return;v.value=!0,await Ae();const w=document.getElementById("cf-confirm-div");w&&w.remove();const s=document.createElement("div");s.id="cf-confirm-div",s.setAttribute("data-theme","light"),(h=i.value)==null||h.appendChild(s);const k=window;k.turnstile.ready(function(){k.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(U){v.value=!1,await f(U)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},f=async w=>{if(!d.value){o.value=!0;try{const s=await ql(w,m.value.email);if(s.code!==0){B(a,s.code);return}ve(a,"发送验证码成功"),o.value=!1,d.value=!0,g=new Date,y.value="60秒后重发",S=setInterval(()=>{const h=Math.floor((new Date().getTime()-(g==null?void 0:g.getTime()))/1e3);h>60?(y.value="发送验证码",d.value=!1,clearInterval(S)):y.value=`${60-h}秒后重发`},1e3)}catch{fe(a,"发送验证码失败")}finally{o.value=!1}}},C=()=>{ve(a,"重置成功")},P=({validateResult:w,firstError:s,e:k})=>{if(!r.value){if(k.preventDefault(),w!==!0){fe(a,s);return}if(m.value.password!==m.value.confirmPassword){fe(a,"两次密码不一致");return}r.value=!0,Fl(m.value.username,m.value.password,m.value.email,m.value.emailKey,m.value.nickname).then(h=>{h.code===0?(ve(a,"注册成功，可使用账号信息登录"),a.$router.push({name:"login"})):B(a,h.code)}).catch(h=>{console.error("Login error",h),fe(a,"登录失败")}).finally(()=>{r.value=!1})}};return re(()=>{if(n.isLogin()){a.$router.push({path:"/user"});return}}),Pe(()=>{clearInterval(S)}),(w,s)=>{const k=Ue,h=$e,U=Qt,M=J,E=je,j=We,$=pe,q=Oe;return L(),Q(le,null,[t($,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:l(()=>[t(E,{ref:"form",rules:p.value,data:m.value,colon:!0,onReset:C,onSubmit:P,class:"yj-login-form"},{default:l(()=>[t(h,{name:"username",label:"用户名"},{default:l(()=>[t(k,{modelValue:m.value.username,"onUpdate:modelValue":s[0]||(s[0]=z=>m.value.username=z),clearable:"",placeholder:"用于登录与查找"},null,8,["modelValue"])]),_:1}),t(h,{name:"password",label:"密码"},{default:l(()=>[t(k,{modelValue:m.value.password,"onUpdate:modelValue":s[1]||(s[1]=z=>m.value.password=z),type:"password",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(h,{name:"confirmPassword",label:"确认密码"},{default:l(()=>[t(k,{modelValue:m.value.confirmPassword,"onUpdate:modelValue":s[2]||(s[2]=z=>m.value.confirmPassword=z),type:"password",clearable:"",placeholder:"请确认密码"},null,8,["modelValue"])]),_:1}),t(h,{name:"nickname",label:"昵称"},{default:l(()=>[t(k,{modelValue:m.value.nickname,"onUpdate:modelValue":s[3]||(s[3]=z=>m.value.nickname=z),clearable:"",placeholder:"用于优先在网站各处展示"},null,8,["modelValue"])]),_:1}),t(h,{name:"email",label:"邮箱"},{default:l(()=>[t(k,{modelValue:m.value.email,"onUpdate:modelValue":s[4]||(s[4]=z=>m.value.email=z),clearable:"",placeholder:"请填写常用邮箱"},null,8,["modelValue"])]),_:1}),t(h,{name:"emailKey",label:"验证码"},{default:l(()=>[t(U,{append:b.value},{default:l(()=>[t(k,{modelValue:m.value.emailKey,"onUpdate:modelValue":s[5]||(s[5]=z=>m.value.emailKey=z),clearable:"",placeholder:"请输入验证码",style:{width:"140px"}},null,8,["modelValue"])]),_:1},8,["append"])]),_:1}),t(h,null,{default:l(()=>[t(M,{theme:"primary",type:"submit",block:"",loading:r.value},{default:l(()=>s[8]||(s[8]=[I("注册")])),_:1},8,["loading"])]),_:1})]),_:1},8,["rules","data"]),R("div",Jl,[t(j,{onClick:s[6]||(s[6]=()=>{ie(a).$router.push({name:"login"})})},{default:l(()=>s[9]||(s[9]=[I("返回登陆 ")])),_:1})])]),_:1}),t(q,{visible:v.value,"onUpdate:visible":s[7]||(s[7]=z=>v.value=z),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:l(()=>[R("div",{ref_key:"dialogContainer",ref:i,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),Wl=se(Yl,[["__scopeId","data-v-9b5f4fc7"]]),Xl={key:0,style:{margin:"10px"}},Zl={key:1,style:{margin:"10px"}},Ql={style:{margin:"12px"}},en=ne({__name:"UserView",setup(e){let a=ge();const{globalProperties:n}=de(),r=Re();let o="";const d=c(!1),y=c(null),g=c([]),S=c([]),v=c([]),i=async m=>{d.value=!0;try{let _=await Rl(m);if(_.code!==0){d.value=!1,B(n,_.code),await W.push({name:"home"});return}if(y.value=Ul(_.data.user),g.value=_.data.problems_ac,r.setTitle(y.value.nickname+" - "+r.getTitle),y.value.vjudgeId){const p=await El(y.value.vjudgeId);S.value=p.acRecords;for(const b in S.value)S.value[b].sort((u,f)=>u.length===f.length?u.localeCompare(f):u.length-f.length);v.value=p.failRecords;for(const b in v.value)v.value[b].sort((u,f)=>u.length===f.length?u.localeCompare(f):u.length-f.length)}}catch{fe(n,"获取用户信息失败"),await W.push({name:"home"})}finally{d.value=!1}};return La(async(m,_,p)=>{if(Array.isArray(m.params.username)?o=m.params.username[0]:o=m.params.username,!o){await W.push({name:"home"});return}await i(o),p()}),re(async()=>{if(Array.isArray(a.params.username)?o=a.params.username[0]:o=a.params.username,!o){await W.push({name:"home"});return}await i(o)}),(m,_)=>{const p=J,b=ye,u=pe,f=We,C=Fe,P=qe,w=ke,s=Oa,k=we,h=Ie;return L(),G(h,{loading:d.value},{default:l(()=>[t(k,{class:"dida-main-content"},{default:l(()=>[t(w,{span:8},{default:l(()=>{var U;return[t(u,{style:{margin:"10px"},title:"AC题目"},{default:l(()=>[t(b,{style:{"flex-wrap":"wrap"}},{default:l(()=>[(L(!0),Q(le,null,he(g.value,M=>(L(),G(p,{key:M,size:"small",onClick:()=>ie(W).push({name:"problem-detail",params:{problemId:M}})},{default:l(()=>[I(N(M),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),(U=y.value)!=null&&U.vjudgeId?(L(),G(u,{key:0,style:{margin:"10px"},title:"vjudge.net"},{actions:l(()=>{var M;return[t(f,{href:"https://vjudge.net/user/"+((M=y.value)==null?void 0:M.vjudgeId),target:"_blank"},{default:l(()=>{var E;return[I("@"+N((E=y.value)==null?void 0:E.vjudgeId),1)]}),_:1},8,["href"])]}),default:l(()=>[S.value&&Object.keys(S.value).length>0?(L(),Q("div",Xl,[_[0]||(_[0]=R("div",{style:{margin:"5px"}},[R("span",null,"AC")],-1)),t(P,{layout:"vertical",bordered:!0},{default:l(()=>[(L(!0),Q(le,null,he(S.value,(M,E)=>(L(),G(C,{key:E,label:E},{default:l(()=>[t(b,{style:{"flex-wrap":"wrap"}},{default:l(()=>[(L(!0),Q(le,null,he(M,j=>(L(),G(p,{key:j,size:"small",onClick:()=>ie(W).push({name:"problem-detail",params:{problemId:E+"-"+j}})},{default:l(()=>[I(N(j),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):ae("",!0),v.value&&Object.keys(v.value).length>0?(L(),Q("div",Zl,[_[1]||(_[1]=R("div",{style:{margin:"5px"}},[R("span",null,"Fail")],-1)),t(P,{layout:"vertical",bordered:!0},{default:l(()=>[(L(!0),Q(le,null,he(v.value,(M,E)=>(L(),G(C,{key:E,label:E},{default:l(()=>[t(b,{style:{"flex-wrap":"wrap"}},{default:l(()=>[(L(!0),Q(le,null,he(M,j=>(L(),G(p,{key:j,size:"small",onClick:()=>ie(W).push({name:"problem-detail",params:{problemId:E+"-"+j}})},{default:l(()=>[I(N(j),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})])):ae("",!0)]),_:1})):ae("",!0)]}),_:1}),t(w,{span:4},{default:l(()=>[R("div",Ql,[t(P,{layout:"vertical",bordered:!0},{default:l(()=>[t(C,{label:"头像"},{default:l(()=>{var U;return[t(s,{shape:"round",size:"100px",image:(U=y.value)==null?void 0:U.avatar,"hide-on-load-failed":!1},null,8,["image"])]}),_:1}),t(C,{label:"昵称"},{default:l(()=>{var U;return[I(N((U=y.value)==null?void 0:U.nickname),1)]}),_:1}),t(C,{label:"Slogan"},{default:l(()=>{var U;return[I(N((U=y.value)==null?void 0:U.slogan),1)]}),_:1}),t(C,{label:"邮箱"},{default:l(()=>{var U;return[I(N((U=y.value)==null?void 0:U.email),1)]}),_:1}),t(C,{label:"组织"},{default:l(()=>{var U;return[I(N((U=y.value)==null?void 0:U.organization),1)]}),_:1}),t(C,{label:"通过数量"},{default:l(()=>{var U;return[I(N((U=y.value)==null?void 0:U.accept),1)]}),_:1}),t(C,{label:"提交数量"},{default:l(()=>{var U;return[I(N((U=y.value)==null?void 0:U.attempt),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),tn=se(en,[["__scopeId","data-v-555e19aa"]]),Tt=[{name:"home",path:"/",title:"首页",showSidebar:!1,disableGenerateTab:!0,component:Pl},{name:"problem",path:"/problem",title:"题目",icon:"calculation",showSidebar:!0,redirect:"problem-list"},{name:"collection-detail-tab",title:"题集",path:"/collection",showSidebar:!0,disableGenerateTab:!0,redirect:"problem-collection-list"},{name:"judge",path:"/judge",title:"评测",icon:"code",showSidebar:!0,redirect:"judge-list"},{name:"contest",path:"/contest",title:"比赛",icon:"application",showSidebar:!0,redirect:"contest-list"},{name:"contest-detail-tab",title:"比赛",path:"/contest",showSidebar:!0,disableGenerateTab:!0,redirect:"contest-list"},{name:"discuss",title:"讨论",path:"/discuss",icon:"sonic",showSidebar:!0,redirect:"discuss-list"},{name:"rank",path:"/rank",title:"排名",icon:"chart-column",showSidebar:!0,redirect:"rank-ac-all"},{name:"tool",path:"/tool",title:"工具",icon:"tools",showSidebar:!0,redirect:"tool-paste"},{name:"system",path:"/system",title:"系统",icon:"dashboard",showSidebar:!0,redirect:"system-status"},{name:"manage",path:"/manage",title:"管理",icon:"command",showSidebar:!0,redirect:"manage-judge",auths:[ze.Manage]},{name:"login",path:"/login",title:"登陆",showSidebar:!1,disableGenerateTab:!0,component:Bl},{name:"register",path:"/register",title:"注册",showSidebar:!1,disableGenerateTab:!0,component:Wl},{name:"user",path:"/user/:username+",title:"用户",showSidebar:!1,needLogin:!0,disableGenerateTab:!0,component:tn},{name:"404",path:"/404",title:"404",showSidebar:!1,disableGenerateTab:!0,component:ia}],an=e=>Tt.find(a=>a.name==e),ln=e=>{const a=[];return Tt.forEach(n=>{!n.disableGenerateTab&&e.hasAllAuths(n.auths)&&a.push(n)}),a},nn=e=>{Tt.forEach(a=>{const n={name:a.name,path:a.path,meta:{title:a.title,tab:a.name,showSidebar:a.showSidebar,needLogin:a.needLogin,redirect:a.redirect,tabAuths:a.auths},component:a.component};e.push(n)})};function ca(e){return e.children!==void 0}function on(e){return e.children!==void 0}var xt=(e=>(e[e.Unknown=-1]="Unknown",e[e.C=0]="C",e[e.Cpp=1]="Cpp",e[e.Java=2]="Java",e[e.Python=3]="Python",e[e.Pascal=4]="Pascal",e[e.Golang=5]="Golang",e[e.Lua=6]="Lua",e[e.TypeScript=7]="TypeScript",e[e.Max=8]="Max",e))(xt||{});function Vt(){const e=[-1,8];return Object.values(xt).filter(a=>typeof a=="number"&&!e.includes(a)).map(a=>({value:a,label:Lt(a)}))}function ct(e){return e>-1&&e<8}function Lt(e){switch(e){case 0:return"C";case 1:return"C++";case 2:return"Java";case 3:return"Python";case 4:return"Pascal";case 5:return"Golang";case 6:return"Lua";case 7:return"TypeScript";default:return"未知"}}function Dt(e){switch(e){case 0:return"c";case 1:return"cpp";case 2:return"java";case 3:return"python";case 4:return"pascal";case 5:return"go";case 6:return"lua";case 7:return"typescript";default:return"text"}}var Le=(e=>(e[e.Init=0]="Init",e[e.Rejudge=1]="Rejudge",e[e.Submitting=2]="Submitting",e[e.Queuing=3]="Queuing",e[e.Compiling=4]="Compiling",e[e.Running=5]="Running",e[e.Accept=6]="Accept",e[e.PE=7]="PE",e[e.WA=8]="WA",e[e.TLE=9]="TLE",e[e.MLE=10]="MLE",e[e.OLE=11]="OLE",e[e.RE=12]="RE",e[e.CE=13]="CE",e[e.CLE=14]="CLE",e[e.JudgeFail=15]="JudgeFail",e[e.SubmitFail=16]="SubmitFail",e[e.Unknown=17]="Unknown",e[e.Max=18]="Max",e))(Le||{});const sn=e=>{switch(e){case 0:return"普通评测";case 1:return"特殊评测";default:return"未知"}},mt=e=>{switch(e){case 0:return"等待处理";case 1:return"重新评测";case 2:return"提交中";case 3:return"队列中";case 4:return"编译中";case 5:return"运行中";case 6:return"通过";case 7:return"格式错误";case 8:return"答案错误";case 9:return"超时";case 10:return"内存超限";case 11:return"输出超限";case 12:return"运行错误";case 13:return"编译错误";case 14:return"编译超限";case 15:return"评测失败";case 16:return"提交失败";case 17:return"未知";default:return e}},da=e=>{switch(e){case 0:case 1:case 2:case 3:case 4:case 5:case 17:return"default";case 6:return"success";case 7:return"warning";default:return"danger"}};function ma(){const e=[17,18];return Object.values(Le).filter(a=>typeof a=="number"&&!e.includes(a)).map(a=>({value:a,label:mt(a)}))}function dt(e){return e>=0&&e<17}function Ze(e){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return!0;default:return!1}}function pa(e){var n;const a={};if(a.id=e.id,a.problemId=e.problem_id,a.contestProblemIndex=e.contest_problem_index,a.status=e.status,Ze(e.status)||!dt(e.status)?a.score="-":a.score=e.score.toString(),e.time?a.time=Math.ceil(e.time/1e6)+"ms":a.time="-",e.memory?a.memory=(e.memory/1024/1024).toFixed(2)+"MB":a.memory="-",a.language=e.language,a.codeLength=e.code_length,e.approve_time?a.approveTime=new Date(e.approve_time).toLocaleString():a.approveTime="-",a.author=e.author,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.code=e.code,a.compileMessage=e.compile_message,a.taskCurrent=e.task_current,a.taskTotal=e.task_total,a.task=[],e.task)for(let r=0;r<((n=e.task)==null?void 0:n.length);r++){const o=e.task[r],d={};d.taskId=o.task_id,d.status=o.status,o.time?d.time=Math.ceil(o.time/1e6)+"ms":d.time="-",o.memory?d.memory=(o.memory/1024/1024).toFixed(2)+"MB":d.memory="-",d.score=o.score,d.content=o.content,d.waHint=o.wa_hint,!d.content&&!d.waHint&&(d.content="无提示信息"),a.task.push(d)}return e.judger&&(a.judger=e.judger),e.judge_time&&(a.judgeTime=new Date(e.judge_time).toLocaleString()),a}function rn(e,a,n,r,o){return X({url:"/judge/approve",method:"post",data:{problem_id:e,contest_id:a,problem_index:n,language:r,code:o}})}function un(e){return X({url:"/judge?id="+e,method:"get"})}function cn(e){return X({url:"/judge/code?id="+e,method:"get"})}function dn(e,a,n,r,o,d,y){let g={problem_id:a,username:n,language:String(r),status:String(o),page:String(d),page_size:String(y)};return e&&(g.contest_id=String(e)),X({url:`/judge/list?${new URLSearchParams(g).toString()}`,method:"get"})}function mn(){return X({url:"/judge/rejudge/recently",method:"post"})}function pn(e,a,n){const r={};return e!=null&&(r.problem_id=e),a!=null?r.language=a:r.language=xt.Unknown,n!=null?r.status=n:r.status=18,X({url:"/judge/rejudge/search",method:"post",data:r})}function fn(){return X({url:"/judge/rejudge/all",method:"post",timeout:0})}function _n(e){return X({url:"/judge/rejudge",method:"post",data:{id:Number(e)}})}var Je=(e=>(e[e.None=0]="None",e[e.Attempt=1]="Attempt",e[e.Accept=2]="Accept",e))(Je||{});function at(e,a){const n={};if(n.id=e.id,n.author=e.author,n.title=e.title,n.tags=[],e.tags)for(const r of e.tags){const o=a[r];o&&n.tags.push(o)}if(n.private=e.private,n.accept=e.accept,n.attempt=e.attempt,e.description!=null&&(n.description=e.description),e.time_limit!=null&&e.time_limit>=0?n.timeLimit=e.time_limit.toString()+" ms":n.timeLimit="未知",e.memory_limit!=null&&e.memory_limit>=0?n.memoryLimit=(e.memory_limit/1024).toFixed(2)+" MB":n.memoryLimit="未知",e.judge_type!=null&&(n.judgeType=sn(e.judge_type)),e.insert_time!=null&&(n.insertTime=new Date(e.insert_time).toLocaleString()),e.update_time!=null&&(n.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(n.creatorNickname=e.creator_nickname),e.source!=null){const r=/\[([^\]]+)\]\(([^)]+)\)/,o=e.source.match(r);o?(n.source=o[1],n.sourceUrl=o[2]):(n.source=e.source,n.sourceUrl="")}return e.judge_md5!=null&&(n.judgeMd5=e.judge_md5),e.origin_oj!=null&&(n.originOj=e.origin_oj),e.origin_id!=null&&(n.originId=e.origin_id),e.origin_url!=null&&(n.originUrl=e.origin_url),n}function fa(e,a,n){const r={};return e?r.id=e:(r.contest_id=a,r.problem_index=n),X({url:`/problem?${new URLSearchParams(r).toString()}`,method:"get"})}function _a(e){return X({url:"/problem/tag/list?max_count="+e,method:"get"})}function vn(e){return X({url:"/problem/judge?id="+e,method:"get"})}function gn(e,a,n,r,o,d){const y={};return e&&(y.oj=e),a&&(y.title=a),n&&(y.tag=n),r!==void 0&&(y.private=r?"1":"0"),o&&(y.page=o),d&&(y.page_size=d),X({url:`/problem/list?${new URLSearchParams(y).toString()}`,method:"get"})}function bn(e){const a={};return e&&(a.problem_id=e),X({url:`/problem/recommend?${new URLSearchParams(a).toString()}`,method:"get"})}function va(e,a){return X({url:"/problem/crawl",method:"post",data:{oj:e,id:a}})}function hn(e,a,n,r,o,d,y){return X({url:"/problem/create",method:"post",data:{title:e,time_limit:a,memory_limit:n,source:r,private:o,tags:d,description:y}})}function yn(e,a,n,r,o,d,y,g){return X({url:"/problem/edit",method:"post",data:{id:e,title:a,time_limit:n,memory_limit:r,source:o,private:d,tags:y,description:g}})}function wn(e,a){return X({url:"/problem/judge/data/download?id="+e+"&key="+a,method:"get"})}function kn(e,a){const n=new FormData;return n.append("id",e),n.append("zip",a),X({url:"/problem/judge/data",method:"post",data:n,headers:{"Content-Type":"multipart/form-data"},timeout:1e3*60*5})}function Cn(e){return X({url:"/problem/parse",method:"post",data:{problems:e}})}const Sn={style:{margin:"10px"}},In={key:0,class:"dida-operation-container"};function Pn(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ge(e)}const Tn=ne({__name:"ProblemList",setup(e){const a=ge(),n=Ke(),{globalProperties:r}=de(),o=xe();let d=null;const y=c(!1),g={};let S={};const v=c(!1),i=Me(()=>o.hasAuth(ze.ManageProblem)),m=c([{title:"ID",colKey:"id",cell:(z,T)=>{let V=h(T.row.id);return t(J,{variant:"dashed",theme:V,onClick:()=>k(T.row.id)},{default:()=>[T.row.id]})}},{title:"标题",colKey:"title",cell:(z,T)=>t(J,{variant:"text",onClick:()=>k(T.row.id)},{default:()=>[T.row.title]})},{title:"标签",colKey:"tags",cell:(z,T)=>{const V=T.row.tags;if(!V||V.length===0)return"";let D=[];for(let x=0;x<V.length;x++){const K=V[x];D.push(t(J,{key:x,theme:"default",variant:"outline",size:"small",onClick:()=>E(K)},{default:()=>[K.name]}))}return t(ye,null,Pn(D)?D:{default:()=>[D]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),_=c(!1);let p=1,b=50;const u=c({current:p,pageSize:b,defaultCurrent:p,defaultPageSize:b,total:0,pageSizeOptions:[50,100]}),f=c(),C=c(),P=[{label:"DidaOJ",value:"didaoj"},{label:"HDU",value:"hdu"},{label:"POJ",value:"poj"},{label:"NYOJ",value:"nyoj"}],w=c({oj:"",title:"",tag:"",private:!1}),s=c({oj:"",problem:""}),k=z=>{z&&n.push({path:"/problem/"+z})},h=z=>{if(!z||!S)return"default";const T=S[z];if(!T)return"default";switch(T){case Je.Accept:return"success";case Je.Attempt:return"warning";default:return"default"}},U=async()=>{await n.push({query:{...a.query,oj:w.value.oj,title:w.value.title,tag:w.value.tag,private:w.value.private?"1":"0",page:1,page_size:u.value.defaultPageSize}})},M=async()=>{try{v.value=!0;const z=await va(s.value.oj,s.value.problem);z.code===0?(ve(r,"搜索成功"),await n.push({name:"problem-detail",params:{problemId:z.data}})):B(r,z.code)}catch(z){console.error(z),B(r,De())}finally{v.value=!1}},E=z=>{z&&n.push({query:{...a.query,title:"",tag:z.name,page:1,page_size:u.value.defaultPageSize}})},j=()=>{n.push({name:"manage-problem-create"})},$=async(z,T)=>{_.value=!0;try{const{current:V,pageSize:D}=z,x=await gn(w.value.oj,w.value.title,w.value.tag,w.value.private,V,D);if(f.value=[],x.code===0){const K=x.data.list;if(!K||K.length<=0){u.value={...u.value,total:0},S={},ve(r,"未找到记录");return}K.forEach(H=>{var O;const A=at(H,g);(O=f.value)==null||O.push(A)}),u.value={...u.value,total:x.data.total_count},S=x.data.problem_attempt_status}else T&&B(r,x.code)}catch(V){console.error(V),B(r,De())}finally{_.value=!1}},q=async z=>{await n.push({query:{...a.query,page:z.current,page_size:z.pageSize}})};return re(async()=>{_.value=!0,C.value=[],_a(-1).then(z=>{if(z.code===0){C.value=z.data.list,y.value=z.data.total_count>z.data.list.length;for(let T=0;T<z.data.list.length;T++){const V=z.data.list[T];g[V.id]=V}d=Ve(()=>a.query,T=>{w.value.oj=T.oj||"",w.value.title=T.title||"",w.value.tag=T.tag||"",w.value.private=T.private==="1";const V=parseInt(T.page)||u.value.defaultCurrent,D=parseInt(T.page_size)||u.value.defaultPageSize;p=V,b=D,u.value={...u.value,current:p,pageSize:b},$({current:p,pageSize:b},!0)},{immediate:!0})}else y.value=!0}).catch(z=>{console.error(z),y.value=!0})}),Pe(()=>{d&&d()}),(z,T)=>{const V=Te,D=pe,x=ke,K=J,H=ye,A=ft,O=$e,F=Ue,ue=tt,me=je,Y=we;return L(),G(Y,null,{default:l(()=>[t(x,{span:9},{default:l(()=>[t(D,{style:{margin:"10px"}},{default:l(()=>[t(V,{data:f.value,columns:m.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:u.value,"table-layout":"auto",loading:_.value,onPageChange:q},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(x,{span:3},{default:l(()=>[R("div",Sn,[i.value?(L(),Q("div",In,[t(H,null,{default:l(()=>[t(K,{onClick:j},{default:l(()=>T[7]||(T[7]=[I("新建")])),_:1})]),_:1})])):ae("",!0),t(D,{class:"sh-card"},{default:l(()=>[t(me,{model:w.value,onSubmit:U},{default:l(()=>[t(O,{label:"OJ"},{default:l(()=>[t(A,{modelValue:w.value.oj,"onUpdate:modelValue":T[0]||(T[0]=te=>w.value.oj=te),options:P,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(O,{label:"标题"},{default:l(()=>[t(F,{modelValue:w.value.title,"onUpdate:modelValue":T[1]||(T[1]=te=>w.value.title=te),placeholder:"请输入关键词"},null,8,["modelValue"])]),_:1}),t(O,{label:"标签"},{default:l(()=>[t(F,{modelValue:w.value.tag,"onUpdate:modelValue":T[2]||(T[2]=te=>w.value.tag=te),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),i.value?(L(),G(O,{key:0,label:"私有"},{default:l(()=>[t(ue,{modelValue:w.value.private,"onUpdate:modelValue":T[3]||(T[3]=te=>w.value.private=te)},null,8,["modelValue"])]),_:1})):ae("",!0),t(O,null,{default:l(()=>[t(K,{theme:"primary",type:"submit"},{default:l(()=>T[8]||(T[8]=[I("搜索")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(D,{class:"sh-card"},{default:l(()=>[t(me,{model:s.value,onSubmit:M},{default:l(()=>[t(O,{label:"OJ"},{default:l(()=>[t(A,{modelValue:s.value.oj,"onUpdate:modelValue":T[4]||(T[4]=te=>s.value.oj=te),options:P,placeholder:"请选择OJ",clearable:""},null,8,["modelValue"])]),_:1}),t(O,{label:"题目"},{default:l(()=>[t(F,{modelValue:s.value.problem,"onUpdate:modelValue":T[5]||(T[5]=te=>s.value.problem=te),placeholder:"请输入原始题号"},null,8,["modelValue"])]),_:1}),t(O,null,{default:l(()=>[t(K,{theme:"primary",type:"submit",loading:v.value},{default:l(()=>T[9]||(T[9]=[I("前往")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),t(D,{class:"sh-card sh-background-black"},{default:l(()=>[(L(!0),Q(le,null,he(C.value,te=>(L(),G(K,{class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:()=>E(te)},{default:l(()=>[I(N(te.name),1)]),_:2},1032,["onClick"]))),256)),y.value?(L(),G(K,{key:0,class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:T[6]||(T[6]=()=>z.$router.push("/problem/tags"))},{default:l(()=>T[10]||(T[10]=[I(" ... ")])),_:1})):ae("",!0)]),_:1})])]),_:1})]),_:1})}}}),xn=se(Tn,[["__scopeId","data-v-bc7185f5"]]);function Ye(e){e.querySelectorAll("pre > code:not([data-copy-attached])").forEach(n=>{n.setAttribute("data-copy-attached","true");const r=n.parentElement,o=document.createElement("div");o.className="copy-wrapper";const d=document.createElement("button");d.className="copy-btn",d.innerText="复制",d.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(n.innerText),d.innerText="已复制",setTimeout(()=>d.innerText="复制",1500)}catch{d.innerText="失败"}}),r.replaceWith(o),o.appendChild(d),o.appendChild(r)})}function Ne(e){let a="";for(;e>0;)e--,a=String.fromCharCode(65+e%26)+a,e=Math.floor(e/26);return a}async function jt(e){const a={};a.id=e.id,a.ownerId=e.owner_id,a.ownerUsername=e.owner_username,a.ownerNickname=e.owner_nickname,a.title=e.title,a.startTime=new Date(e.start_time).toLocaleString(),a.endTime=new Date(e.end_time).toLocaleString(),a.createTime=new Date(e.create_time).toLocaleString(),a.updateTime=new Date(e.update_time).toLocaleString(),a.private=e.private;const n={math:{inlineDigit:!0,engine:"KaTeX"}};if(a.description=await _e.md2html(e.description,n),a.notification=e.notification,e.problems){a.problems=[],e.problems.sort((r,o)=>r.index-o.index);for(let r=0;r<e.problems.length;r++){const o=e.problems[r];let d={accept:0,attempt:0,author:"",id:"",private:!1,tags:[],title:""};d.index=o.index,d.id=Ne(o.index),d.title=o.title,o.accept?d.accept=o.accept:d.accept=0,o.attempt?d.attempt=o.attempt:d.attempt=0,a.problems.push(d)}}return a}function Vn(e){return X({url:"/contest?id="+e,method:"get"})}function Ln(e){return X({url:"/contest/edit?id="+e,method:"get"})}function Dn(e){return X({url:"/contest/problem/list?id="+e,method:"get"})}function jn(e,a){return X({url:"/contest/problem?id="+e+"&problem_index="+a,method:"get"})}function $n(e,a){return X({url:"/contest/list?page="+e+"&page_size="+a,method:"get"})}function Un(e){return X({url:"/contest/rank?id="+e,method:"get"})}function zn(e){return X({url:"/contest/create",method:"post",data:e})}function An(e){return X({url:"/contest/edit",method:"post",data:e})}function Rn(e,a){return X({url:"/contest/password",method:"post",data:{id:e,password:a}})}const ga=async(e,a)=>{a&&await e.push({name:"user",params:{username:a}})},St=async(e,a)=>{await W.push({name:"contest-problem-detail",params:{contestId:e,problemIndex:a}})},En=["innerHTML"],Mn={key:0,class:"dida-problems-container"},Kn={style:{margin:"12px"}},qn={key:1},Fn={class:"dida-operation-container"},Nn={key:0,class:"dida-operation-container"},Gn={class:"dida-code-submit-div"},On=ne({__name:"ProblemDetail",setup(e){let a=ge();const{globalProperties:n}=de();let r=null;const o=Re(),d=xe();let y=c(""),g="",S=0,v=c(0);const i=c(!1),m=c(null),_=c(!1),p=c(null);let b=null;const u=c(null),f=c(!1),C=c(!1),P={},w=c(""),s=c([]);s.value=Vt();const k=c([]),h=Me(()=>d.hasAuth(ze.ManageProblem)),U=D=>{D&&W.push({name:"problem-list",query:{...a.query,title:"",tag:D.name}})},M=async()=>{let D=g;if(!D)try{const x=await jn(S,v.value);x.code===0?D=x.data:B(n,x.code)}catch{fe(n,"获取题目ID失败，请稍后再试");return}await W.push({name:"manage-problem",params:{problemId:D}})},E=()=>{g?W.push({name:"judge-list",query:{problem_id:g}}):W.push({name:"contest-judge",params:{contestId:S},query:{problem_id:Ne(v.value)}})},j=()=>{g?W.push({name:"discuss-list-problem",query:{problem_id:g}}):W.push({name:"contest-discuss",params:{contestId:S},query:{problem_id:Ne(v.value)}})},$=()=>{W.push({name:"problem-recommend",params:{problemId:g}})},q=async()=>{var K,H;const D=(K=p.value)==null?void 0:K.originOj,x=(H=p.value)==null?void 0:H.originId;if(!(!D||!x))try{f.value=!0;const A=await va(D,x);A.code===0?(await V(),ve(n,"更新成功")):B(n,A.code)}catch{fe(n,"更新失败，请稍后再试")}finally{f.value=!1}},z=async()=>{const D=parseInt(w.value);if(!ct(D)){fe(n,"请选择所编写的语言");return}const x=b==null?void 0:b.getValue();if(!x){fe(n,"请输入所需提交的代码");return}if(!g&&(!S||!v.value)){fe(n,"问题ID无效");return}C.value=!0;try{const K=await rn(g,S,v.value,D,x);if(K.code!==0){B(n,K.code);return}ve(n,"提交成功，正在跳转到详情页面");const H=K.data.id;S?await W.push({name:"contest-judge-detail",params:{contestId:S,judgeId:H}}):await W.push({name:"judge-detail",params:{judgeId:H}})}finally{C.value=!1}},T=D=>{if(!b)return;const x=b.getModel();x&&zt.setModelLanguage(x,Dt(D))},V=async()=>{k.value=[];let D=await fa(g,S,v.value);if(D.code!==0){_.value=!1,B(n,D.code),await W.push({name:"problem"});return}D.data.tags&&D.data.tags.forEach(H=>{P[H.id]=H}),p.value=at(D.data.problem,P),o.setTitle(p.value.title+" - "+o.getTitle);let x=p.value.description;S&&(D=await Dn(S),D.code===0?k.value=D.data.problems:B(n,D.code));const K={math:{inlineDigit:!0,engine:"KaTeX"}};y.value=await _e.md2html(x,K),await Ae(()=>{m.value&&(_e.mathRender(m.value),_e.highlightRender({lineNumber:!0,enable:!0},m.value),Ye(m.value),!b&&u.value&&(b=zt.create(u.value,{value:"",language:"cpp",minimap:{enabled:!0},colorDecorators:!0,readOnly:!1,theme:"vs-dark"}))),_.value=!1})};return re(async()=>{r=Ve(()=>a.params,async()=>{if(Array.isArray(a.params.problemId)?g=a.params.problemId[0]:g=a.params.problemId,!g){if(Array.isArray(a.params.contestId)?S=Number(a.params.contestId[0]):S=Number(a.params.contestId),!S){fe(n,"题目不存在"),await W.push({name:"problem"});return}if(Array.isArray(a.params.problemIndex)?v.value=parseInt(a.params.problemIndex[0]):v.value=parseInt(a.params.problemIndex),!v.value){fe(n,"题目不存在"),await W.push({name:"problem"});return}}i.value=!!S,_.value=!0,await V()},{immediate:!0})}),Pe(()=>{r&&(r(),r=null)}),(D,x)=>{const K=pe,H=ke,A=J,O=ye,F=Fe,ue=We,me=qe,Y=Pt,te=ft,ce=we,ee=Ie;return L(),G(ee,{loading:_.value},{default:l(()=>[t(ce,{class:"dida-main-content"},{default:l(()=>[t(H,{span:8},{default:l(()=>[t(K,{style:{margin:"10px"}},{default:l(()=>[R("div",{innerHTML:ie(y),ref_key:"markdownRef",ref:m},null,8,En)]),_:1})]),_:1}),t(H,{span:4},{default:l(()=>{var be;return[ie(S)?(L(),Q("div",Mn,[t(O,{style:{"flex-wrap":"wrap"}},{default:l(()=>[(L(!0),Q(le,null,he(k.value,(oe,Z)=>(L(),G(A,{key:Z,theme:oe==ie(v)?"primary":"default",onClick:async()=>await ie(St)(ie(S),oe)},{default:l(()=>[I(N(ie(Ne)(oe)),1)]),_:2},1032,["theme","onClick"]))),128))]),_:1})])):ae("",!0),R("div",Kn,[t(me,{layout:"vertical",bordered:!0},{default:l(()=>{var oe;return[t(F,{label:"标题"},{default:l(()=>{var Z;return[I(N((Z=p.value)==null?void 0:Z.title),1)]}),_:1}),t(F,{label:"时间限制"},{default:l(()=>{var Z;return[I(N((Z=p.value)==null?void 0:Z.timeLimit),1)]}),_:1}),t(F,{label:"内存限制"},{default:l(()=>{var Z;return[I(N((Z=p.value)==null?void 0:Z.memoryLimit),1)]}),_:1}),t(F,{label:"判题方式"},{default:l(()=>{var Z;return[I(N((Z=p.value)==null?void 0:Z.judgeType),1)]}),_:1}),t(F,{label:"正确提交"},{default:l(()=>{var Z;return[I(N((Z=p.value)==null?void 0:Z.accept),1)]}),_:1}),t(F,{label:"提交总数"},{default:l(()=>{var Z;return[I(N((Z=p.value)==null?void 0:Z.attempt),1)]}),_:1}),t(F,{label:"创建时间"},{default:l(()=>{var Z;return[I(N((Z=p.value)==null?void 0:Z.insertTime),1)]}),_:1}),t(F,{label:"更新时间"},{default:l(()=>{var Z;return[I(N((Z=p.value)==null?void 0:Z.updateTime),1)]}),_:1}),t(F,{label:"上传用户"},{default:l(()=>{var Z;return[I(N((Z=p.value)==null?void 0:Z.creatorNickname),1)]}),_:1}),i.value?ae("",!0):(L(),G(F,{key:0,label:"题目来源"},{default:l(()=>{var Z,Ce,Ee;return[(Z=p.value)!=null&&Z.sourceUrl?(L(),G(ue,{key:0,href:(Ce=p.value)==null?void 0:Ce.sourceUrl,target:"_blank"},{default:l(()=>{var ot;return[I(N((ot=p.value)==null?void 0:ot.source),1)]}),_:1},8,["href"])):(L(),Q("span",qn,N((Ee=p.value)==null?void 0:Ee.source),1))]}),_:1})),h.value?(L(),G(F,{key:1,label:"是否私有"},{default:l(()=>{var Z;return[I(N((Z=p.value)!=null&&Z.private?"私有":"公开"),1)]}),_:1})):ae("",!0),(oe=p.value)!=null&&oe.originUrl?(L(),G(F,{key:2,label:"原题链接"},{default:l(()=>{var Z;return[t(ue,{href:(Z=p.value)==null?void 0:Z.originUrl,target:"_blank"},{default:l(()=>{var Ce,Ee;return[I(N((Ce=p.value)==null?void 0:Ce.originOj)+" - "+N((Ee=p.value)==null?void 0:Ee.originId),1)]}),_:1},8,["href"])]}),_:1})):ae("",!0),ie(g)?(L(),G(F,{key:3,label:"标签"},{default:l(()=>[t(O,null,{default:l(()=>{var Z;return[(L(!0),Q(le,null,he((Z=p.value)==null?void 0:Z.tags,Ce=>(L(),G(A,{key:Ce.id,variant:"dashed",onClick:()=>U(Ce)},{default:l(()=>[I(N(Ce.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})):ae("",!0)]}),_:1}),R("div",Fn,[t(O,null,{default:l(()=>[t(A,{onClick:E},{default:l(()=>x[1]||(x[1]=[I("提交记录")])),_:1}),t(A,{onClick:j},{default:l(()=>x[2]||(x[2]=[I("题目讨论")])),_:1}),ie(g)?(L(),G(A,{key:0,onClick:$},{default:l(()=>x[3]||(x[3]=[I("题目推荐")])),_:1})):ae("",!0)]),_:1})]),h.value||(be=p.value)!=null&&be.originId?(L(),Q("div",Nn,[t(O,null,{default:l(()=>{var oe;return[h.value?(L(),G(A,{key:0,onClick:M},{default:l(()=>x[4]||(x[4]=[I("编辑")])),_:1})):ae("",!0),(oe=p.value)!=null&&oe.originId?(L(),G(A,{key:1,onClick:q,loading:f.value},{default:l(()=>x[5]||(x[5]=[I("更新描述 ")])),_:1},8,["loading"])):ae("",!0)]}),_:1})])):ae("",!0),R("div",Gn,[t(O,null,{default:l(()=>[t(te,{modelValue:w.value,"onUpdate:modelValue":x[0]||(x[0]=oe=>w.value=oe),label:"语言：",placeholder:"请选择提交语言","auto-width":"",clearable:"",onChange:T},{default:l(()=>[(L(!0),Q(le,null,he(s.value,oe=>(L(),G(Y,{key:oe.value,value:oe.value,label:oe.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),t(A,{onClick:z,loading:C.value},{default:l(()=>x[6]||(x[6]=[I("提交")])),_:1},8,["loading"])]),_:1}),R("div",{ref_key:"codeEditRef",ref:u,class:"dida-code-editor"},null,512)])])]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),At=se(On,[["__scopeId","data-v-41e356bd"]]),Hn={style:{margin:"10px"}};function Bn(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ge(e)}const Jn=ne({__name:"ProblemRecommend",setup(e){const a=ge(),n=Ke(),{globalProperties:r}=de();let o=null,d="",y={},g={};const S=c([{title:"ID",colKey:"id",cell:(u,f)=>{let C=_(f.row.id);return t(J,{variant:"dashed",theme:C,onClick:()=>m(f.row.id)},{default:()=>[f.row.id]})}},{title:"标题",colKey:"title",cell:(u,f)=>t(J,{variant:"text",onClick:()=>m(f.row.id)},{default:()=>[f.row.title]})},{title:"标签",colKey:"tags",cell:(u,f)=>{const C=f.row.tags;if(!C||C.length===0)return"";let P=[];for(let w=0;w<C.length;w++){const s=C[w];P.push(t(J,{key:w,theme:"default",variant:"outline",size:"small",onClick:()=>p(s)},{default:()=>[s.name]}))}return t(ye,null,Bn(P)?P:{default:()=>[P]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),v=c(!1),i=c(),m=u=>{u&&n.push({path:"/problem/"+u})},_=u=>{if(!u||!g)return"default";const f=g[u];if(!f)return"default";switch(f){case Je.Accept:return"success";case Je.Attempt:return"warning";default:return"default"}},p=u=>{u&&n.push({name:"problem-list",query:{tag:u.name}})},b=async u=>{v.value=!0;try{const f=await bn(d);if(i.value=[],f.code===0){const C=f.data.list;if(!C||C.length<=0){ve(r,"暂无推荐题目");return}y={},f.data.tags&&f.data.tags.forEach(P=>{y[P.id]=P}),C.forEach(P=>{var s;const w=at(P,y);(s=i.value)==null||s.push(w)})}else u&&B(r,f.code)}catch(f){console.error(f),B(r,De())}finally{v.value=!1}};return re(async()=>{v.value=!0,o=Ve(()=>a.query,u=>{Array.isArray(a.params.problemId)?d=a.params.problemId[0]:d=a.params.problemId,b(!0)},{immediate:!0})}),Pe(()=>{o&&o()}),(u,f)=>{const C=Te,P=pe,w=ke,s=we;return L(),G(s,null,{default:l(()=>[t(w,{span:9},{default:l(()=>[t(P,{style:{margin:"10px"}},{default:l(()=>[t(C,{data:i.value,columns:S.value,"row-key":"id","vertical-align":"top",hover:!0,"table-layout":"auto",loading:v.value},null,8,["data","columns","loading"])]),_:1})]),_:1}),t(w,{span:3},{default:l(()=>[R("div",Hn,[t(P,{class:"sh-card",header:"题目推荐","header-bordered":!0},{default:l(()=>f[0]||(f[0]=[I(" 根据本站其他用户的提交记录推荐类似题目"),R("br",null,null,-1),I("依据推荐算法来计算，与本用户相似度最高的用户做的题，大概率被自己感兴趣。 ")])),_:1})])]),_:1})]),_:1})}}}),Yn=se(Jn,[["__scopeId","data-v-77972e8b"]]);async function $t(e){const a={};if(a.id=e.id,a.ownerId=e.owner_id,a.ownerUsername=e.owner_username,a.ownerNickname=e.owner_nickname,a.title=e.title,e.start_time?a.startTime=new Date(e.start_time).toLocaleString():a.startTime="无限制",e.end_time?a.endTime=new Date(e.end_time).toLocaleString():a.endTime="无限制",e.update_time?a.updateTime=new Date(e.update_time).toLocaleString():a.updateTime="",e.create_time?a.createTime=new Date(e.create_time).toLocaleString():a.createTime="",e.description){const n={math:{inlineDigit:!0,engine:"KaTeX"}};a.description=await _e.md2html(e.description,n)}else a.description="";return a.problems=e.problems,a}function Wn(e){return X({url:"/collection?id="+e,method:"get"})}function Xn(e){return X({url:"/collection/edit?id="+e,method:"get"})}function Zn(e,a){return X({url:"/collection/list?page="+e+"&page_size="+a,method:"get"})}function Qn(e){return X({url:"/collection/rank?id="+e,method:"get"})}function eo(e){return X({url:"/collection/create",method:"post",data:e})}function to(e){return X({url:"/collection/edit",method:"post",data:e})}const ao={style:{margin:"10px"}},lo=ne({__name:"CollectionList",setup(e){const a=ge(),n=Ke(),{globalProperties:r}=de();let o=null;c(!1),c(!1);const d=c([{title:"ID",colKey:"id",width:"100",cell:(C,P)=>t(J,{variant:"text",onClick:()=>_(P.row.id)},{default:()=>[P.row.id]})},{title:"标题",colKey:"title",cell:(C,P)=>t(J,{variant:"text",onClick:()=>_(P.row.id)},{default:()=>[P.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),y=c(!1);let g=1,S=50;const v=c({current:g,pageSize:S,defaultCurrent:g,defaultPageSize:S,total:0,pageSizeOptions:[50,100]}),i=c(),m=c({title:"",username:""});c({title:"",description:"",open_time:[]});const _=C=>{C&&n.push({path:"/collection/"+C})},p=async()=>{await n.push({query:{...a.query,title:m.value.title,username:m.value.username,page:1,page_size:v.value.defaultPageSize}})},b=async(C,P)=>{var w;y.value=!0;try{const{current:s,pageSize:k}=C,h=await Zn(s,k);if(i.value=[],h.code===0){const U=h.data.list;for(let M=0;M<U.length;M++){const E=U[M],j=await $t(E);(w=i.value)==null||w.push(j)}v.value={...v.value,total:h.data.total_count}}else P&&B(r,h.code)}catch(s){console.error(s),B(r,De())}finally{y.value=!1}},u=async C=>{await n.push({query:{...a.query,page:C.current,page_size:C.pageSize}})},f=async()=>{await n.push({name:"collection-create"})};return re(async()=>{o=Ve(()=>a.query,C=>{m.value.title=C.title||"",m.value.username=C.username||"";const P=parseInt(C.page)||v.value.defaultCurrent,w=parseInt(C.page_size)||v.value.defaultPageSize;g=P,S=w,v.value={...v.value,current:g,pageSize:S},b({current:g,pageSize:S},!0)},{immediate:!0})}),Pe(()=>{o&&o()}),(C,P)=>{const w=Te,s=pe,k=ke,h=Ue,U=$e,M=J,E=je,j=ye,$=we;return L(),G($,null,{default:l(()=>[t(k,{span:9},{default:l(()=>[t(s,{style:{margin:"10px"}},{default:l(()=>[t(w,{data:i.value,columns:d.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:v.value,loading:y.value,onPageChange:u},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(k,{span:3},{default:l(()=>[R("div",ao,[t(s,{class:"sh-card"},{default:l(()=>[t(E,{model:m.value},{default:l(()=>[t(U,{label:"标题"},{default:l(()=>[t(h,{modelValue:m.value.title,"onUpdate:modelValue":P[0]||(P[0]=q=>m.value.title=q),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(U,{label:"负责人"},{default:l(()=>[t(h,{modelValue:m.value.username,"onUpdate:modelValue":P[1]||(P[1]=q=>m.value.username=q),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(U,null,{default:l(()=>[t(M,{theme:"primary",onClick:p},{default:l(()=>P[2]||(P[2]=[I("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(s,{class:"sh-card"},{default:l(()=>[t(j,null,{default:l(()=>[t(M,{onClick:f},{default:l(()=>P[3]||(P[3]=[I("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),no=se(lo,[["__scopeId","data-v-29832c46"]]),oo={style:{margin:"20px"}},so={class:"dida-operation-container"},ro={style:{margin:"12px"}},io=["innerHTML"],uo=ne({__name:"CollectionDetail",setup(e){let a=ge();const{globalProperties:n}=de(),r=Re(),o=xe();let d=0;const y=c(!1),g=c(null),S=Me(()=>o.hasAuth(ze.ManageCollection)||g.value&&o.getUserId==g.value.ownerId),v=c([{title:"问题ID",colKey:"id",cell:(p,b)=>t(J,{variant:"text",onClick:()=>m(b.row.id)},{default:()=>[b.row.id]})},{title:"标题",colKey:"title",cell:(p,b)=>t(J,{variant:"text",onClick:()=>m(b.row.id)},{default:()=>[b.row.title]})},{title:"正确",colKey:"accept",cell:(p,b)=>b.row.accept?b.row.accept:0},{title:"提交",colKey:"attempt",cell:(p,b)=>b.row.attempt?b.row.attempt:0}]),i=c([]),m=p=>{W.push({name:"problem-detail",params:{problemId:p}})},_=()=>{g.value&&W.push({name:"collection-edit",params:{collectionId:g.value.id}})};return re(async()=>{if(Array.isArray(a.params.collectionId)?d=Number(a.params.collectionId[0]):d=Number(a.params.collectionId),!d){await W.push({name:"problem-collection-list"});return}y.value=!0;const p=await Wn(d);if(p.code!==0){y.value=!1,B(n,p.code),await W.push({name:"problem-collection-list"});return}g.value=await $t(p.data.collection),i.value=[],p.data.collection.problems&&p.data.collection.problems.forEach(b=>{const u=p.data.problems.find(f=>f.id===b);i.value.push(u)}),r.setTitle(g.value.title+" - "+r.getTitle),await Ae(()=>{const b=document.querySelectorAll(".dida-content-description");b&&b.length>0&&b.forEach(u=>{_e.mathRender(u),_e.highlightRender({lineNumber:!0,enable:!0},u),Ye(u)}),y.value=!1})}),(p,b)=>{const u=ta,f=ea,C=Te,P=pe,w=ke,s=J,k=ye,h=Fe,U=qe,M=we,E=Ie;return L(),G(E,{loading:y.value},{default:l(()=>[t(M,{class:"dida-main-content"},{default:l(()=>[t(w,{span:6},{default:l(()=>[R("div",oo,[t(f,{"max-item-width":"300"},{default:l(()=>[t(u,{to:{name:"problem-collection-list"}},{default:l(()=>b[0]||(b[0]=[I("题目集合")])),_:1}),t(u,null,{default:l(()=>{var j;return[I(N((j=g.value)==null?void 0:j.title),1)]}),_:1})]),_:1})]),t(P,{style:{margin:"10px"}},{default:l(()=>[t(C,{data:i.value,columns:v.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),_:1})]),_:1}),t(w,{span:6},{default:l(()=>{var j;return[R("div",so,[t(k,null,{default:l(()=>[S.value?(L(),G(s,{key:0,onClick:_},{default:l(()=>b[1]||(b[1]=[I("编辑")])),_:1})):ae("",!0)]),_:1})]),R("div",ro,[t(U,{layout:"vertical",bordered:!0},{default:l(()=>[t(h,{label:"创建者"},{default:l(()=>{var $;return[I(N(($=g.value)==null?void 0:$.ownerNickname),1)]}),_:1})]),_:1}),t(U,{layout:"vertical",bordered:!0},{default:l(()=>[t(h,{label:"开始时间"},{default:l(()=>{var $;return[I(N(($=g.value)==null?void 0:$.startTime),1)]}),_:1})]),_:1}),t(U,{layout:"vertical",bordered:!0},{default:l(()=>[t(h,{label:"结束时间"},{default:l(()=>{var $;return[I(N(($=g.value)==null?void 0:$.endTime),1)]}),_:1})]),_:1})]),(j=g.value)!=null&&j.description?(L(),G(P,{key:0,style:{margin:"10px"}},{default:l(()=>{var $;return[R("div",{innerHTML:($=g.value)==null?void 0:$.description,class:"dida-content-description"},null,8,io)]}),_:1})):ae("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),co=se(uo,[["__scopeId","data-v-0105a065"]]),mo=ne({__name:"CollectionRank",setup(e){const a=ge(),n=Ke(),{globalProperties:r}=de();let o=null,d=0,y=0;const g=c([{title:"Rank",colKey:"rank",align:"center"},{title:"序号",colKey:"index",align:"center"},{title:"Username",colKey:"username",cell:(_,p)=>t(J,{variant:"text",onClick:()=>n.push({name:"user",params:{username:p.row.username}})},{default:()=>[p.row.username]})},{title:"昵称",colKey:"nickname",cell:(_,p)=>t(J,{variant:"text",onClick:()=>n.push({name:"user",params:{username:p.row.username}})},{default:()=>[p.row.nickname]})},{title:"Count",colKey:"count",cell:(_,p)=>t(J,{variant:"text",onClick:()=>n.push({name:"judge-list",query:{username:p.row.username,status:Le.Accept}})},{default:()=>[`${p.row.accept} / ${y}`]})},{title:"Progress",colKey:"progress",cell:(_,p)=>{let b=100;return y>0&&(b=Number((p.row.accept/y*100).toFixed(2))),t(aa,{percentage:b},null)}}]),S=c(!1),v=c([]),i=({col:_,rowIndex:p})=>{let b=1;for(let u=p+1;u<v.value.length&&v.value[u].rank===v.value[p].rank;u++)b++;if(_.colKey==="rank")return{rowspan:b}},m=async _=>{S.value=!0;try{const p=await Qn(d);if(v.value=[],p.code===0){y=p.data.problem;const b=p.data.ranks,u=[];if(b){for(let P=0;P<b.length;P++){const w=b[P];let s={userId:w.author_id,username:w.author_username,nickname:w.author_nickname};s.accept=w.accept,u.push(s)}u.sort((P,w)=>P.accept!==w.accept?w.accept-P.accept:P.userId-w.userId);let f=0,C=-1;for(let P=0;P<u.length;P++)u[P].accept!==C&&(f=P+1,C=u[P].accept),u[P].index=P+1,u[P].rank=f}v.value=u}else _&&B(r,p.code)}catch(p){console.error(p),B(r,De())}finally{S.value=!1}};return re(async()=>{o=Ve(()=>a.query,async()=>{if(Array.isArray(a.params.collectionId)?d=Number(a.params.collectionId[0]):d=Number(a.params.collectionId),!d){await n.push({name:"problem-collection-list"});return}await m(!0)},{immediate:!0})}),Pe(()=>{o&&o()}),(_,p)=>{const b=Te,u=pe,f=we;return L(),G(f,null,{default:l(()=>[t(u,{style:{margin:"10px"}},{default:l(()=>[R("div",null,[t(b,{data:v.value,columns:g.value,"row-key":"index","rowspan-and-colspan":i,"vertical-align":"middle",bordered:!0,hover:!0,loading:S.value},null,8,["data","columns","loading"])])]),_:1})]),_:1})}}});var Se=(e=>(e[e.Valid=0]="Valid",e[e.Duplicate=1]="Duplicate",e[e.Invalid=2]="Invalid",e))(Se||{});const po={class:"dida-form-border"},fo={style:{"text-align":"right"}},_o=ne({name:"ParseProblemList",__name:"ParseProblemList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:a}=de(),n=c(!1),r=c(!1),o=c(""),d=Wt(e,"modelValue");let y=[];Ve(d,async _=>{JSON.stringify(_)!==JSON.stringify(y)&&(await v(_),y=d.value)},{deep:!0});const g=c([]),S=c([{title:"有效性",colKey:"validType",cell:(_,p)=>{switch(p.row.valid){case Se.Valid:return t(He,{theme:"success"},{default:()=>[I("有效")]});case Se.Duplicate:return t(He,{theme:"warning"},{default:()=>[I("重复")]});case Se.Invalid:return t(He,{theme:"danger"},{default:()=>[I("无效")]});default:return null}}},{title:"问题ID",colKey:"id"},{title:"标题",colKey:"title"}]),v=async _=>{const p=Array.from(new Set(_)),b=await Cn(p);if(b.code!==0){B(a,b.code),r.value=!1;return}const u=[],f=b.data.problems;let C=[];_.forEach(P=>{const w=f.find(s=>s.id===P);if(w){const s=u.find(k=>k.id===P);w.valid=s?Se.Duplicate:Se.Valid,u.push({id:P,title:w.title,valid:w.valid}),s||C.push(P)}else u.push({id:P,title:"-",valid:Se.Invalid})}),g.value=u,y=C,d.value=C},i=async()=>{r.value=!0;const _=ua(o.value);await v(_),n.value=!1,r.value=!1},m=()=>{g.value?o.value=g.value.map(_=>_.id).join(`
`):o.value="",n.value=!0};return(_,p)=>{const b=J,u=Te,f=_t,C=Oe;return L(),Q(le,null,[R("div",po,[R("div",fo,[t(b,{onClick:m},{default:l(()=>p[2]||(p[2]=[I("编辑")])),_:1})]),t(u,{data:g.value,columns:S.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(C,{visible:n.value,"onUpdate:visible":p[1]||(p[1]=P=>n.value=P),onConfirm:i,header:"请输入问题ID","confirm-loading":r.value},{default:l(()=>[p[3]||(p[3]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(f,{modelValue:o.value,"onUpdate:modelValue":p[0]||(p[0]=P=>o.value=P),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),ba=se(_o,[["__scopeId","data-v-b0352688"]]),vo={class:"dida-form-border"},go={style:{"text-align":"right"}},bo=ne({name:"ParseUserList",__name:"ParseUserList",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){const{globalProperties:a}=de(),n=c(!1),r=c(!1),o=c(""),d=Wt(e,"modelValue");let y=[];Ve(d,async b=>{JSON.stringify(b)!==JSON.stringify(y)&&(y=b,await i(b))},{deep:!0});const g=c(),S=c([{title:"有效性",colKey:"validType",cell:(b,u)=>{switch(u.row.valid){case Se.Valid:return t(He,{theme:"success"},{default:()=>[I("有效")]});case Se.Duplicate:return t(He,{theme:"warning"},{default:()=>[I("重复")]});case Se.Invalid:return t(He,{theme:"danger"},{default:()=>[I("无效")]})}}},{title:"Username",colKey:"username"},{title:"昵称",colKey:"nickname"}]),v=(b,u)=>{if(b.code!==0){B(a,b.code),r.value=!1;return}const f=[],C=b.data.users;let P=[];u?u.forEach(w=>{let s=null;if(C&&(s=C.find(k=>k.username.toLowerCase()===w.toLowerCase())),s){const k=f.find(U=>U.username.toLowerCase()===w.toLowerCase()),h=k?Se.Duplicate:Se.Valid;f.push({id:s.id,username:s.username,nickname:s.nickname,valid:h}),k||P.push(s.id)}else f.push({id:-1,username:w,nickname:"-",valid:Se.Invalid})}):C&&C.forEach(w=>{const s=f.find(h=>h.id===w.id),k=s?Se.Duplicate:Se.Valid;f.push({id:w.id,username:w.username,nickname:w.nickname,valid:k}),s||P.push(w.id)}),g.value=f,y=P,d.value=P},i=async b=>{const u=Array.from(new Set(b)),f=await Ml(u);v(f)},m=async b=>{const u=Array.from(new Set(b)),f=await Kl(u);v(f,b)},_=async()=>{r.value=!0;const b=ua(o.value);await m(b),n.value=!1,r.value=!1},p=()=>{g.value?o.value=g.value.map(b=>b.username).join(`
`):o.value="",n.value=!0};return(b,u)=>{const f=J,C=Te,P=_t,w=Oe;return L(),Q(le,null,[R("div",vo,[R("div",go,[t(f,{onClick:p},{default:l(()=>u[2]||(u[2]=[I("编辑")])),_:1})]),t(C,{data:g.value,columns:S.value,"row-key":"id","vertical-align":"top","table-layout":"auto",hover:!0},null,8,["data","columns"])]),t(w,{visible:n.value,"onUpdate:visible":u[1]||(u[1]=s=>n.value=s),onConfirm:_,header:"请输入用户Username","confirm-loading":r.value},{default:l(()=>[u[3]||(u[3]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(P,{modelValue:o.value,"onUpdate:modelValue":u[0]||(u[0]=s=>o.value=s),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","confirm-loading"])],64)}}}),ha=se(bo,[["__scopeId","data-v-b0b99852"]]),ho={style:{margin:"10px"}},yo={style:{margin:"12px"}},wo={class:"dida-edit-container"},ko=ne({__name:"CollectionEdit",setup(e){let a=ge();const{globalProperties:n}=de(),r=Re(),o=c(""),d=c(!1);let y=null;const g=c(!1),S=c(!1),v=c(null),i=c({title:"",openTime:[],private:!0,problems:[],members:[],description:""}),m=c(""),_=c(""),p=c(!1),b=async()=>{p.value=!0,S.value=!1,p.value=!1},u=async()=>{if(y){g.value=!0;try{const w={title:i.value.title,description:y.getValue(),problems:i.value.problems,members:i.value.members,private:i.value.private};i.value.openTime[0]&&(w.start_time=new Date(i.value.openTime[0])),i.value.openTime[1]&&(w.end_time=new Date(i.value.openTime[1]));const s=await eo(w);if(g.value=!0,s.code!==0){B(n,s.code);return}s.data!=null&&await W.push({name:"collection-detail",params:{collectionId:s.data}}),Be(n,"创建成功")}finally{g.value=!1}}},f=async()=>{if(y){g.value=!0;try{const w={id:Number(o.value),title:i.value.title,private:i.value.private,problems:i.value.problems,members:i.value.members,description:y.getValue()};i.value.openTime[0]&&(w.start_time=new Date(i.value.openTime[0])),i.value.openTime[1]&&(w.end_time=new Date(i.value.openTime[1]));const s=await to(w);if(g.value=!0,s.code!==0){B(n,s.code);return}s.data!=null&&v.value&&(v.value.updateTime=new Date(s.data).toLocaleString()),Be(n,"保存成功")}finally{g.value=!1}}},C=w=>{const s={after:()=>{y==null||y.setValue(w),d.value=!1}};y=new _e("collectionEditDiv",s)},P=async()=>{const w=await Xn(o.value);if(w.code!==0){B(n,w.code),console.error("collection get failed",w.code),await W.push({name:"problem-collection-list"});return}const s=w.data.collection;v.value=await $t(s),i.value.title=s.title,i.value.openTime=[],s.start_time?i.value.openTime.push(new Date(s.start_time)):i.value.openTime.push(""),s.end_time?i.value.openTime.push(new Date(s.end_time)):i.value.openTime.push(""),i.value.private=s.private,i.value.description=s.description,i.value.problems=s.problems,i.value.members=s.members,r.setTitle(s.title+" - "+r.getTitle);let k="";s.description&&(k=s.description),C(k)};return re(async()=>{Array.isArray(a.params.collectionId)?o.value=a.params.collectionId[0]:o.value=a.params.collectionId,o.value?(d.value=!0,await P()):C("")}),(w,s)=>{const k=Ue,h=$e,U=la,M=tt,E=je,j=pe,$=ke,q=J,z=ye,T=Fe,V=qe,D=we,x=Ie,K=_t,H=Oe;return L(),Q(le,null,[t(x,{loading:d.value},{default:l(()=>[t(D,null,{default:l(()=>[t($,{span:8},{default:l(()=>[R("div",ho,[t(j,{class:"sh-card"},{default:l(()=>[t(E,{model:i.value},{default:l(()=>[t(h,{label:"标题"},{default:l(()=>[t(k,{modelValue:i.value.title,"onUpdate:modelValue":s[0]||(s[0]=A=>i.value.title=A),placeholder:"题集标题"},null,8,["modelValue"])]),_:1}),t(h,{label:"开启时间"},{default:l(()=>[t(U,{modelValue:i.value.openTime,"onUpdate:modelValue":s[1]||(s[1]=A=>i.value.openTime=A),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(h,{label:"私有"},{default:l(()=>[t(M,{modelValue:i.value.private,"onUpdate:modelValue":s[2]||(s[2]=A=>i.value.private=A)},null,8,["modelValue"])]),_:1}),t(h,{label:"成员"},{default:l(()=>[t(ha,{modelValue:i.value.members,"onUpdate:modelValue":s[3]||(s[3]=A=>i.value.members=A)},null,8,["modelValue"])]),_:1}),t(h,{label:"问题测试"},{default:l(()=>[t(ba,{modelValue:i.value.problems,"onUpdate:modelValue":s[4]||(s[4]=A=>i.value.problems=A)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t($,{span:4},{default:l(()=>[R("div",yo,[R("div",wo,[o.value?(L(),G(z,{key:0},{default:l(()=>[t(q,{onClick:f,theme:"danger",loading:g.value},{default:l(()=>s[7]||(s[7]=[I("保存")])),_:1},8,["loading"])]),_:1})):(L(),G(z,{key:1},{default:l(()=>[t(q,{onClick:u,theme:"danger",loading:g.value},{default:l(()=>s[8]||(s[8]=[I("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(L(),G(V,{key:0,layout:"vertical",bordered:!0},{default:l(()=>[t(T,{label:"创建时间"},{default:l(()=>{var A;return[I(N((A=v.value)==null?void 0:A.createTime),1)]}),_:1}),t(T,{label:"更新时间"},{default:l(()=>{var A;return[I(N((A=v.value)==null?void 0:A.updateTime),1)]}),_:1}),t(T,{label:"创建用户"},{default:l(()=>{var A;return[I(N((A=v.value)==null?void 0:A.ownerNickname),1)]}),_:1})]),_:1})):ae("",!0)])]),_:1})]),_:1}),s[9]||(s[9]=R("div",{id:"collectionEditDiv",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"]),t(H,{visible:S.value,"onUpdate:visible":s[6]||(s[6]=A=>S.value=A),onConfirm:b,header:m.value,"confirm-loading":p.value},{default:l(()=>[s[10]||(s[10]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(K,{modelValue:_.value,"onUpdate:modelValue":s[5]||(s[5]=A=>_.value=A),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),Rt=se(ko,[["__scopeId","data-v-4b1cf4fd"]]),Co=["innerHTML"];function Et(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ge(e)}const So=ne({__name:"JudgeJobList",setup(e){const a=ge(),n=Ke(),{globalProperties:r}=de();let o=!1,d=null,y;const g=c(!1),S=c(null),v=c(null),i=c(!1);let m=-1;const _=c({problemId:"",username:"",language:void 0,status:void 0}),p=c([{title:"ID",colKey:"id",cell:(T,V)=>{let D=null;return dt(V.row.status)&&ct(V.row.language)&&(D=()=>{M(V.row.id)}),t(J,{variant:"text",onClick:D},{default:()=>[V.row.id]})}},{title:"问题",colKey:"problemId",cell:(T,V)=>{if(m){let D;return t(J,{variant:"text",onClick:()=>U(m,V.row.contestProblemIndex)},Et(D=Ne(V.row.contestProblemIndex))?D:{default:()=>[D]})}return t(J,{variant:"text",onClick:()=>h(V.row.problemId)},{default:()=>[V.row.problemId]})}},{title:"状态",colKey:"status",align:"center",cell:(T,V)=>{let D=null;dt(V.row.status)&&ct(V.row.language)&&(D=()=>{M(V.row.id)});const x=V.row.status,K=mt(x);let H=!dt(x);const A=da(x);let O=[];return Ze(x)&&O.push(t(Ie,{text:V.row.state,size:"small",class:"dida-status-loading"},null)),O.push(t("span",null,[K])),t(J,{theme:A,variant:"outline",onClick:D,disabled:H},Et(O)?O:{default:()=>[O]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"code",cell:(T,V)=>{let D=!ct(V.row.language);return t(J,{theme:"default",onClick:()=>k(V.row),disabled:D},{default:()=>[Lt(V.row.language)+" / "+V.row.codeLength]})}},{title:"作者",colKey:"author",width:200,cell:(T,V)=>t(J,{variant:"text",onClick:()=>E(V.row.authorUsername)},{default:()=>[V.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),b=c(!1);let u=1,f=50;const C=c({current:u,pageSize:f,defaultCurrent:u,defaultPageSize:f,total:0,pageSizeOptions:[50,100]}),P=c(),w=c([]);w.value=Vt();const s=c([]);s.value=ma();const k=async T=>{i.value=!0,g.value=!0;try{S.value=T;const V=await cn(Number(S.value.id));if(V.code===0){const D=V.data,K=`\`\`\`${Dt(D.language)}
${D.code}
\`\`\``,H={};S.value.code=await _e.md2html(K,H),await Ae(()=>{v.value&&(_e.highlightRender({lineNumber:!0,enable:!0},v.value),Ye(v.value))})}else B(r,V.code)}finally{i.value=!1}},h=T=>{T&&n.push({path:"/problem/"+T})},U=(T,V)=>{n.push({name:"contest-problem-detail",params:{contestId:T,problemIndex:V}})},M=T=>{T&&(m>0?n.push({name:"contest-judge-detail",params:{contestId:m,judgeId:T}}):n.push({name:"judge-detail",params:{judgeId:T}}))},E=T=>{T&&n.push({path:"/user/"+T})},j=async()=>{await n.push({query:{...a.query,page:1,page_size:f,problem_id:_.value.problemId,username:_.value.username,language:_.value.language,status:_.value.status}})},$=async()=>{_.value.problemId="",_.value.username="",_.value.language=void 0,_.value.status=void 0,await n.push({query:{...a.query,page:1,page_size:f,problem_id:"",username:"",language:void 0,status:void 0}})},q=async(T,V)=>{V&&(b.value=!0);let D=!1;try{const{current:x,pageSize:K}=T,H=await dn(m,_.value.problemId,_.value.username,_.value.language,_.value.status,x,K);if(P.value=[],H.code===0){if(!H.data.has_auth){ve(r,"您目前没有权限查看评测记录"),m?await n.push({name:"contest-detail",params:{contestId:m}}):await n.push({name:"judge-list"});return}H.data.list&&H.data.list.length>0?(H.data.list.forEach(O=>{var ue;const F=pa(O);(ue=P.value)==null||ue.push(F),Ze(O.status)&&(D=!0)}),C.value={...C.value,total:H.data.total_count}):(ve(r,"未找到记录"),C.value={...C.value,total:0})}else V&&B(r,H.code)}catch(x){console.error(x),V&&B(r,De())}finally{V&&(b.value=!1),D&&o&&(y=setTimeout(()=>{q({current:u,pageSize:f},!1)},5e3))}},z=async T=>{await n.push({query:{...a.query,page:T.current,page_size:T.pageSize}})};return re(async()=>{o=!0,d=Ve(()=>a.query,T=>{Array.isArray(a.params.contestId)?m=Number(a.params.contestId[0]):m=Number(a.params.contestId),_.value.problemId=T.problem_id||"",_.value.username=T.username||"",T.language!=null?_.value.language=Number(T.language):_.value.language=void 0,T.status!=null?_.value.status=Number(T.status):_.value.status=void 0;const V=parseInt(T.page)||C.value.defaultCurrent,D=parseInt(T.page_size)||C.value.defaultPageSize;u=V,f=D,C.value.pageSizeOptions.includes(f)||(f=C.value.defaultPageSize),C.value={...C.value,current:u,pageSize:f},q({current:u,pageSize:f},!0)},{immediate:!0})}),Pe(()=>{o=!1,d&&d(),clearTimeout(y)}),(T,V)=>{const D=Ue,x=$e,K=Pt,H=ft,A=J,O=ye,F=je,ue=Te,me=pe,Y=We,te=Ie,ce=Oe;return L(),Q(le,null,[t(me,{style:{margin:"10px"}},{default:l(()=>[t(F,{layout:"inline",onSubmit:j,onReset:$},{default:l(()=>[t(x,{label:"题号"},{default:l(()=>[t(D,{modelValue:_.value.problemId,"onUpdate:modelValue":V[0]||(V[0]=ee=>_.value.problemId=ee),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(x,{label:"用户"},{default:l(()=>[t(D,{modelValue:_.value.username,"onUpdate:modelValue":V[1]||(V[1]=ee=>_.value.username=ee),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(x,{label:"语言"},{default:l(()=>[t(H,{modelValue:_.value.language,"onUpdate:modelValue":V[2]||(V[2]=ee=>_.value.language=ee),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:l(()=>[(L(!0),Q(le,null,he(w.value,ee=>(L(),G(K,{key:ee.value,value:ee.value,label:ee.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(x,{label:"状态"},{default:l(()=>[t(H,{modelValue:_.value.status,"onUpdate:modelValue":V[3]||(V[3]=ee=>_.value.status=ee),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:l(()=>[(L(!0),Q(le,null,he(s.value,ee=>(L(),G(K,{key:ee.value,value:ee.value,label:ee.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(x,null,{default:l(()=>[t(O,null,{default:l(()=>[t(A,{theme:"primary",type:"submit"},{default:l(()=>V[7]||(V[7]=[I("搜索")])),_:1}),t(A,{theme:"default",variant:"base",type:"reset"},{default:l(()=>V[8]||(V[8]=[I("重置")])),_:1})]),_:1})]),_:1})]),_:1}),t(ue,{data:P.value,columns:p.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:C.value,loading:b.value,onPageChange:z,"table-layout":"auto"},null,8,["data","columns","pagination","loading"])]),_:1}),t(ce,{visible:g.value,"onUpdate:visible":V[5]||(V[5]=ee=>g.value=ee),width:"800px","cancel-btn":null,"close-btn":!1,onConfirm:V[6]||(V[6]=ee=>g.value=!1)},{header:l(()=>[t(Y,{onClick:V[4]||(V[4]=()=>{var ee;M((ee=S.value)==null?void 0:ee.id)})},{default:l(()=>{var ee,be;return[I(N(((ee=S.value)==null?void 0:ee.id)+" - "+((be=S.value)==null?void 0:be.language)),1)]}),_:1})]),default:l(()=>[t(te,{loading:i.value},{default:l(()=>{var ee;return[R("div",{innerHTML:(ee=S.value)==null?void 0:ee.code,ref_key:"markdownCodeRef",ref:v,style:{"min-height":"100px"}},null,8,Co)]}),_:1},8,["loading"])]),_:1},8,["visible"])],64)}}}),Mt=se(So,[["__scopeId","data-v-172ab9e7"]]),Io={class:"dida-code-container"},Po=["innerHTML"],To={key:2,class:"dida-edit-container"};function Kt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ge(e)}const xo=ne({__name:"JudgeJobDetail",setup(e){const a=ge(),n=Ke(),r=xe(),{globalProperties:o}=de();let d=!1,y,g=0,S=0;const v=c(""),i=c(null),m=c(""),_=c(null),p=c(0),b=c(null),u=c({from:"#5a96ff",to:"#00A870"});let f=!1;const C=c([{title:"ID",colKey:"id"},{title:"问题",colKey:"problemId",cell:(q,z)=>t(J,{variant:"text",onClick:()=>U(z.row.problemId)},{default:()=>[z.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(q,z)=>{const T=z.row.status,V=mt(T),D=da(T);let x=[];return Ze(T)&&x.push(t(Ie,{text:z.row.state,size:"small",class:"dida-status-loading"},null)),x.push(t("span",null,[V])),t(J,{theme:D,variant:"outline"},Kt(x)?x:{default:()=>[x]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"language",cell:(q,z)=>t("span",null,[Lt(z.row.language)+" / "+z.row.codeLength])},{title:"作者",colKey:"author",width:200,cell:(q,z)=>t(J,{variant:"text",onClick:()=>M(z.row.authorUsername)},{default:()=>[z.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),P=c(!1),w=c(!1),s=c(),k=Me(()=>r.hasAuth(ze.ManageJudge)),h=async()=>{if(!w.value){w.value=!0;try{const q=await _n(g);q.code===0?await j(!0):B(o,q.code)}catch(q){console.error(q),B(o,De())}finally{w.value=!1}}},U=q=>{q&&n.push({path:"/problem/"+q})},M=q=>{q&&n.push({path:"/user/"+q})},E=q=>{const z=q.status,T=mt(z);let V;switch(z){case Le.Init:case Le.Rejudge:case Le.Compiling:case Le.Running:V="default";break;case Le.Accept:V="success";break;case Le.PE:V="warning";break;default:V="danger";break}return t(ye,null,{default:()=>[t(J,{theme:"default",variant:"outline"},{default:()=>[q.taskId]}),t(J,{theme:V,variant:"outline"},Kt(T)?T:{default:()=>[T]}),t("span",null,[I("分数："),q.score]),t("span",null,[I("用时："),q.time]),t("span",null,[I("内存："),q.memory])]})},j=async q=>{var T;q&&(P.value=!0);let z=!1;try{const V=await un(g);if(s.value=[],V.code===0){const D=V.data,x=pa(D);if((T=s.value)==null||T.push(x),D.judger){const H=await ra(D.judger);v.value=H.name}else v.value="";u.value.to="#00A870",Ze(D.status)?(b.value="active",x.taskTotal>0?(p.value=x.taskCurrent/x.taskTotal*100,x.taskCurrent>=x.taskTotal&&(p.value=99)):p.value=0):(p.value=100,D.status===Le.Accept?b.value="success":D.status===Le.PE?(u.value.to="#F57C20",b.value="warning"):(u.value.to="#F56C6C",b.value="error"));const K={};if(D.code){const A=`\`\`\`${Dt(D.language)}
${D.code}
\`\`\``;m.value=await _e.md2html(A,K),await Ae(()=>{_.value&&(f||(f=!0,_e.highlightRender({lineNumber:!0,enable:!0},_.value)),Ye(_.value))})}i.value=x,Ze(D.status)&&(z=!0)}else q&&B(o,V.code),S?await n.push({name:"contest-judge",params:{contestId:S}}):await n.push({name:"judge-list"})}catch(V){console.error(V),q&&B(o,De())}finally{q&&(P.value=!1),z&&d&&(y=setTimeout(()=>{j(!1)},5e3))}};function $(){_.value&&_.value.parentElement&&(_.value.style.maxWidth=_.value.parentElement.clientWidth+"px")}return re(async()=>{if(d=!0,Array.isArray(a.params.judgeId)?g=Number(a.params.judgeId[0]):g=Number(a.params.judgeId),Array.isArray(a.params.contestId)?S=Number(a.params.contestId[0]):S=Number(a.params.contestId),!g){await n.push({name:"judge"});return}await j(!0),$(),window.addEventListener("resize",$)}),Pe(()=>{d=!1,window.removeEventListener("resize",$),clearTimeout(y)}),(q,z)=>{var me,Y,te;const T=aa,V=Te,D=pe,x=ke,K=Fe,H=qe,A=we,O=Ha,F=Ba,ue=J;return L(),Q(le,null,[t(T,{color:u.value,status:b.value,class:"dida-job-progress",percentage:p.value},null,8,["color","status","percentage"]),t(D,{style:{margin:"10px"}},{default:l(()=>[t(V,{data:s.value,columns:C.value,"row-key":"id","vertical-align":"top",hover:!0,loading:P.value},null,8,["data","columns","loading"])]),_:1}),t(A,null,{default:l(()=>[t(x,{span:8},{default:l(()=>[R("div",Io,[R("div",{innerHTML:m.value,ref_key:"markdownCodeRef",ref:_,class:"dida-code-div"},null,8,Po)])]),_:1}),t(x,{span:4},{default:l(()=>[t(H,{layout:"vertical",bordered:!0,style:{margin:"10px"}},{default:l(()=>[t(K,{label:"判题机"},{default:l(()=>[I(N(v.value),1)]),_:1}),t(K,{label:"判题时间"},{default:l(()=>{var ce;return[I(N((ce=i.value)==null?void 0:ce.judgeTime),1)]}),_:1})]),_:1})]),_:1})]),_:1}),(me=i.value)!=null&&me.compileMessage?(L(),G(D,{key:0,class:"compile-message"},{default:l(()=>{var ce;return[I(N((ce=i.value)==null?void 0:ce.compileMessage),1)]}),_:1})):ae("",!0),(Y=i.value)!=null&&Y.task&&((te=i.value)==null?void 0:te.task.length)>0?(L(),G(F,{key:1,class:"task-panel"},{default:l(()=>{var ce;return[(L(!0),Q(le,null,he((ce=i.value)==null?void 0:ce.task,(ee,be)=>(L(),G(O,{key:ee.taskId,header:()=>E(ee)},{default:l(()=>[I(N(ee.content)+" "+N(ee.waHint),1)]),_:2},1032,["header"]))),128))]}),_:1})):ae("",!0),k.value?(L(),Q("div",To,[t(ue,{onClick:h,loading:w.value},{default:l(()=>z[0]||(z[0]=[I("重新评测")])),_:1},8,["loading"])])):ae("",!0)],64)}}}),qt=se(xo,[["__scopeId","data-v-23d2dc0c"]]),Vo={style:{margin:"10px"}},Lo=ne({__name:"ContestList",setup(e){const a=ge(),n=Ke(),{globalProperties:r}=de();let o=null;const d=c([{title:"ID",colKey:"id",cell:(C,P)=>t(J,{variant:"text",onClick:()=>_(P.row.id)},{default:()=>[P.row.id]})},{title:"标题",colKey:"title",cell:(C,P)=>t(J,{variant:"text",onClick:()=>_(P.row.id)},{default:()=>[P.row.title]})},{title:"负责人",colKey:"ownerNickname"},{title:"权限",colKey:"private",cell:(C,P)=>P.row.private?"私有":"公开"},{title:"开始时间",colKey:"startTime"},{title:"结束时间",colKey:"endTime"}]),y=c(!1);let g=1,S=50;const v=c({current:g,pageSize:S,defaultCurrent:g,defaultPageSize:S,total:0,pageSizeOptions:[50,100]}),i=c(),m=c({title:"",username:""}),_=C=>{C&&n.push({path:"/contest/"+C})},p=async()=>{await n.push({query:{...a.query,title:m.value.title,username:m.value.username,page:1,page_size:v.value.defaultPageSize}})},b=async(C,P)=>{var w;y.value=!0;try{const{current:s,pageSize:k}=C,h=await $n(s,k);if(i.value=[],h.code===0){const U=h.data.list;for(let M=0;M<U.length;M++){const E=U[M],j=await jt(E);(w=i.value)==null||w.push(j)}v.value={...v.value,total:h.data.total_count}}else P&&B(r,h.code)}catch(s){console.error(s),B(r,De())}finally{y.value=!1}},u=async C=>{await n.push({query:{...a.query,page:C.current,page_size:C.pageSize}})},f=()=>{n.push({name:"contest-create"})};return re(async()=>{o=Ve(()=>a.query,C=>{m.value.title=C.title||"",m.value.username=C.username||"";const P=parseInt(C.page)||v.value.defaultCurrent,w=parseInt(C.page_size)||v.value.defaultPageSize;g=P,S=w,v.value={...v.value,current:g,pageSize:S},b({current:g,pageSize:S},!0)},{immediate:!0})}),Pe(()=>{o&&o()}),(C,P)=>{const w=Te,s=pe,k=ke,h=Ue,U=$e,M=J,E=je,j=ye,$=we;return L(),G($,null,{default:l(()=>[t(k,{span:9},{default:l(()=>[t(s,{style:{margin:"10px"}},{default:l(()=>[t(w,{data:i.value,columns:d.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:v.value,loading:y.value,"table-layout":"auto",onPageChange:u},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(k,{span:3},{default:l(()=>[R("div",Vo,[t(s,{class:"sh-card"},{default:l(()=>[t(E,{model:m.value},{default:l(()=>[t(U,{label:"标题"},{default:l(()=>[t(h,{modelValue:m.value.title,"onUpdate:modelValue":P[0]||(P[0]=q=>m.value.title=q),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(U,{label:"负责人"},{default:l(()=>[t(h,{modelValue:m.value.username,"onUpdate:modelValue":P[1]||(P[1]=q=>m.value.username=q),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(U,null,{default:l(()=>[t(M,{theme:"primary",onClick:p},{default:l(()=>P[2]||(P[2]=[I("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(s,{class:"sh-card"},{default:l(()=>[t(j,null,{default:l(()=>[t(M,{onClick:f},{default:l(()=>P[3]||(P[3]=[I("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),Ft=se(Lo,[["__scopeId","data-v-da5d30ff"]]),Do={style:{margin:"20px"}},jo={style:{margin:"10px"}},$o={style:{"text-align":"center","align-content":"center",padding:"20px",height:"500px"}},Uo={style:{"text-align":"center",width:"100%"}},zo={class:"dida-operation-container"},Ao={style:{margin:"12px"}},Ro=["innerHTML"],Eo=ne({__name:"ContestDetail",setup(e){let a=ge();const{globalProperties:n}=de(),r=Re(),o=xe();let d=0;const y=c(!1),g=c(null),S=c(!1),v=c(!1),i=c(""),m=Me(()=>o.hasAuth(ze.ManageContest)||g.value&&o.getUserId==g.value.ownerId),_=s=>{if(!s||!u)return"default";const k=u[s];if(!k)return"default";switch(k){case Je.Accept:return"success";case Je.Attempt:return"warning";default:return"default"}},p=c([{title:"问题ID",colKey:"index",cell:(s,k)=>{const h=_(k.row.index);return t(J,{variant:"dashed",theme:h,onClick:async()=>await St(d,k.row.index)},{default:()=>[k.row.id]})}},{title:"标题",colKey:"title",cell:(s,k)=>t(J,{variant:"text",onClick:async()=>await St(d,k.row.index)},{default:()=>[k.row.title]})},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),b=c([]);let u={},f=c(!1);const C=()=>{W.push({name:"contest-edit",params:{contestId:d}})},P=async s=>{if(!o.isLogin()){await W.push({name:"login"});return}if(!i.value){fe(n,"请输入密码");return}f.value=!0;try{const k=await Rn(d,i.value);if(k.code!==0){B(n,k.code);return}ve(n,"申请访问成功"),await w()}catch(k){console.error("Error submitting contest password:",k),B(n,"提交密码失败，请稍后再试")}finally{f.value=!1}},w=async()=>{y.value=!0;const s=await Vn(d);if(s.code!==0){y.value=!1,B(n,s.code),await W.push({name:"contest"});return}S.value=s.data.has_auth,v.value=s.data.need_password,g.value=await jt(s.data.contest),b.value=g.value.problems,u=s.data.attempt_status||{},r.setTitle(g.value.title+" - "+r.getTitle),await Ae(()=>{const k=document.querySelectorAll(".dida-content-description");k&&k.length>0&&k.forEach(h=>{_e.mathRender(h),_e.highlightRender({lineNumber:!0,enable:!0},h),Ye(h)}),y.value=!1})};return re(async()=>{if(Array.isArray(a.params.contestId)?d=Number(a.params.contestId[0]):d=Number(a.params.contestId),!d){await W.push({name:"contest"});return}await w()}),(s,k)=>{const h=It,U=Te,M=pe,E=Ue,j=$e,$=J,q=je,z=ke,T=ye,V=Fe,D=qe,x=we,K=Ie;return L(),G(K,{loading:y.value},{default:l(()=>[t(x,{class:"dida-main-content"},{default:l(()=>[t(z,{span:6},{default:l(()=>{var H,A,O;return[R("div",Do,[R("h1",null,N((H=g.value)==null?void 0:H.title),1),(A=g.value)!=null&&A.notification?(L(),G(h,{key:0,theme:"info",message:(O=g.value)==null?void 0:O.notification},null,8,["message"])):ae("",!0)]),R("div",jo,[S.value?(L(),G(M,{key:0},{default:l(()=>[t(U,{data:b.value,columns:p.value,"row-key":"id","table-layout":"auto","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1})):(L(),G(M,{key:1},{default:l(()=>[R("div",$o,[t(h,{theme:"warning",message:"您没有查看本比赛的权限"}),v.value?(L(),G(q,{key:0,style:{margin:"20px auto 0",width:"200px"},onSubmit:P,"label-width":"0"},{default:l(()=>[t(j,null,{default:l(()=>[t(E,{placeholder:"请输入密码",value:i.value,"onUpdate:value":k[0]||(k[0]=F=>i.value=F),style:{width:"300px"},type:"password",autocomplete:"new-password"},null,8,["value"])]),_:1}),t(j,null,{default:l(()=>[R("div",Uo,[t($,{theme:"primary",type:"submit",loading:ie(f)},{default:l(()=>k[1]||(k[1]=[I("提交")])),_:1},8,["loading"])])]),_:1})]),_:1})):ae("",!0)])]),_:1}))])]}),_:1}),t(z,{span:6},{default:l(()=>{var H;return[R("div",zo,[t(T,null,{default:l(()=>[m.value?(L(),G($,{key:0,onClick:C},{default:l(()=>k[2]||(k[2]=[I("编辑")])),_:1})):ae("",!0)]),_:1})]),R("div",Ao,[t(D,{layout:"vertical",bordered:!0},{default:l(()=>[t(V,{label:"开始时间"},{default:l(()=>{var A;return[I(N((A=g.value)==null?void 0:A.startTime),1)]}),_:1})]),_:1}),t(D,{layout:"vertical",bordered:!0},{default:l(()=>[t(V,{label:"结束时间"},{default:l(()=>{var A;return[I(N((A=g.value)==null?void 0:A.endTime),1)]}),_:1})]),_:1})]),(H=g.value)!=null&&H.description?(L(),G(M,{key:0,style:{margin:"12px"}},{default:l(()=>{var A;return[R("div",{innerHTML:(A=g.value)==null?void 0:A.description,class:"dida-content-description"},null,8,Ro)]}),_:1})):ae("",!0)]}),_:1})]),_:1})]),_:1},8,["loading"])}}}),Mo=se(Eo,[["__scopeId","data-v-2f35f245"]]);function ya(e){return e?Math.floor(e/1e9):0}function Xe(e){if(e<=0)return"0秒";let a="";const n=Math.floor(e/3600);n>0&&(a+=`${n}小时`);const r=Math.floor(e%3600/60);return(r>0||n>0)&&(n>0&&r<10&&(a+="0"),a+=`${r}分钟`),e=e%60,(e>0||r>0||n>0)&&((n>0||r>0)&&e<10&&(a+="0"),a+=`${e.toFixed(0)}秒`),a}const Ko={style:{margin:"10px 10px 40px"}},qo={style:{"text-align":"right","margin-bottom":"10px"}},Fo={class:"table-scroll-wrapper"};function Nt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ge(e)}const No=ne({__name:"ContestRank",setup(e){const a=ge(),n=Ke(),{globalProperties:r}=de();let o=!1,d=null,y=0,g=null,S=null,v=0;const i=c(0),m=c(0),_=c(!0),p=c(!0);let b=null,u=null;const f=x=>{if(x==null)return"-";const K=Math.floor(x/3600).toString().padStart(2,"0"),H=Math.floor(x%3600/60).toString().padStart(2,"0"),A=(x%60).toFixed(0).toString().padStart(2,"0");return`${K}:${H}:${A}`},C=c({}),P=[{title:"Rank",colKey:"rank",align:"center",fixed:"left"},{title:"昵称",colKey:"nickname",fixed:"left",cell:(x,K)=>{const H=jl(K.row.nickname,18);return t(Ya,{content:K.row.nickname},{default:()=>[t(J,{variant:"text",onClick:()=>n.push({name:"user",params:{username:K.row.username}})},Nt(H)?H:{default:()=>[H]})]})}},{title:"Solved",colKey:"solved",align:"center",fixed:"left",cell:(x,K)=>t(J,{variant:"text",onClick:()=>n.push({name:"contest-judge",params:{contestId:y},query:{username:K.row.username,status:Le.Accept}})},{default:()=>[K.row.solved]})},{title:"Penalty",colKey:"penalty",align:"center",fixed:"left",cell:(x,K)=>f(K.row.penalty)}],w=c([]),s=c(!1);let k=[],h=[];const U=c([]);let M=[];const E=({col:x,rowIndex:K})=>{let H=1;for(let A=K+1;A<U.value.length&&U.value[A].rank===U.value[K].rank;A++)H++;if(x.colKey==="rank")return{rowspan:H}},j=(x,{value:K})=>Xe(K),$=()=>{b&&clearInterval(b),b=setInterval(()=>{o&&D(!1)},3e4),u&&clearInterval(u),u=setInterval(()=>{o&&(i.value=(new Date().getTime()-g.getTime())/1e3,T())},1e3)},q=()=>{b&&(clearInterval(b),b=null),u&&(clearInterval(u),u=null)},z=async x=>{_.value=x,x?(await D(!1),$()):q()},T=()=>{U.value=[];const x=[];for(let Y=0;Y<k.length;Y++){const te=k[Y];let ce={userId:te.author_id,username:te.author_username,nickname:te.author_nickname},ee=0,be=0;te.problems.forEach(oe=>{let Z=-1,Ce=oe.lock||0;if(oe.ac){if(Z=(new Date(oe.ac).getTime()-g.getTime())/1e3,Z>i.value)return;ee++,be+=Z,be+=oe.attempt*20*60}if(Ce>0&&v>0){const ot=m.value-v;i.value<ot&&(Ce=0)}const Ee=oe.index;ce[`problem_${Ee}`]={acDuration:Z,attempt:oe.attempt||0,lock:Ce}}),ce.solved=ee,ce.penalty=be,x.push(ce)}x.sort((Y,te)=>Y.solved!==te.solved?te.solved-Y.solved:Y.penalty-te.penalty);const K=h;let H=0,A=0,O=-1,F=-1;for(let Y=0;Y<x.length;Y++)x[Y].index=Y+1,K&&K.includes(x[Y].userId)?x[Y].rank="*":(A++,(x[Y].solved!==O||x[Y].penalty!==F)&&(H=A,O=x[Y].solved,F=x[Y].penalty),x[Y].rank=String(H));const ue=document.querySelectorAll("tbody tr"),me={};if(M.forEach((Y,te)=>{const ce=ue[te];ce&&(me[Y.userId]=ce.getBoundingClientRect())}),U.value=x,M=[...U.value],p.value){const Y={},te=document.querySelectorAll("table tbody tr");U.value.forEach((ce,ee)=>{const be=te[ee];be&&(Y[ce.userId]=be.getBoundingClientRect())}),requestAnimationFrame(()=>{const ce=document.querySelectorAll("table tbody tr");U.value.forEach((ee,be)=>{const oe=ce[be],Z=me[ee.userId],Ce=Y[ee.userId];if(Z&&Ce){const Ee=Z.top-Ce.top;Ee!==0&&(oe.style.transition="none",oe.style.transform=`translateY(${Ee}px)`)}}),requestAnimationFrame(()=>{document.querySelectorAll("table tbody tr").forEach(be=>{be.style.transition="transform 300ms ease",be.style.transform=""})})})}},V=x=>{z(!1),i.value=x;const K=(new Date().getTime()-g.getTime())/1e3;i.value>K&&(i.value=K),T()},D=async x=>{x&&(s.value=!0);try{const K=await Un(y);if(w.value=[...P],k=[],h=[],U.value=[],K.code===0){if(!K.data.has_auth){ve(r,"您目前没有权限查看比赛排名"),await n.push({name:"contest-detail",params:{contestId:y}});return}K.data.problems.sort((A,O)=>A-O),K.data.problems.forEach((A,O)=>{w.value.push({colKey:`problem_${A}`,align:"center",title:()=>{let F;return t(J,{variant:"text",onClick:()=>n.push({name:"contest-problem-detail",params:{contestId:y,problemIndex:A}})},Nt(F=Ne(A))?F:{default:()=>[F]})},cell:(F,ue)=>{const me=ue.row[`problem_${A}`];if(!me)return"";let Y="";return me.acDuration>=0&&(Y=f(me.acDuration)),me.attempt>0&&(Y&&(Y+=" "),Y+=`(-${me.attempt})`),me.lock>0&&(Y&&(Y+=" "),Y+=`(+${me.lock})`),t("span",null,[Y])},attrs:F=>{const ue=F.row[`problem_${A}`];return ue?ue.acDuration>=0?{style:{backgroundColor:"rgba(130,255,30,0.5)"}}:ue.lock>0?{style:{backgroundColor:"rgb(255,180,50,0.5)"}}:{style:{backgroundColor:"rgba(255,120,120,0.5)"}}:{}}})});const H=K.data.contest;if(g=new Date(H.start_time),S=new Date(H.end_time),k=K.data.ranks,h=K.data.v_members||[],m.value=Math.floor((S.getTime()-g.getTime())/1e3),C.value={0:"0",[Math.floor(m.value/2)]:Xe(Math.floor(m.value/2)),[m.value]:Xe(m.value)},v=ya(H.lock_rank_duration||0),v>0){const A=m.value-v;C.value[A]=`锁榜(${Xe(A)})`}i.value=Math.floor((new Date().getTime()-g.getTime())/1e3),_.value=!0,$(),T()}else x&&B(r,K.code)}catch(K){console.error(K),x&&B(r,De())}finally{x&&(s.value=!1)}};return re(async()=>{o=!0,d=Ve(()=>a.query,async()=>{if(Array.isArray(a.params.contestId)?y=Number(a.params.contestId[0]):y=Number(a.params.contestId),!y){await n.push({name:"contest"});return}await D(!0)},{immediate:!0})}),Pe(()=>{o=!1,d&&d(),q()}),(x,K)=>{const H=tt,A=ye,O=Ja,F=Te,ue=pe,me=we;return L(),G(me,null,{default:l(()=>[t(ue,{style:{margin:"10px",width:"100%"}},{default:l(()=>[R("div",Ko,[R("div",qo,[t(A,null,{default:l(()=>[t(H,{size:"large",modelValue:p.value,"onUpdate:modelValue":K[0]||(K[0]=Y=>p.value=Y)},{label:l(Y=>[I(N(Y.value?"开启动画":"关闭动画"),1)]),_:1},8,["modelValue"]),t(H,{size:"large",modelValue:_.value,"onUpdate:modelValue":K[1]||(K[1]=Y=>_.value=Y),onChange:z},{label:l(Y=>[I(N(Y.value?"自动刷新":"关闭刷新"),1)]),_:1},8,["modelValue"])]),_:1})]),t(O,{modelValue:i.value,"onUpdate:modelValue":K[2]||(K[2]=Y=>i.value=Y),marks:C.value,max:m.value,label:j,"tooltip-props":{placement:"top"},"input-number-props":{theme:"column",autoWidth:!0,format:ie(Xe),onChange:V},onChangeEnd:V},null,8,["modelValue","marks","max","input-number-props"])]),R("div",Fo,[t(F,{data:U.value,columns:w.value,"row-key":"index","vertical-align":"middle",bordered:!0,hover:!0,"table-layout":"auto","rowspan-and-colspan":E,loading:s.value,class:"dida-contest-rank-table"},null,8,["data","columns","loading"])])]),_:1})]),_:1})}}}),Go=se(No,[["__scopeId","data-v-56208a35"]]),Oo={style:{margin:"10px"}},Ho={style:{margin:"12px"}},Bo={class:"dida-edit-container"},Jo=ne({__name:"ContestEdit",setup(e){let a=ge();const{globalProperties:n}=de(),r=Re(),o=c(""),d=c(!1);let y=null;const g=c(!1),S=c(!1),v=c(null),i=c({title:"",openTime:[],private:!0,password:"",problems:[],members:[],description:"",notification:"",lockRankDuration:0,alwaysLock:!0,submitAnytime:!1}),m=c(""),_=c(""),p=c(!1),b=async()=>{p.value=!0,S.value=!1,p.value=!1},u=async()=>{if(y){g.value=!0;try{const w={title:i.value.title,description:y.getValue(),notification:i.value.notification,lock_rank_duration:i.value.lockRankDuration,always_lock:i.value.alwaysLock,problems:i.value.problems,members:i.value.members,private:i.value.private,password:i.value.password,submit_anytime:i.value.submitAnytime};i.value.openTime[0]&&(w.start_time=new Date(i.value.openTime[0])),i.value.openTime[1]&&(w.end_time=new Date(i.value.openTime[1]));const s=await zn(w);if(g.value=!0,s.code!==0){B(n,s.code);return}s.data!=null&&await W.push({name:"contest-detail",params:{contestId:s.data}}),Be(n,"创建成功")}finally{g.value=!1}}},f=async()=>{if(y){g.value=!0;try{const w={id:Number(o.value),title:i.value.title,description:y.getValue(),notification:i.value.notification,lock_rank_duration:i.value.lockRankDuration,always_lock:i.value.alwaysLock,problems:i.value.problems,members:i.value.members,private:i.value.private,password:i.value.password,submit_anytime:i.value.submitAnytime};i.value.openTime[0]&&(w.start_time=new Date(i.value.openTime[0])),i.value.openTime[1]&&(w.end_time=new Date(i.value.openTime[1]));const s=await An(w);if(g.value=!0,s.code!==0){B(n,s.code);return}s.data!=null&&v.value&&(v.value.updateTime=new Date(s.data).toLocaleString()),Be(n,"保存成功")}finally{g.value=!1}}},C=w=>{const s={after:()=>{y==null||y.setValue(w),d.value=!1}};y=new _e("contestEditDiv",s)},P=async()=>{const w=await Ln(o.value);if(w.code!==0){B(n,w.code),console.error("contest get failed",w.code),await W.push({name:"contest-list"});return}const s=w.data.contest;v.value=await jt(s),i.value.title=s.title,i.value.openTime=[],s.start_time?i.value.openTime.push(new Date(s.start_time)):i.value.openTime.push(""),s.end_time?i.value.openTime.push(new Date(s.end_time)):i.value.openTime.push(""),i.value.private=s.private,i.value.password=s.password||"",i.value.description=s.description||"",i.value.notification=s.notification||"",i.value.problems=w.data.problems,i.value.members=w.data.members,s.lock_rank_duration?i.value.lockRankDuration=ya(s.lock_rank_duration):i.value.lockRankDuration=0,i.value.alwaysLock=s.always_lock,i.value.submitAnytime=s.submit_anytime,r.setTitle(s.title+" - "+r.getTitle);let k="";s.description&&(k=s.description),C(k)};return re(async()=>{Array.isArray(a.params.contestId)?o.value=a.params.contestId[0]:o.value=a.params.contestId,o.value?(d.value=!0,await P()):C("")}),(w,s)=>{const k=Ue,h=$e,U=la,M=tt,E=na,j=je,$=pe,q=ke,z=J,T=ye,V=Fe,D=qe,x=we,K=Ie,H=_t,A=Oe;return L(),Q(le,null,[t(K,{loading:d.value},{default:l(()=>[t(x,null,{default:l(()=>[t(q,{span:8},{default:l(()=>[R("div",Oo,[t($,{class:"sh-card"},{default:l(()=>[t(j,{model:i.value,"label-width":"150px"},{default:l(()=>[t(h,{label:"标题"},{default:l(()=>[t(k,{modelValue:i.value.title,"onUpdate:modelValue":s[0]||(s[0]=O=>i.value.title=O),placeholder:"比赛标题"},null,8,["modelValue"])]),_:1}),t(h,{label:"通知"},{default:l(()=>[t(k,{modelValue:i.value.notification,"onUpdate:modelValue":s[1]||(s[1]=O=>i.value.notification=O),placeholder:"会更为醒目地提醒"},null,8,["modelValue"])]),_:1}),t(h,{label:"开启时间"},{default:l(()=>[t(U,{modelValue:i.value.openTime,"onUpdate:modelValue":s[2]||(s[2]=O=>i.value.openTime=O),"allow-input":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss","default-time":["00:00:00","23:59:59"]},null,8,["modelValue"])]),_:1}),t(h,{label:"提交限制"},{default:l(()=>[t(M,{modelValue:i.value.submitAnytime,"onUpdate:modelValue":s[3]||(s[3]=O=>i.value.submitAnytime=O)},{label:l(O=>[I(N(O.value?"结束仍能提交":"仅比赛期间提交"),1)]),_:1},8,["modelValue"])]),_:1}),t(h,{label:"锁榜时长"},{default:l(()=>[t(E,{modelValue:i.value.lockRankDuration,"onUpdate:modelValue":s[4]||(s[4]=O=>i.value.lockRankDuration=O),min:0,format:ie(Xe),"auto-width":""},null,8,["modelValue","format"])]),_:1}),t(h,{label:"自动解锁"},{default:l(()=>[t(M,{modelValue:i.value.alwaysLock,"onUpdate:modelValue":s[5]||(s[5]=O=>i.value.alwaysLock=O)},{label:l(O=>[I(N(O.value?"结束后仍锁榜":"结束后解锁"),1)]),_:1},8,["modelValue"])]),_:1}),t(h,{label:"私有"},{default:l(()=>[t(M,{modelValue:i.value.private,"onUpdate:modelValue":s[6]||(s[6]=O=>i.value.private=O)},null,8,["modelValue"])]),_:1}),i.value.private?(L(),G(h,{key:0,label:"密码"},{default:l(()=>[t(k,{modelValue:i.value.password,"onUpdate:modelValue":s[7]||(s[7]=O=>i.value.password=O),type:"password",placeholder:"请输入访问密码，留空代表关闭密码访问"},null,8,["modelValue"])]),_:1})):ae("",!0),i.value.private?(L(),G(h,{key:1,label:"成员"},{default:l(()=>[t(ha,{modelValue:i.value.members,"onUpdate:modelValue":s[8]||(s[8]=O=>i.value.members=O)},null,8,["modelValue"])]),_:1})):ae("",!0),t(h,{label:"问题"},{default:l(()=>[t(ba,{modelValue:i.value.problems,"onUpdate:modelValue":s[9]||(s[9]=O=>i.value.problems=O)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(q,{span:4},{default:l(()=>[R("div",Ho,[R("div",Bo,[o.value?(L(),G(T,{key:0},{default:l(()=>[t(z,{onClick:f,theme:"danger",loading:g.value},{default:l(()=>s[12]||(s[12]=[I("保存")])),_:1},8,["loading"])]),_:1})):(L(),G(T,{key:1},{default:l(()=>[t(z,{onClick:u,theme:"danger",loading:g.value},{default:l(()=>s[13]||(s[13]=[I("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(L(),G(D,{key:0,layout:"vertical",bordered:!0},{default:l(()=>[t(V,{label:"创建时间"},{default:l(()=>{var O;return[I(N((O=v.value)==null?void 0:O.createTime),1)]}),_:1}),t(V,{label:"更新时间"},{default:l(()=>{var O;return[I(N((O=v.value)==null?void 0:O.updateTime),1)]}),_:1}),t(V,{label:"创建用户"},{default:l(()=>{var O;return[I(N((O=v.value)==null?void 0:O.ownerNickname),1)]}),_:1})]),_:1})):ae("",!0)])]),_:1})]),_:1}),s[14]||(s[14]=R("div",{id:"contestEditDiv",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"]),t(A,{visible:S.value,"onUpdate:visible":s[11]||(s[11]=O=>S.value=O),onConfirm:b,header:m.value,"confirm-loading":p.value},{default:l(()=>[s[15]||(s[15]=R("div",{style:{"margin-bottom":"10px"}},[R("span",null,"多条请以空格、换行、英文逗号隔开")],-1)),t(H,{modelValue:_.value,"onUpdate:modelValue":s[10]||(s[10]=O=>_.value=O),autosize:{minRows:5}},null,8,["modelValue"])]),_:1},8,["visible","header","confirm-loading"])],64)}}}),Gt=se(Jo,[["__scopeId","data-v-cd60f18a"]]);function wa(e){const a={};return a.id=e.id,a.authorId=e.author_id,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.title=e.title,a.content=e.content,e.insert_time&&(a.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(a.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(a.updateTime=new Date(e.update_time).toLocaleString()),a.problemId=e.problem_id,a.problemTitle=e.problem_title,a.contestId=e.contest_id,a.contestTitle=e.contest_title,a.contestProblemIndex=e.contest_problem_index,a}async function Yo(e){const a={};if(a.id=e.id,a.authorId=e.author_id,a.authorUsername=e.author_username,a.authorNickname=e.author_nickname,a.content="",e.content){const n={math:{inlineDigit:!0,engine:"KaTeX"}};a.content=await _e.md2html(e.content,n)}return e.insert_time&&(a.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(a.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(a.updateTime=new Date(e.update_time).toLocaleString()),a}function Wo(e){return X({url:"/discuss?id="+e,method:"get"})}function Xo(e,a,n,r,o,d){const y={};return e&&(y.contest_id=e),a&&(y.problem_id=a),n&&(y.title=n),r&&(y.username=r),o&&(y.page=o),d&&(y.page_size=d),X({url:`/discuss/list?${new URLSearchParams(y).toString()}`,method:"get"})}function Zo(e,a,n){return X({url:"/discuss/comment/list?id="+e+"&page="+a+"&page_size="+n,method:"get"})}function Qo(e){return X({url:"/discuss/create",method:"post",data:e})}const es={style:{margin:"10px"}};function ts(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ge(e)}const as=ne({__name:"DiscussList",setup(e){const a=ge(),n=Ke(),{globalProperties:r}=de();let o=null;const d=c(!1),y=c(!1);let g=-1;const S=c([]),v=[],i=[{title:"标题",colKey:"title",cell:(j,$)=>t(J,{variant:"text",onClick:()=>s($.row.id)},{default:()=>[$.row.title]})},{title:"创建人",colKey:"authorNickname",width:"200",cell:(j,$)=>t(J,{variant:"text",onClick:async()=>await ga(n,$.row.authorUsername)},{default:()=>[$.row.authorNickname]})},{title:"创建时间",colKey:"insertTime",width:"180"},{title:"更新时间",colKey:"updateTime",width:"180"}],m=c(!1);let _=1,p=50;const b=c({current:_,pageSize:p,defaultCurrent:_,defaultPageSize:p,total:0,pageSizeOptions:[50,100]}),u=c(),f=c({problemId:"",title:"",username:""}),C=c({title:"",content:""}),P=j=>{j&&n.push({name:"problem-detail",params:{problemId:j}})},w=(j,$)=>{n.push({name:"contest-problem-detail",params:{contestId:j,problemIndex:$}})},s=j=>{if(j){if(g){n.push({name:"contest-discuss-detail",params:{contestId:g,discussId:j}});return}n.push({name:"discuss-detail",params:{discussId:j}})}},k=async()=>{await n.push({query:{...a.query,problem_id:f.value.problemId,title:f.value.title,username:f.value.username,page:1,page_size:b.value.defaultPageSize}})},h=async(j,$)=>{var q;m.value=!0;try{const{current:z,pageSize:T}=j,V=await Xo(g,f.value.problemId,f.value.title,f.value.username,z,T);if(u.value=[],V.code===0){if(!V.data.has_auth){ve(r,"您目前没有权限查看讨论列表"),g?await n.push({name:"contest-detail",params:{contestId:g}}):await n.push({name:"discuss-list"});return}if(V.data.list){const D=V.data.list;for(let x=0;x<D.length;x++){const K=D[x],H=await wa(K);(q=u.value)==null||q.push(H)}}b.value={...b.value,total:V.data.total_count}}else $&&B(r,V.code)}catch(z){console.error(z),B(r,De())}finally{m.value=!1}},U=async j=>{await n.push({query:{...a.query,page:j.current,page_size:j.pageSize}})},M=()=>{d.value=!0},E=async()=>{y.value=!0,console.log("discussCreateForm",C.value),Qo(C.value).then(j=>{j.code===0?(ve(r,"创建比赛成功"),d.value=!1,n.push({path:"/discuss/"+j.data.id})):B(r,j.code)}).finally(()=>{y.value=!1})};return re(async()=>{o=Ve(()=>a.query,j=>{Array.isArray(a.params.contestId)?g=Number(a.params.contestId[0]):g=Number(a.params.contestId),S.value=v,g?S.value=S.value.concat([{title:"问题ID",colKey:"contestProblemIndex",width:"100",cell:(z,T)=>{let V;return T.row.contestProblemIndex?t(J,{variant:"text",onClick:()=>w(g,T.row.contestProblemIndex)},ts(V=Ne(T.row.contestProblemIndex))?V:{default:()=>[V]}):""}}]):S.value=S.value.concat([{title:"问题ID",colKey:"problemId",width:"100",cell:(z,T)=>T.row.problemId?t(J,{variant:"text",onClick:()=>P(T.row.problemId)},{default:()=>[T.row.problemId]}):""}]),S.value=S.value.concat(i),f.value.problemId=j.problem_id||"",f.value.title=j.title||"",f.value.username=j.username||"";const $=parseInt(j.page)||b.value.defaultCurrent,q=parseInt(j.page_size)||b.value.defaultPageSize;_=$,p=q,b.value={...b.value,current:_,pageSize:p},h({current:_,pageSize:p},!0)},{immediate:!0})}),Pe(()=>{o&&o()}),(j,$)=>{const q=Te,z=pe,T=ke,V=Ue,D=$e,x=J,K=je,H=ye,A=we,O=Oe;return L(),Q(le,null,[t(A,null,{default:l(()=>[t(T,{span:9},{default:l(()=>[t(z,{style:{margin:"10px"}},{default:l(()=>[t(q,{data:u.value,columns:S.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:b.value,loading:m.value,"table-layout":"auto",onPageChange:U},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t(T,{span:3},{default:l(()=>[R("div",es,[t(z,{class:"sh-card"},{default:l(()=>[t(K,{model:f.value},{default:l(()=>[t(D,{label:"问题ID"},{default:l(()=>[t(V,{modelValue:f.value.problemId,"onUpdate:modelValue":$[0]||($[0]=F=>f.value.problemId=F),placeholder:"请输入完整问题ID"},null,8,["modelValue"])]),_:1}),t(D,{label:"标题"},{default:l(()=>[t(V,{modelValue:f.value.title,"onUpdate:modelValue":$[1]||($[1]=F=>f.value.title=F),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),t(D,{label:"创建人"},{default:l(()=>[t(V,{modelValue:f.value.username,"onUpdate:modelValue":$[2]||($[2]=F=>f.value.username=F),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),t(D,null,{default:l(()=>[t(x,{theme:"primary",onClick:k},{default:l(()=>$[6]||($[6]=[I("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(z,{class:"sh-card"},{default:l(()=>[t(H,null,{default:l(()=>[t(x,{onClick:M},{default:l(()=>$[7]||($[7]=[I("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),t(O,{visible:d.value,"onUpdate:visible":$[5]||($[5]=F=>d.value=F),header:"创建讨论",onConfirm:E,"confirm-loading":y.value},{default:l(()=>[t(K,{"label-width":80,model:C.value,onSubmit:$[4]||($[4]=ut(()=>{},["prevent"]))},{default:l(()=>[t(D,{label:"标题"},{default:l(()=>[t(V,{modelValue:C.value.title,"onUpdate:modelValue":$[3]||($[3]=F=>C.value.title=F),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),st=se(as,[["__scopeId","data-v-76771638"]]),ls={key:0,style:{margin:"20px"}},ns=["innerHTML"],os=["innerHTML"],ss={style:{margin:"10px"}},rs={style:{margin:"10px"}},is={style:{margin:"10px","text-align":"right"}},us={style:{margin:"12px"}},cs={key:0,class:"dida-edit-container"},ds=ne({__name:"DiscussDetail",props:{discussId:{}},setup(e){const a=e;let n=ge();const{globalProperties:r}=de();let o=null;const d=Re(),y=xe();let g=c("");const S=c(""),v=c(null),i=c(!1),m=c(null),_=c(!1);let p=1,b=20;const u=c({current:1,total:0,defaultPageSize:b,defaultCurrent:p,pageSizeOptions:[20,50]}),f=c([]),C={},P=Me(()=>y.hasAuth(ze.ManageDiscuss)),w=E=>{E&&W.push({name:"discuss-list",query:{...n.query,title:"",tag:E.name}})},s=()=>{W.push({name:"manage-discuss",params:{discussId:S.value}})},k=()=>t("div",{class:"t-pagination__total"},[`共 ${u.value.total} 条回复`]),h=()=>{},U=async(E,j)=>{var $;_.value=!0;try{const{current:q,pageSize:z}=E,T=await Zo(S.value,q,z);if(f.value=[],T.code===0){const V=T.data.list;if(V)for(let D=0;D<V.length;D++){const x=V[D],K=await Yo(x);($=f.value)==null||$.push(K),await Ae(()=>{const H=document.querySelectorAll(".dida-discuss-content");H&&H.length>0&&H.forEach(A=>{_e.mathRender(A),_e.highlightRender({lineNumber:!0,enable:!0},A),Ye(A)})})}u.value={...u.value,total:T.data.total_count}}else j&&B(r,T.code)}catch(q){console.error(q),B(r,De())}finally{_.value=!1}},M=async E=>{await W.push({query:{...n.query,page:E.current,page_size:E.pageSize}})};return re(async()=>{if(S.value=a.discussId,S.value||(Array.isArray(n.params.discussId)?S.value=n.params.discussId[0]:S.value=n.params.discussId),!S.value){fe(r,"讨论不存在"),await W.push({name:"discuss"});return}i.value=!0;const E=await Wo(S.value);if(E.code!==0){i.value=!1,B(r,E.code),await W.push({name:"discuss"});return}E.data.tags&&E.data.tags.forEach(z=>{C[z.id]=z}),m.value=wa(E.data.discuss),d.setTitle(m.value.title+" - "+d.getTitle);let j=m.value.content;const $={math:{inlineDigit:!0,engine:"KaTeX"}};g.value=await _e.md2html(j,$),await Ae(()=>{v.value&&(_e.mathRender(v.value),_e.highlightRender({lineNumber:!0,enable:!0},v.value),Ye(v.value)),i.value=!1}),o=Ve(()=>n.query,z=>{const T=parseInt(z.page)||u.value.defaultCurrent,V=parseInt(z.page_size)||u.value.defaultPageSize;p=T,b=V,u.value={...u.value,current:p,pageSize:b},U({current:p,pageSize:b},!0)},{immediate:!0});const q={after:()=>{}};new _e("commentEditRef",q)}),Pe(()=>{o&&o()}),(E,j)=>{const $=ta,q=ea,z=pe,T=ye,V=Wa,D=J,x=ke,K=Fe,H=qe,A=we,O=Ie;return L(),G(O,{loading:i.value},{default:l(()=>[t(A,{class:"dida-main-content"},{default:l(()=>[t(x,{span:8},{default:l(()=>{var F,ue,me;return[(F=m.value)!=null&&F.problemTitle||(ue=m.value)!=null&&ue.contestTitle?(L(),Q("div",ls,[t(q,{"max-item-width":"300"},{default:l(()=>{var Y,te,ce,ee,be;return[(Y=m.value)!=null&&Y.contestTitle?(L(),Q(le,{key:0},[t($,{to:{name:"contest-detail",params:{contestId:(te=m.value)==null?void 0:te.contestId}}},{default:l(()=>{var oe;return[I(N((oe=m.value)==null?void 0:oe.contestTitle),1)]}),_:1},8,["to"]),(ce=m.value)!=null&&ce.contestProblemIndex?(L(),G($,{key:0,to:{name:"contest-problem-detail",params:{problemIndex:(ee=m.value)==null?void 0:ee.contestProblemIndex}}},{default:l(()=>{var oe,Z;return[I(N(ie(Ne)((oe=m.value)==null?void 0:oe.contestProblemIndex))+" - "+N((Z=m.value)==null?void 0:Z.problemTitle),1)]}),_:1},8,["to"])):ae("",!0)],64)):(L(),Q(le,{key:1},[t($,{to:{name:"discuss-list-problem"}},{default:l(()=>j[3]||(j[3]=[I(" 问题讨论")])),_:1}),t($,{to:{name:"problem-detail",params:{problemId:(be=m.value)==null?void 0:be.problemId}}},{default:l(()=>{var oe;return[I(N((oe=m.value)==null?void 0:oe.problemTitle),1)]}),_:1},8,["to"])],64))]}),_:1})])):ae("",!0),t(z,{style:{margin:"10px"},header:(me=m.value)==null?void 0:me.title,"header-bordered":!0},{default:l(()=>[R("div",{innerHTML:ie(g),class:"dida-discuss-content"},null,8,ns)]),_:1},8,["header"]),(L(!0),Q(le,null,he(f.value,(Y,te)=>(L(),G(z,{key:te,style:{margin:"10px"},"header-bordered":""},{header:l(()=>[t(T,null,{default:l(()=>[R("span",null,N(Y.authorNickname),1),R("span",null,N(Y.insertTime),1)]),_:2},1024)]),default:l(()=>[R("div",{innerHTML:Y.content,class:"dida-discuss-content"},null,8,os)]),_:2},1024))),128)),R("div",ss,[t(V,{modelValue:u.value.current,"onUpdate:modelValue":j[0]||(j[0]=Y=>u.value.current=Y),"page-size":u.value.pageSize,"onUpdate:pageSize":j[1]||(j[1]=Y=>u.value.pageSize=Y),total:u.value.total,"page-size-options":u.value.pageSizeOptions,"show-page-size":!1,"total-content":k,onChange:M},null,8,["modelValue","page-size","total","page-size-options"])]),R("div",rs,[j[5]||(j[5]=R("div",{id:"commentEditRef",class:"dida-comment-editor"},null,-1)),R("div",is,[t(T,null,{default:l(()=>[t(D,{theme:"primary",onClick:h},{default:l(()=>j[4]||(j[4]=[I("提交")])),_:1})]),_:1})])])]}),_:1}),t(x,{span:4},{default:l(()=>[R("div",us,[P.value?(L(),Q("div",cs,[t(D,{onClick:s},{default:l(()=>j[6]||(j[6]=[I("编辑")])),_:1})])):ae("",!0),t(H,{layout:"vertical",bordered:!0},{default:l(()=>[t(K,{label:"创建时间"},{default:l(()=>{var F;return[I(N((F=m.value)==null?void 0:F.insertTime),1)]}),_:1}),t(K,{label:"编辑时间"},{default:l(()=>{var F;return[I(N((F=m.value)==null?void 0:F.modifyTime),1)]}),_:1}),t(K,{label:"更新时间"},{default:l(()=>{var F;return[I(N((F=m.value)==null?void 0:F.updateTime),1)]}),_:1}),t(K,{label:"创建用户"},{default:l(()=>[t(D,{variant:"text",onClick:j[2]||(j[2]=async()=>{var F;return await ie(ga)(ie(W),(F=m.value)==null?void 0:F.authorUsername)})},{default:l(()=>{var F;return[I(N((F=m.value)==null?void 0:F.authorNickname),1)]}),_:1})]),_:1}),t(K,{label:"标签"},{default:l(()=>[t(T,null,{default:l(()=>{var F;return[(L(!0),Q(le,null,he((F=m.value)==null?void 0:F.tags,ue=>(L(),G(D,{key:ue.id,variant:"dashed",onClick:()=>w(ue)},{default:l(()=>[I(N(ue.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),gt=se(ds,[["__scopeId","data-v-03948cc8"]]);function ms(e,a){return X({url:"/rank/ac/all?page="+e+"&page_size="+a,method:"get"})}function ps(e,a){return X({url:"/rank/ac/problem?page="+e+"&page_size="+a,method:"get"})}function fs(e,a){return X({url:"/rank/ac/problem/today?page="+e+"&page_size="+a,method:"get"})}function _s(e,a){return X({url:"/rank/ac/problem/day7?page="+e+"&page_size="+a,method:"get"})}function vs(e,a){return X({url:"/rank/ac/problem/year?page="+e+"&page_size="+a,method:"get"})}const gs={style:{margin:"10px"}};function bt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ge(e)}const bs=ne({__name:"RankUser",props:{type:{}},setup(e){const a=ge(),n=Ke(),{globalProperties:r}=de();let o=null;const d=e,y=c(""),g=c(""),S={all:{header:"统计所有用户在本站的提交记录",content:"优先以AC记录数量排序，如果相同则提交所用次数较少的优先，如果仍相同，注册较早的用户靠前"},problem:{header:"统计所有用户在本站的提交记录",content:"以题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-today":{header:"统计所有用户今日在本站的提交记录",content:"以今日题目记录数量排序，如果相同，注册较早的用户靠前"},"problem-day7":{header:"统计所有用户最近7日在本站的提交记录",content:"以7日题目记录数量排序（从7日前的0点开始计算），如果相同，注册较早的用户靠前"},"problem-year":{header:"统计所有用户最近1年在本站的提交记录",content:"以最近1年题目记录数量排序（从365日前的0点开始计算），如果相同，注册较早的用户靠前"}},v=c([]),i=[{title:"序号",colKey:"index"},{title:"用户名",colKey:"username",cell:(U,M)=>t(J,{variant:"dashed",onClick:()=>P(M.row.username)},{default:()=>[M.row.username]})},{title:"昵称",colKey:"nickname"},{title:"Slogan",colKey:"slogan"}],m=[{title:"题目数量",colKey:"problem_count",cell:(U,M)=>{let E=0;return M.row.problem_count&&(E=M.row.problem_count),t(J,{variant:"dashed",onClick:()=>w(M.row.username)},bt(E)?E:{default:()=>[E]})}}],_=[{title:"正确",colKey:"accept",cell:(U,M)=>{let E=0;return M.row.accept&&(E=M.row.accept),t(J,{variant:"dashed",onClick:()=>w(M.row.username)},bt(E)?E:{default:()=>[E]})}},{title:"提交",colKey:"attempt",cell:(U,M)=>{let E=0;return M.row.attempt&&(E=M.row.attempt),t(J,{variant:"dashed",onClick:()=>s(M.row.username)},bt(E)?E:{default:()=>[E]})}}],p=c(!1);let b=1,u=50;const f=c({current:b,pageSize:u,defaultCurrent:b,defaultPageSize:u,total:0,pageSizeOptions:[50]}),C=c(),P=U=>{n.push({name:"user",params:{username:U}})},w=U=>{n.push({name:"judge-list",query:{username:U,status:Le.Accept}})},s=U=>{n.push({name:"judge-list",query:{username:U}})},k=async(U,M)=>{p.value=!0;try{C.value=[];const{current:E,pageSize:j}=U;let $=null;switch(d.type){case"problem":$=await ps(E,j);break;case"problem-today":$=await fs(E,j);break;case"problem-day7":$=await _s(E,j);break;case"problem-year":$=await vs(E,j);break;default:$=await ms(E,j);break}if($.code===0){const q=$.data.list;if(!q||q.length<=0){f.value={...f.value,total:0},ve(r,"未找到记录");return}C.value=[];const z=f.value.pageSize*(f.value.current-1);let T=1;q.forEach(V=>{var x;const D=V;D.index=z+T++,(x=C.value)==null||x.push(D)}),f.value={...f.value,total:$.data.total_count}}else M&&B(r,$.code)}catch(E){console.error(E),B(r,De())}finally{p.value=!1}},h=async U=>{await n.push({query:{...a.query,page:U.current,page_size:U.pageSize}})};return re(async()=>{p.value=!0,o=Ve(()=>a.query,U=>{switch(d.type&&S[d.type]?(y.value=S[d.type].header,g.value=S[d.type].content):(y.value=S.all.header,g.value=S.all.content),d.type){case"all":v.value=i.concat(_);break;default:v.value=i.concat(m);break}const M=parseInt(U.page)||f.value.defaultCurrent,E=parseInt(U.page_size)||f.value.defaultPageSize;b=M,u=E,f.value={...f.value,current:b,pageSize:u},k({current:b,pageSize:u},!0)},{immediate:!0})}),Pe(()=>{o&&o()}),(U,M)=>{const E=Te,j=pe,$=ke,q=we;return L(),G(q,null,{default:l(()=>[t($,{span:9},{default:l(()=>[t(j,{style:{margin:"10px"}},{default:l(()=>[t(E,{data:C.value,columns:v.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:f.value,loading:p.value,"table-layout":"auto",onPageChange:h},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),t($,{span:3},{default:l(()=>[R("div",gs,[t(j,{class:"sh-card",header:y.value,"header-bordered":!0},{default:l(()=>[I(N(g.value),1)]),_:1},8,["header"])])]),_:1})]),_:1})}}}),et=se(bs,[["__scopeId","data-v-9bbfd60b"]]),hs=ne({__name:"ManageJudge",setup(e){const{globalProperties:a}=de(),n=c(!1),r=c(!1),o=c({problemId:"",language:void 0,status:void 0}),d=c(!1),y=c([]);y.value=Vt();const g=c([]);g.value=ma();const S=async()=>{n.value=!0;try{const m=await mn();if(m.code!==0){B(a,m.code);return}ve(a,"重判成功"),await W.push({name:"judge-list"})}catch(m){console.error(m),B(a,"重判失败")}finally{n.value=!1}},v=async()=>{if(!o.value.problemId&&!o.value.language&&!o.value.status){B(a,"请输入问题Id");return}d.value=!0;try{const m=await pn(o.value.problemId,o.value.language,o.value.status);if(m.code!==0){B(a,m.code);return}ve(a,"重判成功"),await W.push({name:"judge-list",query:{problem_id:o.value.problemId,language:o.value.language}})}catch(m){console.error(m),B(a,"重判失败")}finally{d.value=!1}},i=async()=>{r.value=!0;try{const m=await fn();if(m.code!==0){B(a,m.code);return}ve(a,"重判成功"),await W.push({name:"judge-list"})}catch(m){console.error(m),B(a,"重判失败")}finally{r.value=!1}};return(m,_)=>{const p=J,b=pe,u=Ue,f=$e,C=Pt,P=ft,w=ye,s=je;return L(),Q(le,null,[t(b,{class:"yj-manage-card",title:"重判最近提交"},{default:l(()=>[t(p,{onClick:S,loading:n.value},{default:l(()=>_[3]||(_[3]=[I("重判")])),_:1},8,["loading"])]),_:1}),t(b,{class:"yj-manage-card",title:"重判指定记录"},{default:l(()=>[t(s,{layout:"inline",onSubmit:v},{default:l(()=>[t(f,{label:"题号"},{default:l(()=>[t(u,{modelValue:o.value.problemId,"onUpdate:modelValue":_[0]||(_[0]=k=>o.value.problemId=k),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),t(f,{label:"语言"},{default:l(()=>[t(P,{modelValue:o.value.language,"onUpdate:modelValue":_[1]||(_[1]=k=>o.value.language=k),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:l(()=>[(L(!0),Q(le,null,he(y.value,k=>(L(),G(C,{key:k.value,value:k.value,label:k.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"状态"},{default:l(()=>[t(P,{modelValue:o.value.status,"onUpdate:modelValue":_[2]||(_[2]=k=>o.value.status=k),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:l(()=>[(L(!0),Q(le,null,he(g.value,k=>(L(),G(C,{key:k.value,value:k.value,label:k.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(f,null,{default:l(()=>[t(w,null,{default:l(()=>[t(p,{theme:"primary",type:"submit",loading:d.value},{default:l(()=>_[4]||(_[4]=[I("重判")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(b,{class:"yj-manage-card",title:"重判所有"},{default:l(()=>[t(p,{onClick:i,theme:"danger",loading:r.value},{default:l(()=>_[5]||(_[5]=[I("重判")])),_:1},8,["loading"])]),_:1})],64)}}}),ys=se(hs,[["__scopeId","data-v-6a706c72"]]),ws={style:{margin:"10px"}},ks={key:1},Cs={style:{margin:"12px"}},Ss={class:"dida-edit-container"},Is=ne({__name:"ProblemEdit",setup(e){let a=ge();const{globalProperties:n}=de(),r=Re(),o=c(""),d=c(!1);let y=null;const g=c(!1),S=c(null),v=c({title:"",timeLimit:0,memoryLimit:0,source:"",private:!0,tags:[]}),i=c([]),m=c([]),_=Me(()=>{const k=[],h=i.value;for(let U=0,M=h.length;U<M;U++)h[U].value&&k.push(h[U].value);return k}),p=(k,h)=>{const{trigger:U,index:M,item:E}=h;if(U==="clear"&&(i.value=[]),["tag-remove","backspace"].includes(U)&&i.value.splice(M,1),U==="enter"){for(let $=0;$<m.value.length;$++){const q=m.value[$];if(q.label===E){for(let z=0;z<i.value.length;z++)if(i.value[z].label===q.label)return;i.value.push(q);return}}const j={label:E,value:E};i.value.push(j),m.value=m.value.concat(j)}},b=(k,{current:h,type:U})=>{if(!h){i.value=U==="check"?m.value.slice(1):[];return}if(U==="check"){const M=m.value.find(E=>E.value===h);if(!M)return;i.value.push(M)}else i.value=i.value.filter(M=>M.value!==h)},u=()=>{W.push({name:"problem-detail",params:{problemId:o.value}})},f=()=>{W.push({name:"manage-problem-judge",params:{problemId:o.value}})},C=async()=>{if(y){g.value=!0,v.value.tags=[];for(let k=0;k<i.value.length;k++){const h=i.value[k];h&&h.label&&v.value.tags.push(h.label)}try{const k=await hn(v.value.title,v.value.timeLimit,v.value.memoryLimit,v.value.source,v.value.private,v.value.tags,y.getValue());if(g.value=!0,k.code!==0){B(n,k.code);return}k.data!=null&&await W.push({name:"problem-detail",params:{problemId:k.data}}),Be(n,"创建成功")}finally{g.value=!1}}},P=async()=>{if(y){g.value=!0,v.value.tags=[];for(let k=0;k<i.value.length;k++){const h=i.value[k];h&&h.label&&v.value.tags.push(h.label)}try{const k=await yn(o.value,v.value.title,v.value.timeLimit,v.value.memoryLimit,v.value.source,v.value.private,v.value.tags,y.getValue());if(g.value=!0,k.code!==0){B(n,k.code);return}k.data!=null&&(S.value.updateTime=new Date(k.data).toLocaleString()),Be(n,"保存成功")}finally{g.value=!1}}},w=k=>{const h={after:()=>{y==null||y.setValue(k),d.value=!1}};y=new _e("problemEditDiv",h)},s=async()=>{const k=await fa(o.value,void 0,void 0);if(k.code!==0){B(n,k.code),console.error("problem get failed",k.code),await W.push({name:"problem"});return}const h=k.data.problem;if(S.value=at(h,{}),v.value.title=h.title,v.value.timeLimit=h.time_limit,v.value.memoryLimit=h.memory_limit,v.value.source=h.source,v.value.private=h.private,v.value.tags=[],i.value=[],k.data.tags)for(let M=0;M<k.data.tags.length;M++){const E=k.data.tags[M];E&&E.name&&(v.value.tags.push(E.name),i.value.push({label:E.name,value:E.id}))}r.setTitle(h.title+" - "+r.getTitle);let U=h.description;w(U)};return re(async()=>{Array.isArray(a.params.problemId)?o.value=a.params.problemId[0]:o.value=a.params.problemId,o.value?(d.value=!0,_a(-1).then(async k=>{k.code===0?(k.data.list&&k.data.list.forEach(h=>{m.value.push({label:h.name,value:h.id})}),await s()):(B(n,k.code),console.error("problem tag get failed",k.code),await W.push({name:"problem"}))}).catch(async k=>{console.error(k),B(n,"获取数据异常"),await W.push({name:"problem"})})):(v.value.timeLimit=1e3,v.value.memoryLimit=65536,w(""))}),(k,h)=>{const U=Ue,M=$e,E=na,j=tt,$=Za,q=Xa,z=je,T=pe,V=ke,D=J,x=ye,K=Fe,H=qe,A=we,O=Ie;return L(),G(O,{loading:d.value},{default:l(()=>[t(A,null,{default:l(()=>[t(V,{span:8},{default:l(()=>[R("div",ws,[t(T,{class:"sh-card"},{default:l(()=>[t(z,{model:v.value},{default:l(()=>[t(M,{label:"标题"},{default:l(()=>[t(U,{modelValue:v.value.title,"onUpdate:modelValue":h[0]||(h[0]=F=>v.value.title=F),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),t(M,{label:"时间限制"},{default:l(()=>[t(E,{modelValue:v.value.timeLimit,"onUpdate:modelValue":h[1]||(h[1]=F=>v.value.timeLimit=F),theme:"normal",min:0},{suffix:l(()=>h[5]||(h[5]=[R("span",null,"ms",-1)])),_:1},8,["modelValue"])]),_:1}),t(M,{label:"内存限制"},{default:l(()=>[t(E,{modelValue:v.value.memoryLimit,"onUpdate:modelValue":h[2]||(h[2]=F=>v.value.memoryLimit=F),theme:"normal",min:0},{suffix:l(()=>h[6]||(h[6]=[R("span",null,"KB",-1)])),_:1},8,["modelValue"])]),_:1}),t(M,{label:"来源"},{default:l(()=>[t(U,{modelValue:v.value.source,"onUpdate:modelValue":h[3]||(h[3]=F=>v.value.source=F),placeholder:"请输入题目来源"},null,8,["modelValue"])]),_:1}),t(M,{label:"私有"},{default:l(()=>[t(j,{modelValue:v.value.private,"onUpdate:modelValue":h[4]||(h[4]=F=>v.value.private=F)},null,8,["modelValue"])]),_:1}),t(M,{label:"标签"},{default:l(()=>[t(q,{value:i.value,"allow-input":!0,placeholder:"请选择或输入","tag-input-props":{excessTagsDisplayType:"break-line"},"popup-props":{overlayInnerClassName:["narrow-scrollbar"],overlayInnerStyle:{maxHeight:"280px",overflowY:"auto",overscrollBehavior:"contain",padding:"6px"}},clearable:"",multiple:"",onTagChange:p},{panel:l(()=>[m.value.length?(L(),G($,{key:0,value:_.value,options:m.value,onChange:b},null,8,["value","options"])):(L(),Q("div",ks,"暂无数据"))]),suffixIcon:l(()=>[t(ie(Da))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),t(V,{span:4},{default:l(()=>[R("div",Cs,[R("div",Ss,[o.value?(L(),G(x,{key:0},{default:l(()=>[t(D,{onClick:P,theme:"danger",loading:g.value},{default:l(()=>h[7]||(h[7]=[I("保存")])),_:1},8,["loading"]),t(D,{onClick:f,theme:"warning"},{default:l(()=>h[8]||(h[8]=[I("判题数据")])),_:1}),t(D,{onClick:u},{default:l(()=>h[9]||(h[9]=[I("查看")])),_:1})]),_:1})):(L(),G(x,{key:1},{default:l(()=>[t(D,{onClick:C,theme:"danger",loading:g.value},{default:l(()=>h[10]||(h[10]=[I("创建")])),_:1},8,["loading"])]),_:1}))]),o.value?(L(),G(H,{key:0,layout:"vertical",bordered:!0},{default:l(()=>[t(K,{label:"创建时间"},{default:l(()=>{var F;return[I(N((F=S.value)==null?void 0:F.insertTime),1)]}),_:1}),t(K,{label:"更新时间"},{default:l(()=>{var F;return[I(N((F=S.value)==null?void 0:F.updateTime),1)]}),_:1}),t(K,{label:"判题方式"},{default:l(()=>{var F;return[I(N((F=S.value)==null?void 0:F.judgeType),1)]}),_:1}),t(K,{label:"上传用户"},{default:l(()=>{var F;return[I(N((F=S.value)==null?void 0:F.creatorNickname),1)]}),_:1})]),_:1})):ae("",!0)])]),_:1})]),_:1}),h[11]||(h[11]=R("div",{id:"problemEditDiv",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"])}}}),Ot=se(Is,[["__scopeId","data-v-583e6955"]]),Ps={style:{margin:"10px"}},Ts={style:{margin:"12px"}},xs={class:"dida-edit-container"},Vs=ne({__name:"ProblemJudge",setup(e){let a=ge();const{globalProperties:n}=de(),r=Re(),o=c(""),d=c(!1),y=c(null);let g=null;const S=c(null),v=c(""),i=c(!1),m=c(!1),_=c([{title:"文件",colKey:"file"},{title:"大小",colKey:"size",width:150,cell:(j,$)=>$.row.size.toFixed(0)+" B"},{title:"最后修改时间",colKey:"lastModified",width:180,cell:(j,$)=>new Date($.row.lastModified).toLocaleString()},{title:"操作",colKey:"action",width:100,cell:(j,$)=>t(J,{onClick:()=>P($.row.file)},{default:()=>[I("下载")]})}]),p=c([]),b=Me(()=>({border:"2px dashed #ccc",borderRadius:"6px",padding:"20px",textAlign:"center",cursor:"pointer",backgroundColor:i.value?"#f0f9ff":"#fff",transition:"background-color 0.2s ease"})),u=Me(()=>v.value?`已选择：${v.value}`:i.value?"松开文件以上传":"拖拽文件到这里，或点击选择文件"),f=()=>{W.push({name:"problem-detail",params:{problemId:o.value}})},C=()=>{W.push({name:"manage-problem",params:{problemId:o.value}})},P=async j=>{const $=await wn(o.value,j);if($.code!==0){B(n,$.code);return}const q=document.createElement("a");q.href=$.data,q.target="_blank",q.click(),URL.revokeObjectURL(q.href)},w=async()=>{if(!g){fe(n,"请选择压缩包");return}m.value=!0,kn(o.value,g).then(async j=>{j.code==0?(S.value.value=null,g=null,v.value="",d.value=!0,Be(n,"上传成功"),await E()):B(n,j.code)}).catch(j=>{console.log(j),n.$message.error({duration:3e3,content:"申请失败"})}).finally(()=>{m.value=!1})},s=()=>{var j;(j=S.value)==null||j.click()},k=j=>{const $=j.target.files[0];$&&(v.value=$.name,g=$)},h=j=>{i.value=!0},U=()=>{i.value=!1},M=j=>{j.preventDefault(),j.stopPropagation(),i.value=!1;const $=j.dataTransfer.files[0];if($){v.value=$.name;const q=new DataTransfer;q.items.add($),S.value.files=q.files,g=$}},E=async()=>{const j=await vn(o.value);if(j.code!==0){B(n,j.code),await W.push({name:"problem"});return}const $=j.data.problem;y.value=at($,{}),r.setTitle($.title+" - "+r.getTitle),p.value=[],j.data.judges?j.data.judges.forEach(q=>{p.value.push({file:q.key,size:q.size,lastModified:q.last_modified})}):fe(n,"评测数据不存在"),d.value=!1};return re(async()=>{if(Array.isArray(a.params.problemId)?o.value=a.params.problemId[0]:o.value=a.params.problemId,!o.value){fe(n,"题目不存在"),await W.push({name:"problem"});return}d.value=!0,await E()}),(j,$)=>{const q=Te,z=ke,T=J,V=ye,D=Fe,x=qe,K=we,H=Ie;return L(),G(H,{loading:d.value},{default:l(()=>[t(K,null,{default:l(()=>[t(z,{span:7},{default:l(()=>[R("div",Ps,[R("div",{id:"drop-zone",style:Xt(b.value),onClick:s,onDragenter:ut(h,["prevent"]),onDragover:$[0]||($[0]=ut(()=>{},["prevent"])),onDragleave:ut(U,["prevent"]),onDrop:M},[R("input",{ref_key:"fileInput",ref:S,type:"file",style:{display:"none"},onChange:k},null,544),I(" "+N(u.value),1)],36)]),t(q,{data:p.value,columns:_.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1}),t(z,{span:5},{default:l(()=>[R("div",Ts,[R("div",xs,[t(V,null,{default:l(()=>[t(T,{onClick:w,theme:"danger",loading:m.value},{default:l(()=>$[1]||($[1]=[I("上传")])),_:1},8,["loading"]),t(T,{onClick:C,theme:"warning"},{default:l(()=>$[2]||($[2]=[I("编辑")])),_:1}),t(T,{onClick:f},{default:l(()=>$[3]||($[3]=[I("查看")])),_:1})]),_:1})]),t(x,{layout:"vertical",bordered:!0},{default:l(()=>[t(D,{label:"标题"},{default:l(()=>{var A;return[I(N((A=y.value)==null?void 0:A.title),1)]}),_:1}),t(D,{label:"创建时间"},{default:l(()=>{var A;return[I(N((A=y.value)==null?void 0:A.insertTime),1)]}),_:1}),t(D,{label:"更新时间"},{default:l(()=>{var A;return[I(N((A=y.value)==null?void 0:A.updateTime),1)]}),_:1}),t(D,{label:"判题方式"},{default:l(()=>{var A;return[I(N((A=y.value)==null?void 0:A.judgeType),1)]}),_:1}),t(D,{label:"评测数据"},{default:l(()=>{var A;return[I(N((A=y.value)==null?void 0:A.judgeMd5),1)]}),_:1}),t(D,{label:"上传用户"},{default:l(()=>{var A;return[I(N((A=y.value)==null?void 0:A.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Ls=se(Vs,[["__scopeId","data-v-17986e38"]]),Ds={style:{display:"flex","align-items":"center"}},js={style:{color:"#409eff","margin-right":"20px"}},$s={class:"dida-login-footer"},Us=ne({__name:"UserForget",setup(e){const{globalProperties:a}=de(),n=xe(),r=c(!1),o=c(!1),d=c(!1),y=c("发送验证码");let g=null,S=-1;const v=c(!1),i=c(null),m=c(""),_=c({username:"",emailKey:"",password:"",confirmPassword:""}),b=c({username:[{required:!0,message:"请填写用户名"},{min:4,message:"用户名至少4个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"}],password:[{required:!0,message:"请填写密码"},{min:6,message:"密码至少6个字符"},{max:20,message:"密码最多20个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:k=>new Promise(h=>{const U=setTimeout(()=>{h(_.value.password===k),clearTimeout(U)})}),message:"两次密码不一致"}],emailKey:[{required:!0,message:"请填写验证码"},{min:6,message:"请输入完整字符"},{max:6,message:"请输入完整字符"}]}),u=()=>{ve(a,"重置成功")},f=async k=>{if(!d.value){r.value=!0,o.value=!0;try{const h=await Nl(k,_.value.username);h.code===0?(ve(a,"验证码发送成功"),m.value=h.data,o.value=!1,d.value=!0,g=new Date,y.value="60秒后重发",S=setInterval(()=>{const M=Math.floor((new Date().getTime()-(g==null?void 0:g.getTime()))/1e3);M>60?(y.value="发送验证码",d.value=!1,clearInterval(S)):y.value=`${60-M}秒后重发`},1e3)):B(a,h.code)}catch(h){console.error("Send email key error",h),fe(a,"发送验证码失败")}finally{r.value=!1}}},C=async()=>{var M;if(v.value=!0,d.value||o.value)return;await Ae();const k=document.getElementById("cf-confirm-div");k&&k.remove();const h=document.createElement("div");h.id="cf-confirm-div",h.setAttribute("data-theme","light"),(M=i.value)==null||M.appendChild(h);const U=window;U.turnstile.ready(function(){U.turnstile.render("#cf-confirm-div",{sitekey:"0x4AAAAAABeM4SYPu2Rn7PmI",callback:async function(E){v.value=!1,await f(E)},"before-interactive-callback":function(){console.log("before-interactive-callback")}})})},P=c(()=>t(J,{onClick:C,disabled:d.value,loading:o.value,style:"width:120px"},{default:()=>[y.value]})),w=async()=>{r.value=!0;try{const k=await Gl(_.value.username,_.value.password,_.value.emailKey);k.code===0?(ve(a,"密码修改成功"),a.$router.push({name:"login"})):B(a,k.code)}catch(k){console.error("Modify password error",k),fe(a,"修改密码失败")}finally{r.value=!1}},s=async({validateResult:k,firstError:h,e:U})=>{if(!r.value){if(U.preventDefault(),k!==!0){fe(a,h);return}m.value?await w():await C()}};return re(()=>{if(n.isLogin()){a.$router.push({path:"/user"});return}}),Pe(()=>{}),(k,h)=>{const U=It,M=Ue,E=$e,j=Qt,$=J,q=je,z=We,T=pe,V=Oe;return L(),Q(le,null,[t(T,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:l(()=>[t(U,{"max-line":1},{default:l(()=>h[6]||(h[6]=[R("span",null,"如果您未绑定邮箱或忘记用户名，可联系管理员寻求帮助",-1),R("span",null,"管理员邮箱：BoilTask@qq.com",-1)])),_:1}),t(q,{ref:"form",rules:b.value,data:_.value,colon:!0,onReset:u,onSubmit:s,class:"yj-login-form"},{default:l(()=>[t(E,{name:"username",label:"用户名"},{default:l(()=>[t(M,{modelValue:_.value.username,"onUpdate:modelValue":h[0]||(h[0]=D=>_.value.username=D),clearable:"",placeholder:"请输入完整用户名"},null,8,["modelValue"])]),_:1}),m.value?(L(),Q(le,{key:0},[t(E,{name:"email",label:"发送邮箱"},{default:l(()=>[t(j,{append:P.value},{default:l(()=>[R("div",Ds,[R("span",js,N(m.value),1)])]),_:1},8,["append"])]),_:1}),t(E,{name:"emailKey",label:"验证码"},{default:l(()=>[t(M,{modelValue:_.value.emailKey,"onUpdate:modelValue":h[1]||(h[1]=D=>_.value.emailKey=D),clearable:"",placeholder:"请输入收到的验证码"},null,8,["modelValue"])]),_:1}),t(E,{name:"password",label:"新密码"},{default:l(()=>[t(M,{modelValue:_.value.password,"onUpdate:modelValue":h[2]||(h[2]=D=>_.value.password=D),type:"password",clearable:"",placeholder:"新密码"},null,8,["modelValue"])]),_:1}),t(E,{name:"confirmPassword",label:"确认密码"},{default:l(()=>[t(M,{modelValue:_.value.confirmPassword,"onUpdate:modelValue":h[3]||(h[3]=D=>_.value.confirmPassword=D),type:"password",clearable:"",placeholder:"请重复输入密码"},null,8,["modelValue"])]),_:1})],64)):ae("",!0),m.value?(L(),G(E,{key:1},{default:l(()=>[t($,{theme:"primary",type:"submit",block:"",loading:r.value},{default:l(()=>h[7]||(h[7]=[I("修改密码")])),_:1},8,["loading"])]),_:1})):(L(),G(E,{key:2},{default:l(()=>[t($,{theme:"primary",type:"submit",block:"",loading:r.value},{default:l(()=>h[8]||(h[8]=[I("重置密码")])),_:1},8,["loading"])]),_:1}))]),_:1},8,["rules","data"]),R("div",$s,[t(z,{onClick:h[4]||(h[4]=()=>{ie(a).$router.push({name:"login"})})},{default:l(()=>h[9]||(h[9]=[I("返回登陆 ")])),_:1})])]),_:1}),t(V,{visible:v.value,"onUpdate:visible":h[5]||(h[5]=D=>v.value=D),header:"正在加载人机验证","close-btn":!1,footer:!1},{default:l(()=>[R("div",{ref_key:"dialogContainer",ref:i,class:"cf-confirm-container"},null,512)]),_:1},8,["visible"])],64)}}}),zs=se(Us,[["__scopeId","data-v-c3586c6f"]]),ka=[{name:"problem-list",tab:"problem",sidebar:"problem-list",path:"",title:"问题列表",icon:"list",component:xn},{name:"problem-detail",tab:"problem",sidebar:"problem-list",path:":problemId+",title:"问题详情",icon:"list",component:At},{name:"problem-recommend",tab:"problem",sidebar:"problem-recommend",path:"recommend/:problemId*",title:"问题推荐",icon:"cpu",needLogin:!0,component:Yn},{name:"problem-collection-list",tab:"problem",sidebar:"problem-collection-list",path:"collection",title:"题目集合",icon:"list",disableTabPath:!0,component:no},{name:"collection-detail",tab:"collection-detail-tab",sidebar:"collection-detail",path:":collectionId+",title:"题集详情",icon:"cpu",component:co},{name:"collection-rank",tab:"collection-detail-tab",sidebar:"collection-rank",path:":collectionId+/rank",title:"题集排名",icon:"list",component:mo},{name:"collection-edit",tab:"collection-detail-tab",sidebar:"collection-edit",disableSidebar:!0,needLogin:!0,path:":collectionId+/edit",title:"题集编辑",icon:"list",component:Rt},{name:"collection-create",tab:"collection-detail-tab",sidebar:"collection-create",needLogin:!0,disableSidebar:!0,path:"create",title:"新建题集",icon:"list",component:Rt},{name:"judge-list",tab:"judge",sidebar:"judge-list",path:"",title:"评测列表",icon:"list",component:Mt},{name:"judge-detail",tab:"judge",sidebar:"judge-list",path:":judgeId+",title:"评测详情",icon:"cpu",component:qt},{name:"contest-list",tab:"contest",sidebar:"contest-list",path:"",title:"比赛列表",icon:"list",component:Ft},{name:"contest-recent",tab:"contest",sidebar:"contest-recent",path:"recent",title:"近期比赛",icon:"list",component:Ft},{name:"contest-create",tab:"contest",sidebar:"contest-create",disableSidebar:!0,needLogin:!0,path:"create",title:"新建比赛",icon:"list",component:Gt},{name:"contest-edit",tab:"contest-detail-tab",sidebar:"contest-edit",disableSidebar:!0,needLogin:!0,path:":contestId+/edit",title:"比赛编辑",icon:"list",component:Gt},{name:"contest-detail",tab:"contest-detail-tab",sidebar:"contest-detail",path:":contestId+",title:"比赛详情",icon:"cpu",component:Mo},{name:"contest-problem-detail",tab:"contest-detail-tab",sidebar:"contest-problem-detail",path:":contestId+/problem/:problemIndex+",title:"问题详情",icon:"cpu",disableSidebar:!0,component:At},{name:"contest-judge",tab:"contest-detail-tab",sidebar:"contest-judge",path:":contestId+/judge",title:"评测列表",icon:"list",component:Mt},{name:"contest-judge-detail",tab:"contest-detail-tab",sidebar:"contest-judge-detail",path:":contestId+/judge/:judgeId+",title:"评测详情",icon:"cpu",component:qt,disableSidebar:!0},{name:"contest-rank",tab:"contest-detail-tab",sidebar:"contest-rank",path:":contestId+/rank",title:"比赛排名",icon:"list",component:Go},{name:"contest-discuss",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss",title:"比赛讨论",icon:"list",component:st},{name:"contest-discuss-detail",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss/:discussId+",title:"讨论详情",icon:"list",component:gt},{name:"discuss-list",tab:"discuss",sidebar:"discuss-list",path:"",title:"讨论列表",icon:"list",component:st},{name:"discuss-list-problem",tab:"discuss",sidebar:"discuss-list-problem",path:"problem",title:"问题讨论",icon:"list",component:st},{name:"discuss-list-judge",tab:"discuss",sidebar:"discuss-list-judge",path:"judge",title:"评测讨论",icon:"list",component:st},{name:"discuss-detail",tab:"discuss",sidebar:"discuss-list",path:":discussId+",title:"讨论详情",icon:"list",component:gt},{name:"rank-ac-all",tab:"rank",sidebar:"rank-ac-all",path:"ac",title:"AC排名",icon:"base-station",props:{type:"all"},component:et},{name:"rank-ac-problem",tab:"rank",sidebar:"rank-ac-problem",path:"ac/problem",title:"题量排名",icon:"base-station",props:{type:"problem"},component:et},{name:"rank-ac-problem-today",tab:"rank",sidebar:"rank-ac-problem-today",path:"ac/problem/today",title:"今日题量",icon:"base-station",props:{type:"problem-today"},component:et},{name:"rank-ac-problem-day7",tab:"rank",sidebar:"rank-ac-problem-day7",path:"ac/problem/day7",title:"7日题量",icon:"base-station",props:{type:"problem-day7"},component:et},{name:"rank-ac-problem-year",tab:"rank",sidebar:"rank-ac-problem-year",path:"ac/problem/year",title:"1年题量",icon:"base-station",props:{type:"problem-year"},component:et},{name:"tool-paste",tab:"tool",sidebar:"tool-paste",path:"paste",title:"码池",icon:"base-station",component:kt},{name:"system-status",tab:"system",sidebar:"system-status",path:"",title:"运行状态",icon:"base-station",component:kt},{name:"system-about",tab:"system",sidebar:"system-about",path:"about",title:"关于",icon:"base-station",props:{discussId:"52"},component:gt},{name:"manage-problem-create",tab:"manage",sidebar:"manage-problem-create",disableSidebar:!0,path:"problem",title:"新建问题",icon:"list",component:Ot,auths:[ze.ManageProblem]},{name:"manage-problem",tab:"manage",sidebar:"manage-problem",disableSidebar:!0,path:"problem/:problemId+",title:"问题编辑",icon:"list",component:Ot,auths:[ze.ManageProblem]},{name:"manage-problem-judge",tab:"manage",sidebar:"manage-problem-judge",disableSidebar:!0,path:"problem/:problemId+/judge",title:"评测数据",icon:"list",component:Ls,auths:[ze.ManageProblem]},{name:"manage-judge",tab:"manage",path:"judge",sidebar:"manage-judge",title:"评测管理",icon:"list",auths:["i-manage-judge"],component:ys},{name:"login-forget",tab:"login",path:"forget",title:"忘记密码",component:zs}],Ht=(e,a,n,r)=>{r.tab==n&&(r.disableSidebar&&a!=r.sidebar||r.sidebar==null||r.sidebar!=r.name||e.push({name:r.name,title:r.title,icon:r.icon,to:{name:r.name}}))},As=(e,a)=>{const n=[];return ka.forEach(r=>{if(ca(r)){const o=[];r.children.forEach(d=>{Ht(o,e,a,d)}),o.length>0&&n.push({title:r.title,children:o})}else Ht(n,e,a,r)}),n},Bt=(e,a)=>{const n=an(a.tab),r={name:a.name,path:"/"+a.path,meta:{title:a.title+" - "+n.title,tab:a.tab,sidebar:a.sidebar,showSidebar:n.showSidebar,needLogin:n.needLogin||a.needLogin,tabAuths:n.auths,auths:a.auths},props:a.props,component:a.component};!n.disablePath&&!a.disableTabPath&&(r.path=n.path+r.path),e.push(r)},Rs=e=>{ka.forEach(a=>{ca(a)?a.children.forEach(n=>{Bt(e,n)}):Bt(e,a)})},Es={class:"sh-main"},Ms=ne({__name:"View403",setup(e){let a=ge();const n=c("");return re(()=>{a.query.target?n.value=a.query.target:n.value=a.fullPath}),(r,o)=>{const d=J;return L(),Q("div",Es,[R("p",null,N(n.value),1),o[2]||(o[2]=R("p",null,"该页面无访问权限，请更换访问目标或重新登陆后再试",-1)),t(d,{theme:"primary",onClick:o[0]||(o[0]=()=>r.$router.push("/"))},{default:l(()=>o[1]||(o[1]=[I("返回首页")])),_:1})])}}}),Ca=se(Ms,[["__scopeId","data-v-8f62f1f8"]]),lt=[];nn(lt);Rs(lt);lt.push({path:"/403",name:"403",component:Ca});lt.push({path:"/:pathMatch(.*)*",name:"404",component:ia});const W=ja({history:$a("/"),routes:lt});W.beforeEach((e,a,n)=>{if(e.name==null||!W.hasRoute(e.name)){n({name:"home"});return}const r=e.matched[e.matched.length-1].meta;if(r.redirect){n({name:r.redirect});return}if(r.needLogin){const d=xe();if(d.getToken==null||d.getToken==""){n({name:"login",query:{redirect_uri:e.fullPath}});return}}const o=r.tabAuths;if(o&&!xe().hasAllAuths(o)){n({name:"403",query:{target:e.fullPath}});return}n()});W.afterEach((e,a)=>{if(e.name===a.name)return;const n=vt(),r=Re();let o=null;if(e.matched.length>0&&(o=e.matched[e.matched.length-1].meta),o!=null&&o.title&&r.setTitle(o==null?void 0:o.title),o!=null&&o.showSidebar){n.setSidebarShow(!0);const d=As(o==null?void 0:o.sidebar,o==null?void 0:o.tab);n.setMenuList(d),n.setMenuActiveName(o==null?void 0:o.sidebar)}else n.setSidebarShow(!1)});const Sa=pt("login",{state:()=>({Loaded:!1}),getters:{isLoaded(){return this.Loaded}}}),Ks=ne({__name:"HeaderContent",setup(e){const a=Sa(),n=xe(),{globalProperties:r}=de(),o=c(a.isLoaded),d=c(!1),y=c(n.getUsername),g=c(n.getNickname),S=c(),v=()=>{S.value=ln(n)};a.$subscribe((_,p)=>{o.value=p.Loaded}),n.$subscribe((_,p)=>{y.value=p.username,g.value=p.nickname,d.value=p.token!="",v()});const i=()=>{r.$router.currentRoute.value.name!=="login"&&r.$router.push({name:"login",query:{redirect_uri:r.$router.currentRoute.value.fullPath}})},m=()=>{n.clear(),r.$message.success({duration:3e3,content:"注销成功"}),r.$router.push({path:"/login",query:{redirect_uri:r.$router.currentRoute.value.fullPath}})};return re(()=>{v()}),(_,p)=>{const b=Zt("router-link"),u=sa,f=oa,C=Qa,P=el;return L(),G(P,{modelValue:_.$route.meta.tab,"onUpdate:modelValue":p[0]||(p[0]=w=>_.$route.meta.tab=w),class:"sh-menu","expand-type":"popup"},{logo:l(()=>[t(b,{to:"/",class:"sh-logo"},{default:l(()=>p[1]||(p[1]=[I("DidaOJ")])),_:1})]),operations:l(()=>[o.value&&d.value?(L(),G(C,{key:0,title:g.value},{icon:l(()=>[t(u,{name:"user"})]),default:l(()=>[t(f,{value:"user",to:{path:"/user/"+y.value}},{default:l(()=>p[2]||(p[2]=[I("个人空间")])),_:1},8,["to"]),t(f,{value:"user_logout",onClick:m},{default:l(()=>p[3]||(p[3]=[I(" 注销")])),_:1})]),_:1},8,["title"])):o.value?(L(),G(f,{key:2,value:"login",onClick:i},{icon:l(()=>[t(u,{name:"login"})]),default:l(()=>[p[5]||(p[5]=I(" 登录 "))]),_:1})):(L(),G(f,{key:1,value:"login"},{icon:l(()=>[t(u,{name:"login"})]),default:l(()=>[p[4]||(p[4]=I(" ... "))]),_:1}))]),default:l(()=>[(L(!0),Q(le,null,he(S.value,w=>(L(),G(f,{key:w.name,value:w.name,to:{name:w.name}},{icon:l(()=>[w.icon?(L(),G(u,{key:0,name:w.icon},null,8,["name"])):ae("",!0)]),default:l(()=>[I(" "+N(w.title),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])}}}),qs=se(Ks,[["__scopeId","data-v-c64d812f"]]),Fs={id:"menu-container"},Ns=ne({__name:"SidebarContent",setup(e){const a=vt(),n=c(!1),r=c(null),o=c(a.menuActiveName),d=c(a.menuList),y=c([]),g=c(!1),S=()=>{o.value=a.menuActiveName;const i=JSON.stringify(d.value),m=JSON.stringify(a.menuList);i!==m&&(y.value.push([...a.menuList]),v())},v=async()=>{if(y.value.length>0&&!g.value){for(g.value=!0;y.value.length>1;)y.value.shift();const i=y.value.shift();n.value=i.length<=0,d.value=[],await Ae(),r.value&&r.value.updateActiveName(),await new Promise(_=>setTimeout(_,300)),d.value=i,await Ae(),r.value&&r.value.updateActiveName();const m=300;await new Promise(_=>setTimeout(_,m)),g.value=!1,await v()}};return a.$subscribe((i,m)=>{S()}),re(()=>{S()}),(i,m)=>{const _=sa,p=oa,b=al,u=tl,f=Ie;return L(),Q(le,null,[R("div",Fs,[t(u,{modelValue:o.value,"onUpdate:modelValue":m[0]||(m[0]=C=>o.value=C),theme:"light",class:"sh-menu-container"},{default:l(()=>[t(Ua,{name:"move-left"},{default:l(()=>[(L(!0),Q(le,null,he(d.value,(C,P)=>(L(),Q(le,{key:P},[ie(on)(C)?(L(),G(b,{key:0,title:C.title},{default:l(()=>[(L(!0),Q(le,null,he(C.children,(w,s)=>(L(),G(p,{key:w.name,value:w.name,to:w.to},Ut({default:l(()=>[I(" "+N(w.title),1)]),_:2},[w.icon?{name:"icon",fn:l(()=>[t(_,{name:w.icon,class:wt(w.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))),128))]),_:2},1032,["title"])):(L(),G(p,{key:C.name,value:C.name,to:C.to},Ut({default:l(()=>[I(" "+N(C.title),1)]),_:2},[C.icon?{name:"icon",fn:l(()=>[t(_,{name:C.icon,class:wt(C.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),t(f,{size:"small",loading:n.value,"show-overlay":!0,attach:"#menu-container",class:"sh-sidebar-loading",style:{"align-items":"flex-start","padding-top":"100px"}},null,8,["loading"])],64)}}}),Gs=se(Ns,[["__scopeId","data-v-96e2d89f"]]),Os={};function Hs(e,a){return null}const Bs=se(Os,[["render",Hs]]),Js={class:"footer"},Ys={class:"footer-left"},Ws={class:"foot-time"},Xs={class:"footer-center"},Zs={href:"https://beiancx.miit.gov.cn/",target:"_blank"},Qs={class:"footer-right"},er={class:"foot-text"},tr={href:"https://github.com/hpu-developer/DiDaOJ-web",target:"_blank"},ar={class:"foot-text"},lr={href:"https://github.com/hpu-developer/DiDaOJ-go",target:"_blank"},nr=ne({__name:"FooterContent",setup(e){const a=c("");function n(){a.value=new Date().toLocaleString()}return re(()=>{n(),setInterval(()=>{n()},1e3)}),(r,o)=>{const d=J;return L(),Q("div",Js,[R("div",Ys,[R("p",Ws,N(a.value),1)]),R("div",Xs,[R("a",Zs,[t(d,{theme:"default",variant:"outline",ghost:!0},{default:l(()=>o[0]||(o[0]=[I("豫ICP备15024677号-4")])),_:1})])]),R("div",Qs,[R("p",er,[R("a",tr,[t(d,{theme:"default",variant:"outline",ghost:!0},{default:l(()=>o[1]||(o[1]=[I("@didaoj-web")])),_:1})])]),R("p",ar,[R("a",lr,[t(d,{theme:"default",variant:"outline",ghost:!0},{default:l(()=>o[2]||(o[2]=[I("@didaoj-go")])),_:1})])])])])}}}),or=se(nr,[["__scopeId","data-v-979fed79"]]),rt=20,ht=100,yt=50,sr=ne({__name:"ForceHiddenSidebarButton",setup(e){let a=vt();const n=c({x:window.innerWidth-ht-rt,y:window.innerHeight-yt-rt}),r=c(window.innerWidth),o=c(window.innerHeight);let d=!1,y={x:0,y:0};const g=C=>{d=!0;const P=C.clientX??C.touches[0].clientX,w=C.clientY??C.touches[0].clientY;y={x:P-n.value.x,y:w-n.value.y},document.addEventListener("mousemove",S),document.addEventListener("touchmove",S),document.addEventListener("mouseup",v),document.addEventListener("touchend",v)},S=C=>{if(!d)return;const P=C.clientX??C.touches[0].clientX,w=C.clientY??C.touches[0].clientY;let s=P-y.x,k=w-y.y;s=Math.max(0,Math.min(s,r.value-ht)),k=Math.max(0,Math.min(k,o.value-yt)),n.value={x:s,y:k}},v=()=>{d=!1,document.removeEventListener("mousemove",S),document.removeEventListener("touchmove",S),document.removeEventListener("mouseup",v),document.removeEventListener("touchend",v)},i=()=>{r.value=window.innerWidth,o.value=window.innerHeight,n.value={x:Math.min(n.value.x,r.value-ht-rt),y:Math.min(n.value.y,o.value-yt-rt)}};let m=c(a.forceHiddenSidebar),_=c(a.forceHiddenSidebar);const p=()=>{m.value=!m.value,a.setForceHiddenSidebar(m.value)},b=()=>{_.value||(_.value=!0,a.setForceHiddenSidebar(m.value))},u=()=>{_.value&&(_.value=!1,a.setForceHiddenSidebar(!1))},f=C=>{C>=800?u():b()};return f(r.value),Ve(r,C=>{f(C)}),re(()=>{window.addEventListener("resize",i)}),Pe(()=>{window.removeEventListener("resize",i)}),(C,P)=>{const w=J;return ie(_)?(L(),G(w,{key:0,class:"draggable-button",style:Xt({top:`${n.value.y}px`,left:`${n.value.x}px`}),onMousedown:g,onTouchstart:g,variant:"dashed",theme:"primary",onClick:p},{default:l(()=>[I(N(ie(m)?"显示":"隐藏"),1)]),_:1},8,["style"])):ae("",!0)}}}),rr=se(sr,[["__scopeId","data-v-1aee5506"]]),it="DidaOJ",ir=ne({__name:"App",setup(e){const{globalProperties:a}=de(),n=Sa(),r=xe(),o=Re(),d=vt();n.$patch({Loaded:!1});const y=r.getToken,g=c(!1),S=c(!1);o.title&&o.title.length>0?document.title=o.title+" - "+it:document.title=it,o.$subscribe((_,p)=>{p.title&&p.title.length>0?document.title=p.title+" - "+it:document.title=it}),d.$subscribe((_,p)=>{g.value=p.showSidebar,S.value=g.value&&!p.forceHiddenSidebar});const v=ge(),i=Me(()=>{const _=v.meta.auths;return _?!r.hasAllAuths(_):!1});function m(){a.$message.warning({duration:3e3,content:"登陆状态失效"}),n.$patch({Loaded:!0}),r.clear()}return re(()=>{if(y==""){n.$patch({Loaded:!0});return}Al().then(_=>{_.code==0?(r.loadResponse(_.data),n.$patch({Loaded:!0})):(B(a,_.code),n.$patch({Loaded:!0}),r.clear())}).catch(_=>{console.log(_),m()})}),(_,p)=>{const b=ll,u=ol,f=Zt("RouterView"),C=sl,P=nl,w=rl;return L(),Q(le,null,[t(P,null,{default:l(()=>[t(b,{class:"sh-header"},{default:l(()=>[t(qs)]),_:1}),t(P,null,{default:l(()=>[t(za,{name:"slide"},{default:l(()=>[S.value?(L(),G(u,{key:0,class:"sh-sidebar"},{default:l(()=>[t(Gs)]),_:1})):ae("",!0)]),_:1}),t(P,{class:wt(["sh-main-layout",{expanded:!S.value}])},{default:l(()=>[t(Bs),t(C,{class:"sh-main-content"},{default:l(()=>[i.value?(L(),G(Ca,{key:0})):(L(),G(f,{key:1}))]),_:1}),t(or)]),_:1},8,["class"])]),_:1})]),_:1}),g.value?(L(),G(rr,{key:0})):ae("",!0),t(w,{container:"body",offset:["24px","80px"],size:"small"})],64)}}}),ur=se(ir,[["__scopeId","data-v-9e122cb4"]]);ul.registerLanguage("verilog",cl);const Ia=Aa();Ia.use(Ra);const nt=Ea(ur);nt.use(Ia);nt.use(W);nt.use(il);nt.use(Ma);nt.mount("#app");Vl().then(()=>{console.log("Text cache reinitialized")}).catch(e=>{console.error("Text cache reinitialization failed",e)});
