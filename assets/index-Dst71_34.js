import{bm as Be,bn as Nt,bo as X,s as a,bp as n,bq as j,br as M,ap as y,n as ae,r as p,bs as ce,bt as q,aD as ne,g as Gt,o as le,bu as G,bv as gt,bw as Ke,bx as vt,F as te,by as fe,bz as ie,aM as Ot,bA as et,bB as tt,q as we,y as ze,J as Le,bC as ht,c as Ce,a0 as Kt,bD as qe,u as Xe,bE as Me,ac as Ft,bF as Bt,bG as Xt,bH as Jt,bI as Wt,B as Yt,bJ as Zt}from"./node_modules-CwWekrCs.js";import{R as ve,C as he,a as de,B as H,F as Pe,b as Te,I as ke,L as ot,M as bt,c as yt,S as Qt,H as ea,d as ta,e as aa,f as be,g as na,h as oa,A as la,i as sa,j as ra,T as xe,k as _e,D as De,l as Re,m as wt,O as kt,n as lt,P as ua,o as Ct,p as St,q as It,r as ia,s as ca,t as da,u as ma,v as pa,w as fa,x as _a,y as ga}from"./tdesign-vue-next-Br0XQrkj.js";import{V as oe}from"./vditor-DArazWIS.js";import{e as ct}from"./monaco-editor-DCUKHC_e.js";import{H as va,v as ha}from"./highlight.js-D9zWiMxS.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const c of l)if(c.type==="childList")for(const g of c.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&s(g)}).observe(document,{childList:!0,subtree:!0});function o(l){const c={};return l.integrity&&(c.integrity=l.integrity),l.referrerPolicy&&(c.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?c.credentials="include":l.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(l){if(l.ep)return;l.ep=!0;const c=o(l);fetch(l.href,c)}})();var Se=(e=>(e.Manage="i-manage",e.ManageJudge="i-manage-judge",e.ManageProblem="i-manage-problem",e))(Se||{});const ba={"r-admin":["i-manage","i-manage-judge","i-manage-problem"]};function ya(e){if(e==null)return[];const t=[];for(const o of e){const s=ba[o];s!=null&&t.push(...s)}return[...new Set(t)]}function wa(e,t){if(e==null||t==null)return!1;const o=ya(e);for(const s of t)if(!o.includes(s))return!1;return!0}const ge=Be("user",{state:()=>({token:"",userId:-1,username:"",nickname:"",roles:[]}),getters:{getToken(){return this.token},getUserId(){return this.userId},getUsername(){return this.username},getNickname(){return this.nickname}},actions:{clear(){this.$patch({token:"",userId:-1,username:"",nickname:"",roles:[]})},loadResponse(e){this.$patch({token:e.token,userId:e.user_id,username:e.username,nickname:e.nickname,roles:e.roles})},isLogin(){return this.token!=null&&this.token!=""},hasAuth(e){return this.hasAllAuths([e])},hasAllAuths(e){return e?wa(this.roles,e):!0}},persist:!0}),ka="https://oj-api.didapipa.com/",Y=Nt.create({baseURL:ka,timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});Y.interceptors.request.use(e=>{const o=ge().getToken;return o&&(e.headers["X-Token"]=o),e},e=>Promise.reject(e));Y.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});function Lt(e,t){return Y({url:"/user/login",method:"post",data:{username:e,password:t}})}function Ca(){return Y({url:"/user/login/refresh",method:"post"})}const Pt=Be("login",{state:()=>({Loaded:!1}),getters:{isLoaded(){return this.Loaded}}}),je=Be("webStyle",{state:()=>({title:""}),getters:{getTitle(){return this.title}},actions:{setTitle(e){this.title=e}}}),Je=Be("sidebarStyle",{state:()=>({showSidebar:!1,forceHiddenSidebar:!1,menuActiveName:"",menuList:[]}),getters:{getMenuList(){return this.menuList}},actions:{setSidebarShow(e){this.showSidebar=e},setForceHiddenSidebar(e){this.forceHiddenSidebar=e},setMenuActiveName(e){this.menuActiveName=e},clearMenuList(){this.menuList=[]},setMenuList(e){this.menuList=e},addMenuList(e){this.menuList.push(e)}}}),Q=(e,t)=>{const o=e.__vccOpts||e;for(const[s,l]of t)o[s]=l;return o},Sa={},Ia={class:"sh-main"};function La(e,t){const o=de,s=he,l=ve;return j(),X("div",Ia,[a(l,null,{default:n(()=>[a(s,{span:6},{default:n(()=>[a(o,{title:"正在完善，欢迎提供意见建议"},{default:n(()=>t[0]||(t[0]=[M("p",null,[M("a",{href:"https://codeoj.cn/",target:"_blank"},"CodeOJ"),y("的迁移计划")],-1),M("p",null,"正在开发中",-1)])),_:1})]),_:1})]),_:1})])}const Pa=Q(Sa,[["render",La],["__scopeId","data-v-78f609f9"]]),Ta={class:"sh-main"},xa=ae({__name:"View404",setup(e){let t=ce(),o=p(t.fullPath);return(s,l)=>{const c=H;return j(),X("div",Ta,[M("p",null,q(ne(o)),1),l[2]||(l[2]=M("p",null,"该页面无效或已被迁移，请重新选择访问目标",-1)),a(c,{theme:"primary",onClick:l[0]||(l[0]=()=>s.$router.push("/"))},{default:n(()=>l[1]||(l[1]=[y("返回首页")])),_:1})])}}}),Tt=Q(xa,[["__scopeId","data-v-d4218944"]]);let at=null;async function ja(){at=await $a()}function Va(e,t="zh"){if(at==null)return[!1,e.toString()];const o=at[e.toString()];if(!o)return[!1,e.toString()];let s=o[t];return s||(t="zh",s=o[t]),s?[!0,s]:[!1,e.toString()]}async function $a(){return new Promise((e,t)=>{e({404:{zh:"接口未找到"},1e3:{zh:"系统错误"},10001:{zh:"权限异常，请重新登陆后再试"},10002:{zh:"参数不符合要求"},10003:{zh:"未找到目标数据"},100001:{zh:"用户名不存在或密码不匹配"}})})}function ue(){const{appContext:e}=Gt();return{globalProperties:e.config.globalProperties}}function Ie(){return 1e3}function xt(e,t,o=3e3){e.$message.success({duration:o,content:t})}function pe(e,t,o=3e3){e.$message.info({duration:o,content:t})}function me(e,t,o=3e3){e.$message.error({duration:o,content:t})}function N(e,t,o=3e3){const[s,l]=Va(t),c=s?l:`系统错误，错误提示[${l}]`;e.$message.error({duration:o,content:c})}const za={class:"dida-login-footer"},Da=ae({__name:"LoginView",setup(e){const{globalProperties:t}=ue(),o=ge(),s=p(!1),l=p({account:"",password:""}),c=()=>{pe(t,"重置成功")},g=({validateResult:S,firstError:m})=>{s.value||Lt(l.value.account,l.value.password).then(f=>{if(f.code===0){o.loadResponse(f.data),pe(t,"登录成功");let u=t.$route.query.redirect_uri;u||(u="/user/"+f.data.username),t.$router.push({path:u})}else N(t,f.code)}).catch(f=>{console.error("Login error",f),me(t,"登录失败")})};return le(()=>{if(o.isLogin()){t.$router.push({path:"/user"});return}}),(S,m)=>{const f=ke,u=Te,_=H,h=Pe,b=ot,L=de;return j(),G(L,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:n(()=>[a(h,{ref:"form",data:l.value,colon:!0,onReset:c,onSubmit:g,class:"yj-login-form","label-width":0},{default:n(()=>[a(u,{name:"account"},{default:n(()=>[a(f,{modelValue:l.value.account,"onUpdate:modelValue":m[0]||(m[0]=P=>l.value.account=P),clearable:"",placeholder:"请输入账户名"},{"prefix-icon":n(()=>[a(ne(gt))]),_:1},8,["modelValue"])]),_:1}),a(u,{name:"password"},{default:n(()=>[a(f,{modelValue:l.value.password,"onUpdate:modelValue":m[1]||(m[1]=P=>l.value.password=P),type:"password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":n(()=>[a(ne(Ke))]),_:1},8,["modelValue"])]),_:1}),a(u,null,{default:n(()=>[a(_,{theme:"primary",type:"submit",block:"",loading:s.value},{default:n(()=>m[4]||(m[4]=[y("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),M("div",za,[a(b,{onClick:m[2]||(m[2]=()=>{ne(t).$router.push({name:"login-forget"})})},{default:n(()=>m[5]||(m[5]=[y("忘记密码")])),_:1}),a(b,{onClick:m[3]||(m[3]=()=>{ne(t).$router.push({name:"register"})})},{default:n(()=>m[6]||(m[6]=[y("注册账户")])),_:1})])]),_:1})}}}),Ra=Q(Da,[["__scopeId","data-v-9450941b"]]),Aa={};function Ea(e,t){return" TODO "}const Ma=Q(Aa,[["render",Ea]]),qa={class:"dida-login-footer"},Ua=ae({__name:"RegisterView",setup(e){const{globalProperties:t}=ue(),o=ge(),s=p(!1),l=p({account:"",password:"",confirmPassword:"",email:""}),c=()=>{pe(t,"重置成功")},g=({validateResult:S,firstError:m})=>{s.value||Lt(l.value.account,l.value.password).then(f=>{if(f.code===0){o.loadResponse(f.data),pe(t,"登录成功");let u=t.$route.query.redirect_uri;u||(u="/user/"+f.data.username),t.$router.push({path:u})}else N(t,f.code)}).catch(f=>{console.error("Login error",f),me(t,"登录失败")})};return le(()=>{if(o.isLogin()){t.$router.push({path:"/user"});return}}),(S,m)=>{const f=ke,u=Te,_=H,h=Pe,b=ot,L=de;return j(),G(L,{class:"yj-login-card",title:"欢迎使用DidaOJ~"},{default:n(()=>[a(h,{ref:"form",data:l.value,colon:!0,onReset:c,onSubmit:g,class:"yj-login-form","label-width":0},{default:n(()=>[a(u,{name:"account"},{default:n(()=>[a(f,{modelValue:l.value.account,"onUpdate:modelValue":m[0]||(m[0]=P=>l.value.account=P),clearable:"",placeholder:"请输入账户名"},{"prefix-icon":n(()=>[a(ne(gt))]),_:1},8,["modelValue"])]),_:1}),a(u,{name:"password"},{default:n(()=>[a(f,{modelValue:l.value.password,"onUpdate:modelValue":m[1]||(m[1]=P=>l.value.password=P),type:"password",clearable:"",placeholder:"请输入密码"},{"prefix-icon":n(()=>[a(ne(Ke))]),_:1},8,["modelValue"])]),_:1}),a(u,{name:"confirm-password"},{default:n(()=>[a(f,{modelValue:l.value.confirmPassword,"onUpdate:modelValue":m[2]||(m[2]=P=>l.value.confirmPassword=P),type:"password",clearable:"",placeholder:"请确认密码"},{"prefix-icon":n(()=>[a(ne(Ke))]),_:1},8,["modelValue"])]),_:1}),a(u,{name:"email"},{default:n(()=>[a(f,{modelValue:l.value.email,"onUpdate:modelValue":m[3]||(m[3]=P=>l.value.email=P),type:"password",clearable:"",placeholder:"邮箱"},{"prefix-icon":n(()=>[a(ne(Ke))]),_:1},8,["modelValue"])]),_:1}),a(u,null,{default:n(()=>[a(_,{theme:"primary",type:"submit",block:"",loading:s.value},{default:n(()=>m[5]||(m[5]=[y("注册")])),_:1},8,["loading"])]),_:1})]),_:1},8,["data"]),M("div",qa,[a(b,{onClick:m[4]||(m[4]=()=>{ne(t).$router.push({name:"login"})})},{default:n(()=>m[6]||(m[6]=[y("返回登陆")])),_:1})])]),_:1})}}}),Ha=Q(Ua,[["__scopeId","data-v-e840b450"]]),st=[{name:"home",path:"/",title:"首页",showSidebar:!1,disableGenerateTab:!0,component:Pa},{name:"problem",path:"/problem",title:"题目",icon:"calculation",showSidebar:!0,redirect:"problem-list"},{name:"judge",path:"/judge",title:"评测",icon:"code",showSidebar:!0,redirect:"judge-list"},{name:"contest",path:"/contest",title:"比赛",icon:"application",showSidebar:!0,redirect:"contest-list"},{name:"contest-detail-tab",title:"比赛",path:"/contest",showSidebar:!0,disableGenerateTab:!0,redirect:"contest-list"},{name:"discuss",title:"讨论",path:"/discuss",icon:"sonic",showSidebar:!0,redirect:"discuss-list"},{name:"system",path:"/system",title:"系统",icon:"dashboard",showSidebar:!0,redirect:"discuss-list"},{name:"manage",path:"/manage",title:"管理",icon:"command",showSidebar:!0,redirect:"manage-judge",auths:[Se.Manage]},{name:"login",path:"/login",title:"登陆",showSidebar:!1,disableGenerateTab:!0,component:Ra},{name:"register",path:"/register",title:"注册",showSidebar:!1,disableGenerateTab:!0,component:Ha},{name:"user",path:"/user/:username+",title:"用户",showSidebar:!1,needLogin:!0,disableGenerateTab:!0,component:Ma},{name:"404",path:"/404",title:"404",showSidebar:!1,disableGenerateTab:!0,component:Tt}],Na=e=>st.find(t=>t.name==e),Ga=e=>{const t=[];return st.forEach(o=>{!o.disableGenerateTab&&e.hasAllAuths(o.auths)&&t.push(o)}),t},Oa=e=>{st.forEach(t=>{const o={name:t.name,path:t.path,meta:{title:t.title,tab:t.name,showSidebar:t.showSidebar,needLogin:t.needLogin,redirect:t.redirect,tabAuths:t.auths},component:t.component};e.push(o)})},Ka=ae({__name:"HeaderContent",setup(e){const t=Pt(),o=ge(),{globalProperties:s}=ue(),l=p(t.isLoaded),c=p(!1),g=p(o.getUsername),S=p(o.getNickname),m=p(),f=()=>{m.value=Ga(o)};t.$subscribe((h,b)=>{l.value=b.Loaded}),o.$subscribe((h,b)=>{g.value=b.username,S.value=b.nickname,c.value=b.token!="",f()});const u=()=>{s.$router.currentRoute.value.name!=="login"&&s.$router.push({name:"login",query:{redirect_uri:s.$router.currentRoute.value.fullPath}})},_=()=>{o.clear(),s.$message.success({duration:3e3,content:"注销成功"}),s.$router.push({path:"/login",query:{redirect_uri:s.$router.currentRoute.value.fullPath}})};return le(()=>{f()}),(h,b)=>{const L=vt("router-link"),P=yt,E=bt,z=Qt,K=ea;return j(),G(K,{modelValue:h.$route.meta.tab,"onUpdate:modelValue":b[0]||(b[0]=I=>h.$route.meta.tab=I),class:"sh-menu","expand-type":"popup"},{logo:n(()=>[a(L,{to:"/",class:"sh-logo"},{default:n(()=>b[1]||(b[1]=[y("DidaOJ")])),_:1})]),operations:n(()=>[l.value&&c.value?(j(),G(z,{key:0,title:S.value},{icon:n(()=>[a(P,{name:"user"})]),default:n(()=>[a(E,{value:"user",to:{path:"/user/"+g.value}},{default:n(()=>b[2]||(b[2]=[y("个人空间")])),_:1},8,["to"]),a(E,{value:"user_logout",onClick:_},{default:n(()=>b[3]||(b[3]=[y(" 注销")])),_:1})]),_:1},8,["title"])):l.value?(j(),G(E,{key:2,value:"login",onClick:u},{icon:n(()=>[a(P,{name:"login"})]),default:n(()=>[b[5]||(b[5]=y(" 登录 "))]),_:1})):(j(),G(E,{key:1,value:"login"},{icon:n(()=>[a(P,{name:"login"})]),default:n(()=>[b[4]||(b[4]=y(" ... "))]),_:1}))]),default:n(()=>[(j(!0),X(te,null,fe(m.value,I=>(j(),G(E,{key:I.name,value:I.name,to:{name:I.name}},{icon:n(()=>[I.icon?(j(),G(P,{key:0,name:I.icon},null,8,["name"])):ie("",!0)]),default:n(()=>[y(" "+q(I.title),1)]),_:2},1032,["value","to"]))),128))]),_:1},8,["modelValue"])}}}),Fa=Q(Ka,[["__scopeId","data-v-a4891d9b"]]);function jt(e){return e.children!==void 0}function Ba(e){return e.children!==void 0}const Xa={id:"menu-container"},Ja=ae({__name:"SidebarContent",setup(e){const t=Je(),o=p(!1),s=p(null),l=p(t.menuActiveName),c=p(t.menuList),g=p([]),S=p(!1),m=()=>{l.value=t.menuActiveName;const u=JSON.stringify(c.value),_=JSON.stringify(t.menuList);u!==_&&(g.value.push([...t.menuList]),f())},f=async()=>{if(g.value.length>0&&!S.value){for(S.value=!0;g.value.length>1;)g.value.shift();const u=g.value.shift();o.value=u.length<=0,c.value=[],await we(),s.value&&s.value.updateActiveName(),await new Promise(h=>setTimeout(h,300)),c.value=u,await we(),s.value&&s.value.updateActiveName();const _=300;await new Promise(h=>setTimeout(h,_)),S.value=!1,await f()}};return t.$subscribe((u,_)=>{m()}),le(()=>{m()}),(u,_)=>{const h=yt,b=bt,L=aa,P=ta,E=be;return j(),X(te,null,[M("div",Xa,[a(P,{modelValue:l.value,"onUpdate:modelValue":_[0]||(_[0]=z=>l.value=z),theme:"light",class:"sh-menu-container"},{default:n(()=>[a(Ot,{name:"move-left"},{default:n(()=>[(j(!0),X(te,null,fe(c.value,(z,K)=>(j(),X(te,{key:K},[ne(Ba)(z)?(j(),G(L,{key:0,title:z.title},{default:n(()=>[(j(!0),X(te,null,fe(z.children,(I,T)=>(j(),G(b,{key:I.name,value:I.name,to:I.to},et({default:n(()=>[y(" "+q(I.title),1)]),_:2},[I.icon?{name:"icon",fn:n(()=>[a(h,{name:I.icon,class:tt(I.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))),128))]),_:2},1032,["title"])):(j(),G(b,{key:z.name,value:z.name,to:z.to},et({default:n(()=>[y(" "+q(z.title),1)]),_:2},[z.icon?{name:"icon",fn:n(()=>[a(h,{name:z.icon,class:tt(z.iconClass)},null,8,["name","class"])]),key:"0"}:void 0]),1032,["value","to"]))],64))),128))]),_:1})]),_:1},8,["modelValue"])]),a(E,{size:"small",loading:o.value,"show-overlay":!0,attach:"#menu-container",class:"sh-sidebar-loading",style:{"align-items":"flex-start","padding-top":"100px"}},null,8,["loading"])],64)}}}),Wa=Q(Ja,[["__scopeId","data-v-96e2d89f"]]),Ya={};function Za(e,t){return null}const Qa=Q(Ya,[["render",Za]]),en={class:"footer"},tn={class:"footer-left"},an={class:"foot-time"},nn={class:"footer-center"},on={href:"https://boiltask.com",target:"_blank"},ln={class:"footer-right"},sn={class:"foot-text"},rn={href:"https://github.com/hpu-user/DiDaOJ-web",target:"_blank"},un=ae({__name:"FooterContent",setup(e){const t=p("");function o(){t.value=new Date().toLocaleString()}return le(()=>{o(),setInterval(()=>{o()},1e3)}),(s,l)=>{const c=H;return j(),X("div",en,[M("div",tn,[M("p",an,q(t.value),1)]),M("div",nn,[M("a",on,[a(c,{theme:"default",variant:"outline",ghost:!0},{default:n(()=>l[0]||(l[0]=[y("@BoilTask")])),_:1})])]),M("div",ln,[M("p",sn,[M("a",rn,[a(c,{theme:"default",variant:"outline",ghost:!0},{default:n(()=>l[1]||(l[1]=[y("@didaoj-web")])),_:1})])])])])}}}),cn=Q(un,[["__scopeId","data-v-400ac98b"]]),Ne=20,Ze=100,Qe=50,dn=ae({__name:"ForceHiddenSidebarButton",setup(e){let t=Je();const o=p({x:window.innerWidth-Ze-Ne,y:window.innerHeight-Qe-Ne}),s=p(window.innerWidth),l=p(window.innerHeight);let c=!1,g={x:0,y:0};const S=z=>{c=!0;const K=z.clientX??z.touches[0].clientX,I=z.clientY??z.touches[0].clientY;g={x:K-o.value.x,y:I-o.value.y},document.addEventListener("mousemove",m),document.addEventListener("touchmove",m),document.addEventListener("mouseup",f),document.addEventListener("touchend",f)},m=z=>{if(!c)return;const K=z.clientX??z.touches[0].clientX,I=z.clientY??z.touches[0].clientY;let T=K-g.x,D=I-g.y;T=Math.max(0,Math.min(T,s.value-Ze)),D=Math.max(0,Math.min(D,l.value-Qe)),o.value={x:T,y:D}},f=()=>{c=!1,document.removeEventListener("mousemove",m),document.removeEventListener("touchmove",m),document.removeEventListener("mouseup",f),document.removeEventListener("touchend",f)},u=()=>{s.value=window.innerWidth,l.value=window.innerHeight,o.value={x:Math.min(o.value.x,s.value-Ze-Ne),y:Math.min(o.value.y,l.value-Qe-Ne)}};let _=p(t.forceHiddenSidebar),h=p(t.forceHiddenSidebar);const b=()=>{_.value=!_.value,t.setForceHiddenSidebar(_.value)},L=()=>{h.value||(h.value=!0,t.setForceHiddenSidebar(_.value))},P=()=>{h.value&&(h.value=!1,t.setForceHiddenSidebar(!1))},E=z=>{z>=800?P():L()};return E(s.value),ze(s,z=>{E(z)}),le(()=>{window.addEventListener("resize",u)}),Le(()=>{window.removeEventListener("resize",u)}),(z,K)=>{const I=H;return ne(h)?(j(),G(I,{key:0,class:"draggable-button",style:ht({top:`${o.value.y}px`,left:`${o.value.x}px`}),onMousedown:S,onTouchstart:S,variant:"dashed",theme:"primary",onClick:b},{default:n(()=>[y(q(ne(_)?"显示":"隐藏"),1)]),_:1},8,["style"])):ie("",!0)}}}),mn=Q(dn,[["__scopeId","data-v-1aee5506"]]),pn={class:"sh-main"},fn=ae({__name:"View403",setup(e){let t=ce();const o=p("");return le(()=>{t.query.target?o.value=t.query.target:o.value=t.fullPath}),(s,l)=>{const c=H;return j(),X("div",pn,[M("p",null,q(o.value),1),l[2]||(l[2]=M("p",null,"该页面无访问权限，请更换访问目标或重新登陆后再试",-1)),a(c,{theme:"primary",onClick:l[0]||(l[0]=()=>s.$router.push("/"))},{default:n(()=>l[1]||(l[1]=[y("返回首页")])),_:1})])}}}),Vt=Q(fn,[["__scopeId","data-v-8f62f1f8"]]),Ge="DidaOJ",_n=ae({__name:"App",setup(e){const{globalProperties:t}=ue(),o=Pt(),s=ge(),l=je(),c=Je();o.$patch({Loaded:!1});const g=s.getToken,S=p(!1),m=p(!1);l.title&&l.title.length>0?document.title=l.title+" - "+Ge:document.title=Ge,l.$subscribe((h,b)=>{b.title&&b.title.length>0?document.title=b.title+" - "+Ge:document.title=Ge}),c.$subscribe((h,b)=>{S.value=b.showSidebar,m.value=S.value&&!b.forceHiddenSidebar});const f=ce(),u=Ce(()=>{const h=f.meta.auths;return h?!s.hasAllAuths(h):!1});function _(){t.$message.warning({duration:3e3,content:"登陆状态失效"}),o.$patch({Loaded:!0}),s.clear()}return le(()=>{if(g==""){o.$patch({Loaded:!0});return}Ca().then(h=>{h.code==0?(s.loadResponse(h.data),o.$patch({Loaded:!0})):(N(t,h.code),o.$patch({Loaded:!0}),s.clear())}).catch(h=>{console.log(h),_()})}),(h,b)=>{const L=na,P=la,E=vt("RouterView"),z=sa,K=oa,I=ra;return j(),X(te,null,[a(K,null,{default:n(()=>[a(L,{class:"sh-header"},{default:n(()=>[a(Fa)]),_:1}),a(K,null,{default:n(()=>[a(Kt,{name:"slide"},{default:n(()=>[m.value?(j(),G(P,{key:0,class:"sh-sidebar"},{default:n(()=>[a(Wa)]),_:1})):ie("",!0)]),_:1}),a(K,{class:tt(["sh-main-layout",{expanded:!m.value}])},{default:n(()=>[a(Qa),a(z,{class:"sh-main-content"},{default:n(()=>[u.value?(j(),G(Vt,{key:0})):(j(),G(E,{key:1}))]),_:1}),a(cn)]),_:1},8,["class"])]),_:1})]),_:1}),S.value?(j(),G(mn,{key:0})):ie("",!0),a(I,{container:"body",offset:["24px","80px"],size:"small"})],64)}}}),gn=Q(_n,[["__scopeId","data-v-851fc4f3"]]);var $t=(e=>(e[e.Unknown=-1]="Unknown",e[e.C=0]="C",e[e.Cpp=1]="Cpp",e[e.Java=2]="Java",e[e.Python=3]="Python",e[e.Pascal=4]="Pascal",e[e.Golang=5]="Golang",e[e.Max=6]="Max",e))($t||{});function zt(){const e=[-1,4,5,6];return Object.values($t).filter(t=>typeof t=="number"&&!e.includes(t)).map(t=>({value:t,label:Dt(t)}))}function vn(e){return e>-1&&e<6}function Dt(e){switch(e){case 0:return"C";case 1:return"C++";case 2:return"Java";case 3:return"Python";case 4:return"Pascal";case 5:return"Golang";default:return"Unknown"}}function rt(e){switch(e){case 0:return"c";case 1:return"cpp";case 2:return"java";case 3:return"python";case 4:return"pascal";case 5:return"golang";default:return"text"}}var ee=(e=>(e[e.Init=0]="Init",e[e.Rejudge=1]="Rejudge",e[e.Submitting=2]="Submitting",e[e.Queuing=3]="Queuing",e[e.Compiling=4]="Compiling",e[e.Running=5]="Running",e[e.Accept=6]="Accept",e[e.PE=7]="PE",e[e.WA=8]="WA",e[e.TLE=9]="TLE",e[e.MLE=10]="MLE",e[e.OLE=11]="OLE",e[e.RE=12]="RE",e[e.CE=13]="CE",e[e.CLE=14]="CLE",e[e.JudgeFail=15]="JudgeFail",e[e.SubmitFail=16]="SubmitFail",e[e.Unknown=17]="Unknown",e))(ee||{});const hn=e=>{switch(e){case 0:return"普通评测";case 1:return"特殊评测";default:return"未知"}},Fe=e=>{switch(e){case 0:return"等待处理";case 1:return"重新评测";case 2:return"提交中";case 3:return"队列中";case 4:return"编译中";case 5:return"运行中";case 6:return"通过";case 7:return"格式错误";case 8:return"答案错误";case 9:return"超时";case 10:return"内存超限";case 11:return"输出超限";case 12:return"运行错误";case 13:return"编译错误";case 14:return"编译超限";case 15:return"评测失败";case 16:return"提交失败";case 17:return"未知";default:return e}};function bn(){const e=[17];return Object.values(ee).filter(t=>typeof t=="number"&&!e.includes(t)).map(t=>({value:t,label:Fe(t)}))}function Ve(e){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:return!0;default:return!1}}function Rt(e){var o;const t={};if(t.id=e.id,t.problemId=e.problem_id,t.status=e.status,Ve(e.status)?t.score="-":t.score=e.score.toString(),e.time?t.time=Math.ceil(e.time/1e6)+"ms":t.time="-",e.memory?t.memory=(e.memory/1024/1024).toFixed(2)+"MB":t.memory="-",t.language=Dt(e.language),t.codeLength=e.code_length,e.approve_time?t.approveTime=new Date(e.approve_time).toLocaleString():t.approveTime="-",t.author=e.author,t.authorUsername=e.author_username,t.authorNickname=e.author_nickname,t.code=e.code,t.compileMessage=e.compile_message,t.taskCurrent=e.task_current,t.taskTotal=e.task_total,t.task=[],e.task)for(let s=0;s<((o=e.task)==null?void 0:o.length);s++){const l=e.task[s],c={};c.taskId=l.task_id,c.status=l.status,l.time?c.time=Math.ceil(l.time/1e6)+"ms":c.time="-",l.memory?c.memory=(l.memory/1024/1024).toFixed(2)+"MB":c.memory="-",c.score=l.score,c.content=l.content,c.waHint=l.wa_hint,!c.content&&!c.waHint&&(c.content="无提示信息"),t.task.push(c)}return e.judger&&(t.judger=e.judger),e.judge_time&&(t.judgeTime=new Date(e.judge_time).toLocaleString()),t}function yn(e,t,o,s,l){return Y({url:"/judge/approve",method:"post",data:{problem_id:e,contest_id:t,problem_index:o,language:s,code:l}})}function wn(e){return Y({url:"/judge?id="+e,method:"get"})}function kn(e){return Y({url:"/judge/code?id="+e,method:"get"})}function Cn(e,t,o,s,l,c){const g=new URLSearchParams({problem_id:e,username:t,language:String(o),status:String(s),page:String(l),page_size:String(c)});return Y({url:`/judge/list?${g.toString()}`,method:"get"})}function Sn(){return Y({url:"/judge/rejudge/recently",method:"post"})}function In(e){return Y({url:"/judge/rejudge/problem",method:"post",data:{id:e}})}function Ln(){return Y({url:"/judge/rejudge/all",method:"post",timeout:0})}function Pn(e){return Y({url:"/judge/rejudge",method:"post",data:{id:Number(e)}})}var nt=(e=>(e[e.None=0]="None",e[e.Attempt=1]="Attempt",e[e.Accept=2]="Accept",e))(nt||{});function We(e,t){const o={};if(o.id=e.id,o.author=e.author,o.title=e.title,o.tags=[],e.tags)for(const s of e.tags){const l=t[s];l&&o.tags.push(l)}return o.accept=e.accept,o.attempt=e.attempt,e.description!=null&&(o.description=e.description),e.time_limit!=null&&(o.timeLimit=e.time_limit.toString()+" ms"),e.memory_limit!=null&&(o.memoryLimit=(e.memory_limit/1024).toFixed(2)+" MB"),e.judge_type!=null&&(o.judgeType=hn(e.judge_type)),e.insert_time!=null&&(o.insertTime=new Date(e.insert_time).toLocaleString()),e.update_time!=null&&(o.updateTime=new Date(e.update_time).toLocaleString()),e.creator_nickname!=null&&(o.creatorNickname=e.creator_nickname),e.source!=null&&(o.source=e.source),e.judge_md5!=null&&(o.judgeMd5=e.judge_md5),o}function At(e,t,o){const s={};return e?s.id=e:(s.contest_id=t,s.problem_index=o),Y({url:`/problem?${new URLSearchParams(s).toString()}`,method:"get"})}function Et(e){return Y({url:"/problem/tag/list?max_count="+e,method:"get"})}function Tn(e){return Y({url:"/problem/judge?id="+e,method:"get"})}function xn(e,t,o,s){return Y({url:"/problem/list?title="+e+"&tag="+t+"&page="+o+"&page_size="+s,method:"get"})}function jn(e,t,o,s,l,c,g){return Y({url:"/problem/edit",method:"post",data:{id:e,title:t,time_limit:o,memory_limit:s,source:l,tags:c,description:g}})}function Vn(e,t){return Y({url:"/problem/judge/data/download?id="+e+"&key="+t,method:"get"})}function $n(e,t){const o=new FormData;return o.append("id",e),o.append("zip",t),Y({url:"/problem/judge/data",method:"post",data:o,headers:{"Content-Type":"multipart/form-data"},timeout:1e3*60*5})}const zn={style:{margin:"10px"}};function Dn(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Xe(e)}const Rn=ae({__name:"ProblemList",setup(e){const t=ce(),o=qe(),{globalProperties:s}=ue();let l=null;const c=p(!1),g={};let S={};const m=p([{title:"ID",colKey:"id",cell:(w,V)=>{let x=z(V.row.id);return a(H,{variant:"dashed",theme:x,onClick:()=>E(V.row.id)},{default:()=>[V.row.id]})}},{title:"标题",colKey:"title",cell:(w,V)=>a(H,{variant:"text",onClick:()=>E(V.row.id)},{default:()=>[V.row.title]})},{title:"标签",colKey:"tags",cell:(w,V)=>{const x=V.row.tags;if(!x||x.length===0)return"";let v=[];for(let i=0;i<x.length;i++){const r=x[i];v.push(a(H,{key:i,theme:"default",variant:"outline"},{default:()=>[r.name]}))}return a(_e,null,Dn(v)?v:{default:()=>[v]})}},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),f=p(!1);let u=1,_=50;const h=p({current:u,pageSize:_,defaultCurrent:u,defaultPageSize:_,total:0,pageSizeOptions:[50,100]}),b=p(),L=p(),P=p({title:"",tag:""}),E=w=>{w&&o.push({path:"/problem/"+w})},z=w=>{if(!w||!S)return"default";const V=S[w];if(!V)return"default";switch(V){case nt.Accept:return"success";case nt.Attempt:return"warning";default:return"default"}},K=async()=>{await o.push({query:{...t.query,title:P.value.title,tag:P.value.tag,page:1,page_size:h.value.defaultPageSize}})},I=w=>{w&&o.push({query:{...t.query,title:"",tag:w.name,page:1,page_size:h.value.defaultPageSize}})},T=async(w,V)=>{f.value=!0;try{const{current:x,pageSize:v}=w,i=await xn(P.value.title,P.value.tag,x,v);if(b.value=[],i.code===0){const r=i.data.list;if(!r||r.length<=0){h.value={...h.value,total:0},S=null,pe(s,"未找到记录");return}r.forEach(d=>{var C;const k=We(d,g);(C=b.value)==null||C.push(k)}),h.value={...h.value,total:i.data.total_count},S=i.data.problem_attempt_status}else V&&N(s,i.code)}catch(x){console.error(x),N(s,Ie())}finally{f.value=!1}},D=async w=>{await o.push({query:{...t.query,page:w.current,page_size:w.pageSize}})};return le(async()=>{f.value=!0,L.value=[],Et(-1).then(w=>{if(w.code===0){L.value=w.data.list,c.value=w.data.total_count>w.data.list.length;for(let V=0;V<w.data.list.length;V++){const x=w.data.list[V];g[x.id]=x}l=ze(()=>t.query,V=>{P.value.title=V.title||"",P.value.tag=V.tag||"";const x=parseInt(V.page)||h.value.defaultCurrent,v=parseInt(V.page_size)||h.value.defaultPageSize;u=x,_=v,h.value={...h.value,current:u,pageSize:_},T({current:u,pageSize:_},!0)},{immediate:!0})}else c.value=!0}).catch(w=>{console.error(w),c.value=!0})}),Le(()=>{l&&l()}),(w,V)=>{const x=xe,v=de,i=he,r=ke,d=Te,k=H,C=Pe,A=ve;return j(),G(A,null,{default:n(()=>[a(i,{span:9},{default:n(()=>[a(v,{style:{margin:"10px"}},{default:n(()=>[a(x,{data:b.value,columns:m.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:h.value,loading:f.value,onPageChange:D},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),a(i,{span:3},{default:n(()=>[M("div",zn,[a(v,{class:"sh-card"},{default:n(()=>[a(C,{model:P.value},{default:n(()=>[a(d,{label:"标题"},{default:n(()=>[a(r,{modelValue:P.value.title,"onUpdate:modelValue":V[0]||(V[0]=R=>P.value.title=R),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),a(d,{label:"标签"},{default:n(()=>[a(r,{modelValue:P.value.tag,"onUpdate:modelValue":V[1]||(V[1]=R=>P.value.tag=R),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),a(d,null,{default:n(()=>[a(k,{theme:"primary",onClick:K},{default:n(()=>V[3]||(V[3]=[y("搜索")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(v,{class:"sh-card sh-background-black"},{default:n(()=>[(j(!0),X(te,null,fe(L.value,R=>(j(),G(k,{class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:()=>I(R)},{default:n(()=>[y(q(R.name),1)]),_:2},1032,["onClick"]))),256)),c.value?(j(),G(k,{key:0,class:"sh-tag-button",theme:"default",variant:"outline",ghost:!0,onClick:V[2]||(V[2]=()=>w.$router.push("/problem/tags"))},{default:n(()=>V[4]||(V[4]=[y(" ... ")])),_:1})):ie("",!0)]),_:1})])]),_:1})]),_:1})}}}),An=Q(Rn,[["__scopeId","data-v-0d640f14"]]);function $e(e){e.querySelectorAll("pre > code:not([data-copy-attached])").forEach(o=>{o.setAttribute("data-copy-attached","true");const s=o.parentElement,l=document.createElement("div");l.className="copy-wrapper";const c=document.createElement("button");c.className="copy-btn",c.innerText="复制",c.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(o.innerText),c.innerText="已复制",setTimeout(()=>c.innerText="复制",1500)}catch{c.innerText="失败"}}),s.replaceWith(l),l.appendChild(c),l.appendChild(s)})}function Ye(e){let t="";for(;e>0;)e--,t=String.fromCharCode(65+e%26)+t,e=Math.floor(e/26);return t}async function Mt(e){const t={};if(t.id=e.id,t.ownerId=e.owner_id,t.ownerUsername=e.owner_username,t.ownerNickname=e.owner_nickname,t.title=e.title,t.startTime=new Date(e.start_time).toLocaleString(),t.endTime=new Date(e.end_time).toLocaleString(),e.descriptions){t.descriptions=[];const o={math:{inlineDigit:!0,engine:"KaTeX"}};for(let s=0;s<e.descriptions.length;s++){const l=e.descriptions[s],c={};c.title=l.title,c.content=await oe.md2html(l.content,o),c.sort=l.sort,t.descriptions.push(c)}}if(t.notification=e.notification,e.problems){t.problems=[],e.problems.sort((o,s)=>o.index-s.index);for(let o=0;o<e.problems.length;o++){const s=e.problems[o];s.accept||(s.accept=0),s.attempt||(s.attempt=0),s.id=Ye(s.index),t.problems.push(s)}}return t}function En(e){return Y({url:"/contest?id="+e,method:"get"})}function Mn(e,t){return Y({url:"/contest/list?page="+e+"&page_size="+t,method:"get"})}function qn(e){return Y({url:"/contest/create",method:"post",data:e})}const Un=["innerHTML"],Hn={style:{margin:"12px"}},Nn={key:0,class:"dida-edit-container"},Gn={class:"dida-operation-container"},On={class:"dida-code-submit-div"},Kn=ae({__name:"ProblemDetail",setup(e){let t=ce();const{globalProperties:o}=ue(),s=je(),l=ge();let c=p(""),g="",S=0,m=0;const f=p(null),u=p(!1),_=p(null);let h=null;const b=p(null),L={},P=p(""),E=p([]);E.value=zt();const z=Ce(()=>l.hasAuth(Se.ManageProblem)),K=v=>{v&&O.push({name:"problem-list",query:{...t.query,title:"",tag:v.name}})},I=()=>{O.push({name:"manage-problem",params:{problemId:g}})},T=()=>{g?O.push({name:"judge-list",query:{problem_id:g}}):O.push({name:"contest-judge-list",params:{contestId:S,problemIndex:m}})},D=()=>{g?O.push({name:"discuss-list-problem",query:{problem_id:g}}):O.push({name:"contest-discuss",params:{contestId:S},query:{problem_id:Ye(m)}})},w=()=>{O.push({name:"problem-recommend",params:{problemId:g}})},V=async()=>{if(!g){me(o,"问题ID无效");return}const v=parseInt(P.value);if(!vn(v)){me(o,"请选择所编写的语言");return}const i=h==null?void 0:h.getValue();if(!i){me(o,"请输入所需提交的代码");return}const r=await yn(g,S,m,v,i);if(r.code!==0){N(o,r.code);return}pe(o,"提交成功，正在跳转到详情页面");const d=r.data.id;await O.push({path:"/judge/"+d})},x=v=>{h&&ct.setModelLanguage(h.getModel(),rt(v))};return le(async()=>{if(Array.isArray(t.params.problemId)?g=t.params.problemId[0]:g=t.params.problemId,!g){if(Array.isArray(t.params.contestId)?S=t.params.contestId[0]:S=t.params.contestId,!S){me(o,"题目不存在"),await O.push({name:"problem"});return}if(Array.isArray(t.params.problemIndex)?m=parseInt(t.params.problemIndex[0]):m=parseInt(t.params.problemIndex),!m){me(o,"题目不存在"),await O.push({name:"problem"});return}}u.value=!0;let v=await At(g,S,m);if(v.code!==0){u.value=!1,N(o,v.code),await O.push({name:"problem"});return}v.data.tags&&v.data.tags.forEach(d=>{L[d.id]=d}),_.value=We(v.data.problem,L),s.setTitle(_.value.title+" - "+s.getTitle);let i=_.value.description;const r={math:{inlineDigit:!0,engine:"KaTeX"}};c.value=await oe.md2html(i,r),await we(()=>{f.value&&(oe.mathRender(f.value),oe.highlightRender({lineNumber:!0,enable:!0},f.value),$e(f.value),b.value&&(h=ct.create(b.value,{value:"",language:"cpp",minimap:{enabled:!0},colorDecorators:!0,readOnly:!1,theme:"vs-dark"}))),u.value=!1})}),(v,i)=>{const r=de,d=he,k=H,C=Re,A=_e,R=De,J=kt,F=wt,U=ve,W=be;return j(),G(W,{loading:u.value},{default:n(()=>[a(U,{class:"dida-main-content"},{default:n(()=>[a(d,{span:8},{default:n(()=>[a(r,{style:{margin:"10px"}},{default:n(()=>[M("div",{innerHTML:ne(c),ref_key:"markdownRef",ref:f},null,8,Un)]),_:1})]),_:1}),a(d,{span:4},{default:n(()=>[M("div",Hn,[z.value?(j(),X("div",Nn,[a(k,{onClick:I},{default:n(()=>i[1]||(i[1]=[y("编辑")])),_:1})])):ie("",!0),a(R,{layout:"vertical",bordered:!0},{default:n(()=>[a(C,{label:"标题"},{default:n(()=>{var $;return[y(q(($=_.value)==null?void 0:$.title),1)]}),_:1}),a(C,{label:"时间限制"},{default:n(()=>{var $;return[y(q(($=_.value)==null?void 0:$.timeLimit),1)]}),_:1}),a(C,{label:"内存限制"},{default:n(()=>{var $;return[y(q(($=_.value)==null?void 0:$.memoryLimit),1)]}),_:1}),a(C,{label:"判题方式"},{default:n(()=>{var $;return[y(q(($=_.value)==null?void 0:$.judgeType),1)]}),_:1}),a(C,{label:"正确提交"},{default:n(()=>{var $;return[y(q(($=_.value)==null?void 0:$.accept),1)]}),_:1}),a(C,{label:"提交总数"},{default:n(()=>{var $;return[y(q(($=_.value)==null?void 0:$.attempt),1)]}),_:1}),a(C,{label:"创建时间"},{default:n(()=>{var $;return[y(q(($=_.value)==null?void 0:$.insertTime),1)]}),_:1}),a(C,{label:"更新时间"},{default:n(()=>{var $;return[y(q(($=_.value)==null?void 0:$.updateTime),1)]}),_:1}),a(C,{label:"上传用户"},{default:n(()=>{var $;return[y(q(($=_.value)==null?void 0:$.creatorNickname),1)]}),_:1}),a(C,{label:"题目来源"},{default:n(()=>{var $;return[y(q(($=_.value)==null?void 0:$.source),1)]}),_:1}),ne(g)?(j(),G(C,{key:0,label:"标签"},{default:n(()=>[a(A,null,{default:n(()=>{var $;return[(j(!0),X(te,null,fe(($=_.value)==null?void 0:$.tags,se=>(j(),G(k,{key:se.id,variant:"dashed",onClick:()=>K(se)},{default:n(()=>[y(q(se.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})):ie("",!0)]),_:1}),M("div",Gn,[a(A,null,{default:n(()=>[a(k,{onClick:T},{default:n(()=>i[2]||(i[2]=[y("提交记录")])),_:1}),a(k,{onClick:D},{default:n(()=>i[3]||(i[3]=[y("题目讨论")])),_:1}),ne(g)?(j(),G(k,{key:0,onClick:w},{default:n(()=>i[4]||(i[4]=[y("题目推荐")])),_:1})):ie("",!0)]),_:1})]),M("div",On,[a(A,null,{default:n(()=>[a(F,{modelValue:P.value,"onUpdate:modelValue":i[0]||(i[0]=$=>P.value=$),label:"语言：",placeholder:"请选择提交语言","auto-width":"",clearable:"",onChange:x},{default:n(()=>[(j(!0),X(te,null,fe(E.value,$=>(j(),G(J,{key:$.value,value:$.value,label:$.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),a(k,{onClick:V},{default:n(()=>i[5]||(i[5]=[y("提交")])),_:1})]),_:1}),M("div",{ref_key:"codeEditRef",ref:b,class:"dida-code-editor"},null,512)])])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),dt=Q(Kn,[["__scopeId","data-v-2307df15"]]),Fn={};function Bn(e,t){return" TODO "}const Xn=Q(Fn,[["render",Bn]]),Jn=["innerHTML"];function Wn(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Xe(e)}const Yn=ae({__name:"JudgeJobList",setup(e){const t=ce(),o=qe(),{globalProperties:s}=ue();let l=!1,c=null;const g=p(!1),S=p(null),m=p(null),f=p(!1),u=p({problemId:"",username:"",language:void 0,status:void 0}),_=p([{title:"ID",colKey:"id",cell:(r,d)=>a(H,{variant:"text",onClick:()=>D(d.row.id)},{default:()=>[d.row.id]})},{title:"问题",colKey:"problemId",cell:(r,d)=>a(H,{variant:"text",onClick:()=>T(d.row.problemId)},{default:()=>[d.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(r,d)=>{const k=d.row.status,C=Fe(k);let A;switch(k){case ee.Init:case ee.Rejudge:case ee.Compiling:case ee.Running:A="default";break;case ee.Accept:A="success";break;case ee.PE:A="warning";break;default:A="danger";break}let R=[];return Ve(k)&&R.push(a(be,{text:d.row.state,size:"small",class:"dida-status-loading"},null)),R.push(a("span",null,[C])),a(H,{theme:A,variant:"outline",onClick:()=>D(d.row.id)},Wn(R)?R:{default:()=>[R]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"code",cell:(r,d)=>a(H,{theme:"default",onClick:()=>I(d.row)},{default:()=>[d.row.language+" / "+d.row.codeLength]})},{title:"作者",colKey:"author",width:200,cell:(r,d)=>a(H,{variant:"text",onClick:()=>w(d.row.authorUsername)},{default:()=>[d.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),h=p(!1);let b=1,L=50;const P=p({current:b,pageSize:L,defaultCurrent:b,defaultPageSize:L,total:0,pageSizeOptions:[50,100]}),E=p(),z=p([]);z.value=zt();const K=p([]);K.value=bn();const I=async r=>{f.value=!0,g.value=!0;try{S.value=r;const d=await kn(S.value.id);if(d.code===0){const k=d.data,A=`\`\`\`${rt(k.language)}
${k.code}
\`\`\``,R={};S.value.code=await oe.md2html(A,R),await we(()=>{m.value&&(oe.highlightRender({lineNumber:!0,enable:!0},m.value),$e(m.value))})}else N(s,d.code)}finally{f.value=!1}},T=r=>{r&&o.push({path:"/problem/"+r})},D=r=>{r&&o.push({name:"judge-detail",params:{judgeId:r}})},w=r=>{r&&o.push({path:"/user/"+r})},V=async()=>{await o.push({query:{...t.query,page:1,page_size:L,problem_id:u.value.problemId,username:u.value.username,language:u.value.language,status:u.value.status}})},x=async()=>{u.value.problemId="",u.value.username="",u.value.language=void 0,u.value.status=void 0,await o.push({query:{...t.query,page:1,page_size:L,problem_id:"",username:"",language:void 0,status:void 0}})},v=async(r,d)=>{d&&(h.value=!0);let k=!1;try{const{current:C,pageSize:A}=r,R=await Cn(u.value.problemId,u.value.username,u.value.language,u.value.status,C,A);E.value=[],R.code===0?R.data.list&&R.data.list.length>0?(R.data.list.forEach(F=>{var W;const U=Rt(F);(W=E.value)==null||W.push(U),Ve(F.status)&&(k=!0)}),P.value={...P.value,total:R.data.total_count}):(pe(s,"未找到记录"),P.value={...P.value,total:0}):d&&N(s,R.code)}catch(C){console.error(C),d&&N(s,Ie())}finally{d&&(h.value=!1),k&&l&&setTimeout(()=>{v({current:b,pageSize:L},!1)},5e3)}},i=async r=>{await o.push({query:{...t.query,page:r.current,page_size:r.pageSize}})};return le(async()=>{l=!0,c=ze(()=>t.query,r=>{u.value.problemId=r.problem_id||"",u.value.username=r.username||"",r.language!=null?u.value.language=Number(r.language):u.value.language=void 0,r.status!=null?u.value.status=Number(r.status):u.value.status=void 0;const d=parseInt(r.page)||P.value.defaultCurrent,k=parseInt(r.page_size)||P.value.defaultPageSize;b=d,L=k,P.value.pageSizeOptions.includes(L)||(L=P.value.defaultPageSize),P.value={...P.value,current:b,pageSize:L},v({current:b,pageSize:L},!0)},{immediate:!0})}),Le(()=>{l=!1,c&&c()}),(r,d)=>{const k=ke,C=Te,A=kt,R=wt,J=H,F=_e,U=Pe,W=xe,$=de,se=ot,Z=be,re=lt;return j(),X(te,null,[a($,{style:{margin:"10px"}},{default:n(()=>[a(U,{layout:"inline",onSubmit:V,onReset:x},{default:n(()=>[a(C,{label:"题号"},{default:n(()=>[a(k,{modelValue:u.value.problemId,"onUpdate:modelValue":d[0]||(d[0]=B=>u.value.problemId=B),placeholder:"请输入完整题号"},null,8,["modelValue"])]),_:1}),a(C,{label:"用户"},{default:n(()=>[a(k,{modelValue:u.value.username,"onUpdate:modelValue":d[1]||(d[1]=B=>u.value.username=B),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),a(C,{label:"语言"},{default:n(()=>[a(R,{modelValue:u.value.language,"onUpdate:modelValue":d[2]||(d[2]=B=>u.value.language=B),placeholder:"请选择提交语言","auto-width":"",clearable:""},{default:n(()=>[(j(!0),X(te,null,fe(z.value,B=>(j(),G(A,{key:B.value,value:B.value,label:B.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(C,{label:"状态"},{default:n(()=>[a(R,{modelValue:u.value.status,"onUpdate:modelValue":d[3]||(d[3]=B=>u.value.status=B),placeholder:"请选择评测状态","auto-width":"",clearable:""},{default:n(()=>[(j(!0),X(te,null,fe(K.value,B=>(j(),G(A,{key:B.value,value:B.value,label:B.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(C,null,{default:n(()=>[a(F,null,{default:n(()=>[a(J,{theme:"primary",type:"submit"},{default:n(()=>d[7]||(d[7]=[y("搜索")])),_:1}),a(J,{theme:"default",variant:"base",type:"reset"},{default:n(()=>d[8]||(d[8]=[y("重置")])),_:1})]),_:1})]),_:1})]),_:1}),a(W,{data:E.value,columns:_.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:P.value,loading:h.value,onPageChange:i,"table-layout":"auto"},null,8,["data","columns","pagination","loading"])]),_:1}),a(re,{visible:g.value,"onUpdate:visible":d[5]||(d[5]=B=>g.value=B),width:"800px","cancel-btn":null,"close-btn":!1,onConfirm:d[6]||(d[6]=B=>g.value=!1)},{header:n(()=>[a(se,{onClick:d[4]||(d[4]=()=>{var B;D((B=S.value)==null?void 0:B.id)})},{default:n(()=>{var B,Ae;return[y(q(((B=S.value)==null?void 0:B.id)+" - "+((Ae=S.value)==null?void 0:Ae.language)),1)]}),_:1})]),default:n(()=>[a(Z,{loading:f.value},{default:n(()=>{var B;return[M("div",{innerHTML:(B=S.value)==null?void 0:B.code,ref_key:"markdownCodeRef",ref:m,style:{"min-height":"100px"}},null,8,Jn)]}),_:1},8,["loading"])]),_:1},8,["visible"])],64)}}}),Zn=Q(Yn,[["__scopeId","data-v-90a4dfd1"]]);function Qn(e){return Y({baseURL:"https://r2-oj.didapipa.com",url:"/status/judger/"+e+".json",method:"get"})}const eo=["innerHTML"],to={key:2,class:"dida-edit-container"};function mt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Xe(e)}const ao=ae({__name:"JudgeJobDetail",setup(e){const t=ce(),o=qe(),s=ge(),{globalProperties:l}=ue();let c=!1,g=-1;const S=p(""),m=p(null),f=p(""),u=p(null),_=p(0),h=p(null),b=p({from:"#5a96ff",to:"#00A870"});let L=!1;const P=p([{title:"ID",colKey:"id"},{title:"问题",colKey:"problemId",cell:(v,i)=>a(H,{variant:"text",onClick:()=>D(i.row.problemId)},{default:()=>[i.row.problemId]})},{title:"状态",colKey:"status",align:"center",cell:(v,i)=>{const r=i.row.status,d=Fe(r);let k;switch(r){case ee.Init:case ee.Rejudge:case ee.Compiling:case ee.Running:k="default";break;case ee.Accept:k="success";break;case ee.PE:k="warning";break;default:k="danger";break}let C=[];return Ve(r)&&C.push(a(be,{text:i.row.state,size:"small",class:"dida-status-loading"},null)),C.push(a("span",null,[d])),a(H,{theme:k,variant:"outline"},mt(C)?C:{default:()=>[C]})}},{title:"分数",colKey:"score"},{title:"时间",colKey:"time"},{title:"内存",colKey:"memory"},{title:"代码",colKey:"language",cell:(v,i)=>a("span",null,[i.row.language+" / "+i.row.codeLength])},{title:"作者",colKey:"author",width:200,cell:(v,i)=>a(H,{variant:"text",onClick:()=>w(i.row.authorUsername)},{default:()=>[i.row.authorNickname]})},{title:"提交时间",colKey:"approveTime",width:180}]),E=p(!1),z=p(!1),K=p(),I=Ce(()=>s.hasAuth(Se.ManageJudge)),T=async()=>{if(!z.value){z.value=!0;try{const v=await Pn(g);v.code===0?await x(!0):N(l,v.code)}catch(v){console.error(v),N(l,Ie())}finally{z.value=!1}}},D=v=>{v&&o.push({path:"/problem/"+v})},w=v=>{v&&o.push({path:"/user/"+v})},V=v=>{const i=v.status,r=Fe(i);let d;switch(i){case ee.Init:case ee.Rejudge:case ee.Compiling:case ee.Running:d="default";break;case ee.Accept:d="success";break;case ee.PE:d="warning";break;default:d="danger";break}return a(_e,null,{default:()=>[a(H,{theme:"default",variant:"outline"},{default:()=>[v.taskId]}),a(H,{theme:d,variant:"outline"},mt(r)?r:{default:()=>[r]}),a("span",null,[y("分数："),v.score]),a("span",null,[y("用时："),v.time]),a("span",null,[y("内存："),v.memory])]})},x=async v=>{var r;v&&(E.value=!0);let i=!1;try{const d=await wn(g);if(K.value=[],d.code===0){const k=d.data,C=Rt(k);if((r=K.value)==null||r.push(C),k.judger){const R=await Qn(k.judger);S.value=R.name}else S.value="";b.value.to="#00A870",Ve(k.status)?(h.value="active",C.taskTotal>0?(_.value=C.taskCurrent/C.taskTotal*100,C.taskCurrent>=C.taskTotal&&(_.value=99)):_.value=0):(_.value=100,k.status===ee.Accept?h.value="success":k.status===ee.PE?(b.value.to="#F57C20",h.value="warning"):(b.value.to="#F56C6C",h.value="error"));const A={};if(k.code){const J=`\`\`\`${rt(k.language)}
${k.code}
\`\`\``;f.value=await oe.md2html(J,A),await we(()=>{u.value&&(L||(L=!0,oe.highlightRender({lineNumber:!0,enable:!0},u.value)),$e(u.value))})}m.value=C,Ve(k.status)&&(i=!0)}else v&&N(l,d.code)}catch(d){console.error(d),v&&N(l,Ie())}finally{v&&(E.value=!1),i&&c&&setTimeout(()=>{x(!1)},5e3)}};return le(async()=>{if(c=!0,Array.isArray(t.params.judgeId)?g=t.params.judgeId[0]:g=t.params.judgeId,!g){await o.push({name:"judge"});return}await x(!0)}),Le(()=>{c=!1}),(v,i)=>{var $,se;const r=ua,d=xe,k=de,C=he,A=Re,R=De,J=ve,F=Ct,U=St,W=H;return j(),X(te,null,[a(r,{color:b.value,status:h.value,class:"dida-job-progress",percentage:_.value},null,8,["color","status","percentage"]),a(k,{style:{margin:"10px"}},{default:n(()=>[a(d,{data:K.value,columns:P.value,"row-key":"id","vertical-align":"top",hover:!0,loading:E.value},null,8,["data","columns","loading"])]),_:1}),a(J,null,{default:n(()=>[a(C,{span:8},{default:n(()=>[M("div",{innerHTML:f.value,ref_key:"markdownCodeRef",ref:u},null,8,eo)]),_:1}),a(C,{span:4},{default:n(()=>[a(R,{layout:"vertical",bordered:!0,style:{margin:"10px"}},{default:n(()=>[a(A,{label:"判题机"},{default:n(()=>[y(q(S.value),1)]),_:1}),a(A,{label:"判题时间"},{default:n(()=>{var Z;return[y(q((Z=m.value)==null?void 0:Z.judgeTime),1)]}),_:1})]),_:1})]),_:1})]),_:1}),($=m.value)!=null&&$.compileMessage?(j(),G(k,{key:0,class:"compile-message"},{default:n(()=>{var Z;return[y(q((Z=m.value)==null?void 0:Z.compileMessage),1)]}),_:1})):ie("",!0),((se=m.value)==null?void 0:se.task.length)>0?(j(),G(U,{key:1,class:"task-panel"},{default:n(()=>{var Z;return[(j(!0),X(te,null,fe((Z=m.value)==null?void 0:Z.task,re=>(j(),G(F,{key:re.taskId,header:()=>V(re)},{default:n(()=>[y(q(re.content)+" "+q(re.waHint),1)]),_:2},1032,["header"]))),128))]}),_:1})):ie("",!0),I.value?(j(),X("div",to,[a(W,{onClick:T,loading:z.value},{default:n(()=>i[0]||(i[0]=[y("重新评测")])),_:1},8,["loading"])])):ie("",!0)],64)}}}),no=Q(ao,[["__scopeId","data-v-e424ba0b"]]),oo={style:{margin:"10px"}},lo=ae({__name:"ContestList",setup(e){const t=ce(),o=qe(),{globalProperties:s}=ue();let l=null;const c=p(!1),g=p(!1),S=p([{title:"ID",colKey:"id",width:"100",cell:(D,w)=>a(H,{variant:"text",onClick:()=>P(w.row.id)},{default:()=>[w.row.id]})},{title:"标题",colKey:"title",cell:(D,w)=>a(H,{variant:"text",onClick:()=>P(w.row.id)},{default:()=>[w.row.title]})},{title:"负责人",colKey:"ownerNickname",width:"200"},{title:"开始时间",colKey:"startTime",width:"180"},{title:"结束时间",colKey:"endTime",width:"180"}]),m=p(!1);let f=1,u=50;const _=p({current:f,pageSize:u,defaultCurrent:f,defaultPageSize:u,total:0,pageSizeOptions:[50,100]}),h=p(),b=p({title:"",username:""}),L=p({title:"",description:"",open_time:[]}),P=D=>{D&&o.push({path:"/contest/"+D})},E=async()=>{await o.push({query:{...t.query,title:b.value.title,username:b.value.username,page:1,page_size:_.value.defaultPageSize}})},z=async(D,w)=>{var V;m.value=!0;try{const{current:x,pageSize:v}=D,i=await Mn(x,v);if(h.value=[],i.code===0){const r=i.data.list;for(let d=0;d<r.length;d++){const k=r[d],C=await Mt(k);(V=h.value)==null||V.push(C)}_.value={..._.value,total:i.data.total_count}}else w&&N(s,i.code)}catch(x){console.error(x),N(s,Ie())}finally{m.value=!1}},K=async D=>{await o.push({query:{...t.query,page:D.current,page_size:D.pageSize}})},I=()=>{c.value=!0},T=async()=>{g.value=!0,console.log("contestCreateForm",L.value),qn(L.value).then(D=>{D.code===0?(pe(s,"创建比赛成功"),c.value=!1,o.push({path:"/contest/"+D.data.id})):N(s,D.code)}).finally(()=>{g.value=!1})};return le(async()=>{l=ze(()=>t.query,D=>{b.value.title=D.title||"",b.value.username=D.username||"";const w=parseInt(D.page)||_.value.defaultCurrent,V=parseInt(D.page_size)||_.value.defaultPageSize;f=w,u=V,_.value={..._.value,current:f,pageSize:u},z({current:f,pageSize:u},!0)},{immediate:!0})}),Le(()=>{l&&l()}),(D,w)=>{const V=xe,x=de,v=he,i=ke,r=Te,d=H,k=Pe,C=_e,A=ve,R=It,J=lt;return j(),X(te,null,[a(A,null,{default:n(()=>[a(v,{span:9},{default:n(()=>[a(x,{style:{margin:"10px"}},{default:n(()=>[a(V,{data:h.value,columns:S.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:_.value,loading:m.value,onPageChange:K},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),a(v,{span:3},{default:n(()=>[M("div",oo,[a(x,{class:"sh-card"},{default:n(()=>[a(k,{model:b.value},{default:n(()=>[a(r,{label:"标题"},{default:n(()=>[a(i,{modelValue:b.value.title,"onUpdate:modelValue":w[0]||(w[0]=F=>b.value.title=F),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),a(r,{label:"负责人"},{default:n(()=>[a(i,{modelValue:b.value.username,"onUpdate:modelValue":w[1]||(w[1]=F=>b.value.username=F),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),a(r,null,{default:n(()=>[a(d,{theme:"primary",onClick:E},{default:n(()=>w[6]||(w[6]=[y("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(x,{class:"sh-card"},{default:n(()=>[a(C,null,{default:n(()=>[a(d,{onClick:I},{default:n(()=>w[7]||(w[7]=[y("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),a(J,{visible:c.value,"onUpdate:visible":w[5]||(w[5]=F=>c.value=F),header:"创建比赛",onConfirm:T,"confirm-loading":g.value},{default:n(()=>[a(k,{"label-width":80,model:L.value,onSubmit:w[4]||(w[4]=Me(()=>{},["prevent"]))},{default:n(()=>[a(r,{label:"标题"},{default:n(()=>[a(i,{modelValue:L.value.title,"onUpdate:modelValue":w[2]||(w[2]=F=>L.value.title=F),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),a(r,{label:"开启时间"},{default:n(()=>[a(R,{"enable-time-picker":"","allow-input":"",clearable:"",modelValue:L.value.open_time,"onUpdate:modelValue":w[3]||(w[3]=F=>L.value.open_time=F)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Ee=Q(lo,[["__scopeId","data-v-3e6ea683"]]),so={style:{margin:"20px"}},ro=["innerHTML"],uo={style:{margin:"12px"}},io=ae({__name:"ContestDetail",setup(e){let t=ce();const{globalProperties:o}=ue(),s=je();let l=0;const c=p(!1),g=p(null),S=p([{title:"问题ID",colKey:"id",cell:(u,_)=>a(H,{variant:"text",onClick:()=>f(l,_.row.index)},{default:()=>[_.row.id]})},{title:"标题",colKey:"title",cell:(u,_)=>a(H,{variant:"text",onClick:()=>f(l,_.row.index)},{default:()=>[_.row.title]})},{title:"正确",colKey:"accept"},{title:"提交",colKey:"attempt"}]),m=p([]),f=(u,_)=>{O.push({name:"contest-problem-detail",params:{contestId:u,problemIndex:_}})};return le(async()=>{if(Array.isArray(t.params.contestId)?l=t.params.contestId[0]:l=t.params.contestId,!l){await O.push({name:"contest"});return}c.value=!0;const u=await En(l);if(u.code!==0){c.value=!1,N(o,u.code),await O.push({name:"contest"});return}g.value=await Mt(u.data),m.value=g.value.problems,s.setTitle(g.value.title+" - "+s.getTitle),await we(()=>{const _=document.querySelectorAll(".dida-content-description");_&&_.length>0&&_.forEach(h=>{oe.mathRender(h),oe.highlightRender({lineNumber:!0,enable:!0},h),$e(h)}),c.value=!1})}),(u,_)=>{const h=ia,b=H,L=_e,P=Ct,E=St,z=xe,K=de,I=he,T=Re,D=De,w=ve,V=be;return j(),G(V,{loading:c.value},{default:n(()=>[a(w,{class:"dida-main-content"},{default:n(()=>[a(I,{span:8},{default:n(()=>{var x,v,i;return[M("div",so,[M("h1",null,q((x=g.value)==null?void 0:x.title),1),(v=g.value)!=null&&v.notification?(j(),G(h,{key:0,theme:"info",message:(i=g.value)==null?void 0:i.notification},null,8,["message"])):ie("",!0)]),a(E,{"default-value":[0],"expand-icon":!1,borderless:!0},{default:n(()=>{var r;return[(j(!0),X(te,null,fe((r=g.value)==null?void 0:r.descriptions,(d,k)=>(j(),G(P,{key:k,header:d.title},et({default:n(()=>[M("div",{innerHTML:d.content,class:"dida-content-description"},null,8,ro)]),_:2},[k===0?{name:"headerRightContent",fn:n(()=>[a(L,{size:"small"},{default:n(()=>[a(b,{size:"small"},{default:n(()=>_[0]||(_[0]=[y("收起全部")])),_:1}),a(b,{size:"small"},{default:n(()=>_[1]||(_[1]=[y("展开全部")])),_:1})]),_:1})]),key:"0"}:void 0]),1032,["header"]))),128))]}),_:1}),a(K,{style:{margin:"10px"}},{default:n(()=>[a(z,{data:m.value,columns:S.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1})]}),_:1}),a(I,{span:4},{default:n(()=>[M("div",uo,[a(D,{layout:"vertical",bordered:!0},{default:n(()=>[a(T,{label:"开始时间"},{default:n(()=>{var x;return[y(q((x=g.value)==null?void 0:x.startTime),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),co=Q(io,[["__scopeId","data-v-5e212303"]]);function qt(e){const t={};return t.id=e.id,t.authorId=e.author_id,t.authorUsername=e.author_username,t.authorNickname=e.author_nickname,t.title=e.title,t.content=e.content,e.insert_time&&(t.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(t.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(t.updateTime=new Date(e.update_time).toLocaleString()),t.problemId=e.problem_id,t.problemTitle=e.problem_title,t.contestId=e.contest_id,t.contestTitle=e.contest_title,t.contestProblemIndex=e.contest_problem_index,t}async function mo(e){const t={};if(t.id=e.id,t.authorId=e.author_id,t.authorUsername=e.author_username,t.authorNickname=e.author_nickname,t.content="",e.content){const o={math:{inlineDigit:!0,engine:"KaTeX"}};t.content=await oe.md2html(e.content,o)}return e.insert_time&&(t.insertTime=new Date(e.insert_time).toLocaleString()),e.modify_time&&(t.modifyTime=new Date(e.modify_time).toLocaleString()),e.update_time&&(t.updateTime=new Date(e.update_time).toLocaleString()),t}function po(e){return Y({url:"/discuss?id="+e,method:"get"})}function fo(e,t,o,s,l,c){const g={};return e&&(g.contest_id=e),t&&(g.problem_id=t),o&&(g.title=o),s&&(g.username=s),l&&(g.page=l),c&&(g.page_size=c),Y({url:`/discuss/list?${new URLSearchParams(g).toString()}`,method:"get"})}function _o(e,t,o){return Y({url:"/discuss/comment/list?id="+e+"&page="+t+"&page_size="+o,method:"get"})}function go(e){return Y({url:"/discuss/create",method:"post",data:e})}const vo={style:{margin:"10px"}};function ho(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Xe(e)}const bo=ae({__name:"DiscussList",setup(e){const t=ce(),o=qe(),{globalProperties:s}=ue();let l=null;const c=p(!1),g=p(!1);let S=0;const m=p([]),f=[{title:"ID",colKey:"id",width:"100",cell:(i,r)=>a(H,{variant:"text",onClick:()=>T(r.row.id)},{default:()=>[r.row.id]})}],u=[{title:"标题",colKey:"title",cell:(i,r)=>a(H,{variant:"text",onClick:()=>T(r.row.id)},{default:()=>[r.row.title]})},{title:"创建人",colKey:"authorNickname",width:"200"},{title:"创建时间",colKey:"insertTime",width:"180"},{title:"更新时间",colKey:"updateTime",width:"180"}],_=p(!1);let h=1,b=50;const L=p({current:h,pageSize:b,defaultCurrent:h,defaultPageSize:b,total:0,pageSizeOptions:[50,100]}),P=p(),E=p({problemId:"",title:"",username:""}),z=p({title:"",description:"",open_time:[]}),K=i=>{i&&o.push({name:"problem-detail",params:{problemId:i}})},I=(i,r)=>{o.push({name:"contest-problem-detail",params:{contestId:i,problemIndex:r}})},T=i=>{if(i){if(S){o.push({name:"contest-discuss-detail",params:{contestId:S,discussId:i}});return}o.push({name:"discuss-detail",params:{discussId:i}})}},D=async()=>{await o.push({query:{...t.query,problem_id:E.value.problemId,title:E.value.title,username:E.value.username,page:1,page_size:L.value.defaultPageSize}})},w=async(i,r)=>{var d;_.value=!0;try{const{current:k,pageSize:C}=i,A=await fo(S,E.value.problemId,E.value.title,E.value.username,k,C);if(P.value=[],A.code===0){if(A.data.list){const R=A.data.list;for(let J=0;J<R.length;J++){const F=R[J],U=await qt(F);(d=P.value)==null||d.push(U)}}L.value={...L.value,total:A.data.total_count}}else r&&N(s,A.code)}catch(k){console.error(k),N(s,Ie())}finally{_.value=!1}},V=async i=>{await o.push({query:{...t.query,page:i.current,page_size:i.pageSize}})},x=()=>{c.value=!0},v=async()=>{g.value=!0,console.log("discussCreateForm",z.value),go(z.value).then(i=>{i.code===0?(pe(s,"创建比赛成功"),c.value=!1,o.push({path:"/discuss/"+i.data.id})):N(s,i.code)}).finally(()=>{g.value=!1})};return le(async()=>{l=ze(()=>t.query,i=>{Array.isArray(t.params.contestId)?S=t.params.contestId[0]:S=t.params.contestId,m.value=f,S?m.value=m.value.concat([{title:"问题ID",colKey:"contestProblemIndex",width:"100",cell:(k,C)=>{let A;return a(H,{variant:"text",onClick:()=>I(S,C.row.contestProblemIndex)},ho(A=Ye(C.row.contestProblemIndex))?A:{default:()=>[A]})}}]):m.value=m.value.concat([{title:"问题ID",colKey:"problemId",width:"100",cell:(k,C)=>a(H,{variant:"text",onClick:()=>K(C.row.problemId)},{default:()=>[C.row.problemId]})}]),m.value=m.value.concat(u),E.value.problemId=i.problem_id||"",E.value.title=i.title||"",E.value.username=i.username||"";const r=parseInt(i.page)||L.value.defaultCurrent,d=parseInt(i.page_size)||L.value.defaultPageSize;h=r,b=d,L.value={...L.value,current:h,pageSize:b},w({current:h,pageSize:b},!0)},{immediate:!0})}),Le(()=>{l&&l()}),(i,r)=>{const d=xe,k=de,C=he,A=ke,R=Te,J=H,F=Pe,U=_e,W=ve,$=It,se=lt;return j(),X(te,null,[a(W,null,{default:n(()=>[a(C,{span:9},{default:n(()=>[a(k,{style:{margin:"10px"}},{default:n(()=>[a(d,{data:P.value,columns:m.value,"row-key":"id","vertical-align":"top",hover:!0,pagination:L.value,loading:_.value,"table-layout":"auto",onPageChange:V},null,8,["data","columns","pagination","loading"])]),_:1})]),_:1}),a(C,{span:3},{default:n(()=>[M("div",vo,[a(k,{class:"sh-card"},{default:n(()=>[a(F,{model:E.value},{default:n(()=>[a(R,{label:"问题ID"},{default:n(()=>[a(A,{modelValue:E.value.problemId,"onUpdate:modelValue":r[0]||(r[0]=Z=>E.value.problemId=Z),placeholder:"请输入完整问题ID"},null,8,["modelValue"])]),_:1}),a(R,{label:"标题"},{default:n(()=>[a(A,{modelValue:E.value.title,"onUpdate:modelValue":r[1]||(r[1]=Z=>E.value.title=Z),placeholder:"暂不支持模糊查询"},null,8,["modelValue"])]),_:1}),a(R,{label:"创建人"},{default:n(()=>[a(A,{modelValue:E.value.username,"onUpdate:modelValue":r[2]||(r[2]=Z=>E.value.username=Z),placeholder:"仅支持输入完整用户名"},null,8,["modelValue"])]),_:1}),a(R,null,{default:n(()=>[a(J,{theme:"primary",onClick:D},{default:n(()=>r[7]||(r[7]=[y("提交")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(k,{class:"sh-card"},{default:n(()=>[a(U,null,{default:n(()=>[a(J,{onClick:x},{default:n(()=>r[8]||(r[8]=[y("创建")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),a(se,{visible:c.value,"onUpdate:visible":r[6]||(r[6]=Z=>c.value=Z),header:"创建比赛",onConfirm:v,"confirm-loading":g.value},{default:n(()=>[a(F,{"label-width":80,model:z.value,onSubmit:r[5]||(r[5]=Me(()=>{},["prevent"]))},{default:n(()=>[a(R,{label:"标题"},{default:n(()=>[a(A,{modelValue:z.value.title,"onUpdate:modelValue":r[3]||(r[3]=Z=>z.value.title=Z),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),a(R,{label:"开启时间"},{default:n(()=>[a($,{"enable-time-picker":"","allow-input":"",clearable:"",modelValue:z.value.open_time,"onUpdate:modelValue":r[4]||(r[4]=Z=>z.value.open_time=Z)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])],64)}}}),Oe=Q(bo,[["__scopeId","data-v-97dda3a0"]]),yo={key:0,style:{margin:"20px"}},wo=["innerHTML"],ko=["innerHTML"],Co={style:{margin:"10px"}},So={style:{margin:"10px"}},Io={style:{margin:"10px","text-align":"right"}},Lo={style:{margin:"12px"}},Po={key:0,class:"dida-edit-container"},To=ae({__name:"DiscussDetail",setup(e){let t=ce();const{globalProperties:o}=ue();let s=null;const l=je(),c=ge();let g=p("");const S=p(""),m=p(null),f=p(!1),u=p(null),_=p(!1);let h=1,b=20;const L=p({current:1,total:0,defaultPageSize:b,defaultCurrent:h,pageSizeOptions:[20,50]}),P=p([]),E={},z=Ce(()=>c.hasAuth(Se.ManageDiscuss)),K=x=>{x&&O.push({name:"discuss-list",query:{...t.query,title:"",tag:x.name}})},I=()=>{O.push({name:"manage-discuss",params:{discussId:S.value}})},T=()=>a("div",{class:"t-pagination__total"},[`共 ${L.value.total} 条回复`]),D=()=>{},w=async(x,v)=>{var i;_.value=!0;try{const{current:r,pageSize:d}=x,k=await _o(S.value,r,d);if(P.value=[],k.code===0){const C=k.data.list;if(C)for(let A=0;A<C.length;A++){const R=C[A],J=await mo(R);(i=P.value)==null||i.push(J),await we(()=>{const F=document.querySelectorAll(".dida-discuss-content");F&&F.length>0&&F.forEach(U=>{oe.mathRender(U),oe.highlightRender({lineNumber:!0,enable:!0},U),$e(U)})})}L.value={...L.value,total:k.data.total_count}}else v&&N(o,k.code)}catch(r){console.error(r),N(o,Ie())}finally{_.value=!1}},V=async x=>{await O.push({query:{...t.query,page:x.current,page_size:x.pageSize}})};return le(async()=>{if(Array.isArray(t.params.discussId)?S.value=t.params.discussId[0]:S.value=t.params.discussId,!S.value){me(o,"题目不存在"),await O.push({name:"discuss"});return}f.value=!0;const x=await po(S.value);if(x.code!==0){f.value=!1,N(o,x.code),await O.push({name:"discuss"});return}x.data.tags&&x.data.tags.forEach(d=>{E[d.id]=d}),u.value=qt(x.data.discuss),l.setTitle(u.value.title+" - "+l.getTitle);let v=u.value.content;const i={math:{inlineDigit:!0,engine:"KaTeX"}};g.value=await oe.md2html(v,i),await we(()=>{m.value&&(oe.mathRender(m.value),oe.highlightRender({lineNumber:!0,enable:!0},m.value),$e(m.value)),f.value=!1}),s=ze(()=>t.query,d=>{const k=parseInt(d.page)||L.value.defaultCurrent,C=parseInt(d.page_size)||L.value.defaultPageSize;h=k,b=C,L.value={...L.value,current:h,pageSize:b},w({current:h,pageSize:b},!0)},{immediate:!0});const r={after:()=>{}};new oe("commentEditRef",r)}),Le(()=>{s&&s()}),(x,v)=>{const i=da,r=ca,d=de,k=_e,C=ma,A=H,R=he,J=Re,F=De,U=ve,W=be;return j(),G(W,{loading:f.value},{default:n(()=>[a(U,{class:"dida-main-content"},{default:n(()=>[a(R,{span:8},{default:n(()=>{var $,se,Z;return[($=u.value)!=null&&$.problemTitle||(se=u.value)!=null&&se.contestTitle?(j(),X("div",yo,[a(r,{"max-item-width":"300"},{default:n(()=>{var re,B,Ae,ut;return[(re=u.value)!=null&&re.contestTitle?(j(),X(te,{key:0},[a(i,{to:{name:"contest-detail",params:{contestId:(B=u.value)==null?void 0:B.contestId}}},{default:n(()=>{var ye;return[y(q((ye=u.value)==null?void 0:ye.contestTitle),1)]}),_:1},8,["to"]),a(i,{to:{name:"contest-problem-detail",params:{problemId:(Ae=u.value)==null?void 0:Ae.contestProblemIndex}}},{default:n(()=>{var ye,it;return[y(q(ne(Ye)((ye=u.value)==null?void 0:ye.contestProblemIndex))+" - "+q((it=u.value)==null?void 0:it.problemTitle),1)]}),_:1},8,["to"])],64)):(j(),X(te,{key:1},[a(i,{to:{name:"discuss-list-problem"}},{default:n(()=>v[2]||(v[2]=[y(" 问题讨论")])),_:1}),a(i,{to:{name:"problem-detail",params:{problemId:(ut=u.value)==null?void 0:ut.problemId}}},{default:n(()=>{var ye;return[y(q((ye=u.value)==null?void 0:ye.problemTitle),1)]}),_:1},8,["to"])],64))]}),_:1})])):ie("",!0),a(d,{style:{margin:"10px"},header:(Z=u.value)==null?void 0:Z.title,"header-bordered":!0},{default:n(()=>[M("div",{innerHTML:ne(g),class:"dida-discuss-content"},null,8,wo)]),_:1},8,["header"]),(j(!0),X(te,null,fe(P.value,(re,B)=>(j(),G(d,{key:B,style:{margin:"10px"},"header-bordered":""},{header:n(()=>[a(k,null,{default:n(()=>[M("span",null,q(re.authorNickname),1),M("span",null,q(re.insertTime),1)]),_:2},1024)]),default:n(()=>[M("div",{innerHTML:re.content,class:"dida-discuss-content"},null,8,ko)]),_:2},1024))),128)),M("div",Co,[a(C,{modelValue:L.value.current,"onUpdate:modelValue":v[0]||(v[0]=re=>L.value.current=re),"page-size":L.value.pageSize,"onUpdate:pageSize":v[1]||(v[1]=re=>L.value.pageSize=re),total:L.value.total,"page-size-options":L.value.pageSizeOptions,"show-page-size":!1,"total-content":T,onChange:V},null,8,["modelValue","page-size","total","page-size-options"])]),M("div",So,[v[4]||(v[4]=M("div",{id:"commentEditRef",class:"dida-comment-editor"},null,-1)),M("div",Io,[a(k,null,{default:n(()=>[a(A,{theme:"primary",onClick:D},{default:n(()=>v[3]||(v[3]=[y("提交")])),_:1})]),_:1})])])]}),_:1}),a(R,{span:4},{default:n(()=>[M("div",Lo,[z.value?(j(),X("div",Po,[a(A,{onClick:I},{default:n(()=>v[5]||(v[5]=[y("编辑")])),_:1})])):ie("",!0),a(F,{layout:"vertical",bordered:!0},{default:n(()=>[a(J,{label:"创建时间"},{default:n(()=>{var $;return[y(q(($=u.value)==null?void 0:$.insertTime),1)]}),_:1}),a(J,{label:"编辑时间"},{default:n(()=>{var $;return[y(q(($=u.value)==null?void 0:$.modifyTime),1)]}),_:1}),a(J,{label:"更新时间"},{default:n(()=>{var $;return[y(q(($=u.value)==null?void 0:$.updateTime),1)]}),_:1}),a(J,{label:"创建用户"},{default:n(()=>{var $;return[y(q(($=u.value)==null?void 0:$.authorNickname),1)]}),_:1}),a(J,{label:"标签"},{default:n(()=>[a(k,null,{default:n(()=>{var $;return[(j(!0),X(te,null,fe(($=u.value)==null?void 0:$.tags,se=>(j(),G(A,{key:se.id,variant:"dashed",onClick:()=>K(se)},{default:n(()=>[y(q(se.name),1)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),pt=Q(To,[["__scopeId","data-v-17657340"]]),xo=ae({__name:"ManageJudge",setup(e){const{globalProperties:t}=ue(),o=p(""),s=p(!1),l=p(!1),c=async()=>{try{const m=await Sn();if(m.code!==0){N(t,m.code);return}pe(t,"重判成功"),await O.push({name:"judge-list"})}catch(m){console.error(m),N(t,"重判失败")}},g=async()=>{if(o.value===""){N(t,"请输入问题Id");return}s.value=!0;try{const m=await In(o.value);if(m.code!==0){N(t,m.code);return}pe(t,"重判成功"),await O.push({name:"judge-list",query:{problem_id:o.value}})}catch(m){console.error(m),N(t,"重判失败")}finally{s.value=!1}},S=async()=>{l.value=!0;try{const m=await Ln();if(m.code!==0){N(t,m.code);return}pe(t,"重判成功"),await O.push({name:"judge-list"})}catch(m){console.error(m),N(t,"重判失败")}finally{l.value=!1}};return(m,f)=>{const u=H,_=de,h=ke,b=_e;return j(),X(te,null,[a(_,{class:"yj-manage-card",title:"重判最近提交"},{default:n(()=>[a(u,{onClick:c},{default:n(()=>f[1]||(f[1]=[y("重判")])),_:1})]),_:1}),a(_,{class:"yj-manage-card",title:"重判问题"},{default:n(()=>[a(b,null,{default:n(()=>[a(h,{modelValue:o.value,"onUpdate:modelValue":f[0]||(f[0]=L=>o.value=L),placeholder:"输入问题Id"},null,8,["modelValue"]),a(u,{onClick:g,loading:s.value},{default:n(()=>f[2]||(f[2]=[y("重判")])),_:1},8,["loading"])]),_:1})]),_:1}),a(_,{class:"yj-manage-card",title:"重判所有"},{default:n(()=>[a(u,{onClick:S,theme:"danger",loading:l.value},{default:n(()=>f[3]||(f[3]=[y("重判")])),_:1},8,["loading"])]),_:1})],64)}}}),jo=Q(xo,[["__scopeId","data-v-60a14d44"]]),Vo={style:{margin:"10px"}},$o={key:1},zo={style:{margin:"12px"}},Do={class:"dida-edit-container"},Ro=ae({__name:"ProblemEdit",setup(e){let t=ce();const{globalProperties:o}=ue(),s=je(),l=p(""),c=p(!1);let g=null;const S=p(!1),m=p(null),f=p({title:"",timeLimit:0,memoryLimit:0,source:"",tags:[]}),u=p([]),_=p([]),h=Ce(()=>{const I=[],T=u.value;for(let D=0,w=T.length;D<w;D++)T[D].value&&I.push(T[D].value);return I}),b=(I,T)=>{const{trigger:D,index:w,item:V}=T;if(D==="clear"&&(u.value=[]),["tag-remove","backspace"].includes(D)&&u.value.splice(w,1),D==="enter"){for(let v=0;v<_.value.length;v++){const i=_.value[v];if(i.label===V){for(let r=0;r<u.value.length;r++)if(u.value[r].label===i.label)return;u.value.push(i);return}}const x={label:V,value:V};u.value.push(x),_.value=_.value.concat(x)}},L=(I,{current:T,type:D})=>{if(!T){u.value=D==="check"?_.value.slice(1):[];return}if(D==="check"){const w=_.value.find(V=>V.value===T);if(!w)return;u.value.push(w)}else u.value=u.value.filter(w=>w.value!==T)},P=()=>{O.push({name:"problem-detail",params:{problemId:l.value}})},E=()=>{O.push({name:"manage-problem-judge",params:{problemId:l.value}})},z=async()=>{if(g){S.value=!0,f.value.tags=[];for(let I=0;I<u.value.length;I++){const T=u.value[I];T&&T.label&&f.value.tags.push(T.label)}try{const I=await jn(l.value,f.value.title,f.value.timeLimit,f.value.memoryLimit,f.value.source,f.value.tags,g.getValue());if(S.value=!0,I.code!==0){N(o,I.code);return}I.data!=null&&(m.value.updateTime=new Date(I.data).toLocaleString()),xt(o,"保存成功")}finally{S.value=!1}}},K=async()=>{const I=await At(l.value);if(I.code!==0){N(o,I.code),console.error("problem get failed",I.code),await O.push({name:"problem"});return}const T=I.data.problem;if(m.value=We(T,{}),f.value.title=T.title,f.value.timeLimit=T.time_limit,f.value.memoryLimit=T.memory_limit,f.value.source=T.source,f.value.tags=[],u.value=[],I.data.tags)for(let V=0;V<I.data.tags.length;V++){const x=I.data.tags[V];x&&x.name&&(f.value.tags.push(x.name),u.value.push({label:x.name,value:x.id}))}s.setTitle(T.title+" - "+s.getTitle);let D=T.description;const w={after:()=>{g==null||g.setValue(D)}};g=new oe("codeEditRef",w),c.value=!1};return le(async()=>{if(Array.isArray(t.params.problemId)?l.value=t.params.problemId[0]:l.value=t.params.problemId,!l.value){me(o,"题目不存在"),await O.push({name:"problem"});return}c.value=!0,Et(-1).then(async I=>{I.code===0?(I.data.list&&I.data.list.forEach(T=>{_.value.push({label:T.name,value:T.id})}),await K()):(N(o,I.code),console.error("problem tag get failed",I.code),await O.push({name:"problem"}))}).catch(async I=>{console.error(I),N(o,"获取数据异常"),await O.push({name:"problem"})})}),(I,T)=>{const D=ke,w=Te,V=pa,x=_a,v=fa,i=Pe,r=de,d=he,k=H,C=_e,A=Re,R=De,J=ve,F=be;return j(),G(F,{loading:c.value},{default:n(()=>[a(J,null,{default:n(()=>[a(d,{span:8},{default:n(()=>[M("div",Vo,[a(r,{class:"sh-card"},{default:n(()=>[a(i,{model:f.value},{default:n(()=>[a(w,{label:"标题"},{default:n(()=>[a(D,{modelValue:f.value.title,"onUpdate:modelValue":T[0]||(T[0]=U=>f.value.title=U),placeholder:"问题标题"},null,8,["modelValue"])]),_:1}),a(w,{label:"时间限制"},{default:n(()=>[a(V,{modelValue:f.value.timeLimit,"onUpdate:modelValue":T[1]||(T[1]=U=>f.value.timeLimit=U),theme:"normal",min:0},{suffix:n(()=>T[4]||(T[4]=[M("span",null,"ms",-1)])),_:1},8,["modelValue"])]),_:1}),a(w,{label:"内存限制"},{default:n(()=>[a(V,{modelValue:f.value.memoryLimit,"onUpdate:modelValue":T[2]||(T[2]=U=>f.value.memoryLimit=U),theme:"normal",min:0},{suffix:n(()=>T[5]||(T[5]=[M("span",null,"KB",-1)])),_:1},8,["modelValue"])]),_:1}),a(w,{label:"来源"},{default:n(()=>[a(D,{modelValue:f.value.source,"onUpdate:modelValue":T[3]||(T[3]=U=>f.value.source=U),placeholder:"请输入题目来源"},null,8,["modelValue"])]),_:1}),a(w,{label:"标签"},{default:n(()=>[a(v,{value:u.value,"allow-input":!0,placeholder:"请选择或输入","tag-input-props":{excessTagsDisplayType:"break-line"},"popup-props":{overlayInnerClassName:["narrow-scrollbar"],overlayInnerStyle:{maxHeight:"280px",overflowY:"auto",overscrollBehavior:"contain",padding:"6px"}},clearable:"",multiple:"",onTagChange:b},{panel:n(()=>[_.value.length?(j(),G(x,{key:0,value:h.value,options:_.value,onChange:L},null,8,["value","options"])):(j(),X("div",$o,"暂无数据"))]),suffixIcon:n(()=>[a(ne(Ft))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),a(d,{span:4},{default:n(()=>[M("div",zo,[M("div",Do,[a(C,null,{default:n(()=>[a(k,{onClick:z,theme:"danger",loading:S.value},{default:n(()=>T[6]||(T[6]=[y("保存")])),_:1},8,["loading"]),a(k,{onClick:E,theme:"warning"},{default:n(()=>T[7]||(T[7]=[y("判题数据")])),_:1}),a(k,{onClick:P},{default:n(()=>T[8]||(T[8]=[y("查看")])),_:1})]),_:1})]),a(R,{layout:"vertical",bordered:!0},{default:n(()=>[a(A,{label:"创建时间"},{default:n(()=>{var U;return[y(q((U=m.value)==null?void 0:U.insertTime),1)]}),_:1}),a(A,{label:"更新时间"},{default:n(()=>{var U;return[y(q((U=m.value)==null?void 0:U.updateTime),1)]}),_:1}),a(A,{label:"判题方式"},{default:n(()=>{var U;return[y(q((U=m.value)==null?void 0:U.judgeType),1)]}),_:1}),a(A,{label:"上传用户"},{default:n(()=>{var U;return[y(q((U=m.value)==null?void 0:U.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1}),T[9]||(T[9]=M("div",{id:"codeEditRef",class:"dida-description-editor"},null,-1))]),_:1},8,["loading"])}}}),Ao=Q(Ro,[["__scopeId","data-v-b8d494d1"]]),Eo={style:{margin:"10px"}},Mo={style:{margin:"12px"}},qo={class:"dida-edit-container"},Uo=ae({__name:"ProblemJudge",setup(e){let t=ce();const{globalProperties:o}=ue(),s=je(),l=p(""),c=p(!1),g=p(null);let S=null;const m=p(null),f=p(""),u=p(!1),_=p(!1),h=p([{title:"文件",colKey:"file"},{title:"大小",colKey:"size",width:150,cell:(i,r)=>r.row.size.toFixed(0)+" B"},{title:"最后修改时间",colKey:"lastModified",width:180,cell:(i,r)=>new Date(r.row.lastModified).toLocaleString()},{title:"操作",colKey:"action",width:100,cell:(i,r)=>a(H,{onClick:()=>K(r.row.file)},{default:()=>[y("下载")]})}]),b=p([]),L=Ce(()=>({border:"2px dashed #ccc",borderRadius:"6px",padding:"20px",textAlign:"center",cursor:"pointer",backgroundColor:u.value?"#f0f9ff":"#fff",transition:"background-color 0.2s ease"})),P=Ce(()=>f.value?`已选择：${f.value}`:u.value?"松开文件以上传":"拖拽文件到这里，或点击选择文件"),E=()=>{O.push({name:"problem-detail",params:{problemId:l.value}})},z=()=>{O.push({name:"manage-problem",params:{problemId:l.value}})},K=async i=>{const r=await Vn(l.value,i);if(r.code!==0){N(o,r.code);return}const d=document.createElement("a");d.href=r.data,d.target="_blank",d.click(),URL.revokeObjectURL(d.href)},I=async()=>{if(!S){me(o,"请选择压缩包");return}_.value=!0,$n(l.value,S).then(async i=>{i.code==0?(m.value.value=null,S=null,f.value="",c.value=!0,xt(o,"上传成功"),await v()):N(o,i.code)}).catch(i=>{console.log(i),o.$message.error({duration:3e3,content:"申请失败"})}).finally(()=>{_.value=!1})},T=()=>{var i;(i=m.value)==null||i.click()},D=i=>{const r=i.target.files[0];r&&(f.value=r.name,S=r)},w=i=>{u.value=!0},V=()=>{u.value=!1},x=i=>{i.preventDefault(),i.stopPropagation(),u.value=!1;const r=i.dataTransfer.files[0];if(r){f.value=r.name;const d=new DataTransfer;d.items.add(r),m.value.files=d.files,S=r}},v=async()=>{const i=await Tn(l.value);if(i.code!==0){N(o,i.code),await O.push({name:"problem"});return}const r=i.data.problem;g.value=We(r,{}),s.setTitle(r.title+" - "+s.getTitle),b.value=[],i.data.judges?i.data.judges.forEach(d=>{b.value.push({file:d.key,size:d.size,lastModified:d.last_modified})}):me(o,"评测数据不存在"),c.value=!1};return le(async()=>{if(Array.isArray(t.params.problemId)?l.value=t.params.problemId[0]:l.value=t.params.problemId,!l.value){me(o,"题目不存在"),await O.push({name:"problem"});return}c.value=!0,await v()}),(i,r)=>{const d=xe,k=he,C=H,A=_e,R=Re,J=De,F=ve,U=be;return j(),G(U,{loading:c.value},{default:n(()=>[a(F,null,{default:n(()=>[a(k,{span:7},{default:n(()=>[M("div",Eo,[M("div",{id:"drop-zone",style:ht(L.value),onClick:T,onDragenter:Me(w,["prevent"]),onDragover:r[0]||(r[0]=Me(()=>{},["prevent"])),onDragleave:Me(V,["prevent"]),onDrop:x},[M("input",{ref_key:"fileInput",ref:m,type:"file",style:{display:"none"},onChange:D},null,544),y(" "+q(P.value),1)],36)]),a(d,{data:b.value,columns:h.value,"row-key":"id","vertical-align":"top",hover:!0},null,8,["data","columns"])]),_:1}),a(k,{span:5},{default:n(()=>[M("div",Mo,[M("div",qo,[a(A,null,{default:n(()=>[a(C,{onClick:I,theme:"danger",loading:_.value},{default:n(()=>r[1]||(r[1]=[y("上传")])),_:1},8,["loading"]),a(C,{onClick:z,theme:"warning"},{default:n(()=>r[2]||(r[2]=[y("编辑")])),_:1}),a(C,{onClick:E},{default:n(()=>r[3]||(r[3]=[y("查看")])),_:1})]),_:1})]),a(J,{layout:"vertical",bordered:!0},{default:n(()=>[a(R,{label:"标题"},{default:n(()=>{var W;return[y(q((W=g.value)==null?void 0:W.title),1)]}),_:1}),a(R,{label:"创建时间"},{default:n(()=>{var W;return[y(q((W=g.value)==null?void 0:W.insertTime),1)]}),_:1}),a(R,{label:"更新时间"},{default:n(()=>{var W;return[y(q((W=g.value)==null?void 0:W.updateTime),1)]}),_:1}),a(R,{label:"判题方式"},{default:n(()=>{var W;return[y(q((W=g.value)==null?void 0:W.judgeType),1)]}),_:1}),a(R,{label:"评测数据"},{default:n(()=>{var W;return[y(q((W=g.value)==null?void 0:W.judgeMd5),1)]}),_:1}),a(R,{label:"上传用户"},{default:n(()=>{var W;return[y(q((W=g.value)==null?void 0:W.creatorNickname),1)]}),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["loading"])}}}),Ho=Q(Uo,[["__scopeId","data-v-17986e38"]]),Ut=[{name:"problem-list",tab:"problem",sidebar:"problem-list",path:"",title:"问题列表",icon:"list",component:An},{name:"problem-detail",tab:"problem",sidebar:"problem-list",path:":problemId+",title:"问题详情",icon:"list",component:dt},{name:"problem-recommend",tab:"problem",sidebar:"problem-recommend",path:"recommend/:problemId*",title:"问题推荐",icon:"cpu",component:Xn},{name:"judge-list",tab:"judge",sidebar:"judge-list",path:"",title:"评测列表",icon:"list",component:Zn},{name:"judge-detail",tab:"judge",sidebar:"judge-list",path:":judgeId+",title:"评测详情",icon:"cpu",component:no},{name:"contest-list",tab:"contest",sidebar:"contest-list",path:"",title:"比赛列表",icon:"list",component:Ee},{name:"contest-recent",tab:"contest",sidebar:"contest-recent",path:"recent",title:"近期比赛",icon:"list",component:Ee},{name:"contest-detail",tab:"contest-detail-tab",sidebar:"contest-detail",path:":contestId+",title:"比赛详情",icon:"cpu",component:co},{name:"contest-problem-detail",tab:"contest-detail-tab",sidebar:"contest-problem-detail",path:":contestId+/problem/:problemIndex+",title:"问题详情",icon:"cpu",component:dt},{name:"contest-judge",tab:"contest-detail-tab",sidebar:"contest-judge",path:":contestId+/judge",title:"评测列表",icon:"list",component:Ee},{name:"contest-rank",tab:"contest-detail-tab",sidebar:"contest-rank",path:":contestId+/rank",title:"比赛排名",icon:"list",component:Ee},{name:"contest-statistics",tab:"contest-detail-tab",sidebar:"contest-statistics",path:":contestId+/statistics",title:"结果统计",icon:"list",component:Ee},{name:"contest-discuss",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss",title:"比赛讨论",icon:"list",component:Oe},{name:"contest-discuss-detail",tab:"contest-detail-tab",sidebar:"contest-discuss",path:":contestId+/discuss/:discussId+",title:"讨论详情",icon:"list",component:pt},{name:"discuss-list",tab:"discuss",sidebar:"discuss-list",path:"",title:"讨论列表",icon:"list",component:Oe},{name:"discuss-list-problem",tab:"discuss",sidebar:"discuss-list-problem",path:"problem",title:"问题讨论",icon:"list",component:Oe},{name:"discuss-list-judge",tab:"discuss",sidebar:"discuss-list-judge",path:"judge",title:"评测讨论",icon:"list",component:Oe},{name:"discuss-detail",tab:"discuss",sidebar:"discuss-list",path:":discussId+",title:"讨论详情",icon:"list",component:pt},{name:"manage-problem",tab:"manage",sidebar:"manage-problem",disableSidebar:!0,path:"problem/:problemId+",title:"问题编辑",icon:"list",component:Ao,auths:[Se.ManageProblem]},{name:"manage-problem-judge",tab:"manage",sidebar:"manage-problem-judge",disableSidebar:!0,path:"problem/:problemId+/judge",title:"评测数据",icon:"list",component:Ho,auths:[Se.ManageProblem]},{name:"manage-judge",tab:"manage",path:"judge",sidebar:"manage-judge",title:"评测管理",icon:"list",auths:["i-manage-judge"],component:jo}],ft=(e,t,o,s)=>{s.tab==o&&(s.disableSidebar&&t!=s.sidebar||s.sidebar==null||s.sidebar!=s.name||e.push({name:s.name,title:s.title,icon:s.icon,to:{name:s.name}}))},No=(e,t)=>{const o=[];return Ut.forEach(s=>{if(jt(s)){const l=[];s.children.forEach(c=>{ft(l,e,t,c)}),l.length>0&&o.push({title:s.title,children:l})}else ft(o,e,t,s)}),o},_t=(e,t)=>{const o=Na(t.tab),s={name:t.name,path:"/"+t.path,meta:{title:t.title+" - "+o.title,tab:t.tab,sidebar:t.sidebar,showSidebar:o.showSidebar,needLogin:o.needLogin||t.needLogin,tabAuths:o.auths,auths:t.auths},component:t.component};o.disablePath||(s.path=o.path+s.path),e.push(s)},Go=e=>{Ut.forEach(t=>{jt(t)?t.children.forEach(o=>{_t(e,o)}):_t(e,t)})},Ue=[];Oa(Ue);Go(Ue);Ue.push({path:"/403",name:"403",component:Vt});Ue.push({path:"/:pathMatch(.*)*",name:"404",component:Tt});const O=Bt({history:Xt("/"),routes:Ue});O.beforeEach((e,t,o)=>{if(e.name==null||!O.hasRoute(e.name)){o({name:"home"});return}const s=e.matched[e.matched.length-1].meta;if(s.redirect){o({name:s.redirect});return}if(s.needLogin){const c=ge();if(c.getToken==null||c.getToken==""){o({name:"login",query:{redirect_uri:e.fullPath}});return}}const l=s.tabAuths;if(l&&!ge().hasAllAuths(l)){o({name:"403",query:{target:e.fullPath}});return}o()});O.afterEach((e,t)=>{if(e.name===t.name)return;const o=Je(),s=je();let l=null;if(e.matched.length>0&&(l=e.matched[e.matched.length-1].meta),l!=null&&l.title&&s.setTitle(l==null?void 0:l.title),l!=null&&l.showSidebar){o.setSidebarShow(!0);const c=No(l==null?void 0:l.sidebar,l==null?void 0:l.tab);o.setMenuList(c),o.setMenuActiveName(l==null?void 0:l.sidebar)}else o.setSidebarShow(!1)});va.registerLanguage("verilog",ha);const Ht=Jt();Ht.use(Wt);const He=Yt(gn);He.use(Ht);He.use(O);He.use(ga);He.use(Zt);He.mount("#app");ja().then(()=>{console.log("Text cache reinitialized")}).catch(e=>{console.error("Text cache reinitialization failed",e)});
